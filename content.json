[{"title":"å…³é—­ Flink Checkpointï¼Œå¼•å‘ P3 æ•…éšœ","date":"2022-10-08T16:00:00.000Z","path":"2022/10/09/flink-disable-checkpoint/","text":"è®°å½•ä¸€ä¸ªæ¯”è¾ƒæœ‰æ„ä¹‰çš„æ•…éšœï¼Œæ²¡é‡åˆ°çš„å¯ä»¥é¿å‘ï¼Œå·²ç»è¢«å‘è¿‡çš„åªèƒ½æ¡æ‰‹ğŸ¤äº†ã€‚ èƒŒæ™¯å› é˜¿é‡Œäº‘æç¤ºæœºå™¨æœ‰æ•…éšœï¼Œä¼šåœ¨ç¬¬äºŒå¤©æ—©é«˜å³°è‡ªåŠ¨é‡å¯ï¼ŒæŒ‰ç…§ä¹‹å‰è¿ç»´æ“ä½œï¼Œæå‰åšå¥½é€šçŸ¥åï¼Œåœ¨é›†ç¾¤éé«˜å³°æœŸå°†æœºå™¨è¸¢å‡ºé›†ç¾¤ã€‚è¸¢å‡ºé›†ç¾¤æ—¶è¯¥æœºå™¨ä¸Šè¿è¡Œçš„ TaskManager Pod ä¼šæŒ‚æ‰ï¼ŒFlink ä¼šåœ¨å…¶ä»–æ­£å¸¸æœºå™¨ä¸Šç”³è¯·æ–°çš„ TaskManager è¿è¡Œï¼ŒæœŸé—´ä¼šæœ‰ä»»åŠ¡çš„ failoverã€‚ æ“ä½œå 10 æ¥åˆ†é’Ÿçœ‹åˆ°å…¬å¸å¤§ç¾¤æœ‰å€¼ç­åŒäº‹å“åº”æŒ‡æ ‡å¼‚å¸¸é—®é¢˜ï¼ŒåŠ å…¥åˆ°é—®é¢˜ç¾¤èŠä¸­å‘ç°å¯èƒ½å’Œå‰”é™¤æ•…éšœæœºå™¨æœ‰å…³ï¼Œäºæ˜¯åŠ å…¥æ’æŸ¥ï¼Œæä¾›äº†å½“æ—¶å—å½±å“çš„ä»»åŠ¡ä¿¡æ¯ï¼Œå‘ç°äº†å¼‚å¸¸æŒ‡æ ‡å¯¹åº”çš„ä»»åŠ¡å½“æ—¶åœ¨æ¶ˆè´¹ 10 åˆ†é’Ÿä¹‹å‰çš„æ•°æ®ã€‚ è€Œè¿™ä¸ªæ¶ˆè´¹å»¶è¿Ÿæ—¶é•¿å¯¹äºè¯¥ä½œä¸šçš„ä¸šåŠ¡åœºæ™¯å®Œå…¨ä¸èƒ½æ¥å—ï¼ˆå»¶è¿Ÿ 10s å°±ä¼šé€ æˆå¾ˆå¤§é—®é¢˜ï¼‰ï¼Œæœ€ç»ˆå»¶è¿Ÿå¯¼è‡´ä¸šåŠ¡æŒ‡æ ‡ä¸‹è·Œï¼Œäº§ç”Ÿèµ„æŸï¼Œæ•…éšœæœ€ç»ˆå®šçº§ P3ã€‚ è§£å†³åŠæ³•ï¼šä¸šåŠ¡æ–¹åœäº†å‡ ä¸ªåŒæ­¥æ•°æ®åˆ° ES ç´¢å¼•çš„ä»»åŠ¡ï¼Œç„¶åé‡å»ºäº†ä¸»é“¾ç´¢å¼•ä»»åŠ¡ï¼ˆä»»åŠ¡åŒæ—¶åŠ å¤§å¹¶å‘ï¼‰ï¼Œä¸‹æ¸¸åˆ‡æ¢åˆ°æ–°ç´¢å¼•å³æ¢å¤ã€‚ æ•…éšœæ ¹å› åˆ†æè¿‡ç¨‹äº‹åæ‰¾ä¸šåŠ¡æ–¹çº¿ä¸‹è®¨è®ºäº†ä¸€ä¸‹ï¼Œåˆæ­¥åˆ†ææ˜¯ ES å‹åŠ›å¤§ï¼Œå¯¼è‡´ Flink ä»»åŠ¡æœ‰åå‹ï¼Œä»è€Œå¼•èµ·ä»»åŠ¡ Source ç«¯æ¶ˆè´¹ Kafka æ•°æ®å¯¼è‡´çš„å»¶è¿Ÿã€‚ æœ¬ä»¥ä¸ºç»“è®ºå°±æ˜¯å‰”é™¤æœºå™¨åï¼Œå—å½±å“ä»»åŠ¡æ¯”è¾ƒå¤šï¼Œä»»åŠ¡ failover åä¼šä»ä¸Šä¸€æ¬¡ Checkpoint ä¿å­˜çš„ Kafka offset å¼€å§‹æ¶ˆè´¹ï¼Œè¿™æ—¶å€™å†™åˆ° ES çš„æ•°æ®é‡ä¼šæ¯”æ­£å¸¸å¤š 2min å·¦å³çš„æ•°æ®ï¼ˆCheckpoint é›†ç¾¤é»˜è®¤è®¾ç½®çš„ 2min æ‰§è¡Œä¸€æ¬¡ï¼‰ï¼Œä»è€Œå¯¼è‡´å¯¹ ES æœ‰ç‚¹å‹åŠ›è¿›è€Œå½±å“åˆ° Flink ä»»åŠ¡å‡ºç°åå‹æƒ…å†µã€‚ä½†æ˜¯æ™šä¸Šä¸šåŠ¡æ–¹ç»™æˆ‘æä¾›äº†ä¸€ä¸ªå¦å¤–å—å½±å“ä»»åŠ¡ï¼ˆè¿™é‡Œç§°å¤‡é“¾ä»»åŠ¡ï¼Œä¸»é“¾ä»»åŠ¡å°±æ˜¯é‚£ä¸ªæ¶ˆè´¹ 10 åˆ†é’Ÿä¹‹å‰æ•°æ®çš„ä»»åŠ¡ï¼‰çš„ä½œä¸šç›‘æ§é“¾æ¥ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡è¿™ä¸ªä»»åŠ¡çš„ç›‘æ§ä¿¡æ¯æ‰çœŸæ­£å‘ç°é—®é¢˜çš„æ ¹å› ã€‚ å½“æ—¶å‘ç°è¿™ä¸ªå¤‡é“¾ä»»åŠ¡åœ¨æ•…éšœåæœ‰å¤§éƒ¨åˆ† TaskManager çš„ task æ˜¯ä» 22 ä¸ªå°æ—¶ä¹‹å‰çš„æ•°æ®å¼€å§‹æ¶ˆè´¹çš„ï¼Œå¦‚ä¸‹å›¾ç›‘æ§æ‰€ç¤ºï¼š åˆæœ‰å°‘éƒ¨åˆ† TaskManager çš„ task æ˜¯æ­£å¸¸æ¶ˆè´¹çš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š åœ¨ failover ä¹‹åè¯¥å¤‡é“¾ä»»åŠ¡çš„æ¶ˆè´¹é€Ÿåº¦ TPS ä»æ­£å¸¸çš„ä¸¤åƒå¢é•¿åˆ° 12W/s ä¸»é“¾ä»»åŠ¡ failover åæ‰€æœ‰çš„ task æ¶ˆè´¹æ¯”è¾ƒæ­£å¸¸ï¼ˆå‰æ–‡å·²æˆªå›¾ï¼‰ï¼Œå¯¹æ¯”å‡ ä¸ªç›‘æ§æ¥çœ‹è¯¥å¤‡é“¾ä»»åŠ¡åœ¨ failover åæ˜æ˜¾æ¶ˆè´¹æœ‰å¼‚å¸¸ï¼Œå³æ¶ˆè´¹ 22 å°æ—¶ä¹‹å‰çš„æ•°æ®ï¼ŒåŒæ—¶çœ‹åˆ°ä»»åŠ¡å¯åŠ¨è¿è¡Œæ—¶é•¿å°±æ˜¯ 22 å°æ—¶å·¦å³ï¼Œç›¸å½“äºä»ä»»åŠ¡å¼€ç¬¬ä¸€æ¬¡å§‹å¯åŠ¨çš„æ—¶å€™æŒ‡å®šçš„æ—¶é—´ç‚¹å¼€å§‹æ¶ˆè´¹äº†ã€‚ æ—¢ç„¶ä¸»é“¾å’Œå¤‡é“¾ä»»åŠ¡ failover åçš„æ¶ˆè´¹ç­–ç•¥éƒ½ä¸ä¸€æ ·ï¼Œæ‰€ä»¥æˆ‘å½“æ—¶ç¬¬ä¸€ååº”è§‰å¾—æ˜¯ä¸æ˜¯å¤‡é“¾ä»»åŠ¡é•¿æœŸ Checkpoint å¤±è´¥ï¼Œç„¶å failover åä»æ—©æœŸå®Œæˆçš„ Checkpoint ä¸­ä¿å­˜çš„ offset å¼€å§‹æ¶ˆè´¹ï¼Œä»è€Œå¯¼è‡´çš„æ¶ˆè´¹ 22 å°æ—¶ä¹‹å‰çš„æ•°æ®ï¼Œä½†æ˜¯å’¨è¯¢äº†ä¸šåŠ¡æ–¹å‘ç°ä»»åŠ¡å…³é—­äº† Checkpointã€‚å¿ƒæƒ³é‚£åªæœ‰å¯èƒ½æ˜¯æ²¡æ‰“å¼€ Kafka çš„ auto.commit.offset æˆ–è€…æ‰“å¼€äº†ä½†æ˜¯è‡ªåŠ¨æäº¤ä¸€ç›´å¤±è´¥äº†ï¼Œæˆ‘å»çœ‹äº† Kafka topic groupid çš„ committed offset ç›‘æ§å‘ç°æ­£å¸¸ï¼Œä¸€ç›´æœ‰åœ¨æ­£å¸¸çš„æäº¤ offsetï¼Œæ‰€ä»¥ä¹Ÿå¦å®šäº†åˆšæ‰çš„çŒœæƒ³ã€‚å¦å¤–å°±æ˜¯è§‰å¾—ä¸¤ä¸ªä»»åŠ¡çš„æ¶ˆè´¹ç­–ç•¥è¿™ä¹ˆå¤§ï¼Œæ˜¯ä¸æ˜¯ä»£ç ä¸ä¸€è‡´æˆ–è€…é…ç½®ä¸ä¸€è‡´å¯¼è‡´çš„ï¼Œå› ä¸ºä¸€å¼€å§‹é—®äº†ä¸šåŠ¡æ–¹ä»£ç æ˜¯å¦ä¸€è‡´ï¼Œå›å¤æ˜¯ä¸€è‡´çš„ï¼Œè¿™é‡Œæˆ‘ä¹Ÿè¢«å‘äº†ä¸€ä¸‹ï¼Œåé¢åœ¨å¹³å°å‘ç°ä¸¤ä¸ªä»»åŠ¡çš„ä»£ç  Git commitId éƒ½ä¸ä¸€æ ·ï¼Œé‚£ä¹Ÿå°±æ˜¯æ„å‘³ç€ä»£ç ä¸ä¸€è‡´ã€‚ æ¥ç€å°±å¼€å§‹ review ä¸šåŠ¡æ–¹çš„é¡¹ç›®ä»£ç ï¼Œå‘ç°å¤‡é“¾è·¯ä»»åŠ¡å…³é—­äº† Checkpointï¼Œè€Œä¸»é“¾ä»»åŠ¡æ˜¯å¼€å¯ Checkpoint çš„ï¼ŒåŒæ—¶ä»£ç æ¶ˆè´¹æ–¹å¼æ˜¯æŒ‡å®šäº† Offset å¼€å§‹æ¶ˆè´¹ï¼ˆæ ¹æ®æ—¶é—´é…ç½®æŸ¥è¯¢ topic çš„ offsetï¼Œç„¶åä»æŒ‡å®šçš„ offset å¼€å§‹æ¶ˆè´¹ï¼Œè¿™ç§æ¶ˆè´¹æ–¹å¼å…¶å®å’ŒæŒ‡å®š timestamp å¼€å§‹æ¶ˆè´¹æ˜¯ä¸€è‡´çš„ï¼‰ã€‚ ç„¶åæˆ‘å°±ç¿»äº†ä¸‹ KafkaSource Consumer æºç ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š Open æ–¹æ³•ä¸»è¦åšäº†çŠ¶æ€åˆå§‹åŒ–ç›¸å…³é€»è¾‘ï¼Œå¯ä»¥å‘ç°å¦‚æœå…³é—­äº† Checkpointï¼Œé‚£ä¹ˆè‚¯å®šä¸ä¼šæœ‰æ¢å¤çš„çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯èµ°åˆ°åé¢çš„é€»è¾‘ï¼ŒæŒ‰ç…§ç”¨æˆ·æŒ‡å®šçš„ offset å¼€å§‹æ¶ˆè´¹ã€‚åœ¨è¸¢å‡ºæ•…éšœæœºå™¨åï¼Œä¼šç”³è¯·æ–°çš„ TaskManager åšçŠ¶æ€åˆå§‹åŒ–å…¶å®å°±æ˜¯ä¼šèµ°åˆ°ä¸Šé¢çš„é€»è¾‘ï¼Œä¹Ÿå°±å¯¼è‡´ failover åæ¶ˆè´¹äº†å¾ˆæ—©ä¹‹å‰çš„æ•°æ®ã€‚æ’æŸ¥åˆ°è¿™ï¼Œå‡ ä¹æ ¹å› å·²ç»å‡ºæ¥äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯éªŒè¯è¿‡ç¨‹ã€‚ æ ¹å› éªŒè¯æµ‹è¯•ä»£ç ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940@Slf4jpublic class CheckpointTest &#123; public static void main(String[] args) throws Exception &#123; ParameterTool parameters = ParameterTool.fromArgs(args); final StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment(); env.getConfig().setGlobalJobParameters(parameters); env.setParallelism(parameters.getInt(\"envParallelism\", 1)); env.setRestartStrategy(RestartStrategies.fixedDelayRestart( 100, Time.of(10, TimeUnit.SECONDS) )); //æ‰‹åŠ¨å…³é—­ checkpoint env.getCheckpointConfig().disableCheckpointing(); FlinkKafkaConsumer&lt;String&gt; flinkKafkaConsumer = new FlinkKafkaConsumer&lt;&gt;(parameters.get(\"sourceTopic\", \"yarn_flink_log\"), new SimpleStringSchema(), buildKafkaProps(parameters)); if (parameters.get(\"timestamp\") != null) &#123; log.info(\"Start from timestamp \" + parameters.getLong(\"timestamp\")); // æ‰‹åŠ¨æŒ‡å®š timestamp å¼€å§‹æ¶ˆè´¹ï¼Œåº•å±‚ä¹Ÿæ˜¯ä¼šæ ¹æ® timestamp å»æ‰¾è¿™ä¸ª timestamp ä¸‹å¯¹åº”çš„ offset æ•°æ® flinkKafkaConsumer.setStartFromTimestamp(parameters.getLong(\"timestamp\")); &#125; env.addSource(flinkKafkaConsumer) .setParallelism(parameters.getInt(\"sourceParallelism\", 1)) .print(); env.execute(\"test checkpoint not enable\"); &#125; public static Properties buildKafkaProps(ParameterTool parameterTool) &#123; Properties props = parameterTool.getProperties(); props.put(\"bootstrap.servers\", parameterTool.get(\"sourceBootstrapServers\", \"localhost:9092\")); props.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, true); props.put(\"group.id\", parameterTool.get(\"sourceGroupId\", String.valueOf(UUID.randomUUID()))); props.put(\"flink.partition-discovery.interval-millis\", \"10000\"); props.put(\"auto.offset.reset\", parameterTool.get(\"sourceAutoOffsetReset\", \"latest\")); return props; &#125;&#125; å½“æ—¶æŒ‡å®šçš„ timestamp æ˜¯ 1666819431000 ï¼ˆå¯¹åº” 2022-10-27 05:23:51ï¼‰ï¼Œç„¶ååœ¨ 2022-10-28 15:31 æ—¶æ‰‹åŠ¨ Kill æ‰ä¸€ä¸ª TaskManager podï¼Œä»»åŠ¡å‘ç”Ÿ failoverï¼Œæ–°ç”³è¯·çš„ pod å¼€å§‹æ¶ˆè´¹ 1666819431000 ï¼ˆå¯¹åº” 2022-10-27 05:23:51ï¼‰æ—¶å€™çš„æ•°æ® æ–°ç”³è¯· TM å¯åŠ¨æ—¥å¿—ï¼š 1232022-10-28 15:31:05,254 INFO org.apache.flink.streaming.connectors.kafka.FlinkKafkaConsumerBase [] - Consumer subtask 0 will start reading the following 6 partitions from timestamp 1666819431000: [KafkaTopicPartition&#123;topic=&apos;yxxx_log&apos;, partition=34&#125;, KafkaTopicPartition&#123;topic=&apos;yxxx_log&apos;, partition=4&#125;, KafkaTopicPartition&#123;topic=&apos;yxxx_log&apos;, partition=54&#125;, KafkaTopicPartition&#123;topic=&apos;yxxx_log&apos;, partition=24&#125;, KafkaTopicPartition&#123;topic=&apos;yxxx_log&apos;, partition=44&#125;, KafkaTopicPartition&#123;topic=&apos;yxxx_log&apos;, partition=14&#125;]2022-10-28 15:31:05,267 INFO org.apache.flink.streaming.connectors.kafka.FlinkKafkaConsumerBase [] - Consumer subtask 0 creating fetcher with offsets &#123;KafkaTopicPartition&#123;topic=&apos;yxxx_log&apos;, partition=34&#125;=(782507410,-1), KafkaTopicPartition&#123;topic=&apos;yxxx_log&apos;, partition=4&#125;=(87934879,-1), KafkaTopicPartition&#123;topic=&apos;yxxx_log&apos;, partition=54&#125;=(1259521975,-1), KafkaTopicPartition&#123;topic=&apos;yxxx_log&apos;, partition=24&#125;=(4335766087,-1), KafkaTopicPartition&#123;topic=&apos;yxxx_log&apos;, partition=44&#125;=(4210596124,-1), KafkaTopicPartition&#123;topic=&apos;yxxx_log&apos;, partition=14&#125;=(350718902,-1)&#125;. å¯ä»¥ä»æ—¥å¿—å‘ç°æ˜¯ç»§ç»­ä» 1666819431000 å¼€å§‹ ç»“è®ºå…³é—­ Checkpoint + æŒ‡å®š timestamp æˆ–è€… Offset æ¶ˆè´¹ + æ•…éšœ failover æ—¶ä¼šå‡ºç°é‡å¤è¯»æ•°æ®é—®é¢˜ æ€è€ƒ1ã€æ ¸å¿ƒä»»åŠ¡ä¸€å®šè¦é…ç½®å¥½æ¶ˆè´¹å»¶è¿Ÿå‘Šè­¦ï¼ŒåŠæ—¶å‘ç°å’Œå®šä½é—®é¢˜èƒ½å‡å°‘æ•…éšœæŸå¤± 2ã€ä¸è¦è½»æ˜“æ¼æ‰æŸäº›æŒ‡æ ‡ï¼Œå¦åˆ™å¯èƒ½ä¼šå¿½ç•¥æ‰æ ¹å›  3ã€å…³é—­æ‰é›†ç¾¤é»˜è®¤å¼€å¯çš„é…ç½®éœ€è¦è°¨æ…ï¼Œå¤šå……åˆ†æµ‹è¯•","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"Flink Table Store â€”â€”ä»è®¡ç®—åˆ°å­˜å‚¨æå‡æµæ‰¹ç»Ÿä¸€ç«¯åˆ°ç«¯ç”¨æˆ·ä½“éªŒ","date":"2022-05-11T16:00:00.000Z","path":"2022/05/12/flink-table-store/","text":"è¯¥é¡¹ç›®ç”¨äºåœ¨ Flink ä¸­ä¸ºæµå¤„ç†å’Œæ‰¹å¤„ç†æ„å»ºåŠ¨æ€è¡¨ï¼Œæ”¯æŒè¶…å¤§æµé‡çš„æ•°æ®æå–å’ŒåŠæ—¶çš„æ•°æ®æŸ¥è¯¢ã€‚ æ³¨æ„ï¼šè¯¥é¡¹ç›®ä»å¤„äº beta çŠ¶æ€ï¼Œæ­£åœ¨å¿«é€Ÿå‘å±•ï¼Œä¸å»ºè®®ç›´æ¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨å®ƒã€‚ Flink Table Store ä»‹ç»åœ¨è¿‡å»çš„å‡ å¹´é‡Œï¼Œå¾—ç›Šäº Flink ç¤¾åŒºä¼—å¤šçš„è´¡çŒ®è€…å’Œç”¨æˆ·ï¼ŒApache Flink å·²ç»æˆä¸ºæœ€å¥½çš„åˆ†å¸ƒå¼è®¡ç®—å¼•æ“ä¹‹ä¸€ï¼Œå°¤å…¶æ˜¯åœ¨å¤§è§„æ¨¡æœ‰çŠ¶æ€æµå¤„ç†æ–¹é¢ã€‚ç„¶è€Œï¼Œå½“äººä»¬è¯•å›¾ä»ä»–ä»¬çš„æ•°æ®ä¸­å®æ—¶è·å–æ´å¯ŸåŠ›æ—¶ï¼Œä»ç„¶é¢ä¸´ç€ä¸€äº›æŒ‘æˆ˜ã€‚åœ¨è¿™äº›æŒ‘æˆ˜ä¸­ï¼Œä¸€ä¸ªçªå‡ºçš„é—®é¢˜æ˜¯ç¼ºä¹æ»¡è¶³æ‰€æœ‰è®¡ç®—æ¨¡å¼çš„å­˜å‚¨ã€‚ åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šéƒ¨ç½²ä¸€äº›å­˜å‚¨ç³»ç»Ÿæ¥ä¸ Flink ä¸€èµ·ç”¨äºä¸åŒç›®çš„æ˜¯å¾ˆå¸¸è§çš„ã€‚å…¸å‹çš„è®¾ç½®æ˜¯ç”¨äºæµå¤„ç†çš„æ¶ˆæ¯é˜Ÿåˆ—ã€ç”¨äºæ‰¹å¤„ç†å’Œå³å¸­æŸ¥è¯¢çš„å¯æŸ¥è¯¢æ–‡ä»¶ç³»ç»Ÿ/å¯¹è±¡å­˜å‚¨ï¼Œä»¥åŠç”¨äºæŸ¥æ‰¾çš„ K-V å­˜å‚¨ã€‚ç”±äºå…¶å¤æ‚æ€§å’Œå¼‚æ„æ€§ï¼Œè¿™ç§æ¶æ„åœ¨æ•°æ®è´¨é‡å’Œç³»ç»Ÿç»´æŠ¤æ–¹é¢æå‡ºäº†æŒ‘æˆ˜ã€‚è¿™æ­£åœ¨æˆä¸ºå½±å“ Apache Flink å¸¦æ¥çš„æµæ‰¹ç»Ÿä¸€ç«¯åˆ°ç«¯ç”¨æˆ·ä½“éªŒçš„ä¸€å¤§é—®é¢˜ã€‚ Flink Table Store çš„ç›®æ ‡å°±æ˜¯è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œè¿™æ˜¯è¯¥é¡¹ç›®çš„é‡è¦ä¸€æ­¥ã€‚å®ƒå°† Flink çš„èƒ½åŠ›ä»è®¡ç®—æ‰©å±•åˆ°å­˜å‚¨é¢†åŸŸã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºç”¨æˆ·æä¾›æ›´å¥½çš„ç«¯åˆ°ç«¯ä½“éªŒã€‚ Flink Table Store æ—¨åœ¨æä¾›ç»Ÿä¸€çš„å­˜å‚¨æŠ½è±¡ï¼Œè®©ç”¨æˆ·ä¸å¿…è‡ªå·±æ„å»ºæ··åˆå­˜å‚¨ã€‚å…·ä½“æ¥è¯´ï¼ŒFlink Table Store æä¾›ä»¥ä¸‹æ ¸å¿ƒèƒ½åŠ›ï¼š æ”¯æŒè¶…å¤§æ•°æ®é›†çš„å­˜å‚¨ï¼Œå¹¶å…è®¸ä»¥æ‰¹å¤„ç†å’Œæµæ–¹å¼è¯»å–å’Œå†™å…¥ æ”¯æŒæ¯«ç§’çº§åˆ«å»¶è¿Ÿçš„æµå¼æŸ¥è¯¢ æ”¯æŒç§’çº§åˆ«å»¶è¿Ÿçš„ Batch/OLAP æŸ¥è¯¢ é»˜è®¤æ”¯æŒæµè¯»å¢é‡å¿«ç…§ï¼Œæ‰€ä»¥ç”¨æˆ·ä¸éœ€è¦è‡ªå·±è§£å†³ç»„åˆä¸åŒå­˜å‚¨çš„é—®é¢˜ åœ¨è¿™ä¸ªç‰ˆæœ¬ä¸­ï¼Œæ¶æ„å¦‚ä¸Šå›¾æ‰€ç¤ºï¼š ç”¨æˆ·å¯ä»¥ä½¿ç”¨ Flink å°†æ•°æ®å†™å…¥åˆ° Table Store ä¸­ï¼Œæ—¢å¯ä»¥é€šè¿‡æµå¼å°†æ•°æ®åº“ä¸­æ•è·çš„å˜æ›´æ—¥å¿—å†™å…¥ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä»æ•°æ®ä»“åº“ç­‰å…¶ä»–å­˜å‚¨ä¸­æ‰¹é‡åŠ è½½æ•°æ®åå†å†™å…¥ ç”¨æˆ·å¯ä»¥ä½¿ç”¨ Flink ä»¥ä¸åŒçš„æ–¹å¼æŸ¥è¯¢ Table Storeï¼ŒåŒ…æ‹¬æµå¼æŸ¥è¯¢å’Œ Batch/OLAP æŸ¥è¯¢ã€‚ è¿˜å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–å¼•æ“ï¼ˆä¾‹å¦‚ Apache Hiveï¼‰ä» Table Store ä¸­æŸ¥è¯¢ åœ¨åº•å±‚ï¼ŒTable Store ä½¿ç”¨æ··åˆå­˜å‚¨æ¶æ„ï¼Œä½¿ç”¨ Lake Store å­˜å‚¨å†å²æ•°æ®ï¼Œä½¿ç”¨ Queue ç³»ç»Ÿï¼ˆç›®å‰æ”¯æŒ Apache Kafka é›†æˆï¼‰å­˜å‚¨å¢é‡æ•°æ®ã€‚ å®ƒä¸ºæ··åˆæµå¼è¯»å–æä¾›å¢é‡å¿«ç…§ Table Store çš„ Lake Store å°†æ•°æ®ä½œä¸ºåˆ—æ–‡ä»¶å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿ/å¯¹è±¡å­˜å‚¨ä¸Šï¼Œå¹¶ä½¿ç”¨ LSM ç»“æ„æ¥æ”¯æŒå¤§é‡çš„æ•°æ®æ›´æ–°å’Œé«˜æ€§èƒ½æŸ¥è¯¢ éå¸¸æ„Ÿè°¢ä»¥ä¸‹ç³»ç»Ÿçš„å¯å‘ï¼šApache Iceberg å’Œ RocksDBã€‚ åç»­è¿›å±•ç¤¾åŒºç›®å‰æ­£åœ¨åŠªåŠ›å¼ºåŒ–æ ¸å¿ƒé€»è¾‘ï¼Œç¨³å®šå­˜å‚¨æ ¼å¼ç­‰ï¼Œä»¥ä½¿ Flink Table Store å¯ä»¥æŠ•å…¥ç”Ÿäº§ã€‚ åœ¨å³å°†å‘å¸ƒçš„ 0.2.0 ç‰ˆæœ¬ä¸­ï¼Œå¯ä»¥æœŸå¾…ï¼ˆè‡³å°‘ï¼‰ä»¥ä¸‹åŠŸèƒ½ï¼š ç”Ÿæ€ï¼šæ”¯æŒ Apache Hive Engine çš„ Flink Table Store Reader æ ¸å¿ƒï¼šæ”¯æŒè‡ªé€‚åº” Bucket æ•°é‡ æ ¸å¿ƒï¼šæ”¯æŒä»… append çš„æ•°æ®ï¼ŒTable Store ä¸ä»…ä»…å±€é™äºæ›´æ–°åœºæ™¯ æ ¸å¿ƒï¼šå®Œå–„çš„ schema å˜åŒ– æ”¹è¿›åŸºäºé¢„è§ˆç‰ˆå¾—åˆ°çš„åé¦ˆ ä»ä¸­æœŸæ¥çœ‹ï¼Œä½ è¿˜å¯ä»¥æœŸå¾…ï¼š ç”Ÿæ€ç³»ç»Ÿï¼šæ”¯æŒ Trinoã€PrestoDB å’Œ Apache Spark çš„ Flink Table Store Reader Flink Table Store Service ä¼šåŠ é€Ÿæ›´æ–°ï¼Œæå‡æŸ¥è¯¢æ€§èƒ½ å°é²œå¯ä»¥é€šè¿‡ https://nightlies.apache.org/flink/flink-table-store-docs-release-0.1/docs/try-table-store/quick-start/ æ¥å°è¯•ä¸€ä¸‹ã€‚ ä¸‹è½½é“¾æ¥ï¼šhttps://flink.apache.org/downloads.html ç¿»è¯‘åŸæ–‡é“¾æ¥ï¼šhttps://flink.apache.org/news/2022/05/11/release-table-store-0.1.0.html åŸæ–‡ä½œè€…ï¼šæåŠ²æ¾ &amp; ç§¦æ±Ÿæ°","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"Flink Iceberg Source å¹¶è¡Œåº¦æ¨æ–­æºç è§£æ","date":"2022-05-01T16:00:00.000Z","path":"2022/05/02/flink-iceberg-source-parallelism/","text":"æ‰¹è¯» IcebergIceberg æä¾›äº†ä¸¤ä¸ªé…ç½®ï¼š 123456789101112public static final ConfigOption&lt;Boolean&gt; TABLE_EXEC_ICEBERG_INFER_SOURCE_PARALLELISM = ConfigOptions.key(\"table.exec.iceberg.infer-source-parallelism\") .booleanType() .defaultValue(true) .withDescription(\"If is false, parallelism of source are set by config.\\n\" + \"If is true, source parallelism is inferred according to splits number.\\n\");public static final ConfigOption&lt;Integer&gt; TABLE_EXEC_ICEBERG_INFER_SOURCE_PARALLELISM_MAX = ConfigOptions.key(\"table.exec.iceberg.infer-source-parallelism.max\") .intType() .defaultValue(100) .withDescription(\"Sets max infer parallelism for source operator.\"); table.exec.iceberg.infer-source-parallelismï¼šé»˜è®¤æ˜¯ trueï¼Œæ„å‘³ç€ source çš„å¹¶è¡Œåº¦æ˜¯æ ¹æ®æ¨æ–­æ¥é…ç½®çš„ï¼Œå¦‚æœé…ç½®çš„ false çš„è¯ï¼Œé‚£ä¹ˆå¹¶è¡Œåº¦çš„é…ç½®æ˜¯ä»¥é…ç½®çš„ä¸ºå‡†ã€‚ table.exec.iceberg.infer-source-parallelism.maxï¼š é»˜è®¤æ˜¯ 100ï¼Œsource ç®—å­çš„æœ€å¤§å¹¶è¡Œåº¦ã€‚ è¿™ä¸¤ä¸ªå‚æ•°åªåœ¨ FileSource çš„ inferParallelism æ–¹æ³•ä¸­è°ƒç”¨ï¼š 1234567891011121314151617181920212223242526272829303132int inferParallelism(FlinkInputFormat format, ScanContext context) &#123; // è¯»å– table.exec.resource.default-parallelism é…ç½®ï¼Œé»˜è®¤å€¼ä¸º -1 int parallelism = readableConfig.get(ExecutionConfigOptions.TABLE_EXEC_RESOURCE_DEFAULT_PARALLELISM); // è¯»å– table.exec.iceberg.infer-source-parallelism é…ç½®ï¼Œé»˜è®¤æ˜¯ true if (readableConfig.get(FlinkConfigOptions.TABLE_EXEC_ICEBERG_INFER_SOURCE_PARALLELISM)) &#123; // è¯»å– table.exec.iceberg.infer-source-parallelism.max é…ç½®ï¼Œé»˜è®¤æ˜¯ 100 int maxInferParallelism = readableConfig.get(FlinkConfigOptions .TABLE_EXEC_ICEBERG_INFER_SOURCE_PARALLELISM_MAX); Preconditions.checkState( maxInferParallelism &gt;= 1, FlinkConfigOptions.TABLE_EXEC_ICEBERG_INFER_SOURCE_PARALLELISM_MAX.key() + \" cannot be less than 1\"); //è·å–è¡¨çš„ splitNum int splitNum; try &#123; FlinkInputSplit[] splits = format.createInputSplits(0); splitNum = splits.length; &#125; catch (IOException e) &#123; throw new UncheckedIOException(\"Failed to create iceberg input splits for table: \" + table, e); &#125; parallelism = Math.min(splitNum, maxInferParallelism); &#125; if (context.limit() &gt; 0) &#123; int limit = context.limit() &gt;= Integer.MAX_VALUE ? Integer.MAX_VALUE : (int) context.limit(); parallelism = Math.min(parallelism, limit); &#125; // parallelism must be positive. parallelism = Math.max(1, parallelism); return parallelism;&#125; åœ¨ä¸‹é¢ä»£ç è·å–åˆ°è¡¨çš„ splitNum 1234567891011121314151617181920212223242526272829303132333435363738394041FlinkInputSplit[] splits = format.createInputSplits(0);splitNum = splits.length; public FlinkInputSplit[] createInputSplits(int minNumSplits) throws IOException &#123; // Called in Job manager, so it is OK to load table from catalog. // åŠ è½½ catalog tableLoader.open(); final ExecutorService workerPool = ThreadPools.newWorkerPool(\"iceberg-plan-worker-pool\", context.planParallelism()); try (TableLoader loader = tableLoader) &#123; // åŠ è½½è¡¨ Table table = loader.loadTable(); // è°ƒç”¨ return FlinkSplitPlanner.planInputSplits(table, context, workerPool); &#125; finally &#123; workerPool.shutdown(); &#125; &#125; static FlinkInputSplit[] planInputSplits(Table table, ScanContext context, ExecutorService workerPool) &#123; // ä¸»è¦é€šè¿‡ planTasks æ–¹æ³• try (CloseableIterable&lt;CombinedScanTask&gt; tasksIterable = planTasks(table, context, workerPool)) &#123; List&lt;CombinedScanTask&gt; tasks = Lists.newArrayList(tasksIterable); FlinkInputSplit[] splits = new FlinkInputSplit[tasks.size()]; boolean exposeLocality = context.exposeLocality(); Tasks.range(tasks.size()) .stopOnFailure() .executeWith(exposeLocality ? workerPool : null) .run(index -&gt; &#123; CombinedScanTask task = tasks.get(index); String[] hostnames = null; if (exposeLocality) &#123; hostnames = Util.blockLocations(table.io(), task); &#125; splits[index] = new FlinkInputSplit(index, task, hostnames); &#125;); return splits; &#125; catch (IOException e) &#123; throw new UncheckedIOException(\"Failed to process tasks iterable\", e); &#125; &#125; planTasks æ–¹æ³•ä¸­ä¸»è¦é  scan.planTasks()ï¼Œä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354public CloseableIterable&lt;CombinedScanTask&gt; planTasks() &#123; CloseableIterable&lt;FileScanTask&gt; fileScanTasks = planFiles(); CloseableIterable&lt;FileScanTask&gt; splitFiles = TableScanUtil.splitFiles(fileScanTasks, targetSplitSize()); return TableScanUtil.planTasks(splitFiles, targetSplitSize(), splitLookback(), splitOpenFileCost());&#125; // è·å–æ–‡ä»¶æƒ…å†µ public CloseableIterable&lt;FileScanTask&gt; planFiles() &#123; Snapshot snapshot = snapshot(); if (snapshot != null) &#123; LOG.info(\"Scanning table &#123;&#125; snapshot &#123;&#125; created at &#123;&#125; with filter &#123;&#125;\", table, snapshot.snapshotId(), DateTimeUtil.formatTimestampMillis(snapshot.timestampMillis()), context.rowFilter()); Listeners.notifyAll( new ScanEvent(table.name(), snapshot.snapshotId(), context.rowFilter(), schema())); return planFiles(ops, snapshot, context.rowFilter(), context.ignoreResiduals(), context.caseSensitive(), context.returnColumnStats()); &#125; else &#123; LOG.info(\"Scanning empty table &#123;&#125;\", table); return CloseableIterable.empty(); &#125; &#125; // split public static CloseableIterable&lt;FileScanTask&gt; splitFiles(CloseableIterable&lt;FileScanTask&gt; tasks, long splitSize) &#123; Preconditions.checkArgument(splitSize &gt; 0, \"Invalid split size (negative or 0): %s\", splitSize); Iterable&lt;FileScanTask&gt; splitTasks = FluentIterable .from(tasks) .transformAndConcat(input -&gt; input.split(splitSize)); // Capture manifests which can be closed after scan planning return CloseableIterable.combine(splitTasks, tasks); &#125; public static CloseableIterable&lt;CombinedScanTask&gt; planTasks(CloseableIterable&lt;FileScanTask&gt; splitFiles, long splitSize, int lookback, long openFileCost) &#123; Preconditions.checkArgument(splitSize &gt; 0, \"Invalid split size (negative or 0): %s\", splitSize); Preconditions.checkArgument(lookback &gt; 0, \"Invalid split planning lookback (negative or 0): %s\", lookback); Preconditions.checkArgument(openFileCost &gt;= 0, \"Invalid file open cost (negative): %s\", openFileCost); // Check the size of delete file as well to avoid unbalanced bin-packing Function&lt;FileScanTask, Long&gt; weightFunc = file -&gt; Math.max( file.length() + file.deletes().stream().mapToLong(ContentFile::fileSizeInBytes).sum(), (1 + file.deletes().size()) * openFileCost); return CloseableIterable.transform( CloseableIterable.combine( new BinPacking.PackingIterable&lt;&gt;(splitFiles, splitSize, lookback, weightFunc, true), splitFiles), BaseCombinedScanTask::new); &#125; æ¨æ–­åˆ°è¡¨æ–‡ä»¶ split çš„æ•°é‡åï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æ˜¯å†³å®šå¹¶è¡Œåº¦å¤§å°çš„æ—¶å€™äº†ï¼š 1parallelism = Math.min(splitNum, maxInferParallelism); å–é…ç½®çš„æœ€å¤§å¹¶è¡Œåº¦å’Œ split æ•°é‡çš„æœ€å°å€¼ï¼Œegï¼šè®¾ç½®çš„ source æœ€å¤§å¹¶è¡Œåº¦ä¸º 50ï¼Œä½†æ˜¯æ ¹æ®è¡¨æ–‡ä»¶åˆ’åˆ†å‡ºæ¥çš„ split æ•°é‡ä¸º 40ï¼Œé‚£ä¹ˆ source çš„å¹¶è¡Œåº¦ä¸º 40ã€‚ å¦‚æœæ²¡æœ‰é…ç½® table.exec.iceberg.infer-source-parallelism ä¸º true çš„è¯ï¼Œé‚£ä¹ˆå°±ä»¥ table.exec.resource.default-parallelism çš„å¹¶è¡Œåº¦ä¸ºå‡†ï¼ˆé»˜è®¤å€¼æ˜¯ -1ï¼‰ã€‚ ç»§ç»­åˆ†ææ¥ä¸‹æ¥çš„ä»£ç ï¼š 1234if (context.limit() &gt; 0) &#123; int limit = context.limit() &gt;= Integer.MAX_VALUE ? Integer.MAX_VALUE : (int) context.limit(); parallelism = Math.min(parallelism, limit);&#125; limit åƒæ˜¯ SQL æŸ¥è¯¢è¯­å¥é‡Œé¢çš„ limit çš„å€¼ï¼Œå¦‚æœé…ç½®äº† limitï¼Œé‚£ä¹ˆä¹Ÿä¼šå‚ä¸å¹¶è¡Œåº¦é…ç½®çš„è®¡ç®—çš„ï¼Œegï¼šå¦‚æœ limti ä¸º 1ï¼Œé‚£ä¹ˆ parallelism å–å‰é¢ parallelism çš„å€¼ä¸ 1 ä¸¤è€…çš„æœ€å°å€¼ã€‚ 123// parallelism must be positive.parallelism = Math.max(1, parallelism);return parallelism; æœ€åä»£ç ä¿è¯å¹¶è¡Œåº¦çš„æœ€å°å€¼ä¸º 1ã€‚ æ¥çœ‹ä¸‹ inferParallelism æ–¹æ³•çš„è°ƒç”¨æƒ…å†µï¼Œåªåœ¨ FileSource ç±»çš„ build() æ–¹æ³•è°ƒç”¨ï¼š 123456789101112131415161718192021public DataStream&lt;RowData&gt; build() &#123; Preconditions.checkNotNull(env, \"StreamExecutionEnvironment should not be null\"); FlinkInputFormat format = buildFormat(); ScanContext context = contextBuilder.build(); TypeInformation&lt;RowData&gt; typeInfo = FlinkCompatibilityUtil.toTypeInfo(FlinkSchemaUtil.convert(context.project())); if (!context.isStreaming()) &#123; // åªåœ¨ æ‰¹ æ¨¡å¼ä¸‹ç”Ÿæ•ˆ int parallelism = inferParallelism(format, context); return env.createInput(format, typeInfo).setParallelism(parallelism); &#125; else &#123; StreamingMonitorFunction function = new StreamingMonitorFunction(tableLoader, context); String monitorFunctionName = String.format(\"Iceberg table (%s) monitor\", table); String readerOperatorName = String.format(\"Iceberg table (%s) reader\", table); return env.addSource(function, monitorFunctionName) .transform(readerOperatorName, typeInfo, StreamingReaderOperator.factory(format)); &#125;&#125; å¯ä»¥çœ‹ TestFlinkScanSql æµ‹è¯•ç±»çš„ testInferedParallelism æ–¹æ³•è¿›è¡Œæµ‹è¯•ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253@Testpublic void testInferedParallelism() throws IOException &#123; Table table = catalog.createTable(TableIdentifier.of(\"default\", \"t\"), TestFixtures.SCHEMA, TestFixtures.SPEC); TableLoader tableLoader = TableLoader.fromHadoopTable(table.location()); FlinkInputFormat flinkInputFormat = FlinkSource.forRowData().tableLoader(tableLoader).table(table).buildFormat(); ScanContext scanContext = ScanContext.builder().build(); // Empty table, infer parallelism should be at least 1 int parallelism = FlinkSource.forRowData().inferParallelism(flinkInputFormat, scanContext); Assert.assertEquals(\"Should produce the expected parallelism.\", 1, parallelism); GenericAppenderHelper helper = new GenericAppenderHelper(table, fileFormat, TEMPORARY_FOLDER); DataFile dataFile1 = helper.writeFile(TestHelpers.Row.of(\"2020-03-20\", 0), RandomGenericData.generate(TestFixtures.SCHEMA, 2, 0L)); DataFile dataFile2 = helper.writeFile(TestHelpers.Row.of(\"2020-03-21\", 0), RandomGenericData.generate(TestFixtures.SCHEMA, 2, 0L)); helper.appendToTable(dataFile1, dataFile2); // Make sure to generate 2 CombinedScanTasks long maxFileLen = Math.max(dataFile1.fileSizeInBytes(), dataFile2.fileSizeInBytes()); sql(\"ALTER TABLE t SET ('read.split.open-file-cost'='1', 'read.split.target-size'='%s')\", maxFileLen); // 2 splits (max infer is the default value 100 , max &gt; splits num), the parallelism is splits num : 2 parallelism = FlinkSource.forRowData().inferParallelism(flinkInputFormat, scanContext); Assert.assertEquals(\"Should produce the expected parallelism.\", 2, parallelism); // 2 splits and limit is 1 , max infer parallelism is default 100ï¼Œ // which is greater than splits num and limit, the parallelism is the limit value : 1 parallelism = FlinkSource.forRowData().inferParallelism(flinkInputFormat, ScanContext.builder().limit(1).build()); Assert.assertEquals(\"Should produce the expected parallelism.\", 1, parallelism); // 2 splits and max infer parallelism is 1 (max &lt; splits num), the parallelism is 1 Configuration configuration = new Configuration(); configuration.setInteger(FlinkConfigOptions.TABLE_EXEC_ICEBERG_INFER_SOURCE_PARALLELISM_MAX, 1); parallelism = FlinkSource.forRowData() .flinkConf(configuration) .inferParallelism(flinkInputFormat, ScanContext.builder().build()); Assert.assertEquals(\"Should produce the expected parallelism.\", 1, parallelism); // 2 splits, max infer parallelism is 1, limit is 3, the parallelism is max infer parallelism : 1 parallelism = FlinkSource.forRowData() .flinkConf(configuration) .inferParallelism(flinkInputFormat, ScanContext.builder().limit(3).build()); Assert.assertEquals(\"Should produce the expected parallelism.\", 1, parallelism); // 2 splits, infer parallelism is disabled, the parallelism is flink default parallelism 1 configuration.setBoolean(FlinkConfigOptions.TABLE_EXEC_ICEBERG_INFER_SOURCE_PARALLELISM, false); parallelism = FlinkSource.forRowData() .flinkConf(configuration) .inferParallelism(flinkInputFormat, ScanContext.builder().limit(3).build()); Assert.assertEquals(\"Should produce the expected parallelism.\", 1, parallelism);&#125; æ³¨æ„âš ï¸ï¼šè¯¥ä»£ç æ¨¡å—æ˜¯åœ¨ Iceberg é¡¹ç›®çš„ flink module ä¸‹ æµè¯» Icebergå¹¶æ²¡æœ‰é’ˆå¯¹æµè¯»é…ç½® Source å¹¶è¡Œåº¦ åŠ å…¥çŸ¥è¯†æ˜Ÿçƒå¯ä»¥çœ‹åˆ°ä¸Šé¢æ–‡ç« ï¼šhttps://t.zsxq.com/6YjyJYR","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"Flink Hive Source å¹¶è¡Œåº¦æ¨æ–­æºç è§£æ","date":"2022-04-30T16:00:00.000Z","path":"2022/05/01/flink-hive-source-parallelism/","text":"æ‰¹è¯» HiveHiveOptions ä¸­æœ‰ä¸¤ä¸ªé…ç½® 1234567891011public static final ConfigOption&lt;Boolean&gt; TABLE_EXEC_HIVE_INFER_SOURCE_PARALLELISM = key(\"table.exec.hive.infer-source-parallelism\") .defaultValue(true) .withDescription( \"If is false, parallelism of source are set by config.\\n\" + \"If is true, source parallelism is inferred according to splits number.\\n\");public static final ConfigOption&lt;Integer&gt; TABLE_EXEC_HIVE_INFER_SOURCE_PARALLELISM_MAX = key(\"table.exec.hive.infer-source-parallelism.max\") .defaultValue(1000) .withDescription(\"Sets max infer parallelism for source operator.\"); table.exec.hive.infer-source-parallelismï¼šé»˜è®¤å€¼æ˜¯ trueï¼Œè¡¨ç¤º source çš„å¹¶è¡Œåº¦æ˜¯æ ¹æ®æ•°æ®åˆ†åŒºæ•°å’Œæ–‡ä»¶æ•°æ¨æ–­çš„ï¼Œå¦‚æœè®¾ç½®ä¸º false çš„è¯è¡¨ç¤ºå¹¶è¡Œåº¦æ˜¯ä»¥é…ç½®çš„ä¸ºå‡† table.exec.hive.infer-source-parallelism.maxï¼šé»˜è®¤å€¼æ˜¯ 1000ï¼Œè¡¨ç¤ºè¯»å– Hive æ•°æ®çš„ source æœ€å¤§å¹¶è¡Œåº¦ è¿™ä¸¤ä¸ªå‚æ•°åªåœ¨ HiveParallelismInference ç±»ä¸­ä½¿ç”¨ï¼Œè§‚å¯Ÿåˆ° HiveParallelismInference ç±»æ˜¯ä¸“é—¨é’ˆå¯¹ Hive å¹¶è¡Œåº¦é…ç½®çš„å·¥å…·ç±»ï¼Œä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283/** * A utility class to calculate parallelism for Hive connector considering various factors. */class HiveParallelismInference &#123; private static final Logger LOG = LoggerFactory.getLogger(HiveParallelismInference.class); private final ObjectPath tablePath; private final boolean infer; private final int inferMaxParallelism; private int parallelism; HiveParallelismInference(ObjectPath tablePath, ReadableConfig flinkConf) &#123; this.tablePath = tablePath; // è·å– table.exec.hive.infer-source-parallelism é…ç½®å¹¶èµ‹å€¼ï¼Œ this.infer = flinkConf.get(HiveOptions.TABLE_EXEC_HIVE_INFER_SOURCE_PARALLELISM); // è·å– table.exec.hive.infer-source-parallelism.max é…ç½®å¹¶èµ‹å€¼ this.inferMaxParallelism = flinkConf.get(HiveOptions.TABLE_EXEC_HIVE_INFER_SOURCE_PARALLELISM_MAX); Preconditions.checkArgument( inferMaxParallelism &gt;= 1, HiveOptions.TABLE_EXEC_HIVE_INFER_SOURCE_PARALLELISM_MAX.key() + \" cannot be less than 1\"); // è·å– table.exec.resource.default-parallelism é…ç½® this.parallelism = flinkConf.get(ExecutionConfigOptions.TABLE_EXEC_RESOURCE_DEFAULT_PARALLELISM); &#125; /** * Apply limit to calculate the parallelism. * Here limit is the limit in query &lt;code&gt;SELECT * FROM xxx LIMIT [limit]&lt;/code&gt;. */ int limit(Long limit) &#123; if (limit != null) &#123; parallelism = Math.min(parallelism, (int) (limit / 1000)); &#125; // make sure that parallelism is at least 1 return Math.max(1, parallelism); &#125; //æ ¹æ® /** * Infer parallelism by number of files and number of splits. * If &#123;@link HiveOptions#TABLE_EXEC_HIVE_INFER_SOURCE_PARALLELISM&#125; is not set this method does nothing. */ HiveParallelismInference infer( SupplierWithException&lt;Integer, IOException&gt; numFiles, SupplierWithException&lt;Integer, IOException&gt; numSplits) &#123; //å¦‚æœè®¾ç½® table.exec.hive.infer-source-parallelism ä¸º falseï¼Œåˆ™ç›´æ¥è·³è¿‡äº† if (!infer) &#123; return this; &#125; try &#123; // `createInputSplits` is costly, // so we try to avoid calling it by first checking the number of files // which is the lower bound of the number of splits int lowerBound = logRunningTime(\"getNumFiles\", numFiles); if (lowerBound &gt;= inferMaxParallelism) &#123; parallelism = inferMaxParallelism; return this; &#125; int splitNum = logRunningTime(\"createInputSplits\", numSplits); parallelism = Math.min(splitNum, inferMaxParallelism); &#125; catch (IOException e) &#123; throw new FlinkHiveException(e); &#125; return this; &#125; private int logRunningTime( String operationName, SupplierWithException&lt;Integer, IOException&gt; supplier) throws IOException &#123; long startTimeMillis = System.currentTimeMillis(); int result = supplier.get(); LOG.info( \"Hive source(&#123;&#125;&#125;) &#123;&#125; use time: &#123;&#125; ms, result: &#123;&#125;\", tablePath, operationName, System.currentTimeMillis() - startTimeMillis, result); return result; &#125;&#125; å¯ä»¥çœ‹åˆ°æ³¨é‡Šä¸»è¦æ˜¯ infer æ–¹æ³•å»åšçš„çš„å¹¶è¡Œåº¦æ¨æ–­ï¼Œè¯¥æ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•° numFiles å’Œ numSplitsï¼Œè¯¥æ–¹æ³•åªåœ¨HiveTableSource ç±»ä¸­çš„ getDataStream æ–¹æ³•ä¸­è°ƒç”¨ï¼Œå¯ä»¥æŸ¥çœ‹ä¸‹å›¾ï¼š é‚£å°±æ¥çœ‹çœ‹è¿™ä¸¤ä¸ªæ–¹æ³•çš„å®ç°ï¼š getNumFiles æ–¹æ³•æ˜¯ç”¨æ¥è·å– Hive è¡¨åˆ†åŒºä¸‹é¢çš„æ–‡ä»¶æ•°é‡çš„: 1234567891011121314151617public static int getNumFiles(List&lt;HiveTablePartition&gt; partitions, JobConf jobConf) throws IOException &#123; int numFiles = 0; FileSystem fs = null; for (HiveTablePartition partition : partitions) &#123; StorageDescriptor sd = partition.getStorageDescriptor(); org.apache.hadoop.fs.Path inputPath = new org.apache.hadoop.fs.Path(sd.getLocation()); if (fs == null) &#123; fs = inputPath.getFileSystem(jobConf); &#125; // it's possible a partition exists in metastore but the data has been removed if (!fs.exists(inputPath)) &#123; continue; &#125; numFiles += fs.listStatus(inputPath).length; &#125; return numFiles;&#125; createInputSplits æ–¹æ³•æ˜¯ç”¨æ¥å°† Hive è¡¨åˆ†åŒºä¸‹çš„æ–‡ä»¶åˆ†å‰²æˆé€»è¾‘ä¸Šçš„ InputSplitï¼Œè¿™é‡Œæ˜¯åœ¨ Flink Hive Connector é‡Œé¢å®šä¹‰äº†ä¸€ä¸ª HiveSourceSplit ç±»æ¥åŒ…è£… InputSplitï¼ŒåŒ…å«äº† Hive è¡¨åˆ†åŒºçš„ä¿¡æ¯ã€‚ 123456789101112131415161718192021222324252627282930313233343536public static List&lt;HiveSourceSplit&gt; createInputSplits( int minNumSplits, List&lt;HiveTablePartition&gt; partitions, JobConf jobConf) throws IOException &#123; List&lt;HiveSourceSplit&gt; hiveSplits = new ArrayList&lt;&gt;(); FileSystem fs = null; for (HiveTablePartition partition : partitions) &#123; StorageDescriptor sd = partition.getStorageDescriptor(); org.apache.hadoop.fs.Path inputPath = new org.apache.hadoop.fs.Path(sd.getLocation()); if (fs == null) &#123; fs = inputPath.getFileSystem(jobConf); &#125; // it's possible a partition exists in metastore but the data has been removed if (!fs.exists(inputPath)) &#123; continue; &#125; InputFormat format; try &#123; format = (InputFormat) Class.forName(sd.getInputFormat(), true, Thread.currentThread().getContextClassLoader()).newInstance(); &#125; catch (Exception e) &#123; throw new FlinkHiveException(\"Unable to instantiate the hadoop input format\", e); &#125; ReflectionUtils.setConf(format, jobConf); jobConf.set(INPUT_DIR, sd.getLocation()); //TODO: we should consider how to calculate the splits according to minNumSplits in the future. org.apache.hadoop.mapred.InputSplit[] splitArray = format.getSplits(jobConf, minNumSplits); for (org.apache.hadoop.mapred.InputSplit inputSplit : splitArray) &#123; Preconditions.checkState(inputSplit instanceof FileSplit, \"Unsupported InputSplit type: \" + inputSplit.getClass().getName()); hiveSplits.add(new HiveSourceSplit((FileSplit) inputSplit, partition, null)); &#125; &#125; return hiveSplits;&#125; å› ä¸ºä¸Šé¢ä¸¤ä¸ªæ–¹æ³•çš„æ‰§è¡Œå¯èƒ½éœ€è¦ä¸€ç‚¹æ—¶é—´ï¼Œæ‰€ä»¥ä¸“é—¨è¿˜å†™äº†ä¸€ä¸ª logRunningTime è®°å½•å…¶æ‰§è¡Œçš„æ—¶é—´ã€‚ å¦‚æœæ–‡ä»¶æ•°å¤§äºé…ç½®çš„æœ€å¤§å¹¶è¡Œåº¦ï¼Œé‚£ä¹ˆä½œä¸šçš„å¹¶è¡Œåº¦ç›´æ¥ä»¥é…ç½®çš„æœ€å¤§å¹¶è¡Œåº¦ä¸ºå‡†ï¼›å¦åˆ™å– InputSplit ä¸ªæ•°ä¸é…ç½®çš„æœ€å¤§å¹¶è¡Œåº¦ä¸¤è€…æœ€å°å€¼ã€‚ 12345678int lowerBound = logRunningTime(\"getNumFiles\", numFiles);if (lowerBound &gt;= inferMaxParallelism) &#123; parallelism = inferMaxParallelism; return this;&#125;int splitNum = logRunningTime(\"createInputSplits\", numSplits);parallelism = Math.min(splitNum, inferMaxParallelism); ç„¶åå°±æ˜¯ limit æ–¹æ³•çš„é™åˆ¶å¹¶è¡Œåº¦äº†ï¼š 123456789101112/** * Apply limit to calculate the parallelism. * Here limit is the limit in query &lt;code&gt;SELECT * FROM xxx LIMIT [limit]&lt;/code&gt;. */int limit(Long limit) &#123; if (limit != null) &#123; parallelism = Math.min(parallelism, (int) (limit / 1000)); &#125; // make sure that parallelism is at least 1 return Math.max(1, parallelism);&#125; è¿™ä¸ªæ–¹æ³•çš„æ³¨é‡Šçš„æ„æ€æ˜¯æ ¹æ®æŸ¥è¯¢è¯­å¥çš„ limit æ¥é…ç½®å¹¶è¡Œåº¦ï¼Œåˆ¤æ–­å‰é¢å¾—åˆ°çš„å¹¶è¡Œåº¦ä¸ limit/1000 çš„å¤§å°ï¼Œå–ä¸¤è€…æœ€å°å€¼ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå‰é¢åˆ¤æ–­è¿™ä¸ª Hive è¡¨åˆ†åŒºæœ‰éå¸¸å¤šçš„æ–‡ä»¶ï¼Œæ¯”å¦‚ 10001 ä¸ªï¼Œé‚£å¤§äºé»˜è®¤çš„æœ€å¤§å€¼ 1000ï¼Œé‚£ä¹ˆè¿”å›çš„å¹¶è¡Œåº¦æ˜¯ 1000ï¼Œä½†æ˜¯å› ä¸ºæŸ¥è¯¢ Hive çš„ SQL åªæ˜¯ 100 æ¡ï¼Œé‚£ä¹ˆè¿™é‡Œå–å€¼å¾—åˆ°çš„æœ€å°å€¼æ˜¯ 0ï¼Œæœ€åé€šè¿‡ Math.max(1, parallelism) è¿”å›çš„ source å¹¶è¡Œåº¦æ˜¯ 1ã€‚ æ³¨æ„âš ï¸ï¼šä¸Šé¢çš„å¹¶è¡Œåº¦é…ç½®ä»…ä»…é’ˆå¯¹äºæ‰¹ä½œä¸šæŸ¥ Hive æ•°æ®ï¼Œä¸é’ˆå¯¹æµè¯» Hive æ•°æ®ã€‚ æµè¯» Hiveåœ¨ HiveTableSource ç±»ä¸­çš„ getDataStream æ–¹æ³•ä¸­å¹¶æ²¡æœ‰é’ˆå¯¹æµè¯»é…ç½® Source å¹¶è¡Œåº¦ã€‚ åŠ å…¥çŸ¥è¯†æ˜Ÿçƒå¯ä»¥çœ‹åˆ°ä¸Šé¢æ–‡ç« ï¼šhttps://t.zsxq.com/E6Mj6uv","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"å¦‚ä½•æé«˜ Flink K8s é›†ç¾¤èµ„æºä½¿ç”¨ç‡ï¼Ÿ","date":"2022-03-25T16:00:00.000Z","path":"2022/03/26/flink-k8s-pod-add-request-and-limit/","text":"é—®é¢˜åœ¨ flink on k8s é»˜è®¤æäº¤ä½œä¸šçš„å‘½ä»¤ä¸‹ï¼Œæˆ‘ä»¬ä¼šæŒ‡å®šä½œä¸šçš„ JM/TM çš„ CPU å’Œ Memoryï¼Œæœ€åä½œä¸šç”Ÿæˆçš„ pod å®ƒçš„ CPU/Memory çš„ request/limit éƒ½æ˜¯ä¸€æ ·çš„èµ„æºï¼Œä½†æ˜¯ä½œä¸šçœŸå®è¿è¡Œæ—¶ä½¿ç”¨çš„èµ„æºè¿œè¾¾ä¸åˆ° limit çš„å€¼ï¼Œè¿™æ ·å°±ä¼šé€ æˆæœºå™¨èµ„æºæµªè´¹ï¼ˆæ°´ä½ä¸é«˜ï¼Œä½†æ˜¯æœºå™¨åˆä¸èƒ½å†ç”³è¯· podï¼‰ã€‚ æ¯”å¦‚ä¸‹é¢å‘½ä»¤ï¼šï¼ˆæŒ‡å®šäº† TM çš„èµ„æºï¼ŒæœªæŒ‡å®š JM èµ„æºï¼‰ 12345678./bin/flink run-application -p 1 -t kubernetes-application -c com.zhisheng.Test \\ -Dkubernetes.cluster-id=flink-log-alert-test1 \\ -Dtaskmanager.memory.process.size=6g \\ -Djobmanager.memory.process.size=2g \\ -Dkubernetes.jobmanager.cpu=0.5 \\ -Dkubernetes.taskmanager.cpu=1 \\ -Dtaskmanager.numberOfTaskSlots=1 \\ .... JM: TM: è§£å†³æ–¹æ¡ˆ1ã€åˆ†åˆ«ä¸º JM/TM çš„ å†…å­˜å’Œ CPU æ·»åŠ å‚æ•°è®¾ç½® request å’Œ limitï¼Œå¦‚æœè¡Œå¾—é€šçš„è¯ï¼Œè¿™ç§æ–¹å¼è¦å¢åŠ  8 ä¸ªå‚æ•°æ‰èƒ½æ»¡è¶³éœ€æ±‚ï¼Œä½†å›  Flink å†…å­˜æ¨¡å‹ä½¿å¾—å•ç‹¬è®¾ç½®å†…å­˜çš„ request/limit å˜å¾—éå¸¸å¤æ‚ï¼Œåªèƒ½è®¾ç½® CPU å‚æ•°ï¼Œè€Œä¸”ä¹‹å‰çš„å‚æ•°ä¹Ÿå°†å˜å¾—ä¸å¯ä»¥ä½¿ç”¨ã€‚ 2ã€åˆ†åˆ«ä¸º JM/TM çš„ å†…å­˜å’Œ CPU æ·»åŠ å‚æ•° limit å› å­ï¼Œç”¨æˆ·é…ç½®çš„å†…å­˜æˆ–è€… CPU çš„å€¼é»˜è®¤ä¸º request çš„å€¼ï¼Œlimit å› å­å¿…é¡» &gt;= 1ï¼Œè¿™ç§æ–¹å¼éœ€è¦å¢åŠ å››ä¸ªå‚æ•°ï¼Œç›¸æ¯”ç¬¬ä¸€ç§æ–¹æ³•è¿™ç§æ–¹æ³•è¾ƒä¸ºç®€å•ï¼Œä½†æ˜¯ç›®å‰ YARN é›†ç¾¤ç”¨æˆ·çš„èµ„æºé…ç½®ï¼Œå¤§å¤šæ•°ä½œä¸šå·²ç»æ˜¯æœ‰ä¸€å®šçš„èµ„æºæµªè´¹ï¼ˆç”³è¯·çš„èµ„æºè¿œå¤§äºå®é™…ä½¿ç”¨çš„èµ„æºï¼‰ï¼Œå¦‚æœä½¿ç”¨è¯¥æ–¹å¼ï¼Œç”¨æˆ·ä½œä¸šæ— æ„Ÿè¿ç§»åˆ° K8s é›†ç¾¤åï¼Œå…¶å®èµ„æºæµªè´¹é—®é¢˜å¹¶æ²¡æœ‰è§£å†³ã€‚ 3ã€åˆ†åˆ«ä¸º JM/TM çš„ å†…å­˜å’Œ CPU æ·»åŠ å‚æ•° request å› å­ï¼Œç”¨æˆ·é…ç½®çš„å†…å­˜æˆ–è€… CPU çš„å€¼é»˜è®¤ä¸º limit çš„å€¼ï¼Œrequest å› å­å¿…é¡» &lt;= 1ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®ç”Ÿäº§çš„æ•°æ®é…ç½®ä¸€ä¸ªåˆç†çš„å€¼ï¼Œæ¯”å¦‚ä¸º 0.5ã€‚è¿™ç§æ–¹å¼åŒæ ·éœ€è¦å¢åŠ å››ä¸ªå‚æ•°ï¼Œä½†æ˜¯è¿™ç§æ–¹æ³•å¯¹æ¯”ç¬¬äºŒç§å¸¦æ¥çš„å¥½å¤„æ˜¯ï¼Œå¤§å¤šæ•°ç”¨æˆ·ä½œä¸šçš„èµ„æºé…ç½®å°†ä¼šæ›´åˆç†ï¼Œæœºå™¨åŒç­‰èµ„æºèƒ½è¿è¡Œæ›´å¤šçš„ podï¼Œä»è€Œå¯ä»¥æé«˜æœºå™¨çš„èµ„æºæ°´ä½ã€‚ ä»£ç å¼€å‘ 1ã€åœ¨ KubernetesConfigOptions å¢åŠ é…ç½® KubernetesConfigOptions.java 12345678910111213141516171819202122232425262728293031323334// jobmanagerpublic static final ConfigOption&lt;Double&gt; JOB_MANAGER_CPU_REQUEST_FACTOR = key(\"kubernetes.jobmanager.cpu.request-factor\") .doubleType() .defaultValue(1.0) .withDescription( \"The request factor of cpu used by job manager. \" + \"The resources request cpu will be set to cpu * request-factor.\");public static final ConfigOption&lt;Double&gt; JOB_MANAGER_MEMORY_REQUEST_FACTOR = key(\"kubernetes.jobmanager.memory.request-factor\") .doubleType() .defaultValue(1.0) .withDescription( \"The request factor of memory used by job manager. \" + \"The resources request memory will be set to memory * request-factor.\");// taskmanagerpublic static final ConfigOption&lt;Double&gt; TASK_MANAGER_CPU_REQUEST_FACTOR = key(\"kubernetes.taskmanager.cpu.request-factor\") .doubleType() .defaultValue(1.0) .withDescription( \"The request factor of cpu used by task manager. \" + \"The resources request cpu will be set to cpu * request-factor.\");public static final ConfigOption&lt;Double&gt; TASK_MANAGER_MEMORY_REQUEST_FACTOR = key(\"kubernetes.taskmanager.memory.request-factor\") .doubleType() .defaultValue(1.0) .withDescription( \"The request factor of memory used by task manager. \" + \"The resources request memory will be set to memory * request-factor.\"); 2ã€åœ¨ KubernetesJobManagerParameters å’Œ KubernetesTaskManagerParameters ä¸­åˆ†åˆ«æä¾›è·å–å‚æ•°çš„æ–¹æ³• KubernetesJobManagerParameters.java 12345678910111213141516171819public double getJobManagerCPURequestFactor() &#123; final double requestFactor = flinkConfig.getDouble(KubernetesConfigOptions.JOB_MANAGER_CPU_REQUEST_FACTOR); checkArgument( requestFactor &lt;= 1, \"%s should be less than or equal to 1.\", KubernetesConfigOptions.JOB_MANAGER_CPU_REQUEST_FACTOR.key()); return requestFactor;&#125;public double getJobManagerMemoryRequestFactor() &#123; final double requestFactor = flinkConfig.getDouble(KubernetesConfigOptions.JOB_MANAGER_MEMORY_REQUEST_FACTOR); checkArgument( requestFactor &lt;= 1, \"%s should be less than or equal to 1.\", KubernetesConfigOptions.JOB_MANAGER_MEMORY_REQUEST_FACTOR.key()); return requestFactor;&#125; KubernetesTaskManagerParameters.java 12345678910111213141516171819public double getTaskManagerCPURequestFactor() &#123; final double requestFactor = flinkConfig.getDouble(KubernetesConfigOptions.TASK_MANAGER_CPU_REQUEST_FACTOR); checkArgument( requestFactor &lt;= 1, \"%s should be less than or equal to 1.\", KubernetesConfigOptions.TASK_MANAGER_CPU_REQUEST_FACTOR.key()); return requestFactor;&#125;public double getTaskManagerMemoryRequestFactor() &#123; final double requestFactor = flinkConfig.getDouble(KubernetesConfigOptions.TASK_MANAGER_MEMORY_REQUEST_FACTOR); checkArgument( requestFactor &lt;= 1, \"%s should be less than or equal to 1.\", KubernetesConfigOptions.TASK_MANAGER_MEMORY_REQUEST_FACTOR.key()); return requestFactor;&#125; 3ã€KubernetesUtils.getResourceRequirements() æ–¹æ³•åšå¦‚ä¸‹æ”¹å˜ï¼Œå¢åŠ  request å› å­å‚æ•° KubernetesUtils.java 12345678910111213141516171819202122232425262728293031323334353637383940/** * Get resource requirements from memory and cpu. * * @param mem Memory in mb. * @param memoryRequestFactor Memory request factor. * @param cpu cpu. * @param cpuRequestFactor cpu request factor. * @param externalResources external resources * @return KubernetesResource requirements. */public static ResourceRequirements getResourceRequirements( int mem, double memoryRequestFactor, double cpu, double cpuRequestFactor, Map&lt;String, Long&gt; externalResources) &#123; //todoï¼šcpu å’Œ å†…å­˜åˆ†åˆ«è®¾ç½®ä¸€ä¸ªå› å­ï¼Œé»˜è®¤æ˜¯ 0.5ï¼Œç”¨æˆ·è®¾ç½®çš„èµ„æºé…ç½®ä¸º limitï¼›request = limit * å› å­ final Quantity cpuQuantity = new Quantity(String.valueOf(cpu)); final Quantity cpuRequestQuantity = new Quantity(String.valueOf(cpu * cpuRequestFactor)); final Quantity memQuantity = new Quantity(mem + Constants.RESOURCE_UNIT_MB); final Quantity memRequestQuantity = new Quantity(((int) (mem * memoryRequestFactor)) + Constants.RESOURCE_UNIT_MB); ResourceRequirementsBuilder resourceRequirementsBuilder = new ResourceRequirementsBuilder() .addToRequests(Constants.RESOURCE_NAME_MEMORY, memRequestQuantity) .addToRequests(Constants.RESOURCE_NAME_CPU, cpuRequestQuantity) .addToLimits(Constants.RESOURCE_NAME_MEMORY, memQuantity) .addToLimits(Constants.RESOURCE_NAME_CPU, cpuQuantity); // Add the external resources to resource requirement. for (Map.Entry&lt;String, Long&gt; externalResource: externalResources.entrySet()) &#123; final Quantity resourceQuantity = new Quantity(String.valueOf(externalResource.getValue())); resourceRequirementsBuilder .addToRequests(externalResource.getKey(), resourceQuantity) .addToLimits(externalResource.getKey(), resourceQuantity); LOG.info(\"Request external resource &#123;&#125; with config key &#123;&#125;.\", resourceQuantity.getAmount(), externalResource.getKey()); &#125; return resourceRequirementsBuilder.build();&#125; 4ã€åœ¨ InitJobManagerDecorator å’Œ InitTaskManagerDecorator è°ƒç”¨ä¸Šé¢æ–¹æ³•çš„åœ°æ–¹åšç›¸åº”çš„ä¿®æ”¹ æœ€ç»ˆæ•ˆæœå¯ä»¥åœ¨ flink-conf.yaml ä¸­å®šä¹‰é…ç½®å¦‚ä¸‹ï¼š 1234kubernetes.jobmanager.cpu.request-factor: 0.5kubernetes.jobmanager.memory.request-factor: 0.8kubernetes.taskmanager.cpu.request-factor: 0.5kubernetes.taskmanager.memory.request-factor: 0.8 å½“ç„¶ï¼Œç”¨æˆ·çš„ä½œä¸šæäº¤å‚æ•°ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸Šé¢çš„å‚æ•°è¿›è¡Œè¦†ç›–ï¼Œæœ€ç»ˆæ•ˆæœå¦‚ä¸‹ï¼š å…³æ³¨æˆ‘å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ Github ä»£ç ä»“åº“https://github.com/zhisheng17/flink-learning/ ä»¥åè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç éƒ½å°†æ”¾åœ¨è¿™ä¸ªä»“åº“é‡Œï¼ŒåŒ…å«äº†è‡ªå·±å­¦ä¹  flink çš„ä¸€äº› demo å’Œåšå®¢","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"å®•æœºä¸€å°æœºå™¨ï¼Œç»“æœä¸€ç™¾å¤šä¸ª Flink ä½œä¸šæŒ‚äº†","date":"2021-11-10T16:00:00.000Z","path":"2021/11/11/flink-akka-framesize/","text":"èƒŒæ™¯å› å®•æœºäº†ä¸€å°ç‰©ç†æœºå™¨ï¼Œå®æ—¶é›†ç¾¤ä¸å°‘ä½œä¸šå‘ç”Ÿ failoverï¼Œå…¶ä¸­å¤§éƒ¨åˆ†ä½œä¸šéƒ½èƒ½ failover æˆåŠŸï¼ŒæŸä¸ªéƒ¨é—¨çš„éƒ¨åˆ†ä½œä¸šä¸€ç›´åœ¨ failoverï¼Œå§‹ç»ˆæœªæˆåŠŸï¼Œåˆ° WebUI æŸ¥çœ‹ä½œä¸šå¼‚å¸¸æ—¥å¿—å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232021-11-09 16:01:11java.util.concurrent.CompletionException: java.lang.reflect.UndeclaredThrowableException at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:273) at java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:280) at java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1592) at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) at java.util.concurrent.FutureTask.run(FutureTask.java:266) at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180) at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) at java.lang.Thread.run(Thread.java:748)Caused by: java.lang.reflect.UndeclaredThrowableException at com.sun.proxy.$Proxy54.submitTask(Unknown Source) at org.apache.flink.runtime.jobmaster.RpcTaskManagerGateway.submitTask(RpcTaskManagerGateway.java:72) at org.apache.flink.runtime.executiongraph.Execution.lambda$deploy$10(Execution.java:756) at java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1590) ... 7 moreCaused by: java.io.IOException: The rpc invocation size 56424326 exceeds the maximum akka framesize. at org.apache.flink.runtime.rpc.akka.AkkaInvocationHandler.createRpcInvocationMessage(AkkaInvocationHandler.java:276) at org.apache.flink.runtime.rpc.akka.AkkaInvocationHandler.invokeRpc(AkkaInvocationHandler.java:205) at org.apache.flink.runtime.rpc.akka.AkkaInvocationHandler.invoke(AkkaInvocationHandler.java:134) ... 11 more è§£å†³å¼‚å¸¸è¿‡ç¨‹ä»ä¸Šé¢çš„å¼‚å¸¸æ—¥å¿—ä¸­æˆ‘ä»¬æå–åˆ°å…³é”®ä¿¡æ¯ï¼š 1Caused by: java.io.IOException: The rpc invocation size 56424326 exceeds the maximum akka framesize. çœ‹èµ·æ¥æ˜¯ RPC çš„æ¶ˆæ¯å¤§å°è¶…è¿‡äº†é»˜è®¤çš„ akka framesize çš„æœ€å¤§å€¼äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹è¿™ä¸ªå€¼çš„é»˜è®¤å€¼ï¼Œä» å®˜ç½‘ æˆ‘ä»¬å¯ä»¥çœ‹çš„åˆ°è¯¥å€¼çš„é»˜è®¤å¤§å°ä¸º â€œ10485760bâ€ï¼Œå¹¶ä¸”è¯¥å‚æ•°çš„æè¿°ä¸ºï¼š 1Maximum size of messages which are sent between the JobManager and the TaskManagers. If Flink fails because messages exceed this limit, then you should increase it. The message size requires a size-unit specifier. ç¿»è¯‘è¿‡æ¥çš„æ„æ€å°±æ˜¯ï¼šè¿™ä¸ªå‚æ•°æ˜¯ JobManager å’Œ TaskManagers ä¹‹é—´é€šä¿¡å…è®¸çš„æœ€å¤§æ¶ˆæ¯å¤§å°ï¼Œå¦‚æœ Flink ä½œä¸šå› ä¸ºé€šä¿¡æ¶ˆæ¯å¤§å°è¶…è¿‡äº†è¯¥å€¼ï¼Œä½ å¯ä»¥é€šè¿‡å¢åŠ è¯¥å€¼çš„å¤§å°æ¥è§£å†³ï¼Œè¯¥å‚æ•°éœ€è¦æŒ‡å®šä¸€ä¸ªå•ä½ã€‚ åˆ†æåŸå› Flink ä½¿ç”¨ Akka ä½œä¸ºç»„ä»¶ï¼ˆJobManager/TaskManager/ResourceManagerï¼‰ä¹‹é—´çš„ RPC æ¡†æ¶ï¼Œåœ¨ JobManager å’Œ TaskManagers ä¹‹é—´å‘é€çš„æ¶ˆæ¯çš„æœ€å¤§å¤§å°é»˜è®¤ä¸º 10485760bï¼Œå¦‚æœæ¶ˆæ¯è¶…è¿‡è¿™ä¸ªé™åˆ¶å°±ä¼šå¤±è´¥ï¼ŒæŠ¥é”™ã€‚è¿™ä¸ªå¯ä»¥çœ‹ä¸‹æŠ›å‡ºå¼‚å¸¸å¤„çš„æºç ï¼š 123456789101112131415161718192021protected RpcInvocation createRpcInvocationMessage(String methodName, Class&lt;?&gt;[] parameterTypes, Object[] args) throws IOException &#123; Object rpcInvocation; if (this.isLocal) &#123; rpcInvocation = new LocalRpcInvocation(methodName, parameterTypes, args); &#125; else &#123; try &#123; RemoteRpcInvocation remoteRpcInvocation = new RemoteRpcInvocation(methodName, parameterTypes, args); if (remoteRpcInvocation.getSize() &gt; this.maximumFramesize) &#123; // å¼‚å¸¸æ‰€åœ¨ä½ç½® throw new IOException(&quot;The rpc invocation size exceeds the maximum akka framesize.&quot;); &#125; rpcInvocation = remoteRpcInvocation; &#125; catch (IOException var6) &#123; LOG.warn(&quot;Could not create remote rpc invocation message. Failing rpc invocation because...&quot;, var6); throw var6; &#125; &#125; return (RpcInvocation)rpcInvocation;&#125; è‡³äºä¸ºä»€ä¹ˆ JobManager å’Œ TaskManager ä¹‹é—´çš„ RPC æ¶ˆæ¯å¤§å°ä¼šå¦‚æ­¤ä¹‹å¤§ï¼Œåˆæ­¥çš„è§£é‡Šæ˜¯åœ¨ task å‡ºç°å¼‚å¸¸ä¹‹åï¼Œå®ƒéœ€è¦è°ƒç”¨ updateTaskExecutionState(TaskExecutionStateï¼ŒtaskExecutionState) è¿™ä¸ª RPC æ¥å£å»é€šçŸ¥ Flink Jobmanager å»æ”¹å˜å¯¹åº” task çš„çŠ¶æ€å¹¶ä¸”é‡å¯ taskã€‚ä½†æ˜¯å‘¢ï¼ŒtaskExecutionState è¿™ä¸ªå‚æ•°é‡Œé¢æœ‰ä¸ª error å±æ€§ï¼Œå½“æˆ‘çš„ task æ‰“å‡ºæ¥çš„é”™è¯¯æ ˆå¤ªå¤šçš„æ—¶å€™ï¼Œåœ¨åºåˆ—åŒ–çš„ä¹‹åè¶…è¿‡äº† rpc æ¥å£è¦æ±‚çš„æœ€å¤§æ•°æ®å¤§å°ï¼ˆä¹Ÿå°±æ˜¯ maximum akka framesizeï¼‰ï¼Œå¯¼è‡´è°ƒç”¨ updateTaskExecutionState è¿™ä¸ª rpc æ¥å£å¤±è´¥ï¼ŒJobmanager æ— æ³•è·çŸ¥è¿™ä¸ª task å·²ç»å¤„äº fail çš„çŠ¶æ€ï¼Œä¹Ÿæ— æ³•é‡å¯ï¼Œç„¶åå°±å¯¼è‡´äº†ä¸€ç³»åˆ—è¿é”ååº”ã€‚ è§£å†³åŠæ³•ä»»åŠ¡åœæ­¢ï¼Œåœ¨ flink-conf.yaml ä¸­åŠ å…¥ akka.framesize å‚æ•°ï¼Œè°ƒå¤§è¯¥å€¼ã€‚ 1akka.framesize: &quot;62914560b&quot; ç„¶åå°†ä»»åŠ¡é‡å¯ï¼Œå¯ä»¥è§‚å¯Ÿ Jobmanager Configration çœ‹çœ‹å‚æ•°æ˜¯å¦ç”Ÿæ•ˆã€‚","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"å®æ—¶å¹³å°å¦‚ä½•ç®¡ç†å¤šä¸ª Flink ç‰ˆæœ¬ï¼Ÿâ€”â€” ä¸ºå•¥ä¼šå‡ºç°å¤šä¸ªç‰ˆæœ¬ï¼Ÿ","date":"2021-09-25T16:00:00.000Z","path":"2021/09/26/realtime-platform-flink-version/","text":"ä¸ºå•¥ä¼šå‡ºç°å¤šä¸ªç‰ˆæœ¬ï¼Ÿ Flink ç¤¾åŒºæœ¬èº«è¿­ä»£é€Ÿåº¦éå¸¸å¿«ï¼Œç›®å‰é˜¿é‡Œäº‘æœ‰ä¸€å¤§æ³¢çš„äººä¸“èŒåš Flink å¼€æºï¼Œå¦å¤–è¿˜æ‹¥æœ‰æ´»è·ƒçš„ç¤¾åŒºè´¡çŒ®è€…ï¼Œæ‰€ä»¥åŠŸèƒ½å¼€å‘è¾ƒå¿«ï¼Œbug ä¿®å¤é€Ÿåº¦è¾ƒå¿«ï¼Œå‡ ä¹æ¯ 4 ä¸ªæœˆä¸€ä¸ªå¤§ç‰ˆæœ¬ï¼Œæ¯ä¸ªå¤§ç‰ˆæœ¬ä¹‹é—´è¿­ä»£çš„åŠŸèƒ½éå¸¸å¤šï¼Œä»£ç å˜åŠ¨éå¸¸å¤§ï¼ŒAPI æ¥å£å˜åŠ¨ä¹Ÿå¤§ï¼ŒåŠ¨ä¸åŠ¨å°±å¹²ç¿»è‡ªå·±äº†ã€‚ ç¤¾åŒºè¿­ä»£å¿«å°±å¿«å‘—ï¼Œä¸ºä»€ä¹ˆå…¬å¸ä¹Ÿè¦è¦ä¸æ–­è·Ÿç€ç¤¾åŒºé¼»å­èµ°ï¼Ÿç¤¾åŒºè¿­ä»£å¿«æ„å‘³ç€åŠŸèƒ½å¤šï¼Œä¿®å¤çš„ bug å¤šï¼Œç›¸å¯¹äºæ—©æœŸç‰ˆæœ¬æ„å‘³ç€ç¨³å®šæ€§ä¹Ÿé«˜äº›ã€‚é™¤äº†å›½å†…ä¸€äºŒçº¿å…¬å¸æœ‰ç‰¹åˆ«å¤šçš„ä¸“èŒäººå»è´Ÿè´£è¿™å—ï¼Œå¤§å¤šæ•°ä¸­å°å…¬å¸æœ€ç®€å•æœ€å¿«æ·ä½“éªŒåˆ°ç¨³å®šæ€§æœ€é«˜ã€åŠŸèƒ½æ€§æœ€å¤šã€æ€§èƒ½æœ€å¥½çš„ Flink ç‰ˆæœ¬æ— éæ˜¯ç›´æ¥ä½¿ç”¨æœ€æ–°çš„ Flink ç‰ˆæœ¬ã€‚ä¸¾ä¸ªä¾‹å­ï¼šFlink SQL ä»æœ€æ—©æœŸï¼ˆ1.9ï¼‰çš„åŠŸèƒ½ã€æ€§èƒ½åˆ°ç›®å‰ 1.14ï¼Œå·®åˆ«çœŸçš„å¤§å¾ˆå¤šï¼Œä¼˜åŒ–äº†ç‰¹åˆ«å¤šçš„åœ°æ–¹ï¼Œå¢å¼ºäº†å¾ˆå¤šåŠŸèƒ½ã€‚åŸå…ˆä½¿ç”¨ Flink SQL å®Œæˆä¸€ä¸ªæµå¤„ç†ä»»åŠ¡éå¸¸éº»çƒ¦ï¼Œè¿˜ä¸å¦‚ç›´æ¥å†™å‡ åè¡Œä»£ç æ¥çš„å¿«ï¼Œç›®å‰æˆ‘æƒ…æ„¿å†™ SQL å»å¤„ç†ä¸€ä¸ªæµä»»åŠ¡ã€‚é‚£ä¹ˆè‡ªç„¶ä¼šè·Ÿç€å‡çº§åˆ°æ–°ç‰ˆæœ¬ã€‚ ç”¨æˆ· A é—® Flink SQL æ”¯æŒå•ç‹¬è®¾ç½®å¹¶è¡Œåº¦å—ï¼Ÿç”¨æˆ· B é—®å®æ—¶å¹³å°ç°åœ¨æ”¯æŒ Flink 1.13 ç‰ˆæœ¬çš„ Window TVFï¼Ÿè¿™ä¸ªè¦ Flink xxx ç‰ˆæœ¬æ‰èƒ½æ”¯æŒï¼Œè¦ä¸ä½ å‡çº§ä¸€ä¸‹ Flink ç‰ˆæœ¬åˆ° xxxï¼Ÿè¿™æ ·å°±èƒ½æ”¯æŒäº†ï¼Œç±»ä¼¼çš„åœºæ™¯è¿˜æœ‰å¾ˆå¤šï¼Œå¯¹äºä¸­å°å…¬å¸çš„å®æ—¶å¹³å°è´Ÿè´£äººæ¥è¯´ï¼Œè¿™æ— éæœ€çœäº‹ï¼›å¯¹äºå¤§å…¬å¸çš„è´Ÿè´£å®æ—¶å¼€å‘çš„äººæ¥è¯´ï¼Œè¿™æ— ç–‘æ˜¯ä¸€ä¸ªå™©æ¢¦ï¼Œæ¯æ¬¡å‡çº§æ–°ç‰ˆæœ¬éƒ½è¦å°†åœ¨è€ç‰ˆæœ¬å¼€å‘çš„å„ç§åŠŸèƒ½éƒ½æƒ³å°½åŠæ³•ç§»æ¤åˆ°æ–°ç‰ˆæœ¬ä¸Šæ¥ï¼Œç¢°åˆ° API æ¥å£å˜åŠ¨å¤§çš„æ— éç›¸å½“äºé‡å†™äº†ï¼Œæˆ–è€…å°†æ–°ç‰ˆæœ¬çš„æŸäº›ç‰¹åˆ«éœ€è¦çš„åŠŸèƒ½é€šè¿‡æ‰“ patch çš„æ–¹å¼æ‰“åˆ°è€ç‰ˆæœ¬é‡Œé¢å»ã€‚ æ–°ç‰ˆæœ¬é¦™æ˜¯çœŸçš„é¦™ï¼Œå¯æ˜¯ä¸ºå•¥æœ‰çš„äººä¸ç”¨å‘¢ï¼Ÿé—®é¢˜å°±æ˜¯ï¼Œå®æ—¶ä½œä¸šå¤§å¤šæ•°æ˜¯é•¿æœŸè¿è¡Œçš„ï¼Œå¦‚æœä¸€ä¸ªä½œä¸šæ²¡å•¥é”™è¯¯ï¼Œåœ¨ç”Ÿäº§è¿è¡Œçš„å¥½å¥½çš„ï¼Œä¹Ÿä¸å‡ºå•¥æ•…éšœï¼Œç¨³å®šæ€§å’Œæ€§èƒ½ä¹Ÿéƒ½èƒ½æ¥å—ï¼ˆå¹¶ä¸æ˜¯æ‰€æœ‰ä½œä¸šæ•°æ®é‡éƒ½å¾ˆå¤§ï¼Œä¼šé‡åˆ°æ€§èƒ½é—®é¢˜ï¼‰ï¼Œé‚£ä¹ˆç”¨æˆ·ä¸ºå•¥è¦ä½¿ç”¨æ–°ç‰ˆæœ¬ï¼Ÿç”¨æˆ·æ‰ä¸ç®¡ä½ æ–°ç‰ˆæœ¬åŠŸèƒ½å¤šç‰›é€¼ï¼Œæ€§èƒ½å¤šå±Œå‘¢ï¼Œè€å­å‡çº§è¿˜è¦æ”¹ä¾èµ–ç‰ˆæœ¬ã€æ”¹æ¥å£ä»£ç ã€æµ‹è¯•è”è°ƒã€æ€§èƒ½æµ‹è¯•ï¼ˆè°çŸ¥é“ä½ è¯´çš„æ€§èƒ½æå‡æ˜¯ä¸æ˜¯å¹ç‰›é€¼çš„ï¼‰ã€ç¨³å®šæ€§æµ‹è¯•ï¼ˆå¯èƒ½ä¸Šçº¿åŒè·‘ä¸€æ®µæ—¶é—´éªŒè¯ï¼‰ï¼Œè¿™äº›ä¸éœ€è¦æ—¶é—´å‘€ï¼Œä½ å«æˆ‘å‡çº§å°±å‡çº§ï¼Œæ»šçŠŠå­å§ï¼Œä½ çŸ¥é“æˆ‘è¿˜æœ‰å¤šå°‘ä¸šåŠ¡éœ€æ±‚è¦åšå—ï¼Ÿ é‚£ä¹ˆå°±è½ä¸‹è¿™ä¸ªåœºåœ°äº†ï¼Œåˆè¦ä½¿ç”¨æ–°ç‰ˆæœ¬çš„åŠŸèƒ½å»è§£å†³é—®é¢˜ï¼Œè€ä½œä¸šçš„ç”¨æˆ·è·Ÿä»–å„ç§æ‰¯çš®ä¹Ÿæ‰“åŠ¨ä¸äº†ä»–å‡çº§ä½œä¸šçš„ç‰ˆæœ¬ï¼Œé‚£ä¹ˆè‡ªç„¶å°±ä¸æ–­çš„å‡ºç°äº†å¤šä¸ªç‰ˆæœ¬äº†ã€‚ è¿™æ ·ï¼Œå¦‚æœä¸å¯¹ç‰ˆæœ¬åšå¥½è§„åˆ’ï¼Œé‚£ä¹ˆæ‘Šå­å°±é€æ¸è¶Šæ¥è¶Šå¤§ï¼Œè¶Šæ¥è¶Šéš¾æ”¶æ‹¾äº†ï¼Ÿ é‚£ä¹ˆè¯¥å¦‚ä½•ç®¡ç†å…¬å¸çš„ Flink ç‰ˆæœ¬ï¼Ÿå¦‚æœç®¡ç†å’Œå…¼å®¹å¤šä¸ª Flink ç‰ˆæœ¬çš„ä½œä¸šæäº¤ï¼Ÿå¦‚ä½•å…¼å®¹ Jar åŒ…å’Œ SQL ä½œä¸šçš„æäº¤ æ€ä¹ˆç®¡ç†å¤šä¸ª Flink ç‰ˆæœ¬çš„ä½œä¸šæäº¤ï¼Ÿå°½è¯·æœŸå¾…ä¸‹ç¯‡æ–‡ç« ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹â€”â€” åŸºäº Flink çš„å®æ—¶ç›‘æ§å‘Šè­¦ç³»ç»Ÿ","date":"2021-08-20T16:00:00.000Z","path":"2021/08/21/flink-in-action-12.3/","text":"12.3 åŸºäº Flink çš„å®æ—¶ç›‘æ§å‘Šè­¦ç³»ç»Ÿåœ¨å¦‚ä»Šå¾®æœåŠ¡ã€äº‘åŸç”Ÿç­‰æŠ€æœ¯ç››è¡Œçš„æ—¶ä»£ï¼Œå½“è°ˆåˆ°è¯´è¦ä» 0 å¼€å§‹æ„å»ºä¸€ä¸ªç›‘æ§ç³»ç»Ÿï¼Œå¤§å®¶æ— éå°±é¦–å…ˆæƒ³åˆ°ä¸‰ä¸ªè¯ï¼šMetricsã€Tracingã€Loggingã€‚ 12.3.1 ç›‘æ§ç³»ç»Ÿçš„è¯‰æ±‚å›½å¤–ä¸€ç¯‡æ¯”è¾ƒç«çš„æ–‡ç«  Metrics, Tracing, and Logging å†…æœ‰ä¸ªå›¾å¾ˆå¥½çš„æ€»ç»“äº†ä¸€ä¸ªç›‘æ§ç³»ç»Ÿçš„è¯‰æ±‚ï¼Œåˆ†åˆ«æ˜¯ Metricsã€Loggingã€Tracingï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ Metrics çš„ç‰¹ç‚¹ï¼šå®ƒè‡ªå·±æä¾›äº†äº”ç§åŸºæœ¬çš„åº¦é‡ç±»å‹ Gaugeã€Counterã€Histogramã€Timerã€Meterã€‚ Tracing çš„ç‰¹ç‚¹ï¼šæä¾›äº†ä¸€ä¸ªè¯·æ±‚ä»æ¥æ”¶åˆ°å¤„ç†å®Œæ¯•æ•´ä¸ªç”Ÿå‘½å‘¨æœŸçš„è·Ÿè¸ªè·¯å¾„ï¼Œé€šå¸¸è¯·æ±‚éƒ½æ˜¯åœ¨åˆ†å¸ƒå¼çš„ç³»ç»Ÿä¸­å¤„ç†ï¼Œæ‰€ä»¥ä¹Ÿå«åšåˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªã€‚ Logging çš„ç‰¹ç‚¹ï¼šæä¾›é¡¹ç›®åº”ç”¨è¿è¡Œçš„è¯¦ç»†ä¿¡æ¯ï¼Œä¾‹å¦‚æ–¹æ³•çš„å…¥å‚ã€è¿è¡Œçš„å¼‚å¸¸è®°å½•ç­‰ã€‚ è¿™ä¸‰è€…åœ¨ç›‘æ§ç³»ç»Ÿä¸­ç¼ºä¸€ä¸å¯ï¼Œå®ƒä»¬ä¹‹é—´çš„å…³ç³»æ˜¯ï¼šåŸºäº Metrics çš„å¼‚å¸¸å‘Šè­¦äº‹ä»¶ï¼Œç„¶åé€šè¿‡ Tracing å®šä½é—®é¢˜å¯ç–‘æ¨¡å—ï¼Œæ ¹æ®æ¨¡å—è¯¦ç»†çš„æ—¥å¿—å®šä½åˆ°é”™è¯¯æ ¹æºï¼Œæœ€åå†è¿”å›æ¥è°ƒæ•´ Metrics çš„å‘Šè­¦è§„åˆ™ï¼Œä»¥ä¾¿ä¸‹æ¬¡æ›´æ—©çš„é¢„è­¦ï¼Œæå‰é¢„é˜²å‡ºç°æ­¤ç±»é—®é¢˜ã€‚ 12.3.2 ç›‘æ§ç³»ç»ŸåŒ…å«çš„å†…å®¹é’ˆå¯¹æåˆ°çš„ä¸‰ä¸ªç‚¹ï¼Œç¬”è€…æ‰¾åˆ°å›½å†…å¤–çš„å¼€æºç›‘æ§ç³»ç»Ÿåšäº†å¯¹æ¯”ï¼Œå‘ç°çœŸæ­£æ‹¥æœ‰å…¨éƒ¨åŠŸèƒ½çš„æ¯”è¾ƒå°‘ï¼Œæœ‰çš„ç³»ç»Ÿæ¯”è¾ƒä¸“æ³¨äº Loggingã€æœ‰çš„ç³»ç»Ÿæ¯”è¾ƒä¸“æ³¨äº Tracingï¼Œè€Œå¤§éƒ¨åˆ†å…¶ä»–çš„ç›‘æ§ç³»ç»Ÿæ— éæ˜¯åªæ˜¯ç›‘æ§ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ï¼Œæ¯”å¦‚æ˜¯ä½œä¸ºä¸€æ¬¾æ•°æ®åº“å­˜å‚¨ç›‘æ§æ•°æ®ã€ä½œä¸ºä¸€ä¸ªå¯è§†åŒ–å›¾è¡¨çš„ç³»ç»Ÿå»å±•ç¤ºå„ç§å„æ ·çš„ç›‘æ§æ•°æ®ä¿¡æ¯ã€‚ æ‹¿ Logging æ¥è¯´ï¼Œå¼€æºç”¨çš„æœ€å¤šæœ€ç«çš„æŠ€æœ¯æ ˆæ˜¯ ELKï¼ŒTracing è¿™å—æœ‰ Skywalkingã€Pinpoint ç­‰æŠ€æœ¯ï¼Œå®ƒä»¬çš„å¯¹æ¯”å¦‚ APM å·…å³°å¯¹å†³ï¼šSkywalking PK Pinpoint ä¸€æ–‡ä»‹ç»ã€‚è€Œå­˜å‚¨ç›‘æ§æ•°æ®çš„æ—¶åºæ•°æ®åº“é‚£å°±æ¯”è¾ƒå¤šäº†ï¼Œå¸¸è§çš„æ¯”å¦‚ InfluxDBã€Prometheusã€OpenTSDB ç­‰ï¼Œå®ƒä»¬ä¹‹é—´çš„å¯¹æ¯”ä»‹ç»å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ ç›‘æ§å¯è§†åŒ–å›¾è¡¨çš„å¼€æºç³»ç»Ÿä¸ªäººè§‰å¾—æœ€å¥½çœ‹çš„å°±æ˜¯ Grafanaï¼Œåœ¨ 8.2 èŠ‚ä¸­æ­å»º Flink ç›‘æ§ç³»ç»Ÿçš„æ•°æ®å±•ç¤ºä¹Ÿæ˜¯ç”¨çš„ Grafanaï¼Œå½“ç„¶è¿˜å¯ä»¥åˆ©ç”¨ EChartsã€BizCharts ç­‰æ•°æ®å›¾è¡¨åº“åšäºŒæ¬¡å¼€å‘æ¥é€‚é…å…¬å¸çš„æ•°æ®å±•ç¤ºå›¾è¡¨ã€‚ ä¸Šé¢è¯´äº†è¿™ä¹ˆå¤šï¼Œè¿™é‡Œç¬”è€…æ ¹æ®è‡ªå·±çš„å·¥ä½œç»éªŒå…ˆè°ˆè°ˆå‡ ç‚¹è‡ªå·±å¯¹ç›‘æ§ç³»ç»Ÿçš„å¿ƒå¾—ï¼š å‘Šè­¦æ˜¯ç›‘æ§ç³»ç»Ÿç¬¬ä¸€å…¥å£ï¼Œå›¾è¡¨å±•ç¤ºä½“ç°ç›‘æ§çš„ä»·å€¼ï¼šå‘Šè­¦æ˜¯å”¯ä¸€å¯ä»¥ç¬¬ä¸€æ—¶é—´åæ˜ è¿è¡ŒçŠ¶æ€ï¼Œå®ƒæ‰¿æ‹…ç€ç³»ç»Ÿä¸äººä¹‹é—´çš„æ²Ÿé€šæ¡¥æ¢ï¼Œé€šå¸¸å‘Šè­¦æ¶ˆæ¯åˆä¼šæºå¸¦é“¾æ¥è·³è½¬åˆ°å›¾è¡¨å±•ç¤ºï¼Œå®ƒä½œä¸ºç¬¬ä¸€å…¥å£å¹¶è¡”æ¥ä¸Šäº†æ•´ä¸ªç›‘æ§ç³»ç»Ÿã€‚ æ•°æ®é‡‡é›†æ˜¯ç›‘æ§çš„æºæ³‰ï¼šæ•°æ®é‡‡é›†æ˜¯ç›‘æ§ç³»ç»Ÿçš„æºæ³‰ï¼Œå¦‚æœé‡‡é›†çš„æ•°æ®æ˜¯é”™è¯¯çš„ï¼Œå°†å¯¼è‡´åé¢çš„é“¾è·¯ï¼ˆå‘Šè­¦ã€æ•°æ®å±•ç¤ºï¼‰å…¨å¤„äºæ— æ•ˆçŠ¶æ€ï¼Œæ‰€ä»¥åƒä¸‡åƒä¸‡è¦ä¿è¯æ•°æ®é‡‡é›†çš„å‡†ç¡®æ€§å’Œå®Œæ•´æ€§ã€‚ æ•°æ®å­˜å‚¨æ˜¯ç›‘æ§æœ€å¤§æŒ‘æˆ˜ï¼šå½“æœºå™¨ã€ç³»ç»Ÿåº”ç”¨å’Œç›‘æ§æŒ‡æ ‡ç­‰å˜å¾—è¶Šå¤šæ¥å¤šæ—¶ï¼Œé‡‡é›†ä¸Šæ¥çš„æ•°æ®æ˜¯çˆ†ç‚¸æ€§å¢é•¿çš„ï¼Œå°†æµ·é‡çš„ç›‘æ§æ•°æ®å®æ—¶å­˜å‚¨åˆ°ä»»ä½•ä¸€ä¸ªæ•°æ®åº“ï¼ŒæŒ‘æˆ˜éƒ½æ˜¯ä¸å°çš„ã€‚ è¯´å®Œå¿ƒå¾—å†æ¥è®²è§£åˆ°åº•ä¸€ä¸ªç›‘æ§ç³»ç»ŸçœŸæ­£è¯¥åŒ…å«å“ªäº›ä¸œè¥¿å‘¢ï¼Ÿç¬”è€…è§‰å¾—é¦–å…ˆåˆ† 6 å±‚ï¼šæ•°æ®é‡‡é›†å±‚ã€æ•°æ®ä¼ è¾“å±‚ã€æ•°æ®è®¡ç®—å±‚ã€å‘Šè­¦ã€æ•°æ®å­˜å‚¨ã€æ•°æ®å±•ç¤ºï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ ç›‘æ§ç³»ç»Ÿè¿™å…­å±‚çš„ä¸»è¦åŠŸèƒ½åˆ†åˆ«æ˜¯ï¼š æ•°æ®é‡‡é›†å±‚ï¼šè¯¥å±‚ä¸»è¦åŠŸèƒ½å°±æ˜¯å»é‡‡é›†å„ç§å„æ ·çš„æ•°æ®ï¼Œæ¯”å¦‚ Metricsã€Loggingã€Tracing æ•°æ®ã€‚ æ•°æ®ä¼ è¾“å±‚ï¼šè¯¥å±‚ä¸»è¦åŠŸèƒ½å°±æ˜¯ä¼ è¾“é‡‡é›†åˆ°çš„ç›‘æ§æ•°æ®ï¼Œä¸€èˆ¬ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—å±…å¤šï¼Œæ¯”å¦‚ Kafkaã€RocketMQ ç­‰ã€‚ æ•°æ®è®¡ç®—å±‚ï¼šè¯¥å±‚çš„ä¸»è¦åŠŸèƒ½æ˜¯å°†é‡‡é›†åˆ°çš„æ•°æ®è¿›è¡Œæ•°æ®æ¸…æ´—å’Œè®¡ç®—ï¼Œä¸€èˆ¬é‡‡ç”¨ Flinkã€Spark ç­‰è®¡ç®—å¼•æ“æ¥å¤„ç†ã€‚ å‘Šè­¦ï¼šè¯¥å±‚å…¶å®ä¹Ÿå±äºæ•°æ®è®¡ç®—å±‚ï¼Œä½†æ˜¯å› ä¸ºå‘Šè­¦æ¶‰åŠçš„å†…å®¹å¤ªå¤šï¼Œæ¯”å¦‚å‘Šè­¦è§„åˆ™ã€å‘Šè­¦è®¡ç®—ã€å‘Šè­¦é€šçŸ¥ç­‰ï¼Œæ‰€ä»¥å¯ä»¥å•ç‹¬ä½œä¸ºä¸€ä¸ªé‡è¦ç‚¹æ¥è®²ã€‚ æ•°æ®å­˜å‚¨å±‚ï¼šè¯¥å±‚çš„ä¸»è¦åŠŸèƒ½æ˜¯å­˜å‚¨æ‰€æœ‰çš„ç›‘æ§æ•°æ®ï¼Œä¸ºåé¢çš„æ•°æ®å¯è§†åŒ–æä¾›æ•°æ®æºã€‚ æ•°æ®å±•ç¤ºå±‚ï¼šè¯¥å±‚çš„ä¸»è¦åŠŸèƒ½æ˜¯å°†ç›‘æ§æ•°æ®é€šè¿‡å¯è§†åŒ–å›¾è¡¨æ¥å±•ç¤ºå‡ºæ¥ï¼Œé€šè¿‡å›¾è¡¨å¯ä»¥çŸ¥é“æœåŠ¡å™¨ã€åº”ç”¨çš„è¿è¡ŒçŠ¶æ€ã€‚ 12.3.3 Metricsï¼Tracingï¼Logging æ•°æ®å®æ—¶é‡‡é›†åœ¨ 12.1 èŠ‚ä¸­è®²è§£äº†æ—¥å¿—æ•°æ®å¦‚ä½•é‡‡é›†ï¼Œé‚£ä¹ˆå¯¹äº Metrics å’Œ Tracing æ•°æ®è¯¥æ€ä¹ˆé‡‡é›†å‘¢ï¼Ÿ MetricsTracing12.3.4 æ¶ˆæ¯é˜Ÿåˆ—å¦‚ä½•æ’‘ä½é«˜å³°æµé‡RabbitMQKafkaRocketMQ12.3.5 æŒ‡æ ‡æ•°æ®å®æ—¶è®¡ç®—12.3.6 æä¾›åŠæ—¶ä¸”å‡†ç¡®çš„æ ¹å› åˆ†æå‘Šè­¦å‘Šè­¦æœ¬è´¨å‘Šè­¦é€šçŸ¥å¯¹è±¡å‘Šè­¦é€šçŸ¥æ–¹å¼å‘Šè­¦è§„åˆ™çš„è®¾è®¡æ ¹å› åˆ†æå‘Šè­¦å‘Šè­¦äº‹ä»¶è§£è€¦å‘Šè­¦å·¥å•è®°å½•å‘Šè­¦è§£å†³è¿‡ç¨‹12.3.7 AIOps æ™ºèƒ½è¿ç»´é“è·¯æ¢ç´¢12.3.8 å¦‚ä½•ä¿éšœé«˜å³°æµé‡å®æ—¶å†™å…¥å­˜å‚¨ç³»ç»Ÿçš„ç¨³å®šæ€§12.3.9 ç›‘æ§æ•°æ®ä½¿ç”¨å¯è§†åŒ–å›¾è¡¨å±•ç¤ºGrafana ä»‹ç»12.3.10 å°ç»“ä¸åæ€åŠ å…¥çŸ¥è¯†æ˜Ÿçƒå¯ä»¥çœ‹åˆ°ä¸Šé¢æ–‡ç« ï¼šhttps://t.zsxq.com/IeAYbEy æœ¬ç« æ€»ç»“æœ¬ç« è®²äº†ä¸‰ä¸ªå…¬å¸å¸¸è§åœºæ™¯æ¡ˆä¾‹ï¼šæ—¥å¿—å¤„ç†ã€å»é‡ã€ç›‘æ§å‘Šè­¦ã€‚åœ¨æ—¥å¿—å¤„ç†æ¡ˆä¾‹ä¸­è®²è§£äº†æ—¥å¿—çš„é‡‡é›†çš„éœ€æ±‚ï¼Œä»¥åŠåˆ†æäº†æ•´ä¸ªæ—¥å¿—é‡‡é›†æ¡ˆä¾‹çš„æ¶æ„è®¾è®¡åˆ†å±‚ï¼Œå…³äºæ—¥å¿—é‡‡é›†å·¥å…·çš„é€‰å‹åœ¨ 11.5 èŠ‚ä¸­æœ‰è®²è¿‡ï¼Œæ‰€ä»¥è¯¥æ¡ˆä¾‹ä¸­å°±ç›´æ¥è®²è¿°é‡‡é›†å·¥å…·çš„ä½¿ç”¨å’Œå®‰è£…ï¼Œå¹¶å°†é‡‡é›†åˆ°çš„æ•°æ®å‘é€åˆ° Kafkaï¼Œç„¶åä½¿ç”¨ Flink æ¸…æ´—æ—¥å¿—æ•°æ®å¹¶å°†å¼‚å¸¸æ—¥å¿—å‘Šè­¦é€šçŸ¥åˆ°ç›¸åº”è´Ÿè´£äººï¼Œæ¥ç€å°†æ•°æ®å†™å…¥åˆ° ElasticSearchï¼Œæœ€åé€šè¿‡ Kibana å¯ä»¥å±•ç¤ºå’Œæœç´¢æ—¥å¿—æ•°æ®ã€‚ åœ¨ç™¾äº¿æ•°æ®å®æ—¶å»é‡æ¡ˆä¾‹ä¸­é€šè¿‡å¯¹æ¯”é€šç”¨è§£å†³æ–¹æ³•ã€ä½¿ç”¨ BloomFilterã€ä½¿ç”¨ HBase å’Œä½¿ç”¨ Flink KeyedState å‡ ç§æ–¹æ¡ˆæ¥åˆ†æå®æ—¶å»é‡çš„è§£å†³æ–¹æ¡ˆï¼Œå¹¶åœ¨è¯¥æ¡ˆä¾‹ä¸­è¿˜æåŠåˆ°å¦‚ä½•å»ä¼˜åŒ–å»é‡çš„æ•ˆæœã€‚ åœ¨å®æ—¶ç›‘æ§å‘Šè­¦æ¡ˆä¾‹ä¸­è®²è¿°äº†å…¬å¸é€šç”¨çš„ç›‘æ§å‘Šè­¦éœ€æ±‚ï¼ŒåŒ…æ‹¬ Metricsã€Loggingã€Tracingï¼Œç„¶åè®¾è®¡å‡ºæ•´ä¸ªç›‘æ§å‘Šè­¦ç³»ç»Ÿçš„æ¶æ„åˆ†å±‚å’ŒæŠ€æœ¯é€‰å‹ï¼Œå…¶ä¸­åˆ†å±‚åŒ…å«æ•°æ®é‡‡é›†å±‚ã€æ•°æ®ä¼ è¾“å±‚ã€æ•°æ®è®¡ç®—å±‚ã€æ•°æ®å­˜å‚¨å±‚ã€æ•°æ®å±•ç¤ºå±‚ã€‚å…³äºæ•°æ®é‡‡é›†å·¥å…·ã€æ¶ˆæ¯é˜Ÿåˆ—ã€æ•°æ®å­˜å‚¨ä¸­é—´ä»¶ã€æ•°æ®å±•ç¤ºçš„æŠ€æœ¯é€‰å‹ï¼Œç¬”è€…ä¹Ÿåˆ†åˆ«åšäº†å¯¹æ¯”ä»‹ç»ï¼Œä»¥ä¾¿å¤§å®¶å¯ä»¥æ ¹æ®è‡ªå·±å…¬å¸çš„æƒ…å†µåšæ¶æ„é€‰å‹ã€‚å¦å¤–é’ˆå¯¹å®æ—¶å‘Šè­¦è¿™å—ï¼Œç¬”è€…ä¹Ÿè¯¦è¿°äº†å¾ˆå¤šï¼ŒåŒ…æ‹¬å‘Šè­¦è§„åˆ™çš„è®¾è®¡ã€å‘Šè­¦é€šçŸ¥å¯¹è±¡ã€å‘Šè­¦é€šçŸ¥æ–¹å¼ã€å‘Šè­¦æ¶ˆæ¯æ”¶æ•›ã€å‘Šè­¦æ¶ˆæ¯æ ¹å› åˆ†æç­‰ï¼Œæœ€åè¿˜è®²äº†å¯¹ç›‘æ§å‘Šè­¦çš„å±•æœ›ï¼Œå¸Œæœ›èƒ½å¤Ÿåœ¨ AIOps åšæ›´å¤šçš„æ¢ç´¢ï¼Œå¯¹äºè¿™å—çš„å†…å®¹ï¼Œç¬”è€…åœ¨ç¤¾åŒºé’‰é’‰ç¾¤åšè¿‡è§†é¢‘ç›´æ’­ï¼Œå¤§å®¶å¯ä»¥å»ç¬”è€…çš„åšå®¢æŸ¥çœ‹å½•æ’­çš„è§†é¢‘ã€‚","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹â€”â€” åŸºäº Flink çš„ç™¾äº¿æ•°æ®å»é‡å®è·µ","date":"2021-08-19T16:00:00.000Z","path":"2021/08/20/flink-in-action-12.2/","text":"12.2 åŸºäº Flink çš„ç™¾äº¿æ•°æ®å»é‡å®è·µåœ¨å·¥ä½œä¸­ç»å¸¸ä¼šé‡åˆ°å»é‡çš„åœºæ™¯ï¼Œä¾‹å¦‚åŸºäº APP çš„ç”¨æˆ·è¡Œä¸ºæ—¥å¿—åˆ†æç³»ç»Ÿï¼šç”¨æˆ·çš„è¡Œä¸ºæ—¥å¿—ä»æ‰‹æœº APP ç«¯ä¸ŠæŠ¥åˆ° Nginx æœåŠ¡ç«¯ï¼Œç„¶åé€šè¿‡ Logstashã€Flume æˆ–å…¶ä»–å·¥å…·å°†æ—¥å¿—ä» Nginx å†™å…¥åˆ° Kafka ä¸­ã€‚ç”±äºç”¨æˆ·æ‰‹æœºå®¢æˆ·ç«¯çš„ç½‘ç»œå¯èƒ½å‡ºç°ä¸ç¨³å®šï¼Œæ‰€ä»¥æ‰‹æœº APP ç«¯ä¸Šä¼ æ—¥å¿—çš„ç­–ç•¥æ˜¯ï¼šå®å¯é‡å¤ä¸ŠæŠ¥ï¼Œä¹Ÿä¸èƒ½æ¼æŠ¥æ—¥å¿—ï¼Œæ‰€ä»¥å¯¼è‡´ Kafka ä¸­å¯èƒ½ä¼šå‡ºç°æ—¥å¿—é‡å¤çš„æƒ…å†µï¼Œå³ï¼šåŒä¸€æ¡æ—¥å¿—å‡ºç°äº† 2 æ¡æˆ– 2 æ¡ä»¥ä¸Šã€‚é€šå¸¸æƒ…å†µä¸‹ï¼ŒFlink ä»»åŠ¡çš„æ•°æ®æºéƒ½æ˜¯ Kafkaï¼Œè‹¥ Kafka ä¸­æ•°æ®å‡ºç°äº†é‡å¤ï¼Œåœ¨å®æ—¶ ETL æˆ–è€…æµè®¡ç®—æ—¶éƒ½éœ€è¦è€ƒè™‘åŸºäºæ—¥å¿—ä¸»é”®å¯¹æ—¥å¿—è¿›è¡Œå»é‡ï¼Œå¦åˆ™ä¼šå¯¼è‡´æµè®¡ç®—ç»“æœåé«˜æˆ–ç»“æœä¸å‡†ç¡®çš„é—®é¢˜ï¼Œä¾‹å¦‚ç”¨æˆ· a åœ¨æŸä¸ªé¡µé¢åªç‚¹å‡»äº†ä¸€æ¬¡ï¼Œä½†ç”±äºæ—¥å¿—é‡å¤ä¸ŠæŠ¥ï¼Œæ‰€ä»¥ç”¨æˆ· a åœ¨è¯¥é¡µé¢çš„ç‚¹å‡»æ—¥å¿—åœ¨ Kafka ä¸­å‡ºç°äº† 2 æ¬¡ï¼Œæœ€åç»Ÿè®¡è¯¥é¡µé¢çš„ç‚¹å‡»æ•°æ—¶ï¼Œç»“æœå°±ä¼šåé«˜ã€‚è¿™é‡Œåªé˜è¿°äº†ä¸€ç§å¯èƒ½é€ æˆ Kafka ä¸­æ•°æ®é‡å¤çš„æƒ…å†µï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¾ˆå¤šæƒ…å†µéƒ½å¯èƒ½é€ æˆ Kafka ä¸­æ•°æ®é‡å¤ï¼Œè¿™é‡Œä¸ä¸€ä¸€åˆ—ä¸¾ï¼Œæœ¬èŠ‚ä¸»è¦è®²è¿°å‡ºç°äº†æ•°æ®é‡å¤åï¼Œè¯¥å¦‚ä½•å¤„ç†ã€‚ 12.2.1 å»é‡çš„é€šç”¨è§£å†³æ–¹æ¡ˆKafka ä¸­æ•°æ®å‡ºç°é‡å¤åï¼Œå„ç§è§£å†³æ–¹æ¡ˆéƒ½æ¯”è¾ƒç±»ä¼¼ï¼Œä¸€èˆ¬éœ€è¦ä¸€ä¸ªå…¨å±€ Set é›†åˆæ¥ç»´æŠ¤å†å²æ‰€æœ‰æ•°æ®çš„ä¸»é”®ã€‚å½“å¤„ç†æ–°æ—¥å¿—æ—¶ï¼Œéœ€è¦æ‹¿åˆ°å½“å‰æ—¥å¿—çš„ä¸»é”®ä¸å†å²æ•°æ®çš„ Set é›†åˆæŒ‰ç…§è§„åˆ™è¿›è¡Œæ¯”è¾ƒï¼Œè‹¥ Set é›†åˆä¸­å·²ç»åŒ…å«äº†å½“å‰æ—¥å¿—çš„ä¸»é”®ï¼Œè¯´æ˜å½“å‰æ—¥å¿—åœ¨ä¹‹å‰å·²ç»è¢«å¤„ç†è¿‡äº†ï¼Œåˆ™å½“å‰æ—¥å¿—åº”è¯¥è¢«è¿‡æ»¤æ‰ï¼Œå¦åˆ™è®¤ä¸ºå½“å‰æ—¥å¿—ä¸åº”è¯¥è¢«è¿‡æ»¤åº”è¯¥è¢«å¤„ç†ï¼Œè€Œä¸”å¤„ç†å®Œæˆåéœ€è¦å°†æ–°æ—¥å¿—çš„ä¸»é”®åŠ å…¥åˆ° Set é›†åˆä¸­ï¼ŒSet é›†åˆæ°¸è¿œå­˜æ”¾ç€æ‰€æœ‰å·²ç»è¢«å¤„ç†è¿‡çš„æ•°æ®ã€‚è¿™ç§å»é‡çš„é€šç”¨è§£å†³æ–¹æ¡ˆçš„æµç¨‹å›¾å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ å¤„ç†æµç¨‹å¾ˆç®€å•ï¼Œå…³é”®åœ¨äºå¦‚ä½•ç»´æŠ¤è¿™ä¸ª Set é›†åˆï¼Œå¯ä»¥ç®€å•ä¼°ç®—ä¸€ä¸‹è¿™ä¸ª Set é›†åˆéœ€è¦å ç”¨å¤šå¤§ç©ºé—´ã€‚æœ¬å°èŠ‚è¦è§£å†³çš„é—®é¢˜æ˜¯ç™¾äº¿æ•°æ®å»é‡ï¼Œæ‰€ä»¥å°±æŒ‰ç…§æ¯å¤© 1 ç™¾äº¿çš„æ•°æ®é‡æ¥è®¡ç®—ã€‚ç”±äºæ¯å¤©æ•°æ®é‡å·¨å¤§ï¼Œå› æ­¤ä¸»é”®å ç”¨ç©ºé—´é€šå¸¸ä¼šæ¯”è¾ƒå¤§ï¼Œå¦‚æœä¸»é”®å ç”¨ç©ºé—´å°æ„å‘³ç€è¡¨ç¤ºçš„æ•°æ®èŒƒå›´å°±æ¯”è¾ƒå°ï¼Œå°±å¯èƒ½å¯¼è‡´ä¸»é”®å†²çªï¼Œä¾‹å¦‚ï¼š4 ä¸ªå­—èŠ‚çš„ int ç±»å‹è¡¨ç¤ºæ•°æ®èŒƒå›´æ˜¯ä¸º -2147483648 ~ 2147483647ï¼Œæ€»å…±å¯ä»¥è¡¨ç¤º 42 äº¿ä¸ªæ•°ï¼Œå¦‚æœè¿™é‡Œæ¯å¤©ç™¾äº¿çš„æ•°æ®é‡é€‰ç”¨ int ç±»å‹åšä¸ºä¸»é”®çš„è¯ï¼Œå¾ˆæ˜æ˜¾ä¼šæœ‰å¤§é‡çš„ä¸»é”®å‘ç”Ÿå†²çªï¼Œä¼šå°†ä¸é‡å¤çš„æ•°æ®è®¤ä¸ºæ˜¯å‘ç”Ÿäº†é‡å¤ã€‚ç”¨æˆ·çš„è¡Œä¸ºæ—¥å¿—æ˜¯åœ¨æ‰‹æœºå®¢æˆ·ç«¯ç”Ÿæˆçš„ï¼Œæ²¡æœ‰å…¨å±€å‘å·å™¨ï¼Œä¸€èˆ¬ä¼šé€‰å– UUID åšä¸ºæ—¥å¿—çš„ä¸»é”®ï¼ŒUUID ä¼šç”Ÿæˆ 36 ä½çš„å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ï¼šâ€f106c4a1-4c6f-41c1-9d30-bbb2b271284aâ€ã€‚æ¯ä¸ªä¸»é”®å ç”¨ 36 å­—èŠ‚ï¼Œæ¯å¤© 1 ç™¾äº¿æ•°æ®ï¼Œ36å­—èŠ‚ 100äº¿ â‰ˆ 360 GBã€‚è¿™ä»…ä»…æ˜¯ä¸€å¤©çš„æ•°æ®é‡ï¼Œæ‰€ä»¥è¯¥ Set é›†åˆè¦æƒ³å­˜å‚¨ç©ºé—´ä¸å‘ç”ŸæŒç»­åœ°çˆ†ç‚¸å¼å¢é•¿ï¼Œå¿…é¡»å¢åŠ ä¸€ä¸ªåŠŸèƒ½ï¼Œé‚£å°±æ˜¯ç»™æ‰€æœ‰çš„ä¸»é”®å¢åŠ  TTLï¼ˆè¿‡æœŸæ—¶é—´ï¼‰ã€‚å¦‚æœä¸å¢åŠ  TTLï¼Œ10 å¤©æ•°æ®é‡çš„ä¸»é”®å ç”¨ç©ºé—´å°± 3.6Tï¼Œ100 å¤©æ•°æ®é‡çš„ä¸»é”®å ç”¨ç©ºé—´ 36Tï¼Œæ‰€ä»¥åœ¨è®¾è®¡ä¹‹åˆå¿…é¡»è€ƒè™‘ä¸ºä¸»é”®è®¾å®š TTLã€‚å¦‚æœè¦æ±‚æŒ‰å¤©è¿›è¡Œå»é‡æˆ–è€…è®¤ä¸ºæ—¥å¿—å‘ç”Ÿé‡å¤ä¸ŠæŠ¥çš„æ—¶é—´é—´éš”ä¸å¯èƒ½å¤§äº 24 å°æ—¶ï¼Œé‚£ä¹ˆä¸ºäº†ç³»ç»Ÿçš„å¯é æ€§ TTL å¯ä»¥è®¾ç½®ä¸º 36 å°æ—¶ã€‚æ¯å¤©æ•°æ®é‡ 1 ç™¾äº¿ï¼Œä¸” Set é›†åˆä¸­å­˜æ”¾ç€ 36 å°æ—¶çš„æ•°æ®é‡ï¼Œå³ 100 äº¿ 1.5 = 150 äº¿ï¼Œæ‰€ä»¥ Set é›†åˆä¸­éœ€è¦ç»´æŠ¤ 150 äº¿çš„æ•°æ®é‡ï¼Œä¸” Set é›†åˆä¸­æ¯æ¡æ•°æ®éƒ½å¢åŠ äº† TTLï¼Œæ„å‘³ç€ Set é›†åˆéœ€è¦ä¸ºæ¯æ¡æ•°æ®å†é™„å¸¦ä¿å­˜ä¸€ä¸ªæ—¶é—´æˆ³ï¼Œæ¥ç¡®å®šè¯¥æ•°æ®ä»€ä¹ˆæ—¶å€™è¿‡æœŸã€‚ä¾‹å¦‚ Redis ä¸­ä¸ºä¸€ä¸ª key è®¾ç½®äº† TTLï¼Œå¦‚æœæ²¡æœ‰ä¸ºè¿™ä¸ª key é™„å¸¦æ—¶é—´æˆ³ï¼Œé‚£ä¹ˆæ ¹æœ¬æ— æ³•åˆ¤æ–­è¯¥ key ä»€ä¹ˆæ—¶å€™åº”è¯¥è¢«æ¸…ç†ã€‚æ‰€ä»¥åœ¨è€ƒè™‘æ¯æ¡æ•°æ®å ç”¨ç©ºé—´æ—¶ï¼Œä¸ä»…è¦è€ƒè™‘æ•°æ®æœ¬èº«ï¼Œè¿˜éœ€è¦è€ƒè™‘æ˜¯å¦éœ€è¦å…¶ä»–é™„å¸¦çš„å­˜å‚¨ã€‚ä¸»é”®æœ¬èº«å ç”¨ 36 å­—èŠ‚åŠ ä¸Š long ç±»å‹çš„æ—¶é—´æˆ³ 8 å­—èŠ‚ï¼Œæ‰€ä»¥æ¯æ¡æ•°æ®è‡³å°‘éœ€è¦å ç”¨ 44 å­—èŠ‚ï¼Œ150 äº¿ * 44 å­—èŠ‚ = 660 GBã€‚æ‰€ä»¥æ¯å¤©ç™¾äº¿çš„æ•°æ®é‡ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨ Set é›†åˆçš„æ–¹æ¡ˆæ¥å®ç°ï¼Œè‡³å°‘éœ€è¦å ç”¨ 660 GB ä»¥ä¸Šçš„å­˜å‚¨ç©ºé—´ã€‚ 12.2.2 ä½¿ç”¨ BloomFilter å®ç°å»é‡æœ‰äº›æµè®¡ç®—çš„åœºæ™¯å¯¹å‡†ç¡®æ€§è¦æ±‚å¹¶ä¸æ˜¯å¾ˆé«˜ï¼Œä¾‹å¦‚ä¼ ç»Ÿçš„ Lambda æ¶æ„ä¸­ï¼Œéƒ½ä¼šæœ‰ç¦»çº¿å»çŸ«æ­£å®æ—¶è®¡ç®—çš„ç»“æœï¼Œæ‰€ä»¥æ ¹æ®ä¸šåŠ¡åœºæ™¯ï¼Œå½“ä¸šåŠ¡è¦æ±‚å¯ä»¥æ¥å—ç»“æœæœ‰å°é‡è¯¯å·®æ—¶ï¼Œå¯ä»¥é€‰æ‹©ä½¿ç”¨ä¸€äº›ä½æˆæœ¬çš„æ•°æ®ç»“æ„ã€‚BloomFilter å’Œ HyperLogLog éƒ½æ˜¯ç›¸å¯¹ä½æˆæœ¬çš„æ•°æ®ç»“æ„ï¼Œåˆ†åˆ«æœ‰è‡ªå·±çš„åº”ç”¨åœºæ™¯ï¼Œä¸”ä¸¤ç§æ•°æ®ç»“æ„éƒ½æœ‰ä¸€å®šè¯¯å·®ã€‚HyperLogLog å¯ä»¥ä¼°ç®—å‡º HyperLogLog ä¸­æ’å…¥äº†å¤šå°‘ä¸ªä¸é‡å¤çš„å…ƒç´ ï¼Œè€Œä¸èƒ½å‘Šè¯‰æˆ‘ä»¬ä¹‹å‰æ˜¯å¦æ’å…¥äº†å“ªäº›å…ƒç´ ã€‚BloomFilter åˆ™æ°å¥½ç›¸åï¼Œç›¸å¯¹è€Œè¨€ BloomFilter æ›´åƒæ˜¯ä¸€ä¸ª Set é›†åˆï¼ŒBloomFilter å¯ä»¥å‘Šè¯‰ä½  BloomFilter ä¸­è‚¯å®šä¸åŒ…å«å…ƒç´  aï¼Œæˆ–è€…å‘Šè¯‰ä½  BloomFilter ä¸­å¯èƒ½åŒ…å«å…ƒç´  bï¼Œä½† BloomFilter ä¸èƒ½å‘Šè¯‰ä½  BloomFilter ä¸­æ’å…¥äº†å¤šå°‘ä¸ªå…ƒç´ ã€‚æ¥ä¸‹æ¥äº†è§£ä¸€ä¸‹ BloomFilter çš„å®ç°åŸç†ã€‚ bitmap ä½å›¾äº†è§£ BloomFilterï¼Œä» bitmapï¼ˆä½å›¾ï¼‰å¼€å§‹è¯´èµ·ã€‚ç°åœ¨æœ‰ 1 åƒä¸‡ä¸ªæ•´æ•°ï¼Œæ•°æ®èŒƒå›´åœ¨ 0 åˆ° 2 åƒä¸‡ä¹‹é—´ã€‚å¦‚ä½•å¿«é€ŸæŸ¥æ‰¾æŸä¸ªæ•´æ•°æ˜¯å¦åœ¨è¿™ 1 åƒä¸‡ä¸ªæ•´æ•°ä¸­å‘¢ï¼Ÿå¯ä»¥å°†è¿™ 1 åƒä¸‡ä¸ªæ•°ä¿å­˜åœ¨ HashMap ä¸­ï¼Œä¸è€ƒè™‘å¯¹è±¡å¤´åŠå…¶ä»–ç©ºé—´ï¼Œ1000 ä¸‡ä¸ª int ç±»å‹æ•°æ®éœ€è¦å ç”¨å¤§çº¦ 1000ä¸‡ * 4 å­—èŠ‚ â‰ˆ 40 MB å­˜å‚¨ç©ºé—´ã€‚æœ‰æ²¡æœ‰å…¶ä»–æ–¹æ¡ˆå‘¢ï¼Ÿå› ä¸ºæ•°æ®èŒƒå›´æ˜¯ 0 åˆ° 2 åƒä¸‡ï¼Œæ‰€ä»¥å¯ä»¥ç”³è¯·ä¸€ä¸ªé•¿åº¦ä¸º 2000 ä¸‡ã€boolean ç±»å‹çš„æ•°ç»„ï¼Œå°†è¿™ 2 åƒä¸‡ä¸ªæ•´æ•°ä½œä¸ºæ•°ç»„ä¸‹æ ‡ï¼Œå°†å…¶å¯¹åº”çš„æ•°ç»„é»˜è®¤å€¼è®¾ç½®æˆ falseï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ•°ç»„ä¸‹æ ‡ä¸º 2ã€666ã€999 çš„ä½ç½®å­˜å‚¨çš„æ•°æ®ä¸º trueï¼Œè¡¨ç¤º 1 åƒä¸‡ä¸ªæ•°ä¸­åŒ…å«äº† 2ã€666ã€999 ç­‰ã€‚å½“æŸ¥è¯¢æŸä¸ªæ•´æ•° K æ˜¯å¦åœ¨è¿™ 1 åƒä¸‡ä¸ªæ•´æ•°ä¸­æ—¶ï¼Œåªéœ€è¦å°†å¯¹åº”çš„æ•°ç»„å€¼ array[K] å–å‡ºæ¥ï¼Œçœ‹æ˜¯å¦ç­‰äº trueã€‚å¦‚æœç­‰äº trueï¼Œè¯´æ˜ 1 åƒä¸‡æ•´æ•°ä¸­åŒ…å«è¿™ä¸ªæ•´æ•° Kï¼Œå¦åˆ™è¡¨ç¤ºä¸åŒ…å«è¿™ä¸ªæ•´æ•° Kã€‚ Java çš„ boolean åŸºæœ¬ç±»å‹å ç”¨ä¸€ä¸ªå­—èŠ‚ï¼ˆ8bitï¼‰çš„å†…å­˜ç©ºé—´ï¼Œæ‰€ä»¥ä¸Šè¿°æ–¹æ¡ˆéœ€è¦ç”³è¯· 2000 ä¸‡å­—èŠ‚ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¯ä»¥é€šè¿‡ç¼–ç¨‹è¯­è¨€ç”¨äºŒè¿›åˆ¶ä½æ¥æ¨¡æ‹Ÿå¸ƒå°”ç±»å‹ï¼ŒäºŒè¿›åˆ¶çš„ 1 è¡¨ç¤ºtrueã€äºŒè¿›åˆ¶çš„ 0 è¡¨ç¤ºfalseã€‚é€šè¿‡äºŒè¿›åˆ¶æ¨¡æ‹Ÿå¸ƒå°”ç±»å‹çš„æ–¹æ¡ˆï¼Œåªéœ€è¦ç”³è¯· 2000 ä¸‡ bit å³å¯ï¼Œç›¸æ¯” boolean ç±»å‹è€Œè¨€ï¼Œå­˜å‚¨ç©ºé—´å ç”¨ä»…ä¸ºåŸæ¥çš„ 1/8ã€‚2000 ä¸‡ bit â‰ˆ 2.4 MBï¼Œç›¸æ¯”å­˜å‚¨åŸå§‹æ•°æ®çš„æ–¹æ¡ˆ 40 MB è€Œè¨€ï¼Œå ç”¨çš„å­˜å‚¨ç©ºé—´å°‘äº†å¾ˆå¤šã€‚ å‡å¦‚è¿™ 1 åƒä¸‡ä¸ªæ•´æ•°çš„æ•°æ®èŒƒå›´æ˜¯ 0 åˆ° 100 äº¿ï¼Œé‚£ä¹ˆå°±éœ€è¦ç”³è¯· 100 äº¿ä¸ª bit çº¦ç­‰äº 1200 MBï¼Œæ¯”å­˜å‚¨åŸå§‹æ•°æ®æ–¹æ¡ˆçš„ 40MB è¿˜è¦å¤§å¾ˆå¤šã€‚è¯¥æƒ…å†µä¸‹ï¼Œç›´æ¥ä½¿ç”¨ä½å›¾ä½¿ç”¨çš„å­˜å‚¨ç©ºé—´æ›´å¤šäº†ï¼Œæ€ä¹ˆè§£å†³å‘¢ï¼Ÿå¯ä»¥åªç”³è¯· 1 äº¿ bit çš„å­˜å‚¨ç©ºé—´ï¼Œå¯¹ 1000 ä¸‡ä¸ªæ•°æ±‚hashï¼Œæ˜ å°„åˆ° 1 äº¿çš„äºŒè¿›åˆ¶ä½ä¸Šï¼Œæœ€åå¤§çº¦å ç”¨ 12 MB çš„å­˜å‚¨ç©ºé—´ï¼Œä½†æ˜¯å¯èƒ½å­˜åœ¨ hash å†²çªçš„æƒ…å†µã€‚ä¾‹å¦‚ 3 å’Œ 100000003ï¼ˆä¸€äº¿é›¶ä¸‰ï¼‰è¿™ä¸¤ä¸ªæ•°å¯¹ä¸€äº¿æ±‚ä½™éƒ½ä¸º 3ï¼Œæ‰€ä»¥æ˜ å°„åˆ°é•¿åº¦ä¸º 1 äº¿çš„ä½å›¾ä¸Šï¼Œè¿™ä¸¤ä¸ªæ•°ä¼šå ç”¨åŒä¸€ä¸ª bitï¼Œå°±ä¼šå¯¼è‡´ä¸€ä¸ªé—®é¢˜ï¼š1 åƒä¸‡ä¸ªæ•´æ•°ä¸­åŒ…å«äº†ä¸€äº¿é›¶ä¸‰ï¼Œæ‰€ä»¥ä½å›¾ä¸­ä¸‹æ ‡ä¸º 3 çš„ä½ç½®å­˜å‚¨ç€äºŒè¿›åˆ¶ 1ã€‚å½“æŸ¥è¯¢ 1 åƒä¸‡ä¸ªæ•´æ•°ä¸­æ˜¯å¦åŒ…å«æ•°å­— 3 æ—¶ï¼ŒåŒæ ·ä¹Ÿæ˜¯å»ä½å›¾ä¸­ä¸‹æ ‡ 3 çš„ä½ç½®å»æŸ¥æ‰¾ï¼Œå‘ç°ä¸‹æ ‡ä¸º 3 çš„ä½ç½®å­˜å‚¨ç€äºŒè¿›åˆ¶ 1ï¼Œæ‰€ä»¥è¯¯ä»¥ä¸º 1 åƒä¸‡ä¸ªæ•´æ•°ä¸­åŒ…å«æ•°å­— 3ã€‚ä¸ºäº†å‡å°‘ hash å†²çªï¼Œäºæ˜¯è¯ç”Ÿäº† BloomFilterã€‚ BloomFilter åŸç†ä»‹ç»hash å­˜åœ¨ hash å†²çªï¼ˆç¢°æ’ï¼‰çš„é—®é¢˜ï¼Œä¸¤ä¸ªä¸åŒçš„ key é€šè¿‡åŒä¸€ä¸ª hash å‡½æ•°å¾—åˆ°çš„å€¼æœ‰å¯èƒ½ç›¸åŒã€‚ä¸ºäº†å‡å°‘å†²çªï¼Œå¯ä»¥å¼•å…¥å¤šä¸ª hash å‡½æ•°ï¼Œå¦‚æœé€šè¿‡å…¶ä¸­çš„ä¸€ä¸ª hash å‡½æ•°å‘ç°æŸå…ƒç´ ä¸åœ¨é›†åˆä¸­ï¼Œé‚£ä¹ˆè¯¥å…ƒç´ è‚¯å®šä¸åœ¨é›†åˆä¸­ã€‚å½“æ‰€æœ‰çš„ hash å‡½æ•°å‘Šè¯‰æˆ‘ä»¬è¯¥å…ƒç´ åœ¨é›†åˆä¸­æ—¶ï¼Œæ‰èƒ½ç¡®å®šè¯¥å…ƒç´ å­˜åœ¨äºé›†åˆä¸­ï¼Œè¿™ä¾¿æ˜¯BloomFilterçš„åŸºæœ¬æ€æƒ³ã€‚ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ˜¯å¾€ BloomFilter ä¸­æ’å…¥å…ƒç´  aã€b çš„è¿‡ç¨‹ï¼Œæœ‰ 3 ä¸ª hash å‡½æ•°ï¼Œå…ƒç´  a ç»è¿‡ 3 ä¸ª hash å‡½æ•°åå¯¹åº”çš„ 2ã€8ã€10 è¿™ä¸‰ä¸ªäºŒè¿›åˆ¶ä½ï¼Œæ‰€ä»¥å°†è¿™ä¸‰ä¸ªäºŒè¿›åˆ¶ä½ç½®ä¸º 1ï¼Œå…ƒç´  b ç»è¿‡ 3 ä¸ª hash å‡½æ•°åï¼Œå¯¹åº”çš„ 5ã€10ã€14 è¿™ä¸‰ä¸ªäºŒè¿›åˆ¶ä½ï¼Œå°†è¿™ä¸‰ä¸ªäºŒè¿›åˆ¶ä½ä¹Ÿç½®ä¸º 1ï¼Œå…¶ä¸­ä¸‹æ ‡ä¸º 10 çš„äºŒè¿›åˆ¶ä½è¢« aã€b å…ƒç´ éƒ½æ¶‰åŠåˆ°ã€‚ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ˜¯ä» BloomFilter ä¸­æŸ¥æ‰¾å…ƒç´  cã€d çš„è¿‡ç¨‹ï¼ŒåŒæ ·åŒ…å«äº† 3 ä¸ª hash å‡½æ•°ï¼Œå…ƒç´  c ç»è¿‡ 3 ä¸ª hash å‡½æ•°åå¯¹åº”çš„ 2ã€6ã€9 è¿™ä¸‰ä¸ªäºŒè¿›åˆ¶ä½ï¼Œå…¶ä¸­ä¸‹æ ‡ 6 å’Œ 9 å¯¹åº”çš„äºŒè¿›åˆ¶ä½ä¸º 0ï¼Œæ‰€ä»¥ä¼šè®¤ä¸º BloomFilter ä¸­ä¸å­˜åœ¨å…ƒç´  cã€‚å…ƒç´  d ç»è¿‡ 3 ä¸ª hash å‡½æ•°åå¯¹åº”çš„ 5ã€8ã€14 è¿™ä¸‰ä¸ªäºŒè¿›åˆ¶ä½ï¼Œè¿™ä¸‰ä¸ªä½å¯¹åº”çš„äºŒè¿›åˆ¶ä½éƒ½ä¸º 1ï¼Œæ‰€ä»¥ä¼šè®¤ä¸º BloomFilter ä¸­å­˜åœ¨å…ƒç´  dï¼Œä½†å…¶å® BloomFilter ä¸­å¹¶ä¸å­˜åœ¨å…ƒç´  dï¼Œæ˜¯å› ä¸ºå…ƒç´  a å’Œå…ƒç´  b ä¹Ÿå¯¹åº”åˆ°äº† 5ã€8ã€14 è¿™ä¸‰ä¸ªäºŒè¿›åˆ¶ä½ä¸Šï¼Œæ‰€ä»¥ BloomFilter ä¼šæœ‰è¯¯åˆ¤ã€‚ä½†æ˜¯ä»å®ç°åŸç†æ¥çœ‹ï¼Œå½“ BloomFilter å‘Šè¯‰ä½ ä¸åŒ…å«å…ƒç´  c æ—¶ï¼ŒBloomFilter ä¸­è‚¯å®šä¸åŒ…å«å…ƒç´  cï¼Œå½“ BloomFilter å‘Šè¯‰ä½  BloomFilter ä¸­åŒ…å«å…ƒç´  d æ—¶ï¼Œå®ƒåªæ˜¯å¯èƒ½åŒ…å«ï¼Œä¹Ÿæœ‰å¯èƒ½ä¸åŒ…å«ã€‚ ä½¿ç”¨ BloomFilter å®ç°æ•°æ®å»é‡Redis 4.0 ä¹‹å BloomFilter ä»¥æ’ä»¶çš„å½¢å¼åŠ å…¥åˆ° Redis ä¸­ï¼Œå…³äº api çš„å…·ä½“ä½¿ç”¨è¿™é‡Œä¸å¤šèµ˜è¿°ã€‚BloomFilter åœ¨åˆ›å»ºæ—¶æ”¯æŒè®¾å®šä¸€ä¸ªé¢„æœŸå®¹é‡å’Œè¯¯åˆ¤ç‡ï¼Œé¢„æœŸå®¹é‡å³é¢„è®¡æ’å…¥çš„æ•°æ®é‡ï¼Œè¯¯åˆ¤ç‡å³ï¼šå½“ BloomFilter ä¸­æ’å…¥çš„æ•°æ®è¾¾åˆ°é¢„æœŸå®¹é‡æ—¶ï¼Œè¯¯åˆ¤çš„æ¦‚ç‡ï¼Œå¦‚æœ BloomFilter ä¸­æ’å…¥æ•°æ®è¾ƒå°‘çš„è¯ï¼Œè¯¯åˆ¤ç‡ä¼šæ›´ä½ã€‚ ç»ç¬”è€…æµ‹è¯•ï¼Œç”³è¯·ä¸€ä¸ªé¢„æœŸå®¹é‡ä¸º 10 äº¿ï¼Œè¯¯åˆ¤ç‡ä¸ºåƒåˆ†ä¹‹ä¸€çš„ BloomFilterï¼ŒBloomFilter ä¼šç”³è¯·çº¦ 143 äº¿ä¸ª bitï¼Œå³ï¼š14Gå·¦å³ï¼Œç›¸æ¯”ä¹‹å‰ 660G çš„å­˜å‚¨ç©ºé—´å°å¤ªå¤šäº†ã€‚ä½†æ˜¯åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œéœ€è¦è®°å½• BloomFilter ä¸­æ’å…¥å…ƒç´ çš„ä¸ªæ•°ï¼Œå½“æ’å…¥å…ƒç´ ä¸ªæ•°è¾¾åˆ° 10 äº¿æ—¶ï¼Œä¸ºäº†ä¿éšœè¯¯å·®ç‡ï¼Œå¯ä»¥å°†å½“å‰ BloomFilter æ¸…é™¤ï¼Œé‡æ–°ç”³è¯·ä¸€ä¸ªæ–°çš„ BloomFilterã€‚ é€šè¿‡ä½¿ç”¨ Redis çš„ BloomFilterï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç›¸å¯¹è¾ƒå°çš„å†…å­˜å®ç°ç™¾äº¿æ•°æ®çš„å»é‡ï¼Œä½†æ˜¯ BloomFilter æœ‰è¯¯å·®ï¼Œæ‰€ä»¥åªèƒ½ä½¿ç”¨åœ¨é‚£äº›å¯¹ç»“æœèƒ½æ‰¿å—ä¸€å®šè¯¯å·®çš„åº”ç”¨åœºæ™¯ï¼Œå¯¹äºå¹¿å‘Šè®¡è´¹ç­‰å¯¹æ•°æ®ç²¾åº¦è¦æ±‚éå¸¸é«˜çš„åœºæ™¯ï¼ŒæåŠ›æ¨èå¤§å®¶ä½¿ç”¨ç²¾å‡†å»é‡çš„æ–¹æ¡ˆæ¥å®ç°ã€‚ 12.2.3 ä½¿ç”¨ HBase ç»´æŠ¤å…¨å±€ Set å®ç°å»é‡é€šè¿‡ä¹‹å‰åˆ†æï¼Œæˆ‘ä»¬çŸ¥é“è¦æƒ³å®ç°ç™¾äº¿æ•°æ®é‡çš„ç²¾å‡†å»é‡ï¼Œéœ€è¦ç»´æŠ¤ 150 äº¿æ•°æ®é‡çš„ Set é›†åˆï¼Œæ¯æ¡æ•°æ®å ç”¨ 44 KBï¼Œæ€»å…±éœ€è¦ 660 GB çš„å­˜å‚¨ç©ºé—´ã€‚æ³¨æ„è¿™é‡Œè¯´çš„æ˜¯å­˜å‚¨ç©ºé—´è€Œä¸æ˜¯å†…å­˜ç©ºé—´ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸º 660 G çš„å†…å­˜å®åœ¨æ˜¯å¤ªè´µäº†ï¼Œ660G çš„ Redis äº‘æœåŠ¡ä¸€ä¸ªæœˆè‡³å°‘è¦ 2 ä¸‡ RMB ä»¥ä¸Šï¼Œä¿—è¯è¯´è®¾è®¡æ¶æ„ä¸è€ƒè™‘æˆæœ¬ç­‰äºè€æµæ°“ã€‚è¿™é‡Œä½¿ç”¨ Redis ç¡®å®å¯ä»¥è§£å†³é—®é¢˜ï¼Œä½†æ˜¯æˆæœ¬è¾ƒé«˜ã€‚HBase åŸºäº RowKey Get çš„æ•ˆç‡æ¯”è¾ƒé«˜ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥è€ƒè™‘å°†è¿™ä¸ªå¤§çš„ Set é›†åˆä»¥ HBase RowKey çš„å½¢å¼å­˜æ”¾åˆ° HBase ä¸­ã€‚HBase è¡¨è®¾ç½® TTL ä¸º 36 å°æ—¶ï¼Œæœ€è¿‘ 36 å°æ—¶çš„ 150 äº¿æ¡æ—¥å¿—çš„ä¸»é”®éƒ½å­˜æ”¾åˆ° HBase ä¸­ï¼Œæ¯æ¥ä¸€æ¡æ•°æ®ï¼Œå…ˆæ‹¿åˆ°ä¸»é”®å» HBase ä¸­æŸ¥è¯¢ï¼Œå¦‚æœ HBase è¡¨ä¸­å­˜åœ¨è¯¥ä¸»é”®ï¼Œè¯´æ˜å½“å‰æ—¥å¿—å·²ç»è¢«å¤„ç†è¿‡äº†ï¼Œå½“å‰æ—¥å¿—åº”è¯¥è¢«è¿‡æ»¤ã€‚å¦‚æœ HBase è¡¨ä¸­ä¸å­˜åœ¨è¯¥ä¸»é”®ï¼Œè¯´æ˜å½“å‰æ—¥å¿—ä¹‹å‰æ²¡æœ‰è¢«å¤„ç†è¿‡ï¼Œæ­¤æ—¶åº”è¯¥è¢«å¤„ç†ï¼Œä¸”å¤„ç†å®Œæˆåå°†å½“å‰ä¸»é”® Put åˆ° HBase è¡¨ä¸­ã€‚ç”±äºæ•°æ®é‡æ¯”è¾ƒå¤§ï¼Œæ‰€ä»¥ä¸€å®šè¦æå‰å¯¹ HBase è¡¨è¿›è¡Œé¢„åˆ†åŒºï¼Œå°†å‹åŠ›åˆ†æ•£åˆ°å„ä¸ª RegionServer ä¸Šã€‚ ä½¿ç”¨ HBase RowKey å»é‡å¸¦æ¥çš„é—®é¢˜12.2.4 ä½¿ç”¨ Flink çš„ KeyedState å®ç°å»é‡ä¸‹é¢å°±æ•™å¤§å®¶å¦‚ä½•ä½¿ç”¨ Flink çš„ KeyedState å®ç°å»é‡ã€‚ ä½¿ç”¨ Flink çŠ¶æ€æ¥ç»´æŠ¤ Set é›†åˆçš„ä¼˜åŠ¿å¦‚ä½•ä½¿ç”¨ KeyedState ç»´æŠ¤ Set é›†åˆä¼˜åŒ–ä¸»é”®æ¥å‡å°‘çŠ¶æ€å¤§å°ï¼Œä¸”æé«˜ååé‡12.2.5 ä½¿ç”¨ RocksDBStateBackend çš„ä¼˜åŒ–æ–¹æ³•åœ¨ä½¿ç”¨ä¸Šè¿°æ–¹æ¡ˆçš„è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šå‡ºç°ååé‡æ—¶é«˜æ—¶ä½ï¼Œæˆ–è€…ååé‡æ¯”ç¬”è€…çš„æµ‹è¯•æ€§èƒ½è¦ä½ä¸€äº›ï¼Œå½“å‡ºç°è¿™ç±»é—®é¢˜çš„æ—¶å€™ï¼Œå¯ä»¥å°è¯•ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢è¿›è¡Œä¼˜åŒ–ã€‚ è®¾ç½®æœ¬åœ° RocksDB çš„æ•°æ®ç›®å½•Checkpoint å‚æ•°ç›¸å…³é…ç½®RocksDB å‚æ•°ç›¸å…³é…ç½®12.2.6 å°ç»“ä¸åæ€åŠ å…¥çŸ¥è¯†æ˜Ÿçƒå¯ä»¥çœ‹åˆ°ä¸Šé¢æ–‡ç« ï¼šhttps://t.zsxq.com/IeAYbEy","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹â€”â€” åŸºäº Flink å®æ—¶å¤„ç†æµ·é‡æ—¥å¿—","date":"2021-08-18T16:00:00.000Z","path":"2021/08/19/flink-in-action-12.1/","text":"ç¬¬åäºŒç«  â€”â€” Flink æ¡ˆä¾‹æœ¬ç« å°†ä»‹ç» Flink åœ¨å¤šä¸ªåœºæ™¯ä¸‹è½åœ°å®ç°çš„å¤§å‹æ¡ˆä¾‹ï¼Œç¬¬ä¸€ä¸ªæ˜¯å®æ—¶å¤„ç†æµ·é‡çš„æ—¥å¿—ï¼Œå°†ä»æ—¥å¿—çš„æ”¶é›†ã€æ—¥å¿—çš„ä¼ è¾“ã€æ—¥å¿—çš„å®æ—¶æ¸…æ´—å’Œå¼‚å¸¸æ£€æµ‹ã€æ—¥å¿—å­˜å‚¨ã€æ—¥å¿—å±•ç¤ºç­‰æ–¹é¢å»ä»‹ç» Flink åœ¨å…¶ä¸­èµ·çš„ä½œç”¨ï¼Œå¸Œæœ›æ•´ä¸ªæ—¥å¿—å¤„ç†çš„æ¶æ„å¤§å®¶å¯ä»¥çµæ´»çš„è¿ç”¨åœ¨è‡ªå·±çš„å…¬å¸ï¼›ç¬¬äºŒä¸ªæ˜¯ç™¾äº¿æ•°æ®é‡çš„æƒ…å†µä¸‹å¦‚ä½•ä½¿ç”¨ Flink å®æ—¶å»é‡ï¼Œåœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­å°†å¯¹æ¯”ä»‹ç»å…¶ä»–å‡ ç§å¸¸è§çš„å»é‡å®ç°æ–¹æ¡ˆï¼›ç¬¬ä¸‰ä¸ªæ˜¯ Flink åœ¨ç›‘æ§å‘Šè­¦ç³»ç»Ÿä¸­çš„è½åœ°å®ç°ï¼Œåœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­åŒæ ·å¾ˆè¯¦ç»†çš„ä»‹ç»äº†ä¸€ä¸ªç›‘æ§å‘Šè­¦ç³»ç»Ÿçš„å…¨é“¾è·¯ï¼Œæ¯ä¸€ä¸ªå…³èŠ‚éƒ½ä¸å¯æˆ–ç¼ºï¼Œå¹¶ä¸”è¿˜ä»‹ç»äº† Flink åœ¨æœªæ¥ç»“åˆæœºå™¨å­¦ä¹ ç®—æ³•åšä¸€äº› AIOps çš„äº‹æƒ…ã€‚ä¸‰ä¸ªæ¡ˆä¾‹éƒ½æ¯”è¾ƒå…¸å‹ï¼Œå¦‚æœä½ ä¹Ÿåœ¨åšç±»ä¼¼çš„é¡¹ç›®ï¼Œå¸Œæœ›å¯¹ä½ ä»¬çš„æŠ€æœ¯é€‰å‹æœ‰ä¸€å®šçš„å¸®åŠ©ã€‚ 12.1 åŸºäº Flink å®æ—¶å¤„ç†æµ·é‡æ—¥å¿—åœ¨ 11.5 èŠ‚ä¸­è®²è§£äº† Flink å¦‚ä½•å®æ—¶å¤„ç†å¼‚å¸¸çš„æ—¥å¿—ï¼Œå¹¶ä¸”å¯¹æ¯”åˆ†æäº†å‡ ç§å¸¸ç”¨çš„æ—¥å¿—é‡‡é›†å·¥å…·ã€‚æˆ‘ä»¬ä¹ŸçŸ¥é“é€šå¸¸åœ¨æ’æŸ¥çº¿ä¸Šå¼‚å¸¸æ•…éšœçš„æ—¶å€™ï¼Œæ—¥å¿—æ˜¯å¿…ä¸å¯ç¼ºçš„ä¸€éƒ¨åˆ†ï¼Œé€šè¿‡å¼‚å¸¸æ—¥å¿—æˆ‘ä»¬å¯ä»¥å¿«é€Ÿçš„å®šä½åˆ°é—®é¢˜çš„æ ¹å› ã€‚é‚£ä¹ˆé€šå¸¸åœ¨å…¬å¸å¯¹äºæ—¥å¿—å¤„ç†æœ‰å“ªäº›éœ€æ±‚å‘¢ï¼Ÿ 12.1.1 å®æ—¶å¤„ç†æµ·é‡æ—¥å¿—éœ€æ±‚åˆ†æç°åœ¨å…¬å¸éƒ½åœ¨æµè¡Œæ„å»ºåˆ†å¸ƒå¼ã€å¾®æœåŠ¡ã€äº‘åŸç”Ÿçš„æ¶æ„ï¼Œåœ¨è¿™ç±»æ¶æ„ä¸‹ï¼Œé¡¹ç›®åº”ç”¨çš„æ—¥å¿—éƒ½è¢«åˆ†æ•£åˆ°ä¸åŒçš„æœºå™¨ä¸Šï¼Œæ—¥å¿—æŸ¥è¯¢å°±ä¼šæ¯”è¾ƒå›°éš¾ï¼Œæ‰€ä»¥ç»Ÿä¸€çš„æ—¥å¿—æ”¶é›†å‡ ä¹ä¹Ÿæ˜¯æ¯å®¶å…¬å¸å¿…ä¸å¯å°‘çš„ã€‚æ®ç¬”è€…è°ƒç ”ï¼Œä¸å°‘å…¬å¸ç°åœ¨æ˜¯æœ‰æ—¥å¿—ç»Ÿä¸€çš„æ”¶é›†ï¼Œä¹Ÿä¼šå»åšæ—¥å¿—çš„å®æ—¶ ETLï¼Œåˆ©ç”¨ä¸€äº›ä¸»æµçš„æŠ€æœ¯æ¯”å¦‚ ELK å»åšæ—¥å¿—çš„å±•ç¤ºã€æœç´¢å’Œåˆ†æï¼Œä½†æ˜¯å´ç¼ºå°‘äº†æ—¥å¿—çš„å®æ—¶å‘Šè­¦ã€‚æ€»ç»“æ¥è¯´ï¼Œå¤§éƒ¨åˆ†å…¬å¸å¯¹äºæ—¥å¿—è¿™å—çš„ç°çŠ¶æ˜¯ï¼š æ—¥å¿—åˆ†å¸ƒé›¶æ•£ï¼šåˆ†å¸ƒå¼åº”ç”¨å¯¼è‡´æ—¥å¿—åˆ†å¸ƒåœ¨ä¸åŒçš„æœºå™¨ä¸Šï¼Œäººè‚‰ç™»å½•åˆ°æœºå™¨ä¸Šæ“ä½œå¤æ‚ï¼Œéœ€è¦ç»Ÿä¸€çš„æ—¥å¿—æ”¶é›†å·¥å…·ã€‚ å¼‚å¸¸æ—¥å¿—æ— å‘Šè­¦ï¼šå‡ºé”™æ—¶æ— å¼‚å¸¸æ—¥å¿—å‘Šè­¦ï¼Œå¯¼è‡´é”™è¿‡æœ€ä½³å®šä½é—®é¢˜çš„æ—¶æœºï¼Œéœ€è¦å¼‚å¸¸é”™è¯¯æ—¥å¿—çš„å‘Šè­¦ã€‚ æ—¥å¿—æŸ¥çœ‹ä¸å‹å¥½ï¼šç™»å½•æœåŠ¡å™¨ä¸Šåœ¨ç»ˆç«¯æŸ¥çœ‹æ—¥å¿—ä¸å¤ªæ–¹ä¾¿ï¼Œéœ€è¦ä¸€ä¸ªæ“ä½œå‹å¥½çš„é¡µé¢å»æŸ¥çœ‹æ—¥å¿—ã€‚ æ— æ—¥å¿—æœç´¢åˆ†æï¼šå†å²æ—¥å¿—æ–‡ä»¶å¤ªå¤šï¼Œæƒ³æ‰¾æŸç§æ—¥å¿—æ‰¾ä¸åˆ°äº†ï¼Œéœ€è¦ä¸€ä¸ªå¯ä»¥æœç´¢æ—¥å¿—çš„åŠŸèƒ½ã€‚ åœ¨æœ¬èŠ‚ä¸­ï¼Œç¬”è€…å°†ä¸ºå¤§å®¶è®²è§£æ—¥å¿—çš„å…¨é“¾è·¯ï¼ŒåŒ…å«äº†æ—¥å¿—çš„å®æ—¶é‡‡é›†ã€æ—¥å¿—çš„ ETLã€æ—¥å¿—çš„å®æ—¶ç›‘æ§å‘Šè­¦ã€æ—¥å¿—çš„å­˜å‚¨ã€æ—¥å¿—çš„å¯è§†åŒ–å›¾è¡¨å±•ç¤ºä¸æœç´¢åˆ†æç­‰ã€‚ 12.1.2 å®æ—¶å¤„ç†æµ·é‡æ—¥å¿—æ¶æ„è®¾è®¡åˆ†æå®Œæˆ‘ä»¬è¿™ä¸ªæ¡ˆä¾‹çš„éœ€æ±‚åï¼Œæ¥ä¸‹æ¥å¯¹æ•´ä¸ªé¡¹ç›®çš„æ¶æ„åšä¸€ä¸ªåˆç†çš„è®¾è®¡ã€‚ æ•´ä¸ªæ¶æ„åˆ†ä¸ºäº”å±‚ï¼šæ—¥å¿—æ¥å…¥å±‚ã€æ—¥å¿—å‰Šå³°å±‚ã€æ—¥å¿—å¤„ç†å±‚ã€æ—¥å¿—å­˜å‚¨å±‚ã€æ—¥å¿—å±•ç¤ºå±‚ã€‚ æ—¥å¿—æ¥å…¥å±‚ï¼šæ—¥å¿—é‡‡é›†çš„è¯ä½¿ç”¨çš„æ˜¯ Filebeat ç»„ä»¶ï¼Œéœ€è¦åœ¨æ¯å°æœºå™¨ä¸Šéƒ¨ç½²ä¸€ä¸ª Filebeatã€‚ æ—¥å¿—å‰Šå³°å±‚ï¼šé˜²æ­¢æ—¥å¿—æµé‡é«˜å³°ï¼Œä½¿ç”¨ Kafka æ¶ˆæ¯é˜Ÿåˆ—åšå‰Šå³°ã€‚ æ—¥å¿—å¤„ç†å±‚ï¼šFlink ä½œä¸šåŒæ—¶æ¶ˆè´¹ Kafka æ•°æ®åšæ—¥å¿—æ¸…æ´—ã€ETLã€å®æ—¶å‘Šè­¦ã€‚ æ—¥å¿—å­˜å‚¨å±‚ï¼šä½¿ç”¨ ElasticSearch åšæ—¥å¿—çš„å­˜å‚¨ã€‚ æ—¥å¿—å±•ç¤ºå±‚ï¼šä½¿ç”¨ Kibana åšæ—¥å¿—çš„å±•ç¤ºä¸æœç´¢æŸ¥è¯¢ç•Œé¢ã€‚ 12.1.3 æ—¥å¿—å®æ—¶é‡‡é›†åœ¨ 11.5.1 ä¸­å¯¹æ¯”äº†è¿™å‡ ç§æ¯”è¾ƒæµè¡Œçš„æ—¥å¿—é‡‡é›†å·¥å…·ï¼ˆLogstashã€Filebeatã€Fluentdã€Logagentï¼‰ï¼Œä»åŠŸèƒ½å®Œæ•´æ€§ã€æ€§èƒ½ã€æˆæœ¬ã€ä½¿ç”¨éš¾åº¦ç­‰æ–¹é¢ç»¼åˆè€ƒè™‘åï¼Œè¿™é‡Œæ¼”ç¤ºä½¿ç”¨çš„æ˜¯ Filebeatã€‚ å®‰è£… Filebeatåœ¨æœåŠ¡å™¨ä¸Šä¸‹è½½ Fliebeat 6.3.2 å®‰è£…åŒ…ï¼ˆè¯·æ ¹æ®è‡ªå·±æœåŠ¡å™¨å’Œæ‰€éœ€è¦çš„ç‰ˆæœ¬è¿›è¡Œä¸‹è½½ï¼‰ï¼Œä¸‹è½½åè¿›è¡Œè§£å‹ã€‚ 1tar xzf filebeat-6.3.2-linux-x86_64.tar.gz é…ç½® Filebeaté…ç½® Filebeat éœ€è¦ç¼–è¾‘ Filebeat çš„é…ç½®æ–‡ä»¶ filebeat.ymlï¼Œä¸åŒå®‰è£…æ–¹å¼é…ç½®æ–‡ä»¶çš„å­˜æ”¾è·¯å¾„æœ‰ä¸€äº›ä¸åŒï¼Œå¯¹äºè§£å‹åŒ…å®‰è£…çš„æ–¹å¼ï¼Œé…ç½®æ–‡ä»¶å­˜åœ¨è§£å‹ç›®å½•ä¸‹é¢ï¼›å¯¹äº rpm å’Œ deb çš„æ–¹å¼, é…ç½®æ–‡ä»¶è·¯å¾„çš„æ˜¯ /etc/filebeat/filebeat.yml ä¸‹ã€‚ å› ä¸º Filebeat æ˜¯è¦å®æ—¶é‡‡é›†æ—¥å¿—çš„ï¼Œæ‰€ä»¥å¾—è®© Filebeat çŸ¥é“æ—¥å¿—çš„è·¯å¾„æ˜¯åœ¨å“ªé‡Œï¼Œä¸‹é¢åœ¨é…ç½®æ–‡ä»¶ä¸­å®šä¹‰ä¸€ä¸‹æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„ã€‚é€šå¸¸å»ºè®®åœ¨æœåŠ¡å™¨ä¸Šå›ºå®šå­˜æ”¾æ—¥å¿—çš„è·¯å¾„ï¼Œç„¶ååº”ç”¨çš„æ—¥å¿—éƒ½æ‰“åœ¨è¿™ä¸ªå›ºå®šçš„è·¯å¾„ä¸­ï¼Œè¿™æ · Filebeat çš„æ—¥å¿—è·¯å¾„é…ç½®åªéœ€è¦å¡«å†™ä¸€æ¬¡ï¼Œå…¶ä»–æœºå™¨ä¸Šå¯ä»¥æ‹·è´åŒæ ·çš„é…ç½®å°±èƒ½å°† Filebeat è¿è¡Œèµ·æ¥ï¼Œé…ç½®å¦‚ä¸‹ã€‚ 123456- type: log # é…ç½®ä¸º true è¡¨ç¤ºå¼€å¯ enabled: true # æ—¥å¿—çš„è·¯å¾„ paths: - /var/logs/*.log ä¸Šé¢çš„é…ç½®è¡¨ç¤ºå°†å¯¹ /var/logs ç›®å½•ä¸‹æ‰€æœ‰ä»¥ .log ç»“å°¾çš„æ–‡ä»¶è¿›è¡Œé‡‡é›†ï¼Œæ¥ä¸‹æ¥é…ç½®æ—¥å¿—è¾“å‡ºçš„æ–¹å¼ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯ Kafkaï¼Œé…ç½®å¦‚ä¸‹ã€‚ 12345678output.kafka: # å¡«å†™ Kafka åœ°å€ä¿¡æ¯ hosts: [&quot;localhost:9092&quot;] # æ•°æ®å‘åˆ°å“ªä¸ª topic topic: zhisheng-log partition.round_robin: reachable_only: false required_acks: 1 ä¸Šé¢è®²è§£çš„ä¸¤ä¸ªé…ç½®ï¼Œç¬”è€…è¿™é‡Œå°†å®ƒä»¬å†™åœ¨ä¸€ä¸ªæ–°å»ºçš„é…ç½®æ–‡ä»¶ä¸­ kafka.ymlï¼Œç„¶åå¯åŠ¨ Filebeat çš„æ—¶å€™ä½¿ç”¨è¯¥é…ç½®ã€‚ 1234567891011filebeat.inputs:- type: log enabled: true paths: - /var/logs/*.logoutput.kafka: hosts: [\"localhost:9092\"] topic: zhisheng_log partition.round_robin: reachable_only: false required_acks: 1 å¯åŠ¨ Filebeatæ—¥å¿—è·¯å¾„çš„é…ç½®å’Œ Kafka çš„é…ç½®éƒ½å†™å¥½åï¼Œåˆ™æ¥ä¸‹æ¥é€šè¿‡ä¸‹é¢å‘½ä»¤å°† Filebeat å¯åŠ¨ï¼š 1bin/filebeat -e -c kafka.yml æ‰§è¡Œå®Œå‘½ä»¤åå‡ºç°çš„æ—¥å¿—å¦‚ä¸‹åˆ™è¡¨ç¤ºå¯åŠ¨æˆåŠŸäº†ï¼Œå¦å¤–è¿˜å¯ä»¥çœ‹å¾—åˆ°ä¼šåœ¨ç»ˆç«¯æ‰“å°å‡º metrics æ•°æ®å‡ºæ¥ã€‚ éªŒè¯ Filebeat æ˜¯å¦å°†æ—¥å¿—æ•°æ®å‘åˆ° Kafkaé‚£ä¹ˆæ­¤æ—¶å°±å¾—å»æŸ¥çœ‹æ˜¯å¦çœŸæ­£å°±å°†è¿™äº›æ—¥å¿—æ•°æ®å‘åˆ° Kafka äº†å‘¢ï¼Œä½ å¯ä»¥é€šè¿‡ Kafka çš„è‡ªå¸¦å‘½ä»¤å»æ¶ˆè´¹è¿™ä¸ª Topic çœ‹æ˜¯å¦ä¸æ–­æœ‰æ•°æ®å‘å‡ºæ¥ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š 1bin/kafka-console-consumer.sh --zookeeper 106.54.248.27:2181 --topic zhisheng_log --from-beginning å¦‚æœå‡ºç°æ•°æ®åˆ™ä»£è¡¨æ˜¯å·²ç»æœ‰æ•°æ®å‘åˆ° Kafka äº†ï¼Œå¦‚æœä½ ä¸å–œæ¬¢ä½¿ç”¨è¿™ç§æ–¹å¼éªŒè¯ï¼Œå¯ä»¥è‡ªå·±å†™ä¸ª Flink Job å»è¯»å– Kafka è¯¥ Topic çš„æ•°æ®ï¼Œæ¯”å¦‚å†™äº†ä¸ªä½œä¸šè¿è¡Œç»“æœå¦‚ä¸‹å°±ä»£è¡¨ç€æ—¥å¿—æ•°æ®å·²ç»æˆåŠŸå‘é€åˆ° Kafkaã€‚ å‘åˆ° Kafka çš„æ—¥å¿—ç»“æ„æ—¢ç„¶æ•°æ®éƒ½å·²ç»å‘åˆ° Kafka äº†ï¼Œé€šè¿‡æ¶ˆè´¹ Kafka è¯¥ Topic çš„æ•°æ®æˆ‘ä»¬å¯ä»¥å‘ç°è¿™äº›æ•°æ®çš„æ ¼å¼å¦æ˜¯ JSONï¼Œç»“æ„å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031&#123; \"@timestamp\": \"2019-10-26T08:18:18.087Z\", \"@metadata\": &#123; \"beat\": \"filebeat\", \"type\": \"doc\", \"version\": \"6.8.4\", \"topic\": \"zhisheng_log\" &#125;, \"prospector\": &#123; \"type\": \"log\" &#125;, \"input\": &#123; \"type\": \"log\" &#125;, \"beat\": &#123; \"name\": \"VM_0_2_centos\", \"hostname\": \"VM_0_2_centos\", \"version\": \"6.8.4\" &#125;, \"host\": &#123; \"name\": \"VM_0_2_centos\" &#125;, \"source\": \"/var/logs/middleware/kafka.log\", \"offset\": 9460, \"log\": &#123; \"file\": &#123; \"path\": \"/var/logs/middleware/kafka.log\" &#125; &#125;, \"message\": \"2019-10-26 16:18:11 TRACE [Controller id=0] Leader imbalance ratio for broker 0 is 0.0 (kafka.controller.KafkaController)\"&#125; è¿™ä¸ªæ—¥å¿—ç»“æ„é‡Œé¢åŒ…å«äº†å¾ˆå¤šå­—æ®µï¼Œæ¯”å¦‚ timestampã€metadataã€hostã€sourceã€message ç­‰ï¼Œä½†æ˜¯å…¶ä¸­æŸäº›å­—æ®µæˆ‘ä»¬å…¶å®æ ¹æœ¬ä¸éœ€è¦çš„ï¼Œä½ å¯ä»¥æ ¹æ®å…¬å¸çš„éœ€æ±‚ä¸¢å¼ƒä¸€äº›å­—æ®µï¼ŒæŠŠè¦ä¸¢å¼ƒçš„å­—æ®µä¹Ÿé…ç½®åœ¨ kafka.yml ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚ 123processors:- drop_fields: fields: [&quot;prospector&quot;,&quot;input&quot;,&quot;beat&quot;,&quot;log&quot;,&quot;offset&quot;,&quot;@metadata&quot;] ç„¶åå†æ¬¡å¯åŠ¨ Filebeat ï¼Œå‘ç°ä¸Šé¢é…ç½®çš„å­—æ®µåœ¨æ–°çš„æ•°æ®ä¸­æ²¡æœ‰äº†ï¼ˆé™¤ @metadata ä¹‹å¤–ï¼‰ï¼Œå¦å¤–ç»ç¬”è€…éªŒè¯ï¼šä¸ä»… @metadata å­—æ®µä¸èƒ½ä¸¢å¼ƒï¼Œå¦‚æœ @timestamp è¿™ä¸ªå­—æ®µåœ¨ drop_fields ä¸­é…ç½®äº†ï¼Œä¹Ÿæ˜¯ä¸èµ·ä½œç”¨çš„ï¼Œå®ƒä»¬ä¸¤ä¸å…è®¸ä¸¢å¼ƒã€‚é€šå¸¸æ¥è¯´ä¸€è¡Œæ—¥å¿—å·²ç»å¤Ÿé•¿äº†ï¼Œå†åŠ ä¸Šè¿™ä¹ˆå¤šæˆ‘ä»¬ä¸éœ€è¦çš„å­—æ®µï¼Œå°±ä¼šå¢åŠ æ•°æ®çš„å¤§å°ï¼Œå¯¹äºç”Ÿäº§ç¯å¢ƒçš„è¯ï¼Œæ—¥å¿—æ•°æ®é‡éå¸¸å¤§ï¼Œé‚£æ— ç–‘ä¼šå¯¹åé¢æ‰€æœ‰çš„é“¾è·¯éƒ½ä¼šé€ æˆä¸€å®šçš„å½±å“ï¼Œæ‰€ä»¥ä¸€å®šè¦åœ¨åº•å±‚æ•°æ®æºå¤´åšå¥½ç²¾ç®€ã€‚å¦å¤–è¿˜å¯ä»¥åœ¨å‘é€ Kafka çš„æ—¶å€™å¯¹æ•°æ®è¿›è¡Œå‹ç¼©ï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®ä¸€ä¸ª compression: gzipã€‚ç²¾ç®€åçš„æ—¥å¿—æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š 1234567891011121314&#123; \"@timestamp\": \"2019-10-26T09:23:16.848Z\", \"@metadata\": &#123; \"beat\": \"filebeat\", \"type\": \"doc\", \"version\": \"6.8.4\", \"topic\": \"zhisheng_log\" &#125;, \"host\": &#123; \"name\": \"VM_0_2_centos\" &#125;, \"source\": \"/var/logs/middleware/kafka.log\", \"message\": \"2019-10-26 17:23:11 TRACE [Controller id=0] Leader imbalance ratio for broker 0 is 0.0 (kafka.controller.KafkaController)\"&#125; 12.1.4 æ—¥å¿—æ ¼å¼ç»Ÿä¸€å› ä¸º Filebeat æ˜¯åœ¨æœºå™¨ä¸Šé‡‡é›†çš„æ—¥å¿—ï¼Œè¿™äº›æ—¥å¿—çš„ç§ç±»æ¯”è¾ƒå¤šï¼Œå¸¸è§çš„æœ‰åº”ç”¨ç¨‹åºçš„è¿è¡Œæ—¥å¿—ã€ä½œä¸šæ„å»ºç¼–è¯‘æ‰“åŒ…çš„æ—¥å¿—ã€ä¸­é—´ä»¶æœåŠ¡è¿è¡Œçš„æ—¥å¿—ç­‰ã€‚é€šå¸¸åœ¨å…¬å¸æ˜¯å¯ä»¥ç»™å¼€å‘çº¦å®šæ—¥å¿—æ‰“å°çš„è§„åˆ™ï¼Œä½†æ˜¯åƒä¸­é—´ä»¶è¿™ç±»æœåŠ¡çš„æ—¥å¿—æ˜¯ä¸å›ºå®šçš„ï¼Œå¦‚æœå°† Kafka ä¸­çš„æ¶ˆæ¯ç›´æ¥å­˜å‚¨åˆ° ElasticSearch çš„è¯ï¼Œåé¢å¦‚æœè¦åšåŒºåˆ†ç­›é€‰çš„è¯å¯èƒ½ä¼šæœ‰é—®é¢˜ã€‚ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¾—åœ¨æ—¥å¿—å­˜å…¥ ElasticSearch ä¹‹å‰åšä¸€ä¸ªæ•°æ®æ ¼å¼åŒ–å’Œæ¸…æ´—çš„å·¥ä½œï¼Œå› ä¸º Flink å¤„ç†æ•°æ®çš„é€Ÿåº¦æ¯”è¾ƒå¥½ï¼Œè€Œä¸”å¯ä»¥åšåˆ°å®æ—¶ï¼Œæ‰€ä»¥é€‰æ‹©åœ¨ Flink Job ä¸­å®Œæˆè¯¥å·¥ä½œã€‚ åœ¨è¯¥ä½œä¸šä¸­çš„è¦å°† message è§£æï¼Œä¸€èˆ¬è¯¥è¡Œæ—¥å¿—ä¿¡æ¯ä¼šåŒ…å«å¾ˆå¤šä¿¡æ¯ï¼Œæ¯”å¦‚æ—¥å¿—æ‰“å°æ—¶é—´ã€æ—¥å¿—çº§åˆ«ã€åº”ç”¨åã€å”¯ä¸€æ€§ IDï¼ˆç”¨æ¥å…³è”å„ä¸ªè¯·æ±‚ï¼‰ã€è¯·æ±‚ä¸Šä¸‹æ–‡ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦ä¸€ä¸ªæ–°çš„æ—¥å¿—ç»“æ„å¯¹è±¡æ¥ç»Ÿä¸€æ—¥å¿—çš„æ ¼å¼ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š 12.1.5 æ—¥å¿—å®æ—¶æ¸…æ´—12.1.6 æ—¥å¿—å®æ—¶å‘Šè­¦12.1.7 æ—¥å¿—å®æ—¶å­˜å‚¨12.1.8 æ—¥å¿—å®æ—¶å±•ç¤º12.1.9 å°ç»“ä¸åæ€åŠ å…¥çŸ¥è¯†æ˜Ÿçƒå¯ä»¥çœ‹åˆ°ä¸Šé¢æ–‡ç« ï¼šhttps://t.zsxq.com/IeAYbEy","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹â€”â€” å¦‚ä½•å®æ—¶å°†åº”ç”¨ Error æ—¥å¿—å‘Šè­¦ï¼Ÿ","date":"2021-08-17T16:00:00.000Z","path":"2021/08/18/flink-in-action-11.5/","text":"11.5 å¦‚ä½•å®æ—¶å°†åº”ç”¨ Error æ—¥å¿—å‘Šè­¦ï¼Ÿå¤§æ•°æ®æ—¶ä»£ï¼Œéšç€å…¬å¸ä¸šåŠ¡ä¸æ–­çš„å¢é•¿ï¼Œæ•°æ®é‡è‡ªç„¶ä¹Ÿä¼šè·Ÿç€ä¸æ–­çš„å¢é•¿ï¼Œé‚£ä¹ˆä¸šåŠ¡åº”ç”¨å’Œé›†ç¾¤æœåŠ¡å™¨çš„çš„è§„æ¨¡ä¹Ÿä¼šé€æ¸æ‰©å¤§ï¼Œå‡ ç™¾å°æœåŠ¡å™¨åœ¨ä¸€èˆ¬çš„å…¬å¸å·²ç»æ˜¯å¾ˆå¸¸è§çš„äº†ã€‚é‚£ä¹ˆå°†åº”ç”¨æœåŠ¡éƒ¨ç½²åœ¨å¦‚æ­¤å¤šçš„æœåŠ¡å™¨ä¸Šï¼Œå¯¹å¼€å‘å’Œè¿ç»´äººå‘˜æ¥è¯´éƒ½æ˜¯ä¸€ä¸ªæŒ‘æˆ˜ã€‚ä¸€ä¸ªä¼˜ç§€çš„ç³»ç»Ÿè¿ç»´å¹³å°æ˜¯éœ€è¦å°†éƒ¨ç½²åœ¨è¿™ä¹ˆå¤šæœåŠ¡å™¨ä¸Šçš„åº”ç”¨ç›‘æ§ä¿¡æ¯æ±‡æ€»æˆä¸€ä¸ªç»Ÿä¸€çš„æ•°æ®å±•ç¤ºå¹³å°ï¼Œæ–¹ä¾¿è¿ç»´äººå‘˜åšæ—¥å¸¸çš„ç›‘æµ‹ã€æå‡è¿ç»´æ•ˆç‡ï¼Œè¿˜å¯ä»¥åŠæ—¶åé¦ˆåº”ç”¨çš„è¿è¡ŒçŠ¶æ€ç»™åº”ç”¨å¼€å‘äººå‘˜ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œåº”ç”¨çš„è¿è¡Œæ—¥å¿—éœ€è¦æŒ‰ç…§æ—¶é—´æ’åºåšä¸€ä¸ªå±•ç¤ºï¼Œå¹¶ä¸”æä¾›æ—¥å¿—ä¸‹è½½å’Œæ—¥å¿—æœç´¢ç­‰æœåŠ¡ï¼Œè¿™æ ·å¦‚æœåº”ç”¨å‡ºç°é—®é¢˜å¼€å‘äººå‘˜é¦–å…ˆå¯ä»¥æ ¹æ®åº”ç”¨æ—¥å¿—çš„é”™è¯¯ä¿¡æ¯è¿›è¡Œé—®é¢˜çš„æ’æŸ¥ã€‚é‚£ä¹ˆè¯¥å¦‚ä½•å®æ—¶çš„å°†åº”ç”¨çš„ Error æ—¥å¿—æ¨é€ç»™åº”ç”¨å¼€å‘äººå‘˜å‘¢ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†è®²è§£æ—¥å¿—çš„å¤„ç†æ–¹æ¡ˆã€‚ 11.5.1 æ—¥å¿—å¤„ç†æ–¹æ¡ˆçš„æ¼”è¿›æ—¥å¿—å¤„ç†çš„æ–¹æ¡ˆä¹Ÿæ˜¯æœ‰ä¸€ä¸ªæ¼”è¿›çš„è¿‡ç¨‹ï¼Œè¦æƒ³å¼„æ¸…æ¥šæ•´ä¸ªè¿‡ç¨‹ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹æ—¥å¿—çš„ä»‹ç»ã€‚ ä»€ä¹ˆæ˜¯æ—¥å¿—ï¼Ÿæ—¥å¿—æ˜¯å¸¦æ—¶é—´æˆ³çš„åŸºäºæ—¶é—´åºåˆ—çš„æ•°æ®ï¼Œå®ƒå¯ä»¥åæ˜ ç³»ç»Ÿçš„è¿è¡ŒçŠ¶æ€ï¼ŒåŒ…æ‹¬äº†ä¸€äº›æ ‡è¯†ä¿¡æ¯ï¼ˆåº”ç”¨æ‰€åœ¨æœåŠ¡å™¨é›†ç¾¤åã€é›†ç¾¤æœºå™¨ IPã€æœºå™¨è®¾å¤‡ç³»ç»Ÿä¿¡æ¯ã€åº”ç”¨åã€åº”ç”¨ IDã€åº”ç”¨æ‰€å±é¡¹ç›®ç­‰ï¼‰ æ—¥å¿—å¤„ç†æ–¹æ¡ˆæ¼”è¿›æ—¥å¿—å¤„ç†æ–¹æ¡ˆçš„æ¼”è¿›è¿‡ç¨‹ï¼š æ—¥å¿—å¤„ç† v1.0: åº”ç”¨æ—¥å¿—åˆ†å¸ƒåœ¨å¾ˆå¤šæœºå™¨ä¸Šï¼Œéœ€è¦äººè‚‰æ‰‹åŠ¨å»æœºå™¨æŸ¥çœ‹æ—¥å¿—ä¿¡æ¯ã€‚ æ—¥å¿—å¤„ç† v2.0: åˆ©ç”¨ç¦»çº¿è®¡ç®—å¼•æ“ç»Ÿä¸€çš„å°†æ—¥å¿—æ”¶é›†ï¼Œå½¢æˆä¸€ä¸ªæ—¥å¿—æœç´¢åˆ†æå¹³å°ï¼Œæä¾›æœç´¢è®©ç”¨æˆ·æ ¹æ®å…³é”®å­—è¿›è¡Œæœç´¢å’Œåˆ†æï¼Œç¼ºç‚¹å°±æ˜¯åŠæ—¶æ€§æ¯”è¾ƒå·®ã€‚ æ—¥å¿—å¤„ç† v3.0: åˆ©ç”¨ Agent å®æ—¶çš„é‡‡é›†éƒ¨ç½²åœ¨æ¯å°æœºå™¨ä¸Šçš„æ—¥å¿—ï¼Œç„¶åç»Ÿä¸€å‘åˆ°æ—¥å¿—æ”¶é›†å¹³å°åšæ±‡æ€»ï¼Œå¹¶æä¾›å®æ—¶æ—¥å¿—åˆ†æå’Œæœç´¢çš„åŠŸèƒ½ï¼Œè¿™æ ·ä»æ—¥å¿—äº§ç”Ÿåˆ°æœç´¢åˆ†æå‡ºç»“æœåªæœ‰ç®€çŸ­çš„å»¶è¿Ÿï¼ˆåœ¨ç”¨æˆ·å®¹å¿æ—¶é—´èŒƒå›´ä¹‹å†…ï¼‰ï¼Œä¼˜ç‚¹æ˜¯å¿«ï¼Œä½†æ˜¯æ—¥å¿—æ•°æ®é‡å¤§çš„æƒ…å†µä¸‹å¸¦æ¥çš„æŒ‘æˆ˜ä¹Ÿå¤§ã€‚ 11.5.2 æ—¥å¿—é‡‡é›†å·¥å…·å¯¹æ¯”ä¸Šé¢æåˆ°çš„æ—¥å¿—é‡‡é›†ï¼Œå…¶å®ç°åœ¨å·²ç»æœ‰å¾ˆå¤šå¼€æºçš„ç»„ä»¶æ”¯æŒå»é‡‡é›†æ—¥å¿—ï¼Œæ¯”å¦‚ Logstashã€Filebeatã€Fluentdã€Logagent ç­‰ï¼Œè¿™é‡Œç®€å•åšä¸ªå¯¹æ¯”ã€‚ LogstashLogstash æ˜¯ä¸€ä¸ªå¼€æºæ•°æ®æ”¶é›†å¼•æ“ï¼Œå…·æœ‰å®æ—¶ç®¡é“åŠŸèƒ½ã€‚Logstash å¯ä»¥åŠ¨æ€åœ°å°†æ¥è‡ªä¸åŒæ•°æ®æºçš„æ•°æ®ç»Ÿä¸€èµ·æ¥ï¼Œå¹¶å°†æ•°æ®æ ‡å‡†åŒ–åˆ°ä½ æ‰€é€‰æ‹©çš„ç›®çš„åœ°ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒLogstash å°†é‡‡é›†åˆ°çš„æ•°æ®ç”¨ä½œåˆ†æã€ç›‘æ§ã€å‘Šè­¦ç­‰ã€‚ ä¼˜åŠ¿ï¼šLogstash ä¸»è¦çš„ä¼˜ç‚¹å°±æ˜¯å®ƒçš„çµæ´»æ€§ï¼Œå®ƒæä¾›å¾ˆå¤šæ’ä»¶ï¼Œè¯¦ç»†çš„æ–‡æ¡£ä»¥åŠç›´ç™½çš„é…ç½®æ ¼å¼è®©å®ƒå¯ä»¥åœ¨å¤šç§åœºæ™¯ä¸‹åº”ç”¨ã€‚è€Œä¸”ç°åœ¨ ELK æ•´ä¸ªæŠ€æœ¯æ ˆåœ¨å¾ˆå¤šå…¬å¸åº”ç”¨çš„æ¯”è¾ƒå¤šï¼Œæ‰€ä»¥åŸºæœ¬ä¸Šå¯ä»¥åœ¨å¾€ä¸Šæ‰¾åˆ°å¾ˆå¤šç›¸å…³çš„å­¦ä¹ èµ„æºã€‚ åŠ£åŠ¿ï¼šLogstash è‡´å‘½çš„é—®é¢˜æ˜¯å®ƒçš„æ€§èƒ½ä»¥åŠèµ„æºæ¶ˆè€—(é»˜è®¤çš„å †å¤§å°æ˜¯ 1GB)ã€‚å°½ç®¡å®ƒçš„æ€§èƒ½åœ¨è¿‘å‡ å¹´å·²ç»æœ‰å¾ˆå¤§æå‡ï¼Œä¸å®ƒçš„æ›¿ä»£è€…ä»¬ç›¸æ¯”è¿˜æ˜¯è¦æ…¢å¾ˆå¤šçš„ï¼Œå®ƒåœ¨å¤§æ•°æ®é‡çš„æƒ…å†µä¸‹ä¼šæ˜¯ä¸ªé—®é¢˜ã€‚å¦ä¸€ä¸ªé—®é¢˜æ˜¯å®ƒç›®å‰ä¸æ”¯æŒç¼“å­˜ï¼Œç›®å‰çš„å…¸å‹æ›¿ä»£æ–¹æ¡ˆæ˜¯å°† Redis æˆ– Kafka ä½œä¸ºä¸­å¿ƒç¼“å†²æ± ï¼š Filebeatä½œä¸º Beats å®¶æ—çš„ä¸€å‘˜ï¼ŒFilebeat æ˜¯ä¸€ä¸ªè½»é‡çº§çš„æ—¥å¿—ä¼ è¾“å·¥å…·ï¼Œå®ƒçš„å­˜åœ¨æ­£å¼¥è¡¥äº† Logstash çš„ç¼ºç‚¹ï¼ŒFilebeat ä½œä¸ºä¸€ä¸ªè½»é‡çº§çš„æ—¥å¿—ä¼ è¾“å·¥å…·å¯ä»¥å°†æ—¥å¿—æ¨é€åˆ° Kafkaã€Logstashã€ElasticSearchã€Redisã€‚å®ƒçš„å¤„ç†æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä¼˜åŠ¿ï¼šFilebeat åªæ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶æ²¡æœ‰ä»»ä½•ä¾èµ–ã€‚å®ƒå ç”¨èµ„æºæå°‘ï¼Œå°½ç®¡å®ƒè¿˜ååˆ†å¹´è½»ï¼Œæ­£å¼å› ä¸ºå®ƒç®€å•ï¼Œæ‰€ä»¥å‡ ä¹æ²¡æœ‰ä»€ä¹ˆå¯ä»¥å‡ºé”™çš„åœ°æ–¹ï¼Œæ‰€ä»¥å®ƒçš„å¯é æ€§è¿˜æ˜¯å¾ˆé«˜çš„ã€‚å®ƒä¹Ÿä¸ºæˆ‘ä»¬æä¾›äº†å¾ˆå¤šå¯ä»¥è°ƒèŠ‚çš„ç‚¹ï¼Œä¾‹å¦‚ï¼šå®ƒä»¥ä½•ç§æ–¹å¼æœç´¢æ–°çš„æ–‡ä»¶ï¼Œä»¥åŠå½“æ–‡ä»¶æœ‰ä¸€æ®µæ—¶é—´æ²¡æœ‰å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä½•æ—¶é€‰æ‹©å…³é—­æ–‡ä»¶å¥æŸ„ã€‚ åŠ£åŠ¿ï¼šFilebeat çš„åº”ç”¨èŒƒå›´ååˆ†æœ‰é™ï¼Œæ‰€ä»¥åœ¨æŸäº›åœºæ™¯ä¸‹æˆ‘ä»¬ä¼šç¢°åˆ°é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½¿ç”¨ Logstash ä½œä¸ºä¸‹æ¸¸ç®¡é“ï¼Œæˆ‘ä»¬åŒæ ·ä¼šé‡åˆ°æ€§èƒ½é—®é¢˜ã€‚æ­£å› ä¸ºå¦‚æ­¤ï¼ŒFilebeat çš„èŒƒå›´åœ¨æ‰©å¤§ã€‚å¼€å§‹æ—¶ï¼Œå®ƒåªèƒ½å°†æ—¥å¿—å‘é€åˆ° Logstash å’Œ Elasticsearchï¼Œè€Œç°åœ¨å®ƒå¯ä»¥å°†æ—¥å¿—å‘é€ç»™ Kafka å’Œ Redisï¼Œåœ¨ 5.x ç‰ˆæœ¬ä¸­ï¼Œå®ƒè¿˜å…·å¤‡è¿‡æ»¤çš„èƒ½åŠ›ã€‚ FluentdFluentd åˆ›å»ºçš„åˆè¡·ä¸»è¦æ˜¯å°½å¯èƒ½çš„ä½¿ç”¨ JSON ä½œä¸ºæ—¥å¿—è¾“å‡ºï¼Œæ‰€ä»¥ä¼ è¾“å·¥å…·åŠå…¶ä¸‹æ¸¸çš„ä¼ è¾“çº¿ä¸éœ€è¦çŒœæµ‹å­å­—ç¬¦ä¸²é‡Œé¢å„ä¸ªå­—æ®µçš„ç±»å‹ã€‚è¿™æ ·å®ƒä¸ºå‡ ä¹æ‰€æœ‰çš„è¯­è¨€éƒ½æä¾›åº“ï¼Œè¿™ä¹Ÿæ„å‘³ç€å¯ä»¥å°†å®ƒæ’å…¥åˆ°è‡ªå®šä¹‰çš„ç¨‹åºä¸­ã€‚å®ƒçš„å¤„ç†æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä¼˜åŠ¿ï¼šå’Œå¤šæ•° Logstash æ’ä»¶ä¸€æ ·ï¼ŒFluentd æ’ä»¶æ˜¯ç”¨ Ruby è¯­è¨€å¼€å‘çš„éå¸¸æ˜“äºç¼–å†™ç»´æŠ¤ã€‚æ‰€ä»¥å®ƒæ•°é‡å¾ˆå¤šï¼Œå‡ ä¹æ‰€æœ‰çš„æºå’Œç›®æ ‡å­˜å‚¨éƒ½æœ‰æ’ä»¶(å„ä¸ªæ’ä»¶çš„æˆç†Ÿåº¦ä¹Ÿä¸å¤ªä¸€æ ·)ã€‚è¿™ä¹Ÿæ„å‘³è¿™å¯ä»¥ç”¨ Fluentd æ¥ä¸²è”æ‰€æœ‰çš„ä¸œè¥¿ã€‚ åŠ£åŠ¿ï¼šå› ä¸ºåœ¨å¤šæ•°åº”ç”¨åœºæ™¯ä¸‹å¾—åˆ° Fluentd ç»“æ„åŒ–çš„æ•°æ®ï¼Œå®ƒçš„çµæ´»æ€§å¹¶ä¸å¥½ã€‚ä½†æ˜¯ä»ç„¶å¯ä»¥é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼æ¥è§£æéç»“æ„åŒ–çš„æ•°æ®ã€‚å°½ç®¡æ€§èƒ½åœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹éƒ½å¾ˆå¥½ï¼Œä½†å®ƒå¹¶ä¸æ˜¯æœ€å¥½çš„ï¼Œå®ƒçš„ç¼“å†²åªå­˜åœ¨ä¸è¾“å‡ºç«¯ï¼Œå•çº¿ç¨‹æ ¸å¿ƒä»¥åŠ Ruby GIL å®ç°çš„æ’ä»¶æ„å‘³ç€å®ƒå¤§çš„èŠ‚ç‚¹ä¸‹æ€§èƒ½æ˜¯å—é™çš„ã€‚ LogagentLogagent æ˜¯ Sematext æä¾›çš„ä¼ è¾“å·¥å…·ï¼Œå®ƒç”¨æ¥å°†æ—¥å¿—ä¼ è¾“åˆ° Logsene(ä¸€ä¸ªåŸºäº SaaS å¹³å°çš„ Elasticsearch API)ï¼Œå› ä¸º Logsene ä¼šæš´éœ² Elasticsearch APIï¼Œæ‰€ä»¥ Logagent å¯ä»¥å¾ˆå®¹æ˜“å°†æ•°æ®æ¨é€åˆ° Elasticsearch ã€‚ ä¼˜åŠ¿ï¼šå¯ä»¥è·å– /var/log ä¸‹çš„æ‰€æœ‰ä¿¡æ¯ï¼Œè§£æå„ç§æ ¼å¼çš„æ—¥å¿—ï¼Œå¯ä»¥æ©ç›–æ•æ„Ÿçš„æ•°æ®ä¿¡æ¯ã€‚å®ƒè¿˜å¯ä»¥åŸºäº IP åš GeoIP ä¸°å¯Œåœ°ç†ä½ç½®ä¿¡æ¯ã€‚åŒæ ·ï¼Œå®ƒè½»é‡åˆå¿«é€Ÿï¼Œå¯ä»¥å°†å…¶ç½®å…¥ä»»ä½•æ—¥å¿—å—ä¸­ã€‚Logagent æœ‰æœ¬åœ°ç¼“å†²ï¼Œæ‰€ä»¥åœ¨æ•°æ®ä¼ è¾“ç›®çš„åœ°ä¸å¯ç”¨æ—¶ä¸ä¼šä¸¢å¤±æ—¥å¿—ã€‚ åŠ£åŠ¿ï¼šæ²¡æœ‰ Logstash çµæ´»ã€‚ 11.5.3 æ—¥å¿—ç»“æ„è®¾è®¡å‰é¢ä»‹ç»äº†æ—¥å¿—å’Œå¯¹æ¯”äº†å¸¸ç”¨æ—¥å¿—é‡‡é›†å·¥å…·çš„ä¼˜åŠ¿å’ŒåŠ£åŠ¿ï¼Œé€šå¸¸åœ¨ä¸åŒç¯å¢ƒï¼Œä¸åŒæœºå™¨ä¸Šéƒ½ä¼šéƒ¨ç½²æ—¥å¿—é‡‡é›†å·¥å…·ï¼Œç„¶åé‡‡é›†å·¥å…·ä¼šå®æ—¶çš„å°†æ–°çš„æ—¥å¿—é‡‡é›†å‘é€åˆ°ä¸‹æ¸¸ï¼Œå› ä¸ºæ—¥å¿—æ•°æ®é‡æ¯•ç«Ÿå¤§ï¼Œæ‰€ä»¥å»ºè®®å‘åˆ° MQ ä¸­ï¼Œæ¯”å¦‚ Kafkaï¼Œè¿™æ ·å†æƒ³æ€ä¹ˆå¤„ç†è¿™äº›æ—¥å¿—å°±ä¼šæ¯”è¾ƒçµæ´»ã€‚å‡è®¾æˆ‘ä»¬å¿½ç•¥åº•å±‚é‡‡é›†å…·ä½“æ˜¯å“ªç§ï¼Œä½†æ˜¯è§„å®šé‡‡é›†å¥½çš„æ—¥å¿—ç»“æ„åŒ–æ•°æ®å¦‚ä¸‹ï¼š 12345678public class LogEvent &#123; private String type;//æ—¥å¿—çš„ç±»å‹(åº”ç”¨ã€å®¹å™¨ã€...) private Long timestamp;//æ—¥å¿—çš„æ—¶é—´æˆ³ private String level;//æ—¥å¿—çš„çº§åˆ«(debug/info/warn/error) private String message;//æ—¥å¿—å†…å®¹ //æ—¥å¿—çš„æ ‡è¯†(åº”ç”¨ IDã€åº”ç”¨åã€å®¹å™¨ IDã€æœºå™¨ IPã€é›†ç¾¤åã€...) private Map&lt;String, String&gt; tags = new HashMap&lt;&gt;();&#125; ç„¶åä¸Šé¢è¿™ç§ LogEvent çš„æ•°æ®ï¼ˆå‡è®¾é‡‡é›†å‘ä¸Šæ¥çš„æ˜¯è¿™ç§ç»“æ„æ•°æ®çš„ JSON ä¸²ï¼Œæ‰€ä»¥éœ€è¦åœ¨ Flink ä¸­åšä¸€ä¸ªååºåˆ—åŒ–è§£æï¼‰å°±ä¼šå¾€ Kafka ä¸æ–­çš„å‘é€æ•°æ®ï¼Œæ ·ä¾‹æ•°æ®å¦‚ä¸‹ï¼š 123456789101112&#123; \"type\": \"app\", \"timestamp\": 1570941591229, \"level\": \"error\", \"message\": \"Exception in thread \\\"main\\\" java.lang.NoClassDefFoundError: org/apache/flink/api/common/ExecutionConfig$GlobalJobParameters\", \"tags\": &#123; \"cluster_name\": \"zhisheng\", \"app_name\": \"zhisheng\", \"host_ip\": \"127.0.0.1\", \"app_id\": \"21\" &#125;&#125; é‚£ä¹ˆåœ¨ Flink ä¸­å¦‚ä½•å°†åº”ç”¨å¼‚å¸¸æˆ–è€…é”™è¯¯çš„æ—¥å¿—åšå®æ—¶å‘Šè­¦å‘¢ï¼Ÿ 11.5.4 å¼‚å¸¸æ—¥å¿—å®æ—¶å‘Šè­¦é¡¹ç›®æ¶æ„æ•´ä¸ªå¼‚å¸¸æ—¥å¿—å®æ—¶å‘Šè­¦é¡¹ç›®çš„æ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ åº”ç”¨æ—¥å¿—æ•£åˆ—åœ¨ä¸åŒçš„æœºå™¨ï¼Œç„¶åæ¯å°æœºå™¨éƒ½æœ‰éƒ¨ç½²é‡‡é›†æ—¥å¿—çš„ Agentï¼ˆå¯ä»¥æ˜¯ä¸Šé¢çš„ Filebeatã€Logstash ç­‰ï¼‰ï¼Œè¿™äº› Agent ä¼šå®æ—¶çš„å°†åˆ†æ•£åœ¨ä¸åŒæœºå™¨ã€ä¸åŒç¯å¢ƒçš„åº”ç”¨æ—¥å¿—ç»Ÿä¸€çš„é‡‡é›†å‘åˆ° Kafka é›†ç¾¤ä¸­ï¼Œç„¶åå‘Šè­¦è¿™è¾¹æ˜¯æœ‰ä¸€ä¸ª Flink ä½œä¸šå»å®æ—¶çš„æ¶ˆè´¹ Kafka æ•°æ®åšä¸€ä¸ªå¼‚å¸¸å‘Šè­¦è®¡ç®—å¤„ç†ã€‚å¦‚æœè¿˜æƒ³åšæ—¥å¿—çš„æœç´¢åˆ†æï¼Œå¯ä»¥èµ·å¦å¤–ä¸€ä¸ªä½œä¸šå»å®æ—¶çš„å°† Kafka çš„æ—¥å¿—æ•°æ®å†™å…¥è¿› ElasticSearchï¼Œå†é€šè¿‡ Kibana é¡µé¢åšæœç´¢å’Œåˆ†æã€‚ 11.5.5 æ—¥å¿—æ•°æ®å‘é€åˆ° Kafkaä¸Šé¢å·²ç»è®²äº†æ—¥å¿—æ•°æ® LogEvent çš„ç»“æ„å’Œæ ·ä¾‹æ•°æ®ï¼Œå› ä¸ºè¦åœ¨æœåŠ¡å™¨éƒ¨ç½²é‡‡é›†å·¥å…·å»é‡‡é›†åº”ç”¨æ—¥å¿—æ•°æ®å¯¹äºæœ¬åœ°æµ‹è¯•æ¥è¯´å¯èƒ½ç¨å¾®å¤æ‚ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œå°±åªé€šè¿‡ä»£ç æ¨¡æ‹Ÿæ„é€ æ•°æ®å‘åˆ° Kafka å»ï¼Œç„¶ååœ¨ Flink ä½œä¸šä¸­å»å®æ—¶æ¶ˆè´¹ Kafka ä¸­çš„æ•°æ®ï¼Œä¸‹é¢æ¼”ç¤ºæ„é€ æ—¥å¿—æ•°æ®å‘åˆ° Kafka çš„å·¥å…·ç±»ï¼Œè¿™ä¸ªå·¥å…·ç±»ä¸»è¦åˆ†ä¸¤å—ï¼Œæ„é€  LogEvent æ•°æ®å’Œå‘é€åˆ° Kafkaã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384@Slf4jpublic class BuildLogEventDataUtil &#123; //Kafka broker å’Œ topic ä¿¡æ¯ public static final String BROKER_LIST = \"localhost:9092\"; public static final String LOG_TOPIC = \"zhisheng_log\"; public static void writeDataToKafka() &#123; Properties props = new Properties(); props.put(\"bootstrap.servers\", BROKER_LIST); props.put(\"key.serializer\", \"org.apache.kafka.common.serialization.StringSerializer\"); props.put(\"value.serializer\", \"org.apache.kafka.common.serialization.StringSerializer\"); KafkaProducer producer = new KafkaProducer&lt;String, String&gt;(props); for (int i = 0; i &lt; 10000; i++) &#123; //æ¨¡æ‹Ÿæ„é€  LogEvent å¯¹è±¡ LogEvent logEvent = new LogEvent().builder() .type(\"app\") .timestamp(System.currentTimeMillis()) .level(logLevel()) .message(message(i + 1)) .tags(mapData()) .build();// System.out.println(logEvent); ProducerRecord record = new ProducerRecord&lt;String, String&gt;(LOG_TOPIC, null, null, GsonUtil.toJson(logEvent)); producer.send(record); &#125; producer.flush(); &#125; public static void main(String[] args) &#123; writeDataToKafka(); &#125; public static String message(int i) &#123; return \"è¿™æ˜¯ç¬¬ \" + i + \" è¡Œæ—¥å¿—ï¼\"; &#125; public static String logLevel() &#123; Random random = new Random(); int number = random.nextInt(4); switch (number) &#123; case 0: return \"debug\"; case 1: return \"info\"; case 2: return \"warn\"; case 3: return \"error\"; default: return \"info\"; &#125; &#125; public static String hostIp() &#123; Random random = new Random(); int number = random.nextInt(4); switch (number) &#123; case 0: return \"121.12.17.10\"; case 1: return \"121.12.17.11\"; case 2: return \"121.12.17.12\"; case 3: return \"121.12.17.13\"; default: return \"121.12.17.10\"; &#125; &#125; public static Map&lt;String, String&gt; mapData() &#123; Map&lt;String, String&gt; map = new HashMap&lt;&gt;(); map.put(\"app_id\", \"11\"); map.put(\"app_name\", \"zhisheng\"); map.put(\"cluster_name\", \"zhisheng\"); map.put(\"host_ip\", hostIp()); map.put(\"class\", \"BuildLogEventDataUtil\"); map.put(\"method\", \"main\"); map.put(\"line\", String.valueOf(new Random().nextInt(100))); //add more tag return map; &#125;&#125; å¦‚æœä¹‹å‰ Kafka ä¸­æ²¡æœ‰ zhisheng_log è¿™ä¸ª topicï¼Œè¿è¡Œè¿™ä¸ªå·¥å…·ç±»ä¹‹åä¹Ÿä¼šè‡ªåŠ¨åˆ›å»ºè¿™ä¸ª topic äº†ã€‚ 11.5.6 Flink å®æ—¶å¤„ç†æ—¥å¿—æ•°æ®11.5.7 å¤„ç†åº”ç”¨å¼‚å¸¸æ—¥å¿—åŠ å…¥çŸ¥è¯†æ˜Ÿçƒå¯ä»¥çœ‹åˆ°ä¸Šé¢æ–‡ç« ï¼šhttps://t.zsxq.com/RBYj66M æœ¬ç« å±äº Flink å®æˆ˜ç¯‡ï¼Œå‰é¢ç« èŠ‚è®²äº†å¾ˆå¤š Flink ç›¸å…³çš„æŠ€æœ¯çŸ¥è¯†ç‚¹ï¼Œè¿™ç« ä¸»è¦æ˜¯é€šè¿‡æŠ€æœ¯ç‚¹æ¥æ•™å¤§å®¶å¦‚ä½•å»å®Œæˆä¸€äº›çœŸå®çš„éœ€æ±‚ï¼Œæ¯”å¦‚é€šè¿‡ State å»å®æ—¶ç»Ÿè®¡ç½‘ç«™å„é¡µé¢ä¸€å¤©çš„ PV å’Œ UVã€é€šè¿‡ ProcessFunction å»åšå®šæ—¶å™¨å¤„ç†ä¸€äº›å»¶è¿Ÿçš„äº‹ä»¶ï¼ˆå®•æœºå‘Šè­¦ï¼‰ã€é€šè¿‡ Async IO è¯»å–å‘Šè­¦è§„åˆ™ã€é€šè¿‡å¹¿æ’­å˜é‡åŠ¨æ€çš„æ›´æ–°å‘Šè­¦è§„åˆ™ã€å¦‚ä½•å®æ—¶çš„åšåˆ°æ—¥å¿—å‘Šè­¦ã€‚ è™½ç„¶è¿™äº›éœ€æ±‚æ¢åˆ°ä½ ä»¬å…¬å¸å»å¯èƒ½ä¸ä¸€æ ·ï¼Œä½†æ˜¯è¿™äº›æŠ€æœ¯çŸ¥è¯†ç‚¹æ˜¯å¯ä»¥è¿ç”¨åˆ°ä½ çš„é¡¹ç›®éœ€æ±‚ä¸­å»çš„ï¼Œè¿™é‡Œä»‹ç»çš„è¿™äº›éœ€æ±‚ï¼Œä½ è¦å­¦ä¼šå»åˆ†æï¼Œç„¶åå»åˆ¤æ–­è¿™äº›éœ€æ±‚åˆ°åº•è¯¥ä½¿ç”¨ä»€ä¹ˆæŠ€æœ¯æ¥å®ç°ä¼šæ›´å¥½ï¼Œè¿™æ ·æ‰å¯ä»¥åšåˆ°æ´»å­¦æ´»ç”¨ã€‚","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹â€”â€” å¦‚ä½•åˆ©ç”¨å¹¿æ’­å˜é‡åŠ¨æ€æ›´æ–°å‘Šè­¦è§„åˆ™ï¼Ÿ","date":"2021-08-16T16:00:00.000Z","path":"2021/08/17/flink-in-action-11.4/","text":"11.4 å¦‚ä½•åˆ©ç”¨å¹¿æ’­å˜é‡åŠ¨æ€æ›´æ–°å‘Šè­¦è§„åˆ™ï¼Ÿä¸€ä¸ªåœ¨ç”Ÿäº§ç¯å¢ƒè¿è¡Œçš„æµä½œä¸šæœ‰æ—¶å€™ä¼šæƒ³å˜æ›´ä¸€äº›ä½œä¸šçš„é…ç½®æˆ–è€…æ•°æ®æµçš„é…ç½®ï¼Œç„¶åä½œä¸šå¯ä»¥è¯»å–å¹¶ä½¿ç”¨æ–°çš„é…ç½®ï¼Œè€Œä¸æ˜¯é€šè¿‡ä¿®æ”¹é…ç½®ç„¶åé‡å¯ä½œä¸šæ¥è¯»å–é…ç½®ï¼Œæ¯•ç«Ÿé‡å¯ä¸€ä¸ªæœ‰çŠ¶æ€çš„æµä½œä¸šä»£ä»·æŒºå¤§ï¼Œæœ¬èŠ‚å°†å¸¦ä½ ç†Ÿæ‚‰ Broadcastï¼Œå¹¶é€šè¿‡ä¸€ä¸ªæ¡ˆä¾‹æ¥æ•™ä¼šä½ å¦‚ä½•å»åŠ¨æ€çš„æ›´æ–°ä½œä¸šçš„é…ç½®ã€‚ 11.4.1 BroadcastVariable ç®€ä»‹BroadcastVariable ä¸­æ–‡æ„æ€æ˜¯å¹¿æ’­å˜é‡ï¼Œå…¶å®å¯ä»¥ç†è§£æ˜¯ä¸€ä¸ªå…¬å…±çš„å…±äº«å˜é‡ï¼ˆå¯èƒ½æ˜¯å›ºå®šä¸å˜çš„æ•°æ®é›†åˆï¼Œä¹Ÿå¯èƒ½æ˜¯åŠ¨æ€å˜åŒ–çš„æ•°æ®é›†åˆï¼‰ï¼Œåœ¨ä½œä¸šä¸­å°†è¯¥å…±äº«å˜é‡å¹¿æ’­å‡ºå»ï¼Œç„¶åä¸‹æ¸¸çš„æ‰€æœ‰ä»»åŠ¡éƒ½å¯ä»¥è·å–åˆ°è¯¥å…±äº«å˜é‡ï¼Œè¿™æ ·å°±å¯ä»¥ä¸ç”¨å°†è¿™ä¸ªå˜é‡æ‹·è´åˆ°ä¸‹æ¸¸çš„æ¯ä¸ªä»»åŠ¡ä¸­ã€‚ä¹‹æ‰€ä»¥è®¾è®¡è¿™ä¸ªå¹¿æ’­å˜é‡çš„åŸå› ä¸»è¦æ˜¯å› ä¸ºåœ¨ Flink ä¸­å¤šå¹¶è¡Œåº¦çš„æƒ…å†µä¸‹ï¼Œæ¯ä¸ªç®—å­æˆ–è€…ä¸åŒç®—å­è¿è¡Œæ‰€åœ¨çš„ Slot ä¸ä¸€è‡´ï¼Œè¿™å°±å¯¼è‡´å®ƒä»¬ä¸ä¼šå…±äº«åŒä¸€ä¸ªå†…å­˜ï¼Œä¹Ÿå°±ä¸å¯ä»¥é€šè¿‡é™æ€å˜é‡çš„æ–¹å¼å»è·å–è¿™äº›å…±äº«å˜é‡å€¼ã€‚å¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œæœ‰ä¸å°‘è¯»è€…åœ¨é—®è¿‡æˆ‘ä¸ºå•¥æˆ‘è®¾ç½®çš„é™æ€å˜é‡å€¼åœ¨æœ¬åœ°è¿è¡Œæ˜¯å¯ä»¥è·å–åˆ°çš„ï¼Œåœ¨é›†ç¾¤ç¯å¢ƒè¿è¡Œä½œä¸šå°±å‡ºç°ç©ºæŒ‡é’ˆå•Šï¼Œè¯¥é—®é¢˜å…¶å®ç¬”è€…è‡ªå·±ä¹Ÿåœ¨ç”Ÿäº§ç¯å¢ƒé‡åˆ°è¿‡ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥å¥½å¥½æ•™å¤§å®¶ä½¿ç”¨ï¼ 11.4.2 å¦‚ä½•ä½¿ç”¨ BroadcastVariable ï¼Ÿåœ¨ 3.4 èŠ‚ä¸­è®²è¿‡å¦‚ä½• broadcast ç®—å­å’Œ BroadcastStream å¦‚ä½•ä½¿ç”¨ï¼Œåœ¨ 4.1 èŠ‚ä¸­è®²è§£äº† Broadcast State å¦‚ä½•ä½¿ç”¨ä»¥åŠéœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼Œæ³¨æ„ BroadcastVariable åªèƒ½åº”ç”¨åœ¨æ‰¹ä½œä¸šä¸­ï¼Œå¦‚æœè¦åº”ç”¨åœ¨æµä½œä¸šä¸­åˆ™éœ€è¦è¦ä½¿ç”¨ BroadcastStreamã€‚ åœ¨æ‰¹ä½œä¸šä¸­é€šè¿‡ä½¿ç”¨ withBroadcastSet(DataSet, String) æ¥å¹¿æ’­ä¸€ä¸ª DataSet æ•°æ®é›†åˆï¼Œå¹¶å¯ä»¥ç»™è¿™ä»½æ•°æ®èµ·ä¸ªåå­—ï¼Œå¦‚æœè¦è·å–æ•°æ®çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡ getRuntimeContext().getBroadcastVariable(String) è·å–å¹¿æ’­å‡ºå»çš„å˜é‡æ•°æ®ã€‚ä¸‹é¢æ¼”ç¤ºä¸€ä¸‹å¹¿æ’­ä¸€ä¸ª DataSet å˜é‡å’Œè·å–å˜é‡çš„æ ·ä¾‹ã€‚ 12345678910111213141516171819202122final ParameterTool params = ParameterTool.fromArgs(args);final ExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment();//1. å¾…å¹¿æ’­çš„æ•°æ®DataSet&lt;Integer&gt; toBroadcast = env.fromElements(1, 2, 3);env.fromElements(\"a\", \"b\") .map(new RichMapFunction&lt;String, String&gt;() &#123; List&lt;Integer&gt; broadcastData; @Override public void open(Configuration parameters) throws Exception &#123; // 3. è·å–å¹¿æ’­çš„ DataSet æ•°æ® ä½œä¸ºä¸€ä¸ª Collection broadcastData = getRuntimeContext().getBroadcastVariable(\"zhisheng\"); &#125; @Override public String map(String value) throws Exception &#123; return broadcastData.get(1) + value; &#125; &#125;).withBroadcastSet(toBroadcast, \"zhisheng\")// 2. å¹¿æ’­ DataSet .print(); æ³¨æ„å¹¿æ’­çš„æ—¶å€™è®¾ç½®çš„åç§°å’Œè·å–çš„åç§°è¦ä¸€è‡´ï¼Œç„¶åè¿è¡Œçš„ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ æµä½œä¸šä¸­é€šå¸¸ä½¿ç”¨ BroadcastStream çš„æ–¹å¼å°†å˜é‡é›†åˆåœ¨æ•°æ®æµä¸­ä¼ é€’ï¼Œå¯èƒ½æ•°æ®é›†åˆä¼šåšä¿®æ”¹æ›´æ–°ï¼Œä½†æ˜¯ä¿®æ”¹åå…¶å®å¹¶ä¸æƒ³é‡å¯ä½œä¸šå»è¯»å–è¿™äº›æ–°ä¿®æ”¹çš„é…ç½®ï¼Œå› ä¸ºå¯¹äºä¸€ä¸ªæµä½œä¸šæ¥è¯´é‡å¯å¸¦æ¥çš„ä»£ä»·å¾ˆé«˜ï¼ˆéœ€è¦è€ƒè™‘æ•°æ®å †ç§¯å’Œå¦‚ä½•æ¢å¤è‡³é‡å¯å‰çš„çŠ¶æ€ç­‰é—®é¢˜ï¼‰ï¼Œé‚£ä¹ˆè¿™ç§æƒ…å†µä¸‹å°±å¯ä»¥åœ¨å¹¿æ’­æ•°æ®æµå¤„å®šæ—¶æŸ¥è¯¢æ•°æ®ï¼Œè¿™æ ·å°±èƒ½å¤Ÿè·å–æ›´æ”¹åçš„æ•°æ®ï¼Œé€šå¸¸åœ¨è¿™ç§å¹¿æ’­æ•°æ®å¤„è·å–æ•°æ®åªéœ€è¦è®¾ç½®ä¸€ä¸ªå¹¶è¡Œåº¦å°±å¥½ï¼Œæ—¶é—´æ ¹æ®éœ€æ±‚æ¥åˆ¤æ–­åŠæ—¶æ€§ï¼Œä¸€èˆ¬ 1 åˆ†é’Ÿå†…çš„æ•°æ®å˜æ›´å»¶è¿Ÿéƒ½æ˜¯åœ¨å®¹å¿èŒƒå›´ä¹‹å†…ã€‚å¹¿æ’­æµä¸­çš„å…ƒç´ ä¿è¯æµæ‰€æœ‰çš„å…ƒç´ æœ€ç»ˆéƒ½ä¼šå‘åˆ°ä¸‹æ¸¸çš„æ‰€æœ‰å¹¶è¡Œå®ä¾‹ï¼Œä½†æ˜¯å…ƒç´ åˆ°è¾¾ä¸‹æ¸¸çš„å¹¶è¡Œå®ä¾‹çš„é¡ºåºå¯èƒ½ä¸ç›¸åŒã€‚å› æ­¤ï¼Œå¯¹å¹¿æ’­çŠ¶æ€çš„ä¿®æ”¹ä¸èƒ½ä¾èµ–äºè¾“å…¥æ•°æ®çš„é¡ºåºã€‚åœ¨è¿›è¡Œ Checkpoint æ—¶ï¼Œæ‰€æœ‰çš„ä»»åŠ¡éƒ½ä¼š Checkpoint ä¸‹å®ƒä»¬çš„å¹¿æ’­çŠ¶æ€ã€‚ å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼šå¹¿æ’­å‡ºå»çš„å˜é‡å­˜åœ¨äºæ¯ä¸ªèŠ‚ç‚¹çš„å†…å­˜ä¸­ï¼Œæ‰€ä»¥è¿™ä¸ªæ•°æ®é›†ä¸èƒ½å¤ªå¤§ï¼Œå› ä¸ºå¹¿æ’­å‡ºå»çš„æ•°æ®ï¼Œä¼šä¸€è‡´åœ¨å†…å­˜ä¸­å­˜åœ¨ï¼Œé™¤éç¨‹åºæ‰§è¡Œç»“æŸã€‚ä¸ªäººå»ºè®®ï¼šå¦‚æœæ•°æ®é›†åœ¨å‡ åå…†æˆ–è€…ç™¾å…†çš„æ—¶å€™ï¼Œå¯ä»¥é€‰æ‹©è¿›è¡Œå¹¿æ’­ï¼Œå¦‚æœæ•°æ®é›†çš„å¤§å°ä¸Š G çš„è¯ï¼Œå°±ä¸å»ºè®®è¿›è¡Œå¹¿æ’­äº†ã€‚ ä¸Šé¢ä»‹ç»äº†ä¸‹å¹¿æ’­å˜é‡çš„åœ¨æ‰¹ä½œä¸šçš„ä½¿ç”¨æ–¹å¼ï¼Œä¸‹é¢é€šè¿‡ä¸€ä¸ªæ¡ˆä¾‹æ¥æ•™å¤§å®¶å¦‚ä½•åœ¨æµä½œä¸šä¸­ä½¿ç”¨å¹¿æ’­å˜é‡ã€‚ 11.4.3 åˆ©ç”¨å¹¿æ’­å˜é‡åŠ¨æ€æ›´æ–°å‘Šè­¦è§„åˆ™æ•°æ®éœ€æ±‚åˆ†æåœ¨ 11.3.3 èŠ‚ä¸­æœ‰è®¾è®¡ä¸€å¼ ç®€å•çš„å‘Šè­¦è§„åˆ™è¡¨ï¼Œé€šå¸¸å‘Šè­¦è§„åˆ™æ˜¯ä¼šå¯¹å¤–æä¾›æ¥å£è¿›è¡Œå¢åˆ æ”¹æŸ¥çš„ï¼Œé‚£ä¹ˆéšç€ä¸šåŠ¡åº”ç”¨ä¸Šçº¿ï¼Œå¼€å‘äººå‘˜ä¼šå¯¹å…¶åº”ç”¨æœåŠ¡æ–°å¢æˆ–è€…ä¿®æ”¹å‘Šè­¦è§„åˆ™ï¼ˆæ›´æ”¹ä¹‹å‰è§„åˆ™ä¸­çš„é˜ˆå€¼ï¼‰ï¼Œé‚£ä¹ˆæ›´æ”¹ä¹‹åå°±éœ€è¦è®©å‘Šè­¦çš„ä½œä¸šèƒ½å¤Ÿå»æ„ŸçŸ¥åˆ°ä¹‹å‰çš„è§„åˆ™å‘ç”Ÿäº†å˜åŠ¨ï¼Œæ‰€ä»¥å°±éœ€è¦åœ¨ä½œä¸šä¸­æƒ³ä¸ªä»€ä¹ˆåŠæ³•å»è·å–åˆ°æ›´æ”¹åçš„æ•°æ®ã€‚æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥è®©ä½œä¸šçŸ¥é“è§„åˆ™çš„å˜æ›´ï¼š push å’Œ pull æ¨¡å¼ã€‚ push æ¨¡å¼åˆ™éœ€è¦åœ¨æ›´æ–°ã€åˆ é™¤ã€æ–°å¢æ¥å£ä¸­ä¸ä»…æ“ä½œæ•°æ®åº“ï¼Œè¿˜éœ€è¦é¢å¤–çš„å‘é€æ›´æ–°ã€åˆ é™¤ã€æ–°å¢è§„åˆ™çš„äº‹ä»¶åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œç„¶åä½œä¸šæ¶ˆè´¹æ¶ˆæ¯é˜Ÿåˆ—çš„æ•°æ®å†å»åšæ›´æ–°ã€åˆ é™¤ã€æ–°å¢è§„åˆ™ï¼Œè¿™ç§åŠæ—¶æ€§æœ‰ä¿è¯ï¼Œä½†æ˜¯å¯èƒ½ä¼šæœ‰æ•°æ®ä¸ç»Ÿä¸€çš„é£é™©ï¼ˆå¦‚æœæ¶ˆæ¯é˜Ÿåˆ—çš„æ•°æ®ä¸¢äº†ï¼Œä½†æ˜¯åœ¨æ¥å£ä¸­è¿˜æ˜¯å°†è§„åˆ™çš„æ•°æ®å˜æ›´å­˜å‚¨åˆ°æ•°æ®åº“ï¼‰ï¼›pull æ¨¡å¼ä¸‹å°±éœ€è¦ä½œä¸šå®šæ—¶å»æŸ¥æ‰¾ä¸€éæ‰€æœ‰çš„å‘Šè­¦è§„åˆ™æ•°æ®ï¼Œç„¶åå­˜åœ¨ä½œä¸šå†…å­˜ä¸­ï¼Œè¿™ä¸ªæ—¶é—´å¯ä»¥è®¾ç½®çš„æ¯”è¾ƒçŸ­ï¼Œæ¯”å¦‚ 1 åˆ†é’Ÿï¼Œè¿™æ ·å°±èƒ½æ—¢ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œæ—¶é—´å»¶è¿Ÿä¹Ÿæ˜¯åœ¨å®¹å¿èŒƒå›´ä¹‹å†…ã€‚ å¯¹äºè¿™ç§åŠ¨æ€å˜åŒ–çš„è§„åˆ™æ•°æ®ï¼Œåœ¨ Flink ä¸­é€šå¸¸æ˜¯ä½¿ç”¨å¹¿æ’­æµæ¥å¤„ç†çš„ã€‚é‚£ä¹ˆæ¥ä¸‹æ¥å°±æ¼”ç¤ºä¸‹å¦‚ä½•åˆ©ç”¨å¹¿æ’­å˜é‡åŠ¨æ€æ›´æ–°å‘Šè­¦è§„åˆ™æ•°æ®ï¼Œå‡è®¾æˆ‘ä»¬åœ¨æ•°æ®åº“ä¸­æ–°å¢å‘Šè­¦è§„åˆ™æˆ–è€…ä¿®æ”¹å‘Šè­¦è§„åˆ™æŒ‡æ ‡çš„é˜ˆå€¼ï¼Œç„¶åçœ‹ä½œä¸šä¸­æ˜¯å¦ä¼šå‡ºç°ç›¸åº”çš„å˜åŒ–ã€‚ 11.4.4 è¯»å–å‘Šè­¦è§„åˆ™æ•°æ®11.4.5 ç›‘æ§æ•°æ®è¿æ¥è§„åˆ™æ•°æ®11.4.6 å°ç»“ä¸åæ€åŠ å…¥çŸ¥è¯†æ˜Ÿçƒå¯ä»¥çœ‹åˆ°ä¸Šé¢æ–‡ç« ï¼šhttps://t.zsxq.com/RBYj66M","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹â€”â€” å¦‚ä½•åˆ©ç”¨ Async I/O è¯»å–å‘Šè­¦è§„åˆ™ï¼Ÿ","date":"2021-08-15T16:00:00.000Z","path":"2021/08/16/flink-in-action-11.3/","text":"11.3 å¦‚ä½•åˆ©ç”¨ Async I/O è¯»å–å‘Šè­¦è§„åˆ™ï¼ŸAsync ä¸­æ–‡æ˜¯å¼‚æ­¥çš„æ„æ€ï¼Œåœ¨æµè®¡ç®—ä¸­ï¼Œä½¿ç”¨å¼‚æ­¥ I/O èƒ½å¤Ÿæå‡ä½œä¸šæ•´ä½“çš„è®¡ç®—èƒ½åŠ›ï¼Œæœ¬èŠ‚ä¸­ä¸ä»…ä¼šè®²è§£å¼‚æ­¥ I/O çš„ API åŸç†ï¼Œè¿˜ä¼šé€šè¿‡ä¸€ä¸ªå®æˆ˜éœ€æ±‚ï¼ˆè¯»å–å‘Šè­¦è§„åˆ™ï¼‰æ¥è®²è§£å¼‚æ­¥ I/O çš„ä½¿ç”¨ã€‚ 11.3.1 ä¸ºä»€ä¹ˆéœ€è¦ Async I/Oï¼Ÿåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒIO æ“ä½œéƒ½æ˜¯ä¸€ä¸ªè€—æ—¶çš„è¿‡ç¨‹ï¼Œå°¤å…¶åœ¨æµè®¡ç®—ä¸­ï¼Œå¦‚æœåœ¨å…·ä½“çš„ç®—å­é‡Œé¢è¿˜æœ‰å’Œç¬¬ä¸‰æ–¹å¤–éƒ¨ç³»ç»Ÿï¼ˆæ¯”å¦‚æ•°æ®åº“ã€Redisã€HBase ç­‰å­˜å‚¨ç³»ç»Ÿï¼‰åšäº¤äº’ï¼Œæ¯”å¦‚åœ¨ä¸€ä¸ª MapFunction ä¸­æ¯æ¥ä¸€æ¡æ•°æ®å°±è¦å»æŸ¥æ‰¾ MySQL ä¸­æŸå¼ è¡¨çš„æ•°æ®ï¼Œç„¶åè·ŸæŸ¥è¯¢å‡ºæ¥çš„æ•°æ®åšå…³è”ï¼ˆåŒæ­¥äº¤äº’ï¼‰ã€‚æŸ¥è¯¢è¯·æ±‚åˆ°æ•°æ®åº“ï¼Œå†åˆ°æ•°æ®åº“å“åº”è¿”å›æ•°æ®çš„æ•´ä¸ªæµç¨‹çš„æ—¶é—´å¯¹äºæµä½œä¸šæ¥è¯´æ˜¯æ¯”è¾ƒé•¿çš„ã€‚é‚£ä¹ˆè¯¥ Map ç®—å­å¤„ç†æ•°æ®çš„é€Ÿåº¦å°±ä¼šé™ä¸‹æ¥ï¼Œåœ¨å¤§æ•°æ®é‡çš„æƒ…å†µä¸‹å¾ˆå¯èƒ½ä¼šå¯¼è‡´æ•´ä¸ªæµä½œä¸šå‡ºç°åå‹é—®é¢˜ï¼ˆåœ¨ 9.1 èŠ‚ä¸­è®²è¿‡ï¼‰ï¼Œé‚£ä¹ˆæ•´ä¸ªä½œä¸šçš„æ¶ˆè´¹å»¶è¿Ÿå°±ä¼šå¢åŠ ï¼Œå½±å“ä½œä¸šæ•´ä½“ååé‡å’Œå®æ—¶æ€§ï¼Œä»è€Œå¯¼è‡´æœ€ç»ˆè¯¥ä½œä¸šå¤„äºä¸å¯ç”¨çš„çŠ¶æ€ã€‚ è¿™ç§åŒæ­¥ï¼ˆSyncï¼‰çš„ä¸æ•°æ®åº“åšäº¤äº’æ“ä½œï¼Œä¼šå› è€—æ—¶å¤ªä¹…å¯¼è‡´æ•´ä¸ªä½œä¸šå»¶è¿Ÿï¼Œå¦‚æœæ¢æˆå¼‚æ­¥çš„è¯ï¼Œå°±å¯ä»¥åŒæ—¶å¤„ç†å¾ˆå¤šè¯·æ±‚å¹¶åŒæ—¶å¯ä»¥æ¥æ”¶å“åº”ï¼Œè¿™æ ·çš„è¯ï¼Œç­‰å¾…æ•°æ®åº“å“åº”çš„æ—¶é—´å°±ä¼šä¸å…¶ä»–å‘é€è¯·æ±‚å’Œæ¥æ”¶å“åº”çš„æ—¶é—´é‡å ï¼Œç›¸åŒçš„ç­‰å¾…æ—¶é—´å†…ä¼šå¤„ç†å¤šä¸ªè¯·æ±‚ï¼Œä»è€Œæ¯”åŒæ­¥çš„è®¿é—®è¦æé«˜ä¸å°‘æµå¤„ç†çš„ååé‡ã€‚è™½ç„¶ä¹Ÿå¯ä»¥é€šè¿‡å¢å¤§è¯¥ç®—å­çš„å¹¶è¡Œåº¦å»æ‰§è¡ŒæŸ¥æ•°æ®åº“ï¼Œä½†æ˜¯è¿™ç§è§£å†³åŠæ³•éœ€è¦æ¶ˆè€—æ›´å¤šçš„èµ„æºï¼ˆå¹¶è¡Œåº¦å¢åŠ æ„å‘³ç€æ¶ˆè´¹çš„ slot ä¸ªæ•°ä¹Ÿä¼šå¢åŠ ï¼‰ï¼Œè¿™ç§æ–¹æ³•å’Œä½¿ç”¨å¼‚æ­¥å¤„ç†çš„æ–¹æ³•å¯¹æ¯”ä¸€ä¸‹ï¼Œè¿˜æ˜¯ä½¿ç”¨å¼‚æ­¥çš„æŸ¥è¯¢æ•°æ®åº“è¿™ç§æ–¹æ³•å€¼å¾—ä½¿ç”¨ã€‚åŒæ­¥æ“ä½œï¼ˆSync I/Oï¼‰å’Œå¼‚æ­¥æ“ä½œï¼ˆAsync I/Oï¼‰çš„å¤„ç†æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ å·¦ä¾§è¡¨ç¤ºçš„æ˜¯åœ¨æµå¤„ç†ä¸­åŒæ­¥çš„æ•°æ®åº“è¯·æ±‚ï¼Œå³ä¾§æ˜¯å¼‚æ­¥çš„æ•°æ®åº“è¯·æ±‚ã€‚å‡è®¾å·¦ä¾§æ˜¯æ•°æ®æµä¸­ A æ•°æ®æ¥äº†å‘é€ä¸€ä¸ªæŸ¥è¯¢æ•°æ®åº“çš„è¯·æ±‚çœ‹æ˜¯å¦ä¹‹å‰å­˜åœ¨ Aï¼Œç„¶åç­‰å¾…æŸ¥è¯¢ç»“æœè¿”å›ï¼Œåªæœ‰ç­‰ A æ•´ä¸ªæŸ¥è¯¢è¯·æ±‚å“åº”åæ‰ä¼šç»§ç»­å¼€å§‹ B æ•°æ®çš„æŸ¥è¯¢è¯·æ±‚ï¼Œä¾æ­¤ç»§ç»­ï¼›è€Œå³ä¾§æ˜¯è¿ç»­çš„å»æ•°æ®åº“æŸ¥è¯¢æ˜¯å¦å­˜åœ¨ Aã€Bã€Cã€Dï¼Œåé¢å“ªä¸ªè¯·æ±‚å…ˆå“åº”å°±å…ˆå¤„ç†å“ªä¸ªï¼Œä¸éœ€è¦å’Œå·¦ä¾§çš„ä¸€æ ·è¦ç­‰å¾…ä¸Šä¸€ä¸ªè¯·æ±‚å…¨éƒ¨å®Œæˆæ‰å¯ä»¥å¼€å§‹ä¸‹ä¸€ä¸ªè¯·æ±‚ï¼Œæ‰€ä»¥å¼‚æ­¥çš„è¯ååé‡è‡ªç„¶å°±é«˜èµ·æ¥äº†ã€‚ä½†æ˜¯å¾—æ³¨æ„çš„æ˜¯ï¼šä½¿ç”¨å¼‚æ­¥è¿™ç§æ–¹æ³•å‰ææ˜¯è¦æ•°æ®åº“å®¢æˆ·ç«¯æ”¯æŒå¼‚æ­¥çš„è¯·æ±‚ï¼Œå¦åˆ™å¯èƒ½éœ€è¦å€ŸåŠ©çº¿ç¨‹æ± æ¥å®ç°å¼‚æ­¥è¯·æ±‚ï¼Œä½†æ˜¯ç°åœ¨ä¸»æµçš„æ•°æ®åº“é€šå¸¸éƒ½æ”¯æŒå¼‚æ­¥çš„æ“ä½œï¼Œæ‰€ä»¥ä¸ç”¨å¤ªæ‹…å¿ƒã€‚ 11.3.2 Async I/O APIFlink çš„ Async I/O API å…è®¸ç”¨æˆ·åœ¨æ•°æ®æµå¤„ç†ä¸­ä½¿ç”¨å¼‚æ­¥è¯·æ±‚ï¼Œå¹¶ä¸”è¿˜æ”¯æŒè¶…æ—¶å¤„ç†ã€å¤„ç†é¡ºåºã€äº‹ä»¶æ—¶é—´ã€å®¹é”™ã€‚åœ¨ Flink ä¸­ï¼Œå¦‚æœè¦ä½¿ç”¨ Async I/O APIï¼Œæ˜¯éå¸¸ç®€å•çš„ï¼Œéœ€è¦é€šè¿‡ä¸‹é¢ä¸‰ä¸ªæ­¥éª¤æ¥æ‰§è¡Œå¯¹æ•°æ®åº“çš„å¼‚æ­¥æ“ä½œã€‚ ç»§æ‰¿ RichAsyncFunction æŠ½è±¡ç±»æˆ–è€…å®ç°ç”¨æ¥åˆ†å‘è¯·æ±‚çš„ AsyncFunction æ¥å£ è¿”å›å¼‚æ­¥è¯·æ±‚çš„ç»“æœçš„ Future åœ¨ DataStream ä¸Šä½¿ç”¨å¼‚æ­¥æ“ä½œ å®˜ç½‘ä¹Ÿç»™å‡ºæ¡ˆä¾‹å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142class AsyncDatabaseRequest extends RichAsyncFunction&lt;String, Tuple2&lt;String, String&gt;&gt; &#123; //æ•°æ®åº“çš„å®¢æˆ·ç«¯ï¼Œå®ƒå¯ä»¥å‘å‡ºå¸¦æœ‰ callback çš„å¹¶å‘è¯·æ±‚ private transient DatabaseClient client; @Override public void open(Configuration parameters) throws Exception &#123; client = new DatabaseClient(host, post, credentials); &#125; @Override public void close() throws Exception &#123; client.close(); &#125; @Override public void asyncInvoke(String key, final ResultFuture&lt;Tuple2&lt;String, String&gt;&gt; resultFuture) throws Exception&#123; //å‘å‡ºå¼‚æ­¥è¯·æ±‚ï¼Œæ¥æ”¶ future çš„ç»“æœ final Future&lt;String&gt; result = client.query(key); //è®¾ç½®å®¢æˆ·ç«¯è¯·æ±‚å®Œæˆåæ‰§è¡Œçš„ callbackï¼Œcallback åªæ˜¯å°†ç»“æœè½¬å‘ç»™ ResultFuture CompletableFuture.supplyAsync(new Supplier&lt;String&gt;() &#123; @Override public String get() &#123; try &#123; return result.get(); &#125; catch (InterruptedException | ExecutionException e) &#123; return null; &#125; &#125; &#125;).thenAccept( (String dbResult) -&gt; &#123; resultFuture.complete(Collections.singleton(new Tuple2&lt;&gt;(key, dbResult))); &#125;); &#125;&#125;//åŸå§‹æ•°æ®DataStream&lt;String&gt; stream = ...;//åº”ç”¨å¼‚æ­¥ I/O è½¬æ¢DataStream&lt;Tuple2&lt;String, String&gt;&gt; resultStream = AsyncDataStream.unorderedWait(stream, new AsyncDatabaseRequest(), 1000, TimeUnit.MILLISECONDS, 100); æ³¨æ„ï¼šResultFuture åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨ resultFuture.complete æ—¶å°±å·²ç»å®Œæˆäº†ï¼Œåé¢æ‰€æœ‰ resultFuture.complete çš„è°ƒç”¨éƒ½ä¼šè¢«å¿½ç•¥ã€‚ ä¸‹é¢ä¸¤ä¸ªå‚æ•°æ§åˆ¶äº†å¼‚æ­¥æ“ä½œï¼š Timeoutï¼štimeout å®šä¹‰äº†å¼‚æ­¥æ“ä½œè¿‡äº†å¤šé•¿æ—¶é—´åä¼šè¢«ä¸¢å¼ƒï¼Œè¿™ä¸ªå‚æ•°æ˜¯é˜²æ­¢äº†æ­»çš„æˆ–è€…å¤±è´¥çš„è¯·æ±‚ Capacityï¼šè¿™ä¸ªå‚æ•°å®šä¹‰å¯ä»¥åŒæ—¶å¤„ç†å¤šå°‘ä¸ªå¼‚æ­¥è¯·æ±‚ã€‚è™½ç„¶å¼‚æ­¥è¯·æ±‚ä¼šå¸¦æ¥æ›´å¥½çš„ååé‡ï¼Œä½†æ˜¯è¯¥æ“ä½œä»ç„¶å¯èƒ½æˆä¸ºæµä½œä¸šçš„æ€§èƒ½ç“¶é¢ˆã€‚é™åˆ¶å¹¶å‘è¯·æ±‚çš„æ•°é‡å¯ç¡®ä¿æ“ä½œä¸ä¼šä¸æ–­ç´¯ç§¯å¤„ç†è¯·æ±‚ï¼Œä¸€æ—¦è¶…è¿‡ Capacity å€¼ï¼Œå®ƒå°†è§¦å‘åå‹ã€‚ è¶…æ—¶å¤„ç†ç»“æœé¡ºåºäº‹ä»¶æ—¶é—´å®¹é”™æ€§ä¿è¯å®è·µæŠ€å·§æ³¨æ„ç‚¹11.3.3 åˆ©ç”¨ Async I/O è¯»å–å‘Šè­¦è§„åˆ™éœ€æ±‚åˆ†æç›‘æ§æ•°æ®æ ·ä¾‹å‘Šè­¦è§„åˆ™è¡¨è®¾è®¡å‘Šè­¦è§„åˆ™å®ä½“ç±»11.3.4 å¦‚ä½•ä½¿ç”¨ Async I/O è¯»å–å‘Šè­¦è§„åˆ™æ•°æ®11.3.5 å°ç»“ä¸åæ€åŠ å…¥çŸ¥è¯†æ˜Ÿçƒå¯ä»¥çœ‹åˆ°ä¸Šé¢æ–‡ç« ï¼šhttps://t.zsxq.com/RBYj66M","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹â€”â€” å¦‚ä½•ä½¿ç”¨ Flink ProcessFunction å¤„ç†å®•æœºå‘Šè­¦?","date":"2021-08-14T16:00:00.000Z","path":"2021/08/15/flink-in-action-11.2/","text":"11.2 å¦‚ä½•ä½¿ç”¨ Flink ProcessFunction å¤„ç†å®•æœºå‘Šè­¦?åœ¨ 3.3 èŠ‚ä¸­è®²è§£äº† Process ç®—å­çš„æ¦‚å¿µï¼Œæœ¬èŠ‚ä¸­å°†æ›´è¯¦ç»†çš„è®²è§£ Flink ProcessFunctionï¼Œç„¶åæ•™å¤§å®¶å¦‚ä½•ä½¿ç”¨ ProcessFunction æ¥è§£å†³å…¬å¸ä¸­å¸¸è§çš„é—®é¢˜ â€”â€” å®•æœºï¼Œè¿™ä¸ªå®•æœºä¸ä»…ä»…åŒ…æ‹¬æœºå™¨å®•æœºï¼Œè¿˜åŒ…å«åº”ç”¨å®•æœºï¼Œé€šå¸¸å‡ºç°å®•æœºå¸¦æ¥çš„å½±å“æ˜¯ä¼šå¾ˆå¤§çš„ï¼Œæ‰€ä»¥èƒ½åŠæ—¶æ”¶åˆ°å‘Šè­¦ä¼šå‡å°‘æŸå¤±ã€‚ 11.2.1 ProcessFunction ç®€ä»‹åœ¨ 1.2.5 èŠ‚ä¸­è®²äº† Flink çš„ API åˆ†å±‚ï¼Œå…¶ä¸­å¯ä»¥çœ‹è§ Flink çš„åº•å±‚ API å°±æ˜¯ ProcessFunctionï¼Œå®ƒæ˜¯ä¸€ä¸ªä½é˜¶çš„æµå¤„ç†æ“ä½œï¼Œå®ƒå¯ä»¥è®¿é—®æµå¤„ç†ç¨‹åºçš„åŸºç¡€æ„å»ºæ¨¡å—ï¼šEventã€Stateã€Timerã€‚ProcessFunction å¯ä»¥è¢«è®¤ä¸ºæ˜¯ä¸€ç§æä¾›äº†å¯¹ KeyedState å’Œå®šæ—¶å™¨è®¿é—®çš„ FlatMapFunctionã€‚æ¯å½“æ•°æ®æºä¸­æ¥æ”¶åˆ°ä¸€ä¸ªäº‹ä»¶ï¼Œå°±ä¼šè°ƒç”¨æ¥æ­¤å‡½æ•°æ¥å¤„ç†ã€‚å¯¹äºå®¹é”™çš„çŠ¶æ€ï¼ŒProcessFunction å¯ä»¥é€šè¿‡ RuntimeContext è®¿é—® KeyedStateã€‚ å®šæ—¶å™¨å¯ä»¥å¯¹å¤„ç†æ—¶é—´å’Œäº‹ä»¶æ—¶é—´çš„å˜åŒ–åšä¸€äº›å¤„ç†ã€‚æ¯æ¬¡è°ƒç”¨ processElement() éƒ½å¯ä»¥è·å¾—ä¸€ä¸ª Context å¯¹è±¡ï¼Œé€šè¿‡è¯¥å¯¹è±¡å¯ä»¥è®¿é—®å…ƒç´ çš„äº‹ä»¶æ—¶é—´æˆ³ä»¥åŠ TimerServiceã€‚TimerService å¯ä»¥ä¸ºå°šæœªå‘ç”Ÿçš„äº‹ä»¶æ—¶é—´/å¤„ç†æ—¶é—´å®ä¾‹æ³¨å†Œå›è°ƒã€‚å½“å®šæ—¶å™¨åˆ°è¾¾æŸä¸ªæ—¶åˆ»æ—¶ï¼Œä¼šè°ƒç”¨ onTimer() æ–¹æ³•ã€‚åœ¨è°ƒç”¨æœŸé—´ï¼Œæ‰€æœ‰çŠ¶æ€å†æ¬¡é™å®šä¸ºå®šæ—¶å™¨åˆ›å»ºçš„ keyï¼Œå…è®¸å®šæ—¶å™¨æ“ä½œ KeyedStateã€‚å¦‚æœè¦è®¿é—® KeyedState å’Œå®šæ—¶å™¨ï¼Œé‚£å¿…é¡»åœ¨ KeyedStream ä¸Šä½¿ç”¨ KeyedProcessFunctionï¼Œæ¯”å¦‚åœ¨ keyBy ç®—å­ä¹‹åä½¿ç”¨ï¼š 123dataStream.keyBy(...).process(new KeyedProcessFunction&lt;&gt;()&#123; &#125;) KeyedProcessFunction æ˜¯ ProcessFunction å‡½æ•°çš„ä¸€ä¸ªæ‰©å±•ï¼Œå®ƒå¯ä»¥åœ¨ onTimer å’Œ processElement æ–¹æ³•ä¸­è·å–åˆ°åˆ†åŒºçš„ Key å€¼ï¼Œè¿™å¯¹äºæ•°æ®ä¼ é€’æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ï¼Œå› ä¸ºç»å¸¸æœ‰è¿™æ ·çš„éœ€æ±‚ï¼Œç»è¿‡ keyBy ç®—å­ä¹‹åå¯èƒ½è¿˜éœ€è¦è¿™ä¸ª key å­—æ®µï¼Œé‚£ä¹ˆåœ¨è¿™é‡Œç›´æ¥æ„å»ºæˆä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼ˆæ–°å¢ä¸€ä¸ª key å­—æ®µï¼‰ï¼Œç„¶åä¸‹æ¸¸çš„ç®—å­ç›´æ¥ä½¿ç”¨è¿™ä¸ªæ–°å¯¹è±¡ä¸­çš„ key å°±å¥½äº†ï¼Œè€Œä¸åœ¨éœ€è¦é‡å¤çš„æ‹¼ä¸€ä¸ªå”¯ä¸€çš„ keyã€‚ 12345678910public void processElement(String value, Context ctx, Collector&lt;String&gt; out) throws Exception &#123; System.out.println(ctx.getCurrentKey()); out.collect(value);&#125;@Overridepublic void onTimer(long timestamp, OnTimerContext ctx, Collector&lt;String&gt; out) throws Exception &#123; System.out.println(ctx.getCurrentKey()); super.onTimer(timestamp, ctx, out);&#125; 11.2.2 CoProcessFunction ç®€ä»‹å¦‚æœè¦åœ¨ä¸¤ä¸ªè¾“å…¥æµä¸Šè¿›è¡Œæ“ä½œï¼Œå¯ä»¥ä½¿ç”¨ CoProcessFunctionï¼Œè¿™ä¸ªå‡½æ•°å¯ä»¥ä¼ å…¥ä¸¤ä¸ªä¸åŒçš„æ•°æ®æµè¾“å…¥ï¼Œå¹¶ä¸ºæ¥è‡ªä¸¤ä¸ªä¸åŒæ•°æ®æºçš„äº‹ä»¶åˆ†åˆ«è°ƒç”¨ processElement1() å’Œ processElement2() æ–¹æ³•ã€‚å¯ä»¥æŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤æ¥å®ç°ä¸€ä¸ªå…¸å‹çš„ Join æ“ä½œï¼š ä¸ºä¸€ä¸ªæ•°æ®æºçš„æ•°æ®å»ºç«‹ä¸€ä¸ªçŠ¶æ€å¯¹è±¡ ä»æ•°æ®æºå¤„æœ‰æ–°æ•°æ®æµè¿‡æ¥çš„æ—¶å€™æ›´æ–°è¿™ä¸ªçŠ¶æ€å¯¹è±¡ åœ¨å¦ä¸€ä¸ªæ•°æ®æºæ¥æ”¶åˆ°å…ƒç´ æ—¶ï¼Œå…³è”çŠ¶æ€å¯¹è±¡å¹¶å¯¹å…¶äº§ç”Ÿå‡ºè¿æ¥çš„ç»“æœ æ¯”å¦‚ï¼Œå°†ç›‘æ§çš„ metric æ•°æ®å’Œå‘Šè­¦è§„åˆ™æ•°æ®è¿›è¡Œä¸€ä¸ªè¿æ¥ï¼Œåœ¨æµæ•°æ®çš„çŠ¶æ€ä¸­å­˜å‚¨äº†å‘Šè­¦è§„åˆ™æ•°æ®ï¼Œå½“æœ‰ç›‘æ§æ•°æ®è¿‡æ¥æ—¶ï¼Œæ ¹æ®ç›‘æ§æ•°æ®çš„ metric åç§°å’Œä¸€äº› tag å»æ‰¾å¯¹åº”å‘Šè­¦è§„åˆ™è®¡ç®—è¡¨è¾¾å¼ï¼Œç„¶åé€šè¿‡è§„åˆ™çš„è¡¨è¾¾å¼å¯¹æ•°æ®è¿›è¡ŒåŠ å·¥å¤„ç†ï¼Œåˆ¤æ–­æ˜¯å¦è¦å‘Šè­¦ï¼Œå¦‚æœæ˜¯è¦å‘Šè­¦åˆ™ä¼šå…³è”æ„é€ æˆä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œæ–°å¯¹è±¡ä¸­ä¸ä»…æœ‰åˆå§‹çš„ç›‘æ§ metric æ•°æ®ï¼Œè¿˜æœ‰å«æœ‰å¯¹åº”çš„å‘Šè­¦è§„åˆ™æ•°æ®ä»¥åŠé€šçŸ¥ç­–ç•¥æ•°æ®ï¼Œç»„è£…æˆè¿™æ ·ä¸€æ¡æ•°æ®åï¼Œä¸‹æ¸¸å°±å¯ä»¥æ ¹æ®è¿™ä¸ªæ•°æ®è¿›è¡Œé€šçŸ¥ï¼Œé€šçŸ¥è¿˜ä¼šåœ¨çŠ¶æ€ä¸­å­˜å‚¨è¿™ä¸ªå‘Šè­¦çŠ¶æ€ï¼Œè¡¨ç¤ºå®ƒåœ¨ä»€ä¹ˆæ—¶é—´å‘Šè¿‡è­¦äº†ï¼Œä¸‹æ¬¡æœ‰æ–°æ•°æ®è¿‡æ¥çš„æ—¶å€™ï¼Œåˆ¤æ–­æ–°æ•°æ®æ˜¯å¦æ˜¯æ¢å¤çš„ï¼Œå¦‚æœå±äºæ¢å¤åˆ™æŠŠè¯¥çŠ¶æ€æ¸…é™¤ã€‚ 11.2.3 Timer ç®€ä»‹Timer æä¾›äº†ä¸€ç§å®šæ—¶è§¦å‘å™¨çš„åŠŸèƒ½ï¼Œé€šè¿‡ TimerService æ¥å£æ³¨å†Œ timerã€‚TimerService åœ¨å†…éƒ¨ç»´æŠ¤ä¸¤ç§ç±»å‹çš„å®šæ—¶å™¨ï¼ˆå¤„ç†æ—¶é—´å’Œäº‹ä»¶æ—¶é—´å®šæ—¶å™¨ï¼‰å¹¶æ’é˜Ÿæ‰§è¡Œã€‚å¤„ç†æ—¶é—´å®šæ—¶å™¨çš„è§¦å‘ä¾èµ–äº ProcessingTimeServiceï¼Œå®ƒè´Ÿè´£ç®¡ç†æ‰€æœ‰åŸºäºå¤„ç†æ—¶é—´çš„è§¦å‘å™¨ï¼Œå†…éƒ¨ä½¿ç”¨ ScheduledThreadPoolExecutor è°ƒåº¦å®šæ—¶ä»»åŠ¡ï¼›äº‹ä»¶æ—¶é—´å®šæ—¶å™¨çš„è§¦å‘ä¾èµ–äºç³»ç»Ÿå½“å‰çš„ Watermarkã€‚éœ€è¦æ³¨æ„çš„ä¸€ç‚¹å°±æ˜¯ï¼šTimer åªèƒ½åœ¨ KeyedStream ä¸­ä½¿ç”¨ã€‚ TimerService ä¼šåˆ é™¤æ¯ä¸ª Key å’Œæ—¶é—´æˆ³é‡å¤çš„å®šæ—¶å™¨ï¼Œå³æ¯ä¸ª Key åœ¨åŒä¸€ä¸ªæ—¶é—´æˆ³ä¸Šæœ€å¤šæœ‰ä¸€ä¸ªå®šæ—¶å™¨ã€‚å¦‚æœä¸ºåŒä¸€æ—¶é—´æˆ³æ³¨å†Œäº†å¤šä¸ªå®šæ—¶å™¨ï¼Œåˆ™åªä¼šè°ƒç”¨ä¸€æ¬¡ onTimerï¼ˆï¼‰ æ–¹æ³•ã€‚Flink ä¼šåŒæ­¥è°ƒç”¨ onTimer() å’Œ processElement() æ–¹æ³•ï¼Œå› æ­¤ä¸å¿…æ‹…å¿ƒçŠ¶æ€çš„å¹¶å‘ä¿®æ”¹é—®é¢˜ã€‚TimerService ä¸ä»…æä¾›äº†æ³¨å†Œå’Œåˆ é™¤ Timer çš„åŠŸèƒ½ï¼Œè¿˜å¯ä»¥é€šè¿‡å®ƒæ¥è·å–å½“å‰çš„ç³»ç»Ÿæ—¶é—´å’Œ Watermark çš„å€¼ã€‚TimerService ç±»ä¸­çš„æ–¹æ³•å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ å®¹é”™å®šæ—¶å™¨å…·æœ‰å®¹é”™èƒ½åŠ›ï¼Œå¹¶ä¸”ä¼šä¸åº”ç”¨ç¨‹åºçš„çŠ¶æ€ä¸€èµ·è¿›è¡Œ Checkpointï¼Œå¦‚æœå‘ç”Ÿæ•…éšœé‡å¯ä¼šä» Checkpointï¼Savepoint ä¸­æ¢å¤å®šæ—¶å™¨çš„çŠ¶æ€ã€‚å¦‚æœæœ‰å¤„ç†æ—¶é—´å®šæ—¶å™¨åŸæœ¬æ˜¯è¦åœ¨æ¢å¤èµ·æ¥çš„é‚£ä¸ªæ—¶é—´ä¹‹å‰è§¦å‘çš„ï¼Œé‚£ä¹ˆåœ¨æ¢å¤çš„é‚£ä¸€åˆ»ä¼šç«‹å³è§¦å‘è¯¥å®šæ—¶å™¨ã€‚å®šæ—¶å™¨å§‹ç»ˆæ˜¯å¼‚æ­¥çš„è¿›è¡Œ Checkpointï¼ˆé™¤ RocksDB çŠ¶æ€åç«¯å­˜å‚¨ã€å¢é‡çš„ Checkpointã€åŸºäºå †çš„å®šæ—¶å™¨å¤–ï¼‰ã€‚å› ä¸ºå®šæ—¶å™¨å®é™…ä¸Šä¹Ÿæ˜¯ä¸€ç§ç‰¹æ®ŠçŠ¶æ€çš„çŠ¶æ€ï¼Œåœ¨ Checkpoint æ—¶ä¼šå†™å…¥å¿«ç…§ä¸­ï¼Œæ‰€ä»¥å¦‚æœæœ‰å¤§é‡çš„å®šæ—¶å™¨ï¼Œåˆ™æ— éä¼šå¢åŠ ä¸€æ¬¡ Checkpoint æ‰€éœ€è¦çš„æ—¶é—´ï¼Œå¿…è¦çš„è¯å¾—æ ¹æ®å®é™…æƒ…å†µåˆå¹¶å®šæ—¶å™¨ã€‚ åˆå¹¶å®šæ—¶å™¨ç”±äº Flink ä»…ä¸ºæ¯ä¸ª Key å’Œæ—¶é—´æˆ³ç»´æŠ¤ä¸€ä¸ªå®šæ—¶å™¨ï¼Œå› æ­¤å¯ä»¥é€šè¿‡é™ä½å®šæ—¶å™¨çš„é¢‘ç‡æ¥è¿›è¡Œåˆå¹¶ä»¥å‡å°‘å®šæ—¶å™¨çš„æ•°é‡ã€‚å¯¹äºé¢‘ç‡ä¸º 1 ç§’çš„å®šæ—¶å™¨ï¼ˆåŸºäºäº‹ä»¶æ—¶é—´æˆ–å¤„ç†æ—¶é—´ï¼‰ï¼Œå¯ä»¥å°†ç›®æ ‡æ—¶é—´å‘ä¸‹èˆå…¥ä¸ºæ•´ç§’æ•°ï¼Œåˆ™å®šæ—¶å™¨æœ€å¤šæå‰ 1 ç§’è§¦å‘ï¼Œä½†ä¸ä¼šè¿Ÿäºæˆ‘ä»¬çš„è¦æ±‚ï¼Œç²¾ç¡®åˆ°æ¯«ç§’ã€‚å› æ­¤ï¼Œæ¯ä¸ªé”®æ¯ç§’æœ€å¤šæœ‰ä¸€ä¸ªå®šæ—¶å™¨ã€‚ 12long coalescedTime = ((ctx.timestamp() + timeout) / 1000) * 1000;ctx.timerService().registerProcessingTimeTimer(coalescedTime); ç”±äºäº‹ä»¶æ—¶é—´è®¡æ—¶å™¨ä»…åœ¨ Watermark åˆ°è¾¾æ—¶æ‰è§¦å‘ï¼Œå› æ­¤å¯ä»¥å°†å½“å‰ Watermark ä¸ä¸‹ä¸€ä¸ª Watermark çš„å®šæ—¶å™¨ä¸€èµ·è°ƒåº¦å’Œåˆå¹¶ï¼š 12long coalescedTime = ctx.timerService().currentWatermark() + 1;ctx.timerService().registerEventTimeTimer(coalescedTime); å®šæ—¶å™¨ä¹Ÿå¯ä»¥ç±»ä¼¼ä¸‹é¢è¿™æ ·ç§»é™¤ï¼š 1234567//åˆ é™¤å¤„ç†æ—¶é—´å®šæ—¶å™¨long timestampOfTimerToStop = ...ctx.timerService().deleteProcessingTimeTimer(timestampOfTimerToStop);//åˆ é™¤äº‹ä»¶æ—¶é—´å®šæ—¶å™¨long timestampOfTimerToStop = ...ctx.timerService().deleteEventTimeTimer(timestampOfTimerToStop); å¦‚æœæ²¡æœ‰è¯¥æ—¶é—´æˆ³çš„å®šæ—¶å™¨ï¼Œåˆ™åˆ é™¤å®šæ—¶å™¨æ— æ•ˆã€‚ 11.2.4 å¦‚æœåˆ©ç”¨ ProcessFunction å¤„ç†å®•æœºå‘Šè­¦ï¼Ÿå®•æœºå‘Šè­¦éœ€æ±‚åˆ†æå®•æœºå‘Šè­¦ä»£ç å®ç°11.2.5 å°ç»“ä¸åæ€åŠ å…¥çŸ¥è¯†æ˜Ÿçƒå¯ä»¥çœ‹åˆ°ä¸Šé¢æ–‡ç« ï¼šhttps://t.zsxq.com/RBYj66M","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹â€”â€” å¦‚ä½•ç»Ÿè®¡ç½‘ç«™å„é¡µé¢ä¸€å¤©å†…çš„ PV å’Œ UVï¼Ÿ","date":"2021-08-13T16:00:00.000Z","path":"2021/08/14/flink-in-action-11.1/","text":"ç¬¬åä¸€ç«  â€”â€” Flink å®æˆ˜æœ¬ç« ä¸»è¦æ˜¯ Flink å®æˆ˜ï¼Œä»‹ç»äº†ä¸€äº›å¸¸è§çš„éœ€æ±‚ï¼Œæ¯”å¦‚å®æ—¶ç»Ÿè®¡ç½‘ç«™é¡µé¢çš„ PV/UVã€å®•æœºå‘Šè­¦ã€åŠ¨æ€æ›´æ–°é…ç½®ã€åº”ç”¨ Error æ—¥å¿—å®æ—¶å‘Šè­¦ç­‰ï¼Œç„¶ååˆ†åˆ«å»åˆ†æè¿™äº›éœ€æ±‚çš„å®ç°æ–¹å¼ï¼Œæ˜ç™½è¯¥ä½¿ç”¨ Flink ä¸­çš„å“ªäº›çŸ¥è¯†ç‚¹æ‰èƒ½å¤Ÿå¾ˆå¥½çš„å®Œæˆè¿™ç§éœ€æ±‚ï¼Œå¹¶æä¾›å®Œæ•´çš„æ¡ˆä¾‹ä»£ç ä¾›å¤§å®¶å‚è€ƒã€‚åœ¨å®ç°å®Œæˆè¿™äº›éœ€æ±‚ä¹‹åï¼Œç¬”è€…è¿˜å°†ä¼šæ›´æ·±ä¸€æ­¥çš„å»è®²è§£ä¸‹è¿™äº›çŸ¥è¯†ç‚¹èƒŒåçš„å®ç°æ–¹å¼ï¼Œå¸Œæœ›å¯ä»¥åŠ æ·±ä½ å¯¹è¿™äº›çŸ¥è¯†ç‚¹çš„å°è±¡ï¼Œä»¥ä¾¿åé¢ä½ å¯ä»¥çµæ´»çš„å¤„ç†ç±»ä¼¼çš„éœ€æ±‚ã€‚ 11.1 å¦‚ä½•ç»Ÿè®¡ç½‘ç«™å„é¡µé¢ä¸€å¤©å†…çš„ PV å’Œ UVï¼Ÿå¤§æ•°æ®å¼€å‘æœ€å¸¸ç»Ÿè®¡çš„éœ€æ±‚å¯èƒ½å°±æ˜¯ PVã€UVã€‚PV å…¨æ‹¼ PageViewï¼Œå³é¡µé¢è®¿é—®é‡ï¼Œç”¨æˆ·æ¯æ¬¡å¯¹ç½‘ç«™çš„è®¿é—®å‡è¢«è®°å½•ï¼ŒæŒ‰ç…§è®¿é—®é‡è¿›è¡Œç´¯è®¡ï¼Œå‡å¦‚ç”¨æˆ·å¯¹åŒä¸€é¡µé¢è®¿é—®äº† 5 æ¬¡ï¼Œé‚£è¯¥é¡µé¢çš„ PV å°±åº”è¯¥åŠ  5ã€‚UV å…¨æ‹¼ä¸º UniqueVisitorï¼Œå³ç‹¬ç«‹è®¿é—®ç”¨æˆ·æ•°ï¼Œè®¿é—®è¯¥é¡µé¢çš„ä¸€å°ç”µè„‘å®¢æˆ·ç«¯ä¸ºä¸€ä¸ªè®¿å®¢ï¼Œå‡å¦‚ç”¨æˆ·å¯¹åŒä¸€é¡µé¢è®¿é—®äº† 5 æ¬¡ï¼Œé‚£ä¹ˆè¯¥é¡µé¢çš„ UV åªåº”è¯¥åŠ  1ï¼Œå› ä¸º UV è®¡ç®—çš„æ˜¯å»é‡åçš„ç”¨æˆ·æ•°è€Œä¸æ˜¯è®¿é—®æ¬¡æ•°ã€‚å½“ç„¶å¦‚æœæ˜¯æŒ‰å¤©ç»Ÿè®¡ï¼Œé‚£ä¹ˆå½“å¤© 0 ç‚¹åˆ° 24 ç‚¹ç›¸åŒçš„å®¢æˆ·ç«¯åªè¢«è®¡ç®—ä¸€æ¬¡ï¼Œå¦‚æœè¿‡äº†ä»Šå¤© 24 ç‚¹ï¼Œç¬¬äºŒå¤©è¯¥ç”¨æˆ·åˆè®¿é—®äº†è¯¥é¡µé¢ï¼Œé‚£ä¹ˆç¬¬äºŒå¤©è¯¥é¡µé¢çš„ UV åº”è¯¥åŠ  1ã€‚ æ¦‚å¿µæ˜ç™½äº†é‚£å¦‚ä½•ä½¿ç”¨ Flink æ¥ç»Ÿè®¡ç½‘ç«™å„é¡µé¢çš„ PV å’Œ UV å‘¢ï¼Ÿé€šè¿‡æœ¬èŠ‚æ¥è¯¦ç»†æè¿°ã€‚ 11.1.1 ç»Ÿè®¡ç½‘ç«™å„é¡µé¢ä¸€å¤©å†…çš„ PVåœ¨ 9.5.2 èŠ‚ç«¯å¯¹ç«¯å¦‚ä½•ä¿è¯ Exactly Once ä¸­çš„å¹‚ç­‰æ€§å†™å…¥å¦‚ä½•ä¿è¯ç«¯å¯¹ç«¯ Exactly Once éƒ¨åˆ†å·²ç»ç”¨æ¡ˆä¾‹è®²è¿°äº†å¦‚ä½•é€šè¿‡ Flink çš„çŠ¶æ€æ¥è®¡ç®— APP çš„ PVï¼Œå¹¶èƒ½å¤Ÿä¿è¯ Exactly Onceã€‚å¦‚æœåœ¨å·¥ä½œä¸­éœ€è¦è®¡ç®—ç½‘ç«™å„é¡µé¢ä¸€å¤©å†…çš„ PVï¼Œåªéœ€è¦å°†æ¡ˆä¾‹ä¸­çš„ APP æ›¿æ¢æˆå„é¡µé¢çš„ id æˆ–è€…å„é¡µé¢çš„ url è¿›è¡Œç»Ÿè®¡å³å¯ï¼ŒæŒ‰ç…§å„é¡µé¢ id å’Œæ—¥æœŸç»„åˆåšä¸º key è¿›è¡Œ keyByï¼Œç›¸åŒé¡µé¢ã€ç›¸åŒæ—¥æœŸçš„æ•°æ®å‘é€åˆ°ç›¸åŒçš„å®ä¾‹ä¸­è¿›è¡Œ PV å€¼çš„ç´¯åŠ ï¼Œæ¯ä¸ª key å¯¹åº”ä¸€ä¸ª ValueStateï¼Œå°† PV å€¼ç»´æŠ¤åœ¨ ValueState å³å¯ã€‚å¦‚æœä¸€äº›é¡µé¢å±äºçˆ†æ¬¾é¡µé¢ï¼Œä¾‹å¦‚é¦–é¡µæˆ–è€…æ´»åŠ¨é¡µé¢è®¿é—®ç‰¹åˆ«é¢‘ç¹å°±å¯èƒ½å‡ºç°æŸäº› subtask ä¸Šçš„æ•°æ®é‡ç‰¹åˆ«å¤§ï¼Œå¯¼è‡´å„ä¸ª subtask ä¹‹å‰å‡ºç°æ•°æ®å€¾æ–œçš„é—®é¢˜ï¼Œå…³äºæ•°æ®å€¾æ–œçš„è§£å†³æ–¹æ¡ˆè¯·å‚è€ƒ 9.6 èŠ‚ã€‚ 11.1.2 ç»Ÿè®¡ç½‘ç«™å„é¡µé¢ä¸€å¤©å†… UV çš„ä¸‰ç§æ–¹æ¡ˆPV ç»Ÿè®¡ç›¸å¯¹æ¥è¯´æ¯”è¾ƒç®€å•ï¼Œæ¯æ¥ä¸€æ¡ç”¨æˆ·çš„è®¿é—®æ—¥å¿—åªéœ€è¦ä»æ—¥å¿—ä¸­æå–å‡ºç›¸åº”çš„é¡µé¢ id å’Œæ—¥æœŸï¼Œå°†å…¶å¯¹åº”çš„ PV å€¼åŠ ä¸€å³å¯ã€‚ç›¸å¯¹è€Œè¨€ç»Ÿè®¡ UV å°±æœ‰éš¾åº¦äº†ï¼ŒåŒä¸€ä¸ªç”¨æˆ·ä¸€å¤©å†…å¤šæ¬¡è®¿é—®åŒä¸€ä¸ªé¡µé¢ï¼Œåªèƒ½è®¡æ•°ä¸€æ¬¡ã€‚æ‰€ä»¥æ¯æ¥ä¸€æ¡æ—¥å¿—ï¼Œæ—¥å¿—ä¸­å¯¹åº”é¡µé¢çš„ UV å€¼æ˜¯å¦éœ€è¦åŠ ä¸€å‘¢ï¼Ÿå­˜åœ¨ä¸¤ç§æƒ…å†µï¼šå¦‚æœè¯¥ç”¨æˆ·ä»Šå¤©ç¬¬ä¸€æ¬¡è®¿é—®è¯¥é¡µé¢ï¼Œé‚£ä¹ˆ UV åº”è¯¥åŠ ä¸€ã€‚å¦‚æœè¯¥ç”¨æˆ·ä»Šå¤©ä¸æ˜¯ç¬¬ä¸€æ¬¡è®¿é—®è¯¥é¡µé¢ï¼Œè¡¨ç¤º UV ä¸­å·²ç»è®°å½•äº†è¯¥ç”¨æˆ·ï¼ŒUV è¦åŸºäºç”¨æˆ·å»é‡ï¼Œæ‰€ä»¥æ­¤æ—¶ UV å€¼ä¸åº”è¯¥åŠ ä¸€ã€‚éš¾ç‚¹å°±åœ¨äºå¦‚ä½•åˆ¤æ–­è¯¥ç”¨æˆ·ä»Šå¤©æ˜¯ä¸æ˜¯ç¬¬ä¸€æ¬¡è®¿é—®è¯¥é¡µé¢å‘¢ï¼Ÿ æŠŠé—®é¢˜ç®€å•åŒ–ï¼Œå…ˆä¸è€ƒè™‘æ—¥æœŸï¼Œç°åœ¨ç»Ÿè®¡ç½‘ç«™å„é¡µé¢çš„ç´¯ç§¯ UVï¼Œå¯ä»¥ä¸ºæ¯ä¸ªé¡µé¢ç»´æŠ¤ä¸€ä¸ª Set é›†åˆï¼Œå‡å¦‚ç½‘ç«™æœ‰ 10 ä¸ªé¡µé¢ï¼Œé‚£ä¹ˆå°±ç»´æŠ¤ 10 ä¸ª Set é›†åˆï¼Œé›†åˆä¸­å­˜æ”¾ç€æ‰€æœ‰è®¿é—®è¿‡è¯¥é¡µé¢ç”¨æˆ·çš„ user_idã€‚æ¯æ¥ä¸€æ¡ç”¨æˆ·çš„è®¿é—®æ—¥å¿—ï¼Œæˆ‘ä»¬éƒ½éœ€è¦ä»æ—¥å¿—ä¸­è§£æå‡ºç›¸åº”çš„é¡µé¢ id å’Œç”¨æˆ· user_idï¼Œå»è¯¥é¡µé¢ id å¯¹åº”çš„ Set ä¸­æŸ¥æ‰¾è¯¥ user_id ä¹‹å‰æœ‰æ²¡æœ‰è®¿é—®è¿‡è¯¥é¡µé¢ï¼Œå¦‚æœ Set ä¸­åŒ…å«è¯¥ user_id è¡¨ç¤ºè¯¥ç”¨æˆ·ä¹‹å‰è®¿é—®è¿‡è¯¥é¡µé¢ï¼Œæ‰€ä»¥è¯¥é¡µé¢çš„ UV å€¼ä¸åº”è¯¥åŠ ä¸€ï¼Œå¦‚æœ Set ä¸­ä¸åŒ…å«è¯¥ user_id è¡¨ç¤ºè¯¥ç”¨æˆ·ä¹‹å‰æ²¡æœ‰è®¿é—®è¿‡è¯¥é¡µé¢ï¼Œæ‰€ä»¥è¯¥é¡µé¢çš„ UV å€¼åº”è¯¥åŠ ä¸€ï¼Œå¹¶ä¸”å°†è¯¥ user_id æ’å…¥åˆ°è¯¥é¡µé¢å¯¹åº”çš„ Set ä¸­ï¼Œè¡¨ç¤ºè¯¥ç”¨æˆ·è®¿é—®è¿‡è¯¥é¡µé¢äº†ã€‚è¦æŒ‰å¤©å»ç»Ÿè®¡å„é¡µé¢ UVï¼Œåªéœ€è¦å°†æ—¥æœŸå’Œé¡µé¢ id çœ‹åšä¸€ä¸ªæ•´ä½“ keyï¼Œæ¯ä¸ª key å¯¹åº”ä¸€ä¸ª Setï¼Œå…¶ä»–æµç¨‹ä¸ä¸Šè¿°ç±»ä¼¼ã€‚å…·ä½“çš„ç¨‹åºæµç¨‹å›¾å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ ä½¿ç”¨ Redis çš„ set æ¥ç»´æŠ¤ç”¨æˆ·é›†åˆæ¯ä¸ª key éƒ½éœ€è¦ç»´æŠ¤ä¸€ä¸ª Setï¼Œè¿™ä¸ª Set å­˜æ”¾åœ¨å“ªé‡Œå‘¢ï¼Ÿè¿™é‡Œæ¯æ¡æ—¥å¿—éƒ½éœ€è¦è®¿é—®ä¸€æ¬¡ Setï¼Œå¯¹ Set è®¿é—®æ¯”è¾ƒé¢‘ç¹ï¼Œå¯¹å­˜å‚¨ä»‹è´¨çš„å»¶è¿Ÿè¦æ±‚æ¯”è¾ƒé«˜ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ Redis çš„ set æ•°æ®ç»“æ„ï¼ŒRedis çš„ set æ•°æ®ç»“æ„ä¹Ÿä¼šå¯¹æ•°æ®è¿›è¡Œå»é‡ã€‚å¯ä»¥å°†é¡µé¢ id å’Œæ—¥æœŸæ‹¼æ¥åšä¸º Redis çš„ keyï¼Œé€šè¿‡ Redis çš„ sadd å‘½ä»¤å°† user_id æ”¾åˆ° key å¯¹åº”çš„ set ä¸­å³å¯ã€‚Redis çš„ set ä¸­å­˜æ”¾ç€ä»Šå¤©è®¿é—®è¿‡è¯¥é¡µé¢æ‰€æœ‰ç”¨æˆ·çš„ user_idã€‚ åœ¨çœŸå®çš„å·¥ä½œä¸­ï¼ŒFlink ä»»åŠ¡å¯èƒ½ä¸éœ€è¦ç»´æŠ¤ä¸€ä¸ª UV å€¼ï¼ŒFlink ä»»åŠ¡æ‰¿æ‹…çš„è§’è‰²æ˜¯å®æ—¶è®¡ç®—ï¼Œè€ŒæŸ¥è¯¢ UV å¯èƒ½æ˜¯ä¸€ä¸ª Java Web é¡¹ç›®ã€‚Web é¡¹ç›®åªéœ€è¦å» Redis æŸ¥è¯¢ç›¸åº” key å¯¹åº”çš„ set ä¸­å…ƒç´ çš„ä¸ªæ•°å³å¯ï¼ŒRedis çš„ set æ•°æ®ç»“æ„æœ‰ scard å‘½ä»¤å¯ä»¥æŸ¥è¯¢ set ä¸­å…ƒç´ ä¸ªæ•°ï¼Œè¿™é‡Œçš„å…ƒç´ ä¸ªæ•°å°±æ˜¯æˆ‘ä»¬æ‰€è¦ç»Ÿè®¡çš„ç½‘ç«™å„é¡µé¢æ¯å¤©çš„ UV å€¼ã€‚æ‰€ä»¥ä½¿ç”¨ Redis set æ•°æ®ç»“æ„çš„æ–¹æ¡ˆ Flink ä»»åŠ¡çš„ä»£ç å¾ˆç®€å•ï¼Œåªéœ€è¦ä»æ—¥å¿—ä¸­è§£æå‡ºç›¸åº”çš„æ—¥æœŸã€é¡µé¢id å’Œ user_idï¼Œå°†æ—¥æœŸå’Œé¡µé¢ id ç»„åˆåšä¸º Redis çš„ keyï¼Œæœ€åå°† user_id é€šè¿‡ sadd å‘½ä»¤æ·»åŠ åˆ° set ä¸­ï¼ŒFlink ä»»åŠ¡çš„å·¥ä½œå°±ç»“æŸäº†ï¼Œä¹‹å Web é¡¹ç›®å°±èƒ½ä» Redis ä¸­æŸ¥è¯¢åˆ°å®æ—¶å¢åŠ çš„ UV äº†ã€‚ä¸‹é¢æ¥çœ‹è¯¦ç»†çš„ä»£ç å®ç°ã€‚ ç”¨æˆ·è®¿é—®ç½‘ç«™é¡µé¢çš„æ—¥å¿—å®ä½“ç±»ï¼š 123456789101112public class UserVisitWebEvent &#123; // æ—¥å¿—çš„å”¯ä¸€ id private String id; // æ—¥æœŸï¼Œå¦‚ï¼š20191025 private String date; // é¡µé¢ id private Integer pageId; // ç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†ï¼Œç”¨æˆ· id private String userId; // é¡µé¢çš„ url private String url;&#125; ç”Ÿæˆæµ‹è¯•æ•°æ®çš„æ ¸å¿ƒä»£ç å¦‚ä¸‹: 123456789101112131415String yyyyMMdd = new DateTime(System.currentTimeMillis()).toString(\"yyyyMMdd\");int pageId = random.nextInt(10); // éšæœºç”Ÿæˆé¡µé¢ idint userId = random.nextInt(100); // éšæœºç”Ÿæˆç”¨æˆ· idUserVisitWebEvent userVisitWebEvent = UserVisitWebEvent.builder() .id(UUID.randomUUID().toString()) // æ—¥å¿—çš„å”¯ä¸€ id .date(yyyyMMdd) // æ—¥æœŸ .pageId(pageId) // é¡µé¢ id .userId(Integer.toString(userId)) // ç”¨æˆ· id .url(\"url/\" + pageId) // é¡µé¢çš„ url .build();// å¯¹è±¡åºåˆ—åŒ–ä¸º JSON å‘é€åˆ° KafkaProducerRecord record = new ProducerRecord&lt;String, String&gt;(topic, null, null, GsonUtil.toJson(userVisitWebEvent));producer.send(record); ç»Ÿè®¡ UV çš„æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼Œå¯¹ Redis Connector ä¸ç†Ÿæ‚‰çš„è¯·å‚é˜… 3.11 èŠ‚å¦‚ä½•ä½¿ç”¨ Flink Connectors â€”â€” Redisï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950public class RedisSetUvExample &#123; public static void main(String[] args) throws Exception &#123; // çœç•¥äº† envåˆå§‹åŒ–åŠ Checkpoint ç›¸å…³é…ç½® Properties props = new Properties(); props.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, UvExampleUtil.broker_list); props.put(ConsumerConfig.GROUP_ID_CONFIG, \"app-uv-stat\"); FlinkKafkaConsumerBase&lt;String&gt; kafkaConsumer = new FlinkKafkaConsumer011&lt;&gt;( UvExampleUtil.topic, new SimpleStringSchema(), props) .setStartFromLatest(); FlinkJedisPoolConfig conf = new FlinkJedisPoolConfig .Builder().setHost(\"192.168.30.244\").build(); env.addSource(kafkaConsumer) .map(string -&gt; &#123; // ååºåˆ—åŒ– JSON UserVisitWebEvent userVisitWebEvent = GsonUtil.fromJson( string, UserVisitWebEvent.class); // ç”Ÿæˆ Redis keyï¼Œæ ¼å¼ä¸º æ—¥æœŸ_pageIdï¼Œå¦‚: 20191026_0 String redisKey = userVisitWebEvent.getDate() + \"_\" + userVisitWebEvent.getPageId(); return Tuple2.of(redisKey, userVisitWebEvent.getUserId()); &#125;) .returns(new TypeHint&lt;Tuple2&lt;String, String&gt;&gt;()&#123;&#125;) .addSink(new RedisSink&lt;&gt;(conf, new RedisSaddSinkMapper())); env.execute(\"Redis Set UV Stat\"); &#125; // æ•°æ®ä¸ Redis key çš„æ˜ å°„å…³ç³» public static class RedisSaddSinkMapper implements RedisMapper&lt;Tuple2&lt;String, String&gt;&gt; &#123; @Override public RedisCommandDescription getCommandDescription() &#123; // è¿™é‡Œå¿…é¡»æ˜¯ sadd æ“ä½œ return new RedisCommandDescription(RedisCommand.SADD); &#125; @Override public String getKeyFromData(Tuple2&lt;String, String&gt; data) &#123; return data.f0; &#125; @Override public String getValueFromData(Tuple2&lt;String, String&gt; data) &#123; return data.f1; &#125; &#125;&#125; Redis ä¸­ç»Ÿè®¡ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå·¦ä¾§å±•ç¤ºçš„ Redis keyï¼Œ20191026_1 è¡¨ç¤º 2019å¹´10æœˆ26æ—¥æµè§ˆè¿‡ pageId ä¸º 1 çš„é¡µé¢å¯¹åº”çš„ keyï¼Œå³ä¾§å±•ç¤º key å¯¹åº”çš„ set é›†åˆï¼Œè¡¨ç¤º userId ä¸º [0,6,27,30,66,67,79,88] çš„ç”¨æˆ·åœ¨ 2019å¹´10æœˆ26æ—¥æµè§ˆè¿‡ pageId ä¸º 1 çš„é¡µé¢ã€‚ è¦æƒ³è·å– 20191026_1 å¯¹åº”çš„ UV å€¼ï¼Œå¯é€šè¿‡ scard å‘½ä»¤è·å– set ä¸­ user_id çš„æ•°é‡ï¼Œå…·ä½“æ“ä½œå¦‚ä¸‹æ‰€ç¤ºï¼š 12redis&gt; scard 20191026_18 é€šè¿‡ä¸Šè¿°ä»£ç å³å¯é€šè¿‡ Redis çš„ set æ•°æ®ç»“æ„æ¥ç»Ÿè®¡ç½‘ç«™å„é¡µé¢çš„ UVã€‚ ä½¿ç”¨ Flink çš„ KeyedState æ¥ç»´æŠ¤ç”¨æˆ·é›†åˆä½¿ç”¨ Redis çš„ HyperLogLog æ¥ç»Ÿè®¡ UV11.1.3 å°ç»“ä¸åæ€åŠ å…¥çŸ¥è¯†æ˜Ÿçƒå¯ä»¥çœ‹åˆ°ä¸Šé¢æ–‡ç« ï¼šhttps://t.zsxq.com/RBYj66M","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹â€”â€” å¦‚ä½•è®¾ç½® Flink Job RestartStrategyï¼ˆé‡å¯ç­–ç•¥ï¼‰ï¼Ÿ","date":"2021-08-12T16:00:00.000Z","path":"2021/08/13/flink-in-action-10.2/","text":"10.2 å¦‚ä½•ä½¿ç”¨ Flink ParameterTool è¯»å–é…ç½®ï¼Ÿåœ¨ä½¿ç”¨ Flink ä¸­ä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰è§‰å¾—é…ç½®çš„ç®¡ç†å¾ˆä¸æ–¹ä¾¿ï¼Œæ¯”å¦‚åƒç®—å­çš„å¹¶è¡Œåº¦é…ç½®ã€Kafka æ•°æ®æºçš„é…ç½®ï¼ˆbroker åœ°å€ã€topic åã€group.idï¼‰ã€Checkpoint æ˜¯å¦å¼€å¯ã€çŠ¶æ€åç«¯å­˜å‚¨è·¯å¾„ã€æ•°æ®åº“åœ°å€ã€ç”¨æˆ·åå’Œå¯†ç ç­‰ï¼Œåæ­£å„ç§å„æ ·çš„é…ç½®éƒ½æ‚ä¹±åœ¨ä¸€èµ·ï¼Œå½“ç„¶ä½ å¯èƒ½è¯´æˆ‘å°±åœ¨ä»£ç é‡Œé¢å†™æ­»ä¸å°±å¥½äº†ï¼Œä½†æ˜¯ä½ æœ‰æ²¡æœ‰æƒ³è¿‡ä½ çš„ä½œä¸šæ˜¯å¦å¯ä»¥ä¸ä¿®æ”¹ä»»ä½•é…ç½®å°±ç›´æ¥åœ¨å„ç§ç¯å¢ƒï¼ˆå¼€å‘ã€æµ‹è¯•ã€é¢„å‘ã€ç”Ÿäº§ï¼‰è¿è¡Œå‘¢ï¼Ÿå¯èƒ½æ¯ä¸ªç¯å¢ƒçš„è¿™äº›é…ç½®å¯¹åº”çš„å€¼éƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œå¦‚æœä½ æ˜¯ç›´æ¥åœ¨ä»£ç é‡Œé¢å†™æ­»çš„é…ç½®ï¼Œé‚£è¿™ä¸‹å­å°±æ¯”è¾ƒç—›è‹¦äº†ï¼Œæ¯æ¬¡æ¢ä¸ªç¯å¢ƒå»è¿è¡Œæµ‹è¯•ä½ çš„ä½œä¸šï¼Œä½ éƒ½è¦é‡æ–°å»ä¿®æ”¹ä»£ç ä¸­çš„é…ç½®ï¼Œç„¶åç¼–è¯‘æ‰“åŒ…ï¼Œæäº¤è¿è¡Œï¼Œè¿™æ ·ä½ å°±è¦èŠ±è´¹å¾ˆå¤šæ—¶é—´åœ¨è¿™äº›é‡å¤çš„åŠ³åŠ¨åŠ›ä¸Šäº†ã€‚æœ‰æ²¡æœ‰ä»€ä¹ˆåŠæ³•å¯ä»¥è§£å†³è¿™ç§é—®é¢˜å‘¢ï¼Ÿ 10.2.1 Flink Job é…ç½®åœ¨ Flink ä¸­å…¶å®æ˜¯æœ‰å‡ ç§æ–¹æ³•æ¥ç®¡ç†é…ç½®ï¼Œä¸‹é¢åˆ†åˆ«æ¥è®²è§£ä¸€ä¸‹ã€‚ ä½¿ç”¨ ConfigurationFlink æä¾›äº† withParameters æ–¹æ³•ï¼Œå®ƒå¯ä»¥ä¼ é€’ Configuration ä¸­çš„å‚æ•°ç»™ï¼Œè¦ä½¿ç”¨å®ƒï¼Œéœ€è¦å®ç°é‚£äº› Rich å‡½æ•°ï¼Œæ¯”å¦‚å®ç° RichMapFunctionï¼Œè€Œä¸æ˜¯ MapFunctionï¼Œå› ä¸º Rich å‡½æ•°ä¸­æœ‰ open æ–¹æ³•ï¼Œç„¶åå¯ä»¥é‡å†™ open æ–¹æ³•é€šè¿‡ Configuration è·å–åˆ°ä¼ å…¥çš„å‚æ•°å€¼ã€‚ 12345678910111213141516171819202122232425262728ExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment();// Configuration ç±»æ¥å­˜å‚¨å‚æ•°Configuration configuration = new Configuration();configuration.setString(\"name\", \"zhisheng\");env.fromElements(WORDS) .flatMap(new RichFlatMapFunction&lt;String, Tuple2&lt;String, Integer&gt;&gt;() &#123; String name; @Override public void open(Configuration parameters) throws Exception &#123; //è¯»å–é…ç½® name = parameters.getString(\"name\", \"\"); &#125; @Override public void flatMap(String value, Collector&lt;Tuple2&lt;String, Integer&gt;&gt; out) throws Exception &#123; String[] splits = value.toLowerCase().split(\"\\\\W+\"); for (String split : splits) &#123; if (split.length() &gt; 0) &#123; out.collect(new Tuple2&lt;&gt;(split + name, 1)); &#125; &#125; &#125; &#125;).withParameters(configuration) //å°†å‚æ•°ä¼ é€’ç»™å‡½æ•° .print(); ä½†æ˜¯è¦æ³¨æ„è¿™ä¸ª withParameters åªåœ¨æ‰¹ç¨‹åºä¸­æ”¯æŒï¼Œæµç¨‹åºä¸­æ˜¯æ²¡æœ‰è¯¥æ–¹æ³•çš„ï¼Œå¹¶ä¸”è¿™ä¸ª withParameters è¦åœ¨æ¯ä¸ªç®—å­åé¢ä½¿ç”¨æ‰è¡Œï¼Œå¹¶ä¸æ˜¯ä¸€æ¬¡ä½¿ç”¨å°±æ‰€æœ‰éƒ½å¯ä»¥è·å–åˆ°ï¼Œå¦‚æœæ‰€æœ‰ç®—å­éƒ½è¦è¯¥é…ç½®ï¼Œé‚£ä¹ˆå°±é‡å¤è®¾ç½®å¤šæ¬¡å°±ä¼šæ¯”è¾ƒç¹çã€‚ 10.2.2 ParameterTool ç®¡ç†é…ç½®ä¸Šé¢é€šè¿‡ Configuration çš„å±€é™æ€§å¾ˆå¤§ï¼Œå…¶å®åœ¨ Flink ä¸­è¿˜å¯ä»¥é€šè¿‡ä½¿ç”¨ ParameterTool ç±»è¯»å–é…ç½®ï¼Œå®ƒå¯ä»¥è¯»å–ç¯å¢ƒå˜é‡ã€è¿è¡Œå‚æ•°ã€é…ç½®æ–‡ä»¶ï¼Œä¸‹é¢åˆ†åˆ«è®²ä¸‹æ¯ç§å¦‚ä½•ä½¿ç”¨ã€‚ è¯»å–è¿è¡Œå‚æ•°æˆ‘ä»¬çŸ¥é“ Flink UI ä¸Šæ˜¯æ”¯æŒä¸ºæ¯ä¸ª Job å•ç‹¬ä¼ å…¥ argumentsï¼ˆå‚æ•°ï¼‰çš„ï¼Œå®ƒçš„æ ¼å¼è¦æ±‚æ˜¯å¦‚ä¸‹è¿™ç§ã€‚ 123--brokers 127.0.0.1:9200--username admin--password 123456 æˆ–è€…è¿™ç§ 123-brokers 127.0.0.1:9200-username admin-password 123456 ç„¶ååœ¨ Flink ç¨‹åºä¸­ä½ å¯ä»¥ç›´æ¥ä½¿ç”¨ ParameterTool.fromArgs(args) è·å–åˆ°æ‰€æœ‰çš„å‚æ•°ï¼Œç„¶åå¦‚æœä½ è¦è·å–æŸä¸ªå‚æ•°å¯¹åº”çš„å€¼çš„è¯ï¼Œå¯ä»¥é€šè¿‡ parameterTool.get(&quot;username&quot;) æ–¹æ³•ã€‚é‚£ä¹ˆåœ¨è¿™ä¸ªåœ°æ–¹å…¶å®ä½ å°±å¯ä»¥å°†é…ç½®æ”¾åœ¨ä¸€ä¸ªç¬¬ä¸‰æ–¹çš„æ¥å£ï¼Œç„¶åè¿™ä¸ªå‚æ•°å€¼ä¸­ä¼ å…¥ä¸€ä¸ªæ¥å£ï¼Œæ‹¿åˆ°è¯¥æ¥å£åå°±èƒ½å¤Ÿé€šè¿‡è¯·æ±‚å»è·å–æ›´å¤šä½ æƒ³è¦çš„é…ç½®ã€‚ è¯»å–ç³»ç»Ÿå±æ€§ParameterTool è¿˜æ”¯æŒé€šè¿‡ ParameterTool.fromSystemProperties() æ–¹æ³•è¯»å–ç³»ç»Ÿå±æ€§ã€‚ è¯»å–é…ç½®æ–‡ä»¶é™¤äº†ä¸Šé¢ä¸¤ç§å¤–ï¼ŒParameterTool è¿˜æ”¯æŒ ParameterTool.fromPropertiesFile(&quot;/application.properties&quot;) è¯»å– properties é…ç½®æ–‡ä»¶ã€‚ä½ å¯ä»¥å°†æ‰€æœ‰è¦é…ç½®çš„åœ°æ–¹ï¼ˆæ¯”å¦‚å¹¶è¡Œåº¦å’Œä¸€äº› Kafkaã€MySQL ç­‰é…ç½®ï¼‰éƒ½å†™æˆå¯é…ç½®çš„ï¼Œç„¶åå…¶å¯¹åº”çš„ key å’Œ value å€¼éƒ½å†™åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œæœ€åé€šè¿‡ ParameterTool å»è¯»å–é…ç½®æ–‡ä»¶è·å–å¯¹åº”çš„å€¼ã€‚ ParameterTool è·å–å€¼ParameterTool ç±»æä¾›äº†å¾ˆå¤šä¾¿æ·æ–¹æ³•å»è·å–å€¼ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ ä½ å¯ä»¥åœ¨åº”ç”¨ç¨‹åºçš„ main() æ–¹æ³•ä¸­ç›´æ¥ä½¿ç”¨è¿™äº›æ–¹æ³•è¿”å›çš„å€¼ï¼Œä¾‹å¦‚ï¼šä½ å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹æ³•æ¥è®¾ç½®ä¸€ä¸ªç®—å­çš„å¹¶è¡Œåº¦ï¼š 123ParameterTool parameters = ParameterTool.fromArgs(args);int parallelism = parameters.get(\"mapParallelism\", 2);DataStream&lt;Tuple2&lt;String, Integer&gt;&gt; counts = data.flatMap(new Tokenizer()).setParallelism(parallelism); å› ä¸º ParameterTool æ˜¯å¯åºåˆ—åŒ–çš„ï¼Œæ‰€ä»¥ä½ å¯ä»¥å°†å®ƒå½“ä½œå‚æ•°è¿›è¡Œä¼ é€’ç»™è‡ªå®šä¹‰çš„å‡½æ•°ã€‚ 12ParameterTool parameters = ParameterTool.fromArgs(args);DataStream&lt;Tuple2&lt;String, Integer&gt;&gt; counts = dara.flatMap(new Tokenizer(parameters)); ç„¶ååœ¨å‡½æ•°å†…éƒ¨ä½¿ç”¨ ParameterTool æ¥è·å–å‘½ä»¤è¡Œå‚æ•°ï¼Œè¿™æ ·å°±æ„å‘³ç€ä½ åœ¨ä½œä¸šä»»ä½•åœ°æ–¹éƒ½å¯ä»¥è·å–åˆ°å‚æ•°ï¼Œè€Œä¸æ˜¯åƒ withParameters ä¸€æ ·éœ€è¦æ¯æ¬¡éƒ½è®¾ç½®ã€‚ æ³¨å†Œå…¨å±€å‚æ•°åœ¨ ExecutionConfig ä¸­å¯ä»¥å°† ParameterTool æ³¨å†Œä¸ºå…¨ä½œä¸šå‚æ•°çš„å‚æ•°ï¼Œè¿™æ ·å°±å¯ä»¥è¢« JobManager çš„ web ç«¯ä»¥åŠç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ä¸­ä»¥é…ç½®å€¼çš„å½¢å¼è®¿é—®ã€‚ 12StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();env.getConfig().setGlobalJobParameters(ParameterTool.fromArgs(args)); ç„¶åå°±å¯ä»¥åœ¨ç”¨æˆ·è‡ªå®šä¹‰çš„ Rich å‡½æ•°ä¸­åƒå¦‚ä¸‹è¿™æ ·è·å–åˆ°å‚æ•°å€¼äº†ã€‚ 12345678910111213env.addSource(new RichSourceFunction&lt;String&gt;() &#123; @Override public void run(SourceContext&lt;String&gt; sourceContext) throws Exception &#123; while (true) &#123; ParameterTool parameterTool = (ParameterTool) getRuntimeContext().getExecutionConfig().getGlobalJobParameters(); sourceContext.collect(System.currentTimeMillis() + parameterTool.get(\"os.name\") + parameterTool.get(\"user.home\")); &#125; &#125; @Override public void cancel() &#123; &#125;&#125;) åœ¨ç¬”è€…å…¬å¸å†…é€šå¸¸æ˜¯ä»¥ Job è¿è¡Œçš„ç¯å¢ƒå˜é‡ä¸ºå‡†ï¼Œæ¯”å¦‚æˆ‘ä»¬æ˜¯è¿è¡Œåœ¨ K8s ä¸Šé¢ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¼šä¸ºæˆ‘ä»¬çš„è¿™ä¸ª Flink Job è®¾ç½®å¾ˆå¤šç¯å¢ƒå˜é‡ï¼Œè®¾ç½®çš„ç¯å¢ƒå˜é‡çš„å€¼å°±å¾—é€šè¿‡ ParameterTool ç±»å»è·å–ï¼Œæˆ‘ä»¬æ˜¯ä¼šä¼˜å…ˆæ ¹æ®ç¯å¢ƒå˜é‡çš„å€¼ä¸ºå‡†ï¼Œå¦‚æœç¯å¢ƒå˜é‡çš„å€¼æ²¡æœ‰å°±ä¼šå»è¯»å–åº”ç”¨è¿è¡Œå‚æ•°ï¼Œå¦‚æœåº”ç”¨è¿è¡Œå‚æ•°ä¹Ÿæ²¡æœ‰æ‰ä¼šå»è¯»å–ä¹‹å‰å·²ç»å†™å¥½åœ¨é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®ã€‚å¤§æ¦‚ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516public static ParameterTool createParameterTool(final String[] args) throws Exception &#123; return ParameterTool .fromPropertiesFile(ExecutionEnv.class.getResourceAsStream(\"/application.properties\")) .mergeWith(ParameterTool.fromArgs(args)) .mergeWith(ParameterTool.fromSystemProperties()) .mergeWith(ParameterTool.fromMap(getenv()));// mergeWith ä¼šä½¿ç”¨æœ€æ–°çš„é…ç½®&#125;//è·å– Job è®¾ç½®çš„ç¯å¢ƒå˜é‡private static Map&lt;String, String&gt; getenv() &#123; Map&lt;String, String&gt; map = new HashMap&lt;&gt;(); for (Map.Entry&lt;String, String&gt; entry : System.getenv().entrySet()) &#123; map.put(entry.getKey().toLowerCase().replace('_', '.'), entry.getValue()); &#125; return map;&#125; è¿™æ ·å¦‚æœ Job è¦æ›´æ”¹ä¸€äº›é…ç½®ï¼Œç›´æ¥åœ¨ Job åœ¨ K8s ä¸Šé¢çš„ç¯å¢ƒå˜é‡è¿›è¡Œé…ç½®å°±å¥½äº†ï¼Œä¿®æ”¹é…ç½®åç„¶åé‡å¯ Job å°±å¯ä»¥è¿è¡Œèµ·æ¥äº†ï¼Œæ•´ä¸ªè¿‡ç¨‹éƒ½ä¸éœ€è¦å†æ¬¡å°†ä½œä¸šé‡æ–°ç¼–è¯‘æ‰“åŒ…çš„ã€‚ä½†æ˜¯è¿™æ ·å…¶å®ä¹Ÿæœ‰ä¸€å®šçš„åå¤„ï¼Œé‡å¯ä¸€ä¸ªä½œä¸šçš„ä»£ä»·å¾ˆå¤§ï¼Œå› ä¸ºåœ¨é‡å¯åä½ åˆè¦å»ä¿è¯çŠ¶æ€è¦æ¢å¤åˆ°ä¹‹å‰æœªé‡å¯æ—¶çš„çŠ¶æ€ï¼Œå°½ç®¡ Flink ä¸­çš„ Checkpoint å’Œ Savepoint å·²ç»å¾ˆå¼ºå¤§äº†ï¼Œä½†æ˜¯å¯¹äºå¤æ‚çš„å®ƒæ¥è¯´æˆ‘ä»¬å¤šä¸€äº‹ä¸å¦‚å°‘ä¸€äº‹ï¼Œæ‰€ä»¥å…¶å®æ›´å¸Œæœ›èƒ½å¤Ÿç›´æ¥åŠ¨æ€çš„è·å–é…ç½®ï¼Œå¦‚æœé…ç½®åšäº†æ›´æ”¹ï¼Œä½œä¸šèƒ½å¤Ÿæ„ŸçŸ¥åˆ°ã€‚åœ¨ Flink ä¸­æœ‰çš„é…ç½®æ˜¯ä¸èƒ½å¤ŸåŠ¨æ€è®¾ç½®çš„ï¼Œä½†æ˜¯æ¯”å¦‚åº”ç”¨ä¸šåŠ¡é…ç½®å´æ˜¯å¯ä»¥åšåˆ°åŠ¨æ€çš„é…ç½®ï¼Œè¿™æ—¶å°±éœ€è¦ä½¿ç”¨æ¯”è¾ƒå¼ºå¤§çš„å¹¿æ’­å˜é‡ï¼Œå¹¿æ’­å˜é‡åœ¨ä¹‹å‰ 3.4 èŠ‚å·²ç»ä»‹ç»è¿‡äº†ï¼Œå¦‚æœå¿˜è®°å¯ä»¥å†å›å»æŸ¥çœ‹ï¼Œå¦å¤–åœ¨ 11.4 èŠ‚ä¸­ä¼šé€šè¿‡ä¸€ä¸ªå®é™…æ¡ˆä¾‹æ¥æ•™ä½ å¦‚ä½•ä½¿ç”¨å¹¿æ’­å˜é‡å»åŠ¨æ€çš„æ›´æ–°é…ç½®æ•°æ®ã€‚ 10.2.3 ParameterTool æºç åˆ†æ10.2.4 è‡ªå®šä¹‰é…ç½®å‚æ•°ç±»10.2.5 å°ç»“ä¸åæ€åŠ å…¥çŸ¥è¯†æ˜Ÿçƒå¯ä»¥çœ‹åˆ°ä¸Šé¢æ–‡ç« ï¼šhttps://t.zsxq.com/RBYj66M æœ¬ç« è®²äº†ä¸¤ä¸ªå®è·µç›¸å…³çš„å†…å®¹ï¼Œä¸€ä¸ªæ˜¯ä½œä¸šçš„é‡å¯ç­–ç•¥ï¼Œä»åˆ†æçœŸå®çº¿ä¸Šæ•…éšœæ¥æ•™å¤§å®¶å¦‚ä½•å»é…ç½®é‡å¯ç­–ç•¥ï¼Œä»¥åŠä»‹ç»é‡å¯ç­–ç•¥çš„ç§ç±»ï¼Œå¦ä¸€ä¸ªæ˜¯ä½¿ç”¨ ParameterTool å»ç®¡ç†é…ç½®ã€‚ä¸¤ä¸ªå®è·µéƒ½æ˜¯æ¯”è¾ƒçœŸå®ä¸”æœ‰ä¸€å®šå¸®åŠ©ä½œç”¨çš„ï¼Œå¸Œæœ›ä½ ä¹Ÿå¯ä»¥åº”ç”¨åœ¨ä½ çš„é¡¹ç›®ä¸­å»ã€‚","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹â€”â€” å¦‚ä½•è®¾ç½® Flink Job RestartStrategyï¼ˆé‡å¯ç­–ç•¥ï¼‰ï¼Ÿ","date":"2021-08-11T16:00:00.000Z","path":"2021/08/12/flink-in-action-10.1/","text":"ç¬¬åç«  â€”â€” Flink æœ€ä½³å®è·µæœ¬ç« å°†ä»‹ç»ä¸¤ä¸ªæœ€ä½³å®è·µï¼Œç¬¬ä¸€ä¸ªæ˜¯å¦‚ä½•åˆç†çš„é…ç½®é‡å¯ç­–ç•¥ï¼Œç¬”è€…é€šè¿‡è‡ªå·±çš„äº²èº«ç»å†æ¥è®²è¿°é…ç½®é‡å¯ç­–ç•¥çš„é‡è¦æ€§ï¼Œæ¥ç€ä»‹ç»äº† Flink ä¸­çš„é‡å¯ç­–ç•¥å’Œæ¢å¤ç­–ç•¥çš„å‘å±•å®ç°è¿‡ç¨‹ï¼›ç¬¬äºŒä¸ªæ˜¯å¦‚ä½•å»ç®¡ç† Flink ä½œä¸šçš„é…ç½®ã€‚ä¸¤ä¸ªå®è·µå¤§å®¶å¯ä»¥å‚è€ƒï¼Œä¸ä¸€å®šè¦ç…§æ¬è¿ç”¨åœ¨è‡ªå·±çš„å…¬å¸ï¼ŒåŒæ—¶ä¹Ÿå¸Œæœ›ä½ å¯ä»¥æ€è€ƒä¸‹è‡ªå·±æ˜¯å¦æœ‰å•¥æœ€ä½³å®è·µå¯ä»¥åˆ†äº«ã€‚ 10.1 å¦‚ä½•è®¾ç½® Flink Job RestartStrategyï¼ˆé‡å¯ç­–ç•¥ï¼‰ï¼Ÿä»ä½¿ç”¨ Flink åˆ°è‡³ä»Šï¼Œé‡åˆ°çš„ Flink æœ‰å¾ˆå¤šï¼Œè§£å†³çš„é—®é¢˜æ›´å¤šï¼ˆå«å¸®åŠ©å¾®ä¿¡å¥½å‹è§£å†³é—®é¢˜ï¼‰ï¼Œæ‰€ä»¥å¯¹äº Flink å¯èƒ½é‡åˆ°çš„é—®é¢˜åŠè§£å†³åŠæ³•éƒ½æ¯”è¾ƒæ¸…æ¥šï¼Œé‚£ä¹ˆåœ¨è¿™ç« å°±ç»™å¤§å®¶è®²è§£ä¸‹å‡ ä¸ª Flink ä¸­æ¯”è¾ƒå¸¸é‡åˆ°çš„é—®é¢˜çš„è§£å†³åŠæ³•ã€‚ 10.1.1 å¸¸è§é”™è¯¯å¯¼è‡´ Flink ä½œä¸šé‡å¯ä¸çŸ¥é“å¤§å®¶æ˜¯å¦æœ‰é‡åˆ°è¿‡è¿™æ ·çš„é—®é¢˜ï¼šæ•´ä¸ª Job ä¸€ç›´åœ¨é‡å¯ï¼Œå¹¶ä¸”è¿˜ä¼šä¼´éšç€ä¸€äº›é”™è¯¯ï¼ˆå¯ä»¥é€šè¿‡ UI æŸ¥çœ‹ Exceptions æ—¥å¿—ï¼‰ï¼Œä»¥ä¸‹ä¸‰å¼ å›¾ç‰‡ä¸­çš„é”™è¯¯ä¿¡æ¯æ˜¯ç¬”è€…æ›¾ç»ç”Ÿäº§ç¯å¢ƒé‡åˆ°è¿‡çš„ä¸€äº›é—®é¢˜ã€‚ ç¬”è€…å°±æ›¾å› ä¸ºä¸Šå›¾ä¸­çš„ä¸€ä¸ªå¼‚å¸¸æŠ¥é”™ï¼Œä½œä¸šä¸€ç›´é‡å¯ï¼Œåœ¨æ·±å¤œçº¿ä¸Šå‘ç‰ˆçš„æ—¶å€™ï¼ŒåŒäº‹å‘ç°è¿™ä¸ªé—®é¢˜ï¼Œå‡Œæ™¨ä¸¤ç‚¹çš„æ—¶å€™æ‰“ç”µè¯æŠŠæˆ‘å«é†’èµ·æ¥ä¿® BUGï¼ŒçœŸæ˜¯æƒ¨çš„æ•™è®­ï¼Œå“ˆå“ˆå“ˆï¼Œä¼°è®¡è¿™è¾ˆå­éƒ½å¿˜ä¸æ‰äº†ï¼ å…¶å®é‡åˆ°ä¸Šé¢è¿™ç§é—®é¢˜æ¯”è¾ƒå¸¸è§çš„ï¼Œæ¯”å¦‚æœ‰æ—¶å€™å› ä¸ºæ•°æ®çš„é—®é¢˜ï¼ˆä¸åˆè§„èŒƒã€ä¸º null ç­‰ï¼‰ï¼Œè¿™æ—¶åœ¨å¤„ç†è¿™äº›è„æ•°æ®çš„æ—¶å€™å¯èƒ½å°±ä¼šé‡åˆ°å„ç§å„æ ·çš„å¼‚å¸¸é”™è¯¯ï¼Œæ¯”å¦‚ç©ºæŒ‡é’ˆã€æ•°ç»„è¶Šç•Œã€æ•°æ®ç±»å‹è½¬æ¢é”™è¯¯ç­‰ã€‚å¯èƒ½ä½ ä¼šè¯´åªè¦è¿‡æ»¤æ‰è¿™ç§è„æ•°æ®å°±è¡Œäº†ï¼Œæˆ–è€…è¿›è¡Œå¼‚å¸¸æ•è·å°±ä¸ä¼šå¯¼è‡´ Job ä¸æ–­é‡å¯çš„é—®é¢˜äº†ã€‚ ç¡®å®å¦‚æ­¤ï¼Œå¦‚æœåšå¥½äº†è„æ•°æ®çš„è¿‡æ»¤å’Œå¼‚å¸¸çš„æ•è·ï¼ŒJob çš„ç¨³å®šæ€§ç¡®å®æœ‰ä¿è¯ï¼Œä½†æ˜¯å¤æ‚çš„ Job ä¸‹æ¯ä¸ªç®—å­å¯èƒ½éƒ½ä¼šäº§ç”Ÿå‡ºè„æ•°æ®ï¼ˆåŒ…å«æºæ•°æ®å¯èƒ½ä¹Ÿä¼šä¸ºç©ºæˆ–è€…ä¸åˆæ³•çš„æ•°æ®ï¼‰ï¼Œä½ ä¸å¯èƒ½åœ¨æ¯ä¸ªç®—å­é‡Œé¢ä¹Ÿç”¨ä¸€ä¸ªå¤§çš„ try catch åšä¸€ä¸ªå¼‚å¸¸æ•è·ï¼Œæ‰€ä»¥è„æ•°æ®å’Œå¼‚å¸¸ç®€ç›´å°±æ˜¯é˜²ä¸èƒœé˜²ï¼Œä¸è¿‡æˆ‘ä»¬è¿˜æ˜¯è¦å°½åŠ›çš„ä¿è¯ä»£ç çš„å¥å£®æ€§ï¼Œä½†æ˜¯ä¹Ÿè¦é…ç½®å¥½ Flink Job çš„ RestartStrategyï¼ˆé‡å¯ç­–ç•¥ï¼‰ã€‚ 10.1.2 RestartStrategy ç®€ä»‹RestartStrategyï¼Œé‡å¯ç­–ç•¥ï¼Œåœ¨é‡åˆ°æœºå™¨æˆ–è€…ä»£ç ç­‰ä¸å¯é¢„çŸ¥çš„é—®é¢˜æ—¶å¯¼è‡´ Job æˆ–è€… Task æŒ‚æ‰çš„æ—¶å€™ï¼Œå®ƒä¼šæ ¹æ®é…ç½®çš„é‡å¯ç­–ç•¥å°† Job æˆ–è€…å—å½±å“çš„ Task æ‹‰èµ·æ¥é‡æ–°æ‰§è¡Œï¼Œä»¥ä½¿å¾—ä½œä¸šæ¢å¤åˆ°ä¹‹å‰æ­£å¸¸æ‰§è¡ŒçŠ¶æ€ã€‚Flink ä¸­çš„é‡å¯ç­–ç•¥å†³å®šäº†æ˜¯å¦è¦é‡å¯ Job æˆ–è€… Taskï¼Œä»¥åŠé‡å¯çš„æ¬¡æ•°å’Œæ¯æ¬¡é‡å¯çš„æ—¶é—´é—´éš”ã€‚ 10.1.3 ä¸ºä»€ä¹ˆéœ€è¦ RestartStrategyï¼Ÿé‡å¯ç­–ç•¥ä¼šè®© Job ä»ä¸Šä¸€æ¬¡å®Œæ•´çš„ Checkpoint å¤„æ¢å¤çŠ¶æ€ï¼Œä¿è¯ Job å’ŒæŒ‚ä¹‹å‰çš„çŠ¶æ€ä¿æŒä¸€è‡´ï¼Œå¦å¤–è¿˜å¯ä»¥è®© Job ç»§ç»­å¤„ç†æ•°æ®ï¼Œä¸ä¼šå‡ºç° Job æŒ‚äº†å¯¼è‡´æ¶ˆæ¯å‡ºç°å¤§é‡å †ç§¯çš„é—®é¢˜ï¼Œåˆç†çš„è®¾ç½®é‡å¯ç­–ç•¥å¯ä»¥å‡å°‘ Job ä¸å¯ç”¨æ—¶é—´å’Œé¿å…äººå·¥ä»‹å…¥å¤„ç†æ•…éšœçš„è¿ç»´æˆæœ¬ï¼Œå› æ­¤é‡å¯ç­–ç•¥å¯¹äº Flink Job çš„ç¨³å®šæ€§æ¥è¯´æœ‰ç€ä¸¾è¶³è½»é‡çš„ä½œç”¨ã€‚ 10.1.4 å¦‚ä½•é…ç½® RestartStrategyï¼Ÿæ—¢ç„¶ Flink ä¸­çš„é‡å¯ç­–ç•¥ä½œç”¨è¿™ä¹ˆå¤§ï¼Œé‚£ä¹ˆè¯¥å¦‚ä½•é…ç½®å‘¢ï¼Ÿå…¶å®å¦‚æœ Flink Job æ²¡æœ‰å•ç‹¬è®¾ç½®é‡å¯é‡å¯ç­–ç•¥çš„è¯ï¼Œåˆ™ä¼šä½¿ç”¨é›†ç¾¤å¯åŠ¨æ—¶åŠ è½½çš„é»˜è®¤é‡å¯ç­–ç•¥ï¼Œå¦‚æœ Flink Job ä¸­å•ç‹¬è®¾ç½®äº†é‡å¯ç­–ç•¥åˆ™ä¼šè¦†ç›–é»˜è®¤çš„é›†ç¾¤é‡å¯ç­–ç•¥ã€‚é»˜è®¤é‡å¯ç­–ç•¥å¯ä»¥åœ¨ Flink çš„é…ç½®æ–‡ä»¶ flink-conf.yaml ä¸­è®¾ç½®ï¼Œç”± restart-strategy å‚æ•°æ§åˆ¶ï¼Œæœ‰ fixed-delayï¼ˆå›ºå®šå»¶æ—¶é‡å¯ç­–ç•¥ï¼‰ã€failure-rateï¼ˆæ•…éšœç‡é‡å¯ç­–ç•¥ï¼‰ã€noneï¼ˆä¸é‡å¯ç­–ç•¥ï¼‰ä¸‰ç§å¯ä»¥é€‰æ‹©ï¼Œå¦‚æœé€‰æ‹©çš„å‚æ•°ä¸åŒï¼Œå¯¹åº”çš„å…¶ä»–å‚æ•°ä¹Ÿä¸åŒã€‚ä¸‹é¢åˆ†åˆ«ä»‹ç»è¿™å‡ ç§é‡å¯ç­–ç•¥å’Œå¦‚ä½•é…ç½®ã€‚ FixedDelayRestartStrategyï¼ˆå›ºå®šå»¶æ—¶é‡å¯ç­–ç•¥ï¼‰FixedDelayRestartStrategy æ˜¯å›ºå®šå»¶è¿Ÿé‡å¯ç­–ç•¥ï¼Œç¨‹åºæŒ‰ç…§é›†ç¾¤é…ç½®æ–‡ä»¶ä¸­æˆ–è€…ç¨‹åºä¸­é¢å¤–è®¾ç½®çš„é‡å¯æ¬¡æ•°å°è¯•é‡å¯ä½œä¸šï¼Œå¦‚æœå°è¯•æ¬¡æ•°è¶…è¿‡äº†ç»™å®šçš„æœ€å¤§æ¬¡æ•°ï¼Œç¨‹åºè¿˜æ²¡æœ‰èµ·æ¥ï¼Œåˆ™åœæ­¢ä½œä¸šï¼Œå¦å¤–è¿˜å¯ä»¥é…ç½®è¿ç»­ä¸¤æ¬¡é‡å¯ä¹‹é—´çš„ç­‰å¾…æ—¶é—´ï¼Œåœ¨ flink-conf.yaml ä¸­å¯ä»¥åƒä¸‹é¢è¿™æ ·é…ç½®ã€‚ 123restart-strategy: fixed-delayrestart-strategy.fixed-delay.attempts: 3 #è¡¨ç¤ºä½œä¸šé‡å¯çš„æœ€å¤§æ¬¡æ•°ï¼Œå¯ç”¨ checkpoint çš„è¯æ˜¯ Integer.MAX_VALUEï¼Œå¦åˆ™æ˜¯ 1ã€‚restart-strategy.fixed-delay.delay: 10 s #å¦‚æœè®¾ç½®åˆ†é’Ÿå¯ä»¥ç±»ä¼¼ 1 minï¼Œè¯¥å‚æ•°è¡¨ç¤ºä¸¤æ¬¡é‡å¯ä¹‹é—´çš„æ—¶é—´é—´éš”ï¼Œå½“ç¨‹åºä¸å¤–éƒ¨ç³»ç»Ÿæœ‰è¿æ¥äº¤äº’æ—¶å»¶è¿Ÿé‡å¯å¯èƒ½ä¼šæœ‰å¸®åŠ©ï¼Œå¯ç”¨ checkpoint çš„è¯ï¼Œå»¶è¿Ÿé‡å¯çš„æ—¶é—´æ˜¯ 10 ç§’ï¼Œå¦åˆ™ä½¿ç”¨ akka.ask.timeout çš„å€¼ã€‚ åœ¨ç¨‹åºä¸­è®¾ç½®å›ºå®šå»¶è¿Ÿé‡å¯ç­–ç•¥çš„è¯å¦‚ä¸‹ï¼š 12345ExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment();env.setRestartStrategy(RestartStrategies.fixedDelayRestart( 3, // å°è¯•é‡å¯çš„æ¬¡æ•° Time.of(10, TimeUnit.SECONDS) // å»¶æ—¶)); FailureRateRestartStrategyï¼ˆæ•…éšœç‡é‡å¯ç­–ç•¥ï¼‰FailureRateRestartStrategy æ˜¯æ•…éšœç‡é‡å¯ç­–ç•¥ï¼Œåœ¨å‘ç”Ÿæ•…éšœä¹‹åé‡å¯ä½œä¸šï¼Œå¦‚æœå›ºå®šæ—¶é—´é—´éš”ä¹‹å†…å‘ç”Ÿæ•…éšœçš„æ¬¡æ•°è¶…è¿‡è®¾ç½®çš„å€¼åï¼Œä½œä¸šå°±ä¼šå¤±è´¥åœæ­¢ï¼Œè¯¥é‡å¯ç­–ç•¥ä¹Ÿæ”¯æŒè®¾ç½®è¿ç»­ä¸¤æ¬¡é‡å¯ä¹‹é—´çš„ç­‰å¾…æ—¶é—´ã€‚ 1234restart-strategy: failure-raterestart-strategy.failure-rate.max-failures-per-interval: 3 #å›ºå®šæ—¶é—´é—´éš”å†…å…è®¸çš„æœ€å¤§é‡å¯æ¬¡æ•°ï¼Œé»˜è®¤ 1restart-strategy.failure-rate.failure-rate-interval: 5 min #å›ºå®šæ—¶é—´é—´éš”ï¼Œé»˜è®¤ 1 åˆ†é’Ÿrestart-strategy.failure-rate.delay: 10 s #è¿ç»­ä¸¤æ¬¡é‡å¯å°è¯•ä¹‹é—´çš„å»¶è¿Ÿæ—¶é—´ï¼Œé»˜è®¤æ˜¯ akka.ask.timeout å¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­è¿™æ ·è®¾ç½®æ¥é…ç½®æ•…éšœç‡é‡å¯ç­–ç•¥ï¼š 123456ExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment();env.setRestartStrategy(RestartStrategies.failureRateRestart( 3, // å›ºå®šæ—¶é—´é—´éš”å…è®¸ Job é‡å¯çš„æœ€å¤§æ¬¡æ•° Time.of(5, TimeUnit.MINUTES), // å›ºå®šæ—¶é—´é—´éš” Time.of(10, TimeUnit.SECONDS) // ä¸¤æ¬¡é‡å¯çš„å»¶è¿Ÿæ—¶é—´)); NoRestartStrategyï¼ˆä¸é‡å¯ç­–ç•¥ï¼‰NoRestartStrategy ä½œä¸šä¸é‡å¯ç­–ç•¥ï¼Œç›´æ¥å¤±è´¥åœæ­¢ï¼Œåœ¨ flink-conf.yaml ä¸­é…ç½®å¦‚ä¸‹ï¼š 1restart-strategy: none åœ¨ç¨‹åºä¸­å¦‚ä¸‹è®¾ç½®å³å¯é…ç½®ä¸é‡å¯ï¼š 12ExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment();env.setRestartStrategy(RestartStrategies.noRestart()); Fallbackï¼ˆå¤‡ç”¨é‡å¯ç­–ç•¥ï¼‰å¦‚æœç¨‹åºæ²¡æœ‰å¯ç”¨ Checkpointï¼Œåˆ™é‡‡ç”¨ä¸é‡å¯ç­–ç•¥ï¼Œå¦‚æœå¼€å¯äº† Checkpoint ä¸”æ²¡æœ‰è®¾ç½®é‡å¯ç­–ç•¥ï¼Œé‚£ä¹ˆé‡‡ç”¨å›ºå®šå»¶æ—¶é‡å¯ç­–ç•¥ï¼Œæœ€å¤§é‡å¯æ¬¡æ•°ä¸º Integer.MAX_VALUEã€‚ åœ¨åº”ç”¨ç¨‹åºä¸­é…ç½®å¥½äº†å›ºå®šå»¶æ—¶é‡å¯ç­–ç•¥ï¼Œå¯ä»¥æµ‹è¯•ä¸€ä¸‹ä»£ç å¼‚å¸¸åå¯¼è‡´ Job å¤±è´¥åé‡å¯çš„æƒ…å†µï¼Œç„¶åè§‚å¯Ÿæ—¥å¿—ï¼Œå¯ä»¥çœ‹åˆ° Job é‡å¯ç›¸å…³çš„æ—¥å¿—ï¼š 123[flink-akka.actor.default-dispatcher-5] INFO org.apache.flink.runtime.executiongraph.ExecutionGraph - Try to restart or fail the job zhisheng default RestartStrategy example (a890361aed156610b354813894d02cd0) if no longer possible.[flink-akka.actor.default-dispatcher-5] INFO org.apache.flink.runtime.executiongraph.ExecutionGraph - Job zhisheng default RestartStrategy example (a890361aed156610b354813894d02cd0) switched from state FAILING to RESTARTING.[flink-akka.actor.default-dispatcher-5] INFO org.apache.flink.runtime.executiongraph.ExecutionGraph - Restarting the job zhisheng default RestartStrategy example (a890361aed156610b354813894d02cd0). æœ€åé‡å¯æ¬¡æ•°è¾¾åˆ°é…ç½®çš„æœ€å¤§é‡å¯æ¬¡æ•°å Job è¿˜æ²¡æœ‰èµ·æ¥çš„è¯ï¼Œåˆ™ä¼šåœæ­¢ Job å¹¶æ‰“å°æ—¥å¿—ï¼š 1[flink-akka.actor.default-dispatcher-2] INFO org.apache.flink.runtime.executiongraph.ExecutionGraph - Could not restart the job zhisheng default RestartStrategy example (a890361aed156610b354813894d02cd0) because the restart strategy prevented it. Flink ä¸­å‡ ç§é‡å¯ç­–ç•¥çš„è®¾ç½®å¦‚ä¸Šï¼Œå¤§å®¶å¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©åˆé€‚çš„é‡å¯ç­–ç•¥ï¼Œæ¯”å¦‚å¦‚æœç¨‹åºæŠ›å‡ºäº†ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œä½†æ˜¯ä½ é…ç½®çš„æ˜¯ä¸€ç›´æ— é™é‡å¯ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´ Job ä¸€ç›´åœ¨é‡å¯ï¼Œè¿™æ ·æ— éå†æµªè´¹æœºå™¨èµ„æºï¼Œè¿™ç§æƒ…å†µä¸‹å¯ä»¥é…ç½®é‡è¯•å›ºå®šæ¬¡æ•°ï¼Œæ¯æ¬¡éš”å¤šä¹…é‡è¯•çš„å›ºå®šå»¶æ—¶é‡å¯ç­–ç•¥ï¼Œè¿™æ ·åœ¨é‡è¯•ä¸€å®šæ¬¡æ•°å Job å°±ä¼šåœæ­¢ï¼Œå¦‚æœå¯¹ Job çš„çŠ¶æ€åšäº†ç›‘æ§å‘Šè­¦çš„è¯ï¼Œé‚£ä¹ˆä½ å°±ä¼šæ”¶åˆ°å‘Šè­¦ä¿¡æ¯ï¼Œè¿™æ ·ä¹Ÿä¼šæç¤ºä½ å»æŸ¥çœ‹ Job çš„è¿è¡ŒçŠ¶å†µï¼Œèƒ½åŠæ—¶çš„å»å‘ç°å’Œä¿®å¤ Job çš„é—®é¢˜ã€‚ 10.1.5 RestartStrategy æºç åˆ†æå†ä»‹ç»é‡å¯ç­–ç•¥åº”ç”¨ç¨‹åºä»£ç é…ç½®çš„æ—¶å€™ä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰çœ‹åˆ°è®¾ç½®é‡å¯ç­–ç•¥éƒ½æ˜¯ä½¿ç”¨ RestartStrategies ç±»ï¼Œé€šè¿‡è¯¥ç±»çš„æ–¹æ³•å°±å¯ä»¥åˆ›å»ºä¸åŒçš„é‡å¯ç­–ç•¥ï¼Œåœ¨ RestartStrategies ç±»ä¸­æä¾›äº†äº”ä¸ªæ–¹æ³•ç”¨æ¥åˆ›å»ºå››ç§ä¸åŒçš„é‡å¯ç­–ç•¥ï¼ˆæœ‰ä¸¤ä¸ªæ–¹æ³•æ˜¯åˆ›å»º FixedDelay é‡å¯ç­–ç•¥çš„ï¼Œåªä¸è¿‡æ–¹æ³•çš„å‚æ•°ä¸åŒï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ åœ¨æ¯ä¸ªæ–¹æ³•å†…éƒ¨å…¶å®è°ƒç”¨çš„æ˜¯ RestartStrategies ä¸­çš„å†…éƒ¨é™æ€ç±»ï¼Œåˆ†åˆ«æ˜¯ NoRestartStrategyConfigurationã€FixedDelayRestartStrategyConfigurationã€FailureRateRestartStrategyConfigurationã€FallbackRestartStrategyConfigurationï¼Œè¿™å››ä¸ªç±»éƒ½ç»§æ‰¿è‡ª RestartStrategyConfiguration æŠ½è±¡ç±»ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ ä¸Šé¢æ˜¯å®šä¹‰çš„å››ç§é‡å¯ç­–ç•¥çš„é…ç½®ç±»ï¼Œåœ¨ Flink ä¸­æ˜¯é  RestartStrategyResolving ç±»ä¸­çš„ resolve æ–¹æ³•æ¥è§£æ RestartStrategies.RestartStrategyConfigurationï¼Œç„¶åæ ¹æ®é…ç½®ä½¿ç”¨ RestartStrategyFactory åˆ›å»º RestartStrategyã€‚RestartStrategy æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒæœ‰ canRestart å’Œ restart ä¸¤ä¸ªæ–¹æ³•ï¼Œå®ƒæœ‰å››ä¸ªå®ç°ç±»ï¼š FixedDelayRestartStrategyã€FailureRateRestartStrategyã€ThrowingRestartStrategyã€NoRestartStrategyï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ 10.1.6 Failover Strategiesï¼ˆæ•…éšœæ¢å¤ç­–ç•¥ï¼‰é‡å¯æ‰€æœ‰çš„ä»»åŠ¡åŸºäº Region çš„å±€éƒ¨æ•…éšœé‡å¯ç­–ç•¥10.1.7 å°ç»“ä¸åæ€åŠ å…¥çŸ¥è¯†æ˜Ÿçƒå¯ä»¥çœ‹åˆ°ä¸Šé¢æ–‡ç« ï¼šhttps://t.zsxq.com/RBYj66M","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹â€”â€” å¦‚ä½•å¤„ç† Flink ä¸­æ•°æ®å€¾æ–œé—®é¢˜ï¼Ÿ","date":"2021-08-10T16:00:00.000Z","path":"2021/08/11/flink-in-action-9.6/","text":"9.6 å¦‚ä½•å¤„ç† Flink ä¸­æ•°æ®å€¾æ–œé—®é¢˜ï¼Ÿåœ¨å¤§æ•°æ®è®¡ç®—åœºæ™¯ï¼Œæ— è®ºä½¿ç”¨ MapReduceã€Spark è¿˜æ˜¯ Flink è®¡ç®—æ¡†æ¶ï¼Œæ— è®ºæ˜¯æ‰¹å¤„ç†è¿˜æ˜¯æµå¤„ç†éƒ½å­˜åœ¨æ•°æ®å€¾æ–œçš„é—®é¢˜ï¼Œé€šè¿‡æœ¬èŠ‚å­¦ä¹ äº§ç”Ÿæ•°æ®å€¾æ–œçš„åŸå› åŠå¦‚ä½•åœ¨ç”Ÿäº§ç¯å¢ƒè§£å†³æ•°æ®å€¾æ–œã€‚ 9.6.1 æ•°æ®å€¾æ–œç®€ä»‹åˆ†æä¸€ä¸ªè®¡ç®—å„ app PV çš„æ¡ˆä¾‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåœ†çƒè¡¨ç¤º app1 çš„æ—¥å¿—ï¼Œæ–¹å—è¡¨ç¤º app2 çš„æ—¥å¿—ï¼ŒSource ç«¯ä»å¤–éƒ¨ç³»ç»Ÿè¯»å–ç”¨æˆ·ä¸ŠæŠ¥çš„å„ app è¡Œä¸ºæ—¥å¿—ï¼Œè¦è®¡ç®—å„ app çš„ PVï¼Œæ‰€ä»¥æŒ‰ç…§ app è¿›è¡Œ keyByï¼Œç›¸åŒ app çš„æ•°æ®å‘é€åˆ°åŒä¸€ä¸ª Operator å®ä¾‹ä¸­å¤„ç†ï¼ŒkeyBy åå¯¹ app çš„ PV å€¼è¿›è¡Œç´¯åŠ æ¥ï¼Œæœ€åå°†è®¡ç®—çš„ PV ç»“æœè¾“å‡ºåˆ°å¤–éƒ¨ Sink ç«¯ã€‚ å¯ä»¥çœ‹åˆ°åœ¨ä»»åŠ¡è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œè®¡ç®— Count çš„ç®—å­æœ‰ä¸¤ä¸ªå¹¶è¡Œåº¦ï¼Œå…¶ä¸­ä¸€ä¸ªå¹¶è¡Œåº¦å¤„ç† app1 çš„æ•°æ®ï¼Œå¦ä¸€ä¸ªå¹¶è¡Œåº¦å¤„ç† app2 çš„æ•°æ®ã€‚ç”±äº app1 æ¯”è¾ƒçƒ­é—¨ï¼Œæ‰€ä»¥ app1 çš„æ—¥å¿—é‡è¿œå¤§äº app2 çš„æ—¥å¿—é‡ï¼Œé€ æˆè®¡ç®— app1 PV çš„å¹¶è¡Œåº¦å‹åŠ›è¿‡å¤§æˆä¸ºæ•´ä¸ªç³»ç»Ÿçš„ç“¶é¢ˆï¼Œè€Œè®¡ç®— app2 PV çš„å¹¶è¡Œåº¦æ•°æ®é‡è¾ƒå°‘æ‰€ä»¥ CPUã€å†…å­˜ä»¥åŠç½‘ç»œèµ„æºçš„ä½¿ç”¨ç‡æ•´ä½“éƒ½æ¯”è¾ƒä½ï¼Œè¿™å°±æ˜¯äº§ç”Ÿæ•°æ®å€¾æ–œçš„æ¡ˆä¾‹ã€‚ éšç€ä¸šåŠ¡çš„ä¸æ–­å‘å±•ï¼Œå¦‚æœ app1 çš„æ—¥å¿—é‡æš´å¢ï¼Œå•ä¸ªèŠ‚ç‚¹çš„å•ä¸ªå¹¶è¡Œåº¦å·²ç»æ‰¿æ‹…ä¸äº†è®¡ç®— app1 PV çš„ä»»åŠ¡ï¼Œæ­¤æ—¶å¦‚ä½•æ¥è§£å†³å‘¢ï¼Ÿå¯¹äºä¸äº†è§£æ•°æ®å€¾æ–œçš„åŒå­¦çœ‹åˆ° Flink ä»»åŠ¡å‡ºç°äº†å»¶è¿Ÿï¼Œç»“åˆä¹‹å‰å­¦ä¹ çš„åå‹ç« èŠ‚ï¼Œå®šä½æ•´ä¸ª Flink ä»»åŠ¡çš„ç“¶é¢ˆåœ¨äº Count ç®—å­ï¼Œæ‰€ä»¥è®¤ä¸º Count ç®—å­çš„å¹¶è¡Œåº¦ä¸å¤Ÿï¼Œäºæ˜¯è§£å†³æ€è·¯å°±æ˜¯è°ƒå¤§ Count ç®—å­çš„å¹¶è¡Œåº¦è‡³ 4 æ¥æé«˜ Count ç®—å­çš„è®¡ç®—èƒ½åŠ›ï¼Œè°ƒå¤§å¹¶è¡Œåº¦ä»¥åå‘ç° Flink ä»»åŠ¡çš„ååé‡å¹¶æ²¡æœ‰æå‡ï¼Œè€Œä¸”é€šè¿‡åå‹æœºåˆ¶å®šä½åˆ°ç³»ç»Ÿçš„ç“¶é¢ˆè¿˜åœ¨äº Count ç®—å­ï¼Œéš¾é“ Count ç®—å­çš„å¹¶è¡Œåº¦éœ€è¦ä» 2 è°ƒå¤§åˆ° 10 å—ï¼ŸNoï¼Œä¸Šè¿°æƒ…å†µå°±ç®—æŠŠå¹¶è¡Œåº¦è°ƒå¤§åˆ° 100ï¼Œä¾ç„¶ä¸èƒ½è§£å†³ä»»åŠ¡ç“¶é¢ˆã€‚ä¸ºä»€ä¹ˆå‡ºç°è¿™ç§æƒ…å†µå‘¢ï¼Ÿè¦è®¡ç®—å„ app çš„ PV æ•°æ®ï¼Œé‚£ä¹ˆç›¸åŒ app çš„æ•°æ®å¿…ç„¶è¦å‘é€åˆ°ç›¸åŒçš„ Operator å®ä¾‹å»å¤„ç†ï¼Œç°åœ¨åªæœ‰ä¸¤ä¸ª appï¼Œæœ€å¤šåªèƒ½åˆ†é…åˆ°ä¸¤ä¸ªå¹¶è¡Œåº¦ä¸Šå»æ‰§è¡Œï¼Œå¦‚æœ Count ç®—å­çš„å¹¶è¡Œåº¦å¤§äº 2ï¼Œæ„å‘³ç€è‚¯å®šæœ‰ä¸€äº›å¹¶è¡Œåº¦åˆ†é…ä¸åˆ°æ•°æ®ï¼Œæ‰€ä»¥ä¸Šè¿°æƒ…å†µè°ƒå¤§ Count ç®—å­çš„å¹¶è¡Œåº¦ä¸èƒ½è§£å†³é—®é¢˜ã€‚é‚£ä½¿ç”¨ Flink å¦‚ä½•æ¥è§£å†³æ•°æ®å€¾æ–œå‘¢ï¼Œæˆ‘ä»¬å…ˆå­¦ä¹  Flink ä¸­å¦‚ä½•æ¥åˆ¤æ–­æ˜¯å¦å‘ç”Ÿäº†æ•°æ®å€¾æ–œã€‚ 9.6.2 åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ•°æ®å€¾æ–œè¿™é‡Œå†é€šè¿‡ä¸€ä¸ªæ¡ˆä¾‹æ¥è®²è¿° Flink ä»»åŠ¡å¦‚ä½•æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ•°æ®å€¾æ–œï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ˜¯ Flink Web UI Job é¡µé¢å±•ç¤ºçš„ä»»åŠ¡æ‰§è¡Œè®¡åˆ’ï¼Œå¯ä»¥çœ‹åˆ°ä»»åŠ¡ç»è¿‡ Operator Chain åï¼Œæ€»å…±æœ‰ä¸¤ä¸ª Taskï¼Œä¸Šæ¸¸ Task å°†æ•°æ® keyBy åå‘é€åˆ°ä¸‹æ¸¸ Taskï¼Œå¦‚ä½•åˆ¤æ–­ç¬¬äºŒä¸ª Task è®¡ç®—çš„æ•°æ®æ˜¯å¦å­˜åœ¨æ•°æ®å‘¢ï¼Ÿ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œé€šè¿‡ Flink Web UI ä¸­ Job é¡µé¢çš„ç¬¬ä¸€ä¸ª Subtasks é€‰é¡¹å¡ï¼Œå¯ä»¥çœ‹åˆ°ä»»åŠ¡çš„ä¸¤ä¸ª Taskï¼Œç‚¹å‡» Taskï¼Œå¯ä»¥çœ‹åˆ° Task ç›¸åº”çš„ Subtask è¯¦æƒ…ã€‚ä¾‹å¦‚ Subtask çš„å¯åŠ¨æ—¶é—´ã€ç»“æŸæ—¶é—´ã€æŒç»­æ—¶é•¿ã€æ¥æ”¶æ•°æ®é‡çš„å­—èŠ‚æ•°ä»¥åŠæ¥æ”¶æ•°æ®çš„ä¸ªæ•°ã€‚å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œç›¸åŒ Task çš„å¤šä¸ª Subtask ä¸­ï¼Œæœ‰çš„ Subtask æ¥æ”¶åˆ° 1.69 TB çš„æ•°æ®é‡ï¼Œæœ‰çš„ Subtask æ¥æ”¶åˆ° 17.6 TB çš„æ•°æ®é‡ï¼Œé€šè¿‡ Flink Web UI å¯ä»¥ç²¾ç¡®åœ°çœ‹åˆ°æ¯ä¸ª Subtask å¤„ç†äº†å¤šå°‘æ•°æ®ï¼Œå³å¯åˆ¤æ–­å‡º Flink ä»»åŠ¡æ˜¯å¦å­˜åœ¨æ•°æ®å€¾æ–œï¼Œæ¥ä¸‹æ¥å­¦ä¹  Flink ä¸­å¦‚ä½•æ¥è§£å†³æ•°æ®å€¾æ–œã€‚ 9.6.3 åˆ†æå’Œè§£å†³æ•°æ®å€¾æ–œé—®é¢˜åœ¨ Flink ä¸­ï¼Œå¾ˆå¤šå› ç´ éƒ½ä¼šå¯¼è‡´æ•°æ®å€¾æ–œï¼Œä¾‹å¦‚ 9.6.1 èŠ‚æè¿°çš„ keyBy åçš„èšåˆæ“ä½œå­˜åœ¨æ•°æ®å€¾æ–œã€‚keyBy ä¹‹å‰çš„æ•°æ®ç›´æ¥æ¥è‡ªäºæ•°æ®æºï¼Œä¸€èˆ¬ä¸ä¼šå‡ºç°æ•°æ®å€¾æ–œï¼Œé™¤éæ•°æ®æºä¸­çš„æ•°æ®å‘ç”Ÿäº†æ•°æ®å€¾æ–œã€‚æœ¬å°èŠ‚å°†ä»å¤šä¸ªè§’åº¦æ¥è§£å†³æ•°æ®å€¾æ–œã€‚ keyBy åçš„èšåˆæ“ä½œå­˜åœ¨æ•°æ®å€¾æ–œkeyBy ä¹‹å‰å‘ç”Ÿæ•°æ®å€¾æ–œ9.6.4 å°ç»“ä¸åæ€åŠ å…¥çŸ¥è¯†æ˜Ÿçƒå¯ä»¥çœ‹åˆ°ä¸Šé¢æ–‡ç« ï¼šhttps://t.zsxq.com/uFEEYzJ åœ¨å‰ä¸€ç« ä¸­è®²è§£äº† Flink ç›‘æ§ç³»ç»Ÿçš„é‡è¦æ€§ï¼Œè¿™ç« ä¸»è¦è®²è§£ Flink ä½œä¸šçš„æ€§èƒ½è°ƒä¼˜ã€‚å½“ä½œä¸šå‡ºç°å„ç§å„æ ·çš„é—®é¢˜æ—¶ï¼Œå…¶å®è¿™æ—¶å°±ä½“ç°äº†å‰é¢ç« èŠ‚æåˆ°çš„ç›‘æ§çš„é‡è¦æ€§ï¼Œæ‰€ä»¥æœ¬ç« çš„å†…å®¹ä¹Ÿæ¯”è¾ƒä¾èµ–äºç›‘æ§ç³»ç»Ÿï¼Œç„¶åæ‰èƒ½å¤Ÿæ›´å¥½çš„å»æ’æŸ¥é—®é¢˜ï¼Œç„¶åå»è§£å†³é—®é¢˜ã€‚ åœ¨æœ¬ç« ä¸­è®²è§£çš„åå‹é—®é¢˜ã€å¹¶è¡Œåº¦è®¾ç½®é—®é¢˜ã€æ•°æ®å€¾æ–œé—®é¢˜ç­‰éƒ½æ˜¯å¼€å‘ä½œä¸šæ—¶è¦æ³¨æ„çš„ç‚¹ï¼Œæœ¬ç« ä¸ä»…è®²è§£äº†è¿™äº›é—®é¢˜å‡ºç°åçš„è§£å†³æ–¹æ¡ˆï¼Œè¿˜æ·±å…¥çš„å‰–æäº†è¿™äº›é—®é¢˜ä¸ºå•¥ä¼šå‡ºç°ï¼Œåªæœ‰çŸ¥å…¶åŸå› åï¼Œåé¢å¼€å‘æ–°çš„ä½œä¸šæ—¶æ‰ä¼šå»æ³¨æ„è¿™äº›é—®é¢˜ã€‚æœ¬ç« çš„å†…å®¹å±äºé«˜é˜¶ç©å®¶è¦æŒæ¡çš„ï¼Œå¸Œæœ›ä½ ä¹Ÿèƒ½å¤Ÿå¥½å¥½ç†è§£ï¼Œåœ¨ä½ ä»¬å…¬å¸é‡åˆ°åŒæ ·é—®é¢˜çš„æ—¶å€™å¯ä»¥ç«™å‡ºæ¥å»è§£å†³ã€‚","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹â€”â€” Flink ä¸­å¦‚ä½•ä¿è¯ Exactly Onceï¼Ÿ","date":"2021-08-10T16:00:00.000Z","path":"2021/08/11/flink-in-action-9.5/","text":"9.5 Flink ä¸­å¦‚ä½•ä¿è¯ Exactly Onceï¼Ÿåœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºéšæ—¶å¯èƒ½å‡ºç°ä»»ä½•å½¢å¼çš„æ•…éšœï¼Œä¾‹å¦‚ï¼šæœºå™¨ç¡¬ä»¶æ•…éšœã€ç¨‹åº OOM ç­‰ã€‚å½“åº”ç”¨ç¨‹åºå‡ºç°æ•…éšœæ—¶ï¼ŒFlink ä¸ºäº†ä¿è¯æ•°æ®æ¶ˆè´¹çš„ Exactly Onceï¼Œéœ€è¦æœ‰ç›¸åº”çš„æ•…éšœå®¹é”™èƒ½åŠ›ã€‚Flink æ˜¯é€šè¿‡å‘¨æœŸæ€§ Checkpoint çš„æ–¹å¼æ¥å®ç°æ•…éšœå®¹é”™ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯åŸºäº Chandy-Lamport æ”¹è¿›çš„ç®—æ³•ã€‚æœ¬èŠ‚ä¼šä»‹ç» Flink å†…éƒ¨å¦‚ä½•ä¿è¯ Exactly Once ä»¥åŠç«¯å¯¹ç«¯å¦‚ä½•ä¿è¯ Exactly Onceã€‚ 9.5.1 Flink å†…éƒ¨å¦‚ä½•ä¿è¯ Exactly Onceï¼ŸFlink å®˜ç½‘çš„å®šä¹‰æ˜¯ Stateful Computations over Data Streamsï¼ˆæ•°æ®æµä¸Šçš„æœ‰çŠ¶æ€è®¡ç®—ï¼‰ï¼Œé‚£åˆ°åº•ä»€ä¹ˆæ˜¯çŠ¶æ€å‘¢ï¼Ÿä¸¾ä¸€ä¸ªæ— çŠ¶æ€è®¡ç®—çš„ä¾‹å­ï¼Œæ¯”å¦‚ï¼šæˆ‘ä»¬åªæ˜¯è¿›è¡Œä¸€ä¸ªå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œè¾“å…¥aï¼Œè¾“å‡ºa_666,è¾“å…¥bï¼Œè¾“å‡º b_666ã€‚æ— çŠ¶æ€è¡¨ç¤ºè®¡ç®—è¾“å‡ºçš„ç»“æœè·Ÿä¹‹å‰çš„çŠ¶æ€æ²¡å…³ç³»ï¼Œç¬¦åˆå¹‚ç­‰æ€§ã€‚å¹‚ç­‰æ€§å°±æ˜¯ç”¨æˆ·å¯¹äºåŒä¸€æ“ä½œå‘èµ·çš„ä¸€æ¬¡è¯·æ±‚æˆ–è€…å¤šæ¬¡è¯·æ±‚çš„ç»“æœæ˜¯ä¸€è‡´çš„ï¼Œä¸ä¼šå› ä¸ºå¤šæ¬¡ç‚¹å‡»è€Œäº§ç”Ÿå‰¯ä½œç”¨ã€‚è€Œè®¡ç®— PVã€UV å°±å±äºæœ‰çŠ¶æ€è®¡ç®—ã€‚å®æ—¶è®¡ç®— PV æ—¶ï¼Œæ¯æ¬¡éƒ½éœ€è¦ä»æŸä¸ªå­˜å‚¨ä»‹è´¨çš„ç»“æœè¡¨ä¸­æ‹¿åˆ°ä¹‹å‰çš„ PV å€¼ï¼Œ+1 å set åˆ°ç»“æœè¡¨ä¸­ã€‚æœ‰çŠ¶æ€è®¡ç®—è¡¨ç¤ºè¾“å‡ºçš„ç»“æœè·Ÿä¹‹å‰çš„çŠ¶æ€æœ‰å…³ç³»ï¼Œä¸ç¬¦åˆå¹‚ç­‰æ€§ï¼Œè®¿é—®å¤šæ¬¡ï¼ŒPV ä¼šå¢åŠ ã€‚ Flinkçš„ Checkpoint åŠŸèƒ½ç®€ä»‹Flink Checkpoint æœºåˆ¶çš„å­˜åœ¨å°±æ˜¯ä¸ºäº†è§£å†³ Flink ä»»åŠ¡åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ç”±äºå„ç§åŸå› å¯¼è‡´ä»»åŠ¡å¤±è´¥åï¼Œèƒ½å¤Ÿæ­£å¸¸æ¢å¤ä»»åŠ¡ã€‚é‚£ Checkpoint å…·ä½“åšäº†å“ªäº›åŠŸèƒ½ï¼Œä¸ºä»€ä¹ˆä»»åŠ¡æŒ‚æ‰ä¹‹åï¼Œé€šè¿‡ Checkpoint æœºåˆ¶èƒ½ä½¿å¾—ä»»åŠ¡æ¢å¤å‘¢ï¼ŸCheckpoint æ˜¯é€šè¿‡ç»™ç¨‹åºåšå¿«ç…§çš„æ–¹å¼ä½¿å¾—å°†æ•´ä¸ªç¨‹åºæŸäº›æ—¶åˆ»çš„çŠ¶æ€ä¿å­˜ä¸‹æ¥ï¼Œå½“ä»»åŠ¡æŒ‚æ‰ä¹‹åï¼Œé»˜è®¤ä»æœ€è¿‘ä¸€æ¬¡ä¿å­˜çš„å®Œæ•´å¿«ç…§å¤„è¿›è¡Œæ¢å¤ä»»åŠ¡ã€‚é—®é¢˜æ¥äº†ï¼Œå¿«ç…§æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼ŸSnapShotç¿»è¯‘ä¸ºå¿«ç…§ï¼Œæ˜¯æŒ‡å°†ç¨‹åºä¸­æŸäº›ä¿¡æ¯å­˜ä¸€ä»½ï¼ŒåæœŸå¯ä»¥ç”¨è¿™äº›ä¿¡æ¯æ¥æ¢å¤ä»»åŠ¡ã€‚å¯¹äºä¸€ä¸ª Flink ä»»åŠ¡æ¥è®²ï¼Œå¿«ç…§é‡Œé¢åˆ°åº•ä¿å­˜ç€ä»€ä¹ˆä¿¡æ¯å‘¢ï¼Ÿç†è®ºçŸ¥è¯†ä¸€èˆ¬æ¯”è¾ƒæ™¦æ¶©éš¾æ‡‚ï¼Œæˆ‘ä»¬åˆ†æä¸€ä¸ªæ¡ˆä¾‹ï¼Œç”¨æ¡ˆä¾‹è¾…åŠ©å¤§å®¶ç†è§£å¿«ç…§é‡Œé¢åˆ°åº•å­˜å‚¨ä»€ä¹ˆä¿¡æ¯ã€‚è®¡ç®—å„ä¸ª app çš„ PVï¼Œä½¿ç”¨ Flink è¯¥æ€ä¹ˆç»Ÿè®¡å‘¢ï¼Ÿ å¯ä»¥æŠŠè¦ç»Ÿè®¡çš„ app_id åšä¸º keyï¼Œå¯¹åº”çš„ PV å€¼åšä¸º valueï¼Œå°†ç»Ÿè®¡çš„ç»“æœæ”¾åˆ°ä¸€ä¸ª Map é›†åˆä¸­ï¼Œè¿™ä¸ª Map é›†åˆå¯ä»¥æ˜¯å†…å­˜é‡Œçš„ HashMap æˆ–å…¶ä»– kv æ•°æ®åº“ï¼Œä¾‹å¦‚æ”¾åˆ°Redis çš„ keyã€value ç»“æ„ä¸­ã€‚ä» Kafka è¯»å–åˆ°ä¸€æ¡æ¡æ—¥å¿—ï¼Œç”±äºè¦ç»Ÿè®¡å„ app çš„ PVï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä»æ—¥å¿—ä¸­è§£æå‡º app_id å­—æ®µï¼Œæ¯æ¥ä¸€æ¡æ—¥å¿—ï¼Œåªéœ€è¦ä» Map é›†åˆå°†ç›¸åº” app_id çš„ PV å€¼æ‹¿å‡ºæ¥ï¼Œ+1 å put åˆ° Map ä¸­ï¼Œè¿™æ ·æˆ‘ä»¬çš„ Map ä¸­æ°¸è¿œä¿å­˜ç€æ‰€æœ‰ app æœ€æ–°çš„ PV æ•°æ®ã€‚è¯¦ç»†æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å›¾ä¸­åŒ…å«ä¸‰éƒ¨åˆ†ï¼šç¬¬ä¸€ä¸ªæ˜¯ Kafka çš„ä¸€ä¸ªåä¸º test çš„ Topicï¼Œæˆ‘ä»¬çš„æ•°æ®æ¥æºäºè¿™ä¸ª Topicï¼Œç¬¬äºŒä¸ªæ˜¯ Flink çš„ Source Taskï¼Œæ˜¯ Flink åº”ç”¨ç¨‹åºè¯»å–æ•°æ®çš„ Taskï¼Œç¬¬ä¸‰ä¸ªæ˜¯è®¡ç®— PV çš„ Flink Taskï¼Œç”¨äºç»Ÿè®¡å„ä¸ª app çš„ PV å€¼ï¼Œå¹¶å°† PV ç»“æœè¾“å‡ºåˆ° Map é›†åˆã€‚ Flink çš„ Source Task è®°å½•äº†å½“å‰æ¶ˆè´¹åˆ° test Topic æ‰€æœ‰ partition çš„ offsetï¼Œä¸ºäº†æ–¹ä¾¿ç†è§£ Checkpoint çš„ä½œç”¨ï¼Œè¿™é‡Œå…ˆç”¨ä¸€ä¸ª partition è¿›è¡Œè®²è§£ï¼Œå‡è®¾åä¸º test çš„ Topicåªæœ‰ä¸€ä¸ªpartition0ã€‚ä¾‹ï¼šï¼ˆ0ï¼Œ60000ï¼‰è¡¨ç¤º0å·partition ç›®å‰æ¶ˆè´¹åˆ° offset ä¸º 60000 çš„æ•°æ®ã€‚Flink çš„ PV task è®°å½•äº†å½“å‰è®¡ç®—çš„å„ app çš„ PV å€¼ï¼Œä¸ºäº†æ–¹ä¾¿è®²è§£ï¼Œè¿™é‡Œå‡è®¾æœ‰ä¸¤ä¸ªappï¼šapp1ã€app2ã€‚ä¾‹ï¼šï¼ˆapp1ï¼Œ50000ï¼‰ï¼ˆapp2ï¼Œ10000ï¼‰è¡¨ç¤º app1 å½“å‰ PV å€¼ä¸º50000ã€app2 å½“å‰ PV å€¼ä¸º 10000ã€‚è®¡ç®—è¿‡ç¨‹ä¸­ï¼Œæ¯æ¥ä¸€æ¡æ•°æ®ï¼Œåªéœ€è¦ç¡®å®šç›¸åº” app_idï¼Œå°†ç›¸åº”çš„ PV å€¼ +1 å put åˆ° map ä¸­å³å¯ã€‚ è¯¥æ¡ˆä¾‹ä¸­ï¼ŒCheckpoint åˆ°åº•è®°å½•äº†ä»€ä¹ˆä¿¡æ¯å‘¢ï¼Ÿè®°å½•çš„å…¶å®å°±æ˜¯ç¬¬ n æ¬¡ Checkpoint æ¶ˆè´¹çš„ offset ä¿¡æ¯å’Œå„app çš„ PV å€¼ä¿¡æ¯ï¼Œè®°å½•ä¸‹å‘ç”Ÿ Checkpoint å½“å‰çš„çŠ¶æ€ä¿¡æ¯ï¼Œå¹¶å°†è¯¥çŠ¶æ€ä¿¡æ¯ä¿å­˜åˆ°ç›¸åº”çš„çŠ¶æ€åç«¯ã€‚ï¼ˆæ³¨ï¼šçŠ¶æ€åç«¯æ˜¯ä¿å­˜çŠ¶æ€çš„åœ°æ–¹ï¼Œå†³å®šçŠ¶æ€å¦‚ä½•ä¿å­˜ï¼Œå¦‚ä½•ä¿è¯çŠ¶æ€é«˜å¯ç”¨ï¼Œæˆ‘ä»¬åªéœ€è¦çŸ¥é“ï¼Œæˆ‘ä»¬èƒ½ä»çŠ¶æ€åç«¯æ‹¿åˆ° offset ä¿¡æ¯å’Œ PV ä¿¡æ¯å³å¯ã€‚çŠ¶æ€åç«¯å¿…é¡»æ˜¯é«˜å¯ç”¨çš„ï¼Œå¦åˆ™æˆ‘ä»¬çš„çŠ¶æ€åç«¯ç»å¸¸å‡ºç°æ•…éšœï¼Œä¼šå¯¼è‡´æ— æ³•é€šè¿‡ Checkpoint æ¥æ¢å¤æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼‰ã€‚ä¸‹é¢åˆ—å‡ºäº†ç¬¬ 100 æ¬¡ Checkpoint çš„æ—¶å€™ï¼ŒçŠ¶æ€åç«¯ä¿å­˜çš„çŠ¶æ€ä¿¡æ¯ï¼š 123chk-100 - offsetï¼šï¼ˆ0ï¼Œ60000ï¼‰ - PVï¼šï¼ˆapp1ï¼Œ50000ï¼‰ï¼ˆapp2ï¼Œ10000ï¼‰ è¯¥çŠ¶æ€ä¿¡æ¯è¡¨ç¤ºç¬¬ 100 æ¬¡ Checkpoint çš„æ—¶å€™ï¼Œ partition 0 offset æ¶ˆè´¹åˆ°äº† 60000ï¼ŒPV ç»Ÿè®¡ç»“æœä¸ºï¼ˆapp1ï¼Œ50000ï¼‰ï¼ˆapp2ï¼Œ10000ï¼‰ ã€‚å¦‚æœä»»åŠ¡æŒ‚äº†ï¼Œå¦‚ä½•æ¢å¤ï¼Ÿ å‡å¦‚æˆ‘ä»¬è®¾ç½®äº†ä¸€åˆ†é’Ÿè¿›è¡Œä¸€æ¬¡ Checkpointï¼Œç¬¬ 100 æ¬¡ Checkpoint æˆåŠŸåï¼Œè¿‡äº†åç§’é’Ÿï¼Œoffsetå·²ç»æ¶ˆè´¹åˆ° ï¼ˆ0ï¼Œ60100ï¼‰ï¼ŒPV ç»Ÿè®¡ç»“æœå˜æˆäº†ï¼ˆapp1ï¼Œ50080ï¼‰ï¼ˆapp2ï¼Œ10020ï¼‰ï¼Œçªç„¶ä»»åŠ¡æŒ‚äº†ï¼Œæ€ä¹ˆåŠï¼Ÿå…¶å®å¾ˆç®€å•ï¼ŒFlink åªéœ€è¦ä»æœ€è¿‘ä¸€æ¬¡æˆåŠŸçš„ Checkpointï¼Œä¹Ÿå°±æ˜¯ä»ç¬¬ 100 æ¬¡ Checkpoint ä¿å­˜çš„ offsetï¼ˆ0ï¼Œ60000ï¼‰å¤„æ¥ç€æ¶ˆè´¹å³å¯ï¼Œå½“ç„¶ PV å€¼ä¹Ÿè¦ä»ç¬¬ 100 æ¬¡ Checkpoint é‡Œä¿å­˜çš„ PV å€¼ï¼ˆapp1ï¼Œ50000ï¼‰ï¼ˆapp2ï¼Œ10000ï¼‰è¿›è¡Œç´¯åŠ ï¼Œä¸èƒ½ä»ï¼ˆapp1ï¼Œ50080ï¼‰ï¼ˆapp2ï¼Œ10020ï¼‰å¤„è¿›è¡Œç´¯åŠ ï¼Œå› ä¸º partition 0 offsetæ¶ˆè´¹åˆ° 60000 æ—¶ï¼Œå¯¹åº”çš„ PV ç»Ÿè®¡ç»“æœä¸ºï¼ˆapp1ï¼Œ50000ï¼‰ï¼ˆapp2ï¼Œ10000ï¼‰ã€‚å½“ç„¶å¦‚æœä½ æƒ³ä»offset ï¼ˆ0ï¼Œ60100ï¼‰PVï¼ˆapp1ï¼Œ50080ï¼‰ï¼ˆapp2ï¼Œ10020ï¼‰è¿™ä¸ªçŠ¶æ€æ¢å¤ï¼Œä¹Ÿæ˜¯åšä¸åˆ°çš„ï¼Œå› ä¸ºé‚£ä¸ªæ—¶åˆ»ç¨‹åºçªç„¶æŒ‚äº†ï¼Œè¿™ä¸ªçŠ¶æ€æ ¹æœ¬æ²¡æœ‰ä¿å­˜ä¸‹æ¥ï¼Œåªæœ‰åœ¨ Checkpoint çš„æ—¶å€™ï¼Œæ‰ä¼šæŠŠè¿™äº›å®Œæ•´çš„çŠ¶æ€ä¿å­˜åˆ°çŠ¶æ€åç«¯ï¼Œä¾›æˆ‘ä»¬æ¢å¤ä»»åŠ¡ã€‚æˆ‘ä»¬èƒ½åšçš„æœ€é«˜æ•ˆæ–¹å¼å°±æ˜¯ä»æœ€è¿‘ä¸€æ¬¡æˆåŠŸçš„ Checkpoint å¤„æ¢å¤ï¼Œä¹Ÿå°±æ˜¯ä¸€ç›´æ‰€è¯´çš„ chk-100ã€‚ä»¥ä¸ŠåŸºæœ¬å°±æ˜¯ Checkpoint æ‰¿æ‹…çš„å·¥ä½œï¼Œä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œæè¿°çš„ä¸šåŠ¡åœºæ™¯æ¯”è¾ƒç®€å•ã€‚ è¡¥å……ä¸¤ä¸ªé—®é¢˜ï¼šè®¡ç®— PV çš„ task åœ¨ä¸€ç›´è¿è¡Œï¼Œå®ƒæ€ä¹ˆçŸ¥é“ä»€ä¹ˆæ—¶å€™å»åš Checkpoint å‘¢ï¼Ÿè®¡ç®— PV çš„ task æ€ä¹ˆä¿è¯å®ƒè‡ªå·±è®¡ç®—çš„ PV å€¼ï¼ˆapp1ï¼Œ50000ï¼‰ï¼ˆapp2ï¼Œ10000ï¼‰å°±æ˜¯offsetï¼ˆ0ï¼Œ60000ï¼‰é‚£ä¸€åˆ»çš„ç»Ÿè®¡ç»“æœå‘¢ï¼ŸFlink åœ¨æ•°æ®ä¸­åŠ äº†ä¸€ä¸ªå«åš barrierï¼ˆæ …æ ï¼‰ çš„ä¸œè¥¿ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œç”¨åœˆæ ‡æ³¨çš„å°±æ˜¯ barrierã€‚ barrier ä» Source Task å¤„ç”Ÿæˆï¼Œä¸€ç›´æµåˆ° Sink Taskï¼ŒæœŸé—´æ‰€æœ‰çš„ Task åªè¦ç¢°åˆ° barrierï¼Œå°±ä¼šè§¦å‘è‡ªèº«è¿›è¡Œå¿«ç…§ã€‚å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒCheckpoint barrier n-1 å¤„åšçš„å¿«ç…§å°±æ˜¯æŒ‡ Job ä»å¼€å§‹å¤„ç†åˆ° barrier n-1 æ‰€æœ‰çš„çŠ¶æ€æ•°æ®ï¼Œbarrier n å¤„åšçš„å¿«ç…§å°±æ˜¯æŒ‡ä» Job å¼€å§‹åˆ°å¤„ç†åˆ° barrier n æ‰€æœ‰çš„çŠ¶æ€æ•°æ®ã€‚å¯¹åº”åˆ° PV æ¡ˆä¾‹ä¸­å°±æ˜¯ï¼ŒSource Task æ¥æ”¶åˆ° JobManager çš„ç¼–å·ä¸º chk-100 çš„ Checkpoint è§¦å‘è¯·æ±‚åï¼Œå‘ç°è‡ªå·±æ°å¥½æ¥æ”¶åˆ° kafka offsetï¼ˆ0ï¼Œ60000ï¼‰å¤„çš„æ•°æ®ï¼Œæ‰€ä»¥ä¼šå¾€ offsetï¼ˆ0ï¼Œ60000ï¼‰æ•°æ®ä¹‹å offsetï¼ˆ0ï¼Œ60001ï¼‰æ•°æ®ä¹‹å‰æ’å…¥ä¸€ä¸ªbarrierï¼Œç„¶åè‡ªå·±å¼€å§‹åšå¿«ç…§ï¼Œä¹Ÿå°±æ˜¯å°†offsetï¼ˆ0ï¼Œ60000ï¼‰ä¿å­˜åˆ°çŠ¶æ€åç«¯ chk-100 ä¸­ã€‚ç„¶åï¼ŒSource Task ä¼šæŠŠ barrier å’Œæˆ‘ä»¬è¦å¤„ç†çš„æ•°æ®ä¸€å—å¾€ä¸‹æ¸¸å‘é€ï¼Œå½“ç»Ÿè®¡ PV çš„ task æ¥æ”¶åˆ° barrier åï¼Œæ„å‘³ç€ barrier ä¹‹å‰çš„æ•°æ®å·²ç»è¢« PV task å¤„ç†å®Œäº†ï¼Œæ­¤æ—¶ä¹Ÿä¼šæš‚åœå¤„ç† barrier ä¹‹åçš„æ•°æ®ï¼Œå°†è‡ªå·±å†…å­˜ä¸­ä¿å­˜çš„ PV ä¿¡æ¯ï¼ˆapp1ï¼Œ50000ï¼‰ï¼ˆapp2ï¼Œ10000ï¼‰ä¿å­˜åˆ°çŠ¶æ€åç«¯ chk-100 ä¸­ã€‚Flink å¤§æ¦‚å°±æ˜¯é€šè¿‡ä»¥ä¸Šè¿‡ç¨‹æ¥ä¿å­˜å¿«ç…§çš„ã€‚ ä¸Šè¿°è¿‡ç¨‹ä¸­ï¼Œbarrier çš„ä½œç”¨å°±æ˜¯ä¸ºäº†æŠŠæ•°æ®åŒºåˆ†å¼€ï¼Œbarrier ä¹‹å‰çš„æ•°æ®æ˜¯æœ¬æ¬¡ Checkpoint ä¹‹å‰å¿…é¡»å¤„ç†å®Œçš„æ•°æ®ï¼Œbarrier ä¹‹åçš„æ•°æ®åœ¨æœ¬æ¬¡ Checkpoint ä¹‹å‰ä¸èƒ½è¢«å¤„ç†ã€‚Checkpoint è¿‡ç¨‹ä¸­æœ‰ä¸€ä¸ªåŒæ­¥åšå¿«ç…§çš„ç¯èŠ‚ä¸èƒ½å¤„ç† barrier ä¹‹åçš„æ•°æ®ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå¦‚æœåšå¿«ç…§çš„åŒæ—¶ï¼Œä¹Ÿåœ¨å¤„ç†æ•°æ®ï¼Œé‚£ä¹ˆå¤„ç†çš„æ•°æ®å¯èƒ½ä¼šä¿®æ”¹å¿«ç…§å†…å®¹ï¼Œæ‰€ä»¥å…ˆæš‚åœå¤„ç†æ•°æ®ï¼ŒæŠŠå†…å­˜ä¸­å¿«ç…§ä¿å­˜å¥½åï¼Œå†å¤„ç†æ•°æ®ã€‚ç»“åˆæ¡ˆä¾‹æ¥è®²å°±æ˜¯ï¼ŒPV task åœ¨å¯¹ï¼ˆapp1ï¼Œ50000ï¼‰ï¼ˆapp2ï¼Œ10000ï¼‰åšå¿«ç…§çš„åŒæ—¶ï¼Œå¦‚æœ barrier ä¹‹åçš„æ•°æ®è¿˜åœ¨å¤„ç†ï¼Œå¯èƒ½ä¼šå¯¼è‡´çŠ¶æ€ä¿¡æ¯è¿˜æ²¡ä¿å­˜åˆ°ç£ç›˜ï¼ŒçŠ¶æ€å·²ç»å˜æˆäº†ï¼ˆapp1ï¼Œ50001ï¼‰ï¼ˆapp2ï¼Œ10001ï¼‰ï¼Œå¯¼è‡´æˆ‘ä»¬æœ€åå¿«ç…§é‡Œä¿å­˜çš„ PV å€¼å˜æˆäº†ï¼ˆapp1ï¼Œ50001ï¼‰ï¼ˆapp2ï¼Œ10001ï¼‰ï¼Œè¿™æ ·å¦‚æœä» Checkpoint æ¢å¤ä»»åŠ¡æ—¶ï¼Œæˆ‘ä»¬ä» offset 60000 å¼€å§‹æ¶ˆè´¹ï¼ŒPV å€¼ä» ï¼ˆapp1ï¼Œ50001ï¼‰ï¼ˆapp2ï¼Œ10001ï¼‰ å¼€å§‹ç´¯åŠ ï¼Œå°±ä¼šé€ æˆè®¡ç®—çš„ PV ç»“æœåé«˜ï¼Œç»“æœä¸å‡†ç¡®ï¼Œå°±ä¸èƒ½ä¿è¯ Exactly Onceã€‚æ‰€ä»¥ï¼ŒCheckpoint åŒæ­¥åšå¿«ç…§çš„è¿‡ç¨‹ä¸­ï¼Œä¸èƒ½å¤„ç† barrier ä¹‹åçš„æ•°æ®ã€‚Checkpoint å°†å¿«ç…§ä¿¡æ¯å†™å…¥åˆ°ç£ç›˜åï¼Œä¸ºäº†ä¿è¯å¿«ç…§ä¿¡æ¯çš„é«˜å¯ç”¨ï¼Œéœ€è¦å°†å¿«ç…§ä¸Šä¼ åˆ° HDFSï¼Œè¿™ä¸ªä¸Šä¼ å¿«ç…§åˆ° HDFS çš„è¿‡ç¨‹æ˜¯å¼‚æ­¥è¿›è¡Œçš„ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¹Ÿå¯ä»¥å¤„ç† barrier ä¹‹åçš„æ•°æ®ï¼Œå¤„ç† barrier ä¹‹åçš„æ•°æ®ä¸ä¼šå½±å“åˆ°ç£ç›˜ä¸Šçš„å¿«ç…§ä¿¡æ¯ã€‚ ä» PV æ¡ˆä¾‹å†åˆ†æ Flink æ˜¯å¦‚ä½•åš Checkpoint å¹¶ä» Checkpoint å¤„æ¢å¤ä»»åŠ¡çš„ï¼Œé¦–å…ˆ JobManager ç«¯ä¼šå‘æ‰€æœ‰ SourceTask å‘é€ Checkpointï¼ŒSource Task ä¼šåœ¨æ•°æ®æµä¸­å®‰æ’ Checkpoint barrierï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ Source Task å®‰æ’å¥½ barrier åï¼Œä¼šå°† barrier è·Ÿæ•°æ®ä¸€å—å‘é€ç»™ä¸‹æ¸¸ï¼Œç„¶åè‡ªèº«å¼€å§‹åšå¿«ç…§ï¼Œå¹¶å°†å¿«ç…§ä¿¡æ¯ offset (0,60000) å‘é€åˆ°é«˜å¯ç”¨çš„æŒä¹…åŒ–å­˜å‚¨ä»‹è´¨ï¼Œä¾‹å¦‚ HDFS ä¸Šï¼Œå‘é€æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ ä¸‹æ¸¸çš„ PV task æ¥æ”¶åˆ° barrier åï¼Œä¹Ÿä¼šåšå¿«ç…§ï¼Œå¹¶å°†å¿«ç…§ä¿¡æ¯ PVï¼š(app1,50000) (app2,10000) å‘é€åˆ° HDFS ä¸Šï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ å‡è®¾ç¬¬ 100 æ¬¡ Checkpoint å®Œæˆåï¼Œä¸€æ®µæ—¶é—´åä»»åŠ¡æŒ‚äº†ï¼ŒFlink ä»»åŠ¡ä¼šè‡ªåŠ¨ä»çŠ¶æ€åç«¯æ¢å¤ä»»åŠ¡ã€‚Source Task å»è¯»å–è‡ªå·±éœ€è¦çš„çŠ¶æ€ä¿¡æ¯ offset (0,60000) ï¼Œå¹¶ä» offset ä¸º 60000 çš„ä½ç½®æ¥ç€å¼€å§‹æ¶ˆè´¹æ•°æ®ï¼ŒPV task ä¹Ÿä¼šå»è¯»å–éœ€è¦çš„çŠ¶æ€ä¿¡æ¯ PVï¼š(app1,50000) (app2,10000)ï¼Œå¹¶åœ¨è¯¥çŠ¶æ€å€¼çš„åŸºç¡€ä¸Šï¼Œå¾€ä¸Šç´¯ç§¯è®¡ç®— PV å€¼ï¼Œæµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ å¤šå¹¶è¡Œåº¦ã€å¤š Operator æƒ…å†µä¸‹ï¼ŒCheckpoint çš„è¿‡ç¨‹ä¸Šä¸€èŠ‚ä¸­è®²è¿°äº†å•å¹¶è¡Œåº¦æƒ…å†µä¸‹ Checkpoint çš„è¿‡ç¨‹ï¼Œä½†æ˜¯ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œä¸€èˆ¬éƒ½æ˜¯å¤šå¹¶è¡Œåº¦ï¼Œè€Œä¸”ç®—å­ä¹Ÿä¼šæ¯”è¾ƒå¤šï¼Œè¿™ç§æƒ…å†µä¸‹ Checkpoint çš„è¿‡ç¨‹å°±ä¼šå˜å¾—å¤æ‚ã€‚åˆ†å¸ƒå¼çŠ¶æ€å®¹é”™é¢ä¸´çš„é—®é¢˜ä¸æŒ‘æˆ˜ï¼š å¦‚ä½•ç¡®ä¿çŠ¶æ€æ‹¥æœ‰ç²¾ç¡®ä¸€æ¬¡çš„å®¹é”™ä¿è¯ï¼Ÿ å¦‚ä½•åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹æ›¿å¤šä¸ªæ‹¥æœ‰æœ¬åœ°çŠ¶æ€çš„ç®—å­äº§ç”Ÿä¸€ä¸ªå…¨åŸŸä¸€è‡´çš„å¿«ç…§ï¼Ÿ å¦‚ä½•åœ¨ä¸ä¸­æ–­è¿ç®—çš„å‰æä¸‹äº§ç”Ÿå¿«ç…§ï¼Ÿ å¤šå¹¶è¡Œåº¦ã€å¤š Operator å®ä¾‹çš„æƒ…å†µä¸‹ï¼Œå¦‚ä½•åšå…¨åŸŸä¸€è‡´çš„å¿«ç…§ï¼Ÿæ‰€æœ‰çš„ Operator è¿è¡Œè¿‡ç¨‹ä¸­æ¥æ”¶åˆ°æ‰€æœ‰ä¸Šæ¸¸ç®—å­å‘é€ barrier åï¼Œå¯¹è‡ªèº«çš„çŠ¶æ€è¿›è¡Œä¸€æ¬¡å¿«ç…§ï¼Œä¿å­˜åˆ°ç›¸åº”çŠ¶æ€åç«¯ï¼Œæµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ å½“ä»»åŠ¡ä»çŠ¶æ€æ¢å¤æ—¶ï¼Œæ¯ä¸ª Operator ä»çŠ¶æ€åç«¯è¯»å–è‡ªå·±ç›¸åº”çš„çŠ¶æ€ä¿¡æ¯ï¼Œæ•°æ®æºä¼šä»çŠ¶æ€ä¸­ä¿å­˜çš„ä½ç½®å¼€å§‹é‡æ–°æ¶ˆè´¹ï¼Œåç»­çš„å…¶ä»–ç®—å­ä¹Ÿä¼šåŸºäº Checkpoint ä¸­ä¿å­˜çš„çŠ¶æ€è¿›è¡Œè®¡ç®—ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ æ•´ä¸ª Checkpoint çš„è¿‡ç¨‹è·Ÿä¹‹å‰å•å¹¶è¡Œåº¦ç±»ä¼¼ï¼Œå›¾ä¸­æœ‰ 4 ä¸ªå¸¦çŠ¶æ€çš„ Operator å®ä¾‹ï¼Œç›¸åº”çš„çŠ¶æ€åç«¯å°±å¯ä»¥æƒ³è±¡æˆ 4 ä¸ªæ ¼å­ã€‚æ•´ä¸ª Checkpoint çš„è¿‡ç¨‹å¯ä»¥å½“åš Operator å®ä¾‹å¡«è‡ªå·±æ ¼å­çš„è¿‡ç¨‹ï¼ŒOperator å®ä¾‹å°†è‡ªèº«çš„çŠ¶æ€å†™åˆ°çŠ¶æ€åç«¯ä¸­ç›¸åº”çš„æ ¼å­ï¼Œå½“æ‰€æœ‰çš„æ ¼å­å¡«æ»¡å¯ä»¥ç®€å•çš„è®¤ä¸ºä¸€æ¬¡å®Œæ•´çš„ Checkpoint åšå®Œäº†ã€‚ ä¸Šé¢åªæ˜¯å¿«ç…§çš„è¿‡ç¨‹ï¼ŒCheckpoint æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š 1ã€JobManager ç«¯çš„ CheckPointCoordinator å‘æ‰€æœ‰ Source Task å‘é€ CheckPointTriggerï¼ŒSource Taskä¼šåœ¨æ•°æ®æµä¸­å®‰æ’ Checkpoint barrier 2ã€å½“ task æ”¶åˆ°æ‰€æœ‰çš„ barrier åï¼Œå‘è‡ªå·±çš„ä¸‹æ¸¸ç»§ç»­ä¼ é€’ barrierï¼Œç„¶åè‡ªèº«æ‰§è¡Œå¿«ç…§ï¼Œå¹¶å°†è‡ªå·±çš„çŠ¶æ€å¼‚æ­¥å†™å…¥åˆ°æŒä¹…åŒ–å­˜å‚¨ä¸­ å¢é‡ CheckPoint åªæ˜¯æŠŠæœ€æ–°çš„ä¸€éƒ¨åˆ†æ•°æ®æ›´æ–°å†™å…¥åˆ°å¤–éƒ¨å­˜å‚¨ ä¸ºäº†ä¸‹æ¸¸å°½å¿«å¼€å§‹åš CheckPointï¼Œæ‰€ä»¥ä¼šå…ˆå‘é€ barrier åˆ°ä¸‹æ¸¸ï¼Œè‡ªèº«å†åŒæ­¥è¿›è¡Œå¿«ç…§ 3ã€å½“ task å¯¹çŠ¶æ€çš„å¿«ç…§ä¿¡æ¯å®Œæˆå¤‡ä»½åï¼Œä¼šå°†å¤‡ä»½æ•°æ®çš„åœ°å€ï¼ˆstate handleï¼‰é€šçŸ¥ç»™ JobManager çš„ CheckPointCoordinator å¦‚æœ Checkpoint çš„æŒç»­æ—¶é•¿è¶…è¿‡äº† Checkpoint è®¾å®šçš„è¶…æ—¶æ—¶é—´ï¼ŒCheckPointCoordinator è¿˜æ²¡æœ‰æ”¶é›†å®Œæ‰€æœ‰çš„ State Handleï¼ŒCheckPointCoordinatorå°±ä¼šè®¤ä¸ºæœ¬æ¬¡ Checkpoint å¤±è´¥ï¼Œä¼šæŠŠè¿™æ¬¡ Checkpoint äº§ç”Ÿçš„æ‰€æœ‰ çŠ¶æ€æ•°æ®å…¨éƒ¨åˆ é™¤ 4ã€CheckPointCoordinator æŠŠæ•´ä¸ª StateHandle å°è£…æˆ Completed Checkpoint Metaï¼Œå†™å…¥åˆ° HDFSï¼Œæ•´ä¸ª Checkpoint ç»“æŸ barrier å¯¹é½ä»€ä¹ˆæ˜¯ barrier å¯¹é½ï¼Ÿå¦‚å›¾æ‰€ç¤ºï¼Œå½“å‰çš„ Operator å®ä¾‹æ¥æ”¶ä¸Šæ¸¸ä¸¤ä¸ªæµçš„æ•°æ®ï¼Œä¸€ä¸ªæ˜¯å­—æ¯æµï¼Œä¸€ä¸ªæ˜¯æ•°å­—æµã€‚ å½“ Checkpoint æ—¶ï¼Œä¸Šæ¸¸å­—æ¯æµå’Œæ•°å­—æµéƒ½ä¼šå¾€ Operator å®ä¾‹å‘é€ Checkpoint barrierï¼Œä½†æ˜¯ç”±äºæ¯ä¸ªç®—å­çš„æ‰§è¡Œé€Ÿç‡ä¸åŒï¼Œæ‰€ä»¥ä¸å¯èƒ½ä¿è¯ä¸Šæ¸¸ä¸¤ä¸ªæµçš„ barrier åŒæ—¶åˆ°è¾¾ Operator å®ä¾‹ï¼Œé‚£å›¾ä¸­çš„ Operator å®ä¾‹åˆ°åº•ä»€ä¹ˆæ—¶å€™è¿›è¡Œå¿«ç…§å‘¢ï¼Ÿæ¥æ”¶åˆ°ä»»æ„ä¸€ä¸ª barrier å°±å¯ä»¥å¼€å§‹è¿›è¡Œå¿«ç…§äº†å—ï¼Œè¿˜æ˜¯æ¥æ”¶åˆ°æ‰€æœ‰çš„ barrier æ‰èƒ½å¼€å§‹è¿›è¡Œå¿«ç…§å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼šå½“ä¸€ä¸ª Operator å®ä¾‹æœ‰å¤šä¸ªè¾“å…¥æµæ—¶ï¼ŒOperator å®ä¾‹éœ€è¦åœ¨åšå¿«ç…§ä¹‹å‰è¿›è¡Œ barrier å¯¹é½ï¼Œç­‰å¾…æ‰€æœ‰è¾“å…¥æµçš„ barrier éƒ½åˆ°è¾¾ã€‚barrier å¯¹é½çš„è¯¦ç»†è¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š 1ã€å¯¹äºä¸€ä¸ªæœ‰å¤šä¸ªè¾“å…¥æµçš„ Operator å®ä¾‹ï¼Œå½“ Operator å®ä¾‹ä»å…¶ä¸­ä¸€ä¸ªè¾“å…¥æµæ¥æ”¶åˆ° Checkpoint barrier n æ—¶ï¼Œå°±ä¸èƒ½å¤„ç†æ¥è‡ªè¯¥æµçš„ä»»ä½•æ•°æ®è®°å½•äº†ï¼Œç›´åˆ°å®ƒä»å…¶ä»–æ‰€æœ‰è¾“å…¥æµæ¥æ”¶åˆ° barrier nä¸ºæ­¢ï¼Œå¦åˆ™ Operator å®ä¾‹ Checkpoint n çš„å¿«ç…§ä¼šæ··å…¥å¿«ç…§ n çš„è®°å½•å’Œå¿«ç…§ n + 1 çš„è®°å½•ã€‚å¦‚ä¸Šå›¾ä¸­ç¬¬ 1 ä¸ªå°å›¾æ‰€ç¤ºï¼Œæ•°å­—æµçš„ barrier å…ˆåˆ°è¾¾äº†ã€‚ 2ã€æ¥æ”¶åˆ° barrier n çš„æµæš‚æ—¶è¢«æç½®ï¼Œä»è¿™äº›æµæ¥æ”¶çš„è®°å½•ä¸ä¼šè¢«å¤„ç†ï¼Œè€Œæ˜¯æ”¾å…¥è¾“å…¥ç¼“å†²åŒºã€‚å›¾ 2 ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è™½ç„¶æ•°å­—æµå¯¹åº”çš„ barrier å·²ç»åˆ°è¾¾äº†ï¼Œä½†æ˜¯barrierä¹‹åçš„ 1ã€2ã€3 è¿™äº›æ•°æ®åªèƒ½æ”¾åˆ°ç¼“å†²åŒºä¸­ï¼Œç­‰å¾…å­—æ¯æµçš„barrieråˆ°è¾¾ã€‚ 3ã€ä¸€æ—¦æœ€åæ‰€æœ‰è¾“å…¥æµéƒ½æ¥æ”¶åˆ° barrier nï¼ŒOperator å®ä¾‹å°±ä¼šæŠŠ barrier ä¹‹å‰æ‰€æœ‰å·²ç»å¤„ç†å®Œæˆçš„æ•°æ®å’Œ barrier n ä¸€å—å‘é€ç»™ä¸‹æ¸¸ã€‚ç„¶å Operator å®ä¾‹å°±å¯ä»¥å¯¹çŠ¶æ€ä¿¡æ¯è¿›è¡Œå¿«ç…§ã€‚å¦‚å›¾ 3 æ‰€ç¤ºï¼ŒOperator å®ä¾‹æ¥æ”¶åˆ°ä¸Šæ¸¸æ‰€æœ‰æµçš„ barrier nï¼Œæ­¤æ—¶ Operator å®ä¾‹å°±å¯ä»¥å°† barrier å’Œ barrier ä¹‹å‰çš„æ•°æ®å‘é€åˆ°ä¸‹æ¸¸ï¼Œç„¶åè‡ªèº«çŠ¶æ€è¿›è¡Œå¿«ç…§ã€‚ 4ã€å¿«ç…§åšå®Œåï¼ŒOperator å®ä¾‹å°†ç»§ç»­å¤„ç†ç¼“å†²åŒºçš„è®°å½•ï¼Œç„¶åå°±å¯ä»¥å¤„ç†è¾“å…¥æµçš„æ•°æ®ã€‚å¦‚å›¾ 4 æ‰€ç¤ºï¼Œå…ˆå¤„ç†å®Œç¼“å†²åŒºæ•°æ®ï¼Œå°±å¯ä»¥æ­£å¸¸å¤„ç†è¾“å…¥æµçš„æ•°æ®äº†ã€‚ ä¸Šé¢çš„è¿‡ç¨‹å°±æ˜¯ Flink åœ¨ Operator å®ä¾‹æœ‰å¤šä¸ªè¾“å…¥æµçš„æƒ…å†µä¸‹ï¼Œæ•´ä¸ª barrier å¯¹é½çš„è¿‡ç¨‹ã€‚é‚£ä»€ä¹ˆæ˜¯ barrier ä¸å¯¹é½å‘¢ï¼Ÿbarrier ä¸å¯¹é½æ˜¯æŒ‡å½“è¿˜æœ‰å…¶ä»–æµçš„ barrier è¿˜æ²¡åˆ°è¾¾æ—¶ï¼Œä¸ºäº†æé«˜ Operator å®ä¾‹çš„å¤„ç†æ€§èƒ½ï¼ŒOperator å®ä¾‹ä¼šç›´æ¥å¤„ç† barrier ä¹‹åçš„æ•°æ®ï¼Œç­‰åˆ°æ‰€æœ‰æµçš„ barrier éƒ½åˆ°è¾¾åï¼Œå°±å¯ä»¥å¯¹è¯¥ Operator åš Checkpoint å¿«ç…§äº†ã€‚å¯¹åº”åˆ°å›¾ä¸­å°±æ˜¯ï¼Œbarrier ä¸å¯¹é½æ—¶ä¼šç›´æ¥æŠŠ barrier ä¹‹åçš„æ•°æ® 1ã€2ã€3 ç›´æ¥å¤„ç†æ‰ï¼Œè€Œä¸æ˜¯æ”¾åˆ°ç¼“å†²åŒºä¸­ç­‰å¾…å…¶ä»–çš„è¾“å…¥æµçš„ barrier åˆ°è¾¾ï¼Œå½“æ‰€æœ‰è¾“å…¥æµçš„ barrier éƒ½åˆ°è¾¾åï¼Œæ‰å¼€å§‹å¯¹ Operator å®ä¾‹çš„çŠ¶æ€ä¿¡æ¯è¿›è¡Œå¿«ç…§ï¼Œè¿™æ ·ä¼šå¯¼è‡´åšå¿«ç…§ä¹‹å‰ï¼ŒOperator å®ä¾‹å·²ç»å¤„ç†äº†ä¸€äº› barrier n ä¹‹åçš„æ•°æ®ã€‚Checkpoint çš„ç›®çš„æ˜¯ä¸ºäº†ä¿å­˜å¿«ç…§ä¿¡æ¯ï¼Œå¦‚æœ barrier ä¸å¯¹é½ï¼Œé‚£ä¹ˆ Operator å®ä¾‹åœ¨åšç¬¬ n æ¬¡ Checkpoint ä¹‹å‰ï¼Œå·²ç»å¤„ç†äº†ä¸€äº› barrier n ä¹‹åçš„æ•°æ®ï¼Œå½“ç¨‹åºä»ç¬¬ n æ¬¡ Checkpoint æ¢å¤ä»»åŠ¡æ—¶ï¼Œç¨‹åºä¼šä»ç¬¬ n æ¬¡ Checkpoint ä¿å­˜çš„ offset ä½ç½®å¼€å§‹æ¶ˆè´¹æ•°æ®ï¼Œå°±ä¼šå¯¼è‡´ä¸€äº›æ•°æ®è¢«å¤„ç†äº†ä¸¤æ¬¡ï¼Œå°±å‡ºç°äº†é‡å¤æ¶ˆè´¹ã€‚å¦‚æœè¿›è¡Œ barrier å¯¹é½ï¼Œå°±ä¸ä¼šå‡ºç°è¿™ç§é‡å¤æ¶ˆè´¹çš„é—®é¢˜ï¼Œæ‰€ä»¥ barrier å¯¹é½å°±å¯ä»¥å®ç° Exactly Onceï¼Œbarrier ä¸å¯¹é½å°±å˜æˆäº†At Least Onceã€‚ å†ç»“åˆè®¡ç®— PV çš„æ¡ˆä¾‹æ¥è¯æ˜ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆ barrier å¯¹é½å°±å¯ä»¥å®ç° Exactly Onceï¼Œbarrier ä¸å¯¹é½å°±å˜æˆäº† At Least Onceã€‚ä¹‹å‰çš„æ¡ˆä¾‹ä¸ºäº†ç®€å•ï¼Œæè¿°çš„ kafka topic åªæœ‰ 1 ä¸ª partitionï¼Œè¿™é‡Œä¸ºäº†è®²è¿° barrier å¯¹é½ï¼Œå‡è®¾ topic æœ‰ 2 ä¸ª partittionï¼Œä¸”è®¡ç®—çš„æ˜¯æˆ‘ä»¬å¹³å°çš„æ€» PVï¼Œä¹Ÿå°±æ˜¯è¯´ä¸éœ€è¦åŒºåˆ† appï¼Œæ¯æ¡ä¸€æ¡æ•°æ®ï¼Œæˆ‘ä»¬éƒ½éœ€è¦å°†å…¶ PV å€¼ +1 å³å¯ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒFlink åº”ç”¨ç¨‹åºæœ‰ä¸¤ä¸ª Source Taskï¼Œä¸€ä¸ªè®¡ç®— PV çš„ Taskï¼Œè¿™é‡Œè®¡ç®— PV çš„ Task å°±å‡ºç°äº†å­˜åœ¨å¤šä¸ªè¾“å…¥æµçš„æƒ…å†µã€‚ å‡è®¾ barrier ä¸å¯¹é½ï¼Œé‚£ä¹ˆ Checkpoint è¿‡ç¨‹æ˜¯æ€ä¹ˆæ ·å‘¢ï¼Ÿå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å¦‚ä¸Šå›¾å·¦éƒ¨åˆ†æ‰€ç¤ºï¼ŒSource Subtask 0 å’Œ Subtask 1 å·²ç»å®Œæˆäº†å¿«ç…§æ“ä½œï¼Œä»–ä»¬çš„çŠ¶æ€ä¿¡æ¯ä¸º offset(0,10000)(1,10005) è¡¨ç¤º partition0 æ¶ˆè´¹åˆ° offset ä¸º 10000 çš„ä½ç½®ï¼Œpartition 1 æ¶ˆè´¹åˆ° offset ä¸º 10005 çš„ä½ç½®ã€‚å½“ Source Subtask 1 çš„ barrier åˆ°è¾¾ PV task æ—¶ï¼Œè®¡ç®—çš„ PV ç»“æœä¸º 20002ï¼Œä½† PV task è¿˜æ²¡æœ‰æ¥æ”¶åˆ° Source Subtask 0 å‘é€çš„ barrierï¼Œæ‰€ä»¥ PV task è¿˜ä¸èƒ½å¯¹è‡ªèº«çŠ¶æ€ä¿¡æ¯è¿›è¡Œå¿«ç…§ã€‚ç”±äºè®¾ç½®çš„ barrier ä¸å¯¹é½ï¼Œæ‰€ä»¥æ­¤æ—¶ PV task ä¼šç»§ç»­å¤„ç† Source Subtask 0 å’Œ Source Subtask 1 ä¼ æ¥çš„æ•°æ®ã€‚å¾ˆå¿«ï¼Œå¦‚ä¸Šå›¾å³éƒ¨åˆ†æ‰€ç¤ºï¼ŒPV task æ¥æ”¶åˆ° Source Subtask 0 å‘æ¥çš„ barrierï¼Œä½†æ˜¯ PV task å·²ç»å¤„ç†äº† Source Subtask 1 barrier ä¹‹åçš„ä¸‰æ¡æ•°æ®ï¼Œæ‰€ä»¥ PV å€¼ç›®å‰å·²ç»ä¸º 20008äº†ï¼Œè¿™é‡Œçš„ PV=20008 å®é™…ä¸Šå·²ç»å¤„ç†åˆ° partition 1 offset ä¸º 10008 çš„ä½ç½®ï¼Œæ­¤æ—¶ PV task ä¼šå¯¹è‡ªèº«çš„çŠ¶æ€ä¿¡æ¯ï¼ˆPV = 20008ï¼‰åšå¿«ç…§ï¼Œæ•´ä½“çš„å¿«ç…§ä¿¡æ¯ä¸º offset(0,10000)(1,10005) PV=20008ã€‚ æ¥ç€ç¨‹åºåœ¨ç»§ç»­è¿è¡Œï¼Œè¿‡äº† 10 ç§’ï¼Œç”±äºæŸä¸ªæœåŠ¡å™¨æ•…éšœï¼Œå¯¼è‡´æˆ‘ä»¬çš„ Operator å®ä¾‹æœ‰ä¸€ä¸ªæŒ‚äº†ï¼Œæ‰€ä»¥ Flink ä¼šä»æœ€è¿‘ä¸€æ¬¡ Checkpoint ä¿å­˜çš„çŠ¶æ€æ¢å¤ã€‚é‚£å…·ä½“æ˜¯æ€ä¹ˆæ¢å¤çš„å‘¢ï¼ŸFlink åŒæ ·ä¼šèµ·ä¸‰ä¸ª Operator å®ä¾‹ï¼Œæˆ‘è¿˜ç§°ä»–ä»¬æ˜¯ Source Subtask 0 ã€Source Subtask 1 å’Œ PV taskã€‚ä¸‰ä¸ª Operator ä¼šä»çŠ¶æ€åç«¯è¯»å–ä¿å­˜çš„çŠ¶æ€ä¿¡æ¯ã€‚Source Subtask 0 ä¼šä» partition 0 offset ä¸º 10000 çš„ä½ç½®å¼€å§‹æ¶ˆè´¹ï¼ŒSource Subtask 1 ä¼šä» partition 1 offset ä¸º 10005 çš„ä½ç½®å¼€å§‹æ¶ˆè´¹ï¼ŒPV task ä¼šåŸºäº PV=20008 è¿›è¡Œç´¯åŠ ç»Ÿè®¡ã€‚ç„¶åå°±ä¼šå‘ç°çš„ PV å€¼ 20008 å®é™…ä¸Šå·²ç»åŒ…å«äº† partition 1 çš„ offset 10005~10008 çš„æ•°æ®ï¼Œæ‰€ä»¥ partition 1 ä» offset 10005 æ¢å¤ä»»åŠ¡æ—¶ï¼Œpartition1 çš„ offset 10005~10008 çš„æ•°æ®è¢«æ¶ˆè´¹äº†ä¸¤æ¬¡ï¼Œå‡ºç°äº†é‡å¤æ¶ˆè´¹çš„é—®é¢˜ï¼Œæ‰€ä»¥ barrier ä¸å¯¹é½åªèƒ½ä¿è¯ At Least Onceã€‚ å¦‚æœè®¾ç½®ä¸º barrier å¯¹é½ï¼Œè¿™é‡Œèƒ½ä¿è¯ Exactly Once å—ï¼Ÿå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå½“ PV task æ¥æ”¶åˆ° Source Subtask 1 çš„ barrier åï¼Œå¹¶ä¸ä¼šå¤„ç† Source Subtask 1 barrier ä¹‹åçš„æ•°æ®ï¼Œè€Œæ˜¯æŠŠè¿™äº›æ•°æ®æ”¾åˆ° PV task çš„è¾“å…¥ç¼“å†²åŒºä¸­ï¼Œç›´åˆ°ç­‰åˆ° Source Subtask 0 çš„ barrier åˆ°è¾¾åï¼ŒPV task æ‰ä¼šå¯¹è‡ªèº«çŠ¶æ€ä¿¡æ¯è¿›è¡Œå¿«ç…§ï¼Œæ­¤æ—¶ PV task ä¼šæŠŠ PV=20005 ä¿å­˜åˆ°å¿«ç…§ä¿¡æ¯ä¸­ï¼Œæ•´ä½“çš„å¿«ç…§çŠ¶æ€ä¿¡æ¯ä¸º offset(0,10000)(1,10005) PV=20005ï¼Œå½“ä»»åŠ¡ä» Checkpoint æ¢å¤æ—¶ï¼ŒSource Subtask 0 ä¼šä» partition 0 offset ä¸º 10000 çš„ä½ç½®å¼€å§‹æ¶ˆè´¹ï¼ŒSource Subtask 1 ä¼šä» partition 1 offset ä¸º 10005 çš„ä½ç½®å¼€å§‹æ¶ˆè´¹ï¼ŒPV task ä¼šåŸºäº PV=20005 è¿›è¡Œç´¯åŠ ç»Ÿè®¡ï¼Œæ‰€ä»¥ barrier å¯¹é½èƒ½ä¿è¯ Flink å†…éƒ¨çš„ Exactly Onceã€‚åœ¨ Flink åº”ç”¨ç¨‹åºä¸­ï¼Œå½“ Checkpoint è¯­ä¹‰è®¾ç½® Exactly Once æˆ– At Least Once æ—¶ï¼Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯ barrier å¯¹ä¸å¯¹é½ã€‚å½“è®¾ç½®ä¸º Exactly Once æ—¶ï¼Œå°±ä¼š barrier å¯¹é½ï¼Œå½“è®¾ç½®ä¸º At Least Once æ—¶ï¼Œå°±ä¼š barrier ä¸å¯¹é½ã€‚ é€šè¿‡æœ¬æ¡ˆä¾‹ï¼Œæˆ‘ä»¬åº”è¯¥å‘ç°äº† barrier åœ¨ Flink çš„ Checkpoint ä¸­èµ·ç€éå¸¸å¤§çš„ä½œç”¨ã€‚barrier å‘Šè¯‰ Flink åº”ç”¨ç¨‹åºï¼ŒCheckpoint ä¹‹å‰å“ªäº›æ•°æ®ä¸åº”è¯¥è¢«å¤„ç†ï¼Œbarrier å¯¹é½çš„è¿‡ç¨‹å…¶å®å°±æ˜¯ä¸ºäº†é˜²æ­¢ Flink åº”ç”¨ç¨‹åºå¤„ç†é‡å¤çš„æ•°æ®ã€‚æ€»ç»“ä¸€ä¸‹ï¼Œæ»¡è¶³å“ªäº›æ¡ä»¶æ—¶ï¼Œä¼šå‡ºç° barrier å¯¹é½ï¼Ÿåœ¨ä»£ç ä¸­è®¾ç½®äº† Flink çš„ Checkpoint è¯­ä¹‰æ˜¯ Exactly Onceï¼Œå…¶æ¬¡ Operator å®ä¾‹å¿…é¡»æœ‰å¤šä¸ªè¾“å…¥æµæ‰ä¼šå‡ºç° barrier å¯¹é½ã€‚å¯¹é½ï¼Œæ±‰è¯­è¯æ±‡ï¼Œé‡Šä¹‰ä¸ºä½¿ä¸¤ä¸ªä»¥ä¸Šäº‹ç‰©é…åˆæˆ–æ¥è§¦å¾—æ•´é½ã€‚ç”±æ±‰è¯­è§£é‡Šå¯å¾—å¯¹é½è‚¯å®šéœ€è¦ä¸¤ä¸ªä»¥ä¸Šäº‹ç‰©ï¼Œæ‰€ä»¥å¿…é¡»æœ‰å¤šä¸ªè¾“å…¥æµæ‰å¯èƒ½å­˜åœ¨å¯¹é½ã€‚barrier å¯¹é½å°±æ˜¯ä¸Šæ¸¸å¤šä¸ªæµé…åˆä½¿å¾—æ•°æ®å¯¹é½çš„è¿‡ç¨‹ã€‚è¨€å¤–ä¹‹æ„ï¼šå¦‚æœ Operator å®ä¾‹åªæœ‰ä¸€ä¸ªè¾“å…¥æµï¼Œå°±æ ¹æœ¬ä¸å­˜åœ¨ barrier å¯¹é½ï¼Œè‡ªå·±è·Ÿè‡ªå·±é»˜è®¤æ°¸è¿œéƒ½æ˜¯å¯¹é½çš„ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä» Source åˆ° Sink æ‰€æœ‰ç®—å­çš„å¹¶è¡Œåº¦éƒ½æ˜¯ 1 çš„è¯ï¼Œå°±ç®—è®¾ç½®çš„ At Least Onceï¼Œæ— å½¢ä¸­ä¹Ÿå®ç°äº† barrier å¯¹é½ï¼Œæ­¤æ—¶ Checkpoint è®¾ç½®æˆ Exactly Once å’Œ At Least Once ä¸€ç‚¹åŒºåˆ«éƒ½æ²¡æœ‰ï¼Œéƒ½å¯ä»¥ä¿è¯ Exactly Onceã€‚çœ‹åˆ°è¿™é‡Œä½ åº”è¯¥å·²ç»çŸ¥é“äº†å“ªç§æƒ…å†µä¼šå‡ºç°é‡å¤æ¶ˆè´¹äº†ï¼Œä¹Ÿåº”è¯¥è¦æŒæ¡ä¸ºä»€ä¹ˆ barrier å¯¹é½å°±èƒ½ä¿è¯ Exactly Onceï¼Œä¸ºä»€ä¹ˆ barrier ä¸å¯¹é½å°±æ˜¯ At Least Onceã€‚ barrier å¯¹é½å…¶å®æ˜¯è¦ä»˜å‡ºä»£ä»·çš„ï¼Œä» barrier å¯¹é½çš„è¿‡ç¨‹å¯ä»¥çœ‹å‡ºï¼ŒPV task æ˜æ˜å¯ä»¥æ›´é«˜æ•ˆçš„å¤„ç†æ•°æ®ï¼Œä½†å› ä¸º barrier å¯¹é½ï¼Œå¯¼è‡´ Source Subtask 1 barrier ä¹‹åçš„æ•°æ®è¢«æ”¾åˆ°ç¼“å†²åŒºä¸­ï¼Œæš‚æ—¶æ€§åœ°æ²¡æœ‰è¢«å¤„ç†ï¼Œå‡å¦‚ç”Ÿäº§ç¯å¢ƒä¸­ï¼ŒSource Subtask 0 çš„ barrier è¿Ÿè¿Ÿæ²¡æœ‰åˆ°è¾¾ï¼Œæ¯” Source Subtask 1 å»¶è¿Ÿäº† 30 ç§’ï¼Œé‚£ä¹ˆè¿™ 30 ç§’æœŸé—´ï¼ŒSource Subtask 1 barrier ä¹‹åçš„æ•°æ®ä¸èƒ½è¢«å¤„ç†ï¼Œæ‰€ä»¥ PV task ç›¸å½“äºè¢«é—²ç½®äº†ã€‚æ‰€ä»¥ï¼Œå½“æˆ‘ä»¬çš„ä¸€äº›ä¸šåŠ¡åœºæ™¯å¯¹ Exactly Once è¦æ±‚ä¸é«˜æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½® Flink çš„ Checkpoint è¯­ä¹‰æ˜¯ At Least Once æ¥å°å¹…åº¦çš„æé«˜åº”ç”¨ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ã€‚Flink Web UI çš„ Checkpoint é€‰é¡¹å¡ä¸­å¯ä»¥çœ‹åˆ° barrier å¯¹é½çš„è€—æ—¶ï¼Œå¦‚æœå‘ç°è€—æ—¶æ¯”è¾ƒé•¿ï¼Œä¸”å¯¹ Exactly Once è¯­ä¹‰è¦æ±‚ä¸é«˜æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨è¯¥ä¼˜åŒ–æ–¹æ¡ˆã€‚ å‰é¢æåˆ°å¦‚ä½•åœ¨ä¸ä¸­æ–­è¿ç®—çš„å‰æä¸‹äº§ç”Ÿå¿«ç…§ï¼Ÿåœ¨ Flink çš„ Checkpoint è¿‡ç¨‹ä¸­ï¼Œæ— è®ºä¸‹æ¸¸ç®—å­æœ‰æ²¡æœ‰åšå®Œå¿«ç…§ï¼Œåªè¦ä¸Šæ¸¸ç®—å­å°† barrier å‘é€åˆ°ä¸‹æ¸¸ä¸”ä¸Šæ¸¸ç®—å­è‡ªèº«å·²ç»åšå®Œå¿«ç…§æ—¶ï¼Œé‚£ä¹ˆä¸Šæ¸¸ç®—å­å°±å¯ä»¥å¤„ç† barrier ä¹‹åçš„æ•°æ®äº†ï¼Œä»è€Œä½¿å¾—æ•´ä¸ªç³»ç»Ÿ Checkpoint çš„è¿‡ç¨‹å½±å“é¢å°½é‡ç¼©åˆ°æœ€å°ï¼Œæ¥æå‡ç³»ç»Ÿæ•´ä½“çš„ååé‡ã€‚ åœ¨æ•´ä¸ª Checkpoint çš„è¿‡ç¨‹ä¸­ï¼Œè¿˜å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå‡è®¾æˆ‘ä»¬è®¾ç½®çš„ 10 åˆ†é’Ÿä¸€æ¬¡ Checkpointã€‚åœ¨ç¬¬ n æ¬¡ Checkpoint æˆåŠŸåï¼Œè¿‡äº† 9 åˆ†é’Ÿï¼Œä»»åŠ¡çªç„¶æŒ‚äº†ï¼Œæˆ‘ä»¬éœ€è¦ä»æœ€è¿‘ä¸€æ¬¡æˆåŠŸçš„ Checkpoint å¤„æ¢å¤ä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯ä» 9 åˆ†é’Ÿä¹‹å‰çš„çŠ¶æ€æ¢å¤ä»»åŠ¡ï¼Œå°±éœ€è¦æŠŠè¿™ 9åˆ†é’Ÿçš„æ•°æ®å…¨éƒ¨å†æ¶ˆè´¹ä¸€æ¬¡ï¼Œæˆæœ¬æ¯”è¾ƒå¤§ã€‚æœ‰çš„åŒå­¦å¯èƒ½ä¼šæƒ³ï¼Œé‚£å¯ä»¥ä¸å¯ä»¥è®¾ç½®ä¸º 100 mså°±åšä¸€æ¬¡ Checkpoint å‘¢ï¼Ÿè¿™æ ·çš„è¯ï¼Œå½“ä»»åŠ¡å‡ºç°æ•…éšœæ—¶ï¼Œå°±ä¸éœ€è¦ä» 9 åˆ†é’Ÿå‰çš„çŠ¶æ€è¿›è¡Œæ¢å¤äº†ï¼Œç›´æ¥ä» 100 msä¹‹å‰çš„çŠ¶æ€æ¢å¤å³å¯ï¼Œæ¢å¤å°±ä¼šå¾ˆå¿«ï¼Œä¸éœ€è¦å¤„ç†å¤§é‡é‡å¤æ•°æ®äº†ã€‚ä½†æ˜¯ï¼Œè¿™æ ·åšä¼šå¯¼è‡´åº”ç”¨ç¨‹åºé¢‘ç¹çš„è®¿é—®çŠ¶æ€åç«¯ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¸ºäº†é«˜å¯ç”¨ï¼Œä¼šæŠŠçŠ¶æ€é‡Œçš„æ•°æ®æ¯”å¦‚ offsetï¼šï¼ˆ0ï¼Œ60000ï¼‰PVï¼šï¼ˆapp1ï¼Œ50000ï¼‰ï¼ˆapp2ï¼Œ10000ï¼‰ ä¿¡æ¯ä¿å­˜åˆ° HDFS ä¸­ï¼Œå¦‚æœé¢‘ç¹è®¿é—® HDFSï¼Œè‚¯å®šä¼šé€ æˆååé‡ä¸‹é™ï¼Œæ‰€ä»¥ä¸€èˆ¬æˆ‘ä»¬çš„ Checkpoint æ—¶é—´é—´éš”å¯ä»¥è®¾ç½®ä¸ºåˆ†é’Ÿçº§åˆ«ï¼Œä¾‹å¦‚ 1 åˆ†é’Ÿã€3 åˆ†é’Ÿï¼Œå¯¹äºçŠ¶æ€å¾ˆå¤§çš„ä»»åŠ¡æ¯æ¬¡ Checkpoint è®¿é—® HDFS æ¯”è¾ƒè€—æ—¶ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥è®¾ç½®ä¸º 5 åˆ†é’Ÿä¸€æ¬¡ Checkpointï¼Œæ¯•ç«Ÿæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæŒ‚çš„æ¦‚ç‡å¹¶ä¸é«˜ï¼Œå¶å°”ä¸€æ¬¡ä» 5 åˆ†é’Ÿå‰çš„çŠ¶æ€æ¢å¤ï¼Œæˆ‘ä»¬æ˜¯å¯ä»¥æ¥å—çš„ã€‚å¯ä»¥æ ¹æ®ä¸šåŠ¡åœºæ™¯åˆç†åœ°è°ƒèŠ‚ Checkpoint çš„é—´éš”æ—¶é•¿ï¼Œå¯¹äºçŠ¶æ€å¾ˆå°çš„ Job Checkpoint ä¼šå¾ˆå¿«ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒå°æ—¶é—´é—´éš”ï¼Œå¯¹äºçŠ¶æ€æ¯”è¾ƒå¤§çš„ Job Checkpoint ä¼šæ¯”è¾ƒæ…¢ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒå¤§ Checkpoint æ—¶é—´é—´éš”ã€‚ æœ‰çš„åŒå­¦å¯èƒ½è¿˜æœ‰ç–‘é—®ï¼Œæ˜æ˜è¯´å¥½çš„ Exactly Onceï¼Œä½†åœ¨ Checkpoint æˆåŠŸå 10s å‘ç”Ÿäº†æ•…éšœï¼Œä»æœ€è¿‘ä¸€æ¬¡æˆåŠŸçš„ Checkpoint å¤„æ¢å¤æ—¶ï¼Œç”±äºå‘ç”Ÿæ•…éšœå‰çš„ 10s Flink ä¹Ÿåœ¨å¤„ç†æ•°æ®ï¼Œæ‰€ä»¥ Flink åº”ç”¨ç¨‹åºè‚¯å®šæ˜¯æŠŠä¸€äº›æ•°æ®é‡å¤å¤„ç†äº†å‘€ã€‚åœ¨é¢å¯¹ä»»æ„æ•…éšœæ—¶ï¼Œä¸å¯èƒ½ä¿è¯æ¯ä¸ªç®—å­ä¸­ç”¨æˆ·å®šä¹‰çš„é€»è¾‘åœ¨æ¯ä¸ªäº‹ä»¶ä¸­åªæ‰§è¡Œä¸€æ¬¡ï¼Œå› ä¸ºç”¨æˆ·ä»£ç è¢«éƒ¨åˆ†æ‰§è¡Œçš„å¯èƒ½æ€§æ˜¯æ°¸è¿œå­˜åœ¨çš„ã€‚é‚£ä¹ˆï¼Œå½“å¼•æ“å£°æ˜ Exactly Once å¤„ç†è¯­ä¹‰æ—¶ï¼Œå®ƒä»¬èƒ½ä¿è¯ä»€ä¹ˆå‘¢ï¼Ÿå¦‚æœä¸èƒ½ä¿è¯ç”¨æˆ·é€»è¾‘åªæ‰§è¡Œä¸€æ¬¡ï¼Œé‚£ä¹ˆå“ªäº›é€»è¾‘åªæ‰§è¡Œä¸€æ¬¡ï¼Ÿå½“å¼•æ“å£°æ˜ Exactly Once å¤„ç†è¯­ä¹‰æ—¶ï¼Œå®ƒä»¬å®é™…ä¸Šæ˜¯åœ¨è¯´ï¼Œå®ƒä»¬å¯ä»¥ä¿è¯å¼•æ“ç®¡ç†çš„çŠ¶æ€æ›´æ–°åªæäº¤ä¸€æ¬¡åˆ°æŒä¹…çš„åç«¯å­˜å‚¨ã€‚æ¢è¨€ä¹‹ï¼Œæ— è®ºä»¥ä»€ä¹ˆç»´åº¦è®¡ç®— PVã€æ— è®º Flink åº”ç”¨ç¨‹åºå‘ç”Ÿå¤šå°‘æ¬¡æ•…éšœå¯¼è‡´é‡å¯ä» Checkpoint æ¢å¤ï¼ŒFlink éƒ½å¯ä»¥ä¿è¯ PV ç»“æœæ˜¯å‡†ç¡®çš„ï¼Œä¸ä¼šå› ä¸ºå„ç§ä»»åŠ¡é‡å¯è€Œå¯¼è‡´ PV å€¼è®¡ç®—åé«˜ã€‚ ä¸ºäº†ä¸‹æ¸¸å°½å¿«åš Checkpointï¼Œæ‰€ä»¥ä¼šå…ˆå‘é€ barrier åˆ°ä¸‹æ¸¸ï¼Œè‡ªèº«å†åŒæ­¥è¿›è¡Œå¿«ç…§ã€‚è¿™ä¸€æ­¥ï¼Œå¦‚æœå‘ä¸‹å‘é€barrieråï¼Œè‡ªå·±åŒæ­¥å¿«ç…§æ…¢æ€ä¹ˆåŠï¼Ÿä¸‹æ¸¸å·²ç»åŒæ­¥å¥½äº†ï¼Œè‡ªå·±è¿˜æ²¡ï¼Ÿå¯èƒ½ä¼šå‡ºç°ä¸‹æ¸¸æ¯”ä¸Šæ¸¸å¿«ç…§è¿˜æ—©çš„æƒ…å†µï¼Œä½†æ˜¯è¿™ä¸å½±å“å¿«ç…§ç»“æœï¼Œåªæ˜¯ä¸‹æ¸¸åšå¿«ç…§æ›´åŠæ—¶äº†ï¼Œæˆ‘åªè¦ä¿è¯ä¸‹æ¸¸æŠŠbarrierä¹‹å‰çš„æ•°æ®éƒ½å¤„ç†äº†ï¼Œå¹¶ä¸”ä¸å¤„ç† barrier ä¹‹åçš„æ•°æ®ï¼Œç„¶ååšå¿«ç…§ï¼Œé‚£ä¹ˆä¸‹æ¸¸ä¹ŸåŒæ ·æ”¯æŒ Exactly Onceã€‚è¿™ä¸ªé—®é¢˜ä¸è¦ä»å…¨å±€æ€è€ƒï¼Œå•ç‹¬æ€è€ƒä¸Šæ¸¸å’Œä¸‹æ¸¸çš„å®ä¾‹ï¼Œä½ ä¼šå‘ç°ä¸Šä¸‹æ¸¸çš„çŠ¶æ€éƒ½æ˜¯å‡†ç¡®çš„ï¼Œæ—¢æ²¡æœ‰ä¸¢ï¼Œä¹Ÿæ²¡æœ‰é‡å¤è®¡ç®—ã€‚è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œå¦‚æœæœ‰ä¸€ä¸ªOperator çš„ Checkpoint å¤±è´¥äº†æˆ–è€…å› ä¸º Checkpoint è¶…æ—¶ä¹Ÿä¼šå¯¼è‡´å¤±è´¥ï¼Œé‚£ä¹ˆ JobManager ä¼šè®¤ä¸ºæ•´ä¸ª Checkpoint å¤±è´¥ã€‚å¤±è´¥çš„ Checkpoint æ˜¯ä¸èƒ½ç”¨æ¥æ¢å¤ä»»åŠ¡çš„ï¼Œå¿…é¡»æ‰€æœ‰çš„ç®—å­çš„ Checkpoint éƒ½æˆåŠŸï¼Œé‚£ä¹ˆè¿™æ¬¡ Checkpoint æ‰èƒ½è®¤ä¸ºæ˜¯æˆåŠŸçš„ï¼Œæ‰èƒ½ç”¨æ¥æ¢å¤ä»»åŠ¡ã€‚å¯¹åº”åˆ° PV æ¡ˆä¾‹å°±æ˜¯ï¼ŒPV task åšå¿«ç…§é€Ÿåº¦è¾ƒå¿«ï¼ŒPV=20005 è¾ƒæ—©åœ°å†™å…¥åˆ°äº† HDFSï¼Œä½†æ˜¯ offset(0,10000)(1,10005) è¿‡äº†å‡ ç§’æ‰å†™å…¥åˆ° HDFSï¼Œè¿™ç§æƒ…å†µå°±ç®—å‡ºç°äº†ï¼Œä¹Ÿä¸ä¼šå½±å“è®¡ç®—ç»“æœï¼Œå› ä¸ºæˆ‘ä»¬çš„å¿«ç…§ä¿¡æ¯æ˜¯å®Œå…¨æ­£ç¡®çš„ã€‚ å†åˆ†äº«ä¸€ä¸ªæ¡ˆä¾‹ï¼ŒFlink çš„ Checkpoint è¯­ä¹‰è®¾ç½®äº† Exactly Onceï¼Œç¨‹åºä¸­è®¾ç½®äº† 1 åˆ†é’Ÿ 1 æ¬¡ Checkpointï¼Œ5 ç§’å‘ MySQL å†™ä¸€æ¬¡æ•°æ®ï¼Œå¹¶commitã€‚æœ€åå‘ç° MySQL ä¸­æ•°æ®é‡å¤äº†ã€‚ä¸ºä»€ä¹ˆä¼šé‡å¤å‘¢ï¼ŸFlinkè¦æ±‚ç«¯å¯¹ç«¯çš„ Exactly Once éƒ½å¿…é¡»å®ç° TwoPhaseCommitSinkFunctionã€‚å¦‚æœä½ çš„ Checkpoint æˆåŠŸäº†ï¼Œè¿‡äº†30ç§’çªç„¶ç¨‹åºæŒ‚äº†ï¼Œç”±äº 5 ç§’ commit ä¸€æ¬¡ï¼Œæ‰€ä»¥åœ¨åº”ç”¨ç¨‹åºæŒ‚ä¹‹å‰çš„ 30 ç§’å®é™…ä¸Šå·²ç»å†™å…¥äº† 6 æ‰¹æ•°æ®è¿›å…¥ MySQLã€‚ä» Checkpoint å¤„æ¢å¤æ—¶ï¼Œä¹‹å‰æäº¤çš„ 6 æ‰¹æ•°æ®å°±ä¼šé‡å¤å†™å…¥ï¼Œæ‰€ä»¥å‡ºç°äº†é‡å¤æ¶ˆè´¹ã€‚Flink çš„ Exactly Once æœ‰ä¸¤ç§æƒ…å†µï¼Œä¸€ä¸ªæ˜¯æˆ‘ä»¬æœ¬èŠ‚æ‰€è®²çš„ Flink å†…éƒ¨çš„ Exactly Onceï¼Œä¸€ä¸ªæ˜¯ç«¯å¯¹ç«¯çš„ Exactly Onceã€‚å…³äºç«¯å¯¹ç«¯å¦‚ä½•ä¿è¯ Exactly Onceï¼Œæˆ‘ä»¬åœ¨ä¸‹ä¸€èŠ‚ä¸­æ·±å…¥åˆ†æã€‚ 9.5.2 ç«¯å¯¹ç«¯å¦‚ä½•ä¿è¯ Exactly Onceï¼ŸFlink ä¸å¤–éƒ¨å­˜å‚¨ä»‹è´¨ä¹‹é—´è¿›è¡Œæ•°æ®äº¤äº’ç»Ÿç§°ä¸ºç«¯å¯¹ç«¯æˆ– end to end æ•°æ®ä¼ è¾“ã€‚ä¸Šä¸€èŠ‚è®²è¿°äº† Flink å†…éƒ¨å¦‚ä½•ä¿è¯ Exactly Onceï¼Œè¿™ä¸€èŠ‚æ¥åˆ†æç«¯å¯¹ç«¯çš„ Exactly Onceã€‚æ­£å¦‚ä¸Šè¿° Flink å†™ MySQL çš„æ¡ˆä¾‹æ‰€ç¤ºï¼Œåœ¨ç¬¬ n æ¬¡ Checkpoint ç»“æŸåï¼Œç¬¬ n+1 æ¬¡ Checkpoint ä¹‹å‰ï¼Œå¦‚æœ Flink åº”ç”¨ç¨‹åºå·²ç»å‘å¤–éƒ¨çš„å­˜å‚¨ä»‹è´¨ä¸­æˆåŠŸå†™å…¥å¹¶æäº¤äº†ä¸€äº›æ•°æ®åï¼ŒFlink åº”ç”¨ç¨‹åºç”±äºæŸäº›åŸå› æŒ‚äº†ï¼Œå¯¼è‡´ä»»åŠ¡ä»ç¬¬ n æ¬¡ Checkpoint å¤„æ¢å¤ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå°±ä¼šå¯¼è‡´ç¬¬ n æ¬¡ Checkpoint ç»“æŸåä¸”ä»»åŠ¡å¤±è´¥ä¹‹å‰å¾€å¤–éƒ¨å­˜å‚¨ä»‹è´¨ä¸­å†™å…¥çš„é‚£ä¸€éƒ¨åˆ†æ•°æ®é‡å¤å†™å…¥ä¸¤æ¬¡ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç›¸åŒçš„æ•°æ®åœ¨å­˜å‚¨ä»‹è´¨ä¸­å­˜å‚¨äº†ä¸¤ä»½ï¼Œä»è€Œç«¯å¯¹ç«¯çš„ä¸€è‡´æ€§è¯­ä¹‰ä¿è¯ä» Exactly Once é€€åŒ–ä¸º At Least Onceã€‚è¿™é‡Œåªè€ƒè™‘äº†æ•°æ®é‡å¤çš„æƒ…å†µï¼Œä¸ºä»€ä¹ˆä¸è€ƒè™‘ä¸¢æ•°æ®çš„æƒ…å†µå‘¢ï¼Ÿåœ¨å†™æ•°æ®æ—¶å¯ä»¥å¯¹å¼‚å¸¸è¿›è¡Œæ•è·å¢åŠ é‡è¯•ç­–ç•¥ï¼Œå¦‚æœé‡è¯•å¤šæ¬¡è¿˜æ²¡æœ‰æˆåŠŸå¯ä»¥è®© Flink ä»»åŠ¡å¤±è´¥ï¼ŒFlink ä»»åŠ¡å°±ä¼šä»æœ€è¿‘ä¸€æ¬¡æˆåŠŸçš„ Checkpoint å¤„æ¢å¤ï¼Œå°±ä¸ä¼šå‡ºç°ä¸¢æ•°æ®çš„æƒ…å†µï¼Œæ‰€ä»¥æˆ‘ä»¬æœ¬èŠ‚å†…å®¹ä¸»è¦ç”¨æ¥è§£å†³æ•°æ®é‡å¤çš„é—®é¢˜ã€‚ é’ˆå¯¹ä¸Šè¿°ç«¯å¯¹ç«¯ Exactly Once çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ¡ˆæ¥è§£å†³ï¼š 1ã€å‡å¦‚æˆ‘ä»¬ä½¿ç”¨çš„å­˜å‚¨ä»‹è´¨æ”¯æŒæŒ‰ç…§å…¨å±€ä¸»é”®å»é‡ï¼Œé‚£ä¹ˆæ¯”è¾ƒå®¹æ˜“å®ç° Exactly Onceï¼Œæ— è®ºç›¸åŒçš„æ•°æ®å¾€å¤–éƒ¨å­˜å‚¨ä¸­å†™å…¥äº†å‡ æ¬¡ï¼Œå¤–éƒ¨å­˜å‚¨éƒ½ä¼šè¿›è¡Œå»é‡ï¼Œåªä¿ç•™ä¸€æ¡æ•°æ®ã€‚ä¾‹å¦‚ï¼Œapp1 çš„ PV å€¼ä¸º 10ï¼Œç°åœ¨æŠŠ ï¼ˆkey=app1ï¼Œvalue=10ï¼‰ å¾€ Redis ä¸­å†™å…¥ 10 æ¬¡ï¼Œåªæ˜¯è¯´æŠŠ value å€¼è¦†ç›–äº† 10æ¬¡ï¼Œå¹¶ä¸ä¼šå¯¼è‡´ç»“æœé”™è¯¯ï¼Œè¿™ç§æ–¹æ¡ˆå±äºå¹‚ç­‰æ€§å†™å…¥ã€‚ 2ã€æˆ‘ä»¬ä¸Šè¿°æ¡ˆä¾‹ä¸­ä¸ºä»€ä¹ˆä¼šå¯¼è‡´é‡å¤å†™å…¥æ•°æ®åˆ°å¤–éƒ¨å­˜å‚¨å‘¢ï¼Ÿæ˜¯å› ä¸ºåœ¨ä¸‹ä¸€æ¬¡ Checkpoint ä¹‹å‰å¦‚æœä»»åŠ¡å¤±è´¥æ—¶ï¼Œä¸€äº›æ•°æ®å·²ç»æˆåŠŸå†™å…¥åˆ°äº†å¤–éƒ¨å­˜å‚¨ä¸­ï¼Œæ²¡åŠæ³•åˆ é™¤é‚£äº›æ•°æ®ã€‚æ—¢ç„¶é—®é¢˜æ˜¯è¿™æ ·ï¼Œé‚£å¯ä»¥æƒ³åŠæ³•æŠŠ â€œå‘å¤–éƒ¨å­˜å‚¨ä¸­æäº¤æ•°æ®â€ ä¸ â€œCheckpointâ€ å¼ºå…³è”ï¼Œä¸¤æ¬¡ Checkpoint ä¹‹é—´ä¸å…è®¸å‘å¤–éƒ¨å­˜å‚¨ä»‹è´¨ä¸­æäº¤æ•°æ®ï¼ŒCheckpoint çš„æ—¶å€™å†å‘å¤–éƒ¨å­˜å‚¨æäº¤ã€‚å¦‚æœæäº¤æˆåŠŸï¼Œåˆ™ Checkpoint æˆåŠŸï¼Œæäº¤å¤±è´¥ï¼Œåˆ™ Checkpoint ä¹Ÿå¤±è´¥ã€‚è¿™æ ·åœ¨ä¸‹ä¸€æ¬¡ Checkpoint ä¹‹å‰ï¼Œå¦‚æœä»»åŠ¡å¤±è´¥ï¼Œä¹Ÿæ²¡æœ‰é‡å¤æ•°æ®è¢«æäº¤åˆ°å¤–éƒ¨å­˜å‚¨ã€‚è¿™é‡Œåªæ˜¯æè¿°ä¸€ä¸‹å¤§æ¦‚æ€æƒ³ï¼Œå¥½å¤šç»†èŠ‚è¿™é‡Œå¹¶æ²¡æœ‰è¯¦ç»†æè¿°ï¼Œä¼šåœ¨ä¸‹æ–‡ä¸­è¯¦ç»†æè¿°ã€‚åŸºäºä¸Šè¿°æ€æƒ³ï¼ŒFlink å®ç°äº† TwoPhaseCommitSinkFunctionï¼Œå®ƒæå–äº†ä¸¤é˜¶æ®µæäº¤åè®®çš„é€šç”¨é€»è¾‘ï¼Œä½¿å¾—é€šè¿‡ Flink æ¥æ„å»ºç«¯åˆ°ç«¯çš„Exactly Once ç¨‹åºæˆä¸ºå¯èƒ½ã€‚å®ƒæä¾›äº†ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œç”¨æˆ·åªéœ€è¦å®ç°å°‘æ•°æ–¹æ³•å°±èƒ½å®ç°ç«¯åˆ°ç«¯çš„ Exactly Once è¯­ä¹‰ã€‚ä¸è¿‡è¿™ç§æ–¹æ¡ˆå¿…é¡»è¦æ±‚æˆ‘ä»¬çš„è¾“å‡ºç«¯ (Sink ç«¯) å¿…é¡»æ”¯æŒäº‹åŠ¡ã€‚ ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä¸¤éƒ¨åˆ†æ¥è¯¦ç»†ä»‹ç»ä¸Šè¿°ä¸¤ç§æ–¹æ¡ˆã€‚ å¹‚ç­‰æ€§å†™å…¥å¦‚ä½•ä¿è¯ç«¯å¯¹ç«¯çš„ Exactly Onceå®æ—¶ ETL å½“ HBase åšä¸º Sink ç«¯æ—¶ï¼Œå°±æ˜¯å…¸å‹çš„åº”ç”¨åœºæ™¯ã€‚æŠŠæ—¥å¿—ä¸­çš„ä¸»é”®åšä¸º HBase çš„ RowKeyï¼Œå°±å¯ä»¥ä¿è¯æ•°æ®ä¸é‡å¤ï¼Œå®ç°æ¯”è¾ƒç®€å•ï¼Œè¿™é‡Œä¸å¤šèµ˜è¿°ã€‚ ç»§ç»­æ¢è®¨å®æ—¶è®¡ç®—å„ app PV çš„æ¡ˆä¾‹ï¼Œå°†ç»Ÿè®¡ç»“æœä»¥æ™®é€šé”®å€¼å¯¹çš„å½¢å¼ä¿å­˜åˆ° Redis ä¸­ä¾›ä¸šåŠ¡æ–¹æŸ¥è¯¢ã€‚åˆ°åº•å¦‚ä½•å®ç°ï¼Œæ‰èƒ½ä¿è¯ Redis ä¸­çš„ç»“æœæ˜¯ç²¾å‡†çš„å‘¢ï¼Ÿåœ¨ä¹‹å‰ Strom æˆ– Spark Streaming çš„æ–¹æ¡ˆä¸­ï¼Œå°†ç»Ÿè®¡çš„ PV ç»“æœä¿å­˜åœ¨ Redis ä¸­ï¼Œæ¯æ¥ä¸€æ¡æ•°æ®ï¼Œä» Redis ä¸­è·å–ç›¸åº” app å¯¹åº”çš„ PV å€¼ç„¶åå†…å­˜ä¸­è¿›è¡Œ +1 åï¼Œå†å°† PV å€¼ put åˆ° Redis ä¸­ã€‚ä¾‹å¦‚ï¼šRedis ä¸­ä¿å­˜ app1 çš„ PV ä¸º 10ï¼Œç°åœ¨æ¥äº†ä¸€æ¡ app1 çš„æ—¥å¿—ï¼Œé¦–å…ˆä» Redis ä¸­è·å– app1 çš„ PV å€¼=10ï¼Œå†…å­˜ä¸­ 10+1=11ï¼Œå°† (app1,11) put åˆ° Redis ä¸­ï¼Œè¿™é‡Œçš„ 11 å°±æ˜¯æˆ‘ä»¬ç»Ÿè®¡çš„ app1 çš„ PV ç»“æœã€‚å¯ä»¥å°†è¿™ç§æ–¹æ¡ˆä¼˜åŒ–ä¸º incr æˆ– incrbyï¼Œç›´æ¥å¯¹ Redis ä¸­çš„ 10 è¿›è¡Œç´¯åŠ ï¼Œä¸éœ€è¦æ‰‹åŠ¨åœ¨å†…å­˜ä¸­è¿›è¡Œç´¯åŠ æ“ä½œã€‚å½“ç„¶ Flink ä¹Ÿå¯ä»¥ç”¨ä¸Šè¿°çš„è¿™ç§æ–¹æ¡ˆæ¥ç»Ÿè®¡å„ app çš„ PVï¼Œä½†æ˜¯ä¸Šè¿°æ–¹æ¡ˆå¹¶ä¸èƒ½ä¿è¯ Exactly Onceï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå½“ç¬¬ n æ¬¡ Checkpoint æ—¶ï¼Œapp1 çš„ PV ç»“æœä¸º 10000ï¼Œç¬¬ n æ¬¡ Checkpoint ç»“æŸåè¿è¡Œäº† 10 ç§’ï¼ŒRedis ä¸­ app1 çš„ PV ç»“æœå·²ç»ç´¯åŠ åˆ°äº† 10200ã€‚æ­¤æ—¶å¦‚æœä»»åŠ¡æŒ‚äº†ï¼Œä»ç¬¬ n æ¬¡ Checkpoint æ¢å¤ä»»åŠ¡æ—¶ï¼Œä¼šç»§ç»­æŒ‰ç…§ Redis ä¸­ä¿å­˜çš„ PV=10200 è¿›è¡Œç´¯åŠ ï¼Œä½†æ˜¯æ­£ç¡®çš„ç»“æœåº”è¯¥æ˜¯ä» PV=10000 å¼€å§‹ç´¯åŠ ã€‚å¦‚æœæŒ‰ç…§ä¸Šé¢çš„æ–¹æ¡ˆç»Ÿè®¡ PVï¼Œå°±å¯èƒ½ä¼šå‡ºç°ç»Ÿè®¡å€¼åé«˜çš„æƒ…å†µã€‚è¿™é‡Œä¹Ÿè¯å®äº†ä¸€ç‚¹ï¼šå¹¶ä¸æ˜¯è¯´ Flink ç¨‹åºçš„ Checkpoint è¯­ä¹‰è®¾ç½®ä¸º Exactly Onceï¼Œå°±èƒ½ä¿è¯æˆ‘ä»¬çš„ç»Ÿè®¡ç»“æœæˆ–è€…å„ç§è¾“å‡ºç»“æœéƒ½èƒ½æ»¡è¶³ Exactly Onceã€‚ä¸ºäº†ç¼–å†™çœŸæ­£æ»¡è¶³ Exactly Once çš„ä»£ç ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ Flink çš„ Checkpoint åŸç†åšä¸€äº›äº†è§£ï¼Œç¼–å†™å¯¹ Exactly Once å‹å¥½çš„ä»£ç ã€‚ é‚£å¦‚ä½•ç¼–å†™ä»£ç æ‰èƒ½ä½¿å¾—æœ€ååœ¨ Redis ä¸­ä¿å­˜çš„ PV ç»“æœæ»¡è¶³ Exactly Once å‘¢ï¼Ÿä¸Šä¸€èŠ‚ä¸­ï¼Œè®²è¿°äº† Flink å†…éƒ¨çŠ¶æ€å¯ä»¥ä¿è¯ Exactly Onceï¼Œè¿™é‡Œå¯ä»¥å°†ç»Ÿè®¡çš„ PV ç»“æœä¿å­˜åœ¨ Flink å†…éƒ¨çš„çŠ¶æ€é‡Œï¼Œæ¯æ¬¡åŸºäºçŠ¶æ€è¿›è¡Œç´¯åŠ æ“ä½œï¼Œå¹¶å°†ç´¯åŠ åˆ°çš„ç»“æœ put åˆ° Redis ä¸­ï¼Œè¿™æ ·å½“ä»»åŠ¡ä» Checkpoint å¤„æ¢å¤æ—¶ï¼Œå¹¶ä¸æ˜¯åŸºäº Redis ä¸­å®æ—¶ç»Ÿè®¡çš„ PV å€¼è¿›è¡Œç´¯åŠ ï¼Œè€Œæ˜¯åŸºäº Checkpoint ä¸­ä¿å­˜çš„ PV å€¼è¿›è¡Œç´¯åŠ ï¼ŒCheckpoint ä¸­ä¼šä¿å­˜æ¯æ¬¡ Checkpoint æ—¶å¯¹åº”çš„ PV å¿«ç…§ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼šç¬¬ n æ¬¡ Checkpoint ä¼šæŠŠå½“æ—¶ pv=10000 ä¿å­˜åˆ°å¿«ç…§ä¿¡æ¯é‡Œï¼ŒåŒæ—¶çŠ¶æ€åç«¯è¿˜ä¿å­˜ç€ä¸€ä»½å®æ—¶çš„çŠ¶æ€ä¿¡æ¯ç”¨äºå®æ—¶ç´¯åŠ ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748final StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();// 1 åˆ†é’Ÿä¸€æ¬¡Checkpointenv.enableCheckpointing(TimeUnit.MINUTES.toMillis(1));CheckpointConfig checkpointConf = env.getCheckpointConfig();// Checkpoint è¯­ä¹‰ EXACTLY ONCEcheckpointConf.setCheckpointingMode(CheckpointingMode.EXACTLY_ONCE);checkpointConf.enableExternalizedCheckpoints(CheckpointConfig.ExternalizedCheckpointCleanup.RETAIN_ON_CANCELLATION);Properties props = new Properties();props.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, \"localhost:9092\");props.put(ConsumerConfig.GROUP_ID_CONFIG, \"app-pv-stat\");DataStreamSource&lt;String&gt; appInfoSource = env.addSource(new FlinkKafkaConsumer011&lt;&gt;( // kafka topicï¼Œ String åºåˆ—åŒ– \"app-topic\", new SimpleStringSchema(), props));// æŒ‰ç…§ appId è¿›è¡Œ keyByappInfoSource.keyBy((KeySelector&lt;String, String&gt;) appId -&gt; appId) .map(new RichMapFunction&lt;String, Tuple2&lt;String, Long&gt;&gt;() &#123; private ValueState&lt;Long&gt; pvState; private long pv = 0; @Override public void open(Configuration parameters) throws Exception &#123; super.open(parameters); // åˆå§‹åŒ–çŠ¶æ€ pvState = getRuntimeContext().getState( new ValueStateDescriptor&lt;&gt;(\"pvStat\", TypeInformation.of(new TypeHint&lt;Long&gt;() &#123;&#125;))); &#125; @Override public Tuple2&lt;String, Long&gt; map(String appId) throws Exception &#123; // ä»çŠ¶æ€ä¸­è·å–è¯¥ app çš„ PV å€¼ï¼Œ+1åï¼Œupdate åˆ°çŠ¶æ€ä¸­ if(null == pvState.value())&#123; pv = 1; &#125; else &#123; pv = pvState.value(); pv += 1; &#125; pvState.update(pv); return new Tuple2&lt;&gt;(appId, pv); &#125; &#125;) .print();env.execute(\"Flink PV stat\"); ä»£ç ä¸­è®¾ç½® 1 åˆ†é’Ÿä¸€æ¬¡ Checkpointï¼ŒCheckpoint è¯­ä¹‰ EXACTLY ONCEï¼Œä» Kafka ä¸­è¯»å–æ•°æ®ï¼Œè¿™é‡Œä¸ºäº†ç®€åŒ–ä»£ç ï¼Œæ‰€ä»¥ Kafka ä¸­è¯»å–çš„ç›´æ¥å°±æ˜¯ String ç±»å‹çš„ appIdï¼ŒæŒ‰ç…§ appId KeyBy åï¼Œæ‰§è¡Œ RichMapFunctionï¼ŒRichMapFunction çš„ open æ–¹æ³•ä¸­ä¼šåˆå§‹åŒ– ValueState ç±»å‹çš„ pvStateï¼ŒpvState å°±æ˜¯ä¸Šæ–‡ä¸€ç›´å¼ºè°ƒçš„çŠ¶æ€ä¿¡æ¯ï¼Œæ¯æ¬¡ Checkpoint çš„æ—¶å€™ï¼Œä¼šæŠŠ pvState çš„çŠ¶æ€ä¿¡æ¯å¿«ç…§ä¸€ä»½åˆ° HDFS æ¥æä¾›æ¢å¤ã€‚è¿™é‡ŒæŒ‰ç…§ appId è¿›è¡Œ keyByï¼Œæ‰€ä»¥æ¯ä¸€ä¸ª appId éƒ½ä¼šå¯¹åº”ä¸€ä¸ª pvStateï¼ŒpvState é‡Œå­˜å‚¨ç€è¯¥ appId å¯¹åº”çš„ pv å€¼ã€‚æ¯æ¥ä¸€æ¡æ•°æ®éƒ½ä¼šæ‰§è¡Œä¸€æ¬¡ map æ–¹æ³•ï¼Œå½“è¿™æ¡æ•°æ®å¯¹åº”çš„ appId æ˜¯æ–° app æ—¶ï¼ŒpvState é‡Œå°±æ²¡æœ‰å­˜å‚¨è¿™ä¸ª appId å½“å‰çš„ pv å€¼ï¼Œå°† pv å€¼èµ‹å€¼ä¸º 1ï¼Œå½“ pvState é‡Œå­˜å‚¨çš„ value ä¸ä¸º null æ—¶ï¼Œæ‹¿å‡º pv å€¼ +1å update åˆ° pvState é‡Œã€‚map æ–¹æ³•å†å°† appId å’Œ pv å€¼å‘é€åˆ°ä¸‹æ¸¸ç®—å­ï¼Œä¸‹æ¸¸ç›´æ¥è°ƒç”¨äº† print è¿›è¡Œè¾“å‡ºï¼Œè¿™é‡Œå®Œå…¨å¯ä»¥æ›¿æ¢æˆç›¸åº”çš„ RedisSink æˆ– HBaseSinkã€‚æœ¬æ¡ˆä¾‹ä¸­è®¡ç®— pv çš„å·¥ä½œäº¤ç»™äº† Flink å†…éƒ¨çš„ ValueStateï¼Œä¸ä¾èµ–å¤–éƒ¨å­˜å‚¨ä»‹è´¨è¿›è¡Œç´¯åŠ ï¼Œå¤–éƒ¨ä»‹è´¨æ‰¿æ‹…çš„è§’è‰²ä»…ä»…æ˜¯æä¾›æ•°æ®ç»™ä¸šåŠ¡æ–¹æŸ¥è¯¢ï¼Œæ‰€ä»¥æ— è®ºä¸‹æ¸¸ä½¿ç”¨ä»€ä¹ˆå½¢å¼çš„ Sinkï¼Œåªè¦ Sink ç«¯èƒ½å¤ŸæŒ‰ç…§ä¸»é”®å»é‡ï¼Œè¯¥ç»Ÿè®¡æ–¹æ¡ˆå°±å¯ä»¥ä¿è¯ Exactly Onceã€‚æœ¬æ¡ˆä¾‹ä½¿ç”¨çš„ ValueStateï¼Œå…³äº State çš„è¯¦ç»†ä½¿ç”¨è¯·å‚é˜…ç¬¬3.1èŠ‚ã€‚ TwoPhaseCommitSinkFunction å¦‚ä½•ä¿è¯ç«¯å¯¹ç«¯çš„ Exactly OnceFlink çš„æºç ä¸­æœ‰è¿™ä¹ˆä¸€æ®µæ³¨é‡Šï¼šThis is a recommended base class for all of the {@link SinkFunction} that intend to implement exactly-once semanticã€‚æ„æ€æ˜¯å¯¹äºæ‰“ç®—å®ç° Exactly Once è¯­ä¹‰çš„æ‰€æœ‰ SinkFunction éƒ½æ¨èç»§æ‰¿è¯¥æŠ½è±¡ç±»ã€‚åœ¨ä»‹ç» TwoPhaseCommitSinkFunction ä¹‹å‰ï¼Œå…ˆäº†è§£ä¸€ä¸‹ 2PC åˆ†å¸ƒå¼ä¸€è‡´æ€§åè®®ã€‚ åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæ¯ä¸€ä¸ªæœºå™¨èŠ‚ç‚¹è™½ç„¶éƒ½èƒ½æ˜ç¡®åœ°çŸ¥é“è‡ªå·±åœ¨è¿›è¡Œäº‹åŠ¡æ“ä½œè¿‡ç¨‹ä¸­çš„ç»“æœæ˜¯æˆåŠŸæˆ–å¤±è´¥ï¼Œä½†æ— æ³•ç›´æ¥è·å–åˆ°å…¶ä»–åˆ†å¸ƒå¼èŠ‚ç‚¹çš„æ“ä½œç»“æœã€‚å› æ­¤ï¼Œå½“ä¸€ä¸ªäº‹åŠ¡æ“ä½œéœ€è¦è·¨è¶Šå¤šä¸ªåˆ†å¸ƒå¼èŠ‚ç‚¹çš„æ—¶å€™ï¼Œä¸ºäº†è®©æ¯ä¸ªèŠ‚ç‚¹éƒ½èƒ½å¤Ÿè·å–åˆ°å…¶ä»–èŠ‚ç‚¹çš„äº‹åŠ¡æ‰§è¡ŒçŠ¶å†µï¼Œéœ€è¦å¼•å…¥ä¸€ä¸ªâ€åè°ƒè€…ï¼ˆCoordinatorï¼‰â€èŠ‚ç‚¹æ¥ç»Ÿä¸€è°ƒåº¦æ‰€æœ‰åˆ†å¸ƒå¼èŠ‚ç‚¹çš„æ‰§è¡Œé€»è¾‘ï¼Œè¿™äº›è¢«è°ƒåº¦çš„åˆ†å¸ƒå¼èŠ‚ç‚¹è¢«ç§°ä¸ºâ€å‚ä¸è€…ï¼ˆParticipantï¼‰â€ã€‚åè°ƒè€…è´Ÿè´£è°ƒåº¦å‚ä¸è€…çš„è¡Œä¸ºï¼Œå¹¶æœ€ç»ˆå†³å®šè¿™äº›å‚ä¸è€…æ˜¯å¦è¦æŠŠäº‹åŠ¡çœŸæ­£çš„æäº¤ã€‚æ™®é€šçš„äº‹åŠ¡å¯ä»¥ä¿è¯å•ä¸ªäº‹åŠ¡å†…æ‰€æœ‰æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼Œè€Œåˆ†å¸ƒå¼ç³»ç»Ÿä¸­å…·ä½“å¦‚ä½•ä¿è¯å¤šå°èŠ‚ç‚¹ä¸Šæ‰§è¡Œçš„äº‹åŠ¡è¦ä¹ˆæ‰€æœ‰èŠ‚ç‚¹äº‹åŠ¡éƒ½æˆåŠŸï¼Œè¦ä¹ˆæ‰€æœ‰èŠ‚ç‚¹äº‹åŠ¡éƒ½å¤±è´¥å‘¢ï¼Ÿå…ˆäº†è§£ä¸€ä¸‹ 2PC ä¸€è‡´æ€§åè®®ã€‚ 2PC æ˜¯ Two-Phase Commit çš„ç¼©å†™ï¼Œå³ä¸¤é˜¶æ®µæäº¤ã€‚2PC å°†åˆ†å¸ƒå¼äº‹åŠ¡åˆ†ä¸ºäº†ä¸¤ä¸ªé˜¶æ®µï¼Œåˆ†åˆ«æ˜¯æäº¤äº‹åŠ¡è¯·æ±‚ï¼ˆæŠ•ç¥¨ï¼‰å’Œæ‰§è¡Œäº‹åŠ¡æäº¤ã€‚åè°ƒè€…ä¼šæ ¹æ®å‚ä¸è€…åœ¨ç¬¬ä¸€é˜¶æ®µçš„æŠ•ç¥¨ç»“æœï¼Œæ¥å†³å®šç¬¬äºŒé˜¶æ®µæ˜¯å¦çœŸæ­£çš„æ‰§è¡Œäº‹åŠ¡ï¼Œå…·ä½“æµç¨‹å¦‚ä¸‹ã€‚ æäº¤äº‹åŠ¡è¯·æ±‚ï¼ˆæŠ•ç¥¨ï¼‰é˜¶æ®µæäº¤äº‹åŠ¡è¯·æ±‚é˜¶æ®µå¦‚ä¸‹æ‰€ç¤ºï¼š åè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…å‘é€ prepare è¯·æ±‚ä¸äº‹åŠ¡å†…å®¹ï¼Œè¯¢é—®æ˜¯å¦å¯ä»¥å‡†å¤‡äº‹åŠ¡æäº¤ï¼Œå¹¶ç­‰å¾…å‚ä¸è€…çš„å“åº” å„å‚ä¸è€…æ‰§è¡Œäº‹åŠ¡æ“ä½œï¼Œå¹¶è®°å½• Undoæ—¥å¿—ï¼ˆç”¨äºå›æ»šï¼‰å’Œ Redoæ—¥å¿—ï¼ˆç”¨äºé‡æ”¾ï¼‰ï¼Œä½†ä¸çœŸæ­£æäº¤ å‚ä¸è€…å‘åè°ƒè€…è¿”å›äº‹åŠ¡æ“ä½œçš„æ‰§è¡Œç»“æœï¼Œæ‰§è¡ŒæˆåŠŸè¿”å› Yesï¼Œå¦åˆ™è¿”å› No æ‰§è¡Œäº‹åŠ¡æäº¤é˜¶æ®µåˆ†ä¸ºæˆåŠŸä¸å¤±è´¥ä¸¤ç§æƒ…å†µï¼š è‹¥ç¬¬ä¸€é˜¶æ®µæ‰€æœ‰å‚ä¸è€…éƒ½è¿”å› Yesï¼Œè¯´æ˜äº‹åŠ¡å¯ä»¥æäº¤ åè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…å‘é€ Commit è¯·æ±‚ å‚ä¸è€…æ”¶åˆ° Commit è¯·æ±‚åï¼Œä¼šæ­£å¼æ‰§è¡Œäº‹åŠ¡æäº¤æ“ä½œï¼Œå¹¶åœ¨æäº¤å®Œæˆåé‡Šæ”¾äº‹åŠ¡èµ„æº å®Œæˆäº‹åŠ¡æäº¤åï¼Œå‘åè°ƒè€…å‘é€ Ack æ¶ˆæ¯ åè°ƒè€…æ”¶åˆ°æ‰€æœ‰å‚ä¸è€…çš„ Ack æ¶ˆæ¯ï¼Œå®Œæˆäº‹åŠ¡ äº‹åŠ¡æäº¤æˆåŠŸçš„æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š è‹¥ç¬¬ä¸€é˜¶æ®µæœ‰å‚ä¸è€…è¿”å› No æˆ–è€…è¶…æ—¶æœªè¿”å›ï¼Œè¯´æ˜äº‹åŠ¡ä¸­æ–­ï¼Œéœ€è¦å›æ»š åè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…å‘é€ Rollback è¯·æ±‚ å‚ä¸è€…æ”¶åˆ° Rollback è¯·æ±‚åï¼Œæ ¹æ® Undoæ—¥å¿—å›æ»šåˆ°äº‹åŠ¡æ‰§è¡Œå‰çš„çŠ¶æ€ï¼Œé‡Šæ”¾å ç”¨çš„äº‹åŠ¡èµ„æº å‚ä¸è€…åœ¨å®Œæˆäº‹åŠ¡å›æ»šåï¼Œå‘åè°ƒè€…è¿”å› Ack åè°ƒè€…æ”¶åˆ°æ‰€æœ‰å‚ä¸è€…çš„ Ack æ¶ˆæ¯ï¼Œäº‹åŠ¡å›æ»šå®Œæˆ äº‹åŠ¡æäº¤ä¸­æ–­ï¼Œéœ€è¦å›æ»šçš„æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ç®€å•æ¥è®²ï¼Œ2PC å°†ä¸€ä¸ªäº‹åŠ¡çš„å¤„ç†è¿‡ç¨‹åˆ†ä¸ºäº†æŠ•ç¥¨å’Œæ‰§è¡Œä¸¤ä¸ªé˜¶æ®µï¼Œå…¶æ ¸å¿ƒæ˜¯æ¯ä¸ªäº‹åŠ¡éƒ½é‡‡ç”¨å…ˆå°è¯•åæäº¤çš„å¤„ç†æ–¹å¼ã€‚2PC çš„ä¼˜ç¼ºç‚¹å¦‚ä¸‹æ‰€ç¤ºï¼š ä¼˜ç‚¹ï¼šåŸç†ç®€å•ï¼Œå®ç°æ–¹ä¾¿ ç¼ºç‚¹ï¼š åè°ƒè€…å•ç‚¹é—®é¢˜ï¼šåè°ƒè€…åœ¨æ•´ä¸ª 2PC åè®®ä¸­éå¸¸é‡è¦ï¼Œä¸€æ—¦åè°ƒè€…æ•…éšœï¼Œåˆ™ 2PC å°†æ— æ³•è¿è½¬ è¿‡äºä¿å®ˆï¼šåœ¨ 2PC çš„é˜¶æ®µä¸€ï¼Œå¦‚æœå‚ä¸è€…å‡ºç°æ•…éšœè€Œå¯¼è‡´åè°ƒè€…æ— æ³•è·å–åˆ°å‚ä¸è€…çš„å“åº”ä¿¡æ¯ï¼Œè¿™æ—¶åè°ƒè€…åªèƒ½ä¾é è‡ªèº«çš„è¶…æ—¶æœºåˆ¶æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦ä¸­æ–­äº‹åŠ¡ï¼Œè¿™ç§ç­–ç•¥æ¯”è¾ƒä¿å®ˆã€‚æ¢è¨€ä¹‹ï¼Œ2PC æ²¡æœ‰æ¶‰åŠè¾ƒä¸ºå®Œå–„çš„å®¹é”™æœºåˆ¶ï¼Œä»»æ„ä¸€ä¸ªèŠ‚ç‚¹å¤±è´¥éƒ½ä¼šå¯¼è‡´æ•´ä¸ªäº‹åŠ¡çš„å¤±è´¥ åŒæ­¥é˜»å¡ï¼šæ‰§è¡Œè¿‡ç¨‹æ˜¯å®Œå…¨åŒæ­¥çš„ï¼Œå„ä¸ªå‚ä¸è€…åœ¨ç­‰å¾…å…¶ä»–å‚ä¸è€…æŠ•ç¥¨å“åº”çš„çš„è¿‡ç¨‹ä¸­ï¼Œå°†æ— æ³•è¿›è¡Œå…¶ä»–ä»»ä½•æ“ä½œ æ•°æ®ä¸ä¸€è‡´ï¼šåœ¨äºŒé˜¶æ®µæäº¤åè®®çš„é˜¶æ®µäºŒï¼Œå½“åè°ƒè€…å‘æ‰€æœ‰çš„å‚ä¸è€…å‘é€ Commit è¯·æ±‚åï¼Œå‡ºç°äº†å±€éƒ¨ç½‘ç»œå¼‚å¸¸æˆ–å±€éƒ¨å‚ä¸è€…æœºå™¨æ•…éšœç­‰å› ç´ å¯¼è‡´ä¸€éƒ¨åˆ†çš„å‚ä¸è€…æ‰§è¡Œäº† Commit æ“ä½œï¼Œè€Œå‘ç”Ÿæ•…éšœçš„å‚ä¸è€…æ²¡æœ‰æ‰§è¡Œ Commitï¼Œäºæ˜¯æ•´ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¾¿å‡ºç°äº†æ•°æ®ä¸ä¸€è‡´ç°è±¡ Flink çš„ TwoPhaseCommitSinkFunction æ˜¯åŸºäº 2PC å®ç°çš„ã€‚Flink çš„ JobManager å¯¹åº”åˆ° 2PC ä¸­çš„åè°ƒè€…ï¼ŒOperator å®ä¾‹å¯¹åº”åˆ° 2PC ä¸­çš„å‚ä¸è€…ã€‚TwoPhaseCommitSinkFunction å®ç°äº† CheckpointedFunction å’Œ CheckpointListener æ¥å£ã€‚CheckpointedFunction æ¥å£ä¸­æœ‰\bä¸¤ä¸ªæ–¹æ³• snapshotState å’Œ initializeStateï¼ŒsnapshotState æ–¹æ³•ä¼šåœ¨ Checkpoint \bæ—¶ä¸”åšå¿«ç…§ä¹‹å‰è¢«è°ƒç”¨ï¼ŒinitializeState æ–¹æ³•ä¼šåœ¨è‡ªå®šä¹‰ Function åˆå§‹åŒ–æ¢å¤çŠ¶æ€æ—¶è¢«è°ƒç”¨ã€‚CheckpointListener æ¥å£ä¸­æœ‰ä¸€ä¸ª notifyCheckpointComplete æ–¹æ³•ï¼ŒOperator å®ä¾‹çš„ Checkpoint æˆåŠŸåï¼Œä¼šåé¦ˆç»™ JobManagerï¼Œå½“ JobManager æ¥æ”¶åˆ°æ‰€æœ‰ Operator å®ä¾‹ Checkpoint æˆåŠŸçš„é€šçŸ¥åï¼Œå°±è®¤ä¸ºæœ¬æ¬¡ Checkpoint æˆåŠŸäº†ï¼Œä¼šç»™æ‰€æœ‰ Operator å®ä¾‹å‘é€ä¸€ä¸ª Checkpoint å®Œæˆçš„\bé€šçŸ¥ï¼ŒOperator å®ä¾‹æ¥æ”¶åˆ°é€šçŸ¥åï¼Œå°±ä¼šè°ƒç”¨ notifyCheckpointComplete æ–¹æ³•ã€‚ TwoPhaseCommitSinkFunctionå®šä¹‰äº†å¦‚ä¸‹ 5 ä¸ªæŠ½è±¡æ–¹æ³•ï¼š 12345678910// å¤„ç†æ¯ä¸€æ¡æ•°æ®protected abstract void invoke(TXN transaction, IN value, Context context) throws Exception;// å¼€å§‹ä¸€ä¸ªäº‹åŠ¡ï¼Œè¿”å›äº‹åŠ¡ä¿¡æ¯çš„å¥æŸ„protected abstract TXN beginTransaction() throws Exception;// é¢„æäº¤ï¼ˆå³æäº¤è¯·æ±‚ï¼‰é˜¶æ®µçš„é€»è¾‘protected abstract void preCommit(TXN transaction) throws Exception;// æ­£å¼æäº¤é˜¶æ®µçš„é€»è¾‘protected abstract void commit(TXN transaction);// å–æ¶ˆäº‹åŠ¡,Rollback ç›¸å…³çš„é€»è¾‘protected abstract void abort(TXN transaction); 9.5.3 åˆ†æ FlinkKafkaConsumer çš„è®¾è®¡æ€æƒ³kafka offset å­˜å‚¨åŠå¦‚ä½•å®ç° Consumer å®ä¾‹æ¶ˆè´¹ partition çš„è´Ÿè½½å‡è¡¡Source ç«¯å¹¶è¡Œåº¦æ”¹å˜äº†ï¼Œå¦‚ä½•æ¥æ¢å¤ offsetå¦‚ä½•å®ç°è‡ªåŠ¨å‘ç°å½“å‰æ¶ˆè´¹ topic ä¸‹æ–°å¢çš„ partition9.5.4 å°ç»“ä¸åæ€åŠ å…¥çŸ¥è¯†æ˜Ÿçƒå¯ä»¥çœ‹åˆ°ä¸Šé¢æ–‡ç« ï¼šhttps://t.zsxq.com/uFEEYzJ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹â€”â€” å¦‚ä½•åˆç†çš„è®¾ç½® Flink ä½œä¸šå¹¶è¡Œåº¦ï¼Ÿ","date":"2021-08-09T16:00:00.000Z","path":"2021/08/10/flink-in-action-9.4/","text":"9.4 å¦‚ä½•åˆç†çš„è®¾ç½® Flink ä½œä¸šå¹¶è¡Œåº¦ï¼Ÿåœ¨ 9.2 èŠ‚ä¸­è®²è§£äº† Flink Job ä¸­çš„æ‰§è¡Œè®¡åˆ’ï¼Œå¹¶è¯¦ç»†åˆ†æäº† Flink ä¸­çš„ operator chain åœ¨ä¸€èµ·çš„å„ç§æ¡ä»¶ï¼Œåœ¨ 9.3 èŠ‚ä¸­ä¹Ÿé€šè¿‡çœŸå®ç”Ÿäº§ç¯å¢ƒçš„æ¡ˆä¾‹æ¥åˆ†äº«å¹¶è¡Œåº¦ä¸ Slot çš„æ¦‚å¿µä¸å…³ç³»ã€‚ç›¸ä¿¡å¤§å®¶ä¹Ÿéƒ½æœ‰ä¸€å®šçš„ç†è§£ï¼Œä½†æ˜¯æœ‰æ—¶å€™ç”Ÿäº§ç¯å¢ƒå¦‚æœ Job çªç„¶æ¶ˆè´¹ä¸åŠæ—¶äº†ï¼Œæˆ–è€… Job å°±æ ¹æœ¬ä¸åœ¨æ¶ˆè´¹æ•°æ®äº†ï¼Œé‚£ä¹ˆè¯¥æ€ä¹ˆåŠï¼Ÿé¦–å…ˆå¾—çœ‹ä¸‹ç›¸å…³çš„ç›‘æ§æŸ¥çœ‹ Job æ˜¯å¦åœ¨æ­£å¸¸è¿è¡Œï¼Œæ˜¯å¦å‡ºç°åå‹çš„æƒ…å†µï¼Œæ˜¯å¦è¿™ä¼šç”Ÿäº§æ•°æ®é‡è¿‡å¤§ç„¶è€Œå¹¶è¡Œåº¦å´æ˜¯æ ¹æ®ä¹‹å‰æ•°æ®é‡è®¾ç½®çš„ï¼Œç§ç§åŸå› éƒ½éœ€è¦ä¸€ä¸ªä¸ªæ’æŸ¥ä¸€ä¸‹ï¼Œç„¶åæ‰¾åˆ°æ ¹å› æ‰èƒ½å¤Ÿå¯¹åº”çš„å»è§£å†³ã€‚è¿™èŠ‚æ¥è®²è§£ä¸‹é‡åˆ°è¿™ç§é—®é¢˜åå¦‚ä½•åˆç†é…ç½®å¹¶è¡Œåº¦å‘¢ï¼Ÿ 9.4.1 Source ç«¯å¹¶è¡Œåº¦çš„é…ç½®å‡è®¾æ•°æ®æºç«¯æ˜¯ Kafkaï¼Œåœ¨å‡ºç°ä½œä¸šæ¶ˆè´¹ä¸åŠæ—¶çš„æ—¶å€™ï¼Œé¦–å…ˆçœ‹ä¸‹ Kafka çš„ç›‘æ§æ˜¯ä¸æ˜¯ç°åœ¨ç”Ÿäº§è€…ç”Ÿäº§çš„æ•°æ®ä¸Šæ¶¨é€Ÿåº¦è¾ƒå¿«ï¼Œä»è€Œå¯¼è‡´ä½œä¸šç›®å‰çš„æ¶ˆè´¹é€Ÿåº¦å°±æ˜¯è·Ÿä¸ä¸Š Kafka ç”Ÿäº§è€…çš„ç”Ÿäº§é€Ÿåº¦ï¼Œå¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼Œé‚£ä¹ˆå°±å¾—æŸ¥çœ‹ä½œä¸šçš„å¹¶è¡Œåº¦å’Œ Kafka çš„åˆ†åŒºæ•°æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœå°äº Kafka çš„åˆ†åŒºæ•°ï¼Œé‚£ä¹ˆå¯ä»¥å¢å¤§å¹¶è¡Œåº¦è‡³ Kafka çš„åˆ†åŒºæ•°ï¼Œç„¶åå†è§‚å¯Ÿä½œä¸šæ¶ˆè´¹é€Ÿåº¦æ˜¯å¦å¯ä»¥è·Ÿä¸Šæ•°æ®ç”Ÿäº§é€Ÿåº¦ï¼›å¦‚æœå·²ç»ç­‰äº Kafka çš„åˆ†åŒºæ•°äº†ï¼Œé‚£å¾—è€ƒè™‘ä¸‹æ˜¯å¦ Kafka è¦æ‰©å¤§åˆ†åŒºï¼Œä½†æ˜¯è¿™æ ·å¯èƒ½ä¼šå¸¦æ¥ Kafka å…¶ä»–çš„é—®é¢˜ï¼Œè¿™ä¸ªæ“ä½œéœ€è¦è°¨æ…ã€‚ Kafka ä¸­æ•°æ®å‡ºç°å †ç§¯çš„è¯ï¼Œè¿˜å¯ä»¥åˆ†æä¸‹æ•°æ®çš„ç±»å‹ï¼Œå¦‚æœæ•°æ®ä¸é‡è¦ï¼Œä½†æ˜¯åˆè¦ä¿è¯æ•°æ®çš„åŠæ—¶æ€§ï¼Œå¯ä»¥ä¿®æ”¹ä½œä¸šè®©ä½œä¸šå§‹ç»ˆä»æœ€æ–°çš„æ•°æ®å¼€å§‹æ¶ˆè´¹ï¼Œä¸¢å¼ƒä¹‹å‰å †ç§¯çš„æ•°æ®ï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯æ•°æ®çš„åŠæ—¶æ€§ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå‡å¦‚ä¸€ä¸ªå®æ—¶å‘Šè­¦ä½œä¸šå®ƒçªç„¶æ¶ˆè´¹ä¸åŠæ—¶ï¼ŒKafka ä¸­å †ç§¯äº†å‡ äº¿æ¡æ•°æ®ï¼ˆæ•°æ®å»¶è¿Ÿå‡ ä¸ªå°æ—¶ï¼‰ï¼Œé‚£ä¹ˆå¦‚æœä½œä¸šè°ƒé«˜å¹¶è¡Œåº¦é‡å¯åï¼Œå®ƒè¿˜æ˜¯ä»ä¸Šä¸€æ¬¡æäº¤çš„ offset å¤„å¼€å§‹æ¶ˆè´¹çš„è¯ï¼Œè¿™æ ·å‘Šè­¦ä½œä¸šå³ä½¿ç°åœ¨æ¶ˆè´¹é€Ÿåº¦è·Ÿçš„ä¸Šäº†ï¼Œä½†æ˜¯å®ƒè¦å¤„ç†æ‰ä¹‹å‰å †ç§¯çš„å‡ äº¿æ¡æ•°æ®ä¹Ÿæ˜¯è¦ä¸€æ®µæ—¶é—´çš„ï¼Œé‚£ä¹ˆå°±æ„å‘³ç€è¿™ä¸ªä½œä¸šä»å°†æœ‰æ®µæ—¶é—´å¤„äº â€˜ä¸å¯ç”¨â€™ã€‚å› ä¸ºå³ä½¿åˆ¤æ–­å‡ºæ¥è¦å‘Šè­¦ï¼Œå¯èƒ½è¿™ä¸ªå‘Šè­¦ä¿¡æ¯çš„åŸæ•°æ®å·²ç»æ˜¯å‡ ä¸ªå°æ—¶å‰çš„äº†ï¼Œæ²¡å‡†è¿™ä¸ªå‘Šè­¦æ­¤æ—¶å·²ç»æ¢å¤äº†ï¼Œä½†æ˜¯è¿˜å‘å‡ºæ¥å‘Šè­¦è¿™å°±æ„å‘³ç€å»¶è¿Ÿæ€§æ¯”è¾ƒå¤§ï¼Œè¿˜ä¼šå¯¹å‘Šè­¦æ¶ˆæ¯æ¥æ”¶è€…é€ æˆä¸€å®šçš„å¹²æ‰°ï¼Œæ‰€ä»¥è¿™ç§åœºæ™¯ä¸‹å»ºè®®é‡å¯ä½œä¸šå°±ç›´æ¥å¼€å§‹ä»æœ€æ–°çš„æ•°æ®å¼€å§‹æ¶ˆè´¹ã€‚å½“ç„¶ä¸åŒçš„åœºæ™¯å¯èƒ½ä¸ä¸€æ ·ï¼Œå¦‚æœé‡‘èè¡Œä¸šçš„äº¤æ˜“æ•°æ®ï¼Œé‚£ä¹ˆæ˜¯è‚¯å®šä¸èƒ½å…è®¸è¿™æ ·ä¸¢æ•°æ®çš„ï¼Œå³ä½¿å †ç§¯äº†ï¼Œä¹Ÿè¦æ…¢æ…¢çš„å»æ¶ˆè´¹å †ç§¯çš„æ•°æ®ï¼Œç›´åˆ°åé¢è¿½å¹³è‡³æœ€æ–°çš„æ•°æ®ã€‚ åœ¨ Source ç«¯è®¾ç½®å¹¶è¡Œåº¦çš„è¯ï¼Œå¦‚æœæ•°æ®æºæ˜¯ Kafka çš„è¯ï¼Œå»ºè®®å¹¶è¡Œåº¦ä¸è¦è¶…è¿‡ Kafka çš„åˆ†åŒºæ•°ï¼Œå› ä¸ºä¸€ä¸ªå¹¶è¡Œåº¦ä¼šå»å¤„ç†ä¸€è‡³å¤šä¸ªåˆ†åŒºçš„æ•°æ®ï¼Œå¦‚æœè®¾ç½®è¿‡å¤šçš„è¯ï¼Œä¼šå‡ºç°éƒ¨åˆ†å¹¶è¡Œåº¦ç©ºé—²ã€‚å¦‚æœæ˜¯å…¶ä»–çš„æ•°æ®æºï¼Œå¯ä»¥æ ¹æ®å®é™…æƒ…å†µåˆç†å¢å¤§å¹¶è¡Œåº¦æ¥æé«˜ä½œä¸šçš„å¤„ç†æ•°æ®èƒ½åŠ›ã€‚ 9.4.2 ä¸­é—´ Operator å¹¶è¡Œåº¦çš„é…ç½®æ•°æ®ä» Source ç«¯æµå…¥åï¼Œé€šå¸¸ä¼šè¿›è¡Œä¸€å®šçš„æ•°æ®è½¬æ¢ã€èšåˆæ‰èƒ½å¤Ÿæ»¡è¶³éœ€æ±‚ï¼Œåœ¨æ•°æ®è½¬æ¢ä¸­å¯èƒ½ä¼šå’Œç¬¬ä¸‰æ–¹ç³»ç»Ÿè¿›è¡Œäº¤äº’ï¼Œåœ¨äº¤äº’çš„è¿‡ç¨‹ä¸­å¯èƒ½ä¼šå› ä¸ºç½‘ç»œåŸå› æˆ–è€…ç¬¬ä¸‰æ–¹æœåŠ¡åŸå› å¯¼è‡´æœ‰ä¸€å®šçš„å»¶è¿Ÿï¼Œä»è€Œå¯¼è‡´è¿™ä¸ªæ•°æ®äº¤äº’çš„ç®—å­å¤„ç†æ•°æ®çš„ååé‡ä¼šé™ä½ï¼Œå¯èƒ½ä¼šé€ æˆåå‹ï¼Œä»è€Œä¼šå½±å“ä¸Šæ¸¸çš„ç®—å­çš„æ¶ˆè´¹ã€‚é‚£ä¹ˆåœ¨è¿™ç§æƒ…å†µä¸‹è¿™äº›ä¸ç¬¬ä¸‰æ–¹ç³»ç»Ÿæœ‰äº¤äº’çš„ç®—å­å¾—ç¨å¾®æé«˜å¹¶è¡Œåº¦ï¼Œé˜²æ­¢å‡ºç°è¿™ç§åå‹é—®é¢˜ï¼ˆå½“ç„¶åå‹é—®é¢˜ä¸ä¸€å®šå°±è¿™æ ·å¯ä»¥è§£å†³ï¼Œå…·ä½“å¦‚ä½•å¤„ç†å‚è§ 9.1 èŠ‚ï¼‰ã€‚ é™¤äº†è¿™ç§ä¸ç¬¬ä¸‰æ–¹æœåŠ¡åšäº¤äº’çš„å¤–ï¼Œå¦å¤–å¯èƒ½çš„æ€§èƒ½ç“¶é¢ˆä¹Ÿä¼šå‡ºç°åœ¨è¿™ç±»ç®—å­ä¸­ï¼Œæ¯”å¦‚ä½  Kafka è¿‡æ¥çš„æ•°æ®æ˜¯ JSON ä¸²çš„ Stringï¼Œç„¶åéœ€è¦è½¬æ¢æˆå¯¹è±¡ï¼Œåœ¨å¤§æ•°æ®é‡çš„æƒ…å†µä¸‹è¿™ä¸ªè½¬æ¢ä¹Ÿæ˜¯æ¯”è¾ƒè€—è´¹æ€§èƒ½çš„ã€‚ æ‰€ä»¥æ•°æ®è½¬æ¢ä¸­é—´è¿‡ç¨‹çš„ç®—å­ä¹Ÿæ˜¯éå¸¸é‡è¦çš„ï¼Œå¦‚æœå“ªä¸€æ­¥ç®—å­çš„å¹¶è¡Œåº¦è®¾ç½®çš„ä¸åˆç†ï¼Œå¯èƒ½å°±ä¼šé€ æˆå„ç§å„æ ·çš„é—®é¢˜å‡ºç°ã€‚ 9.4.3 Sink ç«¯å¹¶è¡Œåº¦çš„é…ç½®Sink ç«¯æ˜¯æ•°æ®æµå‘ä¸‹æ¸¸çš„åœ°æ–¹ï¼Œå¯ä»¥æ ¹æ® Sink ç«¯çš„æ•°æ®é‡è¿›è¡Œè¯„ä¼°ï¼Œå¯èƒ½æœ‰çš„ä½œä¸šæ˜¯ Source ç«¯çš„æ•°æ®é‡æœ€å¤§ï¼Œç„¶åæ•°æ®é‡ä¸æ–­çš„å˜å°‘ï¼Œæœ€ååˆ° Sink ç«¯çš„æ•°æ®å°±ä¸€ç‚¹ç‚¹äº†ï¼Œæ¯”è¾ƒå¸¸è§çš„å°±æ˜¯ç›‘æ§å‘Šè­¦çš„åœºæ™¯ã€‚Source ç«¯çš„æ•°æ®æ˜¯æµ·é‡çš„ï¼Œä½†æ˜¯é€šè¿‡é€å±‚çš„è¿‡æ»¤å’Œè½¬æ¢ï¼Œåˆ°æœ€ååˆ¤æ–­è¦å‘Šè­¦çš„æ•°æ®å…¶å®å·²ç»å‡å°‘å¾ˆå¤šå¾ˆå¤šäº†ï¼Œé‚£ä¹ˆåœ¨æœ€åçš„è¿™ä¸ªåœ°æ–¹å°±å¯ä»¥å°†å¹¶è¡Œåº¦è®¾ç½®çš„å°ä¸€äº›ã€‚ å½“ç„¶ä¹Ÿå¯èƒ½ä¼šæœ‰è¿™æ ·çš„æƒ…å†µï¼Œåœ¨ Source ç«¯çš„æ•°æ®é‡æ˜¯æœ€å°çš„ï¼Œæ‹¿åˆ° Source ç«¯æµè¿‡æ¥çš„æ•°æ®ååšäº†ç»†ç²’åº¦çš„æ‹†åˆ†ï¼Œé‚£ä¹ˆæ•°æ®é‡å°±ä¸æ–­çš„å¢åŠ äº†ï¼Œåˆ° Sink ç«¯çš„æ•°æ®é‡å°±éå¸¸éå¸¸çš„å¤§äº†ã€‚é‚£ä¹ˆåœ¨ Sink åˆ°ä¸‹æ¸¸çš„å­˜å‚¨ä¸­é—´ä»¶çš„æ—¶å€™å°±éœ€è¦æé«˜å¹¶è¡Œåº¦ã€‚ å¦å¤– Sink ç«¯ä¹Ÿæ˜¯è¦ä¸ä¸‹æ¸¸çš„æœåŠ¡è¿›è¡Œäº¤äº’ï¼Œå¹¶è¡Œåº¦è¿˜å¾—æ ¹æ®ä¸‹æ¸¸çš„æœåŠ¡æŠ—å‹èƒ½åŠ›æ¥è®¾ç½®ï¼Œå¦‚æœåœ¨ Flink Sink è¿™ç«¯çš„æ•°æ®é‡è¿‡å¤§çš„è¯ï¼Œç„¶ååœ¨ Sink å¤„å¹¶è¡Œåº¦ä¹Ÿè®¾ç½®çš„å¾ˆå¤§ï¼Œä½†æ˜¯ä¸‹æ¸¸çš„æœåŠ¡å®Œå…¨æ’‘ä¸ä½è¿™ä¹ˆå¤§çš„å¹¶å‘å†™å…¥ï¼Œä¹Ÿæ˜¯å¯èƒ½ä¼šé€ æˆä¸‹æ¸¸æœåŠ¡ç›´æ¥è¢«å†™æŒ‚çš„ï¼Œä¸‹æ¸¸æœåŠ¡å¯èƒ½è¿˜è¦å¯¹å¤–æä¾›ä¸€äº›å…¶ä»–çš„æœåŠ¡ï¼Œå¦‚æœç¨³å®šæ€§ä¸èƒ½ä¿è¯çš„è¯ï¼Œä¼šé€ æˆå¾ˆå¤§çš„å½±å“ï¼Œæ‰€ä»¥æœ€ç»ˆè¿˜æ˜¯è¦åœ¨ Sink å¤„çš„å¹¶è¡Œåº¦åšä¸€å®šçš„æƒè¡¡ã€‚ 9.4.4 Operator Chainå¯¹äºä¸€èˆ¬çš„ä½œä¸šï¼ˆæ— ç‰¹æ®Šè€—æ€§èƒ½å¤„ï¼‰ï¼Œå¯ä»¥å°½é‡è®©ç®—å­çš„å¹¶è¡Œåº¦ä» Source ç«¯åˆ° Sink ç«¯éƒ½ä¿æŒä¸€è‡´ï¼Œè¿™æ ·å¯ä»¥å°½å¯èƒ½çš„è®© Job ä¸­çš„ç®—å­è¿›è¡Œ chain åœ¨ä¸€èµ·ï¼Œå½¢æˆé“¾ï¼Œæ•°æ®åœ¨é“¾ä¸­å¯ä»¥ç›´æ¥ä¼ è¾“ï¼Œè€Œä¸éœ€è¦å†æ¬¡è¿›è¡Œåºåˆ—åŒ–ä¸ååºåˆ—åŒ–ï¼Œè¿™æ ·å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—å°±ä¼šå¾—åˆ°é™ä½ã€‚åœ¨ 9.2 èŠ‚ä¸­å…·ä½“è®²è§£äº†ç®—å­ chain åœ¨ä¸€èµ·çš„æ¡ä»¶ï¼Œå¿˜è®°çš„è¯å¯ä»¥å»å›é¡¾ä¸€ä¸‹ã€‚ 9.4.5 å°ç»“ä¸åæ€æœ¬èŠ‚è®²äº†ä½œä¸šæ‰§è¡Œè¿‡ç¨‹ä¸­ Source ç«¯ã€ä¸­é—´ç®—å­å’Œ Sink ç«¯çš„å¹¶è¡Œåº¦è®¾ç½®çš„ä¸€äº›æŠ€å·§ã€‚å¹¶è¡Œåº¦ä¿®æ”¹åï¼ˆå¢å¤§æˆ–è€…å‡å°ï¼‰é‡å¯ Jobï¼Œå¦‚æœæ˜¯å‡å°å¹¶è¡Œåº¦ï¼Œä¹‹å‰åŸæœ‰çš„å¹¶è¡Œåº¦çš„çŠ¶æ€è¯¥æ€ä¹ˆåŠï¼›å¦‚æœæ˜¯æ–°å¢å¹¶è¡Œåº¦ï¼Œå¦‚ä½•ç¡®ä¿å’ŒåŸæ¥çš„å¹¶è¡Œåº¦çŠ¶æ€ä¿æŒä¸€è‡´ï¼Ÿ åŠ å…¥çŸ¥è¯†æ˜Ÿçƒå¯ä»¥çœ‹åˆ°ä¸Šé¢æ–‡ç« ï¼šhttps://t.zsxq.com/uFEEYzJ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹â€”â€” Flink Parallelism å’Œ Slot æ·±åº¦ç†è§£","date":"2021-08-08T16:00:00.000Z","path":"2021/08/09/flink-in-action-9.3/","text":"9.3 Flink Parallelism å’Œ Slot æ·±åº¦ç†è§£ç›¸ä¿¡ä½¿ç”¨è¿‡ Flink çš„ä½ æˆ–å¤šæˆ–å°‘é‡åˆ°è¿‡ä¸‹é¢è¿™ä¸ªé—®é¢˜ï¼ˆç¬”è€…è‡ªå·±çš„é¡¹ç›®æ›¾ç»ä¹Ÿå‡ºç°è¿‡è¿™æ ·çš„é—®é¢˜ï¼‰ï¼Œé”™è¯¯ä¿¡æ¯å¦‚ä¸‹ï¼š 123Caused by: akka.pattern.AskTimeoutException: Ask timed out on [Actor[akka://flink/user/taskmanager_0#15608456]] after [10000 ms]. Sender[null] sent message of type &quot;org.apache.flink.runtime.rpc.messages.LocalRpcInvocation&quot;. é”™è¯¯ä¿¡æ¯çš„å®Œæ•´æˆªå›¾å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ è·Ÿç€è¿™é—®é¢˜åœ¨ Flink çš„ Issue åˆ—è¡¨é‡Œçœ‹åˆ°äº†ä¸€ä¸ªç±»ä¼¼çš„é—®é¢˜ï¼šFLINK-9056 issuesï¼Œçœ‹åˆ°è¯¥ Issue ä¸‹é¢çš„è¯„è®ºè¯´å‡ºç°è¯¥é—®é¢˜çš„åŸå› æ˜¯å› ä¸º TaskManager çš„ Slot æ•°é‡ä¸è¶³å¯¼è‡´çš„ Job æäº¤å¤±è´¥ï¼Œåœ¨ Flink 1.63 ä¸­å·²ç»ä¿®å¤äº†ï¼Œå˜æˆæŠ›å‡ºå¼‚å¸¸äº†ï¼Œä¿®å¤çš„ä»£ç å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ ç«Ÿç„¶çŸ¥é“äº†æ˜¯å› ä¸º Slot ä¸è¶³çš„åŸå› äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¦å…ˆäº†è§£ä¸‹ Slot æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä¸è¿‡åœ¨äº†è§£ Slot ä¹‹å‰è¿™é‡Œå…ˆä»‹ç»ä¸‹ Parallelismã€‚ 9.3.1 Parallelism ç®€ä»‹Parallelism ç¿»è¯‘æˆä¸­æ–‡æ˜¯å¹¶è¡Œçš„æ„æ€ï¼Œåœ¨ Flink ä½œä¸šé‡Œé¢ä»£è¡¨ç®—å­çš„å¹¶è¡Œåº¦ï¼Œé€‚å½“çš„æé«˜å¹¶è¡Œåº¦å¯ä»¥å¤§å¤§æé«˜ Job çš„æ‰§è¡Œæ•ˆç‡ï¼Œæ¯”å¦‚ä½ çš„ Job æ¶ˆè´¹ Kafka æ•°æ®è¿‡æ…¢ï¼Œé€‚å½“è°ƒå¤§å¯èƒ½å°±æ¶ˆè´¹æ­£å¸¸äº†ã€‚é‚£ä¹ˆåœ¨ Flink ä¸­æ€ä¹ˆè®¾ç½®å¹¶è¡Œåº¦å‘¢ï¼Ÿ 9.3.2 å¦‚ä½•è®¾ç½® Parallelismï¼Ÿåœ¨ Flink é…ç½®æ–‡ä»¶ä¸­é»˜è®¤å¹¶è¡Œåº¦æ˜¯ 1ï¼Œä½ å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹åˆ°é…ç½®æ–‡ä»¶ä¸­çš„é»˜è®¤å¹¶è¡Œåº¦ï¼š 1cat flink-conf.yaml | grep parallelism ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æ‰€ä»¥å¦‚æœåœ¨ä½ çš„ Flink Job é‡Œé¢ä¸è®¾ç½®ä»»ä½• Parallelism çš„è¯ï¼Œé‚£ä¹ˆå®ƒä¹Ÿä¼šæœ‰ä¸€ä¸ªé»˜è®¤çš„ Parallelismï¼ˆé»˜è®¤ä¸º 1ï¼‰ï¼Œé‚£ä¹Ÿæ„å‘³ç€å¯ä»¥ä¿®æ”¹è¿™ä¸ªé…ç½®æ–‡ä»¶çš„é»˜è®¤å¹¶è¡Œåº¦æ¥æé«˜ Job çš„æ‰§è¡Œæ•ˆç‡ã€‚å¦‚æœæ˜¯ä½¿ç”¨å‘½ä»¤è¡Œå¯åŠ¨ä½ çš„ Flink Jobï¼Œé‚£ä¹ˆä½ ä¹Ÿå¯ä»¥è¿™æ ·è®¾ç½®å¹¶è¡Œåº¦(ä½¿ç”¨ -p n å‚æ•°)ï¼š 1./bin/flink run -p 10 /Users/zhisheng/word-count.jar ä½ ä¹Ÿå¯ä»¥åœ¨ä½œä¸šä¸­é€šè¿‡ env.setParallelism(n) ä»£ç æ¥è®¾ç½®æ•´ä¸ªä½œä¸šç¨‹åºçš„å¹¶è¡Œåº¦ã€‚ 12StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();env.setParallelism(10); æ³¨æ„ï¼šè¿™æ ·è®¾ç½®çš„å¹¶è¡Œåº¦æ˜¯æ•´ä¸ªç¨‹åºçš„å¹¶è¡Œåº¦ï¼Œé‚£ä¹ˆåé¢å¦‚æœæ¯ä¸ªç®—å­ä¸å•ç‹¬è®¾ç½®å¹¶è¡Œåº¦è¦†ç›–çš„è¯ï¼Œé‚£ä¹ˆåé¢æ¯ä¸ªç®—å­çš„å¹¶è¡Œåº¦å°±éƒ½æ˜¯ä»¥è¿™é‡Œè®¾ç½®çš„å¹¶è¡Œåº¦ä¸ºå‡†äº†ã€‚å¦‚ä½•ç»™æ¯ä¸ªç®—å­å•ç‹¬è®¾ç½®å¹¶è¡Œåº¦å‘¢ï¼Ÿ 1234data.keyBy(new xxxKey()) .flatMap(new XxxFlatMapFunction()).setParallelism(5) .map(new XxxMapFunction).setParallelism(5) .addSink(new XxxSink()).setParallelism(1) å¦‚ä¸Šå°±æ˜¯ç»™æ¯ä¸ªç®—å­å•ç‹¬è®¾ç½®å¹¶è¡Œåº¦ï¼Œè¿™æ ·çš„è¯ï¼Œå°±ç®—ç¨‹åºè®¾ç½®äº† env.setParallelism(10) ä¹Ÿæ˜¯ä¼šè¢«è¦†ç›–çš„ã€‚è¿™ä¹Ÿè¯´æ˜ä¼˜å…ˆçº§æ˜¯ï¼šç®—å­è®¾ç½®å¹¶è¡Œåº¦ &gt; env è®¾ç½®å¹¶è¡Œåº¦ &gt; é…ç½®æ–‡ä»¶é»˜è®¤å¹¶è¡Œåº¦ã€‚ å¹¶è¡Œåº¦è®²åˆ°è¿™é‡Œåº”è¯¥éƒ½æ‡‚äº†ï¼Œä¸‹é¢å°±ç»§ç»­è®²ä»€ä¹ˆæ˜¯ Slotï¼Ÿ 9.3.3 Slot ç®€ä»‹å…¶å® Slot çš„æ¦‚å¿µåœ¨ 1.2 èŠ‚ä¸­å·²ç»æåŠåˆ°ï¼Œè¿™é‡Œå†ç»†è®²ä¸€ç‚¹ã€‚Flink çš„ä½œä¸šæäº¤çš„æ¶æ„æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å›¾ä¸­ TaskManager æ˜¯ä» JobManager å¤„æ¥æ”¶éœ€è¦éƒ¨ç½²çš„ Taskï¼Œä»»åŠ¡èƒ½é…ç½®çš„æœ€å¤§å¹¶è¡Œåº¦ç”± TaskManager ä¸Šå¯ç”¨çš„ Slot å†³å®šã€‚æ¯ä¸ªä»»åŠ¡ä»£è¡¨åˆ†é…ç»™ä»»åŠ¡æ§½çš„ä¸€ç»„èµ„æºï¼ŒSlot åœ¨ Flink é‡Œé¢å¯ä»¥è®¤ä¸ºæ˜¯èµ„æºç»„ï¼ŒFlink å°†æ¯ä¸ªä»»åŠ¡åˆ†æˆå­ä»»åŠ¡å¹¶ä¸”å°†è¿™äº›å­ä»»åŠ¡åˆ†é…åˆ° Slot ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥å¹¶è¡Œçš„æ‰§è¡Œç¨‹åºã€‚ ä¾‹å¦‚ï¼Œå¦‚æœ TaskManager æœ‰å››ä¸ª Slotï¼Œé‚£ä¹ˆå®ƒå°†ä¸ºæ¯ä¸ª Slot åˆ†é… 25ï¼… çš„å†…å­˜ã€‚ å¯ä»¥åœ¨ä¸€ä¸ª Slot ä¸­è¿è¡Œä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ã€‚ åŒä¸€ Slot ä¸­çš„çº¿ç¨‹å…±äº«ç›¸åŒçš„ JVMã€‚ åŒä¸€ JVM ä¸­çš„ä»»åŠ¡å…±äº« TCP è¿æ¥å’Œå¿ƒè·³æ¶ˆæ¯ã€‚TaskManager çš„ä¸€ä¸ª Slot ä»£è¡¨ä¸€ä¸ªå¯ç”¨çº¿ç¨‹ï¼Œè¯¥çº¿ç¨‹å…·æœ‰å›ºå®šçš„å†…å­˜ï¼Œæ³¨æ„ Slot åªå¯¹å†…å­˜éš”ç¦»ï¼Œæ²¡æœ‰å¯¹ CPU éš”ç¦»ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒFlink å…è®¸å­ä»»åŠ¡å…±äº« Slotï¼Œå³ä½¿å®ƒä»¬æ˜¯ä¸åŒ Task çš„ subtaskï¼Œåªè¦å®ƒä»¬æ¥è‡ªç›¸åŒçš„ Jobï¼Œè¿™ç§å…±äº«æ¨¡å¼å¯ä»¥å¤§å¤§çš„æé«˜èµ„æºåˆ©ç”¨ç‡ã€‚ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæœ‰ä¸¤ä¸ª TaskManagerï¼Œæ¯ä¸ª TaskManager æœ‰ä¸‰ä¸ª Slotï¼Œè¿™æ ·æˆ‘ä»¬çš„ç®—å­æœ€å¤§å¹¶è¡Œåº¦é‚£ä¹ˆå°±å¯ä»¥è¾¾åˆ° 6 ä¸ªï¼Œåœ¨åŒä¸€ä¸ª Slot é‡Œé¢å¯ä»¥æ‰§è¡Œ 1 è‡³å¤šä¸ªå­ä»»åŠ¡ã€‚é‚£ä¹ˆå†çœ‹ä¸‹å›¾ï¼Œsource/map/keyby/window/apply ç®—å­æœ€å¤§å¯ä»¥è®¾ç½® 6 ä¸ªå¹¶è¡Œåº¦ï¼Œsink åªè®¾ç½®äº† 1 ä¸ªå¹¶è¡Œåº¦ã€‚ æ¯ä¸ª Flink TaskManager åœ¨é›†ç¾¤ä¸­æä¾› Slotï¼ŒSlot çš„æ•°é‡é€šå¸¸ä¸æ¯ä¸ª TaskManager çš„å¯ç”¨ CPU å†…æ ¸æ•°æˆæ¯”ä¾‹ï¼ˆä¸€èˆ¬æƒ…å†µä¸‹ Slot ä¸ªæ•°æ˜¯æ¯ä¸ª TaskManager çš„ CPU æ ¸æ•°ï¼‰ã€‚Flink é…ç½®æ–‡ä»¶ä¸­è®¾ç½®çš„ä¸€ä¸ª TaskManager é»˜è®¤çš„ Slot æ˜¯ 1ï¼Œé…ç½®å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ taskmanager.numberOfTaskSlots: 1 è¯¥å‚æ•°å¯ä»¥æ ¹æ®å®é™…æƒ…å†µåšä¸€å®šçš„ä¿®æ”¹ã€‚ 9.3.4 Slot å’Œ Parallelism çš„å…³ç³»9.3.5 å¯èƒ½ä¼šé‡åˆ° Slot å’Œ Parallelism çš„é—®é¢˜9.3.6 å°ç»“ä¸åæ€åŠ å…¥çŸ¥è¯†æ˜Ÿçƒå¯ä»¥çœ‹åˆ°ä¸Šé¢æ–‡ç« ï¼šhttps://t.zsxq.com/uFEEYzJ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹â€”â€” å¦‚ä½•æŸ¥çœ‹ Flink ä½œä¸šæ‰§è¡Œè®¡åˆ’ï¼Ÿ","date":"2021-08-07T16:00:00.000Z","path":"2021/08/08/flink-in-action-9.2/","text":"9.2 å¦‚ä½•æŸ¥çœ‹ Flink ä½œä¸šæ‰§è¡Œè®¡åˆ’ï¼Ÿå½“ä¸€ä¸ªåº”ç”¨ç¨‹åºéœ€æ±‚æ¯”è¾ƒç®€å•çš„æƒ…å†µä¸‹ï¼Œæ•°æ®è½¬æ¢æ¶‰åŠçš„ operatorï¼ˆç®—å­ï¼‰å¯èƒ½ä¸å¤šï¼Œä½†æ˜¯å½“åº”ç”¨çš„éœ€æ±‚å˜å¾—è¶Šæ¥è¶Šå¤æ‚æ—¶ï¼Œå¯èƒ½åœ¨ä¸€ä¸ª Job é‡Œé¢ç®—å­çš„ä¸ªæ•°ä¼šè¾¾åˆ°å‡ åä¸ªã€ç”šè‡³ä¸Šç™¾ä¸ªï¼Œåœ¨å¦‚æ­¤å¤šç®—å­çš„æƒ…å†µä¸‹ï¼Œæ•´ä¸ªåº”ç”¨ç¨‹åºå°±ä¼šå˜å¾—éå¸¸å¤æ‚ï¼Œæ‰€ä»¥åœ¨ç¼–å†™ Flink Job çš„æ—¶å€™è¦æ˜¯èƒ½å¤Ÿéšæ—¶çŸ¥é“ Job çš„æ‰§è¡Œè®¡åˆ’é‚£å°±å¾ˆæ–¹ä¾¿äº†ã€‚ åˆšå¥½ï¼ŒFlink æ˜¯æ”¯æŒå¯ä»¥è·å–åˆ°æ•´ä¸ª Job çš„æ‰§è¡Œè®¡åˆ’çš„ï¼Œå¦å¤– Flink å®˜ç½‘è¿˜æä¾›äº†ä¸€ä¸ªå¯è§†åŒ–å·¥å…· visualizerï¼ˆå¯ä»¥å°†æ‰§è¡Œè®¡åˆ’ JSON ç»˜åˆ¶å‡ºæ‰§è¡Œå›¾ï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ 9.2.1 å¦‚ä½•è·å–æ‰§è¡Œè®¡åˆ’ JSONï¼Ÿæ—¢ç„¶çŸ¥é“äº†å°†æ‰§è¡Œè®¡åˆ’ JSON ç»˜åˆ¶å‡ºå¯æŸ¥çœ‹çš„æ‰§è¡Œå›¾çš„å·¥å…·ï¼Œé‚£ä¹ˆè¯¥å¦‚ä½•è·å–æ‰§è¡Œè®¡åˆ’ JSON å‘¢ï¼Ÿæ–¹æ³•å¾ˆç®€å•ï¼Œä½ åªéœ€è¦åœ¨ä½ çš„ Flink Job çš„ Main æ–¹æ³• é‡Œé¢åŠ ä¸Šè¿™ä¹ˆä¸€è¡Œä»£ç ï¼š 1System.out.println(env.getExecutionPlan()); ç„¶åå°±å¯ä»¥åœ¨ IDEA ä¸­å³é”® Run ä¸€ä¸‹ä½ çš„ Flink Jobï¼Œä»æ‰“å°çš„æ—¥å¿—é‡Œé¢å¯ä»¥æŸ¥çœ‹åˆ°æ‰§è¡Œè®¡åˆ’çš„ JSON ä¸²ï¼Œä¾‹å¦‚ä¸‹é¢è¿™ç§ï¼š 1&#123;\"nodes\":[&#123;\"id\":1,\"type\":\"Source: Custom Source\",\"pact\":\"Data Source\",\"contents\":\"Source: Custom Source\",\"parallelism\":5&#125;,&#123;\"id\":2,\"type\":\"Sink: flink-connectors-kafka\",\"pact\":\"Data Sink\",\"contents\":\"Sink: flink-connectors-kafka\",\"parallelism\":5,\"predecessors\":[&#123;\"id\":1,\"ship_strategy\":\"FORWARD\",\"side\":\"second\"&#125;]&#125;]&#125; IDEA ä¸­è¿è¡Œæ‰“å°å‡ºæ¥çš„æ‰§è¡Œè®¡åˆ’çš„ JSON ä¸²å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 9.2.2 ç”Ÿæˆæ‰§è¡Œè®¡åˆ’å›¾è·å–åˆ°æ‰§è¡Œè®¡åˆ’ JSON äº†ï¼Œé‚£ä¹ˆåˆ©ç”¨ Flink è‡ªå¸¦çš„å·¥å…·æ¥ç»˜å‡ºæ‰§è¡Œè®¡åˆ’å›¾ï¼Œå°†è·å¾—åˆ°çš„ JSON ä¸²å¤åˆ¶ç²˜è´´åˆ°åˆšæ‰é‚£ç½‘å€å»ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ ç‚¹å‡»ä¸Šå›¾çš„ Draw æŒ‰é’®ï¼Œå°±ä¼šç”Ÿæˆå¦‚ä¸‹å›¾æ‰€ç¤ºçš„æ‰§è¡Œæµç¨‹å›¾äº†ã€‚ ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å“ªäº›å†…å®¹å‘¢ï¼Ÿ operator nameï¼ˆç®—å­ï¼‰ï¼šæ¯”å¦‚ sourceã€sink æ¯ä¸ª operator çš„å¹¶è¡Œåº¦ï¼šæ¯”å¦‚ Parallelism: 5 æ•°æ®ä¸‹å‘çš„ç±»å‹ï¼šæ¯”å¦‚ FORWARD ä½ è¿˜å¯ä»¥ç‚¹å‡»ä¸‹å›¾ä¸­çš„ Data Source(ID = 1) æŸ¥çœ‹å…·ä½“è¯¦æƒ…ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š éšç€éœ€æ±‚çš„ä¸æ®µå¢åŠ ï¼Œå¯èƒ½ç®—å­çš„ä¸ªæ•°ä¼šå¢åŠ ï¼Œæ‰€ä»¥æ‰§è¡Œè®¡åˆ’ä¹Ÿä¼šå˜å¾—æ›´ä¸ºå¤æ‚ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ çœ‹åˆ°ä¸Šå›¾æ˜¯ä¸æ˜¯è§‰å¾—å°±æœ‰ç‚¹å¾ˆå¤æ‚äº†ï¼Œç¬”è€…ç›¸ä¿¡å¯èƒ½ä½ è‡ªå·±çš„ä¸šåŠ¡éœ€æ±‚æ¯”è¿™è¿˜ä¼šå¤æ‚å¾—æ›´å¤šï¼Œä¸è¿‡ä»è¿™å›¾æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ¯”ä¸Šé¢é‚£ä¸ªç®€å•çš„æ‰§è¡Œè®¡åˆ’å›¾å¤šäº†ä¸€ç§æ•°æ®ä¸‹å‘ç±»å‹å°±æ˜¯ HASHã€‚ä½†æ˜¯å¤§å®¶å¯èƒ½ä¼šå¥½å¥‡çš„è¯´ï¼šä¸ºä»€ä¹ˆæˆ‘å¹³æ—¶ä» Flink UI ä¸ŠæŸ¥çœ‹åˆ°çš„ Job â€æ‰§è¡Œè®¡åˆ’å›¾â€œ å´ä¸æ˜¯è¿™æ ·å­çš„å‘€ï¼Ÿ è¿™é‡Œæˆ‘ä»¬å¤ç°ä¸€ä¸‹è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªç¨å¾®å¤æ‚çš„ Flink Job æäº¤åˆ° Flink UI ä¸Šå»æŸ¥çœ‹ä¸€ä¸‹åˆ°åº•å®ƒåœ¨ UI ä¸Šçš„æ‰§è¡Œè®¡åˆ’å›¾æ˜¯ä¸ªä»€ä¹ˆæ ·å­ï¼Ÿæˆ‘ä»¬æäº¤ Jar åŒ…åä¸è¿è¡Œï¼Œç›´æ¥ç‚¹å‡» show plan çš„ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ æˆ‘ä»¬å†è¿è¡Œä¸€ä¸‹ï¼ŒæŸ¥çœ‹è¿è¡Œçš„æ—¶å€™çš„å±•ç¤ºçš„ â€œæ‰§è¡Œè®¡åˆ’å›¾â€ åˆæ˜¯ä¸ä¸€æ ·çš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ 9.2.3 æ·±å…¥æ¢ç©¶ Flink ä½œä¸šæ‰§è¡Œè®¡åˆ’æˆ‘ä»¬å¯ä»¥å‘ç°è¿™ä¸¤ä¸ª â€œæ‰§è¡Œè®¡åˆ’å›¾â€ éƒ½å’Œåœ¨ Flink å®˜ç½‘æä¾›çš„ visualizer å·¥å…·ç”Ÿæˆçš„æ‰§è¡Œè®¡åˆ’å›¾æ˜¯ä¸ä¸€æ ·çš„ã€‚ç²—ç•¥è§‚å¯Ÿå¯ä»¥å‘ç°ï¼šåœ¨ Flink UI ä¸Šé¢çš„ â€œæ‰§è¡Œè®¡åˆ’å›¾â€ å˜å¾—æ›´åŠ ç®€æ´äº†ï¼Œæœ‰äº›ç®—å­åˆåœ¨ä¸€èµ·äº†ï¼Œæ‰€ä»¥æ•´ä½“çœ‹èµ·æ¥å°±æ²¡è¿™ä¹ˆå¤æ‚äº†ã€‚å…¶å®ï¼Œè¿™æ˜¯ Flink å†…éƒ¨åšçš„ä¸€ä¸ªä¼˜åŒ–ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ env.getExecutionPlan() è¿™æ®µä»£ç å®ƒèƒŒåçš„é€»è¾‘ï¼š 1234567891011/** * Creates the plan with which the system will execute the program, and * returns it as a String using a JSON representation of the execution data * flow graph. Note that this needs to be called, before the plan is * executed. * * @return The execution plan of the program, as a JSON String. */public String getExecutionPlan() &#123; return getStreamGraph().getStreamingPlanAsJSON();&#125; ä»£ç æ³¨é‡Šçš„å¤§æ¦‚æ„æ€æ˜¯ï¼š åˆ›å»ºç¨‹åºæ‰§è¡Œè®¡åˆ’ï¼Œå¹¶å°†æ‰§è¡Œæ•°æ®æµå›¾çš„ JSON ä½œä¸º String è¿”å›ï¼Œè¯·æ³¨æ„ï¼Œåœ¨æ‰§è¡Œè®¡åˆ’ä¹‹å‰éœ€è¦è°ƒç”¨æ­¤æ–¹æ³•ã€‚ è¿™ä¸ª getExecutionPlan æ–¹æ³•æœ‰ä¸¤æ­¥æ“ä½œï¼š 1ã€è·å–åˆ° Job çš„ StreamGraph å…³äºå¦‚ä½•è·å–åˆ° StreamGraphï¼Œç¬”è€…åœ¨åšå®¢é‡Œé¢å†™äº†ç¯‡æºç è§£æ å¦‚ä½•è·å– StreamGraphï¼Ÿ ã€‚ 2ã€å°† StreamGraph è½¬æ¢æˆ JSON 12345678public String getStreamingPlanAsJSON() &#123; try &#123; return new JSONGenerator(this).getJSON(); &#125; catch (Exception e) &#123; throw new RuntimeException(\"JSON plan creation failed\", e); &#125;&#125; è·Ÿè¿› getStreamingPlanAsJSON æ–¹æ³•çœ‹è§å®ƒæ„é€ äº†ä¸€ä¸ª JSONGenerator å¯¹è±¡ï¼ˆå«å‚ StreamGraphï¼‰ï¼Œç„¶åè°ƒç”¨ getJSON æ–¹æ³•ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹è¿™ä¸ªæ–¹æ³•ï¼š 1234567891011121314151617public String getJSON() &#123; ObjectNode json = mapper.createObjectNode(); ArrayNode nodes = mapper.createArrayNode(); json.put(\"nodes\", nodes); List&lt;Integer&gt; operatorIDs = new ArrayList&lt;Integer&gt;(streamGraph.getVertexIDs()); Collections.sort(operatorIDs, new Comparator&lt;Integer&gt;() &#123; @Override public int compare(Integer idOne, Integer idTwo) &#123; boolean isIdOneSinkId = streamGraph.getSinkIDs().contains(idOne); boolean isIdTwoSinkId = streamGraph.getSinkIDs().contains(idTwo); // put sinks at the back ... &#125; &#125;); visit(nodes, operatorIDs, new HashMap&lt;Integer, Integer&gt;()); return json.toString();&#125; ä¸€å¼€å§‹æ„é€ å¤–éƒ¨çš„å¯¹è±¡ï¼Œç„¶åè°ƒç”¨ visit æ–¹æ³•ç»§ç»­æ„é€ å†…éƒ¨çš„å¯¹è±¡ï¼Œvisit æ–¹æ³•å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354private void visit(ArrayNode jsonArray, List&lt;Integer&gt; toVisit, Map&lt;Integer, Integer&gt; edgeRemapings) &#123; Integer vertexID = toVisit.get(0); StreamNode vertex = streamGraph.getStreamNode(vertexID); if (streamGraph.getSourceIDs().contains(vertexID) || Collections.disjoint(vertex.getInEdges(), toVisit)) &#123; ObjectNode node = mapper.createObjectNode(); decorateNode(vertexID, node); if (!streamGraph.getSourceIDs().contains(vertexID)) &#123; ArrayNode inputs = mapper.createArrayNode(); node.put(PREDECESSORS, inputs); for (StreamEdge inEdge : vertex.getInEdges()) &#123; int inputID = inEdge.getSourceId(); Integer mappedID = (edgeRemapings.keySet().contains(inputID)) ? edgeRemapings .get(inputID) : inputID; decorateEdge(inputs, inEdge, mappedID); &#125; &#125; jsonArray.add(node); toVisit.remove(vertexID); &#125; else &#123; Integer iterationHead = -1; for (StreamEdge inEdge : vertex.getInEdges()) &#123; int operator = inEdge.getSourceId(); if (streamGraph.vertexIDtoLoopTimeout.containsKey(operator)) &#123; iterationHead = operator; &#125; &#125; ObjectNode obj = mapper.createObjectNode(); ArrayNode iterationSteps = mapper.createArrayNode(); obj.put(STEPS, iterationSteps); obj.put(ID, iterationHead); obj.put(PACT, \"IterativeDataStream\"); obj.put(PARALLELISM, streamGraph.getStreamNode(iterationHead).getParallelism()); obj.put(CONTENTS, \"Stream Iteration\"); ArrayNode iterationInputs = mapper.createArrayNode(); obj.put(PREDECESSORS, iterationInputs); toVisit.remove(iterationHead); visitIteration(iterationSteps, toVisit, iterationHead, edgeRemapings, iterationInputs); jsonArray.add(obj); &#125; if (!toVisit.isEmpty()) &#123; visit(jsonArray, toVisit, edgeRemapings); &#125;&#125; æœ€åå°±å°†è¿™ä¸ª StreamGraph æ„é€ æˆä¸€ä¸ª JSON ä¸²è¿”å›å‡ºå»ï¼Œæ‰€ä»¥å…¶å®è¿™é‡Œè¿”å›çš„æ‰§è¡Œè®¡åˆ’å›¾å°±æ˜¯ Flink Job çš„ StreamGraphï¼Œç„¶è€Œæˆ‘ä»¬åœ¨ Flink UI ä¸Šé¢çœ‹åˆ°çš„ â€œæ‰§è¡Œè®¡åˆ’å›¾â€ æ˜¯å¯¹åº” Flink ä¸­çš„ JobGraphï¼ŒåŒæ ·ï¼Œç¬”è€…åœ¨åšå®¢é‡Œé¢ä¹Ÿå†™äº†ç¯‡æºç è§£æçš„æ–‡ç«  æºç è§£æâ€”â€”å¦‚ä½•è·å– JobGraphï¼Ÿã€‚ 9.2.4 Flink ä¸­ç®—å­é“¾æ¥ï¼ˆchainï¼‰èµ·æ¥çš„æ¡ä»¶Flink åœ¨å†…éƒ¨ä¼šå°†å¤šä¸ªç®—å­ä¸²åœ¨ä¸€èµ·ä½œä¸ºä¸€ä¸ª operator chainï¼ˆæ‰§è¡Œé“¾ï¼‰æ¥æ‰§è¡Œï¼Œæ¯ä¸ªæ‰§è¡Œé“¾ä¼šåœ¨ TaskManager ä¸Šçš„ä¸€ä¸ªç‹¬ç«‹çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œè¿™æ ·ä¸ä»…å¯ä»¥å‡å°‘çº¿ç¨‹çš„æ•°é‡åŠçº¿ç¨‹åˆ‡æ¢å¸¦æ¥çš„èµ„æºæ¶ˆè€—ï¼Œè¿˜èƒ½é™ä½æ•°æ®åœ¨ç®—å­ä¹‹é—´ä¼ è¾“åºåˆ—åŒ–ä¸ååºåˆ—åŒ–å¸¦æ¥çš„æ¶ˆè€—ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œæ‹¿ä¸€ä¸ª Flink Job ï¼ˆç®—å­çš„å¹¶è¡Œåº¦éƒ½è®¾ç½®ä¸º 5ï¼‰ç”Ÿæˆçš„ StreamGraph JSON æ¸²æŸ“å‡ºæ¥çš„æ‰§è¡Œæµç¨‹å›¾å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ æäº¤åˆ° Flink UI ä¸Šçš„ JobGraph å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ å¯ä»¥çœ‹åˆ° Flink å®ƒå†…éƒ¨å°†ä¸‰ä¸ªç®—å­ï¼ˆsourceã€filterã€sinkï¼‰éƒ½ä¸²æˆåœ¨ä¸€ä¸ªæ‰§è¡Œé“¾é‡Œã€‚ä½†æ˜¯æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹ filter è¿™ä¸ªç®—å­çš„å¹¶è¡Œåº¦ä¸º 4ï¼Œæˆ‘ä»¬å†æ¬¡æäº¤åˆ° Flink UI ä¸Šè¿è¡Œï¼Œæ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ ä½ ä¼šå‘ç°å®ƒç«Ÿç„¶æ‹†åˆ†æˆä¸‰ä¸ªäº†ï¼Œæˆ‘ä»¬ç»§ç»­å°† sink çš„å¹¶è¡Œåº¦ä¹Ÿä¿®æ”¹æˆ 4ï¼Œç»§ç»­æ‰“åŒ…è¿è¡Œåçš„æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ ç¥å¥‡ä¸ï¼Œå®ƒå˜æˆäº† 2 ä¸ªäº†ï¼Œå°† filter å’Œ sink ç®—å­ä¸²åœ¨ä¸€èµ·äº†æ‰§è¡Œäº†ã€‚ç»è¿‡ç®€å•çš„æµ‹è¯•ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°å…¶å®å¦‚æœæƒ³è¦æŠŠä¸¤ä¸ªä¸ä¸€æ ·çš„ç®—å­ä¸²åœ¨ä¸€èµ·æ‰§è¡Œç¡®å®è¿˜ä¸æ˜¯é‚£ä¹ˆç®€å•çš„ï¼Œçš„ç¡®ï¼Œå®ƒèƒŒåçš„æ¡ä»¶å¯æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œè¿™é‡Œç¬”è€…ç»™å‡ºæºç å‡ºæ¥ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥ç‹¬è‡ªé˜…è¯»ä¸‹æºç ã€‚ 1234567891011121314151617181920public static boolean isChainable(StreamEdge edge, StreamGraph streamGraph) &#123; //è·å–StreamEdgeçš„æºå’Œç›®æ ‡StreamNode StreamNode upStreamVertex = edge.getSourceVertex(); StreamNode downStreamVertex = edge.getTargetVertex(); //è·å–æºå’Œç›®æ ‡StreamNodeä¸­çš„StreamOperator StreamOperator&lt;?&gt; headOperator = upStreamVertex.getOperator(); StreamOperator&lt;?&gt; outOperator = downStreamVertex.getOperator(); return downStreamVertex.getInEdges().size() == 1 &amp;&amp; outOperator != null &amp;&amp; headOperator != null &amp;&amp; upStreamVertex.isSameSlotSharingGroup(downStreamVertex) &amp;&amp; outOperator.getChainingStrategy() == ChainingStrategy.ALWAYS &amp;&amp; (headOperator.getChainingStrategy() == ChainingStrategy.HEAD || headOperator.getChainingStrategy() == ChainingStrategy.ALWAYS) &amp;&amp; (edge.getPartitioner() instanceof ForwardPartitioner) &amp;&amp; upStreamVertex.getParallelism() == downStreamVertex.getParallelism() &amp;&amp; streamGraph.isChainingEnabled();&#125; ä»æºç æœ€åçš„ return å¯ä»¥çœ‹å‡ºå®ƒæœ‰ä¹ä¸ªæ¡ä»¶ï¼š â€¦ æ‰€ä»¥çœ‹åˆ°ä¸Šé¢çš„è¿™ä¹ä¸ªæ¡ä»¶ï¼Œä½ æ˜¯ä¸æ˜¯åœ¨æƒ³å¦‚æœæˆ‘ä»¬ä»£ç èƒ½å¤Ÿåˆç†çš„å†™å¥½ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½ä¼šå°†ä¸åŒçš„ç®—å­ä¸²åœ¨ä¸€ä¸ªæ‰§è¡Œé“¾ä¸­ï¼Œè¿™æ ·ä¹Ÿå°±å¯ä»¥æé«˜ä»£ç çš„æ‰§è¡Œæ•ˆç‡äº†ã€‚ 9.2.5 å¦‚ä½•ç¦æ­¢ Operator chainï¼ŸåŠ å…¥çŸ¥è¯†æ˜Ÿçƒå¯ä»¥çœ‹åˆ°ä¸Šé¢æ–‡ç« ï¼šhttps://t.zsxq.com/uFEEYzJ 9.2.6 å°ç»“ä¸åæ€æœ¬èŠ‚å†…å®¹ä»æŸ¥çœ‹ä½œä¸šçš„æ‰§è¡Œè®¡åˆ’æ¥åˆ†æä½œä¸šçš„æ‰§è¡Œæƒ…å†µï¼Œæ¥ç€åˆ†æäº†ä½œä¸šç®—å­ chain èµ·æ¥çš„æ¡ä»¶ï¼Œå¹¶é€šè¿‡ç¨‹åºæ¼”ç¤ºæ¥éªŒè¯ï¼Œæœ€åè®²è§£äº†å¦‚ä½•ç¦æ­¢ç®—å­ chain èµ·æ¥ã€‚ æœ¬èŠ‚ä»£ç åœ°å€ï¼šchain Job visualizer å·¥å…· æºç è§£æâ€”â€”å¦‚ä½•è·å– StreamGraph","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹â€”â€” å¦‚ä½•å¤„ç† Flink Job BackPressure ï¼ˆåå‹ï¼‰é—®é¢˜?","date":"2021-08-06T16:00:00.000Z","path":"2021/08/07/flink-in-action-9.1/","text":"ç¬¬ä¹ç«  â€”â€” Flink æ€§èƒ½è°ƒä¼˜é€šè¿‡ç¬¬å…«ç« çš„ç›‘æ§å›¾è¡¨ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°é—®é¢˜ï¼Œåœ¨å‘ç°é—®é¢˜åï¼Œéœ€è¦å»åˆ†æä¸ºä»€ä¹ˆä¼šå‘ç”Ÿè¿™äº›é—®é¢˜ä»¥åŠæˆ‘ä»¬è¯¥å¦‚ä½•å»è§£å†³è¿™äº›é—®é¢˜ã€‚æœ¬ç« å°†ä¼šä»‹ç»å¾ˆå¤š Flink ç”Ÿäº§ç¯å¢ƒé‡åˆ°çš„é—®é¢˜ï¼Œæ¯”å¦‚ä½œä¸šå‡ºç°åå‹ã€ä½œä¸šå¹¶è¡Œåº¦é…ç½®ä¸åˆç†ã€ä½œä¸šæ•°æ®å€¾æ–œç­‰ï¼Œé™¤äº†å¼•å‡ºè¿™ç§å¸¸è§é—®é¢˜ä¹‹å¤–ï¼Œç¬”è€…è¿˜å°†å’Œä½ ä¸€èµ·å»åˆ†æè¿™ç§é—®é¢˜é€ æˆçš„åŸå› ä»¥åŠå¦‚ä½•å»ä¼˜åŒ–ä½œä¸šã€‚æ¯”å¦‚åˆç†çš„é…ç½®å¹¶è¡Œåº¦ã€è®©ä½œä¸šç®—å­å°½å¯èƒ½çš„ chain åœ¨ä¸€èµ·å·²è¾¾åˆ°æœ€ä¼˜ç­‰ã€‚å¸Œæœ›é€šè¿‡æœ¬ç« çš„å†…å®¹ï¼Œä½ å¯ä»¥å°†è¿™äº›è§£å†³æ–¹æ³•è¿ç”¨åœ¨ä½ çš„å…¬å¸ï¼Œå¸®åŠ©å…¬å¸è§£å†³ç±»ä¼¼çš„é—®é¢˜ã€‚ 9.1 å¦‚ä½•å¤„ç† Flink Job BackPressure ï¼ˆåå‹ï¼‰é—®é¢˜?åå‹ï¼ˆBackPressureï¼‰æœºåˆ¶è¢«å¹¿æ³›åº”ç”¨åˆ°å®æ—¶æµå¤„ç†ç³»ç»Ÿä¸­ï¼Œæµå¤„ç†ç³»ç»Ÿéœ€è¦èƒ½ä¼˜é›…åœ°å¤„ç†åå‹é—®é¢˜ã€‚åå‹é€šå¸¸äº§ç”Ÿäºè¿™æ ·çš„åœºæ™¯ï¼šçŸ­æ—¶é—´çš„è´Ÿè½½é«˜å³°å¯¼è‡´ç³»ç»Ÿæ¥æ”¶æ•°æ®çš„é€Ÿç‡è¿œé«˜äºå®ƒå¤„ç†æ•°æ®çš„é€Ÿç‡ã€‚è®¸å¤šæ—¥å¸¸é—®é¢˜éƒ½ä¼šå¯¼è‡´åå‹ï¼Œä¾‹å¦‚ï¼Œåƒåœ¾å›æ”¶åœé¡¿å¯èƒ½ä¼šå¯¼è‡´æµå…¥çš„æ•°æ®å¿«é€Ÿå †ç§¯ï¼Œæˆ–é‡åˆ°å¤§ä¿ƒã€ç§’æ€æ´»åŠ¨å¯¼è‡´æµé‡é™¡å¢ã€‚åå‹å¦‚æœä¸èƒ½å¾—åˆ°æ­£ç¡®çš„å¤„ç†ï¼Œå¯èƒ½ä¼šå¯¼è‡´èµ„æºè€—å°½ç”šè‡³ç³»ç»Ÿå´©æºƒã€‚åå‹æœºåˆ¶æ˜¯æŒ‡ç³»ç»Ÿèƒ½å¤Ÿè‡ªå·±æ£€æµ‹åˆ°è¢«é˜»å¡çš„ Operatorï¼Œç„¶åè‡ªé€‚åº”åœ°é™ä½æºå¤´æˆ–ä¸Šæ¸¸æ•°æ®çš„å‘é€é€Ÿç‡ï¼Œä»è€Œç»´æŒæ•´ä¸ªç³»ç»Ÿçš„ç¨³å®šã€‚Flink ä»»åŠ¡ä¸€èˆ¬è¿è¡Œåœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šï¼Œæ•°æ®ä»ä¸Šæ¸¸ç®—å­å‘é€åˆ°ä¸‹æ¸¸ç®—å­éœ€è¦ç½‘ç»œä¼ è¾“ï¼Œè‹¥ç³»ç»Ÿåœ¨åå‹æ—¶æƒ³è¦é™ä½æ•°æ®æºå¤´æˆ–ä¸Šæ¸¸ç®—å­æ•°æ®çš„å‘é€é€Ÿç‡ï¼Œé‚£ä¹ˆè‚¯å®šä¹Ÿéœ€è¦ç½‘ç»œä¼ è¾“ã€‚æ‰€ä»¥ä¸‹é¢å…ˆæ¥äº†è§£ä¸€ä¸‹ Flink çš„ç½‘ç»œæµæ§ï¼ˆFlink å¯¹ç½‘ç»œæ•°æ®æµé‡çš„æ§åˆ¶ï¼‰æœºåˆ¶ã€‚ 9.1.1 Flink æµå¤„ç†ä¸ºä»€ä¹ˆéœ€è¦ç½‘ç»œæµæ§ä¸‹å›¾æ˜¯ä¸€ä¸ªç®€å•çš„ Flink æµä»»åŠ¡æ‰§è¡Œå›¾ï¼šä»»åŠ¡é¦–å…ˆä» Kafka ä¸­è¯»å–æ•°æ®ã€é€šè¿‡ map ç®—å­å¯¹æ•°æ®è¿›è¡Œè½¬æ¢ã€keyBy æŒ‰ç…§æŒ‡å®š key å¯¹æ•°æ®è¿›è¡Œåˆ†åŒºï¼ˆkey ç›¸åŒçš„æ•°æ®ç»è¿‡ keyBy ååˆ†åˆ°åŒä¸€ä¸ª subtask å®ä¾‹ä¸­ï¼‰ï¼ŒkeyBy åå¯¹æ•°æ®è¿›è¡Œ map è½¬æ¢ï¼Œç„¶åä½¿ç”¨ Sink å°†æ•°æ®è¾“å‡ºåˆ°å¤–éƒ¨å­˜å‚¨ã€‚ ä¼—æ‰€å‘¨çŸ¥ï¼Œåœ¨å¤§æ•°æ®å¤„ç†ä¸­ï¼Œæ— è®ºæ˜¯æ‰¹å¤„ç†è¿˜æ˜¯æµå¤„ç†ï¼Œå•ç‚¹å¤„ç†çš„æ€§èƒ½æ€»æ˜¯æœ‰é™çš„ï¼Œæˆ‘ä»¬çš„å•ä¸ª Job ä¸€èˆ¬ä¼šè¿è¡Œåœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šï¼Œé€šè¿‡å¤šä¸ªèŠ‚ç‚¹å…±åŒé…åˆæ¥æå‡æ•´ä¸ªç³»ç»Ÿçš„å¤„ç†æ€§èƒ½ã€‚å›¾ä¸­ï¼Œä»»åŠ¡è¢«åˆ‡åˆ†æˆ 4 ä¸ªå¯ç‹¬ç«‹æ‰§è¡Œçš„ subtask åˆ†åˆ«æ˜¯ A0ã€A1ã€B0ã€B1ï¼Œåœ¨æ•°æ®å¤„ç†è¿‡ç¨‹ä¸­å°±ä¼šå­˜åœ¨ shuffleã€‚ä¾‹å¦‚ï¼Œsubtask A0 å¤„ç†å®Œçš„æ•°æ®ç»è¿‡ keyBy åè¢«å‘é€åˆ° subtask B0ã€B1 æ‰€åœ¨èŠ‚ç‚¹å»å¤„ç†ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œsubtask A0 åº”è¯¥ä»¥å¤šå¿«çš„é€Ÿåº¦å‘ subtask B0ã€B1 å‘é€æ•°æ®å‘¢ï¼ŸæŠŠä¸Šè¿°é—®é¢˜æŠ½è±¡åŒ–ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå°† subtask A0 å½“ä½œ Producerï¼Œsubtask B0 å½“åš Consumerï¼Œä¸Šæ¸¸ Producer å‘ä¸‹æ¸¸ Consumer å‘é€æ•°æ®ï¼Œåœ¨å‘é€ç«¯å’Œæ¥æ”¶ç«¯æœ‰ç›¸åº”çš„ Send Buffer å’Œ Receive Bufferï¼Œä½†æ˜¯ä¸Šæ¸¸ Producer ç”Ÿäº§æ•°æ®çš„é€Ÿç‡æ¯”ä¸‹æ¸¸ Consumer æ¶ˆè´¹æ•°æ®çš„é€Ÿç‡å¤§ï¼ŒProducer ç”Ÿäº§æ•°æ®çš„é€Ÿç‡ä¸º 2MB/sï¼Œ Consumer æ¶ˆè´¹æ•°æ®é€Ÿç‡ä¸º 1MB/sï¼ŒReceive Buffer å®¹é‡åªæœ‰ 5MBï¼Œæ‰€ä»¥è¿‡äº† 5 ç§’åï¼Œæ¥æ”¶ç«¯çš„ Receive Buffer æ»¡äº†ã€‚ ä¸‹æ¸¸æ¶ˆè´¹é€Ÿç‡æ…¢ï¼Œä¸”æ¥æ”¶åŒºçš„ Receive Buffer æœ‰é™ï¼Œå¦‚æœä¸Šæ¸¸ä¸€ç›´æœ‰æºæºä¸æ–­çš„æ•°æ®ï¼Œé‚£ä¹ˆå°†ä¼šé¢ä¸´ç€ä»¥ä¸‹ä¸¤ç§æƒ…å†µï¼š ä¸‹æ¸¸æ¶ˆè´¹è€…çš„ç¼“å†²åŒºæ”¾ä¸ä¸‹æ•°æ®ï¼Œå¯¼è‡´ä¸‹æ¸¸æ¶ˆè´¹è€…ä¼šä¸¢å¼ƒæ–°åˆ°è¾¾çš„æ•°æ® ä¸ºäº†ä¸ä¸¢å¼ƒæ•°æ®ï¼Œæ‰€ä»¥ä¸‹æ¸¸æ¶ˆè´¹è€…çš„ Receive Buffer æŒç»­æ‰©å¼ ï¼Œæœ€åè€—å°½æ¶ˆè´¹è€…çš„å†…å­˜ï¼Œå¯¼è‡´ OOM ç¨‹åºæŒ‚æ‰ å¸¸è¯†å‘Šè¯‰æˆ‘ä»¬ï¼Œè¿™ä¸¤ç§æƒ…å†µåœ¨ç”Ÿäº§ç¯å¢ƒä¸‹éƒ½æ˜¯ä¸èƒ½æ¥å—çš„ï¼Œç¬¬ä¸€ç§ä¼šä¸¢æ•°æ®ã€ç¬¬äºŒç§ä¼šæŠŠåº”ç”¨ç¨‹åºæŒ‚æ‰ã€‚æ‰€ä»¥ï¼Œè¯¥é—®é¢˜çš„è§£å†³æ–¹æ¡ˆä¸åº”è¯¥æ˜¯ä¸‹æ¸¸ Receive Buffer ä¸€ç›´ç´¯ç§¯æ•°æ®ï¼Œè€Œæ˜¯ä¸Šæ¸¸ Producer å‘ç°ä¸‹æ¸¸ Consumer æ¶ˆè´¹æ¯”è¾ƒæ…¢çš„æ—¶å€™ï¼Œåº”è¯¥åœ¨ Producer ç«¯åšå‡ºé™æµçš„ç­–ç•¥ï¼Œé˜²æ­¢åœ¨ä¸‹æ¸¸ Consumer ç«¯æ— é™åˆ¶åœ°å †ç§¯æ•°æ®ã€‚é‚£ä¸Šæ¸¸ Producer ç«¯è¯¥å¦‚ä½•åšé™æµå‘¢ï¼Ÿå¯ä»¥é‡‡ç”¨å¦‚ä¸‹å›¾æ‰€ç¤ºçš„é™æ€é™æµç­–ç•¥ï¼š é™æ€é™é€Ÿçš„æ€æƒ³å°±æ˜¯ï¼Œæå‰å·²çŸ¥ä¸‹æ¸¸ Consumer ç«¯çš„æ¶ˆè´¹é€Ÿç‡ï¼Œç„¶ååœ¨ä¸Šæ¸¸ Producer ç«¯ä½¿ç”¨ç±»ä¼¼ä»¤ç‰Œæ¡¶çš„æ€æƒ³ï¼Œé™åˆ¶ Producer ç«¯ç”Ÿäº§æ•°æ®çš„é€Ÿç‡ï¼Œä»è€Œæ§åˆ¶ä¸Šæ¸¸ Producer ç«¯å‘ä¸‹æ¸¸ Consumer ç«¯å‘é€æ•°æ®çš„é€Ÿç‡ã€‚ä½†æ˜¯é™æ€é™é€Ÿä¼šå­˜åœ¨é—®é¢˜ï¼š é€šå¸¸æ— æ³•äº‹å…ˆé¢„ä¼°ä¸‹æ¸¸ Consumer ç«¯èƒ½æ‰¿å—çš„æœ€å¤§é€Ÿç‡ å°±ç®—é€šè¿‡æŸç§æ–¹å¼é¢„ä¼°å‡ºä¸‹æ¸¸ Consumer ç«¯èƒ½æ‰¿å—çš„æœ€å¤§é€Ÿç‡ï¼Œåœ¨è¿è¡Œè¿‡ç¨‹ä¸­ä¹Ÿå¯èƒ½ä¼šå› ä¸ºç½‘ç»œæŠ–åŠ¨ã€ CPU å…±äº«ç«äº‰ã€å†…å­˜ç´§å¼ ã€IOé˜»å¡ç­‰åŸå› é€ æˆä¸‹æ¸¸ Consumer çš„ååé‡é™ä½ï¼Œä½†æ˜¯ä¸Šæ¸¸ Producer çš„ååé‡æ­£å¸¸ï¼Œç„¶ååˆä¼šå‡ºç°ä¹‹å‰æ‰€è¯´çš„ä¸‹æ¸¸æ¥æ”¶åŒºçš„ Receive Buffer æœ‰é™ï¼Œä¸Šæ¸¸ä¸€ç›´æœ‰æºæºä¸æ–­çš„æ•°æ®å‘é€åˆ°ä¸‹æ¸¸çš„é—®é¢˜ï¼Œè¿˜æ˜¯ä¼šé€ æˆä¸‹æ¸¸è¦ä¹ˆä¸¢æ•°æ®ï¼Œè¦ä¹ˆä¸ºäº†ä¸ä¸¢æ•°æ® buffer ä¸æ–­æ‰©å……å¯¼è‡´ä¸‹æ¸¸ OOM çš„é—®é¢˜ ç»¼ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬å‘ç°äº†ï¼Œä¸Šæ¸¸ Producer ç«¯å¿…é¡»æœ‰ä¸€ä¸ªé™æµçš„ç­–ç•¥ï¼Œä¸”é™æ€é™æµæ˜¯ä¸å¯é çš„ï¼Œäºæ˜¯å°±éœ€è¦ä¸€ä¸ªåŠ¨æ€é™æµçš„ç­–ç•¥ã€‚å¯ä»¥é‡‡ç”¨å¦‚ä¸‹å›¾æ‰€ç¤ºçš„åŠ¨æ€åé¦ˆç­–ç•¥ï¼š ä¸‹æ¸¸ Consumer ç«¯ä¼šé¢‘ç¹åœ°å‘ä¸Šæ¸¸ Producer ç«¯è¿›è¡ŒåŠ¨æ€åé¦ˆï¼Œå‘Šè¯‰ Producer ä¸‹æ¸¸ Consumer çš„è´Ÿè½½èƒ½åŠ›ï¼Œä»è€Œä½¿ Producer ç«¯å¯ä»¥åŠ¨æ€è°ƒæ•´å‘ä¸‹æ¸¸ Consumer å‘é€æ•°æ®çš„é€Ÿç‡ï¼Œä»¥å®ç° Producer ç«¯çš„åŠ¨æ€é™æµã€‚å½“ Consumer ç«¯å¤„ç†è¾ƒæ…¢æ—¶ï¼ŒConsumer å°†è´Ÿè½½åé¦ˆåˆ° Producer ç«¯ï¼ŒProducer ç«¯ä¼šæ ¹æ®åé¦ˆé€‚å½“é™ä½ Producer è‡ªèº«ä»ä¸Šæ¸¸æˆ–è€… Source ç«¯è¯»æ•°æ®çš„é€Ÿç‡æ¥é™ä½å‘ä¸‹æ¸¸ Consumer å‘é€æ•°æ®çš„é€Ÿç‡ã€‚å½“ Consumer å¤„ç†è´Ÿè½½èƒ½åŠ›æå‡åï¼ŒåˆåŠæ—¶å‘ Producer ç«¯åé¦ˆï¼ŒProducer ä¼šé€šè¿‡æå‡è‡ªèº«ä»ä¸Šæ¸¸æˆ– Source ç«¯è¯»æ•°æ®çš„é€Ÿç‡æ¥æå‡å‘ä¸‹æ¸¸å‘é€æ•°æ®çš„é€Ÿç‡ï¼Œé€šè¿‡åŠ¨æ€åé¦ˆçš„ç­–ç•¥æ¥åŠ¨æ€è°ƒæ•´ç³»ç»Ÿæ•´ä½“çš„ååé‡ã€‚ è¯»åˆ°è¿™é‡Œï¼Œåº”è¯¥çŸ¥é“ Flink ä¸ºä»€ä¹ˆéœ€è¦ç½‘ç»œæµæ§æœºåˆ¶äº†ï¼Œå¹¶ä¸”çŸ¥é“ Flink çš„ç½‘ç»œæµæ§æœºåˆ¶å¿…é¡»æ˜¯ä¸€ä¸ªåŠ¨æ€åé¦ˆçš„ç­–ç•¥ã€‚ä½†æ˜¯è¿˜æœ‰ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š Flink ä¸­æ•°æ®å…·ä½“æ˜¯æ€ä¹ˆä»ä¸Šæ¸¸ Producer ç«¯å‘é€åˆ°ä¸‹æ¸¸ Consumer ç«¯çš„ï¼Ÿ Flink çš„åŠ¨æ€é™æµå…·ä½“æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿä¸‹æ¸¸çš„è´Ÿè½½èƒ½åŠ›å’Œå‹åŠ›æ˜¯å¦‚ä½•ä¼ é€’ç»™ä¸Šæ¸¸çš„ï¼Ÿ å¸¦ç€è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œå­¦ä¹ ä¸‹é¢çš„ Flink ç½‘ç»œæµæ§ä¸åå‹æœºåˆ¶ã€‚ 9.1.2 Flink 1.5 ä¹‹å‰ç½‘ç»œæµæ§æœºåˆ¶ä»‹ç»åœ¨ Flink 1.5 ä¹‹å‰ï¼ŒFlink æ²¡æœ‰ä½¿ç”¨ä»»ä½•å¤æ‚çš„æœºåˆ¶æ¥è§£å†³åå‹é—®é¢˜ï¼Œå› ä¸ºæ ¹æœ¬ä¸éœ€è¦é‚£æ ·çš„æ–¹æ¡ˆï¼Flink åˆ©ç”¨è‡ªèº«ä½œä¸ºçº¯æ•°æ®æµå¼•æ“çš„ä¼˜åŠ¿æ¥ä¼˜é›…åœ°å“åº”åå‹é—®é¢˜ã€‚ä¸‹é¢æˆ‘ä»¬ä¼šæ·±å…¥åˆ†æ Flink æ˜¯å¦‚ä½•åœ¨ Task ä¹‹é—´ä¼ è¾“æ•°æ®çš„ï¼Œä»¥åŠæ•°æ®æµå¦‚ä½•å®ç°è‡ªç„¶é™é€Ÿçš„ã€‚ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒJob åˆ†ä¸º Task Aã€Bã€Cï¼ŒTask A æ˜¯ Source Taskã€Task B å¤„ç†è½¬æ¢æ•°æ®ã€Task C æ˜¯ Sink Taskã€‚Task A ä»å¤–éƒ¨ Source ç«¯è¯»å–åˆ°æ•°æ®åå°†æ•°æ®åºåˆ—åŒ–æ”¾åˆ° Send Buffer ä¸­ï¼Œå†ç”± Task A çš„ Send Buffer å‘é€åˆ° Task B çš„ Receive Bufferï¼ŒTask B çš„ç®—å­ä» Task B çš„ Receive Buffer ä¸­å°†æ•°æ®ååºåˆ—åè¿›è¡Œå¤„ç†ï¼Œå°†å¤„ç†åæ•°æ®åºåˆ—åŒ–æ”¾åˆ° Task B çš„ Send Buffer ä¸­ï¼Œå†ç”± Task B çš„ Send Buffer å‘é€åˆ° Task C çš„ Receive Bufferï¼ŒTask C å†ä» Task C çš„ Receive Buffer ä¸­å°†æ•°æ®ååºåˆ—åè¾“å‡ºåˆ°å¤–éƒ¨ Sink ç«¯ï¼Œè¿™å°±æ˜¯æ‰€æœ‰æ•°æ®çš„ä¼ è¾“å’Œå¤„ç†æµç¨‹ã€‚ Flink ä¸­ï¼ŒåŠ¨æ€åé¦ˆç­–ç•¥åŸç†æ¯”è¾ƒç®€å•ï¼Œå‡å¦‚ Task C ç”±äºå„ç§åŸå› ååé‡æ€¥å‰§é™ä½ï¼Œé‚£ä¹ˆè‚¯å®šä¼šé€ æˆ Task C çš„ Receive Buffer ä¸­å †ç§¯å¤§é‡æ•°æ®ï¼Œæ­¤æ—¶ Task B è¿˜åœ¨ç»™ Task C å‘é€æ•°æ®ï¼Œä½†æ˜¯æ¯•ç«Ÿå†…å­˜æ˜¯æœ‰é™çš„ï¼ŒæŒç»­ä¸€æ®µæ—¶é—´å Task C çš„ Receive Buffer æ»¡äº†ï¼Œæ­¤æ—¶ Task B å‘ç° Task C çš„ Receive Buffer æ»¡äº†åï¼Œå°±ä¸ä¼šå†å¾€ Task C å‘é€æ•°æ®äº†ï¼ŒTask B å¤„ç†å®Œçš„æ•°æ®å°±å¼€å§‹å¾€ Task B çš„ Send Buffer ç§¯å‹ï¼Œä¸€æ®µæ—¶é—´å Task B çš„ Send Buffer ä¹Ÿæ»¡äº†ï¼ŒTask B çš„å¤„ç†å°±ä¼šè¢«é˜»å¡ï¼Œè¿™æ—¶ Task A è¿˜åœ¨å¾€ Task B çš„ Receive Buffer å‘é€æ•°æ®ã€‚åŒæ ·çš„é“ç†ï¼ŒTask B çš„ Receive Buffer å¾ˆå¿«æ»¡äº†ï¼Œå¯¼è‡´ Task A ä¸å†å¾€ Task B å‘é€æ•°æ®ï¼ŒTask A çš„ Send Buffer ä¹Ÿä¼šè¢«ç”¨å®Œï¼ŒTask A æ˜¯ Source Task æ²¡æœ‰ä¸Šæ¸¸ï¼Œæ‰€ä»¥ Task A ç›´æ¥é™ä½ä»å¤–éƒ¨ Source ç«¯è¯»å–æ•°æ®çš„é€Ÿç‡ç”šè‡³å®Œå…¨åœæ­¢è¯»å–æ•°æ®ã€‚é€šè¿‡ä»¥ä¸ŠåŸç†ï¼ŒFlink å°†ä¸‹æ¸¸çš„å‹åŠ›ä¼ é€’ç»™ä¸Šæ¸¸ã€‚å¦‚æœä¸‹æ¸¸ Task C çš„è´Ÿè½½èƒ½åŠ›æ¢å¤åï¼Œå¦‚ä½•å°†è´Ÿè½½æå‡çš„ä¿¡æ¯åé¦ˆç»™ä¸Šæ¸¸å‘¢ï¼Ÿå®é™…ä¸Š Task B ä¼šä¸€ç›´å‘ Task C å‘é€æ¢æµ‹ä¿¡å·ï¼Œæ£€æµ‹ Task C çš„ Receive Buffer æ˜¯å¦æœ‰è¶³å¤Ÿçš„ç©ºé—´ï¼Œå½“ Task C çš„è´Ÿè½½èƒ½åŠ›æ¢å¤åï¼ŒTask C ä¼šä¼˜å…ˆæ¶ˆè´¹ Task C Receive Buffer ä¸­çš„æ•°æ®ï¼ŒTask C Receive Buffer ä¸­æœ‰è¶³å¤Ÿçš„ç©ºé—´æ—¶ï¼ŒTask B ä¼šä» Send Buffer ç»§ç»­å‘é€æ•°æ®åˆ° Task C çš„ Receive Bufferï¼ŒTask B çš„ Send Buffer æœ‰è¶³å¤Ÿç©ºé—´åï¼ŒTask B åˆå¼€å§‹æ­£å¸¸å¤„ç†æ•°æ®ï¼Œå¾ˆå¿« Task B çš„ Receive Buffer ä¸­ä¹Ÿä¼šæœ‰è¶³å¤Ÿç©ºé—´ï¼ŒåŒç†ï¼ŒTask A ä¼šä» Send Buffer ç»§ç»­å‘é€æ•°æ®åˆ° Task B çš„ Receive Bufferï¼ŒTask A çš„ Receive Buffer æœ‰è¶³å¤Ÿç©ºé—´åï¼ŒTask A å°±å¯ä»¥ä»å¤–éƒ¨çš„ Source ç«¯å¼€å§‹æ­£å¸¸è¯»å–æ•°æ®äº†ã€‚é€šè¿‡ä»¥ä¸ŠåŸç†ï¼ŒFlink å°†ä¸‹æ¸¸è´Ÿè½½è¿‡ä½çš„æ¶ˆæ¯ä¼ é€’ç»™ä¸Šæ¸¸ã€‚æ‰€ä»¥è¯´ Flink åˆ©ç”¨è‡ªèº«çº¯æ•°æ®æµå¼•æ“çš„ä¼˜åŠ¿ä¼˜é›…åœ°å“åº”åå‹é—®é¢˜ï¼Œå¹¶æ²¡æœ‰ä»»ä½•å¤æ‚çš„æœºåˆ¶æ¥è§£å†³åå‹ã€‚ä¸Šè¿°æµç¨‹ï¼Œå°±æ˜¯ Flink åŠ¨æ€é™æµï¼ˆåå‹æœºåˆ¶ï¼‰çš„ç®€å•æè¿°ï¼Œå¯ä»¥çœ‹åˆ° Flink çš„åå‹æ˜¯ä»ä¸‹æ¸¸å¾€ä¸Šæ¸¸ä¼ æ’­çš„ï¼Œä¸€ç›´å¾€ä¸Šä¼ æ’­åˆ° Source Task åï¼ŒSource Task æœ€ç»ˆä¼šé™ä½æˆ–æå‡ä»å¤–éƒ¨ Source ç«¯è¯»å–æ•°æ®çš„é€Ÿç‡ã€‚ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¯¹äºä¸€ä¸ª Flink ä»»åŠ¡ï¼ŒåŠ¨æ€åé¦ˆè¦è€ƒè™‘å¦‚ä¸‹ä¸¤ç§æƒ…å†µï¼š 1.è·¨ Taskï¼ŒåŠ¨æ€åé¦ˆå…·ä½“å¦‚ä½•ä»ä¸‹æ¸¸ Task çš„ Receive Buffer åé¦ˆç»™ä¸Šæ¸¸ Task çš„ Send Buffer å½“ä¸‹æ¸¸ Task C çš„ Receive Buffer æ»¡äº†ï¼Œå¦‚ä½•å‘Šè¯‰ä¸Šæ¸¸ Task B åº”è¯¥é™ä½æ•°æ®å‘é€é€Ÿç‡ å½“ä¸‹æ¸¸ Task C çš„ Receive Buffer ç©ºäº†ï¼Œå¦‚ä½•å‘Šè¯‰ä¸Šæ¸¸ Task B åº”è¯¥æå‡æ•°æ®å‘é€é€Ÿç‡ æ³¨ï¼šè¿™é‡Œåˆåˆ†äº†ä¸¤ç§æƒ…å†µï¼ŒTask B å’Œ Task C å¯èƒ½åœ¨åŒä¸€ä¸ª TaskManager ä¸Šè¿è¡Œï¼Œä¹Ÿæœ‰å¯èƒ½ä¸åœ¨åŒä¸€ä¸ª TaskManager ä¸Šè¿è¡Œ Task B å’Œ Task C åœ¨åŒä¸€ä¸ª TaskManager è¿è¡ŒæŒ‡çš„æ˜¯ï¼šä¸€ä¸ª TaskManager åŒ…å«äº†å¤šä¸ª Slotï¼ŒTask B å’Œ Task C éƒ½è¿è¡Œåœ¨è¿™ä¸ª TaskManager ä¸Šã€‚æ­¤æ—¶ Task B ç»™ Task C å‘é€æ•°æ®å®é™…ä¸Šæ˜¯åŒä¸€ä¸ª JVM å†…çš„æ•°æ®å‘é€ï¼Œæ‰€ä»¥ä¸å­˜åœ¨ç½‘ç»œé€šä¿¡ Task B å’Œ Task C ä¸åœ¨åŒä¸€ä¸ª TaskManager è¿è¡ŒæŒ‡çš„æ˜¯ï¼šTask B å’Œ Task C è¿è¡Œåœ¨ä¸åŒçš„ TaskManager ä¸­ã€‚æ­¤æ—¶ Task B ç»™ Task C å‘é€æ•°æ®æ˜¯è·¨èŠ‚ç‚¹çš„ï¼Œæ‰€ä»¥ä¼šå­˜åœ¨ç½‘ç»œé€šä¿¡ 2.Task å†…ï¼ŒåŠ¨æ€åé¦ˆå¦‚ä½•ä»å†…éƒ¨çš„ Send Buffer åé¦ˆç»™å†…éƒ¨çš„ Receive Buffer å½“ Task B çš„ Send Buffer æ»¡äº†ï¼Œå¦‚ä½•å‘Šè¯‰ Task B å†…éƒ¨çš„ Receive Bufferï¼Œè‡ªèº«çš„ Send Buffer å·²ç»æ»¡äº†ï¼Ÿè¦è®© Task B çš„ Receive Buffer æ„Ÿå—åˆ°å‹åŠ›ï¼Œæ‰èƒ½æŠŠä¸‹æ¸¸çš„å‹åŠ›ä¼ é€’åˆ° Task A å½“ Task B çš„ Send Buffer ç©ºäº†ï¼Œå¦‚ä½•å‘Šè¯‰ Task B å†…éƒ¨çš„ Receive Buffer ä¸‹æ¸¸ Send Buffer ç©ºäº†ï¼Œå¹¶æŠŠä¸‹æ¸¸è´Ÿè½½å¾ˆä½çš„æ¶ˆæ¯ä¼ é€’ç»™ Task A åˆ°ç›®å‰ä¸ºæ­¢ï¼ŒåŠ¨æ€åé¦ˆçš„å…·ä½“ç»†èŠ‚æŠ½è±¡æˆäº†ä¸‰ä¸ªé—®é¢˜ï¼š è·¨ Task ä¸” Task ä¸åœ¨åŒä¸€ä¸ª TaskManager å†…ï¼ŒåŠ¨æ€åé¦ˆå…·ä½“å¦‚ä½•ä»ä¸‹æ¸¸ Task çš„ Receive Buffer åé¦ˆç»™ä¸Šæ¸¸ Task çš„ Send Buffer è·¨ Task ä¸” Task åœ¨åŒä¸€ä¸ª TaskManager å†…ï¼ŒåŠ¨æ€åé¦ˆå…·ä½“å¦‚ä½•ä»ä¸‹æ¸¸ Task çš„ Receive Buffer åé¦ˆç»™ä¸Šæ¸¸ Task çš„ Send Buffer Task å†…ï¼ŒåŠ¨æ€åé¦ˆå…·ä½“å¦‚ä½•ä» Task å†…éƒ¨çš„ Send Buffer åé¦ˆç»™å†…éƒ¨çš„ Receive Buffer TaskManager ä¹‹é—´ç½‘ç»œä¼ è¾“ç›¸å…³ç»„ä»¶TaskManager ä¹‹é—´æ•°æ®ä¼ è¾“æµå‘å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¯ä»¥çœ‹åˆ° Source Task ç»™ Task B å‘é€æ•°æ®ï¼ŒSource Task åšä¸º Producerï¼ŒTask B åšä¸º Consumerï¼ŒProducer ç«¯äº§ç”Ÿçš„æ•°æ®æœ€åé€šè¿‡ç½‘ç»œå‘é€ç»™ Consumer ç«¯ã€‚Producer ç«¯ Operator å®ä¾‹å¯¹ä¸€æ¡æ¡çš„æ•°æ®è¿›è¡Œå¤„ç†ï¼Œå¤„ç†å®Œçš„æ•°æ®é¦–å…ˆç¼“å­˜åˆ° ResultPartition å†…çš„ ResultSubPartition ä¸­ã€‚ResultSubPartition ä¸­ä¸€ä¸ª Buffer å†™æ»¡æˆ–è€…è¶…æ—¶åï¼Œå°±ä¼šè§¦å‘å°† ResultSubPartition ä¸­çš„æ•°æ®æ‹·è´åˆ° Producer ç«¯ Netty çš„ Buffer ä¸­ï¼Œä¹‹ååˆæŠŠæ•°æ®æ‹·è´åˆ° Socket çš„ Send Buffer ä¸­ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªä»ç”¨æˆ·æ€æ‹·è´åˆ°å†…æ ¸æ€çš„è¿‡ç¨‹ï¼Œæœ€åé€šè¿‡ Socket å‘é€ç½‘ç»œè¯·æ±‚ï¼ŒæŠŠ Send Buffer ä¸­çš„æ•°æ®å‘é€åˆ° Consumer ç«¯çš„ Receive Bufferã€‚æ•°æ®åˆ°è¾¾ Consumer ç«¯åï¼Œå†ä¾æ¬¡ä» Socket çš„ Receive Buffer æ‹·è´åˆ° Netty çš„ Bufferï¼Œå†æ‹·è´åˆ° Consumer Operator InputGate å†…çš„ InputChannel ä¸­ï¼Œæœ€å Consumer Operator å°±å¯ä»¥è¯»åˆ°æ•°æ®è¿›è¡Œå¤„ç†äº†ã€‚è¿™å°±æ˜¯ä¸¤ä¸ª TaskManager ä¹‹é—´çš„æ•°æ®ä¼ è¾“è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å‘é€æ–¹å’Œæ¥æ”¶æ–¹å„æœ‰ä¸‰å±‚çš„ Bufferã€‚å½“ Task B å¾€ä¸‹æ¸¸å‘é€æ•°æ®æ—¶ï¼Œæ•´ä¸ªæµç¨‹ä¸ Source Task ç»™ Task B å‘é€æ•°æ®çš„æµç¨‹ç±»ä¼¼ã€‚ æ ¹æ®ä¸Šè¿°æµç¨‹ï¼Œä¸‹è¡¨ä¸­å¯¹ Flink é€šä¿¡ç›¸å…³çš„ä¸€äº›æœ¯è¯­è¿›è¡Œä»‹ç»ï¼š æ¦‚å¿µ/æœ¯è¯­ è§£é‡Š ResultPartition ç”Ÿäº§è€…ç”Ÿäº§çš„æ•°æ®é¦–å…ˆå†™å…¥åˆ° ResultPartition ä¸­ï¼Œä¸€ä¸ª Operator å®ä¾‹å¯¹åº”ä¸€ä¸ªResultPartitionã€‚ ResultSubpartition ä¸€ä¸ª ResultPartition æ˜¯ç”±å¤šä¸ª ResultSubpartition ç»„æˆã€‚å½“ Producer Operator å®ä¾‹ç”Ÿäº§çš„æ•°æ®è¦å‘é€ç»™ä¸‹æ¸¸ Consumer Operator n ä¸ªå®ä¾‹æ—¶ï¼Œé‚£ä¹ˆè¯¥ Producer Operator å®ä¾‹å¯¹åº”çš„ ResultPartition ä¸­å°±åŒ…å« n ä¸ª ResultSubpartitionã€‚ InputGate æ¶ˆè´¹è€…æ¶ˆè´¹çš„æ•°æ®æ¥è‡ªäº InputGate ä¸­ï¼Œä¸€ä¸ª Operator å®ä¾‹å¯¹åº”ä¸€ä¸ªInputGateã€‚ç½‘ç»œä¸­ä¼ è¾“çš„æ•°æ®ä¼šå†™å…¥åˆ° Task çš„ InputGateã€‚ InputChannel ä¸€ä¸ª InputGate æ˜¯ç”±å¤šä¸ª InputChannel ç»„æˆã€‚å½“ Consumer Operator å®ä¾‹è¯»å–çš„æ•°æ®æ¥è‡ªäºä¸Šæ¸¸ Producer Operator n ä¸ªå®ä¾‹æ—¶ï¼Œé‚£ä¹ˆè¯¥ Consumer Operator å®ä¾‹å¯¹åº”çš„ InputGate ä¸­å°±åŒ…å« n ä¸ª InputChannelã€‚ RecordReader ç”¨äºå°†è®°å½•ä»Bufferä¸­è¯»å‡ºã€‚ RecordWriter ç”¨äºå°†è®°å½•å†™å…¥Bufferã€‚ LocalBufferPool ä¸º ResultPartition æˆ– InputGate åˆ†é…å†…å­˜ï¼Œæ¯ä¸€ä¸ª ResultPartition æˆ– InputGateåˆ†åˆ«å¯¹åº”ä¸€ä¸ª LocalBufferPoolã€‚ NetworkBufferPool ä¸º LocalBufferPool åˆ†é…å†…å­˜ï¼ŒNetworkBufferPool æ˜¯ Task ä¹‹é—´å…±äº«çš„ï¼Œæ¯ä¸ª TaskManager åªä¼šå®ä¾‹åŒ–ä¸€ä¸ªã€‚ InputGate å’Œ ResultPartition çš„å†…å­˜æ˜¯å¦‚ä½•ç”³è¯·çš„å‘¢ï¼Ÿå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œäº†è§£ä¸€ä¸‹ Flink ç½‘ç»œä¼ è¾“ç›¸å…³çš„å†…å­˜ç®¡ç†ã€‚åœ¨ TaskManager åˆå§‹åŒ–æ—¶ï¼ŒFlink ä¼šåœ¨ NetworkBufferPool ä¸­ç”Ÿæˆä¸€å®šæ•°é‡çš„å†…å­˜å— MemorySegmentï¼Œå†…å­˜å—çš„æ€»æ•°é‡å°±ä»£è¡¨äº†ç½‘ç»œä¼ è¾“ä¸­æ‰€æœ‰å¯ç”¨çš„å†…å­˜ã€‚ NetworkBufferPool æ˜¯ Task ä¹‹é—´å…±äº«çš„ï¼Œæ¯ä¸ª TaskManager åªä¼šå®ä¾‹åŒ–ä¸€ä¸ªã€‚Task çº¿ç¨‹å¯åŠ¨æ—¶ï¼Œä¼šä¸º Task çš„ InputChannel å’Œ ResultSubPartition åˆ†åˆ«åˆ›å»ºä¸€ä¸ª LocalBufferPoolã€‚InputGate æˆ– ResultPartition éœ€è¦å†™å…¥æ•°æ®æ—¶ï¼Œä¼šå‘ç›¸å¯¹åº”çš„ LocalBufferPool ç”³è¯·å†…å­˜ï¼ˆå›¾ä¸­â‘ ï¼‰ï¼Œå½“ LocalBufferPool æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜ä¸”è¿˜æ²¡åˆ°è¾¾ LocalBufferPool è®¾ç½®çš„ä¸Šé™æ—¶ï¼Œå°±ä¼šå‘ NetworkBufferPool ç”³è¯·å†…å­˜ï¼ˆå›¾ä¸­â‘¡ï¼‰ï¼Œå¹¶å°†å†…å­˜åˆ†é…ç»™ç›¸åº”çš„ InputChannel æˆ– ResultSubPartition ï¼ˆå›¾â‘¢â‘£ï¼‰ã€‚è™½ç„¶å¯ä»¥ç”³è¯·ï¼Œä½†æ˜¯å¿…é¡»æ˜ç™½å†…å­˜ç”³è¯·è‚¯å®šæ˜¯æœ‰é™åˆ¶çš„ï¼Œä¸å¯èƒ½æ— é™åˆ¶çš„ç”³è¯·ï¼Œæˆ‘ä»¬åœ¨å¯åŠ¨ä»»åŠ¡æ—¶å¯ä»¥æŒ‡å®šè¯¥ä»»åŠ¡æœ€å¤šå¯èƒ½ç”³è¯·å¤šå¤§çš„å†…å­˜ç©ºé—´ç”¨äº NetworkBufferPoolã€‚å½“ InputChannel çš„å†…å­˜å—è¢« Operator è¯»å–æ¶ˆè´¹æ‰æˆ– ResultSubPartition çš„å†…å­˜å—å·²ç»è¢«å†™å…¥åˆ°äº† Netty ä¸­ï¼Œé‚£ä¹ˆ InputChannel å’Œ ResultSubPartition ä¸­çš„å†…å­˜å—å°±å¯ä»¥è¿˜ç»™ LocalBufferPool äº†ï¼ˆå›¾ä¸­â‘¤ï¼‰ï¼Œå¦‚æœ LocalBufferPool ä¸­æœ‰è¾ƒå¤šç©ºé—²çš„å†…å­˜å—ï¼Œå°±ä¼šè¿˜ç»™ NetworkBufferPool ï¼ˆå›¾ä¸­â‘¥ï¼‰ã€‚ äº†è§£äº† Flink ç½‘ç»œä¼ è¾“ç›¸å…³çš„å†…å­˜ç®¡ç†ï¼Œæˆ‘ä»¬æ¥åˆ†æ 3 ç§åŠ¨æ€åé¦ˆçš„å…·ä½“ç»†èŠ‚ã€‚ è·¨ Task ä¸” Task ä¸åœ¨åŒä¸€ä¸ª TaskManager å†…æ—¶ï¼Œåå‹å¦‚ä½•å‘ä¸Šæ¸¸ä¼ æ’­è·¨ Task ä¸” Task åœ¨åŒä¸€ä¸ª TaskManager å†…ï¼Œåå‹å¦‚ä½•å‘ä¸Šæ¸¸ä¼ æ’­Task å†…éƒ¨ï¼Œåå‹å¦‚ä½•å‘ä¸Šæ¸¸ä¼ æ’­9.1.3 åŸºäº Credit çš„åå‹æœºåˆ¶Flink 1.5 ä¹‹å‰åå‹æœºåˆ¶å­˜åœ¨çš„é—®é¢˜åŸºäº Credit çš„åå‹æœºåˆ¶åŸç†9.1.4 Flink å¦‚ä½•å®šä½äº§ç”Ÿåå‹çš„ä½ç½®ï¼ŸFlink åå‹ç›‘æ§åŸç†ä»‹ç»åˆ©ç”¨ Flink Web UI å®šä½äº§ç”Ÿåå‹çš„ä½ç½®åˆ©ç”¨ Flink Metrics å®šä½äº§ç”Ÿåå‹çš„ä½ç½®9.1.5 å®šä½åˆ°åå‹æ¥æºåï¼Œè¯¥å¦‚ä½•å¤„ç†ï¼Ÿç³»ç»Ÿèµ„æºåƒåœ¾æ”¶é›†ï¼ˆGCï¼‰CPU/çº¿ç¨‹ç“¶é¢ˆçº¿ç¨‹ç«äº‰è´Ÿè½½ä¸å¹³è¡¡å¤–éƒ¨ä¾èµ–9.1.6 å°ç»“ä¸åæ€åŠ å…¥çŸ¥è¯†æ˜Ÿçƒå¯ä»¥çœ‹åˆ°ä¸Šé¢æ–‡ç« ï¼šhttps://t.zsxq.com/f66iAMz","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹â€”â€” å¦‚ä½•æ­å»ºä¸€å¥— Flink ç›‘æ§ç³»ç»Ÿ?","date":"2021-08-05T16:00:00.000Z","path":"2021/08/06/flink-in-action-8.2/","text":"8.2 æ­å»ºä¸€å¥— Flink ç›‘æ§ç³»ç»Ÿ8.1 èŠ‚ä¸­è®²è§£äº† JobManagerã€TaskManager å’Œ Flink Job çš„ç›‘æ§ï¼Œä»¥åŠéœ€è¦å…³æ³¨çš„ç›‘æ§æŒ‡æ ‡æœ‰å“ªäº›ã€‚æœ¬èŠ‚å¸¦å¤§å®¶è®²è§£ä¸€ä¸‹å¦‚ä½•æ­å»ºä¸€å¥—å®Œæ•´çš„ Flink ç›‘æ§ç³»ç»Ÿï¼Œå¦‚æœä½ æ‰€åœ¨çš„å…¬å¸æ²¡æœ‰ä¸“é—¨çš„ç›‘æ§å¹³å°ï¼Œé‚£ä¹ˆå¯ä»¥æ ¹æ®æœ¬èŠ‚çš„å†…å®¹æ¥ä¸ºå…¬å¸æ­å»ºä¸€å¥—å±äºè‡ªå·±å…¬å¸çš„ Flink ç›‘æ§ç³»ç»Ÿã€‚ 8.2.1 åˆ©ç”¨ API è·å–ç›‘æ§æ•°æ®ç†Ÿæ‚‰ Flink çš„æœ‹å‹éƒ½çŸ¥é“ Flink çš„ UI ä¸Šé¢å·²ç»è¯¦ç»†åœ°å±•ç¤ºäº†å¾ˆå¤šç›‘æ§æŒ‡æ ‡çš„æ•°æ®ï¼Œå¹¶ä¸”è¿™äº›æŒ‡æ ‡è¿˜æ˜¯æ¯”è¾ƒé‡è¦çš„ï¼Œæ‰€ä»¥å¦‚æœä¸æƒ³æ­å»ºé¢å¤–çš„ç›‘æ§ç³»ç»Ÿï¼Œé‚£ä¹ˆç›´æ¥åˆ©ç”¨ Flink è‡ªèº«çš„ UI å°±å¯ä»¥è·å–åˆ°å¾ˆå¤šé‡è¦çš„ç›‘æ§ä¿¡æ¯ã€‚è¿™é‡Œè¦è®²çš„æ˜¯è¿™äº›ç›‘æ§ä¿¡æ¯å…¶å®ä¹Ÿæ˜¯é€šè¿‡ Flink è‡ªèº«çš„ Rest API æ¥è·å–æ•°æ®çš„ï¼Œæ‰€ä»¥å…¶å®è¦æ­å»ºä¸€ä¸ªç²—ç³™çš„ç›‘æ§å¹³å°ï¼Œä¹Ÿæ˜¯å¯ä»¥ç›´æ¥åˆ©ç”¨ç°æœ‰çš„æ¥å£å®šæ—¶å»è·å–æ•°æ®ï¼Œç„¶åå°†è¿™äº›æŒ‡æ ‡çš„æ•°æ®å­˜å‚¨åœ¨æŸç§æ—¶åºæ•°æ®åº“ä¸­ï¼Œæœ€åç”¨äº›å¯è§†åŒ–å›¾è¡¨åšä¸ªå±•ç¤ºï¼Œè¿™æ ·ä¸€ä¸ªå®Œæ•´çš„ç›‘æ§ç³»ç»Ÿå°±åšå‡ºæ¥äº†ã€‚ è¿™é‡Œé€šè¿‡ Chrome æµè§ˆå™¨çš„æ§åˆ¶å°æ¥æŸ¥çœ‹ä¸€ä¸‹æœ‰å“ªäº› REST API æ˜¯ç”¨æ¥æä¾›ç›‘æ§æ•°æ®çš„ã€‚ 1.åœ¨ Chrome æµè§ˆå™¨ä¸­æ‰“å¼€ http://localhost:8081/overview é¡µé¢ï¼Œå¯ä»¥è·å–åˆ°æ•´ä¸ª Flink é›†ç¾¤çš„èµ„æºä¿¡æ¯ï¼šTaskManager ä¸ªæ•°ï¼ˆTaskManagersï¼‰ã€Slot æ€»ä¸ªæ•°ï¼ˆTotal Task Slotsï¼‰ã€å¯ç”¨ Slot ä¸ªæ•°ï¼ˆAvailable Task Slotsï¼‰ã€Job è¿è¡Œä¸ªæ•°ï¼ˆRunning Jobsï¼‰ã€Job è¿è¡ŒçŠ¶æ€ï¼ˆFinished 0 Canceled 0 Failed 0ï¼‰ç­‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ 2.é€šè¿‡ http://localhost:8081/taskmanagers é¡µé¢æŸ¥çœ‹ TaskManager åˆ—è¡¨ï¼Œå¯ä»¥çŸ¥é“è¯¥é›†ç¾¤ä¸‹æ‰€æœ‰ TaskManager çš„ä¿¡æ¯ï¼ˆæ•°æ®ç«¯å£å·ï¼ˆData Portï¼‰ã€ä¸Šä¸€æ¬¡å¿ƒè·³æ—¶é—´ï¼ˆLast Heartbeatï¼‰ã€æ€»å…±çš„ Slot ä¸ªæ•°ï¼ˆAll Slotsï¼‰ã€ç©ºé—²çš„ Slot ä¸ªæ•°ï¼ˆFree Slotsï¼‰ã€ä»¥åŠ CPU å’Œå†…å­˜çš„åˆ†é…ä½¿ç”¨æƒ…å†µï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ 3.é€šè¿‡ http://localhost:8081/taskmanagers/tm_id é¡µé¢æŸ¥çœ‹ TaskManager çš„å…·ä½“æƒ…å†µï¼ˆè¿™é‡Œçš„ tm_id æ˜¯ä¸ªéšæœºçš„ UUID å€¼ï¼‰ã€‚åœ¨è¿™ä¸ªé¡µé¢ä¸Šï¼Œé™¤äº†ä¸Šä¸€æ¡çš„ç›‘æ§ä¿¡æ¯å¯ä»¥æŸ¥çœ‹ï¼Œè¿˜å¯ä»¥æŸ¥çœ‹è¯¥ TaskManager çš„ JVMï¼ˆå †å’Œéå †ï¼‰ã€Direct å†…å­˜ã€ç½‘ç»œã€GC æ¬¡æ•°å’Œæ—¶é—´ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚å†…å­˜å’Œ GC è¿™äº›ä¿¡æ¯éå¸¸é‡è¦ï¼Œå¾ˆå¤šæ—¶å€™ TaskManager é¢‘ç¹é‡å¯çš„åŸå› å°±æ˜¯ JVM å†…å­˜è®¾ç½®å¾—ä¸åˆç†ï¼Œå¯¼è‡´é¢‘ç¹çš„ GCï¼Œæœ€åä½¿å¾— OOM å´©æºƒï¼Œä¸å¾—ä¸é‡å¯ã€‚ å¦å¤–å¦‚æœä½ åœ¨ /taskmanagers/tm_id æ¥å£åé¢åŠ ä¸ª /log å°±å¯ä»¥æŸ¥çœ‹è¯¥ TaskManager çš„æ—¥å¿—ï¼Œæ³¨æ„ï¼Œåœ¨ Flink ä¸­çš„æ—¥å¿—å’Œå¹³å¸¸è‡ªå·±å†™çš„åº”ç”¨ä¸­çš„æ—¥å¿—æ˜¯ä¸ä¸€æ ·çš„ã€‚åœ¨ Flink ä¸­ï¼Œæ—¥å¿—æ˜¯ä»¥ TaskManager ä¸ºæ¦‚å¿µæ‰“å°å‡ºæ¥çš„ï¼Œè€Œä¸æ˜¯ä»¥å•ä¸ª Job æ‰“å°å‡ºæ¥çš„ï¼Œå¦‚æœä½ çš„ Job åœ¨å¤šä¸ª TaskManager ä¸Šè¿è¡Œï¼Œé‚£ä¹ˆæ—¥å¿—å°±ä¼šåœ¨å¤šä¸ª TaskManager ä¸­æ‰“å°å‡ºæ¥ã€‚å¦‚æœä¸€ä¸ª TaskManager ä¸­è¿è¡Œäº†å¤šä¸ª Jobï¼Œé‚£ä¹ˆå®ƒé‡Œé¢çš„æ—¥å¿—å°±ä¼šå¾ˆæ··ä¹±ï¼ŒæŸ¥çœ‹æ—¥å¿—æ—¶ä¼šå‘ç°å®ƒä¸ºä»€ä¹ˆæ—¢æœ‰è¿™ä¸ª Job æ‰“å‡ºæ¥çš„æ—¥å¿—ï¼Œåˆæœ‰é‚£ä¸ª Job æ‰“å‡ºæ¥çš„æ—¥å¿—ï¼Œå¦‚æœä½ ä¹‹å‰æœ‰è¿™ä¸ªç–‘é—®ï¼Œé‚£ä¹ˆç›¸ä¿¡ä½ çœ‹å®Œè¿™é‡Œï¼Œå°±ä¸ä¼šæœ‰ç–‘é—®äº†ã€‚ å¯¹äºè¿™ç§è®¾è®¡æ˜¯å¦çœŸçš„å¥½ï¼Œä¸åŒçš„äººæœ‰ä¸åŒçš„çœ‹æ³•ï¼Œåœ¨ Flink çš„ Issue ä¸­å°±æœ‰äººæå‡ºäº†è¯¥é—®é¢˜ï¼ŒIssue ä¸­çš„æè¿°æ˜¯å¸Œæœ›æ—¥å¿—å¯ä»¥æ˜¯ Job ä¸ Job ä¹‹é—´çš„éš”ç¦»ï¼Œè¿™æ ·æ—¥å¿—æ›´æ–¹ä¾¿é‡‡é›†å’ŒæŸ¥çœ‹ï¼Œå¯¹äºæ’æŸ¥é—®é¢˜ä¹Ÿä¼šæ›´å¿«ã€‚å¯¹æ­¤å›½å†…æœ‰å…¬å¸ä¹Ÿå¯¹è¿™ä¸€éƒ¨åˆ†åšäº†æ”¹è¿›ï¼Œä¸çŸ¥é“æ­£åœ¨çœ‹æœ¬ä¹¦çš„ä½ æ˜¯å¦æœ‰ä»€ä¹ˆå¥½çš„æƒ³æ³•å¯ä»¥è§£å†³ Flink çš„è¿™ä¸€ç—›ç‚¹ã€‚ 4.é€šè¿‡ http://localhost:8081/#/job-manager/config é¡µé¢å¯ä»¥çœ‹åˆ°å¯ JobManager çš„é…ç½®ä¿¡æ¯ï¼Œå¦å¤–é€šè¿‡ http://localhost:8081/jobmanager/log é¡µé¢å¯ä»¥æŸ¥çœ‹ JobManager çš„æ—¥å¿—è¯¦æƒ…ã€‚ 5.é€šè¿‡ http://localhost:8081/jobs/job_id é¡µé¢å¯ä»¥æŸ¥çœ‹ Job çš„ç›‘æ§æ•°æ®ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œç”±äºæŒ‡æ ‡ï¼ˆåŒ…æ‹¬äº† Job çš„ Task æ•°æ®ã€Operator æ•°æ®ã€Exception æ•°æ®ã€Checkpoint æ•°æ®ç­‰ï¼‰è¿‡å¤šï¼Œå¤§å®¶å¯ä»¥è‡ªå·±åœ¨æœ¬åœ°æµ‹è¯•æŸ¥çœ‹ã€‚ ä¸Šé¢åˆ—ä¸¾äº†å‡ ä¸ª REST APIï¼ˆä¸æ˜¯å…¨éƒ¨ï¼‰ï¼Œä¸»è¦æ˜¯ä¸ºäº†å‘Šè¯‰å¤§å®¶ï¼Œå…¶å®è¿™äº›æ¥å£æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ©ç”¨è¿™äº›æ¥å£å»è·å–å¯¹åº”çš„ç›‘æ§æ•°æ®ï¼Œç„¶åç»˜åˆ¶å‡ºæ›´é…·ç‚«çš„å›¾è¡¨ï¼Œç”¨æ›´ç›´è§‚çš„é¡µé¢å°†è¿™äº›æ•°æ®å±•ç¤ºå‡ºæ¥ï¼Œè¿™æ ·å°±èƒ½æ›´å¥½åœ°æ§åˆ¶ã€‚ é™¤äº†åˆ©ç”¨ Flink UI æä¾›çš„æ¥å£å»å®šæ—¶è·å–åˆ°ç›‘æ§æ•°æ®ï¼Œå…¶å® Flink è¿˜æä¾›äº†å¾ˆå¤šçš„ reporter å»ä¸ŠæŠ¥ç›‘æ§æ•°æ®ï¼Œæ¯”å¦‚ JMXReporterã€PrometheusReporterã€PrometheusPushGatewayReporterã€InfluxDBReporterã€StatsDReporter ç­‰ï¼Œè¿™æ ·å°±å¯ä»¥æ ¹æ®éœ€æ±‚å»å®šåˆ¶è·å–åˆ° Flink çš„ç›‘æ§æ•°æ®ï¼Œä¸‹é¢æ•™å¤§å®¶ä½¿ç”¨å‡ ä¸ªå¸¸ç”¨çš„ reporterã€‚ ç›¸å…³ Rest API å¯ä»¥æŸ¥çœ‹å®˜ç½‘é“¾æ¥ï¼šrest-api-integration 8.2.2 Metrics ç±»å‹ç®€ä»‹å¯ä»¥åœ¨ç»§æ‰¿è‡ª RichFunction çš„å‡½æ•°ä¸­é€šè¿‡ getRuntimeContext().getMetricGroup() è·å– Metric ä¿¡æ¯ï¼Œå¸¸è§çš„ Metrics çš„ç±»å‹æœ‰ Counterã€Gaugeã€Histogramã€Meterã€‚ CounterGaugeHistogramMeter8.2.3 åˆ©ç”¨ JMXReporter è·å–ç›‘æ§æ•°æ®8.2.4 åˆ©ç”¨ PrometheusReporter è·å–ç›‘æ§æ•°æ®8.2.5 åˆ©ç”¨ PrometheusPushGatewayReporter è·å–ç›‘æ§æ•°æ®8.2.6 åˆ©ç”¨ InfluxDBReporter è·å–ç›‘æ§æ•°æ®8.2.7 å®‰è£… InfluxDB å’Œ Grafanaå®‰è£… InfluxDBå®‰è£… Grafana8.2.8 é…ç½® Grafana å±•ç¤ºç›‘æ§æ•°æ®åŠ å…¥çŸ¥è¯†æ˜Ÿçƒå¯ä»¥çœ‹åˆ°ä¸Šé¢æ–‡ç« ï¼šhttps://t.zsxq.com/f66iAMz 8.2.9 å°ç»“ä¸åæ€æœ¬èŠ‚è®²äº†å¦‚ä½•åˆ©ç”¨ API å»è·å–ç›‘æ§æ•°æ®ï¼Œå¯¹ Metrics çš„ç±»å‹è¿›è¡Œä»‹ç»ï¼Œç„¶åè¿˜ä»‹ç»äº†æ€ä¹ˆåˆ©ç”¨ Reporter å»å°† Metrics æ•°æ®è¿›è¡Œä¸ŠæŠ¥ï¼Œå¹¶é€šè¿‡ InfluxDB + Grafana æ­å»ºäº†ä¸€å¥— Flink çš„ç›‘æ§ç³»ç»Ÿã€‚å¦å¤–ä½ è¿˜å¯ä»¥æ ¹æ®å…¬å¸çš„éœ€è¦ä½¿ç”¨å…¶ä»–çš„å­˜å‚¨æ–¹æ¡ˆæ¥å­˜å‚¨ç›‘æ§æ•°æ®ï¼ŒGrafana ä¹Ÿæ”¯æŒä¸åŒçš„æ•°æ®æºï¼Œä½ ä»¬å…¬å¸çš„ç›‘æ§ç³»ç»Ÿæ¶æ„æ˜¯æ€ä¹ˆæ ·çš„ï¼Œæ˜¯å¦å¯ä»¥ç›´æ¥æ¥å…¥è¿™å¥—ç›‘æ§ç³»ç»Ÿï¼Ÿ ä½œä¸šéƒ¨ç½²ä¸Šçº¿åçš„ç›‘æ§å°¤å…¶é‡è¦ï¼Œè™½è¯´ Flink UI è‡ªèº«æä¾›äº†ä¸å°‘çš„ç›‘æ§ä¿¡æ¯ï¼Œä½†æ˜¯ä¸ªäººè§‰å¾—è¿˜æ˜¯æ¯”è¾ƒå¼±ï¼Œè¿˜æ˜¯å¾—å»æ­å»ºä¸€å¥—å®Œæ•´çš„ç›‘æ§ç³»ç»Ÿå»ç›‘æ§ Flink ä¸­çš„ JobManagerã€TaskManager å’Œä½œä¸šã€‚æœ¬ç« ä¸­è®²è§£äº† Flink UI ä¸Šè·å–ç›‘æ§æ•°æ®çš„æ–¹å¼ï¼Œè¿˜è®²è§£äº†å¦‚ä½•åˆ©ç”¨ Flink è‡ªå¸¦çš„ Metrics Reporter å»é‡‡é›†å„ç§ç›‘æ§æ•°æ®ï¼Œä»è€Œåˆ©ç”¨æ—¶åºæ•°æ®åº“å­˜å‚¨è¿™äº›ç›‘æ§æ•°æ®ï¼Œæœ€åç”¨ Grafana è¿™ç§å¯è§†åŒ–æ¯”è¾ƒå¥½çš„å»å±•ç¤ºè¿™äº›ç›‘æ§æ•°æ®ï¼Œä»è€Œè¾¾åˆ°ä½œä¸šçœŸæ­£çš„ç›‘æ§è¿ç»´æ•ˆæœã€‚ æ•´å¥—ç›‘æ§ç³»ç»Ÿä¹Ÿå¸Œæœ›ä½ å¯ä»¥è¿ç”¨åœ¨ä½ ä»¬å…¬å¸ï¼Œå½“ç„¶ä½ ä¸ä¸€å®šéå¾—é€‰ç”¨ç›¸åŒçš„å­˜å‚¨æ—¶åºæ•°æ®åº“ï¼Œè¿™æ ·å¯ä»¥ä¸ºä½ ä»¬èŠ‚çœä¸å°‘ä½œä¸šå‡ºé—®é¢˜åçš„æ’æŸ¥æ—¶é—´ã€‚","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹â€”â€” å¦‚ä½•å®æ—¶ç›‘æ§ Flink åŠå…¶ä½œä¸šï¼Ÿ","date":"2021-08-04T16:00:00.000Z","path":"2021/08/05/flink-in-action-8.1/","text":"ç¬¬å…«ç«  â€”â€” Flink ç›‘æ§Flink ç›¸å…³çš„ç»„ä»¶å’Œä½œä¸šçš„ç¨³å®šæ€§é€šå¸¸æ˜¯æ¯”è¾ƒå…³é”®çš„ï¼Œæ‰€ä»¥å¾—éœ€è¦å¯¹å®ƒä»¬è¿›è¡Œç›‘æ§ï¼Œå¦‚æœæœ‰å¼‚å¸¸ï¼Œåˆ™éœ€è¦åŠæ—¶å‘Šè­¦é€šçŸ¥ã€‚æœ¬ç« å…ˆä¼šæ•™ä¼šæ•™ä¼šå¤§å®¶å¦‚ä½•åˆ©ç”¨ç°æœ‰ Flink UI ä¸Šé¢çš„ä¿¡æ¯å»å‘ç°å’Œæ’æŸ¥é—®é¢˜ï¼Œä¼šæŒ‡æ˜ä¸€äº›æ¯”è¾ƒé‡è¦å’Œæˆ‘ä»¬éå¸¸å…³å¿ƒçš„æŒ‡æ ‡ï¼Œé€šè¿‡è¿™äº›æŒ‡æ ‡æˆ‘ä»¬èƒ½å¤Ÿç«‹é©¬å®šä½åˆ°é—®é¢˜çš„æ ¹æœ¬åŸå› ã€‚æ¥ç€ç¬”è€…ä¼šæ•™å¤§å®¶å¦‚ä½•å»åˆ©ç”¨ç°æœ‰çš„ Metrics Reporter å»æ„å»ºä¸€ä¸ª Flink çš„ç›‘æ§ç³»ç»Ÿï¼Œå®ƒå¯ä»¥æ”¶é›†åˆ°æ‰€æœ‰ä½œä¸šçš„ç›‘æ§æŒ‡æ ‡ï¼Œå¹¶ä¼šå­˜å‚¨è¿™äº›ç›‘æ§æŒ‡æ ‡æ•°æ®ï¼Œæœ€åè¿˜ä¼šæœ‰ä¸€ä¸ªç›‘æ§å¤§ç›˜åšæ•°æ®å¯è§†åŒ–ï¼Œé€šè¿‡è¿™ä¸ªå¤§ç›˜å¯ä»¥æ–¹ä¾¿æ’æŸ¥é—®é¢˜ã€‚ 8.1 å®æ—¶ç›‘æ§ Flink åŠå…¶ä½œä¸š å½“å°† Flink JobManagerã€TaskManager éƒ½è¿è¡Œèµ·æ¥äº†ï¼Œå¹¶ä¸”ä¹Ÿéƒ¨ç½²äº†ä¸å°‘ Flink Jobï¼Œé‚£ä¹ˆå®ƒåˆ°åº•æ˜¯å¦è¿˜åœ¨è¿è¡Œã€è¿è¡Œçš„çŠ¶æ€å¦‚ä½•ã€èµ„æº TaskManager å’Œ Slot çš„ä¸ªæ•°æ˜¯å¦è¶³å¤Ÿã€Job å†…éƒ¨æ˜¯å¦å‡ºç°å¼‚å¸¸ã€è®¡ç®—é€Ÿåº¦æ˜¯å¦è·Ÿå¾—ä¸Šæ•°æ®ç”Ÿäº§çš„é€Ÿåº¦ ç­‰è¿™äº›é—®é¢˜å…¶å®å¯¹æˆ‘ä»¬æ¥è¯´æ˜¯æ¯”è¾ƒå…³æ³¨çš„ï¼Œæ‰€ä»¥å°±å¾ˆè¿«åˆ‡çš„éœ€è¦ä¸€ä¸ªç›‘æ§ç³»ç»Ÿå¸®æˆ‘ä»¬æŠŠæ•´ä¸ª Flink é›†ç¾¤çš„è¿è¡ŒçŠ¶æ€ç»™å±•ç¤ºå‡ºæ¥ã€‚é€šè¿‡ç›‘æ§ç³»ç»Ÿæˆ‘ä»¬èƒ½å¤Ÿå¾ˆå¥½çš„çŸ¥é“ Flink å†…éƒ¨çš„æ•´ä¸ªè¿è¡ŒçŠ¶æ€ï¼Œç„¶åæ‰èƒ½å¤Ÿæ ¹æ®é¡¹ç›®ç”Ÿäº§ç¯å¢ƒé‡åˆ°çš„é—®é¢˜ â€˜å¯¹ç—‡ä¸‹è¯â€™ã€‚ä¸‹é¢åˆ†åˆ«æ¥è®²ä¸‹ JobManagerã€TaskManagerã€Flink Job çš„ç›‘æ§ä»¥åŠæœ€å…³å¿ƒçš„ä¸€äº›ç›‘æ§æŒ‡æ ‡ã€‚ 8.1.1 ç›‘æ§ JobManageræˆ‘ä»¬çŸ¥é“ JobManager æ˜¯ Flink é›†ç¾¤çš„ä¸­æ§èŠ‚ç‚¹ï¼Œç±»ä¼¼äº Apache Storm çš„ Nimbus ä»¥åŠ Apache Spark çš„ Driver çš„è§’è‰²ã€‚å®ƒè´Ÿè´£ä½œä¸šçš„è°ƒåº¦ã€ä½œä¸š Jar åŒ…çš„ç®¡ç†ã€Checkpoint çš„åè°ƒå’Œå‘èµ·ã€ä¸ TaskManager ä¹‹é—´çš„å¿ƒè·³æ£€æŸ¥ç­‰å·¥ä½œã€‚å¦‚æœ JobManager å‡ºç°é—®é¢˜çš„è¯ï¼Œå°±ä¼šå¯¼è‡´ä½œä¸š UI ä¿¡æ¯æŸ¥çœ‹ä¸äº†ï¼ŒTaskManager å’Œæ‰€æœ‰è¿è¡Œçš„ä½œä¸šéƒ½ä¼šå—åˆ°ä¸€å®šçš„å½±å“ï¼Œæ‰€ä»¥è¿™ä¹Ÿæ˜¯ä¸ºå•¥åœ¨ 7.1 èŠ‚ä¸­å¼ºè°ƒ JobManager çš„é«˜å¯ç”¨é—®é¢˜ã€‚ åœ¨ Flink è‡ªå¸¦çš„ UI ä¸Š JobManager é‚£ä¸ª Tab å±•ç¤ºçš„å…¶å®å¹¶æ²¡æœ‰æ˜¾ç¤ºå…¶å¯¹åº”çš„ Metricsï¼Œé‚£ä¹ˆå¯¹äº JobManager æ¥è¯´å¸¸è§æ¯”è¾ƒå…³å¿ƒçš„ç›‘æ§æŒ‡æ ‡æœ‰å“ªäº›å‘¢ï¼Ÿ åŸºç¡€æŒ‡æ ‡å› ä¸º Flink JobManager å…¶å®ä¹Ÿæ˜¯ä¸€ä¸ª Java çš„åº”ç”¨ç¨‹åºï¼Œé‚£ä¹ˆå®ƒè‡ªç„¶ä¹Ÿä¼šæœ‰ Java åº”ç”¨ç¨‹åºçš„æŒ‡æ ‡ï¼Œæ¯”å¦‚å†…å­˜ã€CPUã€GCã€ç±»åŠ è½½ã€çº¿ç¨‹ä¿¡æ¯ç­‰ã€‚ å†…å­˜ï¼šå†…å­˜åˆåˆ†å †å†…å­˜å’Œéå †å†…å­˜ï¼Œåœ¨ Flink ä¸­è¿˜æœ‰ Direct å†…å­˜ï¼Œæ¯ç§å†…å­˜åˆæœ‰åˆå§‹å€¼ã€ä½¿ç”¨å€¼ã€æœ€å¤§å€¼ç­‰æŒ‡æ ‡ï¼Œå› ä¸ºåœ¨ JobManager ä¸­çš„å·¥ä½œå…¶å®ç›¸å½“äº TaskManager æ¥è¯´æ¯”è¾ƒå°‘ï¼Œä¹Ÿä¸å­˜å‚¨äº‹ä»¶æ•°æ®ï¼Œæ‰€ä»¥é€šå¸¸ JobManager å ç”¨çš„å†…å­˜ä¸ä¼šå¾ˆå¤šï¼Œåœ¨ Flink JobManager ä¸­è‡ªå¸¦çš„å†…å­˜ Metrics æŒ‡æ ‡æœ‰ï¼š 123456789101112jobmanager_Status_JVM_Memory_Direct_Countjobmanager_Status_JVM_Memory_Direct_MemoryUsedjobmanager_Status_JVM_Memory_Direct_TotalCapacityjobmanager_Status_JVM_Memory_Heap_Committedjobmanager_Status_JVM_Memory_Heap_Maxjobmanager_Status_JVM_Memory_Heap_Usedjobmanager_Status_JVM_Memory_Mapped_Countjobmanager_Status_JVM_Memory_Mapped_MemoryUsedjobmanager_Status_JVM_Memory_Mapped_TotalCapacityjobmanager_Status_JVM_Memory_NonHeap_Committedjobmanager_Status_JVM_Memory_NonHeap_Maxjobmanager_Status_JVM_Memory_NonHeap_Used CPUï¼šJobManager åˆ†é…çš„ CPU ä½¿ç”¨æƒ…å†µï¼Œå¦‚æœä½¿ç”¨ç±»ä¼¼ K8S ç­‰èµ„æºè°ƒåº¦ç³»ç»Ÿï¼Œåˆ™éœ€è¦å¯¹æ¯ä¸ªå®¹å™¨è¿›è¡Œè®¾ç½®èµ„æºï¼Œæ¯”å¦‚ CPU é™åˆ¶ä¸èƒ½è¶…è¿‡å¤šå°‘ï¼Œåœ¨ Flink JobManager ä¸­è‡ªå¸¦çš„ CPU æŒ‡æ ‡æœ‰ï¼š 12jobmanager_Status_JVM_CPU_Loadjobmanager_Status_JVM_CPU_Time GCï¼šGC ä¿¡æ¯å¯¹äº Java åº”ç”¨æ¥è¯´æ˜¯é¿å…ä¸äº†çš„ï¼Œæ¯ç§ GC éƒ½æœ‰æ—¶é—´å’Œæ¬¡æ•°çš„æŒ‡æ ‡å¯ä»¥ä¾›å‚è€ƒï¼Œæä¾›çš„æŒ‡æ ‡æœ‰ï¼š 1234jobmanager_Status_JVM_GarbageCollector_PS_MarkSweep_Countjobmanager_Status_JVM_GarbageCollector_PS_MarkSweep_Timejobmanager_Status_JVM_GarbageCollector_PS_Scavenge_Countjobmanager_Status_JVM_GarbageCollector_PS_Scavenge_Time Checkpoint æŒ‡æ ‡å› ä¸º JobManager è´Ÿè´£äº†ä½œä¸šçš„ Checkpoint çš„åè°ƒå’Œå‘èµ·åŠŸèƒ½ï¼Œæ‰€ä»¥ Checkpoint ç›¸å…³çš„æŒ‡æ ‡å°±æœ‰è¡¨ç¤º Checkpoint æ‰§è¡Œçš„æ—¶é—´ã€Checkpoint çš„æ—¶é—´é•¿çŸ­ã€å®Œæˆçš„ Checkpoint çš„æ¬¡æ•°ã€Checkpoint å¤±è´¥çš„æ¬¡æ•°ã€Checkpoint æ­£åœ¨æ‰§è¡Œ Checkpoint çš„ä¸ªæ•°ç­‰ï¼Œå…¶å¯¹åº”çš„æŒ‡æ ‡å¦‚ä¸‹ï¼š 123456789jobmanager_job_lastCheckpointAlignmentBufferedjobmanager_job_lastCheckpointDurationjobmanager_job_lastCheckpointExternalPathjobmanager_job_lastCheckpointRestoreTimestampjobmanager_job_lastCheckpointSizejobmanager_job_numberOfCompletedCheckpointsjobmanager_job_numberOfFailedCheckpointsjobmanager_job_numberOfInProgressCheckpointsjobmanager_job_totalNumberOfCheckpoints é‡è¦çš„æŒ‡æ ‡å¦å¤–è¿˜æœ‰æ¯”è¾ƒé‡è¦çš„æŒ‡æ ‡å°±æ˜¯ Flink UI ä¸Šä¹Ÿæä¾›çš„ï¼Œç±»ä¼¼äº Slot æ€»å…±ä¸ªæ•°ã€Slot å¯ä½¿ç”¨çš„ä¸ªæ•°ã€TaskManager çš„ä¸ªæ•°ï¼ˆé€šè¿‡æŸ¥çœ‹è¯¥å€¼å¯ä»¥çŸ¥é“æ˜¯å¦æœ‰ TaskManager å‘ç”Ÿå¼‚å¸¸é‡å¯ï¼‰ã€æ­£åœ¨è¿è¡Œçš„ä½œä¸šæ•°é‡ã€ä½œä¸šè¿è¡Œçš„æ—¶é—´å’Œå®Œæˆçš„æ—¶é—´ã€ä½œä¸šçš„é‡å¯æ¬¡æ•°ï¼Œå¯¹åº”çš„æŒ‡æ ‡å¦‚ä¸‹ï¼š 12345678jobmanager_job_uptimejobmanager_numRegisteredTaskManagersjobmanager_numRunningJobsjobmanager_taskSlotsAvailablejobmanager_taskSlotsTotaljobmanager_job_downtimejobmanager_job_fullRestartsjobmanager_job_restartingTime 8.1.2 ç›‘æ§ TaskManagerâ€¦. 12345678910111213141516171819202122232425taskmanager_Status_JVM_CPU_Loadtaskmanager_Status_JVM_CPU_Timetaskmanager_Status_JVM_ClassLoader_ClassesLoadedtaskmanager_Status_JVM_ClassLoader_ClassesUnloadedtaskmanager_Status_JVM_GarbageCollector_G1_Old_Generation_Counttaskmanager_Status_JVM_GarbageCollector_G1_Old_Generation_Timetaskmanager_Status_JVM_GarbageCollector_G1_Young_Generation_Counttaskmanager_Status_JVM_GarbageCollector_G1_Young_Generation_Timetaskmanager_Status_JVM_Memory_Direct_Counttaskmanager_Status_JVM_Memory_Direct_MemoryUsedtaskmanager_Status_JVM_Memory_Direct_TotalCapacitytaskmanager_Status_JVM_Memory_Heap_Committedtaskmanager_Status_JVM_Memory_Heap_Maxtaskmanager_Status_JVM_Memory_Heap_Usedtaskmanager_Status_JVM_Memory_Mapped_Counttaskmanager_Status_JVM_Memory_Mapped_MemoryUsedtaskmanager_Status_JVM_Memory_Mapped_TotalCapacitytaskmanager_Status_JVM_Memory_NonHeap_Committedtaskmanager_Status_JVM_Memory_NonHeap_Maxtaskmanager_Status_JVM_Memory_NonHeap_Usedtaskmanager_Status_JVM_Threads_Counttaskmanager_Status_Network_AvailableMemorySegmentstaskmanager_Status_Network_TotalMemorySegmentstaskmanager_Status_Shuffle_Netty_AvailableMemorySegmentstaskmanager_Status_Shuffle_Netty_TotalMemorySegments 8.1.3 ç›‘æ§ Flink ä½œä¸šâ€¦ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647taskmanager_job_task_Shuffle_Netty_Input_Buffers_outPoolUsagetaskmanager_job_task_Shuffle_Netty_Input_Buffers_outputQueueLengthtaskmanager_job_task_Shuffle_Netty_Output_Buffers_inPoolUsagetaskmanager_job_task_Shuffle_Netty_Output_Buffers_inputExclusiveBuffersUsagetaskmanager_job_task_Shuffle_Netty_Output_Buffers_inputFloatingBuffersUsagetaskmanager_job_task_Shuffle_Netty_Output_Buffers_inputQueueLengthtaskmanager_job_task_Shuffle_Netty_Output_numBuffersInLocaltaskmanager_job_task_Shuffle_Netty_Output_numBuffersInLocalPerSecondtaskmanager_job_task_Shuffle_Netty_Output_numBuffersInRemotetaskmanager_job_task_Shuffle_Netty_Output_numBuffersInRemotePerSecondtaskmanager_job_task_Shuffle_Netty_Output_numBytesInLocaltaskmanager_job_task_Shuffle_Netty_Output_numBytesInLocalPerSecondtaskmanager_job_task_Shuffle_Netty_Output_numBytesInRemotetaskmanager_job_task_Shuffle_Netty_Output_numBytesInRemotePerSecondtaskmanager_job_task_buffers_inPoolUsagetaskmanager_job_task_buffers_inputExclusiveBuffersUsagetaskmanager_job_task_buffers_inputFloatingBuffersUsagetaskmanager_job_task_buffers_inputQueueLengthtaskmanager_job_task_buffers_outPoolUsagetaskmanager_job_task_buffers_outputQueueLengthtaskmanager_job_task_checkpointAlignmentTimetaskmanager_job_task_currentInputWatermarktaskmanager_job_task_numBuffersInLocaltaskmanager_job_task_numBuffersInLocalPerSecondtaskmanager_job_task_numBuffersInRemotetaskmanager_job_task_numBuffersInRemotePerSecondtaskmanager_job_task_numBuffersOuttaskmanager_job_task_numBuffersOutPerSecondtaskmanager_job_task_numBytesIntaskmanager_job_task_numBytesInLocaltaskmanager_job_task_numBytesInLocalPerSecondtaskmanager_job_task_numBytesInPerSecondtaskmanager_job_task_numBytesInRemotetaskmanager_job_task_numBytesInRemotePerSecondtaskmanager_job_task_numBytesOuttaskmanager_job_task_numBytesOutPerSecondtaskmanager_job_task_numRecordsIntaskmanager_job_task_numRecordsInPerSecondtaskmanager_job_task_numRecordsOuttaskmanager_job_task_numRecordsOutPerSecondtaskmanager_job_task_operator_currentInputWatermarktaskmanager_job_task_operator_currentOutputWatermarktaskmanager_job_task_operator_numLateRecordsDroppedtaskmanager_job_task_operator_numRecordsIntaskmanager_job_task_operator_numRecordsInPerSecondtaskmanager_job_task_operator_numRecordsOuttaskmanager_job_task_operator_numRecordsOutPerSecond 8.1.4 æœ€å…³å¿ƒçš„æ€§èƒ½æŒ‡æ ‡JobManagerTaskManagerFlink Job8.1.5 å°ç»“ä¸åæ€åŠ å…¥çŸ¥è¯†æ˜Ÿçƒå¯ä»¥çœ‹åˆ°ä¸Šé¢æ–‡ç« ï¼šhttps://t.zsxq.com/f66iAMz","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹â€”â€” Flink ä½œä¸šå¦‚ä½•åœ¨ Standaloneã€YARNã€Mesosã€K8S ä¸Šéƒ¨ç½²è¿è¡Œï¼Ÿ","date":"2021-08-03T16:00:00.000Z","path":"2021/08/04/flink-in-action-7.2/","text":"7.2 Flink ä½œä¸šå¦‚ä½•åœ¨ Standaloneã€YARNã€Mesosã€K8S ä¸Šéƒ¨ç½²è¿è¡Œï¼Ÿå‰é¢ç« èŠ‚å·²ç»æœ‰å¾ˆå¤šå­¦ä¹ æ¡ˆåˆ—å¸¦å¤§å®¶ä½¿ç”¨ Flinkï¼Œä¸ä»…æœ‰è®²å°† Flink åº”ç”¨ç¨‹åºåœ¨ IDEA ä¸­è¿è¡Œï¼Œä¹Ÿæœ‰è®²å°† Flink Job ç¼–è¯‘æ‰“åŒ…ä¸Šä¼ åˆ° Flink UI ä¸Šè¿è¡Œï¼Œåœ¨è¿™ UI èƒŒåå¯èƒ½æ˜¯é€šè¿‡ Standaloneã€YARNã€Mesosã€Kubernetes ç­‰è¿è¡Œå¯åŠ¨çš„ Flinkã€‚é‚£ä¹ˆè¿™èŠ‚å°±ç³»ç»Ÿè®²ä¸‹å¦‚ä½•éƒ¨ç½²å’Œè¿è¡Œæˆ‘ä»¬çš„ Flink Jobï¼Œå¤§å®¶å¯ä»¥æ ¹æ®è‡ªå·±å…¬å¸çš„åœºæ™¯è¿›è¡Œé€‰æ‹©ä½¿ç”¨å“ªç§æ–¹å¼è¿›è¡Œéƒ¨ç½² Flink ä½œä¸šï¼ 7.2.1 Standaloneç¬¬ä¸€ç§æ–¹å¼å°±æ˜¯ Standalone æ¨¡å¼ï¼Œè¿™ç§æ¨¡å¼ç¬”è€…åœ¨å‰é¢ 2.2 èŠ‚é‡Œé¢æ¼”ç¤ºçš„å°±æ˜¯è¿™ç§ï¼Œæˆ‘ä»¬é€šè¿‡æ‰§è¡Œå‘½ä»¤ï¼š./bin/start-cluster.sh å¯åŠ¨ä¸€ä¸ª Flink Standalone é›†ç¾¤ã€‚ 1234zhisheng@zhisheng /usr/local/flink-1.9.0 ./bin/start-cluster.shStarting cluster.Starting standalonesession daemon on host zhisheng.Starting taskexecutor daemon on host zhisheng. é»˜è®¤çš„è¯æ˜¯å¯åŠ¨ä¸€ä¸ª JobManager å’Œä¸€ä¸ª TaskManagerï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ jps æŸ¥çœ‹è¿›ç¨‹æœ‰ï¼š 12365425 Jps51572 TaskManagerRunner51142 StandaloneSessionClusterEntrypoint å…¶ä¸­ä¸Šé¢çš„ TaskManagerRunner ä»£è¡¨çš„æ˜¯ TaskManager è¿›ç¨‹ï¼ŒStandaloneSessionClusterEntrypoint ä»£è¡¨çš„æ˜¯ JobManager è¿›ç¨‹ã€‚ä¸Šé¢è¿è¡Œäº§ç”Ÿçš„åªæœ‰ä¸€ä¸ª JobManager å’Œä¸€ä¸ª TaskManagerï¼Œå¦‚æœæ˜¯ç”Ÿäº§ç¯å¢ƒçš„è¯ï¼Œè¿™æ ·çš„é…ç½®è‚¯å®šæ˜¯ä¸å¤Ÿè¿è¡Œå¤šä¸ª Job çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¯¥å¦‚ä½•åœ¨ç”Ÿäº§ç¯å¢ƒä¸­é…ç½® standalone æ¨¡å¼çš„é›†ç¾¤å‘¢ï¼Ÿæˆ‘ä»¬å°±éœ€è¦ä¿®æ”¹ Flink å®‰è£…ç›®å½•ä¸‹é¢çš„ conf æ–‡ä»¶å¤¹é‡Œé¢é…ç½®ï¼š 123flink-conf.yamlmastersslaves å°† slaves ä¸­å†æ·»åŠ ä¸€ä¸ª localhostï¼Œè¿™æ ·å°±å¯ä»¥å¯åŠ¨ä¸¤ä¸ª TaskManager äº†ã€‚æ¥ç€å¯åŠ¨è„šæœ¬ start-cluster.shï¼Œå¯åŠ¨æ—¥å¿—æ˜¾ç¤ºå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ å¯ä»¥çœ‹è§æœ‰ä¸¤ä¸ª TaskManager å¯åŠ¨äº†ï¼Œå†çœ‹ä¸‹ UI æ˜¾ç¤ºçš„ä¹Ÿæ˜¯æœ‰ä¸¤ä¸ª TaskManagerï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ é‚£ä¹ˆå¦‚æœè¿˜æƒ³è¦æ·»åŠ ä¸€ä¸ª JobManager æˆ–è€… TaskManager æ€ä¹ˆåŠï¼Ÿæ€»ä¸èƒ½å†æ¬¡é‡å¯ä¿®æ”¹é…ç½®æ–‡ä»¶åç„¶åå†é‡å¯å§ï¼è¿™é‡Œä½ å¯ä»¥è¿™æ ·æ“ä½œã€‚ å¢åŠ ä¸€ä¸ª JobManagerï¼š 1bin/jobmanager.sh ((start|start-foreground) [host] [webui-port])|stop|stop-all ä½†æ˜¯æ³¨æ„ Standalone ä¸‹ä¸€å°æœºå™¨æœ€å¤šåªèƒ½è¿è¡Œä¸€ä¸ª JobManagerã€‚ å¢åŠ ä¸€ä¸ª TaskManagerï¼š 1bin/taskmanager.sh start|start-foreground|stop|stop-all æ¯”å¦‚æˆ‘æ‰§è¡Œäº† ./bin/taskmanager.sh start å‘½ä»¤åï¼Œè¿è¡Œç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ Standalone æ¨¡å¼ä¸‹å¯ä»¥å…ˆå¯¹ Flink Job é€šè¿‡ mvn clean package ç¼–è¯‘æ‰“åŒ…ï¼Œå¾—åˆ° Jar åŒ…åï¼Œå¯ä»¥åœ¨ UI ä¸Šç›´æ¥ä¸Šä¼  Jar åŒ…ï¼Œç„¶åç‚¹å‡» Submit å°±å¯ä»¥è¿è¡Œäº†ã€‚ 7.2.2 YARN7.2.3 MesosSession é›†ç¾¤Per Job é›†ç¾¤7.3.4 Kubernetes7.2.5 å°ç»“ä¸åæ€åŠ å…¥çŸ¥è¯†æ˜Ÿçƒå¯ä»¥çœ‹åˆ°ä¸Šé¢æ–‡ç« ï¼šhttps://t.zsxq.com/f66iAMz æœ¬ç« è®²è§£äº† Flink ä¸­æ‰€æœ‰çš„é…ç½®æ–‡ä»¶ï¼Œæ¯ä¸ªé…ç½®æ–‡ä»¶ä¸­çš„é…ç½®æœ‰å•¥ä½œç”¨ï¼Œå¹¶ä¸”å¦‚æœåœ¨ä¸åŒç¯å¢ƒä¸‹é…ç½® JobManager çš„é«˜å¯ç”¨ï¼Œå¦å¤–è¿˜ä»‹ç»äº† Flink çš„éƒ¨ç½²é—®é¢˜ï¼Œå› ä¸º Flink æœ¬èº«æ˜¯æ”¯æŒåœ¨ä¸åŒçš„ç¯å¢ƒä¸‹éƒ¨ç½²çš„ï¼Œæ¯”å¦‚ Standaloneã€K8Sã€YARNã€Mesos ç­‰ï¼Œå…¶ä¸­åœ¨è°ƒåº¦å¹³å°ä¸Šåˆæœ‰ Session æ¨¡å¼å’Œ Per Job æ¨¡å¼ï¼Œæ¯ç§æ¨¡å¼éƒ½æœ‰è‡ªå·±çš„ç‰¹ç‚¹ï¼Œæ‰€ä»¥ä½ å¯èƒ½éœ€è¦æ ¹æ®å…¬å¸çš„æƒ…å†µæ¥åšä¸€å®šçš„é€‰å‹ï¼Œæ¯ç§çš„éƒ¨ç½²ä¹Ÿå¯èƒ½ä¼šæœ‰ç‚¹ä¸ä¸€æ ·ï¼Œé‡åˆ°é—®é¢˜çš„åŒ–è¿˜å¾—æ ¹æ®ç‰¹æ®Šæƒ…å†µè¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œå¸Œæœ›ä½ å¯ä»¥åœ¨å…¬å¸çµæ´»çš„å¤„ç†è¿™ç§é—®é¢˜ã€‚","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹â€”â€” Flink é…ç½®è¯¦è§£åŠå¦‚ä½•é…ç½®é«˜å¯ç”¨ï¼Ÿ","date":"2021-08-02T16:00:00.000Z","path":"2021/08/03/flink-in-action-7.1/","text":"ç¬¬ä¸ƒç«  â€”â€” Flink ä½œä¸šç¯å¢ƒéƒ¨ç½²åœ¨ç¬¬ä¸€ç« ä¸­ä»‹ç»è¿‡ Flink æ˜¯å¯ä»¥ä»¥å¤šç§æ–¹å¼éƒ¨ç½²çš„ï¼Œæ¯”å¦‚ Standaloneã€YARNã€Mesosã€K8Sã€‚æœ¬ç« å°†å…ˆå¯¹ Flink ä¸­çš„æ‰€æœ‰é…ç½®æ–‡ä»¶åšä¸€ä¸ªè¯¦ç»†çš„è®²è§£ï¼Œæ¥ä¸‹æ¥å°†è®²è§£ JobManager é«˜å¯ç”¨éƒ¨ç½²ç›¸å…³çš„é…ç½®ï¼Œæœ€åä¼šåˆ†åˆ«è®²è§£å¦‚ä½•åœ¨ä¸åŒçš„å¹³å°ä¸Šéƒ¨ç½²è¿è¡Œ Flink ä½œä¸šã€‚è™½ç„¶åœ¨ä½ ä»¬å…¬å¸å¯èƒ½åªä¼šç”¨åˆ°å…¶ä¸­çš„ä¸€ç§ï¼Œä½†æ˜¯ä»ç„¶å»ºè®®ä½ å°†æ¯ç§æ–¹å¼éƒ½ç†Ÿæ‚‰ä¸€ä¸‹ã€‚ 7.1 Flink é…ç½®è¯¦è§£åŠå¦‚ä½•é…ç½®é«˜å¯ç”¨ï¼Ÿ åœ¨è®²è§£å¦‚ä½•éƒ¨ç½² Flink ä½œä¸šï¼ˆåœ¨ 7.2 èŠ‚ä¸­ä¼šè®²ï¼‰ä¹‹å‰ï¼Œå…ˆæ¥è¯¦ç»†çš„çœ‹ä¸€ä¸‹ Flink ä¸­çš„æ‰€æœ‰é…ç½®æ–‡ä»¶ä»¥åŠæ–‡ä»¶ä¸­çš„å„ç§é…ç½®ä»£è¡¨çš„å†…å®¹ï¼Œè¿™æ ·å¯¹äºåé¢éƒ¨ç½²å’Œè°ƒä¼˜ Flink ä½œä¸šæœ‰ä¸€å®šçš„å¸®åŠ©ã€‚ 7.1.1 Flink é…ç½®è¯¦è§£å…ˆæ¥çœ‹ä¸‹ Flink é…ç½®æ–‡ä»¶ç›®å½•ä¸­æœ€é‡è¦çš„é…ç½®æ–‡ä»¶ flink-conf.yaml çš„é…ç½®ã€‚ flink-conf.yamlåŸºç¡€é…ç½®å¦‚ä¸‹æ‰€ç¤ºï¼š 1234567891011121314151617181920# jobManager çš„IPåœ°å€jobmanager.rpc.address: localhost# JobManager çš„ç«¯å£å·jobmanager.rpc.port: 6123# JobManager JVM heap å†…å­˜å¤§å°jobmanager.heap.size: 1024m# TaskManager JVM heap å†…å­˜å¤§å°taskmanager.heap.size: 1024m# æ¯ä¸ª TaskManager æä¾›çš„ä»»åŠ¡ slots æ•°é‡å¤§å°taskmanager.numberOfTaskSlots: 1# ç¨‹åºé»˜è®¤å¹¶è¡Œè®¡ç®—çš„ä¸ªæ•°parallelism.default: 1# æ–‡ä»¶ç³»ç»Ÿæ¥æº# fs.default-scheme é«˜å¯ç”¨æ€§ç›¸å…³çš„é…ç½®å¦‚ä¸‹æ‰€ç¤ºï¼š 1234567891011# å¯ä»¥é€‰æ‹© &apos;NONE&apos; æˆ–è€… &apos;zookeeper&apos;.# high-availability: zookeeper# æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ï¼Œè®© Flink åœ¨é«˜å¯ç”¨æ€§è®¾ç½®ä¸­æŒä¹…ä¿å­˜å…ƒæ•°æ®# high-availability.storageDir: hdfs:///flink/ha/# zookeeper é›†ç¾¤ä¸­ä»²è£è€…çš„æœºå™¨ ip å’Œ port ç«¯å£å·# high-availability.zookeeper.quorum: localhost:2181# é»˜è®¤æ˜¯ openï¼Œå¦‚æœ zookeeper security å¯ç”¨äº†è¯¥å€¼ä¼šæ›´æ”¹æˆ creator# high-availability.zookeeper.client.acl: open å®¹é”™å’Œ Checkpoint ç›¸å…³çš„é…ç½®å¦‚ä¸‹æ‰€ç¤ºï¼š 1234567891011# ç”¨äºå­˜å‚¨å’Œæ£€æŸ¥ç‚¹çŠ¶æ€# state.backend: filesystem# å­˜å‚¨æ£€æŸ¥ç‚¹çš„æ•°æ®æ–‡ä»¶å’Œå…ƒæ•°æ®çš„é»˜è®¤ç›®å½•# state.checkpoints.dir: hdfs://namenode-host:port/flink-checkpoints# savepoints çš„é»˜è®¤ç›®æ ‡ç›®å½•(å¯é€‰)# state.savepoints.dir: hdfs://namenode-host:port/flink-checkpoints# ç”¨äºå¯ç”¨/ç¦ç”¨å¢é‡ checkpoints çš„æ ‡å¿—# state.backend.incremental: false Web å‰ç«¯ç›¸å…³çš„é…ç½®å¦‚ä¸‹æ‰€ç¤ºï¼š 12345678# åŸºäº Web çš„è¿è¡Œæ—¶ç›‘è§†å™¨ä¾¦å¬çš„åœ°å€.#jobmanager.web.address: 0.0.0.0# Web çš„è¿è¡Œæ—¶ç›‘è§†å™¨ç«¯å£rest.port: 8081# æ˜¯å¦ä»åŸºäº Web çš„ jobmanager å¯ç”¨ä½œä¸šæäº¤# jobmanager.web.submit.enable: false é«˜çº§é…ç½®å¦‚ä¸‹æ‰€ç¤ºï¼š 123456789101112# io.tmp.dirs: /tmp# æ˜¯å¦åº”åœ¨ TaskManager å¯åŠ¨æ—¶é¢„å…ˆåˆ†é… TaskManager ç®¡ç†çš„å†…å­˜# taskmanager.memory.preallocate: false# ç±»åŠ è½½è§£æé¡ºåºï¼Œæ˜¯å…ˆæ£€æŸ¥ç”¨æˆ·ä»£ç  jarï¼ˆâ€œchild-firstâ€ï¼‰è¿˜æ˜¯åº”ç”¨ç¨‹åºç±»è·¯å¾„ï¼ˆâ€œparent-firstâ€ï¼‰ã€‚ é»˜è®¤è®¾ç½®æŒ‡ç¤ºé¦–å…ˆä»ç”¨æˆ·ä»£ç  jar åŠ è½½ç±»# classloader.resolve-order: child-first# ç”¨äºç½‘ç»œç¼“å†²åŒºçš„ JVM å†…å­˜çš„åˆ†æ•°ã€‚ è¿™å†³å®šäº† TaskManager å¯ä»¥åŒæ—¶æ‹¥æœ‰å¤šå°‘æµæ•°æ®äº¤æ¢é€šé“ä»¥åŠé€šé“ç¼“å†²çš„ç¨‹åº¦ã€‚ å¦‚æœä½œä¸šè¢«æ‹’ç»æˆ–è€…æ‚¨æ”¶åˆ°ç³»ç»Ÿæ²¡æœ‰è¶³å¤Ÿç¼“å†²åŒºçš„è­¦å‘Šï¼Œè¯·å¢åŠ æ­¤å€¼æˆ–ä¸‹é¢çš„æœ€å°/æœ€å¤§å€¼ã€‚ å¦è¯·æ³¨æ„ï¼Œâ€œtaskmanager.network.memory.minâ€å’Œâ€œtaskmanager.network.memory.maxâ€å¯èƒ½ä¼šè¦†ç›–æ­¤åˆ†æ•°# taskmanager.network.memory.fraction: 0.1# taskmanager.network.memory.min: 67108864# taskmanager.network.memory.max: 1073741824 Flink é›†ç¾¤å®‰å…¨é…ç½®å¦‚ä¸‹æ‰€ç¤ºï¼š 1234567891011# æŒ‡ç¤ºæ˜¯å¦ä» Kerberos ticket ç¼“å­˜ä¸­è¯»å–# security.kerberos.login.use-ticket-cache: true# åŒ…å«ç”¨æˆ·å‡­æ®çš„ Kerberos å¯†é’¥è¡¨æ–‡ä»¶çš„ç»å¯¹è·¯å¾„# security.kerberos.login.keytab: /path/to/kerberos/keytab# ä¸ keytab å…³è”çš„ Kerberos ä¸»ä½“åç§°# security.kerberos.login.principal: flink-user# ä»¥é€—å·åˆ†éš”çš„ç™»å½•ä¸Šä¸‹æ–‡åˆ—è¡¨ï¼Œç”¨äºæä¾› Kerberos å‡­æ®ï¼ˆä¾‹å¦‚ï¼Œ`Clientï¼ŒKafkaClient`ä½¿ç”¨å‡­è¯è¿›è¡Œ ZooKeeper èº«ä»½éªŒè¯å’Œ Kafka èº«ä»½éªŒè¯ï¼‰# security.kerberos.login.contexts: Client,KafkaClient Zookeeper å®‰å…¨é…ç½®å¦‚ä¸‹æ‰€ç¤ºï¼š 12345# è¦†ç›–ä»¥ä¸‹é…ç½®ä»¥æä¾›è‡ªå®šä¹‰ ZK æœåŠ¡åç§°# zookeeper.sasl.service-name: zookeeper# è¯¥é…ç½®å¿…é¡»åŒ¹é… &quot;security.kerberos.login.contexts&quot; ä¸­çš„åˆ—è¡¨ï¼ˆå«æœ‰ä¸€ä¸ªï¼‰# zookeeper.sasl.login-context-name: Client HistoryServer ç›¸å…³çš„é…ç½®å¦‚ä¸‹æ‰€ç¤ºï¼š 12345678910111213141516# ä½ å¯ä»¥é€šè¿‡ bin/historyserver.sh (start|stop) å‘½ä»¤å¯åŠ¨å’Œå…³é—­ HistoryServer# å°†å·²å®Œæˆçš„ä½œä¸šä¸Šä¼ åˆ°çš„ç›®å½•# jobmanager.archive.fs.dir: hdfs:///completed-jobs/# åŸºäº Web çš„ HistoryServer çš„åœ°å€# historyserver.web.address: 0.0.0.0# åŸºäº Web çš„ HistoryServer çš„ç«¯å£å·# historyserver.web.port: 8082# ä»¥é€—å·åˆ†éš”çš„ç›®å½•åˆ—è¡¨ï¼Œç”¨äºç›‘è§†å·²å®Œæˆçš„ä½œä¸š# historyserver.archive.fs.dir: hdfs:///completed-jobs/# åˆ·æ–°å—ç›‘æ§ç›®å½•çš„æ—¶é—´é—´éš”ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰# historyserver.archive.fs.refresh-interval: 10000 mastersmasters é…ç½®æ–‡ä»¶ä¸­ä»¥ host:port æ„æˆå°±è¡Œï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 1localhost:8081 slavesslaves æ–‡ä»¶é‡Œé¢æ˜¯æ¯ä¸ª worker èŠ‚ç‚¹çš„ IP/Hostnameï¼Œæ¯ä¸€ä¸ª worker ç»“ç‚¹ä¹‹åéƒ½ä¼šè¿è¡Œä¸€ä¸ª TaskManagerï¼Œä¸€ä¸ªä¸€è¡Œï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚ 1localhost 7.1.2 Log çš„é…ç½®åœ¨ Flink çš„æ—¥å¿—é…ç½®æ–‡ä»¶ï¼ˆlogback.xml æˆ– log4j.propertiesï¼‰ä¸­æœ‰é…ç½®æ—¥å¿—å­˜å‚¨çš„åœ°æ–¹ï¼Œlogback.xml é…ç½®æ—¥å¿—å­˜å‚¨çš„è·¯å¾„æ˜¯ï¼š 1234567&lt;appender name=\"file\" class=\"ch.qos.logback.core.FileAppender\"&gt; &lt;file&gt;$&#123;log.file&#125;&lt;/file&gt; &lt;append&gt;false&lt;/append&gt; &lt;encoder&gt; &lt;pattern&gt;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;60&#125; %X&#123;sourceThread&#125; - %msg%n&lt;/pattern&gt; &lt;/encoder&gt;&lt;/appender&gt; log4j.properties å’Œ log4j-cli.properties çš„é…ç½®æ—¥å¿—å­˜å‚¨çš„è·¯å¾„æ˜¯ï¼š 1log4j.appender.file.file=$&#123;log.file&#125; ä»ä¸Šé¢ä¸¤ä¸ªé…ç½®å¯ä»¥çœ‹åˆ°æ—¥å¿—çš„è·¯å¾„éƒ½æ˜¯ç”± log.file å˜é‡æ§åˆ¶çš„ï¼Œå¦‚æœç³»ç»Ÿå˜é‡æ²¡æœ‰é…ç½®çš„è¯ï¼Œåˆ™ä¼šä½¿ç”¨ binï¼flink è„šæœ¬é‡Œé…ç½®çš„å€¼ã€‚ 12log=$FLINK_LOG_DIR/flink-$FLINK_IDENT_STRING-client-$HOSTNAME.loglog_setting=(-Dlog.file=&quot;$log&quot; -Dlog4j.configuration=file:&quot;$FLINK_CONF_DIR&quot;/log4j-cli.properties -Dlogback.configurationFile=file:&quot;$FLINK_CONF_DIR&quot;/logback.xml) ä»ä¸Šé¢å¯ä»¥çœ‹åˆ° log é‡Œé…ç½®çš„ FLINK_LOG_DIR å˜é‡æ˜¯åœ¨ bin ç›®å½•ä¸‹çš„ config.sh é‡Œåˆå§‹åŒ–çš„ã€‚ 123456DEFAULT_FLINK_LOG_DIR=$FLINK_HOME_DIR_MANGLED/logKEY_ENV_LOG_DIR=\"env.log.dir\"if [ -z \"$&#123;FLINK_LOG_DIR&#125;\" ]; then FLINK_LOG_DIR=$(readFromConfig $&#123;KEY_ENV_LOG_DIR&#125; \"$&#123;DEFAULT_FLINK_LOG_DIR&#125;\" \"$&#123;YAML_CONF&#125;\")fi ä»ä¸Šé¢å¯ä»¥çŸ¥é“æ—¥å¿—é»˜è®¤å°±æ˜¯åœ¨ Flink çš„ log ç›®å½•ä¸‹ï¼Œä½ å¯ä»¥é€šè¿‡åœ¨ flink-conf.yaml é…ç½®æ–‡ä»¶ä¸­é…ç½® env.log.dir å‚æ•°æ¥æ›´æ”¹ä¿å­˜æ—¥å¿—çš„ç›®å½•ã€‚å¦å¤–é€šè¿‡æºç å¯ä»¥å‘ç°ï¼Œå¦‚æœæ‰¾ä¸åˆ° log.file ç¯å¢ƒå˜é‡ï¼Œåˆ™ä¼šå»æ‰¾ web.log.path çš„é…ç½®ï¼Œä½†æ˜¯è¯¥é…ç½®åœ¨ Standalone ä¸‹æ˜¯ä¸èµ·ä½œç”¨çš„ï¼Œæ—¥å¿—ä¾æ—§æ˜¯ä¼šåœ¨ log ç›®å½•ï¼Œåœ¨ YARN ä¸‹æ˜¯ä¼šèµ·ä½œç”¨çš„ã€‚ 123456789101112131415161718192021222324252627282930313233public static LogFileLocation find(Configuration config) &#123; final String logEnv = \"log.file\"; String logFilePath = System.getProperty(logEnv); if (logFilePath == null) &#123; LOG.warn(\"Log file environment variable '&#123;&#125;' is not set.\", logEnv); logFilePath = config.getString(WebOptions.LOG_PATH); //è¯¥å€¼ä¸º web.log.path &#125; // not configured, cannot serve log files if (logFilePath == null || logFilePath.length() &lt; 4) &#123; LOG.warn(\"JobManager log files are unavailable in the web dashboard. \" + \"Log file location not found in environment variable '&#123;&#125;' or configuration key '&#123;&#125;'.\", logEnv, WebOptions.LOG_PATH); return new LogFileLocation(null, null); &#125; String outFilePath = logFilePath.substring(0, logFilePath.length() - 3).concat(\"out\"); LOG.info(\"Determined location of main cluster component log file: &#123;&#125;\", logFilePath); LOG.info(\"Determined location of main cluster component stdout file: &#123;&#125;\", outFilePath); return new LogFileLocation(resolveFileLocation(logFilePath), resolveFileLocation(outFilePath));&#125;/** * The log file location (may be in /log for standalone but under log directory when using YARN). */public static final ConfigOption&lt;String&gt; LOG_PATH = key(\"web.log.path\") .noDefaultValue() .withDeprecatedKeys(\"jobmanager.web.log.path\") .withDescription(\"Path to the log file (may be in /log for standalone but under log directory when using YARN).\"); å¦å¤–å¯èƒ½ä¼šåœ¨æœ¬åœ° IDE ä¸­è¿è¡Œä½œä¸šå‡ºä¸æ¥æ—¥å¿—çš„æƒ…å†µï¼Œè¿™æ—¶è¯·æ£€æŸ¥æ˜¯å¦æœ‰æ·»åŠ æ—¥å¿—çš„ä¾èµ–ã€‚ 12345678910&lt;dependency&gt; &lt;groupId&gt;org.slf4j&lt;/groupId&gt; &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt; &lt;version&gt;1.7.25&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.slf4j&lt;/groupId&gt; &lt;artifactId&gt;slf4j-simple&lt;/artifactId&gt; &lt;version&gt;1.7.25&lt;/version&gt;&lt;/dependency&gt; 7.1.3 å¦‚ä½•é…ç½® JobManager é«˜å¯ç”¨ï¼ŸJobManager åè°ƒæ¯ä¸ª Flink ä½œä¸šçš„éƒ¨ç½²ï¼Œå®ƒè´Ÿè´£è°ƒåº¦å’Œèµ„æºç®¡ç†ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ª Flink é›†ç¾¤åªæœ‰ä¸€ä¸ª JobManager å®ä¾‹ï¼Œè¿™æ ·å°±å¯èƒ½ä¼šäº§ç”Ÿå•ç‚¹æ•…éšœï¼Œå¦‚æœ JobManager å´©æºƒï¼Œåˆ™æ— æ³•æäº¤æ–°ä½œä¸šä¸”è¿è¡Œä¸­çš„ä½œä¸šä¹Ÿä¼šå¤±è´¥ã€‚å¦‚æœä¿è¯ JobManager çš„é«˜å¯ç”¨ï¼Œåˆ™å¯ä»¥é¿å…è¿™ä¸ªé—®é¢˜ã€‚ä¸‹é¢åˆ†åˆ«ä¸‹å¦‚ä½•æ­å»º Standalone é›†ç¾¤å’Œ YARN é›†ç¾¤é«˜å¯ç”¨çš„ JobManagerã€‚ æ­å»º Standalone é›†ç¾¤é«˜å¯ç”¨ JobManagerStandalone é›†ç¾¤çš„ JobManager é«˜å¯ç”¨æ€§çš„æ¦‚å¿µæ˜¯ï¼šä»»ä½•æ—¶å€™åªæœ‰ä¸€ä¸ªä¸» JobManager å’Œå¤šä¸ªå¤‡ JobManagerï¼Œä»¥ä¾¿åœ¨ä¸»èŠ‚ç‚¹å¤±è´¥æ—¶æœ‰æ–°çš„ JobManager æ¥ç®¡é›†ç¾¤ã€‚è¿™æ ·å°±ä¿è¯äº†æ²¡æœ‰å•ç‚¹æ•…éšœï¼Œä¸€æ—¦å¤‡ JobManager æ¥ç®¡é›†ç¾¤ï¼Œä½œä¸šå°±å¯ä»¥ä¾æ—§æ­£å¸¸è¿è¡Œã€‚ä¸»å¤‡ JobManager å®ä¾‹ä¹‹é—´æ²¡æœ‰æ˜ç¡®çš„åŒºåˆ«ï¼Œæ¯ä¸ª JobManager éƒ½å¯ä»¥å……å½“ä¸»å¤‡èŠ‚ç‚¹ã€‚ä¾‹å¦‚ï¼Œè¯·è€ƒè™‘ä»¥ä¸‹ä¸‰ä¸ª JobManager å®ä¾‹çš„è®¾ç½®ã€‚ å¦‚ä½•é…ç½® è¦å¯ç”¨ JobManager é«˜å¯ç”¨æ€§åŠŸèƒ½ï¼Œé¦–å…ˆå¿…é¡»åœ¨é…ç½®æ–‡ä»¶ flink-conf.yaml ä¸­å°†é«˜å¯ç”¨æ€§æ¨¡å¼è®¾ç½®ä¸º ZooKeeperï¼Œé…ç½® ZooKeeper quorumï¼Œå°†æ‰€æœ‰ JobManager ä¸»æœºåŠå…¶ Web UI ç«¯å£å†™å…¥é…ç½®æ–‡ä»¶ã€‚æ¯ä¸ª ip:port éƒ½æ˜¯ä¸€ä¸ª ZooKeeper æœåŠ¡å™¨çš„ ip åŠå…¶ç«¯å£ï¼ŒFlink å¯ä»¥é€šè¿‡æŒ‡å®šçš„åœ°å€å’Œç«¯å£è®¿é—® ZooKeeperã€‚å¦å¤–å°±æ˜¯é«˜å¯ç”¨å­˜å‚¨ç›®å½•ï¼ŒJobManager å…ƒæ•°æ®ä¿å­˜åœ¨ high-availability.storageDir æŒ‡å®šçš„æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œåœ¨ ZooKeeper ä¸­ä»…ä¿å­˜äº†æŒ‡å‘æ­¤çŠ¶æ€çš„æŒ‡é’ˆ, æ¨èè¿™ä¸ªç›®å½•æ˜¯ HDFSã€S3ã€Cephã€NFS ç­‰ï¼Œè¯¥æ–‡ä»¶ç³»ç»Ÿä¸­ä¿å­˜äº† JobManager æ¢å¤çŠ¶æ€éœ€è¦çš„æ‰€æœ‰å…ƒæ•°æ®ã€‚ 123high-availability: zookeeperhigh-availability.zookeeper.quorum: ip1:2181 [,...],ip2:2181high-availability.storageDir: hdfs:///flink/ha/ Flink åˆ©ç”¨ ZooKeeper åœ¨æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„ JobManager å®ä¾‹ä¹‹é—´è¿›è¡Œåˆ†å¸ƒå¼åè°ƒã€‚ZooKeeper æ˜¯ç‹¬ç«‹äº Flink çš„æœåŠ¡ï¼Œé€šè¿‡ leader é€‰ä¸¾å’Œè½»é‡çº§ä¸€è‡´æ€§çŠ¶æ€å­˜å‚¨æä¾›é«˜å¯é çš„åˆ†å¸ƒå¼åè°ƒæœåŠ¡ã€‚Flink åŒ…å«ç”¨äº Bootstrap ZooKeeper å®‰è£…çš„è„šæœ¬ã€‚å®ƒåœ¨æˆ‘ä»¬çš„ Flink å®‰è£…è·¯å¾„ä¸‹é¢ /conf/zoo.cfg ã€‚ æ­å»º YARN é›†ç¾¤é«˜å¯ç”¨ JobManager7.1.4 å°ç»“ä¸åæ€åŠ å…¥çŸ¥è¯†æ˜Ÿçƒå¯ä»¥çœ‹åˆ°ä¸Šé¢æ–‡ç« ï¼šhttps://t.zsxq.com/f66iAMz","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹â€”â€” Flink æ‰©å±•åº“â€”â€”Gelly","date":"2021-08-01T16:00:00.000Z","path":"2021/08/02/flink-in-action-6.5/","text":"6.5 Flink æ‰©å±•åº“â€”â€”Gellyåœ¨ 1.9 ç‰ˆæœ¬ä¸­è¿˜å‰©æœ€åä¸€ä¸ªæ‰©å±•åº“å°±æ˜¯ Gellyï¼Œæœ¬èŠ‚å°†å¸¦ä½ äº†è§£ä¸€ä¸‹ Gelly çš„åŠŸèƒ½ä»¥åŠå¦‚ä½•ä½¿ç”¨ã€‚ 6.5.1 Gelly ç®€ä»‹Gelly æ˜¯ Flink çš„å›¾ API åº“ï¼Œå®ƒåŒ…å«äº†ä¸€ç»„æ—¨åœ¨ç®€åŒ– Flink ä¸­å›¾å½¢åˆ†æåº”ç”¨ç¨‹åºå¼€å‘çš„æ–¹æ³•å’Œå®ç”¨ç¨‹åºã€‚åœ¨ Gelly ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ç±»ä¼¼äºæ‰¹å¤„ç† API æä¾›çš„é«˜çº§å‡½æ•°æ¥è½¬æ¢å’Œä¿®æ”¹å›¾ã€‚Gelly æä¾›äº†åˆ›å»ºã€è½¬æ¢å’Œä¿®æ”¹å›¾çš„æ–¹æ³•ä»¥åŠå›¾ç®—æ³•åº“ã€‚ 6.5.2 ä½¿ç”¨ Gellyå› ä¸º Gelly æ˜¯ Flink é¡¹ç›®ä¸­åº“çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒæœ¬èº«ä¸åœ¨ Flink çš„äºŒè¿›åˆ¶åŒ…ä¸­ï¼Œæ‰€ä»¥è¿è¡Œ Gelly é¡¹ç›®ï¼ˆJava åº”ç”¨ç¨‹åºï¼‰æ˜¯éœ€è¦å°† opt/flink-gelly_2.11-1.9.0.jar ç§»åŠ¨åˆ° lib ç›®å½•ä¸­ï¼Œå¦‚æœæ˜¯ Scala åº”ç”¨ç¨‹åºåˆ™éœ€è¦å°† opt/flink-gelly-scala_2.11-1.9.0.jar ç§»åŠ¨åˆ° lib ä¸­ï¼Œæ¥ç€è¿è¡Œä¸‹é¢çš„å‘½ä»¤å°±å¯ä»¥è¿è¡Œä¸€ä¸ª flink-gelly-examples é¡¹ç›®ã€‚ 1234./bin/flink run examples/gelly/flink-gelly-examples_2.11-1.9.0.jar \\ --algorithm GraphMetrics --order directed \\ --input RMatGraph --type integer --scale 20 --simplify directed \\ --output print æ¥ä¸‹æ¥å¯ä»¥åœ¨ UI ä¸Šçœ‹åˆ°è¿è¡Œçš„ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å¦‚æœæ˜¯è‡ªå·±åˆ›å»ºçš„ Gelly Java åº”ç”¨ç¨‹åºï¼Œåˆ™éœ€è¦æ·»åŠ å¦‚ä¸‹ä¾èµ–ï¼š 12345&lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-gelly_$&#123;scala.binary.version&#125;&lt;/artifactId&gt; &lt;version&gt;$&#123;flink.version&#125;&lt;/version&gt;&lt;/dependency&gt; å¦‚æœæ˜¯ Gelly Scala åº”ç”¨ç¨‹åºï¼Œæ·»åŠ ä¸‹é¢çš„ä¾èµ–ï¼š 12345&lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-gelly-scala_$&#123;scala.binary.version&#125;&lt;/artifactId&gt; &lt;version&gt;$&#123;flink.version&#125;&lt;/version&gt;&lt;/dependency&gt; 6.5.3 Gelly APIå¼•å…¥å¥½ä¾èµ–åï¼Œæ¥ç€å°†ä»‹ç»ä¸€ä¸‹ Gelly è¯¥å¦‚ä½•ä½¿ç”¨ã€‚ Graph ä»‹ç»åœ¨ Gelly ä¸­ï¼Œä¸€ä¸ªå›¾ï¼ˆGraphï¼‰ç”±é¡¶ç‚¹çš„æ•°æ®é›†ï¼ˆDataSetï¼‰å’Œè¾¹çš„æ•°æ®é›†ï¼ˆDataSetï¼‰ç»„æˆã€‚å›¾ä¸­çš„é¡¶ç‚¹ç”± Vertex ç±»å‹æ¥è¡¨ç¤ºï¼Œä¸€ä¸ª Vertex ç”±å”¯ä¸€çš„ ID å’Œä¸€ä¸ªå€¼æ¥è¡¨ç¤ºã€‚å…¶ä¸­ Vertex çš„ ID å¿…é¡»æ˜¯å…¨å±€å”¯ä¸€çš„å€¼ï¼Œä¸”å®ç°äº† Comparable æ¥å£ã€‚å¦‚æœèŠ‚ç‚¹ä¸éœ€è¦ç”±ä»»ä½•å€¼ï¼Œåˆ™è¯¥å€¼ç±»å‹å¯ä»¥å£°æ˜æˆ NullValue ç±»å‹ã€‚ 12345//åˆ›å»ºä¸€ä¸ª Vertex&lt;Longï¼ŒString&gt;Vertex&lt;Long, String&gt; v = new Vertex&lt;Long, String&gt;(1L, \"foo\");//åˆ›å»ºä¸€ä¸ª Vertex&lt;Longï¼ŒNullValue&gt;Vertex&lt;Long, NullValue&gt; v = new Vertex&lt;Long, NullValue&gt;(1L, NullValue.getInstance()); Graph ä¸­çš„è¾¹ç”± Edge ç±»å‹æ¥è¡¨ç¤ºï¼Œä¸€ä¸ª Edge é€šå¸¸ç”±æºé¡¶ç‚¹çš„ IDï¼Œç›®æ ‡é¡¶ç‚¹çš„ ID ä»¥åŠä¸€ä¸ªå¯é€‰çš„å€¼æ¥è¡¨ç¤ºã€‚å…¶ä¸­æºé¡¶ç‚¹å’Œç›®æ ‡é¡¶ç‚¹çš„ç±»å‹å¿…é¡»ä¸ Vertex çš„ ID ç±»å‹ç›¸åŒã€‚åŒæ ·çš„ï¼Œå¦‚æœè¾¹ä¸éœ€è¦ç”±ä»»ä½•å€¼ï¼Œåˆ™è¯¥å€¼ç±»å‹å¯ä»¥å£°æ˜æˆ NullValue ç±»å‹ã€‚ 1234Edge&lt;Long, Double&gt; e = new Edge&lt;Long, Double&gt;(1L, 2L, 0.5);//åè½¬æ­¤ edge çš„æºå’Œç›®æ ‡Edge&lt;Long, Double&gt; reversed = e.reverse();Double weight = e.getValue(); // weight = 0.5 åœ¨ Gelly ä¸­ï¼Œä¸€ä¸ª Edge æ€»æ˜¯ä»æºé¡¶ç‚¹æŒ‡å‘ç›®æ ‡é¡¶ç‚¹ã€‚å¦‚æœå›¾ä¸­æ¯æ¡è¾¹éƒ½èƒ½åŒ¹é…ä¸€ä¸ªä»ç›®æ ‡é¡¶ç‚¹åˆ°æºé¡¶ç‚¹çš„ Edgeï¼Œé‚£ä¹ˆè¿™ä¸ªå›¾å¯èƒ½æ˜¯ä¸ªæ— å‘å›¾ã€‚åŒæ ·åœ°ï¼Œæ— å‘å›¾å¯ä»¥ç”¨è¿™ä¸ªæ–¹å¼æ¥è¡¨ç¤ºã€‚ åˆ›å»º Graphå¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼åˆ›å»ºä¸€ä¸ª Graphï¼š ä»ä¸€ä¸ª Edge æ•°æ®é›†åˆå’Œä¸€ä¸ª Vertex æ•°æ®é›†åˆä¸­åˆ›å»ºå›¾ã€‚ 123456ExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment();DataSet&lt;Vertex&lt;String, Long&gt;&gt; vertices = ...DataSet&lt;Edge&lt;String, Double&gt;&gt; edges = ...Graph&lt;String, Long, Double&gt; graph = Graph.fromDataSet(vertices, edges, env); ä»ä¸€ä¸ªè¡¨ç¤ºè¾¹çš„ Tuple2 æ•°æ®é›†åˆä¸­åˆ›å»ºå›¾ã€‚Gelly ä¼šå°†æ¯ä¸ª Tuple2 è½¬æ¢æˆä¸€ä¸ª Edgeï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ è¡¨ç¤ºæºé¡¶ç‚¹çš„ IDï¼Œç¬¬äºŒä¸ªå…ƒç´ è¡¨ç¤ºç›®æ ‡é¡¶ç‚¹çš„ IDï¼Œå›¾ä¸­çš„é¡¶ç‚¹å’Œè¾¹çš„ value å€¼å‡è¢«è®¾ç½®ä¸º NullValueã€‚ 12345ExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment();DataSet&lt;Tuple2&lt;String, String&gt;&gt; edges = ...Graph&lt;String, NullValue, NullValue&gt; graph = Graph.fromTuple2DataSet(edges, env); ä»ä¸€ä¸ª Tuple3 æ•°æ®é›†å’Œä¸€ä¸ªå¯é€‰çš„ Tuple2 æ•°æ®é›†ä¸­ç”Ÿæˆå›¾ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒGelly ä¼šå°†æ¯ä¸ª Tuple3 è½¬æ¢æˆ Edgeï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ åŸŸæ˜¯æºé¡¶ç‚¹ IDï¼Œç¬¬äºŒä¸ªåŸŸæ˜¯ç›®æ ‡é¡¶ç‚¹ IDï¼Œç¬¬ä¸‰ä¸ªåŸŸæ˜¯è¾¹çš„å€¼ã€‚åŒæ ·çš„ï¼Œæ¯ä¸ª Tuple2 ä¼šè½¬æ¢æˆä¸€ä¸ªé¡¶ç‚¹ Vertexï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªåŸŸæ˜¯é¡¶ç‚¹çš„ IDï¼Œç¬¬äºŒä¸ªåŸŸæ˜¯é¡¶ç‚¹çš„ valueã€‚ 1234567ExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment();DataSet&lt;Tuple2&lt;String, Long&gt;&gt; vertexTuples = env.readCsvFile(\"path/to/vertex/input\").types(String.class, Long.class);DataSet&lt;Tuple3&lt;String, String, Double&gt;&gt; edgeTuples = env.readCsvFile(\"path/to/edge/input\").types(String.class, String.class, Double.class);Graph&lt;String, Long, Double&gt; graph = Graph.fromTupleDataSet(vertexTuples, edgeTuples, env); ä»ä¸€ä¸ªè¡¨ç¤ºè¾¹æ•°æ®çš„CSVæ–‡ä»¶å’Œä¸€ä¸ªå¯é€‰çš„è¡¨ç¤ºèŠ‚ç‚¹çš„CSVæ–‡ä»¶ä¸­ç”Ÿæˆå›¾ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒGellyä¼šå°†è¡¨ç¤ºè¾¹çš„CSVæ–‡ä»¶ä¸­çš„æ¯ä¸€è¡Œè½¬æ¢æˆä¸€ä¸ªEdgeï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªåŸŸè¡¨ç¤ºæºé¡¶ç‚¹IDï¼Œç¬¬äºŒä¸ªåŸŸè¡¨ç¤ºç›®æ ‡é¡¶ç‚¹IDï¼Œç¬¬ä¸‰ä¸ªåŸŸè¡¨ç¤ºè¾¹çš„å€¼ã€‚åŒæ ·çš„ï¼Œè¡¨ç¤ºèŠ‚ç‚¹çš„CSVä¸­çš„æ¯ä¸€è¡Œéƒ½è¢«è½¬æ¢æˆä¸€ä¸ªVertexï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªåŸŸè¡¨ç¤ºé¡¶ç‚¹çš„IDï¼Œç¬¬äºŒä¸ªåŸŸè¡¨ç¤ºé¡¶ç‚¹çš„å€¼ã€‚ä¸ºäº†é€šè¿‡GraphCsvReaderç”Ÿæˆå›¾ï¼Œéœ€è¦æŒ‡å®šæ¯ä¸ªåŸŸçš„ç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨ typesã€edgeTypesã€vertexTypesã€keyType ä¸­çš„æ–¹æ³•ã€‚ 123456//åˆ›å»ºä¸€ä¸ªå…·æœ‰å­—ç¬¦ä¸² Vertex idã€Long Vertex å’ŒåŒè¾¹ç¼˜çš„å›¾Graph&lt;String, Long, Double&gt; graph = Graph.fromCsvReader(\"path/to/vertex/input\", \"path/to/edge/input\", env) .types(String.class, Long.class, Double.class);//åˆ›å»ºä¸€ä¸ªæ—¢æ²¡æœ‰é¡¶ç‚¹å€¼ä¹Ÿæ²¡æœ‰è¾¹å€¼çš„å›¾Graph&lt;Long, NullValue, NullValue&gt; simpleGraph = Graph.fromCsvReader(\"path/to/edge/input\", env).keyType(Long.class); ä»ä¸€ä¸ªè¾¹çš„é›†åˆå’Œä¸€ä¸ªå¯é€‰çš„é¡¶ç‚¹çš„é›†åˆä¸­ç”Ÿæˆå›¾ã€‚å¦‚æœåœ¨å›¾åˆ›å»ºçš„æ—¶å€™é¡¶ç‚¹çš„é›†åˆæ²¡æœ‰ä¼ å…¥ï¼ŒGelly ä¼šä¾æ®æ•°æ®çš„è¾¹æ•°æ®é›†åˆè‡ªåŠ¨åœ°ç”Ÿæˆä¸€ä¸ª Vertex é›†åˆã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œåˆ›å»ºçš„èŠ‚ç‚¹æ˜¯æ²¡æœ‰å€¼çš„ã€‚æˆ–è€…ä¹Ÿå¯ä»¥åƒä¸‹é¢ä¸€æ ·ï¼Œåœ¨åˆ›å»ºå›¾çš„æ—¶å€™æä¾›ä¸€ä¸ª MapFunction æ–¹æ³•æ¥åˆå§‹åŒ–èŠ‚ç‚¹çš„å€¼ã€‚ 12345678910111213List&lt;Vertex&lt;Long, Long&gt;&gt; vertexList = new ArrayList...List&lt;Edge&lt;Long, String&gt;&gt; edgeList = new ArrayList...Graph&lt;Long, Long, String&gt; graph = Graph.fromCollection(vertexList, edgeList, env);//å°†é¡¶ç‚¹å€¼åˆå§‹åŒ–ä¸ºé¡¶ç‚¹IDGraph&lt;Long, Long, String&gt; graph = Graph.fromCollection(edgeList, new MapFunction&lt;Long, Long&gt;() &#123; public Long map(Long value) &#123; return value; &#125; &#125;, env); Graph å±æ€§Gelly æä¾›äº†ä¸‹åˆ—æ–¹æ³•æ¥æŸ¥è¯¢å›¾çš„å±æ€§å’ŒæŒ‡æ ‡ï¼š 123456789101112DataSet&lt;Vertex&lt;K, VV&gt;&gt; getVertices()//è·å–è¾¹ç¼˜æ•°æ®é›†DataSet&lt;Edge&lt;K, EV&gt;&gt; getEdges()//è·å–é¡¶ç‚¹çš„ id æ•°æ®é›†DataSet&lt;K&gt; getVertexIds()DataSet&lt;Tuple2&lt;K, K&gt;&gt; getEdgeIds()DataSet&lt;Tuple2&lt;K, LongValue&gt;&gt; inDegrees()DataSet&lt;Tuple2&lt;K, LongValue&gt;&gt; outDegrees()DataSet&lt;Tuple2&lt;K, LongValue&gt;&gt; getDegrees()long numberOfVertices()long numberOfEdges()DataSet&lt;Triplet&lt;K, VV, EV&gt;&gt; getTriplets() Graph è½¬æ¢Graph è½¬æ¢æ–¹å¼æœ‰ä¸‹é¢å‡ ç§æ–¹å¼ï¼š Mapï¼šGelly æä¾›äº†ä¸“é—¨çš„ç”¨äºè½¬æ¢é¡¶ç‚¹å€¼å’Œè¾¹å€¼çš„æ–¹æ³•ã€‚mapVertices å’Œ mapEdges ä¼šè¿”å›ä¸€ä¸ªæ–°å›¾ï¼Œå›¾ä¸­çš„æ¯ä¸ªé¡¶ç‚¹å’Œè¾¹çš„ ID ä¸ä¼šæ”¹å˜ï¼Œä½†æ˜¯é¡¶ç‚¹å’Œè¾¹çš„å€¼ä¼šæ ¹æ®ç”¨æˆ·è‡ªå®šä¹‰çš„æ˜ å°„æ–¹æ³•è¿›è¡Œä¿®æ”¹ã€‚è¿™äº›æ˜ å°„æ–¹æ³•åŒæ—¶ä¹Ÿå¯ä»¥ä¿®æ”¹é¡¶ç‚¹å’Œè¾¹çš„å€¼çš„ç±»å‹ã€‚ Translateï¼šGelly è¿˜æä¾›äº†ä¸“é—¨ç”¨äºæ ¹æ®ç”¨æˆ·å®šä¹‰çš„å‡½æ•°è½¬æ¢é¡¶ç‚¹å’Œè¾¹çš„ ID å’Œå€¼çš„å€¼åŠç±»å‹çš„æ–¹æ³•ï¼ˆtranslateGraphIDs/translateVertexValues/translateEdgeValuesï¼‰ï¼Œæ˜¯Map åŠŸèƒ½çš„å‡çº§ç‰ˆï¼Œå› ä¸º Map æ“ä½œä¸æ”¯æŒä¿®è®¢é¡¶ç‚¹å’Œè¾¹çš„ IDã€‚ Filterï¼šGelly æ”¯æŒåœ¨å›¾ä¸­çš„é¡¶ç‚¹ä¸Šæˆ–è¾¹ä¸Šæ‰§è¡Œä¸€ä¸ªç”¨æˆ·æŒ‡å®šçš„ filter è½¬æ¢ã€‚filterOnEdges ä¼šæ ¹æ®æä¾›çš„åœ¨è¾¹ä¸Šçš„æ–­è¨€åœ¨åŸå›¾çš„åŸºç¡€ä¸Šç”Ÿæˆä¸€ä¸ªæ–°çš„å­å›¾ï¼Œæ³¨æ„ï¼Œé¡¶ç‚¹çš„æ•°æ®ä¸ä¼šè¢«ä¿®æ”¹ã€‚åŒæ ·çš„ filterOnVertices åœ¨åŸå›¾çš„é¡¶ç‚¹ä¸Šè¿›è¡Œ filter è½¬æ¢ï¼Œä¸æ»¡è¶³æ–­è¨€æ¡ä»¶çš„æºèŠ‚ç‚¹æˆ–ç›®æ ‡èŠ‚ç‚¹ä¼šåœ¨æ–°çš„å­å›¾ä¸­ç§»é™¤ã€‚è¯¥å­å›¾æ–¹æ³•æ”¯æŒåŒæ—¶å¯¹é¡¶ç‚¹å’Œè¾¹åº”ç”¨ filter å‡½æ•°ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ Reverseï¼šGellyä¸­å¾—reverse()æ–¹æ³•ç”¨äºåœ¨åŸå›¾çš„åŸºç¡€ä¸Šï¼Œç”Ÿæˆä¸€ä¸ªæ‰€æœ‰è¾¹æ–¹å‘ä¸åŸå›¾ç›¸åçš„æ–°å›¾ã€‚ Undirectedï¼šåœ¨å‰é¢çš„å†…å®¹ä¸­ï¼Œæˆ‘ä»¬æåˆ°è¿‡ï¼ŒGellyä¸­çš„å›¾é€šå¸¸éƒ½æ˜¯æœ‰å‘çš„ï¼Œè€Œæ— å‘å›¾å¯ä»¥é€šè¿‡å¯¹æ‰€æœ‰è¾¹æ·»åŠ åå‘çš„è¾¹æ¥å®ç°ï¼Œå‡ºäºè¿™ä¸ªç›®çš„ï¼ŒGellyæä¾›äº†getUndirected()æ–¹æ³•ï¼Œç”¨äºè·å–åŸå›¾çš„æ— å‘å›¾ã€‚ Unionï¼šGellyçš„union()æ“ä½œç”¨äºè”åˆå½“å‰å›¾å’ŒæŒ‡å®šçš„è¾“å…¥å›¾ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªæ–°å›¾ï¼Œåœ¨è¾“å‡ºçš„æ–°å›¾ä¸­ï¼Œç›¸åŒçš„èŠ‚ç‚¹åªä¿ç•™ä¸€ä»½ï¼Œä½†æ˜¯é‡å¤çš„è¾¹ä¼šä¿ç•™ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š Differenceï¼šGellyæä¾›äº†difference()æ–¹æ³•ç”¨äºå‘ç°å½“å‰å›¾ä¸æŒ‡å®šçš„è¾“å…¥å›¾ä¹‹é—´çš„å·®å¼‚ã€‚ Intersectï¼šGellyæä¾›äº†intersect()æ–¹æ³•ç”¨äºå‘ç°ä¸¤ä¸ªå›¾ä¸­å…±åŒå­˜åœ¨çš„è¾¹ï¼Œå¹¶å°†ç›¸åŒçš„è¾¹ä»¥æ–°å›¾çš„æ–¹å¼è¿”å›ã€‚ç›¸åŒçš„è¾¹æŒ‡çš„æ˜¯å…·æœ‰ç›¸åŒçš„æºé¡¶ç‚¹ï¼Œç›¸åŒçš„ç›®æ ‡é¡¶ç‚¹å’Œç›¸åŒçš„è¾¹å€¼ã€‚è¿”å›çš„æ–°å›¾ä¸­ï¼Œæ‰€æœ‰çš„èŠ‚ç‚¹æ²¡æœ‰ä»»ä½•å€¼ï¼Œå¦‚æœéœ€è¦èŠ‚ç‚¹å€¼ï¼Œå¯ä»¥ä½¿ç”¨joinWithVertices()æ–¹æ³•å»ä»»ä½•ä¸€ä¸ªè¾“å…¥å›¾ä¸­æ£€ç´¢ã€‚ Graph å˜åŒ–Gelly å†…ç½®ä¸‹åˆ—æ–¹æ³•ä»¥æ”¯æŒå¯¹ä¸€ä¸ªå›¾è¿›è¡ŒèŠ‚ç‚¹å’Œè¾¹çš„å¢åŠ /ç§»é™¤æ“ä½œï¼š 12345678Graph&lt;K, VV, EV&gt; addVertex(final Vertex&lt;K, VV&gt; vertex)Graph&lt;K, VV, EV&gt; addVertices(List&lt;Vertex&lt;K, VV&gt;&gt; verticesToAdd)Graph&lt;K, VV, EV&gt; addEdge(Vertex&lt;K, VV&gt; source, Vertex&lt;K, VV&gt; target, EV edgeValue)Graph&lt;K, VV, EV&gt; addEdges(List&lt;Edge&lt;K, EV&gt;&gt; newEdges)Graph&lt;K, VV, EV&gt; removeVertex(Vertex&lt;K, VV&gt; vertex)Graph&lt;K, VV, EV&gt; removeVertices(List&lt;Vertex&lt;K, VV&gt;&gt; verticesToBeRemoved)Graph&lt;K, VV, EV&gt; removeEdge(Edge&lt;K, EV&gt; edge)Graph&lt;K, VV, EV&gt; removeEdges(List&lt;Edge&lt;K, EV&gt;&gt; edgesToBeRemoved) Neighborhood MethodsGraph éªŒè¯6.5.4 å°ç»“ä¸åæ€åŠ å…¥çŸ¥è¯†æ˜Ÿçƒå¯ä»¥çœ‹åˆ°ä¸Šé¢æ–‡ç« ï¼šhttps://t.zsxq.com/nMR7ufq æœ¬ç« æ‰€è®²çš„å†…å®¹å±äº Flink çš„æ‰©å±•åº“ï¼ŒåŒ…å«äº† CEP å¤æ‚äº‹ä»¶å¤„ç†ã€State Processor APIã€Machine Learning å’Œ Gellyï¼Œå„ç§éƒ½æœ‰è®²è§£ä¸€äº›æ ·ä¾‹ï¼Œä½†æ˜¯æ²¡æœ‰è¿‡å¤šæ·±å…¥çš„è®²ï¼Œä½†è¿˜æ˜¯å¸Œæœ›ä½ å¯ä»¥åœ¨ä¹¦æœ¬å¤–è‡ªå·±å»æ‰©å……è¿™äº›å†…å®¹çš„çŸ¥è¯†ç‚¹ã€‚","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹â€”â€” Flink æ‰©å±•åº“â€”â€”Machine Learning","date":"2021-07-31T16:00:00.000Z","path":"2021/08/01/flink-in-action-6.4/","text":"6.4 Flink æ‰©å±•åº“â€”â€”Machine Learningéšç€äººå·¥æ™ºèƒ½çš„ç«çƒ­ï¼Œæœºå™¨å­¦ä¹ è¿™é—¨æŠ€æœ¯ä¹Ÿå˜å¾—å¼‚å¸¸é‡è¦ï¼ŒFlink ä½œä¸ºä¸€ä¸ªæ•°æ®å¤„ç†çš„å¼•æ“ï¼Œè™½ç„¶ç›®å‰åœ¨è¯¥æ–¹é¢è¿˜è¾ƒå¼±ï¼Œä½†æ˜¯åœ¨ Flink Forward Asia 2019 åŒ—äº¬ç«™åï¼Œé˜¿é‡Œå¼€æºäº† Alink å¹³å°çš„æ ¸å¿ƒä»£ç ï¼Œå¹¶ä¸Šä¼ äº†ä¸€ç³»åˆ—çš„ç®—æ³•åº“ï¼Œè¯¥é¡¹ç›®æ˜¯åŸºäº Flink çš„é€šç”¨ç®—æ³•å¹³å°ï¼Œå¼€å‘è€…å’Œæ•°æ®åˆ†æå¸ˆå¯ä»¥åˆ©ç”¨ Alink æä¾›çš„ä¸€ç³»åˆ—ç®—æ³•æ¥æ„å»ºè½¯ä»¶åŠŸèƒ½ï¼Œä¾‹å¦‚ç»Ÿè®¡åˆ†æã€æœºå™¨å­¦ä¹ ã€å®æ—¶é¢„æµ‹ã€ä¸ªæ€§åŒ–æ¨èå’Œå¼‚å¸¸æ£€æµ‹ã€‚ç›¸ä¿¡æœªæ¥ Flink çš„æœºå™¨å­¦ä¹ åº“å°†ä¼šåº”ç”¨åˆ°æ›´å¤šçš„åœºæ™¯å»ï¼Œæœ¬èŠ‚å°†å¸¦ä½ äº†è§£ä¸€ä¸‹ Flink ä¸­çš„æœºå™¨å­¦ä¹ åº“ã€‚ 6.4.1 Flink-ML ç®€ä»‹ML æ˜¯ Machine Learning çš„ç®€ç§°ï¼ŒFlink-ML æ˜¯ Flink çš„æœºå™¨å­¦ä¹ ç±»åº“ã€‚åœ¨ Flink 1.9 ä¹‹å‰è¯¥ç±»åº“æ˜¯å­˜åœ¨ flink-libraries æ¨¡å—ä¸‹çš„ï¼Œä½†æ˜¯åœ¨ Flink 1.9 ç‰ˆæœ¬ä¸­ï¼Œä¸ºäº†æ”¯æŒ FLIP-39 ï¼Œæ‰€ä»¥è¯¥ç±»åº“è¢«ç§»é™¤äº†ã€‚ å»ºç«‹ FLIP-39 çš„ç›®çš„ä¸»è¦æ˜¯å¢å¼º Flink-ML çš„å¯ä¼¸ç¼©æ€§å’Œæ˜“ç”¨æ€§ã€‚é€šå¸¸ä½¿ç”¨æœºå™¨å­¦ä¹ çš„æœ‰ä¸¤ç±»äººï¼Œä¸€ç±»æ˜¯æœºå™¨å­¦ä¹ ç®—æ³•åº“çš„å¼€å‘è€…ï¼Œä»–ä»¬éœ€è¦ä¸€å¥—æ ‡å‡†çš„ API æ¥å®ç°ç®—æ³•ï¼Œæ¯ä¸ªæœºå™¨å­¦ä¹ ç®—æ³•ä¼šåœ¨è¿™äº› API çš„åŸºç¡€ä¸Šå®ç°ï¼›å¦ä¸€ç±»ç”¨æˆ·æ˜¯ç›´æ¥åˆ©ç”¨è¿™äº›ç°æœ‰çš„æœºå™¨å­¦ä¹ ç®—æ³•åº“å»è®­ç»ƒæ•°æ®æ¨¡å‹ï¼Œæ•´ä¸ªè®­ç»ƒæ˜¯è¦é€šè¿‡å¾ˆå¤šè½¬æ¢æˆ–è€…ç®—æ³•æ‰èƒ½å®Œæˆçš„ï¼Œæ‰€ä»¥å¦‚æœèƒ½å¤Ÿæä¾› ML Pipelineï¼Œé‚£ä¹ˆå¯¹äºåä¸€ç±»ç”¨æˆ·æ¥è¯´ç»å¯¹æ˜¯ä¸€ç§ç¦éŸ³ã€‚è™½ç„¶åœ¨ 1.9 ä¸­ç§»é™¤äº†ä¹‹å‰çš„ Flink-ML æ¨¡å—ï¼Œä½†æ˜¯åœ¨ Flink é¡¹ç›®ä¸‹å‡ºç°äº†ä¸€ä¸ª flink-ml-parent çš„æ¨¡å—ï¼Œè¯¥æ¨¡å—æœ‰ä¸¤ä¸ªå­æ¨¡å— flink-ml-api å’Œ flink-ml-libã€‚ flink-ml-api æ¨¡å—å¢åŠ äº† ML Pipeline å’Œ MLLib çš„æ¥å£ï¼Œå®ƒçš„ç±»ç»“æ„å›¾å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ ä¸»è¦æ¥å£å¦‚ä¸‹æ‰€ç¤ºï¼š Transformer: Transformer æ˜¯ä¸€ç§å¯ä»¥å°†ä¸€ä¸ªè¡¨è½¬æ¢æˆå¦ä¸€ä¸ªè¡¨çš„ç®—æ³• Model: Model æ˜¯ä¸€ç§ç‰¹åˆ«çš„ Transformerï¼Œå®ƒç»§æ‰¿è‡ª Transformerã€‚å®ƒé€šå¸¸æ˜¯ç”± Estimator ç”Ÿæˆï¼ŒModel ç”¨äºæ¨æ–­ï¼Œè¾“å…¥ä¸€ä¸ªæ•°æ®è¡¨ä¼šç”Ÿæˆç»“æœè¡¨ã€‚ Estimator: Estimator æ˜¯ä¸€ä¸ªå¯ä»¥æ ¹æ®ä¸€ä¸ªæ•°æ®è¡¨ç”Ÿæˆä¸€ä¸ªæ¨¡å‹çš„ç®—æ³•ã€‚ Pipeline: Pipeline æè¿°çš„æ˜¯æœºå™¨å­¦ä¹ çš„å·¥ä½œæµï¼Œå®ƒå°†å¾ˆå¤š Transformer å’Œ Estimator è¿æ¥åœ¨ä¸€èµ·æˆä¸€ä¸ªå·¥ä½œæµã€‚ PipelineStage: PipelineStage æ˜¯ Pipeline çš„åŸºç¡€èŠ‚ç‚¹ï¼ŒTransformer å’Œ Estimator ä¸¤ä¸ªéƒ½ç»§æ‰¿è‡ª PipelineStage æ¥å£ã€‚ Params: Params æ˜¯ä¸€ä¸ªå‚æ•°å®¹å™¨ã€‚ WithParams: WithParams æœ‰ä¸€ä¸ªä¿å­˜å‚æ•°çš„ Params å®¹å™¨ã€‚é€šå¸¸ä¼šä½¿ç”¨åœ¨ PipelineStage é‡Œé¢ï¼Œå› ä¸ºå‡ ä¹æ‰€æœ‰çš„ç®—æ³•éƒ½éœ€è¦å‚æ•°ã€‚ Flink-ML çš„ pipeline æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š flink-ml-lib æ¨¡å—åŒ…æ‹¬äº† DenseMatrixã€DenseVectorã€SparseVector ç­‰ç±»çš„åŸºæœ¬æ“ä½œã€‚è¿™ä¸¤ä¸ªæ¨¡å—æ˜¯ Flink-ML çš„åŸºç¡€æ¨¡å—ï¼Œç›¸ä¿¡ç¤¾åŒºåœ¨åé¢çš„ç¨³å®šç‰ˆæœ¬ä¸€å®šä¼šå¸¦æ¥æ›´åŠ å®Œå–„çš„ Flink-ML åº“ã€‚ 6.4.2 ä½¿ç”¨ Flink-MLè™½ç„¶åœ¨ Flink 1.9 ä¸­å·²ç»ç§»é™¤äº† Flink-ML æ¨¡å—ï¼Œä½†æ˜¯åœ¨ä¹‹å‰çš„ç‰ˆæœ¬è¿˜æ˜¯æ”¯æŒçš„ï¼Œå¦‚æœä½ ä»¬å…¬å¸ä½¿ç”¨çš„æ˜¯ä½äº 1.9 çš„ç‰ˆæœ¬ï¼Œé‚£ä¹ˆè¿˜æ˜¯å¯ä»¥ä½¿ç”¨çš„ï¼Œåœ¨ä½¿ç”¨ä¹‹å‰å¼•å…¥ä¾èµ–ï¼ˆå‡è®¾ä½¿ç”¨çš„æ˜¯ Flink 1.8 ç‰ˆæœ¬ï¼‰ï¼š 12345&lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-ml_2.11&lt;/artifactId&gt; &lt;version&gt;1.8.0&lt;/version&gt;&lt;/dependency&gt; å¦å¤–å¦‚æœæ˜¯è¦è¿è¡Œçš„è¯è¿˜æ˜¯è¦å°† opt ç›®å½•ä¸‹çš„ flink-ml_2.11-1.8.0.jar ç§»åˆ° lib ç›®å½•ä¸‹ã€‚ä¸‹é¢æ¼”ç¤ºä¸‹å¦‚ä½•è®­ç»ƒå¤šå…ƒçº¿æ€§å›å½’æ¨¡å‹ï¼š 12345678910111213141516171819//å¸¦æ ‡ç­¾çš„ç‰¹å¾å‘é‡val trainingData: DataSet[LabeledVector] = ...val testingData: DataSet[Vector] = ...val dataSet: DataSet[LabeledVector] = ...//ä½¿ç”¨ Splitter å°†æ•°æ®é›†æ‹†åˆ†æˆè®­ç»ƒæ•°æ®å’Œæµ‹è¯•æ•°æ®val trainTestData: DataSet[TrainTestDataSet] = Splitter.trainTestSplit(dataSet)val trainingData: DataSet[LabeledVector] = trainTestData.trainingval testingData: DataSet[Vector] = trainTestData.testing.map(lv =&gt; lv.vector)val mlr = MultipleLinearRegression() .setStepsize(1.0) .setIterations(100) .setConvergenceThreshold(0.001)mlr.fit(trainingData)//å·²ç»å½¢æˆçš„æ¨¡å‹å¯ä»¥ç”¨æ¥é¢„æµ‹æ•°æ®äº†val predictions: DataSet[LabeledVector] = mlr.predict(testingData) 6.4.3 ä½¿ç”¨ Flink-ML Pipeline6.4.4 Alink ä»‹ç»6.4.5 å°ç»“ä¸åæ€åŠ å…¥çŸ¥è¯†æ˜Ÿçƒå¯ä»¥çœ‹åˆ°ä¸Šé¢æ–‡ç« ï¼šhttps://t.zsxq.com/nMR7ufq","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹â€”â€” Flink æ‰©å±•åº“â€”â€”State Processor API","date":"2021-07-29T16:00:00.000Z","path":"2021/07/30/flink-in-action-6.3/","text":"6.3 Flink æ‰©å±•åº“â€”â€”State Processor APIState Processor API åŠŸèƒ½æ˜¯åœ¨ 1.9 ç‰ˆæœ¬ä¸­æ–°å¢åŠ çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œæœ¬èŠ‚å°†å¸¦ä½ äº†è§£ä¸€ä¸‹å…¶åŠŸèƒ½å’Œå¦‚ä½•ä½¿ç”¨ï¼Ÿ 6.3.1 State Processor API ç®€ä»‹èƒ½å¤Ÿä»å¤–éƒ¨è®¿é—® Flink ä½œä¸šçš„çŠ¶æ€ä¸€ç›´ç”¨æˆ·è¿«åˆ‡éœ€è¦çš„åŠŸèƒ½ä¹‹ä¸€ï¼Œåœ¨ Apache Flink 1.9.0 ä¸­æ–°å¼•å…¥äº† State Processor APIï¼Œè¯¥ API è®©ç”¨æˆ·å¯ä»¥é€šè¿‡ Flink DataSet ä½œä¸šæ¥çµæ´»è¯»å–ã€å†™å…¥å’Œä¿®æ”¹ Flink çš„ Savepoint å’Œ Checkpointã€‚ 6.3.2 åœ¨ Flink 1.9 ä¹‹å‰æ˜¯å¦‚ä½•å¤„ç†çŠ¶æ€çš„ï¼Ÿä¸€èˆ¬æ¥è¯´ï¼Œå¤§å¤šæ•°çš„ Flink ä½œä¸šéƒ½æ˜¯æœ‰çŠ¶æ€çš„ï¼Œå¹¶ä¸”éšç€ä½œä¸šè¿è¡Œçš„æ—¶é—´è¶Šæ¥è¶Šä¹…ï¼Œå°±ä¼šç´¯ç§¯è¶Šå¤šè¶Šå¤šçš„çŠ¶æ€ï¼Œå¦‚æœå› ä¸ºæ•…éšœå¯¼è‡´ä½œä¸šå´©æºƒå¯èƒ½ä¼šå¯¼è‡´ä½œä¸šçš„çŠ¶æ€éƒ½ä¸¢å¤±ï¼Œé‚£ä¹ˆå¯¹äºæ¯”è¾ƒé‡è¦çš„çŠ¶æ€æ¥è¯´ï¼ŒæŸå¤±å°±ä¼šå¾ˆå¤§ã€‚ä¸ºäº†ä¿è¯ä½œä¸šçŠ¶æ€çš„ä¸€è‡´æ€§å’ŒæŒä¹…æ€§ï¼ŒFlink ä»ä¸€å¼€å§‹ä½¿ç”¨çš„å°±æ˜¯ Checkpoint å’Œ Savepoint æ¥ä¿å­˜çŠ¶æ€ï¼Œå¹¶ä¸”å¯ä»¥ä» Savepoint ä¸­æ¢å¤çŠ¶æ€ã€‚åœ¨ Flink çš„æ¯ä¸ªæ–° Release ç‰ˆæœ¬ä¸­ï¼ŒFlink ç¤¾åŒºæ·»åŠ äº†è¶Šæ¥è¶Šå¤šä¸çŠ¶æ€ç›¸å…³çš„åŠŸèƒ½ä»¥æé«˜ Checkpoint çš„é€Ÿåº¦å’Œæ¢å¤é€Ÿåº¦ã€‚ æœ‰çš„æ—¶å€™ï¼Œç”¨æˆ·å¯èƒ½ä¼šæœ‰è¿™äº›éœ€æ±‚åœºæ™¯ï¼Œæ¯”å¦‚ä»ç¬¬ä¸‰æ–¹å¤–éƒ¨ç³»ç»Ÿè®¿é—®ä½œä¸šçš„çŠ¶æ€ã€å°†ä½œä¸šçš„çŠ¶æ€ä¿¡æ¯è¿ç§»åˆ°å¦ä¸€ä¸ªåº”ç”¨ç¨‹åºç­‰ï¼Œç›®å‰ç°æœ‰æ”¯æŒæŸ¥è¯¢ä½œä¸šçŠ¶æ€çš„åŠŸèƒ½ Queryable Stateï¼Œä½†æ˜¯åœ¨ Flink ä¸­ç›®å‰è¯¥åŠŸèƒ½åªæ”¯æŒæ ¹æ® Key æŸ¥æ‰¾ï¼Œå¹¶ä¸”ä¸èƒ½ä¿è¯è¿”å›å€¼çš„ä¸€è‡´æ€§ã€‚å¦å¤–è¯¥åŠŸèƒ½ä¸æ”¯æŒæ·»åŠ å’Œä¿®æ”¹ä½œä¸šçš„çŠ¶æ€ï¼Œæ‰€ä»¥é€‚ç”¨çš„åœºæ™¯è¿˜æ˜¯æ¯”è¾ƒæœ‰é™ã€‚ 6.3.3 ä½¿ç”¨ State Processor API è¯»å†™ä½œä¸šçŠ¶æ€åœ¨ 1.9 ç‰ˆæœ¬ä¸­çš„ State Processor APIï¼Œå®ƒå®Œå…¨å’Œä¹‹å‰ä¸ä¸€è‡´ï¼Œè¯¥åŠŸèƒ½ä½¿ç”¨ InputFormat å’Œ OutputFormat æ‰©å±•äº† DataSet API ä»¥è¯»å–å’Œå†™å…¥ Checkpoint å’Œ Savepoint æ•°æ®ã€‚ç”±äº DataSet å’Œ Table API çš„äº’é€šæ€§ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥ä½¿ç”¨ Table API æˆ–è€… SQL æŸ¥è¯¢å’Œåˆ†æçŠ¶æ€çš„æ•°æ®ã€‚ä¾‹å¦‚ï¼Œå†è·å–åˆ°æ­£åœ¨è¿è¡Œçš„æµä½œä¸šçŠ¶æ€çš„ Checkpoint åï¼Œå¯ä»¥ä½¿ç”¨ DataSet æ‰¹å¤„ç†ç¨‹åºå¯¹å…¶è¿›è¡Œåˆ†æï¼Œä»¥éªŒè¯è¯¥æµä½œä¸šçš„è¿è¡Œæ˜¯å¦æ­£ç¡®ã€‚å¦å¤– State Processor API è¿˜å¯ä»¥ä¿®å¤ä¸ä¸€è‡´çš„çŠ¶æ€ä¿¡æ¯ï¼Œå®ƒæä¾›äº†å¾ˆå¤šæ–¹æ³•æ¥å¼€å‘æœ‰çŠ¶æ€çš„åº”ç”¨ç¨‹åºï¼Œè¿™äº›æ–¹æ³•åœ¨ä»¥å‰çš„ç‰ˆæœ¬ä¸­å› ä¸ºè®¾è®¡çš„é—®é¢˜å¯¼è‡´ä½œä¸šåœ¨å¯åŠ¨åä¸èƒ½å†ä¿®æ”¹ï¼Œå¦åˆ™çŠ¶æ€å¯èƒ½ä¼šä¸¢å¤±ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ä»»æ„ä¿®æ”¹çŠ¶æ€çš„æ•°æ®ç±»å‹ã€è°ƒæ•´ç®—å­çš„æœ€å¤§å¹¶è¡Œåº¦ã€æ‹†åˆ†æˆ–åˆå¹¶ç®—å­çš„çŠ¶æ€ã€é‡æ–°åˆ†é…ç®—å­çš„ uid ç­‰ã€‚ å¦‚æœè¦ä½¿ç”¨ State Processor API å»è¯»å†™ä½œä¸šçš„çŠ¶æ€ï¼Œä½ éœ€è¦æ·»åŠ ä¸‹é¢çš„ä¾èµ–ï¼š 12345&lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-state-processor-api_$&#123;scala.binary.version&#125;&lt;/artifactId&gt; &lt;version&gt;$&#123;flink.version&#125;&lt;/version&gt;&lt;/dependency&gt; 6.3.4 ä½¿ç”¨ DataSet è¯»å–ä½œä¸šçŠ¶æ€State Processor API å°†ä½œä¸šçš„çŠ¶æ€æ˜ å°„åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªå¯ä»¥å•ç‹¬å¤„ç†çš„æ•°æ®é›†ï¼Œä¸ºäº†èƒ½å¤Ÿä½¿ç”¨è¯¥ APIï¼Œéœ€è¦å…ˆäº†è§£è¿™ä¸ªæ˜ å°„çš„å·¥ä½œæ–¹å¼ï¼Œé¦–å…ˆæ¥çœ‹ä¸‹æœ‰çŠ¶æ€çš„ Flink ä½œä¸šæ˜¯ä»€ä¹ˆæ ·å­çš„ã€‚Flink ä½œä¸šæ˜¯ç”±å¾ˆå¤šç®—å­ç»„æˆï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªæ•°æ®æºï¼ˆSourceï¼‰ã€ä¸€äº›å®é™…å¤„ç†æ•°æ®çš„ç®—å­ï¼ˆæ¯”å¦‚ Mapï¼Filterï¼FlatMap ç­‰ï¼‰å’Œä¸€ä¸ªæˆ–è€…å¤šä¸ª Sinkã€‚æ¯ä¸ªç®—å­ä¼šåœ¨ä¸€ä¸ªæˆ–è€…å¤šä¸ªä»»åŠ¡ä¸­å¹¶è¡Œè¿è¡Œï¼ˆå–å†³äºå¹¶è¡Œåº¦ï¼‰ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨ä¸åŒç±»å‹çš„çŠ¶æ€ï¼Œç®—å­å¯èƒ½ä¼šæœ‰é›¶ä¸ªã€ä¸€ä¸ªæˆ–å¤šä¸ª Operator Stateï¼Œè¿™äº›çŠ¶æ€ä¼šç»„æˆä¸€ä¸ªä»¥ç®—å­ä»»åŠ¡ä¸ºèŒƒå›´çš„åˆ—è¡¨ã€‚å¦‚æœæ˜¯ç®—å­åº”ç”¨åœ¨ KeyedStreamï¼Œå®ƒè¿˜æœ‰é›¶ä¸ªã€ä¸€ä¸ªæˆ–è€…å¤šä¸ª Keyed Stateï¼Œå®ƒä»¬çš„ä½œç”¨åŸŸèŒƒå›´æ˜¯ä»æ¯ä¸ªå·²å¤„ç†æ•°æ®ä¸­æå– Keyï¼Œå¯ä»¥å°† Keyed State çœ‹ä½œæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„ Mapã€‚ State Processor API ç°åœ¨æä¾›äº†è¯»å–ã€æ–°å¢å’Œä¿®æ”¹ Savepoint æ•°æ®çš„æ–¹æ³•ï¼Œæ¯”å¦‚ä»å·²åŠ è½½çš„ Savepoint ä¸­è¯»å–æ•°æ®é›†ï¼Œç„¶åå°†æ•°æ®é›†è½¬æ¢ä¸ºçŠ¶æ€å¹¶å°†å…¶ä¿å­˜åˆ° Savepointã€‚ä¸‹é¢åˆ†åˆ«è®²è§£ä¸‹è¿™ä¸‰ç§æ–¹æ³•è¯¥å¦‚ä½•ä½¿ç”¨ã€‚ è¯»å–ç°æœ‰çš„ Savepointè¯»å–çŠ¶æ€é¦–å…ˆéœ€è¦æŒ‡å®šä¸€ä¸ª Savepointï¼ˆæˆ–è€… Checkpointï¼‰ çš„è·¯å¾„å’ŒçŠ¶æ€åç«¯å­˜å‚¨çš„ç±»å‹ã€‚ 12ExecutionEnvironment bEnv = ExecutionEnvironment.getExecutionEnvironment();ExistingSavepoint savepoint = Savepoint.load(bEnv, \"hdfs://path/\", new RocksDBStateBackend()); è¯»å– Operator State æ—¶ï¼Œåªéœ€æŒ‡å®šç®—å­çš„ uidã€çŠ¶æ€åç§°å’Œç±»å‹ä¿¡æ¯ã€‚ 12345DataSet&lt;Integer&gt; listState = savepoint.readListState(\"zhisheng-uid\", \"list-state\", Types.INT);DataSet&lt;Integer&gt; unionState = savepoint.readUnionState(\"zhisheng-uid\", \"union-state\", Types.INT); DataSet&lt;Tuple2&lt;Integer, Integer&gt;&gt; broadcastState = savepoint.readBroadcastState(\"zhisheng-uid\", \"broadcast-state\", Types.INT, Types.INT); å¦‚æœåœ¨çŠ¶æ€æè¿°ç¬¦ï¼ˆStateDescriptorï¼‰ä¸­ä½¿ç”¨äº†è‡ªå®šä¹‰ç±»å‹åºåˆ—åŒ–å™¨ TypeSerializerï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå®ƒï¼š 123DataSet&lt;Integer&gt; listState = savepoint.readListState( \"zhisheng-uid\", \"list-state\", Types.INT, new MyCustomIntSerializer()); å†™å…¥æ–°çš„ Savepointä¿®æ”¹ç°æœ‰çš„ Savepoint6.3.5 ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ DataSet APIï¼Ÿ6.3.6 å°ç»“ä¸åæ€åŠ å…¥çŸ¥è¯†æ˜Ÿçƒå¯ä»¥çœ‹åˆ°ä¸Šé¢æ–‡ç« ï¼šhttps://t.zsxq.com/nMR7ufq","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹â€”â€” ä½¿ç”¨ Flink CEP å¤„ç†å¤æ‚äº‹ä»¶","date":"2021-07-28T16:00:00.000Z","path":"2021/07/29/flink-in-action-6.2/","text":"6.2 ä½¿ç”¨ Flink CEP å¤„ç†å¤æ‚äº‹ä»¶6.1 èŠ‚ä¸­ä»‹ç» Flink CEP å’Œå…¶ä½¿ç”¨åœºæ™¯ï¼Œæœ¬èŠ‚å°†è¯¦ç»†ä»‹ç» Flink CEP çš„ APIï¼Œæ•™ä¼šå¤§å®¶å¦‚ä½•å»ä½¿ç”¨ Flink CEPã€‚ 6.2.1 å‡†å¤‡ä¾èµ–è¦å¼€å‘ Flink CEP åº”ç”¨ç¨‹åºï¼Œé¦–å…ˆä½ å¾—åœ¨é¡¹ç›®çš„ pom.xml ä¸­æ·»åŠ ä¾èµ–ã€‚ 12345&lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-cep_$&#123;scala.binary.version&#125;&lt;/artifactId&gt; &lt;version&gt;$&#123;flink.version&#125;&lt;/version&gt;&lt;/dependency&gt; è¿™ä¸ªä¾èµ–æœ‰ä¸¤ç§ï¼Œä¸€ä¸ªæ˜¯ Java ç‰ˆæœ¬çš„ï¼Œä¸€ä¸ªæ˜¯ Scala ç‰ˆæœ¬ï¼Œä½ å¯ä»¥æ ¹æ®é¡¹ç›®çš„å¼€å‘è¯­è¨€è‡ªè¡Œé€‰æ‹©ã€‚ 6.2.2 Flink CEP å…¥é—¨åº”ç”¨ç¨‹åºå‡†å¤‡å¥½ä¾èµ–åï¼Œæˆ‘ä»¬å¼€å§‹ç¬¬ä¸€ä¸ª Flink CEP åº”ç”¨ç¨‹åºï¼Œè¿™é‡Œæˆ‘ä»¬åªåšä¸€ä¸ªç®€å•çš„æ•°æ®æµåŒ¹é…ï¼Œå½“åŒ¹é…æˆåŠŸåå°†åŒ¹é…çš„ä¸¤æ¡æ•°æ®æ‰“å°å‡ºæ¥ã€‚é¦–å…ˆå®šä¹‰å®ä½“ç±» Event å¦‚ä¸‹ï¼š 1234public class Event &#123; private Integer id; private String name;&#125; ç„¶åæ„é€ è¯»å– Socket æ•°æ®æµå°†æ•°æ®è¿›è¡Œè½¬æ¢æˆ Eventï¼Œä»£ç å¦‚ä¸‹ï¼š 123456789101112SingleOutputStreamOperator&lt;Event&gt; eventDataStream = env.socketTextStream(\"127.0.0.1\", 9200) .flatMap(new FlatMapFunction&lt;String, Event&gt;() &#123; @Override public void flatMap(String s, Collector&lt;Event&gt; collector) throws Exception &#123; if (StringUtil.isNotEmpty(s)) &#123; String[] split = s.split(\",\"); if (split.length == 2) &#123; collector.collect(new Event(Integer.valueOf(split[0]), split[1])); &#125; &#125; &#125; &#125;); æ¥ç€å°±æ˜¯å®šä¹‰ CEP ä¸­çš„åŒ¹é…è§„åˆ™äº†ï¼Œä¸‹é¢çš„è§„åˆ™è¡¨ç¤ºç¬¬ä¸€ä¸ªäº‹ä»¶çš„ id ä¸º 42ï¼Œç´§æ¥ç€çš„ç¬¬äºŒä¸ªäº‹ä»¶ id è¦å¤§äº 10ï¼Œæ»¡è¶³è¿™æ ·çš„è¿ç»­ä¸¤ä¸ªäº‹ä»¶æ‰ä¼šå°†è¿™ä¸¤æ¡æ•°æ®è¿›è¡Œæ‰“å°å‡ºæ¥ã€‚ 12345678910111213141516171819202122232425262728Pattern&lt;Event, ?&gt; pattern = Pattern.&lt;Event&gt;begin(\"start\").where( new SimpleCondition&lt;Event&gt;() &#123; @Override public boolean filter(Event event) &#123; log.info(\"start &#123;&#125;\", event.getId()); return event.getId() == 42; &#125; &#125;).next(\"middle\").where( new SimpleCondition&lt;Event&gt;() &#123; @Override public boolean filter(Event event) &#123; log.info(\"middle &#123;&#125;\", event.getId()); return event.getId() &gt;= 10; &#125; &#125;);CEP.pattern(eventDataStream, pattern).select(new PatternSelectFunction&lt;Event, String&gt;() &#123; @Override public String select(Map&lt;String, List&lt;Event&gt;&gt; p) throws Exception &#123; StringBuilder builder = new StringBuilder(); log.info(\"p = &#123;&#125;\", p); builder.append(p.get(\"start\").get(0).getId()).append(\",\").append(p.get(\"start\").get(0).getName()).append(\"\\n\") .append(p.get(\"middle\").get(0).getId()).append(\",\").append(p.get(\"middle\").get(0).getName()); return builder.toString(); &#125;&#125;).print();//æ‰“å°ç»“æœ ç„¶åç¬”è€…åœ¨ç»ˆç«¯å¼€å¯ Socketï¼Œè¾“å…¥çš„ä¸¤æ¡æ•°æ®å¦‚ä¸‹ï¼š 1242,zhisheng20,zhisheng ä½œä¸šæ‰“å°å‡ºæ¥çš„æ—¥å¿—å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æ•´ä¸ªä½œä¸š print å‡ºæ¥çš„ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å¥½äº†ï¼Œä¸€ä¸ªå®Œæ•´çš„ Flink CEP åº”ç”¨ç¨‹åºå¦‚ä¸Šï¼Œç›¸ä¿¡ä½ ä¹Ÿèƒ½å¤§æ¦‚ç†è§£ä¸Šé¢çš„ä»£ç ï¼Œæ¥ç€æ¥è¯¦ç»†çš„è®²è§£ä¸€ä¸‹ Flink CEP ä¸­çš„ Pattern APIã€‚ 6.2.3 Pattern APIä½ å¯ä»¥é€šè¿‡ Pattern API å»å®šä¹‰ä»æµæ•°æ®ä¸­åŒ¹é…äº‹ä»¶çš„ Patternï¼Œæ¯ä¸ªå¤æ‚ Pattern éƒ½æ˜¯ç”±å¤šä¸ªç®€å•çš„ Pattern ç»„æˆçš„ï¼Œæ‹¿å‰é¢å…¥é—¨çš„åº”ç”¨æ¥è®²ï¼Œå®ƒå°±æ˜¯ç”± start å’Œ middle ä¸¤ä¸ªç®€å•çš„ Pattern ç»„æˆçš„ï¼Œåœ¨å…¶æ¯ä¸ª Pattern ä¸­éƒ½åªæ˜¯ç®€å•çš„å¤„ç†äº†æµæ•°æ®ã€‚åœ¨å¤„ç†çš„è¿‡ç¨‹ä¸­éœ€è¦æ ‡ç¤ºè¯¥ Pattern çš„åç§°ï¼Œä»¥ä¾¿åç»­å¯ä»¥ä½¿ç”¨è¯¥åç§°æ¥è·å–åŒ¹é…åˆ°çš„æ•°æ®ï¼Œå¦‚ p.get(&quot;start&quot;).get(0) å®ƒå°±å¯ä»¥è·å–åˆ° Pattern ä¸­åŒ¹é…çš„ç¬¬ä¸€ä¸ªäº‹ä»¶ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ç®€å•çš„ Pattern ã€‚ å•ä¸ª Patternæ•°é‡ æ¡ä»¶ ç»„åˆ PatternGroup Patternäº‹ä»¶åŒ¹é…è·³è¿‡ç­–ç•¥6.2.4 æ£€æµ‹ Patterné€‰æ‹© Pattern6.2.5 CEP æ—¶é—´å±æ€§æ ¹æ®äº‹ä»¶æ—¶é—´å¤„ç†å»¶è¿Ÿæ•°æ®æ—¶é—´ä¸Šä¸‹æ–‡åŠ å…¥çŸ¥è¯†æ˜Ÿçƒå¯ä»¥çœ‹åˆ°ä¸Šé¢æ–‡ç« ï¼šhttps://t.zsxq.com/nMR7ufq 6.2.6 å°ç»“ä¸åæ€æœ¬èŠ‚å¼€å§‹é€šè¿‡ä¸€ä¸ª Flink CEP æ¡ˆä¾‹æ•™å¤§å®¶ä¸Šæ‰‹ï¼Œåé¢é€šè¿‡è®²è§£ Flink CEP çš„ Pattern APIï¼Œæ›´å¤šè¯¦ç»†çš„è¿˜æ˜¯å¾—å»çœ‹å®˜ç½‘æ–‡æ¡£ï¼Œå…¶å®ä¹Ÿå»ºè®®å¤§å®¶å¥½å¥½çš„è·Ÿç€å®˜ç½‘çš„æ–‡æ¡£è¿‡ä¸€éæ‰€æœ‰çš„ APIï¼Œå¹¶è·Ÿç€æ•²ä¸€äº›æ ·ä¾‹æ¥å®ç°ï¼Œè¿™æ ·åœ¨å¼€å‘éœ€æ±‚çš„æ—¶å€™æ‰èƒ½å¤ŸåŠæ—¶çš„æƒ³åˆ°ä»€ä¹ˆåœºæ™¯ä¸‹è¯¥ä½¿ç”¨å“ªç§ APIï¼Œæ¥ç€æ•™äº†å¤§å®¶å¦‚ä½•å°† Pattern ä¸æ•°æ®æµç»“åˆèµ·æ¥åŒ¹é…å¹¶è·å–åŒ¹é…çš„æ•°æ®ï¼Œæœ€åè®²äº†ä¸‹ CEP ä¸­çš„æ—¶é—´æ¦‚å¿µã€‚ ä½ å…¬å¸æœ‰ä½¿ç”¨ Flink CEP å—ï¼Ÿé€šå¸¸ä½¿ç”¨å“ªäº› API å±…å¤šï¼Ÿ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹â€”â€” Flink CEP ç®€ä»‹åŠå…¶ä½¿ç”¨åœºæ™¯","date":"2021-07-27T16:00:00.000Z","path":"2021/07/28/flink-in-action-6.1/","text":"ç¬¬å…­ç«  â€”â€” æ‰©å±•åº“Flink æºç ä¸­æœ‰å•ç‹¬çš„ flink-libraries æ¨¡å—ç”¨æ¥å­˜æ”¾ä¸€äº›æ‰©å±•åº“ï¼Œæ¯”å¦‚ CEPã€Gellyã€Machine Learningã€State Processor APIã€‚æœ¬ç« å°†åˆ†åˆ«ä»‹ç»è¿™å‡ ç§æ‰©å±•åº“ä»¥åŠå¦‚ä½•åº”ç”¨åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­ã€‚ 6.1 Flink CEP ç®€ä»‹åŠå…¶ä½¿ç”¨åœºæ™¯ Flink CEP æ˜¯ä¸€å¥—æå…·é€šç”¨æ€§ã€æ˜“äºä½¿ç”¨çš„å®æ—¶æµå¼äº‹ä»¶å¤„ç†æ–¹æ¡ˆï¼Œå®ƒå¯ä»¥åœ¨å®æ—¶æ•°æ®ä¸­åŒ¹é…å¤æ‚äº‹ä»¶ï¼Œç”¨å¤„å¾ˆå¹¿ï¼Œæœ¬èŠ‚å°†å¸¦å¤§å®¶äº†è§£å…¶åŠŸèƒ½å’Œåº”ç”¨åœºæ™¯ã€‚ 6.1.1 CEP ç®€ä»‹ï¼ŸCEP çš„è‹±æ–‡å…¨ç§°æ˜¯ Complex Event Processingï¼Œç¿»è¯‘æˆä¸­æ–‡ä¸ºå¤æ‚äº‹ä»¶å¤„ç†ã€‚å®ƒå¯ä»¥ç”¨äºå¤„ç†å®æ—¶æ•°æ®å¹¶åœ¨äº‹ä»¶æµåˆ°è¾¾æ—¶ä»äº‹ä»¶æµä¸­æå–ä¿¡æ¯ï¼Œå¹¶æ ¹æ®å®šä¹‰çš„è§„åˆ™æ¥åˆ¤æ–­äº‹ä»¶æ˜¯å¦åŒ¹é…ï¼Œå¦‚æœåŒ¹é…åˆ™ä¼šè§¦å‘æ–°çš„äº‹ä»¶åšå‡ºå“åº”ã€‚é™¤äº†æ”¯æŒå•ä¸ªäº‹ä»¶çš„ç®€å•æ— çŠ¶æ€çš„æ¨¡å¼åŒ¹é…ï¼ˆä¾‹å¦‚åŸºäºäº‹ä»¶ä¸­çš„æŸä¸ªå­—æ®µè¿›è¡Œç­›é€‰è¿‡æ»¤ï¼‰ï¼Œä¹Ÿå¯ä»¥æ”¯æŒåŸºäºå…³è”ï¼èšåˆï¼æ—¶é—´çª—å£ç­‰å¤šä¸ªäº‹ä»¶çš„å¤æ‚æœ‰çŠ¶æ€æ¨¡å¼çš„åŒ¹é…ï¼ˆä¾‹å¦‚åˆ¤æ–­ç”¨æˆ·ä¸‹å•äº‹ä»¶å 30 åˆ†é’Ÿå†…æ˜¯å¦æœ‰æ”¯ä»˜äº‹ä»¶ï¼‰ã€‚ å› ä¸ºè¿™ç§äº‹ä»¶åŒ¹é…é€šå¸¸æ˜¯æ ¹æ®æå‰åˆ¶å®šå¥½çš„è§„åˆ™å»åŒ¹é…çš„ï¼Œè€Œè¿™äº›è§„åˆ™ä¸€èˆ¬æ¥è¯´ä¸ä»…å¤šï¼Œè€Œä¸”å¤æ‚ï¼Œæ‰€ä»¥å°±ä¼šå¼•å…¥ä¸€äº›è§„åˆ™å¼•æ“æ¥å¤„ç†è¿™ç§å¤æ‚äº‹ä»¶åŒ¹é…ã€‚å¸‚é¢ä¸Šå¸¸ç”¨çš„è§„åˆ™å¼•æ“æœ‰å¦‚ä¸‹è¿™äº›ã€‚ 6.1.2 è§„åˆ™å¼•æ“å¯¹æ¯”ç›®å‰å¼€æºçš„è§„åˆ™å¼•æ“æœ‰å¾ˆå¤šç§ï¼Œæ¥ä¸‹æ¥å°†å¯¹æ¯”ä¸€ä¸‹ Droolsã€Aviatorã€EasyRulesã€Esperã€Flink CEP ä¹‹é—´çš„ä¼˜åŠ¿å’ŒåŠ£åŠ¿ã€‚ DroolsDrools æ˜¯ä¸€æ¬¾ä½¿ç”¨ Java ç¼–å†™çš„å¼€æºè§„åˆ™å¼•æ“ï¼Œé€šå¸¸ç”¨æ¥è§£å†³ä¸šåŠ¡ä»£ç ä¸ä¸šåŠ¡è§„åˆ™çš„åˆ†ç¦»ï¼Œå®ƒå†…ç½®çš„ Drools Fusion æ¨¡å—ä¹Ÿæä¾› CEP çš„åŠŸèƒ½ã€‚ ä¼˜åŠ¿: åŠŸèƒ½è¾ƒä¸ºå®Œå–„ï¼Œå…·æœ‰å¦‚ç³»ç»Ÿç›‘æ§ã€æ“ä½œå¹³å°ç­‰åŠŸèƒ½ã€‚ è§„åˆ™æ”¯æŒåŠ¨æ€æ›´æ–°ã€‚ åŠ£åŠ¿: ä»¥å†…å­˜å®ç°æ—¶é—´çª—åŠŸèƒ½ï¼Œæ— æ³•æ”¯æŒè¾ƒé•¿è·¨åº¦çš„æ—¶é—´çª—ã€‚ æ— æ³•æœ‰æ•ˆæ”¯æŒå®šæ—¶è§¦è¾¾ï¼ˆå¦‚ç”¨æˆ·åœ¨æµè§ˆå‘ç”Ÿä¸€æ®µæ—¶é—´åè§¦è¾¾æ¡ä»¶åˆ¤æ–­ï¼‰ã€‚ AviatorAviator æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ã€è½»é‡çº§çš„ Java è¯­è¨€å®ç°çš„è¡¨è¾¾å¼æ±‚å€¼å¼•æ“ï¼Œä¸»è¦ç”¨äºå„ç§è¡¨è¾¾å¼çš„åŠ¨æ€æ±‚å€¼ã€‚ ä¼˜åŠ¿ï¼š æ”¯æŒå¤§éƒ¨åˆ†è¿ç®—æ“ä½œç¬¦ã€‚ æ”¯æŒå‡½æ•°è°ƒç”¨å’Œè‡ªå®šä¹‰å‡½æ•°ã€‚ æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ã€‚ æ”¯æŒä¼ å…¥å˜é‡å¹¶ä¸”æ€§èƒ½ä¼˜ç§€ã€‚ åŠ£åŠ¿ï¼š æ²¡æœ‰ if elseã€do while ç­‰è¯­å¥ï¼Œæ²¡æœ‰èµ‹å€¼è¯­å¥ï¼Œæ²¡æœ‰ä½è¿ç®—ç¬¦ã€‚ EasyRulesEasyRules é›†æˆäº† MVEL å’Œ SpEL è¡¨è¾¾å¼çš„ä¸€æ¬¾è½»é‡çº§è§„åˆ™å¼•æ“ã€‚ ä¼˜åŠ¿ï¼š è½»é‡çº§æ¡†æ¶ï¼Œå­¦ä¹ æˆæœ¬ä½ã€‚ åŸºäº POJOã€‚ ä¸ºå®šä¹‰ä¸šåŠ¡å¼•æ“æä¾›æœ‰ç”¨çš„æŠ½è±¡å’Œç®€ä¾¿çš„åº”ç”¨ æ”¯æŒä»ç®€å•çš„è§„åˆ™ç»„å»ºæˆå¤æ‚è§„åˆ™ EsperEsper è®¾è®¡ç›®æ ‡ä¸º CEP çš„è½»é‡çº§è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥æ–¹ä¾¿çš„åµŒå…¥æœåŠ¡ä¸­ï¼Œæä¾› CEP åŠŸèƒ½ã€‚ ä¼˜åŠ¿: è½»é‡çº§å¯åµŒå…¥å¼€å‘ï¼Œå¸¸ç”¨çš„ CEP åŠŸèƒ½ç®€å•å¥½ç”¨ã€‚ EPL è¯­æ³•ä¸ SQL ç±»ä¼¼ï¼Œå­¦ä¹ æˆæœ¬è¾ƒä½ã€‚ åŠ£åŠ¿: å•æœºå…¨å†…å­˜æ–¹æ¡ˆï¼Œéœ€è¦æ•´åˆå…¶ä»–åˆ†å¸ƒå¼å’Œå­˜å‚¨ã€‚ ä»¥å†…å­˜å®ç°æ—¶é—´çª—åŠŸèƒ½ï¼Œæ— æ³•æ”¯æŒè¾ƒé•¿è·¨åº¦çš„æ—¶é—´çª—ã€‚ æ— æ³•æœ‰æ•ˆæ”¯æŒå®šæ—¶è§¦è¾¾ï¼ˆå¦‚ç”¨æˆ·åœ¨æµè§ˆå‘ç”Ÿä¸€æ®µæ—¶é—´åè§¦è¾¾æ¡ä»¶åˆ¤æ–­ï¼‰ã€‚ Flink CEPFlink æ˜¯ä¸€ä¸ªæµå¼ç³»ç»Ÿï¼Œå…·æœ‰é«˜ååä½å»¶è¿Ÿçš„ç‰¹ç‚¹ï¼ŒFlink CEP æ˜¯ä¸€å¥—æå…·é€šç”¨æ€§ã€æ˜“äºä½¿ç”¨çš„å®æ—¶æµå¼äº‹ä»¶å¤„ç†æ–¹æ¡ˆã€‚ ä¼˜åŠ¿: ç»§æ‰¿äº† Flink é«˜ååçš„ç‰¹ç‚¹ äº‹ä»¶æ”¯æŒå­˜å‚¨åˆ°å¤–éƒ¨ï¼Œå¯ä»¥æ”¯æŒè¾ƒé•¿è·¨åº¦çš„æ—¶é—´çª—ã€‚ å¯ä»¥æ”¯æŒå®šæ—¶è§¦è¾¾ï¼ˆç”¨ followedBy ï¼‹ PartternTimeoutFunction å®ç°ï¼‰ åŠ£åŠ¿: æ— æ³•åŠ¨æ€æ›´æ–°è§„åˆ™ï¼ˆç—›ç‚¹ï¼‰ 6.1.3 Flink CEP ç®€ä»‹6.1.4 Flink CEP åŠ¨æ€æ›´æ–°è§„åˆ™6.1.5 Flink CEP ä½¿ç”¨åœºæ™¯åˆ†æå®æ—¶åä½œå¼Šå’Œé£æ§å®æ—¶è¥é”€å®æ—¶ç½‘ç»œæ”»å‡»æ£€æµ‹6.1.6 å°ç»“ä¸åæ€åŠ å…¥çŸ¥è¯†æ˜Ÿçƒå¯ä»¥çœ‹åˆ°ä¸Šé¢æ–‡ç« ï¼šhttps://t.zsxq.com/nMR7ufq","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹â€”â€” Flink Table API & SQL åŠŸèƒ½","date":"2021-07-26T16:00:00.000Z","path":"2021/07/27/flink-in-action-5.2/","text":"5.2 Flink Table API &amp; SQL åŠŸèƒ½åœ¨ 5.1 èŠ‚ä¸­å¯¹ Flink Table API &amp; SQL çš„æ¦‚è¿°å’Œå¸¸è§ API éƒ½åšäº†ä»‹ç»ï¼Œè¿™ç¯‡æ–‡ç« å…ˆæ¥çœ‹ä¸‹å…¶ä¸ DataStream å’Œ DataSet API çš„é›†æˆã€‚ 5.2.1 Flink Table å’Œ SQL ä¸ DataStream å’Œ DataSet é›†æˆä¸¤ä¸ª planner éƒ½å¯ä»¥ä¸ DataStream API é›†æˆï¼Œåªæœ‰ä»¥å‰çš„ planner æ‰å¯ä»¥é›†æˆ DataSet APIï¼Œæ‰€ä»¥ä¸‹é¢è®¨è®º DataSet API éƒ½æ˜¯å’Œä»¥å‰çš„ planner æœ‰å…³ã€‚ Table API &amp; SQL æŸ¥è¯¢ä¸ DataStream å’Œ DataSet ç¨‹åºé›†æˆæ˜¯éå¸¸ç®€å•çš„ï¼Œæ¯”å¦‚å¯ä»¥é€šè¿‡ Table API æˆ–è€… SQL æŸ¥è¯¢å¤–éƒ¨è¡¨æ•°æ®ï¼Œè¿›è¡Œä¸€äº›é¢„å¤„ç†åï¼Œç„¶åä½¿ç”¨ DataStream æˆ– DataSet API ç»§ç»­å¤„ç†ä¸€äº›å¤æ‚çš„è®¡ç®—ï¼Œå¦å¤–ä¹Ÿå¯ä»¥å°† DataStream æˆ– DataSet å¤„ç†åçš„æ•°æ®åˆ©ç”¨ Table API æˆ–è€… SQL å†™å…¥åˆ°å¤–éƒ¨è¡¨å»ã€‚æ€»è€Œè¨€ä¹‹ï¼Œå®ƒä»¬ä¹‹é—´äº’ç›¸è½¬æ¢æˆ–è€…é›†æˆæ¯”è¾ƒå®¹æ˜“ã€‚ Scala çš„éšå¼è½¬æ¢Scala Table API æä¾›äº† DataSetã€DataStream å’Œ Table ç±»çš„éšå¼è½¬æ¢ï¼Œå¯ä»¥é€šè¿‡å¯¼å…¥ org.apache.flink.table.api.scala._ æˆ–è€… org.apache.flink.api.scala._ åŒ…æ¥å¯ç”¨è¿™äº›è½¬æ¢ã€‚ å°† DataStream æˆ– DataSet æ³¨å†Œä¸º TableDataStream æˆ–è€… DataSet å¯ä»¥æ³¨å†Œä¸º Tableï¼Œç»“æœè¡¨çš„ schema å–å†³äºå·²ç»æ³¨å†Œçš„ DataStream å’Œ DataSet çš„æ•°æ®ç±»å‹ã€‚ä½ å¯ä»¥åƒä¸‹é¢è¿™ç§æ–¹å¼è½¬æ¢ï¼š 123456789StreamTableEnvironment tableEnv = ...;DataStream&lt;Tuple2&lt;Long, String&gt;&gt; stream = ...//å°† DataStream æ³¨å†Œä¸º myTable è¡¨tableEnv.registerDataStream(\"myTable\", stream);//å°† DataStream æ³¨å†Œä¸º myTable2 è¡¨ï¼ˆè¡¨ä¸­çš„å­—æ®µä¸º myLongã€myStringï¼‰tableEnv.registerDataStream(\"myTable2\", stream, \"myLong, myString\"); å°† DataStream æˆ– DataSet è½¬æ¢ä¸º Tableé™¤äº†å¯ä»¥å°† DataStream æˆ– DataSet æ³¨å†Œä¸º Tableï¼Œè¿˜å¯ä»¥å°†å®ƒä»¬è½¬æ¢ä¸º Tableï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼Œè½¬æ¢ä¹‹åå†å»ä½¿ç”¨ Table API æŸ¥è¯¢å°±æ¯”è¾ƒæ–¹ä¾¿äº†ã€‚ 123456789StreamTableEnvironment tableEnv = ...;DataStream&lt;Tuple2&lt;Long, String&gt;&gt; stream = ...//å°† DataStream è½¬æ¢æˆ TableTable table1 = tableEnv.fromDataStream(stream);//å°† DataStream è½¬æ¢æˆ TableTable table2 = tableEnv.fromDataStream(stream, \"myLong, myString\"); å°† Table è½¬æ¢æˆ DataStream æˆ– DataSetTable å¯ä»¥è½¬æ¢ä¸º DataStream æˆ– DataSetï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ Table API æˆ– SQL æŸ¥è¯¢çš„ç»“æœä¸Šè¿è¡Œè‡ªå®šä¹‰çš„ DataStream æˆ– DataSet ç¨‹åºã€‚å½“å°†ä¸€ä¸ª Table è½¬æ¢æˆ DataStream æˆ– DataSet æ—¶ï¼Œéœ€è¦æŒ‡å®šç»“æœ DataStream æˆ– DataSet çš„æ•°æ®ç±»å‹ï¼Œæœ€æ–¹ä¾¿çš„æ•°æ®ç±»å‹æ˜¯ Rowï¼Œä¸‹é¢å‡ ä¸ªæ•°æ®ç±»å‹è¡¨ç¤ºä¸åŒçš„åŠŸèƒ½ï¼š Rowï¼šå­—æ®µæŒ‰ä½ç½®æ˜ å°„ï¼Œä»»æ„æ•°é‡çš„å­—æ®µï¼Œæ”¯æŒ null å€¼ï¼Œæ²¡æœ‰ç±»å‹å®‰å…¨è®¿é—®ã€‚ POJOï¼šå­—æ®µæŒ‰åç§°æ˜ å°„ï¼ŒPOJO å±æ€§å¿…é¡»æŒ‰ç…§ Table ä¸­çš„å±æ€§æ¥å‘½åï¼Œä»»æ„æ•°é‡çš„å­—æ®µï¼Œæ”¯æŒ null å€¼ï¼Œç±»å‹å®‰å…¨è®¿é—® Case Classï¼šå­—æ®µæŒ‰ä½ç½®æ˜ å°„ï¼Œä¸æ”¯æŒ null å€¼ï¼Œç±»å‹å®‰å…¨è®¿é—®ã€‚ Tupleï¼šæŒ‰ä½ç½®æ˜ å°„å­—æ®µï¼Œé™åˆ¶ä¸º 22ï¼ˆScalaï¼‰æˆ– 25ï¼ˆJavaï¼‰å­—æ®µï¼Œä¸æ”¯æŒ null å€¼ï¼Œç±»å‹å®‰å…¨è®¿é—®ã€‚ åŸå­ç±»å‹ï¼šTable å¿…é¡»å…·æœ‰å•ä¸ªå­—æ®µï¼Œä¸æ”¯æŒ null å€¼ï¼Œç±»å‹å®‰å…¨è®¿é—®ã€‚ å°† Table è½¬æ¢æˆ DataStreamæµæŸ¥è¯¢çš„ç»“æœè¡¨ä¼šåŠ¨æ€æ›´æ–°ï¼Œå³æ¯ä¸ªæ–°çš„è®°å½•åˆ°è¾¾è¾“å…¥æµæ—¶ç»“æœå°±ä¼šå‘ç”Ÿå˜åŒ–ã€‚æ‰€ä»¥åœ¨å°† Table è½¬æ¢æˆ DataStream å°±éœ€è¦å¯¹è¡¨çš„æ›´æ–°è¿›è¡Œç¼–ç ï¼Œæœ‰ä¸¤ç§å°† Table è½¬æ¢ä¸º DataStream çš„æ¨¡å¼ï¼š è¿½åŠ æ¨¡å¼(Append Mode)ï¼šè¿™ç§æ¨¡å¼åªèƒ½åœ¨åŠ¨æ€è¡¨ä»…é€šè¿‡ INSERT æ›´æ”¹ä¿®æ”¹æ—¶æ‰èƒ½ä½¿ç”¨ï¼Œå³ä»…è¿½åŠ ï¼Œä¹‹å‰å‘å‡ºçš„ç»“æœä¸ä¼šæ›´æ–°ã€‚ æ’¤å›æ¨¡å¼(Retract Mode)ï¼šä»»ä½•æ—¶åˆ»éƒ½å¯ä»¥ä½¿ç”¨æ­¤æ¨¡å¼ï¼Œå®ƒä½¿ç”¨ä¸€ä¸ª boolean æ ‡å¿—æ¥ç¼–ç  INSERT å’Œ DELETE çš„æ›´æ”¹ã€‚ ä¸¤ç§æ¨¡å¼çš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š 1234567891011121314StreamTableEnvironment tableEnv = ...;//æœ‰ä¸¤ä¸ªå­—æ®µ(nameã€age) çš„ TableTable table = ...//é€šè¿‡æŒ‡å®šç±»ï¼Œå°†è¡¨è½¬æ¢ä¸ºä¸€ä¸ª append DataStreamDataStream&lt;Row&gt; dsRow = tableEnv.toAppendStream(table, Row.class);//å°†è¡¨è½¬æ¢ä¸º Tuple2&lt;String, Integer&gt; çš„ append DataStreamTupleTypeInfo&lt;Tuple2&lt;String, Integer&gt;&gt; tupleType = new TupleTypeInfo&lt;&gt;(Types.STRING(), Types.INT());DataStream&lt;Tuple2&lt;String, Integer&gt;&gt; dsTuple = tableEnv.toAppendStream(table, tupleType);//å°†è¡¨è½¬æ¢ä¸ºä¸€ä¸ª Retract DataStream RowDataStream&lt;Tuple2&lt;Boolean, Row&gt;&gt; retractStream = tableEnv.toRetractStream(table, Row.class); å°† Table è½¬æ¢æˆ DataSetå°† Table è½¬æ¢æˆ DataSet çš„æ ·ä¾‹å¦‚ä¸‹ï¼š 1234567891011BatchTableEnvironment tableEnv = BatchTableEnvironment.create(env);//æœ‰ä¸¤ä¸ªå­—æ®µ(nameã€age) çš„ TableTable table = ...//é€šè¿‡æŒ‡å®šä¸€ä¸ªç±»å°†è¡¨è½¬æ¢ä¸ºä¸€ä¸ª Row DataSetDataSet&lt;Row&gt; dsRow = tableEnv.toDataSet(table, Row.class);//å°†è¡¨è½¬æ¢ä¸º Tuple2&lt;String, Integer&gt; çš„ DataSetTupleTypeInfo&lt;Tuple2&lt;String, Integer&gt;&gt; tupleType = new TupleTypeInfo&lt;&gt;(Types.STRING(), Types.INT());DataSet&lt;Tuple2&lt;String, Integer&gt;&gt; dsTuple = tableEnv.toDataSet(table, tupleType); 5.2.2 æŸ¥è¯¢ä¼˜åŒ–Flink ä½¿ç”¨ Calcite æ¥ä¼˜åŒ–å’Œç¿»è¯‘æŸ¥è¯¢ï¼Œä»¥å‰çš„ planner ä¸ä¼šå»ä¼˜åŒ– join çš„é¡ºåºï¼Œè€Œæ˜¯æŒ‰ç…§æŸ¥è¯¢ä¸­å®šä¹‰çš„é¡ºåºå»æ‰§è¡Œã€‚é€šè¿‡æä¾›ä¸€ä¸ª CalciteConfig å¯¹è±¡æ¥è°ƒæ•´åœ¨ä¸åŒé˜¶æ®µåº”ç”¨çš„ä¼˜åŒ–è§„åˆ™é›†ï¼Œè¿™ä¸ªå¯ä»¥é€šè¿‡è°ƒç”¨ CalciteConfig.createBuilder() è·å¾—çš„ builder æ¥åˆ›å»ºï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡è°ƒç”¨tableEnv.getConfig.setCalciteConfig(calciteConfig) æ¥æä¾›ç»™ TableEnvironmentã€‚è€Œåœ¨ Blink planner ä¸­æ‰©å±•äº† Calcite æ¥æ‰§è¡Œå¤æ‚çš„æŸ¥è¯¢ä¼˜åŒ–ï¼Œè¿™åŒ…æ‹¬ä¸€ç³»åˆ—åŸºäºè§„åˆ™å’Œæˆæœ¬çš„ä¼˜åŒ–ï¼Œæ¯”å¦‚ï¼š åŸºäº Calcite çš„å­æŸ¥è¯¢å»ç›¸å…³æ€§ Project pruning Partition pruning Filter push-down åˆ é™¤å­è®¡åˆ’ä¸­çš„é‡å¤æ•°æ®ä»¥é¿å…é‡å¤è®¡ç®— é‡å†™ç‰¹æ®Šçš„å­æŸ¥è¯¢ï¼ŒåŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼š å°† IN å’Œ EXISTS è½¬æ¢ä¸º left semi-joins å°† NOT IN å’Œ NOT EXISTS è½¬æ¢ä¸º left anti-join é‡æ’åºå¯é€‰çš„ join é€šè¿‡å¯ç”¨ table.optimizer.join-reorder-enabled æ³¨æ„ï¼šIN/EXISTS/NOT IN/NOT EXISTS ç›®å‰åªæ”¯æŒå­æŸ¥è¯¢é‡å†™ä¸­çš„è¿æ¥æ¡ä»¶ã€‚ è§£é‡Š TableTable API æä¾›äº†ä¸€ç§æœºåˆ¶æ¥è§£é‡Šè®¡ç®— Table çš„é€»è¾‘å’Œä¼˜åŒ–æŸ¥è¯¢è®¡åˆ’ã€‚ä½ å¯ä»¥é€šè¿‡ TableEnvironment.explain(table) æˆ–è€… TableEnvironment.explain() æ–¹æ³•æ¥å®Œæˆã€‚explain(table) ä¼šè¿”å›ç»™å®šè®¡åˆ’çš„ Tableï¼Œexplain() ä¼šè¿”å›å¤šè·¯ Sink è®¡åˆ’çš„ç»“æœï¼ˆä¸»è¦ç”¨äº Blink plannerï¼‰ã€‚å®ƒè¿”å›ä¸€ä¸ªæè¿°ä¸‰ä¸ªè®¡åˆ’çš„å­—ç¬¦ä¸²ï¼š å…³ç³»æŸ¥è¯¢çš„æŠ½è±¡è¯­æ³•æ ‘ï¼Œå³æœªä¼˜åŒ–çš„é€»è¾‘æŸ¥è¯¢è®¡åˆ’ ä¼˜åŒ–çš„é€»è¾‘æŸ¥è¯¢è®¡åˆ’ å®é™…æ‰§è¡Œè®¡åˆ’ ä»¥ä¸‹ä»£ç æ¼”ç¤ºäº†ä¸€ä¸ª Table ç¤ºä¾‹ï¼š 1234567891011StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();StreamTableEnvironment tEnv = StreamTableEnvironment.create(env);DataStream&lt;Tuple2&lt;Integer, String&gt;&gt; stream1 = env.fromElements(new Tuple2&lt;&gt;(1, \"hello\"));DataStream&lt;Tuple2&lt;Integer, String&gt;&gt; stream2 = env.fromElements(new Tuple2&lt;&gt;(1, \"hello\"));Table table1 = tEnv.fromDataStream(stream1, \"count, word\");Table table2 = tEnv.fromDataStream(stream2, \"count, word\");Table table = table1.where(\"LIKE(word, 'F%')\").unionAll(table2);System.out.println(tEnv.explain(table)); é€šè¿‡ explain(table) æ–¹æ³•è¿”å›çš„ç»“æœï¼š 123456789101112131415161718192021222324252627282930== Abstract Syntax Tree ==LogicalUnion(all=[true]) LogicalFilter(condition=[LIKE($1, _UTF-16LE&apos;F%&apos;)]) FlinkLogicalDataStreamScan(id=[1], fields=[count, word]) FlinkLogicalDataStreamScan(id=[2], fields=[count, word])== Optimized Logical Plan ==DataStreamUnion(all=[true], union all=[count, word]) DataStreamCalc(select=[count, word], where=[LIKE(word, _UTF-16LE&apos;F%&apos;)]) DataStreamScan(id=[1], fields=[count, word]) DataStreamScan(id=[2], fields=[count, word])== Physical Execution Plan ==Stage 1 : Data Source content : collect elements with CollectionInputFormatStage 2 : Data Source content : collect elements with CollectionInputFormat Stage 3 : Operator content : from: (count, word) ship_strategy : REBALANCE Stage 4 : Operator content : where: (LIKE(word, _UTF-16LE&apos;F%&apos;)), select: (count, word) ship_strategy : FORWARD Stage 5 : Operator content : from: (count, word) ship_strategy : REBALANCE 5.2.3 æ•°æ®ç±»å‹5.2.4 æ—¶é—´å±æ€§Processing TimeEvent time5.2.5 SQL Connectorä½¿ç”¨ä»£ç  ä½¿ç”¨ YAML æ–‡ä»¶ ä½¿ç”¨ DDL 5.2.6 SQL Client5.2.7 HiveåŠ å…¥çŸ¥è¯†æ˜Ÿçƒå¯ä»¥çœ‹åˆ°ä¸Šé¢æ–‡ç« ï¼šhttps://t.zsxq.com/MNBEYvf 5.2.8 å°ç»“ä¸åæ€æœ¬ç« èŠ‚ç»§ç»­ä»‹ç»äº† Flink Table API &amp; SQL ä¸­çš„éƒ¨åˆ† APIï¼Œç„¶åè®²è§£äº† Flink ä¹‹å‰çš„ planner å’Œ Blink planner åœ¨æŸäº›ç‰¹æ€§ä¸Šé¢çš„åŒºåˆ«ï¼Œè¿˜è®²è§£äº† SQL Connectorï¼Œæœ€åä»‹ç»äº† SQL Client å’Œ Hiveã€‚ æœ¬ç« è®²è§£äº† Flink Table API &amp; SQL ç›¸å…³çš„æ¦‚è¿°ï¼Œå¦å¤–è¿˜ä»‹ç»äº†å®ƒä»¬çš„ API ä½¿ç”¨æ–¹å¼ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜å¯¹ Connectorsã€SQL Clientã€Hive åšäº†ä¸€å®šçš„è®²è§£ã€‚","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹â€”â€” Flink Table & SQL æ¦‚å¿µä¸é€šç”¨ API","date":"2021-07-26T16:00:00.000Z","path":"2021/07/27/flink-in-action-5.1/","text":"ç¬¬äº”ç«  â€”â€” Table API &amp; SQLFlink ä¸­é™¤äº† DataStream å’Œ DataSet APIï¼Œè¿˜æœ‰æ¯”è¾ƒé«˜çº§çš„ Table API &amp; SQLï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬ç®€åŒ–å¼€å‘çš„è¿‡ç¨‹ï¼Œèƒ½å¤Ÿå¿«è¯»çš„è¿ç”¨ Flink å»å®Œæˆä¸€äº›éœ€æ±‚ï¼Œæœ¬ç« å°†å¯¹ Flink Table API &amp; SQL è¿›è¡Œè®²è§£ï¼Œå¹¶å°†ä¸å…¶ä»–çš„ API ç»“åˆå¯¹æ¯”åˆ†æã€‚ 5.1 Flink Table &amp; SQL æ¦‚å¿µä¸é€šç”¨ API å‰é¢çš„å†…å®¹éƒ½æ˜¯è®²è§£ DataStream å’Œ DataSet API ç›¸å…³çš„ï¼Œåœ¨ 1.2.5 èŠ‚ä¸­è®²è§£ Flink API æ—¶æåŠåˆ° Flink çš„é«˜çº§ API â€”â€” Table API &amp; SQLï¼Œæœ¬èŠ‚å°†å¼€å§‹ Table &amp; SQL ä¹‹æ—…ã€‚ 5.1.1 æ–°å¢ Blink SQL æŸ¥è¯¢å¤„ç†å™¨åœ¨ Flink 1.9 ç‰ˆæœ¬ä¸­ï¼Œåˆè¿›äº†é˜¿é‡Œå·´å·´å¼€æºçš„ Blink ç‰ˆæœ¬ä¸­çš„å¤§é‡ä»£ç ï¼Œå…¶ä¸­æœ€é‡è¦çš„è´¡çŒ®å°±æ˜¯ Blink SQL äº†ã€‚åœ¨ Blink æçŒ®ç»™ Apache Flink ä¹‹åï¼Œç¤¾åŒºå°±è‡´åŠ›äºä¸º Table API &amp; SQL é›†æˆ Blink çš„æŸ¥è¯¢ä¼˜åŒ–å™¨å’Œ runtimeã€‚å…ˆæ¥çœ‹ä¸‹ 1.8 ç‰ˆæœ¬çš„ Flink Table é¡¹ç›®ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ 1.9 ç‰ˆæœ¬çš„ Flink Table é¡¹ç›®ç»“æ„å›¾å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å¯ä»¥å‘ç°æ–°å¢äº† flink-sql-parserã€flink-table-planner-blinkã€flink-table-runtime-blinkã€flink-table-uber-blink æ¨¡å—ï¼Œå¯¹ Flink Table æ¨¡å—çš„é‡æ„è¯¦ç»†å†…å®¹å¯ä»¥å‚è€ƒ FLIP-32ã€‚è¿™æ ·å¯¹äº Java å’Œ Scala API æ¨¡å—ã€ä¼˜åŒ–å™¨ä»¥åŠ runtime æ¨¡å—æ¥è¯´ï¼Œåˆ†å±‚æ›´æ¸…æ¥šï¼Œæ¥å£æ›´æ˜ç¡®ã€‚ å¦å¤– flink-table-planner-blink æ¨¡å—ä¸­å®ç°äº†æ–°çš„ä¼˜åŒ–å™¨æ¥å£ï¼Œæ‰€ä»¥ç°åœ¨æœ‰ä¸¤ä¸ªæ’ä»¶åŒ–çš„æŸ¥è¯¢å¤„ç†å™¨æ¥æ‰§è¡Œ Table API &amp; SQLï¼š1.9 ä»¥å‰çš„ Flink å¤„ç†å™¨å’Œæ–°çš„åŸºäº Blink çš„å¤„ç†å™¨ã€‚åŸºäº Blink çš„æŸ¥è¯¢å¤„ç†å™¨æä¾›äº†æ›´å¥½çš„ SQL è¦†ç›–ç‡ã€æ”¯æŒæ›´å¹¿æ³›çš„æŸ¥è¯¢ä¼˜åŒ–ã€æ”¹è¿›äº†ä»£ç ç”Ÿæˆæœºåˆ¶ã€é€šè¿‡è°ƒä¼˜ç®—å­çš„å®ç°æ¥æå‡æ‰¹å¤„ç†æŸ¥è¯¢çš„æ€§èƒ½ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒåŸºäº Blink çš„æŸ¥è¯¢å¤„ç†å™¨è¿˜æä¾›äº†æ›´å¼ºå¤§çš„æµå¤„ç†èƒ½åŠ›ï¼ŒåŒ…æ‹¬äº†ç¤¾åŒºä¸€äº›éå¸¸æœŸå¾…çš„æ–°åŠŸèƒ½ï¼ˆå¦‚ç»´è¡¨ Joinã€TopNã€å»é‡ï¼‰å’Œèšåˆåœºæ™¯ç¼“è§£æ•°æ®å€¾æ–œçš„ä¼˜åŒ–ï¼Œä»¥åŠå†…ç½®æ›´å¤šå¸¸ç”¨çš„å‡½æ•°ï¼Œå…·ä½“å¯ä»¥æŸ¥çœ‹ flink-table-runtime-blink ä»£ç ã€‚ç›®å‰æ•´ä¸ªæ¨¡å—çš„ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æ³¨æ„ï¼šä¸¤ä¸ªæŸ¥è¯¢å¤„ç†å™¨ä¹‹é—´çš„è¯­ä¹‰å’ŒåŠŸèƒ½å¤§éƒ¨åˆ†æ˜¯ä¸€è‡´çš„ï¼Œä½†æœªå®Œå…¨å¯¹é½ï¼Œå› ä¸ºåŸºäº Blink çš„æŸ¥è¯¢å¤„ç†å™¨è¿˜åœ¨ä¼˜åŒ–ä¸­ï¼Œæ‰€ä»¥åœ¨ 1.9 ç‰ˆæœ¬ä¸­é»˜è®¤æŸ¥è¯¢å¤„ç†å™¨è¿˜æ˜¯ 1.9 ä¹‹å‰çš„ç‰ˆæœ¬ã€‚å¦‚æœä½ æƒ³ä½¿ç”¨ Blink å¤„ç†å™¨çš„è¯ï¼Œå¯ä»¥åœ¨åˆ›å»º TableEnvironment æ—¶é€šè¿‡ EnvironmentSettings é…ç½®å¯ç”¨ã€‚è¢«é€‰æ‹©çš„å¤„ç†å™¨å¿…é¡»è¦åœ¨æ­£åœ¨æ‰§è¡Œçš„ Java è¿›ç¨‹çš„ç±»è·¯å¾„ä¸­ã€‚å¯¹äºé›†ç¾¤è®¾ç½®ï¼Œé»˜è®¤ä¸¤ä¸ªæŸ¥è¯¢å¤„ç†å™¨éƒ½ä¼šè‡ªåŠ¨åœ°åŠ è½½åˆ°ç±»è·¯å¾„ä¸­ã€‚å¦‚æœè¦åœ¨ IDE ä¸­è¿è¡Œä¸€ä¸ªæŸ¥è¯¢ï¼Œéœ€è¦åœ¨é¡¹ç›®ä¸­æ·»åŠ  planner ä¾èµ–ã€‚ 5.1.2 ä¸ºä»€ä¹ˆé€‰æ‹© Table API &amp; SQLï¼Ÿåœ¨ 1.2 èŠ‚ä¸­ä»‹ç»äº† Flink çš„ API æ˜¯åŒ…å«äº† Table API &amp; SQLï¼Œåœ¨ 1.3 èŠ‚ä¸­ä¹Ÿä»‹ç»äº†åœ¨ Flink 1.9 ä¸­é˜¿é‡Œå¼€æºçš„ Blink åˆ†æ”¯ä¸­çš„å¾ˆå¼ºå¤§çš„ SQL åŠŸèƒ½åˆå¹¶è¿› Flink ä¸»åˆ†æ”¯ï¼Œå¦å¤–é€šè¿‡é˜¿é‡Œ Blink ç›¸å…³çš„ä»‹ç»ï¼Œå¯ä»¥çŸ¥é“é˜¿é‡Œåœ¨ SQL åŠŸèƒ½è¿™å—æ˜¯åšäº†å¾ˆå¤šçš„å·¥ä½œã€‚ä»å‰é¢ç« èŠ‚çš„å†…å®¹å¯ä»¥å‘ç° Flink çš„ DataStreamï¼DataSet API çš„åŠŸèƒ½å·²ç»å¾ˆå…¨å¹¶ä¸”å¾ˆå¼ºå¤§äº†ï¼Œå¸¸è§å¤æ‚çš„æ•°æ®å¤„ç†é—®é¢˜ä¹Ÿéƒ½å¯ä»¥å¤„ç†ï¼Œé‚£ä¹ˆç¤¾åŒºä¸ºå•¥è¿˜åœ¨ä¸€ç›´æ¨å¹¿ Table API &amp; SQL å‘¢ï¼Ÿ å…¶å®é€šè¿‡è§‚å¯Ÿå…¶å®ƒçš„å¤§æ•°æ®ç»„ä»¶ï¼Œå°±ä¸ä¼šå¥½å¥‡äº†ï¼Œæ¯”å¦‚ Sparkã€Stormã€Beamã€Hive ã€KSQLï¼ˆé¢å‘ Kafka çš„ SQL å¼•æ“ï¼‰ã€Elasticsearchã€Phoenixï¼ˆä½¿ç”¨ SQL è¿›è¡Œ HBase æ•°æ®çš„æŸ¥è¯¢ï¼‰ç­‰ï¼Œå¯ä»¥å‘ç° SQL å·²ç»æˆä¸ºå„ä¸ªå¤§æ•°æ®ç»„ä»¶å¿…ä¸å¯å°‘çš„æ•°æ®æŸ¥è¯¢è¯­è¨€ï¼Œé‚£ä¹ˆ Flink ä½œä¸ºä¸€ä¸ªå¤§æ•°æ®å®æ—¶å¤„ç†å¼•æ“ï¼Œç¬”è€…å¯¹å…¶æ”¯æŒ SQL æŸ¥è¯¢æµæ•°æ®ä¹Ÿä¸è¶³ä¸ºå¥‡äº†ï¼Œä½†æ˜¯è¿˜æ˜¯æ¥ç¨å¾®ä»‹ç»ä¸€ä¸‹ Table API &amp; SQLã€‚ Table API &amp; SQL æ˜¯ä¸€ç§å…³ç³»å‹ APIï¼Œç”¨æˆ·å¯ä»¥åƒæ“ä½œæ•°æ®åº“ä¸€æ ·ç›´æ¥æ“ä½œæµæ•°æ®ï¼Œè€Œä¸å†éœ€è¦é€šè¿‡ DataStream API æ¥å†™å¾ˆå¤šä»£ç å®Œæˆè®¡ç®—éœ€æ±‚ï¼Œæ›´ä¸ç”¨æ‰‹åŠ¨å»è°ƒä¼˜ä½ å†™çš„ä»£ç ï¼Œå¦å¤– SQL æœ€å¤§çš„ä¼˜åŠ¿åœ¨äºå®ƒæ˜¯ä¸€é—¨å­¦ä¹ æˆæœ¬å¾ˆä½çš„è¯­è¨€ï¼Œæ™®åŠç‡å¾ˆé«˜ï¼Œç”¨æˆ·åŸºæ•°å¤§ï¼Œå’Œå…¶ä»–çš„ç¼–ç¨‹è¯­è¨€ç›¸æ¯”ï¼Œå®ƒçš„å…¥é—¨ç›¸å¯¹ç®€å•ã€‚ é™¤äº†ä¸Šé¢çš„åŸå› ï¼Œè¿˜æœ‰ä¸€ä¸ªåŸå› æ˜¯ï¼šå¯ä»¥å€ŸåŠ© Table API &amp; SQL ç»Ÿä¸€æµå¤„ç†å’Œæ‰¹å¤„ç†ï¼Œå› ä¸ºåœ¨ DataStreamï¼DataSet API ä¸­ï¼Œç”¨æˆ·å¼€å‘æµä½œä¸šå’Œæ‰¹ä½œä¸šéœ€è¦å»äº†è§£ä¸¤ç§ä¸åŒçš„ APIï¼Œè¿™å¯¹äºå…¬å¸æœ‰äº›å¼€å‘èƒ½åŠ›ä¸é«˜çš„æ•°æ®åˆ†æå¸ˆæ¥è¯´ï¼Œå­¦ä¹ æˆæœ¬æœ‰ç‚¹é«˜ï¼Œä»–ä»¬å…¶å®æ›´æ“…é•¿å†™ SQL æ¥åˆ†æã€‚Table API &amp; SQL åšåˆ°äº†æ‰¹ä¸æµä¸Šçš„æŸ¥è¯¢å…·æœ‰åŒæ ·çš„è¯­æ³•è¯­ä¹‰ï¼Œå› æ­¤ä¸ç”¨æ”¹ä»£ç å°±èƒ½åŒæ—¶åœ¨æ‰¹å’Œæµä¸Šæ‰§è¡Œã€‚ æ€»ç»“æ¥è¯´ï¼Œä¸ºä»€ä¹ˆé€‰æ‹© Table API &amp; SQLï¼š å£°æ˜å¼è¯­è¨€è¡¨è¾¾ä¸šåŠ¡é€»è¾‘ æ— éœ€ä»£ç ç¼–ç¨‹ â€”â€” æ˜“äºä¸Šæ‰‹ æŸ¥è¯¢èƒ½å¤Ÿè¢«æœ‰æ•ˆçš„ä¼˜åŒ– æŸ¥è¯¢å¯ä»¥é«˜æ•ˆçš„æ‰§è¡Œ 5.1.3 Flink Table é¡¹ç›®æ¨¡å—åœ¨ä¸Šæ–‡ä¸­æåŠåˆ° Flink Table åœ¨ 1.8 å’Œ 1.9 çš„åŒºåˆ«ï¼Œè¿™é‡Œè¿˜æ˜¯è¦å†è®²è§£ä¸€ä¸‹è¿™å‡ ä¸ªä¾èµ–ï¼Œå› ä¸ºåªæœ‰äº†è§£æ¸…æ¥šäº†ä¹‹åï¼Œæˆ‘ä»¬åœ¨åé¢å¼€å‘çš„æ—¶å€™æ‰èƒ½å¤Ÿæ¸…æ¥šæŒ‘é€‰å“ªç§ä¾èµ–ã€‚å®ƒæœ‰å¦‚ä¸‹å‡ ä¸ªæ¨¡å—ï¼š flink-table-commonï¼štable ä¸­çš„å…¬å…±æ¨¡å—ï¼Œå¯ä»¥ç”¨äºé€šè¿‡è‡ªå®šä¹‰ functionï¼Œformat ç­‰æ¥æ‰©å±• Table ç”Ÿæ€ç³»ç»Ÿ flink-table-api-javaï¼šæ”¯æŒä½¿ç”¨ Java è¯­è¨€ï¼Œçº¯ Tableï¼†SQL API flink-table-api-scalaï¼šæ”¯æŒä½¿ç”¨ Scala è¯­è¨€ï¼Œçº¯ Tableï¼†SQL API flink-table-api-java-bridgeï¼šæ”¯æŒä½¿ç”¨ Java è¯­è¨€ï¼ŒåŒ…å« DataStream/DataSet API çš„ Tableï¼†SQL APIï¼ˆæ¨èä½¿ç”¨ï¼‰ flink-table-api-scala-bridgeï¼šæ”¯æŒä½¿ç”¨ Scala è¯­è¨€ï¼Œå¸¦æœ‰ DataStream/DataSet API çš„ Tableï¼†SQL APIï¼ˆæ¨èä½¿ç”¨ï¼‰ flink-sql-parserï¼šSQL è¯­å¥è§£æå±‚ï¼Œä¸»è¦ä¾èµ– calcite flink-table-plannerï¼šTable ç¨‹åºçš„ planner å’Œ runtime flink-table-uberï¼šå°†ä¸Šè¯‰æ¨¡å—æ‰“æˆä¸€ä¸ª fat jarï¼Œåœ¨ lib ç›®å½•ä¸‹ flink-table-planner-blinkï¼šBlink çš„ Table ç¨‹åºçš„ plannerï¼ˆé˜¿é‡Œå¼€æºçš„ç‰ˆæœ¬ï¼‰ flink-table-runtime-blinkï¼šBlink çš„ Table ç¨‹åºçš„ runtimeï¼ˆé˜¿é‡Œå¼€æºçš„ç‰ˆæœ¬ï¼‰ flink-table-uber-blinkï¼šå°† Blink ç‰ˆæœ¬çš„ planner å’Œ runtime ä¸å‰é¢æ¨¡å—ï¼ˆé™¤ flink-table-planner æ¨¡å—ï¼‰æ‰“æˆä¸€ä¸ª fat jarï¼Œåœ¨ lib ç›®å½•ä¸‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ flink-sql-clientï¼šSQL å®¢æˆ·ç«¯ 5.1.4 ä¸¤ç§ planner ä¹‹é—´çš„åŒºåˆ«ä¸Šé¢è®²äº†ä¸¤ç§ä¸åŒçš„ planner ä¹‹é—´åŒ…å«çš„æ¨¡å—æœ‰ç‚¹åŒºåˆ«ï¼Œä½†æ˜¯å…·ä½“æœ‰ä»€ä¹ˆåŒºåˆ«å¦‚ä¸‹æ‰€ç¤ºï¼š Blink planner å°†æ‰¹å¤„ç†ä½œä¸šè§†ä¸ºæµçš„ä¸€ç§ç‰¹æ®Šæƒ…å†µã€‚å› æ­¤ä¸æ”¯æŒ Table å’Œ DataSet ä¹‹é—´çš„è½¬æ¢ï¼Œæ‰¹å¤„ç†ä½œä¸šä¼šè½¬æ¢æˆ DataStream ç¨‹åºï¼Œè€Œä¸ä¼šè½¬æ¢æˆ DataSet ç¨‹åºï¼Œæµä½œä¸šè¿˜æ˜¯è½¬æ¢æˆ DataStream ç¨‹åºã€‚ Blink planner ä¸æ”¯æŒ BatchTableSourceï¼Œè€Œæ˜¯ä½¿ç”¨æœ‰ç•Œçš„ï¼ˆboundedï¼‰ StreamTableSource ä»£æ›¿å®ƒã€‚ Blink planner ä»…æ”¯æŒå…¨æ–°çš„ Catalogï¼Œä¸æ”¯æŒå·²ç»åºŸå¼ƒçš„ ExternalCatalogã€‚ ä»¥å‰çš„ planner ä¸­ FilterableTableSource çš„å®ç°ä¸ç°åœ¨çš„ Blink planner æœ‰å†²çªï¼Œåœ¨ä»¥å‰çš„ planner ä¸­æ˜¯å åŠ  PlannerExpressionsï¼ˆåœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­ä¼šç§»é™¤ï¼‰ï¼Œè€Œåœ¨ Blink planner ä¸­æ˜¯ Expressionsã€‚ åŸºäºå­—ç¬¦ä¸²çš„ KV é”®å€¼é…ç½®é€‰é¡¹ä»…å¯ä»¥åœ¨ Blink planner ä¸­ä½¿ç”¨ã€‚ PlannerConfig çš„å®ç°ï¼ˆCalciteConfigï¼‰åœ¨ä¸¤ç§ planner ä¸­ä¸åŒã€‚ Blink planner ä¼šå°†å¤šä¸ª sink ä¼˜åŒ–åœ¨åŒä¸€ä¸ª DAG ä¸­ï¼ˆåªåœ¨ TableEnvironment ä¸­æ”¯æŒï¼ŒStreamTableEnvironment ä¸­ä¸æ”¯æŒï¼‰ï¼Œè€Œä»¥å‰çš„ planner æ˜¯æ¯ä¸ª sink éƒ½æœ‰ä¸€ä¸ª DAG ä¸­ï¼Œç›¸äº’ç‹¬ç«‹çš„ã€‚ ä»¥å‰çš„ planner ä¸æ”¯æŒ catalog ç»Ÿè®¡ï¼Œè€Œ Blink planner æ”¯æŒã€‚ åœ¨äº†è§£åˆ°äº†ä¸¤ç§ planner çš„åŒºåˆ«åï¼Œæ¥ä¸‹æ¥å¼€å§‹ Flink Table API &amp; SQL ä¹‹æ—…ã€‚ 5.1.5 æ·»åŠ é¡¹ç›®ä¾èµ–å› ä¸ºåœ¨ Flink 1.9 ç‰ˆæœ¬ä¸­æœ‰ä¸¤ä¸ª plannerï¼Œæ‰€ä»¥å¾—æ ¹æ®ä½ ä½¿ç”¨çš„ planner æ¥é€‰æ‹©å¯¹åº”çš„ä¾èµ–ï¼Œå‡è®¾ä½ é€‰æ‹©çš„æ˜¯æœ€æ–°çš„ Blink ç‰ˆæœ¬ï¼Œé‚£ä¹ˆæ·»åŠ ä¸‹é¢çš„ä¾èµ–ï¼š 12345&lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-table-planner-blink_$&#123;scala.binary.version&#125;&lt;/artifactId&gt; &lt;version&gt;$&#123;flink.version&#125;&lt;/version&gt;&lt;/dependency&gt; å¦‚æœæ˜¯ä»¥å‰çš„ plannerï¼Œåˆ™ä½¿ç”¨ä¸‹é¢è¿™ä¸ªä¾èµ–ï¼š 12345&lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-table-planner_$&#123;scala.binary.version&#125;&lt;/artifactId&gt; &lt;version&gt;$&#123;flink.version&#125;&lt;/version&gt;&lt;/dependency&gt; å¦‚æœè¦è‡ªå®šä¹‰ format æ ¼å¼æˆ–è€…è‡ªå®šä¹‰ functionï¼Œåˆ™éœ€è¦æ·»åŠ  flink-table-common ä¾èµ–ï¼š 12345&lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-table-common&lt;/artifactId&gt; &lt;version&gt;$&#123;flink.version&#125;&lt;/version&gt;&lt;/dependency&gt; 5.1.6 åˆ›å»ºä¸€ä¸ª TableEnvironmentTableEnvironment æ˜¯ Table API å’Œ SQL çš„ç»Ÿç§°ï¼Œå®ƒè´Ÿè´£çš„å†…å®¹æœ‰ï¼š åœ¨å†…éƒ¨çš„ catalog æ³¨å†Œ Table æ³¨å†Œä¸€ä¸ªå¤–éƒ¨çš„ catalog æ‰§è¡Œ SQL æŸ¥è¯¢ æ³¨å†Œç”¨æˆ·è‡ªå®šä¹‰çš„ function å°† DataStream æˆ–è€… DataSet è½¬æ¢æˆ Table ä¿æŒå¯¹ ExecutionEnvironment å’Œ StreamExecutionEnvironment çš„å¼•ç”¨ Table æ€»æ˜¯ä¼šç»‘å®šåœ¨ä¸€ä¸ªæŒ‡å®šçš„ TableEnvironmentï¼Œä¸èƒ½åœ¨åŒä¸€ä¸ªæŸ¥è¯¢ä¸­ç»„åˆä¸åŒ TableEnvironment çš„ Tableï¼Œæ¯”å¦‚ join æˆ– union æ“ä½œã€‚ä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‡ ç§é™æ€æ–¹æ³•åˆ›å»º TableEnvironmentã€‚ 1234567891011121314151617181920212223//åˆ›å»º StreamTableEnvironmentstatic StreamTableEnvironment create(StreamExecutionEnvironment executionEnvironment) &#123; return create(executionEnvironment, EnvironmentSettings.newInstance().build());&#125;static StreamTableEnvironment create(StreamExecutionEnvironment executionEnvironment, EnvironmentSettings settings) &#123; return StreamTableEnvironmentImpl.create(executionEnvironment, settings, new TableConfig());&#125;/** @deprecated */@Deprecatedstatic StreamTableEnvironment create(StreamExecutionEnvironment executionEnvironment, TableConfig tableConfig) &#123; return StreamTableEnvironmentImpl.create(executionEnvironment, EnvironmentSettings.newInstance().build(), tableConfig);&#125;//åˆ›å»º BatchTableEnvironmentstatic BatchTableEnvironment create(ExecutionEnvironment executionEnvironment) &#123; return create(executionEnvironment, new TableConfig());&#125;static BatchTableEnvironment create(ExecutionEnvironment executionEnvironment, TableConfig tableConfig) &#123; //&#125; ä½ éœ€è¦æ ¹æ®ä½ çš„ç¨‹åºæ¥ä½¿ç”¨å¯¹åº”çš„ TableEnvironmentï¼Œæ˜¯ BatchTableEnvironment è¿˜æ˜¯ StreamTableEnvironmentã€‚é»˜è®¤ä¸¤ä¸ª planner éƒ½æ˜¯åœ¨ Flink çš„å®‰è£…ç›®å½•ä¸‹ lib æ–‡ä»¶å¤¹ä¸­å­˜åœ¨çš„ï¼Œæ‰€ä»¥åº”è¯¥åœ¨ä½ çš„ç¨‹åºä¸­æŒ‡å®šä½¿ç”¨å“ªç§ plannerã€‚ 1234567891011121314151617181920212223242526272829// Flink Streaming queryimport org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;import org.apache.flink.table.api.EnvironmentSettings;import org.apache.flink.table.api.java.StreamTableEnvironment;EnvironmentSettings fsSettings = EnvironmentSettings.newInstance().useOldPlanner().inStreamingMode().build();StreamExecutionEnvironment fsEnv = StreamExecutionEnvironment.getExecutionEnvironment();StreamTableEnvironment fsTableEnv = StreamTableEnvironment.create(fsEnv, fsSettings);//æˆ–è€… TableEnvironment fsTableEnv = TableEnvironment.create(fsSettings);// Flink Batch queryimport org.apache.flink.api.java.ExecutionEnvironment;import org.apache.flink.table.api.java.BatchTableEnvironment;ExecutionEnvironment fbEnv = ExecutionEnvironment.getExecutionEnvironment();BatchTableEnvironment fbTableEnv = BatchTableEnvironment.create(fbEnv);// Blink Streaming queryimport org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;import org.apache.flink.table.api.EnvironmentSettings;import org.apache.flink.table.api.java.StreamTableEnvironment;StreamExecutionEnvironment bsEnv = StreamExecutionEnvironment.getExecutionEnvironment();EnvironmentSettings bsSettings = EnvironmentSettings.newInstance().useBlinkPlanner().inStreamingMode().build();StreamTableEnvironment bsTableEnv = StreamTableEnvironment.create(bsEnv, bsSettings);//æˆ–è€… TableEnvironment bsTableEnv = TableEnvironment.create(bsSettings);// Blink Batch queryimport org.apache.flink.table.api.EnvironmentSettings;import org.apache.flink.table.api.TableEnvironment;EnvironmentSettings bbSettings = EnvironmentSettings.newInstance().useBlinkPlanner().inBatchMode().build();TableEnvironment bbTableEnv = TableEnvironment.create(bbSettings); å¦‚æœåœ¨ lib ç›®å½•ä¸‹åªå­˜åœ¨ä¸€ä¸ª plannerï¼Œåˆ™å¯ä»¥ä½¿ç”¨ useAnyPlanner æ¥åˆ›å»ºæŒ‡å®šçš„ EnvironmentSettingsã€‚ 5.1.7 Table API &amp; SQL åº”ç”¨ç¨‹åºçš„ç»“æ„æ‰¹å¤„ç†å’Œæµå¤„ç†çš„ Table API &amp; SQL ä½œä¸šéƒ½æœ‰ç›¸åŒçš„æ¨¡å¼ï¼Œå®ƒä»¬çš„ä»£ç ç»“æ„å¦‚ä¸‹ï¼š 123456789101112131415161718192021//æ ¹æ®å‰é¢å†…å®¹åˆ›å»ºä¸€ä¸ª TableEnvironmentï¼ŒæŒ‡å®šæ˜¯æ‰¹ä½œä¸šè¿˜æ˜¯æµä½œä¸šTableEnvironment tableEnv = ...; //ç”¨ä¸‹é¢çš„å…¶ä¸­ä¸€ç§æ–¹å¼æ³¨å†Œä¸€ä¸ª TabletableEnv.registerTable(\"table1\", ...) tableEnv.registerTableSource(\"table2\", ...); tableEnv.registerExternalCatalog(\"extCat\", ...);//æ³¨å†Œä¸€ä¸ª TableSinktableEnv.registerTableSink(\"outputTable\", ...);//æ ¹æ®ä¸€ä¸ª Table API æŸ¥è¯¢åˆ›å»ºä¸€ä¸ª TableTable tapiResult = tableEnv.scan(\"table1\").select(...);//æ ¹æ®ä¸€ä¸ª SQL æŸ¥è¯¢åˆ›å»ºä¸€ä¸ª TableTable sqlResult = tableEnv.sqlQuery(\"SELECT ... FROM table2 ... \");//å°† Table API æˆ–è€… SQL çš„ç»“æœå‘é€ç»™ TableSinktapiResult.insertInto(\"outputTable\");//è¿è¡ŒtableEnv.execute(\"java_job\"); 5.1.8 Catalog ä¸­æ³¨å†Œ TableTable æœ‰ä¸¤ç§ç±»å‹ï¼Œè¾“å…¥è¡¨å’Œè¾“å‡ºè¡¨ï¼Œå¯ä»¥åœ¨ Table API &amp; SQL æŸ¥è¯¢ä¸­å¼•ç”¨è¾“å…¥è¡¨å¹¶æä¾›è¾“å…¥æ•°æ®ï¼Œè¾“å‡ºè¡¨å¯ä»¥ç”¨äºå°† Table API &amp; SQL çš„æŸ¥è¯¢ç»“æœå‘é€åˆ°å¤–éƒ¨ç³»ç»Ÿã€‚è¾“å‡ºè¡¨å¯ä»¥é€šè¿‡ TableSink æ¥æ³¨å†Œï¼Œè¾“å…¥è¡¨å¯ä»¥ä»å„ç§æ•°æ®æºè¿›è¡Œæ³¨å†Œï¼š å·²ç»å­˜åœ¨çš„ Table å¯¹è±¡ï¼Œé€šè¿‡æ˜¯ Table API æˆ– SQL æŸ¥è¯¢çš„ç»“æœ è¿æ¥äº†å¤–éƒ¨ç³»ç»Ÿçš„ TableSourceï¼Œæ¯”å¦‚æ–‡ä»¶ã€æ•°æ®åº“ã€MQ ä» DataStream æˆ– DataSet ç¨‹åºä¸­è¿”å›çš„ DataStream å’Œ DataSet æ³¨å†Œ Tableåœ¨ TableEnvironment ä¸­å¯ä»¥åƒä¸‹é¢è¿™æ ·æ³¨å†Œä¸€ä¸ª Tableï¼š 12345678//åˆ›å»ºä¸€ä¸ª TableEnvironmentTableEnvironment tableEnv = ...; // see \"Create a TableEnvironment\" section//projTable æ˜¯ä¸€ä¸ªç®€å•æŸ¥è¯¢çš„ç»“æœTable projTable = tableEnv.scan(\"X\").select(...);//å°† projTable è¡¨æ³¨å†Œä¸º projectedTable è¡¨tableEnv.registerTable(\"projectedTable\", projTable); æ³¨å†Œ TableSourceæ³¨å†Œ TableSink5.1.9 æ³¨å†Œå¤–éƒ¨çš„ Catalog5.1.10 æŸ¥è¯¢ TableTable APISQLTable API &amp; SQL5.1.11 æäº¤ Table5.1.12 ç¿»è¯‘å¹¶æ‰§è¡ŒæŸ¥è¯¢åŠ å…¥çŸ¥è¯†æ˜Ÿçƒå¯ä»¥çœ‹åˆ°ä¸Šé¢æ–‡ç« ï¼šhttps://t.zsxq.com/MNBEYvf 5.1.13 å°ç»“ä¸åæ€æœ¬èŠ‚ä»‹ç»äº† Flink æ–°çš„ plannerï¼Œç„¶åè¯¦ç»†çš„å’Œä¹‹å‰çš„ planner åšäº†å¯¹æ¯”ï¼Œç„¶åå¯¹ Table API &amp; SQL ä¸­çš„æ¦‚å¿µåšäº†ä»‹ç»ï¼Œè¿˜é€šè¿‡æ ·ä¾‹å»ä»‹ç»äº†å®ƒä»¬çš„é€šç”¨ APIã€‚","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹â€”â€” Flink Checkpoint å’Œ Savepoint çš„åŒºåˆ«åŠå…¶é…ç½®ä½¿ç”¨","date":"2021-07-25T16:00:00.000Z","path":"2021/07/26/flink-in-action-4.3/","text":"4.3 Flink Checkpoint å’Œ Savepoint çš„åŒºåˆ«åŠå…¶é…ç½®ä½¿ç”¨Checkpoint åœ¨ Flink ä¸­æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„ Featureï¼ŒCheckpoint ä½¿ Flink çš„çŠ¶æ€å…·æœ‰è‰¯å¥½çš„å®¹é”™æ€§ï¼Œé€šè¿‡ Checkpoint æœºåˆ¶ï¼ŒFlink å¯ä»¥å¯¹ä½œä¸šçš„çŠ¶æ€å’Œè®¡ç®—ä½ç½®è¿›è¡Œæ¢å¤ã€‚æœ¬èŠ‚ä¸»è¦è®²è¿°åœ¨ Flink ä¸­ Checkpoint å’Œ Savepoint çš„ä½¿ç”¨æ–¹å¼åŠå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«ã€‚ 4.3.1 Checkpoint ç®€ä»‹åŠä½¿ç”¨åœ¨ Flink ä»»åŠ¡è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œä¸ºäº†ä¿éšœæ•…éšœå®¹é”™ï¼ŒFlink éœ€è¦å¯¹çŠ¶æ€è¿›è¡Œå¿«ç…§ã€‚Flink å¯ä»¥ä» Checkpoint ä¸­æ¢å¤æµçš„çŠ¶æ€å’Œä½ç½®ï¼Œä»è€Œä½¿å¾—åº”ç”¨ç¨‹åºå‘ç”Ÿæ•…éšœåèƒ½å¤Ÿå¾—åˆ°ä¸æ— æ•…éšœæ‰§è¡Œç›¸åŒçš„è¯­ä¹‰ã€‚ Flink çš„ Checkpoint æœ‰ä»¥ä¸‹å…ˆå†³æ¡ä»¶ï¼š éœ€è¦å…·æœ‰æŒä¹…æ€§ä¸”æ”¯æŒé‡æ”¾ä¸€å®šæ—¶é—´èŒƒå›´å†…æ•°æ®çš„æ•°æ®æºã€‚ä¾‹å¦‚ï¼šKafkaã€RabbitMQ ç­‰ã€‚è¿™é‡Œä¸ºä»€ä¹ˆè¦æ±‚æ”¯æŒé‡æ”¾ä¸€å®šæ—¶é—´èŒƒå›´å†…çš„æ•°æ®å‘¢ï¼Ÿå› ä¸º Flink çš„å®¹é”™æœºåˆ¶å†³å®šäº†ï¼Œå½“ Flink ä»»åŠ¡å¤±è´¥åä¼šè‡ªåŠ¨ä»æœ€è¿‘ä¸€æ¬¡æˆåŠŸçš„ Checkpoint å¤„æ¢å¤ä»»åŠ¡ï¼Œæ­¤æ—¶å¯èƒ½éœ€è¦æŠŠä»»åŠ¡å¤±è´¥å‰æ¶ˆè´¹çš„éƒ¨åˆ†æ•°æ®å†æ¶ˆè´¹ä¸€éï¼Œæ‰€ä»¥å¿…é¡»è¦æ±‚æ•°æ®æºæ”¯æŒé‡æ”¾ã€‚å‡å¦‚ä¸€ä¸ªFlink ä»»åŠ¡æ¶ˆè´¹ Kafka å¹¶å°†æ•°æ®å†™å…¥åˆ° MySQL ä¸­ï¼Œä»»åŠ¡ä» Kafka è¯»å–åˆ°æ•°æ®ï¼Œè¿˜æœªå°†æ•°æ®è¾“å‡ºåˆ° MySQL æ—¶ä»»åŠ¡çªç„¶å¤±è´¥äº†ï¼Œæ­¤æ—¶å¦‚æœ Kafka ä¸æ”¯æŒé‡æ”¾ï¼Œå°±ä¼šé€ æˆè¿™éƒ¨åˆ†æ•°æ®æ°¸è¿œä¸¢å¤±äº†ã€‚æ”¯æŒé‡æ”¾æ•°æ®çš„æ•°æ®æºå¯ä»¥ä¿éšœä»»åŠ¡æ¶ˆè´¹å¤±è´¥åï¼Œèƒ½å¤Ÿé‡æ–°æ¶ˆè´¹æ¥ä¿éšœä»»åŠ¡ä¸ä¸¢æ•°æ®ã€‚ éœ€è¦ä¸€ä¸ªèƒ½ä¿å­˜çŠ¶æ€çš„æŒä¹…åŒ–å­˜å‚¨ä»‹è´¨ï¼Œä¾‹å¦‚ï¼šHDFSã€S3 ç­‰ã€‚å½“ Flink ä»»åŠ¡å¤±è´¥åï¼Œè‡ªåŠ¨ä» Checkpoint å¤„æ¢å¤ï¼Œä½†æ˜¯å¦‚æœ Checkpoint æ—¶ä¿å­˜çš„çŠ¶æ€ä¿¡æ¯å¿«ç…§å…¨ä¸¢äº†ï¼Œé‚£å°±ä¼šå½±å“ Flink ä»»åŠ¡çš„æ­£å¸¸æ¢å¤ã€‚å°±å¥½æ¯”æˆ‘ä»¬çœ‹ä¹¦æ—¶ç»å¸¸ä½¿ç”¨ä¹¦ç­¾æ¥è®°å½•å½“å‰çœ‹åˆ°çš„é¡µç ï¼Œå½“ä¸‹æ¬¡çœ‹ä¹¦æ—¶æ‰¾åˆ°ä¹¦ç­¾çš„ä½ç½®ç»§ç»­é˜…è¯»å³å¯ï¼Œä½†æ˜¯å¦‚æœä¹¦ç­¾ä¸‰å¤©ä¸¤å¤´ç»å¸¸ä¸¢ï¼Œé‚£æˆ‘ä»¬å°±æ— æ³•é€šè¿‡ä¹¦ç­¾æ¥æ¢å¤é˜…è¯»ã€‚ Flink ä¸­ Checkpoint æ˜¯é»˜è®¤å…³é—­çš„ï¼Œå¯¹äºéœ€è¦ä¿éšœ At Least Once å’Œ Exactly Once è¯­ä¹‰çš„ä»»åŠ¡ï¼Œå¼ºçƒˆå»ºè®®å¼€å¯ Checkpointï¼Œå¯¹äºä¸¢ä¸€å°éƒ¨åˆ†æ•°æ®ä¸æ•æ„Ÿçš„ä»»åŠ¡ï¼Œå¯ä»¥ä¸å¼€å¯ Checkpointï¼Œä¾‹å¦‚ï¼šä¸€äº›æ¨èç›¸å…³çš„ä»»åŠ¡ä¸¢ä¸€å°éƒ¨åˆ†æ•°æ®å¹¶ä¸ä¼šå½±å“æ¨èæ•ˆæœã€‚ä¸‹é¢æ¥ä»‹ç» Checkpoint å…·ä½“å¦‚ä½•ä½¿ç”¨ã€‚ é¦–å…ˆè°ƒç”¨ StreamExecutionEnvironment çš„æ–¹æ³• enableCheckpointing(n) æ¥å¼€å¯ Checkpointï¼Œå‚æ•° n ä»¥æ¯«ç§’ä¸ºå•ä½è¡¨ç¤º Checkpoint çš„æ—¶é—´é—´éš”ã€‚Checkpoint é…ç½®ç›¸å…³çš„ Java ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š 12345678910111213141516171819202122232425262728StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutinEnvironment();// å¼€å¯ Checkpointï¼Œæ¯ 1000æ¯«ç§’è¿›è¡Œä¸€æ¬¡ Checkpointenv.enableCheckpointing(1000);// Checkpoint è¯­ä¹‰è®¾ç½®ä¸º EXACTLY_ONCEenv.getCheckpointConfig().setCheckpointingMode(CheckpointingMode.EXACTLY_ONCE);// CheckPoint çš„è¶…æ—¶æ—¶é—´env.getCheckpointConfig().setCheckpointTimeout(60000);// åŒä¸€æ—¶é—´ï¼Œåªå…è®¸ æœ‰ 1 ä¸ª Checkpoint åœ¨å‘ç”Ÿenv.getCheckpointConfig().setMaxConcurrentCheckpoints(1);// ä¸¤æ¬¡ Checkpoint ä¹‹é—´çš„æœ€å°æ—¶é—´é—´éš”ä¸º 500 æ¯«ç§’env.getCheckpointConfig().setMinPauseBetweenCheckpoints(500);// å½“ Flink ä»»åŠ¡å–æ¶ˆæ—¶ï¼Œä¿ç•™å¤–éƒ¨ä¿å­˜çš„ CheckPoint ä¿¡æ¯env.getCheckpointConfig().enableExternalizedCheckpoints(ExternalizedCheckpointCleanup.RETAIN_ON_CANCELLATION);// å½“æœ‰è¾ƒæ–°çš„ Savepoint æ—¶ï¼Œä½œä¸šä¹Ÿä¼šä» Checkpoint å¤„æ¢å¤env.getCheckpointConfig().setPreferCheckpointForRecovery(true);// ä½œä¸šæœ€å¤šå…è®¸ Checkpoint å¤±è´¥ 1 æ¬¡ï¼ˆflink 1.9 å¼€å§‹æ”¯æŒï¼‰env.getCheckpointConfig().setTolerableCheckpointFailureNumber(1);// Checkpoint å¤±è´¥åï¼Œæ•´ä¸ª Flink ä»»åŠ¡ä¹Ÿä¼šå¤±è´¥ï¼ˆflink 1.9 ä¹‹å‰ï¼‰env.getCheckpointConfig.setFailTasksOnCheckpointingErrors(true) ä»¥ä¸Š Checkpoint ç›¸å…³çš„å‚æ•°æè¿°å¦‚ä¸‹æ‰€ç¤ºï¼š Checkpoint è¯­ä¹‰ï¼š EXACTLY_ONCE æˆ– AT_LEAST_ONCEï¼ŒEXACTLY_ONCE è¡¨ç¤ºæ‰€æœ‰è¦æ¶ˆè´¹çš„æ•°æ®è¢«æ°å¥½å¤„ç†ä¸€æ¬¡ï¼Œå³æ‰€æœ‰æ•°æ®æ—¢ä¸ä¸¢æ•°æ®ä¹Ÿä¸é‡å¤æ¶ˆè´¹ï¼›AT_LEAST_ONCE è¡¨ç¤ºè¦æ¶ˆè´¹çš„æ•°æ®è‡³å°‘å¤„ç†ä¸€æ¬¡ï¼Œå¯èƒ½ä¼šé‡å¤æ¶ˆè´¹ã€‚ Checkpoint è¶…æ—¶æ—¶é—´ï¼šå¦‚æœ Checkpoint æ—¶é—´è¶…è¿‡äº†è®¾å®šçš„è¶…æ—¶æ—¶é—´ï¼Œåˆ™ Checkpoint å°†ä¼šè¢«ç»ˆæ­¢ã€‚ åŒæ—¶è¿›è¡Œçš„ Checkpoint æ•°é‡ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ä¸€ä¸ª Checkpoint åœ¨è¿›è¡Œæ—¶ï¼ŒJobManager å°†ä¸ä¼šè§¦å‘ä¸‹ä¸€ä¸ª Checkpointï¼Œä½† Flink å…è®¸å¤šä¸ª Checkpoint åŒæ—¶åœ¨å‘ç”Ÿã€‚ ä¸¤æ¬¡ Checkpoint ä¹‹é—´çš„æœ€å°æ—¶é—´é—´éš”ï¼šä»ä¸Šä¸€æ¬¡ Checkpoint ç»“æŸåˆ°ä¸‹ä¸€æ¬¡ Checkpoint å¼€å§‹ï¼Œä¸­é—´çš„é—´éš”æ—¶é—´ã€‚ä¾‹å¦‚ï¼Œenv.enableCheckpointing(60000) è¡¨ç¤º 1 åˆ†é’Ÿè§¦å‘ä¸€æ¬¡ Checkpointï¼ŒåŒæ—¶å†è®¾ç½®ä¸¤æ¬¡ Checkpoint ä¹‹é—´çš„æœ€å°æ—¶é—´é—´éš”ä¸º 30 ç§’ï¼Œå‡å¦‚ä»»åŠ¡è¿è¡Œè¿‡ç¨‹ä¸­ä¸€æ¬¡ Checkpoint å°±ç”¨äº†50sï¼Œé‚£ä¹ˆç­‰ Checkpoint ç»“æŸåï¼Œç†è®ºæ¥è®²å†è¿‡ 10s å°±è¦å¼€å§‹ä¸‹ä¸€æ¬¡ Checkpoint äº†ï¼Œä½†æ˜¯ç”±äºè®¾ç½®äº†æœ€å°æ—¶é—´é—´éš”ä¸º30sï¼Œæ‰€ä»¥éœ€è¦å†è¿‡ 30s åï¼Œä¸‹æ¬¡ Checkpoint æ‰å¼€å§‹ã€‚æ³¨ï¼šå¦‚æœé…ç½®äº†è¯¥å‚æ•°å°±å†³å®šäº†åŒæ—¶è¿›è¡Œçš„ Checkpoint æ•°é‡åªèƒ½ä¸º 1ã€‚ å½“ä»»åŠ¡è¢«å–æ¶ˆæ—¶ï¼Œå¤–éƒ¨ Checkpoint ä¿¡æ¯æ˜¯å¦è¢«æ¸…ç†ï¼šCheckpoint åœ¨é»˜è®¤çš„æƒ…å†µä¸‹ä»…ç”¨äºæ¢å¤è¿è¡Œå¤±è´¥çš„ Flink ä»»åŠ¡ï¼Œå½“ä»»åŠ¡æ‰‹åŠ¨å–æ¶ˆæ—¶ Checkpoint äº§ç”Ÿçš„çŠ¶æ€ä¿¡æ¯å¹¶ä¸ä¿ç•™ã€‚å½“ç„¶å¯ä»¥é€šè¿‡è¯¥é…ç½®æ¥ä¿ç•™å¤–éƒ¨çš„ Checkpoint çŠ¶æ€ä¿¡æ¯ï¼Œè¿™äº›è¢«ä¿ç•™çš„çŠ¶æ€ä¿¡æ¯åœ¨ä½œä¸šæ‰‹åŠ¨å–æ¶ˆæ—¶ä¸ä¼šè¢«æ¸…é™¤ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨è¯¥çŠ¶æ€ä¿¡æ¯æ¥æ¢å¤ Flink ä»»åŠ¡ï¼Œå¯¹äºéœ€è¦ä»çŠ¶æ€æ¢å¤çš„ä»»åŠ¡å¼ºçƒˆå»ºè®®é…ç½®ä¸ºå¤–éƒ¨ Checkpoint çŠ¶æ€ä¿¡æ¯ä¸æ¸…ç†ã€‚å¯é€‰æ‹©çš„é…ç½®é¡¹ä¸ºï¼š ExternalizedCheckpointCleanup.RETAIN_ON_CANCELLATIONï¼šå½“ä½œä¸šæ‰‹åŠ¨å–æ¶ˆæ—¶ï¼Œä¿ç•™ä½œä¸šçš„ Checkpoint çŠ¶æ€ä¿¡æ¯ã€‚æ³¨æ„ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œéœ€è¦æ‰‹åŠ¨æ¸…é™¤è¯¥ä½œä¸šä¿ç•™çš„ Checkpoint çŠ¶æ€ä¿¡æ¯ï¼Œå¦åˆ™è¿™äº›çŠ¶æ€ä¿¡æ¯å°†æ°¸è¿œä¿ç•™åœ¨å¤–éƒ¨çš„æŒä¹…åŒ–å­˜å‚¨ä¸­ã€‚ ExternalizedCheckpointCleanup.DELETE_ON_CANCELLATIONï¼šå½“ä½œä¸šå–æ¶ˆæ—¶ï¼ŒCheckpoint çŠ¶æ€ä¿¡æ¯ä¼šè¢«åˆ é™¤ã€‚ä»…å½“ä½œä¸šå¤±è´¥æ—¶ï¼Œä½œä¸šçš„ Checkpoint æ‰ä¼šè¢«ä¿ç•™ç”¨äºä»»åŠ¡æ¢å¤ã€‚ ä»»åŠ¡å¤±è´¥ï¼Œå½“æœ‰è¾ƒæ–°çš„ Savepoint æ—¶ï¼Œä½œä¸šæ˜¯å¦å›é€€åˆ° Checkpoint è¿›è¡Œæ¢å¤ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ Savepoint æ¯” Checkpoint è¾ƒæ–°æ—¶ï¼Œä»»åŠ¡ä¼šä» Savepoint å¤„æ¢å¤ã€‚ ä½œä¸šå¯ä»¥å®¹å¿ Checkpoint å¤±è´¥çš„æ¬¡æ•°ï¼šé»˜è®¤å€¼ä¸º 0ï¼Œè¡¨ç¤ºä¸èƒ½æ¥å— Checkpoint å¤±è´¥ã€‚ å…³äº Checkpoint æ—¶ï¼ŒçŠ¶æ€åç«¯ç›¸å…³çš„é…ç½®è¯·å‚é˜…æœ¬ä¹¦ 4.2 èŠ‚ã€‚ 4.3.2 Savepoint ç®€ä»‹åŠä½¿ç”¨Savepoint ä¸ Checkpoint ç±»ä¼¼ï¼ŒåŒæ ·éœ€è¦æŠŠçŠ¶æ€ä¿¡æ¯å­˜å‚¨åˆ°å¤–éƒ¨ä»‹è´¨ï¼Œå½“ä½œä¸šå¤±è´¥æ—¶ï¼Œå¯ä»¥ä»å¤–éƒ¨å­˜å‚¨ä¸­æ¢å¤ã€‚å¼ºçƒˆå»ºè®®åœ¨ç¨‹åºä¸­ç»™ç®—å­åˆ†é… Operator IDï¼Œä»¥ä¾¿æ¥å‡çº§ç¨‹åºã€‚ä¸»è¦é€šè¿‡ uid(String) æ–¹æ³•æ‰‹åŠ¨æŒ‡å®šç®—å­çš„ ID ï¼Œè¿™äº› ID å°†ç”¨äºæ¢å¤æ¯ä¸ªç®—å­çš„çŠ¶æ€ã€‚ 12345678910DataStream&lt;String&gt; stream = env. // Stateful source (e.g. Kafka) with ID .addSource(new StatefulSource()) .uid(\"source-id\") // ID for the source operator .shuffle() // Stateful mapper with ID .map(new StatefulMapper()) .uid(\"mapper-id\") // ID for the mapper // Stateless printing sink .print(); // Auto-generated ID å¦‚æœä¸ä¸ºç®—å­æ‰‹åŠ¨æŒ‡å®š IDï¼ŒFlink ä¼šä¸ºç®—å­è‡ªåŠ¨ç”Ÿæˆ IDã€‚å½“ Flink ä»»åŠ¡ä» Savepoint ä¸­æ¢å¤æ—¶ï¼Œæ˜¯æŒ‰ç…§ Operator ID å°†å¿«ç…§ä¿¡æ¯ä¸ç®—å­è¿›è¡ŒåŒ¹é…çš„ï¼Œåªè¦è¿™äº› ID ä¸å˜ï¼ŒFlink ä»»åŠ¡å°±å¯ä»¥ä» Savepoint ä¸­æ¢å¤ã€‚è‡ªåŠ¨ç”Ÿæˆçš„ ID å–å†³äºä»£ç çš„ç»“æ„ï¼Œå¹¶ä¸”å¯¹ä»£ç æ›´æ”¹æ¯”è¾ƒæ•æ„Ÿï¼Œå› æ­¤å¼ºçƒˆå»ºè®®ç»™ç¨‹åºä¸­æ‰€æœ‰æœ‰çŠ¶æ€çš„ç®—å­æ‰‹åŠ¨åˆ†é… Operator IDã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä¸€ä¸ª Flink ä»»åŠ¡åŒ…å«äº† ç®—å­ A å’Œ ç®—å­ Bï¼Œä»£ç ä¸­éƒ½æœªæŒ‡å®š Operator IDï¼Œæ‰€ä»¥ Flink ä¸º Task A è‡ªåŠ¨ç”Ÿæˆäº† Operator ID ä¸º aaaï¼Œä¸º Task B è‡ªåŠ¨ç”Ÿæˆäº† Operator ID ä¸º bbbï¼Œä¸” Savepoint æˆåŠŸå®Œæˆã€‚ä½†æ˜¯åœ¨ä»£ç æ”¹åŠ¨åï¼Œä»»åŠ¡å¹¶ä¸èƒ½ä» Savepoint ä¸­æ­£å¸¸æ¢å¤ï¼Œå› ä¸º Flink ä¸ºç®—å­ç”Ÿæˆçš„ Operator ID å–å†³äºä»£ç ç»“æ„ï¼Œä»£ç æ”¹åŠ¨åå¯èƒ½ä¼šæŠŠç®—å­ B çš„ Operator ID æ”¹å˜æˆ cccï¼Œå¯¼è‡´ä»»åŠ¡ä» Savepoint æ¢å¤æ—¶ï¼ŒSavePoint ä¸­åªæœ‰ Operator ID ä¸º aaa å’Œ bbb çš„çŠ¶æ€ä¿¡æ¯ï¼Œç®—å­ B æ‰¾ä¸åˆ° Operator ID ä¸º ccc çš„çŠ¶æ€ä¿¡æ¯ï¼Œæ‰€ä»¥ç®—å­ B ä¸èƒ½æ­£å¸¸æ¢å¤ã€‚è¿™é‡Œå¦‚æœåœ¨å†™ä»£ç æ—¶é€šè¿‡ uid(String) æ‰‹åŠ¨æŒ‡å®šäº† Operator IDï¼Œå°±ä¸ä¼šå­˜åœ¨ ä¸Šè¿°é—®é¢˜äº†ã€‚ Savepoint éœ€è¦ç”¨æˆ·æ‰‹åŠ¨å»è§¦å‘ï¼Œè§¦å‘ Savepoint çš„æ–¹å¼å¦‚ä¸‹æ‰€ç¤ºï¼š 1bin/flink savepoint :jobId [:targetDirectory] è¿™å°†è§¦å‘ ID ä¸º :jobId çš„ä½œä¸šè¿›è¡Œ Savepointï¼Œå¹¶è¿”å›åˆ›å»ºçš„ Savepoint è·¯å¾„ï¼Œç”¨æˆ·éœ€è¦æ­¤è·¯å¾„æ¥è¿˜åŸå’Œåˆ é™¤ Savepoint ã€‚ ä½¿ç”¨ YARN è§¦å‘ Savepoint çš„æ–¹å¼å¦‚ä¸‹æ‰€ç¤ºï¼š 1bin/flink savepoint :jobId [:targetDirectory] -yid :yarnAppId è¿™å°†è§¦å‘ ID ä¸º :jobId å’Œ YARN åº”ç”¨ç¨‹åº ID :yarnAppId çš„ä½œä¸šè¿›è¡Œ Savepointï¼Œå¹¶è¿”å›åˆ›å»ºçš„ Savepoint è·¯å¾„ã€‚ ä½¿ç”¨ Savepoint å–æ¶ˆ Flink ä»»åŠ¡ï¼š 1bin/flink cancel -s [:targetDirectory] :jobId è¿™å°†è‡ªåŠ¨è§¦å‘ ID ä¸º :jobid çš„ä½œä¸šè¿›è¡Œ Savepointï¼Œå¹¶åœ¨ Checkpoint ç»“æŸåå–æ¶ˆè¯¥ä»»åŠ¡ã€‚æ­¤å¤–ï¼Œå¯ä»¥æŒ‡å®šä¸€ä¸ªç›®æ ‡æ–‡ä»¶ç³»ç»Ÿç›®å½•æ¥å­˜å‚¨ Savepoint çš„çŠ¶æ€ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥åœ¨ flink çš„ conf ç›®å½•ä¸‹ flink-conf.yaml ä¸­é…ç½® state.savepoints.dir å‚æ•°æ¥æŒ‡å®š Savepoint çš„é»˜è®¤ç›®å½•ï¼Œè§¦å‘ Savepoint æ—¶ï¼Œå¦‚æœä¸æŒ‡å®šç›®å½•åˆ™ä½¿ç”¨è¯¥é»˜è®¤ç›®å½•ã€‚æ— è®ºä½¿ç”¨å“ªç§æ–¹å¼é…ç½®ï¼Œéƒ½éœ€è¦ä¿éšœé…ç½®çš„ç›®å½•èƒ½è¢«æ‰€æœ‰çš„ JobManager å’Œ TaskManager è®¿é—®ã€‚ 4.3.3 Savepoint ä¸ Checkpoint çš„åŒºåˆ«å‰é¢åˆ†åˆ«ä»‹ç»äº† Savepoint å’Œ Checkpointï¼Œå¯ä»¥å‘ç°å®ƒä»¬æœ‰ä¸å°‘ç›¸ä¼¼ä¹‹å¤„ï¼Œä¸‹é¢æ¥çœ‹ä¸‹å®ƒä»¬ä¹‹é—´çš„åŒºåˆ«ã€‚ Checkpoint Savepoint ç”± Flink çš„ JobManager å®šæ—¶è‡ªåŠ¨è§¦å‘å¹¶ç®¡ç† ç”±ç”¨æˆ·æ‰‹åŠ¨è§¦å‘å¹¶ç®¡ç† ä¸»è¦ç”¨äºä»»åŠ¡å‘ç”Ÿæ•…éšœæ—¶ï¼Œä¸ºä»»åŠ¡æä¾›ç»™è‡ªåŠ¨æ¢å¤æœºåˆ¶ ä¸»è¦ç”¨æˆ·å‡çº§ Flink ç‰ˆæœ¬ã€ä¿®æ”¹ä»»åŠ¡çš„é€»è¾‘ä»£ç ã€è°ƒæ•´ç®—å­çš„å¹¶è¡Œåº¦ï¼Œä¸”å¿…é¡»æ‰‹åŠ¨æ¢å¤ å½“ä½¿ç”¨ RocksDBStateBackend æ—¶ï¼Œæ”¯æŒå¢é‡æ–¹å¼å¯¹çŠ¶æ€ä¿¡æ¯è¿›è¡Œå¿«ç…§ ä»…æ”¯æŒå…¨é‡å¿«ç…§ Flink ä»»åŠ¡åœæ­¢åï¼ŒCheckpoint çš„çŠ¶æ€å¿«ç…§ä¿¡æ¯é»˜è®¤è¢«æ¸…é™¤ ä¸€æ—¦è§¦å‘ Savepointï¼ŒçŠ¶æ€ä¿¡æ¯å°±è¢«æŒä¹…åŒ–åˆ°å¤–éƒ¨å­˜å‚¨ï¼Œé™¤éç”¨æˆ·æ‰‹åŠ¨åˆ é™¤ Checkpoint è®¾è®¡ç›®æ ‡ï¼šè½»é‡çº§ä¸”å°½å¯èƒ½å¿«åœ°æ¢å¤ä»»åŠ¡ Savepoint çš„ç”Ÿæˆå’Œæ¢å¤æˆæœ¬ä¼šæ›´é«˜ä¸€äº›ï¼ŒSavepoint æ›´å¤šåœ°å…³æ³¨ä»£ç çš„å¯ç§»æ¤æ€§å’Œå…¼å®¹ä»»åŠ¡çš„æ›´æ”¹æ“ä½œ 4.3.4 Checkpoint æµç¨‹Flink ä»»åŠ¡ Checkpoint çš„è¯¦ç»†æµç¨‹å¦‚ä¸‹é¢æµç¨‹æ‰€ç¤ºã€‚ JobManager ç«¯çš„ CheckPointCoordinator ä¼šå®šæœŸå‘æ‰€æœ‰ SourceTask å‘é€ CheckPointTriggerï¼ŒSource Task ä¼šåœ¨æ•°æ®æµä¸­å®‰æ’ Checkpoint barrierï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ å½“ task æ”¶åˆ°ä¸Šæ¸¸æ‰€æœ‰å®ä¾‹çš„ barrier åï¼Œå‘è‡ªå·±çš„ä¸‹æ¸¸ç»§ç»­ä¼ é€’ barrierï¼Œç„¶åè‡ªèº«åŒæ­¥è¿›è¡Œå¿«ç…§ï¼Œå¹¶å°†è‡ªå·±çš„çŠ¶æ€å¼‚æ­¥å†™å…¥åˆ°æŒä¹…åŒ–å­˜å‚¨ä¸­ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ å¦‚æœæ˜¯å¢é‡ Checkpointï¼Œåˆ™åªæ˜¯æŠŠæœ€æ–°çš„ä¸€éƒ¨åˆ†æ›´æ–°å†™å…¥åˆ°å¤–éƒ¨æŒä¹…åŒ–å­˜å‚¨ä¸­ ä¸ºäº†ä¸‹æ¸¸å°½å¿«è¿›è¡Œ Checkpointï¼Œæ‰€ä»¥ task ä¼šå…ˆå‘é€ barrier åˆ°ä¸‹æ¸¸ï¼Œè‡ªèº«å†åŒæ­¥è¿›è¡Œå¿«ç…§ æ³¨ï¼šTask B å¿…é¡»æ¥æ”¶åˆ°ä¸Šæ¸¸ Task A æ‰€æœ‰å®ä¾‹å‘é€çš„ barrier æ—¶ï¼ŒTask B æ‰èƒ½å¼€å§‹è¿›è¡Œå¿«ç…§ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ª barrier å¯¹é½çš„æ¦‚å¿µï¼Œå…³äº barrier å¯¹é½çš„è¯¦ç»†ä»‹ç»è¯·å‚é˜… 9.5.1 èŠ‚ Flink å†…éƒ¨å¦‚ä½•ä¿è¯ Exactly Once ä¸­çš„ barrier å¯¹é½éƒ¨åˆ† å½“ task å°†çŠ¶æ€ä¿¡æ¯å®Œæˆå¤‡ä»½åï¼Œä¼šå°†å¤‡ä»½æ•°æ®çš„åœ°å€ï¼ˆstate handleï¼‰é€šçŸ¥ç»™ JobManager çš„CheckPointCoordinatorï¼Œå¦‚æœ Checkpoint çš„æŒç»­æ—¶é•¿è¶…è¿‡äº† Checkpoint è®¾å®šçš„è¶…æ—¶æ—¶é—´CheckPointCoordinator è¿˜æ²¡æœ‰æ”¶é›†å®Œæ‰€æœ‰çš„ State Handleï¼ŒCheckPointCoordinator å°±ä¼šè®¤ä¸ºæœ¬æ¬¡ Checkpoint å¤±è´¥ï¼Œä¼šæŠŠè¿™æ¬¡ Checkpoint äº§ç”Ÿçš„æ‰€æœ‰çŠ¶æ€æ•°æ®å…¨éƒ¨åˆ é™¤ å¦‚æœ CheckPointCoordinator æ”¶é›†å®Œæ‰€æœ‰ç®—å­çš„ State Handleï¼ŒCheckPointCoordinator ä¼šæŠŠæ•´ä¸ª StateHandle å°è£…æˆ completed Checkpoint Metaï¼Œå†™å…¥åˆ°å¤–éƒ¨å­˜å‚¨ä¸­ï¼ŒCheckpoint ç»“æŸï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ å¦‚æœå¯¹ä¸Šè¿° Checkpoint è¿‡ç¨‹ä¸ç†è§£ï¼Œåœ¨åç»­ 9.5 èŠ‚ Flink å¦‚ä½•ä¿éšœ Exactly Once ä¸­ä¼šè¯¦ç»†ä»‹ç» Flink çš„ Checkpoint è¿‡ç¨‹ä»¥åŠä¸ºä»€ä¹ˆè¿™ä¹ˆåšã€‚ åŸºäº RocksDB çš„å¢é‡ Checkpoint å®ç°åŸç†å½“ä½¿ç”¨ RocksDBStateBackend æ—¶ï¼Œå¢é‡ Checkpoint æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼ŸRocksDB æ˜¯ä¸€ä¸ªåŸºäº LSM å®ç°çš„ KV æ•°æ®åº“ã€‚LSM å…¨ç§° Log Structured Merge Treesï¼ŒLSM æ ‘æœ¬è´¨æ˜¯å°†å¤§é‡çš„ç£ç›˜éšæœºå†™æ“ä½œè½¬æ¢æˆç£ç›˜çš„æ‰¹é‡å†™æ“ä½œæ¥æå¤§åœ°æå‡ç£ç›˜æ•°æ®å†™å…¥æ•ˆç‡ã€‚ä¸€èˆ¬ LSM Tree å®ç°ä¸Šéƒ½ä¼šæœ‰ä¸€ä¸ªåŸºäºå†…å­˜çš„ MemTable ä»‹è´¨ï¼Œæ‰€æœ‰çš„å¢åˆ æ”¹æ“ä½œéƒ½æ˜¯å†™å…¥åˆ° MemTable ä¸­ï¼Œå½“ MemTable è¶³å¤Ÿå¤§ä»¥åï¼Œå°† MemTable ä¸­çš„æ•°æ® flush åˆ°ç£ç›˜ä¸­ç”Ÿæˆä¸å¯å˜ä¸”å†…éƒ¨æœ‰åºçš„ ssTableï¼ˆSorted String Tableï¼‰æ–‡ä»¶ï¼Œå…¨é‡æ•°æ®ä¿å­˜åœ¨ç£ç›˜çš„å¤šä¸ª ssTable æ–‡ä»¶ä¸­ã€‚HBase ä¹Ÿæ˜¯åŸºäº LSM Tree å®ç°çš„ï¼ŒHBase ç£ç›˜ä¸Šçš„ HFile å°±ç›¸å½“äºè¿™é‡Œçš„ ssTable æ–‡ä»¶ï¼Œæ¯æ¬¡ç”Ÿæˆçš„ HFile éƒ½æ˜¯ä¸å¯å˜çš„è€Œä¸”å†…éƒ¨æœ‰åºçš„æ–‡ä»¶ã€‚åŸºäº ssTable ä¸å¯å˜çš„ç‰¹æ€§ï¼Œæ‰å®ç°äº†å¢é‡ Checkpointï¼Œå…·ä½“æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ ç¬¬ä¸€æ¬¡ Checkpoint æ—¶ç”Ÿæˆçš„çŠ¶æ€å¿«ç…§ä¿¡æ¯åŒ…å«äº†ä¸¤ä¸ª sstable æ–‡ä»¶ï¼šsstable1 å’Œ sstable2 åŠ Checkpoint1 çš„å…ƒæ•°æ®æ–‡ä»¶ MANIFEST-chk1ï¼Œæ‰€ä»¥ç¬¬ä¸€æ¬¡ Checkpoint æ—¶éœ€è¦å°† sstable1ã€sstable2 å’Œ MANIFEST-chk1 ä¸Šä¼ åˆ°å¤–éƒ¨æŒä¹…åŒ–å­˜å‚¨ä¸­ã€‚ç¬¬äºŒæ¬¡ Checkpoint æ—¶ç”Ÿæˆçš„å¿«ç…§ä¿¡æ¯ä¸º sstable1ã€sstable2ã€sstable3 åŠå…ƒæ•°æ®æ–‡ä»¶ MANIFEST-chk2ï¼Œç”±äº sstable æ–‡ä»¶çš„ä¸å¯å˜ç‰¹æ€§ï¼Œæ‰€ä»¥çŠ¶æ€å¿«ç…§ä¿¡æ¯çš„ sstable1ã€sstable2 è¿™ä¸¤ä¸ªæ–‡ä»¶å¹¶æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œsstable1ã€sstable2 è¿™ä¸¤ä¸ªæ–‡ä»¶ä¸éœ€è¦é‡å¤ä¸Šä¼ åˆ°å¤–éƒ¨æŒä¹…åŒ–å­˜å‚¨ä¸­ï¼Œå› æ­¤ç¬¬äºŒæ¬¡ Checkpoint æ—¶ï¼Œåªéœ€è¦å°† sstable3 å’Œ MANIFEST-chk2 æ–‡ä»¶ä¸Šä¼ åˆ°å¤–éƒ¨æŒä¹…åŒ–å­˜å‚¨ä¸­å³å¯ã€‚è¿™é‡Œåªå°†æ–°å¢çš„æ–‡ä»¶ä¸Šä¼ åˆ°å¤–éƒ¨æŒä¹…åŒ–å­˜å‚¨ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„å¢é‡ Checkpointã€‚ åŸºäº LSM Tree å®ç°çš„æ•°æ®åº“ä¸ºäº†æé«˜æŸ¥è¯¢æ•ˆç‡ï¼Œéƒ½éœ€è¦å®šæœŸå¯¹ç£ç›˜ä¸Šå¤šä¸ª sstable æ–‡ä»¶è¿›è¡Œåˆå¹¶æ“ä½œï¼Œåˆå¹¶æ—¶ä¼šå°†åˆ é™¤çš„ã€è¿‡æœŸçš„ä»¥åŠæ—§ç‰ˆæœ¬çš„æ•°æ®è¿›è¡Œæ¸…ç†ï¼Œä»è€Œé™ä½ sstable æ–‡ä»¶çš„æ€»å¤§å°ã€‚å›¾ä¸­å¯ä»¥çœ‹åˆ°ç¬¬ä¸‰æ¬¡ Checkpoint æ—¶ç”Ÿæˆçš„å¿«ç…§ä¿¡æ¯ä¸ºsstable3ã€sstable4ã€sstable5 åŠå…ƒæ•°æ®æ–‡ä»¶ MANIFEST-chk3ï¼Œ å…¶ä¸­æ–°å¢äº† sstable4 æ–‡ä»¶ä¸” sstable1 å’Œ sstable2 æ–‡ä»¶åˆå¹¶æˆ sstable5 æ–‡ä»¶ï¼Œå› æ­¤ç¬¬ä¸‰æ¬¡ Checkpoint æ—¶åªéœ€è¦å‘å¤–éƒ¨æŒä¹…åŒ–å­˜å‚¨ä¸Šä¼  sstable4ã€sstable5 åŠå…ƒæ•°æ®æ–‡ä»¶ MANIFEST-chk3ã€‚ åŸºäº RocksDB çš„å¢é‡ Checkpoint ä»æœ¬è´¨ä¸Šæ¥è®²æ¯æ¬¡ Checkpoint æ—¶åªå°†æœ¬æ¬¡ Checkpoint æ–°å¢çš„å¿«ç…§ä¿¡æ¯ä¸Šä¼ åˆ°å¤–éƒ¨çš„æŒä¹…åŒ–å­˜å‚¨ä¸­ï¼Œä¾é çš„æ˜¯ LSM Tree ä¸­ sstable æ–‡ä»¶ä¸å¯å˜çš„ç‰¹æ€§ã€‚å¯¹ LSM Tree æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥æ·±å…¥ç ”ç©¶ RocksDB æˆ– HBase ç›¸å…³åŸç†åŠå®ç°ã€‚ 4.3.5 å¦‚ä½•ä» Checkpoint ä¸­æ¢å¤çŠ¶æ€4.3.6 å¦‚ä½•ä» Savepoint ä¸­æ¢å¤çŠ¶æ€4.3.7 å¦‚ä½•ä¼˜é›…åœ°åˆ é™¤ Checkpoint ç›®å½•4.3.8 å°ç»“ä¸åæ€åŠ å…¥çŸ¥è¯†æ˜Ÿçƒå¯ä»¥çœ‹åˆ°ä¸Šé¢æ–‡ç« ï¼šhttps://t.zsxq.com/RNJeqFy æœ¬ç« å±äºå±äºæœ¬ä¹¦çš„è¿›é˜¶ç¯‡ï¼Œåœ¨ç¬¬ä¸€èŠ‚ä¸­è®²è§£äº† State çš„å„ç§ç±»å‹ï¼ŒåŒ…æ‹¬æ¯ç§ State çš„ä½¿ç”¨æ–¹å¼ã€å®ç°åŸç†å’Œéƒ¨åˆ†æºç å‰–æï¼Œåœ¨ç¬¬äºŒèŠ‚ä¸­ä»‹ç» Flink ä¸­çš„çŠ¶æ€åç«¯å­˜å‚¨çš„ä½¿ç”¨æ–¹å¼ï¼Œå¯¹æ¯”åˆ†æäº†ç°æœ‰çš„å‡ ç§æ–¹æ¡ˆçš„ä½¿ç”¨åœºæ™¯ï¼Œåœ¨ç¬¬ä¸‰èŠ‚ä¸­ä»‹ç»äº† Checkpoint å’Œ Savepoint çš„åŒºåˆ«ï¼Œå¦‚æœä»çŠ¶æ€ä¸­æ¢å¤ä½œä¸šï¼Œä»¥åŠæ•´ä¸ªä½œä¸šçš„ Checkpoint æµç¨‹ã€‚ æœ¬ç« çš„å†…å®¹æ˜¯ Flink ä½œä¸šå¼€å‘çš„é‡ç‚¹ï¼Œé€šå¸¸çº¿ä¸Šé‡åˆ° Stateã€Checkpointã€Savepoint çš„é—®é¢˜æ¯”è¾ƒå¤šï¼Œæ‰€ä»¥å¸Œæœ›ä½ èƒ½å¥½å¥½çš„å¼„æ¸…æ¥šå®ƒä»¬çš„åŸç†ï¼Œè¿™æ ·åœ¨å‡ºé—®é¢˜åæ‰èƒ½å¤Ÿå¯¹ç—‡ä¸‹è¯å»è§£å†³é—®é¢˜ã€‚","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹â€”â€” Flink çŠ¶æ€åç«¯å­˜å‚¨","date":"2021-07-24T16:00:00.000Z","path":"2021/07/25/flink-in-action-4.2/","text":"4.2 Flink çŠ¶æ€åç«¯å­˜å‚¨åœ¨ 4.1 èŠ‚ä¸­ä»‹ç»äº† Flink ä¸­çš„çŠ¶æ€ï¼Œé‚£ä¹ˆåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œéšç€ä½œä¸šçš„è¿è¡Œæ—¶é—´å˜é•¿ï¼ŒçŠ¶æ€ä¼šå˜å¾—è¶Šæ¥è¶Šå¤§ï¼Œé‚£ä¹ˆå¦‚ä½•å°†è¿™äº›çŠ¶æ€å­˜å‚¨ä¹Ÿæ˜¯ Flink è¦è§£å†³çš„ä¸€å¤§éš¾ç‚¹ï¼Œæœ¬èŠ‚æ¥è®²è§£ä¸‹ Flink ä¸­ä¸åŒç±»å‹çš„çŠ¶æ€åç«¯å­˜å‚¨ã€‚ 4.2.1 State Backendså½“éœ€è¦å¯¹å…·ä½“çš„æŸä¸€ç§ State åš Checkpoint æ—¶ï¼Œæ­¤æ—¶å°±éœ€è¦å…·ä½“çš„çŠ¶æ€åç«¯å­˜å‚¨ï¼Œåˆšå¥½ Flink å†…ç½®æä¾›äº†ä¸åŒçš„çŠ¶æ€åç«¯å­˜å‚¨ï¼Œç”¨äºæŒ‡å®šçŠ¶æ€çš„å­˜å‚¨æ–¹å¼å’Œä½ç½®ã€‚çŠ¶æ€å¯ä»¥å­˜å‚¨åœ¨ Java å †å†…å­˜ä¸­æˆ–è€…å †å¤–ï¼Œåœ¨ Flink å®‰è£…è·¯å¾„ä¸‹ conf ç›®å½•ä¸­çš„ flink-conf.yaml é…ç½®æ–‡ä»¶ä¸­ä¹Ÿæœ‰çŠ¶æ€åç«¯å­˜å‚¨ç›¸å…³çš„é…ç½®ï¼Œä¸ºæ­¤åœ¨ Flink æºç ä¸­è¿˜ç‰¹æœ‰ä¸€ä¸ª CheckpointingOptions ç±»æ¥æ§åˆ¶ state å­˜å‚¨çš„ç›¸å…³é…ç½®ï¼Œè¯¥ç±»ä¸­æœ‰å¦‚ä¸‹é…ç½®ï¼š state.backend: ç”¨äºå­˜å‚¨å’Œè¿›è¡ŒçŠ¶æ€ Checkpoint çš„çŠ¶æ€åç«¯å­˜å‚¨æ–¹å¼ï¼Œæ— é»˜è®¤å€¼ state.checkpoints.num-retained: è¦ä¿ç•™çš„å·²å®Œæˆ Checkpoint çš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤å€¼ä¸º 1 state.backend.async: çŠ¶æ€åç«¯æ˜¯å¦ä½¿ç”¨å¼‚æ­¥å¿«ç…§æ–¹æ³•ï¼Œé»˜è®¤å€¼ä¸º true state.backend.incremental: çŠ¶æ€åç«¯æ˜¯å¦åˆ›å»ºå¢é‡æ£€æŸ¥ç‚¹ï¼Œé»˜è®¤å€¼ä¸º false state.backend.local-recovery: çŠ¶æ€åç«¯é…ç½®æœ¬åœ°æ¢å¤ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæœ¬åœ°æ¢å¤è¢«ç¦ç”¨ taskmanager.state.local.root-dirs: å®šä¹‰å­˜å‚¨æœ¬åœ°æ¢å¤çš„åŸºäºæ–‡ä»¶çš„çŠ¶æ€çš„ç›®å½• state.savepoints.dir: å­˜å‚¨ savepoints çš„ç›®å½• state.checkpoints.dir: å­˜å‚¨ Checkpoint çš„æ•°æ®æ–‡ä»¶å’Œå…ƒæ•°æ® state.backend.fs.memory-threshold: çŠ¶æ€æ•°æ®æ–‡ä»¶çš„æœ€å°å¤§å°ï¼Œé»˜è®¤å€¼æ˜¯ 1024 è™½ç„¶é…ç½®è¿™ä¹ˆå¤šï¼Œä½†æ˜¯ï¼ŒFlink è¿˜æ”¯æŒåŸºäºæ¯ä¸ª Job å•ç‹¬è®¾ç½®çŠ¶æ€åç«¯å­˜å‚¨ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š 1234567StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();env.setStateBackend(new MemoryStateBackend()); //è®¾ç½®å †å†…å­˜å­˜å‚¨//env.setStateBackend(new FsStateBackend(checkpointDir, asyncCheckpoints)); //è®¾ç½®æ–‡ä»¶å­˜å‚¨//env.setStateBackend(new RocksDBStateBackend(checkpointDir, incrementalCheckpoints)); //è®¾ç½® RocksDB å­˜å‚¨ StateBackend æ¥å£çš„ä¸‰ç§å®ç°ç±»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä¸Šé¢ä¸‰ç§æ–¹å¼å–ä¸€ç§å°±å¥½äº†ã€‚ä½†æ˜¯æœ‰ä¸‰ç§æ–¹å¼ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•å»æŒ‘é€‰ç”¨å“ªç§å»å­˜å‚¨çŠ¶æ€å‘¢ï¼Ÿä¸‹é¢è®²è®²è¿™ä¸‰ç§çš„ç‰¹ç‚¹ä»¥åŠè¯¥å¦‚ä½•é€‰æ‹©ã€‚ 4.2.2 MemoryStateBackend çš„ç”¨æ³•åŠåˆ†æå¦‚æœ Job æ²¡æœ‰é…ç½®æŒ‡å®šçŠ¶æ€åç«¯å­˜å‚¨çš„è¯ï¼Œå°±ä¼šé»˜è®¤é‡‡å– MemoryStateBackend ç­–ç•¥ã€‚å¦‚æœä½ ç»†å¿ƒçš„è¯ï¼Œå¯ä»¥ä»ä½ çš„ Job ä¸­çœ‹åˆ°ç±»ä¼¼æ—¥å¿—å¦‚ä¸‹ï¼š 12019-04-28 00:16:41.892 [Sink: zhisheng (1/4)] INFO org.apache.flink.streaming.runtime.tasks.StreamTask - No state backend has been configured, using default (Memory / JobManager) MemoryStateBackend (data in heap memory / checkpoints to JobManager) (checkpoints: &apos;null&apos;, savepoints: &apos;null&apos;, asynchronous: TRUE, maxStateSize: 5242880) ä¸Šé¢æ—¥å¿—çš„æ„æ€å°±æ˜¯è¯´å¦‚æœæ²¡æœ‰é…ç½®ä»»ä½•çŠ¶æ€å­˜å‚¨ï¼Œä½¿ç”¨é»˜è®¤çš„ MemoryStateBackend ç­–ç•¥ï¼Œè¿™ç§çŠ¶æ€åç«¯å­˜å‚¨æŠŠæ•°æ®ä»¥å†…éƒ¨å¯¹è±¡çš„å½¢å¼ä¿å­˜åœ¨ TaskManagers çš„å†…å­˜ï¼ˆJVM å †ï¼‰ä¸­ï¼Œå½“åº”ç”¨ç¨‹åºè§¦å‘ Checkpoint æ—¶ï¼Œä¼šå°†æ­¤æ—¶çš„çŠ¶æ€è¿›è¡Œå¿«ç…§ç„¶åå­˜å‚¨åœ¨ JobManager çš„å†…å­˜ä¸­ã€‚å› ä¸ºçŠ¶æ€æ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸­çš„ï¼Œæ‰€ä»¥è¿™ç§æƒ…å†µä¼šæœ‰ç‚¹é™åˆ¶ï¼Œæ¯”å¦‚ï¼š ä¸å¤ªé€‚åˆåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œä»…ç”¨äºæœ¬åœ°æµ‹è¯•çš„æƒ…å†µè¾ƒå¤šï¼Œä¸»è¦é€‚ç”¨äºçŠ¶æ€å¾ˆå°çš„ Jobï¼Œå› ä¸ºå®ƒä¼šå°†çŠ¶æ€æœ€ç»ˆå­˜å‚¨åœ¨ JobManager ä¸­ï¼Œå¦‚æœçŠ¶æ€è¾ƒå¤§çš„è¯ï¼Œé‚£ä¹ˆä¼šä½¿å¾— JobManager çš„å†…å­˜æ¯”è¾ƒç´§å¼ ï¼Œä»è€Œå¯¼è‡´ JobManager ä¼šå‡ºç° OOM ç­‰é—®é¢˜ï¼Œç„¶åé€ æˆè¿é”ååº”ä½¿æ‰€æœ‰çš„ Job éƒ½æŒ‚æ‰ï¼Œæ‰€ä»¥ Job çš„çŠ¶æ€ä¸ä¹‹å‰çš„ Checkpoint çš„æ•°æ®æ‰€å çš„å†…å­˜è¦å°äº JobManager çš„å†…å­˜ã€‚ æ¯ä¸ªå•ç‹¬çš„çŠ¶æ€å¤§å°ä¸èƒ½è¶…è¿‡æœ€å¤§çš„ DEFAULT_MAX_STATE_SIZE(5MB)ï¼Œå¯ä»¥é€šè¿‡æ„é€  MemoryStateBackend å‚æ•°ä¼ å…¥ä¸åŒå¤§å°çš„ maxStateSizeã€‚ Job çš„æ“ä½œç¬¦çŠ¶æ€å’Œ keyed çŠ¶æ€åŠ èµ·æ¥éƒ½ä¸è¦è¶…è¿‡ RPC ç³»ç»Ÿçš„é»˜è®¤é…ç½® 10 MBï¼Œè™½ç„¶å¯ä»¥ä¿®æ”¹è¯¥é…ç½®ï¼Œä½†æ˜¯ä¸å»ºè®®å»ä¿®æ”¹ã€‚ å¦å¤–å°±æ˜¯ MemoryStateBackend æ”¯æŒé…ç½®æ˜¯å¦æ˜¯å¼‚æ­¥å¿«ç…§è¿˜æ˜¯åŒæ­¥å¿«ç…§ï¼Œå®ƒæœ‰ä¸€ä¸ªå­—æ®µ asynchronousSnapshots æ¥è¡¨ç¤ºï¼Œå¯é€‰å€¼æœ‰ï¼š TRUEï¼ˆè¡¨ç¤ºä½¿ç”¨å¼‚æ­¥çš„å¿«ç…§ï¼Œè¿™æ ·å¯ä»¥é¿å…å› å¿«ç…§è€Œå¯¼è‡´æ•°æ®æµå¤„ç†å‡ºç°é˜»å¡ç­‰é—®é¢˜ï¼‰ FALSEï¼ˆåŒæ­¥ï¼‰ UNDEFINEDï¼ˆé»˜è®¤å€¼ï¼‰ åœ¨æ„é€  MemoryStateBackend çš„é»˜è®¤å‡½æ•°æ—¶æ˜¯ä½¿ç”¨çš„ UNDEFINEDï¼Œè€Œä¸æ˜¯å¼‚æ­¥ï¼š 123public MemoryStateBackend() &#123; this(null, null, DEFAULT_MAX_STATE_SIZE, TernaryBoolean.UNDEFINED);//ä½¿ç”¨çš„æ˜¯ UNDEFINED&#125; ç½‘ä¸Šæœ‰äººè¯´é»˜è®¤æ˜¯å¼‚æ­¥çš„ï¼Œè¿™é‡Œç»™å¤§å®¶è§£é‡Šæ¸…æ¥šä¸€ä¸‹ï¼Œä»ä¸Šé¢çš„é‚£æ¡æ—¥å¿—æ‰“å°çš„ç¡®å®ä¹Ÿæ˜¯è¡¨ç¤ºå¼‚æ­¥ï¼Œä½†æ˜¯å‰ææ˜¯ä½ å¯¹ State æ— ä»»ä½•æ“ä½œï¼Œç¬”è€…è·Ÿäº†ä¸‹æºç ï¼Œå½“ä½ æ²¡æœ‰é…ç½®ä»»ä½•çš„ state æ—¶ï¼Œå®ƒæ˜¯ä¼šåœ¨ StateBackendLoader ç±»ä¸­é€šè¿‡ MemoryStateBackendFactory æ¥åˆ›å»ºçš„ state çš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ ç»§ç»­è·Ÿè¿› MemoryStateBackendFactory å¯ä»¥å‘ç°ä»–è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ª MemoryStateBackend å®ä¾‹å¹¶é€šè¿‡ configure æ–¹æ³•è¿›è¡Œé…ç½®ï¼Œå¤§æ¦‚æµç¨‹ä»£ç æ˜¯ï¼š 12345678910111213141516171819202122//MemoryStateBackendFactory ç±»public MemoryStateBackend createFromConfig(Configuration config, ClassLoader classLoader) &#123; return new MemoryStateBackend().configure(config, classLoader);&#125;//MemoryStateBackend ç±»ä¸­çš„ config æ–¹æ³•public MemoryStateBackend configure(Configuration config, ClassLoader classLoader) &#123; return new MemoryStateBackend(this, config, classLoader);&#125;//ç§æœ‰çš„æ„é€ æ–¹æ³•private MemoryStateBackend(MemoryStateBackend original, Configuration configuration, ClassLoader classLoader) &#123; ... this.asynchronousSnapshots = original.asynchronousSnapshots.resolveUndefined( configuration.getBoolean(CheckpointingOptions.ASYNC_SNAPSHOTS));&#125;//æ ¹æ® CheckpointingOptions ç±»ä¸­çš„ ASYNC_SNAPSHOTS å‚æ•°è¿›è¡Œè®¾ç½®çš„public static final ConfigOption&lt;Boolean&gt; ASYNC_SNAPSHOTS = ConfigOptions .key(\"state.backend.async\") .defaultValue(true) //é»˜è®¤å€¼å°±æ˜¯ trueï¼Œä»£è¡¨å¼‚æ­¥ .withDescription(...) å¯ä»¥å‘ç°æœ€ç»ˆæ˜¯é€šè¿‡è¯»å– state.backend.async å‚æ•°çš„é»˜è®¤å€¼ï¼ˆtrueï¼‰æ¥é…ç½®æ˜¯å¦è¦å¼‚æ­¥çš„è¿›è¡Œå¿«ç…§ï¼Œä½†æ˜¯å¦‚æœä½ æ‰‹åŠ¨é…ç½® MemoryStateBackend çš„è¯ï¼Œåˆ©ç”¨æ— å‚æ•°çš„æ„é€ æ–¹æ³•ï¼Œé‚£ä¹ˆå°±ä¸æ˜¯é»˜è®¤å¼‚æ­¥ï¼Œå¦‚æœæƒ³ä½¿ç”¨å¼‚æ­¥çš„è¯ï¼Œéœ€è¦åˆ©ç”¨ä¸‹é¢è¿™ä¸ªæ„é€ å‡½æ•°ï¼ˆéœ€è¦ä¼ å…¥ä¸€ä¸ª boolean å€¼ï¼Œtrue ä»£è¡¨å¼‚æ­¥ï¼Œfalse ä»£è¡¨åŒæ­¥ï¼‰ï¼š 123public MemoryStateBackend(boolean asynchronousSnapshots) &#123; this(null, null, DEFAULT_MAX_STATE_SIZE, TernaryBoolean.fromBoolean(asynchronousSnapshots));&#125; å¦‚æœä½ å†ç»†çœ‹äº†è¿™ä¸ª MemoryStateBackend ç±»çš„è¯ï¼Œé‚£ä¹ˆä½ å¯èƒ½ä¼šå‘ç°è¿™ä¸ªæ„é€ å‡½æ•°ï¼š 123public MemoryStateBackend(@Nullable String checkpointPath, @Nullable String savepointPath) &#123; this(checkpointPath, savepointPath, DEFAULT_MAX_STATE_SIZE, TernaryBoolean.UNDEFINED);//éœ€è¦ä½ ä¼ å…¥ checkpointPath å’Œ savepointPath&#125; è¿™ä¸ªä¹Ÿæ˜¯ç”¨æ¥åˆ›å»ºä¸€ä¸ª MemoryStateBackend çš„ï¼Œå®ƒéœ€è¦ä¼ å…¥çš„å‚æ•°æ˜¯ä¸¤ä¸ªè·¯å¾„ï¼ˆcheckpointPathã€savepointPathï¼‰ï¼Œå…¶ä¸­ checkpointPath æ˜¯å†™å…¥ Checkpoint å…ƒæ•°æ®çš„è·¯å¾„ï¼ŒsavepointPath æ˜¯å†™å…¥ savepoint çš„è·¯å¾„ã€‚ è¿™ä¸ªæ¥çœ‹çœ‹ MemoryStateBackend çš„ç»§æ‰¿å…³ç³»å›¾å¯ä»¥æ›´æ˜ç¡®çš„çŸ¥é“å®ƒæ˜¯ç»§æ‰¿è‡ª AbstractFileStateBackendï¼Œç„¶å AbstractFileStateBackend è¿™ä¸ªæŠ½è±¡ç±»å°±æ˜¯ä¸ºäº†èƒ½å¤Ÿå°†çŠ¶æ€å­˜å‚¨ä¸­çš„æ•°æ®æˆ–è€…å…ƒæ•°æ®è¿›è¡Œæ–‡ä»¶å­˜å‚¨çš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ æ‰€ä»¥ FsStateBackend å’Œ MemoryStateBackend éƒ½ä¼šç»§æ‰¿è¯¥ç±»ã€‚ 4.2.3 FsStateBackend çš„ç”¨æ³•åŠåˆ†æè¿™ç§çŠ¶æ€åç«¯å­˜å‚¨ä¹Ÿæ˜¯å°†å·¥ä½œçŠ¶æ€å­˜å‚¨åœ¨ TaskManager ä¸­çš„å†…å­˜ï¼ˆJVM å †ï¼‰ä¸­ï¼Œä½†æ˜¯ Checkpoint çš„æ—¶å€™ï¼Œå®ƒå’Œ MemoryStateBackend ä¸ä¸€æ ·ï¼Œå®ƒæ˜¯å°†çŠ¶æ€å­˜å‚¨åœ¨æ–‡ä»¶ï¼ˆå¯ä»¥æ˜¯æœ¬åœ°æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯ HDFSï¼‰ä¸­ï¼Œè¿™ä¸ªæ–‡ä»¶å…·ä½“æ˜¯å“ªç§éœ€è¦é…ç½®ï¼Œæ¯”å¦‚ï¼šâ€hdfs://namenode:40010/flink/checkpointsâ€ æˆ– â€œfile://flink/checkpointsâ€ (é€šå¸¸ä½¿ç”¨ HDFS æ¯”è¾ƒå¤šï¼Œå¦‚æœæ˜¯ä½¿ç”¨æœ¬åœ°æ–‡ä»¶ï¼Œå¯èƒ½ä¼šé€ æˆ Job æ¢å¤çš„æ—¶å€™æ‰¾ä¸åˆ°ä¹‹å‰çš„ checkkpointï¼Œå› ä¸º Job é‡å¯åå¦‚æœç”±è°ƒåº¦å™¨é‡æ–°åˆ†é…åœ¨ä¸åŒçš„æœºå™¨çš„ TaskManager æ‰§è¡Œæ—¶å°±ä¼šå¯¼è‡´è¿™ä¸ªé—®é¢˜ï¼Œæ‰€ä»¥è¿˜æ˜¯å»ºè®®ä½¿ç”¨ HDFS æˆ–è€…å…¶ä»–çš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ)ã€‚ åŒæ · FsStateBackend ä¹Ÿæ˜¯æ”¯æŒé€šè¿‡ asynchronousSnapshots å­—æ®µæ¥æ§åˆ¶æ˜¯ä½¿ç”¨å¼‚æ­¥è¿˜æ˜¯åŒæ­¥æ¥è¿›è¡Œ Checkpoint çš„ï¼Œå¼‚æ­¥å¯ä»¥é¿å…åœ¨çŠ¶æ€ Checkpoint æ—¶é˜»å¡æ•°æ®æµçš„å¤„ç†ï¼Œç„¶åè¿˜æœ‰ä¸€ç‚¹çš„å°±æ˜¯åœ¨ FsStateBackend æœ‰ä¸ªå‚æ•° fileStateThresholdï¼Œå¦‚æœçŠ¶æ€å¤§å°æ¯” MAX_FILE_STATE_THRESHOLDï¼ˆ1MBï¼‰ å°çš„è¯ï¼Œé‚£ä¹ˆä¼šå°†çŠ¶æ€æ•°æ®ç›´æ¥å­˜å‚¨åœ¨ meta data æ–‡ä»¶ä¸­ï¼Œè€Œä¸æ˜¯å­˜å‚¨åœ¨é…ç½®çš„æ–‡ä»¶ä¸­ï¼ˆé¿å…å‡ºç°å¾ˆå°çš„çŠ¶æ€æ–‡ä»¶ï¼‰ï¼Œå¦‚æœè¯¥å€¼ä¸º â€œ-1â€ è¡¨ç¤ºå°šæœªé…ç½®ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ä¼šä½¿ç”¨é»˜è®¤å€¼ï¼ˆ1024ï¼Œè¯¥é»˜è®¤å€¼å¯ä»¥é€šè¿‡ state.backend.fs.memory-threshold æ¥é…ç½®ï¼‰ã€‚ é‚£ä¹ˆæˆ‘ä»¬è¯¥ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ FsStateBackend å‘¢ï¼Ÿ å¦‚æœä½ è¦å¤„ç†å¤§çŠ¶æ€ï¼Œé•¿çª—å£ç­‰æœ‰çŠ¶æ€çš„ä»»åŠ¡ï¼Œé‚£ä¹ˆ FsStateBackend å°±æ¯”è¾ƒé€‚åˆ ä½¿ç”¨åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œå¦‚ HDFS ç­‰ï¼Œè¿™æ · failover æ—¶ Job çš„çŠ¶æ€å¯ä»¥æ¢å¤ ä½¿ç”¨ FsStateBackend éœ€è¦æ³¨æ„çš„åœ°æ–¹æœ‰ä»€ä¹ˆå‘¢ï¼Ÿ å·¥ä½œçŠ¶æ€ä»ç„¶æ˜¯å­˜å‚¨åœ¨ TaskManager ä¸­çš„å†…å­˜ä¸­ï¼Œè™½ç„¶åœ¨ Checkpoint çš„æ—¶å€™ä¼šå­˜åœ¨æ–‡ä»¶ä¸­ï¼Œæ‰€ä»¥è¿˜æ˜¯å¾—æ³¨æ„è¿™ä¸ªçŠ¶æ€è¦ä¿è¯ä¸è¶…è¿‡ TaskManager çš„å†…å­˜ 4.2.4 RocksDBStateBackend çš„ç”¨æ³•åŠåˆ†æ4.2.5 å¦‚ä½•é€‰æ‹©çŠ¶æ€åç«¯å­˜å‚¨ï¼Ÿ4.2.6 å°ç»“ä¸åæ€åŠ å…¥çŸ¥è¯†æ˜Ÿçƒå¯ä»¥çœ‹åˆ°ä¸Šé¢æ–‡ç« ï¼š https://t.zsxq.com/RNJeqFy","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹â€”â€” æ·±åº¦è®²è§£ Flink ä¸­çš„çŠ¶æ€","date":"2021-07-23T16:00:00.000Z","path":"2021/07/24/flink-in-action-4.1/","text":"ç¬¬å››ç«  â€”â€” Flink ä¸­çš„çŠ¶æ€åŠå®¹é”™æœºåˆ¶Flink å¯¹æ¯”å…¶ä»–çš„æµå¤„ç†æ¡†æ¶æœ€å¤§çš„ç‰¹ç‚¹æ˜¯å…¶æ”¯æŒçŠ¶æ€ï¼Œæœ¬ç« å°†æ·±åº¦çš„è®²è§£ Flink ä¸­çš„çŠ¶æ€åˆ†ç±»ï¼Œå¦‚ä½•åœ¨ä¸åŒçš„åœºæ™¯ä½¿ç”¨ä¸åŒçš„çŠ¶æ€ï¼Œæ¥ç€ä¼šä»‹ç» Flink ä¸­çš„å¤šç§çŠ¶æ€å­˜å‚¨ï¼Œæœ€åä¼šä»‹ç» Checkpoint å’Œ Savepoint çš„ä½¿ç”¨æ–¹å¼ä»¥åŠå¦‚ä½•æ¢å¤çŠ¶æ€ã€‚ 4.1 æ·±åº¦è®²è§£ Flink ä¸­çš„çŠ¶æ€ åœ¨åŸºç¡€ç¯‡ä¸­çš„ 1.2 èŠ‚ä¸­ä»‹ç»äº† Flink æ˜¯ä¸€æ¬¾æœ‰çŠ¶æ€çš„æµå¤„ç†æ¡†æ¶ã€‚é‚£ä¹ˆå¤§å®¶å¯èƒ½æœ‰ç‚¹ç–‘é—®ï¼Œè¿™ä¸ªçŠ¶æ€æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿæ‹¿ Flink æœ€ç®€å•çš„ Word Count ç¨‹åºæ¥è¯´ï¼Œå®ƒéœ€è¦ä¸æ–­çš„å¯¹ word å‡ºç°çš„ä¸ªæ•°è¿›è¡Œç»“æœç»Ÿè®¡ï¼Œé‚£ä¹ˆåä¸€ä¸ªç»“æœå°±éœ€è¦åˆ©ç”¨å‰ä¸€ä¸ªçš„ç»“æœç„¶åå†åš +1 çš„æ“ä½œï¼Œè¿™æ ·å‰ä¸€ä¸ªè®¡ç®—å°±éœ€è¦å°† word å‡ºç°çš„æ¬¡æ•° count è¿›è¡Œå­˜ç€ï¼ˆè¿™ä¸ª count é‚£ä¹ˆå°±æ˜¯ä¸€ä¸ªçŠ¶æ€ï¼‰ç„¶ååé¢æ‰å¯ä»¥è¿›è¡Œç´¯åŠ ã€‚ 4.1.1 ä¸ºä»€ä¹ˆéœ€è¦ Stateï¼Ÿå¯¹äºæµå¤„ç†ç³»ç»Ÿï¼Œæ•°æ®æ˜¯ä¸€æ¡ä¸€æ¡è¢«å¤„ç†çš„ï¼Œå¦‚æœæ²¡æœ‰å¯¹æ•°æ®å¤„ç†çš„è¿›åº¦è¿›è¡Œè®°å½•ï¼Œé‚£ä¹ˆå¦‚æœè¿™ä¸ªå¤„ç†æ•°æ®çš„ Job å› ä¸ºæœºå™¨é—®é¢˜æˆ–è€…å…¶ä»–é—®é¢˜è€Œå¯¼è‡´é‡å¯ï¼Œé‚£ä¹ˆå®ƒæ˜¯ä¸çŸ¥é“ä¸Šä¸€æ¬¡å¤„ç†æ•°æ®æ˜¯åˆ°å“ªä¸ªåœ°æ–¹äº†ï¼Œè¿™æ ·çš„æƒ…å†µä¸‹å¦‚æœæ˜¯æ‰¹æ•°æ®ï¼Œå€’æ˜¯å¯ä»¥å¾ˆå¥½çš„è§£å†³ï¼ˆé‡æ–°å°†è¿™ä»½å›ºå®šçš„æ•°æ®å†æ‰§è¡Œä¸€éï¼‰ï¼Œä½†æ˜¯æµæ•°æ®é‚£å°±éº»çƒ¦äº†ï¼Œä½ æ ¹æœ¬ä¸çŸ¥é“ä»€ä¹ˆåœ¨ Job æŒ‚çš„é‚£ä¸ªæ—¶åˆ»æ•°æ®æ¶ˆè´¹åˆ°å“ªé‡Œäº†ï¼Ÿé‚£ä¹ˆä½ é‡å¯çš„è¯è¯¥ä»å“ªé‡Œå¼€å§‹é‡æ–°æ¶ˆè´¹å‘¢ï¼Ÿä½ å¯ä»¥æœ‰ä»¥ä¸‹é€‰æ‹©ï¼ˆå› ä¸ºä½ å¯èƒ½ä¹Ÿä¸ç¡®å®š Job æŒ‚çš„å…·ä½“æ—¶é—´ï¼‰ï¼š Job æŒ‚çš„é‚£ä¸ªæ—¶é—´ä¹‹å‰ï¼šå¦‚æœæ˜¯ä» Job æŒ‚ä¹‹å‰å¼€å§‹é‡æ–°æ¶ˆè´¹çš„è¯ï¼Œé‚£ä¹ˆä¼šå¯¼è‡´éƒ¨åˆ†æ•°æ®ï¼ˆä»æ–°æ¶ˆè´¹çš„æ—¶é—´ç‚¹åˆ°ä¹‹å‰ Job æŒ‚çš„é‚£ä¸ªæ—¶é—´ç‚¹ä¹‹å‰çš„æ•°æ®ï¼‰é‡å¤æ¶ˆè´¹ Job æŒ‚çš„é‚£ä¸ªæ—¶é—´ä¹‹åï¼šå¦‚æœæ˜¯ä» Job æŒ‚ä¹‹åå¼€å§‹æ¶ˆè´¹çš„è¯ï¼Œé‚£ä¹ˆä¼šå¯¼è‡´éƒ¨åˆ†æ•°æ®ï¼ˆä» Job æŒ‚çš„é‚£ä¸ªæ—¶é—´ç‚¹åˆ°æ–°æ¶ˆè´¹çš„æ—¶é—´ç‚¹äº§ç”Ÿçš„æ•°æ®ï¼‰ä¸¢å¤±ï¼Œæ²¡æœ‰æ¶ˆè´¹ ä¸Šé¢ä¸¤ç§æƒ…å†µç”¨å›¾ç‰‡æè¿°å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ ä¸ºäº†è§£å†³ä¸Šé¢ä¸¤ç§æƒ…å†µï¼ˆæ•°æ®é‡å¤æ¶ˆè´¹æˆ–è€…æ•°æ®æ²¡æœ‰æ¶ˆè´¹ï¼‰çš„å‘ç”Ÿï¼Œé‚£ä¹ˆæ˜¯ä¸æ˜¯å°±å¾—éœ€è¦ä¸ªä»€ä¹ˆä¸œè¥¿åšä¸ªè®°å½•å°†è¿™ç§æ•°æ®æ¶ˆè´¹çŠ¶æ€ï¼ŒFlink state å°±è¿™æ ·è¯ç”Ÿäº†ï¼Œstate ä¸­å­˜å‚¨ç€æ¯æ¡æ•°æ®æ¶ˆè´¹åæ•°æ®çš„æ¶ˆè´¹ç‚¹ï¼ˆç”Ÿäº§ç¯å¢ƒéœ€è¦æŒä¹…åŒ–è¿™äº›çŠ¶æ€ï¼‰ï¼Œå½“ Job å› ä¸ºæŸç§é”™è¯¯æˆ–è€…å…¶ä»–åŸå› å¯¼è‡´é‡å¯æ—¶ï¼Œå°±èƒ½å¤Ÿä» Checkpointï¼ˆå®šæ—¶å°† state åšä¸€ä¸ªå…¨å±€å¿«ç…§ï¼Œåœ¨ Flink ä¸­ï¼Œä¸ºäº†èƒ½å¤Ÿè®© Job åœ¨è¿è¡Œçš„è¿‡ç¨‹ä¸­ä¿è¯å®¹é”™æ€§ï¼Œæ‰ä¼šå¯¹è¿™äº› state åšä¸€ä¸ªå¿«ç…§ï¼Œåœ¨ 4.3 èŠ‚ä¸­ä¼šè¯¦ç»†è®²ï¼‰ ä¸­çš„ state æ•°æ®è¿›è¡Œæ¢å¤ã€‚ 4.1.2 State çš„ç§ç±»åœ¨ Flink ä¸­æœ‰ä¸¤ä¸ªåŸºæœ¬çš„ stateï¼šKeyed state å’Œ Operator stateï¼Œä¸‹é¢æ¥åˆ†åˆ«ä»‹ç»ä¸€ä¸‹è¿™ä¸¤ç§ Stateã€‚ 4.1.3 Keyed StateKeyed State æ€»æ˜¯å’Œå…·ä½“çš„ key ç›¸å…³è”ï¼Œä¹Ÿåªèƒ½åœ¨ KeyedStream çš„ function å’Œ operator ä¸Šä½¿ç”¨ã€‚ä½ å¯ä»¥å°† Keyed State å½“ä½œæ˜¯ Operator State çš„ä¸€ç§ç‰¹ä¾‹ï¼Œä½†æ˜¯å®ƒæ˜¯è¢«åˆ†åŒºæˆ–åˆ†ç‰‡çš„ã€‚æ¯ä¸ª Keyed State åˆ†åŒºå¯¹åº”ä¸€ä¸ª key çš„ Operator Stateï¼Œå¯¹äºæŸä¸ª key åœ¨æŸä¸ªåˆ†åŒºä¸Šæœ‰å”¯ä¸€çš„çŠ¶æ€ã€‚é€»è¾‘ä¸Šï¼ŒKeyed State æ€»æ˜¯å¯¹åº”ç€ä¸€ä¸ª äºŒå…ƒç»„ï¼Œåœ¨æŸç§ç¨‹åº¦ä¸Šï¼Œå› ä¸ºæ¯ä¸ªå…·ä½“çš„ key æ€»æ˜¯å±äºå”¯ä¸€ä¸€ä¸ªå…·ä½“çš„ parallel-operator-instanceï¼ˆå¹¶è¡Œæ“ä½œå®ä¾‹ï¼‰ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç®€åŒ–è®¤ä¸ºæ˜¯ ã€‚Keyed State å¯ä»¥è¿›ä¸€æ­¥ç»„ç»‡æˆ Key Groupï¼ŒKey Group æ˜¯ Flink é‡æ–°åˆ†é… Keyed State çš„æœ€å°å•å…ƒï¼Œæ‰€ä»¥æœ‰å¤šå°‘ä¸ªå¹¶è¡Œï¼Œå°±ä¼šæœ‰å¤šå°‘ä¸ª Key Groupã€‚åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ª keyed operator çš„å¹¶è¡Œå®ä¾‹ä¼šå¤„ç†æ¥è‡ªä¸åŒ key çš„ä¸åŒ Key Groupã€‚ 4.1.4 Operator Stateå¯¹ Operator State è€Œè¨€ï¼Œæ¯ä¸ª operator state éƒ½å¯¹åº”ç€ä¸€ä¸ªå¹¶è¡Œå®ä¾‹ã€‚Kafka Connector å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ã€‚æ¯ä¸ª Kafka consumer çš„å¹¶è¡Œå®ä¾‹éƒ½ä¼šæŒæœ‰ä¸€ä»½topic partition å’Œ offset çš„ mapï¼Œè¿™ä¸ª map å°±æ˜¯å®ƒçš„ Operator Stateã€‚ å½“å¹¶è¡Œåº¦å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒOperator State å¯ä»¥å°†çŠ¶æ€åœ¨æ‰€æœ‰çš„å¹¶è¡Œå®ä¾‹ä¸­è¿›è¡Œé‡åˆ†é…ï¼Œå¹¶ä¸”æä¾›äº†å¤šç§æ–¹å¼æ¥è¿›è¡Œé‡åˆ†é…ã€‚ åœ¨ Flink æºç ä¸­ï¼Œåœ¨ flink-core module ä¸‹çš„ org.apache.flink.api.common.state ä¸­å¯ä»¥çœ‹åˆ° Flink ä¸­æ‰€æœ‰å’Œ State ç›¸å…³çš„ç±»ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ 4.1.5 Raw State å’Œ Managed StateKeyed State å’Œ Operator State éƒ½æœ‰ä¸¤ç§å­˜åœ¨å½¢å¼ï¼Œå³ Raw Stateï¼ˆåŸå§‹çŠ¶æ€ï¼‰å’Œ Managed Stateï¼ˆæ‰˜ç®¡çŠ¶æ€ï¼‰ã€‚ åŸå§‹çŠ¶æ€æ˜¯ Operatorï¼ˆç®—å­ï¼‰ä¿å­˜å®ƒä»¬è‡ªå·±çš„æ•°æ®ç»“æ„ä¸­çš„ stateï¼Œå½“ Checkpoint æ—¶ï¼ŒåŸå§‹çŠ¶æ€ä¼šä»¥å­—èŠ‚æµçš„å½¢å¼å†™å…¥è¿› Checkpoint ä¸­ã€‚Flink å¹¶ä¸çŸ¥é“ State çš„æ•°æ®ç»“æ„é•¿å•¥æ ·ï¼Œä»…èƒ½çœ‹åˆ°åŸç”Ÿçš„å­—èŠ‚æ•°ç»„ã€‚ æ‰˜ç®¡çŠ¶æ€å¯ä»¥ä½¿ç”¨ Flink runtime æä¾›çš„æ•°æ®ç»“æ„æ¥è¡¨ç¤ºï¼Œä¾‹å¦‚å†…éƒ¨å“ˆå¸Œè¡¨æˆ–è€… RocksDBã€‚å…·ä½“æœ‰ ValueStateï¼ŒListState ç­‰ã€‚Flink runtime ä¼šå¯¹è¿™äº›çŠ¶æ€è¿›è¡Œç¼–ç ç„¶åå°†å®ƒä»¬å†™å…¥åˆ° Checkpoint ä¸­ã€‚ DataStream çš„æ‰€æœ‰ function éƒ½å¯ä»¥ä½¿ç”¨æ‰˜ç®¡çŠ¶æ€ï¼Œä½†æ˜¯åŸç”ŸçŠ¶æ€åªèƒ½åœ¨å®ç° operator çš„æ—¶å€™ä½¿ç”¨ã€‚ç›¸å¯¹äºåŸç”ŸçŠ¶æ€ï¼Œæ¨èä½¿ç”¨æ‰˜ç®¡çŠ¶æ€ï¼Œå› ä¸ºå¦‚æœä½¿ç”¨æ‰˜ç®¡çŠ¶æ€ï¼Œå½“å¹¶è¡Œåº¦å‘ç”Ÿæ”¹å˜æ—¶ï¼ŒFlink å¯ä»¥è‡ªåŠ¨çš„å¸®ä½ é‡åˆ†é… stateï¼ŒåŒæ—¶è¿˜å¯ä»¥æ›´å¥½çš„ç®¡ç†å†…å­˜ã€‚ æ³¨æ„ï¼šå¦‚æœä½ çš„æ‰˜ç®¡çŠ¶æ€éœ€è¦ç‰¹æ®Šçš„åºåˆ—åŒ–ï¼Œç›®å‰ Flink è¿˜ä¸æ”¯æŒã€‚ 4.1.6 å¦‚ä½•ä½¿ç”¨æ‰˜ç®¡çš„ Keyed Stateæ‰˜ç®¡çš„ Keyed State æ¥å£æä¾›å¯¹ä¸åŒç±»å‹çŠ¶æ€ï¼ˆè¿™äº›çŠ¶æ€çš„èŒƒå›´éƒ½æ˜¯å½“å‰è¾“å…¥å…ƒç´ çš„ keyï¼‰çš„è®¿é—®ï¼Œè¿™æ„å‘³ç€è¿™ç§çŠ¶æ€åªèƒ½åœ¨é€šè¿‡ stream.keyBy() åˆ›å»ºçš„ KeyedStream ä¸Šä½¿ç”¨ã€‚ æˆ‘ä»¬é¦–å…ˆæ¥çœ‹ä¸€ä¸‹æœ‰å“ªäº›å¯ä»¥ä½¿ç”¨çš„çŠ¶æ€ï¼Œç„¶åå†æ¥çœ‹çœ‹å®ƒä»¬åœ¨ç¨‹åºä¸­æ˜¯å¦‚ä½•ä½¿ç”¨çš„ï¼š ValueState: ä¿å­˜ä¸€ä¸ªå¯ä»¥æ›´æ–°å’Œè·å–çš„å€¼ï¼ˆæ¯ä¸ª Key ä¸€ä¸ª valueï¼‰ï¼Œå¯ä»¥ç”¨ update(T) æ¥æ›´æ–° valueï¼Œå¯ä»¥ç”¨ value() æ¥è·å– valueã€‚ ListState: ä¿å­˜ä¸€ä¸ªå€¼çš„åˆ—è¡¨ï¼Œç”¨ add(T) æˆ–è€… addAll(List) æ¥æ·»åŠ ï¼Œç”¨ Iterable get() æ¥è·å–ã€‚ ReducingState: ä¿å­˜ä¸€ä¸ªå€¼ï¼Œè¿™ä¸ªå€¼æ˜¯çŠ¶æ€çš„å¾ˆå¤šå€¼çš„èšåˆç»“æœï¼Œæ¥å£å’Œ ListState ç±»ä¼¼ï¼Œä½†æ˜¯å¯ä»¥ç”¨ç›¸åº”çš„ ReduceFunction æ¥èšåˆã€‚ AggregatingState: ä¿å­˜å¾ˆå¤šå€¼çš„èšåˆç»“æœçš„å•ä¸€å€¼ï¼Œä¸ ReducingState ç›¸æ¯”ï¼Œä¸åŒç‚¹åœ¨äºèšåˆç±»å‹å¯ä»¥å’Œå…ƒç´ ç±»å‹ä¸åŒï¼Œæä¾› AggregateFunction æ¥å®ç°èšåˆã€‚ FoldingState: ä¸ AggregatingState ç±»ä¼¼ï¼Œé™¤äº†ä½¿ç”¨ FoldFunction è¿›è¡Œèšåˆã€‚ MapState: ä¿å­˜ä¸€ç»„æ˜ å°„ï¼Œå¯ä»¥å°† kv æ”¾è¿›è¿™ä¸ªçŠ¶æ€ï¼Œä½¿ç”¨ put(UK, UV) æˆ–è€… putAll(Map) æ·»åŠ ï¼Œæˆ–è€…ä½¿ç”¨ get(UK) è·å–ã€‚ æ‰€æœ‰ç±»å‹çš„çŠ¶æ€éƒ½æœ‰ä¸€ä¸ª clear() æ–¹æ³•æ¥æ¸…é™¤å½“å‰çš„çŠ¶æ€ã€‚ æ³¨æ„ï¼šFoldingState å·²ç»ä¸æ¨èä½¿ç”¨ï¼Œå¯ä»¥ç”¨ AggregatingState æ¥ä»£æ›¿ã€‚ éœ€è¦æ³¨æ„ï¼Œä¸Šé¢çš„è¿™äº›çŠ¶æ€å¯¹è±¡ä»…ç”¨æ¥å’ŒçŠ¶æ€æ‰“äº¤é“ï¼ŒçŠ¶æ€ä¸ä¸€å®šä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œä¹Ÿå¯ä»¥å­˜å‚¨åœ¨ç£ç›˜æˆ–è€…å…¶ä»–åœ°æ–¹ã€‚å¦å¤–ï¼Œä½ è·å–åˆ°çš„çŠ¶æ€çš„å€¼æ˜¯å–å†³äºè¾“å…¥å…ƒç´ çš„ keyï¼Œå› æ­¤å¦‚æœ key ä¸åŒï¼Œé‚£ä¹ˆåœ¨ä¸€æ¬¡è°ƒç”¨ç”¨æˆ·å‡½æ•°ä¸­è·å¾—çš„å€¼å¯èƒ½ä¸å¦ä¸€æ¬¡è°ƒç”¨çš„å€¼ä¸åŒã€‚ è¦ä½¿ç”¨ä¸€ä¸ªçŠ¶æ€å¯¹è±¡ï¼Œéœ€è¦å…ˆåˆ›å»ºä¸€ä¸ª StateDescriptorï¼Œå®ƒåŒ…å«äº†çŠ¶æ€çš„åå­—ï¼ˆä½ å¯ä»¥åˆ›å»ºè‹¥å¹²ä¸ª stateï¼Œä½†æ˜¯å®ƒä»¬å¿…é¡»è¦æœ‰å”¯ä¸€çš„å€¼ä»¥ä¾¿èƒ½å¤Ÿå¼•ç”¨å®ƒä»¬ï¼‰ï¼ŒçŠ¶æ€çš„å€¼çš„ç±»å‹ï¼Œæˆ–è®¸è¿˜æœ‰ä¸€ä¸ªç”¨æˆ·å®šä¹‰çš„å‡½æ•°ï¼Œæ¯”å¦‚ ReduceFunctionã€‚æ ¹æ®ä½ æƒ³è¦ä½¿ç”¨çš„ state ç±»å‹ï¼Œä½ å¯ä»¥åˆ›å»º ValueStateDescriptorã€ListStateDescriptorã€ReducingStateDescriptorã€FoldingStateDescriptor æˆ–è€… MapStateDescriptorã€‚ çŠ¶æ€åªèƒ½é€šè¿‡ RuntimeContext æ¥è·å–ï¼Œæ‰€ä»¥åªèƒ½åœ¨ RichFunction é‡Œé¢ä½¿ç”¨ã€‚RichFunction ä¸­ä½ å¯ä»¥é€šè¿‡ RuntimeContext ç”¨ä¸‹è¿°æ–¹æ³•è·å–çŠ¶æ€ï¼š ValueState getState(ValueStateDescriptor) ReducingState getReducingState(ReducingStateDescriptor) ListState getListState(ListStateDescriptor) AggregatingState getAggregatingState(AggregatingState) FoldingState getFoldingState(FoldingStateDescriptor) MapState getMapState(MapStateDescriptor) ä¸Šé¢è®²äº†è¿™ä¹ˆå¤šæ¦‚å¿µï¼Œé‚£ä¹ˆæ¥ä¸€ä¸ªä¾‹å­æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨çŠ¶æ€ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344public class CountWindowAverage extends RichFlatMapFunction&lt;Tuple2&lt;Long, Long&gt;, Tuple2&lt;Long, Long&gt;&gt; &#123; //ValueState ä½¿ç”¨æ–¹å¼ï¼Œç¬¬ä¸€ä¸ªå­—æ®µæ˜¯ countï¼Œç¬¬äºŒä¸ªå­—æ®µæ˜¯è¿è¡Œçš„å’Œ private transient ValueState&lt;Tuple2&lt;Long, Long&gt;&gt; sum; @Override public void flatMap(Tuple2&lt;Long, Long&gt; input, Collector&lt;Tuple2&lt;Long, Long&gt;&gt; out) throws Exception &#123; //è®¿é—®çŠ¶æ€çš„ value å€¼ Tuple2&lt;Long, Long&gt; currentSum = sum.value(); //æ›´æ–° count currentSum.f0 += 1; //æ›´æ–° sum currentSum.f1 += input.f1; //æ›´æ–°çŠ¶æ€ sum.update(currentSum); //å¦‚æœ count ç­‰äº 2, å‘å‡ºå¹³å‡å€¼å¹¶æ¸…é™¤çŠ¶æ€ if (currentSum.f0 &gt;= 2) &#123; out.collect(new Tuple2&lt;&gt;(input.f0, currentSum.f1 / currentSum.f0)); sum.clear(); &#125; &#125; @Override public void open(Configuration config) &#123; ValueStateDescriptor&lt;Tuple2&lt;Long, Long&gt;&gt; descriptor = new ValueStateDescriptor&lt;&gt;( \"average\", //çŠ¶æ€åç§° TypeInformation.of(new TypeHint&lt;Tuple2&lt;Long, Long&gt;&gt;() &#123;&#125;), //ç±»å‹ä¿¡æ¯ Tuple2.of(0L, 0L)); //çŠ¶æ€çš„é»˜è®¤å€¼ sum = getRuntimeContext().getState(descriptor);//è·å–çŠ¶æ€ &#125;&#125;env.fromElements(Tuple2.of(1L, 3L), Tuple2.of(1L, 5L), Tuple2.of(1L, 7L), Tuple2.of(1L, 4L), Tuple2.of(1L, 2L)) .keyBy(0) .flatMap(new CountWindowAverage()) .print();//ç»“æœä¼šæ‰“å°å‡º (1,4) å’Œ (1,5) è¿™ä¸ªä¾‹å­å®ç°äº†ä¸€ä¸ªç®€å•çš„è®¡æ•°å™¨ï¼Œæˆ‘ä»¬ä½¿ç”¨å…ƒç»„çš„ç¬¬ä¸€ä¸ªå­—æ®µæ¥è¿›è¡Œåˆ†ç»„(è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ‰€æœ‰çš„ key éƒ½æ˜¯ 1)ï¼Œè¿™ä¸ª CountWindowAverage å‡½æ•°å°†è®¡æ•°å’Œè¿è¡Œæ—¶æ€»å’Œä¿å­˜åœ¨ä¸€ä¸ª ValueState ä¸­ï¼Œä¸€æ—¦è®¡æ•°ç­‰äº 2ï¼Œå°±ä¼šå‘å‡ºå¹³å‡å€¼å¹¶æ¸…ç† stateï¼Œå› æ­¤åˆä» 0 å¼€å§‹ã€‚è¯·æ³¨æ„ï¼Œå¦‚æœåœ¨ç¬¬ä¸€ä¸ªå­—æ®µä¸­å…·æœ‰ä¸åŒå€¼çš„å…ƒç»„ï¼Œåˆ™è¿™å°†ä¸ºæ¯ä¸ªä¸åŒçš„è¾“å…¥ keyä¿å­˜ä¸åŒçš„ state å€¼ã€‚ 4.1.7 State TTL(å­˜æ´»æ—¶é—´)éšç€ä½œä¸šçš„è¿è¡Œæ—¶é—´å˜é•¿ï¼Œä½œä¸šçš„çŠ¶æ€ä¹Ÿä¼šé€æ¸çš„å˜å¤§ï¼Œé‚£ä¹ˆå¾ˆæœ‰å¯èƒ½å°±ä¼šå½±å“ä½œä¸šçš„ç¨³å®šæ€§ï¼Œè¿™æ—¶å¦‚æœæœ‰çŠ¶æ€çš„è¿‡æœŸè¿™ç§åŠŸèƒ½å°±å¯ä»¥å°†å†å²çš„ä¸€äº›çŠ¶æ€æ¸…é™¤ï¼Œå¯¹åº”åœ¨ Flink ä¸­çš„å°±æ˜¯ State TTLï¼Œæ¥ä¸‹æ¥å°†å¯¹å…¶åšè¯¦ç»†ä»‹ç»ã€‚ State TTL ä»‹ç»TTL å¯ä»¥åˆ†é…ç»™ä»»ä½•ç±»å‹çš„ Keyed stateï¼Œå¦‚æœä¸€ä¸ªçŠ¶æ€è®¾ç½®äº† TTLï¼Œé‚£ä¹ˆå½“çŠ¶æ€è¿‡æœŸæ—¶ï¼Œé‚£ä¹ˆä¹‹å‰å­˜å‚¨çš„çŠ¶æ€å€¼ä¼šè¢«æ¸…é™¤ã€‚æ‰€æœ‰çš„çŠ¶æ€é›†åˆç±»å‹éƒ½æ”¯æŒå•ä¸ªå…¥å£çš„ TTLï¼Œè¿™æ„å‘³ç€ List é›†åˆå…ƒç´ å’Œ Map é›†åˆéƒ½æ”¯æŒç‹¬ç«‹åˆ°æœŸã€‚ä¸ºäº†ä½¿ç”¨çŠ¶æ€ TTLï¼Œé¦–å…ˆå¿…é¡»è¦æ„å»º StateTtlConfig é…ç½®å¯¹è±¡ï¼Œç„¶åå¯ä»¥é€šè¿‡ä¼ é€’é…ç½®åœ¨ State descriptor ä¸­å¯ç”¨ TTL åŠŸèƒ½ï¼š 123456789101112import org.apache.flink.api.common.state.StateTtlConfig;import org.apache.flink.api.common.state.ValueStateDescriptor;import org.apache.flink.api.common.time.Time;StateTtlConfig ttlConfig = StateTtlConfig .newBuilder(Time.seconds(1)) .setUpdateType(StateTtlConfig.UpdateType.OnCreateAndWrite) .setStateVisibility(StateTtlConfig.StateVisibility.NeverReturnExpired) .build(); ValueStateDescriptor&lt;String&gt; stateDescriptor = new ValueStateDescriptor&lt;&gt;(\"zhisheng\", String.class);stateDescriptor.enableTimeToLive(ttlConfig); //å¼€å¯ ttl ä¸Šé¢é…ç½®ä¸­æœ‰å‡ ä¸ªé€‰é¡¹éœ€è¦æ³¨æ„ï¼š 1ã€newBuilder æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¿…éœ€çš„ï¼Œå®ƒä»£è¡¨ç€çŠ¶æ€å­˜æ´»æ—¶é—´ã€‚ 2ã€UpdateType é…ç½®çŠ¶æ€ TTL æ›´æ–°æ—¶ï¼ˆé»˜è®¤ä¸º OnCreateAndWriteï¼‰ï¼š StateTtlConfig.UpdateType.OnCreateAndWrite: ä»…é™åˆ›å»ºå’Œå†™å…¥è®¿é—®æ—¶æ›´æ–° StateTtlConfig.UpdateType.OnReadAndWrite: é™¤äº†åˆ›å»ºå’Œå†™å…¥è®¿é—®ï¼Œè¿˜æ”¯æŒåœ¨è¯»å–æ—¶æ›´æ–° 3ã€StateVisibility é…ç½®æ˜¯å¦åœ¨è¯»å–è®¿é—®æ—¶è¿”å›è¿‡æœŸå€¼ï¼ˆå¦‚æœå°šæœªæ¸…é™¤ï¼‰ï¼Œé»˜è®¤æ˜¯ NeverReturnExpiredï¼š StateTtlConfig.StateVisibility.NeverReturnExpired: æ°¸è¿œä¸ä¼šè¿”å›è¿‡æœŸå€¼ StateTtlConfig.StateVisibility.ReturnExpiredIfNotCleanedUp: å¦‚æœä»ç„¶å¯ç”¨åˆ™è¿”å› åœ¨ NeverReturnExpired çš„æƒ…å†µä¸‹ï¼Œè¿‡æœŸçŠ¶æ€è¡¨ç°å¾—å¥½åƒå®ƒä¸å†å­˜åœ¨ï¼Œå³ä½¿å®ƒä»ç„¶å¿…é¡»è¢«åˆ é™¤ã€‚è¯¥é€‰é¡¹å¯¹äºåœ¨ TTL ä¹‹åå¿…é¡»ä¸¥æ ¼ç”¨äºè¯»å–è®¿é—®çš„æ•°æ®çš„ç”¨ä¾‹æ˜¯æœ‰ç”¨çš„ï¼Œä¾‹å¦‚ï¼Œåº”ç”¨ç¨‹åºä½¿ç”¨éšç§æ•æ„Ÿæ•°æ®. å¦ä¸€ä¸ªé€‰é¡¹ ReturnExpiredIfNotCleanedUp å…è®¸åœ¨æ¸…ç†ä¹‹å‰è¿”å›è¿‡æœŸçŠ¶æ€ã€‚ æ³¨æ„ï¼š çŠ¶æ€åç«¯ä¼šå­˜å‚¨ä¸Šæ¬¡ä¿®æ”¹çš„æ—¶é—´æˆ³ä»¥åŠå¯¹åº”çš„å€¼ï¼Œè¿™æ„å‘³ç€å¯ç”¨æ­¤åŠŸèƒ½ä¼šå¢åŠ çŠ¶æ€å­˜å‚¨çš„æ¶ˆè€—ï¼Œå †çŠ¶æ€åç«¯å­˜å‚¨ä¸€ä¸ªé¢å¤–çš„ Java å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«å¯¹ç”¨æˆ·çŠ¶æ€å¯¹è±¡çš„å¼•ç”¨å’Œå†…å­˜ä¸­åŸå§‹çš„ long å€¼ã€‚RocksDB çŠ¶æ€åç«¯å­˜å‚¨ä¸ºæ¯ä¸ªå­˜å‚¨å€¼ã€Listã€Map éƒ½æ·»åŠ  8 ä¸ªå­—èŠ‚ã€‚ ç›®å‰ä»…æ”¯æŒå‚è€ƒ processing time çš„ TTL ä½¿ç”¨å¯ç”¨ TTL çš„æè¿°ç¬¦å»å°è¯•æ¢å¤å…ˆå‰æœªä½¿ç”¨ TTL é…ç½®çš„çŠ¶æ€å¯èƒ½ä¼šå¯¼è‡´å…¼å®¹æ€§å¤±è´¥æˆ–è€… StateMigrationException å¼‚å¸¸ã€‚ TTL é…ç½®å¹¶ä¸æ˜¯ Checkpoint å’Œ Savepoint çš„ä¸€éƒ¨åˆ†ï¼Œè€Œæ˜¯ Flink å¦‚ä½•åœ¨å½“å‰è¿è¡Œçš„ Job ä¸­å¤„ç†å®ƒçš„æ–¹å¼ã€‚ åªæœ‰å½“ç”¨æˆ·å€¼åºåˆ—åŒ–å™¨å¯ä»¥å¤„ç† null å€¼æ—¶ï¼Œå…·ä½“ TTL çš„ Map çŠ¶æ€å½“å‰æ‰æ”¯æŒ null å€¼ï¼Œå¦‚æœåºåˆ—åŒ–å™¨ä¸æ”¯æŒ null å€¼ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ NullableSerializer æ¥åŒ…è£…å®ƒï¼ˆä»£ä»·æ˜¯éœ€è¦ä¸€ä¸ªé¢å¤–çš„å­—èŠ‚ï¼‰ã€‚ æ¸…é™¤è¿‡æœŸ Stateé»˜è®¤æƒ…å†µä¸‹ï¼Œè¿‡æœŸå€¼åªæœ‰åœ¨æ˜¾å¼è¯»å‡ºæ—¶æ‰ä¼šè¢«åˆ é™¤ï¼Œä¾‹å¦‚é€šè¿‡è°ƒç”¨ ValueState.value()ã€‚ æ³¨æ„ï¼šè¿™æ„å‘³ç€é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœæœªè¯»å–è¿‡æœŸçŠ¶æ€ï¼Œåˆ™ä¸ä¼šåˆ é™¤å®ƒï¼Œè¿™å¯èƒ½å¯¼è‡´çŠ¶æ€ä¸æ–­å¢é•¿ï¼Œè¿™ä¸ªç‰¹æ€§åœ¨ Flink æœªæ¥çš„ç‰ˆæœ¬å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ã€‚ æ­¤å¤–ï¼Œä½ å¯ä»¥åœ¨è·å–å®Œæ•´çŠ¶æ€å¿«ç…§æ—¶æ¿€æ´»æ¸…ç†çŠ¶æ€ï¼Œè¿™æ ·å°±å¯ä»¥å‡å°‘çŠ¶æ€çš„å¤§å°ã€‚åœ¨å½“å‰å®ç°ä¸‹ä¸æ¸…é™¤æœ¬åœ°çŠ¶æ€ï¼Œä½†æ˜¯åœ¨ä»ä¸Šä¸€ä¸ªå¿«ç…§æ¢å¤çš„æƒ…å†µä¸‹ï¼Œå®ƒä¸ä¼šåŒ…æ‹¬å·²åˆ é™¤çš„è¿‡æœŸçŠ¶æ€ï¼Œä½ å¯ä»¥åœ¨ StateTtlConfig ä¸­è¿™æ ·é…ç½®ï¼š 1234567import org.apache.flink.api.common.state.StateTtlConfig;import org.apache.flink.api.common.time.Time;StateTtlConfig ttlConfig = StateTtlConfig .newBuilder(Time.seconds(1)) .cleanupFullSnapshot() .build(); æ­¤é…ç½®ä¸é€‚ç”¨äº RocksDB çŠ¶æ€åç«¯ä¸­çš„å¢é‡ Checkpointã€‚å¯¹äºç°æœ‰çš„ Jobï¼Œå¯ä»¥åœ¨ StateTtlConfig ä¸­éšæ—¶æ¿€æ´»æˆ–åœç”¨æ­¤æ¸…ç†ç­–ç•¥ï¼Œä¾‹å¦‚ï¼Œä»ä¿å­˜ç‚¹é‡å¯åã€‚ é™¤äº†åœ¨å®Œæ•´å¿«ç…§ä¸­æ¸…ç†å¤–ï¼Œä½ è¿˜å¯ä»¥åœ¨åå°æ¿€æ´»æ¸…ç†ã€‚å¦‚æœä½¿ç”¨çš„åç«¯æ”¯æŒä»¥ä¸‹é€‰é¡¹ï¼Œåˆ™ä¼šæ¿€æ´» StateTtlConfig ä¸­çš„é»˜è®¤åå°æ¸…ç†ï¼š 12345import org.apache.flink.api.common.state.StateTtlConfig;StateTtlConfig ttlConfig = StateTtlConfig .newBuilder(Time.seconds(1)) .cleanupInBackground() .build(); è¦åœ¨åå°å¯¹æŸäº›ç‰¹æ®Šæ¸…ç†è¿›è¡Œæ›´ç²¾ç»†çš„æ§åˆ¶ï¼Œå¯ä»¥æŒ‰ç…§ä¸‹é¢çš„è¯´æ˜å•ç‹¬é…ç½®å®ƒã€‚ç›®å‰ï¼Œå †çŠ¶æ€åç«¯ä¾èµ–äºå¢é‡æ¸…ç†ï¼ŒRocksDB åç«¯ä½¿ç”¨å‹ç¼©è¿‡æ»¤å™¨è¿›è¡Œåå°æ¸…ç†ã€‚ æˆ‘ä»¬å†æ¥çœ‹çœ‹ TTL å¯¹åº”ç€çš„ç±» StateTtlConfig ç±»ä¸­çš„å…·ä½“å®ç°ï¼Œè¿™æ ·æˆ‘ä»¬æ‰èƒ½æ›´åŠ çš„ç†è§£å…¶ä½¿ç”¨æ–¹å¼ã€‚ åœ¨è¯¥ç±»ä¸­çš„å±æ€§å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š è¿™äº›å±æ€§çš„åŠŸèƒ½å¦‚ä¸‹ï¼š DISABLEDï¼šå®ƒé»˜è®¤åˆ›å»ºäº†ä¸€ä¸ª UpdateType ä¸º Disabled çš„ StateTtlConfig UpdateTypeï¼šè¿™ä¸ªæ˜¯ä¸€ä¸ªæšä¸¾ï¼ŒåŒ…å« Disabledï¼ˆä»£è¡¨ TTL æ˜¯ç¦ç”¨çš„ï¼ŒçŠ¶æ€ä¸ä¼šè¿‡æœŸï¼‰ã€OnCreateAndWriteã€OnReadAndWrite å¯é€‰ StateVisibilityï¼šè¿™ä¹Ÿæ˜¯ä¸€ä¸ªæšä¸¾ï¼ŒåŒ…å«äº† ReturnExpiredIfNotCleanedUpã€NeverReturnExpired TimeCharacteristicï¼šè¿™æ˜¯æ—¶é—´ç‰¹å¾ï¼Œå…¶å®æ˜¯åªæœ‰ ProcessingTime å¯é€‰ Timeï¼šè®¾ç½® TTL çš„æ—¶é—´ï¼Œè¿™é‡Œæœ‰ä¸¤ä¸ªå‚æ•° unit å’Œ size CleanupStrategiesï¼šTTL æ¸…ç†ç­–ç•¥ï¼Œåœ¨è¯¥ç±»ä¸­æœ‰å­—æ®µ isCleanupInBackgroundï¼ˆæ˜¯å¦åœ¨åå°æ¸…ç†ï¼‰ å’Œç›¸å…³çš„æ¸…ç† strategiesï¼ˆåŒ…å« FULL_STATE_SCAN_SNAPSHOTã€INCREMENTAL_CLEANUP å’Œ ROCKSDB_COMPACTION_FILTERï¼‰ï¼ŒåŒæ—¶è¯¥ç±»ä¸­è¿˜æœ‰ CleanupStrategy æ¥å£ï¼Œå®ƒçš„å®ç°ç±»æœ‰ EmptyCleanupStrategyï¼ˆä¸æ¸…ç†ï¼Œä¸ºç©ºï¼‰ã€IncrementalCleanupStrategyï¼ˆå¢é‡çš„æ¸…é™¤ï¼‰ã€RocksdbCompactFilterCleanupStrategyï¼ˆåœ¨ RocksDB ä¸­è‡ªå®šä¹‰å‹ç¼©è¿‡æ»¤å™¨ï¼‰ï¼Œè¯¥ç±»å’Œå…¶å®ç°ç±»å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ å¦‚æœå¯¹ State TTL è¿˜æœ‰ä¸æ¸…æ¥šçš„å¯ä»¥çœ‹çœ‹ Flink æºç  flink-runtime module ä¸­çš„ state ttl ç›¸å…³çš„å®ç°ç±»ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 4.1.8 å¦‚ä½•ä½¿ç”¨æ‰˜ç®¡çš„ Operator StateCheckpointedFunctionListCheckpointed4.1.9 Stateful Source Functions4.1.10 Broadcast StateFlink ä¸­çš„ Broadcast State åœ¨å¾ˆå¤šåœºæ™¯ä¸‹ä¹Ÿæœ‰ä½¿ç”¨ï¼Œä¸‹é¢æ¥è®²è§£ä¸‹å…¶ä½¿ç”¨æ–¹å¼ã€‚ Broadcast State å¦‚ä½•ä½¿ç”¨ä½¿ç”¨ Broadcast state éœ€è¦æ³¨æ„4.1.11 Queryable StateåŠ å…¥çŸ¥è¯†æ˜Ÿçƒå¯ä»¥çœ‹åˆ°ä¸Šé¢æ–‡ç« ï¼š https://t.zsxq.com/ZVByvzN 4.1.12 å°ç»“ä¸åæ€æœ¬èŠ‚ä¸€å¼€å§‹è®²è§£äº† State å‡ºç°çš„åŸå› ï¼Œæ¥ç€è®²è§£äº† Flink ä¸­çš„ State åˆ†ç±»ï¼Œç„¶åå¯¹ Flink ä¸­çš„æ¯ç§ State åšäº†è¯¦ç»†çš„è®²è§£ï¼Œå¸Œæœ›å¯ä»¥å¥½å¥½æ¶ˆåŒ–è¿™èŠ‚çš„å†…å®¹ã€‚ä½ å¯¹æœ¬èŠ‚çš„å†…å®¹æœ‰ä»€ä¹ˆä¸ç†è§£çš„åœ°æ–¹å—ï¼Ÿåœ¨ä½¿ç”¨ State çš„è¿‡ç¨‹ä¸­æœ‰é‡åˆ°ä»€ä¹ˆé—®é¢˜å—ï¼Ÿ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹â€”â€” ä½¿ç”¨ Side Output åˆ†æµ","date":"2021-07-22T16:00:00.000Z","path":"2021/07/23/flink-in-action-3.12/","text":"3.12 ä½¿ç”¨ Side Output åˆ†æµé€šå¸¸ï¼Œåœ¨ Kafka çš„ topic ä¸­ä¼šæœ‰å¾ˆå¤šæ•°æ®ï¼Œè¿™äº›æ•°æ®è™½ç„¶ç»“æ„æ˜¯ä¸€è‡´çš„ï¼Œä½†æ˜¯ç±»å‹å¯èƒ½ä¸ä¸€è‡´ï¼Œä¸¾ä¸ªä¾‹å­ï¼šKafka ä¸­çš„ç›‘æ§æ•°æ®æœ‰å¾ˆå¤šç§ï¼šæœºå™¨ã€å®¹å™¨ã€åº”ç”¨ã€ä¸­é—´ä»¶ç­‰ï¼Œå¦‚æœè¦å¯¹è¿™äº›æ•°æ®åˆ†åˆ«å¤„ç†ï¼Œå°±éœ€è¦å¯¹è¿™äº›æ•°æ®æµè¿›è¡Œä¸€ä¸ªæ‹†åˆ†ï¼Œé‚£ä¹ˆåœ¨ Flink ä¸­è¯¥æ€ä¹ˆå®Œæˆè¿™éœ€æ±‚å‘¢ï¼Œæœ‰å¦‚ä¸‹è¿™äº›æ–¹æ³•ã€‚ 3.12.1 ä½¿ç”¨ Filter åˆ†æµä½¿ç”¨ filter ç®—å­æ ¹æ®æ•°æ®çš„å­—æ®µè¿›è¡Œè¿‡æ»¤åˆ†æˆæœºå™¨ã€å®¹å™¨ã€åº”ç”¨ã€ä¸­é—´ä»¶ç­‰ã€‚ä¼ªä»£ç å¦‚ä¸‹ï¼š 12345DataStreamSource&lt;MetricEvent&gt; data = KafkaConfigUtil.buildSource(env); //ä» Kafka è·å–åˆ°æ‰€æœ‰çš„æ•°æ®æµSingleOutputStreamOperator&lt;MetricEvent&gt; machineData = data.filter(m -&gt; \"machine\".equals(m.getTags().get(\"type\"))); //è¿‡æ»¤å‡ºæœºå™¨çš„æ•°æ®SingleOutputStreamOperator&lt;MetricEvent&gt; dockerData = data.filter(m -&gt; \"docker\".equals(m.getTags().get(\"type\"))); //è¿‡æ»¤å‡ºå®¹å™¨çš„æ•°æ®SingleOutputStreamOperator&lt;MetricEvent&gt; applicationData = data.filter(m -&gt; \"application\".equals(m.getTags().get(\"type\"))); //è¿‡æ»¤å‡ºåº”ç”¨çš„æ•°æ®SingleOutputStreamOperator&lt;MetricEvent&gt; middlewareData = data.filter(m -&gt; \"middleware\".equals(m.getTags().get(\"type\"))); //è¿‡æ»¤å‡ºä¸­é—´ä»¶çš„æ•°æ® 3.12.2 ä½¿ç”¨ Split åˆ†æµå…ˆåœ¨ split ç®—å­é‡Œé¢å®šä¹‰ OutputSelector çš„åŒ¿åå†…éƒ¨æ„é€ ç±»ï¼Œç„¶åé‡å†™ select æ–¹æ³•ï¼Œæ ¹æ®æ•°æ®çš„ç±»å‹å°†ä¸åŒçš„æ•°æ®æ”¾åˆ°ä¸åŒçš„ tag é‡Œé¢ï¼Œè¿™æ ·è¿”å›åçš„æ•°æ®æ ¼å¼æ˜¯ SplitStreamï¼Œç„¶åè¦ä½¿ç”¨è¿™äº›æ•°æ®çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡ select å»é€‰æ‹©å¯¹åº”çš„æ•°æ®ç±»å‹ï¼Œä¼ªä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930DataStreamSource&lt;MetricEvent&gt; data = KafkaConfigUtil.buildSource(env); //ä» Kafka è·å–åˆ°æ‰€æœ‰çš„æ•°æ®æµSplitStream&lt;MetricEvent&gt; splitData = data.split(new OutputSelector&lt;MetricEvent&gt;() &#123; @Override public Iterable&lt;String&gt; select(MetricEvent metricEvent) &#123; List&lt;String&gt; tags = new ArrayList&lt;&gt;(); String type = metricEvent.getTags().get(\"type\"); switch (type) &#123; case \"machine\": tags.add(\"machine\"); break; case \"docker\": tags.add(\"docker\"); break; case \"application\": tags.add(\"application\"); break; case \"middleware\": tags.add(\"middleware\"); break; default: break; &#125; return tags; &#125;&#125;);DataStream&lt;MetricEvent&gt; machine = splitData.select(\"machine\");DataStream&lt;MetricEvent&gt; docker = splitData.select(\"docker\");DataStream&lt;MetricEvent&gt; application = splitData.select(\"application\");DataStream&lt;MetricEvent&gt; middleware = splitData.select(\"middleware\"); ä¸Šé¢è¿™ç§åªåˆ†æµä¸€æ¬¡æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œæ³¨æ„å¦‚æœè¦ä½¿ç”¨å®ƒæ¥åšè¿ç»­çš„åˆ†æµï¼Œé‚£æ˜¯æœ‰é—®é¢˜çš„ï¼Œç¬”è€…æ›¾ç»å°±é‡åˆ°è¿‡è¿™ä¸ªé—®é¢˜ï¼Œå½“æ—¶è®°å½•äº†åšå®¢ â€”â€” Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ ï¼Œå½“æ—¶æ’æŸ¥è¿™ä¸ªé—®é¢˜è¿˜æŸ¥åˆ°ä¸¤ä¸ªç›¸å…³çš„ Flink Issueã€‚ FLINK-5031 Issue FLINK-11084 Issue è¿™ä¸¤ä¸ª Issue åæ˜ çš„å°±æ˜¯è¿ç»­ split ä¸èµ·ä½œç”¨ï¼Œåœ¨ç¬¬äºŒä¸ª Issue ä¸‹é¢çš„è¯„è®ºå°±æœ‰å›å¤è¯´ Side Output çš„åŠŸèƒ½æ¯” split æ›´å¼ºå¤§ï¼Œ split ä¼šåœ¨åé¢çš„ç‰ˆæœ¬ç§»é™¤ï¼ˆå…¶å®åœ¨ 1.7.x ç‰ˆæœ¬å°±å·²ç»è®¾ç½®ä¸ºè¿‡æœŸï¼‰ï¼Œé‚£ä¹ˆä¸‹é¢å°±æ¥å­¦ä¹ ä¸€ä¸‹ Side Outputã€‚ 3.12.3 ä½¿ç”¨ Side Output åˆ†æµè¦ä½¿ç”¨ Side Output çš„è¯ï¼Œä½ é¦–å…ˆéœ€è¦åšçš„æ˜¯å®šä¹‰ä¸€ä¸ª OutputTag æ¥æ ‡è¯† Side Outputï¼Œä»£è¡¨è¿™ä¸ª Tag æ˜¯è¦æ”¶é›†å“ªç§ç±»å‹çš„æ•°æ®ï¼Œå¦‚æœæ˜¯è¦æ”¶é›†å¤šç§ä¸ä¸€æ ·ç±»å‹çš„æ•°æ®ï¼Œé‚£ä¹ˆä½ å°±éœ€è¦å®šä¹‰å¤šç§ OutputTagã€‚è¦å®Œæˆæœ¬èŠ‚å‰é¢çš„éœ€æ±‚ï¼Œéœ€è¦å®šä¹‰ 4 ä¸ª OutputTagï¼Œå¦‚ä¸‹ï¼š 123456789//åˆ›å»º output tagprivate static final OutputTag&lt;MetricEvent&gt; machineTag = new OutputTag&lt;MetricEvent&gt;(\"machine\") &#123;&#125;;private static final OutputTag&lt;MetricEvent&gt; dockerTag = new OutputTag&lt;MetricEvent&gt;(\"docker\") &#123;&#125;;private static final OutputTag&lt;MetricEvent&gt; applicationTag = new OutputTag&lt;MetricEvent&gt;(\"application\") &#123;&#125;;private static final OutputTag&lt;MetricEvent&gt; middlewareTag = new OutputTag&lt;MetricEvent&gt;(\"middleware\") &#123;&#125;; å®šä¹‰å¥½ OutputTag åï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢å‡ ç§å‡½æ•°æ¥å¤„ç†æ•°æ®ï¼š ProcessFunction KeyedProcessFunction CoProcessFunction ProcessWindowFunction ProcessAllWindowFunction åœ¨åˆ©ç”¨ä¸Šé¢çš„å‡½æ•°å¤„ç†æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦å¯¹æ•°æ®è¿›è¡Œåˆ¤æ–­ï¼Œå°†ä¸åŒç§ç±»å‹çš„æ•°æ®å­˜åˆ°ä¸åŒçš„ OutputTag ä¸­å»ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š 12345678910111213141516171819DataStreamSource&lt;MetricEvent&gt; data = KafkaConfigUtil.buildSource(env); //ä» Kafka è·å–åˆ°æ‰€æœ‰çš„æ•°æ®æµSingleOutputStreamOperator&lt;MetricEvent&gt; sideOutputData = data.process(new ProcessFunction&lt;MetricEvent, MetricEvent&gt;() &#123; @Override public void processElement(MetricEvent metricEvent, Context context, Collector&lt;MetricEvent&gt; collector) throws Exception &#123; String type = metricEvent.getTags().get(\"type\"); switch (type) &#123; case \"machine\": context.output(machineTag, metricEvent); case \"docker\": context.output(dockerTag, metricEvent); case \"application\": context.output(applicationTag, metricEvent); case \"middleware\": context.output(middlewareTag, metricEvent); default: collector.collect(metricEvent); &#125; &#125;&#125;); å¥½äº†ï¼Œæ—¢ç„¶ä¸Šé¢å·²ç»å°†ä¸åŒç±»å‹çš„æ•°æ®æ”¾åˆ°ä¸åŒçš„ OutputTag é‡Œé¢äº†ï¼Œé‚£ä¹ˆè¯¥å¦‚ä½•å»è·å–å‘¢ï¼Ÿå¯ä»¥ä½¿ç”¨ getSideOutput æ–¹æ³•æ¥è·å–ä¸åŒ OutputTag çš„æ•°æ®ï¼Œæ¯”å¦‚ï¼š 1234DataStream&lt;MetricEvent&gt; machine = sideOutputData.getSideOutput(machineTag);DataStream&lt;MetricEvent&gt; docker = sideOutputData.getSideOutput(dockerTag);DataStream&lt;MetricEvent&gt; application = sideOutputData.getSideOutput(applicationTag);DataStream&lt;MetricEvent&gt; middleware = sideOutputData.getSideOutput(middlewareTag); è¿™æ ·ä½ å°±å¯ä»¥è·å–åˆ° Side Output æ•°æ®äº†ï¼Œå…¶å®åœ¨ 3.4 å’Œ 3.5 èŠ‚å°±è®²äº† Side Output åœ¨ Flink ä¸­çš„åº”ç”¨ï¼ˆå¤„ç†çª—å£çš„å»¶è¿Ÿæ•°æ®ï¼‰ï¼Œå¤§å®¶å¦‚æœæ²¡æœ‰å°è±¡äº†å¯ä»¥å†è¿”å›å»å¤ä¹ ä¸€ä¸‹ã€‚ 3.12.4 å°ç»“ä¸åæ€æœ¬èŠ‚è®²äº†ä¸‹ Flink ä¸­å°†æ•°æ®åˆ†æµçš„ä¸‰ç§æ–¹å¼ï¼Œå®Œæ•´ä»£ç çš„ GitHub åœ°å€ï¼šsideoutput æœ¬ç« å…¨éƒ¨åœ¨ä»‹ç» Flink çš„æŠ€æœ¯ç‚¹ï¼Œæ¯”å¦‚å¤šç§æ—¶é—´è¯­ä¹‰çš„å¯¹æ¯”åˆ†æå’Œåº”ç”¨åœºæ™¯åˆ†æã€å¤šç§çµæ´»çš„çª—å£çš„ä½¿ç”¨æ–¹å¼åŠå…¶åŸç†å®ç°ã€å¹³æ—¶å¼€å‘ä½¿ç”¨è¾ƒå¤šçš„ä¸€äº›ç®—å­ã€æ·±å…¥è®²è§£äº† DataStream ä¸­çš„æµç±»å‹åŠå…¶å¯¹åº”çš„æ–¹æ³•å®ç°ã€å¦‚ä½•å°† Watermark ä¸ Window ç»“åˆæ¥å¤„ç†å»¶è¿Ÿæ•°æ®ã€Flink Connector çš„ä½¿ç”¨æ–¹å¼ã€‚ å› ä¸º Flink çš„ Connector æ¯”è¾ƒå¤šï¼Œæ‰€ä»¥æœ¬ä¹¦åªæŒ‘é€‰äº†äº›å¹³æ—¶å·¥ä½œç”¨çš„æ¯”è¾ƒå¤šçš„ Connectorï¼Œæ¯”å¦‚ Kafkaã€ElasticSearchã€HBaseã€Redis ç­‰ï¼Œå¹¶æ•™ä¼šäº†å¤§å®¶å¦‚ä½•å»è‡ªå®šä¹‰ Source å’Œ Sinkï¼Œè¿™æ ·å°±ç®— Flink ä¸­çš„ Connector æ²¡æœ‰ä½ éœ€è¦çš„ï¼Œé‚£ä¹ˆä¹Ÿå¯ä»¥é€šè¿‡è¿™ç§è‡ªå®šä¹‰çš„æ–¹æ³•æ¥å®ç°è¯»å–å’Œå†™å…¥æ•°æ®ã€‚ æœ¬ç« è®²è§£çš„å†…å®¹æ›´ä¾§é‡äºåœ¨ Flink DataStream å’Œ Connector çš„ä½¿ç”¨æŠ€å·§å’Œä¼˜åŒ–ï¼Œåœ¨è®²è§£è¿™äº›æ—¶è¿˜æä¾›äº†è¯¦ç»†çš„ä»£ç å®ç°ï¼Œç›®çš„é™¤äº†å¤§å®¶å¯ä»¥å‚è€ƒå¤–ï¼Œå…¶å®æ›´æœŸæœ›å¤§å®¶èƒ½å¤Ÿè‡ªå·±è·Ÿç€å¤šåŠ¨æ‰‹å»å®ç°å’Œä¼˜åŒ–ï¼Œè¿™æ ·æ‰å¯ä»¥æé«˜è‡ªå·±çš„ç¼–ç¨‹æ°´å¹³ã€‚å¦å¤–æœ¬ç« è¿˜ä»‹ç»äº†è‡ªå·±åœ¨ä½¿ç”¨è¿™äº› Connector æ—¶é‡åˆ°çš„ä¸€äº›é—®é¢˜ï¼Œæ˜¯æ€ä¹ˆè§£å†³çš„ï¼Œä¹Ÿå¸Œæœ›å¤§å®¶åœ¨å·¥ä½œçš„æ—¶å€™é‡åˆ°é—®é¢˜å¯ä»¥é™ä¸‹æ¥è‡ªå·±ç‹¬ç«‹çš„æ€è€ƒä¸‹å‡ºç°é—®é¢˜çš„åŸå› æ˜¯å•¥ï¼Œè¯¥å¦‚ä½•è§£å†³ï¼Œå¤šç‹¬ç«‹æ€è€ƒåï¼Œç›¸ä¿¡é‡åˆ°é—®é¢˜åä½ ä¹Ÿèƒ½å¤Ÿä»å®¹çš„åˆ†æå’Œè§£å†³é—®é¢˜ã€‚ åŠ å…¥çŸ¥è¯†æ˜Ÿçƒå¯ä»¥çœ‹åˆ°æ›´å¤šæ–‡ç« ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹â€”â€” Flink Connector â€”â€” Redis çš„ç”¨æ³•","date":"2021-07-21T16:00:00.000Z","path":"2021/07/22/flink-in-action-3.11/","text":"3.11 Flink Connector â€”â€” Redis çš„ç”¨æ³•åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œé€šå¸¸ä¼šå°†ä¸€äº›è®¡ç®—åçš„æ•°æ®å­˜å‚¨åœ¨ Redis ä¸­ï¼Œä»¥ä¾›ç¬¬ä¸‰æ–¹çš„åº”ç”¨å» Redis æŸ¥æ‰¾å¯¹åº”çš„æ•°æ®ï¼Œè‡³äº Redis çš„ç‰¹æ€§ç¬”è€…ä¸ä¼šåœ¨æœ¬èŠ‚åšè¿‡å¤šçš„è®²è§£ã€‚ 3.11.1 å®‰è£… Redisé¦–å…ˆä»‹ç»ä¸‹ Redis çš„çš„å®‰è£…å’Œå¯åŠ¨è¿è¡Œã€‚ ä¸‹è½½å®‰è£…å…ˆä» å®˜ç½‘ ä¸‹è½½ Redisï¼Œç„¶åè§£å‹ã€‚ 1234wget http://download.redis.io/releases/redis-5.0.4.tar.gztar xzf redis-5.0.4.tar.gzcd redis-5.0.4make é€šè¿‡ HomeBrew å®‰è£…1brew install redis å¦‚æœéœ€è¦åå°è¿è¡Œ Redis æœåŠ¡ï¼Œä½¿ç”¨å‘½ä»¤ï¼š 1brew services start redis è¦è¿è¡Œå‘½ä»¤ï¼Œå¯ä»¥ç›´æ¥åˆ° /usr/local/bin ç›®å½•ä¸‹ï¼Œæœ‰ï¼š 12redis-serverredis-cli ä¸¤ä¸ªå‘½ä»¤ï¼Œæ‰§è¡Œ redis-server å¯ä»¥æ‰“å¼€æœåŠ¡ç«¯ï¼Œå¯åŠ¨åç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ç„¶åå¦å¤–å¼€ä¸€ä¸ªç»ˆç«¯ï¼Œè¿è¡Œ redis-cli å‘½ä»¤å¯ä»¥è¿è¡Œå®¢æˆ·ç«¯ï¼Œæ‰§è¡Œåæ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 3.11.2 å°†å•†å“æ•°æ®å‘é€åˆ° Kafkaè¿™é‡Œæˆ‘æ‰“ç®—å°†ä» Kafka è¯»å–åˆ°æ‰€æœ‰åˆ°å•†å“çš„ä¿¡æ¯ï¼Œç„¶åå°†å•†å“ä¿¡æ¯ä¸­çš„ å•†å“ID å’Œ å•†å“ä»·æ ¼ æå–å‡ºæ¥ï¼Œç„¶åå†™å…¥åˆ° Redis ä¸­ï¼Œä¾›ç¬¬ä¸‰æ–¹æœåŠ¡æ ¹æ®å•†å“ ID æŸ¥è¯¢åˆ°å…¶å¯¹åº”çš„å•†å“ä»·æ ¼ã€‚ é¦–å…ˆå®šä¹‰æˆ‘ä»¬çš„å•†å“ç±» ï¼ˆå…¶ä¸­ id å’Œ price å­—æ®µæ˜¯æˆ‘ä»¬æœ€åè¦æå–çš„ï¼‰ä¸ºï¼š ProductEvent.java 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576/** * Desc: å•†å“ * blogï¼šhttp://www.54tianzhisheng.cn/ * å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng */@Data@Builder@AllArgsConstructor@NoArgsConstructorpublic class ProductEvent &#123; /** * Product Id */ private Long id; /** * Product ç±»ç›® Id */ private Long categoryId; /** * Product ç¼–ç  */ private String code; /** * Product åº—é“º Id */ private Long shopId; /** * Product åº—é“º name */ private String shopName; /** * Product å“ç‰Œ Id */ private Long brandId; /** * Product å“ç‰Œ name */ private String brandName; /** * Product name */ private String name; /** * Product å›¾ç‰‡åœ°å€ */ private String imageUrl; /** * Product çŠ¶æ€ï¼ˆ1(ä¸Šæ¶),-1(ä¸‹æ¶),-2(å†»ç»“),-3(åˆ é™¤)ï¼‰ */ private int status; /** * Product ç±»å‹ */ private int type; /** * Product æ ‡ç­¾ */ private List&lt;String&gt; tags; /** * Product ä»·æ ¼ï¼ˆä»¥åˆ†ä¸ºå•ä½ï¼‰ */ private Long price;&#125; ç„¶åå†™ä¸ªå·¥å…·ç±»ä¸æ–­çš„æ¨¡æ‹Ÿå•†å“æ•°æ®å‘å¾€ Kafkaï¼Œå·¥å…·ç±» ProductUtil.java çš„ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526public class ProductUtil &#123; public static final String broker_list = \"localhost:9092\"; public static final String topic = \"zhisheng\"; //kafka topic éœ€è¦å’Œ flink ç¨‹åºç”¨åŒä¸€ä¸ª topic public static final Random random = new Random(); public static void main(String[] args) &#123; Properties props = new Properties(); props.put(\"bootstrap.servers\", broker_list); props.put(\"key.serializer\", \"org.apache.kafka.common.serialization.StringSerializer\"); props.put(\"value.serializer\", \"org.apache.kafka.common.serialization.StringSerializer\"); KafkaProducer producer = new KafkaProducer&lt;String, String&gt;(props); for (int i = 1; i &lt;= 10000; i++) &#123; ProductEvent product = ProductEvent.builder().id((long) i) //å•†å“çš„ id .name(\"product\" + i) //å•†å“ name .price(random.nextLong() / 10000000000000L) //å•†å“ä»·æ ¼ï¼ˆä»¥åˆ†ä¸ºå•ä½ï¼‰ .code(\"code\" + i).build(); //å•†å“ç¼–ç  ProducerRecord record = new ProducerRecord&lt;String, String&gt;(topic, null, null, GsonUtil.toJson(product)); producer.send(record); System.out.println(\"å‘é€æ•°æ®: \" + GsonUtil.toJson(product)); &#125; producer.flush(); &#125;&#125; 3.11.3 Flink æ¶ˆè´¹ Kafka ä¸­çš„å•†å“æ•°æ®æˆ‘ä»¬éœ€è¦åœ¨ Flink ä¸­æ¶ˆè´¹ Kafka æ•°æ®ï¼Œç„¶åå°†å•†å“ä¸­çš„ä¸¤ä¸ªæ•°æ®ï¼ˆå•†å“ id å’Œ priceï¼‰å–å‡ºæ¥ã€‚å…ˆæ¥çœ‹ä¸‹è¿™æ®µ Flink Job ä»£ç ï¼š 1234567891011121314151617181920212223public class Main &#123; public static void main(String[] args) throws Exception &#123; final StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment(); ParameterTool parameterTool = ExecutionEnvUtil.PARAMETER_TOOL; Properties props = KafkaConfigUtil.buildKafkaProps(parameterTool); SingleOutputStreamOperator&lt;Tuple2&lt;String, String&gt;&gt; product = env.addSource(new FlinkKafkaConsumer011&lt;&gt;( parameterTool.get(METRICS_TOPIC), //è¿™ä¸ª kafka topic éœ€è¦å’Œä¸Šé¢çš„å·¥å…·ç±»çš„ topic ä¸€è‡´ new SimpleStringSchema(), props)) .map(string -&gt; GsonUtil.fromJson(string, ProductEvent.class)) //ååºåˆ—åŒ– JSON .flatMap(new FlatMapFunction&lt;ProductEvent, Tuple2&lt;String, String&gt;&gt;() &#123; @Override public void flatMap(ProductEvent value, Collector&lt;Tuple2&lt;String, String&gt;&gt; out) throws Exception &#123; //æ”¶é›†å•†å“ id å’Œ price ä¸¤ä¸ªå±æ€§ out.collect(new Tuple2&lt;&gt;(value.getId().toString(), value.getPrice().toString())); &#125; &#125;); product.print(); env.execute(\"flink redis connector\"); &#125;&#125; ç„¶å IDEA ä¸­å¯åŠ¨è¿è¡Œ Jobï¼Œå†è¿è¡Œä¸Šé¢çš„ ProductUtil å‘é€ Kafka æ•°æ®çš„å·¥å…·ç±»ï¼ˆæ³¨æ„ï¼šä¹Ÿå¾—æå‰å¯åŠ¨ Kafkaï¼‰ï¼Œè¿è¡Œç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ ä¸Šå›¾å·¦åŠéƒ¨åˆ†æ˜¯å·¥å…·ç±»å‘é€æ•°æ®åˆ° Kafka æ‰“å°çš„æ—¥å¿—ï¼Œå³åŠéƒ¨åˆ†æ˜¯ Job æ‰§è¡Œçš„ç»“æœï¼Œå¯ä»¥çœ‹åˆ°å®ƒå·²ç»å°†å•†å“çš„ id å’Œ price æ•°æ®è·å–åˆ°äº†ã€‚ é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦çš„å°±æ˜¯å°†è¿™ç§ Tuple2&lt;Long, Long&gt; æ ¼å¼çš„ KV æ•°æ®å†™å…¥åˆ° Redis ä¸­å»ã€‚è¦å°†æ•°æ®å†™å…¥åˆ° Redis çš„è¯æ˜¯éœ€è¦å…ˆæ·»åŠ ä¾èµ–çš„ã€‚ 3.11.4 Redis Connector ç®€ä»‹Redis Connector æä¾›ç”¨äºå‘ Redis å‘é€æ•°æ®çš„æ¥å£çš„ç±»ã€‚æ¥æ”¶å™¨å¯ä»¥ä½¿ç”¨ä¸‰ç§ä¸åŒçš„æ–¹æ³•ä¸ä¸åŒç±»å‹çš„ Redis ç¯å¢ƒè¿›è¡Œé€šä¿¡ï¼š å• Redis æœåŠ¡å™¨ Redis é›†ç¾¤ Redis Sentinel æ·»åŠ ä¾èµ–éœ€è¦æ·»åŠ  Flink Redis Sink çš„ Connectorï¼Œè¿™ä¸ª Redis Connector å®˜æ–¹åªæœ‰è€çš„ç‰ˆæœ¬ï¼Œåé¢ä¹Ÿä¸€ç›´æ²¡æœ‰æ›´æ–°ï¼Œæ‰€ä»¥å¯ä»¥çœ‹åˆ°ç½‘ä¸Šæœ‰äº›æ–‡ç« éƒ½æ˜¯æ·»åŠ è€çš„ç‰ˆæœ¬çš„ä¾èµ–ã€‚ 12345&lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-connector-redis_2.10&lt;/artifactId&gt; &lt;version&gt;1.1.5&lt;/version&gt;&lt;/dependency&gt; åŒ…æ‹¬è¯¥éƒ¨åˆ†çš„æ–‡æ¡£éƒ½æ˜¯å¾ˆæ—©ä¹‹å‰çš„å•¦ï¼Œå¯ä»¥æŸ¥çœ‹ flink-docs-release-1.1 redisã€‚ å¦å¤–åœ¨ flink-streaming-redis ä¹Ÿçœ‹åˆ°ä¸€ä¸ª Flink Redis Connector çš„ä¾èµ–ã€‚ 12345&lt;dependency&gt; &lt;groupId&gt;org.apache.bahir&lt;/groupId&gt; &lt;artifactId&gt;flink-connector-redis_2.11&lt;/artifactId&gt; &lt;version&gt;1.0&lt;/version&gt;&lt;/dependency&gt; ä¸¤ä¸ªä¾èµ–åŠŸèƒ½éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬è¿˜æ˜¯å°±ç”¨å®˜æ–¹çš„é‚£ä¸ª Maven ä¾èµ–æ¥è¿›è¡Œæ¼”ç¤ºã€‚ 3.11.5 Flink å†™å…¥æ•°æ®åˆ° Redis3.11.6 é¡¹ç›®è¿è¡ŒåŠéªŒè¯3.11.7 å°ç»“ä¸åæ€åŠ å…¥çŸ¥è¯†æ˜Ÿçƒå¯ä»¥çœ‹åˆ°ä¸Šé¢æ–‡ç« ï¼šhttps://t.zsxq.com/zr76I66","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹â€”â€” Flink Connector â€”â€” HBase çš„ç”¨æ³•","date":"2021-07-20T16:00:00.000Z","path":"2021/07/21/flink-in-action-3.10/","text":"3.10 Flink Connector â€”â€” HBase çš„ç”¨æ³•HBase æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„ã€é¢å‘åˆ—çš„å¼€æºæ•°æ®åº“ï¼ŒåŒæ ·ï¼Œå¾ˆå¤šå…¬å¸ä¹Ÿæœ‰ä½¿ç”¨è¯¥æŠ€æœ¯å­˜å‚¨æ•°æ®çš„ï¼Œæœ¬èŠ‚å°†å¯¹ HBase åšäº›ç®€å•çš„ä»‹ç»ï¼Œä»¥åŠåˆ©ç”¨ Flink HBase Connector è¯»å– HBase ä¸­çš„æ•°æ®å’Œå†™å…¥æ•°æ®åˆ° HBase ä¸­ã€‚ 3.10.1 å‡†å¤‡ç¯å¢ƒå’Œä¾èµ–ä¸‹é¢åˆ†åˆ«è®²è§£ HBase çš„ç¯å¢ƒå®‰è£…ã€é…ç½®ã€å¸¸ç”¨çš„å‘½ä»¤æ“ä½œä»¥åŠæ·»åŠ é¡¹ç›®éœ€è¦çš„ä¾èµ–ã€‚ HBase å®‰è£…å¦‚æœæ˜¯è‹¹æœç³»ç»Ÿï¼Œå¯ä»¥ä½¿ç”¨ HomeBrew å‘½ä»¤å®‰è£…ï¼š 1brew install hbase HBase æœ€ç»ˆä¼šå®‰è£…åœ¨è·¯å¾„ /usr/local/Cellar/hbase/ ä¸‹é¢ï¼Œå®‰è£…ç‰ˆæœ¬ä¸åŒï¼Œæ–‡ä»¶åä¹Ÿä¸åŒã€‚ é…ç½® HBaseæ‰“å¼€ libexec/conf/hbase-env.sh ä¿®æ”¹é‡Œé¢çš„ JAVA_HOMEï¼š 12# The java implementation to use. Java 1.7+ required.export JAVA_HOME=&quot;/Library/Java/JavaVirtualMachines/jdk1.8.0_152.jdk/Contents/Home&quot; æ ¹æ®ä½ è‡ªå·±çš„ JAVA_HOME æ¥é…ç½®è¿™ä¸ªå˜é‡ã€‚ æ‰“å¼€ libexec/conf/hbase-site.xml é…ç½® HBase æ–‡ä»¶å­˜å‚¨ç›®å½•: 1234567891011121314151617181920212223242526272829&lt;configuration&gt; &lt;property&gt; &lt;name&gt;hbase.rootdir&lt;/name&gt; &lt;!-- é…ç½®HBaseå­˜å‚¨æ–‡ä»¶çš„ç›®å½• --&gt; &lt;value&gt;file:///usr/local/var/hbase&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;hbase.zookeeper.property.clientPort&lt;/name&gt; &lt;value&gt;2181&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;hbase.zookeeper.property.dataDir&lt;/name&gt; &lt;!-- é…ç½®HBaseå­˜å‚¨å†…å»ºzookeeperæ–‡ä»¶çš„ç›®å½• --&gt; &lt;value&gt;/usr/local/var/zookeeper&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;hbase.zookeeper.dns.interface&lt;/name&gt; &lt;value&gt;lo0&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;hbase.regionserver.dns.interface&lt;/name&gt; &lt;value&gt;lo0&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;hbase.master.dns.interface&lt;/name&gt; &lt;value&gt;lo0&lt;/value&gt; &lt;/property&gt;&lt;/configuration&gt; è¿è¡Œ HBaseæ‰§è¡Œå¯åŠ¨çš„å‘½ä»¤ï¼š 1./bin/start-hbase.sh æ‰§è¡Œåæ‰“å°å‡ºæ¥çš„æ—¥å¿—å¦‚ï¼š 1starting master, logging to /usr/local/var/log/hbase/hbase-zhisheng-master-zhisheng.out éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸä½¿ç”¨ jps å‘½ä»¤ï¼š 12345zhisheng@zhisheng /usr/local/Cellar/hbase/1.2.9/libexec jps91302 HMaster62535 RemoteMavenServer110091471 Jps å‡ºç° HMaster è¯´æ˜å®‰è£…è¿è¡ŒæˆåŠŸã€‚ å¯åŠ¨ HBase Shellæ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼š 1./bin/hbase shell è¿è¡Œç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š åœæ­¢ HBaseæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š 1./bin/stop-hbase.sh è¿è¡Œç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š HBase å¸¸ç”¨å‘½ä»¤HBase ä¸­å¸¸ç”¨çš„å‘½ä»¤æœ‰ï¼šlistï¼ˆåˆ—å‡ºå·²å­˜åœ¨çš„è¡¨ï¼‰ã€createï¼ˆåˆ›å»ºè¡¨ï¼‰ã€putï¼ˆå†™æ•°æ®ï¼‰ã€getï¼ˆè¯»æ•°æ®ï¼‰ã€scanï¼ˆè¯»æ•°æ®ï¼Œè¯»å…¨è¡¨ï¼‰ã€describeï¼ˆæ˜¾ç¤ºè¡¨è¯¦æƒ…ï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ ç®€å•ä½¿ç”¨ä¸Šè¯‰å‘½ä»¤çš„ç»“æœå¦‚ä¸‹ï¼š æ·»åŠ ä¾èµ–åœ¨ pom.xml ä¸­æ·»åŠ  HBase ç›¸å…³çš„ä¾èµ–ï¼š 12345678910&lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-hbase_$&#123;scala.binary.version&#125;&lt;/artifactId&gt; &lt;version&gt;$&#123;flink.version&#125;&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.hadoop&lt;/groupId&gt; &lt;artifactId&gt;hadoop-common&lt;/artifactId&gt; &lt;version&gt;2.7.4&lt;/version&gt;&lt;/dependency&gt; Flink HBase Connector ä¸­ï¼ŒHBase ä¸ä»…å¯ä»¥ä½œä¸ºæ•°æ®æºï¼Œä¹Ÿè¿˜å¯ä»¥å†™å…¥æ•°æ®åˆ° HBase ä¸­å»ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹å¦‚ä½•ä» HBase ä¸­è¯»å–æ•°æ®ã€‚ 3.10.2 Flink ä½¿ç”¨ TableInputFormat è¯»å– HBase æ‰¹é‡æ•°æ®è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ TableInputFormat æ¥è¯»å– HBase ä¸­çš„æ•°æ®ï¼Œé¦–å…ˆå‡†å¤‡æ•°æ®ã€‚ å‡†å¤‡æ•°æ®å…ˆå¾€ HBase ä¸­æ’å…¥äº”æ¡æ•°æ®å¦‚ä¸‹ï¼š 12345put &apos;zhisheng&apos;, &apos;first&apos;, &apos;info:bar&apos;, &apos;hello&apos;put &apos;zhisheng&apos;, &apos;second&apos;, &apos;info:bar&apos;, &apos;zhisheng001&apos;put &apos;zhisheng&apos;, &apos;third&apos;, &apos;info:bar&apos;, &apos;zhisheng002&apos;put &apos;zhisheng&apos;, &apos;four&apos;, &apos;info:bar&apos;, &apos;zhisheng003&apos;put &apos;zhisheng&apos;, &apos;five&apos;, &apos;info:bar&apos;, &apos;zhisheng004&apos; scan æ•´ä¸ª zhisheng è¡¨çš„è¯ï¼Œæœ‰äº”æ¡æ•°æ®ï¼Œè¿è¡Œç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š Flink Job ä»£ç Flink è¯»å– HBase æ•°æ®çš„ç¨‹åºä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041/** * Desc: è¯»å– HBase æ•°æ® */public class HBaseReadMain &#123; //è¡¨å public static final String HBASE_TABLE_NAME = \"zhisheng\"; // åˆ—æ— static final byte[] INFO = \"info\".getBytes(ConfigConstants.DEFAULT_CHARSET); //åˆ—å static final byte[] BAR = \"bar\".getBytes(ConfigConstants.DEFAULT_CHARSET); public static void main(String[] args) throws Exception &#123; ExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment(); env.createInput(new TableInputFormat&lt;Tuple2&lt;String, String&gt;&gt;() &#123; private Tuple2&lt;String, String&gt; reuse = new Tuple2&lt;String, String&gt;(); @Override protected Scan getScanner() &#123; Scan scan = new Scan(); scan.addColumn(INFO, BAR); return scan; &#125; @Override protected String getTableName() &#123; return HBASE_TABLE_NAME; &#125; @Override protected Tuple2&lt;String, String&gt; mapResultToTuple(Result result) &#123; String key = Bytes.toString(result.getRow()); String val = Bytes.toString(result.getValue(INFO, BAR)); reuse.setField(key, 0); reuse.setField(val, 1); return reuse; &#125; &#125;).filter(new FilterFunction&lt;Tuple2&lt;String, String&gt;&gt;() &#123; @Override public boolean filter(Tuple2&lt;String, String&gt; value) throws Exception &#123; return value.f1.startsWith(\"zhisheng\"); &#125; &#125;).print(); &#125;&#125; ä¸Šé¢ä»£ç ä¸­å°† HBase ä¸­çš„è¯»å–å…¨éƒ¨è¯»å–å‡ºæ¥åç„¶åè¿‡æ»¤ä»¥ zhisheng å¼€å¤´çš„ value æ•°æ®ã€‚è¯»å–ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å¯ä»¥çœ‹åˆ°è¾“å‡ºçš„ç»“æœä¸­å·²ç»å°†ä»¥ zhisheng å¼€å¤´çš„å››æ¡æ•°æ®éƒ½æ‰“å°å‡ºæ¥äº†ã€‚ 3.10.3 Flink ä½¿ç”¨ TableOutputFormat å‘ HBase å†™å…¥æ•°æ®æ·»åŠ ä¾èµ–Flink Job ä»£ç 3.10.4 Flink ä½¿ç”¨ HBaseOutputFormat å‘ HBase å®æ—¶å†™å…¥æ•°æ®è¯»å–æ•°æ®å†™å…¥æ•°æ®é…ç½®æ–‡ä»¶3.10.5 é¡¹ç›®è¿è¡ŒåŠéªŒè¯3.10.6 å°ç»“ä¸åæ€åŠ å…¥çŸ¥è¯†æ˜Ÿçƒå¯ä»¥çœ‹åˆ°ä¸Šé¢æ–‡ç« ï¼šhttps://t.zsxq.com/3bimqBM","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹â€”â€” Flink Connector â€”â€” ElasticSearch çš„ç”¨æ³•å’Œåˆ†æ","date":"2021-07-19T16:00:00.000Z","path":"2021/07/20/flink-in-action-3.9/","text":"3.9 Flink Connector â€”â€” ElasticSearch çš„ç”¨æ³•å’Œåˆ†æElasticSearch ç°åœ¨ä¹Ÿæ˜¯éå¸¸ç«çš„ä¸€é—¨æŠ€æœ¯ï¼Œç›®å‰å¾ˆå¤šå…¬å¸éƒ½æœ‰ä½¿ç”¨ï¼Œæœ¬èŠ‚å°†ä»‹ç» Flink ElasticSearch Connector çš„å®æˆ˜ä½¿ç”¨å’Œå¯èƒ½ä¼šé‡åˆ°çš„é—®é¢˜ã€‚ 3.9.1 å‡†å¤‡ç¯å¢ƒå’Œä¾èµ–é¦–å…ˆå‡†å¤‡ ElasticSearch çš„ç¯å¢ƒå’Œé¡¹ç›®çš„ç¯å¢ƒä¾èµ–ã€‚ ElasticSearch å®‰è£… å› ä¸ºåœ¨ 2.1 èŠ‚ä¸­å·²ç»è®²è¿‡ ElasticSearch çš„å®‰è£…ï¼Œè¿™é‡Œå°±ä¸åšè¿‡å¤šçš„é‡å¤ï¼Œéœ€è¦æ³¨æ„çš„ä¸€ç‚¹å°±æ˜¯ Flink çš„ ElasticSearch Connector æ˜¯åŒºåˆ†ç‰ˆæœ¬å·çš„ï¼Œå®˜æ–¹æ”¯æŒçš„ç‰ˆæœ¬å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ æ‰€ä»¥æ·»åŠ ä¾èµ–çš„æ—¶å€™è¦åŒºåˆ†ä¸€ä¸‹ï¼Œæ ¹æ®ä½ å®‰è£…çš„ ElasticSearch æ¥é€‰æ‹©ä¸ä¸€æ ·çš„ç‰ˆæœ¬ä¾èµ–ï¼Œå¦å¤–å°±æ˜¯ä¸åŒç‰ˆæœ¬çš„ ElasticSearch è¿˜ä¼šå¯¼è‡´ä¸‹é¢çš„æ•°æ®å†™å…¥åˆ° ElasticSearch ä¸­å‡ºç°ä¸€äº›ä¸åŒï¼Œæˆ‘ä»¬è¿™é‡Œä½¿ç”¨çš„ç‰ˆæœ¬æ˜¯ ElasticSearch6ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯å…¶ä»–çš„ç‰ˆæœ¬å¯ä»¥å‚è€ƒå®˜ç½‘çš„å®ç°ã€‚ æ·»åŠ ä¾èµ– å› ä¸ºæˆ‘ä»¬åœ¨ 2.1 èŠ‚ä¸­å®‰è£…çš„ ElasticSearch ç‰ˆæœ¬æ˜¯ 6.3.2 ç‰ˆæœ¬çš„ï¼Œæ‰€æœ‰è¿™é‡Œå¼•å…¥çš„ä¾èµ–å°±é€‰æ‹© flink-connector-elasticsearch6ï¼Œå…·ä½“ä¾èµ–å¦‚ä¸‹æ‰€ç¤ºã€‚ 12345&lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-connector-elasticsearch6_$&#123;scala.binary.version&#125;&lt;/artifactId&gt; &lt;version&gt;$&#123;flink.version&#125;&lt;/version&gt;&lt;/dependency&gt; ä¸Šé¢è¿™ä¸ª scala.binary.version å’Œ flink.version ç‰ˆæœ¬å·éœ€è¦è‡ªå·±åœ¨ä½¿ç”¨çš„æ—¶å€™æ ¹æ®ä½¿ç”¨çš„ç‰ˆæœ¬åšç›¸åº”çš„æ”¹å˜ã€‚ 3.9.2 ä½¿ç”¨ Flink å°†æ•°æ®å†™å…¥åˆ° ElasticSearch åº”ç”¨ç¨‹åºå‡†å¤‡å¥½ç¯å¢ƒå’Œç›¸å…³çš„ä¾èµ–åï¼Œæ¥ä¸‹æ¥å¼€å§‹ç¼–å†™ Flink ç¨‹åºã€‚ ESSinkUtil å·¥å…·ç±»ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼Œè¿™ä¸ªå·¥å…·ç±»æ˜¯ç¬”è€…å°è£…çš„ï¼ŒgetEsAddresses æ–¹æ³•å°†ä¼ å…¥çš„é…ç½®æ–‡ä»¶ es åœ°å€è§£æå‡ºæ¥ï¼Œå¯ä»¥æ˜¯åŸŸåæ–¹å¼ï¼Œä¹Ÿå¯ä»¥æ˜¯ ip + port å½¢å¼ã€‚addSink æ–¹æ³•æ˜¯åˆ©ç”¨äº† Flink è‡ªå¸¦çš„ ElasticsearchSink æ¥å°è£…äº†ä¸€å±‚ï¼Œä¼ å…¥äº†ä¸€äº›å¿…è¦çš„è°ƒä¼˜å‚æ•°å’Œ es é…ç½®å‚æ•°ï¼Œä¸‹é¢ç« èŠ‚è¿˜ä¼šå†è®²å…¶ä»–çš„é…ç½®ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344public class ESSinkUtil &#123; /** * es sink * * @param hosts es hosts * @param bulkFlushMaxActions bulk flush size * @param parallelism å¹¶è¡Œæ•° * @param data æ•°æ® * @param func * @param &lt;T&gt; */ public static &lt;T&gt; void addSink(List&lt;HttpHost&gt; hosts, int bulkFlushMaxActions, int parallelism, SingleOutputStreamOperator&lt;T&gt; data, ElasticsearchSinkFunction&lt;T&gt; func) &#123; ElasticsearchSink.Builder&lt;T&gt; esSinkBuilder = new ElasticsearchSink.Builder&lt;&gt;(hosts, func); esSinkBuilder.setBulkFlushMaxActions(bulkFlushMaxActions); data.addSink(esSinkBuilder.build()).setParallelism(parallelism); &#125; /** * è§£æé…ç½®æ–‡ä»¶çš„ es hosts * * @param hosts * @return * @throws MalformedURLException */ public static List&lt;HttpHost&gt; getEsAddresses(String hosts) throws MalformedURLException &#123; String[] hostList = hosts.split(\",\"); List&lt;HttpHost&gt; addresses = new ArrayList&lt;&gt;(); for (String host : hostList) &#123; if (host.startsWith(\"http\")) &#123; URL url = new URL(host); addresses.add(new HttpHost(url.getHost(), url.getPort())); &#125; else &#123; String[] parts = host.split(\":\", 2); if (parts.length &gt; 1) &#123; addresses.add(new HttpHost(parts[0], Integer.parseInt(parts[1]))); &#125; else &#123; throw new MalformedURLException(\"invalid elasticsearch hosts format\"); &#125; &#125; &#125; return addresses; &#125;&#125; Flink ç¨‹åºä¼šè¯»å–åˆ° ElasticSearch çš„é…ç½®ï¼Œç„¶åå°†ä» Kafka è¯»å–åˆ°çš„æ•°æ®å†™å…¥è¿› ElasticSearchï¼Œå…·ä½“çš„å†™å…¥ä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚ 123456789101112131415161718192021222324252627public class Sink2ES6Main &#123; public static void main(String[] args) throws Exception &#123; //è·å–æ‰€æœ‰å‚æ•° final ParameterTool parameterTool = ExecutionEnvUtil.createParameterTool(args); //å‡†å¤‡å¥½ç¯å¢ƒ StreamExecutionEnvironment env = ExecutionEnvUtil.prepare(parameterTool); //ä»kafkaè¯»å–æ•°æ® DataStreamSource&lt;Metrics&gt; data = KafkaConfigUtil.buildSource(env); //ä»é…ç½®æ–‡ä»¶ä¸­è¯»å– es çš„åœ°å€ List&lt;HttpHost&gt; esAddresses = ESSinkUtil.getEsAddresses(parameterTool.get(ELASTICSEARCH_HOSTS)); //ä»é…ç½®æ–‡ä»¶ä¸­è¯»å– bulk flush sizeï¼Œä»£è¡¨ä¸€æ¬¡æ‰¹å¤„ç†çš„æ•°é‡ï¼Œè¿™ä¸ªå¯æ˜¯æ€§èƒ½è°ƒä¼˜å‚æ•°ï¼Œç‰¹åˆ«æé†’ int bulkSize = parameterTool.getInt(ELASTICSEARCH_BULK_FLUSH_MAX_ACTIONS, 40); //ä»é…ç½®æ–‡ä»¶ä¸­è¯»å–å¹¶è¡Œ sink æ•°ï¼Œè¿™ä¸ªä¹Ÿæ˜¯æ€§èƒ½è°ƒä¼˜å‚æ•°ï¼Œç‰¹åˆ«æé†’ï¼Œè¿™æ ·æ‰èƒ½å¤Ÿæ›´å¿«çš„æ¶ˆè´¹ï¼Œé˜²æ­¢ kafka æ•°æ®å †ç§¯ int sinkParallelism = parameterTool.getInt(STREAM_SINK_PARALLELISM, 5); //è‡ªå·±å†è‡ªå¸¦çš„ es sink ä¸Šä¸€å±‚å°è£…äº†ä¸‹ ESSinkUtil.addSink(esAddresses, bulkSize, sinkParallelism, data, (Metrics metric, RuntimeContext runtimeContext, RequestIndexer requestIndexer) -&gt; &#123; requestIndexer.add(Requests.indexRequest() .index(ZHISHENG + \"_\" + metric.getName()) //es ç´¢å¼•å .type(ZHISHENG) //es type .source(GsonUtil.toJSONBytes(metric), XContentType.JSON)); &#125;); env.execute(\"flink learning connectors es6\"); &#125;&#125; é…ç½®æ–‡ä»¶ä¸­åŒ…å«äº† Kafka å’Œ ElasticSearch çš„é…ç½®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œåœ°å€éƒ½æ”¯æŒé›†ç¾¤æ¨¡å¼å¡«å†™ï¼Œæ³¨æ„ç”¨ , åˆ†éš”ã€‚ 12345678910kafka.brokers=localhost:9092kafka.group.id=zhisheng-metrics-group-testkafka.zookeeper.connect=localhost:2181metrics.topic=zhisheng-metricsstream.parallelism=5stream.checkpoint.interval=1000stream.checkpoint.enable=falseelasticsearch.hosts=localhost:9200elasticsearch.bulk.flush.max.actions=40stream.sink.parallelism=5 3.9.3 éªŒè¯æ•°æ®æ˜¯å¦å†™å…¥ ElasticSearchï¼Ÿ3.9.4 å¦‚ä½•ä¿è¯åœ¨æµ·é‡æ•°æ®å®æ—¶å†™å…¥ä¸‹ ElasticSearch çš„ç¨³å®šæ€§ï¼Ÿ3.9.5 ä½¿ç”¨ Flink-connector-elasticsearch å¯èƒ½ä¼šé‡åˆ°çš„é—®é¢˜3.9.6 å°ç»“ä¸åæ€åŠ å…¥çŸ¥è¯†æ˜Ÿçƒå¯ä»¥çœ‹åˆ°ä¸Šé¢æ–‡ç« ï¼šhttps://t.zsxq.com/Jeqzfem","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹â€”â€” è‡ªå®šä¹‰ Flink Connector","date":"2021-07-18T16:00:00.000Z","path":"2021/07/19/flink-in-action-3.8/","text":"3.8 è‡ªå®šä¹‰ Flink Connectoråœ¨å‰é¢æ–‡ç«  3.6 èŠ‚ä¸­è®²è§£äº† Flink ä¸­çš„ Data Source å’Œ Data Sinkï¼Œç„¶åä»‹ç»äº† Flink ä¸­è‡ªå¸¦çš„ä¸€äº› Source å’Œ Sink çš„ Connectorï¼Œæ¥ç€æˆ‘ä»¬è¿˜æœ‰å‡ ç¯‡å®æˆ˜ä¼šè®²è§£äº†å¦‚ä½•ä» Kafka å¤„ç†æ•°æ®å†™å…¥åˆ° Kafkaã€ElasticSearch ç­‰ï¼Œå½“ç„¶ Flink è¿˜æœ‰ä¸€äº›å…¶ä»–çš„ Connectorï¼Œæˆ‘ä»¬è¿™é‡Œå°±ä¸ä¸€ä¸€ä»‹ç»äº†ï¼Œå¤§å®¶å¦‚æœæ„Ÿå…´è¶£çš„è¯å¯ä»¥å»å®˜ç½‘æŸ¥çœ‹ä¸€ä¸‹ï¼Œå¦‚æœå¯¹å…¶ä»£ç å®ç°æ¯”è¾ƒæ„Ÿå…´è¶£çš„è¯ï¼Œä¹Ÿå¯ä»¥å»çœ‹çœ‹å…¶æºç çš„å®ç°ã€‚æˆ‘ä»¬è¿™ç¯‡æ–‡ç« æ¥è®²è§£ä¸€ä¸‹å¦‚ä½•è‡ªå®šä¹‰ Source å’Œ Sink Connectorï¼Ÿè¿™æ ·æˆ‘ä»¬åé¢å†é‡åˆ°ä»€ä¹ˆæ ·çš„éœ€æ±‚éƒ½éš¾ä¸å€’æˆ‘ä»¬äº†ã€‚ 3.8.1 å¦‚ä½•è‡ªå®šä¹‰ Source Connectorï¼Ÿè¿™é‡Œå°±æ¼”ç¤ºä¸€ä¸‹å¦‚ä½•è‡ªå®šä¹‰ Source ä» MySQL ä¸­è¯»å–æ•°æ®ã€‚ æ·»åŠ ä¾èµ– åœ¨ pom.xml ä¸­æ·»åŠ  MySQL ä¾èµ–ï¼š 12345&lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;5.1.34&lt;/version&gt;&lt;/dependency&gt; æ•°æ®åº“å»ºè¡¨ æ•°æ®åº“å»ºè¡¨çš„ SQL è¯­å¥å¦‚ä¸‹ï¼š 12345678DROP TABLE IF EXISTS `student`;CREATE TABLE `student` ( `id` int(11) unsigned NOT NULL AUTO_INCREMENT, `name` varchar(25) COLLATE utf8_bin DEFAULT NULL, `password` varchar(25) COLLATE utf8_bin DEFAULT NULL, `age` int(10) DEFAULT NULL, PRIMARY KEY (`id`)) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8 COLLATE=utf8_bin; æ•°æ®åº“æ’å…¥æ•°æ® å¾€æ–°å»ºçš„æ•°æ®åº“è¡¨ä¸­æ’å…¥ 4 æ¡æ•°æ®çš„ SQL è¯­å¥å¦‚ä¸‹ï¼š 12INSERT INTO `student` VALUES ('1', 'zhisheng01', '123456', '18'), ('2', 'zhisheng02', '123', '17'), ('3', 'zhisheng03', '1234', '18'), ('4', 'zhisheng04', '12345', '16');COMMIT; æ–°å»ºå®ä½“ç±» å¯¹åº”æ•°æ®åº“å­—æ®µçš„å®ä½“ç±»å¦‚ä¸‹ï¼š 123456789@Data@AllArgsConstructor@NoArgsConstructorpublic class Student &#123; public int id; //id public String name; //å§“å public String password; //å¯†ç  public int age; //å¹´é¾„&#125; è‡ªå®šä¹‰ Source ç±» SourceFromMySQL æ˜¯è‡ªå®šä¹‰çš„ Source ç±»ï¼Œè¯¥ç±»ç»§æ‰¿ RichSourceFunction ï¼Œå®ç°é‡Œé¢çš„ openã€closeã€runã€cancel æ–¹æ³•ï¼Œå®ƒçš„ä½œç”¨æ˜¯è¯»å– MySQL ä¸­çš„æ•°æ®ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768public class SourceFromMySQL extends RichSourceFunction&lt;Student&gt; &#123; PreparedStatement ps; private Connection connection; /** * open() æ–¹æ³•ä¸­å»ºç«‹è¿æ¥ï¼Œè¿™æ ·ä¸ç”¨æ¯æ¬¡ invoke çš„æ—¶å€™éƒ½è¦å»ºç«‹è¿æ¥å’Œé‡Šæ”¾è¿æ¥ã€‚ * * @param parameters * @throws Exception */ @Override public void open(Configuration parameters) throws Exception &#123; super.open(parameters); connection = getConnection(); String sql = \"select * from Student;\"; ps = this.connection.prepareStatement(sql); &#125; /** * ç¨‹åºæ‰§è¡Œå®Œæ¯•å°±å¯ä»¥è¿›è¡Œï¼Œå…³é—­è¿æ¥å’Œé‡Šæ”¾èµ„æºçš„åŠ¨ä½œäº† * * @throws Exception */ @Override public void close() throws Exception &#123; super.close(); if (connection != null) &#123; //å…³é—­è¿æ¥å’Œé‡Šæ”¾èµ„æº connection.close(); &#125; if (ps != null) &#123; ps.close(); &#125; &#125; /** * DataStream è°ƒç”¨ä¸€æ¬¡ run() æ–¹æ³•ç”¨æ¥è·å–æ•°æ® * * @param ctx * @throws Exception */ @Override public void run(SourceContext&lt;Student&gt; ctx) throws Exception &#123; ResultSet resultSet = ps.executeQuery(); while (resultSet.next()) &#123; Student student = new Student( resultSet.getInt(\"id\"), resultSet.getString(\"name\").trim(), resultSet.getString(\"password\").trim(), resultSet.getInt(\"age\")); ctx.collect(student); &#125; &#125; @Override public void cancel() &#123; &#125; private static Connection getConnection() &#123; Connection con = null; try &#123; Class.forName(\"com.mysql.jdbc.Driver\"); con = DriverManager.getConnection(\"jdbc:mysql://localhost:3306/test?useUnicode=true&amp;characterEncoding=UTF-8\", \"root\", \"123456\"); &#125; catch (Exception e) &#123; System.out.println(\"mysql get connection has exception , msg = \" + e.getMessage()); &#125; return con; &#125;&#125; Flink åº”ç”¨ç¨‹åºä»£ç  è¯»å– MySQL æ•°æ®çš„ä»£ç å®Œæˆåï¼Œæ¥ä¸‹æ¥ Flink ä¸»ç¨‹åºçš„ä»£ç å°±å¯ä»¥ç›´æ¥åœ¨ addSource() æ–¹æ³•ä¸­æ„é€ ä¸€ä¸ª SourceFromMySQL å¯¹è±¡ä½œä¸ºä¸€ä¸ªå‚æ•°ä¼ å…¥ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚ 123456789public class Main2 &#123; public static void main(String[] args) throws Exception &#123; final StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment(); env.addSource(new SourceFromMySQL()).print(); env.execute(\"Flink add data sourc\"); &#125;&#125; è¿è¡Œ Flink ç¨‹åºï¼Œæ§åˆ¶å°æ—¥å¿—ä¸­å¯ä»¥çœ‹è§æ‰“å°çš„ student ä¿¡æ¯ï¼Œç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ 3.8.2 RichSourceFunction çš„ç”¨æ³•åŠæºç åˆ†æä»ä¸Šé¢è‡ªå®šä¹‰çš„ Source å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ç»§æ‰¿çš„å°±æ˜¯è¿™ä¸ª RichSourceFunction ç±»ï¼Œå…¶å®ä¹Ÿæ˜¯å¯ä»¥ä½¿ç”¨ SourceFunction å‡½æ•°æ¥è‡ªå®šä¹‰ Sourceã€‚ RichSourceFunction å‡½æ•°æ¯” SourceFunction å¤šäº† open æ–¹æ³•ï¼ˆå¯ä»¥ç”¨æ¥åˆå§‹åŒ–ï¼‰å’Œè·å–åº”ç”¨ä¸Šä¸‹æ–‡çš„æ–¹æ³•ï¼Œé‚£ä¹ˆæ¥äº†è§£ä¸€ä¸‹è¯¥ç±»ï¼Œå®ƒçš„ç±»ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ å®ƒæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œç»§æ‰¿è‡ª AbstractRichFunctionï¼Œå®ç°äº† SourceFunction æ¥å£ï¼Œå…¶å­ç±»æœ‰ä¸‰ä¸ªï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä¸¤ä¸ªæ˜¯æŠ½è±¡ç±»ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šæä¾›äº†æ›´å…·ä½“çš„å®ç°ï¼Œå¦ä¸€ä¸ªæ˜¯ ContinuousFileMonitoringFunctionã€‚ è¿™ä¸‰ä¸ªå­ç±»çš„åŠŸèƒ½å¦‚ä¸‹ï¼š MessageAcknowledgingSourceBase ï¼šå®ƒé’ˆå¯¹çš„æ˜¯æ•°æ®æºæ˜¯æ¶ˆæ¯é˜Ÿåˆ—çš„åœºæ™¯å¹¶ä¸”æä¾›äº†åŸºäº ID çš„åº”ç­”æœºåˆ¶ã€‚ MultipleIdsMessageAcknowledgingSourceBase ï¼š åœ¨ MessageAcknowledgingSourceBase çš„åŸºç¡€ä¸Šé’ˆå¯¹ ID åº”ç­”æœºåˆ¶è¿›è¡Œäº†æ›´ä¸ºç»†åˆ†çš„å¤„ç†ï¼Œæ”¯æŒä¸¤ç§ ID åº”ç­”æ¨¡å‹ï¼šsession id å’Œ unique message idã€‚ ContinuousFileMonitoringFunctionï¼šè¿™æ˜¯å•ä¸ªï¼ˆéå¹¶è¡Œï¼‰ç›‘è§†ä»»åŠ¡ï¼Œå®ƒæ¥å— FileInputFormatï¼Œå¹¶ä¸”æ ¹æ® FileProcessingMode å’Œ FilePathFilterï¼Œå®ƒè´Ÿè´£ç›‘è§†ç”¨æˆ·æä¾›çš„è·¯å¾„ï¼›å†³å®šåº”è¯¥è¿›ä¸€æ­¥è¯»å–å’Œå¤„ç†å“ªäº›æ–‡ä»¶ï¼›åˆ›å»ºä¸è¿™äº›æ–‡ä»¶å¯¹åº”çš„ FileInputSplit æ‹†åˆ†ï¼Œå°†å®ƒä»¬åˆ†é…ç»™ä¸‹æ¸¸ä»»åŠ¡ä»¥è¿›è¡Œè¿›ä¸€æ­¥å¤„ç†ã€‚ é™¤äº†ä¸Šé¢ä½¿ç”¨ RichSourceFunction å’Œ SourceFunction æ¥è‡ªå®šä¹‰ Sourceï¼Œè¿˜å¯ä»¥ç»§æ‰¿ RichParallelSourceFunction æŠ½è±¡ç±»æˆ–å®ç° ParallelSourceFunction æ¥å£æ¥å®ç°è‡ªå®šä¹‰ Source å‡½æ•°ã€‚ 3.8.3 è‡ªå®šä¹‰ Sink Connectorä¸‹é¢å°†å†™ä¸€ä¸ª demo æ•™å¤§å®¶å°†ä» Kafka Source çš„æ•°æ® Sink åˆ° MySQL ä¸­å» å·¥å…·ç±»å†™äº†ä¸€ä¸ªå·¥å…·ç±»å¾€ Kafka çš„ topic ä¸­å‘é€æ•°æ®ã€‚ 123456789101112131415161718192021222324252627/** * å¾€kafkaä¸­å†™æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªmainå‡½æ•°è¿›è¡Œæµ‹è¯•ä¸€ä¸‹ */public class KafkaUtils2 &#123; public static final String broker_list = \"localhost:9092\"; public static final String topic = \"student\"; //kafka topic éœ€è¦å’Œ flink ç¨‹åºç”¨åŒä¸€ä¸ª topic public static void writeToKafka() throws InterruptedException &#123; Properties props = new Properties(); props.put(\"bootstrap.servers\", broker_list); props.put(\"key.serializer\", \"org.apache.kafka.common.serialization.StringSerializer\"); props.put(\"value.serializer\", \"org.apache.kafka.common.serialization.StringSerializer\"); KafkaProducer producer = new KafkaProducer&lt;String, String&gt;(props); for (int i = 1; i &lt;= 100; i++) &#123; Student student = new Student(i, \"zhisheng\" + i, \"password\" + i, 18 + i); ProducerRecord record = new ProducerRecord&lt;String, String&gt;(topic, null, null, JSON.toJSONString(student)); producer.send(record); System.out.println(\"å‘é€æ•°æ®: \" + JSON.toJSONString(student)); &#125; producer.flush(); &#125; public static void main(String[] args) throws InterruptedException &#123; writeToKafka(); &#125;&#125; SinkToMySQLè¯¥ç±»å°±æ˜¯ Sink Functionï¼Œç»§æ‰¿äº† RichSinkFunction ï¼Œç„¶åé‡å†™äº†é‡Œé¢çš„æ–¹æ³•ï¼Œåœ¨ invoke æ–¹æ³•ä¸­å°†æ•°æ®æ’å…¥åˆ° MySQL ä¸­ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758public class SinkToMySQL extends RichSinkFunction&lt;Student&gt; &#123; PreparedStatement ps; private Connection connection; /** * open() æ–¹æ³•ä¸­å»ºç«‹è¿æ¥ï¼Œè¿™æ ·ä¸ç”¨æ¯æ¬¡ invoke çš„æ—¶å€™éƒ½è¦å»ºç«‹è¿æ¥å’Œé‡Šæ”¾è¿æ¥ * * @param parameters * @throws Exception */ @Override public void open(Configuration parameters) throws Exception &#123; super.open(parameters); connection = getConnection(); String sql = \"insert into Student(id, name, password, age) values(?, ?, ?, ?);\"; ps = this.connection.prepareStatement(sql); &#125; @Override public void close() throws Exception &#123; super.close(); //å…³é—­è¿æ¥å’Œé‡Šæ”¾èµ„æº if (connection != null) &#123; connection.close(); &#125; if (ps != null) &#123; ps.close(); &#125; &#125; /** * æ¯æ¡æ•°æ®çš„æ’å…¥éƒ½è¦è°ƒç”¨ä¸€æ¬¡ invoke() æ–¹æ³• * * @param value * @param context * @throws Exception */ @Override public void invoke(Student value, Context context) throws Exception &#123; //ç»„è£…æ•°æ®ï¼Œæ‰§è¡Œæ’å…¥æ“ä½œ ps.setInt(1, value.getId()); ps.setString(2, value.getName()); ps.setString(3, value.getPassword()); ps.setInt(4, value.getAge()); ps.executeUpdate(); &#125; private static Connection getConnection() &#123; Connection con = null; try &#123; Class.forName(\"com.mysql.jdbc.Driver\"); con = DriverManager.getConnection(\"jdbc:mysql://localhost:3306/test?useUnicode=true&amp;characterEncoding=UTF-8\", \"root\", \"root123456\"); &#125; catch (Exception e) &#123; System.out.println(\"-----------mysql get connection has exception , msg = \"+ e.getMessage()); &#125; return con; &#125;&#125; Flink ç¨‹åºè¿™é‡Œçš„ source æ˜¯ä» Kafka è¯»å–æ•°æ®çš„ï¼Œç„¶å Flink ä» Kafka è¯»å–åˆ°æ•°æ®ï¼ˆJSONï¼‰åç”¨é˜¿é‡Œ fastjson æ¥è§£ææˆ Student å¯¹è±¡ï¼Œç„¶ååœ¨ addSink ä¸­ä½¿ç”¨æˆ‘ä»¬åˆ›å»ºçš„ SinkToMySQLï¼Œè¿™æ ·å°±å¯ä»¥æŠŠæ•°æ®å­˜å‚¨åˆ° MySQL äº†ã€‚ 1234567891011121314151617181920212223public class Main3 &#123; public static void main(String[] args) throws Exception &#123; final StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment(); Properties props = new Properties(); props.put(\"bootstrap.servers\", \"localhost:9092\"); props.put(\"zookeeper.connect\", \"localhost:2181\"); props.put(\"group.id\", \"metric-group\"); props.put(\"key.deserializer\", \"org.apache.kafka.common.serialization.StringDeserializer\"); props.put(\"value.deserializer\", \"org.apache.kafka.common.serialization.StringDeserializer\"); props.put(\"auto.offset.reset\", \"latest\"); SingleOutputStreamOperator&lt;Student&gt; student = env.addSource(new FlinkKafkaConsumer011&lt;&gt;( \"student\", //è¿™ä¸ª kafka topic éœ€è¦å’Œä¸Šé¢çš„å·¥å…·ç±»çš„ topic ä¸€è‡´ new SimpleStringSchema(), props)).setParallelism(1) .map(string -&gt; JSON.parseObject(string, Student.class)); //Fastjson è§£æå­—ç¬¦ä¸²æˆ student å¯¹è±¡ student.addSink(new SinkToMySQL()); //æ•°æ® sink åˆ° mysql env.execute(\"Flink add sink\"); &#125;&#125; ç»“æœ3.8.4 RichSinkFunction çš„ç”¨æ³•åŠæºç åˆ†æ3.8.5 å°ç»“ä¸åæ€åŠ å…¥çŸ¥è¯†æ˜Ÿçƒå¯ä»¥çœ‹åˆ°ä¸Šé¢æ–‡ç« ï¼šhttps://t.zsxq.com/Y3RBaaQ æ‰¹é‡å†™ MySQL å¯ä»¥å‚è€ƒ ï¼šhttps://t.zsxq.com/FAmYFYJ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹â€”â€” Flink Connector â€”â€” Kafka çš„ä½¿ç”¨å’Œæºç åˆ†æ","date":"2021-07-16T16:00:00.000Z","path":"2021/07/17/flink-in-action-3.7/","text":"3.7 Flink Connector â€”â€” Kafka çš„ä½¿ç”¨å’Œæºç åˆ†æåœ¨å‰é¢ 3.6 èŠ‚ä¸­ä»‹ç»äº† Flink ä¸­çš„ Data Source å’Œ Data Sinkï¼Œç„¶åè¿˜è®²è¯‰äº†è‡ªå¸¦çš„ä¸€äº› Source å’Œ Sink çš„ Connectorã€‚æœ¬ç¯‡æ–‡ç« å°†è®²è§£ä¸€ä¸‹ç”¨çš„æœ€å¤šçš„ Connector â€”â€” Kafkaï¼Œå¸¦å¤§å®¶åˆ©ç”¨ Kafka Connector è¯»å– Kafka æ•°æ®ï¼Œåšä¸€äº›è®¡ç®—æ“ä½œåç„¶ååˆé€šè¿‡ Kafka Connector å†™å…¥åˆ° kafka æ¶ˆæ¯é˜Ÿåˆ—å»ï¼Œæ•´ä¸ªæ¡ˆä¾‹çš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ 3.7.1 å‡†å¤‡ç¯å¢ƒå’Œä¾èµ–æ¥ä¸‹æ¥å‡†å¤‡ Kafka ç¯å¢ƒçš„å®‰è£…å’Œæ·»åŠ ç›¸å…³çš„ä¾èµ–ã€‚ ç¯å¢ƒå®‰è£…å’Œå¯åŠ¨å¦‚æœä½ å·²ç»å®‰è£…å¥½äº† Flink å’Œ Kafkaï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥ä½¿ç”¨å‘½ä»¤è¿è¡Œå¯åŠ¨ Flinkã€Zookepeerã€Kafka å°±è¡Œäº†ã€‚ å¯åŠ¨ Flink çš„å‘½ä»¤å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å¯åŠ¨ Kafka çš„å‘½ä»¤å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æ‰§è¡Œå‘½ä»¤éƒ½å¯åŠ¨å¥½äº†åå°±å¯ä»¥æ·»åŠ ä¾èµ–äº†ã€‚ æ·»åŠ  Maven ä¾èµ–Flink é‡Œé¢æ”¯æŒ Kafka 0.8.x ä»¥ä¸Šçš„ç‰ˆæœ¬ï¼Œå…·ä½“é‡‡ç”¨å“ªä¸ªç‰ˆæœ¬çš„ Maven ä¾èµ–éœ€è¦æ ¹æ®å®‰è£…çš„ Kafka ç‰ˆæœ¬æ¥ç¡®å®šã€‚å› ä¸ºä¹‹å‰æˆ‘ä»¬å®‰è£…çš„ Kafka æ˜¯ 1.1.0 ç‰ˆæœ¬ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬é€‰æ‹©çš„ Kafka Connector ä¸º flink-connector-kafka-0.11_2.11 ï¼ˆæ”¯æŒ Kafka 0.11.x ç‰ˆæœ¬åŠä»¥ä¸Šï¼Œè¯¥ Connector æ”¯æŒ Kafka äº‹åŠ¡æ¶ˆæ¯ä¼ é€’ï¼Œæ‰€ä»¥èƒ½ä¿è¯ Exactly Onceï¼‰ã€‚Flink Kafka Connector æ”¯æŒçš„ç‰ˆæœ¬å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æ·»åŠ å¦‚ä¸‹ä¾èµ–ï¼š 12345&lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-connector-kafka-0.11_2.11&lt;/artifactId&gt; &lt;version&gt;$&#123;flink.version&#125;&lt;/version&gt;&lt;/dependency&gt; Flinkã€Kafkaã€Flink Kafka Connector ä¸‰è€…å¯¹åº”çš„ç‰ˆæœ¬å¯ä»¥æ ¹æ® å®˜ç½‘ çš„å¯¹æ¯”æ¥é€‰æ‹©ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ flink-connector-kafka_2.11 è¿™ä¸ªç‰ˆæœ¬æ”¯æŒçš„ Kafka ç‰ˆæœ¬è¦å¤§äº 1.0.0ï¼Œä» Flink 1.9 ç‰ˆæœ¬å¼€å§‹ï¼Œå®ƒä½¿ç”¨çš„æ˜¯ Kafka 2.2.0 ç‰ˆæœ¬çš„å®¢æˆ·ç«¯ï¼Œè™½ç„¶è¿™äº›å®¢æˆ·ç«¯ä¼šåšå‘åå…¼å®¹ï¼Œä½†æ˜¯å»ºè®®è¿˜æ˜¯æŒ‰ç…§å®˜ç½‘çº¦å®šçš„æ¥è§„èŒƒä½¿ç”¨ Connector ç‰ˆæœ¬ã€‚å¦å¤–ä½ è¿˜è¦æ·»åŠ çš„ä¾èµ–æœ‰ï¼š 12345678910111213141516171819202122232425262728293031323334&lt;!--flink java--&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-java&lt;/artifactId&gt; &lt;version&gt;$&#123;flink.version&#125;&lt;/version&gt; &lt;scope&gt;provided&lt;/scope&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-streaming-java_$&#123;scala.binary.version&#125;&lt;/artifactId&gt; &lt;version&gt;$&#123;flink.version&#125;&lt;/version&gt; &lt;scope&gt;provided&lt;/scope&gt;&lt;/dependency&gt;&lt;!--log--&gt;&lt;dependency&gt; &lt;groupId&gt;org.slf4j&lt;/groupId&gt; &lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt; &lt;version&gt;1.7.7&lt;/version&gt; &lt;scope&gt;runtime&lt;/scope&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;log4j&lt;/groupId&gt; &lt;artifactId&gt;log4j&lt;/artifactId&gt; &lt;version&gt;1.2.17&lt;/version&gt; &lt;scope&gt;runtime&lt;/scope&gt;&lt;/dependency&gt;&lt;!--alibaba fastjson--&gt;&lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;fastjson&lt;/artifactId&gt; &lt;version&gt;1.2.51&lt;/version&gt;&lt;/dependency&gt; 3.7.2 å°†æµ‹è¯•æ•°æ®å‘é€åˆ° Kafka Topicæˆ‘ä»¬æ¨¡æ‹Ÿä¸€äº›æµ‹è¯•æ•°æ®ï¼Œç„¶åå°†è¿™äº›æµ‹è¯•æ•°æ®å‘åˆ° Kafka Topic ä¸­å»ï¼Œæ•°æ®çš„ç»“æ„å¦‚ä¸‹ï¼š 123456789@Data@AllArgsConstructor@NoArgsConstructorpublic class Metric &#123; public String name; //æŒ‡æ ‡å public long timestamp; //æ—¶é—´æˆ³ public Map&lt;String, Object&gt; fields; //æŒ‡æ ‡å«æœ‰çš„å±æ€§ public Map&lt;String, String&gt; tags; //æŒ‡æ ‡çš„æ ‡è¯†&#125; å¾€ kafka ä¸­å†™æ•°æ®å·¥å…·ç±» KafkaUtils.javaï¼Œä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445/** * å¾€kafkaä¸­å†™æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªmainå‡½æ•°è¿›è¡Œæµ‹è¯•ä¸€ä¸‹ */public class KafkaUtils &#123; public static final String broker_list = \"localhost:9092\"; public static final String topic = \"metric\"; // kafka topicï¼ŒFlink ç¨‹åºä¸­éœ€è¦å’Œè¿™ä¸ªç»Ÿä¸€ public static void writeToKafka() throws InterruptedException &#123; Properties props = new Properties(); props.put(\"bootstrap.servers\", broker_list); props.put(\"key.serializer\", \"org.apache.kafka.common.serialization.StringSerializer\"); //key åºåˆ—åŒ– props.put(\"value.serializer\", \"org.apache.kafka.common.serialization.StringSerializer\"); //value åºåˆ—åŒ– KafkaProducer producer = new KafkaProducer&lt;String, String&gt;(props); Metric metric = new Metric(); metric.setTimestamp(System.currentTimeMillis()); metric.setName(\"mem\"); Map&lt;String, String&gt; tags = new HashMap&lt;&gt;(); Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;(); tags.put(\"cluster\", \"zhisheng\"); tags.put(\"host_ip\", \"101.147.022.106\"); fields.put(\"used_percent\", 90d); fields.put(\"max\", 27244873d); fields.put(\"used\", 17244873d); fields.put(\"init\", 27244873d); metric.setTags(tags); metric.setFields(fields); ProducerRecord record = new ProducerRecord&lt;String, String&gt;(topic, null, null, JSON.toJSONString(metric)); producer.send(record); System.out.println(\"å‘é€æ•°æ®: \" + JSON.toJSONString(metric)); producer.flush(); &#125; public static void main(String[] args) throws InterruptedException &#123; while (true) &#123; Thread.sleep(300); writeToKafka(); &#125; &#125;&#125; è¿è¡Œç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å¦‚æœå‡ºç°å¦‚ä¸Šå›¾æ ‡è®°çš„ï¼Œå³ä»£è¡¨èƒ½å¤Ÿä¸æ–­å¾€ kafka å‘é€æ•°æ®çš„ã€‚ 3.7.3 Flink å¦‚ä½•æ¶ˆè´¹ Kafka æ•°æ®ï¼ŸFlink æ¶ˆè´¹ Kafka æ•°æ®çš„åº”ç”¨ç¨‹åºå¦‚ä¸‹ï¼š 12345678910111213141516171819202122public class Main &#123; public static void main(String[] args) throws Exception &#123; final StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment(); Properties props = new Properties(); props.put(\"bootstrap.servers\", \"localhost:9092\"); props.put(\"zookeeper.connect\", \"localhost:2181\"); props.put(\"group.id\", \"metric-group\"); props.put(\"key.deserializer\", \"org.apache.kafka.common.serialization.StringDeserializer\"); //key ååºåˆ—åŒ– props.put(\"value.deserializer\", \"org.apache.kafka.common.serialization.StringDeserializer\"); props.put(\"auto.offset.reset\", \"latest\"); //value ååºåˆ—åŒ– DataStreamSource&lt;String&gt; dataStreamSource = env.addSource(new FlinkKafkaConsumer011&lt;&gt;( \"metric\", //kafka topic new SimpleStringSchema(), // String åºåˆ—åŒ– props)).setParallelism(1); dataStreamSource.print(); //æŠŠä» kafka è¯»å–åˆ°çš„æ•°æ®æ‰“å°åœ¨æ§åˆ¶å° env.execute(\"Flink add data source\"); &#125;&#125; è¿è¡Œç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼ˆç¨‹åºå¯ä»¥ä¸æ–­çš„æ¶ˆè´¹åˆ° Kafka Topic ä¸­çš„æ•°æ®ï¼‰ï¼š ä»£ç åˆ†æ ä½¿ç”¨ FlinkKafkaConsumer011 æ—¶ä¼ å…¥äº†ä¸‰ä¸ªå‚æ•°ï¼š Kafka topicï¼šè¿™ä¸ªä»£è¡¨äº† Flink è¦æ¶ˆè´¹çš„æ˜¯ Kafka å“ªä¸ª Topicï¼Œå¦‚æœä½ è¦åŒæ—¶æ¶ˆè´¹å¤šä¸ª Topic çš„è¯ï¼Œé‚£ä¹ˆä½ å¯ä»¥ä¼ å…¥ä¸€ä¸ª Topic List è¿›å»ï¼Œå¦å¤–ä¹Ÿæ”¯æŒæ­£åˆ™è¡¨è¾¾å¼åŒ¹é… Topicï¼Œæºç å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ åºåˆ—åŒ–ï¼šä¸Šé¢ä»£ç æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ SimpleStringSchemaã€‚ é…ç½®å±æ€§ï¼šå°† Kafka ç­‰çš„ä¸€äº›é…ç½®ä¼ å…¥ ã€‚ å‰é¢æ¼”ç¤ºäº† Flink å¦‚ä½•æ¶ˆè´¹ Kafak æ•°æ®ï¼Œæ¥ä¸‹æ¥æ¼”ç¤ºå¦‚ä½•æŠŠå…¶ä»– Kafka é›†ç¾¤ä¸­ topic æ•°æ®åŸæ ·å†™å…¥åˆ°è‡ªå·±æœ¬åœ°èµ·çš„ Kafka ä¸­å»ã€‚ 3.7.4 Flink å¦‚ä½•å°†è®¡ç®—åçš„æ•°æ®å‘é€åˆ° Kafkaï¼Ÿå°† Kafka é›†ç¾¤ä¸­ topic æ•°æ®å†™å…¥æœ¬åœ° Kafka çš„ç¨‹åºä¸­è¦å¡«å†™çš„é…ç½®æœ‰æ¶ˆè´¹çš„ Kafka é›†ç¾¤åœ°å€ã€group.idã€å°†æ•°æ®å†™å…¥ Kafka çš„é›†ç¾¤åœ°å€ã€topic ä¿¡æ¯ç­‰ï¼Œå°†æ‰€æœ‰çš„é…ç½®æå–åˆ°é…ç½®æ–‡ä»¶ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚ 1234567891011//å…¶ä»– Kafka é›†ç¾¤é…ç½®kafka.brokers=xxx:9092,xxx:9092,xxx:9092kafka.group.id=metrics-group-testkafka.zookeeper.connect=xxx:2181metrics.topic=xxxstream.parallelism=5kafka.sink.brokers=localhost:9092kafka.sink.topic=metric-teststream.checkpoint.interval=1000stream.checkpoint.enable=falsestream.sink.parallelism=5 ç›®å‰æˆ‘ä»¬å…ˆçœ‹ä¸‹æœ¬åœ° Kafka æ˜¯å¦æœ‰è¿™ä¸ª metric-test topic å‘¢ï¼Ÿéœ€è¦æ‰§è¡Œä¸‹è¿™ä¸ªå‘½ä»¤ï¼š 1bin/kafka-topics.sh --list --zookeeper localhost:2181 æ‰§è¡Œä¸Šé¢å‘½ä»¤åçš„ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å¯ä»¥çœ‹åˆ°æœ¬åœ°çš„ Kafka æ˜¯æ²¡æœ‰ä»»ä½• topic çš„ï¼Œå¦‚æœç­‰ä¸‹ç¨‹åºè¿è¡Œèµ·æ¥åï¼Œå†æ¬¡æ‰§è¡Œè¿™ä¸ªå‘½ä»¤å‡ºç° metric-test topicï¼Œé‚£ä¹ˆè¯æ˜ç¨‹åºç¡®å®èµ·ä½œç”¨äº†ï¼Œå·²ç»å°†å…¶ä»–é›†ç¾¤çš„ Kafka æ•°æ®å†™å…¥åˆ°æœ¬åœ° Kafka äº†ã€‚ æ•´ä¸ª Flink ç¨‹åºçš„ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516public class Main &#123; public static void main(String[] args) throws Exception&#123; final ParameterTool parameterTool = ExecutionEnvUtil.createParameterTool(args); StreamExecutionEnvironment env = ExecutionEnvUtil.prepare(parameterTool); DataStreamSource&lt;Metrics&gt; data = KafkaConfigUtil.buildSource(env); data.addSink(new FlinkKafkaProducer011&lt;Metrics&gt;( parameterTool.get(\"kafka.sink.brokers\"), parameterTool.get(\"kafka.sink.topic\"), new MetricSchema() )).name(\"flink-connectors-kafka\") .setParallelism(parameterTool.getInt(\"stream.sink.parallelism\")); env.execute(\"flink learning connectors kafka\"); &#125;&#125; å¯åŠ¨ç¨‹åºï¼ŒæŸ¥çœ‹è¿è¡Œç»“æœï¼Œä¸æ–­æ‰§è¡ŒæŸ¥çœ‹ topic åˆ—è¡¨çš„å‘½ä»¤ï¼Œè§‚å¯Ÿæ˜¯å¦æœ‰æ–°çš„ topic å‡ºæ¥ï¼Œç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æ‰§è¡Œå‘½ä»¤å¯ä»¥æŸ¥çœ‹è¯¥ topic çš„ä¿¡æ¯ï¼š 1bin/kafka-topics.sh --describe --zookeeper localhost:2181 --topic metric-test è¯¥ topic ä¿¡æ¯å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å‰é¢ä»£ç ä½¿ç”¨çš„ FlinkKafkaProducer011 åªä¼ äº†ä¸‰ä¸ªå‚æ•°ï¼šbrokerListã€topicIdã€serializationSchemaï¼ˆåºåˆ—åŒ–ï¼‰ï¼Œå…¶å®æ˜¯æ”¯æŒä¼ å…¥å¤šä¸ªå‚æ•°çš„ï¼ŒFlink ä¸­çš„æºç å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ 3.7.5 FlinkKafkaConsumer æºç åˆ†æ3.7.6 FlinkKafkaProducer æºç åˆ†æ3.7.7 ä½¿ç”¨ Flink-connector-kafka å¯èƒ½ä¼šé‡åˆ°çš„é—®é¢˜å¦‚ä½•æ¶ˆè´¹å¤šä¸ª Kafka Topicæƒ³è¦è·å–æ•°æ®çš„å…ƒæ•°æ®ä¿¡æ¯å¤šç§æ•°æ®ç±»å‹åºåˆ—åŒ–å¤±è´¥Kafka æ¶ˆè´¹ Offset çš„é€‰æ‹©å¦‚ä½•è‡ªåŠ¨å‘ç° Topic æ–°å¢çš„åˆ†åŒºå¹¶è¯»å–æ•°æ®ç¨‹åºæ¶ˆè´¹ Kafka çš„ offset æ˜¯å¦‚ä½•ç®¡ç†çš„3.7.8 å°ç»“ä¸åæ€åŠ å…¥çŸ¥è¯†æ˜Ÿçƒå¯ä»¥çœ‹åˆ°ä¸Šé¢æ–‡ç« ï¼šhttps://t.zsxq.com/2bmurFy","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹â€”â€” Flink å¸¸ç”¨çš„ Source Connector å’Œ Sink Connector ä»‹ç»","date":"2021-07-15T16:00:00.000Z","path":"2021/07/16/flink-in-action-3.6/","text":"3.6 Flink å¸¸ç”¨çš„ Source Connector å’Œ Sink Connector ä»‹ç»é€šè¿‡å‰é¢æˆ‘ä»¬å¯ä»¥çŸ¥é“ Flink Job çš„å¤§è‡´ç»“æ„å°±æ˜¯ Source â€”â€”&gt; Transformation â€”â€”&gt; Sinkã€‚ é‚£ä¹ˆè¿™ä¸ª Source æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿæˆ‘ä»¬ä¸‹é¢æ¥çœ‹çœ‹ã€‚ 3.6.1 Data Source ç®€ä»‹Data Source æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå°±å­—é¢æ„æ€å…¶å®å°±å¯ä»¥çŸ¥é“ï¼šæ•°æ®æ¥æºã€‚ Flink åšä¸ºä¸€æ¬¾æµå¼è®¡ç®—æ¡†æ¶ï¼Œå®ƒå¯ç”¨æ¥åšæ‰¹å¤„ç†ï¼Œå³å¤„ç†é™æ€çš„æ•°æ®é›†ã€å†å²çš„æ•°æ®é›†ï¼›ä¹Ÿå¯ä»¥ç”¨æ¥åšæµå¤„ç†ï¼Œå³å¤„ç†å®æ—¶çš„æ•°æ®æµï¼ˆåšè®¡ç®—æ“ä½œï¼‰ï¼Œç„¶åå°†å¤„ç†åçš„æ•°æ®å®æ—¶ä¸‹å‘ï¼Œåªè¦æ•°æ®æºæºä¸æ–­è¿‡æ¥ï¼ŒFlink å°±èƒ½å¤Ÿä¸€ç›´è®¡ç®—ä¸‹å»ã€‚ Flink ä¸­ä½ å¯ä»¥ä½¿ç”¨ StreamExecutionEnvironment.addSource(sourceFunction) æ¥ä¸ºä½ çš„ç¨‹åºæ·»åŠ æ•°æ®æ¥æºã€‚ Flink å·²ç»æä¾›äº†è‹¥å¹²å®ç°å¥½äº†çš„ source functionï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥é€šè¿‡å®ç° SourceFunction æ¥è‡ªå®šä¹‰éå¹¶è¡Œçš„ source æˆ–è€…å®ç° ParallelSourceFunction æ¥å£æˆ–è€…æ‰©å±• RichParallelSourceFunction æ¥è‡ªå®šä¹‰å¹¶è¡Œçš„ sourceã€‚ é‚£ä¹ˆå¸¸ç”¨çš„ Data Source æœ‰å“ªäº›å‘¢ï¼Ÿ 3.6.2 å¸¸ç”¨çš„ Data SourceStreamExecutionEnvironment ä¸­å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å›¾æ‰€ç¤ºçš„è¿™äº›å·²å®ç°çš„ Stream Sourceã€‚ æ€»çš„æ¥è¯´å¯ä»¥åˆ†ä¸ºé›†åˆã€æ–‡ä»¶ã€Socketã€è‡ªå®šä¹‰å››å¤§ç±»ã€‚ åŸºäºé›†åˆåŸºäºé›†åˆçš„æœ‰ä¸‹é¢äº”ç§æ–¹æ³•ï¼š 1ã€fromCollection(Collection) - ä» Java çš„ Java.util.Collection åˆ›å»ºæ•°æ®æµã€‚é›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ ç±»å‹å¿…é¡»ç›¸åŒã€‚ 2ã€fromCollection(Iterator, Class) - ä»ä¸€ä¸ªè¿­ä»£å™¨ä¸­åˆ›å»ºæ•°æ®æµã€‚Class æŒ‡å®šäº†è¯¥è¿­ä»£å™¨è¿”å›å…ƒç´ çš„ç±»å‹ã€‚ 3ã€fromElements(T â€¦) - ä»ç»™å®šçš„å¯¹è±¡åºåˆ—ä¸­åˆ›å»ºæ•°æ®æµã€‚æ‰€æœ‰å¯¹è±¡ç±»å‹å¿…é¡»ç›¸åŒã€‚ 12345678StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();DataStream&lt;Event&gt; input = env.fromElements( new Event(1, \"barfoo\", 1.0), new Event(2, \"start\", 2.0), new Event(3, \"foobar\", 3.0), ...); 4ã€fromParallelCollection(SplittableIterator, Class) - ä»ä¸€ä¸ªè¿­ä»£å™¨ä¸­åˆ›å»ºå¹¶è¡Œæ•°æ®æµã€‚Class æŒ‡å®šäº†è¯¥è¿­ä»£å™¨è¿”å›å…ƒç´ çš„ç±»å‹ã€‚ 5ã€generateSequence(from, to) - åˆ›å»ºä¸€ä¸ªç”ŸæˆæŒ‡å®šåŒºé—´èŒƒå›´å†…çš„æ•°å­—åºåˆ—çš„å¹¶è¡Œæ•°æ®æµã€‚ åŸºäºæ–‡ä»¶åŸºäºæ–‡ä»¶çš„æœ‰ä¸‹é¢ä¸‰ç§æ–¹æ³•ï¼š 1ã€readTextFile(path) - è¯»å–æ–‡æœ¬æ–‡ä»¶ï¼Œå³ç¬¦åˆ TextInputFormat è§„èŒƒçš„æ–‡ä»¶ï¼Œå¹¶å°†å…¶ä½œä¸ºå­—ç¬¦ä¸²è¿”å›ã€‚ 123final StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();DataStream&lt;String&gt; text = env.readTextFile(\"file:///path/to/file\"); 2ã€readFile(fileInputFormat, path) - æ ¹æ®æŒ‡å®šçš„æ–‡ä»¶è¾“å…¥æ ¼å¼è¯»å–æ–‡ä»¶ï¼ˆä¸€æ¬¡ï¼‰ã€‚ 3ã€readFile(fileInputFormat, path, watchType, interval, pathFilter, typeInfo) - è¿™æ˜¯ä¸Šé¢ä¸¤ä¸ªæ–¹æ³•å†…éƒ¨è°ƒç”¨çš„æ–¹æ³•ã€‚å®ƒæ ¹æ®ç»™å®šçš„ fileInputFormat å’Œè¯»å–è·¯å¾„è¯»å–æ–‡ä»¶ã€‚æ ¹æ®æä¾›çš„ watchTypeï¼Œè¿™ä¸ª source å¯ä»¥å®šæœŸï¼ˆæ¯éš” interval æ¯«ç§’ï¼‰ç›‘æµ‹ç»™å®šè·¯å¾„çš„æ–°æ•°æ®ï¼ˆFileProcessingMode.PROCESS_CONTINUOUSLYï¼‰ï¼Œæˆ–è€…å¤„ç†ä¸€æ¬¡è·¯å¾„å¯¹åº”æ–‡ä»¶çš„æ•°æ®å¹¶é€€å‡ºï¼ˆFileProcessingMode.PROCESS_ONCEï¼‰ã€‚ä½ å¯ä»¥é€šè¿‡ pathFilter è¿›ä¸€æ­¥æ’é™¤æ‰éœ€è¦å¤„ç†çš„æ–‡ä»¶ã€‚ 12345final StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();DataStream&lt;MyEvent&gt; stream = env.readFile( myFormat, myFilePath, FileProcessingMode.PROCESS_CONTINUOUSLY, 100, FilePathFilter.createDefaultFilter(), typeInfo); å®ç°: åœ¨å…·ä½“å®ç°ä¸Šï¼ŒFlink æŠŠæ–‡ä»¶è¯»å–è¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªå­ä»»åŠ¡ï¼Œå³ç›®å½•ç›‘æ§å’Œæ•°æ®è¯»å–ã€‚æ¯ä¸ªå­ä»»åŠ¡éƒ½ç”±å•ç‹¬çš„å®ä½“å®ç°ã€‚ç›®å½•ç›‘æ§ç”±å•ä¸ªéå¹¶è¡Œï¼ˆå¹¶è¡Œåº¦ä¸º1ï¼‰çš„ä»»åŠ¡æ‰§è¡Œï¼Œè€Œæ•°æ®è¯»å–ç”±å¹¶è¡Œè¿è¡Œçš„å¤šä¸ªä»»åŠ¡æ‰§è¡Œã€‚åè€…çš„å¹¶è¡Œæ€§ç­‰äºä½œä¸šçš„å¹¶è¡Œæ€§ã€‚å•ä¸ªç›®å½•ç›‘æ§ä»»åŠ¡çš„ä½œç”¨æ˜¯æ‰«æç›®å½•ï¼ˆæ ¹æ® watchType å®šæœŸæ‰«ææˆ–ä»…æ‰«æä¸€æ¬¡ï¼‰ï¼ŒæŸ¥æ‰¾è¦å¤„ç†çš„æ–‡ä»¶å¹¶æŠŠæ–‡ä»¶åˆ†å‰²æˆåˆ‡åˆ†ç‰‡ï¼ˆsplitsï¼‰ï¼Œç„¶åå°†è¿™äº›åˆ‡åˆ†ç‰‡åˆ†é…ç»™ä¸‹æ¸¸ readerã€‚reader è´Ÿè´£è¯»å–æ•°æ®ã€‚æ¯ä¸ªåˆ‡åˆ†ç‰‡åªèƒ½ç”±ä¸€ä¸ª reader è¯»å–ï¼Œä½†ä¸€ä¸ª reader å¯ä»¥é€ä¸ªè¯»å–å¤šä¸ªåˆ‡åˆ†ç‰‡ã€‚ é‡è¦æ³¨æ„ï¼š å¦‚æœ watchType è®¾ç½®ä¸º FileProcessingMode.PROCESS_CONTINUOUSLYï¼Œåˆ™å½“æ–‡ä»¶è¢«ä¿®æ”¹æ—¶ï¼Œå…¶å†…å®¹å°†è¢«é‡æ–°å¤„ç†ã€‚è¿™ä¼šæ‰“ç ´â€œexactly-onceâ€è¯­ä¹‰ï¼Œå› ä¸ºåœ¨æ–‡ä»¶æœ«å°¾é™„åŠ æ•°æ®å°†å¯¼è‡´å…¶æ‰€æœ‰å†…å®¹è¢«é‡æ–°å¤„ç†ã€‚ å¦‚æœ watchType è®¾ç½®ä¸º FileProcessingMode.PROCESS_ONCEï¼Œåˆ™ source ä»…æ‰«æè·¯å¾„ä¸€æ¬¡ç„¶åé€€å‡ºï¼Œè€Œä¸ç­‰å¾… reader å®Œæˆæ–‡ä»¶å†…å®¹çš„è¯»å–ã€‚å½“ç„¶ reader ä¼šç»§ç»­é˜…è¯»ï¼Œç›´åˆ°è¯»å–æ‰€æœ‰çš„æ–‡ä»¶å†…å®¹ã€‚å…³é—­ source åå°±ä¸ä¼šå†æœ‰æ£€æŸ¥ç‚¹ã€‚è¿™å¯èƒ½å¯¼è‡´èŠ‚ç‚¹æ•…éšœåçš„æ¢å¤é€Ÿåº¦è¾ƒæ…¢ï¼Œå› ä¸ºè¯¥ä½œä¸šå°†ä»æœ€åä¸€ä¸ªæ£€æŸ¥ç‚¹æ¢å¤è¯»å–ã€‚ åŸºäº SocketsocketTextStream(String hostname, int port) - ä» socket è¯»å–ã€‚å…ƒç´ å¯ä»¥ç”¨åˆ†éš”ç¬¦åˆ‡åˆ†ã€‚ 12345678StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();DataStream&lt;Tuple2&lt;String, Integer&gt;&gt; dataStream = env .socketTextStream(\"localhost\", 9999) // ç›‘å¬ localhost çš„ 9999 ç«¯å£è¿‡æ¥çš„æ•°æ® .flatMap(new Splitter()) .keyBy(0) .timeWindow(Time.seconds(5)) .sum(1); è‡ªå®šä¹‰addSource - æ·»åŠ ä¸€ä¸ªæ–°çš„ source functionã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥ç”¨ addSource(new FlinkKafkaConsumer011&lt;&gt;(â€¦)) ä» Apache Kafka è¯»å–æ•°æ®ã€‚ è¯´è¯´ä¸Šé¢å‡ ç§çš„ç‰¹ç‚¹ 1ã€åŸºäºé›†åˆï¼šæœ‰ç•Œæ•°æ®é›†ï¼Œæ›´åå‘äºæœ¬åœ°æµ‹è¯•ç”¨ 2ã€åŸºäºæ–‡ä»¶ï¼šé€‚åˆç›‘å¬æ–‡ä»¶ä¿®æ”¹å¹¶è¯»å–å…¶å†…å®¹ 3ã€åŸºäº Socketï¼šç›‘å¬ä¸»æœºçš„ host portï¼Œä» Socket ä¸­è·å–æ•°æ® 4ã€è‡ªå®šä¹‰ addSourceï¼šå¤§å¤šæ•°çš„åœºæ™¯æ•°æ®éƒ½æ˜¯æ— ç•Œçš„ï¼Œä¼šæºæºä¸æ–­è¿‡æ¥ã€‚æ¯”å¦‚å»æ¶ˆè´¹ Kafka æŸä¸ª topic ä¸Šçš„æ•°æ®ï¼Œè¿™æ—¶å€™å°±éœ€è¦ç”¨åˆ°è¿™ä¸ª addSourceï¼Œå¯èƒ½å› ä¸ºç”¨çš„æ¯”è¾ƒå¤šçš„åŸå› å§ï¼ŒFlink ç›´æ¥æä¾›äº† FlinkKafkaConsumer011 ç­‰ç±»å¯ä¾›ä½ ç›´æ¥ä½¿ç”¨ã€‚ä½ å¯ä»¥å»çœ‹çœ‹ FlinkKafkaConsumerBase è¿™ä¸ªåŸºç¡€ç±»ï¼Œå®ƒæ˜¯ Flink Kafka æ¶ˆè´¹çš„æœ€æ ¹æœ¬çš„ç±»ã€‚ 123456789StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();DataStream&lt;KafkaEvent&gt; input = env .addSource( new FlinkKafkaConsumer011&lt;&gt;( parameterTool.getRequired(\"input-topic\"), //ä»å‚æ•°ä¸­è·å–ä¼ è¿›æ¥çš„ topic new KafkaEventSchema(), parameterTool.getProperties()) .assignTimestampsAndWatermarks(new CustomWatermarkExtractor())); Flink ç›®å‰æ”¯æŒçš„ Source å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å¦‚æœä½ æƒ³è‡ªå®šä¹‰è‡ªå·±çš„ Source å‘¢ï¼Ÿåœ¨åé¢ 3.8 èŠ‚ä¼šè®²è§£ã€‚ 3.6.3 Data Sink ç®€ä»‹3.6.4 å¸¸ç”¨çš„ Data Sink3.6.5 å°ç»“ä¸åæ€åŠ å…¥çŸ¥è¯†æ˜Ÿçƒå¯ä»¥çœ‹åˆ°ä¸Šé¢æ–‡ç« ï¼šhttps://t.zsxq.com/FAayJU3","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹â€”â€” Watermark çš„ç”¨æ³•å’Œç»“åˆ Window å¤„ç†å»¶è¿Ÿæ•°æ®","date":"2021-07-14T16:00:00.000Z","path":"2021/07/15/flink-in-action-3.5/","text":"3.5 Watermark çš„ç”¨æ³•å’Œç»“åˆ Window å¤„ç†å»¶è¿Ÿæ•°æ®åœ¨ 3.1 èŠ‚ä¸­è®²è§£äº† Flink ä¸­çš„ä¸‰ç§ Time å’Œå…¶å¯¹åº”çš„ä½¿ç”¨åœºæ™¯ï¼Œç„¶ååœ¨ 3.2 èŠ‚ä¸­æ·±å…¥çš„è®²è§£äº† Flink ä¸­çª—å£çš„æœºåˆ¶ä»¥åŠ Flink ä¸­è‡ªå¸¦çš„ Window çš„å®ç°åŸç†å’Œä½¿ç”¨æ–¹æ³•ã€‚å¦‚æœåœ¨è¿›è¡Œ Window è®¡ç®—æ“ä½œçš„æ—¶å€™ï¼Œå¦‚æœä½¿ç”¨çš„æ—¶é—´æ˜¯ Processing Timeï¼Œé‚£ä¹ˆåœ¨ Flink æ¶ˆè´¹æ•°æ®çš„æ—¶å€™ï¼Œå®ƒå®Œå…¨ä¸éœ€è¦å…³å¿ƒçš„æ•°æ®æœ¬èº«çš„æ—¶é—´ï¼Œæ„æ€ä¹Ÿå°±æ˜¯è¯´ä¸éœ€è¦å…³å¿ƒæ•°æ®åˆ°åº•æ˜¯å»¶è¿Ÿæ•°æ®è¿˜æ˜¯ä¹±åºæ•°æ®ã€‚å› ä¸º Processing Time åªæ˜¯ä»£è¡¨æ•°æ®åœ¨ Flink è¢«å¤„ç†æ—¶çš„æ—¶é—´ï¼Œè¿™ä¸ªæ—¶é—´æ˜¯é¡ºåºçš„ã€‚ä½†æ˜¯å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ Event Time çš„è¯ï¼Œé‚£ä¹ˆä½ å°±ä¸å¾—ä¸é¢ä¸´ç€è¿™ä¹ˆä¸ªé—®é¢˜ï¼šäº‹ä»¶ä¹±åº &amp; äº‹ä»¶å»¶è¿Ÿã€‚ é€‰æ‹© Event Time ä¸ Process Time çš„å®é™…æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š åœ¨ç†æƒ³çš„æƒ…å†µä¸‹ï¼ŒEvent Time å’Œ Process Time æ˜¯ç›¸ç­‰çš„ï¼Œæ•°æ®å‘ç”Ÿçš„æ—¶é—´ä¸æ•°æ®å¤„ç†çš„æ—¶é—´æ²¡æœ‰å»¶è¿Ÿï¼Œä½†æ˜¯ç°å®å´ä»ç„¶è¿™ä¹ˆéª¨æ„Ÿï¼Œä¼šå› ä¸ºå„ç§å„æ ·çš„é—®é¢˜ï¼ˆç½‘ç»œçš„æŠ–åŠ¨ã€è®¾å¤‡çš„æ•…éšœã€åº”ç”¨çš„å¼‚å¸¸ç­‰åŸå› ï¼‰ä»è€Œå¯¼è‡´å¦‚å›¾ä¸­æ›²çº¿ä¸€æ ·ï¼ŒProcess Time æ€»æ˜¯ä¼šä¸ Event Time æœ‰ä¸€äº›å»¶è¿Ÿã€‚æ‰€è°“ä¹±åºï¼Œå…¶å®æ˜¯æŒ‡ Flink æ¥æ”¶åˆ°çš„äº‹ä»¶çš„å…ˆåé¡ºåºå¹¶ä¸æ˜¯ä¸¥æ ¼çš„æŒ‰ç…§äº‹ä»¶çš„ Event Time é¡ºåºæ’åˆ—çš„ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ç„¶è€Œåœ¨æœ‰äº›åœºæ™¯ä¸‹ï¼Œå…¶å®æ˜¯ç‰¹åˆ«ä¾èµ–äºäº‹ä»¶æ—¶é—´è€Œä¸æ˜¯å¤„ç†æ—¶é—´ï¼Œæ¯”å¦‚ï¼š é”™è¯¯æ—¥å¿—çš„æ—¶é—´æˆ³ï¼Œä»£è¡¨ç€å‘ç”Ÿçš„é”™è¯¯çš„å…·ä½“æ—¶é—´ï¼Œå¼€å‘ä»¬åªæœ‰çŸ¥é“äº†è¿™ä¸ªæ—¶é—´æˆ³ï¼Œæ‰èƒ½å»è¿˜åŸé‚£ä¸ªæ—¶é—´ç‚¹ç³»ç»Ÿåˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆé—®é¢˜ï¼Œæˆ–è€…æ ¹æ®é‚£ä¸ªæ—¶é—´æˆ³å»å…³è”å…¶ä»–çš„äº‹ä»¶ï¼Œæ‰¾å‡ºå¯¼è‡´é—®é¢˜è§¦å‘çš„ç½ªé­ç¥¸é¦– è®¾å¤‡ä¼ æ„Ÿå™¨æˆ–è€…ç›‘æ§ç³»ç»Ÿå®æ—¶ä¸Šä¼ å¯¹åº”æ—¶é—´ç‚¹çš„è®¾å¤‡å‘¨å›´çš„ç›‘æ§æƒ…å†µï¼Œé€šè¿‡ç›‘æ§å¤§å±å¯ä»¥å®æ—¶æŸ¥çœ‹ï¼Œä¸é”™æ¼é‡è¦æˆ–è€…å¯ç–‘çš„äº‹ä»¶ è¿™ç§æƒ…å†µä¸‹ï¼Œæœ€æœ‰æ„ä¹‰çš„äº‹ä»¶å‘ç”Ÿçš„é¡ºåºï¼Œè€Œä¸æ˜¯äº‹ä»¶åˆ°è¾¾ Flink åè¢«å¤„ç†çš„é¡ºåºã€‚åº†å¹¸çš„æ˜¯ Flink æ”¯æŒç”¨æˆ·ä»¥äº‹ä»¶æ—¶é—´æ¥å®šä¹‰çª—å£ï¼ˆä¹Ÿæ”¯æŒä»¥å¤„ç†æ—¶é—´æ¥å®šä¹‰çª—å£ï¼‰ï¼Œé‚£ä¹ˆè¿™æ ·å°±è¦å»è§£å†³ä¸Šé¢æ‰€è¯´çš„ä¸¤ä¸ªé—®é¢˜ã€‚é’ˆå¯¹ä¸Šé¢çš„é—®é¢˜ï¼ˆäº‹ä»¶ä¹±åº &amp; äº‹ä»¶å»¶è¿Ÿï¼‰ï¼ŒFlink å¼•å…¥äº† Watermark æœºåˆ¶æ¥è§£å†³ã€‚ 3.5.1 Watermark ç®€ä»‹ä¸¾ä¸ªä¾‹å­ï¼š ç»Ÿè®¡ 8:00 ~ 9:00 è¿™ä¸ªæ—¶é—´æ®µæ‰“å¼€æ·˜å® App çš„ç”¨æˆ·æ•°é‡ï¼ŒFlink è¿™è¾¹å¯ä»¥å¼€ä¸ªçª—å£åšèšåˆæ“ä½œï¼Œä½†æ˜¯ç”±äºç½‘ç»œçš„æŠ–åŠ¨æˆ–è€…åº”ç”¨é‡‡é›†æ•°æ®å‘é€å»¶è¿Ÿç­‰é—®é¢˜ï¼Œäºæ˜¯æ— æ³•ä¿è¯åœ¨çª—å£æ—¶é—´ç»“æŸçš„é‚£ä¸€åˆ»çª—å£ä¸­æ˜¯å¦å·²ç»æ”¶é›†å¥½äº†åœ¨ 8:00 ~ 9:00 ä¸­ç”¨æˆ·æ‰“å¼€ App çš„äº‹ä»¶æ•°æ®ï¼Œä½†åˆä¸èƒ½æ— é™æœŸçš„ç­‰ä¸‹å»ï¼Ÿå½“åŸºäºäº‹ä»¶æ—¶é—´çš„æ•°æ®æµè¿›è¡Œçª—å£è®¡ç®—æ—¶ï¼Œæœ€ä¸ºå›°éš¾çš„ä¸€ç‚¹ä¹Ÿå°±æ˜¯å¦‚ä½•ç¡®å®šå¯¹åº”å½“å‰çª—å£çš„äº‹ä»¶å·²ç»å…¨éƒ¨åˆ°è¾¾ã€‚ç„¶è€Œå®é™…ä¸Šå¹¶ä¸èƒ½ç™¾åˆ†ç™¾çš„å‡†ç¡®åˆ¤æ–­ï¼Œå› æ­¤ä¸šç•Œå¸¸ç”¨çš„æ–¹æ³•å°±æ˜¯åŸºäºå·²ç»æ”¶é›†çš„æ¶ˆæ¯æ¥ä¼°ç®—æ˜¯å¦è¿˜æœ‰æ¶ˆæ¯æœªåˆ°è¾¾ï¼Œè¿™å°±æ˜¯ Watermark çš„æ€æƒ³ã€‚ Watermark æ˜¯ä¸€ç§è¡¡é‡ Event Time è¿›å±•çš„æœºåˆ¶ï¼Œå®ƒæ˜¯æ•°æ®æœ¬èº«çš„ä¸€ä¸ªéšè—å±æ€§ï¼Œæ•°æ®æœ¬èº«æºå¸¦ç€å¯¹åº”çš„ Watermarkã€‚Watermark æœ¬è´¨æ¥è¯´å°±æ˜¯ä¸€ä¸ªæ—¶é—´æˆ³ï¼Œä»£è¡¨ç€æ¯”è¿™æ—¶é—´æˆ³æ—©çš„äº‹ä»¶å·²ç»å…¨éƒ¨åˆ°è¾¾çª—å£ï¼Œå³å‡è®¾ä¸ä¼šå†æœ‰æ¯”è¿™æ—¶é—´æˆ³è¿˜å°çš„äº‹ä»¶åˆ°è¾¾ï¼Œè¿™ä¸ªå‡è®¾æ˜¯è§¦å‘çª—å£è®¡ç®—çš„åŸºç¡€ï¼Œåªæœ‰ Watermark å¤§äºçª—å£å¯¹åº”çš„ç»“æŸæ—¶é—´ï¼Œçª—å£æ‰ä¼šå…³é—­å’Œè¿›è¡Œè®¡ç®—ã€‚æŒ‰ç…§è¿™ä¸ªæ ‡å‡†å»å¤„ç†æ•°æ®ï¼Œé‚£ä¹ˆå¦‚æœåé¢è¿˜æœ‰æ¯”è¿™æ—¶é—´æˆ³æ›´å°çš„æ•°æ®ï¼Œé‚£ä¹ˆå°±è§†ä¸ºè¿Ÿåˆ°çš„æ•°æ®ï¼Œå¯¹äºè¿™éƒ¨åˆ†è¿Ÿåˆ°çš„æ•°æ®ï¼ŒFlink ä¹Ÿæœ‰ç›¸åº”çš„æœºåˆ¶ï¼ˆä¸‹æ–‡ä¼šè®²ï¼‰å»å¤„ç†ã€‚ ä¸‹é¢é€šè¿‡å‡ ä¸ªå›¾æ¥äº†è§£ä¸€ä¸‹ Watermark æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ•°æ®æ˜¯ Flink ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ¶ˆè´¹çš„ï¼Œç„¶ååœ¨ Flink ä¸­æœ‰ä¸ª 4s çš„æ—¶é—´çª—å£ï¼ˆæ ¹æ®äº‹ä»¶æ—¶é—´å®šä¹‰çš„çª—å£ï¼‰ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ•°æ®æ˜¯ä¹±åºè¿‡æ¥çš„ï¼Œæ•°æ®ä¸Šçš„æ•°å­—ä»£è¡¨ç€æ•°æ®æœ¬èº«çš„ timestampï¼ŒW(4) å’Œ W(9) æ˜¯æ°´å°ã€‚ ç»è¿‡ Flink çš„æ¶ˆè´¹ï¼Œæ•°æ® 1ã€3ã€2 è¿›å…¥äº†ç¬¬ä¸€ä¸ªçª—å£ï¼Œç„¶å 7 ä¼šè¿›å…¥ç¬¬äºŒä¸ªçª—å£ï¼Œæ¥ç€ 3 ä¾æ—§ä¼šè¿›å…¥ç¬¬ä¸€ä¸ªçª—å£ï¼Œç„¶åå°±æœ‰æ°´å°äº†ï¼Œæ­¤æ—¶æ°´å°è¿‡æ¥äº†ï¼Œå°±ä¼šå‘ç°æ°´å°çš„ timestamp å’Œç¬¬ä¸€ä¸ªçª—å£ç»“æŸæ—¶é—´æ˜¯ä¸€è‡´çš„ï¼Œé‚£ä¹ˆå®ƒå°±è¡¨ç¤ºåœ¨åé¢ä¸ä¼šæœ‰æ¯” 4 è¿˜å°çš„æ•°æ®è¿‡æ¥äº†ï¼Œæ¥ç€å°±ä¼šè§¦å‘ç¬¬ä¸€ä¸ªçª—å£çš„è®¡ç®—æ“ä½œï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ é‚£ä¹ˆæ¥ç€åé¢çš„æ•°æ® 5 å’Œ 6 ä¼šè¿›å…¥åˆ°ç¬¬äºŒä¸ªçª—å£é‡Œé¢ï¼Œæ•°æ® 9 ä¼šè¿›å…¥åœ¨ç¬¬ä¸‰ä¸ªçª—å£é‡Œé¢ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ é‚£ä¹ˆå½“é‡åˆ°æ°´å° 9 æ—¶ï¼Œå‘ç°æ°´å°æ¯”ç¬¬äºŒä¸ªçª—å£çš„ç»“æŸæ—¶é—´ 8 è¿˜å¤§ï¼Œæ‰€ä»¥ç¬¬äºŒä¸ªçª—å£ä¹Ÿä¼šè§¦å‘è¿›è¡Œè®¡ç®—ï¼Œç„¶åä»¥æ­¤ç»§ç»­ç±»æ¨ä¸‹å»ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ ç›¸ä¿¡çœ‹å®Œä¸Šé¢å‡ ä¸ªå›¾çš„è®²è§£ï¼Œä½ å·²ç»çŸ¥é“äº† Watermark çš„å·¥ä½œåŸç†æ˜¯å•¥äº†ï¼Œé‚£ä¹ˆåœ¨ Flink ä¸­è¯¥å¦‚ä½•å»é…ç½®æ°´å°å‘¢ï¼Œä¸‹é¢ä¸€èµ·æ¥çœ‹çœ‹ã€‚ 3.5.2 Flink ä¸­çš„ Watermark çš„è®¾ç½®åœ¨ Flink ä¸­ï¼Œæ•°æ®å¤„ç†ä¸­éœ€è¦é€šè¿‡è°ƒç”¨ DataStream ä¸­çš„ assignTimestampsAndWatermarks æ–¹æ³•æ¥åˆ†é…æ—¶é—´å’Œæ°´å°ï¼Œè¯¥æ–¹æ³•å¯ä»¥ä¼ å…¥ä¸¤ç§å‚æ•°ï¼Œä¸€ä¸ªæ˜¯ AssignerWithPeriodicWatermarksï¼Œå¦ä¸€ä¸ªæ˜¯ AssignerWithPunctuatedWatermarksã€‚ 12345678910111213141516171819public SingleOutputStreamOperator&lt;T&gt; assignTimestampsAndWatermarks(AssignerWithPeriodicWatermarks&lt;T&gt; timestampAndWatermarkAssigner) &#123; final int inputParallelism = getTransformation().getParallelism(); final AssignerWithPeriodicWatermarks&lt;T&gt; cleanedAssigner = clean(timestampAndWatermarkAssigner); TimestampsAndPeriodicWatermarksOperator&lt;T&gt; operator = new TimestampsAndPeriodicWatermarksOperator&lt;&gt;(cleanedAssigner); return transform(\"Timestamps/Watermarks\", getTransformation().getOutputType(), operator).setParallelism(inputParallelism);&#125;public SingleOutputStreamOperator&lt;T&gt; assignTimestampsAndWatermarks(AssignerWithPunctuatedWatermarks&lt;T&gt; timestampAndWatermarkAssigner) &#123; final int inputParallelism = getTransformation().getParallelism(); final AssignerWithPunctuatedWatermarks&lt;T&gt; cleanedAssigner = clean(timestampAndWatermarkAssigner); TimestampsAndPunctuatedWatermarksOperator&lt;T&gt; operator = new TimestampsAndPunctuatedWatermarksOperator&lt;&gt;(cleanedAssigner); return transform(\"Timestamps/Watermarks\", getTransformation().getOutputType(), operator).setParallelism(inputParallelism);&#125; æ‰€ä»¥è®¾ç½® Watermark æ˜¯æœ‰å¦‚ä¸‹ä¸¤ç§æ–¹å¼ï¼š AssignerWithPunctuatedWatermarksï¼šæ•°æ®æµä¸­æ¯ä¸€ä¸ªé€’å¢çš„ EventTime éƒ½ä¼šäº§ç”Ÿä¸€ä¸ª Watermarkã€‚ åœ¨å®é™…çš„ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œåœ¨ TPS å¾ˆé«˜çš„æƒ…å†µä¸‹ä¼šäº§ç”Ÿå¤§é‡çš„ Watermarkï¼Œå¯èƒ½åœ¨ä¸€å®šç¨‹åº¦ä¸Šä¼šå¯¹ä¸‹æ¸¸ç®—å­é€ æˆä¸€å®šçš„å‹åŠ›ï¼Œæ‰€ä»¥åªæœ‰åœ¨å®æ—¶æ€§è¦æ±‚éå¸¸é«˜çš„åœºæ™¯æ‰ä¼šé€‰æ‹©è¿™ç§æ–¹å¼æ¥è¿›è¡Œæ°´å°çš„ç”Ÿæˆã€‚ AssignerWithPeriodicWatermarksï¼šå‘¨æœŸæ€§çš„ï¼ˆä¸€å®šæ—¶é—´é—´éš”æˆ–è€…è¾¾åˆ°ä¸€å®šçš„è®°å½•æ¡æ•°ï¼‰äº§ç”Ÿä¸€ä¸ª Watermarkã€‚ åœ¨å®é™…çš„ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œé€šå¸¸è¿™ç§ä½¿ç”¨è¾ƒå¤šï¼Œå®ƒä¼šå‘¨æœŸæ€§äº§ç”Ÿ Watermark çš„æ–¹å¼ï¼Œä½†æ˜¯å¿…é¡»ç»“åˆæ—¶é—´æˆ–è€…ç§¯ç´¯æ¡æ•°ä¸¤ä¸ªç»´åº¦ï¼Œå¦åˆ™åœ¨æç«¯æƒ…å†µä¸‹ä¼šæœ‰å¾ˆå¤§çš„å»¶æ—¶ï¼Œæ‰€ä»¥ Watermark çš„ç”Ÿæˆæ–¹å¼éœ€è¦æ ¹æ®ä¸šåŠ¡åœºæ™¯çš„ä¸åŒè¿›è¡Œä¸åŒçš„é€‰æ‹©ã€‚ ä¸‹é¢å†åˆ†åˆ«è¯¦ç»†è®²ä¸‹è¿™ä¸¤ç§çš„å®ç°æ–¹å¼ã€‚ 3.5.3 Punctuated WatermarkAssignerWithPunctuatedWatermarks æ¥å£ä¸­åŒ…å«äº† checkAndGetNextWatermark æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šåœ¨æ¯æ¬¡ extractTimestamp() æ–¹æ³•è¢«è°ƒç”¨åè°ƒç”¨ï¼Œå®ƒå¯ä»¥å†³å®šæ˜¯å¦è¦ç”Ÿæˆä¸€ä¸ªæ–°çš„æ°´å°ï¼Œè¿”å›çš„æ°´å°åªæœ‰åœ¨ä¸ä¸º null å¹¶ä¸”æ—¶é—´æˆ³è¦å¤§äºå…ˆå‰è¿”å›çš„æ°´å°æ—¶é—´æˆ³çš„æ—¶å€™æ‰ä¼šå‘é€å‡ºå»ï¼Œå¦‚æœè¿”å›çš„æ°´å°æ˜¯ null æˆ–è€…è¿”å›çš„æ°´å°æ—¶é—´æˆ³æ¯”ä¹‹å‰çš„å°åˆ™ä¸ä¼šç”Ÿæˆæ–°çš„æ°´å°ã€‚ é‚£ä¹ˆè¯¥æ€ä¹ˆåˆ©ç”¨è¿™ä¸ªæ¥å®šä¹‰æ°´å°ç”Ÿæˆå™¨å‘¢ï¼Ÿ 12345678910111213public class WordPunctuatedWatermark implements AssignerWithPunctuatedWatermarks&lt;Word&gt; &#123; @Nullable @Override public Watermark checkAndGetNextWatermark(Word lastElement, long extractedTimestamp) &#123; return extractedTimestamp % 3 == 0 ? new Watermark(extractedTimestamp) : null; &#125; @Override public long extractTimestamp(Word element, long previousElementTimestamp) &#123; return element.getTimestamp(); &#125;&#125; éœ€è¦æ³¨æ„çš„æ˜¯è¿™ç§æƒ…å†µä¸‹å¯ä»¥ä¸ºæ¯ä¸ªäº‹ä»¶éƒ½ç”Ÿæˆä¸€ä¸ªæ°´å°ï¼Œä½†æ˜¯å› ä¸ºæ°´å°æ˜¯è¦åœ¨ä¸‹æ¸¸å‚ä¸è®¡ç®—çš„ï¼Œæ‰€ä»¥è¿‡å¤šçš„è¯ä¼šå¯¼è‡´æ•´ä½“è®¡ç®—æ€§èƒ½ä¸‹é™ã€‚ 3.5.4 Periodic Watermarké€šå¸¸åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ AssignerWithPeriodicWatermarks æ¥å®šæœŸåˆ†é…æ—¶é—´æˆ³å¹¶ç”Ÿæˆæ°´å°æ¯”è¾ƒå¤šï¼Œé‚£ä¹ˆå…ˆæ¥è®²ä¸‹è¿™ä¸ªè¯¥å¦‚ä½•ä½¿ç”¨ã€‚ 123456789101112131415161718public class WordPeriodicWatermark implements AssignerWithPeriodicWatermarks&lt;Word&gt; &#123; private long currentTimestamp = Long.MIN_VALUE; @Override public long extractTimestamp(Word word, long previousElementTimestamp) &#123; long timestamp = word.getTimestamp(); currentTimestamp = Math.max(timestamp, currentTimestamp); return word.getTimestamp(); &#125; @Nullable @Override public Watermark getCurrentWatermark() &#123; long maxTimeLag = 5000; return new Watermark(currentTimestamp == Long.MIN_VALUE ? Long.MIN_VALUE : currentTimestamp - maxTimeLag); &#125;&#125; ä¸Šé¢çš„æ˜¯æˆ‘æ ¹æ® Word æ•°æ®è‡ªå®šä¹‰çš„æ°´å°å‘¨æœŸæ€§ç”Ÿæˆå™¨ï¼Œåœ¨è¿™ä¸ªç±»ä¸­ï¼Œæœ‰ä¸¤ä¸ªæ–¹æ³• extractTimestamp() å’Œ getCurrentWatermark()ã€‚extractTimestamp() æ–¹æ³•æ˜¯ä»æ•°æ®æœ¬èº«ä¸­æå– Event Timeï¼Œç„¶åå°†å½“å‰æ—¶é—´æˆ³ä¸äº‹ä»¶æ—¶é—´è¿›è¡Œæ¯”è¾ƒï¼Œå–æœ€å¤§å€¼åèµ‹å€¼ç»™å½“å‰æ—¶é—´æˆ³ currentTimestampï¼Œç„¶åè¿”å›äº‹ä»¶æ—¶é—´ã€‚getCurrentWatermark() æ–¹æ³•æ˜¯è·å–å½“å‰çš„æ°´ä½çº¿ï¼Œé€šè¿‡ currentTimestamp - maxTimeLag å¾—åˆ°æ°´å°çš„å€¼ï¼Œè¿™é‡Œæœ‰ä¸ª maxTimeLag å‚æ•°ä»£è¡¨æ•°æ®èƒ½å¤Ÿå»¶è¿Ÿçš„æ—¶é—´ï¼Œä¸Šé¢ä»£ç ä¸­å®šä¹‰çš„ long maxTimeLag = 5000; è¡¨ç¤ºæœ€å¤§å…è®¸æ•°æ®å»¶è¿Ÿæ—¶é—´ä¸º 5sï¼Œè¶…è¿‡ 5s çš„è¯å¦‚æœè¿˜æ¥äº†ä¹‹å‰æ—©çš„æ•°æ®ï¼Œé‚£ä¹ˆ Flink å°±ä¼šä¸¢å¼ƒäº†ï¼Œå› ä¸º Flink çš„çª—å£ä¸­çš„æ•°æ®æ˜¯è¦è§¦å‘çš„ï¼Œä¸å¯èƒ½ä¸€ç›´åœ¨ç­‰ç€è¿™äº›è¿Ÿåˆ°çš„æ•°æ®ï¼ˆç”±äºç½‘ç»œçš„é—®é¢˜æ•°æ®å¯èƒ½ä¸€ç›´æ²¡å‘ä¸Šæ¥ï¼‰è€Œä¸è®©çª—å£è§¦å‘ç»“æŸè¿›è¡Œè®¡ç®—æ“ä½œã€‚ é€šè¿‡å®šä¹‰è¿™ä¸ªæ—¶é—´ï¼Œå¯ä»¥é¿å…éƒ¨åˆ†æ•°æ®å› ä¸ºç½‘ç»œæˆ–è€…å…¶ä»–çš„é—®é¢˜å¯¼è‡´ä¸èƒ½å¤ŸåŠæ—¶ä¸Šä¼ ä»è€Œä¸æŠŠè¿™äº›äº‹ä»¶æ•°æ®ä½œä¸ºè®¡ç®—çš„ï¼Œé‚£ä¹ˆå¦‚æœåœ¨è¿™å»¶è¿Ÿä¹‹åè¿˜æœ‰æ›´æ—©çš„æ•°æ®åˆ°æ¥çš„è¯ï¼Œé‚£ä¹ˆ Flink å°±ä¼šä¸¢å¼ƒäº†ï¼Œæ‰€ä»¥åˆç†çš„è®¾ç½®è¿™ä¸ªå…è®¸å»¶è¿Ÿçš„æ—¶é—´ä¹Ÿæ˜¯ä¸€é—¨ç»†æ´»ï¼Œå¾—è§‚å¯Ÿç”Ÿäº§ç¯å¢ƒæ•°æ®çš„é‡‡é›†åˆ°æ¶ˆæ¯é˜Ÿåˆ—å†åˆ° Flink æ•´ä¸ªæµç¨‹æ˜¯å¦ä¼šå‡ºç°å»¶è¿Ÿï¼Œç»Ÿè®¡å¹³å‡å»¶è¿Ÿå¤§æ¦‚ä¼šåœ¨ä»€ä¹ˆèŒƒå›´å†…æ³¢åŠ¨ã€‚è¿™ä¹Ÿå°±æ˜¯è¯´æ˜äº†ä¸€ä¸ªäº‹å®é‚£å°±æ˜¯ Flink ä¸­è®¾è®¡è¿™ä¸ªæ°´å°çš„æ ¹æœ¬ç›®çš„æ˜¯æ¥è§£å†³éƒ¨åˆ†æ•°æ®ä¹±åºæˆ–è€…æ•°æ®å»¶è¿Ÿçš„é—®é¢˜ï¼Œè€Œä¸èƒ½çœŸæ­£åšåˆ°å½»åº•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¸è¿‡è¿™ä¸€ç‰¹æ€§åœ¨ç›¸æ¯”äºå…¶ä»–çš„æµå¤„ç†æ¡†æ¶å·²ç»ç®—æ˜¯éå¸¸ç»™åŠ›äº†ã€‚ AssignerWithPeriodicWatermarks è¿™ä¸ªæ¥å£æœ‰å››ä¸ªå®ç°ç±»ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š è¿™å››ä¸ªå®ç°ç±»çš„åŠŸèƒ½å’Œä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š BoundedOutOfOrdernessTimestampExtractorï¼šè¯¥ç±»ç”¨æ¥å‘å‡ºæ»åäºæ•°æ®æ—¶é—´çš„æ°´å°ï¼Œå®ƒçš„ç›®çš„å…¶å®å°±æ˜¯å’Œæˆ‘ä»¬ä¸Šé¢å®šä¹‰çš„é‚£ä¸ªç±»ä½œç”¨æ˜¯ç±»ä¼¼çš„ï¼Œä½ å¯ä»¥ä¼ å…¥ä¸€ä¸ªæ—¶é—´ä»£è¡¨ç€å¯ä»¥å…è®¸æ•°æ®å»¶è¿Ÿåˆ°æ¥çš„æ—¶é—´æ˜¯å¤šé•¿ã€‚è¯¥ç±»å†…éƒ¨å®ç°å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä½ å¯ä»¥åƒä¸‹é¢ä¸€æ ·ä½¿ç”¨è¯¥ç±»æ¥åˆ†é…æ—¶é—´å’Œç”Ÿæˆæ°´å°ï¼š 12345678//Time.seconds(10) ä»£è¡¨å…è®¸å»¶è¿Ÿçš„æ—¶é—´å¤§å°dataStream.assignTimestampsAndWatermarks(new BoundedOutOfOrdernessTimestampExtractor&lt;Event&gt;(Time.seconds(10)) &#123; //é‡å†™ BoundedOutOfOrdernessTimestampExtractor ä¸­çš„ extractTimestamp()æŠ½è±¡æ–¹æ³• @Override public long extractTimestamp(Event event) &#123; return event.getTimestamp(); &#125;&#125;) CustomWatermarkExtractorï¼šè¿™æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„å‘¨æœŸæ€§ç”Ÿæˆæ°´å°çš„ç±»ï¼Œåœ¨è¿™ä¸ªç±»é‡Œé¢çš„æ•°æ®æ˜¯ KafkaEventã€‚ AscendingTimestampExtractorï¼šæ—¶é—´æˆ³åˆ†é…å™¨å’Œæ°´å°ç”Ÿæˆå™¨ï¼Œç”¨äºæ—¶é—´æˆ³å•è°ƒé€’å¢çš„æ•°æ®æµï¼Œå¦‚æœæ•°æ®æµçš„æ—¶é—´æˆ³ä¸æ˜¯å•è°ƒé€’å¢ï¼Œé‚£ä¹ˆä¼šæœ‰ä¸“é—¨çš„å¤„ç†æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š 12345678910public final long extractTimestamp(T element, long elementPrevTimestamp) &#123; final long newTimestamp = extractAscendingTimestamp(element); if (newTimestamp &gt;= this.currentTimestamp) &#123; this.currentTimestamp = neâˆwTimestamp; return newTimestamp; &#125; else &#123; violationHandler.handleViolation(newTimestamp, this.currentTimestamp); return newTimestamp; &#125;&#125; IngestionTimeExtractorï¼šä¾èµ–äºæœºå™¨ç³»ç»Ÿæ—¶é—´ï¼Œå®ƒåœ¨ extractTimestamp å’Œ getCurrentWatermark æ–¹æ³•ä¸­æ˜¯æ ¹æ® System.currentTimeMillis() æ¥è·å–æ—¶é—´çš„ï¼Œè€Œä¸æ˜¯æ ¹æ®äº‹ä»¶çš„æ—¶é—´ï¼Œå¦‚æœè¿™ä¸ªæ—¶é—´åˆ†é…å™¨æ˜¯åœ¨æ•°æ®æºè¿› Flink ååˆ†é…çš„ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶é—´å°±å’Œ Ingestion Time ä¸€è‡´äº†ï¼Œæ‰€ä»¥å‘½åä¹Ÿå–çš„å°±æ˜¯å« IngestionTimeExtractorã€‚ æ³¨æ„ï¼š 1ã€ä½¿ç”¨è¿™ç§æ–¹å¼å‘¨æœŸæ€§ç”Ÿæˆæ°´å°çš„è¯ï¼Œä½ å¯ä»¥é€šè¿‡ env.getConfig().setAutoWatermarkInterval(...); æ¥è®¾ç½®ç”Ÿæˆæ°´å°çš„é—´éš”ï¼ˆæ¯éš” n æ¯«ç§’ï¼‰ã€‚ 2ã€é€šå¸¸å»ºè®®åœ¨æ•°æ®æºï¼ˆsourceï¼‰ä¹‹åå°±è¿›è¡Œç”Ÿæˆæ°´å°ï¼Œæˆ–è€…åšäº›ç®€å•æ“ä½œæ¯”å¦‚ filter/map/flatMap ä¹‹åå†ç”Ÿæˆæ°´å°ï¼Œè¶Šæ—©ç”Ÿæˆæ°´å°çš„æ•ˆæœä¼šæ›´å¥½ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨æ•°æ®æºå¤´å°±åšç”Ÿæˆæ°´å°ã€‚æ¯”å¦‚ä½ å¯ä»¥åœ¨ source æºå¤´ç±»ä¸­çš„ run() æ–¹æ³•é‡Œé¢è¿™æ ·å®šä¹‰ 1234567891011@Overridepublic void run(SourceContext&lt;MyType&gt; ctx) throws Exception &#123; while (/* condition */) &#123; MyType next = getNext(); ctx.collectWithTimestamp(next, next.getEventTimestamp()); if (next.hasWatermarkTime()) &#123; ctx.emitWatermark(new Watermark(next.getWatermarkTime())); &#125; &#125;&#125; 3.5.5 æ¯ä¸ª Kafka åˆ†åŒºçš„æ—¶é—´æˆ³3.5.6 å°† Watermark ä¸ Window ç»“åˆèµ·æ¥å¤„ç†å»¶è¿Ÿæ•°æ®3.5.7 å¤„ç†å»¶è¿Ÿæ•°æ®çš„ä¸‰ç§æ–¹æ³•ä¸¢å¼ƒï¼ˆé»˜è®¤ï¼‰allowedLateness å†æ¬¡æŒ‡å®šå…è®¸æ•°æ®å»¶è¿Ÿçš„æ—¶é—´sideOutputLateData æ”¶é›†è¿Ÿåˆ°çš„æ•°æ®3.5.8 å°ç»“ä¸åæ€åŠ å…¥çŸ¥è¯†æ˜Ÿçƒå¯ä»¥çœ‹åˆ°ä¸Šé¢æ–‡ç« ï¼šhttps://t.zsxq.com/RbufeIA","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹â€”â€” ä½¿ç”¨ DataStream API æ¥å¤„ç†æ•°æ®","date":"2021-07-13T16:00:00.000Z","path":"2021/07/14/flink-in-action-3.4/","text":"3.4 ä½¿ç”¨ DataStream API æ¥å¤„ç†æ•°æ®åœ¨ 3.3 èŠ‚ä¸­è®²äº†æ•°æ®è½¬æ¢å¸¸ç”¨çš„ Operatorsï¼ˆç®—å­ï¼‰ï¼Œç„¶ååœ¨ 3.2 èŠ‚ä¸­ä¹Ÿè®²äº† Flink ä¸­çª—å£çš„æ¦‚å¿µå’ŒåŸç†ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¿™ç¯‡æ–‡ç« å†æ¥ç»†è®²ä¸€ä¸‹ Flink ä¸­çš„å„ç§ DataStream APIã€‚ æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹æºç é‡Œé¢çš„ DataStream å¤§æ¦‚æœ‰å“ªäº›ç±»å‘¢ï¼Ÿå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå±•ç¤ºäº† 1.9 ç‰ˆæœ¬ä¸­çš„ DataStream ç±»ã€‚ å¯ä»¥å‘ç°å…¶å®è¿˜æ˜¯æœ‰å¾ˆå¤šçš„ç±»ï¼Œåªæœ‰ç†Ÿç»ƒæŒæ¡äº†è¿™äº› APIï¼Œæˆ‘ä»¬æ‰èƒ½åœ¨åšæ•°æ®è½¬æ¢å’Œè®¡ç®—çš„æ—¶å€™è¶³å¤Ÿçµæ´»çš„è¿ç”¨å¼€æ¥ï¼ˆçŸ¥é“ä½•æ—¶è¯¥é€‰ç”¨å“ªç§ DataStreamï¼Ÿé€‰ç”¨å“ªä¸ª Functionï¼Ÿï¼‰ã€‚é‚£ä¹ˆæˆ‘ä»¬å…ˆä» DataStream å¼€å§‹å§ï¼ 3.4.1 DataStream çš„ç”¨æ³•åŠåˆ†æé¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸‹ DataStream è¿™ä¸ªç±»çš„å®šä¹‰å§ï¼š 12A DataStream represents a stream of elements of the same type. A DataStreamcan be transformed into another DataStream by applying a transformation as DataStream#map or DataStream#filter&#125; å¤§æ¦‚æ„æ€æ˜¯ï¼šDataStream è¡¨ç¤ºç›¸åŒç±»å‹çš„å…ƒç´ ç»„æˆçš„æ•°æ®æµï¼Œä¸€ä¸ªæ•°æ®æµå¯ä»¥é€šè¿‡ map/filter ç­‰ç®—å­è½¬æ¢æˆå¦ä¸€ä¸ªæ•°æ®æµã€‚ ç„¶å DataStream çš„ç±»ç»“æ„å›¾å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å®ƒçš„ç»§æ‰¿ç±»æœ‰ KeyedStreamã€SingleOutputStreamOperator å’Œ SplitStreamã€‚è¿™å‡ ä¸ªç±»æœ¬æ–‡åé¢éƒ½ä¼šä¸€ä¸€ç»™å¤§å®¶è®²æ¸…æ¥šã€‚ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹ DataStream è¿™ä¸ªç±»ä¸­çš„å±æ€§å’Œæ–¹æ³•å§ã€‚ å®ƒçš„å±æ€§å°±åªæœ‰ä¸¤ä¸ªï¼š 123protected final StreamExecutionEnvironment environment;protected final StreamTransformation&lt;T&gt; transformation; ä½†æ˜¯å®ƒçš„æ–¹æ³•å´æœ‰å¾ˆå¤šï¼Œå¹¶ä¸”æˆ‘ä»¬å¹³æ—¶å†™çš„ Flink Job å‡ ä¹ç¦»ä¸å¼€è¿™äº›æ–¹æ³•ï¼Œè¿™ä¹Ÿæ³¨å®šäº†è¿™ä¸ªç±»çš„é‡è¦æ€§ï¼Œæ‰€ä»¥å¾—å¥½å¥½çœ‹ä¸‹è¿™äº›æ–¹æ³•è¯¥å¦‚ä½•ä½¿ç”¨ï¼Œä»¥åŠæ˜¯å¦‚ä½•å®ç°çš„ã€‚ unioné€šè¿‡åˆå¹¶ç›¸åŒæ•°æ®ç±»å‹çš„æ•°æ®æµï¼Œç„¶ååˆ›å»ºä¸€ä¸ªæ–°çš„æ•°æ®æµï¼Œunion æ–¹æ³•ä»£ç å®ç°å¦‚ä¸‹ï¼š 12345678910111213public final DataStream&lt;T&gt; union(DataStream&lt;T&gt;... streams) &#123; List&lt;StreamTransformation&lt;T&gt;&gt; unionedTransforms = new ArrayList&lt;&gt;(); unionedTransforms.add(this.transformation); for (DataStream&lt;T&gt; newStream : streams) &#123; if (!getType().equals(newStream.getType())) &#123; //åˆ¤æ–­æ•°æ®ç±»å‹æ˜¯å¦ä¸€è‡´ throw new IllegalArgumentException(\"Cannot union streams of different types: \" + getType() + \" and \" + newStream.getType()); &#125; unionedTransforms.add(newStream.getTransformation()); &#125; //æ„å»ºæ–°çš„æ•°æ®æµ return new DataStream&lt;&gt;(this.environment, new UnionTransformation&lt;&gt;(unionedTransforms));//é€šè¿‡ä½¿ç”¨ UnionTransformation å°†å¤šä¸ª StreamTransformation åˆå¹¶èµ·æ¥&#125; é‚£ä¹ˆæˆ‘ä»¬è¯¥å¦‚ä½•å»ä½¿ç”¨ union å‘¢ï¼ˆä¸æ­¢è¿æ¥ä¸€ä¸ªæ•°æ®æµï¼Œä¹Ÿå¯ä»¥è¿æ¥å¤šä¸ªæ•°æ®æµï¼‰ï¼Ÿ 12345//æ•°æ®æµ 1 å’Œ 2final DataStream&lt;Integer&gt; stream1 = env.addSource(...);final DataStream&lt;Integer&gt; stream2 = env.addSource(...);//unionstream1.union(stream2) splitè¯¥æ–¹æ³•å¯ä»¥å°†ä¸¤ä¸ªæ•°æ®æµè¿›è¡Œæ‹†åˆ†ï¼Œæ‹†åˆ†åçš„æ•°æ®æµå˜æˆäº† SplitStreamï¼ˆåœ¨ä¸‹æ–‡ä¼šè¯¦ç»†ä»‹ç»è¿™ä¸ªç±»çš„å†…éƒ¨å®ç°ï¼‰ï¼Œè¯¥ split æ–¹æ³•é€šè¿‡ä¼ å…¥ä¸€ä¸ª OutputSelector å‚æ•°è¿›è¡Œæ•°æ®é€‰æ‹©ï¼Œæ–¹æ³•å†…éƒ¨å®ç°å°±æ˜¯æ„é€ ä¸€ä¸ª SplitStream å¯¹è±¡ç„¶åè¿”å›ï¼š 123public SplitStream&lt;T&gt; split(OutputSelector&lt;T&gt; outputSelector) &#123; return new SplitStream&lt;&gt;(this, clean(outputSelector));&#125; ç„¶åæˆ‘ä»¬è¯¥å¦‚ä½•ä½¿ç”¨è¿™ä¸ªæ–¹æ³•å‘¢ï¼Ÿ 1234567891011121314dataStream.split(new OutputSelector&lt;Integer&gt;() &#123; private static final long serialVersionUID = 8354166915727490130L; @Override public Iterable&lt;String&gt; select(Integer value) &#123; List&lt;String&gt; s = new ArrayList&lt;String&gt;(); if (value &gt; 4) &#123; //å¤§äº 4 çš„æ•°æ®æ”¾åˆ° &gt; è¿™ä¸ª tag é‡Œé¢å» s.add(\"&gt;\"); &#125; else &#123; //å°äºç­‰äº 4 çš„æ•°æ®æ”¾åˆ° &lt; è¿™ä¸ª tag é‡Œé¢å» s.add(\"&lt;\"); &#125; return s; &#125;&#125;); æ³¨æ„ï¼šè¯¥æ–¹æ³•å·²ç»ä¸æ¨èä½¿ç”¨äº†ï¼åœ¨ 1.7 ç‰ˆæœ¬ä»¥åå»ºè®®ä½¿ç”¨ Side Output æ¥å®ç°åˆ†æµæ“ä½œã€‚ connecté€šè¿‡è¿æ¥ä¸åŒæˆ–ç›¸åŒæ•°æ®ç±»å‹çš„æ•°æ®æµï¼Œç„¶ååˆ›å»ºä¸€ä¸ªæ–°çš„è¿æ¥æ•°æ®æµï¼Œå¦‚æœè¿æ¥çš„æ•°æ®æµä¹Ÿæ˜¯ä¸€ä¸ª DataStream çš„è¯ï¼Œé‚£ä¹ˆè¿æ¥åçš„æ•°æ®æµä¸º ConnectedStreamsï¼ˆä¼šåœ¨ä¸‹æ–‡ä»‹ç»è¿™ä¸ªç±»çš„å…·ä½“å®ç°ï¼‰ï¼Œå®ƒçš„å…·ä½“å®ç°å¦‚ä¸‹ï¼š 123public &lt;R&gt; ConnectedStreams&lt;T, R&gt; connect(DataStream&lt;R&gt; dataStream) &#123; return new ConnectedStreams&lt;&gt;(environment, this, dataStream);&#125; å¦‚æœè¿æ¥çš„æ•°æ®æµæ˜¯ä¸€ä¸ª BroadcastStreamï¼ˆå¹¿æ’­æ•°æ®æµï¼‰ï¼Œé‚£ä¹ˆè¿æ¥åçš„æ•°æ®æµæ˜¯ä¸€ä¸ª BroadcastConnectedStreamï¼ˆä¼šåœ¨ä¸‹æ–‡è¯¦ç»†ä»‹ç»è¯¥ç±»çš„å†…éƒ¨å®ç°ï¼‰ï¼Œå®ƒçš„å…·ä½“å®ç°å¦‚ä¸‹ï¼š 12345public &lt;R&gt; BroadcastConnectedStream&lt;T, R&gt; connect(BroadcastStream&lt;R&gt; broadcastStream) &#123; return new BroadcastConnectedStream&lt;&gt;( environment, this, Preconditions.checkNotNull(broadcastStream), broadcastStream.getBroadcastStateDescriptor());&#125; ä½¿ç”¨å¦‚ä¸‹ï¼š 123456789//1ã€è¿æ¥ DataStreamDataStream&lt;Tuple2&lt;Long, Long&gt;&gt; src1 = env.fromElements(new Tuple2&lt;&gt;(0L, 0L));DataStream&lt;Tuple2&lt;Long, Long&gt;&gt; src2 = env.fromElements(new Tuple2&lt;&gt;(0L, 0L));ConnectedStreams&lt;Tuple2&lt;Long, Long&gt;, Tuple2&lt;Long, Long&gt;&gt; connected = src1.connect(src2);//2ã€è¿æ¥ BroadcastStreamDataStream&lt;Tuple2&lt;Long, Long&gt;&gt; src1 = env.fromElements(new Tuple2&lt;&gt;(0L, 0L));final BroadcastStream&lt;String&gt; broadcast = srcTwo.broadcast(utterDescriptor);BroadcastConnectedStream&lt;Tuple2&lt;Long, Long&gt;, String&gt; connect = src1.connect(broadcast); keyBykeyBy æ–¹æ³•æ˜¯ç”¨æ¥å°†æ•°æ®è¿›è¡Œåˆ†ç»„çš„ï¼Œé€šè¿‡è¯¥æ–¹æ³•å¯ä»¥å°†å…·æœ‰ç›¸åŒ key çš„æ•°æ®åˆ’åˆ†åœ¨ä¸€èµ·ç»„æˆæ–°çš„æ•°æ®æµï¼Œè¯¥æ–¹æ³•æœ‰å››ç§ï¼ˆå®ƒä»¬çš„å‚æ•°å„ä¸ä¸€æ ·ï¼‰ï¼š 12345678910111213141516171819202122232425262728293031//1ã€å‚æ•°æ˜¯ KeySelector å¯¹è±¡public &lt;K&gt; KeyedStream&lt;T, K&gt; keyBy(KeySelector&lt;T, K&gt; key) &#123; ... return new KeyedStream&lt;&gt;(this, clean(key));//æ„é€  KeyedStream å¯¹è±¡&#125;//2ã€å‚æ•°æ˜¯ KeySelector å¯¹è±¡å’Œ TypeInformation å¯¹è±¡public &lt;K&gt; KeyedStream&lt;T, K&gt; keyBy(KeySelector&lt;T, K&gt; key, TypeInformation&lt;K&gt; keyType) &#123; ... return new KeyedStream&lt;&gt;(this, clean(key), keyType);//æ„é€  KeyedStream å¯¹è±¡&#125;//3ã€å‚æ•°æ˜¯ 1 è‡³å¤šä¸ªå­—æ®µï¼ˆç”¨ 0ã€1ã€2... è¡¨ç¤ºï¼‰public KeyedStream&lt;T, Tuple&gt; keyBy(int... fields) &#123; if (getType() instanceof BasicArrayTypeInfo || getType() instanceof PrimitiveArrayTypeInfo) &#123; return keyBy(KeySelectorUtil.getSelectorForArray(fields, getType())); &#125; else &#123; return keyBy(new Keys.ExpressionKeys&lt;&gt;(fields, getType()));//è°ƒç”¨ private çš„ keyBy æ–¹æ³• &#125;&#125;//4ã€å‚æ•°æ˜¯ 1 è‡³å¤šä¸ªå­—ç¬¦ä¸²public KeyedStream&lt;T, Tuple&gt; keyBy(String... fields) &#123; return keyBy(new Keys.ExpressionKeys&lt;&gt;(fields, getType()));//è°ƒç”¨ private çš„ keyBy æ–¹æ³•&#125;//çœŸæ­£è°ƒç”¨çš„æ–¹æ³•private KeyedStream&lt;T, Tuple&gt; keyBy(Keys&lt;T&gt; keys) &#123; return new KeyedStream&lt;&gt;(this, clean(KeySelectorUtil.getSelectorForKeys(keys, getType(), getExecutionConfig())));&#125; å¦‚ä½•ä½¿ç”¨å‘¢ï¼š 12345678910111213141516171819202122232425262728293031DataStream&lt;Event&gt; dataStream = env.fromElements( new Event(1, \"zhisheng01\", 1.0), new Event(2, \"zhisheng02\", 2.0), new Event(3, \"zhisheng03\", 2.1), new Event(3, \"zhisheng04\", 3.0), new SubEvent(4, \"zhisheng05\", 4.0, 1.0),);//ç¬¬1ç§dataStream.keyBy(new KeySelector&lt;Event, Integer&gt;() &#123; @Override public Integer getKey(Event value) throws Exception &#123; return value.getId(); &#125;&#125;);//ç¬¬2ç§dataStream.keyBy(new KeySelector&lt;Event, Integer&gt;() &#123; @Override public Integer getKey(Event value) throws Exception &#123; return value.getId(); &#125;&#125;, Types.STRING);//ç¬¬3ç§dataStream.keyBy(0);//ç¬¬4ç§dataStream.keyBy(\"zhisheng01\", \"zhisheng02\"); partitionCustomä½¿ç”¨è‡ªå®šä¹‰åˆ†åŒºå™¨åœ¨æŒ‡å®šçš„ key å­—æ®µä¸Šå°† DataStream åˆ†åŒºï¼Œè¿™ä¸ª partitionCustom æœ‰ 3 ä¸ªä¸åŒå‚æ•°çš„æ–¹æ³•ï¼Œåˆ†åˆ«è¦ä¼ å…¥çš„å‚æ•°æœ‰è‡ªå®šä¹‰åˆ†åŒº Partitioner å¯¹è±¡ã€ä½ç½®ã€å­—ç¬¦å’Œ KeySelectorã€‚å®ƒä»¬å†…éƒ¨ä¹Ÿéƒ½æ˜¯è°ƒç”¨äº†ç§æœ‰çš„ partitionCustom æ–¹æ³•ã€‚ broadcastbroadcast æ˜¯å°†æ•°æ®æµè¿›è¡Œå¹¿æ’­ï¼Œç„¶åè®©ä¸‹æ¸¸çš„æ¯ä¸ªå¹¶è¡Œ Task ä¸­éƒ½å¯ä»¥è·å–åˆ°è¿™ä»½æ•°æ®æµï¼Œé€šå¸¸è¿™äº›æ•°æ®æ˜¯ä¸€äº›é…ç½®ï¼Œä¸€èˆ¬è¿™äº›é…ç½®æ•°æ®çš„æ•°æ®é‡ä¸èƒ½å¤ªå¤§ï¼Œå¦åˆ™èµ„æºæ¶ˆè€—ä¼šæ¯”è¾ƒå¤§ã€‚è¿™ä¸ª broadcast æ–¹æ³•ä¹Ÿæœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯æ— å‚æ•°ï¼Œå®ƒè¿”å›çš„æ•°æ®æ˜¯ DataStreamï¼›å¦ä¸€ç§çš„å‚æ•°æ˜¯ MapStateDescriptorï¼Œå®ƒè¿”å›çš„å‚æ•°æ˜¯ BroadcastStreamï¼ˆè¿™ä¸ªä¹Ÿä¼šåœ¨ä¸‹æ–‡è¯¦ç»†ä»‹ç»ï¼‰ã€‚ ä½¿ç”¨æ–¹æ³•ï¼š 12345678910//1ã€ç¬¬ä¸€ç§DataStream&lt;Tuple2&lt;Integer, String&gt;&gt; source = env.addSource(...).broadcast();//2ã€ç¬¬äºŒç§final MapStateDescriptor&lt;Long, String&gt; utterDescriptor = new MapStateDescriptor&lt;&gt;( \"broadcast-state\", BasicTypeInfo.LONG_TYPE_INFO, BasicTypeInfo.STRING_TYPE_INFO);final DataStream&lt;String&gt; srcTwo = env.fromCollection(expected.values());final BroadcastStream&lt;String&gt; broadcast = srcTwo.broadcast(utterDescriptor); mapmap æ–¹æ³•éœ€è¦ä¼ å…¥çš„å‚æ•°æ˜¯ä¸€ä¸ª MapFunctionï¼Œå½“ç„¶ä¼ å…¥ RichMapFunction ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œå®ƒè¿”å›çš„æ˜¯ SingleOutputStreamOperatorï¼ˆè¿™ä¸ªç±»åœ¨ä¼šåœ¨ä¸‹æ–‡è¯¦ç»†ä»‹ç»ï¼‰ï¼Œè¯¥ map æ–¹æ³•é‡Œé¢çš„å®ç°å¦‚ä¸‹ï¼š 1234567public &lt;R&gt; SingleOutputStreamOperator&lt;R&gt; map(MapFunction&lt;T, R&gt; mapper) &#123; TypeInformation&lt;R&gt; outType = TypeExtractor.getMapReturnTypes(clean(mapper), getType(), Utils.getCallLocationName(), true); //è°ƒç”¨ transform æ–¹æ³• return transform(\"Map\", outType, new StreamMap&lt;&gt;(clean(mapper)));&#125; è¯¥æ–¹æ³•å¹³æ—¶ä½¿ç”¨çš„éå¸¸é¢‘ç¹ï¼Œç„¶åæˆ‘ä»¬è¯¥å¦‚ä½•ä½¿ç”¨è¿™ä¸ªæ–¹æ³•å‘¢ï¼š 12345678dataStream.map(new MapFunction&lt;Integer, String&gt;() &#123; private static final long serialVersionUID = 1L; @Override public String map(Integer value) throws Exception &#123; return value.toString(); &#125;&#125;) flatMapflatMap æ–¹æ³•éœ€è¦ä¼ å…¥ä¸€ä¸ª FlatMapFunction å‚æ•°ï¼Œå½“ç„¶ä¼ å…¥ RichFlatMapFunction ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œå¦‚æœä½ çš„ Flink Job é‡Œé¢æœ‰è¿ç»­çš„ filter å’Œ map ç®—å­åœ¨ä¸€èµ·ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ flatMap ä¸€ä¸ªç®—å­æ¥å®Œæˆä¸¤ä¸ªç®—å­çš„å·¥ä½œï¼Œå®ƒè¿”å›çš„æ˜¯ SingleOutputStreamOperatorï¼Œè¯¥ flatMap æ–¹æ³•é‡Œé¢çš„å®ç°å¦‚ä¸‹ï¼š 12345678public &lt;R&gt; SingleOutputStreamOperator&lt;R&gt; flatMap(FlatMapFunction&lt;T, R&gt; flatMapper) &#123; TypeInformation&lt;R&gt; outType = TypeExtractor.getFlatMapReturnTypes(clean(flatMapper), getType(), Utils.getCallLocationName(), true); //è°ƒç”¨ transform æ–¹æ³• return transform(\"Flat Map\", outType, new StreamFlatMap&lt;&gt;(clean(flatMapper)));&#125; è¯¥æ–¹æ³•å¹³æ—¶ä½¿ç”¨çš„éå¸¸é¢‘ç¹ï¼Œä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š 123456dataStream.flatMap(new FlatMapFunction&lt;Integer, Integer&gt;() &#123; @Override public void flatMap(Integer value, Collector&lt;Integer&gt; out) throws Exception &#123; out.collect(value); &#125;&#125;) processåœ¨è¾“å…¥æµä¸Šåº”ç”¨ç»™å®šçš„ ProcessFunctionï¼Œä»è€Œåˆ›å»ºè½¬æ¢åçš„è¾“å‡ºæµï¼Œé€šè¿‡è¯¥æ–¹æ³•è¿”å›çš„æ˜¯ SingleOutputStreamOperatorï¼Œå…·ä½“ä»£ç å®ç°å¦‚ä¸‹ï¼š 1234567891011121314151617public &lt;R&gt; SingleOutputStreamOperator&lt;R&gt; process(ProcessFunction&lt;T, R&gt; processFunction) &#123; TypeInformation&lt;R&gt; outType = TypeExtractor.getUnaryOperatorReturnType( processFunction, ProcessFunction.class, 0, 1, TypeExtractor.NO_INDEX, getType(), Utils.getCallLocationName(), true); //è°ƒç”¨ä¸‹é¢çš„ process æ–¹æ³• return process(processFunction, outType);&#125;public &lt;R&gt; SingleOutputStreamOperator&lt;R&gt; process( ProcessFunction&lt;T, R&gt; processFunction, TypeInformation&lt;R&gt; outputType) &#123; ProcessOperator&lt;T, R&gt; operator = new ProcessOperator&lt;&gt;(clean(processFunction)); //è°ƒç”¨ transform æ–¹æ³• return transform(\"Process\", outputType, operator);&#125; ä½¿ç”¨æ–¹æ³•ï¼š 1234567891011121314151617181920DataStreamSource&lt;Long&gt; data = env.generateSequence(0, 0);//å®šä¹‰çš„ ProcessFunctionProcessFunction&lt;Long, Integer&gt; processFunction = new ProcessFunction&lt;Long, Integer&gt;() &#123; private static final long serialVersionUID = 1L; @Override public void processElement(Long value, Context ctx, Collector&lt;Integer&gt; out) throws Exception &#123; //å…·ä½“é€»è¾‘ &#125; @Override public void onTimer(long timestamp, OnTimerContext ctx, Collector&lt;Integer&gt; out) throws Exception &#123; //å…·ä½“é€»è¾‘ &#125;&#125;;DataStream&lt;Integer&gt; processed = data.keyBy(new IdentityKeySelector&lt;Long&gt;()).process(processFunction); filterfilter ç”¨æ¥è¿‡æ»¤æ•°æ®çš„ï¼Œå®ƒéœ€è¦ä¼ å…¥ä¸€ä¸ª FilterFunctionï¼Œç„¶åè¿”å›çš„æ•°æ®ä¹Ÿæ˜¯ SingleOutputStreamOperatorï¼Œè¯¥æ–¹æ³•çš„å®ç°æ˜¯ï¼š 123public SingleOutputStreamOperator&lt;T&gt; filter(FilterFunction&lt;T&gt; filter) &#123; return transform(\"Filter\", getType(), new StreamFilter&lt;&gt;(clean(filter)));&#125; è¯¥æ–¹æ³•å¹³æ—¶ä½¿ç”¨éå¸¸å¤šï¼š 1234567DataStream&lt;String&gt; filter1 = src .filter(new FilterFunction&lt;String&gt;() &#123; @Override public boolean filter(String value) throws Exception &#123; return \"zhisheng\".equals(value); &#125; &#125;) ä¸Šé¢è¿™äº›æ–¹æ³•æ˜¯å¹³æ—¶å†™ä»£ç æ—¶ç”¨çš„éå¸¸å¤šçš„æ–¹æ³•ï¼Œæˆ‘ä»¬è¿™é‡Œè®²è§£äº†å®ƒä»¬çš„å®ç°åŸç†å’Œä½¿ç”¨æ–¹å¼ï¼Œå½“ç„¶è¿˜æœ‰å…¶ä»–æ–¹æ³•ï¼Œæ¯”å¦‚ assignTimestampsAndWatermarksã€joinã€shuffleã€forwardã€addSinkã€rebalanceã€iterateã€coGroupã€projectã€timeWindowAllã€countWindowAllã€windowAllã€print ç­‰ï¼Œè¿™é‡Œç”±äºç¯‡å¹…çš„é—®é¢˜å°±ä¸ä¸€ä¸€å±•å¼€æ¥è®²äº†ã€‚ 3.4.2 SingleOutputStreamOperator çš„ç”¨æ³•åŠåˆ†æSingleOutputStreamOperator è¿™ä¸ªç±»ç»§æ‰¿è‡ª DataStreamï¼Œæ‰€ä»¥ DataStream ä¸­æœ‰çš„æ–¹æ³•åœ¨è¿™é‡Œä¹Ÿéƒ½æœ‰ï¼Œé‚£ä¹ˆè¿™é‡Œå°±è®²è§£ä¸‹é¢å¤–çš„æ–¹æ³•çš„ä½œç”¨ï¼Œå¦‚ä¸‹ã€‚ name()ï¼šè¯¥æ–¹æ³•å¯ä»¥è®¾ç½®å½“å‰æ•°æ®æµçš„åç§°ï¼Œå¦‚æœè®¾ç½®äº†è¯¥å€¼ï¼Œåˆ™å¯ä»¥åœ¨ Flink UI ä¸Šçœ‹åˆ°è¯¥å€¼ï¼›uid() æ–¹æ³•å¯ä»¥ä¸ºç®—å­è®¾ç½®ä¸€ä¸ªæŒ‡å®šçš„ IDï¼Œè¯¥ ID æœ‰ä¸ªä½œç”¨å°±æ˜¯å¦‚æœæƒ³ä» savepoint æ¢å¤ Job æ—¶æ˜¯å¯ä»¥æ ¹æ®è¿™ä¸ªç®—å­çš„ ID æ¥æ¢å¤åˆ°å®ƒä¹‹å‰çš„è¿è¡ŒçŠ¶æ€ï¼› setParallelism() ï¼šè¯¥æ–¹æ³•æ˜¯ä¸ºæ¯ä¸ªç®—å­å•ç‹¬è®¾ç½®å¹¶è¡Œåº¦çš„ï¼Œè¿™ä¸ªè®¾ç½®ä¼˜å…ˆäºä½ é€šè¿‡ env è®¾ç½®çš„å…¨å±€å¹¶è¡Œåº¦ï¼› setMaxParallelism() ï¼šè¯¥ä¸ºç®—å­è®¾ç½®æœ€å¤§çš„å¹¶è¡Œåº¦ï¼› setResources()ï¼šè¯¥æ–¹æ³•æœ‰ä¸¤ä¸ªï¼ˆå‚æ•°ä¸åŒï¼‰ï¼Œè®¾ç½®ç®—å­çš„èµ„æºï¼Œä½†æ˜¯è¿™ä¸¤ä¸ªæ–¹æ³•å¯¹å¤–è¿˜æ²¡å¼€æ”¾ï¼ˆæ˜¯ç§æœ‰çš„ï¼Œæš‚æ—¶åŠŸèƒ½æ€§è¿˜ä¸å…¨ï¼‰ï¼› forceNonParallel()ï¼šè¯¥æ–¹æ³•å¼ºè¡Œå°†å¹¶è¡Œåº¦å’Œæœ€å¤§å¹¶è¡Œåº¦éƒ½è®¾ç½®ä¸º 1ï¼› setChainingStrategy()ï¼šè¯¥æ–¹æ³•å¯¹ç»™å®šçš„ç®—å­è®¾ç½® ChainingStrategyï¼› disableChaining()ï¼šè¯¥è¿™ä¸ªæ–¹æ³•è®¾ç½®åå°†ç¦æ­¢è¯¥ç®—å­ä¸å…¶ä»–çš„ç®—å­ chain åœ¨ä¸€èµ·ï¼› getSideOutput()ï¼šè¯¥æ–¹æ³•é€šè¿‡ç»™å®šçš„ OutputTag å‚æ•°ä» side output ä¸­æ¥ç­›é€‰å‡ºå¯¹åº”çš„æ•°æ®æµã€‚ 3.4.3 KeyedStream çš„ç”¨æ³•åŠåˆ†æKeyedStream æ˜¯ DataStream åœ¨æ ¹æ® KeySelector åˆ†åŒºåçš„æ•°æ®æµï¼ŒDataStream ä¸­å¸¸ç”¨çš„æ–¹æ³•åœ¨ KeyedStream åä¹Ÿå¯ä»¥ç”¨ï¼ˆé™¤äº† shuffleã€forward å’Œ keyBy ç­‰åˆ†åŒºæ–¹æ³•ï¼‰ï¼Œåœ¨è¯¥ç±»ä¸­çš„å±æ€§åˆ†åˆ«æ˜¯ KeySelector å’Œ TypeInformationã€‚ DataStream ä¸­çš„çª—å£æ–¹æ³•åªæœ‰ timeWindowAllã€countWindowAll å’Œ windowAll è¿™ä¸‰ç§å…¨å±€çª—å£æ–¹æ³•ï¼Œä½†æ˜¯åœ¨ KeyedStream ç±»ä¸­çš„ç§ç±»å°±ç¨å¾®å¤šäº†äº›ï¼Œæ–°å¢äº† timeWindowã€countWindow æ–¹æ³•ï¼Œå¹¶ä¸”æ˜¯è¿˜æ”¯æŒæ»‘åŠ¨çª—å£ã€‚ é™¤äº†çª—å£æ–¹æ³•çš„æ–°å¢å¤–ï¼Œè¿˜æ”¯æŒå¤§é‡çš„èšåˆæ“ä½œæ–¹æ³•ï¼Œæ¯”å¦‚ reduceã€foldã€sumã€minã€maxã€minByã€maxByã€aggregate ç­‰æ–¹æ³•ï¼ˆåˆ—ä¸¾çš„è¿™å‡ ä¸ªæ–¹æ³•éƒ½æ”¯æŒå¤šç§å‚æ•°çš„ï¼‰ã€‚ æœ€åå°±æ˜¯å®ƒè¿˜æœ‰ asQueryableState() æ–¹æ³•ï¼Œèƒ½å¤Ÿå°† KeyedStream å‘å¸ƒä¸ºå¯æŸ¥è¯¢çš„ ValueState å®ä¾‹ã€‚ 3.4.4 SplitStream çš„ç”¨æ³•åŠåˆ†æSplitStream è¿™ä¸ªç±»æ¯”è¾ƒç®€å•ï¼Œå®ƒä»£è¡¨ç€æ•°æ®åˆ†æµåçš„æ•°æ®æµäº†ï¼Œå®ƒæœ‰ä¸€ä¸ª select æ–¹æ³•å¯ä»¥é€‰æ‹©åˆ†æµåçš„å“ªç§æ•°æ®æµäº†ï¼Œé€šå¸¸å®ƒæ˜¯ç»“åˆ split ä½¿ç”¨çš„ï¼Œå¯¹äºå•æ¬¡åˆ†æµæ¥è¯´è¿˜æŒºæ–¹ä¾¿çš„ã€‚ä½†æ˜¯å®ƒæ˜¯ä¸€ä¸ªè¢«åºŸå¼ƒçš„ç±»ï¼ˆFlink 1.7 åè¢«åºŸå¼ƒçš„ï¼Œå¯ä»¥çœ‹ä¸‹ç¬”è€…ä¹‹å‰å†™çš„ä¸€ç¯‡æ–‡ç«  Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ ï¼‰ï¼Œå…¶å®å¯ä»¥ç”¨ side output æ¥ä»£æ›¿è¿™ç§ splitï¼Œåé¢æ–‡ç« ä¸­æˆ‘ä»¬ä¹Ÿä¼šè®²é€šè¿‡ç®€å•çš„æ¡ˆä¾‹æ¥è®²è§£ä¸€ä¸‹è¯¥å¦‚ä½•ä½¿ç”¨ side output åšæ•°æ®åˆ†æµæ“ä½œã€‚ å› ä¸ºè¿™ä¸ªç±»çš„æºç æ¯”è¾ƒå°‘ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸‹è¿™ä¸ªç±»çš„å®ç°ï¼š 12345678910111213141516171819202122232425public class SplitStream&lt;OUT&gt; extends DataStream&lt;OUT&gt; &#123; //æ„é€ æ–¹æ³• protected SplitStream(DataStream&lt;OUT&gt; dataStream, OutputSelector&lt;OUT&gt; outputSelector) &#123; super(dataStream.getExecutionEnvironment(), new SplitTransformation&lt;OUT&gt;(dataStream.getTransformation(), outputSelector)); &#125; //é€‰æ‹©è¦è¾“å‡ºå“ªç§æ•°æ®æµ public DataStream&lt;OUT&gt; select(String... outputNames) &#123; return selectOutput(outputNames); &#125; //ä¸Šé¢é‚£ä¸ª public æ–¹æ³•å†…éƒ¨è°ƒç”¨çš„å°±æ˜¯è¿™ä¸ªæ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ˜¯ä¸ª private æ–¹æ³•ï¼Œå¯¹å¤–éšè—äº†å®ƒæ˜¯å¦‚ä½•å»æ‰¾åˆ°ç‰¹å®šçš„æ•°æ®æµã€‚ private DataStream&lt;OUT&gt; selectOutput(String[] outputNames) &#123; for (String outName : outputNames) &#123; if (outName == null) &#123; throw new RuntimeException(\"Selected names must not be null\"); &#125; &#125; //æ„é€ äº†ä¸€ä¸ª SelectTransformation å¯¹è±¡ SelectTransformation&lt;OUT&gt; selectTransform = new SelectTransformation&lt;OUT&gt;(this.getTransformation(), Lists.newArrayList(outputNames)); //æ„é€ äº†ä¸€ä¸ª DataStream å¯¹è±¡ return new DataStream&lt;OUT&gt;(this.getExecutionEnvironment(), selectTransform); &#125;&#125; 3.4.5 WindowedStream çš„ç”¨æ³•åŠåˆ†æè™½ç„¶ WindowedStream ä¸æ˜¯ç»§æ‰¿è‡ª DataStreamï¼Œå¹¶ä¸”æˆ‘ä»¬åœ¨ 3.1 èŠ‚ä¸­ä¹Ÿåšäº†ä¸€å®šçš„è®²è§£ï¼Œä½†æ˜¯å½“æ—¶æ²¡è®²é‡Œé¢çš„ Functionï¼Œæ‰€ä»¥åœ¨è¿™é‡Œåˆšå¥½ä¸€èµ·åšä¸€ä¸ªè¡¥å……ã€‚ åœ¨ WindowedStream ç±»ä¸­å®šä¹‰çš„å±æ€§æœ‰ KeyedStreamã€WindowAssignerã€Triggerã€Evictorã€allowedLateness å’Œ lateDataOutputTagã€‚ KeyedStreamï¼šä»£è¡¨ç€æ•°æ®æµï¼Œæ•°æ®åˆ†ç»„åå†å¼€ Window WindowAssignerï¼šWindow çš„ç»„ä»¶ä¹‹ä¸€ Triggerï¼šWindow çš„ç»„ä»¶ä¹‹ä¸€ Evictorï¼šWindow çš„ç»„ä»¶ä¹‹ä¸€ï¼ˆå¯é€‰ï¼‰ allowedLatenessï¼šç”¨æˆ·æŒ‡å®šçš„å…è®¸è¿Ÿåˆ°æ—¶é—´é•¿ lateDataOutputTagï¼šæ•°æ®å»¶è¿Ÿåˆ°è¾¾çš„ Side outputï¼Œå¦‚æœå»¶è¿Ÿæ•°æ®æ²¡æœ‰è®¾ç½®ä»»ä½•æ ‡è®°ï¼Œåˆ™ä¼šè¢«ä¸¢å¼ƒ åœ¨ 3.1 èŠ‚ä¸­æˆ‘ä»¬è®²äº†ä¸Šé¢çš„ä¸‰ä¸ªçª—å£ç»„ä»¶ WindowAssignerã€Triggerã€Evictorï¼Œå¹¶æ•™å¤§å®¶è¯¥å¦‚ä½•ä½¿ç”¨ï¼Œé‚£ä¹ˆåœ¨è¿™ç¯‡æ–‡ç« æˆ‘å°±ä¸å†é‡å¤ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±æ¥åˆ†æä¸‹å…¶ä»–å‡ ä¸ªçš„ä½¿ç”¨æ–¹å¼å’Œå…¶å®ç°åŸç†ã€‚ å…ˆæ¥çœ‹ä¸‹ allowedLateness è¿™ä¸ªå®ƒå¯ä»¥åœ¨çª—å£åæŒ‡å®šå…è®¸è¿Ÿåˆ°çš„æ—¶é—´é•¿ï¼Œä½¿ç”¨å¦‚ä¸‹ï¼š 123dataStream.keyBy(0) .timeWindow(Time.milliseconds(20)) .allowedLateness(Time.milliseconds(2)) lateDataOutputTag è¿™ä¸ªå®ƒå°†å»¶è¿Ÿåˆ°è¾¾çš„æ•°æ®å‘é€åˆ°ç”±ç»™å®š OutputTag æ ‡è¯†çš„ side outputï¼ˆä¾§è¾“å‡ºï¼‰ï¼Œå½“æ°´å°ç»è¿‡çª—å£æœ«å°¾ï¼ˆå¹¶åŠ ä¸Šäº†å…è®¸çš„å»¶è¿Ÿåï¼‰ï¼Œæ•°æ®å°±è¢«è®¤ä¸ºæ˜¯å»¶è¿Ÿäº†ã€‚ å¯¹äº keyed windows æœ‰äº”ä¸ªä¸åŒå‚æ•°çš„ reduce æ–¹æ³•å¯ä»¥ä½¿ç”¨ï¼Œå¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829//1ã€å‚æ•°ä¸º ReduceFunctionpublic SingleOutputStreamOperator&lt;T&gt; reduce(ReduceFunction&lt;T&gt; function) &#123; ... return reduce(function, new PassThroughWindowFunction&lt;K, W, T&gt;());&#125;//2ã€å‚æ•°ä¸º ReduceFunction å’Œ WindowFunctionpublic &lt;R&gt; SingleOutputStreamOperator&lt;R&gt; reduce(ReduceFunction&lt;T&gt; reduceFunction, WindowFunction&lt;T, R, K, W&gt; function) &#123; ... return reduce(reduceFunction, function, resultType);&#125;//3ã€å‚æ•°ä¸º ReduceFunctionã€WindowFunction å’Œ TypeInformationpublic &lt;R&gt; SingleOutputStreamOperator&lt;R&gt; reduce(ReduceFunction&lt;T&gt; reduceFunction, WindowFunction&lt;T, R, K, W&gt; function, TypeInformation&lt;R&gt; resultType) &#123; ... return input.transform(opName, resultType, operator);&#125;//4ã€å‚æ•°ä¸º ReduceFunction å’Œ ProcessWindowFunctionpublic &lt;R&gt; SingleOutputStreamOperator&lt;R&gt; reduce(ReduceFunction&lt;T&gt; reduceFunction, ProcessWindowFunction&lt;T, R, K, W&gt; function) &#123; ... return reduce(reduceFunction, function, resultType);&#125;//5ã€å‚æ•°ä¸º ReduceFunctionã€ProcessWindowFunction å’Œ TypeInformationpublic &lt;R&gt; SingleOutputStreamOperator&lt;R&gt; reduce(ReduceFunction&lt;T&gt; reduceFunction, ProcessWindowFunction&lt;T, R, K, W&gt; function, TypeInformation&lt;R&gt; resultType) &#123; ... return input.transform(opName, resultType, operator);&#125; é™¤äº† reduce æ–¹æ³•ï¼Œè¿˜æœ‰å…­ä¸ªä¸åŒå‚æ•°çš„ fold æ–¹æ³•ã€aggregate æ–¹æ³•ï¼›ä¸¤ä¸ªä¸åŒå‚æ•°çš„ apply æ–¹æ³•ã€process æ–¹æ³•ï¼ˆå…¶ä¸­ä½ ä¼šå‘ç°è¿™ä¸¤ä¸ª apply æ–¹æ³•å’Œ process æ–¹æ³•å†…éƒ¨å…¶å®éƒ½éšå¼çš„è°ƒç”¨äº†ä¸€ä¸ªç§æœ‰çš„ apply æ–¹æ³•ï¼‰ï¼›å…¶å®é™¤äº†å‰é¢è¯´çš„ä¸¤ä¸ªä¸åŒå‚æ•°çš„ apply æ–¹æ³•å¤–ï¼Œè¿˜æœ‰å››ä¸ªå…¶ä»–çš„ apply æ–¹æ³•ï¼Œè¿™å››ä¸ªæ–¹æ³•ä¹Ÿæ˜¯å‚æ•°ä¸åŒï¼Œä½†æ˜¯å…¶å®æœ€ç»ˆçš„æ˜¯åˆ©ç”¨äº† transform æ–¹æ³•ï¼›è¿˜æœ‰çš„å°±æ˜¯ä¸€äº›é¢„å®šä¹‰çš„èšåˆæ–¹æ³•æ¯”å¦‚ sumã€minã€minByã€maxã€maxByï¼Œå®ƒä»¬çš„æ–¹æ³•å‚æ•°çš„ä¸ªæ•°ä¸ä¸€è‡´ï¼Œè¿™äº›é¢„èšåˆçš„æ–¹æ³•å†…éƒ¨è°ƒç”¨çš„å…¶å®éƒ½æ˜¯ç§æœ‰çš„ aggregate æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å…è®¸ä½ ä¼ å…¥ä¸€ä¸ª AggregationFunction å‚æ•°ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå…·ä½“çš„å®ç°ï¼š 123456789101112131415161718//maxpublic SingleOutputStreamOperator&lt;T&gt; max(String field) &#123; //å†…éƒ¨è°ƒç”¨ç§æœ‰çš„çš„ aggregate æ–¹æ³• return aggregate(new ComparableAggregator&lt;&gt;(field, input.getType(), AggregationFunction.AggregationType.MAX, false, input.getExecutionConfig()));&#125;//ç§æœ‰çš„ aggregate æ–¹æ³•private SingleOutputStreamOperator&lt;T&gt; aggregate(AggregationFunction&lt;T&gt; aggregator) &#123; //ç»§ç»­è°ƒç”¨çš„æ˜¯ reduce æ–¹æ³• return reduce(aggregator);&#125;//è¯¥ reduce æ–¹æ³•å†…éƒ¨å…¶å®åˆæ˜¯è°ƒç”¨äº†å…¶ä»–å¤šä¸ªå‚æ•°çš„ reduce æ–¹æ³•public SingleOutputStreamOperator&lt;T&gt; reduce(ReduceFunction&lt;T&gt; function) &#123; ... function = input.getExecutionEnvironment().clean(function); return reduce(function, new PassThroughWindowFunction&lt;K, W, T&gt;());&#125; ä»ä¸Šé¢çš„æ–¹æ³•è°ƒç”¨è¿‡ç¨‹ï¼Œä½ ä¼šå‘ç°ä»£ç å°è£…çš„å¾ˆæ·±ï¼Œå¾—éœ€è¦ä½ è‡ªå·±å¥½å¥½è·Ÿä¸€ä¸‹æºç æ‰å¯ä»¥äº†è§£æ›´æ·±äº›ã€‚ ä¸Šé¢è®²äº†è¿™ä¹ˆå¤šæ–¹æ³•ï¼Œä½ ä¼šå‘ç° reduce æ–¹æ³•å…¶å®æ˜¯ç”¨çš„è›®å¤šçš„ä¹‹ä¸€ï¼Œé‚£ä¹ˆå°±æ¥çœ‹çœ‹è¯¥å¦‚ä½•ä½¿ç”¨ï¼š 123456789dataStream.keyBy(0) .window(TumblingEventTimeWindows.of(Time.seconds(5))) .reduce(new ReduceFunction&lt;Tuple2&lt;String, Integer&gt;&gt;() &#123; @Override public Tuple2&lt;String, Integer&gt; reduce(Tuple2&lt;String, Integer&gt; value1, Tuple2&lt;String, Integer&gt; value2) &#123; return value1; &#125; &#125;) .print(); 3.4.6 AllWindowedStream çš„ç”¨æ³•åŠåˆ†æå‰é¢è®²å®Œäº† WindowedStreamï¼Œå†æ¥çœ‹çœ‹è¿™ä¸ª AllWindowedStream ä½ ä¼šå‘ç°å®ƒçš„å®ç°å…¶å®æ— å¤ªå¤§åŒºåˆ«ï¼Œè¯¥ç±»ä¸­çš„å±æ€§å’Œæ–¹æ³•éƒ½å’Œå‰é¢ WindowedStream æ˜¯ä¸€æ ·çš„ï¼Œç„¶åæˆ‘ä»¬å°±ä¸å†åšè¿‡å¤šçš„ä»‹ç»ï¼Œç›´æ¥æ¥çœ‹çœ‹è¯¥å¦‚ä½•ä½¿ç”¨å‘¢ï¼Ÿ AllWindowedStream è¿™ç§åœºæ™¯ä¸‹æ˜¯ä¸éœ€è¦è®©æ•°æ®æµåš keyBy åˆ†ç»„æ“ä½œï¼Œç›´æ¥å°±è¿›è¡Œ windowAll æ“ä½œï¼Œç„¶ååœ¨ windowAll æ–¹æ³•ä¸­ä¼ å…¥ WindowAssigner å‚æ•°å¯¹è±¡å³å¯ï¼Œç„¶åè¿”å›çš„æ•°æ®ç»“æœå°±æ˜¯ AllWindowedStream äº†ï¼Œä¸‹é¢ä½¿ç”¨æ–¹å¼ç»§ç»­æ‰§è¡Œäº† AllWindowedStream ä¸­çš„ reduce æ–¹æ³•æ¥è¿”å›æ•°æ®ï¼š 12345678910dataStream.windowAll(SlidingEventTimeWindows.of(Time.of(1, TimeUnit.SECONDS), Time.of(100, TimeUnit.MILLISECONDS))) .reduce(new RichReduceFunction&lt;Tuple2&lt;String, Integer&gt;&gt;() &#123; private static final long serialVersionUID = -6448847205314995812L; @Override public Tuple2&lt;String, Integer&gt; reduce(Tuple2&lt;String, Integer&gt; value1, Tuple2&lt;String, Integer&gt; value2) throws Exception &#123; return value1; &#125; &#125;); 3.4.7 ConnectedStreams çš„ç”¨æ³•åŠåˆ†æConnectedStreams è¿™ä¸ªç±»å®šä¹‰æ˜¯è¡¨ç¤ºï¼ˆå¯èƒ½ï¼‰ä¸¤ä¸ªä¸åŒæ•°æ®ç±»å‹çš„æ•°æ®è¿æ¥æµï¼Œè¯¥åœºæ™¯å¦‚æœå¯¹ä¸€ä¸ªæ•°æ®æµè¿›è¡Œæ“ä½œä¼šç›´æ¥å½±å“å¦ä¸€ä¸ªæ•°æ®æµï¼Œå› æ­¤å¯ä»¥é€šè¿‡æµè¿æ¥æ¥å…±äº«çŠ¶æ€ã€‚æ¯”è¾ƒå¸¸è§çš„ä¸€ä¸ªä¾‹å­å°±æ˜¯ä¸€ä¸ªæ•°æ®æµï¼ˆéšæ—¶é—´å˜åŒ–çš„è§„åˆ™æ•°æ®æµï¼‰é€šè¿‡è¿æ¥å…¶ä»–çš„æ•°æ®æµï¼Œè¿™æ ·å¦ä¸€ä¸ªæ•°æ®æµå°±å¯ä»¥åˆ©ç”¨è¿™äº›è¿æ¥çš„è§„åˆ™æ•°æ®æµã€‚ ConnectedStreams åœ¨æ¦‚å¿µä¸Šå¯ä»¥è®¤ä¸ºå’Œ Union æ•°æ®æµæ˜¯ä¸€æ ·çš„ã€‚ åœ¨ ConnectedStreams ç±»ä¸­æœ‰ä¸‰ä¸ªå±æ€§ï¼šenvironmentã€inputStream1 å’Œ inputStream2ï¼Œè¯¥ç±»ä¸­çš„æ–¹æ³•å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š åœ¨ ConnectedStreams ä¸­å¯ä»¥é€šè¿‡ getFirstInput è·å–è¿æ¥çš„ç¬¬ä¸€ä¸ªæµã€é€šè¿‡ getSecondInput è·å–è¿æ¥çš„ç¬¬äºŒä¸ªæµï¼ŒåŒæ—¶å®ƒè¿˜å«æœ‰å…­ä¸ª keyBy æ–¹æ³•æ¥å°†è¿æ¥åçš„æ•°æ®æµè¿›è¡Œåˆ†ç»„ï¼Œè¿™å…­ä¸ª keyBy æ–¹æ³•çš„å‚æ•°å„æœ‰ä¸åŒã€‚å¦å¤–å®ƒè¿˜å«æœ‰ mapã€flatMapã€process æ–¹æ³•æ¥å¤„ç†æ•°æ®ï¼ˆå…¶ä¸­ map å’Œ flatMap æ–¹æ³•çš„å‚æ•°åˆ†åˆ«ä½¿ç”¨çš„æ˜¯ CoMapFunction å’Œ CoFlatMapFunctionï¼‰ï¼Œå…¶å®å¦‚æœä½ ç»†çœ‹å…¶æ–¹æ³•é‡Œé¢çš„å®ç°å°±ä¼šå‘ç°éƒ½æ˜¯è°ƒç”¨çš„ transform æ–¹æ³•ã€‚ ä¸Šé¢è®²å®Œäº† ConnectedStreams ç±»çš„åŸºç¡€å®šä¹‰ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹ä¸‹è¯¥ç±»å¦‚ä½•ä½¿ç”¨å‘¢ï¼Ÿ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556DataStream&lt;Tuple2&lt;Long, Long&gt;&gt; src1 = env.fromElements(new Tuple2&lt;&gt;(0L, 0L)); //æµ 1DataStream&lt;Tuple2&lt;Long, Long&gt;&gt; src2 = env.fromElements(new Tuple2&lt;&gt;(0L, 0L)); //æµ 2ConnectedStreams&lt;Tuple2&lt;Long, Long&gt;, Tuple2&lt;Long, Long&gt;&gt; connected = src1.connect(src2); //è¿æ¥æµ 1 å’Œæµ 2//ä½¿ç”¨è¿æ¥æµçš„å…­ç§ keyBy æ–¹æ³•ConnectedStreams&lt;Tuple2&lt;Long, Long&gt;, Tuple2&lt;Long, Long&gt;&gt; connectedGroup1 = connected.keyBy(0, 0);ConnectedStreams&lt;Tuple2&lt;Long, Long&gt;, Tuple2&lt;Long, Long&gt;&gt; connectedGroup2 = connected.keyBy(new int[]&#123;0&#125;, new int[]&#123;0&#125;);ConnectedStreams&lt;Tuple2&lt;Long, Long&gt;, Tuple2&lt;Long, Long&gt;&gt; connectedGroup3 = connected.keyBy(\"f0\", \"f0\");ConnectedStreams&lt;Tuple2&lt;Long, Long&gt;, Tuple2&lt;Long, Long&gt;&gt; connectedGroup4 = connected.keyBy(new String[]&#123;\"f0\"&#125;, new String[]&#123;\"f0\"&#125;);ConnectedStreams&lt;Tuple2&lt;Long, Long&gt;, Tuple2&lt;Long, Long&gt;&gt; connectedGroup5 = connected.keyBy(new FirstSelector(), new FirstSelector());ConnectedStreams&lt;Tuple2&lt;Long, Long&gt;, Tuple2&lt;Long, Long&gt;&gt; connectedGroup5 = connected.keyBy(new FirstSelector(), new FirstSelector(), Types.STRING);//ä½¿ç”¨è¿æ¥æµçš„ map æ–¹æ³•connected.map(new CoMapFunction&lt;Tuple2&lt;Long, Long&gt;, Tuple2&lt;Long, Long&gt;, Object&gt;() &#123; private static final long serialVersionUID = 1L; @Override public Object map1(Tuple2&lt;Long, Long&gt; value) &#123; return null; &#125; @Override public Object map2(Tuple2&lt;Long, Long&gt; value) &#123; return null; &#125;&#125;);//ä½¿ç”¨è¿æ¥æµçš„ flatMap æ–¹æ³•connected.flatMap(new CoFlatMapFunction&lt;Tuple2&lt;Long, Long&gt;, Tuple2&lt;Long, Long&gt;, Tuple2&lt;Long, Long&gt;&gt;() &#123; @Override public void flatMap1(Tuple2&lt;Long, Long&gt; value, Collector&lt;Tuple2&lt;Long, Long&gt;&gt; out) throws Exception &#123;&#125; @Override public void flatMap2(Tuple2&lt;Long, Long&gt; value, Collector&lt;Tuple2&lt;Long, Long&gt;&gt; out) throws Exception &#123;&#125;&#125;).name(\"testCoFlatMap\")//ä½¿ç”¨è¿æ¥æµçš„ process æ–¹æ³•connected.process(new CoProcessFunction&lt;Tuple2&lt;Long, Long&gt;, Tuple2&lt;Long, Long&gt;, Tuple2&lt;Long, Long&gt;&gt;() &#123; @Override public void processElement1(Tuple2&lt;Long, Long&gt; value, Context ctx, Collector&lt;Tuple2&lt;Long, Long&gt;&gt; out) throws Exception &#123; if (value.f0 &lt; 3) &#123; out.collect(value); ctx.output(sideOutputTag, \"sideout1-\" + String.valueOf(value)); &#125; &#125; @Override public void processElement2(Tuple2&lt;Long, Long&gt; value, Context ctx, Collector&lt;Tuple2&lt;Long, Long&gt;&gt; out) throws Exception &#123; if (value.f0 &gt;= 3) &#123; out.collect(value); ctx.output(sideOutputTag, \"sideout2-\" + String.valueOf(value)); &#125; &#125;&#125;); 3.4.8 BroadcastStream çš„ç”¨æ³•åŠåˆ†æ3.4.9 BroadcastConnectedStream çš„ç”¨æ³•åŠåˆ†æ3.4.10 QueryableStateStream çš„ç”¨æ³•åŠåˆ†æ3.4.11 å°ç»“ä¸åæ€åŠ å…¥çŸ¥è¯†æ˜Ÿçƒå¯ä»¥çœ‹åˆ°ä¸Šé¢æ–‡ç« ï¼šhttps://t.zsxq.com/fy3RnMv","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹â€”â€” Flink æ•°æ®è½¬æ¢å¿…é¡»ç†Ÿæ‚‰çš„ç®—å­ï¼ˆOperator)","date":"2021-07-12T16:00:00.000Z","path":"2021/07/13/flink-in-action-3.3/","text":"3.3 å¿…é¡»ç†Ÿæ‚‰çš„æ•°æ®è½¬æ¢ Operator(ç®—å­)åœ¨ Flink åº”ç”¨ç¨‹åºä¸­ï¼Œæ— è®ºä½ çš„åº”ç”¨ç¨‹åºæ˜¯æ‰¹ç¨‹åºï¼Œè¿˜æ˜¯æµç¨‹åºï¼Œéƒ½æ˜¯ä¸Šå›¾è¿™ç§æ¨¡å‹ï¼Œæœ‰æ•°æ®æºï¼ˆsourceï¼‰ï¼Œæœ‰æ•°æ®ä¸‹æ¸¸ï¼ˆsinkï¼‰ï¼Œæˆ‘ä»¬å†™çš„åº”ç”¨ç¨‹åºå¤šæ˜¯å¯¹æ•°æ®æºè¿‡æ¥çš„æ•°æ®åšä¸€ç³»åˆ—æ“ä½œï¼Œæ€»ç»“å¦‚ä¸‹ã€‚ 1ã€Source: æ•°æ®æºï¼ŒFlink åœ¨æµå¤„ç†å’Œæ‰¹å¤„ç†ä¸Šçš„ source å¤§æ¦‚æœ‰ 4 ç±»ï¼šåŸºäºæœ¬åœ°é›†åˆçš„ sourceã€åŸºäºæ–‡ä»¶çš„ sourceã€åŸºäºç½‘ç»œå¥—æ¥å­—çš„ sourceã€è‡ªå®šä¹‰çš„ sourceã€‚è‡ªå®šä¹‰çš„ source å¸¸è§çš„æœ‰ Apache kafkaã€Amazon Kinesis Streamsã€RabbitMQã€Twitter Streaming APIã€Apache NiFi ç­‰ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥å®šä¹‰è‡ªå·±çš„ sourceã€‚ 2ã€Transformation: æ•°æ®è½¬æ¢çš„å„ç§æ“ä½œï¼Œæœ‰ Map / FlatMap / Filter / KeyBy / Reduce / Fold / Aggregations / Window / WindowAll / Union / Window join / Split / Select / Project ç­‰ï¼Œæ“ä½œå¾ˆå¤šï¼Œå¯ä»¥å°†æ•°æ®è½¬æ¢è®¡ç®—æˆä½ æƒ³è¦çš„æ•°æ®ã€‚ 3ã€Sink: æ¥æ”¶å™¨ï¼ŒSink æ˜¯æŒ‡ Flink å°†è½¬æ¢è®¡ç®—åçš„æ•°æ®å‘é€çš„åœ°ç‚¹ ï¼Œä½ å¯èƒ½éœ€è¦å­˜å‚¨ä¸‹æ¥ã€‚Flink å¸¸è§çš„ Sink å¤§æ¦‚æœ‰å¦‚ä¸‹å‡ ç±»ï¼šå†™å…¥æ–‡ä»¶ã€æ‰“å°å‡ºæ¥ã€å†™å…¥ Socket ã€è‡ªå®šä¹‰çš„ Sink ã€‚è‡ªå®šä¹‰çš„ sink å¸¸è§çš„æœ‰ Apache kafkaã€RabbitMQã€MySQLã€ElasticSearchã€Apache Cassandraã€Hadoop FileSystem ç­‰ï¼ŒåŒç†ä½ ä¹Ÿå¯ä»¥å®šä¹‰è‡ªå·±çš„ Sinkã€‚ é‚£ä¹ˆæœ¬æ–‡å°†ç»™å¤§å®¶ä»‹ç»çš„å°±æ˜¯ Flink ä¸­çš„æ‰¹å’Œæµç¨‹åºå¸¸ç”¨çš„ç®—å­ï¼ˆOperatorï¼‰ã€‚ 3.3.1 DataStream Operatoræˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æµç¨‹åºä¸­å¸¸ç”¨çš„ç®—å­ã€‚ MapMap ç®—å­çš„è¾“å…¥æµæ˜¯ DataStreamï¼Œç»è¿‡ Map ç®—å­åè¿”å›çš„æ•°æ®æ ¼å¼æ˜¯ SingleOutputStreamOperator ç±»å‹ï¼Œè·å–ä¸€ä¸ªå…ƒç´ å¹¶ç”Ÿæˆä¸€ä¸ªå…ƒç´ ï¼Œä¸¾ä¸ªä¾‹å­ï¼š 12345678SingleOutputStreamOperator&lt;Employee&gt; map = employeeStream.map(new MapFunction&lt;Employee, Employee&gt;() &#123; @Override public Employee map(Employee employee) throws Exception &#123; employee.salary = employee.salary + 5000; return employee; &#125;&#125;);map.print(); æ–°çš„ä¸€å¹´ç»™æ¯ä¸ªå‘˜å·¥çš„å·¥èµ„åŠ  5000ã€‚ FlatMapFlatMap ç®—å­çš„è¾“å…¥æµæ˜¯ DataStreamï¼Œç»è¿‡ FlatMap ç®—å­åè¿”å›çš„æ•°æ®æ ¼å¼æ˜¯ SingleOutputStreamOperator ç±»å‹ï¼Œè·å–ä¸€ä¸ªå…ƒç´ å¹¶ç”Ÿæˆé›¶ä¸ªã€ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ ï¼Œä¸¾ä¸ªä¾‹å­ï¼š 123456789SingleOutputStreamOperator&lt;Employee&gt; flatMap = employeeStream.flatMap(new FlatMapFunction&lt;Employee, Employee&gt;() &#123; @Override public void flatMap(Employee employee, Collector&lt;Employee&gt; out) throws Exception &#123; if (employee.salary &gt;= 40000) &#123; out.collect(employee); &#125; &#125;&#125;);flatMap.print(); å°†å·¥èµ„å¤§äº 40000 çš„æ‰¾å‡ºæ¥ã€‚ FilterKeyByReduceAggregationsWindowWindowAllUnionWindow JoinSplitSelect3.3.2 DataSet OperatorFirst-n3.3.3 æµè®¡ç®—ä¸æ‰¹è®¡ç®—ç»Ÿä¸€çš„æ€è·¯åŠ å…¥çŸ¥è¯†æ˜Ÿçƒå¯ä»¥çœ‹åˆ°ä¸Šé¢æ–‡ç« ï¼šhttps://t.zsxq.com/iYFMZFA 3.3.4 å°ç»“ä¸åæ€æœ¬èŠ‚ä»‹ç»äº†åœ¨å¼€å‘ Flink ä½œä¸šä¸­æ•°æ®è½¬æ¢å¸¸ä½¿ç”¨çš„ç®—å­ï¼ˆåŒ…å«æµä½œä¸šå’Œæ‰¹ä½œä¸šï¼‰ï¼ŒDataStream API å’Œ DataSet API ä¸­éƒ¨åˆ†ç®—å­åå­—æ˜¯ä¸€è‡´çš„ï¼Œä¹Ÿæœ‰ä¸åŒçš„åœ°æ–¹ï¼Œæœ€åè®²è§£äº†ä¸‹ Flink ç¤¾åŒºåé¢æµæ‰¹ç»Ÿä¸€çš„æ€è·¯ã€‚ ä½ ä»¬å…¬å¸ä½¿ç”¨ Flink æ˜¯æµä½œä¸šå±…å¤šè¿˜æ˜¯æ‰¹ä½œä¸šå±…å¤šï¼Ÿ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹â€”â€” å¦‚ä½•ä½¿ç”¨ Flink Window åŠ Window åŸºæœ¬æ¦‚å¿µä¸å®ç°åŸç†?","date":"2021-07-11T16:00:00.000Z","path":"2021/07/12/flink-in-action-3.2/","text":"3.2 Flink Window åŸºç¡€æ¦‚å¿µä¸å®ç°åŸç†ç›®å‰æœ‰è®¸å¤šæ•°æ®åˆ†æçš„åœºæ™¯ä»æ‰¹å¤„ç†åˆ°æµå¤„ç†çš„æ¼”å˜ï¼Œ è™½ç„¶å¯ä»¥å°†æ‰¹å¤„ç†ä½œä¸ºæµå¤„ç†çš„ç‰¹æ®Šæƒ…å†µæ¥å¤„ç†ï¼Œä½†æ˜¯åˆ†ææ— ç©·é›†çš„æµæ•°æ®é€šå¸¸éœ€è¦æ€ç»´æ–¹å¼çš„è½¬å˜å¹¶ä¸”å…·æœ‰å…¶è‡ªå·±çš„æœ¯è¯­ï¼Œä¾‹å¦‚ï¼Œâ€œwindowingï¼ˆçª—å£åŒ–ï¼‰â€ã€â€œat-least-onceï¼ˆè‡³å°‘ä¸€æ¬¡ï¼‰â€ã€â€œexactly-onceï¼ˆåªæœ‰ä¸€æ¬¡ï¼‰â€ ã€‚ å¯¹äºåˆšåˆšæ¥è§¦æµå¤„ç†çš„äººæ¥è¯´ï¼Œè¿™ç§è½¬å˜å’Œæ–°æœ¯è¯­å¯èƒ½ä¼šéå¸¸æ··ä¹±ã€‚ Apache Flink æ˜¯ä¸€ä¸ªä¸ºç”Ÿäº§ç¯å¢ƒè€Œç”Ÿçš„æµå¤„ç†å™¨ï¼Œå…·æœ‰æ˜“äºä½¿ç”¨çš„ APIï¼Œå¯ä»¥ç”¨äºå®šä¹‰é«˜çº§æµåˆ†æç¨‹åºã€‚Flink çš„ API åœ¨æ•°æ®æµä¸Šå…·æœ‰éå¸¸çµæ´»çš„çª—å£å®šä¹‰ï¼Œä½¿å…¶åœ¨å…¶ä»–å¼€æºæµå¤„ç†æ¡†æ¶ä¸­è„±é¢–è€Œå‡ºã€‚ åœ¨æœ¬èŠ‚å°†è®¨è®ºç”¨äºæµå¤„ç†çš„çª—å£çš„æ¦‚å¿µï¼Œä»‹ç» Flink çš„å†…ç½®çª—å£ï¼Œå¹¶è§£é‡Šå®ƒå¯¹è‡ªå®šä¹‰çª—å£è¯­ä¹‰çš„æ”¯æŒã€‚ 3.2.1 Window ç®€ä»‹ä¸‹é¢æˆ‘ä»¬ç»“åˆä¸€ä¸ªç°å®çš„ä¾‹å­æ¥è¯´æ˜ã€‚ å°±æ‹¿äº¤é€šä¼ æ„Ÿå™¨çš„ç¤ºä¾‹ï¼šç»Ÿè®¡ç»è¿‡æŸçº¢ç»¿ç¯çš„æ±½è½¦æ•°é‡ä¹‹å’Œï¼Ÿ å‡è®¾åœ¨ä¸€ä¸ªçº¢ç»¿ç¯å¤„ï¼Œæˆ‘ä»¬æ¯éš” 15 ç§’ç»Ÿè®¡ä¸€æ¬¡é€šè¿‡æ­¤çº¢ç»¿ç¯çš„æ±½è½¦æ•°é‡ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å¯ä»¥æŠŠæ±½è½¦çš„ç»è¿‡çœ‹æˆä¸€ä¸ªæµï¼Œæ— ç©·çš„æµï¼Œä¸æ–­æœ‰æ±½è½¦ç»è¿‡æ­¤çº¢ç»¿ç¯ï¼Œå› æ­¤æ— æ³•ç»Ÿè®¡æ€»å…±çš„æ±½è½¦æ•°é‡ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥æ¢ä¸€ç§æ€è·¯ï¼Œæ¯éš” 15 ç§’ï¼Œæˆ‘ä»¬éƒ½å°†ä¸ä¸Šä¸€æ¬¡çš„ç»“æœè¿›è¡Œ sum æ“ä½œï¼ˆæ»‘åŠ¨èšåˆï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š è¿™ä¸ªç»“æœä¼¼ä¹è¿˜æ˜¯æ— æ³•å›ç­”æˆ‘ä»¬çš„é—®é¢˜ï¼Œæ ¹æœ¬åŸå› åœ¨äºæµæ˜¯æ— ç•Œçš„ï¼Œæˆ‘ä»¬ä¸èƒ½é™åˆ¶æµï¼Œä½†å¯ä»¥åœ¨æœ‰ä¸€ä¸ªæœ‰ç•Œçš„èŒƒå›´å†…å¤„ç†æ— ç•Œçš„æµæ•°æ®ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æ¢ä¸€ä¸ªé—®é¢˜çš„ææ³•ï¼šæ¯åˆ†é’Ÿç»è¿‡æŸçº¢ç»¿ç¯çš„æ±½è½¦æ•°é‡ä¹‹å’Œï¼Ÿ è¿™ä¸ªé—®é¢˜ï¼Œå°±ç›¸å½“äºä¸€ä¸ªå®šä¹‰äº†ä¸€ä¸ª Windowï¼ˆçª—å£ï¼‰ï¼ŒWindow çš„ç•Œé™æ˜¯ 1 åˆ†é’Ÿï¼Œä¸”æ¯åˆ†é’Ÿå†…çš„æ•°æ®äº’ä¸å¹²æ‰°ï¼Œå› æ­¤ä¹Ÿå¯ä»¥ç§°ä¸ºç¿»æ»šï¼ˆä¸é‡åˆï¼‰çª—å£ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ç¬¬ä¸€åˆ†é’Ÿçš„æ•°é‡ä¸º 18ï¼Œç¬¬äºŒåˆ†é’Ÿæ˜¯ 28ï¼Œç¬¬ä¸‰åˆ†é’Ÿæ˜¯ 24â€¦â€¦è¿™æ ·ï¼Œ1 ä¸ªå°æ—¶å†…ä¼šæœ‰ 60 ä¸ª Windowã€‚ å†è€ƒè™‘ä¸€ç§æƒ…å†µï¼Œæ¯ 30 ç§’ç»Ÿè®¡ä¸€æ¬¡è¿‡å» 1 åˆ†é’Ÿçš„æ±½è½¦æ•°é‡ä¹‹å’Œï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æ­¤æ—¶ï¼ŒWindow å‡ºç°äº†é‡åˆã€‚è¿™æ ·ï¼Œ1 ä¸ªå°æ—¶å†…ä¼šæœ‰ 120 ä¸ª Windowã€‚ 3.2.2 Window æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿé€šå¸¸æ¥è®²ï¼ŒWindow å°±æ˜¯ç”¨æ¥å¯¹ä¸€ä¸ªæ— é™çš„æµè®¾ç½®ä¸€ä¸ªæœ‰é™çš„é›†åˆï¼Œåœ¨æœ‰ç•Œçš„æ•°æ®é›†ä¸Šè¿›è¡Œæ“ä½œçš„ä¸€ç§æœºåˆ¶ã€‚Window åˆå¯ä»¥åˆ†ä¸ºåŸºäºæ—¶é—´ï¼ˆTime-basedï¼‰çš„ Window ä»¥åŠåŸºäºæ•°é‡ï¼ˆCount-basedï¼‰çš„ windowã€‚ 3.2.3 Flink è‡ªå¸¦çš„ WindowFlink åœ¨ KeyedStreamï¼ˆDataStream çš„ç»§æ‰¿ç±»ï¼‰ ä¸­æä¾›äº†ä¸‹é¢å‡ ç§ Windowï¼š ä»¥æ—¶é—´é©±åŠ¨çš„ Time Window ä»¥äº‹ä»¶æ•°é‡é©±åŠ¨çš„ Count Window ä»¥ä¼šè¯é—´éš”é©±åŠ¨çš„ Session Window æä¾›ä¸Šé¢ä¸‰ç§ Window æœºåˆ¶åï¼Œç”±äºæŸäº›ç‰¹æ®Šçš„éœ€è¦ï¼ŒDataStream API ä¹Ÿæä¾›äº†å®šåˆ¶åŒ–çš„ Window æ“ä½œï¼Œä¾›ç”¨æˆ·è‡ªå®šä¹‰ Windowã€‚ ä¸‹é¢å°†å…ˆå›´ç»•ä¸Šé¢è¯´çš„ä¸‰ç§ Window æ¥è¿›è¡Œåˆ†æå¹¶æ•™å¤§å®¶å¦‚ä½•ä½¿ç”¨ï¼Œç„¶åå¯¹å…¶åŸç†åˆ†æï¼Œæœ€ååœ¨è§£æå…¶æºç å®ç°ã€‚ 3.2.4 Time Window çš„ç”¨æ³•åŠæºç åˆ†æ3.2.5 Count Window çš„ç”¨æ³•åŠæºç åˆ†æ3.2.6 Session Window çš„ç”¨æ³•åŠæºç åˆ†æ3.2.7 å¦‚ä½•è‡ªå®šä¹‰ Windowï¼Ÿ3.2.8 Window æºç åˆ†æ3.2.9 Window ç»„ä»¶ä¹‹ WindowAssigner çš„ç”¨æ³•åŠæºç åˆ†æ3.2.10 Window ç»„ä»¶ä¹‹ Trigger çš„ç”¨æ³•åŠæºç åˆ†æ3.2.11 Window ç»„ä»¶ä¹‹ Evictor çš„ç”¨æ³•åŠæºç åˆ†æåŠ å…¥çŸ¥è¯†æ˜Ÿçƒå¯ä»¥çœ‹åˆ°ä¸Šé¢æ–‡ç« ï¼šhttps://t.zsxq.com/qnQRvrf 3.2.12 å°ç»“ä¸åæ€æœ¬èŠ‚ä»ç”Ÿæ´»æ¡ˆä¾‹æ¥åˆ†äº«å…³äº Window æ–¹é¢çš„éœ€æ±‚ï¼Œè¿›è€Œå¼€å§‹ä»‹ç» Window ç›¸å…³çš„çŸ¥è¯†ï¼Œå¹¶æŠŠ Flink ä¸­å¸¸ä½¿ç”¨çš„ä¸‰ç§çª—å£éƒ½ä¸€ä¸€åšäº†ä»‹ç»ï¼Œå¹¶å‘Šè¯‰å¤§å®¶å¦‚ä½•ä½¿ç”¨ï¼Œè¿˜åˆ†æäº†å…¶å®ç°åŸç†ã€‚æœ€åè¿˜å¯¹ Window çš„å†…éƒ¨ç»„ä»¶åšäº†è¯¦ç»†çš„åˆ†æï¼Œä¸ºè‡ªå®šä¹‰ Window æä¾›äº†æ–¹æ³•ã€‚ ä¸çŸ¥é“ä½ çœ‹å®Œæœ¬èŠ‚åå¯¹ Window è¿˜æœ‰ä»€ä¹ˆç–‘é—®å—ï¼Ÿä½ ä»¬æ˜¯æ ¹æ®ä»€ä¹ˆæ¡ä»¶æ¥é€‰æ‹©ä½¿ç”¨å“ªç§ Window çš„ï¼Ÿåœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­æœ‰é‡åˆ°ä»€ä¹ˆé—®é¢˜å—ï¼Ÿ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹â€”â€” Flink ä¸­ Processing Timeã€Event Timeã€Ingestion Time å¯¹æ¯”åŠå…¶ä½¿ç”¨åœºæ™¯åˆ†æ","date":"2021-07-10T16:00:00.000Z","path":"2021/07/11/flink-in-action-3.1/","text":"ç¬¬ä¸‰ç«  â€”â€” Flink ä¸­çš„æµè®¡ç®—å¤„ç†é€šè¿‡ç¬¬äºŒç« çš„å…¥é—¨æ¡ˆä¾‹è®²è§£ï¼Œç›¸ä¿¡ä½ å·²ç»çŸ¥é“äº† Flink ç¨‹åºçš„å¼€å‘è¿‡ç¨‹ï¼Œæœ¬ç« å°†å¸¦ä½ ç†Ÿæ‚‰ Flink ä¸­çš„å„ç§ç‰¹æ€§ï¼Œæ¯”å¦‚å¤šç§æ—¶é—´è¯­ä¹‰ã€ä¸°å¯Œçš„çª—å£æœºåˆ¶ã€æµè®¡ç®—ä¸­å¸¸è§çš„è¿ç®—æ“ä½œç¬¦ã€Watermark æœºåˆ¶ã€ä¸°å¯Œçš„ Connectorsï¼ˆKafkaã€ElasticSearchã€Redisã€HBase ç­‰ï¼‰ çš„ä½¿ç”¨æ–¹å¼ã€‚é™¤äº†ä»‹ç»è¿™äº›çŸ¥è¯†ç‚¹çš„åŸç†ä¹‹å¤–ï¼Œç¬”è€…è¿˜å°†é€šè¿‡æ¡ˆä¾‹æ¥æ•™ä¼šå¤§å®¶å¦‚ä½•å»å®æˆ˜ä½¿ç”¨ï¼Œæœ€åè¿˜ä¼šè®²è§£è¿™äº›åŸç†çš„æºç å®ç°ï¼Œå¸Œæœ›ä½ å¯ä»¥æ›´æ·±åˆ»çš„ç†è§£è¿™äº›ç‰¹æ€§ã€‚ 3.1 Flink å¤šç§æ—¶é—´è¯­ä¹‰å¯¹æ¯” Flink åœ¨æµåº”ç”¨ç¨‹åºä¸­æ”¯æŒä¸åŒçš„ Time æ¦‚å¿µï¼Œå°±æ¯”å¦‚æœ‰ Processing Timeã€Event Time å’Œ Ingestion Timeã€‚ä¸‹é¢æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹è¿™ä¸‰ä¸ª Timeã€‚ 3.1.1 Processing TimeProcessing Time æ˜¯æŒ‡äº‹ä»¶è¢«å¤„ç†æ—¶æœºå™¨çš„ç³»ç»Ÿæ—¶é—´ã€‚ å¦‚æœæˆ‘ä»¬ Flink Job è®¾ç½®çš„æ—¶é—´ç­–ç•¥æ˜¯ Processing Time çš„è¯ï¼Œé‚£ä¹ˆåé¢æ‰€æœ‰åŸºäºæ—¶é—´çš„æ“ä½œï¼ˆå¦‚æ—¶é—´çª—å£ï¼‰éƒ½å°†ä¼šä½¿ç”¨å½“æ—¶æœºå™¨çš„ç³»ç»Ÿæ—¶é—´ã€‚æ¯å°æ—¶ Processing Time çª—å£å°†åŒ…æ‹¬åœ¨ç³»ç»Ÿæ—¶é’ŸæŒ‡ç¤ºæ•´ä¸ªå°æ—¶ä¹‹é—´åˆ°è¾¾ç‰¹å®šæ“ä½œçš„æ‰€æœ‰äº‹ä»¶ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœåº”ç”¨ç¨‹åºåœ¨ä¸Šåˆ 9:15 å¼€å§‹è¿è¡Œï¼Œåˆ™ç¬¬ä¸€ä¸ªæ¯å°æ—¶ Processing Time çª—å£å°†åŒ…æ‹¬åœ¨ä¸Šåˆ 9:15 åˆ°ä¸Šåˆ 10:00 ä¹‹é—´å¤„ç†çš„äº‹ä»¶ï¼Œä¸‹ä¸€ä¸ªçª—å£å°†åŒ…æ‹¬åœ¨ä¸Šåˆ 10:00 åˆ° 11:00 ä¹‹é—´å¤„ç†çš„äº‹ä»¶ã€‚ Processing Time æ˜¯æœ€ç®€å•çš„ â€œTimeâ€ æ¦‚å¿µï¼Œä¸éœ€è¦æµå’Œæœºå™¨ä¹‹é—´çš„åè°ƒï¼Œå®ƒæä¾›äº†æœ€å¥½çš„æ€§èƒ½å’Œæœ€ä½çš„å»¶è¿Ÿã€‚ä½†æ˜¯ï¼Œåœ¨åˆ†å¸ƒå¼å’Œå¼‚æ­¥çš„ç¯å¢ƒä¸‹ï¼ŒProcessing Time ä¸èƒ½æä¾›ç¡®å®šæ€§ï¼Œå› ä¸ºå®ƒå®¹æ˜“å—åˆ°äº‹ä»¶åˆ°è¾¾ç³»ç»Ÿçš„é€Ÿåº¦ï¼ˆä¾‹å¦‚ä»æ¶ˆæ¯é˜Ÿåˆ—ï¼‰ã€äº‹ä»¶åœ¨ç³»ç»Ÿå†…æ“ä½œæµåŠ¨çš„é€Ÿåº¦ä»¥åŠä¸­æ–­çš„å½±å“ã€‚ 3.1.2 Event TimeEvent Time æ˜¯æŒ‡äº‹ä»¶å‘ç”Ÿçš„æ—¶é—´ï¼Œä¸€èˆ¬å°±æ˜¯æ•°æ®æœ¬èº«æºå¸¦çš„æ—¶é—´ã€‚è¿™ä¸ªæ—¶é—´é€šå¸¸æ˜¯åœ¨äº‹ä»¶åˆ°è¾¾ Flink ä¹‹å‰å°±ç¡®å®šçš„ï¼Œå¹¶ä¸”å¯ä»¥ä»æ¯ä¸ªäº‹ä»¶ä¸­è·å–åˆ°äº‹ä»¶æ—¶é—´æˆ³ã€‚åœ¨ Event Time ä¸­ï¼Œæ—¶é—´å–å†³äºæ•°æ®ï¼Œè€Œè·Ÿå…¶ä»–æ²¡ä»€ä¹ˆå…³ç³»ã€‚Event Time ç¨‹åºå¿…é¡»æŒ‡å®šå¦‚ä½•ç”Ÿæˆ Event Time æ°´å°ï¼Œè¿™æ˜¯è¡¨ç¤º Event Time è¿›åº¦çš„æœºåˆ¶ã€‚ å®Œç¾çš„è¯´ï¼Œæ— è®ºäº‹ä»¶ä»€ä¹ˆæ—¶å€™åˆ°è¾¾æˆ–è€…å…¶æ€ä¹ˆæ’åºï¼Œæœ€åå¤„ç† Event Time å°†äº§ç”Ÿå®Œå…¨ä¸€è‡´å’Œç¡®å®šçš„ç»“æœã€‚ä½†æ˜¯ï¼Œé™¤éäº‹ä»¶æŒ‰ç…§å·²çŸ¥é¡ºåºï¼ˆäº‹ä»¶äº§ç”Ÿçš„æ—¶é—´é¡ºåºï¼‰åˆ°è¾¾ï¼Œå¦åˆ™å¤„ç† Event Time æ—¶å°†ä¼šå› ä¸ºè¦ç­‰å¾…ä¸€äº›æ— åºäº‹ä»¶è€Œäº§ç”Ÿä¸€äº›å»¶è¿Ÿã€‚ç”±äºåªèƒ½ç­‰å¾…ä¸€æ®µæœ‰é™çš„æ—¶é—´ï¼Œå› æ­¤å°±éš¾ä»¥ä¿è¯å¤„ç† Event Time å°†äº§ç”Ÿå®Œå…¨ä¸€è‡´å’Œç¡®å®šçš„ç»“æœã€‚ å‡è®¾æ‰€æœ‰æ•°æ®éƒ½å·²åˆ°è¾¾ï¼ŒEvent Time æ“ä½œå°†æŒ‰ç…§é¢„æœŸè¿è¡Œï¼Œå³ä½¿åœ¨å¤„ç†æ— åºäº‹ä»¶ã€å»¶è¿Ÿäº‹ä»¶ã€é‡æ–°å¤„ç†å†å²æ•°æ®æ—¶ä¹Ÿä¼šäº§ç”Ÿæ­£ç¡®ä¸”ä¸€è‡´çš„ç»“æœã€‚ ä¾‹å¦‚ï¼Œæ¯å°æ—¶äº‹ä»¶æ—¶é—´çª—å£å°†åŒ…å«å¸¦æœ‰è½å…¥è¯¥å°æ—¶çš„äº‹ä»¶æ—¶é—´æˆ³çš„æ‰€æœ‰è®°å½•ï¼Œä¸ç®¡å®ƒä»¬åˆ°è¾¾çš„é¡ºåºå¦‚ä½•ï¼ˆæ˜¯å¦æŒ‰ç…§äº‹ä»¶äº§ç”Ÿçš„æ—¶é—´ï¼‰ã€‚ 3.1.3 Ingestion TimeIngestion Time æ˜¯äº‹ä»¶è¿›å…¥ Flink çš„æ—¶é—´ã€‚ åœ¨æ•°æ®æºæ“ä½œå¤„ï¼ˆè¿›å…¥ Flink source æ—¶ï¼‰ï¼Œæ¯ä¸ªäº‹ä»¶å°†è¿›å…¥ Flink æ—¶å½“æ—¶çš„æ—¶é—´ä½œä¸ºæ—¶é—´æˆ³ï¼Œå¹¶ä¸”åŸºäºæ—¶é—´çš„æ“ä½œï¼ˆå¦‚æ—¶é—´çª—å£ï¼‰ä¼šåˆ©ç”¨è¿™ä¸ªæ—¶é—´æˆ³ã€‚ Ingestion Time åœ¨æ¦‚å¿µä¸Šä½äº Event Time å’Œ Processing Time ä¹‹é—´ã€‚ ä¸ Processing Time ç›¸æ¯”ï¼Œæˆæœ¬å¯èƒ½ä¼šé«˜ä¸€ç‚¹ï¼Œä½†ç»“æœæ›´å¯é¢„æµ‹ã€‚å› ä¸º Ingestion Time ä½¿ç”¨ç¨³å®šçš„æ—¶é—´æˆ³ï¼ˆåªåœ¨è¿›å…¥ Flink çš„æ—¶å€™åˆ†é…ä¸€æ¬¡ï¼‰ï¼Œæ‰€ä»¥å¯¹äº‹ä»¶çš„ä¸åŒçª—å£æ“ä½œå°†ä½¿ç”¨ç›¸åŒçš„æ—¶é—´æˆ³ï¼ˆç¬¬ä¸€æ¬¡åˆ†é…çš„æ—¶é—´æˆ³ï¼‰ï¼Œè€Œåœ¨ Processing Time ä¸­ï¼Œæ¯ä¸ªçª—å£æ“ä½œç¬¦å¯ä»¥å°†äº‹ä»¶åˆ†é…ç»™ä¸åŒçš„çª—å£ï¼ˆåŸºäºæœºå™¨ç³»ç»Ÿæ—¶é—´å’Œåˆ°è¾¾å»¶è¿Ÿï¼‰ã€‚ ä¸ Event Time ç›¸æ¯”ï¼ŒIngestion Time ç¨‹åºæ— æ³•å¤„ç†ä»»ä½•æ— åºäº‹ä»¶æˆ–å»¶è¿Ÿæ•°æ®ï¼Œä½†ç¨‹åºä¸­ä¸å¿…æŒ‡å®šå¦‚ä½•ç”Ÿæˆæ°´å°ã€‚ åœ¨ Flink ä¸­ï¼ŒIngestion Time ä¸ Event Time éå¸¸ç›¸ä¼¼ï¼Œå”¯ä¸€åŒºåˆ«å°±æ˜¯ Ingestion Time å…·æœ‰è‡ªåŠ¨åˆ†é…æ—¶é—´æˆ³å’Œè‡ªåŠ¨ç”Ÿæˆæ°´å°åŠŸèƒ½ã€‚ 3.1.4 ä¸‰ç§ Time çš„å¯¹æ¯”ç»“æœ3.1.5 ä½¿ç”¨åœºæ™¯åˆ†æ3.1.6 Time ç­–ç•¥è®¾ç½®3.1.7 å°ç»“ä¸åæ€åŠ å…¥çŸ¥è¯†æ˜Ÿçƒå¯ä»¥çœ‹åˆ°ä¸Šé¢æ–‡ç« ï¼šhttps://t.zsxq.com/znqnMNB","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹â€”â€” æ¡ˆä¾‹2ï¼šå®æ—¶å¤„ç† Socket æ•°æ®","date":"2021-07-09T16:00:00.000Z","path":"2021/07/10/flink-in-action-2.4/","text":"2.4 æ¡ˆä¾‹2ï¼šå®æ—¶å¤„ç† Socket æ•°æ®åœ¨ 2.3 èŠ‚ä¸­è®²è§£äº† Flink æœ€ç®€å•çš„ WordCount ç¨‹åºçš„åˆ›å»ºã€è¿è¡Œç»“æœæŸ¥çœ‹å’Œä»£ç åˆ†æï¼Œæœ¬èŠ‚å°†ç»§ç»­å¸¦å¤§å®¶æ¥çœ‹ä¸€ä¸ªå…¥é—¨ä¸Šæ‰‹çš„ç¨‹åºï¼šFlink å¤„ç† Socket æ•°æ®ã€‚ 2.4.1 ä½¿ç”¨ IDEA åˆ›å»ºé¡¹ç›®ä½¿ç”¨ IDEA åˆ›å»ºæ–°çš„ moduleï¼Œç»“æ„å¦‚ä¸‹ï¼š 123456789101112â”œâ”€â”€ pom.xmlâ””â”€â”€ src â”œâ”€â”€ main â”‚ â”œâ”€â”€ java â”‚ â”‚ â””â”€â”€ com â”‚ â”‚ â””â”€â”€ zhisheng â”‚ â”‚ â””â”€â”€ socket â”‚ â”‚ â””â”€â”€ Main.java â”‚ â””â”€â”€ resources â”‚ â””â”€â”€ log4j.properties â””â”€â”€ test â””â”€â”€ java é¡¹ç›®åˆ›å»ºå¥½äº†åï¼Œæˆ‘ä»¬ä¸‹ä¸€æ­¥å¼€å§‹ç¼–å†™ Flink Socket Job çš„ä»£ç ã€‚ 2.4.2 å®æ—¶å¤„ç† Socket æ•°æ®åº”ç”¨ç¨‹åºä»£ç å®ç°ç¨‹åºä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š 123456789101112131415161718192021222324252627282930313233public class Main &#123; public static void main(String[] args) throws Exception &#123; //å‚æ•°æ£€æŸ¥ if (args.length != 2) &#123; System.err.println(\"USAGE:\\nSocketTextStreamWordCount &lt;hostname&gt; &lt;port&gt;\"); return; &#125; String hostname = args[0]; Integer port = Integer.parseInt(args[1]); final StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment(); //è·å–æ•°æ® DataStreamSource&lt;String&gt; stream = env.socketTextStream(hostname, port); //è®¡æ•° SingleOutputStreamOperator&lt;Tuple2&lt;String, Integer&gt;&gt; sum = stream.flatMap(new LineSplitter()) .keyBy(0) .sum(1); sum.print(); env.execute(\"Java WordCount from SocketText\"); &#125; public static final class LineSplitter implements FlatMapFunction&lt;String, Tuple2&lt;String, Integer&gt;&gt; &#123; @Override public void flatMap(String s, Collector&lt;Tuple2&lt;String, Integer&gt;&gt; collector) &#123; String[] tokens = s.toLowerCase().split(\"\\\\W+\"); for (String token: tokens) &#123; if (token.length() &gt; 0) &#123; collector.collect(new Tuple2&lt;String, Integer&gt;(token, 1)); &#125; &#125; &#125; &#125;&#125; pom.xml æ·»åŠ  buildï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253&lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt; &lt;version&gt;3.1&lt;/version&gt; &lt;configuration&gt; &lt;source&gt;$&#123;java.version&#125;&lt;/source&gt; &lt;target&gt;$&#123;java.version&#125;&lt;/target&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-shade-plugin&lt;/artifactId&gt; &lt;version&gt;3.0.0&lt;/version&gt; &lt;executions&gt; &lt;execution&gt; &lt;phase&gt;package&lt;/phase&gt; &lt;goals&gt; &lt;goal&gt;shade&lt;/goal&gt; &lt;/goals&gt; &lt;configuration&gt; &lt;artifactSet&gt; &lt;excludes&gt; &lt;exclude&gt;org.apache.flink:force-shading&lt;/exclude&gt; &lt;exclude&gt;com.google.code.findbugs:jsr305&lt;/exclude&gt; &lt;exclude&gt;org.slf4j:*&lt;/exclude&gt; &lt;exclude&gt;log4j:*&lt;/exclude&gt; &lt;/excludes&gt; &lt;/artifactSet&gt; &lt;filters&gt; &lt;filter&gt; &lt;artifact&gt;*:*&lt;/artifact&gt; &lt;excludes&gt; &lt;exclude&gt;META-INF/*.SF&lt;/exclude&gt; &lt;exclude&gt;META-INF/*.DSA&lt;/exclude&gt; &lt;exclude&gt;META-INF/*.RSA&lt;/exclude&gt; &lt;/excludes&gt; &lt;/filter&gt; &lt;/filters&gt; &lt;transformers&gt; &lt;transformer implementation=\"org.apache.maven.plugins.shade.resource.ManifestResourceTransformer\"&gt; &lt;!--æ³¨æ„ï¼šè¿™é‡Œä¸€å®šè¦æ¢æˆä½ è‡ªå·±çš„ Job main æ–¹æ³•çš„å¯åŠ¨ç±»--&gt; &lt;mainClass&gt;com.zhisheng.socket.Main&lt;/mainClass&gt; &lt;/transformer&gt; &lt;/transformers&gt; &lt;/configuration&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; &lt;/plugins&gt;&lt;/build&gt; 2.4.3 è¿è¡Œå®æ—¶å¤„ç† Socket æ•°æ®åº”ç”¨ç¨‹åºä¸‹é¢åˆ†åˆ«è®²è§£åœ¨ IDE å’Œ Flink UI ä¸Šè¿è¡Œä½œä¸šã€‚ æœ¬åœ° IDE è¿è¡ŒUI è¿è¡Œ Job2.4.4 å®æ—¶å¤„ç† Socket æ•°æ®åº”ç”¨ç¨‹åºä»£ç åˆ†æåŠ å…¥çŸ¥è¯†æ˜Ÿçƒå¯ä»¥çœ‹åˆ°ä¸Šé¢æ–‡ç« ï¼šhttps://t.zsxq.com/VBEQv3F 2.4.5 Flink ä¸­ä½¿ç”¨ Lambda è¡¨è¾¾å¼å› ä¸º Lambda è¡¨è¾¾å¼çœ‹èµ·æ¥ç®€æ´ï¼Œæ‰€ä»¥æœ‰æ—¶å€™ä¹Ÿæ˜¯å¸Œæœ›åœ¨è¿™äº› Flink ä½œä¸šä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸Šå®ƒï¼Œè™½ç„¶ Flink ä¸­æ˜¯æ”¯æŒ Lambdaï¼Œä½†æ˜¯ä¸ªäººæ„Ÿè§‰ä¸å¤ªå‹å¥½ã€‚æ¯”å¦‚ä¸Šé¢çš„åº”ç”¨ç¨‹åºå¦‚æœå°† LineSplitter è¯¥ç±»ä¹‹é—´ç”¨ Lambda è¡¨è¾¾å¼å®Œæˆçš„è¯åˆ™è¦åƒä¸‹é¢è¿™æ ·å†™ï¼š 12345678910stream.flatMap((s, collector) -&gt; &#123; for (String token : s.toLowerCase().split(\"\\\\W+\")) &#123; if (token.length() &gt; 0) &#123; collector.collect(new Tuple2&lt;String, Integer&gt;(token, 1)); &#125; &#125;&#125;) .keyBy(0) .sum(1) .print(); ä½†æ˜¯è¿™æ ·å†™å®Œåï¼Œè¿è¡Œä½œä¸šæŠ¥é”™å¦‚ä¸‹ï¼š 123456789101112Exception in thread &quot;main&quot; org.apache.flink.api.common.functions.InvalidTypesException: The return type of function &apos;main(LambdaMain.java:34)&apos; could not be determined automatically, due to type erasure. You can give type information hints by using the returns(...) method on the result of the transformation call, or by letting your function implement the &apos;ResultTypeQueryable&apos; interface. at org.apache.flink.api.dag.Transformation.getOutputType(Transformation.java:417) at org.apache.flink.streaming.api.datastream.DataStream.getType(DataStream.java:175) at org.apache.flink.streaming.api.datastream.DataStream.keyBy(DataStream.java:318) at com.zhisheng.examples.streaming.socket.LambdaMain.main(LambdaMain.java:41)Caused by: org.apache.flink.api.common.functions.InvalidTypesException: The generic type parameters of &apos;Collector&apos; are missing. In many cases lambda methods don&apos;t provide enough information for automatic type extraction when Java generics are involved. An easy workaround is to use an (anonymous) class instead that implements the &apos;org.apache.flink.api.common.functions.FlatMapFunction&apos; interface. Otherwise the type has to be specified explicitly using type information. at org.apache.flink.api.java.typeutils.TypeExtractionUtils.validateLambdaType(TypeExtractionUtils.java:350) at org.apache.flink.api.java.typeutils.TypeExtractionUtils.extractTypeFromLambda(TypeExtractionUtils.java:176) at org.apache.flink.api.java.typeutils.TypeExtractor.getUnaryOperatorReturnType(TypeExtractor.java:571) at org.apache.flink.api.java.typeutils.TypeExtractor.getFlatMapReturnTypes(TypeExtractor.java:196) at org.apache.flink.streaming.api.datastream.DataStream.flatMap(DataStream.java:611) at com.zhisheng.examples.streaming.socket.LambdaMain.main(LambdaMain.java:34) æ ¹æ®ä¸Šé¢çš„æŠ¥é”™ä¿¡æ¯å…¶å®å¯ä»¥çŸ¥é“è¦æ€ä¹ˆè§£å†³äº†ï¼Œè¯¥é”™è¯¯æ˜¯å› ä¸º Flink åœ¨ç”¨æˆ·è‡ªå®šä¹‰çš„å‡½æ•°ä¸­ä¼šä½¿ç”¨æ³›å‹æ¥åˆ›å»º serializerï¼Œå½“ä½¿ç”¨åŒ¿åå‡½æ•°æ—¶ï¼Œç±»å‹ä¿¡æ¯ä¼šè¢«ä¿ç•™ã€‚ä½† Lambda è¡¨è¾¾å¼å¹¶ä¸æ˜¯åŒ¿åå‡½æ•°ï¼Œæ‰€ä»¥ javac ç¼–è¯‘çš„æ—¶å€™å¹¶ä¸ä¼šæŠŠæ³›å‹ä¿å­˜åˆ° class æ–‡ä»¶é‡Œã€‚è§£å†³æ–¹æ³•ï¼šä½¿ç”¨ Flink æä¾›çš„ returns æ–¹æ³•æ¥æŒ‡å®š flatMap çš„è¿”å›ç±»å‹ 12//ä½¿ç”¨ TupleTypeInfo æ¥æŒ‡å®š Tuple çš„å‚æ•°ç±»å‹.returns((TypeInformation) TupleTypeInfo.getBasicTupleTypeInfo(String.class, Integer.class)) åœ¨ flatMap åé¢åŠ ä¸Šä¸Šé¢è¿™ä¸ª returns å°±è¡Œäº†ï¼Œä½†æ˜¯å¦‚æœç®—å­å¤šäº†çš„è¯ï¼Œæ¯ä¸ªéƒ½å»åŠ ä¸€ä¸ª returnsï¼Œå…¶å®ä¼šå¾ˆç—›è‹¦çš„ï¼Œæ‰€ä»¥é€šå¸¸ä½¿ç”¨åŒ¿åå‡½æ•°æˆ–è€…è‡ªå®šä¹‰å‡½æ•°å±…å¤šã€‚ 2.4.5 å°ç»“ä¸åæ€åœ¨ç¬¬ä¸€ç« ä¸­ä»‹ç»äº† Flink çš„ç‰¹æ€§ï¼Œæœ¬ç« ä¸»è¦æ˜¯è®©å¤§å®¶èƒ½å¤Ÿå¿«é€Ÿå…¥é—¨ï¼Œæ‰€ä»¥åœ¨ç¬¬ä¸€èŠ‚å’Œç¬¬äºŒèŠ‚ä¸­åˆ†åˆ«è®²è§£äº† Flink çš„ç¯å¢ƒå‡†å¤‡å’Œæ­å»ºï¼Œåœ¨ç¬¬ä¸‰èŠ‚å’Œç¬¬å››èŠ‚ä¸­é€šè¿‡ä¸¤ä¸ªå…¥é—¨çš„åº”ç”¨ç¨‹åºï¼ˆWordCount åº”ç”¨ç¨‹åºå’Œè¯»å– Socket æ•°æ®åº”ç”¨ç¨‹åºï¼‰è®©å¤§å®¶å¯ä»¥å¿«é€Ÿå…¥é—¨ Flinkï¼Œä¸¤ä¸ªç¨‹åºéƒ½æ˜¯éœ€è¦è‡ªå·±åŠ¨æ‰‹å®æ“ï¼Œæ‰€ä»¥æ›´èƒ½åŠ æ·±å¤§å®¶çš„å°è±¡ã€‚","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹â€”â€” æ¡ˆä¾‹1ï¼šWordCount åº”ç”¨ç¨‹åº","date":"2021-07-08T16:00:00.000Z","path":"2021/07/09/flink-in-action-2.3/","text":"2.3 æ¡ˆä¾‹1ï¼šWordCount åº”ç”¨ç¨‹åºåœ¨ 2.2 èŠ‚ä¸­å¸¦å¤§å®¶è®²è§£äº†ä¸‹ Flink çš„ç¯å¢ƒå®‰è£…ï¼Œè¿™ç¯‡æ–‡ç« å°±å¼€å§‹æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ª Flink æ¡ˆä¾‹å®æˆ˜ï¼Œä¹Ÿæ–¹ä¾¿å¤§å®¶å¿«é€Ÿå¼€å§‹è‡ªå·±çš„ç¬¬ä¸€ä¸ª Flink åº”ç”¨ã€‚å¤§æ•°æ®é‡Œå­¦ä¹ ä¸€é—¨æŠ€æœ¯ä¸€èˆ¬éƒ½æ˜¯ä» WordCount å¼€å§‹å…¥é—¨çš„ï¼Œé‚£ä¹ˆç¬”è€…è¿˜æ˜¯ä¸æ‰“ç ´å¸¸è§„äº†ï¼Œæ‰€ä»¥è¿™ç¯‡æ–‡ç« ç¬”è€…ä¹Ÿå°†å¸¦å¤§å®¶é€šè¿‡ WordCount ç¨‹åºæ¥åˆæ­¥äº†è§£ Flinkã€‚ 2.3.1 ä½¿ç”¨ Maven åˆ›å»ºé¡¹ç›®Flink æ”¯æŒ Maven ç›´æ¥æ„å»ºæ¨¡ç‰ˆé¡¹ç›®ï¼Œä½ åœ¨ç»ˆç«¯ä½¿ç”¨è¯¥å‘½ä»¤ï¼š 1234mvn archetype:generate \\ -DarchetypeGroupId=org.apache.flink \\ -DarchetypeArtifactId=flink-quickstart-java \\ -DarchetypeVersion=1.9.0 åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å®ƒä¼šæç¤ºä½ è¾“å…¥ groupIdã€artifactIdã€å’Œ package åï¼Œä½ æŒ‰ç…§è¦æ±‚è¾“å…¥å°±è¡Œï¼Œæœ€åå°±å¯ä»¥æˆåŠŸåˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ è¿›å…¥åˆ°ç›®å½•ä½ å°±å¯ä»¥çœ‹åˆ°å·²ç»åˆ›å»ºäº†é¡¹ç›®ï¼Œé‡Œé¢ç»“æ„å¦‚ä¸‹ï¼š 1234567891011121314 zhisheng@zhisheng ~/IdeaProjects/github/Flink-WordCount tree.â”œâ”€â”€ pom.xmlâ””â”€â”€ src â””â”€â”€ main â”œâ”€â”€ java â”‚ â””â”€â”€ com â”‚ â””â”€â”€ zhisheng â”‚ â”œâ”€â”€ BatchJob.java â”‚ â””â”€â”€ StreamingJob.java â””â”€â”€ resources â””â”€â”€ log4j.properties6 directories, 4 files è¯¥é¡¹ç›®ä¸­åŒ…å«äº†ä¸¤ä¸ªç±» BatchJob å’Œ StreamingJobï¼Œå¦å¤–è¿˜æœ‰ä¸€ä¸ª log4j.properties é…ç½®æ–‡ä»¶ï¼Œç„¶åä½ å°±å¯ä»¥å°†è¯¥é¡¹ç›®å¯¼å…¥åˆ° IDEA äº†ã€‚ä½ å¯ä»¥åœ¨è¯¥ç›®å½•ä¸‹æ‰§è¡Œ mvn clean package å°±å¯ä»¥ç¼–è¯‘è¯¥é¡¹ç›®ï¼Œç¼–è¯‘æˆåŠŸååœ¨ target ç›®å½•ä¸‹ä¼šç”Ÿæˆä¸€ä¸ª Job çš„ Jar åŒ…ï¼Œä½†æ˜¯è¿™ä¸ª Job è¿˜ä¸èƒ½æ‰§è¡Œï¼Œå› ä¸º StreamingJob è¿™ä¸ªç±»ä¸­çš„ main æ–¹æ³•é‡Œé¢åªæ˜¯ç®€å•çš„åˆ›å»ºäº† StreamExecutionEnvironment ç¯å¢ƒï¼Œç„¶åå°±æ‰§è¡Œ execute æ–¹æ³•ï¼Œè¿™åœ¨ Flink ä¸­æ˜¯ä¸ç®—ä¸€ä¸ªå¯æ‰§è¡Œçš„ Job çš„ï¼Œå› æ­¤å¦‚æœä½ æäº¤åˆ° Flink UI ä¸Šä¹Ÿæ˜¯ä¼šæŠ¥é”™çš„ã€‚ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä¸Šä¼ ä½œä¸šç¨‹åºæ‰“åŒ…ç¼–è¯‘çš„ Jar åŒ…ï¼š è¿è¡ŒæŠ¥é”™ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 12Server Response Message:Internal server error. æˆ‘ä»¬æŸ¥çœ‹ Flink JobManager çš„æ—¥å¿—ï¼Œå¯ä»¥çœ‹è§é”™è¯¯ä¿¡æ¯å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 122019-04-26 17:27:33,706 ERROR org.apache.flink.runtime.webmonitor.handlers.JarRunHandler - Unhandled exception.org.apache.flink.client.program.ProgramInvocationException: The main method caused an error: No operators defined in streaming topology. Cannot execute. å› ä¸º execute æ–¹æ³•ä¹‹å‰æˆ‘ä»¬æ˜¯éœ€è¦è¡¥å……æˆ‘ä»¬ Job çš„ä¸€äº›ç®—å­æ“ä½œçš„ï¼Œæ‰€ä»¥æŠ¥é”™è¿˜æ˜¯å¾ˆæ­£å¸¸çš„ï¼Œæœ¬èŠ‚ä¸‹é¢å°†ä¼šæä¾›å®Œæ•´ä»£ç ã€‚ 2.3.2 ä½¿ç”¨ IDEA åˆ›å»ºé¡¹ç›®ä¸€èˆ¬æˆ‘ä»¬é¡¹ç›®å¯èƒ½æ˜¯ç”±å¤šä¸ª Job ç»„æˆï¼Œå¹¶ä¸”ä»£ç ä¹Ÿéƒ½æ˜¯åœ¨åŒä¸€ä¸ªå·¥ç¨‹ä¸‹é¢è¿›è¡Œç®¡ç†ï¼Œä¸Šé¢é‚£ç§åˆ›å»ºæ–¹å¼é€‚åˆå•ä¸ª Job æ‰§è¡Œï¼Œä½†å¦‚æœåœ¨å…¬å¸å¤šäººåˆä½œçš„æ—¶å€™è¿˜æ˜¯å¾—åœ¨åŒä¸€ä¸ªå·¥ç¨‹ä¸‹é¢åˆ›å»ºé¡¹ç›®ï¼Œæ¯ä¸ª Flink Job å¯¹åº”ç€ä¸€ä¸ª moduleï¼Œè¯¥ module è´Ÿè´£ç‹¬ç«‹çš„ä¸šåŠ¡é€»è¾‘ï¼Œæ¯”å¦‚ç¬”è€…åœ¨ GitHub çš„ https://github.com/zhisheng17/flink-learning é¡¹ç›®ï¼Œå®ƒçš„é¡¹ç›®ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦åœ¨çˆ¶å·¥ç¨‹çš„ pom.xml ä¸­åŠ å…¥å¦‚ä¸‹å±æ€§ï¼ˆå«ç¼–ç ã€Flink ç‰ˆæœ¬ã€JDK ç‰ˆæœ¬ã€Scala ç‰ˆæœ¬ã€Maven ç¼–è¯‘ç‰ˆæœ¬ï¼‰ï¼š 1234567891011&lt;properties&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;!--Flink ç‰ˆæœ¬--&gt; &lt;flink.version&gt;1.9.0&lt;/flink.version&gt; &lt;!--JDK ç‰ˆæœ¬--&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;!--Scala 2.11 ç‰ˆæœ¬--&gt; &lt;scala.binary.version&gt;2.11&lt;/scala.binary.version&gt; &lt;maven.compiler.source&gt;$&#123;java.version&#125;&lt;/maven.compiler.source&gt; &lt;maven.compiler.target&gt;$&#123;java.version&#125;&lt;/maven.compiler.target&gt;&lt;/properties&gt; ç„¶ååŠ å…¥ä¾èµ–ï¼š 1234567891011121314151617181920212223242526272829303132&lt;dependencies&gt; &lt;!-- Apache Flink dependencies --&gt; &lt;!-- These dependencies are provided, because they should not be packaged into the JAR file. --&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-java&lt;/artifactId&gt; &lt;version&gt;$&#123;flink.version&#125;&lt;/version&gt; &lt;scope&gt;provided&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-streaming-java_$&#123;scala.binary.version&#125;&lt;/artifactId&gt; &lt;version&gt;$&#123;flink.version&#125;&lt;/version&gt; &lt;scope&gt;provided&lt;/scope&gt; &lt;/dependency&gt; &lt;!-- Add logging framework, to produce console output when running in the IDE. --&gt; &lt;!-- These dependencies are excluded from the application JAR by default. --&gt; &lt;dependency&gt; &lt;groupId&gt;org.slf4j&lt;/groupId&gt; &lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt; &lt;version&gt;1.7.7&lt;/version&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;log4j&lt;/groupId&gt; &lt;artifactId&gt;log4j&lt;/artifactId&gt; &lt;version&gt;1.2.17&lt;/version&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;/dependency&gt;&lt;/dependencies&gt; ä¸Šé¢ä¾èµ–ä¸­ flink-java å’Œ flink-streaming-java æ˜¯æˆ‘ä»¬ Flink å¿…å¤‡çš„æ ¸å¿ƒä¾èµ–ï¼Œä¸ºä»€ä¹ˆè®¾ç½® scope ä¸º provided å‘¢ï¼ˆé»˜è®¤æ˜¯ compileï¼‰ï¼Ÿæ˜¯å› ä¸º Flink å…¶å®åœ¨è‡ªå·±çš„å®‰è£…ç›®å½•ä¸­ lib æ–‡ä»¶å¤¹é‡Œçš„ lib/flink-dist_2.11-1.9.0.jar å·²ç»åŒ…å«äº†è¿™äº›å¿…å¤‡çš„ Jar äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ç»™è‡ªå·±çš„ Flink Job æ·»åŠ ä¾èµ–çš„æ—¶å€™æœ€åæ‰“æˆçš„ Jar åŒ…å¯ä¸å¸Œæœ›åˆå°†è¿™äº›é‡å¤çš„ä¾èµ–æ‰“è¿›å»ã€‚æœ‰ä¸¤ä¸ªå¥½å¤„ï¼š å‡å°äº†æˆ‘ä»¬æ‰“çš„ Flink Job Jar åŒ…å®¹é‡å¤§å° ä¸ä¼šå› ä¸ºæ‰“å…¥ä¸åŒç‰ˆæœ¬çš„ Flink æ ¸å¿ƒä¾èµ–è€Œå¯¼è‡´ç±»åŠ è½½å†²çªç­‰é—®é¢˜ ä½†æ˜¯é—®é¢˜åˆæ¥äº†ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ IDEA ä¸­è°ƒè¯•è¿è¡Œæˆ‘ä»¬çš„ Jobï¼Œå¦‚æœå°† scope è®¾ç½®ä¸º provided çš„è¯ï¼Œæ˜¯ä¼šæŠ¥é”™çš„ï¼š 123456789101112131415Error: A JNI error has occurred, please check your installation and try againException in thread &quot;main&quot; java.lang.NoClassDefFoundError: org/apache/flink/api/common/ExecutionConfig$GlobalJobParameters at java.lang.Class.getDeclaredMethods0(Native Method) at java.lang.Class.privateGetDeclaredMethods(Class.java:2701) at java.lang.Class.privateGetMethodRecursive(Class.java:3048) at java.lang.Class.getMethod0(Class.java:3018) at java.lang.Class.getMethod(Class.java:1784) at sun.launcher.LauncherHelper.validateMainClass(LauncherHelper.java:544) at sun.launcher.LauncherHelper.checkAndLoadMain(LauncherHelper.java:526)Caused by: java.lang.ClassNotFoundException: org.apache.flink.api.common.ExecutionConfig$GlobalJobParameters at java.net.URLClassLoader.findClass(URLClassLoader.java:381) at java.lang.ClassLoader.loadClass(ClassLoader.java:424) at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:338) at java.lang.ClassLoader.loadClass(ClassLoader.java:357) ... 7 more é»˜è®¤ scope ä¸º compile çš„è¯ï¼Œæœ¬åœ°è°ƒè¯•çš„è¯å°±ä¸ä¼šå‡ºé”™äº†ã€‚å¦å¤–æµ‹è¯•åˆ°åº•èƒ½å¤Ÿå‡å°å¤šå°‘ Jar åŒ…çš„å¤§å°å‘¢ï¼Ÿæˆ‘è¿™é‡Œå…ˆå†™äº†ä¸ª Job æµ‹è¯•ã€‚å½“ scope ä¸º compile æ—¶ï¼Œç¼–è¯‘åçš„ target ç›®å½•ï¼š 12345678zhisheng@zhisheng ~/Flink-WordCount/target î‚  master â—âœš lltotal 94384-rw-r--r-- 1 zhisheng staff 45M 4 26 21:23 Flink-WordCount-1.0-SNAPSHOT.jardrwxr-xr-x 4 zhisheng staff 128B 4 26 21:23 classesdrwxr-xr-x 3 zhisheng staff 96B 4 26 21:23 generated-sourcesdrwxr-xr-x 3 zhisheng staff 96B 4 26 21:23 maven-archiverdrwxr-xr-x 3 zhisheng staff 96B 4 26 21:23 maven-status-rw-r--r-- 1 zhisheng staff 7.2K 4 26 21:23 original-Flink-WordCount-1.0-SNAPSHOT.jar å½“ scope ä¸º provided æ—¶ï¼Œç¼–è¯‘åçš„ target ç›®å½•ï¼š 12345678zhisheng@zhisheng ~/Flink-WordCount/target î‚  master â—âœš lltotal 32-rw-r--r-- 1 zhisheng staff 7.5K 4 26 21:27 Flink-WordCount-1.0-SNAPSHOT.jardrwxr-xr-x 4 zhisheng staff 128B 4 26 21:27 classesdrwxr-xr-x 3 zhisheng staff 96B 4 26 21:27 generated-sourcesdrwxr-xr-x 3 zhisheng staff 96B 4 26 21:27 maven-archiverdrwxr-xr-x 3 zhisheng staff 96B 4 26 21:27 maven-status-rw-r--r-- 1 zhisheng staff 7.2K 4 26 21:27 original-Flink-WordCount-1.0-SNAPSHOT.jar ã€‚ã€‚ã€‚ 2.3.3 æµè®¡ç®— WordCount åº”ç”¨ç¨‹åºä»£ç å®ç°2.3.4 è¿è¡Œæµè®¡ç®— WordCount åº”ç”¨ç¨‹åºæœ¬åœ° IDE è¿è¡ŒUI è¿è¡Œ Job2.3.5 æµè®¡ç®— WordCount åº”ç”¨ç¨‹åºä»£ç åˆ†æ2.3.6 å°ç»“ä¸åæ€åŠ å…¥çŸ¥è¯†æ˜Ÿçƒå¯ä»¥çœ‹åˆ°ä¸Šé¢æ–‡ç« ï¼šhttps://t.zsxq.com/Z7EAmq3","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹â€”â€” Flink ç¯å¢ƒæ­å»º","date":"2021-07-07T16:00:00.000Z","path":"2021/07/08/flink-in-action-2.2/","text":"2.2 Flink ç¯å¢ƒæ­å»º åœ¨ 2.1 èŠ‚ä¸­å·²ç»å°† Flink çš„å‡†å¤‡ç¯å¢ƒå·²ç»è®²å®Œäº†ï¼Œæœ¬ç« èŠ‚å°†å¸¦å¤§å®¶æ­£å¼å¼€å§‹æ¥è§¦ Flinkï¼Œé‚£ä¹ˆæˆ‘ä»¬å¾—å…ˆå®‰è£…ä¸€ä¸‹ Flinkã€‚Flink æ˜¯å¯ä»¥åœ¨å¤šä¸ªå¹³å°ï¼ˆWindowsã€Linuxã€Macï¼‰ä¸Šå®‰è£…çš„ã€‚åœ¨å¼€å§‹å†™æœ¬ä¹¦çš„æ—¶å€™æœ€æ–°ç‰ˆæœ¬æ˜¯ 1.8 ç‰ˆæœ¬ï¼Œä½†æ˜¯å†™åˆ°ä¸€åŠåæ›´æ–°åˆ° 1.9 äº†ï¼ˆåˆå¹¶äº†å¤§é‡ Blink çš„æ–°ç‰¹æ€§ï¼‰ï¼Œæ‰€ä»¥ç¬”è€…åˆå…¨éƒ¨æ›´æ–°ç‰ˆæœ¬åˆ° 1.9ï¼Œä¹¦ç±åé¢ä¹Ÿéƒ½æ˜¯åŸºäºæœ€æ–°çš„ç‰ˆæœ¬è®²è§£ä¸æ¼”ç¤ºã€‚ Flink çš„å®˜ç½‘åœ°å€æ˜¯ï¼šhttps://flink.apache.org/ 2.2.1 Flink ä¸‹è½½ä¸å®‰è£…Flink åœ¨ Macã€Linuxã€Window å¹³å°ä¸Šçš„å®‰è£…æ–¹å¼å¦‚ä¸‹ã€‚ åœ¨ Mac å’Œ Linux ä¸‹å®‰è£…ä½ å¯ä»¥é€šè¿‡è¯¥åœ°å€ https://flink.apache.org/downloads.html ä¸‹è½½åˆ°æœ€æ–°ç‰ˆæœ¬çš„ Flinkã€‚è¿™é‡Œæˆ‘ä»¬é€‰æ‹© Apache Flink 1.9.0 for Scala 2.11 ç‰ˆæœ¬ï¼Œç‚¹å‡»è·³è½¬åˆ°äº†ä¸€ä¸ªé•œåƒä¸‹è½½é€‰æ‹©çš„åœ°å€ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œéšä¾¿é€‰æ‹©å“ªä¸ªå°±è¡Œï¼Œåªæ˜¯ä¸‹è½½é€Ÿåº¦ä¸ä¸€è‡´è€Œå·²ã€‚ ä¸‹è½½å®Œåï¼Œä½ å°±å¯ä»¥ç›´æ¥è§£å‹ä¸‹è½½çš„ Flink å‹ç¼©åŒ…äº†ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥å¯åŠ¨ä¸€ä¸‹ Flinkï¼Œæˆ‘ä»¬è¿›å…¥åˆ° Flink çš„å®‰è£…ç›®å½•ä¸‹æ‰§è¡Œå‘½ä»¤ ./bin/start-cluster.sh å³å¯ï¼Œäº§ç”Ÿçš„æ—¥å¿—å¦‚ä¸‹ï¼š 1234zhisheng@zhisheng /usr/local/flink-1.9.0 ./bin/start-cluster.shStarting cluster.Starting standalonesession daemon on host zhisheng.Starting taskexecutor daemon on host zhisheng. å¦‚æœä½ çš„ç”µè„‘æ˜¯ Mac çš„è¯ï¼Œé‚£ä¹ˆä½ ä¹Ÿå¯ä»¥é€šè¿‡ Homebrew å‘½ä»¤è¿›è¡Œå®‰è£…ã€‚å…ˆé€šè¿‡å‘½ä»¤ brew search flink æŸ¥æ‰¾ä¸€ä¸‹åŒ…ï¼š 123 zhisheng@zhisheng ~ brew search flink==&gt; Formulaeapache-flink âœ” homebrew/linuxbrew-core/apache-flink å¯ä»¥å‘ç°æ‰¾å¾—åˆ° Flink çš„å®‰è£…åŒ…ï¼Œä½†æ˜¯è¿™æ ·å®‰è£…çš„ç‰ˆæœ¬å¯èƒ½ä¸æ˜¯æœ€æ–°çš„ï¼Œå¦‚æœä½ è¦å®‰è£…çš„è¯ï¼Œåˆ™ä½¿ç”¨å‘½ä»¤ï¼š 1brew install apache-flink é‚£ä¹ˆå®ƒå°±ä¼šå¼€å§‹è¿›è¡Œä¸‹è½½å¹¶å®‰è£…å¥½ï¼Œå®‰è£…åçš„ç›®å½•åº”è¯¥æ˜¯åœ¨ /usr/local/Cellar/apache-flink ä¸‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä½ å¯ä»¥é€šè¿‡ä¸‹é¢å‘½ä»¤æ£€æŸ¥å®‰è£…çš„ Flink åˆ°åº•æ˜¯ä»€ä¹ˆç‰ˆæœ¬çš„ï¼š 1flink --version ç»“æœå¦‚ä¸‹ï¼š 1Version: 1.9.0, Commit ID: ff472b4 è¿™ç§çš„è¯è¿è¡Œæ˜¯å¾—è¿›å…¥ /usr/local/Cellar/apache-flink/1.9.0/libexec/bin ç›®å½•ä¸‹æ‰§è¡Œå‘½ä»¤ ./start-cluster.sh æ‰å¯ä»¥å¯åŠ¨ Flink çš„ã€‚æ‰§è¡Œå‘½ä»¤åçš„å¯åŠ¨æ—¥å¿—å¦‚ä¸‹æ‰€ç¤ºï¼š 123Starting cluster.Starting standalonesession daemon on host zhisheng.Starting taskexecutor daemon on host zhisheng. åœ¨ Windows ä¸‹å®‰è£…å¦‚æœä½ çš„ç”µè„‘ç³»ç»Ÿæ˜¯ Windows çš„è¯ï¼Œé‚£ä¹ˆä½ å°±ç›´æ¥åŒå‡» Flink å®‰è£…ç›®å½•ä¸‹é¢ bin æ–‡ä»¶å¤¹é‡Œé¢çš„ start-cluster.bat å°±è¡Œï¼ŒåŒæ ·å¯ä»¥å°† Flink èµ·åŠ¨æˆåŠŸã€‚ 2.2.2 Flink å¯åŠ¨ä¸è¿è¡Œå¯åŠ¨æˆåŠŸåçš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è®¿é—®åœ°å€http://localhost:8081/ æŸ¥çœ‹ UI é•¿å•¥æ ·äº†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 2.2.3 Flink ç›®å½•é…ç½®æ–‡ä»¶è§£è¯»2.2.4 Flink æºç ä¸‹è½½2.2.5 Flink æºç ç¼–è¯‘2.2.6 å°† Flink æºç å¯¼å…¥åˆ° IDEåŠ å…¥çŸ¥è¯†æ˜Ÿçƒå¯ä»¥çœ‹åˆ°ä¸Šé¢æ–‡ç« ï¼šhttps://t.zsxq.com/JyRzVnU 2.2.7 å°ç»“ä¸åæ€æœ¬èŠ‚ä¸»è¦è®²äº† FLink åœ¨ä¸åŒç³»ç»Ÿä¸‹çš„å®‰è£…å’Œè¿è¡Œæ–¹æ³•ï¼Œç„¶åè®²äº†ä¸‹æ€ä¹ˆå»ä¸‹è½½æºç å’Œå°†æºç å¯¼å…¥åˆ° IDE ä¸­ã€‚ä¸çŸ¥é“ä½ åœ¨å°†æºç å¯¼å…¥åˆ° IDE ä¸­æ˜¯å¦æœ‰é‡åˆ°ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹â€”â€” Flink ç¯å¢ƒå‡†å¤‡","date":"2021-07-06T16:00:00.000Z","path":"2021/07/07/flink-in-action-2.1/","text":"ç¬¬äºŒç«  â€”â€” Flink å…¥é—¨é€šè¿‡ç¬¬ä¸€ç« å¯¹ Flink çš„ä»‹ç»ï¼Œç›¸ä¿¡ä½ å¯¹ Flink çš„æ¦‚å¿µå’Œç‰¹æ€§æœ‰äº†ä¸€å®šçš„äº†è§£ï¼Œæ¥ä¸‹æ¥æœ¬ç« å°†å¼€å§‹æ­£å¼è¿›å…¥ Flink çš„å­¦ä¹ ä¹‹æ—…ï¼Œç¬”è€…å°†å¸¦ä½ æ­å»º Flink çš„ç¯å¢ƒå’Œç¼–å†™ä¸¤ä¸ªæ¡ˆä¾‹ï¼ˆWordCount ç¨‹åºã€è¯»å– Socket æ•°æ®ï¼‰æ¥å…¥é—¨ Flinkã€‚ 2.1 Flink ç¯å¢ƒå‡†å¤‡ é€šè¿‡å‰é¢çš„ç« èŠ‚å†…å®¹ï¼Œç›¸ä¿¡ä½ å·²ç»å¯¹ Flink çš„åŸºç¡€æ¦‚å¿µç­‰çŸ¥è¯†å·²ç»æœ‰ä¸€å®šäº†è§£ï¼Œç°åœ¨æ˜¯ä¸æ˜¯è¿«åˆ‡çš„æƒ³æŠŠ Flink ç»™ç”¨èµ·æ¥ï¼Ÿå…ˆåˆ«æ€¥ï¼Œæˆ‘ä»¬å…ˆæŠŠç”µè„‘çš„å‡†å¤‡ç¯å¢ƒç»™å®‰è£…å¥½ï¼Œè¿™æ ·åé¢æ‰èƒ½æ›´æ„‰å¿«åœ°ç©è€ã€‚ åºŸè¯ä¸å¤šè¯´äº†ï¼Œç›´å¥”ä¸»é¢˜ã€‚å› ä¸ºæœ¬ä¹¦åé¢ç« èŠ‚å†…å®¹ä¼šä½¿ç”¨ Kafkaã€MySQLã€ElasticSearch ç­‰ç»„ä»¶ï¼Œå¹¶ä¸”è¿è¡Œ Flink ç¨‹åºæ˜¯éœ€è¦ä¾èµ– Java çš„ï¼Œå¦å¤–å°±æ˜¯æˆ‘ä»¬éœ€è¦ä½¿ç”¨ IDE æ¥å¼€å‘ Flink åº”ç”¨ç¨‹åºä»¥åŠä½¿ç”¨ Maven æ¥ç®¡ç† Flink åº”ç”¨ç¨‹åºçš„ä¾èµ–ï¼Œæ‰€ä»¥æœ¬èŠ‚æˆ‘ä»¬æå‰å®‰è£…è¿™ä¸ªå‡ ä¸ªç»„ä»¶ï¼Œæ­å»ºå¥½æœ¬åœ°çš„ç¯å¢ƒï¼Œåé¢å¦‚æœè¿˜è¦å®‰è£…å…¶ä»–çš„ç»„ä»¶ç¬”è€…ä¼šåœ¨å¯¹åº”çš„ç« èŠ‚ä¸­è¡¥å……ï¼Œå¦‚æœä½ çš„æ“ä½œç³»ç»Ÿå·²ç»ä¸­å·²ç»å®‰è£…è¿‡ JDKã€Mavenã€MySQLã€IDEA ç­‰ï¼Œé‚£ä¹ˆä½ å¯ä»¥è·³è¿‡å¯¹åº”çš„å†…å®¹ï¼Œç›´æ¥çœ‹ä½ æœªå®‰è£…è¿‡çš„ã€‚ è¿™é‡Œç¬”è€…å†è¯´ä¸‹è‡ªå·±ç”µè„‘çš„ç³»ç»Ÿç¯å¢ƒï¼šmacOS High Sierra 10.13.5ï¼Œåé¢æ–‡ç« çš„æ¼”ç¤ºç¯å¢ƒä¸ä½œç‰¹åˆ«è¯´æ˜çš„è¯å°±æ˜¯éƒ½åœ¨è¿™ä¸ªç³»ç»Ÿç¯å¢ƒä¸­ã€‚ 2.1.1 JDK å®‰è£…ä¸é…ç½®è™½ç„¶ç°åœ¨ JDK å·²ç»æ›´æ–°åˆ° 12 äº†ï¼Œä½†æ˜¯ä¸ºäº†ç¨³å®šæˆ‘ä»¬è¿˜æ˜¯å®‰è£… JDK 8ï¼Œå¦‚æœæ²¡æœ‰å®‰è£…è¿‡çš„è¯ï¼Œå¯ä»¥å»å®˜ç½‘ çš„ä¸‹è½½é¡µé¢ä¸‹è½½å¯¹åº”è‡ªå·±æ“ä½œç³»ç»Ÿçš„æœ€æ–° JDK8 å°±è¡Œã€‚ Mac ç³»ç»Ÿçš„æ˜¯ jdk-8u211-macosx-x64.dmg æ ¼å¼ã€Linux ç³»ç»Ÿçš„æ˜¯ jdk-8u211-linux-x64.tar.gz æ ¼å¼ã€‚Mac ç³»ç»Ÿå®‰è£…çš„è¯ç›´æ¥åŒå‡»ç„¶åä¸€ç›´æŒ‰ç…§æç¤ºå°±è¡Œäº†ï¼Œæœ€å JDK çš„å®‰è£…ç›®å½•åœ¨ /Library/Java/JavaVirtualMachines/ ï¼Œç„¶ååœ¨ /etc/hosts ä¸­é…ç½®å¥½ç¯å¢ƒå˜é‡ï¼ˆæ³¨æ„ï¼šæ›¿æ¢ä½ è‡ªå·±ç”µè„‘æœ¬åœ°çš„è·¯å¾„ï¼‰ã€‚ 123export JAVA_HOME=/Library/Java/JavaVirtualMachines/jdk1.8.0_152.jdk/Contents/Homeexport CLASSPATH=$JAVA_HOME/lib/tools.jar:$JAVA_HOME/lib/dt.jar:export PATH=$PATH:$JAVA_HOME/bin Linux ç³»ç»Ÿçš„è¯å°±æ˜¯åœ¨æŸä¸ªç›®å½•ä¸‹ç›´æ¥è§£å‹å°±è¡Œäº†ï¼Œç„¶ååœ¨ /etc/profile æ·»åŠ ä¸€ä¸‹ä¸Šé¢çš„ç¯å¢ƒå˜é‡ï¼ˆæ³¨æ„ï¼šæ›¿æ¢ä½ è‡ªå·±ç”µè„‘çš„è·¯å¾„ï¼‰ã€‚ç„¶åæ‰§è¡Œ java -version å‘½ä»¤å¯ä»¥æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸï¼ 1234 zhisheng@zhisheng ~ java -versionjava version &quot;1.8.0_152&quot;Java(TM) SE Runtime Environment (build 1.8.0_152-b16)Java HotSpot(TM) 64-Bit Server VM (build 25.152-b16, mixed mode) 2.1.2 Maven å®‰è£…ä¸é…ç½®å®‰è£…å¥½ JDK åæˆ‘ä»¬å°±å¯ä»¥å®‰è£… Maven äº†ï¼Œæˆ‘ä»¬åœ¨å®˜ç½‘ä¸‹è½½äºŒè¿›åˆ¶åŒ…å°±è¡Œï¼Œç„¶ååœ¨è‡ªå·±æœ¬åœ°è½¯ä»¶å®‰è£…ç›®å½•è§£å‹å‹ç¼©åŒ…å°±è¡Œã€‚æ¥ä¸‹æ¥ä½ éœ€è¦é…ç½®ä¸€ä¸‹ç¯å¢ƒå˜é‡ï¼š 12export M2_HOME=/Users/zhisheng/Documents/maven-3.5.2export PATH=$PATH:$M2_HOME/bin ç„¶åæ‰§è¡Œå‘½ä»¤ mvn -v å¯ä»¥éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸï¼Œç»“æœå¦‚ä¸‹ï¼š 1234567zhisheng@zhisheng ~ /Users mvn -vApache Maven 3.5.2 (138edd61fd100ec658bfa2d307c43b76940a5d7d; 2017-10-18T15:58:13+08:00)Maven home: /Users/zhisheng/Documents/maven-3.5.2Java version: 1.8.0_152, vendor: Oracle CorporationJava home: /Library/Java/JavaVirtualMachines/jdk1.8.0_152.jdk/Contents/Home/jreDefault locale: zh_CN, platform encoding: UTF-8OS name: &quot;mac os x&quot;, version: &quot;10.13.5&quot;, arch: &quot;x86_64&quot;, family: &quot;mac&quot; 2.1.3 IDE å®‰è£…ä¸é…ç½®å®‰è£…å®Œ JDK å’Œ Maven åï¼Œå°±å¯ä»¥å®‰è£… IDE äº†ï¼Œå¤§å®¶å¯ä»¥é€‰æ‹©ä½ ç†Ÿç»ƒçš„ IDE å°±è¡Œï¼Œç¬”è€…åé¢æ¼”ç¤ºçš„ä»£ç éƒ½æ˜¯åœ¨ IDEA ä¸­è¿è¡Œçš„ï¼Œå¦‚æœæƒ³ä¸ºäº†åé¢ä¸å‡ºå…¶ä»–çš„é—®é¢˜çš„è¯ï¼Œå»ºè®®å°½é‡å’Œç¬”è€…çš„ç¯å¢ƒä¿æŒä¸€è‡´ã€‚ IDEA å®˜ç½‘ä¸‹è½½åœ°å€ï¼šä¸‹è½½é¡µé¢çš„åœ°å€ï¼Œä¸‹è½½åå¯ä»¥åŒå‡»åç„¶åæŒ‰ç…§æç¤ºä¸€æ­¥æ­¥å®‰è£…ï¼Œå®‰è£…å®Œæˆåéœ€è¦åœ¨ IDEA ä¸­é…ç½® JDK è·¯å¾„å’Œ Maven çš„è·¯å¾„ï¼Œåé¢æˆ‘ä»¬å¼€å‘ä¹Ÿéƒ½æ˜¯é  Maven æ¥ç®¡ç†é¡¹ç›®çš„ä¾èµ–ã€‚ 2.1.4 MySQL å®‰è£…ä¸é…ç½®2.1.5 Kafka å®‰è£…ä¸é…ç½®2.1.6 ElasticSearch å®‰è£…ä¸é…ç½®åŠ å…¥çŸ¥è¯†æ˜Ÿçƒå¯ä»¥çœ‹åˆ°ä¸Šé¢æ–‡ç« ï¼šhttps://t.zsxq.com/JyRzVnU 2.1.7 å°ç»“ä¸åæ€æœ¬èŠ‚è®²è§£äº†ä¸‹ JDKã€Mavenã€IDEã€MySQLã€Kafkaã€ElasticSearch çš„å®‰è£…ä¸é…ç½®ï¼Œå› ä¸ºè¿™äº›éƒ½æ˜¯åé¢è¦ç”¨çš„ï¼Œæ‰€ä»¥è¿™é‡Œå•ç‹¬æŠ½ä¸€ç¯‡æ–‡ç« æ¥è®²è§£ç¯å¢ƒå‡†å¤‡çš„å®‰è£…æ­¥éª¤ï¼Œå½“ç„¶è¿™é‡Œè¿˜å¹¶ä¸æ¶‰åŠå…¨ï¼Œå› ä¸ºåé¢æˆ‘ä»¬è¿˜å¯èƒ½ä¼šæ¶‰åŠåˆ° HBaseã€HDFS ç­‰çŸ¥è¯†ï¼Œåé¢æˆ‘ä»¬ç”¨åˆ°å†çœ‹ï¼Œæœ¬ä¹¦çš„å†…å®¹ä¸»è¦è®²è§£ Flinkï¼Œæ‰€ä»¥æ›´å¤šçš„ç¯å¢ƒå‡†å¤‡è¿˜æ˜¯å¾—é å¤§å®¶è‡ªå·±ç‹¬ç«‹å®Œæˆã€‚ è¿™é‡Œç¬”è€…è¯´ä¸‹ç¬”è€…è‡ªå·±ä¸€èˆ¬å®‰è£…ç¯å¢ƒçš„é€‰æ‹©ï¼š xxx ä¸‹é¢ç« èŠ‚æˆ‘ä»¬å°±æ­£å¼è¿›å…¥ Flink ä¸“é¢˜äº†ï¼","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹â€”â€” å¤§æ•°æ®è®¡ç®—æ¡†æ¶å¯¹æ¯”","date":"2021-07-05T16:00:00.000Z","path":"2021/07/06/flink-in-action-1.3/","text":"1.3 å¤§æ•°æ®è®¡ç®—æ¡†æ¶å¯¹æ¯”åœ¨ 1.2 èŠ‚ä¸­å·²ç»è·Ÿå¤§å®¶è¯¦ç»†ä»‹ç»äº† Flinkï¼Œé‚£ä¹ˆåœ¨æœ¬èŠ‚å°±ä¸»è¦ Blinkã€Spark Streamingã€Structured Streaming å’Œ Storm çš„åŒºåˆ«ã€‚ 1.3.1 FlinkFlink æ˜¯ä¸€ä¸ªé’ˆå¯¹æµæ•°æ®å’Œæ‰¹æ•°æ®åˆ†å¸ƒå¼å¤„ç†çš„å¼•æ“ï¼Œåœ¨æŸäº›å¯¹å®æ—¶æ€§è¦æ±‚éå¸¸é«˜çš„åœºæ™¯ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯é‡‡ç”¨ Flink æ¥ä½œä¸ºè®¡ç®—å¼•æ“ï¼Œå®ƒä¸ä»…å¯ä»¥å¤„ç†æœ‰ç•Œçš„æ‰¹æ•°æ®ï¼Œè¿˜å¯ä»¥å¤„ç†æ— ç•Œçš„æµæ•°æ®ï¼Œåœ¨ Flink çš„è®¾è®¡æ„¿æƒ³å°±æ˜¯å°†æ‰¹å¤„ç†å½“æˆæ˜¯æµå¤„ç†çš„ä¸€ç§ç‰¹ä¾‹ã€‚ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåœ¨ Flink çš„æ¯å…¬å¸ Data Artisans è¢«é˜¿é‡Œæ”¶è´­ä¹‹åï¼Œé˜¿é‡Œä¹Ÿåœ¨å¼€å§‹é€æ­¥å°†å†…éƒ¨çš„ Blink ä»£ç å¼€æºå‡ºæ¥å¹¶åˆå¹¶åœ¨ Flink ä¸»åˆ†æ”¯ä¸Šã€‚ è€Œ Blink ä¸€ä¸ªå¾ˆå¼ºå¤§çš„ç‰¹ç‚¹å°±æ˜¯å®ƒçš„ Table API &amp; SQL å¾ˆå¼ºå¤§ï¼Œç¤¾åŒºä¹Ÿåœ¨ Flink 1.9 ç‰ˆæœ¬å°† Blink å¼€æºç‰ˆæœ¬å¤§éƒ¨åˆ†ä»£ç åˆè¿›äº† Flink ä¸»åˆ†æ”¯ã€‚ 1.3.2 BlinkBlink æ˜¯æ—©æœŸé˜¿é‡Œåœ¨ Flink çš„åŸºç¡€ä¸Šå¼€å§‹ä¿®æ”¹å’Œå®Œå–„ååœ¨å†…éƒ¨åˆ›å»ºçš„åˆ†æ”¯ï¼Œç„¶å Blink ç›®å‰åœ¨é˜¿é‡ŒæœåŠ¡äºé˜¿é‡Œé›†å›¢å†…éƒ¨æœç´¢ã€æ¨èã€å¹¿å‘Šã€èœé¸Ÿç‰©æµç­‰å¤§é‡æ ¸å¿ƒå®æ—¶ä¸šåŠ¡ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ Blink åœ¨é˜¿é‡Œå†…éƒ¨é”™ç»¼å¤æ‚çš„ä¸šåŠ¡åœºæ™¯ä¸­é”»ç‚¼æˆé•¿ç€ï¼Œç»å†äº†å†…éƒ¨è¿™ä¹ˆå¤šç”¨æˆ·çš„åé¦ˆï¼ˆå„ç§æ€§èƒ½ã€èµ„æºä½¿ç”¨ç‡ã€æ˜“ç”¨æ€§ç­‰è¯¸å¤šæ–¹é¢çš„é—®é¢˜ï¼‰ï¼ŒBlink éƒ½åšäº†é’ˆå¯¹æ€§çš„æ”¹è¿›ã€‚åœ¨ Flink Forward China å³°ä¼šä¸Šï¼Œé˜¿é‡Œå·´å·´é›†å›¢å‰¯æ€»è£å‘¨é–äººå®£å¸ƒ Blink åœ¨ 2019 å¹´ 1 æœˆæ­£å¼å¼€æºï¼ŒåŒæ—¶é˜¿é‡Œä¹Ÿå¸Œæœ› Blink å¼€æºåèƒ½è¿›ä¸€æ­¥åŠ æ·±ä¸ Flink ç¤¾åŒºçš„è”åŠ¨ï¼Œ Blink å¼€æºåœ°å€ï¼šhttps://github.com/apache/flink/tree/blink å¼€æºç‰ˆæœ¬ Blink çš„ä¸»è¦åŠŸèƒ½å’Œä¼˜åŒ–ç‚¹ï¼š 1ã€Runtime å±‚å¼•å…¥ Pluggable Shuffle Architectureï¼Œå¼€å‘è€…å¯ä»¥æ ¹æ®ä¸åŒçš„è®¡ç®—æ¨¡å‹æˆ–è€…æ–°ç¡¬ä»¶çš„éœ€è¦å®ç°ä¸åŒçš„ shuffle ç­–ç•¥è¿›è¡Œé€‚é…ï¼›ä¸ºäº†æ€§èƒ½ä¼˜åŒ–ï¼ŒBlink å¯ä»¥è®©ç®—å­æ›´åŠ çµæ´»çš„ chain åœ¨ä¸€èµ·ï¼Œé¿å…äº†ä¸å¿…è¦çš„æ•°æ®ä¼ è¾“å¼€é”€ï¼›åœ¨ BroadCast Shuffle æ¨¡å¼ä¸­ï¼ŒBlink ä¼˜åŒ–æ‰äº†å¤§é‡çš„ä¸å¿…è¦çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–å¼€é”€ï¼›Blink æä¾›äº†å…¨æ–°çš„ JM FailOver æœºåˆ¶ï¼ŒJM å‘ç”Ÿé”™è¯¯ä¹‹åï¼Œæ–°çš„ JM ä¼šé‡æ–°æ¥ç®¡æ•´ä¸ª JOB è€Œä¸æ˜¯é‡å¯ JOBï¼Œä»è€Œå¤§å¤§å‡å°‘äº† JM FailOver å¯¹ JOB çš„å½±å“ï¼›Blink æ”¯æŒè¿è¡Œåœ¨ Kubernetes ä¸Šã€‚ 2ã€SQL/Table API æ¶æ„ä¸Šçš„é‡æ„å’Œæ€§èƒ½çš„ä¼˜åŒ–æ˜¯ Blink å¼€æºç‰ˆæœ¬çš„ä¸€ä¸ªé‡å¤§è´¡çŒ®ã€‚ 3ã€Hive çš„å…¼å®¹æ€§ï¼Œå¯ä»¥ç›´æ¥ç”¨ Flink SQL å»æŸ¥è¯¢ Hive çš„æ•°æ®ï¼ŒBlink é‡æ„äº† Flink catalog çš„å®ç°ï¼Œå¹¶ä¸”å¢åŠ äº†ä¸¤ç§ catalogï¼Œä¸€ä¸ªæ˜¯åŸºäºå†…å­˜å­˜å‚¨çš„ FlinkInMemoryCatalogï¼Œå¦å¤–ä¸€ä¸ªæ˜¯èƒ½å¤Ÿæ¡¥æ¥ Hive metaStore çš„ HiveCatalogã€‚ 4ã€Zeppelin for Flink 5ã€Flink Webï¼Œæ›´ç¾è§‚çš„ UI ç•Œé¢ï¼ŒæŸ¥çœ‹æ—¥å¿—å’Œç›‘æ§ Job éƒ½å˜å¾—æ›´åŠ æ–¹ä¾¿ å¯¹äºå¼€æºé‚£ä¼šçœ‹åˆ°ä¸€ä¸ªå¯¹è¯è®©ç¬”è€…æ„Ÿåˆ°å¾ˆéœ‡æ’¼ï¼š Blink å¼€æºåï¼Œä¸¤ä¸ªå¼€æºé¡¹ç›®ä¹‹é—´çš„å…³ç³»ä¼šæ˜¯æ€æ ·çš„ï¼Ÿæœªæ¥ Flink å’Œ Blink ä¹Ÿä¼šç”±ä¸åŒçš„å›¢é˜Ÿå„è‡ªç»´æŠ¤å—ï¼Ÿ Blink æ°¸è¿œä¸ä¼šæˆä¸ºå¦å¤–ä¸€ä¸ªé¡¹ç›®ï¼Œå¦‚æœåç»­è¿›å…¥ Apache ä¸€å®šæ˜¯æˆä¸º Flink çš„ä¸€éƒ¨åˆ† å¯¹è¯è¯¦æƒ…å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š åœ¨ Blink å¼€æºé‚£ä¼šï¼Œç¬”è€…å°±å°†æºç è‡ªå·±ç¼–è¯‘äº†ä¸€ä»½ï¼Œç„¶åè‡ªå·±åœ¨æœ¬åœ°ä¸€ç›´è¿è¡Œç€ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥çœ‹çœ‹æ–‡ç«  é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ ï¼Œä½ ä¼šå‘ç° Blink çš„ UI è¿˜æ˜¯æ¯”è¾ƒç¾è§‚å’Œå®ç”¨çš„ã€‚ å¦‚æœä½ è¿˜å¯¹ Blink æœ‰ä»€ä¹ˆç–‘é—®ï¼Œå¯ä»¥çœ‹çœ‹ä¸‹é¢ä¸¤ç¯‡æ–‡ç« ï¼š é˜¿é‡Œé‡ç£…å¼€æº Blinkï¼šä¸ºä»€ä¹ˆæˆ‘ä»¬ç­‰äº†è¿™ä¹ˆä¹…ï¼Ÿ é‡ç£…ï¼é˜¿é‡Œå·´å·´ Blink æ­£å¼å¼€æºï¼Œé‡è¦ä¼˜åŒ–ç‚¹è§£è¯» 1.3.3 SparkApache Spark æ˜¯ä¸€ç§åŒ…å«æµå¤„ç†èƒ½åŠ›çš„ä¸‹ä¸€ä»£æ‰¹å¤„ç†æ¡†æ¶ã€‚ä¸ Hadoop çš„ MapReduce å¼•æ“åŸºäºå„ç§ç›¸åŒåŸåˆ™å¼€å‘è€Œæ¥çš„ Spark ä¸»è¦ä¾§é‡äºé€šè¿‡å®Œå–„çš„å†…å­˜è®¡ç®—å’Œå¤„ç†ä¼˜åŒ–æœºåˆ¶åŠ å¿«æ‰¹å¤„ç†å·¥ä½œè´Ÿè½½çš„è¿è¡Œé€Ÿåº¦ã€‚Spark å¯ä½œä¸ºç‹¬ç«‹é›†ç¾¤éƒ¨ç½²ï¼ˆéœ€è¦ç›¸åº”å­˜å‚¨å±‚çš„é…åˆï¼‰ï¼Œæˆ–å¯ä¸ Hadoop é›†æˆå¹¶å–ä»£ MapReduce å¼•æ“ã€‚ Spark Streaming æ˜¯ Spark API æ ¸å¿ƒçš„æ‰©å±•ï¼Œå¯å®ç°å®æ—¶æ•°æ®çš„å¿«é€Ÿæ‰©å±•ï¼Œé«˜ååé‡ï¼Œå®¹é”™å¤„ç†ã€‚æ•°æ®å¯ä»¥ä»å¾ˆå¤šæ¥æºï¼ˆå¦‚ Kafkaã€Flumeã€Kinesis ç­‰ï¼‰ä¸­æå–ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡å¾ˆå¤šå‡½æ•°æ¥å¤„ç†è¿™äº›æ•°æ®ï¼Œå¤„ç†å®Œåçš„æ•°æ®å¯ä»¥ç›´æ¥å­˜å…¥æ•°æ®åº“æˆ–è€… Dashboard ç­‰ï¼Œå¦‚ä¸‹ä¸¤å›¾æ‰€ç¤ºã€‚ Spark Streaming çš„å†…éƒ¨å®ç°åŸç†æ˜¯æ¥æ”¶å®æ—¶è¾“å…¥æ•°æ®æµå¹¶å°†æ•°æ®åˆ†æˆæ‰¹å¤„ç†ï¼Œç„¶åç”± Spark å¼•æ“å¤„ç†ä»¥æ‰¹é‡ç”Ÿæˆæœ€ç»ˆç»“æœæµï¼Œä¹Ÿå°±æ˜¯å¸¸è¯´çš„ micro-batch æ¨¡å¼ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ Spark DStreams DStreams æ˜¯ Spark Streaming æä¾›çš„åŸºæœ¬çš„æŠ½è±¡ï¼Œå®ƒä»£è¡¨ä¸€ä¸ªè¿ç»­çš„æ•°æ®æµã€‚å®ƒè¦ä¹ˆæ˜¯ä»æºä¸­è·å–çš„è¾“å…¥æµï¼Œè¦ä¹ˆæ˜¯è¾“å…¥æµé€šè¿‡è½¬æ¢ç®—å­ç”Ÿæˆçš„å¤„ç†åçš„æ•°æ®æµã€‚åœ¨å†…éƒ¨å®ç°ä¸Šï¼ŒDStream ç”±è¿ç»­çš„åºåˆ—åŒ– RDD æ¥è¡¨ç¤ºï¼Œæ¯ä¸ª RDD å«æœ‰ä¸€æ®µæ—¶é—´é—´éš”å†…çš„æ•°æ®ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä»»ä½•å¯¹ DStreams çš„æ“ä½œéƒ½è½¬æ¢æˆäº†å¯¹ DStreams éšå«çš„ RDD çš„æ“ä½œã€‚ä¾‹å¦‚ flatMap æ“ä½œåº”ç”¨äº lines è¿™ä¸ª DStreams çš„æ¯ä¸ª RDDï¼Œç”Ÿæˆ words è¿™ä¸ª DStreams çš„ RDD è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š é€šè¿‡ Spark å¼•æ“è®¡ç®—è¿™äº›éšå« RDD çš„è½¬æ¢ç®—å­ã€‚DStreams æ“ä½œéšè—äº†å¤§éƒ¨åˆ†çš„ç»†èŠ‚ï¼Œå¹¶ä¸”ä¸ºäº†æ›´ä¾¿æ·ï¼Œä¸ºå¼€å‘è€…æä¾›äº†æ›´é«˜å±‚çš„ APIã€‚ Spark æ”¯æŒçš„æ»‘åŠ¨çª—å£ å®ƒå’Œ Flink çš„æ»‘åŠ¨çª—å£ç±»ä¼¼ï¼Œæ”¯æŒä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªä»£è¡¨çª—å£é•¿åº¦ï¼Œä¸€ä¸ªä»£è¡¨æ»‘åŠ¨é—´éš”ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ Spark æ”¯æŒæ›´å¤šçš„ API å› ä¸º Spark æ˜¯ä½¿ç”¨ Scala å¼€å‘çš„å±…å¤šï¼Œæ‰€ä»¥ä»å®˜æ–¹æ–‡æ¡£å°±å¯ä»¥çœ‹å¾—åˆ°å¯¹ Scala çš„ API æ”¯æŒçš„å¾ˆå¥½ï¼Œè€Œ Flink æºç å®ç°ä¸»è¦ä»¥ Java ä¸ºä¸»ï¼Œå› æ­¤ä¹Ÿå¯¹ Java API æ›´å‹å¥½ï¼Œä»ä¸¤è€…ç›®å‰æ”¯æŒçš„ API å‹å¥½ç¨‹åº¦ï¼Œåº”è¯¥æ˜¯ Spark æ›´å¥½ï¼Œå®ƒç›®å‰ä¹Ÿæ”¯æŒ Python APIï¼Œä½†æ˜¯ Flink æ–°ç‰ˆæœ¬ä¹Ÿåœ¨ä¸æ–­çš„æ”¯æŒ Python APIã€‚ Spark æ”¯æŒæ›´å¤šçš„ Machine Learning Lib ä½ å¯ä»¥å¾ˆè½»æ¾çš„ä½¿ç”¨ Spark MLlib æä¾›çš„æœºå™¨å­¦ä¹ ç®—æ³•ï¼Œç„¶åå°†è¿™äº›è¿™äº›æœºå™¨å­¦ä¹ ç®—æ³•æ¨¡å‹åº”ç”¨åœ¨æµæ•°æ®ä¸­ï¼Œç›®å‰ Flink Machine Learning è¿™å—çš„å†…å®¹è¿˜è¾ƒå°‘ï¼Œä¸è¿‡é˜¿é‡Œå®£ç§°ä¼šå¼€æºäº› Flink Machine Learning ç®—æ³•ï¼Œä¿æŒå’Œ Spark ç›®å‰å·²æœ‰çš„ç®—æ³•ä¸€è‡´ï¼Œæˆ‘è‡ªå·±åœ¨ GitHub ä¸Šçœ‹åˆ°ä¸€ä¸ªé˜¿é‡Œå¼€æºçš„ä»“åº“ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥çœ‹çœ‹ flink-ai-extendedã€‚ Spark Checkpoint Spark å’Œ Flink ä¸€æ ·éƒ½æ”¯æŒ Checkpointï¼Œä½†æ˜¯ Flink è¿˜æ”¯æŒ Savepointï¼Œä½ å¯ä»¥åœ¨åœæ­¢ Flink ä½œä¸šçš„æ—¶å€™ä½¿ç”¨ Savepoint å°†ä½œä¸šçš„çŠ¶æ€ä¿å­˜ä¸‹æ¥ï¼Œå½“ä½œä¸šé‡å¯çš„æ—¶å€™å†ä» Savepoint ä¸­å°†åœæ­¢ä½œä¸šé‚£ä¸ªæ—¶åˆ»çš„çŠ¶æ€æ¢å¤èµ·æ¥ï¼Œä¿æŒä½œä¸šçš„çŠ¶æ€å’Œä¹‹å‰ä¸€è‡´ã€‚ Spark SQL Spark é™¤äº† DataFrames å’Œ Datasets å¤–ï¼Œä¹Ÿè¿˜æœ‰ SQL APIï¼Œè¿™æ ·ä½ å°±å¯ä»¥é€šè¿‡ SQL æŸ¥è¯¢æ•°æ®ï¼Œå¦å¤– Spark SQL è¿˜å¯ä»¥ç”¨äºä» Hive ä¸­è¯»å–æ•°æ®ã€‚ ä» Spark å®˜ç½‘ä¹Ÿå¯ä»¥çœ‹åˆ°å¾ˆå¤šæ¯”è¾ƒå¥½çš„ç‰¹æ€§ï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€ä»‹ç»äº†ï¼Œå¦‚æœå¯¹ Spark æ„Ÿå…´è¶£çš„è¯ä¹Ÿå¯ä»¥å»å®˜ç½‘äº†è§£ä¸€ä¸‹å…·ä½“çš„ä½¿ç”¨æ–¹æ³•å’Œå®ç°åŸç†ã€‚ Spark Streaming ä¼˜ç¼ºç‚¹ 1ã€ä¼˜ç‚¹ Spark Streaming å†…éƒ¨çš„å®ç°å’Œè°ƒåº¦æ–¹å¼é«˜åº¦ä¾èµ– Spark çš„ DAG è°ƒåº¦å™¨å’Œ RDDï¼Œè¿™å°±å†³å®šäº† Spark Streaming çš„è®¾è®¡åˆè¡·å¿…é¡»æ˜¯ç²—ç²’åº¦æ–¹å¼çš„ï¼Œä¹Ÿå°±æ— æ³•åšåˆ°çœŸæ­£çš„å®æ—¶å¤„ç† Spark Streaming çš„ç²—ç²’åº¦æ‰§è¡Œæ–¹å¼ä½¿å…¶ç¡®ä¿â€œå¤„ç†ä¸”ä»…å¤„ç†ä¸€æ¬¡â€çš„ç‰¹æ€§ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥æ›´æ–¹ä¾¿åœ°å®ç°å®¹é”™æ¢å¤æœºåˆ¶ã€‚ ç”±äº Spark Streaming çš„ DStream æœ¬è´¨æ˜¯ RDD åœ¨æµå¼æ•°æ®ä¸Šçš„æŠ½è±¡ï¼Œå› æ­¤åŸºäº RDD çš„å„ç§æ“ä½œä¹Ÿæœ‰ç›¸åº”çš„åŸºäº DStream çš„ç‰ˆæœ¬ï¼Œè¿™æ ·å°±å¤§å¤§é™ä½äº†ç”¨æˆ·å¯¹äºæ–°æ¡†æ¶çš„å­¦ä¹ æˆæœ¬ï¼Œåœ¨äº†è§£ Spark çš„æƒ…å†µä¸‹ç”¨æˆ·å°†å¾ˆå®¹æ˜“ä½¿ç”¨ Spark Streamingã€‚ 2ã€ç¼ºç‚¹ Spark Streaming çš„ç²—ç²’åº¦å¤„ç†æ–¹å¼ä¹Ÿé€ æˆäº†ä¸å¯é¿å…çš„æ•°æ®å»¶è¿Ÿã€‚åœ¨ç»†ç²’åº¦å¤„ç†æ–¹å¼ä¸‹ï¼Œç†æƒ³æƒ…å†µä¸‹æ¯ä¸€æ¡è®°å½•éƒ½ä¼šè¢«å®æ—¶å¤„ç†ï¼Œè€Œåœ¨ Spark Streaming ä¸­ï¼Œæ•°æ®éœ€è¦æ±‡æ€»åˆ°ä¸€å®šçš„é‡åå†ä¸€æ¬¡æ€§å¤„ç†ï¼Œè¿™å°±å¢åŠ äº†æ•°æ®å¤„ç†çš„å»¶è¿Ÿï¼Œè¿™ç§å»¶è¿Ÿæ˜¯ç”±æ¡†æ¶çš„è®¾è®¡å¼•å…¥çš„ï¼Œå¹¶ä¸æ˜¯ç”±ç½‘ç»œæˆ–å…¶ä»–æƒ…å†µé€ æˆçš„ã€‚ ä½¿ç”¨çš„æ˜¯ Processing Time è€Œä¸æ˜¯ Event Time 1.3.4 Structured Streaming1.3.5 StormStorm æ ¸å¿ƒç»„ä»¶Storm æ ¸å¿ƒæ¦‚å¿µStorm æ•°æ®å¤„ç†æµç¨‹å›¾1.3.6 è®¡ç®—æ¡†æ¶å¯¹æ¯”Flink VS SparkFlink VS Stormå…¨éƒ¨å¯¹æ¯”ç»“æœåŠ å…¥çŸ¥è¯†æ˜Ÿçƒå¯ä»¥çœ‹åˆ°ä¸Šé¢æ–‡ç« ï¼šhttps://t.zsxq.com/vVjeMBY 1.3.7 å°ç»“ä¸åæ€å› åœ¨ 1.2 èŠ‚ä¸­å·²ç»å¯¹ Flink çš„ç‰¹æ€§åšäº†å¾ˆè¯¦ç»†çš„è®²è§£ï¼Œæ‰€ä»¥æœ¬èŠ‚ä¸»è¦ä»‹ç»å…¶ä»–å‡ ç§è®¡ç®—æ¡†æ¶ï¼ˆBlinkã€Sparkã€Spark Streamingã€Structured Streamingã€Stormï¼‰ï¼Œå¹¶å¯¹æ¯”åˆ†æäº†è¿™å‡ ç§æ¡†æ¶çš„ç‰¹ç‚¹ä¸ä¸åŒã€‚ä½ å¯¹è¿™å‡ ç§è®¡ç®—æ¡†æ¶ä¸­çš„å“ªä¸ªæœ€ç†Ÿæ‚‰å‘¢ï¼Ÿäº†è§£è¿‡å®ƒä»¬ä¹‹é—´çš„å·®å¼‚å—ï¼Ÿä½ æœ‰å‹æµ‹è¿‡å®ƒä»¬çš„å¤„ç†æ•°æ®çš„æ€§èƒ½å—ï¼Ÿ æœ¬ç« ç¬¬ä¸€èŠ‚ä»å…¬å¸çš„æ—¥å¸¸å®æ—¶è®¡ç®—éœ€æ±‚å‡ºå‘ï¼Œæ¥åˆ†æè¯¥å¦‚ä½•å»å®ç°è¿™ç§å®æ—¶éœ€æ±‚ï¼Œæ¥ç€å¯¹æ¯”äº†å®æ—¶è®¡ç®—ä¸ç¦»çº¿è®¡ç®—çš„åŒºåˆ«ï¼Œä»è€Œå¼•å‡ºäº†å®æ—¶è®¡ç®—çš„ä¼˜åŠ¿ï¼Œæ¥ç€å°±åœ¨ç¬¬äºŒèŠ‚å¼€å§‹ä»‹ç»æœ¬ä¹¦çš„é‡ç‚¹ â€”â€” å®æ—¶è®¡ç®—å¼•æ“ Flinkï¼ŒæŠŠ Flink çš„æ¶æ„ã€APIã€ç‰¹ç‚¹ã€ä¼˜åŠ¿ç­‰æ–¹é¢éƒ½åšäº†è®²è§£ï¼Œåœ¨ç¬¬ä¸‰èŠ‚ä¸­å¯¹æ¯”äº†å¸‚é¢ä¸Šç°æœ‰çš„è®¡ç®—æ¡†æ¶ï¼Œåˆ†åˆ«å¯¹è¿™äº›æ¡†æ¶åšäº†å¼‚åŒç‚¹å¯¹æ¯”ï¼Œæœ€åè¿˜æ±‡æ€»äº†å®ƒä»¬åœ¨å„ä¸ªæ–¹é¢çš„ä¼˜åŠ¿å’ŒåŠ£åŠ¿ï¼Œä»¥ä¾›å¤§å®¶å…¬å¸å†…éƒ¨çš„æŠ€æœ¯é€‰å‹ã€‚","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹â€”â€” å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—æ¡†æ¶ Flink","date":"2021-07-04T16:00:00.000Z","path":"2021/07/05/flink-in-action-1.2/","text":"1.2 å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—æ¡†æ¶ Flinkåœ¨ 1.1 èŠ‚ä¸­è®²è§£äº†æ—¥å¸¸å¼€å‘å¸¸è§çš„å®æ—¶éœ€æ±‚ï¼Œç„¶ååˆ†æäº†è¿™äº›éœ€æ±‚çš„å®ç°æ–¹å¼ï¼Œæ¥ç€å¯¹æ¯”äº†å®æ—¶è®¡ç®—å’Œç¦»çº¿è®¡ç®—ã€‚éšç€è¿™äº›å¹´å¤§æ•°æ®çš„é£é€Ÿå‘å±•ï¼Œä¹Ÿå‡ºç°äº†ä¸å°‘è®¡ç®—çš„æ¡†æ¶ï¼ˆHadoopã€Stormã€Sparkã€Flinkï¼‰ã€‚åœ¨ç½‘ä¸Šæœ‰äººå°†å¤§æ•°æ®è®¡ç®—å¼•æ“çš„å‘å±•åˆ†ä¸ºå››ä¸ªé˜¶æ®µã€‚ ç¬¬ä¸€ä»£ï¼šHadoop æ‰¿è½½çš„ MapReduce ç¬¬äºŒä»£ï¼šæ”¯æŒ DAGï¼ˆæœ‰å‘æ— ç¯å›¾ï¼‰æ¡†æ¶çš„è®¡ç®—å¼•æ“ Tez å’Œ Oozieï¼Œä¸»è¦è¿˜æ˜¯æ‰¹å¤„ç†ä»»åŠ¡ ç¬¬ä¸‰ä»£ï¼šæ”¯æŒ Job å†…éƒ¨çš„ DAGï¼ˆæœ‰å‘æ— ç¯å›¾ï¼‰ï¼Œä»¥ Spark ä¸ºä»£è¡¨ ç¬¬å››ä»£ï¼šå¤§æ•°æ®ç»Ÿä¸€è®¡ç®—å¼•æ“ï¼ŒåŒ…æ‹¬æµå¤„ç†ã€æ‰¹å¤„ç†ã€AIã€Machine Learningã€å›¾è®¡ç®—ç­‰ï¼Œä»¥ Flink ä¸ºä»£è¡¨ æˆ–è®¸ä¼šæœ‰äººä¸åŒæ„ä»¥ä¸Šçš„åˆ†ç±»ï¼Œç¬”è€…è§‰å¾—å…¶å®è¿™å¹¶ä¸é‡è¦çš„ï¼Œé‡è¦çš„æ˜¯ä½“ä¼šå„ä¸ªæ¡†æ¶çš„å·®å¼‚ï¼Œä»¥åŠæ›´é€‚åˆçš„åœºæ™¯ã€‚å¹¶è¿›è¡Œç†è§£ï¼Œæ²¡æœ‰å“ªä¸€ä¸ªæ¡†æ¶å¯ä»¥å®Œç¾çš„æ”¯æŒæ‰€æœ‰çš„åœºæ™¯ï¼Œä¹Ÿå°±ä¸å¯èƒ½æœ‰ä»»ä½•ä¸€ä¸ªæ¡†æ¶èƒ½å®Œå…¨å–ä»£å¦ä¸€ä¸ªã€‚ æœ¬æ–‡å°†å¯¹ Flink çš„æ•´ä½“æ¶æ„å’Œ Flink çš„å¤šç§ç‰¹æ€§åšä¸ªè¯¦ç»†çš„ä»‹ç»ï¼åœ¨è®² Flink ä¹‹å‰çš„è¯ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ æ•°æ®é›†ç±»å‹ å’Œ æ•°æ®è¿ç®—æ¨¡å‹ çš„ç§ç±»ã€‚ æ•°æ®é›†ç±»å‹æ•°æ®é›†ç±»å‹æœ‰åˆ†æ— ç©·å’Œæœ‰ç•Œæ•°æ®é›†ï¼š æ— ç©·æ•°æ®é›†ï¼šæ— ç©·çš„æŒç»­é›†æˆçš„æ•°æ®é›†åˆ æœ‰ç•Œæ•°æ®é›†ï¼šæœ‰é™ä¸ä¼šæ”¹å˜çš„æ•°æ®é›†åˆ é‚£ä¹ˆé‚£äº›å¸¸è§çš„æ— ç©·æ•°æ®é›†æœ‰å“ªäº›å‘¢ï¼Ÿ ç”¨æˆ·ä¸å®¢æˆ·ç«¯çš„å®æ—¶äº¤äº’æ•°æ® åº”ç”¨å®æ—¶äº§ç”Ÿçš„æ—¥å¿— é‡‘èå¸‚åœºçš„å®æ—¶äº¤æ˜“è®°å½• â€¦ æ•°æ®è¿ç®—æ¨¡å‹æ•°æ®è¿ç®—æ¨¡å‹æœ‰åˆ†æµå¼å¤„ç†å’Œæ‰¹å¤„ç†ï¼š æµå¼ï¼šåªè¦æ•°æ®ä¸€ç›´åœ¨äº§ç”Ÿï¼Œè®¡ç®—å°±æŒç»­åœ°è¿›è¡Œ æ‰¹å¤„ç†ï¼šåœ¨é¢„å…ˆå®šä¹‰çš„æ—¶é—´å†…è¿è¡Œè®¡ç®—ï¼Œå½“è®¡ç®—å®Œæˆæ—¶é‡Šæ”¾è®¡ç®—æœºèµ„æº é‚£ä¹ˆæˆ‘ä»¬å†æ¥çœ‹çœ‹ Flink å®ƒæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ 1.2.1 Flink ç®€ä»‹Flink æ˜¯ä¸€ä¸ªé’ˆå¯¹æµæ•°æ®å’Œæ‰¹æ•°æ®çš„åˆ†å¸ƒå¼å¤„ç†å¼•æ“ï¼Œä»£ç ä¸»è¦æ˜¯ç”± Java å®ç°ï¼Œéƒ¨åˆ†ä»£ç æ˜¯ Scalaã€‚å®ƒå¯ä»¥å¤„ç†æœ‰ç•Œçš„æ‰¹é‡æ•°æ®é›†ã€ä¹Ÿå¯ä»¥å¤„ç†æ— ç•Œçš„å®æ—¶æ•°æ®é›†ï¼Œæ€»ç»“å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚å¯¹ Flink è€Œè¨€ï¼Œå…¶æ‰€è¦å¤„ç†çš„ä¸»è¦åœºæ™¯å°±æ˜¯æµæ•°æ®ï¼Œæ‰¹æ•°æ®åªæ˜¯æµæ•°æ®çš„ä¸€ä¸ªæé™ç‰¹ä¾‹è€Œå·²ï¼Œæ‰€ä»¥ Flink ä¹Ÿæ˜¯ä¸€æ¬¾çœŸæ­£çš„æµæ‰¹ç»Ÿä¸€çš„è®¡ç®—å¼•æ“ã€‚ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒFlink æä¾›äº† Stateã€Checkpointã€Timeã€Window ç­‰ï¼Œå®ƒä»¬ä¸º Flink æä¾›äº†åŸºçŸ³ï¼Œæœ¬ç¯‡æ–‡ç« ä¸‹é¢ä¼šç¨ä½œè®²è§£ï¼Œå…·ä½“æ·±åº¦åˆ†æåé¢ä¼šæœ‰ä¸“é—¨çš„æ–‡ç« æ¥è®²è§£ã€‚ 1.2.2 Flink æ•´ä½“æ¶æ„Flink æ•´ä½“æ¶æ„ä»ä¸‹è‡³ä¸Šåˆ†ä¸ºï¼š éƒ¨ç½²ï¼šFlink æ”¯æŒæœ¬åœ°è¿è¡Œï¼ˆIDE ä¸­ç›´æ¥è¿è¡Œç¨‹åºï¼‰ã€èƒ½åœ¨ç‹¬ç«‹é›†ç¾¤ï¼ˆStandalone æ¨¡å¼ï¼‰æˆ–è€…åœ¨è¢« YARNã€Mesosã€K8s ç®¡ç†çš„é›†ç¾¤ä¸Šè¿è¡Œï¼Œä¹Ÿèƒ½éƒ¨ç½²åœ¨äº‘ä¸Šã€‚ è¿è¡Œï¼šFlink çš„æ ¸å¿ƒæ˜¯åˆ†å¸ƒå¼æµå¼æ•°æ®å¼•æ“ï¼Œæ„å‘³ç€æ•°æ®ä»¥ä¸€æ¬¡ä¸€ä¸ªäº‹ä»¶çš„å½¢å¼è¢«å¤„ç†ã€‚ APIï¼šDataStreamã€DataSetã€Table API &amp; SQLã€‚ æ‰©å±•åº“ï¼šFlink è¿˜åŒ…æ‹¬ç”¨äº CEPï¼ˆå¤æ‚äº‹ä»¶å¤„ç†ï¼‰ã€æœºå™¨å­¦ä¹ ã€å›¾å½¢å¤„ç†ç­‰åœºæ™¯ã€‚ æ•´ä½“æ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 1.2.3 Flink çš„å¤šç§æ–¹å¼éƒ¨ç½²ä½œä¸ºä¸€ä¸ªè®¡ç®—å¼•æ“ï¼Œå¦‚æœè¦åšçš„è¶³å¤Ÿå®Œå–„ï¼Œé™¤äº†å®ƒè‡ªèº«çš„å„ç§ç‰¹ç‚¹è¦åŒ…å«ï¼Œè¿˜å¾—æ”¯æŒå„ç§ç”Ÿæ€åœˆï¼Œæ¯”å¦‚éƒ¨ç½²çš„æƒ…å†µï¼ŒFlink æ˜¯æ”¯æŒä»¥ Standaloneã€YARNã€Kubernetesã€Mesos ç­‰å½¢å¼éƒ¨ç½²çš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ æ¯ç§éƒ¨ç½²æ–¹å¼ä»‹ç»å¦‚ä¸‹ï¼š Localï¼šç›´æ¥åœ¨ IDE ä¸­è¿è¡Œ Flink Job æ—¶åˆ™ä¼šåœ¨æœ¬åœ°å¯åŠ¨ä¸€ä¸ª mini Flink é›†ç¾¤ã€‚ Standaloneï¼šåœ¨ Flink ç›®å½•ä¸‹æ‰§è¡Œ bin/start-cluster.sh è„šæœ¬åˆ™ä¼šå¯åŠ¨ä¸€ä¸ª Standalone æ¨¡å¼çš„é›†ç¾¤ã€‚ YARNï¼šYARN æ˜¯ Hadoop é›†ç¾¤çš„èµ„æºç®¡ç†ç³»ç»Ÿï¼Œå®ƒå¯ä»¥åœ¨ç¾¤é›†ä¸Šè¿è¡Œå„ç§åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºï¼ŒFlink å¯ä¸å…¶ä»–åº”ç”¨å¹¶è¡Œäº YARN ä¸­ï¼ŒFlink on YARN çš„æ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ Kubernetesï¼šKubernetes æ˜¯ Google å¼€æºçš„å®¹å™¨é›†ç¾¤ç®¡ç†ç³»ç»Ÿï¼Œåœ¨ Docker æŠ€æœ¯çš„åŸºç¡€ä¸Šï¼Œä¸ºå®¹å™¨åŒ–çš„åº”ç”¨æä¾›éƒ¨ç½²è¿è¡Œã€èµ„æºè°ƒåº¦ã€æœåŠ¡å‘ç°å’ŒåŠ¨æ€ä¼¸ç¼©ç­‰ä¸€ç³»åˆ—å®Œæ•´åŠŸèƒ½ï¼Œæé«˜äº†å¤§è§„æ¨¡å®¹å™¨é›†ç¾¤ç®¡ç†çš„ä¾¿æ·æ€§ï¼ŒFlink ä¹Ÿæ”¯æŒéƒ¨ç½²åœ¨ Kubernetes ä¸Šï¼Œåœ¨ GitHub çœ‹åˆ°æœ‰ä¸‹é¢è¿™ç§è¿è¡Œæ¶æ„çš„ã€‚ é€šå¸¸ä¸Šé¢å››ç§å±…å¤šï¼Œå¦å¤–è¿˜æ”¯æŒ AWSã€MapRã€Aliyun OSS ç­‰ã€‚ 1.2.4 Flink åˆ†å¸ƒå¼è¿è¡Œæµç¨‹Flink ä½œä¸šæäº¤æ¶æ„æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å…·ä½“æµç¨‹ä»‹ç»å¦‚ä¸‹ï¼š Program Codeï¼šæˆ‘ä»¬ç¼–å†™çš„ Flink åº”ç”¨ç¨‹åºä»£ç  Job Clientï¼šJob Client ä¸æ˜¯ Flink ç¨‹åºæ‰§è¡Œçš„å†…éƒ¨éƒ¨åˆ†ï¼Œä½†å®ƒæ˜¯ä»»åŠ¡æ‰§è¡Œçš„èµ·ç‚¹ã€‚ Job Client è´Ÿè´£æ¥å—ç”¨æˆ·çš„ç¨‹åºä»£ç ï¼Œç„¶ååˆ›å»ºæ•°æ®æµï¼Œå°†æ•°æ®æµæäº¤ç»™ JobManager ä»¥ä¾¿è¿›ä¸€æ­¥æ‰§è¡Œã€‚ æ‰§è¡Œå®Œæˆåï¼ŒJob Client å°†ç»“æœè¿”å›ç»™ç”¨æˆ· JobManagerï¼šä¸»è¿›ç¨‹ï¼ˆä¹Ÿç§°ä¸ºä½œä¸šç®¡ç†å™¨ï¼‰åè°ƒå’Œç®¡ç†ç¨‹åºçš„æ‰§è¡Œã€‚ å®ƒçš„ä¸»è¦èŒè´£åŒ…æ‹¬å®‰æ’ä»»åŠ¡ï¼Œç®¡ç† Checkpoint ï¼Œæ•…éšœæ¢å¤ç­‰ã€‚æœºå™¨é›†ç¾¤ä¸­è‡³å°‘è¦æœ‰ä¸€ä¸ª masterï¼Œmaster è´Ÿè´£è°ƒåº¦ taskï¼Œåè°ƒ Checkpoints å’Œå®¹ç¾ï¼Œé«˜å¯ç”¨è®¾ç½®çš„è¯å¯ä»¥æœ‰å¤šä¸ª masterï¼Œä½†è¦ä¿è¯ä¸€ä¸ªæ˜¯ leader, å…¶ä»–æ˜¯ standby; JobManager åŒ…å« Actor systemã€Schedulerã€Check pointing ä¸‰ä¸ªé‡è¦çš„ç»„ä»¶ TaskManagerï¼šä» JobManager å¤„æ¥æ”¶éœ€è¦éƒ¨ç½²çš„ Taskã€‚TaskManager æ˜¯åœ¨ JVM ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œä»»åŠ¡çš„å·¥ä½œèŠ‚ç‚¹ã€‚ ä»»åŠ¡æ‰§è¡Œçš„å¹¶è¡Œæ€§ç”±æ¯ä¸ª TaskManager ä¸Šå¯ç”¨çš„ä»»åŠ¡æ§½ï¼ˆSlot ä¸ªæ•°ï¼‰å†³å®šã€‚ æ¯ä¸ªä»»åŠ¡ä»£è¡¨åˆ†é…ç»™ä»»åŠ¡æ§½çš„ä¸€ç»„èµ„æºã€‚ ä¾‹å¦‚ï¼Œå¦‚æœ TaskManager æœ‰å››ä¸ªæ’æ§½ï¼Œé‚£ä¹ˆå®ƒå°†ä¸ºæ¯ä¸ªæ’æ§½åˆ†é… 25ï¼… çš„å†…å­˜ã€‚ å¯ä»¥åœ¨ä»»åŠ¡æ§½ä¸­è¿è¡Œä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ã€‚ åŒä¸€æ’æ§½ä¸­çš„çº¿ç¨‹å…±äº«ç›¸åŒçš„ JVMã€‚åŒä¸€ JVM ä¸­çš„ä»»åŠ¡å…±äº« TCP è¿æ¥å’Œå¿ƒè·³æ¶ˆæ¯ã€‚TaskManager çš„ä¸€ä¸ª Slot ä»£è¡¨ä¸€ä¸ªå¯ç”¨çº¿ç¨‹ï¼Œè¯¥çº¿ç¨‹å…·æœ‰å›ºå®šçš„å†…å­˜ï¼Œæ³¨æ„ Slot åªå¯¹å†…å­˜éš”ç¦»ï¼Œæ²¡æœ‰å¯¹ CPU éš”ç¦»ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒFlink å…è®¸å­ä»»åŠ¡å…±äº« Slotï¼Œå³ä½¿å®ƒä»¬æ˜¯ä¸åŒ task çš„ subtaskï¼Œåªè¦å®ƒä»¬æ¥è‡ªç›¸åŒçš„ jobã€‚è¿™ç§å…±äº«å¯ä»¥æœ‰æ›´å¥½çš„èµ„æºåˆ©ç”¨ç‡ã€‚ 1.2.5 Flink APIFlink æä¾›äº†ä¸åŒçš„æŠ½è±¡çº§åˆ«çš„ API ä»¥å¼€å‘æµå¼æˆ–æ‰¹å¤„ç†åº”ç”¨ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ è¿™å››ç§ API åŠŸèƒ½åˆ†åˆ«æ˜¯ï¼š æœ€åº•å±‚æä¾›äº†æœ‰çŠ¶æ€æµã€‚å®ƒå°†é€šè¿‡ Process Function åµŒå…¥åˆ° DataStream API ä¸­ã€‚å®ƒå…è®¸ç”¨æˆ·å¯ä»¥è‡ªç”±åœ°å¤„ç†æ¥è‡ªä¸€ä¸ªæˆ–å¤šä¸ªæµæ•°æ®çš„äº‹ä»¶ï¼Œå¹¶ä½¿ç”¨ä¸€è‡´æ€§ã€å®¹é”™çš„çŠ¶æ€ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œç”¨æˆ·å¯ä»¥æ³¨å†Œäº‹ä»¶æ—¶é—´å’Œå¤„ç†äº‹ä»¶å›è°ƒï¼Œä»è€Œä½¿ç¨‹åºå¯ä»¥å®ç°å¤æ‚çš„è®¡ç®—ã€‚ DataStream / DataSet API æ˜¯ Flink æä¾›çš„æ ¸å¿ƒ API ï¼ŒDataSet å¤„ç†æœ‰ç•Œçš„æ•°æ®é›†ï¼ŒDataStream å¤„ç†æœ‰ç•Œæˆ–è€…æ— ç•Œçš„æ•°æ®æµã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡å„ç§æ–¹æ³•ï¼ˆmap / flatmap / window / keyby / sum / max / min / avg / join ç­‰ï¼‰å°†æ•°æ®è¿›è¡Œè½¬æ¢æˆ–è€…è®¡ç®—ã€‚ Table API æ˜¯ä»¥è¡¨ä¸ºä¸­å¿ƒçš„å£°æ˜å¼ DSLï¼Œå…¶ä¸­è¡¨å¯èƒ½ä¼šåŠ¨æ€å˜åŒ–ï¼ˆåœ¨è¡¨è¾¾æµæ•°æ®æ—¶ï¼‰ã€‚Table API æä¾›äº†ä¾‹å¦‚ selectã€projectã€joinã€group-byã€aggregate ç­‰æ“ä½œï¼Œä½¿ç”¨èµ·æ¥å´æ›´åŠ ç®€æ´ï¼ˆä»£ç é‡æ›´å°‘ï¼‰ã€‚ä½ å¯ä»¥åœ¨è¡¨ä¸ DataStream/DataSet ä¹‹é—´æ— ç¼åˆ‡æ¢ï¼Œä¹Ÿå…è®¸ç¨‹åºå°† Table API ä¸ DataStream ä»¥åŠ DataSet æ··åˆä½¿ç”¨ã€‚ Flink æä¾›çš„æœ€é«˜å±‚çº§çš„æŠ½è±¡æ˜¯ SQL ã€‚è¿™ä¸€å±‚æŠ½è±¡åœ¨è¯­æ³•ä¸è¡¨è¾¾èƒ½åŠ›ä¸Šä¸ Table API ç±»ä¼¼ï¼Œä½†æ˜¯æ˜¯ä»¥ SQLæŸ¥è¯¢è¡¨è¾¾å¼çš„å½¢å¼è¡¨ç°ç¨‹åºã€‚SQL æŠ½è±¡ä¸ Table API äº¤äº’å¯†åˆ‡ï¼ŒåŒæ—¶ SQL æŸ¥è¯¢å¯ä»¥ç›´æ¥åœ¨ Table API å®šä¹‰çš„è¡¨ä¸Šæ‰§è¡Œã€‚ Flink é™¤äº† DataStream å’Œ DataSet APIï¼Œå®ƒè¿˜æ”¯æŒ Table API &amp; SQLï¼ŒFlink ä¹Ÿå°†é€šè¿‡ SQL æ¥æ„å»ºç»Ÿä¸€çš„å¤§æ•°æ®æµæ‰¹å¤„ç†å¼•æ“ï¼Œå› ä¸ºåœ¨å…¬å¸ä¸­é€šå¸¸ä¼šæœ‰é‚£ç§æ¯å¤©å®šæ—¶ç”ŸæˆæŠ¥è¡¨çš„éœ€æ±‚ï¼ˆæ‰¹å¤„ç†çš„åœºæ™¯ï¼Œæ¯æ™šå®šæ—¶è·‘ä¸€éæ˜¨å¤©çš„æ•°æ®ç”Ÿæˆä¸€ä¸ªç»“æœæŠ¥è¡¨ï¼‰ï¼Œä½†æ˜¯ä¹Ÿæ˜¯ä¼šæœ‰æµå¤„ç†çš„åœºæ™¯ï¼ˆæ¯”å¦‚é‡‡ç”¨ Flink æ¥åšå®æ—¶æ€§è¦æ±‚å¾ˆé«˜çš„éœ€æ±‚ï¼‰ï¼Œäºæ˜¯æ…¢æ…¢çš„æ•´ä¸ªå…¬å¸çš„æŠ€æœ¯é€‰å‹å°±å˜å¾—è¶Šæ¥è¶Šå¤šäº†ï¼Œè¿™æ ·å¼€å‘äººå‘˜ä¹Ÿå°±è¦é¢ä¸´ç€å­¦ä¹ ä¸¤å¥—ä¸ä¸€æ ·çš„æŠ€æœ¯æ¡†æ¶ï¼Œè¿ç»´äººå‘˜ä¹Ÿéœ€è¦å¯¹ä¸¤ç§ä¸ä¸€æ ·çš„æ¡†æ¶è¿›è¡Œç¯å¢ƒæ­å»ºå’Œä½œä¸šéƒ¨ç½²ï¼Œå¹³æ—¶è¿˜è¦ç»´æŠ¤ä½œä¸šçš„ç¨³å®šæ€§ã€‚å½“æˆ‘ä»¬çš„ç³»ç»Ÿå˜å¾—è¶Šæ¥è¶Šå¤æ‚äº†ï¼Œä½œä¸šè¶Šæ¥è¶Šå¤šäº†ï¼Œè¿™å¯¹äºå¼€å‘äººå‘˜å’Œè¿ç»´æ¥è¯´ç®€ç›´å°±æ˜¯å™©æ¢¦ï¼Œæ²¡å‡†å“ªå¤©å‡Œæ™¨æ™šä¸Šå°±è¢«ç”Ÿäº§ç¯å¢ƒçš„å‘Šè­¦ç”µè¯ç»™å«é†’ã€‚æ‰€ä»¥ Flink ç³»ç»Ÿèƒ½é€šè¿‡ SQL API æ¥è§£å†³æ‰¹æµç»Ÿä¸€çš„ç—›ç‚¹ï¼Œè¿™æ ·ä¸ç®¡æ˜¯å¼€å‘è¿˜æ˜¯è¿ç»´ï¼Œä»–ä»¬åªéœ€è¦å…³æ³¨ä¸€ä¸ªè®¡ç®—æ¡†æ¶å°±è¡Œï¼Œä»è€Œå‡å°‘ä¼ä¸šçš„ç”¨äººæˆæœ¬å’ŒåæœŸå¼€å‘è¿ç»´æˆæœ¬ã€‚ 1.2.6 Flink ç¨‹åºä¸æ•°æ®æµç»“æ„ä¸€ä¸ªå®Œæ•´çš„ Flink åº”ç”¨ç¨‹åºç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å®ƒä»¬çš„åŠŸèƒ½åˆ†åˆ«æ˜¯ï¼š Sourceï¼šæ•°æ®è¾“å…¥ï¼ŒFlink åœ¨æµå¤„ç†å’Œæ‰¹å¤„ç†ä¸Šçš„ source å¤§æ¦‚æœ‰ 4 ç±»ï¼šåŸºäºæœ¬åœ°é›†åˆçš„ sourceã€åŸºäºæ–‡ä»¶çš„ sourceã€åŸºäºç½‘ç»œå¥—æ¥å­—çš„ sourceã€è‡ªå®šä¹‰çš„ sourceã€‚è‡ªå®šä¹‰çš„ source å¸¸è§çš„æœ‰ Apache kafkaã€Amazon Kinesis Streamsã€RabbitMQã€Twitter Streaming APIã€Apache NiFi ç­‰ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥å®šä¹‰è‡ªå·±çš„ sourceã€‚ Transformationï¼šæ•°æ®è½¬æ¢çš„å„ç§æ“ä½œï¼Œæœ‰ Map / FlatMap / Filter / KeyBy / Reduce / Fold / Aggregations / Window / WindowAll / Union / Window join / Split / Select / Project ç­‰ï¼Œæ“ä½œå¾ˆå¤šï¼Œå¯ä»¥å°†æ•°æ®è½¬æ¢è®¡ç®—æˆä½ æƒ³è¦çš„æ•°æ®ã€‚ Sinkï¼šæ•°æ®è¾“å‡ºï¼ŒFlink å°†è½¬æ¢è®¡ç®—åçš„æ•°æ®å‘é€çš„åœ°ç‚¹ ï¼Œä½ å¯èƒ½éœ€è¦å­˜å‚¨ä¸‹æ¥ï¼ŒFlink å¸¸è§çš„ Sink å¤§æ¦‚æœ‰å¦‚ä¸‹å‡ ç±»ï¼šå†™å…¥æ–‡ä»¶ã€æ‰“å°å‡ºæ¥ã€å†™å…¥ socket ã€è‡ªå®šä¹‰çš„ sink ã€‚è‡ªå®šä¹‰çš„ sink å¸¸è§çš„æœ‰ Apache kafkaã€RabbitMQã€MySQLã€ElasticSearchã€Apache Cassandraã€Hadoop FileSystem ç­‰ï¼ŒåŒç†ä½ ä¹Ÿå¯ä»¥å®šä¹‰è‡ªå·±çš„ sinkã€‚ ä»£ç ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 1.2.7 ä¸°å¯Œçš„ Connectoré€šè¿‡æºç å¯ä»¥å‘ç°ä¸åŒç‰ˆæœ¬çš„ Kafkaã€ä¸åŒç‰ˆæœ¬çš„ ElasticSearchã€Cassandraã€HBaseã€Hiveã€HDFSã€RabbitMQ éƒ½æ˜¯æ”¯æŒçš„ï¼Œé™¤äº†æµåº”ç”¨çš„ Connector æ˜¯æ”¯æŒçš„ï¼Œå¦å¤–è¿˜æ”¯æŒ SQLï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ å†å°±æ˜¯è¦è€ƒè™‘è®¡ç®—çš„æ•°æ®æ¥æºå’Œæ•°æ®æœ€ç»ˆå­˜å‚¨ï¼Œå› ä¸º Flink åœ¨å¤§æ•°æ®é¢†åŸŸçš„çš„å®šä½å°±æ˜¯å®æ—¶è®¡ç®—ï¼Œå®ƒä¸åšå­˜å‚¨ï¼ˆè™½ç„¶ Flink ä¸­ä¹Ÿæœ‰ State å»å­˜å‚¨çŠ¶æ€æ•°æ®ï¼Œè¿™é‡Œè¯´çš„å­˜å‚¨ç±»ä¼¼äº MySQLã€ElasticSearch ç­‰å­˜å‚¨ï¼‰ï¼Œæ‰€ä»¥åœ¨è®¡ç®—çš„æ—¶å€™å…¶å®ä½ éœ€è¦è€ƒè™‘çš„æ˜¯æ•°æ®æºæ¥è‡ªå“ªé‡Œï¼Œè®¡ç®—åçš„ç»“æœåˆå­˜å‚¨åˆ°å“ªé‡Œå»ã€‚åº†å¹¸çš„æ˜¯ Flink ç›®å‰å·²ç»æ”¯æŒå¤§éƒ¨åˆ†å¸¸ç”¨çš„ç»„ä»¶äº†ï¼Œæ¯”å¦‚åœ¨ Flink ä¸­å·²ç»æ”¯æŒäº†å¦‚ä¸‹è¿™äº› Connectorï¼š ä¸åŒç‰ˆæœ¬çš„ Kafka ä¸åŒç‰ˆæœ¬çš„ ElasticSearch Redis MySQL Cassandra RabbitMQ HBase HDFS â€¦ è¿™äº› Connector é™¤äº†æ”¯æŒæµä½œä¸šå¤–ï¼Œç›®å‰è¿˜æœ‰è¿˜æœ‰æ”¯æŒ SQL ä½œä¸šçš„ï¼Œé™¤äº†è¿™äº›è‡ªå¸¦çš„ Connector å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡ Flink æä¾›çš„æ¥å£åšè‡ªå®šä¹‰ Source å’Œ Sinkï¼ˆåœ¨ 3.8 èŠ‚ä¸­ï¼‰ã€‚ 1.2.8 äº‹ä»¶æ—¶é—´&amp;å¤„ç†æ—¶é—´è¯­ä¹‰Flink æ”¯æŒå¤šç§ Timeï¼Œæ¯”å¦‚ Event timeã€Ingestion Timeã€Processing Timeï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåé¢ 3.1 èŠ‚ä¸­ä¼šå¾ˆè¯¦ç»†çš„è®²è§£ Flink ä¸­ Time çš„æ¦‚å¿µã€‚ 1.2.9 çµæ´»çš„çª—å£æœºåˆ¶Flink æ”¯æŒå¤šç§ Windowï¼Œæ¯”å¦‚ Time Windowã€Count Windowã€Session Windowï¼Œè¿˜æ”¯æŒè‡ªå®šä¹‰ Windowï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚åé¢ 3.2 èŠ‚ä¸­ä¼šå¾ˆè¯¦ç»†çš„è®²è§£ Flink ä¸­ Window çš„æ¦‚å¿µã€‚ 1.2.10 å¹¶è¡Œæ‰§è¡Œä»»åŠ¡æœºåˆ¶Flink çš„ç¨‹åºå†…åœ¨æ˜¯å¹¶è¡Œå’Œåˆ†å¸ƒå¼çš„ï¼Œæ•°æ®æµå¯ä»¥è¢«åˆ†åŒºæˆ stream partitionsï¼Œoperators è¢«åˆ’åˆ†ä¸º operator subtasks; è¿™äº› subtasks åœ¨ä¸åŒçš„æœºå™¨æˆ–å®¹å™¨ä¸­åˆ†ä¸åŒçš„çº¿ç¨‹ç‹¬ç«‹è¿è¡Œï¼›operator subtasks çš„æ•°é‡åœ¨å…·ä½“çš„ operator å°±æ˜¯å¹¶è¡Œè®¡ç®—æ•°ï¼Œç¨‹åºä¸åŒçš„ operator é˜¶æ®µå¯èƒ½æœ‰ä¸åŒçš„å¹¶è¡Œæ•°ï¼›å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œsource operator çš„å¹¶è¡Œæ•°ä¸º 2ï¼Œä½†æœ€åçš„ sink operator ä¸º 1ï¼š 1.2.11 çŠ¶æ€å­˜å‚¨å’Œå®¹é”™Flink æ˜¯ä¸€æ¬¾æœ‰çŠ¶æ€çš„æµå¤„ç†æ¡†æ¶ï¼Œå®ƒæä¾›äº†ä¸°å¯Œçš„çŠ¶æ€è®¿é—®æ¥å£ï¼ŒæŒ‰ç…§æ•°æ®çš„åˆ’åˆ†æ–¹å¼ï¼Œå¯ä»¥åˆ†ä¸º Keyed State å’Œ Operator Stateï¼Œåœ¨ Keyed State ä¸­åˆæä¾›äº†å¤šç§æ•°æ®ç»“æ„ï¼š ValueState MapState ListState ReducingState AggregatingState å¦å¤–çŠ¶æ€å­˜å‚¨ä¹Ÿæ”¯æŒå¤šç§æ–¹å¼ï¼š MemoryStateBackendï¼šå­˜å‚¨åœ¨å†…å­˜ä¸­ FsStateBackendï¼šå­˜å‚¨åœ¨æ–‡ä»¶ä¸­ RocksDBStateBackendï¼šå­˜å‚¨åœ¨ RocksDB ä¸­ Flink ä¸­æ”¯æŒä½¿ç”¨ Checkpoint æ¥æé«˜ç¨‹åºçš„å¯é æ€§ï¼Œå¼€å¯äº† Checkpoint ä¹‹åï¼ŒFlink ä¼šæŒ‰ç…§ä¸€å®šçš„æ—¶é—´é—´éš”å¯¹ç¨‹åºçš„è¿è¡ŒçŠ¶æ€è¿›è¡Œå¤‡ä»½ï¼Œå½“å‘ç”Ÿæ•…éšœæ—¶ï¼ŒFlink ä¼šå°†æ‰€æœ‰ä»»åŠ¡çš„çŠ¶æ€æ¢å¤è‡³æœ€åä¸€æ¬¡å‘ç”Ÿ Checkpoint ä¸­çš„çŠ¶æ€ï¼Œå¹¶ä»é‚£é‡Œå¼€å§‹é‡æ–°å¼€å§‹æ‰§è¡Œã€‚å¦å¤– Flink è¿˜æ”¯æŒæ ¹æ® Savepoint ä»å·²åœæ­¢ä½œä¸šçš„è¿è¡ŒçŠ¶æ€è¿›è¡Œæ¢å¤ï¼Œè¿™ç§æ–¹å¼éœ€è¦é€šè¿‡å‘½ä»¤è¿›è¡Œè§¦å‘ã€‚ 1.2.12 è‡ªå·±çš„å†…å­˜ç®¡ç†æœºåˆ¶Flink å¹¶ä¸æ˜¯ç›´æ¥æŠŠå¯¹è±¡å­˜æ”¾åœ¨å †å†…å­˜ä¸Šï¼Œè€Œæ˜¯å°†å¯¹è±¡åºåˆ—åŒ–ä¸ºå›ºå®šæ•°é‡çš„é¢„å…ˆåˆ†é…çš„å†…å­˜æ®µã€‚å®ƒé‡‡ç”¨ç±»ä¼¼ DBMS çš„æ’åºå’Œè¿æ¥ç®—æ³•ï¼Œå¯ä»¥ç›´æ¥æ“ä½œäºŒè¿›åˆ¶æ•°æ®ï¼Œä»¥æ­¤å°†åºåˆ—åŒ–å’Œååºåˆ—åŒ–å¼€é”€é™åˆ°æœ€ä½ã€‚å¦‚æœéœ€è¦å¤„ç†çš„æ•°æ®å®¹é‡è¶…è¿‡å†…å­˜ï¼Œé‚£ä¹ˆ Flink çš„è¿ç®—ç¬¦ä¼šå°†éƒ¨åˆ†æ•°æ®å­˜å‚¨åˆ°ç£ç›˜ã€‚Flink çš„ä¸»åŠ¨å†…å­˜ç®¡ç†å’Œæ“ä½œäºŒè¿›åˆ¶æ•°æ®æœ‰å‡ ä¸ªå¥½å¤„ï¼š ä¿è¯å†…å­˜å¯æ§ï¼Œå¯ä»¥é˜²æ­¢ OutOfMemoryError å‡å°‘åƒåœ¾æ”¶é›†å‹åŠ› èŠ‚çœæ•°æ®çš„å­˜å‚¨ç©ºé—´ é«˜æ•ˆçš„äºŒè¿›åˆ¶æ“ä½œ Flink æ˜¯å¦‚ä½•åˆ†é…å†…å­˜ã€å°†å¯¹è±¡è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–ä»¥åŠå¯¹äºŒè¿›åˆ¶æ•°æ®è¿›è¡Œæ“ä½œçš„ï¼Œå¯ä»¥å‚è€ƒæ–‡ç«  Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ ï¼Œè¯¥æ–‡ä¸­è®²è§£äº† Flink çš„å†…å­˜ç®¡ç†æœºåˆ¶ã€‚ 1.2.13 å¤šç§æ‰©å±•åº“Flink æ‰©å±•åº“ä¸­å«æœ‰æœºå™¨å­¦ä¹ ã€Gelly å›¾å½¢å¤„ç†ã€CEP å¤æ‚äº‹ä»¶å¤„ç†ã€State Processing API ç­‰ï¼Œè¿™äº›æ‰©å±•åº“åœ¨ä¸€äº›ç‰¹æ®Šåœºæ™¯ä¸‹ä¼šæ¯”è¾ƒé€‚ç”¨ï¼Œå…³äºè¿™å—å†…å®¹å¯ä»¥åœ¨ç¬¬å…­ç« æŸ¥çœ‹ã€‚ 1.2.14 å°ç»“ä¸åæ€æœ¬èŠ‚åœ¨å¼€å§‹ä»‹ç» Flink ä¹‹å‰å…ˆè®²è§£äº†ä¸‹æ•°æ®é›†ç±»å‹å’Œæ•°æ®è¿ç®—æ¨¡å‹ï¼Œæ¥ç€å¼€å§‹ä»‹ç» Flink çš„å„ç§ç‰¹æ€§ï¼Œå¯¹äºè¿™äº›ç‰¹æ€§ï¼Œä½ æ˜¯å¦æœ‰å’Œå…¶ä»–çš„è®¡ç®—æ¡†æ¶åšè¿‡å¯¹æ¯”ï¼Ÿ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹â€”â€”ä½ çš„å…¬å¸æ˜¯å¦éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ","date":"2021-07-03T16:00:00.000Z","path":"2021/07/04/flink-in-action-1.1/","text":"ç¬¬ä¸€ç«  â€”â€” å®æ—¶è®¡ç®—å¼•æ“æœ¬ç« ä¼šä»å…¬å¸å¸¸è§çš„è®¡ç®—éœ€æ±‚å»åˆ†æè¯¥å¦‚ä½•å®ç°è¿™äº›éœ€æ±‚ï¼Œæ¥ç€ä¼šå¯¹æ¯”åˆ†æå®æ—¶è®¡ç®—ä¸ç¦»çº¿è®¡ç®—ä¹‹é—´çš„åŒºåˆ«ï¼Œä»è€Œå¸®å¤§å®¶åˆ†æå…¬å¸æ˜¯å¦éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ã€‚æ¥ç€å°†ä¼šè¯¦ç»†çš„ä»‹ç»ç›®å‰æœ€ç«çš„å®æ—¶è®¡ç®—å¼•æ“ Flink çš„ç‰¹æ€§ï¼Œè®©å¤§å®¶çŸ¥é“å…¶ä¼˜ç‚¹ï¼Œæœ€åä¼šå¯¹æ¯”å…¶ä»–çš„è®¡ç®—æ¡†æ¶ï¼Œæ¯”å¦‚ Sparkã€Storm ç­‰ï¼Œå¸Œæœ›å¯ä»¥ä»å¯¹æ¯”ç»“æœæ¥åˆ†æè¿™å‡ ç§è®¡ç®—æ¡†æ¶çš„å„è‡ªä¼˜åŠ¿ï¼Œä»è€Œä¸ºä½ åšæŠ€æœ¯é€‰å‹æä¾›ä¸€ç‚¹å¸®åŠ©ã€‚ 1.1 ä½ çš„å…¬å¸æ˜¯å¦éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ å¤§æ•°æ®å‘å±•è‡³ä»Šï¼Œæ•°æ®å‘ˆæŒ‡æ•°å€çš„å¢é•¿ï¼Œå¯¹å®æ•ˆæ€§çš„è¦æ±‚ä¹Ÿè¶Šæ¥è¶Šé«˜ï¼Œæ‰€ä»¥ä½ å¯èƒ½æ¥è§¦åˆ°çš„å®æ—¶è®¡ç®—éœ€æ±‚ä¼šè¶Šæ¥è¶Šå¤šã€‚æœ¬ç« èŠ‚å°†ä»å®æ—¶è®¡ç®—éœ€æ±‚å¼€å§‹è®²èµ·ï¼Œç„¶åé˜è¿°å®Œæˆè¯¥éœ€æ±‚éœ€è¦åšçš„å·¥ä½œï¼Œæœ€åå¯¹æ¯”å®æ—¶è®¡ç®—ä¸ç¦»çº¿è®¡ç®—ã€‚ 1.1.1 å®æ—¶è®¡ç®—éœ€æ±‚åœ¨å…¬å¸é‡Œé¢ï¼Œä½ å¯èƒ½ä¼šæ”¶åˆ°é¢†å¯¼ã€äº§å“ç»ç†æˆ–è€…è¿è¥ç­‰æå‡ºçš„å¦‚ä¸‹éœ€æ±‚ï¼š 1234567891011121314151617å°ç”°ï¼Œä½ çœ‹èƒ½ä¸èƒ½åšä¸ªç›‘æ§å¤§å±å®æ—¶æŸ¥çœ‹ä¿ƒé”€æ´»åŠ¨å•†å“æ€»é”€å”®é¢ï¼ˆGMVï¼‰ï¼Ÿå°æœ±ï¼Œæä¿ƒé”€æ´»åŠ¨çš„æ—¶å€™èƒ½ä¸èƒ½å®æ—¶ç»Ÿè®¡ä¸‹ç½‘ç«™çš„ PV/UV å•Šï¼Ÿå°é¹ï¼Œæˆ‘ä»¬ç°åœ¨æä¿ƒé”€æ´»åŠ¨èƒ½ä¸èƒ½å®æ—¶ç»Ÿè®¡é”€é‡ Top5 å•†å“å•Šï¼Ÿå°æï¼Œæ€ä¹ˆå›äº‹å•Šï¼Ÿç°åœ¨æä¿ƒé”€æ´»åŠ¨ç»“æœæœåŠ¡å™¨å®•æœºäº†éƒ½æ²¡å‘Šè­¦ï¼Œèƒ½ä¸èƒ½åŠ ä¸€ä¸ªï¼Ÿå°åˆ˜ï¼ŒæœåŠ¡å™¨è¿™ä¼šå¥½å¡ï¼Œæ˜¯ä¸æ˜¯å‡ºäº†ä»€ä¹ˆé—®é¢˜å•Šï¼Œä½ çœ‹èƒ½ä¸èƒ½åšä¸ªç›‘æ§å¤§å±å®æ—¶æŸ¥çœ‹æœºå™¨çš„è¿è¡Œæƒ…å†µï¼Ÿå°èµµï¼Œæˆ‘ä»¬çº¿ä¸Šçš„åº”ç”¨é¢‘ç¹å‡ºç° Error æ—¥å¿—ï¼Œä½†æ˜¯åªæœ‰é äººè‚‰ä¸Šæœºå™¨æŸ¥çœ‹æ‰çŸ¥é“æƒ…å†µï¼Œèƒ½ä¸èƒ½åœ¨å‡ºç°é”™è¯¯çš„æ—¶å€™åŠæ—¶å‘Šè­¦é€šçŸ¥ï¼Ÿå°å¤ï¼Œæˆ‘ä»¬ 1 å…ƒç§’æ€ä¿ƒé”€æ´»åŠ¨ä¸­æœ‰ä»¶å•†å“è¢«æŸä¸ªç”¨æˆ·è–…äº† 100 ä»¶ï¼Œæ€ä¹ˆéƒ½æ²¡æœ‰é£æ§å•Šï¼Ÿå°å®‹ï¼Œä½ çœ‹æˆ‘ä»¬æä¿ƒé”€æ´»åŠ¨èƒ½ä¸èƒ½æ ¹æ®æ¯ä¸ªé¡¾å®¢çš„æµè§ˆè®°å½•å®æ—¶æ¨èä¸åŒçš„å•†å“å•Šï¼Ÿâ€¦â€¦ é‚£ä¸Šé¢è¿™äº›éœ€æ±‚åˆ†åˆ«å¯¹åº”ç€ä»€ä¹ˆä¸šåŠ¡åœºæ™¯å‘¢ï¼Ÿæˆ‘ä»¬æ¥æ€»ç»“ä¸‹ï¼Œå¤§æ¦‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š åˆçœ‹è¿™äº›éœ€æ±‚ï¼Œä½ æ˜¯ä¸æ˜¯æ„Ÿè§‰å®ç°ä¼šæ¯”è¾ƒéš¾ï¼Ÿé‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹è¯¥å¦‚ä½•å®ç°è¿™äº›éœ€æ±‚ï¼Ÿä»è¿™äº›éœ€æ±‚æ¥çœ‹ï¼Œæœ€æ ¹æœ¬çš„ä¸šåŠ¡éƒ½æ˜¯éœ€è¦å®æ—¶æŸ¥çœ‹æ•°æ®ä¿¡æ¯ï¼Œé‚£ä¹ˆé¦–å…ˆæˆ‘ä»¬å¾—æƒ³æƒ³å¦‚ä½•å®æ—¶å»é‡‡é›†æ•°æ®ï¼Œç„¶åå°†é‡‡é›†åˆ°çš„æ•°æ®è¿›è¡Œå®æ—¶çš„è®¡ç®—ï¼Œæœ€åå°†è®¡ç®—åçš„ç»“æœä¸‹å‘åˆ°ç¬¬ä¸‰æ–¹ã€‚ä»é‡‡é›†åˆ°è®¡ç®—å†åˆ°ä¸‹å‘è®¡ç®—ç»“æœçš„æ•´ä¸ªè¿‡ç¨‹ï¼Œå¿…é¡»éƒ½å¾—æ˜¯å®æ—¶çš„ï¼Œè¿™æ ·æˆ‘ä»¬çœ‹åˆ°çš„æ•°æ®æ‰æ˜¯æœ€æ¥è¿‘å®æ—¶çš„ï¼Œè¿™æ ·æ‰èƒ½å¤Ÿå¾ˆå®Œç¾çš„å®Œæˆä¸Šé¢çš„è¿™äº›å®æ—¶è®¡ç®—éœ€æ±‚ã€‚ 1.1.2 æ•°æ®å®æ—¶é‡‡é›†å°±ä¸Šé¢è¿™äº›éœ€æ±‚ï¼Œæˆ‘ä»¬çŸ¥é“äº†éœ€è¦å®æ—¶å»é‡‡é›†æ•°æ®ï¼Œä½†æ˜¯é’ˆå¯¹è¿™äº›éœ€æ±‚ï¼Œæˆ‘ä»¬åˆ°åº•éœ€è¦é‡‡é›†äº›ä»€ä¹ˆæ•°æ®å‘¢ï¼Ÿå¦‚ä¸‹å°±æ˜¯æˆ‘ä»¬éœ€è¦é‡‡é›†çš„æ•°æ®ï¼š ç”¨æˆ·æœç´¢ä¿¡æ¯ ç”¨æˆ·æµè§ˆå•†å“ä¿¡æ¯ ç”¨æˆ·ä¸‹å•è®¢å•ä¿¡æ¯ ç½‘ç«™çš„æ‰€æœ‰æµè§ˆè®°å½• æœºå™¨ CPU/Mem/IO ä¿¡æ¯ åº”ç”¨æ—¥å¿—ä¿¡æ¯ 1.1.3 æ•°æ®å®æ—¶è®¡ç®—é‡‡é›†åçš„æ•°æ®å®æ—¶ä¸ŠæŠ¥åï¼Œéœ€è¦åšå®æ—¶çš„è®¡ç®—ï¼Œé‚£æˆ‘ä»¬æ€ä¹ˆå®ç°è®¡ç®—å‘¢ï¼Ÿ è®¡ç®—æ‰€æœ‰å•†å“çš„æ€»é”€å”®é¢ ç»Ÿè®¡å•ä¸ªå•†å“çš„é”€é‡ï¼Œæœ€åæ±‚ Top5 å…³è”ç”¨æˆ·ä¿¡æ¯å’Œæµè§ˆä¿¡æ¯ã€ä¸‹å•ä¿¡æ¯ ç»Ÿè®¡ç½‘ç«™æ‰€æœ‰çš„è¯·æ±‚ IP å¹¶ç»Ÿè®¡æ¯ä¸ª IP çš„è¯·æ±‚æ•°é‡ è®¡ç®—ä¸€åˆ†é’Ÿå†…æœºå™¨ CPU/Mem/IO çš„å¹³å‡å€¼ã€75 åˆ†ä½æ•°å€¼ è¿‡æ»¤å‡º Error çº§åˆ«çš„æ—¥å¿—ä¿¡æ¯ 1.1.4 æ•°æ®å®æ—¶ä¸‹å‘å®æ—¶è®¡ç®—åçš„æ•°æ®ï¼Œéœ€è¦åŠæ—¶çš„ä¸‹å‘åˆ°ä¸‹æ¸¸ï¼Œè¿™é‡Œè¯´çš„ä¸‹æ¸¸ä»£è¡¨å¯èƒ½æ˜¯å‘Šè­¦æ–¹å¼ï¼ˆé‚®ä»¶ã€çŸ­ä¿¡ã€é’‰é’‰ã€å¾®ä¿¡ï¼‰ã€å­˜å‚¨ï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ã€DBã€æ–‡ä»¶ç³»ç»Ÿç­‰ï¼‰ã€‚ ï¼ˆ1ï¼‰å‘Šè­¦æ–¹å¼ï¼ˆé‚®ä»¶ã€çŸ­ä¿¡ã€é’‰é’‰ã€å¾®ä¿¡ï¼‰ åœ¨è®¡ç®—å±‚ä¼šå°†è®¡ç®—ç»“æœä¸é˜ˆå€¼è¿›è¡Œæ¯”è¾ƒï¼Œè¶…è¿‡é˜ˆå€¼è§¦å‘å‘Šè­¦ï¼Œè®©è¿ç»´æå‰æ”¶åˆ°é€šçŸ¥ï¼Œå‘Šè­¦æ¶ˆæ¯å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¿™æ ·è¿ç»´å¯ä»¥åŠæ—¶åšå¥½åº”å¯¹æªæ–½ï¼Œå‡å°‘æ•…éšœçš„æŸå¤±å¤§å°ã€‚ ï¼ˆ2ï¼‰å­˜å‚¨ï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ã€DBã€æ–‡ä»¶ç³»ç»Ÿç­‰ï¼‰ æ•°æ®å­˜å‚¨åï¼Œç›‘æ§å¤§ç›˜ï¼ˆDashboardï¼‰ä»å­˜å‚¨ï¼ˆElasticSearchã€HBase ç­‰ï¼‰é‡Œé¢æŸ¥è¯¢å¯¹åº”æŒ‡æ ‡çš„æ•°æ®å°±å¯ä»¥æŸ¥çœ‹å®æ—¶çš„ç›‘æ§ä¿¡æ¯ï¼Œåšåˆ°å¯¹ä¿ƒé”€æ´»åŠ¨çš„å•†å“é”€é‡ã€é”€å”®é¢ï¼Œæœºå™¨ CPUã€Mem ç­‰æœ‰å®æ—¶ç›‘æ§ï¼Œè¿è¥ã€è¿ç»´ã€å¼€å‘ã€é¢†å¯¼éƒ½å¯ä»¥å®æ—¶æŸ¥çœ‹å¹¶ä½œå‡ºå¯¹åº”çš„æªæ–½ã€‚ è®©è¿è¥çŸ¥é“å“ªäº›å•†å“æ˜¯çˆ†æ¬¾ï¼Œå“ªäº›åº—é“ºæˆäº¤é¢æœ€å¤šï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå“ªäº›å•†å“æˆäº¤é¢æœ€é«˜ï¼Œå“ªäº›å•†å“æµè§ˆé‡æœ€å¤šï¼› è®©è¿ç»´å¯ä»¥æ—¶åˆ»äº†è§£æœºå™¨çš„è¿è¡ŒçŠ¶å†µï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå‡ºç°å®•æœºæˆ–è€…å…¶ä»–ä¸ç¨³å®šæƒ…å†µå¯ä»¥åŠæ—¶å¤„ç†ï¼› è®©å¼€å‘çŸ¥é“è‡ªå·±é¡¹ç›®è¿è¡Œçš„æƒ…å†µï¼Œä» Error æ—¥å¿—çŸ¥é“å‡ºç°äº†å“ªäº› Bugï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼› è®©é¢†å¯¼çŸ¥é“è¿™æ¬¡ä¿ƒé”€èµšäº†å¤šå°‘ moneyï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ ä»æ•°æ®é‡‡é›†åˆ°æ•°æ®è®¡ç®—å†åˆ°æ•°æ®ä¸‹å‘ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ•´ä¸ªæµç¨‹åœ¨ä¸Šé¢çš„åœºæ™¯å¯¹å®æ—¶æ€§è¦æ±‚è¿˜æ˜¯å¾ˆé«˜çš„ï¼Œä»»ä½•ä¸€ä¸ªåœ°æ–¹å‡ºç°é—®é¢˜éƒ½å°†å½±å“æœ€åçš„æ•ˆæœï¼ 1.1.5 å®æ—¶è®¡ç®—åœºæ™¯å‰é¢è¯´äº†è¿™ä¹ˆå¤šåœºæ™¯ï¼Œè¿™é‡Œæˆ‘ä»¬æ€»ç»“ä¸€ä¸‹å®æ—¶è®¡ç®—å¸¸ç”¨çš„åœºæ™¯æœ‰å“ªäº›å‘¢ï¼Ÿæ¯”å¦‚ï¼š äº¤é€šä¿¡å·ç¯æ•°æ® é“è·¯ä¸Šè½¦æµé‡ç»Ÿè®¡ï¼ˆæ‹¥å µçŠ¶å†µï¼‰ å…¬å®‰è§†é¢‘ç›‘æ§ æœåŠ¡å™¨è¿è¡ŒçŠ¶æ€ç›‘æ§ é‡‘èè¯åˆ¸å…¬å¸å®æ—¶è·Ÿè¸ªè‚¡å¸‚æ³¢åŠ¨ï¼Œè®¡ç®—é£é™©ä»·å€¼ æ•°æ®å®æ—¶ ETL é“¶è¡Œæˆ–è€…æ”¯ä»˜å…¬å¸æ¶‰åŠé‡‘èç›—çªƒçš„é¢„è­¦ â€¦â€¦ å¦å¤–è‡ªå·±è¿˜åšè¿‡è°ƒç ”ï¼Œå®æ—¶è®¡ç®—æ¡†æ¶çš„ä½¿ç”¨åœºæ™¯æœ‰å¦‚ä¸‹è¿™äº›ï¼š ä¸šåŠ¡æ•°æ®å¤„ç†ï¼Œèšåˆä¸šåŠ¡æ•°æ®ï¼Œç»Ÿè®¡ä¹‹ç±» æµé‡æ—¥å¿— ETL å®‰é˜²è¿™å—ï¼Œå…¬å®‰è§†é¢‘ç»“æ„åŒ–æ•°æ®ï¼Œç”¨ Flink åšå›¾ç‰‡æœç´¢ é£æ§ï¼Œä¸»è¦å¤„ç†ç»“æ„åŒ–æ•°æ® ä¸šåŠ¡å‘Šè­¦ åŠ¨æ€æ•°æ®ç›‘æ§ æ€»ç»“ä¸€ä¸‹å¤§æ¦‚æœ‰ä¸‹é¢è¿™å››ç±»ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š è¿™å››ç±»åˆ†åˆ«æ˜¯ï¼š å®æ—¶æ•°æ®å­˜å‚¨ï¼šå®æ—¶æ•°æ®å­˜å‚¨çš„æ—¶å€™åšä¸€äº›å¾®èšåˆã€è¿‡æ»¤æŸäº›å­—æ®µã€æ•°æ®è„±æ•ï¼Œç»„å»ºæ•°æ®ä»“åº“ï¼Œå®æ—¶ ETLã€‚ å®æ—¶æ•°æ®åˆ†æï¼šå®æ—¶æ•°æ®æ¥å…¥æœºå™¨å­¦ä¹ æ¡†æ¶ï¼ˆTensorFlowï¼‰æˆ–è€…ä¸€äº›ç®—æ³•è¿›è¡Œæ•°æ®å»ºæ¨¡ã€åˆ†æï¼Œç„¶ååŠ¨æ€çš„ç»™å‡ºå•†å“æ¨èã€å¹¿å‘Šæ¨è å®æ—¶ç›‘æ§å‘Šè­¦ï¼šé‡‘èç›¸å…³æ¶‰åŠäº¤æ˜“ã€å®æ—¶é£æ§ã€è½¦æµé‡é¢„è­¦ã€æœåŠ¡å™¨ç›‘æ§å‘Šè­¦ã€åº”ç”¨æ—¥å¿—å‘Šè­¦ å®æ—¶æ•°æ®æŠ¥è¡¨ï¼šæ´»åŠ¨è¥é”€æ—¶é”€å”®é¢/é”€å”®é‡å¤§å±ï¼ŒTopN å•†å“ è¯´åˆ°å®æ—¶è®¡ç®—ï¼Œè¿™é‡Œä¸å¾—ä¸è®²ä¸€ä¸‹å®ƒä¸ä¼ ç»Ÿçš„ç¦»çº¿è®¡ç®—ä¹‹é—´çš„åŒºåˆ«ï¼ 1.1.6 ç¦»çº¿è®¡ç®— vs å®æ—¶è®¡ç®—å†è®²ç¦»çº¿è®¡ç®—å’Œå®æ—¶è®¡ç®—è¿™ä¸¤ä¸ªåŒºåˆ«ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æµå¤„ç†å’Œæ‰¹å¤„ç†ã€‚ æµå¤„ç†ä¸æ‰¹å¤„ç†æµå¤„ç†æ˜¯ä¸€ç§é‡è¦çš„å¤§æ•°æ®å¤„ç†æ‰‹æ®µï¼Œå…¶ä¸»è¦ç‰¹ç‚¹æ˜¯å…¶å¤„ç†çš„æ•°æ®æ˜¯æºæºä¸æ–­ä¸”å®æ—¶åˆ°æ¥çš„ã€‚æ‰¹å¤„ç†å†å²æ¯”è¾ƒæ‚ ä¹…ï¼Œè€Œä¸”ä½¿ç”¨çš„åœºæ™¯æ¯”è¾ƒå¤šï¼Œå…¶ä¸»è¦æ“ä½œçš„æ˜¯å¤§å®¹é‡çš„é™æ€æ•°æ®é›†ï¼Œå¹¶åœ¨è®¡ç®—è¿‡ç¨‹å®Œæˆåè¿”å›ç»“æœã€‚å®ƒä»¬ä¹‹é—´çš„åŒºåˆ«å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š çœ‹å®Œæµå¤„ç†ä¸æ‰¹å¤„ç†è¿™ä¸¤è€…çš„åŒºåˆ«ä¹‹åï¼Œæˆ‘ä»¬æ¥æŠ½è±¡ä¸€ä¸‹å‰é¢å†…å®¹çš„åœºæ™¯éœ€æ±‚è®¡ç®—æµç¨‹ï¼ˆå®æ—¶è®¡ç®—ï¼‰å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å®æ—¶è®¡ç®—éœ€è¦ä¸æ–­çš„ä» MQ ä¸­è¯»å–é‡‡é›†çš„æ•°æ®ï¼Œç„¶åå¤„ç†è®¡ç®—åå¾€ DB é‡Œå­˜å‚¨ï¼Œåœ¨è®¡ç®—è¿™å±‚ä½ æ— æ³•æ„ŸçŸ¥åˆ°ä¼šæœ‰å¤šå°‘æ•°æ®é‡è¿‡æ¥ã€è¦åšä¸€äº›ç®€å•çš„æ“ä½œï¼ˆè¿‡æ»¤ã€èšåˆç­‰ï¼‰ã€åŠæ—¶å°†æ•°æ®ä¸‹å‘ã€‚ç„¶è€Œä¼ ç»Ÿçš„ç¦»çº¿è®¡ç®—å´å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š åœ¨è®¡ç®—è¿™å±‚ï¼Œå®ƒä» DBï¼ˆä¸é™ MySQLï¼Œè¿˜æœ‰å…¶ä»–çš„å­˜å‚¨ä»‹è´¨ï¼‰é‡Œé¢è¯»å–æ•°æ®ï¼Œè¯¥æ•°æ®ä¸€èˆ¬å°±æ˜¯å›ºå®šçš„ï¼ˆå‰ä¸€å¤©ã€å‰ä¸€æ˜ŸæœŸã€å‰ä¸€ä¸ªæœˆï¼‰ï¼Œç„¶åå†åšä¸€äº›å¤æ‚çš„è®¡ç®—æˆ–è€…ç»Ÿè®¡åˆ†æï¼Œæœ€åç”Ÿæˆå¯ä¾›ç›´è§‚æŸ¥çœ‹çš„æŠ¥è¡¨ï¼ˆdashboardï¼‰ã€‚ ç¦»çº¿è®¡ç®—çš„ç‰¹ç‚¹ç¦»çº¿è®¡ç®—ä¸€èˆ¬æœ‰ä¸‹é¢è¿™äº›ç‰¹ç‚¹ï¼š æ•°æ®é‡å¤§ä¸”æ—¶é—´å‘¨æœŸé•¿ï¼ˆä¸€å¤©ã€ä¸€æ˜ŸæœŸã€ä¸€ä¸ªæœˆã€åŠå¹´ã€ä¸€å¹´ï¼‰ åœ¨å¤§é‡æ•°æ®ä¸Šè¿›è¡Œå¤æ‚çš„æ‰¹é‡è®¡ç®—æ“ä½œ æ•°æ®åœ¨è®¡ç®—ä¹‹å‰å·²ç»å›ºå®šï¼Œä¸å†ä¼šå‘ç”Ÿå˜åŒ– èƒ½å¤Ÿæ–¹ä¾¿çš„æŸ¥è¯¢æ‰¹é‡è®¡ç®—çš„ç»“æœ å®æ—¶è®¡ç®—çš„ç‰¹ç‚¹åœ¨å¤§æ•°æ®ä¸­ä¸ç¦»çº¿è®¡ç®—å¯¹åº”çš„åˆ™æ˜¯å®æ—¶è®¡ç®—ï¼Œé‚£ä¹ˆå®æ—¶è®¡ç®—æœ‰ä»€ä¹ˆç‰¹ç‚¹å‘¢ï¼Ÿç”±äºåº”ç”¨åœºæ™¯çš„å„ä¸ç›¸åŒï¼Œæ‰€ä»¥è¿™ä¸¤ç§è®¡ç®—å¼•æ“æ¥æ”¶æ•°æ®çš„æ–¹å¼ä¹Ÿä¸å¤ªä¸€æ ·ï¼šç¦»çº¿è®¡ç®—çš„æ•°æ®æ˜¯å›ºå®šçš„ï¼ˆä¸å†ä¼šå‘ç”Ÿå˜åŒ–ï¼‰ï¼Œé€šå¸¸ç¦»çº¿è®¡ç®—çš„ä»»åŠ¡éƒ½æ˜¯å®šæ—¶çš„ï¼Œå¦‚ï¼šæ¯å¤©æ™šä¸Š 0 ç‚¹çš„æ—¶å€™å®šæ—¶è®¡ç®—å‰ä¸€å¤©çš„æ•°æ®ï¼Œç”ŸæˆæŠ¥è¡¨ï¼›ç„¶è€Œå®æ—¶è®¡ç®—çš„æ•°æ®æºå´æ˜¯æµå¼çš„ã€‚ è¿™é‡Œæˆ‘ä¸å¾—ä¸è®²è®²ä»€ä¹ˆæ˜¯æµå¼æ•°æ®å‘¢ï¼Ÿæˆ‘çš„ç†è§£æ˜¯æ¯”å¦‚ä½ åœ¨æ·˜å®ä¸Šä¸‹å•äº†æŸä¸ªå•†å“æˆ–è€…ç‚¹å‡»æµè§ˆäº†æŸä»¶å•†å“ï¼Œä½ å°±ä¼šå‘ç°ä½ çš„é¡µé¢ç«‹é©¬å°±ä¼šç»™ä½ æ¨èè¿™ç§å•†å“çš„å¹¿å‘Šå’Œç±»ä¼¼å•†å“çš„åº—é“ºï¼Œè¿™ç§å°±æ˜¯å±äºå®æ—¶æ•°æ®å¤„ç†ç„¶åä½œå‡ºç›¸å…³æ¨èï¼Œè¿™ç±»æ•°æ®éœ€è¦ä¸æ–­çš„ä»ä½ åœ¨ç½‘é¡µä¸Šçš„ç‚¹å‡»åŠ¨ä½œä¸­è·å–æ•°æ®ï¼Œä¹‹åè¿›è¡Œå®æ—¶åˆ†æç„¶åç»™å‡ºæ¨èã€‚ æµå¼æ•°æ®çš„ç‰¹ç‚¹æµå¼æ•°æ®ä¸€èˆ¬æœ‰ä¸‹é¢è¿™äº›ç‰¹ç‚¹ï¼š æ•°æ®å®æ—¶åˆ°è¾¾ æ•°æ®åˆ°è¾¾æ¬¡åºç‹¬ç«‹ï¼Œä¸å—åº”ç”¨ç³»ç»Ÿæ‰€æ§åˆ¶ æ•°æ®è§„æ¨¡å¤§ä¸”æ— æ³•é¢„çŸ¥å®¹é‡ åŸå§‹æ•°æ®ä¸€ç»å¤„ç†ï¼Œé™¤éç‰¹æ„ä¿å­˜ï¼Œå¦åˆ™ä¸èƒ½è¢«å†æ¬¡å–å‡ºå¤„ç†ï¼Œæˆ–è€…å†æ¬¡æå–æ•°æ®ä»£ä»·æ˜‚è´µ é€šè¿‡ä¸Šé¢çš„å†…å®¹å¯ä»¥æ€»ç»“å®æ—¶è®¡ç®—ä¸ç¦»çº¿è®¡ç®—çš„å¯¹æ¯”å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å®æ—¶è®¡ç®—çš„ä¼˜åŠ¿å®æ—¶è®¡ç®—ä¸€æ—¶çˆ½ï¼Œä¸€ç›´å®æ—¶è®¡ç®—ä¸€ç›´çˆ½ï¼Œå¯¹äºæŒç»­ç”Ÿæˆæœ€æ–°æ•°æ®çš„åœºæ™¯ï¼Œé‡‡ç”¨æµæ•°æ®å¤„ç†æ˜¯éå¸¸æœ‰åˆ©çš„ã€‚ä¾‹å¦‚ï¼Œå†ç›‘æ§æœåŠ¡å™¨çš„ä¸€äº›è¿è¡ŒæŒ‡æ ‡çš„æ—¶å€™ï¼Œèƒ½æ ¹æ®é‡‡é›†ä¸Šæ¥çš„å®æ—¶æ•°æ®è¿›è¡Œåˆ¤æ–­ï¼Œå½“è¶…å‡ºä¸€å®šé˜ˆå€¼çš„æ—¶å€™å‘å‡ºè­¦æŠ¥ï¼Œè¿›è¡Œæé†’ä½œç”¨ã€‚å†å¦‚é€šè¿‡å¤„ç†æµæ•°æ®ç”Ÿæˆç®€å•çš„æŠ¥å‘Šï¼Œå¦‚äº”åˆ†é’Ÿçš„çª—å£èšåˆæ•°æ®å¹³å‡å€¼ã€‚å¤æ‚çš„äº‹æƒ…è¿˜æœ‰åœ¨æµæ•°æ®ä¸­è¿›è¡Œæ•°æ®å¤šç»´åº¦å…³è”ã€èšåˆã€ç­›é€‰ï¼Œä»è€Œæ‰¾åˆ°å¤æ‚äº‹ä»¶ä¸­çš„æ ¹å› ã€‚æ›´ä¸ºå¤æ‚çš„æ˜¯åšä¸€äº›å¤æ‚çš„æ•°æ®åˆ†ææ“ä½œï¼Œå¦‚åº”ç”¨æœºå™¨å­¦ä¹ ç®—æ³•ï¼Œç„¶åæ ¹æ®ç®—æ³•å¤„ç†åçš„æ•°æ®ç»“æœæå–å‡ºæœ‰æ•ˆçš„ä¿¡æ¯ï¼Œä½œå‡ºã€ç»™å‡ºä¸ä¸€æ ·çš„æ¨èå†…å®¹ï¼Œè®©ä¸åŒçš„äººå¯ä»¥çœ‹è§ä¸åŒçš„ç½‘é¡µï¼ˆåƒäººåƒé¢ï¼‰ã€‚ 1.1.7 å®æ—¶è®¡ç®—é¢ä¸´çš„æŒ‘æˆ˜è™½ç„¶å®æ—¶è®¡ç®—æœ‰è¿™ä¹ˆå¤šå¥½å¤„ï¼Œä½†æ˜¯è¦ä½¿ç”¨å®æ—¶è®¡ç®—ä¹Ÿä¼šé¢ä¸´å¾ˆå¤šæŒ‘æˆ˜ï¼Œæ¯”å¦‚ä¸‹é¢è¿™äº›ï¼š æ•°æ®å¤„ç†å”¯ä¸€æ€§ï¼ˆå¦‚ä½•ä¿è¯æ•°æ®åªå¤„ç†ä¸€æ¬¡ï¼Ÿè‡³å°‘ä¸€æ¬¡ï¼Ÿæœ€å¤šä¸€æ¬¡ï¼Ÿï¼‰ æ•°æ®å¤„ç†çš„åŠæ—¶æ€§ï¼ˆé‡‡é›†çš„å®æ—¶æ•°æ®é‡å¤ªå¤§çš„è¯å¯èƒ½ä¼šå¯¼è‡´çŸ­æ—¶é—´å†…å¤„ç†ä¸è¿‡æ¥ï¼Œå¦‚ä½•ä¿è¯æ•°æ®èƒ½å¤ŸåŠæ—¶çš„å¤„ç†ï¼Œä¸å‡ºç°æ•°æ®å †ç§¯ï¼Ÿï¼‰ æ•°æ®å¤„ç†å±‚å’Œå­˜å‚¨å±‚çš„å¯æ‰©å±•æ€§ï¼ˆå¦‚ä½•æ ¹æ®é‡‡é›†çš„å®æ—¶æ•°æ®é‡çš„å¤§å°æä¾›åŠ¨æ€æ‰©ç¼©å®¹ï¼Ÿï¼‰ æ•°æ®å¤„ç†å±‚å’Œå­˜å‚¨å±‚çš„å®¹é”™æ€§ï¼ˆå¦‚ä½•ä¿è¯æ•°æ®å¤„ç†å±‚å’Œå­˜å‚¨å±‚é«˜å¯ç”¨ï¼Œå‡ºç°æ•…éšœæ—¶æ•°æ®å¤„ç†å±‚å’Œå­˜å‚¨å±‚æœåŠ¡ä¾æ—§å¯ç”¨ï¼Ÿï¼‰ å› ä¸ºå„ç§éœ€æ±‚ï¼Œä¹Ÿå°±é€ å°±äº†ç°åœ¨ä¸æ–­å‡ºç°å®æ—¶è®¡ç®—æ¡†æ¶ï¼Œåœ¨ 1.2 èŠ‚ä¸­å°†é‡ç£…ä»‹ç»å¦‚ä»Šæœ€ç«çš„å®æ—¶è®¡ç®—æ¡†æ¶ â€”â€” Flinkï¼Œåœ¨ 1.3 èŠ‚ä¸­ä¼šå¯¹æ¯”ä»‹ç» Spark Streamingã€Structured Streaming å’Œ Storm ä¹‹é—´çš„åŒºåˆ«ã€‚ 1.1.8 å°ç»“ä¸åæ€æœ¬èŠ‚ä»å®æ—¶è®¡ç®—çš„éœ€æ±‚ä½œä¸ºåˆ‡å…¥ç‚¹ï¼Œç„¶ååˆ†æè¯¥å¦‚ä½•å»å®Œæˆè¿™ç§å®æ—¶è®¡ç®—çš„éœ€æ±‚ï¼Œä»è€Œå¾—çŸ¥æ•´ä¸ªè¿‡ç¨‹åŒ…æ‹¬æ•°æ®é‡‡é›†ã€æ•°æ®è®¡ç®—ã€æ•°æ®å­˜å‚¨ç­‰ï¼Œæ¥ç€æ€»ç»“äº†å®æ—¶è®¡ç®—åœºæ™¯çš„ç±»å‹ã€‚æœ€åå¼€å§‹ä»‹ç»ç¦»çº¿è®¡ç®—ä¸å®æ—¶è®¡ç®—çš„åŒºåˆ«ï¼Œå¹¶æå‡ºäº†å®æ—¶è®¡ç®—å¯èƒ½å¸¦æ¥çš„æŒ‘æˆ˜ã€‚ä½ ä»¬å…¬å¸æœ‰æ–‡ä¸­æ‰€è®²çš„ç±»ä¼¼éœ€æ±‚å—ï¼Ÿä½ æ˜¯æ€ä¹ˆè§£å†³çš„å‘¢ï¼Ÿ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"åŸºäº Flink çš„åŠ¨æ€æ¬ºè¯ˆæ£€æµ‹ç³»ç»Ÿ(ä¸‹)","date":"2021-07-02T16:00:00.000Z","path":"2021/07/03/Flink-Fraud-Detection-engine-3/","text":"å¦‚ä½•å®ç°å‘¢ï¼Ÿ ä»‹ç»åœ¨æœ¬ç³»åˆ—çš„å‰ä¸¤ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æè¿°äº†å¦‚ä½•åŸºäºåŠ¨æ€æ›´æ–°é…ç½®ï¼ˆæ¬ºè¯ˆæ£€æµ‹è§„åˆ™ï¼‰æ¥å®ç°çµæ´»çš„æ•°æ®æµåˆ†åŒºï¼Œä»¥åŠå¦‚ä½•åˆ©ç”¨ Flink çš„ Broadcast æœºåˆ¶åœ¨è¿è¡Œæ—¶åœ¨ç›¸å…³ç®—å­ä¹‹é—´åˆ†é…å¤„ç†é…ç½®ã€‚ ç›´æ¥è·Ÿä¸Šæˆ‘ä»¬ä¸Šæ¬¡è®¨è®ºç«¯åˆ°ç«¯è§£å†³æ–¹æ¡ˆçš„åœ°æ–¹ï¼Œåœ¨æœ¬ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†æè¿°å¦‚ä½•ä½¿ç”¨ Flink çš„ â€œç‘å£«å†›åˆ€â€ â€”â€” Process Function æ¥åˆ›å»ºä¸€ä¸ªé‡èº«å®šåˆ¶çš„å®ç°ï¼Œä»¥æ»¡è¶³ä½ çš„æµä¸šåŠ¡é€»è¾‘éœ€æ±‚ã€‚æˆ‘ä»¬çš„è®¨è®ºå°†åœ¨æ¬ºè¯ˆæ£€æµ‹å¼•æ“çš„èƒŒæ™¯ä¸‹ç»§ç»­è¿›è¡Œï¼Œæˆ‘ä»¬è¿˜å°†æ¼”ç¤ºå¦‚ä½•åœ¨ DataStream API æä¾›çš„çª—å£ä¸èƒ½æ»¡è¶³ä½ çš„è¦æ±‚çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡è‡ªå®šä¹‰çª—å£æ¥å®ç°ä½ è‡ªå·±çš„éœ€æ±‚ã€‚ç‰¹åˆ«çš„æ˜¯ï¼Œæˆ‘ä»¬å°†ç ”ç©¶åœ¨è®¾è®¡éœ€è¦å¯¹å•ä¸ªäº‹ä»¶è¿›è¡Œä½å»¶è¿Ÿå“åº”çš„è§£å†³æ–¹æ¡ˆæ—¶å¯ä»¥åšå‡ºæƒè¡¡ã€‚ æœ¬æ–‡å°†æè¿°ä¸€äº›å¯ä»¥ç‹¬ç«‹åº”ç”¨çš„é«˜çº§æ¦‚å¿µï¼Œå»ºè®®ä½ å…ˆé˜…è¯»æœ¬ç³»åˆ—ç¬¬ä¸€ç¯‡å’Œç¬¬äºŒç¯‡æ–‡ç« ï¼Œå¹¶é˜…è¯»å…¶ä»£ç å®ç°ï¼Œä»¥ä¾¿æ›´å®¹æ˜“ç†è§£æœ¬æ–‡ã€‚ ProcessFunction å½“ä½œ Windowä½å»¶è¿Ÿé¦–å…ˆæ¥çœ‹ä¸‹æˆ‘ä»¬å°†è¦æ”¯æŒçš„æ¬ºè¯ˆæ£€æµ‹è§„åˆ™ç±»å‹ï¼š â€œæ¯å½“åŒä¸€ä»˜æ¬¾äººåœ¨ 24 å°æ—¶å†…æ”¯ä»˜ç»™åŒä¸€å—ç›Šäººçš„æ¬¾é¡¹æ€»é¢è¶…è¿‡ 20 ä¸‡ç¾å…ƒæ—¶ï¼Œå°±ä¼šè§¦å‘è­¦æŠ¥ã€‚â€ æ¢å¥è¯è¯´ï¼Œå‡è®¾ç°åœ¨æœ‰ä¸€ä¸ªæŒ‰ç…§ä»˜æ¬¾äººå’Œå—ç›Šäººç»„æˆ key åˆ†åŒºçš„äº¤æ˜“æ•°æ®æµï¼Œå¯¹äºæ¯æ¡åˆ°æ¥çš„äº¤æ˜“æ•°æ®æµï¼Œæˆ‘ä»¬éƒ½ä¼šç»Ÿè®¡ä¸¤ä¸ªç‰¹å®šå‚ä¸è€…ä¹‹é—´å‰ 24 å°æ—¶åˆ°ç°åœ¨çš„ä»˜æ¬¾æ€»é¢æ˜¯å¦è¶…è¿‡é¢„å®šä¹‰çš„é˜ˆå€¼ã€‚ æ¬ºè¯ˆæ£€æµ‹ç³»ç»Ÿçš„å¸¸è§å…³é”®è¦æ±‚ä¹‹ä¸€æ˜¯å“åº”æ—¶é—´çŸ­ã€‚æ¬ºè¯ˆè¡Œä¸ºè¶Šæ—©è¢«æ£€æµ‹åˆ°ï¼Œé˜»æ­¢å°±ä¼šè¶ŠåŠæ—¶ï¼Œå¸¦æ¥çš„è´Ÿé¢å½±å“å°±ä¼šè¶Šå°ã€‚è¿™ä¸€è¦æ±‚åœ¨é‡‘èé¢†åŸŸå°¤ä¸ºçªå‡ºï¼Œå› ä¸ºç”¨äºè¯„ä¼°æ¬ºè¯ˆæ£€æµ‹ç³»ç»Ÿçš„ä»»ä½•æ—¶é—´éƒ½æ˜¯ç”¨æˆ·éœ€è¦ç­‰å¾…å“åº”æ‰€èŠ±è´¹çš„æ—¶é—´ã€‚å¤„ç†çš„è¿…é€Ÿæ€§é€šå¸¸æˆä¸ºå„ç§æ”¯ä»˜ç³»ç»Ÿä¹‹é—´çš„ç«äº‰ä¼˜åŠ¿ï¼Œäº§ç”Ÿå‘Šè­¦çš„æ—¶é—´é™åˆ¶å¯èƒ½ä½è‡³ 300-500 æ¯«ç§’ã€‚è¿™æ˜¯ä»æ¬ºè¯ˆæ£€æµ‹ç³»ç»Ÿæ¥æ”¶åˆ°é‡‘èäº¤æ˜“äº‹ä»¶çš„é‚£ä¸€åˆ»èµ·ï¼Œç›´åˆ°ä¸‹æ¸¸ç³»ç»Ÿå‘å‡ºå‘Šè­¦ä¸ºæ­¢çš„æ‰€æœ‰å»¶è¿Ÿæ—¶é—´é™åˆ¶ã€‚ ä½ å¯èƒ½çŸ¥é“ï¼ŒFlink å·²ç»æä¾›äº†å¼ºå¤§çš„ Window APIï¼Œè¿™äº› API å¯ä»¥é€‚ç”¨äºå¹¿æ³›çš„åœºæ™¯ã€‚ä½†æ˜¯ä½ æŸ¥çœ‹ Flink æ‰€æœ‰æ”¯æŒçš„çª—å£ç±»å‹ï¼Œä½ ä¼šå‘ç°æ²¡æœ‰ä¸€ä¸ªèƒ½å®Œå…¨ç¬¦åˆæˆ‘ä»¬è¿™ä¸ªåœºæ™¯çš„è¦æ±‚ â€”â€” ä½å»¶è¿Ÿçš„è®¡ç®—æ¯æ¡äº¤æ˜“æ•°æ®ã€‚Flink è‡ªå¸¦çš„çª—å£æ²¡æœ‰å¯ä»¥è¡¨è¾¾ â€œä»å½“å‰äº‹ä»¶è¿”å› x åˆ†é’Ÿ/å°æ—¶/å¤©â€ çš„è¯­ä¹‰ã€‚åœ¨ Window API ä¸­ï¼Œäº‹ä»¶ä¼šè½åˆ°ç”±çª—å£åˆ†é…å™¨å®šä¹‰çš„çª—å£ä¸­ï¼Œä½†æ˜¯ä»–ä»¬æœ¬èº«ä¸èƒ½å•ç‹¬æ§åˆ¶ Window çš„åˆ›å»ºå’Œè®¡ç®—ã€‚å¦‚ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬çš„æ¬ºè¯ˆæ£€æµ‹å¼•æ“çš„ç›®æ ‡æ˜¯åœ¨æ”¶åˆ°æ–°äº‹ä»¶åç«‹å³å¯¹ä¹‹å‰çš„ç›¸å…³æ•°æ®è¿›è¡Œè®¡ç®—ã€‚åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œåˆ©ç”¨ Flink è‡ªå¸¦çš„ Window API ä¸æ¸…æ¥šæ˜¯å¦å¯è¡Œã€‚Window API æä¾›äº†ä¸€äº›ç”¨äºè‡ªå®šä¹‰çš„ Triggerã€Evictor å’Œ Window Assignerï¼Œæˆ–è®¸å®ƒä»¬å¯èƒ½ä¼šå¸®åŠ©åˆ°æˆ‘ä»¬è·å¾—æ‰€éœ€çš„ç»“æœã€‚ä½†æ˜¯ï¼Œé€šå¸¸æƒ…å†µä¸‹å¾ˆéš¾åšåˆ°è¿™ä¸€ç‚¹ï¼Œæ­¤å¤–ï¼Œè¿™ç§æ–¹æ³•ä¸æä¾›å¯¹å¹¿æ’­çŠ¶æ€çš„è®¿é—®ï¼Œè¿™æ˜¯ç„¶åå¹¿æ’­çŠ¶æ€æ˜¯å®ç°ä¸šåŠ¡è§„åˆ™åŠ¨æ€é…ç½®æ‰€å¿…é¡»çš„ã€‚ 1) é™¤äº†ä¼šè¯çª—å£ï¼Œå®ƒä»¬ä»…é™äºåŸºäºä¼šè¯é—´éš™çš„åˆ†é… æˆ‘ä»¬ä»¥ä½¿ç”¨ Flink çš„ Window API ä¸­çš„æ»‘åŠ¨çª—å£ä¸ºä¾‹ã€‚ä½¿ç”¨æ»‘åŠ¨æ­¥é•¿ä¸º S çš„æ»‘åŠ¨çª—å£è½¬åŒ–ä¸ºç­‰äº S/2 çš„è¯„ä¼°å»¶è¿Ÿçš„é¢„æœŸå€¼ã€‚è¿™æ„å‘³ç€ä½ éœ€è¦å®šä¹‰ 600ï½1000 æ¯«ç§’çš„æ»‘åŠ¨çª—å£æ¥æ»¡è¶³ 300ï½500 æ¯«ç§’å»¶è¿Ÿçš„ä½å»¶è¿Ÿè¦æ±‚ã€‚Flink è¦ä¸ºæ¯ä¸ªæ»‘åŠ¨çª—å£å­˜å‚¨å•ç‹¬çš„çª—å£çŠ¶æ€ï¼Œè¿™ä¼šå¯¼è‡´ä½œä¸šçŠ¶æ€éå¸¸å¤§ï¼Œåœ¨ä»»ä½•ä¸­ç­‰é«˜è´Ÿè½½çš„æƒ…å†µä¸‹ï¼Œè¿™ç§æ–¹æ¡ˆéƒ½ä¸å¯è¡Œã€‚ä¸ºäº†æ»¡è¶³éœ€æ±‚ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºè‡ªå®šçš„ä½å»¶è¿Ÿçª—å£å®ç°ï¼Œå¹¸è¿çš„æ˜¯ï¼ŒFlink ä¸ºæˆ‘ä»¬æä¾›äº†è¿™æ ·åšæ‰€éœ€çš„æ‰€æœ‰å·¥å…·ï¼ŒProcessFunction æ˜¯ Flink API ä¸­ä¸€ä¸ªä½çº§ä½†åŠŸèƒ½å¼ºå¤§çš„ç±»ã€‚å®ƒæœ‰ä¸€ä¸ªç®€å•çš„çº¦å®šï¼š 12345678public class SomeProcessFunction extends KeyedProcessFunction&lt;KeyType, InputType, OutputType&gt; &#123; public void processElement(InputType event, Context ctx, Collector&lt;OutputType&gt; out)&#123;&#125; public void onTimer(long timestamp, OnTimerContext ctx, Collector&lt;OutputType&gt; out) &#123;&#125; public void open(Configuration parameters)&#123;&#125;&#125; processElement()ï¼šæ¥æ”¶è¾“å…¥æ•°æ®ï¼Œä½ å¯ä»¥é€šè¿‡è°ƒç”¨ out.collect() ä¸ºä¸‹ä¸€ä¸ªç®—å­ç”Ÿæˆä¸€ä¸ªæˆ–è€…å¤šä¸ªè¾“å‡ºäº‹ä»¶æ¥å¯¹æ¯ä¸ªè¾“å…¥ä½œå‡ºååº”ï¼Œä½ å¯ä»¥å°†æ•°æ®ä¼ é€’åˆ°ä¾§è¾“å‡ºæˆ–å®Œå…¨å¿½ç•¥ç‰¹å®šçš„è¾“å…¥æ•°æ® onTimer()ï¼šå½“ä¹‹å‰æ³¨å†Œçš„å®šæ—¶å™¨è§¦å‘æ—¶ï¼ŒFlink ä¼šè°ƒç”¨ onTimer()ï¼Œæ”¯æŒäº‹ä»¶æ—¶é—´å’Œå¤„ç†æ—¶é—´å®šæ—¶å™¨ open()ï¼šç›¸å½“äºä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œå®ƒåœ¨ TaskManager çš„ JVM å†…éƒ¨è°ƒç”¨ï¼Œç”¨äºåˆå§‹åŒ–ï¼Œä¾‹å¦‚æ³¨å†Œ Flink ç®¡ç†å†…å­˜ï¼Œå¯ä»¥åœ¨è¯¥æ–¹æ³•åˆå§‹åŒ–é‚£äº›æ²¡æœ‰åºåˆ—åŒ–çš„å­—æ®µæˆ–è€…æ— æ³•ä» JobManager JVM ä¸­ä¼ é€’è¿‡æ¥çš„å­—æ®µã€‚ æœ€é‡è¦çš„æ˜¯ï¼ŒProcessFunction è¿˜å¯ä»¥è®¿é—®ç”± Flink å¤„ç†çš„å®¹é”™çŠ¶æ€ã€‚è¿™ç§ç»„åˆï¼Œå†åŠ ä¸Š Flink çš„æ¶ˆæ¯å¤„ç†èƒ½åŠ›å’Œä½å»¶è¿Ÿçš„ä¿è¯ï¼Œä½¿å¾—æ„å»ºå…·æœ‰å‡ ä¹ä»»æ„å¤æ‚ä¸šåŠ¡é€»è¾‘çš„å¼¹æ€§äº‹ä»¶é©±åŠ¨åº”ç”¨ç¨‹åºæˆä¸ºå¯èƒ½ã€‚è¿™åŒ…æ‹¬åˆ›å»ºå’Œå¤„ç†å¸¦æœ‰çŠ¶æ€çš„è‡ªå®šä¹‰çª—å£ã€‚ å®ç°çŠ¶æ€çš„æ¸…é™¤ ä¸ºäº†èƒ½å¤Ÿå¤„ç†æ—¶é—´çª—å£ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç¨‹åºå†…éƒ¨è·Ÿè¸ªå±äºè¯¥çª—å£çš„æ•°æ®ã€‚ä¸ºäº†ç¡®ä¿è¿™äº›æ•°æ®æ˜¯å®¹é”™çš„ï¼Œå¹¶ä¸”èƒ½å¤Ÿåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å‘ç”Ÿæ•…éšœçš„æƒ…å†µä¸‹æ¢å¤ï¼Œæˆ‘ä»¬åº”è¯¥å°†å…¶å­˜å‚¨åœ¨ Flink ç®¡ç†çš„çŠ¶æ€ä¸­ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œæˆ‘ä»¬ä¸éœ€è¦ä¿ç•™æ‰€æœ‰ä»¥å‰çš„äº¤æ˜“æ•°æ®ã€‚æ ¹æ®æ¬ºè¯ˆæ£€æµ‹æ ·ä¾‹è§„åˆ™ï¼Œæ‰€æœ‰æ—©äº 24 å°æ—¶çš„äº¤æ˜“æ•°æ®éƒ½å˜å¾—æ— å…³ç´§è¦ã€‚æˆ‘ä»¬æ­£åœ¨æŸ¥çœ‹ä¸€ä¸ªä¸æ–­ç§»åŠ¨çš„æ•°æ®çª—å£ï¼Œå…¶ä¸­è¿‡æœŸçš„æ•°æ®éœ€è¦ä¸æ–­ç§»å‡ºèŒƒå›´ï¼ˆæ¢å¥è¯è¯´ï¼Œä»çŠ¶æ€ä¸­æ¸…é™¤ï¼‰ã€‚ æˆ‘ä»¬å°†ä½¿ç”¨ MapState æ¥å­˜å‚¨çª—å£çš„å„ä¸ªäº‹ä»¶ã€‚ä¸ºäº†æœ‰æ•ˆæ¸…ç†è¶…å‡ºèŒƒå›´çš„äº‹ä»¶ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨äº‹ä»¶æ—¶é—´æˆ³ä½œä¸º MapState çš„ keyã€‚ åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¿…é¡»è€ƒè™‘è¿™æ ·ä¸€ä¸ªäº‹å®ï¼Œå³å¯èƒ½å­˜åœ¨å…·æœ‰å®Œå…¨ç›¸åŒæ—¶é—´æˆ³çš„ä¸åŒäº‹ä»¶ï¼Œå› æ­¤æˆ‘ä»¬å°†å­˜å‚¨é›†åˆè€Œä¸æ˜¯æ¯ä¸ªé”®ï¼ˆæ—¶é—´æˆ³ï¼‰çš„å•æ¡æ•°æ®ã€‚ 1MapState&lt;Long, Set&lt;Transaction&gt;&gt; windowState; æ³¨æ„âš ï¸ï¼š å½“åœ¨ KeyedProcessFunction ä¸­ä½¿ç”¨ä»»ä½• Flink ç®¡ç†çš„çŠ¶æ€æ—¶ï¼Œstate.value() è°ƒç”¨è¿”å›çš„æ•°æ®ä¼šè‡ªåŠ¨ç”±å½“å‰å¤„ç†çš„äº‹ä»¶çš„ key ç¡®å®šèŒƒå›´ - å‚è§ä¸‹å›¾ã€‚ å¦‚æœä½¿ç”¨ MapStateï¼Œåˆ™é€‚ç”¨ç›¸åŒçš„åŸåˆ™ï¼Œä¸åŒä¹‹å¤„åœ¨äºè¿”å›çš„æ˜¯ Map è€Œä¸æ˜¯ MyObjectã€‚å¦‚æœä½ è¢«è¿«æ‰§è¡Œç±»ä¼¼ mapState.value().get(inputEvent.getKey()) ä¹‹ç±»çš„æ“ä½œï¼Œä½ å¯èƒ½åº”è¯¥ä½¿ç”¨ ValueState è€Œä¸æ˜¯ MapStateã€‚å› ä¸ºæˆ‘ä»¬æƒ³ä¸ºæ¯ä¸ªäº‹ä»¶ key å­˜å‚¨å¤šä¸ªå€¼ï¼Œæ‰€ä»¥åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼ŒMapState æ˜¯æ­£ç¡®çš„é€‰æ‹©ã€‚ å¦‚æœ¬ç³»åˆ—çš„ç¬¬ä¸€ç¯‡åšå®¢æ‰€è¿°ï¼Œæˆ‘ä»¬å°†æ ¹æ®ä¸»åŠ¨æ¬ºè¯ˆæ£€æµ‹è§„åˆ™ä¸­æŒ‡å®šçš„ key åˆ†é…æ•°æ®ã€‚å¤šä¸ªä¸åŒçš„è§„åˆ™å¯ä»¥åŸºäºç›¸åŒçš„åˆ†ç»„ keyã€‚è¿™æ„å‘³ç€æˆ‘ä»¬çš„è­¦æŠ¥åŠŸèƒ½å¯èƒ½ä¼šæ¥æ”¶ç”±ç›¸åŒ keyï¼ˆä¾‹å¦‚ {payerId=25;beneficiaryId=12}ï¼‰é™å®šçš„äº¤æ˜“ï¼Œä½†æ³¨å®šè¦æ ¹æ®ä¸åŒçš„è§„åˆ™è¿›è¡Œè®¡ç®—ï¼Œè¿™æ„å‘³ç€æ—¶é—´çª—å£çš„é•¿åº¦å¯èƒ½ä¸åŒã€‚è¿™å°±æå‡ºäº†ä¸€ä¸ªé—®é¢˜ï¼Œå³æˆ‘ä»¬å¦‚ä½•æ‰èƒ½æœ€å¥½åœ°åœ¨ KeyedProcessFunction ä¸­å­˜å‚¨å®¹é”™çª—å£çŠ¶æ€ã€‚ä¸€ç§æ–¹æ³•æ˜¯ä¸ºæ¯ä¸ªè§„åˆ™åˆ›å»ºå’Œç®¡ç†å•ç‹¬çš„ MapStateã€‚ç„¶è€Œï¼Œè¿™ç§æ–¹æ³•ä¼šå¾ˆæµªè´¹â€”â€”æˆ‘ä»¬ä¼šå•ç‹¬ä¿å­˜é‡å æ—¶é—´çª—å£çš„çŠ¶æ€ï¼Œå› æ­¤ä¸å¿…è¦åœ°å­˜å‚¨é‡å¤çš„æ•°æ®ã€‚æ›´å¥½çš„æ–¹æ³•æ˜¯å§‹ç»ˆå­˜å‚¨åˆšå¥½è¶³å¤Ÿçš„æ•°æ®ï¼Œä»¥ä¾¿èƒ½å¤Ÿä¼°è®¡ç”±ç›¸åŒ key é™å®šçš„æ‰€æœ‰å½“å‰æ´»åŠ¨è§„åˆ™ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæ¯å½“æ·»åŠ æ–°è§„åˆ™æ—¶ï¼Œæˆ‘ä»¬å°†ç¡®å®šå…¶æ—¶é—´çª—å£æ˜¯å¦å…·æœ‰æœ€å¤§è·¨åº¦ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨ç‰¹æ®Šä¿ç•™çš„ WIDEST_RULE_KEY ä¸‹çš„å¹¿æ’­çŠ¶æ€ã€‚ 123456789101112131415161718@Overridepublic void processBroadcastElement(Rule rule, Context ctx, Collector&lt;Alert&gt; out)&#123; ... updateWidestWindowRule(rule, broadcastState);&#125;private void updateWidestWindowRule(Rule rule, BroadcastState&lt;Integer, Rule&gt; broadcastState)&#123; Rule widestWindowRule = broadcastState.get(WIDEST_RULE_KEY); if (widestWindowRule == null) &#123; broadcastState.put(WIDEST_RULE_KEY, rule); return; &#125; if (widestWindowRule.getWindowMillis() &lt; rule.getWindowMillis()) &#123; broadcastState.put(WIDEST_RULE_KEY, rule); &#125;&#125; ç°åœ¨è®©æˆ‘ä»¬æ›´è¯¦ç»†åœ°çœ‹ä¸€ä¸‹ä¸»è¦æ–¹æ³• processElement() çš„å®ç°ã€‚ åœ¨ä¸Šä¸€ç¯‡åšæ–‡ä¸­ï¼Œæˆ‘ä»¬æè¿°äº† DynamicKeyFunction å¦‚ä½•å…è®¸æˆ‘ä»¬æ ¹æ®è§„åˆ™å®šä¹‰ä¸­çš„ groupingKeyNames å‚æ•°æ‰§è¡ŒåŠ¨æ€æ•°æ®åˆ†åŒºã€‚éšåçš„æè¿°ä¸»è¦å›´ç»• DynamicAlertFunctionï¼Œå®ƒåˆ©ç”¨äº†å‰©ä½™çš„è§„åˆ™è®¾ç½®ã€‚ å¦‚åšæ–‡ç³»åˆ—çš„å‰å‡ éƒ¨åˆ†æ‰€è¿°ï¼Œæˆ‘ä»¬çš„è­¦æŠ¥å¤„ç†å‡½æ•°æ¥æ”¶ Keyed&lt;Transaction, String, Integer&gt; ç±»å‹çš„äº‹ä»¶ï¼Œå…¶ä¸­ Transaction æ˜¯ä¸»è¦çš„â€œåŒ…è£…â€äº‹ä»¶ï¼ŒString æ˜¯ keyï¼ˆpayer #x - beneficiary #y)ï¼ŒInteger æ˜¯å¯¼è‡´è°ƒåº¦æ­¤äº‹ä»¶çš„è§„åˆ™çš„ IDã€‚æ­¤è§„åˆ™ä¹‹å‰å­˜å‚¨åœ¨å¹¿æ’­çŠ¶æ€ä¸­ï¼Œå¿…é¡»é€šè¿‡ ID ä»è¯¥çŠ¶æ€ä¸­æ£€ç´¢ã€‚ä¸‹é¢æ˜¯å®ç°ä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142public class DynamicAlertFunction extends KeyedBroadcastProcessFunction&lt; String, Keyed&lt;Transaction, String, Integer&gt;, Rule, Alert&gt; &#123; private transient MapState&lt;Long, Set&lt;Transaction&gt;&gt; windowState; @Override public void processElement( Keyed&lt;Transaction, String, Integer&gt; value, ReadOnlyContext ctx, Collector&lt;Alert&gt; out)&#123; // Add Transaction to state long currentEventTime = value.getWrapped().getEventTime(); // &lt;--- (1) addToStateValuesSet(windowState, currentEventTime, value.getWrapped()); // Calculate the aggregate value Rule rule = ctx.getBroadcastState(Descriptors.rulesDescriptor).get(value.getId()); // &lt;--- (2) Long windowStartTimestampForEvent = rule.getWindowStartTimestampFor(currentEventTime);// &lt;--- (3) SimpleAccumulator&lt;BigDecimal&gt; aggregator = RuleHelper.getAggregator(rule); // &lt;--- (4) for (Long stateEventTime : windowState.keys()) &#123; if (isStateValueInWindow(stateEventTime, windowStartForEvent, currentEventTime)) &#123; aggregateValuesInState(stateEventTime, aggregator, rule); &#125; &#125; // Evaluate the rule and trigger an alert if violated BigDecimal aggregateResult = aggregator.getLocalValue(); // &lt;--- (5) boolean isRuleViolated = rule.apply(aggregateResult); if (isRuleViolated) &#123; long decisionTime = System.currentTimeMillis(); out.collect(new Alert&lt;&gt;(rule.getRuleId(), rule, value.getKey(), decisionTime, value.getWrapped(), aggregateResult)); &#125; // Register timers to ensure state cleanup long cleanupTime = (currentEventTime / 1000) * 1000; // &lt;--- (6) ctx.timerService().registerEventTimeTimer(cleanupTime); &#125; ä»¥ä¸‹æ˜¯æ­¥éª¤çš„è¯¦ç»†ä¿¡æ¯ï¼š 1ï¼‰æˆ‘ä»¬é¦–å…ˆå°†æ¯ä¸ªæ–°äº‹ä»¶æ·»åŠ åˆ°æˆ‘ä»¬çš„çª—å£çŠ¶æ€ï¼š 123456789101112static &lt;K, V&gt; Set&lt;V&gt; addToStateValuesSet(MapState&lt;K, Set&lt;V&gt;&gt; mapState, K key, V value) throws Exception &#123; Set&lt;V&gt; valuesSet = mapState.get(key); if (valuesSet != null) &#123; valuesSet.add(value); &#125; else &#123; valuesSet = new HashSet&lt;&gt;(); valuesSet.add(value); &#125; mapState.put(key, valuesSet); return valuesSet;&#125; 2ï¼‰æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ£€ç´¢å…ˆå‰å¹¿æ’­çš„è§„åˆ™ï¼Œéœ€è¦æ ¹æ®è¯¥è§„åˆ™è®¡ç®—ä¼ å…¥çš„äº¤æ˜“æ•°æ®ã€‚ 3) getWindowStartTimestampFor ç¡®å®šï¼Œç»™å®šè§„åˆ™ä¸­å®šä¹‰çš„çª—å£è·¨åº¦å’Œå½“å‰äº‹ä»¶æ—¶é—´æˆ³ï¼Œç„¶åè®¡ç®—çª—å£åº”è¯¥è·¨åº¦å¤šä¹…ã€‚ 4) é€šè¿‡è¿­ä»£æ‰€æœ‰çª—å£çŠ¶æ€å¹¶åº”ç”¨èšåˆå‡½æ•°æ¥è®¡ç®—èšåˆå€¼ã€‚å®ƒå¯ä»¥æ˜¯å¹³å‡å€¼ã€æœ€å¤§å€¼ã€æœ€å°å€¼ï¼Œæˆ–è€…å¦‚æœ¬æ–‡å¼€å¤´çš„ç¤ºä¾‹è§„åˆ™ä¸­çš„æ€»å’Œã€‚ 1234567891011121314private boolean isStateValueInWindow( Long stateEventTime, Long windowStartForEvent, long currentEventTime) &#123; return stateEventTime &gt;= windowStartForEvent &amp;&amp; stateEventTime &lt;= currentEventTime;&#125;private void aggregateValuesInState( Long stateEventTime, SimpleAccumulator&lt;BigDecimal&gt; aggregator, Rule rule) throws Exception &#123; Set&lt;Transaction&gt; inWindow = windowState.get(stateEventTime); for (Transaction event : inWindow) &#123; BigDecimal aggregatedValue = FieldsExtractor.getBigDecimalByName(rule.getAggregateFieldName(), event); aggregator.add(aggregatedValue); &#125;&#125; 5) æœ‰äº†èšåˆå€¼ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶ä¸è§„åˆ™å®šä¹‰ä¸­æŒ‡å®šçš„é˜ˆå€¼è¿›è¡Œæ¯”è¾ƒï¼Œå¹¶åœ¨å¿…è¦æ—¶å‘å‡ºè­¦æŠ¥ã€‚ 6) æœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨ ctx.timerService().registerEventTimeTimer() æ³¨å†Œä¸€ä¸ªæ¸…ç†è®¡æ—¶å™¨ã€‚å½“å®ƒè¦ç§»å‡ºèŒƒå›´æ—¶ï¼Œæ­¤è®¡æ—¶å™¨å°†è´Ÿè´£åˆ é™¤å½“å‰æ•°æ®ã€‚ 7) onTimer æ–¹æ³•ä¼šè§¦å‘çª—å£çŠ¶æ€çš„æ¸…ç†ã€‚ å¦‚å‰æ‰€è¿°ï¼Œæˆ‘ä»¬æ€»æ˜¯åœ¨çŠ¶æ€ä¸­ä¿ç•™å°½å¯èƒ½å¤šçš„äº‹ä»¶ï¼Œä»¥è®¡ç®—å…·æœ‰æœ€å®½çª—å£è·¨åº¦çš„æ´»åŠ¨è§„åˆ™ã€‚è¿™æ„å‘³ç€åœ¨æ¸…ç†è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦åˆ é™¤è¿™ä¸ªæœ€å®½çª—å£èŒƒå›´ä¹‹å¤–çš„çŠ¶æ€ã€‚ è¿™æ˜¯æ¸…ç†ç¨‹åºçš„å®ç°æ–¹å¼ï¼š 123456789101112131415161718192021222324252627@Overridepublic void onTimer(final long timestamp, final OnTimerContext ctx, final Collector&lt;Alert&gt; out) throws Exception &#123; Rule widestWindowRule = ctx.getBroadcastState(Descriptors.rulesDescriptor).get(WIDEST_RULE_KEY); Optional&lt;Long&gt; cleanupEventTimeWindow = Optional.ofNullable(widestWindowRule).map(Rule::getWindowMillis); Optional&lt;Long&gt; cleanupEventTimeThreshold = cleanupEventTimeWindow.map(window -&gt; timestamp - window); // Remove events that are older than (timestamp - widestWindowSpan)ms cleanupEventTimeThreshold.ifPresent(this::evictOutOfScopeElementsFromWindow);&#125;private void evictOutOfScopeElementsFromWindow(Long threshold) &#123; try &#123; Iterator&lt;Long&gt; keys = windowState.keys().iterator(); while (keys.hasNext()) &#123; Long stateEventTime = keys.next(); if (stateEventTime &lt; threshold) &#123; keys.remove(); &#125; &#125; &#125; catch (Exception ex) &#123; throw new RuntimeException(ex); &#125;&#125; ä»¥ä¸Šæ˜¯å®ç°ç»†èŠ‚çš„æè¿°ã€‚æˆ‘ä»¬çš„æ–¹æ³•ä¼šåœ¨æ–°äº¤æ˜“æ•°æ®åˆ°è¾¾æ—¶ç«‹å³è§¦å‘å¯¹æ—¶é—´çª—å£çš„è®¡ç®—ã€‚å› æ­¤ï¼Œå®ƒæ»¡è¶³äº†æˆ‘ä»¬çš„ä¸»è¦è¦æ±‚â€”â€”å‘å‡ºè­¦æŠ¥çš„ä½å»¶è¿Ÿã€‚å®Œæ•´çš„å®ç°è¯·çœ‹ github ä¸Šçš„é¡¹ç›®ä»£ç  https://github.com/afedulov/fraud-detection-demoã€‚ å®Œå–„å’Œä¼˜åŒ–ä¸Šé¢æè¿°çš„æ–¹æ³•çš„ä¼˜ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ ä¼˜ç‚¹ï¼š ä½å»¶è¿Ÿèƒ½åŠ› å…·æœ‰æ½œåœ¨ç”¨ä¾‹ç‰¹å®šä¼˜åŒ–çš„å®šåˆ¶è§£å†³æ–¹æ¡ˆ é«˜æ•ˆçš„çŠ¶æ€é‡ç”¨ï¼ˆå…·æœ‰ç›¸åŒ key çš„è§„åˆ™å…±äº«çŠ¶æ€ï¼‰ ç¼ºç‚¹ï¼š æ— æ³•åˆ©ç”¨ç°æœ‰ Window API ä¸­æ½œåœ¨çš„æœªæ¥ä¼˜åŒ– æ— å»¶è¿Ÿäº‹ä»¶å¤„ç†ï¼Œå¯åœ¨ Window API ä¸­å¼€ç®±å³ç”¨ äºŒæ¬¡è®¡ç®—å¤æ‚åº¦å’Œæ½œåœ¨çš„å¤§çŠ¶æ€ ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹åä¸¤ä¸ªç¼ºç‚¹ï¼Œçœ‹çœ‹æˆ‘ä»¬æ˜¯å¦å¯ä»¥è§£å†³å®ƒä»¬ã€‚ å»¶è¿Ÿæ•°æ®å¤„ç†å»¶è¿Ÿæ•°æ®ä¹‹å‰å…ˆæå‡ºäº†ä¸€ä¸ªé—®é¢˜ - åœ¨å»¶è¿Ÿæ•°æ®åˆ°è¾¾çš„æƒ…å†µä¸‹é‡æ–°è¯„ä¼°çª—å£æ˜¯å¦ä»ç„¶æœ‰æ„ä¹‰ï¼Ÿ å¦‚æœéœ€è¦è¿™æ ·åšï¼Œä½ éœ€è¦å¢åŠ æœ€å®½çš„çª—å£å¤§å°ï¼Œç”¨æ¥å…è®¸å®¹å¿æœ€å¤§çš„æ•°æ®å»¶è¿Ÿã€‚è¿™æ ·å°†é¿å…å› å»¶è¿Ÿæ•°æ®é—®é¢˜å¯¼è‡´è§¦å‘äº†ä¸å®Œæ•´çš„æ—¶é—´çª—å£æ•°æ®ã€‚ ç„¶è€Œï¼Œå¯ä»¥è¯´ï¼Œå¯¹äºå¼ºè°ƒä½å»¶è¿Ÿå¤„ç†çš„åœºæ™¯ï¼Œè¿™ç§å»¶è¿Ÿè§¦å‘å°†æ¯«æ— æ„ä¹‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥è·Ÿè¸ªåˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬è§‚å¯Ÿåˆ°çš„æœ€æ–°æ—¶é—´æˆ³ï¼Œå¯¹äºä¸ä¼šå•è°ƒå¢åŠ æ­¤å€¼çš„äº‹ä»¶ï¼Œåªéœ€å°†å®ƒä»¬æ·»åŠ åˆ°çŠ¶æ€å¹¶è·³è¿‡èšåˆè®¡ç®—å’Œè­¦æŠ¥è§¦å‘é€»è¾‘ã€‚ å†—ä½™é‡å¤è®¡ç®—å’ŒçŠ¶æ€å¤§å°åœ¨æˆ‘ä»¬æè¿°çš„å®ç°ä¸­ï¼Œæˆ‘ä»¬ä¿å­˜æ¯æ¡æ•°æ®å¤„äºçŠ¶æ€ä¸­å¹¶åœ¨æ¯ä¸ªæ–°æ•°æ®æ¥æ—¶éå†å®ƒä»¬å¹¶ä¸€æ¬¡åˆä¸€æ¬¡åœ°è®¡ç®—èšåˆã€‚è¿™åœ¨é‡å¤è®¡ç®—ä¸Šæµªè´¹è®¡ç®—èµ„æºæ–¹é¢æ˜¾ç„¶ä¸æ˜¯æœ€ä½³çš„ã€‚ ä¿å­˜æ¯ä¸ªäº¤æ˜“æ•°æ®å¤„äºçŠ¶æ€çš„ä¸»è¦åŸå› æ˜¯ä»€ä¹ˆï¼Ÿå­˜å‚¨äº‹ä»¶çš„ç²’åº¦ç›´æ¥å¯¹åº”äºæ—¶é—´çª—å£è®¡ç®—çš„ç²¾åº¦ã€‚å› ä¸ºæˆ‘ä»¬æ˜¯å­˜å‚¨æ¯æ¡æ˜ç»†äº¤æ˜“æ•°æ®ï¼Œæ‰€ä»¥ä¸€æ—¦å®ƒä»¬ç¦»å¼€ç²¾ç¡®çš„ 2592000000 æ¯«ç§’æ—¶é—´çª—å£ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½çš„ 30 å¤©ï¼‰ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç²¾ç¡®åœ°ç§»é™¤å®ƒä»¬ã€‚åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œå€¼å¾—æå‡ºä¸€ä¸ªé—®é¢˜â€”â€”åœ¨ä¼°è®¡è¿™ä¹ˆé•¿çš„æ—¶é—´çª—å£æ—¶ï¼Œæˆ‘ä»¬çœŸçš„éœ€è¦è¿™ä¸ªæ¯«ç§’çº§çš„ç²¾åº¦ï¼Œè¿˜æ˜¯åœ¨ç‰¹æ®Šæƒ…å†µä¸‹å¯ä»¥æ¥å—æ½œåœ¨çš„è¯¯æŠ¥ï¼Ÿå¦‚æœä½ çš„ç”¨ä¾‹çš„ç­”æ¡ˆæ˜¯ä¸éœ€è¦è¿™æ ·çš„ç²¾åº¦ï¼Œé‚£ä¹ˆä½ å¯ä»¥åŸºäºåˆ†æ¡¶å’Œé¢„èšåˆå®æ–½é¢å¤–çš„ä¼˜åŒ–ã€‚è¿™ç§ä¼˜åŒ–çš„æ€æƒ³å¯ä»¥åˆ†è§£å¦‚ä¸‹ï¼š ä¸æ˜¯å­˜å‚¨æ¯æ¡æ˜ç»†äº¤æ˜“æ•°æ®ï¼Œè€Œæ˜¯åˆ›å»ºä¸€ä¸ªçˆ¶ç±»ï¼Œè¯¥ç±»å¯ä»¥åŒ…å«å•æ¡æ•°æ®çš„å­—æ®µæˆ–æ˜¯æ ¹æ®èšåˆå‡½æ•°è®¡ç®—å¤„ç†ä¸€æ‰¹æ•°æ®åçš„èšåˆå€¼ã€‚ ä¸è¦ä½¿ç”¨ä»¥æ¯«ç§’ä¸ºå•ä½çš„æ—¶é—´æˆ³ä½œä¸º MapState keyï¼Œè€Œæ˜¯å°†å®ƒä»¬å››èˆäº”å…¥åˆ°ä½ æ„¿æ„æ¥å—çš„ç²’åº¦çº§åˆ«ï¼ˆä¾‹å¦‚ï¼Œä¸€åˆ†é’Ÿï¼‰ï¼Œå°†æ•°æ®åˆ†æ¡¶ã€‚ æ¯å½“è®¡ç®—çª—å£æ—¶ï¼Œå°†æ–°çš„äº¤æ˜“æ•°æ®å­˜å‚¨åˆ°èšåˆæ¡¶ä¸­ï¼Œè€Œä¸æ˜¯ä¸ºæ¯ä¸ªæ•°æ®å­˜å‚¨å•ç‹¬çš„æ•°æ®ç‚¹ã€‚ çŠ¶æ€æ•°æ®å’Œåºåˆ—åŒ–å™¨ä¸ºäº†è¿›ä¸€æ­¥ä¼˜åŒ–å®ç°ï¼Œæˆ‘ä»¬å¯ä»¥é—®è‡ªå·±çš„å¦ä¸€ä¸ªé—®é¢˜æ˜¯è·å¾—å…·æœ‰å®Œå…¨ç›¸åŒæ—¶é—´æˆ³çš„ä¸åŒäº‹ä»¶çš„å¯èƒ½æ€§æœ‰å¤šå¤§ã€‚åœ¨æ‰€æè¿°çš„å®ç°ä¸­ï¼Œæˆ‘ä»¬å±•ç¤ºäº†é€šè¿‡åœ¨ MapState&lt;Long, Set&lt;Transaction&gt;&gt; ä¸­å­˜å‚¨æ¯ä¸ªæ—¶é—´æˆ³çš„æ•°æ®é›†æ¥è§£å†³è¿™ä¸ªé—®é¢˜çš„ä¸€ç§æ–¹æ³•ã€‚ä½†æ˜¯ï¼Œè¿™ç§é€‰æ‹©å¯¹æ€§èƒ½çš„å½±å“å¯èƒ½æ¯”é¢„æœŸçš„è¦å¤§ã€‚åŸå› æ˜¯ Flink å½“å‰ä¸æä¾›åŸç”Ÿ Set åºåˆ—åŒ–å™¨ï¼Œè€Œæ˜¯å¼ºåˆ¶ä½¿ç”¨æ•ˆç‡è¾ƒä½çš„ Kryo åºåˆ—åŒ–å™¨ï¼ˆFLINK-16729ï¼‰ã€‚ä¸€ä¸ªæœ‰æ„ä¹‰çš„æ›¿ä»£ç­–ç•¥æ˜¯å‡è®¾åœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œæ²¡æœ‰ä¸¤ä¸ªæœ‰å·®å¼‚çš„äº‹ä»¶å¯ä»¥å…·æœ‰å®Œå…¨ç›¸åŒçš„æ—¶é—´æˆ³ï¼Œå¹¶å°†çª—å£çŠ¶æ€è½¬æ¢ä¸º MapState&lt;Long, Transaction&gt; ç±»å‹ã€‚ä½ å¯ä»¥ä½¿ç”¨è¾…åŠ©è¾“å‡ºæ¥æ”¶é›†å’Œç›‘æ§ä¸ä½ çš„å‡è®¾ç›¸çŸ›ç›¾çš„ä»»ä½•æ„å¤–äº‹ä»¶ã€‚æ€§èƒ½ä¼˜åŒ–æœŸé—´ï¼Œæˆ‘é€šå¸¸å»ºè®®ä½ ç¦ç”¨ Kryoï¼Œå¹¶é€šè¿‡ç¡®ä¿ä½¿ç”¨æ›´é«˜æ•ˆçš„åºåˆ—åŒ–ç¨‹åºæ¥éªŒè¯ä½ çš„åº”ç”¨ç¨‹åºå¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–çš„ä½ç½®ã€‚ ä½ å¯ä»¥é€šè¿‡è®¾ç½®æ–­ç‚¹å¹¶éªŒè¯è¿”å›çš„ TypeInformation çš„ç±»å‹æ¥å¿«é€Ÿç¡®å®šä½ çš„ç±»å°†ä½¿ç”¨å“ªä¸ªåºåˆ—åŒ–ç¨‹åºã€‚ PojoTypeInfo è¡¨ç¤ºå°†ä½¿ç”¨é«˜æ•ˆçš„ Flink POJO åºåˆ—åŒ–å™¨ã€‚ GenericTypeInfo è¡¨ç¤ºä½¿ç”¨äº† Kryo åºåˆ—åŒ–ç¨‹åºã€‚ äº¤æ˜“æ•°æ®ä¿®å‰ªï¼šæˆ‘ä»¬å¯ä»¥å°†å•ä¸ªäº‹ä»¶æ•°æ®å‡å°‘åˆ°ä»…è¦ç”¨åˆ°çš„å­—æ®µï¼Œè€Œä¸æ˜¯å­˜å‚¨å®Œæ•´çš„äº‹ä»¶æ•°æ®ï¼Œå‡å°‘æ•°æ®åºåˆ—åŒ–ä¸ååºåˆ—åŒ–å¯¹æœºå™¨æ–½åŠ é¢å¤–çš„å‹åŠ›ã€‚è¿™å¯èƒ½éœ€è¦æ ¹æ®æ´»åŠ¨è§„åˆ™çš„é…ç½®å°†å•ä¸ªäº‹ä»¶æå–éœ€è¦å¯¹å­—æ®µå‡ºæ¥ï¼Œå¹¶å°†è¿™äº›å­—æ®µå­˜å‚¨åˆ°é€šç”¨ Map æ•°æ®ç»“æ„ä¸­ã€‚ è™½ç„¶è¿™ç§è°ƒæ•´å¯èƒ½ä¼šå¯¹å¤§å¯¹è±¡äº§ç”Ÿæ˜¾è‘—çš„æ”¹è¿›ï¼Œä½†å®ƒä¸åº”è¯¥æ˜¯ä½ çš„é¦–é€‰ã€‚ æ€»ç»“æœ¬æ–‡æ€»ç»“äº†æˆ‘ä»¬åœ¨ç¬¬ä¸€éƒ¨åˆ†ä¸­å¼€å§‹çš„æ¬ºè¯ˆæ£€æµ‹å¼•æ“çš„å®ç°æè¿°ã€‚åœ¨è¿™ç¯‡åšæ–‡ä¸­ï¼Œæˆ‘ä»¬æ¼”ç¤ºäº†å¦‚ä½•åˆ©ç”¨ ProcessFunction æ¥â€œæ¨¡æ‹Ÿâ€å…·æœ‰å¤æ‚è‡ªå®šä¹‰é€»è¾‘çš„çª—å£ã€‚æˆ‘ä»¬å·²ç»è®¨è®ºäº†è¿™ç§æ–¹æ³•çš„ä¼˜ç¼ºç‚¹ï¼Œå¹¶è¯¦ç»†è¯´æ˜äº†å¦‚ä½•åº”ç”¨è‡ªå®šä¹‰åœºæ™¯ç‰¹å®šçš„ä¼˜åŒ– - è¿™æ˜¯ Window API æ— æ³•ç›´æ¥å®ç°çš„ã€‚ è¿™ç¯‡åšæ–‡çš„ç›®çš„æ˜¯è¯´æ˜ Apache Flink API çš„å¼ºå¤§åŠŸèƒ½å’Œçµæ´»æ€§ã€‚å®ƒçš„æ ¸å¿ƒæ˜¯ Flink çš„æ”¯æŸ±ï¼Œä½œä¸ºå¼€å‘äººå‘˜ï¼Œå®ƒä¸ºä½ èŠ‚çœäº†å¤§é‡çš„å·¥ä½œï¼Œå¹¶é€šè¿‡æä¾›ä»¥ä¸‹å†…å®¹å¾ˆå¥½åœ°æ¨å¹¿åˆ°å¹¿æ³›çš„ç”¨ä¾‹ï¼š åˆ†å¸ƒå¼é›†ç¾¤ä¸­çš„é«˜æ•ˆæ•°æ®äº¤æ¢ é€šè¿‡æ•°æ®åˆ†åŒºçš„æ°´å¹³å¯æ‰©å±•æ€§ å…·æœ‰å¿«é€Ÿæœ¬åœ°è®¿é—®çš„å®¹é”™çŠ¶æ€ æ–¹ä¾¿å¤„ç†çŠ¶æ€æ•°æ®ï¼Œå°±åƒä½¿ç”¨å±€éƒ¨å˜é‡ä¸€æ ·ç®€å• å¤šçº¿ç¨‹ã€å¹¶è¡Œæ‰§è¡Œå¼•æ“ã€‚ ProcessFunction ä»£ç åœ¨å•çº¿ç¨‹ä¸­è¿è¡Œï¼Œæ— éœ€åŒæ­¥ã€‚ Flink å¤„ç†æ‰€æœ‰å¹¶è¡Œæ‰§è¡Œæ–¹é¢å¹¶æ­£ç¡®è®¿é—®å…±äº«çŠ¶æ€ï¼Œè€Œä½ ä½œä¸ºå¼€å‘äººå‘˜ä¸å¿…è€ƒè™‘ï¼ˆå¹¶å‘å¾ˆéš¾ï¼‰ã€‚ æ‰€æœ‰è¿™äº›æ–¹é¢éƒ½ä½¿å¾—ä½¿ç”¨ Flink æ„å»ºåº”ç”¨ç¨‹åºæˆä¸ºå¯èƒ½ï¼Œè¿™äº›åº”ç”¨ç¨‹åºè¿œè¿œè¶…å‡ºäº†æ™®é€šçš„æµ ETL ç”¨ä¾‹ï¼Œå¹¶ä¸”å¯ä»¥å®ç°ä»»æ„å¤æ‚çš„åˆ†å¸ƒå¼äº‹ä»¶é©±åŠ¨åº”ç”¨ç¨‹åºã€‚ä½¿ç”¨ Flinkï¼Œä½ å¯ä»¥é‡æ–°æ€è€ƒå¤„ç†å¹¿æ³›ç”¨ä¾‹çš„æ–¹æ³•ï¼Œè¿™äº›ç”¨ä¾‹é€šå¸¸ä¾èµ–äºä½¿ç”¨æ— çŠ¶æ€å¹¶è¡Œæ‰§è¡ŒèŠ‚ç‚¹å¹¶å°†çŠ¶æ€å®¹é”™é—®é¢˜â€œæ¨â€åˆ°æ•°æ®åº“ï¼Œè¿™ç§æ–¹æ³•é€šå¸¸æ³¨å®šä¼šé‡åˆ°å¯æ‰©å±•æ€§é—®é¢˜é¢å¯¹ä¸æ–­å¢é•¿çš„æ•°æ®é‡ã€‚ æœ¬ç¯‡æ–‡ç« å±äºç¿»è¯‘æ–‡ç« ï¼Œä½œè€…ï¼šzhisheng åŸæ–‡åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2021/07/03/Flink-Fraud-Detection-engine-3/ è‹±æ–‡ä½œè€…ï¼šalex_fedulov è‹±æ–‡åŸæ–‡åœ°å€ï¼šhttps://flink.apache.org/news/2020/07/30/demo-fraud-detection-3.html å…³æ³¨æˆ‘å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ ä¸“æ ä»‹ç»é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f Github ä»£ç ä»“åº“https://github.com/zhisheng17/flink-learning/ ä»¥åè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç éƒ½å°†æ”¾åœ¨è¿™ä¸ªä»“åº“é‡Œï¼ŒåŒ…å«äº†è‡ªå·±å­¦ä¹  flink çš„ä¸€äº› demo å’Œåšå®¢ åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€åŸç†ã€å®æˆ˜ã€æ€§èƒ½è°ƒä¼˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"å®æ—¶è®¡ç®—","slug":"å®æ—¶è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/å®æ—¶è®¡ç®—/"}]},{"title":"åŸºäº Flink çš„åŠ¨æ€æ¬ºè¯ˆæ£€æµ‹ç³»ç»Ÿ(ä¸­)","date":"2021-01-22T16:00:00.000Z","path":"2021/01/23/Flink-Fraud-Detection-engine-2/","text":"å¦‚ä½•å®ç°å‘¢ï¼Ÿ å‰è¨€åœ¨ä¸Šä¸€ç¯‡åšå®¢ä¸­ï¼Œæˆ‘ä»¬å¯¹æ¬ºè¯ˆæ£€æµ‹å¼•æ“çš„ç›®æ ‡å’Œæ‰€éœ€è¦çš„åŠŸèƒ½è¿›è¡Œäº†æè¿°ï¼Œæˆ‘ä»¬è¿˜æè¿°äº†å¦‚ä½•åŸºäºå¯ä¿®æ”¹çš„è§„åˆ™è€Œä¸æ˜¯ä½¿ç”¨ç¡¬ç¼–ç çš„ KeysExtractor å®ç° Flink åº”ç”¨ç¨‹åºçš„æ•°æ®è‡ªå®šä¹‰åˆ†åŒºã€‚ æˆ‘ä»¬åœ¨ä¸Šç¯‡åšå®¢ä¸­ç‰¹æ„çœç•¥äº†æœ‰å…³å¦‚ä½•åˆå§‹åŒ–åº”ç”¨çš„è§„åˆ™ä»¥åŠå¦‚ä½•åœ¨ä½œä¸šè¿è¡Œæ—¶æ›´æ–°çš„ç»†èŠ‚ï¼Œåœ¨æœ¬æ–‡æˆ‘ä»¬å°†è¯¦ç»†çš„ä»‹ç»è¿™äº›ç»†èŠ‚ï¼Œä½ å°†å­¦ä¹ å¦‚ä½•å°†ä¸Šç¯‡åšå®¢ä¸­æè¿°çš„æ•°æ®åˆ†åŒºé˜²å¾¡ä¸åŠ¨æ€é…ç½®ç»“åˆä½¿ç”¨ï¼Œå½“è¿™ä¸¤ç§æ¨¡å¼ç»“åˆä½¿ç”¨çš„æ—¶å€™ï¼Œå¯ä»¥çœå»é‡æ–°ç¼–è¯‘ä»£ç å’Œé‡æ–°éƒ¨ç½² Flink ä½œä¸šçš„éœ€è¦ï¼Œä»è€Œå¯ä»¥åº”å¯¹å¤šç§ä¸šåŠ¡åœºæ™¯é€»è¾‘ä¿®æ”¹çš„æƒ…å†µã€‚ å¹¿æ’­è§„åˆ™é¦–å…ˆè®©æˆ‘ä»¬çœ‹çœ‹é¢„å®šä¹‰çš„æ•°æ®å¤„ç†ä»£ç ï¼š 12345DataStream&lt;Alert&gt; alerts = transactions .process(new DynamicKeyFunction()) .keyBy((keyed) -&gt; keyed.getKey()); .process(new DynamicAlertFunction()) DynamicKeyFunction å‡½æ•°æä¾›åŠ¨æ€æ•°æ®åˆ†åŒºï¼ŒåŒæ—¶ DynamicAlertFunction å‡½æ•°è´Ÿè´£æ‰§è¡Œå¤„ç†æ•°æ®çš„ä¸»è¦é€»è¾‘å¹¶æ ¹æ®å·²å®šä¹‰çš„è§„åˆ™å‘åŠ¨å‘Šè­¦æ¶ˆæ¯ã€‚ åœ¨ä¸Šç¯‡æ–‡ä¸­ä¸­ç®€åŒ–äº†ç”¨ä¾‹ï¼Œå¹¶å‡å®šå·²é¢„å…ˆåˆå§‹åŒ–äº†æ‰€åº”ç”¨çš„è§„åˆ™é›†æ•°æ®ï¼Œå¹¶å¯ä»¥é€šè¿‡ DynamicKeyFunction çš„ List&lt;Rules&gt; è®¿é—®è¿™äº›è§„åˆ™ï¼š 1234567public class DynamicKeyFunction extends ProcessFunction&lt;Transaction, Keyed&lt;Transaction, String, Integer&gt;&gt; &#123; /* Simplified */ List&lt;Rule&gt; rules = /* Rules that are initialized somehow.*/; ...&#125; æ˜¾ç„¶ï¼Œåœ¨åˆå§‹åŒ–é˜¶æ®µï¼Œå¯ä»¥ç›´æ¥åœ¨ Flink Job çš„ä»£ç å†…éƒ¨æ·»åŠ è§„åˆ™åˆ°æ­¤åˆ—è¡¨ï¼ˆåˆ›å»ºListå¯¹è±¡ï¼›ä½¿ç”¨å®ƒçš„addæ–¹æ³•ï¼‰ã€‚è¿™æ ·åšçš„ä¸»è¦ç¼ºç‚¹æ˜¯ï¼Œæ¯æ¬¡ä¿®æ”¹è§„åˆ™åéƒ½éœ€è¦é‡æ–°ç¼–è¯‘ä½œä¸šã€‚åœ¨çœŸå®çš„æ¬ºè¯ˆæ£€æµ‹ç³»ç»Ÿä¸­ï¼Œè§„åˆ™ä¼šç»å¸¸æ›´æ”¹ï¼Œå› æ­¤ä»ä¸šåŠ¡å’Œè¿è¥éœ€æ±‚çš„è§’åº¦æ¥çœ‹ï¼Œä½¿æ­¤æ–¹æ³•ä¸å¯æ¥å—ï¼Œéœ€è¦ä¸€ç§ä¸åŒçš„æ–¹æ³•ã€‚ æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ä»‹ç»çš„ç¤ºä¾‹è§„åˆ™å®šä¹‰ï¼š ä¸Šä¸€ç¯‡æ–‡ç« ä»‹ç»äº†ä½¿ç”¨ DynamicKeyFunctionæå–æ•°æ®å« groupingKeyNames é‡Œé¢å­—æ®µç»„æˆæ•°æ®åˆ†ç»„ key çš„æ–¹æ³•ã€‚æ­¤è§„åˆ™ç¬¬äºŒéƒ¨åˆ†ä¸­çš„å‚æ•°ç”± DynamicAlertFunction ä½¿ç”¨ï¼šå®ƒä»¬å®šä¹‰äº†æ‰€æ‰§è¡Œæ“ä½œçš„å®é™…é€»è¾‘åŠå…¶å‚æ•°ï¼ˆä¾‹å¦‚å‘Šè­¦è§¦å‘é™åˆ¶ï¼‰ã€‚è¿™æ„å‘³ç€ç›¸åŒçš„è§„åˆ™å¿…é¡»åŒæ—¶å­˜åœ¨äºDynamicKeyFunctionå’ŒDynamicAlertFunctionã€‚ ä¸‹å›¾å±•ç¤ºäº†æˆ‘ä»¬æ­£åœ¨æ„å»ºçš„ç³»ç»Ÿçš„æœ€ç»ˆå·¥ä½œå›¾ï¼š ä¸Šå›¾çš„ä¸»è¦æ¨¡å—æ˜¯ï¼š Transaction Sourceï¼šFlink ä½œä¸šçš„ Source ç«¯ï¼Œå®ƒä¼šå¹¶è¡Œçš„æ¶ˆè´¹ Kafka ä¸­çš„é‡‘èäº¤æ˜“æµæ•°æ® **Dynamic Key Functionï¼šåŠ¨æ€çš„æå–æ•°æ®åˆ†åŒºçš„ keyã€‚éšåçš„keyByå‡½æ•°ä¼šå°†åŠ¨æ€çš„ key å€¼è¿›è¡Œ hashï¼Œå¹¶åœ¨åç»­è¿ç®—ç¬¦çš„æ‰€æœ‰å¹¶è¡Œå®ä¾‹ä¹‹é—´ç›¸åº”åœ°å¯¹æ•°æ®è¿›è¡Œåˆ†åŒºã€‚ Dynamic Alert Functionï¼šç´¯ç§¯çª—å£ä¸­çš„æ•°æ®ï¼Œå¹¶åŸºäºè¯¥çª—å£åˆ›å»ºå‘Šè­¦ã€‚ Apache Flink å†…éƒ¨çš„æ•°æ®äº¤æ¢ä¸Šé¢çš„ä½œä¸šå›¾è¿˜å±•ç¤ºäº†è¿ç®—ç¬¦ä¹‹é—´çš„å„ç§æ•°æ®äº¤æ¢æ¨¡å¼ï¼Œä¸ºäº†äº†è§£å¹¿æ’­æ¨¡å¼æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ Apache Flink åœ¨åˆ†å¸ƒå¼è¿è¡Œæ—¶å­˜åœ¨å“ªäº›æ¶ˆæ¯ä¼ æ’­æ–¹æ³•ï¼š FORWARDï¼šä¸Šå›¾ä¸­ Transaction Source åçš„ FORWARD æ„å‘³ç€æ¯ä¸ª Transaction Source çš„å¹¶è¡Œåº¦å®ä¾‹æ¶ˆè´¹åˆ°çš„æ•°æ®éƒ½å°†ç²¾ç¡®çš„ä¼ è¾“åˆ°åé¢çš„ DynamicKeyFunction è¿ç®—ç¬¦çš„æ¯ä¸ªå®ä¾‹ã€‚å®ƒè¿˜è¡¨ç¤ºä¸¤ä¸ªè¿æ¥çš„è¿ç®—ç¬¦å¤„äºç›¸åŒçš„å¹¶è¡Œåº¦ï¼Œè¿™ç§æ¨¡å¼å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š HASHï¼šDynamicKeyFunction å’Œ DynamicAlertFunction ä¹‹é—´çš„ HASH æ„å‘³ç€æ¯æ¡æ¶ˆæ¯éƒ½ä¼šè®¡ç®—ä¸€ä¸ªå“ˆå¸Œå€¼ï¼Œå¹¶ä¸”æ¶ˆæ¯ä¼šåœ¨ä¸‹ä¸€ä¸ªè¿ç®—ç¬¦çš„æ‰€æœ‰å¯ç”¨å¹¶è¡Œåº¦ä¹‹é—´å‡åŒ€åˆ†é…ï¼Œè¿™ç§è¿æ¥ä¸€èˆ¬æ˜¯é€šè¿‡ keyBy ç®—å­ã€‚ REBALANCEï¼šè¿™ç§æƒ…å†µä¸‹ä¸€èˆ¬æ˜¯æ‰‹åŠ¨çš„è°ƒç”¨ rebalance() å‡½æ•°æˆ–è€…å¹¶è¡Œåº¦å‘ç”Ÿæ”¹å˜å¯¼è‡´çš„ï¼Œè¿™æ ·ä¼šå¯¼è‡´æ•°æ®ä»¥å¾ªç¯çš„æ–¹å¼é‡æ–°åˆ†åŒºï¼Œæœ‰åŠ©äºæŸäº›æƒ…å†µå–œçˆ±çš„æ•°æ®å€¾æ–œã€‚ BROADCASTï¼šåœ¨æœ¬æ–‡å›¾äºŒä¸­çš„æ¬ºè¯ˆæ£€æµ‹ä½œä¸šå›¾ä¸­åŒ…å«äº†ä¸€ä¸ª Rules Sourceï¼Œå®ƒä¼šä» Kafka ä¸­æ¶ˆè´¹è§„åˆ™æ•°æ®ï¼Œç„¶åé€šè¿‡ BROADCAST çš„é€šé“å°†è§„åˆ™æ•°æ®å‘åŠ¨åˆ°å¤„ç†å®æ—¶æ•°æ®æµçš„ç®—å­ä¸­å»ã€‚ä¸åœ¨è¿ç®—ç¬¦ä¹‹é—´ä¼ è¾“æ•°æ®çš„å…¶ä»–æ–¹æ³•ï¼ˆä¾‹å¦‚ forwardã€hashã€rebalenceï¼Œè¿™ä¸‰ç§ä»…ä¼šå°†æ•°æ®å‘åˆ°ä¸‹æ¸¸è¿ç®—ç¬¦çš„æŸä¸ªå¹¶è¡Œåº¦ä¸­å»ï¼‰ä¸åŒï¼Œbroadcast å¯ä»¥ä½¿å¾—æ¯æ¡æ¶ˆæ¯éƒ½ä¼šåœ¨ä¸‹æ¸¸æ‰€æœ‰çš„å¹¶è¡Œåº¦ä¸­å¤„ç†ã€‚broadcast é€‚ç”¨äºéœ€è¦å½±å“æ‰€æœ‰æ¶ˆæ¯å¤„ç†çš„ä»»åŠ¡ï¼Œè€Œä¸ç®¡æ¶ˆæ¯çš„ key æˆ–è€… Source çš„åˆ†åŒºæ˜¯å¤šå°‘ã€‚ å¹¿æ’­çŠ¶æ€ä¸ºäº†ä½¿ç”¨è§„åˆ™æ•°æ®æµï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶è¿æ¥åˆ°ä¸»æ•°æ®æµï¼š 1234567891011121314// Streams setupDataStream&lt;Transaction&gt; transactions = [...]DataStream&lt;Rule&gt; rulesUpdateStream = [...]BroadcastStream&lt;Rule&gt; rulesStream = rulesUpdateStream.broadcast(RULES_STATE_DESCRIPTOR);// Processing pipeline setup DataStream&lt;Alert&gt; alerts = transactions .connect(rulesStream) .process(new DynamicKeyFunction()) .keyBy((keyed) -&gt; keyed.getKey()) .connect(rulesStream) .process(new DynamicAlertFunction()) å¦‚æ‚¨æ‰€è§ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨broadcastæ–¹æ³•å¹¶æŒ‡å®šçŠ¶æ€æè¿°ç¬¦ï¼Œä»ä»»ä½•å¸¸è§„æµä¸­åˆ›å»ºå¹¿æ’­æµã€‚åœ¨å¤„ç†ä¸»æ•°æ®æµçš„äº‹ä»¶æ—¶éœ€è¦å­˜å‚¨å’ŒæŸ¥æ‰¾å¹¿æ’­çš„æ•°æ®ï¼Œå› æ­¤ï¼ŒFlink å§‹ç»ˆæ ¹æ®æ­¤çŠ¶æ€æè¿°ç¬¦è‡ªåŠ¨åˆ›å»ºç›¸åº”çš„å¹¿æ’­çŠ¶æ€ã€‚è¿™ä¸ä½ åœ¨ä½¿ç”¨å…¶ä»–çš„çŠ¶æ€ç±»å‹ä¸ä¸€æ ·ï¼Œé‚£äº›æ˜¯éœ€è¦åœ¨ open æ–¹æ³•é‡Œé¢å¯¹å…¶è¿›è¡Œåˆå§‹åŒ–ã€‚å¦è¯·æ³¨æ„ï¼Œå¹¿æ’­çŠ¶æ€å§‹ç»ˆæ˜¯ KV æ ¼å¼ï¼ˆMapStateï¼‰ã€‚ 12public static final MapStateDescriptor&lt;Integer, Rule&gt; RULES_STATE_DESCRIPTOR = new MapStateDescriptor&lt;&gt;(\"rules\", Integer.class, Rule.class); è¿æ¥rulesStreamåä¼šå¯¼è‡´ ProcessFunction çš„å†…éƒ¨å‘ç”ŸæŸäº›å˜åŒ–ã€‚ä¸Šä¸€ç¯‡æ–‡ç« ä»¥ç¨å¾®ç®€åŒ–çš„æ–¹å¼ä»‹ç»äº†ProcessFunctionã€‚ä½†æ˜¯ DynamicKeyFunctionå®é™…ä¸Šæ˜¯ä¸€ä¸ªBroadcastProcessFunctionã€‚ 1234567891011public abstract class BroadcastProcessFunction&lt;IN1, IN2, OUT&gt; &#123; public abstract void processElement(IN1 value, ReadOnlyContext ctx, Collector&lt;OUT&gt; out) throws Exception; public abstract void processBroadcastElement(IN2 value, Context ctx, Collector&lt;OUT&gt; out) throws Exception;&#125; ä¸åŒçš„æ˜¯ï¼Œæ·»åŠ processBroadcastElement äº†æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ˜¯ç”¨äºå¤„ç†åˆ°è¾¾çš„å¹¿æ’­è§„åˆ™æµã€‚ä»¥ä¸‹æ–°ç‰ˆæœ¬çš„DynamicKeyFunction å‡½æ•°å…è®¸åœ¨ processElement æ–¹æ³•é‡Œé¢ä¸­åŠ¨æ€çš„ä¿®æ”¹æ•°æ®åˆ†å‘çš„ key åˆ—è¡¨ï¼š 1234567891011121314151617181920212223242526public class DynamicKeyFunction extends BroadcastProcessFunction&lt;Transaction, Rule, Keyed&lt;Transaction, String, Integer&gt;&gt; &#123; @Override public void processBroadcastElement(Rule rule, Context ctx, Collector&lt;Keyed&lt;Transaction, String, Integer&gt;&gt; out) &#123; BroadcastState&lt;Integer, Rule&gt; broadcastState = ctx.getBroadcastState(RULES_STATE_DESCRIPTOR); broadcastState.put(rule.getRuleId(), rule); &#125; @Override public void processElement(Transaction event, ReadOnlyContext ctx, Collector&lt;Keyed&lt;Transaction, String, Integer&gt;&gt; out)&#123; ReadOnlyBroadcastState&lt;Integer, Rule&gt; rulesState = ctx.getBroadcastState(RULES_STATE_DESCRIPTOR); for (Map.Entry&lt;Integer, Rule&gt; entry : rulesState.immutableEntries()) &#123; final Rule rule = entry.getValue(); out.collect( new Keyed&lt;&gt;( event, KeysExtractor.getKey(rule.getGroupingKeyNames(), event), rule.getRuleId())); &#125; &#125;&#125; åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼ŒprocessElement()æ¥æ”¶é‡‘èäº¤æ˜“æ•°æ®ï¼Œå¹¶åœ¨ processBroadcastElement() æ¥æ”¶è§„åˆ™æ›´æ–°æ•°æ®ã€‚åˆ›å»ºæ–°è§„åˆ™æ—¶ï¼Œå°†å¦‚ä¸Šé¢å¹¿æ’­æµçš„é‚£å¼ å›¾æ‰€ç¤ºè¿›è¡Œåˆ†é…ï¼Œå¹¶ä¼šä¿å­˜åœ¨æ‰€æœ‰ä½¿ç”¨ processBroadcastState è¿ç®—ç¬¦çš„å¹¶è¡Œå®ä¾‹ä¸­ã€‚æˆ‘ä»¬ä½¿ç”¨è§„åˆ™çš„ ID ä½œä¸ºå­˜å‚¨å’Œå¼•ç”¨å•ä¸ªè§„åˆ™çš„ keyã€‚æˆ‘ä»¬éå†åŠ¨æ€æ›´æ–°çš„å¹¿æ’­çŠ¶æ€ä¸­çš„æ•°æ®ï¼Œè€Œä¸æ˜¯éå†ç¡¬ç¼–ç çš„ List&lt;Rules&gt; ã€‚ åœ¨å°†è§„åˆ™å­˜å‚¨åœ¨å¹¿æ’­ MapState ä¸­æ—¶ï¼ŒDynamicAlertFunction éµå¾ªç›¸åŒçš„é€»è¾‘ã€‚å¦‚ç¬¬ 1 éƒ¨åˆ†ä¸­æ‰€è¿°ï¼Œé€šè¿‡processElement æ–¹æ³•è¾“å…¥çš„æ¯æ¡æ¶ˆæ¯å‡åº”æŒ‰ç…§ä¸€ä¸ªç‰¹å®šè§„åˆ™è¿›è¡Œå¤„ç†ï¼Œå¹¶é€šè¿‡ DynamicKeyFunction å¯¹å…¶è¿›è¡Œâ€œé¢„æ ‡è®°â€å¹¶å¸¦æœ‰ç›¸åº”çš„IDã€‚æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯ä½¿ç”¨æä¾›çš„ ID ä» BroadcastState ä¸­æ£€ç´¢ç›¸åº”è§„åˆ™ï¼Œå¹¶æ ¹æ®è¯¥è§„åˆ™æ‰€éœ€çš„é€»è¾‘å¯¹å…¶è¿›è¡Œå¤„ç†ã€‚åœ¨æ­¤é˜¶æ®µï¼Œæˆ‘ä»¬è¿˜å°†æ¶ˆæ¯æ·»åŠ åˆ°å†…éƒ¨å‡½æ•°çŠ¶æ€ï¼Œä»¥ä¾¿åœ¨æ‰€éœ€çš„æ•°æ®æ—¶é—´çª—å£ä¸Šæ‰§è¡Œè®¡ç®—ã€‚æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­è€ƒè™‘å¦‚ä½•å®ç°è¿™ä¸€ç‚¹ã€‚ æ€»ç»“åœ¨æœ¬æ–‡ï¼Œæˆ‘ä»¬ç»§ç»­ç ”ç©¶äº†ä½¿ç”¨ Apache Flink æ„å»ºçš„æ¬ºè¯ˆæ£€æµ‹ç³»ç»Ÿçš„ç”¨ä¾‹ã€‚æˆ‘ä»¬ç ”ç©¶äº†åœ¨å¹¶è¡Œè¿ç®—ç¬¦å®ä¾‹ä¹‹é—´åˆ†é…æ•°æ®çš„ä¸åŒæ–¹å¼ï¼Œæœ€é‡è¦çš„æ˜¯å¹¿æ’­çŠ¶æ€ã€‚æˆ‘ä»¬æ¼”ç¤ºäº†å¦‚ä½•é€šè¿‡å¹¿æ’­çŠ¶æ€æä¾›çš„åŠŸèƒ½æ¥ç»„åˆå’Œå¢å¼ºåŠ¨æ€åˆ†åŒºã€‚åœ¨è¿è¡Œæ—¶å‘é€åŠ¨æ€æ›´æ–°çš„åŠŸèƒ½æ˜¯ Apache Flink çš„å¼ºå¤§åŠŸèƒ½ï¼Œé€‚ç”¨äºå¤šç§å…¶ä»–ä½¿ç”¨åœºæ™¯ï¼Œä¾‹å¦‚æ§åˆ¶çŠ¶æ€ï¼ˆæ¸…é™¤/æ’å…¥/ä¿®å¤ï¼‰ï¼Œè¿è¡Œ A / B å®éªŒæˆ–æ‰§è¡Œ ML æ¨¡å‹ç³»æ•°çš„æ›´æ–°ã€‚ æœ¬ç¯‡æ–‡ç« å±äºç¿»è¯‘æ–‡ç« ï¼Œä½œè€…ï¼šzhisheng åŸæ–‡åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2021/01/23/Flink-Fraud-Detection-engine-2/ è‹±æ–‡ä½œè€…ï¼šalex_fedulov è‹±æ–‡åŸæ–‡åœ°å€ï¼šhttps://flink.apache.org/news/2020/03/24/demo-fraud-detection-2.html å…³æ³¨æˆ‘å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ ä¸“æ ä»‹ç»é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f Github ä»£ç ä»“åº“https://github.com/zhisheng17/flink-learning/ ä»¥åè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç éƒ½å°†æ”¾åœ¨è¿™ä¸ªä»“åº“é‡Œï¼ŒåŒ…å«äº†è‡ªå·±å­¦ä¹  flink çš„ä¸€äº› demo å’Œåšå®¢ åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€åŸç†ã€å®æˆ˜ã€æ€§èƒ½è°ƒä¼˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"å®æ—¶è®¡ç®—","slug":"å®æ—¶è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/å®æ—¶è®¡ç®—/"}]},{"title":"åŸºäº Flink çš„åŠ¨æ€æ¬ºè¯ˆæ£€æµ‹ç³»ç»Ÿ(ä¸Š)","date":"2021-01-21T16:00:00.000Z","path":"2021/01/22/Flink-Fraud-Detection-engine/","text":"å¦‚ä½•å®ç°å‘¢ï¼Ÿ å‰è¨€åœ¨æœ¬ç³»åˆ—åšå®¢ä¸­ï¼Œä½ å°†å­¦ä¹ åˆ°ä¸‰ç§æ„å»º Flink åº”ç”¨ç¨‹åºçš„å¼ºå¤§æ¡ˆä¾‹ï¼š åŠ¨æ€æ›´æ–°åº”ç”¨ç¨‹åºçš„é€»è¾‘ åŠ¨æ€çš„æ•°æ®åˆ†åŒºï¼ˆshuffleï¼‰ï¼Œåœ¨ä½œä¸šè¿è¡Œæ—¶è¿›è¡Œæ§åˆ¶ åŸºäºè‡ªå®šä¹‰çª—å£é€»è¾‘çš„ä½å»¶è¿Ÿå‘Šè­¦ï¼ˆä¸ä½¿ç”¨ Window APIï¼‰ è¿™å‡ ä¸ªæ¡ˆä¾‹æ‰©å±•äº†ä½¿ç”¨é™æ€å®šä¹‰çš„æ•°æ®æµå¯ä»¥å®ç°çš„åŠŸèƒ½ï¼Œå¹¶æä¾›äº†æ»¡è¶³å¤æ‚ä¸šåŠ¡éœ€æ±‚çš„åŸºç¡€ã€‚ åŠ¨æ€æ›´æ–°åº”ç”¨ç¨‹åºçš„é€»è¾‘ å…è®¸ä½œä¸šåœ¨è¿è¡Œæ—¶è¿›è¡Œæ›´æ”¹ï¼Œä¸éœ€è¦å°†ä½œä¸šåœæ­¢åä¿®æ”¹ä»£ç å†å‘å¸ƒã€‚ åŠ¨æ€çš„æ•°æ®åˆ†åŒº ä¸ºè¿è¡Œä¸­çš„ Flink ä½œä¸šä½œä¸šæä¾›äº†åŠ¨æ€åœ°å°†æ•°æ®åˆ†ç»„ï¼ˆgroup byï¼‰çš„åŠŸèƒ½ã€‚å¯¹äºæƒ³è¦æ„å»ºä¸€ä¸ªå¯ä»¥åŠ¨æ€é…ç½®åº”ç”¨é€»è¾‘çš„ Flink ç¨‹åºï¼Œç±»ä¼¼åŠŸèƒ½å¾ˆå¸¸è§ã€‚ è‡ªå®šä¹‰çª—å£ç®¡ç† æ¼”ç¤ºäº†å¦‚ä½•åœ¨åŸç”Ÿçš„ Window API ä¸èƒ½å®Œå…¨æ»¡è¶³ä½ çš„éœ€æ±‚ä¸‹ï¼Œå»é€šè¿‡æœ€åº•å±‚çš„ Process Function API æ¥å®Œæˆä½ çš„éœ€æ±‚ã€‚ä½ å°†å­¦ä¼šå¦‚ä½•è‡ªå®šä¹‰ Window é€»è¾‘æ¥å®ç°ä½å»¶è¿Ÿå‘Šè­¦ä»¥åŠå¦‚ä½•åˆ©ç”¨å®šæ—¶å™¨ï¼ˆTimerï¼‰æ¥é™åˆ¶çŠ¶æ€çš„æ— é™å¢é•¿ã€‚ è¿™å‡ ä¸ªæ¡ˆä¾‹éƒ½æ˜¯å»ºç«‹åœ¨ Flink æ ¸å¿ƒåŠŸèƒ½çš„åŸºç¡€ä¸Šï¼Œä½†æ˜¯é€šè¿‡å®˜æ–¹æ–‡æ¡£ä½ å¯èƒ½æ— æ³•ç«‹å³æ˜ç™½ï¼Œå› ä¸ºå¦‚æœæ²¡æœ‰å…·ä½“çš„ç”¨ä¾‹ï¼Œè§£é‡Šå’Œå‘ˆç°å®ƒä»¬èƒŒåçš„åŸç†å…¶å®å¹¶ä¸æ˜¯é‚£ä¹ˆç®€å•ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å°†é€šè¿‡ä¸€äº›å®é™…çš„æ¡ˆä¾‹æ¥å±•ç¤ºï¼Œæœ¬æ¡ˆä¾‹ä¸º Apache Flink çš„ä¸€ä¸ªçœŸå®ä½¿ç”¨åœºæ™¯ â€”â€” æ¬ºè¯ˆæ£€æµ‹å¼•æ“ã€‚æˆ‘å¸Œæœ›ä½ èƒ½ä»æœ¬ç³»åˆ—æ–‡ç« ä¸­æ”¶è·åˆ°è¿™äº›å¼ºå¤§çš„åŠŸèƒ½å’Œæ–¹æ³•ï¼Œç„¶åèƒ½åº”ç”¨åœ¨ä½ ä»¬å®é™…çš„åº”ç”¨åœºæ™¯ä¸­å»ã€‚ åœ¨è¯¥ç³»åˆ—çš„ç¬¬ä¸€ç¯‡åšå®¢ä¸­ï¼Œæˆ‘ä»¬å°†å…ˆæ¥çœ‹çœ‹è¿™ä¸ªåº”ç”¨ç¨‹åºçš„æ¶æ„ã€ç»„ä»¶å’Œäº¤äº’ã€‚ç„¶åæˆ‘ä»¬å°†æ·±å…¥ç ”ç©¶ç¬¬ä¸€ä¸ªæ¡ˆä¾‹çš„çš„å®ç°ç»†èŠ‚ â€”â€” åŠ¨æ€æ•°æ®åˆ†åŒºã€‚ ä½ å°†èƒ½å¤Ÿåœ¨æœ¬åœ°è¿è¡Œå®Œæ•´çš„æ¬ºè¯ˆæ£€æµ‹æ¼”ç¤ºåº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ Github ä»“åº“æŸ¥çœ‹å…¶å®Œæ•´å®ç°ä»£ç ã€‚ æ¬ºè¯ˆæ£€æµ‹ç³»ç»Ÿæ¼”ç¤ºæœ¬æ¬¡æ©é¥°çš„æ¬ºè¯ˆæ£€æµ‹å¼•æ“çš„ä»£ç æ˜¯å¼€æºçš„ï¼Œå¯ä»¥åœ¨çº¿è·å–ï¼Œè¦æ˜¯æƒ³åœ¨æœ¬åœ°è¿è¡Œå®ƒï¼Œè¯·æŒ‰ç…§ https://github.com/afedulov/fraud-detection-demo ä¸­çš„ README æè¿°çš„æ­¥éª¤è‡ªè¡Œè¿›è¡Œæ“ä½œã€‚ ä½ å°†çœ‹åˆ°è¯¥æ¡ˆä¾‹çš„ä»£ç å’Œç»„ä»¶éƒ½å¾ˆå…¨ï¼Œä»…éœ€è¦é€šè¿‡ docker å’Œ docker-compose æ„å»ºæºç ã€‚ä»“åº“é‡Œé¢åŒ…å«äº†ä¸‹é¢ç»„ä»¶ï¼š å«æœ‰ Zookeeper çš„ Apache Kafka Apache Flinkï¼ˆåº”ç”¨ç¨‹åºï¼‰ æ¬ºè¯ˆæ£€æµ‹å¼•æ“çš„ Web åº”ç”¨ æ¬ºè¯ˆæ£€æµ‹å¼•æ“çš„ç›®æ ‡æ˜¯æ¶ˆè´¹é‡‘èäº¤æ˜“çš„å®æ—¶æ•°æ®æµï¼Œç„¶åæ ¹æ®ä¸€ç»„æ£€æµ‹è§„åˆ™å¯¹å…¶è¿›è¡Œè¯„ä¼°ã€‚è¿™äº›è§„åˆ™ä¼šç»å¸¸æ›´æ”¹å’Œè°ƒæ•´ï¼Œåœ¨å®é™…çš„ç”Ÿäº§ç³»ç»Ÿä¸­ï¼Œé‡è¦çš„æ˜¯è¦èƒ½åœ¨ä½œä¸šè¿è¡Œçš„æ—¶å€™å»æ·»åŠ å’Œåˆ é™¤è§„åˆ™ï¼Œè€Œä¸ä¼šå› åœæ­¢å’Œé‡æ–°å¯åŠ¨ä½œä¸šä»è€Œé€ æˆé«˜æ˜‚çš„ä»£ä»·ã€‚ å½“ä½ åœ¨æœ¬åœ°è¿è¡ŒæˆåŠŸåï¼Œä½ åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ URL å¯ä»¥çœ‹åˆ°å¦‚ä¸‹æ•ˆæœï¼š ç‚¹å‡» â€œStartâ€ æŒ‰é’®åï¼Œä½ å¯ä»¥åœ¨å·¦ä¾§çœ‹åˆ°ç³»ç»Ÿä¸­æµåŠ¨çš„é‡‘èäº¤æ˜“å¤§ç›˜ï¼Œä½ å¯ä»¥é€šè¿‡é¡¶éƒ¨çš„æ»‘å—å»æ§åˆ¶æ¯ç§’ç”Ÿæˆçš„æ•°æ®ï¼Œä¸­é—´éƒ¨åˆ†ç”¨äºç®¡ç† Flink ç”¨äºè®¡ç®—çš„è§„åˆ™ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œåˆ›å»ºæ–°è§„åˆ™ä»¥åŠå‘å‡ºæ§åˆ¶å‘½ä»¤ï¼Œä¾‹å¦‚æ¸…é™¤ Flink çš„çŠ¶æ€ã€‚ ç°æˆçš„æ¼”ç¤ºå¸¦æœ‰ä¸€ç»„é¢„å®šä¹‰çš„ç¤ºä¾‹è§„åˆ™ï¼Œä½ å¯ä»¥ç‚¹å‡» Start æŒ‰é’®ï¼Œä¸€æ®µæ—¶é—´ä¹‹åï¼Œå°†è§‚å¯Ÿåˆ° UI å³ä¾§éƒ¨åˆ†ä¸­æ˜¾ç¤ºçš„å‘Šè­¦ï¼Œè¿™äº›å‘Šè­¦æ¶ˆæ¯æ˜¯ Flink æ ¹æ®é¢„å®šä¹‰çš„è§„åˆ™è¯„ä¼°ç”Ÿæˆçš„äº¤æ˜“æµçš„ç»“æœã€‚ æˆ‘ä»¬çš„æ ·æœ¬æ¬ºè¯ˆæ£€æµ‹ç³»ç»ŸåŒ…å«ä¸‰ä¸ªä¸»è¦çš„ç»„ä»¶ï¼š å‰ç«¯ï¼ˆReactï¼‰ åç«¯ï¼ˆSpringBootï¼‰ æ¬ºè¯ˆæ£€æµ‹ Flink åº”ç”¨ç¨‹åº ä¸‰è€…ä¹‹é—´çš„ç»„æˆå…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š åç«¯å°† REST API æš´éœ²ç»™å‰ç«¯ï¼Œç”¨äºåˆ›å»º/åˆ é™¤è§„åˆ™ä»¥åŠå‘å‡ºç”¨äºç®¡ç†æ¼”ç¤ºæ‰§è¡Œçš„æ§åˆ¶å‘½ä»¤ï¼Œç„¶åï¼Œå®ƒä¼šå°†è¿™äº›å‰ç«¯æ“ä½œè¡Œä¸ºæ•°æ®å‘é€åˆ° Kafka Topic Control ä¸­ã€‚åç«¯è¿˜åŒ…å«äº†ä¸€ä¸ªäº¤æ˜“æ•°æ®ç”Ÿæˆå™¨ç»„ä»¶ï¼Œè¯¥ç»„ä»¶ç”¨æ¥æ¨¡æ‹Ÿäº¤æ˜“æ•°æ®çš„ï¼Œç„¶åä¼šå°†è¿™äº›äº¤æ˜“æ•°æ®å‘é€åˆ° Kafka Topic Transactions ä¸­ï¼Œè¿™äº›æ•°æ®æœ€åéƒ½ä¼šè¢« Flink åº”ç”¨ç¨‹åºå»æ¶ˆè´¹ï¼ŒFlink ç¨‹åºç»è¿‡è§„åˆ™è®¡ç®—è¿™äº›äº¤æ˜“æ•°æ®åç”Ÿæˆçš„å‘Šè­¦æ•°æ®ä¼šå‘é€åˆ° Kafka Topic Alerts ä¸­ï¼Œå¹¶é€šè¿‡ Web Sockets å°†æ•°æ®ä¼ åˆ°å‰ç«¯ UIã€‚ ç°åœ¨ä½ å·²ç»ç†Ÿæ‚‰äº†è¯¥æ¬ºè¯ˆæ£€æµ‹å¼•æ“çš„æ€»ä½“ç»“æ„å’Œå¸ƒå±€äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¯¦ç»†ä»‹ç»è¿™ä¸ªç³»ç»Ÿé‡Œé¢åŒ…å«çš„å†…å®¹ã€‚ æ•°æ®åŠ¨æ€åˆ†åŒºå¦‚æœè¿‡å»ä½ æ›¾ç»ä½¿ç”¨è¿‡ Flink DataStream APIï¼Œé‚£ä¹ˆä½ è‚¯å®šå¾ˆç†Ÿæ‚‰ keyBy æ–¹æ³•ã€‚å¯¹æ•°æ®æµä¸­çš„æ‰€æœ‰æ•°æ®æŒ‰é”®è¿›è¡Œ shuffleï¼Œè¿™æ ·å…·æœ‰ç›¸åŒ key çš„å…ƒç´ å°±ä¼šè¢«åˆ†é…åˆ°ç›¸åŒçš„åˆ†åŒºã€‚ ä¸€èˆ¬åœ¨ç¨‹åºä¸­ï¼Œæ•°æ®åˆ†åŒºçš„ keyBy å­—æ®µæ˜¯å›ºå®šçš„ï¼Œç”±æ•°æ®å†…çš„æŸäº›é™æ€å­—æ®µç¡®å®šï¼Œä¾‹å¦‚ï¼Œå½“æ„å»ºä¸€ä¸ªç®€å•çš„åŸºäºçª—å£çš„äº¤æ˜“æµèšåˆæ—¶ï¼Œæˆ‘ä»¬å¯èƒ½æ€»æ˜¯æŒ‰ç…§äº¤æ˜“è´¦æˆ· ID è¿›è¡Œåˆ†ç»„ã€‚ 1234DataStream&lt;Transaction&gt; input = // [...]DataStream&lt;...&gt; windowed = input .keyBy(Transaction::getAccountId) .window(/*window specification*/); è¿™ç§æ–¹æ³•æ˜¯åœ¨å¹¿æ³›çš„ç”¨ä¾‹ä¸­å®ç°æ°´å¹³å¯ä¼¸ç¼©æ€§çš„ä¸»è¦æ¨¡å—ï¼Œä½†æ˜¯åœ¨åº”ç”¨ç¨‹åºè¯•å›¾åœ¨è¿è¡Œæ—¶æä¾›ä¸šåŠ¡é€»è¾‘çµæ´»æ€§çš„æƒ…å†µä¸‹ï¼Œè¿™è¿˜æ˜¯ä¸å¤Ÿçš„ã€‚ä¸ºäº†ç†è§£ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿè¿™ç§æƒ…å†µï¼Œè®©æˆ‘ä»¬é¦–å…ˆä»¥åŠŸèƒ½éœ€æ±‚çš„å½¢å¼ä¸ºæ¬ºè¯ˆæ£€æµ‹ç³»ç»Ÿé˜æ˜ä¸€ä¸ªç°å®çš„æ ·æœ¬è§„åˆ™å®šä¹‰ï¼š åœ¨ä¸€ä¸ªæ˜ŸæœŸ ä¹‹å†…ï¼Œå½“ ç”¨æˆ· A ç´¯è®¡ å‘ B ç”¨æˆ·æ”¯ä»˜çš„é‡‘é¢è¶…è¿‡ 1000000 ç¾å…ƒï¼Œåˆ™è§¦å‘ä¸€æ¡å‘Šè­¦ PSï¼šA å’Œ B ç”¨å­—æ®µæè¿°çš„è¯åˆ†åˆ«æ˜¯ ä»˜æ¬¾äººï¼ˆpayerï¼‰å’Œå—ç›Šäººï¼ˆbeneficiaryï¼‰ åœ¨ä¸Šé¢çš„è§„åˆ™ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°è®¸å¤šå‚æ•°ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿåœ¨æ–°æäº¤çš„è§„åˆ™ä¸­æŒ‡å®šè¿™äº›å‚æ•°ï¼Œç”šè‡³å¯èƒ½åœ¨è¿è¡Œæ—¶è¿›è¡ŒåŠ¨æ€çš„ä¿®æ”¹æˆ–è°ƒæ•´ï¼š èšåˆçš„å­—æ®µï¼ˆä»˜æ¬¾é‡‘é¢ï¼‰ åˆ†ç»„å­—æ®µï¼ˆä»˜æ¬¾äººå’Œå—ç›Šäººï¼‰ èšåˆå‡½æ•°ï¼ˆæ±‚å’Œï¼‰ çª—å£å¤§å°ï¼ˆ1 æ˜ŸæœŸï¼‰ é˜ˆå€¼ï¼ˆ1000000ï¼‰ è®¡ç®—ç¬¦å·ï¼ˆå¤§äºï¼‰ å› æ­¤ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä»¥ä¸‹ç®€å•çš„ JSON æ ¼å¼æ¥å®šä¹‰ä¸Šè¿°å‚æ•°ï¼š 12345678910&#123; \"ruleId\": 1, \"ruleState\": \"ACTIVE\", \"groupingKeyNames\": [\"payerId\", \"beneficiaryId\"], \"aggregateFieldName\": \"paymentAmount\", \"aggregatorFunctionType\": \"SUM\", \"limitOperatorType\": \"GREATER\", \"limit\": 1000000, \"windowMinutes\": 10080&#125; åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œé‡è¦çš„æ˜¯äº†è§£ groupingKeyNames å†³å®šäº†æ•°æ®çš„å®é™…ç‰©ç†åˆ†åŒºï¼Œæ‰€æœ‰æŒ‡å®šå‚æ•°ï¼ˆpayerId + beneficiaryIdï¼‰ç›¸åŒçš„äº¤æ˜“æ•°æ®éƒ½ä¼šæ±‡æ€»åˆ°åŒä¸€ä¸ªç‰©ç†è®¡ç®— operator é‡Œé¢å»ã€‚å¾ˆæ˜æ˜¾ï¼Œå¦‚æœè¦å®ç°è¿™æ ·çš„åŠŸèƒ½ï¼Œåœ¨ Flink é‡Œé¢æ˜¯ä½¿ç”¨ keyBy å‡½æ•°æ¥å®Œæˆã€‚ Flink å®˜æ–¹æ–‡æ¡£ä¸­ keyBy() å‡½æ•°çš„å¤§å¤šæ•°ç¤ºä¾‹éƒ½æ˜¯ä½¿ç”¨ç¡¬ç¼–ç çš„ KeySelectorï¼Œå®ƒæå–ç‰¹å®šæ•°æ®çš„å­—æ®µã€‚ä½†æ˜¯ï¼Œä¸ºäº†æ”¯æŒæ‰€éœ€çš„çµæ´»æ€§ï¼Œæˆ‘ä»¬å¿…é¡»æ ¹æ®è§„åˆ™ä¸­çš„è§„èŒƒä»¥æ›´åŠ åŠ¨æ€çš„æ–¹å¼æå–å®ƒä»¬ï¼Œä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†ä¸å¾—ä¸ä½¿ç”¨ä¸€ä¸ªé¢å¤–çš„è¿ç®—ç¬¦ï¼Œè¯¥è¿ç®—ç¬¦ä¼šå°†æ¯æ¡æ•°æ®åˆ†é…åˆ°æ­£ç¡®çš„èšåˆå®ä¾‹ä¸­ã€‚ æ€»ä½“è€Œè¨€ï¼Œæˆ‘ä»¬çš„ä¸»è¦å¤„ç†æµç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š 12345DataStream&lt;Alert&gt; alerts = transactions .process(new DynamicKeyFunction()) .keyBy(/* some key selector */); .process(/* actual calculations and alerting */) å…ˆå‰æˆ‘ä»¬å·²ç»å»ºç«‹äº†æ¯ä¸ªè§„åˆ™å®šä¹‰ä¸€ä¸ªgroupingKeyNameså‚æ•°ï¼Œè¯¥å‚æ•°æŒ‡å®šå°†å“ªäº›å­—æ®µç»„åˆç”¨äºä¼ å…¥äº‹ä»¶çš„åˆ†ç»„ã€‚æ¯ä¸ªè§„åˆ™å¯ä»¥ä½¿ç”¨è¿™äº›å­—æ®µçš„ä»»æ„ç»„åˆã€‚åŒæ—¶ï¼Œæ¯ä¸ªä¼ å…¥äº‹ä»¶éƒ½å¯èƒ½éœ€è¦æ ¹æ®å¤šä¸ªè§„åˆ™è¿›è¡Œè¯„ä¼°ã€‚è¿™æ„å‘³ç€äº‹ä»¶å¯èƒ½éœ€è¦åŒæ—¶å‡ºç°åœ¨è®¡ç®— operator çš„å¤šä¸ªå¹¶è¡Œå®ä¾‹ä¸­ï¼Œè¿™äº›å®ä¾‹å¯¹åº”äºä¸åŒçš„è§„åˆ™ï¼Œå› æ­¤éœ€è¦è¿›è¡Œåˆ†å‰ã€‚ç¡®ä¿æ­¤ç±»äº‹ä»¶çš„è°ƒåº¦èƒ½è¾¾åˆ° DynamicKeyFunction() çš„ç›®çš„ã€‚ DynamicKeyFunctionè¿­ä»£ä¸€ç»„å·²å®šä¹‰çš„è§„åˆ™ï¼Œå¹¶é€šè¿‡ keyBy()å‡½æ•°æå–æ‰€æœ‰æ•°æ®æ‰€éœ€çš„åˆ†ç»„ key ï¼š 1234567891011121314151617181920212223public class DynamicKeyFunction extends ProcessFunction&lt;Transaction, Keyed&lt;Transaction, String, Integer&gt;&gt; &#123; ... /* Simplified */ List&lt;Rule&gt; rules = /* Rules that are initialized somehow. Details will be discussed in a future blog post. */; @Override public void processElement( Transaction event, Context ctx, Collector&lt;Keyed&lt;Transaction, String, Integer&gt;&gt; out) &#123; for (Rule rule :rules) &#123; out.collect( new Keyed&lt;&gt;( event, KeysExtractor.getKey(rule.getGroupingKeyNames(), event), rule.getRuleId())); &#125; &#125; ...&#125; KeysExtractor.getKey()ä½¿ç”¨åå°„ä»æ•°æ®ä¸­æå–groupingKeyNamesé‡Œé¢æ‰€æœ‰æ‰€éœ€å­—æ®µçš„å€¼ï¼Œå¹¶å°†å®ƒä»¬æ‹¼æ¥ä¸ºå­—ç¬¦ä¸²ï¼Œä¾‹å¦‚&quot;{payerId=25;beneficiaryId=12}&quot;ã€‚Flink å°†è®¡ç®—è¯¥å­—ç¬¦ä¸²çš„å“ˆå¸Œå€¼ï¼Œå¹¶å°†æ­¤ç‰¹å®šç»„åˆçš„æ•°æ®å¤„ç†åˆ†é…ç»™é›†ç¾¤ä¸­çš„ç‰¹å®šæœåŠ¡å™¨ã€‚è¿™æ ·å°±ä¼šè·Ÿè¸ªä»˜æ¬¾äºº25å’Œå—ç›Šäºº12ä¹‹é—´çš„æ‰€æœ‰äº¤æ˜“ï¼Œå¹¶åœ¨æ‰€éœ€çš„æ—¶é—´èŒƒå›´å†…è¯„ä¼°å®šä¹‰çš„è§„åˆ™ã€‚ æ³¨æ„ï¼ŒKeyedå¼•å…¥äº†å…·æœ‰ä»¥ä¸‹ç­¾åçš„åŒ…è£…å™¨ç±»ä½œä¸ºè¾“å‡ºç±»å‹DynamicKeyFunctionï¼š 12345678910public class Keyed&lt;IN, KEY, ID&gt; &#123; private IN wrapped; private KEY key; private ID id; ... public KEY getKey()&#123; return key; &#125;&#125; æ­¤ POJO çš„å­—æ®µæºå¸¦äº†ä»¥ä¸‹ä¿¡æ¯ï¼šwrappedæ˜¯åŸå§‹æ•°æ®ï¼Œkeyæ˜¯ä½¿ç”¨ KeysExtractoræå–å‡ºæ¥çš„ç»“æœï¼Œidæ˜¯å¯¼è‡´äº‹ä»¶çš„è°ƒåº¦è§„åˆ™çš„ IDï¼ˆæ ¹æ®è§„åˆ™ç‰¹å®šçš„åˆ†ç»„é€»è¾‘ï¼‰ã€‚ è¿™ç§ç±»å‹çš„äº‹ä»¶å°†ä½œä¸ºkeyBy()å‡½æ•°çš„è¾“å…¥ï¼Œå¹¶å…è®¸ä½¿ç”¨ç®€å•çš„ lambda è¡¨è¾¾å¼ä½œä¸ºKeySelectorå®ç°åŠ¨æ€æ•°æ® shuffle çš„æœ€åä¸€æ­¥ã€‚ 12345DataStream&lt;Alert&gt; alerts = transactions .process(new DynamicKeyFunction()) .keyBy((keyed) -&gt; keyed.getKey()); .process(new DynamicAlertFunction()) é€šè¿‡åº”ç”¨ï¼ŒDynamicKeyFunctionæˆ‘ä»¬éšå¼å¤åˆ¶äº†äº‹ä»¶ï¼Œä»¥ä¾¿åœ¨ Flink é›†ç¾¤ä¸­å¹¶è¡Œçš„æ‰§è¡Œæ¯ä¸ªè§„åˆ™è¯„ä¼°ã€‚é€šè¿‡è¿™æ ·åšï¼Œæˆ‘ä»¬è·å¾—äº†ä¸€ä¸ªé‡è¦çš„åŠŸèƒ½â€”â€”è§„åˆ™å¤„ç†çš„æ°´å¹³å¯ä¼¸ç¼©æ€§ã€‚é€šè¿‡å‘é›†ç¾¤æ·»åŠ æ›´å¤šæœåŠ¡å™¨ï¼Œå³å¢åŠ å¹¶è¡Œåº¦ï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿå°†èƒ½å¤Ÿå¤„ç†æ›´å¤šè§„åˆ™ã€‚å®ç°æ­¤åŠŸèƒ½çš„ä»£ä»·æ˜¯æ•°æ®é‡å¤ï¼Œè¿™å¯èƒ½ä¼šæˆä¸ºä¸€ä¸ªé—®é¢˜ï¼Œå…·ä½“å–å†³äºä¸€ç»„ç‰¹å®šçš„å‚æ•°ï¼Œä¾‹å¦‚ä¼ å…¥æ•°æ®é€Ÿç‡ï¼Œå¯ç”¨ç½‘ç»œå¸¦å®½ï¼Œäº‹ä»¶æœ‰æ•ˆè´Ÿè½½å¤§å°ç­‰ã€‚åœ¨å®é™…æƒ…å†µä¸‹ï¼Œå¯ä»¥è¿›è¡Œå…¶ä»–ä¼˜åŒ–åº”ç”¨ï¼Œä¾‹å¦‚ç»„åˆè®¡ç®—å…·æœ‰ç›¸åŒgroupingKeyNames çš„è§„åˆ™ï¼Œæˆ–ä½¿ç”¨è¿‡æ»¤å±‚ï¼Œå°†äº‹ä»¶ä¸­ä¸éœ€è¦å¤„ç†ç‰¹å®šè§„åˆ™çš„æ‰€æœ‰å­—æ®µåˆ é™¤ã€‚ æ€»ç»“åœ¨æ­¤åšå®¢æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡æŸ¥çœ‹ç¤ºä¾‹ç”¨ä¾‹ï¼ˆæ¬ºè¯ˆæ£€æµ‹å¼•æ“ï¼‰è®¨è®ºäº†å¦‚ä½•å¯¹ Flink åº”ç”¨ç¨‹åºè¿›è¡ŒåŠ¨æ€ï¼Œè¿è¡Œæ—¶æ›´æ”¹ã€‚æˆ‘ä»¬å·²ç»æè¿°äº†æ€»ä½“é¡¹ç›®ç»“æ„åŠå…¶ç»„ä»¶ä¹‹é—´çš„äº¤äº’ï¼Œå¹¶æä¾›äº†ä½¿ç”¨ docker è¿›è¡Œæ„å»ºå’Œè¿è¡Œæ¼”ç¤ºæ¬ºè¯ˆæ£€æµ‹åº”ç”¨ç¨‹åºã€‚ç„¶åï¼Œæˆ‘ä»¬å±•ç¤ºäº†å°† æ•°æ®åŠ¨æ€åˆ†åŒº ï¼Œè¿™æ˜¯ç¬¬ä¸€ä¸ªå®ç°çµæ´»çš„åŠ¨æ€é…ç½®çš„ä»£ç æ¡ˆä¾‹ã€‚ ä¸ºäº†ä¸“æ³¨äºæè¿°æœ¬æ¡ˆä¾‹çš„æ ¸å¿ƒæœºåˆ¶ï¼Œæˆ‘ä»¬å°† DSL å’ŒåŸºæœ¬è§„åˆ™å¼•æ“çš„å¤æ‚æ€§é™è‡³æœ€ä½ã€‚åœ¨æœªæ¥ï¼Œä¸éš¾æƒ³è±¡ä¼šæ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä¾‹å¦‚å…è®¸ä½¿ç”¨æ›´å¤æ‚çš„è§„åˆ™å®šä¹‰ï¼ŒåŒ…æ‹¬æŸäº›äº‹ä»¶çš„è¿‡æ»¤ï¼Œé€»è¾‘è§„åˆ™é“¾æ¥ä»¥åŠå…¶ä»–æ›´é«˜çº§çš„åŠŸèƒ½ã€‚ åœ¨æœ¬ç³»åˆ—çš„ç¬¬äºŒç¯‡åšå®¢ä¸­ï¼Œæˆ‘ä»¬å°†æè¿°è§„åˆ™å¦‚ä½•è¿›å…¥æ­£åœ¨è¿è¡Œçš„æ¬ºè¯ˆæ£€æµ‹å¼•æ“ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å°†è¯¦ç»†ä»‹ç»å¼•æ“çš„ä¸»è¦å¤„ç†åŠŸèƒ½ DynamicAlertFunction() çš„å®ç°ç»†èŠ‚ã€‚ åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä¼šæ•™å¤§å®¶å¦‚ä½•åˆ©ç”¨ Apache Flink çš„å¹¿æ’­æµåœ¨æˆ‘ä»¬çš„æ¬ºè¯ˆæ£€æµ‹ç³»ç»Ÿä¸­åŠ¨æ€çš„å¤„ç†è§„åˆ™ã€‚ æœ¬ç¯‡æ–‡ç« å±äºç¿»è¯‘æ–‡ç« ï¼Œä½œè€…ï¼šzhisheng åŸæ–‡åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2021/01/22/Flink-Fraud-Detection-engine/ è‹±æ–‡ä½œè€…ï¼šalex_fedulov è‹±æ–‡åŸæ–‡åœ°å€ï¼šhttps://flink.apache.org/news/2020/01/15/demo-fraud-detection.html å…³æ³¨æˆ‘å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ ä¸“æ ä»‹ç»é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f Github ä»£ç ä»“åº“https://github.com/zhisheng17/flink-learning/ ä»¥åè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç éƒ½å°†æ”¾åœ¨è¿™ä¸ªä»“åº“é‡Œï¼ŒåŒ…å«äº†è‡ªå·±å­¦ä¹  flink çš„ä¸€äº› demo å’Œåšå®¢ åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€åŸç†ã€å®æˆ˜ã€æ€§èƒ½è°ƒä¼˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"å®æ—¶è®¡ç®—","slug":"å®æ—¶è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/å®æ—¶è®¡ç®—/"}]},{"title":"Flink Forward Asia 2020 å…¨éƒ¨ PPT å¼€æ”¾ä¸‹è½½","date":"2020-12-20T16:00:00.000Z","path":"2020/12/21/flink-forward-Asia-2020/","text":"Flink Forward Asia 2020 åœ¨åŒ—äº¬å¬å¼€çš„ï¼Œæœ‰ä¸»ä¼šåœºå’Œå‡ ä¸ªåˆ†ä¼šåœºï¼ˆä¼ä¸šå®è·µã€Apache Flink æ ¸å¿ƒæŠ€æœ¯ã€å¼€æºå¤§æ•°æ®ç”Ÿæ€ã€å®æ—¶æ•°ä»“ã€äººå·¥æ™ºèƒ½ï¼‰ï¼Œå†…å®¹æ¶‰åŠå¾ˆå¤šï¼Œå¯ä»¥æŸ¥çœ‹ä¸‹é¢å›¾ç‰‡ä»‹ç»ã€‚ å¦‚ä½•è·å–ä¸Šé¢è¿™äº› PPTï¼Ÿä¸Šé¢çš„è¿™äº› PPT æœ¬äººå·²ç»æ•´ç†å¥½äº†ï¼Œä½ å¯ä»¥æ‰«æä¸‹é¢äºŒç»´ç ï¼Œå…³æ³¨å¾®ä¿¡å…¬ä¼—å·ï¼šzhishengï¼Œç„¶ååœ¨é‡Œé¢å›å¤å…³é”®å­—: ffa2020 å³å¯è·å–å·²æ”¾å‡ºçš„ PPTã€‚","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"å®æ—¶è®¡ç®—","slug":"å®æ—¶è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/å®æ—¶è®¡ç®—/"}]},{"title":"Flink 1.12 Release æ–‡æ¡£è§£è¯»","date":"2020-12-05T16:00:00.000Z","path":"2020/12/06/Flink-1.12/","text":"Flink 1.12 å¿«è¦å‘å¸ƒäº†ï¼Œè¿™é‡Œæå‰è§£è¯»ä¸€ä¸‹ Release æ–‡æ¡£ æœ¬æ–‡çš„ Release æ–‡æ¡£æè¿°äº†åœ¨ Flink 1.11 å’Œ Flink 1.12 ä¹‹é—´æ›´æ”¹çš„é‡è¦æ–¹é¢ï¼Œä¾‹å¦‚é…ç½®ï¼Œè¡Œä¸ºæˆ–ä¾èµ–é¡¹ã€‚ å¦‚æœæ‚¨æ‰“ç®—å°† Flink ç‰ˆæœ¬å‡çº§åˆ° 1.12ï¼Œè¯·ä»”ç»†é˜…è¯»è¿™äº›è¯´æ˜ã€‚ APIç§»é™¤æ‰ ExecutionConfig ä¸­è¿‡æœŸçš„æ–¹æ³• ç§»é™¤æ‰äº† ExecutionConfig#isLatencyTrackingEnabled æ–¹æ³•, ä½ å¯ä»¥ä½¿ç”¨ ExecutionConfig#getLatencyTrackingInterval æ–¹æ³•ä»£æ›¿. ç§»é™¤æ‰äº† ExecutionConfig#enable/disableSysoutLoggingã€ExecutionConfig#set/isFailTaskOnCheckpointError è¿‡æœŸçš„æ–¹æ³•ã€‚ ç§»é™¤æ‰äº† -q CLI å‚æ•°ã€‚ ç§»é™¤æ‰è¿‡æœŸçš„ RuntimeContext#getAllAccumulators æ–¹æ³• è¿‡æœŸçš„ RuntimeContext#getAllAccumulators æ–¹æ³•è¢«ç§»é™¤æ‰äº†ï¼Œè¯·ä½¿ç”¨ RuntimeContext#getAccumulator æ–¹æ³•ä½œä¸ºä»£æ›¿ã€‚ ç”±äºæ•°æ®ä¸¢å¤±çš„é£é™©æŠŠ CheckpointConfig#setPreferCheckpointForRecovery æ–¹æ³•æ ‡ä¸ºè¿‡æœŸ CheckpointConfig#setPreferCheckpointForRecovery æ–¹æ³•æ ‡è®°ä¸ºè¿‡æœŸäº†, å› ä¸ºä½œä¸šåœ¨è¿›è¡Œæ¢å¤æ—¶ï¼Œå¦‚æœä½¿ç”¨è¾ƒæ—§çš„ Checkpoint çŠ¶æ€è€Œä¸ä½¿ç”¨æ–°çš„ Save point çŠ¶æ€æ•°æ®ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚ FLIP-134: DataStream API çš„æ‰¹å¤„ç†æ‰§è¡Œ å…è®¸åœ¨ KeyedStream.intervalJoin() çš„é…ç½®æ—¶é—´å±æ€§ï¼Œåœ¨ Flink 1.12 ä¹‹å‰ KeyedStream.intervalJoin() ç®—å­çš„æ—¶é—´å±æ€§ä¾èµ–äºå…¨å±€è®¾ç½®çš„æ—¶é—´å±æ€§ã€‚åœ¨ Flink 1.12 ä¸­æˆ‘ä»¬å¯ä»¥åœ¨ IntervalJoin æ–¹æ³•ååŠ ä¸Š inProcessingTime() æˆ– inEventTime() ï¼Œè¿™æ · Join å°±ä¸å†ä¾èµ–äºå…¨å±€çš„æ—¶é—´å±æ€§ã€‚ åœ¨ Flink 1.12 ä¸­å°† DataStream API çš„ timeWindow() æ–¹æ³•æ ‡è®°ä¸ºè¿‡æœŸï¼Œè¯·ä½¿ç”¨ window(WindowAssigner)ã€TumblingEventTimeWindowsã€ SlidingEventTimeWindowsã€TumblingProcessingTimeWindows æˆ–è€… SlidingProcessingTimeWindowsã€‚ å°† StreamExecutionEnvironment.setStreamTimeCharacteristic() å’Œ TimeCharacteristic æ–¹æ³•æ ‡è®°ä¸ºè¿‡æœŸã€‚åœ¨ Flink 1.12 ä¸­ï¼Œé»˜è®¤çš„æ—¶é—´å±æ€§æ”¹å˜æˆ EventTime äº†ï¼Œäºæ˜¯ä½ ä¸å†éœ€è¦è¯¥æ–¹æ³•å»å¼€å¯ EventTime äº†ã€‚åœ¨ EventTime æ—¶é—´å±æ€§ä¸‹ï¼Œä½ ä½¿ç”¨ processing-time çš„ windows å’Œ timers ä¹Ÿéƒ½ä¾æ—§ä¼šç”Ÿæ•ˆã€‚å¦‚æœä½ æƒ³ç¦ç”¨æ°´å°ï¼Œè¯·ä½¿ç”¨ ExecutionConfig.setAutoWatermarkInterval(long) æ–¹æ³•ã€‚å¦‚æœä½ æƒ³ä½¿ç”¨ IngestionTimeï¼Œè¯·æ‰‹åŠ¨è®¾ç½®é€‚å½“çš„ WatermarkStrategyã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯åŸºäºæ—¶é—´å±æ€§æ›´æ”¹è¡Œä¸ºçš„é€šç”¨ â€˜time windowâ€™ ç®—å­(eg: KeyedStream.timeWindow())ï¼Œè¯·ä½¿ç”¨ç­‰æ•ˆæ“ä½œæ˜ç¡®çš„æŒ‡å®šå¤„ç†æ—¶é—´å’Œäº‹ä»¶æ—¶é—´ã€‚ å…è®¸åœ¨ CEP PatternStream ä¸Šæ˜¾å¼é…ç½®æ—¶é—´å±æ€§åœ¨ Flink 1.12 ä¹‹å‰ï¼ŒCEP ç®—å­é‡Œé¢çš„æ—¶é—´ä¾èµ–äºå…¨å±€é…ç½®çš„æ—¶é—´å±æ€§ï¼Œåœ¨ 1.12 ä¹‹åå¯ä»¥åœ¨ PatternStream ä¸Šä½¿ç”¨ inProcessingTime() æˆ– inEventTime() æ–¹æ³•ã€‚ API æ¸…ç† ç§»é™¤äº† UdfAnalyzer é…ç½®ï¼Œç§»é™¤äº† ExecutionConfig#get/setCodeAnalysisMode æ–¹æ³•å’Œ SkipCodeAnalysis ç±»ã€‚ ç§»é™¤äº†è¿‡æœŸçš„ DataStream#split æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä»å¾ˆæ—©çš„ç‰ˆæœ¬ä¸­å·²ç»æ ‡è®°æˆä¸ºè¿‡æœŸçš„äº†ï¼Œä½ å¯ä»¥ä½¿ç”¨ Side Output æ¥ä»£æ›¿ã€‚ ç§»é™¤äº†è¿‡æœŸçš„ DataStream#fold() æ–¹æ³•å’Œå…¶ç›¸å…³çš„ç±»ï¼Œä½ å¯ä»¥ä½¿ç”¨æ›´åŠ é«˜æ€§èƒ½çš„ DataStream#reduceã€‚ æ‰©å±• CompositeTypeSerializerSnapshot ä»¥å…è®¸å¤åˆåºåˆ—åŒ–å™¨æ ¹æ®å¤–éƒ¨é…ç½®è¿ç§» ä¸å†æ¨èä½¿ç”¨ CompositeTypeSerializerSnapshot ä¸­çš„ isOuterSnapshotCompatible(TypeSerializer) æ–¹æ³•ï¼Œæ¨èä½¿ç”¨ OuterSchemaCompatibility#resolveOuterSchemaCompatibility(TypeSerializer) æ–¹æ³•ã€‚ å°† Scala ç‰ˆæœ¬å‡çº§åˆ° 2.1.1 Flink ç°åœ¨ä¾èµ– Scala 2.1.1ï¼Œæ„å‘³ç€ä¸å†æ”¯æŒ Scala ç‰ˆæœ¬å°äº 2.11.11ã€‚ SQLå¯¹ aggregate å‡½æ•°çš„ SQL DDL ä½¿ç”¨æ–°ç±»å‹æ¨æ–­ aggregate å‡½æ•°çš„ CREATE FUNCTION DDL ç°åœ¨ä½¿ç”¨æ–°ç±»å‹æ¨æ–­ï¼Œå¯èƒ½æœ‰å¿…è¦å°†ç°æœ‰å®ç°æ›´æ–°ä¸ºæ–°çš„åå°„ç±»å‹æå–é€»è¾‘ï¼Œå°† StreamTableEnvironment.registerFunction æ ‡ä¸ºè¿‡æœŸã€‚ æ›´æ–°è§£æå™¨æ¨¡å— FLIP-107 ç°åœ¨ METADATA å±äºä¿ç•™å…³é”®å­—ï¼Œè®°å¾—ä½¿ç”¨åå¼•å·è½¬ä¹‰ã€‚ å°†å†…éƒ¨ aggregate å‡½æ•°æ›´æ–°ä¸ºæ–°ç±»å‹ ä½¿ç”¨ COLLECT å‡½æ•°çš„ SQL æŸ¥è¯¢å¯èƒ½éœ€è¦æ›´æ–°ä¸ºæ–°ç±»å‹çš„ç³»ç»Ÿã€‚ Connectors å’Œ Formatsç§»é™¤ Kafka 0.10.x å’Œ 0.11.x Connector åœ¨ Flink 1.12 ä¸­ï¼Œç§»é™¤æ‰äº† Kafka 0.10.x å’Œ 0.11.x Connectorï¼Œè¯·ä½¿ç”¨ç»Ÿä¸€çš„ Kafka Connectorï¼ˆé€‚ç”¨äº 0.10.2.x ç‰ˆæœ¬ä¹‹åçš„ä»»ä½• Kafka é›†ç¾¤ï¼‰ï¼Œä½ å¯ä»¥å‚è€ƒ Kafka Connector é¡µé¢çš„æ–‡æ¡£å‡çº§åˆ°æ–°çš„ Flink Kafka Connector ç‰ˆæœ¬ã€‚ CSV åºåˆ—åŒ– Schema åŒ…å«è¡Œåˆ†éš”ç¬¦ csv.line-delimiter é…ç½®å·²ç»ä» CSV æ ¼å¼ä¸­ç§»é™¤äº†ï¼Œå› ä¸ºè¡Œåˆ†éš”ç¬¦åº”è¯¥ç”± Connector å®šä¹‰è€Œä¸æ˜¯ç”± format å®šä¹‰ã€‚å¦‚æœç”¨æˆ·åœ¨ä»¥å‰çš„ Flink ç‰ˆæœ¬ä¸­ä¸€ç›´ä½¿ç”¨äº†è¯¥é…ç½®ï¼Œåˆ™å‡çº§åˆ° Flink 1.12 æ—¶ï¼Œåº”è¯¥åˆ é™¤è¯¥é…ç½®ã€‚ å‡çº§ Kafka Schema Registry Client åˆ° 5.5.0 ç‰ˆæœ¬ flink-avro-confluent-schema-registry æ¨¡å—ä¸å†åœ¨ fat-jar ä¸­æä¾›ï¼Œä½ éœ€è¦æ˜¾å¼çš„åœ¨ä½ è‡ªå·±çš„ä½œä¸šä¸­æ·»åŠ è¯¥ä¾èµ–ï¼ŒSQL-Client ç”¨æˆ·å¯ä»¥ä½¿ç”¨flink-sql-avro-confluent-schema-registry fat jarã€‚ å°† Avro ç‰ˆæœ¬ä» 1.8.2 å‡çº§åˆ° 1.10.0 ç‰ˆæœ¬ flink-avro æ¨¡å—ä¸­çš„ Avro ç‰ˆæœ¬å‡çº§åˆ°äº† 1.10ï¼Œå¦‚æœå‡ºäºæŸç§åŸå› è¦ä½¿ç”¨è¾ƒæ—§çš„ç‰ˆæœ¬ï¼Œè¯·åœ¨é¡¹ç›®ä¸­æ˜ç¡®é™çº§ Avro ç‰ˆæœ¬ã€‚ æ³¨æ„ï¼šæˆ‘ä»¬è§‚å¯Ÿåˆ°ï¼Œä¸ 1.8.2 ç›¸æ¯”ï¼ŒAvro 1.10 ç‰ˆæœ¬çš„æ€§èƒ½æœ‰æ‰€ä¸‹é™ï¼Œå¦‚æœä½ æ‹…å¿ƒæ€§èƒ½ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨è¾ƒæ—§ç‰ˆæœ¬çš„ Avroï¼Œé‚£ä¹ˆè¯·é™çº§ Avro ç‰ˆæœ¬ã€‚ ä¸º SQL Client æ‰“åŒ… flink-avro æ¨¡å—æ—¶ä¼šåˆ›å»ºä¸€ä¸ª uber jar SQL Client jar ä¼šè¢«é‡å‘½åä¸º flink-sql-avro-1.12.jarï¼Œä»¥å‰æ˜¯ flink-avro-1.12-sql-jar.jarï¼Œè€Œä¸”ä¸å†éœ€è¦æ‰‹åŠ¨æ·»åŠ  Avro ä¾èµ–ã€‚ Deploymentï¼ˆéƒ¨ç½²ï¼‰é»˜è®¤ Log4j é…ç½®äº†æ—¥å¿—å¤§å°è¶…è¿‡ 100MB æ»šåŠ¨ é»˜è®¤çš„ log4j é…ç½®ç°åœ¨åšäº†å˜æ›´ï¼šé™¤äº†åœ¨ Flink å¯åŠ¨æ—¶ç°æœ‰çš„æ—¥å¿—æ–‡ä»¶æ»šåŠ¨å¤–ï¼Œå®ƒä»¬åœ¨è¾¾åˆ° 100MB å¤§å°æ—¶ä¹Ÿä¼šæ»šåŠ¨ã€‚Flink æ€»å…±ä¿ç•™ 10 ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œä»è€Œæœ‰æ•ˆåœ°å°†æ—¥å¿—ç›®å½•çš„æ€»å¤§å°é™åˆ¶ä¸º 1GBï¼ˆæ¯ä¸ª Flink æœåŠ¡è®°å½•åˆ°è¯¥ç›®å½•ï¼‰ã€‚ é»˜è®¤åœ¨ Flink Docker é•œåƒä¸­ä½¿ç”¨ jemalloc åœ¨ Flink çš„ Docker é•œåƒä¸­ï¼Œjemalloc è¢«ç”¨ä½œé»˜è®¤çš„å†…å­˜åˆ†é…å™¨ï¼Œä»¥å‡å°‘å†…å­˜ç¢ç‰‡é—®é¢˜ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡å°† disable-jemalloc æ ‡å¿—ä¼ é€’ç»™ docker-entrypoint.sh è„šæœ¬æ¥å›æ»šä½¿ç”¨ glibcã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… Docker æ–‡æ¡£ä¸Šçš„ Flinkã€‚ å‡çº§ Mesos ç‰ˆæœ¬åˆ° 1.7 å°† Mesos ä¾èµ–ç‰ˆæœ¬ä» 1.0.1 ç‰ˆæœ¬å‡çº§åˆ° 1.7.0 ç‰ˆæœ¬ã€‚ å¦‚æœ Flink è¿›ç¨‹åœ¨è¶…æ—¶åä»æœªåœæ­¢ï¼Œåˆ™å‘é€ SIGKILL åœ¨ Flink 1.12 ä¸­ï¼Œå¦‚æœ SIGTERM æ— æ³•æˆåŠŸå…³é—­ Flink è¿›ç¨‹ï¼Œæˆ‘ä»¬æ›´æ”¹äº†ç‹¬ç«‹è„šæœ¬çš„è¡Œä¸ºä»¥å‘å‡º SIGKILLã€‚ ä»‹ç»éé˜»å¡ä½œä¸šæäº¤ æäº¤å·¥ä½œçš„è¯­ä¹‰ç•¥æœ‰å˜åŒ–ï¼Œæäº¤è°ƒç”¨å‡ ä¹ç«‹å³è¿”å›ï¼Œå¹¶ä¸”ä½œä¸šå¤„äºæ–°çš„ INITIALIZING çŠ¶æ€ï¼Œå½“ä½œä¸šå¤„äºè¯¥çŠ¶æ€æ—¶ï¼Œå¯¹ä½œä¸šåš Savepoint æˆ–è€…æ£€ç´¢ä½œä¸šè¯¦æƒ…ä¿¡æ¯ç­‰æ“ä½œå°†ä¸å¯ç”¨ã€‚ ä¸€æ—¦åˆ›å»ºäº†è¯¥ä½œä¸šçš„ JobManagerï¼Œè¯¥ä½œä¸šå°±å¤„äº CREATED çŠ¶æ€ï¼Œå¹¶ä¸”æ‰€æœ‰çš„è°ƒç”¨å‡å¯ç”¨ã€‚ RuntimeFLIP-141: Intra-Slot Managed Memory å…±äº« python.fn-execution.buffer.memory.size å’Œ python.fn-execution.framework.memory.size çš„é…ç½®å·²åˆ é™¤ï¼Œå› æ­¤ä¸å†ç”Ÿæ•ˆã€‚é™¤æ­¤ä¹‹å¤–ï¼Œpython.fn-execution.memory.managed é»˜è®¤çš„å€¼æ›´æ”¹ä¸º trueï¼Œ å› æ­¤é»˜è®¤æƒ…å†µä¸‹ Python workers å°†ä½¿ç”¨æ‰˜ç®¡å†…å­˜ã€‚ FLIP-119 Pipelined Region Scheduling ä» Flink 1.12 å¼€å§‹ï¼Œå°†ä»¥ pipelined region ä¸ºå•ä½è¿›è¡Œè°ƒåº¦ã€‚pipelined region æ˜¯ä¸€ç»„æµæ°´çº¿è¿æ¥çš„ä»»åŠ¡ã€‚è¿™æ„å‘³ç€ï¼Œå¯¹äºåŒ…å«å¤šä¸ª region çš„æµä½œä¸šï¼Œåœ¨å¼€å§‹éƒ¨ç½²ä»»åŠ¡ä¹‹å‰ï¼Œå®ƒä¸å†ç­‰å¾…æ‰€æœ‰ä»»åŠ¡è·å– slotã€‚å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œä¸€æ—¦ä»»ä½• region è·å¾—äº†è¶³å¤Ÿçš„ä»»åŠ¡ slot å°±å¯ä»¥éƒ¨ç½²å®ƒã€‚å¯¹äºæ‰¹å¤„ç†ä½œä¸šï¼Œå°†ä¸ä¼šä¸ºä»»åŠ¡åˆ†é… slotï¼Œä¹Ÿä¸ä¼šå•ç‹¬éƒ¨ç½²ä»»åŠ¡ã€‚å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œä¸€æ—¦æŸä¸ª region è·å¾—äº†è¶³å¤Ÿçš„ slotï¼Œåˆ™è¯¥ä»»åŠ¡å°†ä¸æ‰€æœ‰å…¶ä»–ä»»åŠ¡ä¸€èµ·éƒ¨ç½²åœ¨åŒä¸€åŒºåŸŸä¸­ã€‚ å¯ä»¥ä½¿ç”¨ jobmanager.scheduler.scheduling-strategyï¼šlegacy å¯ç”¨æ—§çš„è°ƒåº¦ç¨‹åºã€‚ RocksDB optimizeForPointLookup å¯¼è‡´ä¸¢å¤±æ—¶é—´çª—å£ é»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šå°† RocksDB çš„ ReadOptions çš„ setTotalOrderSeek è®¾ç½®ä¸ºtrueï¼Œä»¥é˜²æ­¢ç”¨æˆ·å¿˜è®°ä½¿ç”¨ optimizeForPointLookupã€‚ åŒæ—¶ï¼Œæˆ‘ä»¬æ”¯æŒé€šè¿‡RocksDBOptionsFactory è‡ªå®šä¹‰ ReadOptionsã€‚å¦‚æœè§‚å¯Ÿåˆ°ä»»ä½•æ€§èƒ½ä¸‹é™ï¼Œè¯·å°† setTotalOrderSeek è®¾ç½®ä¸º falseï¼ˆæ ¹æ®æˆ‘ä»¬çš„æµ‹è¯•ï¼Œè¿™æ˜¯ä¸å¯èƒ½çš„ï¼‰ã€‚ è‡ªå®šä¹‰ OptionsFactory è®¾ç½®ä¼¼ä¹å¯¹ RocksDB æ²¡æœ‰å½±å“ è¿‡æœŸçš„ OptionsFactory å’Œ ConfigurableOptionsFactory ç±»å·²ç§»é™¤ï¼Œè¯·æ”¹ç”¨ RocksDBOptionsFactory å’Œ ConfigurableRocksDBOptionsFactoryã€‚ å¦‚æœæœ‰ä»»ä½•æ‰©å±• DefaultConfigurableOptionsFactory çš„ç±»ï¼Œä¹Ÿè¯·é‡æ–°ç¼–è¯‘ä½ çš„åº”ç”¨ç¨‹åºä»£ç ã€‚","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"å®æ—¶è®¡ç®—","slug":"å®æ—¶è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/å®æ—¶è®¡ç®—/"}]},{"title":"å¼ºçƒˆæ¨èä¸‰æœ¬ Spark æ–°ä¹¦ç±","date":"2020-10-17T16:00:00.000Z","path":"2020/10/18/Spark-book/","text":"æŒºå¥½çš„ä¸‰æœ¬ä¹¦ å‰è¨€çœ‹åˆ°æ ‡é¢˜å¤§å®¶å¯èƒ½ä¼šæƒ³ï¼Œzhisheng ä¹‹å‰ä¸æ˜¯ä¸€ç›´å†™ Flink ç›¸å…³çš„æ–‡ç« å—ï¼Ÿå’‹å¼€å§‹æ¨è Spark ä¹¦ç±äº†ï¼Œè¿™é‡Œè§£é‡Šä¸€ä¸‹ï¼Œå› ä¸ºæœ¬äººå‰æ®µæ—¶é—´æ¥æ‰‹äº†å…¬å¸ Spark å¼•æ“ï¼Œæ‰€ä»¥å¶å°”ä¹Ÿä¼šæŠ½ç©ºå­¦ä¹ ä¸€ä¸‹ Sparkï¼Œè¿™ä¸çœ‹åˆ°å‡ æœ¬ä¸é”™çš„ Spark ä¹¦ç±ï¼Œäºæ˜¯æƒ³åœ¨è¿™é‡Œä¸å¤§å®¶åˆ†äº«ä¸€ä¸‹ã€‚ ã€ŠStream Processing with Apache Sparkã€‹ è¿™æœ¬ä¹¦å‡ºç‰ˆæ—¶é—´æ˜¯ 2019 å¹´ 6 æœˆï¼Œç®—æ˜¯ä¸ ã€ŠStream Processing with Apache Flinkã€‹æ˜¯å§Šå¦¹ç¯‡ï¼Œä¸»è¦æ˜¯è®² Spark çš„æµå¤„ç†ï¼Œæ¯”å¦‚ Structured Streaming å’Œ Spark Streamingï¼Œå¯¹ Spark æµå¤„ç†æ„Ÿå…´è¶£çš„ä¸å¯é”™è¿‡è¯¥ä¹¦ï¼Œè™½ç„¶ç°åœ¨ Flink æ˜¯æµå¤„ç†çš„ No1ï¼Œä½†æ˜¯å¹¶ä¸å½±å“å¯¹æ¯”ç€å­¦ä¹ ä»–ä»¬ä¹‹é—´çš„æŠ€æœ¯ã€‚ ã€ŠLearning Spark, 2nd Editionã€‹ è¿™æœ¬ä¹¦å‡ºç‰ˆæ—¶é—´æ˜¯ 2020 å¹´ 7 æœˆï¼Œå…¨ä¹¦æˆ‘è§‰å¾—å¯¹äºæ•´ä¸ª Spark çš„ä½“ç³»è®²çš„è¿˜æ˜¯å¾ˆå…¨çš„ï¼Œä»æ¦‚å¿µçš„ä»‹ç»ï¼Œåˆ° API / SQL çš„ä½¿ç”¨ï¼Œå†åˆ°å¦‚ä½•ä¼˜åŒ– Spark ä½œä¸šï¼Œæ¥ç€è®²è§£äº† Structured Streamingï¼Œç„¶åè¿˜è®²è§£äº†é€šè¿‡ Spark æ„å»ºæ•°æ®æ¹–ï¼Œå¹¶ä¸”è¯¥ç« èŠ‚ä¸­è¿˜å¯¹ç›®å‰å¾ˆçƒ­é—¨çš„ä¸‰å¤§æ•°æ®æ¹–æ¡†æ¶ Apache Hudi / Apache Iceberg / Delta Lake è¿›è¡Œäº†ä»‹ç»ã€‚æ¥ç€è®²è§£äº† Spark åœ¨æœºå™¨å­¦ä¹ ç›¸å…³åœºæ™¯çš„æ°´ç¢±å’Œåº”ç”¨ï¼Œæœ€åä»‹ç»äº† Spark 3.0 çš„æ–°ç‰¹æ€§ï¼Œä¹Ÿæ˜¯ç›®å‰å”¯ä¸€ä¸å¤šä»‹ç» Spark 3.0 ç‰ˆæœ¬çš„ä¹¦ç±ä¹‹ä¸€ã€‚ ã€ŠSpark in Action, 2nd Editionã€‹ æœ¬ä¹¦å‡ºç‰ˆæ—¶é—´æ˜¯ 2020 å¹´ 5 æœˆï¼Œå‡ºç‰ˆç¤¾æ˜¯ Manningï¼Œä¸åŒäºä¸Šé¢ä¸¤æœ¬ä¹¦æ˜¯å‡ºç‰ˆäº Oâ€™Reillyã€‚æœ¬ä¹¦å†…å®¹è·Ÿå…¶æ ‡é¢˜å…¶å®è¿˜æ˜¯æ¯”è¾ƒç›¸ç¬¦çš„ï¼Œä¸»è®²å®æˆ˜ï¼Œç›®å½•å¦‚ä¸‹ã€‚ æ‰«æä¸‹é¢äºŒç»´ç ï¼Œå›å¤ Spark å¯è·å–æœ¬æ–‡æåŠåˆ°çš„ä¸‰æœ¬ä¹¦","tags":[{"name":"Spark","slug":"Spark","permalink":"http://www.54tianzhisheng.cn/tags/Spark/"},{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"}]},{"title":"ç”¨äº† Flink History Serverï¼Œå¦ˆå¦ˆå†ä¹Ÿä¸ç”¨æ‹…å¿ƒæˆ‘çš„ä½œä¸šåŠå¤œæŒ‚äº†","date":"2020-10-12T16:00:00.000Z","path":"2020/10/13/flink-history-server/","text":"ä¿å­˜ä½œä¸šåœæ­¢ä¹‹å‰çš„ä¿¡æ¯ å‰è¨€Flink On YARN é»˜è®¤ä½œä¸šæŒ‚äº†ä¹‹åæ‰“å¼€çš„è¯ï¼Œæ˜¯ä¸€ä¸ªå¦‚ä¸‹è¿™æ ·çš„é¡µé¢ï¼š å¯¹äºè¿™ç§æˆ‘ä»¬é¡µé¢æˆ‘ä»¬åªèƒ½æŸ¥çœ‹ JobManager çš„æ—¥å¿—ï¼Œä¸å†å¯ä»¥æŸ¥çœ‹ä½œä¸šæŒ‚æ‰ä¹‹å‰çš„è¿è¡Œçš„ Web UIï¼Œå¾ˆéš¾æ¸…æ¥šçŸ¥é“ä½œä¸šåœ¨æŒ‚çš„é‚£ä¸€åˆ»åˆ°åº•å‘ç”Ÿäº†å•¥ï¼Ÿå¦‚æœæˆ‘ä»¬è¿˜æ²¡æœ‰ Metrics ç›‘æ§çš„è¯ï¼Œé‚£ä¹ˆå®Œå…¨å°±åªèƒ½é€šè¿‡æ—¥å¿—å»åˆ†æå’Œå®šä½é—®é¢˜äº†ï¼Œæ‰€ä»¥å¦‚æœèƒ½è¿˜åŸä¹‹å‰çš„ Web UIï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ UI å‘ç°å’Œå®šä½ä¸€äº›é—®é¢˜ã€‚ History Server ä»‹ç»é‚£ä¹ˆè¿™é‡Œå°±éœ€è¦åˆ©ç”¨ Flink ä¸­çš„ History Server æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚é‚£ä¹ˆ History Server æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ å®ƒå¯ä»¥ç”¨æ¥åœ¨ç›¸åº”çš„ Flink é›†ç¾¤å…³é—­åæŸ¥è¯¢å·²å®Œæˆä½œä¸šçš„ç»Ÿè®¡ä¿¡æ¯ã€‚ä¾‹å¦‚æœ‰ä¸ªæ‰¹å¤„ç†ä½œä¸šæ˜¯å‡Œæ™¨æ‰è¿è¡Œçš„ï¼Œå¹¶ä¸”æˆ‘ä»¬éƒ½çŸ¥é“åªæœ‰å½“ä½œä¸šå¤„äºè¿è¡Œä¸­çš„çŠ¶æ€ï¼Œæ‰èƒ½å¤ŸæŸ¥çœ‹åˆ°ç›¸å…³çš„æ—¥å¿—ä¿¡æ¯å’Œç»Ÿè®¡ä¿¡æ¯ã€‚æ‰€ä»¥å¦‚æœä½œä¸šç”±äºå¼‚å¸¸é€€å‡ºæˆ–è€…å¤„ç†ç»“æœæœ‰é—®é¢˜ï¼Œæˆ‘ä»¬åˆæ— æ³•åŠæ—¶æŸ¥çœ‹ï¼ˆå‡Œæ™¨è¿è¡Œçš„ï¼‰ä½œä¸šçš„ç›¸å…³æ—¥å¿—ä¿¡æ¯ã€‚é‚£ä¹ˆ History Server å°±æ˜¾å¾—ååˆ†é‡è¦äº†ï¼Œå› ä¸ºé€šè¿‡ History Server æˆ‘ä»¬æ‰èƒ½æŸ¥è¯¢è¿™äº›å·²å®Œæˆä½œä¸šçš„ç»Ÿè®¡ä¿¡æ¯ï¼Œæ— è®ºæ˜¯æ­£å¸¸é€€å‡ºè¿˜æ˜¯å¼‚å¸¸é€€å‡ºã€‚ æ­¤å¤–ï¼Œå®ƒå¯¹å¤–æä¾›äº† REST APIï¼Œå®ƒæ¥å— HTTP è¯·æ±‚å¹¶ä½¿ç”¨ JSON æ•°æ®è¿›è¡Œå“åº”ã€‚Flink ä»»åŠ¡åœæ­¢åï¼ŒJobManager ä¼šå°†å·²ç»å®Œæˆä»»åŠ¡çš„ç»Ÿè®¡ä¿¡æ¯è¿›è¡Œå­˜æ¡£ï¼ŒHistory Server è¿›ç¨‹åˆ™åœ¨ä»»åŠ¡åœæ­¢åå¯ä»¥å¯¹ä»»åŠ¡ç»Ÿè®¡ä¿¡æ¯è¿›è¡ŒæŸ¥è¯¢ã€‚æ¯”å¦‚ï¼šæœ€åä¸€æ¬¡çš„ Checkpointã€ä»»åŠ¡è¿è¡Œæ—¶çš„ç›¸å…³é…ç½®ã€‚ é‚£ä¹ˆå¦‚ä½•å¼€å¯è¿™ä¸ªå‘¢ï¼Ÿä½ éœ€è¦åœ¨ flink-conf.yml ä¸­é…ç½®å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526#==============================================================================# HistoryServer#==============================================================================# The HistoryServer is started and stopped via bin/historyserver.sh (start|stop)# Directory to upload completed jobs to. Add this directory to the list of# monitored directories of the HistoryServer as well (see below). # flink job è¿è¡Œå®Œæˆåçš„æ—¥å¿—å­˜æ”¾ç›®å½•jobmanager.archive.fs.dir: hdfs:///flink/history-log# The address under which the web-based HistoryServer listens.# flink historyè¿›ç¨‹æ‰€åœ¨çš„ä¸»æœº#historyserver.web.address: 0.0.0.0# The port under which the web-based HistoryServer listens.# flink historyè¿›ç¨‹çš„å ç”¨ç«¯å£#historyserver.web.port: 8082# Comma separated list of directories to monitor for completed jobs.# flink historyè¿›ç¨‹çš„hdfsç›‘æ§ç›®å½•historyserver.archive.fs.dir: hdfs:///flink/history-log# Interval in milliseconds for refreshing the monitored directories.# åˆ·æ–°å—ç›‘è§†ç›®å½•çš„æ—¶é—´é—´éš”ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰#historyserver.archive.fs.refresh-interval: 10000 æ³¨æ„ï¼š jobmanager.archive.fs.dir è¦å’Œ historyserver.archive.fs.dir é…ç½®çš„è·¯å¾„è¦ä¸€æ · æ‰§è¡Œå‘½ä»¤ï¼š 1./bin/historyserver.sh start å‘ç°æŠ¥é”™å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272020-10-13 21:21:01,310 main INFO org.apache.flink.core.fs.FileSystem - Hadoop is not in the classpath/dependencies. The extended set of supported File Systems via Hadoop is not available.2020-10-13 21:21:01,336 main INFO org.apache.flink.runtime.security.modules.HadoopModuleFactory - Cannot create Hadoop Security Module because Hadoop cannot be found in the Classpath.2020-10-13 21:21:01,352 main INFO org.apache.flink.runtime.security.modules.JaasModule - Jaas file will be created as /tmp/jaas-354359771751866787.conf.2020-10-13 21:21:01,355 main INFO org.apache.flink.runtime.security.SecurityUtils - Cannot install HadoopSecurityContext because Hadoop cannot be found in the Classpath.2020-10-13 21:21:01,363 main WARN org.apache.flink.runtime.webmonitor.history.HistoryServer - Failed to create Path or FileSystem for directory 'hdfs:///flink/history-log'. Directory will not be monitored.org.apache.flink.core.fs.UnsupportedFileSystemSchemeException: Could not find a file system implementation for scheme 'hdfs'. The scheme is not directly supported by Flink and no Hadoop file system to support this scheme could be loaded. at org.apache.flink.core.fs.FileSystem.getUnguardedFileSystem(FileSystem.java:450) at org.apache.flink.core.fs.FileSystem.get(FileSystem.java:362) at org.apache.flink.core.fs.Path.getFileSystem(Path.java:298) at org.apache.flink.runtime.webmonitor.history.HistoryServer.&lt;init&gt;(HistoryServer.java:187) at org.apache.flink.runtime.webmonitor.history.HistoryServer.&lt;init&gt;(HistoryServer.java:137) at org.apache.flink.runtime.webmonitor.history.HistoryServer$1.call(HistoryServer.java:122) at org.apache.flink.runtime.webmonitor.history.HistoryServer$1.call(HistoryServer.java:119) at org.apache.flink.runtime.security.NoOpSecurityContext.runSecured(NoOpSecurityContext.java:30) at org.apache.flink.runtime.webmonitor.history.HistoryServer.main(HistoryServer.java:119)Caused by: org.apache.flink.core.fs.UnsupportedFileSystemSchemeException: Hadoop is not in the classpath/dependencies. at org.apache.flink.core.fs.UnsupportedSchemeFactory.create(UnsupportedSchemeFactory.java:58) at org.apache.flink.core.fs.FileSystem.getUnguardedFileSystem(FileSystem.java:446) ... 8 more2020-10-13 21:21:01,367 main ERROR org.apache.flink.runtime.webmonitor.history.HistoryServer - Failed to run HistoryServer.org.apache.flink.util.FlinkException: Failed to validate any of the configured directories to monitor. at org.apache.flink.runtime.webmonitor.history.HistoryServer.&lt;init&gt;(HistoryServer.java:196) at org.apache.flink.runtime.webmonitor.history.HistoryServer.&lt;init&gt;(HistoryServer.java:137) at org.apache.flink.runtime.webmonitor.history.HistoryServer$1.call(HistoryServer.java:122) at org.apache.flink.runtime.webmonitor.history.HistoryServer$1.call(HistoryServer.java:119) at org.apache.flink.runtime.security.NoOpSecurityContext.runSecured(NoOpSecurityContext.java:30) at org.apache.flink.runtime.webmonitor.history.HistoryServer.main(HistoryServer.java:119) è¿™ä¸ªå¼‚å¸¸çš„åŸå› æ˜¯å› ä¸º Flink é›†ç¾¤çš„ CLASS_PATH ä¸‹ç¼ºå°‘äº† HDFS ç›¸å…³çš„ jarï¼Œæˆ‘ä»¬å¯ä»¥å¼•å…¥ HDFS çš„ä¾èµ–æ”¾åˆ° lib ç›®å½•ä¸‹é¢æˆ–è€…æ·»åŠ  Hadoop çš„ç¯å¢ƒå˜é‡ã€‚ è¿™é‡Œæˆ‘ä»¬åœ¨ historyserver.sh è„šæœ¬ä¸­å¢åŠ ä¸‹é¢è„šæœ¬ï¼Œç›®çš„å°±æ˜¯æ·»åŠ  Hadoop çš„ç¯å¢ƒå˜é‡ï¼š 123456# export hadoop classpathif [ `command -v hadoop` ];then export HADOOP_CLASSPATH=`hadoop classpath`else echo \"hadoop command not found in path!\"fi æ•ˆæœæ·»åŠ åå†å¯åŠ¨è„šæœ¬åˆ™å¯ä»¥è¿è¡ŒæˆåŠŸäº†ï¼Œæ‰“å¼€é¡µé¢ æœºå™¨IP:8082 åˆ™å¯ä»¥çœ‹åˆ°å†å²æ‰€æœ‰è¿è¡Œå®Œæˆæˆ–è€…å¤±è´¥çš„ä½œä¸šåˆ—è¡¨ä¿¡æ¯ã€‚ ç‚¹è¿›å•ä¸ªä½œä¸šå¯ä»¥çœ‹åˆ°ä½œä¸šæŒ‚ä¹‹å‰çš„æ‰€æœ‰ä¿¡æ¯ï¼Œä¾¿äºæˆ‘ä»¬å»æŸ¥çœ‹æŒ‚ä¹‹å‰ä½œä¸šçš„è¿è¡Œæƒ…å†µï¼ˆException ä¿¡æ¯/Checkpoint ä¿¡æ¯/ç®—å­çš„æµå…¥å’Œæµå‡ºæ•°æ®é‡ä¿¡æ¯ç­‰ï¼‰ åŸç†åˆ†æå†æ¥çœ‹çœ‹é…ç½®çš„ /flink/history-log/ ç›®å½•æœ‰ä»€ä¹ˆä¸œè¥¿å‘¢ï¼Ÿæ‰§è¡Œä¸‹é¢å‘½ä»¤å¯ä»¥æŸ¥çœ‹ 1hdfs dfs -ls /flink/history-log/ å…¶å® history server ä¼šåœ¨æœ¬åœ°å­˜å‚¨å·²ç»“æŸ Job ä¿¡æ¯ï¼Œä½ å¯ä»¥é…ç½® historyserver.web.tmpdir æ¥å†³å®šå­˜å‚¨åœ¨å“ªï¼Œé»˜è®¤çš„æ‹¼æ¥è§„åˆ™ä¸ºï¼š 1System.getProperty(\"java.io.tmpdir\") + File.separator + \"flink-web-history-\" + UUID.randomUUID() Linux ç³»ç»Ÿä¸´æ—¶ç›®å½•ä¸º /tmpï¼Œä½ å¯ä»¥çœ‹åˆ°æºç ä¸­ HistoryServerOptions è¯¥ç±»ä¸­çš„å¯é€‰å‚æ•°ã€‚ 12345678/*** The local directory used by the HistoryServer web-frontend.*/public static final ConfigOption&lt;String&gt; HISTORY_SERVER_WEB_DIR = key(\"historyserver.web.tmpdir\") .noDefaultValue() .withDescription(\"This configuration parameter allows defining the Flink web directory to be used by the\" + \" history server web interface. The web interface will copy its static files into the directory.\"); é‚£ä¹ˆæˆ‘ä»¬æ‰¾åˆ°æœ¬åœ°è¯¥ä¸´æ—¶ç›®å½•ï¼Œå¯ä»¥è§‚å¯Ÿåˆ°é‡Œé¢ä¿å­˜ç€å¾ˆå¤š JS æ–‡ä»¶ï¼Œå…¶å®å°±æ˜¯æˆ‘ä»¬åˆšæ‰çœ‹åˆ°çš„é¡µé¢ å†å²æœåŠ¡å­˜å‚¨æ–‡ä»¶ä¸­ï¼Œå­˜å‚¨äº†ç”¨äºé¡µé¢å±•ç¤ºçš„æ¨¡æ¿é…ç½®ã€‚å†å²ä»»åŠ¡ä¿¡æ¯å­˜å‚¨åœ¨ Jobs è·¯å¾„ä¸‹ï¼Œå…¶ä¸­åŒ…å«äº†å·²ç»å®Œæˆçš„ Jobï¼Œæ¯æ¬¡å¯åŠ¨éƒ½ä¼šä» historyserver.archive.fs.dir æ‹‰å–æ‰€æœ‰çš„ä»»åŠ¡å…ƒæ•°æ®ä¿¡æ¯ã€‚ æ¯ä¸ªä»»åŠ¡æ–‡ä»¶å¤¹ä¸­åŒ…å«æˆ‘ä»¬éœ€è¦è·å–çš„ä¸€äº›ä¿¡æ¯ï¼Œé€šè¿‡ REST API è·å–æ—¶æŒ‡æ ‡æ—¶ï¼Œå°±æ˜¯è¿”å›è¿™äº›å†…å®¹ï¼ˆCheckpoint/Exception ä¿¡æ¯ç­‰ï¼‰ã€‚ REST APIä»¥ä¸‹æ˜¯å¯ç”¨ä¸”å¸¦æœ‰ç¤ºä¾‹ JSON å“åº”çš„è¯·æ±‚åˆ—è¡¨ã€‚æ‰€æœ‰è¯·æ±‚æ ¼å¼æ ·ä¾‹å‡ä¸º http://hostname:8082/jobsï¼Œä¸‹é¢æˆ‘ä»¬ä»…åˆ—å‡ºäº† URLs çš„ path éƒ¨åˆ†ã€‚ å°–æ‹¬å·ä¸­çš„å€¼ä¸ºå˜é‡ï¼Œä¾‹å¦‚ä½œä¸š 7684be6004e4e955c2a558a9bc463f65 çš„ http://hostname:port/jobs/&lt;jobid&gt;/exceptions è¯·æ±‚é¡»å†™ä¸º http://hostname:port/jobs/7684be6004e4e955c2a558a9bc463f65/exceptionsã€‚ /config /jobs/overview /jobs/&lt;jobid&gt; /jobs/&lt;jobid&gt;/vertices /jobs/&lt;jobid&gt;/config /jobs/&lt;jobid&gt;/exceptions /jobs/&lt;jobid&gt;/accumulators /jobs/&lt;jobid&gt;/vertices/&lt;vertexid&gt; /jobs/&lt;jobid&gt;/vertices/&lt;vertexid&gt;/subtasktimes /jobs/&lt;jobid&gt;/vertices/&lt;vertexid&gt;/taskmanagers /jobs/&lt;jobid&gt;/vertices/&lt;vertexid&gt;/accumulators /jobs/&lt;jobid&gt;/vertices/&lt;vertexid&gt;/subtasks/accumulators /jobs/&lt;jobid&gt;/vertices/&lt;vertexid&gt;/subtasks/&lt;subtasknum&gt; /jobs/&lt;jobid&gt;/vertices/&lt;vertexid&gt;/subtasks/&lt;subtasknum&gt;/attempts/&lt;attempt&gt; /jobs/&lt;jobid&gt;/vertices/&lt;vertexid&gt;/subtasks/&lt;subtasknum&gt;/attempts/&lt;attempt&gt;/accumulators /jobs/&lt;jobid&gt;/plan æ€»ç»“è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¼€å¿ƒçš„å»æŸ¥çœ‹ä½œä¸šæŒ‚ä¹‹å‰çš„ Web UI ä¿¡æ¯äº†ï¼Œå¦ˆå¦ˆåœ¨ä¹Ÿä¸ç”¨æ‹…å¿ƒæˆ‘çš„ä½œä¸šæŒ‚äº†ï¼ğŸ˜ å‚è€ƒæ–‡ç«  History Server flinkå†å²æœåŠ¡ Github ä»£ç ä»“åº“https://github.com/zhisheng17/flink-learning/ ä»¥åè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç éƒ½å°†æ”¾åœ¨è¿™ä¸ªä»“åº“é‡Œï¼ŒåŒ…å«äº†è‡ªå·±å­¦ä¹  flink çš„ä¸€äº› demo å’Œåšå®¢ å…³æ³¨æˆ‘å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"å®æ—¶è®¡ç®—","slug":"å®æ—¶è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/å®æ—¶è®¡ç®—/"}]},{"title":"å¦‚ä½•ç”Ÿæˆ Flink ä½œä¸šçš„äº¤äº’å¼ç«ç„°å›¾ï¼Ÿ","date":"2020-10-04T16:00:00.000Z","path":"2020/10/05/flink-jvm-profiler/","text":"Flink ä½œä¸šç”Ÿæˆç«ç„°å›¾ å‰è¨€Flink æ˜¯ç›®å‰æœ€æµè¡Œçš„å¤§æ•°æ®åŠæµå¼è®¡ç®—æ¡†æ¶ä¹‹ä¸€ï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨ Java/Scala/Python çš„DataStream æ¥å£æˆ–è€…æ ‡å‡† SQL è¯­è¨€æ¥å¿«é€Ÿå®ç°ä¸€ä¸ªåˆ†å¸ƒå¼é«˜å¯ç”¨çš„æµå¼åº”ç”¨ï¼Œé€šè¿‡å†…éƒ¨çš„ Java JITã€off-heap å†…å­˜ç®¡ç†ç­‰æŠ€æœ¯ä¼˜åŒ–æ€§èƒ½ï¼Œå¹¶ä¸”æœ‰å®Œæ•´çš„ Sourceã€Sinkã€WebUIã€Metrics ç­‰åŠŸèƒ½é›†æˆï¼Œè®© Flink å‡ ä¹æˆä¸ºäº†æµå¼è®¡ç®—çš„äº‹å®æ ‡å‡†ã€‚ ä½†æ˜¯å½“å¤„ç†æµ·é‡æ•°æ®çš„æ—¶å€™ï¼Œå¾ˆå®¹æ˜“å‡ºç°å„ç§å¼‚å¸¸å’Œæ€§èƒ½ç“¶é¢ˆï¼Œè¿™æ—¶æˆ‘ä»¬éœ€è¦ä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½æ—¶ï¼Œå¸¸å¸¸éœ€è¦åˆ†æç¨‹åºè¿è¡Œè¡Œä¸ºå’Œæ€§èƒ½ç“¶é¢ˆã€‚Profiling æŠ€æœ¯æ˜¯ä¸€ç§åœ¨åº”ç”¨è¿è¡Œæ—¶æ”¶é›†ç¨‹åºç›¸å…³ä¿¡æ¯çš„åŠ¨æ€åˆ†ææ‰‹æ®µï¼Œå¸¸ç”¨çš„ JVM Profiler å¯ä»¥ä»å¤šä¸ªæ–¹é¢å¯¹ç¨‹åºè¿›è¡ŒåŠ¨æ€åˆ†æï¼Œå¦‚ CPUã€Memoryã€Threadã€Classesã€GC ç­‰ï¼Œå…¶ä¸­ CPU Profiling çš„åº”ç”¨æœ€ä¸ºå¹¿æ³›ã€‚CPU Profiling ç»å¸¸è¢«ç”¨äºåˆ†æä»£ç çš„æ‰§è¡Œçƒ­ç‚¹ï¼Œå¦‚â€œå“ªä¸ªæ–¹æ³•å ç”¨ CPU çš„æ‰§è¡Œæ—¶é—´æœ€é•¿â€ã€â€œæ¯ä¸ªæ–¹æ³•å ç”¨ CPU çš„æ¯”ä¾‹æ˜¯å¤šå°‘â€ç­‰ç­‰ï¼Œé€šè¿‡ CPU Profiling å¾—åˆ°ä¸Šè¿°ç›¸å…³ä¿¡æ¯åï¼Œç ”å‘äººå‘˜å°±å¯ä»¥è½»æ¾é’ˆå¯¹çƒ­ç‚¹ç“¶é¢ˆè¿›è¡Œåˆ†æå’Œæ€§èƒ½ä¼˜åŒ–ï¼Œè¿›è€Œçªç ´æ€§èƒ½ç“¶é¢ˆï¼Œå¤§å¹…æå‡ç³»ç»Ÿçš„ååé‡ã€‚ æœ¬æ–‡ä»‹ç»æˆ‘ä»¬åœ¨åšæ€§èƒ½ä¼˜åŒ–å¸¸ç”¨çš„ç«ç„°å›¾ä»¥åŠä¸ºå¦‚ä½•é›†æˆç«ç„°å›¾åˆ°é€šç”¨çš„ Flink ä½œä¸šä¸­ã€‚ ç«ç„°å›¾ä»‹ç»ç«ç„°å›¾æ˜¯ã€Šæ€§èƒ½ä¹‹å·…ã€‹ä½œè€…ä»¥åŠ DTrace ç­‰ä¸€ç³»åˆ— Linux ç³»ç»Ÿä¼˜åŒ–å·¥å…·ä½œè€… Brendan Gregg å¤§ç¥çš„ä½œå“ä¹‹ä¸€ï¼Œå¯ä»¥éå¸¸æ¸…æ™°åœ°å±•ç¤ºåº”ç”¨ç¨‹åºçš„å‡½æ•°è°ƒç”¨æ ˆä»¥åŠå‡½æ•°è°ƒç”¨æ—¶é—´å æ¯”ï¼ŒåŸºæœ¬åŸç†æ˜¯é€šè¿‡å„ç§ agent åœ¨ç¨‹åºè¿è¡Œæ—¶é‡‡æ ·å¹¶è¾“å‡ºæ—¥å¿—ï¼Œä½¿ç”¨ FlameGraph å·¥å…·æŠŠæ—¥å¿—æå–å‡ºæ¥è¾“å‡ºå¯åœ¨æµè§ˆå™¨äº¤äº’å¼æŸ¥çœ‹çš„ SVGå›¾ç‰‡ã€‚ Uber å¼€æºäº† jvm-profiler é¡¹ç›®ï¼Œä»‹ç»å¦‚ä½•ä¸º Spark åº”ç”¨å’Œ Java åº”ç”¨æ·»åŠ ç«ç„°å›¾æ”¯æŒï¼Œä½†æ˜¯ç›®å‰ Flink ç¤¾åŒºå’Œ jvm-profiler å®˜ç½‘éƒ½è¿˜æ²¡æœ‰ç›¸å…³çš„ä½¿ç”¨æ•™ç¨‹ã€‚ å®é™…ä¸ŠåŸºäº JVM çš„ç¨‹åºéƒ½å¯ä»¥ä½¿ç”¨è¿™ä¸ªå·¥å…·ï¼Œæœ¬æ–‡å°†åŸºäº jvm-profiler æ¥ä»‹ç»å¦‚ä½•ç”Ÿæˆ Flink ä½œä¸šçš„ç«ç„°å›¾ã€‚ ä¸‹è½½å’Œç¼–è¯‘ jvm-profiler123git clone git clone https://github.com/uber-common/jvm-profiler.gitmvn clean install -DskipTests=true -Dcheckstyle.skip -Dfast -T 8C ç¼–è¯‘å¥½äº†ä¹‹åï¼Œå°†é¡¹ç›® target ç›®å½•ä¸‹çš„ jvm-profiler-1.0.0.jar å¤åˆ¶ä¸€ä»½åˆ° flink çš„ lib ç›®å½•ä¸‹é¢ 1cp target/jvm-profiler-1.0.0.jar /usr/local/flink-1.11.1/lib ä¸‹è½½ FlameGraphç”±äº jvm-profiler æ”¯æŒç”Ÿæˆç«ç„°å›¾éœ€è¦çš„æ—¥å¿—æ–‡ä»¶ï¼Œå°†æ—¥å¿—è½¬åŒ–æˆäº¤äº’å¼ SVG å›¾ç‰‡è¿˜æ˜¯ä½¿ç”¨ Brendan Gregg çš„FlameGraph å·¥å…·ã€‚ 1git clone https://github.com/brendangregg/FlameGraph.git ä¸‹è½½é¡¹ç›®æºç å³å¯ï¼Œåé¢ä¼šä½¿ç”¨ flamegraph.pl å·¥å…·æ¥ç”Ÿæˆå›¾ç‰‡æ–‡ä»¶ã€‚ é…ç½® Flinkå¯¹äº Flink åº”ç”¨ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ TaskManager ä¸­æ³¨å…¥æ‰“ç‚¹çš„ Java agent å³å¯ï¼Œè¿™é‡Œæµ‹è¯•ï¼Œæˆ‘å°±ä½¿ç”¨æœ¬åœ° standalone æ¨¡å¼ï¼Œä¿®æ”¹ Flink conf ç›®å½•ä¸‹çš„ flink-conf.yaml æ–‡ä»¶ï¼Œæ·»åŠ ä¸€ä¸‹å¦‚ä¸‹é…ç½®ï¼š 1env.java.opts.taskmanager: \"-javaagent:/usr/local/flink-1.11.1/lib/jvm-profiler-1.0.0.jar=sampleInterval=50\" ç›®å‰æœ€å°çš„é‡‡æ ·é—´éš”å°±æ˜¯ 50 æ¯«ç§’ï¼Œç„¶åå¯åŠ¨é›†ç¾¤å’Œè¿è¡Œä¸€ä¸ª Flink ä½œä¸šï¼š 12345./bin/start-cluster.sh//è¿è¡Œä¸€ä¸ªä½œä¸š./bin/flink run ./examples/streaming/StateMachineExample.jar è¿è¡Œä¹‹åå¯ä»¥çœ‹åˆ° TaskManager çš„ stdout é‡Œé¢æ‰“å°å¦‚ä¸‹ï¼š å› ä¸ºå·²ç»æ³¨å…¥ Java agentï¼Œå› æ­¤åœ¨æ ‡å‡†è¾“å‡ºä¸­ä¼šå®šæœŸæ·»åŠ ç«ç„°å›¾æ‰€éœ€è¦çš„æ‰“ç‚¹æ•°æ®ï¼Œç„¶åä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æå–ç›¸å…³æ—¥å¿—ï¼Œå¹¶ä¸”ä½¿ç”¨ jvm-profiler å’Œ FlameGraph æä¾›çš„å·¥å…·æ¥ç”Ÿæˆ SVG å›¾ç‰‡æ–‡ä»¶ã€‚ 12345678910111213//1ã€æå– stdout æ–‡ä»¶ä¸­çš„ç›¸å…³æ—¥å¿—cat log/flink-zhisheng-taskexecutor-0-zhisheng.out | grep \"ConsoleOutputReporter - Stacktrace:\" | awk '&#123;print substr($0,37)&#125;' &gt; stacktrace.json//2ã€åœ¨ jvm-profiler ç›®å½•ä¸‹æ‰§è¡Œä¸‹é¢å‘½ä»¤python ./stackcollapse.py -i /usr/local/flink-1.11.1/stacktrace.json &gt; stacktrace.folded//3ã€åœ¨ FlameGraph ç›®å½•ä¸‹æ‰§è¡Œä¸‹é¢å‘½ä»¤ç”Ÿæˆ SVG å›¾ç‰‡./flamegraph.pl /Users/zhisheng/Documents/github/jvm-profiler/stacktrace.folded &gt; stacktrace.svg ç„¶åç”¨æµè§ˆå™¨æ‰“å¼€åˆšæ‰ç”Ÿæˆçš„ SVG å›¾ç‰‡å°±å¯ä»¥çœ‹åˆ°ç«ç„°å›¾ä¿¡æ¯ã€‚ æ€»ç»“æœ¬æ–‡ä¸»è¦ç›®çš„åœ¨äºæ•™å¤§å®¶å¦‚ä½•åˆ©ç”¨ jvm-profiler å»ç”Ÿæˆ Flink ä½œä¸šçš„è¿è¡Œç«ç„°å›¾ï¼Œè¿™æ ·å¯ä»¥åœ¨é‡åˆ°æ€§èƒ½ç“¶é¢ˆé—®é¢˜çš„æ—¶å€™ä¼šå¾ˆæ–¹ä¾¿å¤§å®¶å»å®šä½é—®é¢˜ï¼Œå…³äºå¦‚ä½•å»è¯»æ‡‚ç”Ÿæˆçš„ç«ç„°å›¾ï¼Œåé¢å¯ä»¥å†åˆ†äº«ç³»åˆ—æ–‡ç« ã€‚ å‚è€ƒèµ„æ–™ JVM CPU ProfileræŠ€æœ¯åŸç†åŠæºç æ·±åº¦è§£æ jvm-profile å…³æ³¨æˆ‘å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ Github ä»£ç ä»“åº“https://github.com/zhisheng17/flink-learning/ ä»¥åè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç éƒ½å°†æ”¾åœ¨è¿™ä¸ªä»“åº“é‡Œï¼ŒåŒ…å«äº†è‡ªå·±å­¦ä¹  flink çš„ä¸€äº› demo å’Œåšå®¢","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"å®æ—¶è®¡ç®—","slug":"å®æ—¶è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/å®æ—¶è®¡ç®—/"}]},{"title":"Flink ç²¾è¿›å­¦ä¹ çŸ¥è¯†æ˜Ÿçƒå†…å®¹æ•´ç†","date":"2020-08-08T16:00:00.000Z","path":"2020/08/09/flink-zsxq/","text":"æ•´ç†è‡ªå·±å‘åœ¨çŸ¥è¯†æ˜Ÿçƒå’Œå…¬ä¼—å·çš„ç³»åˆ—æ–‡ç« ï¼Œæ–¹ä¾¿æŸ¥æ‰¾ã€‚ ä»‹ç»è¿›çŸ¥è¯†æ˜Ÿçƒçš„å°ä¼™ä¼´æœ‰çš„æ˜¯åˆšæ¥è§¦ Flink çš„ï¼Œæœ‰çš„æ˜¯æ ¹æœ¬æ²¡æ¥è§¦è¿‡çš„ï¼Œæœ‰çš„æ˜¯å·²ç»ç”¨ Flink å¾ˆä¹…çš„ï¼Œæ‰€ä»¥å¾ˆéš¾é€‚åˆæ‰€æœ‰çš„å£å‘³ã€‚æˆ‘ä¸€å‘è®¤ä¸ºå¯¹ä¸€é—¨æŠ€æœ¯çš„å­¦ä¹ æ–¹å¼åº”è¯¥æ˜¯ï¼š äº†è§£ï¼ˆçŸ¥é“å®ƒçš„ç›¸å…³ä»‹ç»ã€ç”¨å¤„ï¼‰ ç”¨ï¼ˆäº†è§£å¸¸ç”¨ APIï¼‰ ç”¨ç†Ÿï¼ˆå¯¹å¸¸ç”¨ API èƒ½å¤Ÿç”¨ç†Ÿæ¥ï¼Œå¹¶äº†è§£ä¸€äº›é«˜çº§ APIï¼‰ è§£å†³é—®é¢˜ï¼ˆæ ¹æ®ä¸šåŠ¡åœºæ™¯é‡åˆ°çš„é—®é¢˜èƒ½å¤Ÿå®šä½é—®é¢˜å¹¶è§£å†³ï¼‰ çœ‹æºç ï¼ˆæ·±å…¥æºç çš„å®ç°ï¼Œæ­¤ç§æƒ…å†µä¸»è¦æ˜¯å…´è¶£çˆ±å¥½é©±åŠ¨ï¼‰ è¿™é‡Œå…ˆæŠŠã€Šä» 0 åˆ° 1 å­¦ä¹  Flinkã€‹çš„ç³»åˆ—æ–‡ç« ç»™åˆ—å‡ºæ¥ï¼Œæˆ‘è§‰å¾—ä»è¿™ä¸ªç³»åˆ—æ–‡ç« çš„é¡ºåºæ¥å­¦ä¹ èµ·ç å¯ä»¥è®©ä½ å…ˆè¾¾åˆ°ç¬¬å››ä¸ªæ­¥éª¤ï¼Œå¦‚æœæœ‰ä»€ä¹ˆç–‘é—®æˆ–è€…æ–‡ç« ä¸è¶³ä¹‹å¤„æ¬¢è¿æŒ‡å‡ºã€‚ ã€Šä» 0 åˆ° 1 å­¦ä¹  Flinkã€‹ç³»åˆ— Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Apache Flink ä»‹ç» Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Data Source ä»‹ç» Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Data Sink ä»‹ç» Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” ä»‹ç»Flinkä¸­çš„Stream Windows Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Flink æµè®¡ç®—ç¼–ç¨‹â€“çœ‹çœ‹åˆ«äººæ€ä¹ˆç”¨ Session Window Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” è¿™ä¸€æ¬¡å¸¦ä½ å½»åº•ææ‡‚ Flink Watermark Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Flink ä¸­å‡ ç§ Time è¯¦è§£ Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Flink å†™å…¥æ•°æ®åˆ° ElasticSearch Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Flink å®æ—¶å†™å…¥æ•°æ®åˆ° ElasticSearch æ€§èƒ½è°ƒä¼˜ Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Flink å†™å…¥æ•°æ®åˆ° Kafka Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº†? Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ Flink ä» 0 åˆ° 1 å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥? Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Flink Checkpoint è½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” ä½¿ç”¨ Prometheus Grafana ç›‘æ§ Flink Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” ä½¿ç”¨ InflubDB å’Œ Grafana ç›‘æ§ Flink JobManager TaskManager å’Œä½œä¸š Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” ä»0åˆ°1æ­å»ºä¸€å¥— Flink ç›‘æ§ç³»ç»Ÿ Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” è¯¦è§£ Flink Metrics åŸç†ä¸ç›‘æ§å®æˆ˜ Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Flink è¯»å– Kafka å•†å“æ•°æ®åå†™å…¥åˆ° Redis Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” ä¸€æ–‡ææ‡‚ Flink ç½‘ç»œæµæ§ä¸åå‹æœºåˆ¶ Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” ä¸€æ–‡ææ‡‚Flinkå†…éƒ¨çš„Exactly Onceå’ŒAt Least Once Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Flink On K8s Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Apache Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„? Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Flink å‚æ•°é…ç½®å’Œå¸¸è§å‚æ•°è°ƒä¼˜ Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Flink çŠ¶æ€ç”Ÿå­˜æ—¶é—´ï¼ˆState TTLï¼‰æœºåˆ¶çš„åº•å±‚å®ç° Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Flink State æœ€ä½³å®è·µ Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Flink ä½¿ç”¨å¤§çŠ¶æ€æ—¶çš„ä¸€ç‚¹ä¼˜åŒ– Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Flink ä½¿ç”¨ broadcast å®ç°ç»´è¡¨æˆ–é…ç½®çš„å®æ—¶æ›´æ–° Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Spark/Flinkå¹¿æ’­å®ç°ä½œä¸šé…ç½®åŠ¨æ€æ›´æ–° Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Flink æ¸…ç†è¿‡æœŸ Checkpoint ç›®å½•çš„æ­£ç¡®å§¿åŠ¿ Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Flink çŠ¶æ€ç®¡ç†ä¸ Checkpoint æœºåˆ¶ Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Flink èƒ½å¦åŠ¨æ€æ›´æ”¹ Checkpoint é…ç½® Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Flink Checkpoint é—®é¢˜æ’æŸ¥å®ç”¨æŒ‡å— Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Apache Flink ç®¡ç†å¤§å‹çŠ¶æ€ä¹‹å¢é‡ Checkpoint è¯¦è§£ Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” æ·±å…¥ç†è§£ Flink å®¹é”™æœºåˆ¶ Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Flink ä½¿ç”¨ connect å®ç°åŒæµåŒ¹é… Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Flinkæµè®¡ç®—ç¼–ç¨‹â€“Flinkæ‰©å®¹ã€ç¨‹åºå‡çº§å‰åçš„æ€è€ƒ Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Flink HDFS Sink å¦‚ä½•ä¿è¯ exactly-once è¯­ä¹‰ Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Flink Connector æ·±åº¦è§£æ Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Flink å…¨é“¾è·¯ç«¯åˆ°ç«¯å»¶è¿Ÿçš„æµ‹é‡æ–¹æ³• Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Flink on Yarn / K8s åŸç†å‰–æåŠå®è·µ Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Kubernetes éƒ¨ç½² Flink åº”ç”¨ Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” ä¸€å¼ å›¾è½»æ¾æŒæ¡ Flink on YARN åŸºç¡€æ¶æ„ä¸å¯åŠ¨æµç¨‹ Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Flink on YARN å¸¸è§é—®é¢˜ä¸æ’æŸ¥æ€è·¯ Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Flink å•å¹¶è¡Œåº¦å†…ä½¿ç”¨å¤šçº¿ç¨‹æ¥æé«˜ä½œä¸šæ€§èƒ½ Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Flinkä¸­èµ„æºç®¡ç†æœºåˆ¶è§£è¯»ä¸å±•æœ› Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Flink Back Pressure(èƒŒå‹)æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿæœ‰ä»€ä¹ˆç»å¦™ä¹‹å¤„ï¼Ÿ Flink SQL çŸ¥è¯†æ˜Ÿçƒ Flink æ ‡ç­¾æ‰€æœ‰å†…å®¹ Java SPI æœºåˆ¶åœ¨ Flink SQL ä¸­çš„åº”ç”¨ Flink é€šè¿‡ DDL å’Œ SQL æ¥å®ç°è¯»å– Kafka æ•°æ®å¹¶å¤„ç†åå°†æ•°æ®å†™å› Kafka Flink SQL å®æˆ˜â€”â€”è¯»å–Kafkaæ•°æ®å¤„ç†åå†™å…¥ ElasticSearch 6 å’Œ 7 ä¸¤ç§ç‰ˆæœ¬ Flink èšåˆæ€§èƒ½ä¼˜åŒ– â€“ MiniBatch åˆ†æ Flinkæµè®¡ç®—ç¼–ç¨‹ï¼šåŒæµä¸­å®ç°Inner Joinã€Left Joinä¸Right Join Flink SQL å¦‚ä½•å®ç°æ•°æ®æµçš„ Joinï¼Ÿ ã€ŠFlink å„ç‰ˆæœ¬åŠŸèƒ½ç‰¹æ€§è§£è¯»ã€‹ Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» Flink 1.11 æ—¥å¿—æ–‡ä»¶è¯¥å¦‚ä½•é…ç½®ï¼Ÿ Flink 1.11 Release æ–‡æ¡£è§£è¯» Apache Flink 1.10 TaskManager å†…å­˜ç®¡ç†ä¼˜åŒ– Flink ç‰ˆæœ¬å‡çº§æ–¹æ¡ˆ Flink 1.11 æ–°ç‰¹æ€§è¯¦è§£:ã€éå¯¹é½ã€‘Unaligned Checkpoint ä¼˜åŒ–é«˜åå‹ åƒå‘¼ä¸‡å”¤ï¼ŒApache Flink 1.11.0 æ–°åŠŸèƒ½æ­£å¼ä»‹ç» é‡ç£…ï¼Apache Flink 1.11 ä¼šæœ‰å“ªäº›ç‰›é€¼çš„åŠŸèƒ½ Flink 1.10 æ–°ç‰¹æ€§ç ”ç©¶ ä¿®æ”¹ä»£ç 150ä¸‡è¡Œï¼Apache Flink 1.9.0åšäº†è¿™äº›é‡å¤§ä¿®æ”¹ï¼ ã€ŠFlink åœ¨å¤§å‚çš„å®è·µä¸åº”ç”¨ã€‹ OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” æºç¨‹â€”â€”å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† æ•°æ®ä»“åº“ã€æ•°æ®åº“çš„å¯¹æ¯”ä»‹ç»ä¸å®æ—¶æ•°ä»“æ¡ˆä¾‹åˆ†äº« åŸºäº Apache Flink çš„ç›‘æ§å‘Šè­¦ç³»ç»Ÿ æ–‡ç«  åŸºäº Apache Flink çš„ç›‘æ§å‘Šè­¦ç³»ç»Ÿ è§†é¢‘ å¦‚ä½•åˆ©ç”¨Flink Rest API ç›‘æ§æ»¡è¶³ç”Ÿäº§ç¯å¢ƒéå¸¸åˆšéœ€çš„éœ€æ±‚ æ— æµé‡ Flink ä½œä¸šå‘Šè­¦ Apache Flink ç»´è¡¨å…³è”å®æˆ˜ å¦‚ä½•åˆ©ç”¨ Flink å®æ—¶å°†åº”ç”¨ Error æ—¥å¿—å‘Šè­¦ï¼Ÿ Flink æµæ‰¹ä¸€ä½“çš„æŠ€æœ¯æ¶æ„ä»¥åŠåœ¨é˜¿é‡Œ çš„å®è·µ åŸºäº Flink æ­å»ºå®æ—¶ä¸ªæ€§åŒ–è¥é”€å¹³å°ï¼Ÿ åŸºäº Flink å’Œ Drools çš„å®æ—¶æ—¥å¿—å¤„ç† æ–°ä¸€ä»£å¤§æ•°æ®å®æ—¶æ•°æ®æ¶æ„åˆ°åº•é•¿å•¥æ · ä» Spark Streaming åˆ° Apache Flinkï¼šbilibili å®æ—¶å¹³å°çš„æ¶æ„ä¸å®è·µ æ—¥å‡ä¸‡äº¿æ¡æ•°æ®å¦‚ä½•å¤„ç†ï¼Ÿçˆ±å¥‡è‰ºå®æ—¶è®¡ç®—å¹³å°è¿™æ ·åš Flink æµæ‰¹ä¸€ä½“çš„å®è·µä¸æ¢ç´¢ è¶£å¤´æ¡åŸºäº Flink+ClickHouse æ„å»ºå®æ—¶æ•°æ®åˆ†æå¹³å° Flink ç»´è¡¨å…³è”å¤šç§æ–¹æ¡ˆå¯¹æ¯” ç¾å›¢ç‚¹è¯„åŸºäº Flink çš„å®æ—¶æ•°ä»“å¹³å°å®è·µ åŸºäº Apache Flink çš„å¤§è§„æ¨¡å‡†å®æ—¶æ•°æ®åˆ†æå¹³å° é˜¿é‡Œå·´å·´ Flink è¸©å‘ç»éªŒï¼šå¦‚ä½•å¤§å¹…é™ä½ HDFS å‹åŠ›ï¼Ÿ 58 åŒåŸåŸºäº Flink çš„åƒäº¿çº§å®æ—¶è®¡ç®—å¹³å°æ¶æ„å®è·µ åŸºäº Flink æ„å»ºå…³è”åˆ†æå¼•æ“çš„æŒ‘æˆ˜å’Œå®è·µ æ»´æ»´å®æ—¶è®¡ç®—å‘å±•ä¹‹è·¯åŠå¹³å°æ¶æ„å®è·µ å¦‚ä½•ä½¿ç”¨ Flink æ¯å¤©å®æ—¶å¤„ç†ç™¾äº¿æ¡æ—¥å¿—ï¼Ÿ ç¾å›¢ç‚¹è¯„åŸºäº Flink çš„å®æ—¶æ•°ä»“å»ºè®¾å®è·µ åŸºäºKafka+Flink+Redisçš„ç”µå•†å¤§å±å®æ—¶è®¡ç®—æ¡ˆä¾‹ Flink åœ¨å°çº¢ä¹¦æ¨èç³»ç»Ÿä¸­çš„åº”ç”¨ Flink å®æˆ˜ | è´å£³æ‰¾æˆ¿åŸºäºFlinkçš„å®æ—¶å¹³å°å»ºè®¾ Flink åœ¨è¶£å¤´æ¡çš„åº”ç”¨ä¸å®è·µ ã€ŠFlink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹ä¸“æ éƒ¨åˆ†æ–‡ç« å› ä¸ºè¿™ä¸ªä¸“æ æ˜¯ä¸€å¼€å§‹è‡ªå·±å†™çš„ï¼Œå½“æ—¶è¿˜æ²¡æœ‰å’Œä»»ä½•ä¸€å®¶å…¬å¸ç­¾åè®®ï¼Œæ‰€ä»¥å½“æ—¶å°±æ˜¯æƒ³æ”¾åœ¨çŸ¥è¯†æ˜Ÿçƒçš„ï¼Œåé¢æœ‰å…¬å¸è”ç³»ï¼Œæ‰æœ‰å®Œæ•´çš„ä¸“æ æ–‡ç« è¯ç”Ÿå‡ºæ¥ï¼Œå¦åˆ™è‡ªå·±ä¹Ÿä¸çŸ¥é“æ˜¯å¦å¯ä»¥åšæŒå†™å®Œè¿™ä¸ªç³»åˆ—ï¼Œæ‰€ä»¥åé¢åˆä½œå¼€è¿™ä¸ªä¸“æ åæ–°å†™çš„æ–‡ç« å°±æ²¡æ”¾åœ¨æ˜Ÿçƒäº†ï¼Œå› ä¸ºç­¾äº†åˆåŒçš„ï¼Œæ˜¯ä¸èƒ½å¤Ÿåœ¨å…¶ä»–å¹³å°å…¬å¼€çš„ï¼Œè¿™é‡Œå¸Œæœ›å¤§å®¶å¯ä»¥ä½“è°…ï¼Œä½†æ˜¯å·²ç»æ—©å…¬å¼€çš„ä¾æ—§ä¸ä¼šåˆ é™¤æ‰çš„ï¼Œæœ‰å¦‚ä¸‹è¿™äº›æ–‡ç« ï¼š å¤§æ•°æ®é‡ç£…ç‚¸å¼¹å®æ—¶è®¡ç®—æ¡†æ¶Flink ã€Šå¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—å¼•æ“ Flinkã€‹å¼€ç¯‡è¯ é¢„å¤‡ç¯‡ï¼š ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—æ¡†æ¶ Flink åˆ«å†å‚»å‚»çš„åˆ†ä¸æ¸…å¤§æ•°æ®æ¡†æ¶Flinkã€Blinkã€Spark Streamingã€Structured Streamingå’ŒStormä¹‹é—´çš„åŒºåˆ«äº† Flink ç¯å¢ƒå‡†å¤‡çœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† ä¸€æ–‡è®²è§£ä» Flink ç¯å¢ƒå®‰è£…åˆ°æºç ç¼–è¯‘è¿è¡Œ é€šè¿‡ WordCount ç¨‹åºæ•™ä½ å¿«é€Ÿå…¥é—¨ä¸Šæ‰‹ Flink Flink å¦‚ä½•å¤„ç† Socket æ•°æ®åŠåˆ†æå®ç°è¿‡ç¨‹ Flink job å¦‚ä½•åœ¨ Standaloneã€YARNã€Mesosã€K8S ä¸Šéƒ¨ç½²è¿è¡Œï¼Ÿ åŸºç¡€ç¯‡ : Flink æ•°æ®è½¬æ¢å¿…é¡»ç†Ÿæ‚‰çš„ç®—å­ï¼ˆOperator) Flink ä¸­ Processing Timeã€Event Timeã€Ingestion Time å¯¹æ¯”åŠå…¶ä½¿ç”¨åœºæ™¯åˆ†æ å¦‚ä½•ä½¿ç”¨ Flink Window åŠ Window åŸºæœ¬æ¦‚å¿µä¸å®ç°åŸç† å¦‚ä½•ä½¿ç”¨ DataStream API æ¥å¤„ç†æ•°æ®ï¼Ÿ Flink WaterMark è¯¦è§£åŠç»“åˆ WaterMark å¤„ç†å»¶è¿Ÿæ•°æ® Flink å¸¸ç”¨çš„ Source å’Œ Sink Connectors ä»‹ç» Flink æœ€æœ€æœ€å¸¸ä½¿ç”¨çš„ Connector â€”â€” Kafka è¯¥å¦‚ä½•ä½¿ç”¨ï¼Ÿ å¦‚ä½•è‡ªå®šä¹‰ Flink Connectorsï¼ˆSource å’Œ Sinkï¼‰ï¼Ÿ Flink è¯»å– Kafka æ•°æ®åå¦‚ä½•æ‰¹é‡å†™å…¥åˆ° MySQLï¼Ÿ ä¸€æ–‡äº†è§£å¦‚ä½•ä½¿ç”¨ Flink Connectors â€”â€” ElasticSearchï¼Ÿ ä¸€æ–‡äº†è§£å¦‚ä½•ä½¿ç”¨ Flink Connectors â€”â€” HBaseï¼Ÿ å¦‚ä½•åˆ©ç”¨ Redis å­˜å‚¨ Flink è®¡ç®—åçš„æ•°æ®ï¼Ÿ ã€ŠFlink æºç è§£ææ–‡ç« ã€‹ Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ Flink æºç è§£æ â€”â€” Flink æºç çš„ç»“æ„å’Œå…¶å¯¹åº”çš„åŠŸèƒ½ç‚¹ Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ Flink æºç è§£æ â€”â€” standalonesession æ¨¡å¼å¯åŠ¨æµç¨‹ Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ Flink æºç è§£æ â€”â€” Flink-metrics-core æºç è§£æ Flink æºç è§£æ â€”â€” Flink-metrics-datadog æºç è§£æ Flink æºç è§£æ â€”â€” Flink-metrics-dropwizard æºç è§£æ Flink æºç è§£æ â€”â€” Flink-metrics-graphite æºç è§£æ Flink æºç è§£æ â€”â€” Flink-metrics-influxdb æºç è§£æ Flink æºç è§£æ â€”â€” Flink-metrics-jmx æºç è§£æ Flink æºç è§£æ â€”â€” Flink-metrics-slf4j æºç è§£æ Flink æºç è§£æ â€”â€” Flink-metrics-statsd æºç è§£æ Flink æºç è§£æ â€”â€” Flink-metrics-prometheus æºç è§£æ Flink æºç è§£æ â€”â€” Flink æ³¨è§£æºç è§£æ Flink æºç è§£æ â€”â€” Flink Metrics å®æˆ˜ ã€ŠFlink è‡ªå·±å½•åˆ¶è¿‡çš„è§†é¢‘ã€‹ Flink æ•´åˆ Apollo åŠ¨æ€æ›´æ–°é…ç½® Flink æ•´åˆ Nacos åŠ¨æ€æ›´æ–°é…ç½® Flink ä¸“æ çš„å¼€ç¯‡è¯ ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—æ¡†æ¶ Flink åˆ«å†å‚»å‚»çš„åˆ†ä¸æ¸…å¤§æ•°æ®æ¡†æ¶ Flinkã€Blinkã€Spark Streamingã€Structured Streaming å’Œ Storm ä¹‹é—´çš„åŒºåˆ«äº† Flinkç¯å¢ƒå‡†å¤‡ Flinkç¯å¢ƒå®‰è£… Flink WordCount ç¨‹åºå…¥é—¨ä¸Šæ‰‹åŠåˆ†æå®ç°è¿‡ç¨‹ Flink å¦‚ä½•å¤„ç† Socket æ•°æ®åŠåˆ†æå®ç°è¿‡ç¨‹ Flink ä¸­ Processing Timeã€Event Timeã€Ingestion Time å¯¹æ¯”åŠå…¶ä½¿ç”¨åœºæ™¯åˆ†æ å¦‚ä½•ä½¿ç”¨ Flink Window åŠ Window åŸºæœ¬æ¦‚å¿µä¸å®ç°åŸç† Flink_Windowç»„ä»¶æ·±åº¦è®²è§£å’Œå¦‚ä½•è‡ªå®šä¹‰Window Flink è¯»å– Kafka å•†å“æ•°æ®åå†™å…¥åˆ° Redis åŸºäº Apache Flink çš„ç›‘æ§å‘Šè­¦ç³»ç»Ÿ Flinkæºç è§£æ01â€”â€”æºç ç¼–è¯‘è¿è¡Œ Flinkæºç è§£æ02â€”â€”æºç ç»“æ„ä¸€è§ˆ Flinkæºç è§£æ03â€”â€”æºç é˜…è¯»è§„åˆ’ Flinkæºç è§£æ04â€”â€”flink-exampleæ¨¡å—æºç ç»“æ„ Flinkæºç è§£æ05â€”â€”flink-exampleæ¨¡å—æºç åˆ†æ Flinkæºç è§£æ06â€”â€”flink-example-streaming å¼‚æ­¥IOæºç åˆ†æ Flinkæºç è§£æ07â€”â€”flink-example-streaming SideOutputæºç åˆ†æ Flinkæºç è§£æ08â€”â€”flink-example-streaming Socketæºç åˆ†æ Flinkæºç è§£æ09â€”â€”flink-example-streaming windowå’Œjoinæºç åˆ†æ Flinkæºç è§£æ10â€”â€”flink-example-streaming æºç åˆ†ææ€»ç»“ Flinkåˆ°åº•æ˜¯å¦å¯ä»¥åŠ¨æ€æ›´æ”¹checkpointé…ç½® Flink é€šè¿‡ DDL å’Œ SQL æ¥å®ç°è¯»å– Kafka æ•°æ®å¹¶å¤„ç†åå°†æ•°æ®å†™å› Kafka Flink SQL å®æˆ˜â€”â€”è¯»å–Kafkaæ•°æ®å¤„ç†åå†™å…¥ ElasticSearch 6 å’Œ 7 ä¸¤ç§ç‰ˆæœ¬ å…¶ä»–èµ„æºä¸‹è½½ Flink Forward Asia 2019 çš„ PPTå’Œè§†é¢‘ä¸‹è½½ Flink Forward 2020 PPT ä¸‹è½½ å®æ—¶è®¡ç®—å¹³å°æ¶æ„ï¼ˆä¸Šï¼‰ å®æ—¶è®¡ç®—å¹³å°æ¶æ„ï¼ˆä¸‹ï¼‰ åŸºäºFlinkå®ç°çš„å•†å“å®æ—¶æ¨èç³»ç»Ÿ Flink1.8å­¦ä¹ è·¯çº¿ Kafka å­¦ä¹ æ–‡ç« å’Œè§†é¢‘ æ•°æ®åˆ†ææŒ‡å— TimeoutException The heartbeat of TaskManager Flink on RocksDB å‚æ•°è°ƒä¼˜æŒ‡å— 2020æœ€æ–°Javaé¢è¯•é¢˜åŠç­”æ¡ˆ ä»¥ä¸šåŠ¡ä¸ºæ ¸å¿ƒçš„ä¸­å°ä½“ç³»å»ºè®¾ Skip Listâ€“è·³è¡¨(å…¨ç½‘æœ€è¯¦ç»†çš„è·³è¡¨æ–‡ç« æ²¡æœ‰ä¹‹ä¸€) Stream Processing with Apache Flink å‡å¦‚æˆ‘æ˜¯é¢è¯•å®˜ï¼Œæˆ‘ä¼šé—®ä½ è¿™äº›é—®é¢˜ï¼Œè¯·æ¥æ‹› YARN è¿è¡Œæœºåˆ¶åˆ†æ ä¼ä¸šå¤§æ•°æ®å¹³å°ä»“åº“æ¶æ„å»ºè®¾æ€è·¯ é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ åè¡€ä¹‹ä½œ | æµç³»ç»ŸSpark/Flink/Kafka/DataFlowç«¯åˆ°ç«¯ä¸€è‡´æ€§å®ç°å¯¹æ¯” å¦å¤–å°±æ˜¯æ˜Ÿçƒé‡Œå¯ä»¥å‘æˆ‘æé—®ï¼Œæˆ‘çœ‹åˆ°é—®é¢˜ä¼šåŠæ—¶å›ç­”çš„ï¼Œå‘ç°æé—®çš„è¿˜æ˜¯æ¯”è¾ƒå°‘ï¼Œæƒ³æƒ³å½“åˆå°±è¯¥è¿˜æ˜¯è¦æ‰€æœ‰çš„éƒ½ä»˜è´¹æ‰èƒ½è¿›ï¼Œå…è´¹è¿›çš„å°±ä¼šè®©ä½ ä¸çæƒœè‡ªå·±ä»˜å‡ºçš„é’±ğŸ’°ï¼Œè‡ªå·±ä¹Ÿä¸ä¼šæŒç»­è·Ÿç€ä¸€ç›´å­¦ä¹ ä¸‹å»ã€‚åé¢æˆ‘ä¼šæ ¹æ®æé—®æƒ…å†µæŠŠé•¿æœŸæ½œæ°´ä¸”å½“åˆæ˜¯æ²¡ä»˜è´¹çš„ç§»é™¤æ‰ï¼è¿˜æœ‰å°±æ˜¯ç¾¤é‡Œçš„ä¸€äº›é—®é¢˜è§£ç­”ä¼šåŒæ­¥åˆ°è¿™é‡Œæ²‰æ·€ä¸‹æ¥ï¼å¦‚æœä½ å¯¹è¿™äº›é—®é¢˜è¿˜æœ‰æ›´å¥½çš„è§£ç­”ä¹Ÿæ¬¢è¿æå‡ºä½ çš„å›ç­”ï¼Œå¦‚æœè§‰å¾—æ£’çš„è¯æˆ‘ä¼šè¿›è¡Œä¸€å®šé¢åº¦çš„æ‰“èµï¼æ‰“èµåŒ…æ‹¬ä½†ä¸é™åˆ¶äºï¼š é«˜è´¨é‡çš„é—®é¢˜ å­¦ä¹ èµ„æ–™èµ„æºåˆ†äº« é—®é¢˜å…¨é¢çš„è§£ç­” åˆ†äº«è‡ªå·±çš„å»ºè®® å¥½å¥½åšå¥½è¿™å‡ ç‚¹ï¼Œè‚¯å®šä¼šæŠŠå…¥çŸ¥è¯†æ˜Ÿçƒçš„é’±èµšåˆ°ï¼ä¸ºä»€ä¹ˆè¦åšä¸€ä¸ªè¿™æ ·çš„ Flink çŸ¥è¯†æ˜Ÿçƒï¼Ÿ å¸®åŠ©ä»–äººæˆé•¿å°±æ˜¯è‡ªå·±åœ¨æˆé•¿ ä¸»åŠ¨ä¿ƒä½¿è‡ªå·±å»æ·±å…¥è¿™é—¨æŠ€æœ¯ï¼ˆå¿ƒé‡Œæ€»è§‰å¾—è¦å¯¹å¾—èµ·ä»˜è´¹ç©å®¶ï¼‰ çœŸçš„æƒ³é‡åˆ°é‚£ä¹ˆä¸€ä¸¤ä¸ªäººå¯ä»¥ä¸€ç›´å¥½å¥½å­¦ä¹ ä¸‹å»ï¼ˆå­¦ä¹ çœŸç‰¹ä¹ˆæ˜¯å­¤ç‹¬çš„ï¼Œä¸€ä¸ªäººå­¦ä¹ ç¡®å®é‡åˆ°çš„å‘å¾ˆå¤šï¼Œæ•ˆç‡è‚¯å®šä¹Ÿä½ç‚¹ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°çš„è¯ï¼Œé‚£ä¹ˆè¿˜æ˜¯æˆ‘è‡ªå·±çš„é‚£å¥è¯ï¼šå‘è¦è‡ªå·±ä¸€ä¸ªä¸ªå¡«ï¼Œè·¯è¦è‡ªå·±ä¸€æ­¥æ­¥èµ°ï¼ï¼‰ ä¸€ä¸ªäººèµ°çš„å¿«ä¸€äº›ï¼Œä¸€ç¾¤äººèµ°çš„è¿œä¸€äº›ï¼Œæ¬¢è¿æ‰«ç ä¸Šé¢çš„äºŒç»´ç åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼Œæˆ‘ä»¬ä¸€èµ·å‘å‰ï¼","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"å®æ—¶è®¡ç®—","slug":"å®æ—¶è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/å®æ—¶è®¡ç®—/"}]},{"title":"Flink 1.11 æ—¥å¿—è¯¥å¦‚ä½•é…ç½®ï¼Ÿ","date":"2020-08-01T16:00:00.000Z","path":"2020/08/02/flink-1.11-log/","text":"Flink 1.11 æ—¥å¿—å‡çº§åˆ°äº† Log4j2ï¼Œå¹¶ä¸” Web UI å¢å¼ºäº†åŠŸèƒ½ã€‚ Flink 1.11 ä¹‹å‰åœ¨ Flink 1.11 ä¹‹å‰ï¼ŒFlink ä½¿ç”¨çš„æ—¥å¿—æ˜¯ Log4jï¼Œé…ç½®æ–‡ä»¶ log4j.properties ä¸­çš„å†…å®¹å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324# This affects logging for both user code and Flinklog4j.rootLogger=INFO, file# Uncomment this if you want to _only_ change Flink&apos;s logging#log4j.logger.org.apache.flink=INFO# The following lines keep the log level of common libraries/connectors on# log level INFO. The root logger does not override this. You have to manually# change the log levels here.log4j.logger.akka=INFOlog4j.logger.org.apache.kafka=INFOlog4j.logger.org.apache.hadoop=INFOlog4j.logger.org.apache.zookeeper=INFO# Log all infos in the given filelog4j.appender.file=org.apache.log4j.FileAppenderlog4j.appender.file.file=$&#123;log.file&#125;log4j.appender.file.append=falselog4j.appender.file.layout=org.apache.log4j.PatternLayoutlog4j.appender.file.layout.ConversionPattern=%d&#123;yyyy-MM-dd HH:mm:ss,SSS&#125; %-5p %-60c %x - %m%n# Suppress the irrelevant (wrong) warnings from the Netty channel handlerlog4j.logger.org.apache.flink.shaded.akka.org.jboss.netty.channel.DefaultChannelPipeline=ERROR, file è¯¥é…ç½®æ–‡ä»¶ä¼šå°† JobManager å’Œ TaskManager çš„æ—¥å¿—åˆ†åˆ«æ‰“å°åœ¨ä¸åŒçš„æ–‡ä»¶ä¸­ï¼Œæ¯ä¸ªæ–‡ä»¶çš„æ—¥å¿—å¤§å°ä¸€ç›´ä¼šå¢åŠ ï¼Œå¦‚æœæƒ³é…ç½®æ—¥å¿—æ–‡ä»¶æŒ‰å¤§å°æ»šåŠ¨çš„è¯å¯ä»¥ä½¿ç”¨ RollingFileAppenderï¼Œåˆ™è¦å°†é…ç½®æ–‡ä»¶æ”¹æˆå¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425# This affects logging for both user code and Flinklog4j.rootLogger=INFO, RFA # Uncomment this if you want to _only_ change Flink&apos;s logging#log4j.logger.org.apache.flink=INFO # The following lines keep the log level of common libraries/connectors on# log level INFO. The root logger does not override this. You have to manually# change the log levels here.log4j.logger.akka=INFOlog4j.logger.org.apache.kafka=INFOlog4j.logger.org.apache.hadoop=INFOlog4j.logger.org.apache.zookeeper=INFO log4j.appender.RFA=org.apache.log4j.RollingFileAppenderlog4j.appender.RFA.File=$&#123;log.file&#125;log4j.appender.RFA.MaxFileSize=256MBlog4j.appender.RFA.Append=truelog4j.appender.RFA.MaxBackupIndex=10log4j.appender.RFA.layout=org.apache.log4j.PatternLayoutlog4j.appender.RFA.layout.ConversionPattern=%d&#123;yyyy-MM-dd HH:mm:ss,SSS&#125; %t %-5p %-60c %x - %m%n # Suppress the irrelevant (wrong) warnings from the Netty channel handlerlog4j.logger.org.apache.flink.shaded.akka.org.jboss.netty.channel.DefaultChannelPipeline=ERROR, RFA ä¸ºä»€ä¹ˆè¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹å°†æ—¥å¿—æ–‡ä»¶æ”¹æˆæŒ‰ç…§å¤§å°æ»šåŠ¨å‘¢ï¼Ÿ æ— éæ˜¯åœ¨ç”Ÿäº§æƒ…å†µä¸‹ï¼Œæµæ•°æ®æ˜¯éå¸¸å¤§çš„ï¼Œæœ‰çš„æ—¶å€™è‡ªå·±å¯èƒ½ä¼šé€šè¿‡ print() æ‰“å°å‡ºæ¥æµæ•°æ®è¿›æ¥éªŒè¯ç»“æœï¼Œæœ‰çš„æ—¶å€™å¯èƒ½æ˜¯æ‰“å°çš„æ—¥å¿—è®°å½•åš debug ç”¨ï¼Œç„¶ååˆ°ç”Ÿäº§å¿˜è®°å…³äº†ï¼Œç»“æœåˆ°ç”Ÿäº§å°±å…¨éƒ¨å°†æµæ•°æ®æ‰“å°å‡ºæ¥ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå°±ä¼šå¯¼è‡´ TaskManager çš„æ—¥å¿—æ–‡ä»¶ä¼šéå¸¸å¤§ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ‰“å¼€ Web UI æŸ¥çœ‹å¯èƒ½å°±ä¼šå¾ˆå¡ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºå•¥æˆ‘ä»¬æœ‰æ—¶å€™æ‰“å¼€ Web UI æŸ¥çœ‹æ—¥å¿—çš„æ—¶å€™ï¼Œéå¸¸å¡é¡¿ï¼ŒåŠ è½½ä¸å‡ºæ¥çš„åŸå› äº†ï¼Œä¸»è¦åŸå› å°±æ˜¯æ—¥å¿—æ–‡ä»¶å¤ªå¤§å¯¼è‡´çš„ã€‚ å½“ç„¶æœ‰çš„åŒå­¦å¯èƒ½ä¼šæƒ³ç€å°† Flink ä½œä¸šçš„æ—¥å¿—å‘åˆ° Kafka åšç»Ÿä¸€çš„æ”¶é›†ï¼Œç„¶ååšä¸€äº›æ—¥å¿—åˆ†æå‘Šè­¦å’Œå†æ¶ˆè´¹å‘åˆ° ElasticSearch ç­‰å»åšæ—¥å¿—æœç´¢ï¼Œå¦‚æœæ˜¯å‘åˆ° Kafkaï¼Œå¯ä»¥ä½¿ç”¨ KafkaLog4jAppenderï¼Œæ—¥å¿—æ–‡ä»¶é…ç½®å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930# This affects logging for both user code and Flinklog4j.rootLogger=INFO, kafka# Uncomment this if you want to _only_ change Flink&apos;s logging#log4j.logger.org.apache.flink=INFO# The following lines keep the log level of common libraries/connectors on# log level INFO. The root logger does not override this. You have to manually# change the log levels here.log4j.logger.akka=INFOlog4j.logger.org.apache.kafka=INFOlog4j.logger.org.apache.hadoop=INFOlog4j.logger.org.apache.zookeeper=INFO# log send to kafkalog4j.appender.kafka=org.apache.kafka.log4jappender.KafkaLog4jAppenderlog4j.appender.kafka.brokerList=localhost:9092log4j.appender.kafka.topic=flink_logslog4j.appender.kafka.compressionType=nonelog4j.appender.kafka.requiredNumAcks=0log4j.appender.kafka.syncSend=falselog4j.appender.kafka.layout=org.apache.log4j.PatternLayoutlog4j.appender.kafka.layout.ConversionPattern=%d&#123;yyyy-MM-dd HH:mm:ss&#125; %-5p %c&#123;1&#125;:%L - %m%nlog4j.appender.kafka.level=INFO# Suppress the irrelevant (wrong) warnings from the Netty channel handlerlog4j.logger.org.apache.flink.shaded.akka.org.jboss.netty.channel.DefaultChannelPipeline=ERROR, kafka Flink 1.11åœ¨ Flink 1.11 ä¸­ï¼Œå°† Log4j å‡çº§åˆ°äº† Log4j2ï¼Œå¯ä»¥é€šè¿‡æŸ¥çœ‹ FLINK-15672 å¯ä»¥çŸ¥é“å˜æ›´çš„æ–‡ä»¶å¾ˆå¤šï¼Œ æ–°ç‰ˆæœ¬çš„æ—¥å¿—é…ç½®æ–‡ä»¶è¿˜æ˜¯å« log4j.propertiesï¼Œé…ç½®å¦‚ä¸‹æ‰€ç¤ºï¼Œä¸æ¸…æ¥šä¸ºå•¥ FLINK-15672 ä»£ç æäº¤ä¸­æ”¹äº†å¾ˆå¤šåœ°æ–¹çš„é…ç½®æ–‡ä»¶åä¸º log4j2.propertiesï¼Œä½†æ˜¯ Flink æœ€åæ‰“åŒ…çš„ conf ç›®å½•ä¸‹è¿˜æ˜¯ä¿æŒå’Œä¹‹å‰ä¸€æ ·çš„æ–‡ä»¶åï¼ŒæŒ‰é“ç†ä¸æ˜¯ä¹Ÿåº”è¯¥è¿›è¡Œæ›´æ”¹æˆ log4j2.properties çš„å—ï¼Ÿ 12345678910111213141516171819202122232425262728293031# This affects logging for both user code and FlinkrootLogger.level = INFOrootLogger.appenderRef.file.ref = MainAppender# Uncomment this if you want to _only_ change Flink&apos;s logging#logger.flink.name = org.apache.flink#logger.flink.level = INFO# The following lines keep the log level of common libraries/connectors on# log level INFO. The root logger does not override this. You have to manually# change the log levels here.logger.akka.name = akkalogger.akka.level = INFOlogger.kafka.name= org.apache.kafkalogger.kafka.level = INFOlogger.hadoop.name = org.apache.hadooplogger.hadoop.level = INFOlogger.zookeeper.name = org.apache.zookeeperlogger.zookeeper.level = INFO# Log all infos in the given fileappender.main.name = MainAppenderappender.main.type = Fileappender.main.append = falseappender.main.fileName = $&#123;sys:log.file&#125;appender.main.layout.type = PatternLayoutappender.main.layout.pattern = %d&#123;yyyy-MM-dd HH:mm:ss,SSS&#125; %-5p %-60c %x - %m%n# Suppress the irrelevant (wrong) warnings from the Netty channel handlerlogger.netty.name = org.apache.flink.shaded.akka.org.jboss.netty.channel.DefaultChannelPipelinelogger.netty.level = OFF é»˜è®¤è¿™ä¸ªé…ç½®ä¹Ÿæ˜¯ä¸ä¼šå¯¹æ—¥å¿—æ–‡ä»¶è¿›è¡ŒæŒ‰ç…§å¤§å°æ»šåŠ¨çš„ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬è¦ä¿æŒå’Œä¹‹å‰çš„æ•ˆæœä¸€æ ·ï¼ˆæŒ‰ç…§æ—¥å¿—å¤§å°æ»šåŠ¨æ—¥å¿—æ–‡ä»¶ï¼‰è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿä½ å¯ä»¥æ›´æ”¹é…ç½®æ–‡ä»¶çš„å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š 12345678910111213141516171819202122232425262728293031323334353637# This affects logging for both user code and FlinkrootLogger.level = INFOrootLogger.appenderRef.rolling.ref = RollingFileAppender# Uncomment this if you want to _only_ change Flink&apos;s logging#logger.flink.name = org.apache.flink#logger.flink.level = INFO# The following lines keep the log level of common libraries/connectors on# log level INFO. The root logger does not override this. You have to manually# change the log levels here.logger.akka.name = akkalogger.akka.level = INFOlogger.kafka.name= org.apache.kafkalogger.kafka.level = INFOlogger.hadoop.name = org.apache.hadooplogger.hadoop.level = INFOlogger.zookeeper.name = org.apache.zookeeperlogger.zookeeper.level = INFO# Log all infos in the given rolling fileappender.rolling.name = RollingFileAppenderappender.rolling.type = RollingFileappender.rolling.append = falseappender.rolling.fileName = $&#123;sys:log.file&#125;appender.rolling.filePattern = $&#123;sys:log.file&#125;.%iappender.rolling.layout.type = PatternLayoutappender.rolling.layout.pattern = %d&#123;yyyy-MM-dd HH:mm:ss,SSS&#125; %-5p %-60c %x - %m%nappender.rolling.policies.type = Policiesappender.rolling.policies.size.type = SizeBasedTriggeringPolicyappender.rolling.policies.size.size = 200MBappender.rolling.strategy.type = DefaultRolloverStrategyappender.rolling.strategy.max = 10# Suppress the irrelevant (wrong) warnings from the Netty channel handlerlogger.netty.name = org.apache.flink.shaded.akka.org.jboss.netty.channel.DefaultChannelPipelinelogger.netty.level = OFF å¦‚æœä½ å‡çº§äº†åˆ° 1.11 ç‰ˆæœ¬ï¼Œä¸èƒ½ç»§ç»­å»¶ç”¨ä¹‹å‰ 1.11 ä¹‹å‰çš„é…ç½®çš„é‚£ç§æ—¥å¿—æ–‡ä»¶æ»šåŠ¨çš„é…ç½®äº†ï¼Œéœ€è¦åšç‚¹å˜æ›´ã€‚ä¸Šé¢é…ç½®çš„è¡¨ç¤ºæ—¥å¿—æ–‡ä»¶ä»¥æ¯éš” 200MB ä¼šè¿›è¡Œåˆ‡åˆ†ï¼Œç„¶åæ—¥å¿—åˆ‡åˆ†åçš„æ–‡ä»¶åæ˜¯ ${sys:log.file}.%iï¼Œä»¥æ•°å­—ç»“å°¾ã€‚ 1.11 è¿›è¡Œäº†é…ç½®åšåº¦çš„æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä»ä¸Šé¢å›¾ä¸­å¯ä»¥å‘ç° 1.11 å¯¹äºæŸ¥çœ‹æ—¥å¿—æ¯”ä¹‹å‰å‹å¥½äº†ä¸å°‘ï¼Œå¤šä¸ªæ—¥å¿—æ–‡ä»¶éƒ½æœ‰åˆ—è¡¨å±•ç¤ºï¼Œè€Œä¸å†æ˜¯ä¹‹å‰åªèƒ½æŸ¥çœ‹å•ä¸ªæ—¥å¿—æ–‡ä»¶äº†ã€‚ æ³¨ï¼šä¸ºäº†æ¼”ç¤ºæ—¥å¿—æ–‡ä»¶æ»šåŠ¨çš„æ•ˆæœï¼Œæµ‹è¯•çš„æ—¶å€™è®¾ç½®çš„æ—¥å¿— appender.rolling.policies.size.size æ˜¯ 1KB å…³æ³¨æˆ‘å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ Github ä»£ç ä»“åº“https://github.com/zhisheng17/flink-learning/ ä»¥åè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç éƒ½å°†æ”¾åœ¨è¿™ä¸ªä»“åº“é‡Œï¼ŒåŒ…å«äº†è‡ªå·±å­¦ä¹  flink çš„ä¸€äº› demo å’Œåšå®¢","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"Flink 1.11 Release æ–‡æ¡£è§£è¯»","date":"2020-06-28T16:00:00.000Z","path":"2020/06/29/flink-1.11/","text":"Flink 1.11 å¿«è¦å‘å¸ƒäº†ï¼Œè¿™é‡Œæå‰è§£è¯»ä¸€ä¸‹ Release æ–‡æ¡£ é›†ç¾¤å’Œéƒ¨ç½² æ”¯æŒ Hadoop 3.0 åŠæ›´é«˜çš„ç‰ˆæœ¬ï¼šFlink ä¸å†æä¾›ä»»ä½• flink-shaded-hadoop- ä¾èµ–ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡é…ç½® HADOOP_CLASSPATH ç¯å¢ƒå˜é‡(æ¨è)æˆ–åœ¨ lib æ–‡ä»¶å¤¹ä¸‹æ”¾å…¥ Hadoop ä¾èµ–é¡¹ã€‚å¦å¤– include-hadoop Maven profile ä¹Ÿå·²ç»è¢«ç§»é™¤äº†ã€‚ ç§»é™¤äº† LegacySchedulerï¼šFlink ä¸å†æ”¯æŒ legacy schedulerï¼Œå¦‚æœä½ è®¾ç½®äº† jobmanager.scheduler: legacy å°†ä¸å†èµ·ä½œç”¨å¹¶ä¸”ä¼šæŠ›å‡º IllegalArgumentException å¼‚å¸¸ï¼Œè¯¥å‚æ•°çš„é»˜è®¤å€¼å¹¶ä¸”æ˜¯å”¯ä¸€é€‰é¡¹ä¸º ngã€‚ å°†ç”¨æˆ·ä»£ç çš„ç±»åŠ è½½å™¨å’Œ slot çš„ç”Ÿå‘½å‘¨æœŸè¿›è¡Œç»‘å®šï¼šåªè¦ä¸ºå•ä¸ªä½œä¸šåˆ†é…äº†è‡³å°‘ä¸€ä¸ª slotï¼ŒTaskManager å°±ä¼šé‡æ–°ä½¿ç”¨ç”¨æˆ·ä»£ç çš„ç±»åŠ è½½å™¨ã€‚è¿™ä¼šç¨å¾®æ”¹å˜ Flink çš„æ¢å¤è¡Œä¸ºï¼Œä»è€Œä¸ä¼šé‡æ–°åŠ è½½é™æ€å­—æ®µã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œå¯ä»¥å¤§å¤§å‡è½»å¯¹ JVM metaspace çš„å‹åŠ›ã€‚ slave æ–‡ä»¶é‡å‘½åä¸º workersï¼šå¯¹äº Standalone æ¨¡å¼å®‰è£…ï¼Œworker èŠ‚ç‚¹æ–‡ä»¶ä¸å†æ˜¯ slaves è€Œæ˜¯ workersï¼Œä»¥å‰ä½¿ç”¨ start-cluster.sh å’Œ stop-cluster.sh è„šæœ¬çš„è®¾ç½®éœ€è¦é‡å‘½åè¯¥æ–‡ä»¶ã€‚ å®Œå–„ Flink å’Œ Docker çš„é›†æˆï¼š Dockerfiles æ–‡ä»¶æ ·ä¾‹å’Œ build.sh Docker é•œåƒæ–‡ä»¶éƒ½ä» Flink GitHub ä»“åº“ä¸­ç§»é™¤äº†ï¼Œè¿™äº›ç¤ºä¾‹ç¤¾åŒºä¸å†æä¾›ï¼Œå› æ­¤ flink-contrib/docker-flink ã€ flink-container/docker å’Œ flink-container/kubernetes æ¨¡å—éƒ½å·²åˆ é™¤äº†ã€‚ç›®å‰ä½ å¯ä»¥é€šè¿‡æŸ¥çœ‹ Flink Docker integration å®˜æ–¹æ–‡æ¡£å­¦ä¼šå¦‚ä½•ä½¿ç”¨å’Œè‡ªå®šä¹‰ Flink Docker é•œåƒï¼Œæ–‡æ¡£ä¸­åŒ…å«äº† docker runã€docker composeã€docker swarm å’Œ standalone Kubernetesã€‚ å†…å­˜ç®¡ç† JobManager ä½¿ç”¨æ–°çš„å†…å­˜æ¨¡å‹ï¼šå¯ä»¥å‚è€ƒ FLIP-116ï¼Œä»‹ç»äº† JobManager æ–°çš„å†…å­˜æ¨¡å‹ï¼Œæä¾›äº†æ–°çš„é…ç½®é€‰é¡¹æ¥æ§åˆ¶ JobManager çš„è¿›ç¨‹å†…å­˜æ¶ˆè€—ï¼Œè¿™ç§æ”¹å˜ä¼šå½±å“ Standaloneã€YARNã€Mesos å’Œ Active Kubernetesã€‚å¦‚æœä½ å°è¯•åœ¨ä¸åšä»»ä½•è°ƒæ•´çš„æƒ…å†µä¸‹é‡ç”¨ä»¥å‰çš„Flink é…ç½®ï¼Œåˆ™æ–°çš„å†…å­˜æ¨¡å‹å¯èƒ½ä¼šå¯¼è‡´ JVM çš„è®¡ç®—å†…å­˜å‚æ•°ä¸åŒï¼Œä»è€Œå¯¼è‡´æ€§èƒ½å‘ç”Ÿå˜åŒ–ç”šè‡³å¤±è´¥ï¼Œå¯ä»¥å‚è€ƒ Migrate Job Manager Memory Configuration æ–‡æ¡£è¿›è¡Œè¿ç§»å˜æ›´ã€‚ jobmanager.heap.size å’Œ jobmanager.heap.mb é…ç½®å‚æ•°å·²ç»è¿‡æœŸäº†ï¼Œå¦‚æœè¿™äº›è¿‡æœŸçš„é€‰é¡¹è¿˜ç»§ç»­ä½¿ç”¨çš„è¯ï¼Œä¸ºäº†ç»´æŒå‘åå…¼å®¹æ€§ï¼Œå®ƒä»¬å°†è¢«è§£é‡Šä¸ºä»¥ä¸‹æ–°é€‰é¡¹ä¹‹ä¸€ï¼š jobmanager.memory.heap.sizeï¼šJVM Heapï¼Œä¸ºäº† Standalone å’Œ Mesos éƒ¨ç½² jobmanager.memory.process.sizeï¼šè¿›ç¨‹æ€»å†…å­˜ï¼Œä¸ºäº†å®¹å™¨éƒ¨ç½²ï¼ˆKubernetes å’Œ YARNï¼‰ ä¸‹é¢ä¸¤ä¸ªé€‰é¡¹å·²ç»åˆ é™¤äº†å¹¶ä¸”ä¸å†èµ·ä½œç”¨äº†ï¼š containerized.heap-cutoff-ratio containerized.heap-cutoff-min JVM å‚æ•°ï¼ŒJobManager JVM è¿›ç¨‹çš„ direct å’Œ metaspace å†…å­˜ç°åœ¨é€šè¿‡ä¸‹é¢ä¸¤ä¸ªå‚æ•°è¿›è¡Œé…ç½®ï¼š jobmanager.memory.off-heap.size jobmanager.memory.jvm-metaspace.size å¦‚æœæ²¡æœ‰æ­£ç¡®é…ç½®æˆ–å­˜åœ¨ç›¸åº”çš„å†…å­˜æ³„æ¼ï¼Œè¿™äº›æ–°çš„é™åˆ¶å¯èƒ½ä¼šäº§ç”Ÿç›¸åº”çš„ OutOfMemoryError å¼‚å¸¸ï¼Œå¯ä»¥å‚è€ƒ OutOfMemoryError æ–‡æ¡£è¿›è¡Œè§£å†³ã€‚ ç§»é™¤è¿‡æœŸçš„mesos.resourcemanager.tasks.memå‚æ•° Table API/SQL Blink planner æˆä¸ºé»˜è®¤çš„ planner æ”¹å˜äº† Table API çš„åŒ…ç»“æ„ï¼šç”±äºåŒ… org.apache.flink.table.api.scala/java ä¸­çš„å„ç§é—®é¢˜ï¼Œè¿™äº›åŒ…ä¸‹çš„æ‰€æœ‰ç±»éƒ½å·²è¿ç§»ã€‚ æ­¤å¤–ï¼Œå¦‚ Flink 1.9 ä¸­æ‰€è¿°ï¼Œscala è¡¨è¾¾å¼å·²ç§»è‡³ org.apache.flink.table.api ã€‚ å¦‚æœä½ ä¹‹å‰ä½¿ç”¨äº†ä¸‹é¢çš„ç±»ï¼š org.apache.flink.table.api.java.StreamTableEnvironment org.apache.flink.table.api.scala.StreamTableEnvironment org.apache.flink.table.api.java.BatchTableEnvironment org.apache.flink.table.api.scala.BatchTableEnvironment å¦‚æœä½ ä¸éœ€è¦è½¬æ¢æˆ DataStream æˆ–è€…ä» DataStream è½¬æ¢ï¼Œé‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨ï¼š org.apache.flink.table.api.TableEnvironment å¦‚æœä½ éœ€è¦è½¬æ¢æˆ DataStream/DataSetï¼Œæˆ–è€…ä» DataStream/DataSet è½¬æ¢ï¼Œé‚£ä¹ˆä½ éœ€è¦å°†ä¾èµ– imports æ”¹æˆï¼š org.apache.flink.table.api.bridge.java.StreamTableEnvironment org.apache.flink.table.api.bridge.scala.StreamTableEnvironment org.apache.flink.table.api.bridge.java.BatchTableEnvironment org.apache.flink.table.api.bridge.scala.BatchTableEnvironment å¯¹äº Scala è¡¨è¾¾å¼ï¼Œä½¿ç”¨ä¸‹é¢çš„ importï¼š org.apache.flink.table.api._ instead of org.apache.flink.table.api.bridge.scala._ å¦‚æœä½ ä½¿ç”¨ Scala éšå¼è½¬æ¢æˆ DataStream/DataSetï¼Œæˆ–è€…ä» DataStream/DataSet è½¬æ¢ï¼Œé‚£ä¹ˆè¯¥å¯¼å…¥ org.apache.flink.table.api.bridge.scala._ ç§»é™¤ StreamTableSink æ¥å£ä¸­çš„ emitDataStream æ–¹æ³•ï¼šè¯¥æ¥å£çš„ emitDataStream æ–¹æ³•å°†ç§»é™¤ ç§»é™¤ BatchTableSink ä¸­çš„ emitDataSet æ–¹æ³•ï¼šå°†è¯¥æ¥å£çš„ emitDataSet æ–¹æ³•é‡å‘½åä¸º consumeDataSet å¹¶ä¸”è¿”å› DataSink çº æ­£ TableEnvironment.execute()å’Œ StreamTableEnvironment.execute() çš„æ‰§è¡Œè¡Œä¸ºï¼šåœ¨æ—©æœŸçš„ç‰ˆæœ¬ï¼Œ TableEnvironment.execute() å’Œ StreamExecutionEnvironment.execute() éƒ½å¯ä»¥è§¦å‘ Table ç¨‹åºå’Œ DataStream ç¨‹åºã€‚ä» Flink 1.11.0 å¼€å§‹ï¼ŒTable ç¨‹åºåªèƒ½ç”± TableEnvironment.execute() è§¦å‘ã€‚å°† Table ç¨‹åºè½¬æ¢ä¸º DataStream ç¨‹åºï¼ˆé€šè¿‡ toAppendStream() æˆ– toRetractStream() æ–¹æ³•ï¼‰åï¼Œåªèƒ½ç”± StreamExecutionEnvironment.execute() è§¦å‘å®ƒã€‚ çº æ­£ ExecutionEnvironment.execute() å’Œ BatchTableEnvironment.execute() çš„æ‰§è¡Œè¡Œä¸ºï¼šåœ¨æ—©æœŸçš„ç‰ˆæœ¬ä¸­ï¼Œ BatchTableEnvironment.execute() å’Œ ExecutionEnvironment.execute() éƒ½å¯ä»¥è§¦å‘ Table å’Œ DataSet åº”ç”¨ç¨‹åºï¼ˆé’ˆå¯¹è€çš„ plannerï¼‰ã€‚ ä» Flink 1.11.0 å¼€å§‹ï¼Œæ‰¹å¤„ç† Table ç¨‹åºåªèƒ½ç”± BatchEnvironment.execute() è§¦å‘ã€‚å°† Table ç¨‹åºè½¬æ¢ä¸ºDataSet ç¨‹åºï¼ˆé€šè¿‡ toDataSet() æ–¹æ³•ï¼‰åï¼Œåªèƒ½ç”± ExecutionEnvironment.execute() è§¦å‘å®ƒã€‚ åœ¨ Row ç±»å‹ä¸­æ·»åŠ äº†æ›´æ”¹æ ‡å¿—ï¼šåœ¨ Row ç±»å‹ä¸­æ·»åŠ äº†ä¸€ä¸ªæ›´æ”¹æ ‡å¿— RowKind é…ç½® é‡å‘½å log4j-yarn-session.properties å’Œ logback-yarn.xml é…ç½®æ–‡ä»¶ï¼šæ—¥å¿—é…ç½®æ–‡ä»¶ log4j-yarn-session.properties å’Œ logback-yarn.xml è¢«é‡å‘½åä¸º log4j-session.properties å’Œ logback-session.xml è€Œä¸”ï¼Œ yarn-session.sh å’Œ kubernet -session.sh ä½¿ç”¨è¿™äº›æ—¥å¿—é…ç½®æ–‡ä»¶ã€‚ çŠ¶æ€ åˆ é™¤å·²å¼ƒç”¨çš„åå°æ¸…ç†å¼€å…³ï¼š StateTtlConfig#cleanupInBackground å·²ç»è¢«åˆ é™¤ï¼Œå› ä¸ºåœ¨ 1.10 ä¸­è¯¥æ–¹æ³•å·²è¢«å¼ƒç”¨ï¼Œå¹¶ä¸”é»˜è®¤å¯ç”¨äº†åå° TTLã€‚ åˆ é™¤ç¦ç”¨ TTL å‹ç¼©è¿‡æ»¤å™¨çš„çš„é€‰é¡¹ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼ŒRocksDB ä¸­çš„ TTL å‹ç¼©è¿‡æ»¤å™¨åœ¨ 1.10 ä¸­æ˜¯å¯ç”¨çš„ï¼Œåœ¨ 1.11+ ä¸­æ€»æ˜¯å¯ç”¨çš„ã€‚å› æ­¤ï¼Œåœ¨ 1.11 ä¸­åˆ é™¤äº†ä»¥ä¸‹é€‰é¡¹å’Œæ–¹æ³•ï¼š state.backend.rocksdb.ttl.compaction.filter.enabled StateTtlConfig#cleanupInRocksdbCompactFilter() RocksDBStateBackend#isTtlCompactionFilterEnabled RocksDBStateBackend#enableTtlCompactionFilter RocksDBStateBackend#disableTtlCompactionFilter (state_backend.py) is_ttl_compaction_filter_enabled (state_backend.py) enable_ttl_compaction_filter (state_backend.py) disable_ttl_compaction_filter æ”¹å˜ StateBackendFactory#createFromConfig çš„å‚æ•°ç±»å‹ï¼šä» Flink 1.11 å¼€å§‹ï¼Œ StateBackendFactory æ¥å£ä¸­çš„ createFromConfigæ–¹æ³•ä¸­çš„å‚æ•°å˜ä¸º ReadableConfig è€Œä¸æ˜¯ Configurationã€‚Configuration ç±»æ˜¯ ReadableConfig æ¥å£çš„å®ç°ç±»ï¼Œå› ä¸ºå®ƒå®ç°äº† ReadableConfig æ¥å£ï¼Œæ‰€ä»¥è‡ªå®šä¹‰ StateBackend ä¹Ÿåº”è¯¥åšç›¸åº”çš„è°ƒæ•´ã€‚ åˆ é™¤è¿‡æœŸçš„ OptionsFactory å’Œ ConfigurableOptionsFactory ç±»ï¼šè¿‡æœŸçš„ OptionsFactory å’Œ ConfigurableOptionsFactory ç±»å·²è¢«åˆ é™¤ã€‚è¯·æ”¹ç”¨ RocksDBOptionsFactory å’Œ ConfigurableRocksDBOptionsFactoryã€‚å¦‚æœä»»ä½•ç±»æ‰©å±•äº†DefaultConfigurableOptionsFactoryï¼Œä¹Ÿè¯·é‡æ–°ç¼–è¯‘ä½ çš„åº”ç”¨ç¨‹åºä»£ç ã€‚ é»˜è®¤æƒ…å†µä¸‹å¯ç”¨ setTotalOrderSeekï¼šä» Flink 1.11 å¼€å§‹ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒRocksDB çš„ ReadOptions å°†å¯ç”¨ setTotalOrderSeek é€‰é¡¹ã€‚è¿™æ˜¯ä¸ºäº†é˜²æ­¢ç”¨æˆ·å¿˜è®°ä½¿ç”¨ optimizeForPointLookupã€‚ä¸ºäº†å‘åå…¼å®¹ï¼Œæˆ‘ä»¬æ”¯æŒé€šè¿‡ RocksDBOptionsFactory è‡ªå®šä¹‰ ReadOptionsã€‚å¦‚æœè§‚å¯Ÿåˆ°æ€§èƒ½ä¸‹é™ï¼Œè¯·å°† setTotalOrderSeek è®¾ç½®ä¸º falseï¼ˆæ ¹æ®æˆ‘ä»¬çš„æµ‹è¯•ï¼Œè¿™ç§æƒ…å†µä¸åº”è¯¥å‘ç”Ÿï¼‰ã€‚ å¢åŠ  state.backend.fs.memory-threshold çš„é»˜è®¤å€¼ï¼š state.backend.fs.memory-threshold çš„é»˜è®¤å€¼å·²ä» 1K å¢åŠ åˆ°20Kï¼Œä»¥é˜²æ­¢åœ¨è¿œç¨‹ FS ä¸Šä¸ºå°çŠ¶æ€åˆ›å»ºå¤ªå¤šå°æ–‡ä»¶ã€‚å¯¹äºé‚£äº› source å¤„é…ç½®å¾ˆå¤šå¹¶è¡Œåº¦æˆ–è€…æœ‰çŠ¶æ€çš„ç®—å­çš„ä½œä¸šå¯èƒ½ä¼šå› æ­¤å˜æ›´è€Œå‡ºç° JM OOM æˆ– RPC message exceeding maximum frame size çš„é—®é¢˜ã€‚å¦‚æœé‡åˆ°æ­¤ç±»é—®é¢˜ï¼Œè¯·æ‰‹åŠ¨å°†é…ç½®è®¾ç½®å› 1Kã€‚ PyFlink å¯¹äºä¸æ”¯æŒçš„æ•°æ®ç±»å‹å°†æŠ›å‡ºå¼‚å¸¸ï¼šå¯ä»¥ä½¿ç”¨ä¸€äº›å‚æ•°ï¼ˆä¾‹å¦‚ï¼Œç²¾åº¦ï¼‰æ¥é…ç½®æ•°æ®ç±»å‹ã€‚ä½†æ˜¯ï¼Œåœ¨ä»¥å‰çš„ç‰ˆæœ¬ä¸­ï¼Œç”¨æˆ·æä¾›çš„ç²¾åº¦æ²¡æœ‰ä»»ä½•æ•ˆæœï¼Œä¼šä½¿ç”¨è¯¥ç²¾åº¦çš„é»˜è®¤å€¼ã€‚ä¸ºäº†é¿å…æ··æ·†ï¼Œä» Flink 1.11 å¼€å§‹ï¼Œå¦‚æœä¸æ”¯æŒè¯¥æ•°æ®ç±»å‹ï¼Œåˆ™å°†å¼•å‘å¼‚å¸¸ã€‚ æ›´æ”¹åŒ…æ‹¬ï¼š TimeType ç²¾åº¦åªèƒ½ä¸º 0 VarBinaryType/VarCharType çš„é•¿åº¦æ˜¯ 0x7fffffff DecimalType å¯é€‰å€¼æ˜¯ 38/18 TimestampType/LocalZonedTimestampType çš„ç²¾åº¦åªèƒ½æ˜¯ 3 DayTimeIntervalType çš„å•ä½æ˜¯ SECOND ï¼ŒfractionalPrecision ç²¾åº¦åªèƒ½ä¸º 3 YearMonthIntervalType çš„å•ä½æ˜¯ MONTH ï¼ŒyearPrecision ç²¾åº¦åªèƒ½ä¸º 2 CharType/BinaryType/ZonedTimestampType ä¸æ”¯æŒ ç›‘æ§ å°†æ‰€æœ‰çš„ MetricReporters è½¬æ¢ä¸º pluginsï¼šFlink çš„æ‰€æœ‰ MetricReporters éƒ½å·²ç»è½¬æ¢ä¸º pluginsï¼Œå®ƒä»¬ä¸å†å­˜æ”¾åœ¨ lib ç›®å½•ä¸‹ï¼ˆè¿™æ ·åšå¯èƒ½ä¼šå¯¼è‡´ä¾èµ–å†²çªï¼‰ï¼Œè€Œåº”è¯¥æ”¾åˆ° /plugins/&lt;some_directory&gt; ç›®å½•ä¸‹ã€‚ æ”¹å˜ DataDog çš„ metrics reporter Counter Metricsï¼šç°åœ¨ DataDog metrics reporter ç¨‹åºå°† Counter æŒ‡æ ‡ä¸ŠæŠ¥ä¸ºæŠ¥å‘Šæ—¶é—´é—´éš”å†…çš„äº‹ä»¶æ•°ï¼Œè€Œä¸æ˜¯æ€»æ•°ï¼Œå°† Counter è¯­ä¹‰ä¸ DataDog æ–‡æ¡£ä¿æŒä¸€è‡´ã€‚ åˆ‡æ¢ Log4j2 ä¸ºé»˜è®¤çš„ï¼šFlink ç°åœ¨é»˜è®¤ä½¿ç”¨ Log4j2ï¼Œå¸Œæœ›æ¢å¤åˆ° Log4j1 çš„ç”¨æˆ·å¯ä»¥åœ¨æ—¥å¿—æ–‡æ¡£ä¸­æ‰¾åˆ°æ“ä½œè¯´æ˜ æ›´æ”¹ JobManager API çš„æ—¥å¿—è¯·æ±‚è¡Œä¸ºï¼šä» JobManager æœåŠ¡ç«¯è¯·æ±‚ä¸€ä¸ªä¸å¯ç”¨çš„ log æˆ–è€… stdout æ–‡ä»¶ç°åœ¨ä¼šè¿”å› 404 çŠ¶æ€ç ï¼Œåœ¨ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œä¼šè¿”å› file unavailable ã€‚ ç§»é™¤ lastCheckpointAlignmentBuffered metricï¼šç°åœ¨ lastCheckpointAlignmentBuffered metric å·²ç»è¢«ç§»é™¤äº†ï¼Œå› ä¸ºåœ¨å‘å‡º Checkpoint barrier ä¹‹åï¼Œä¸Šæ¸¸çš„ä»»åŠ¡ä¸ä¼šå‘é€ä»»ä½•æ•°æ®ï¼Œç›´åˆ°ä¸‹æ¸¸ä¾§å®Œæˆå¯¹é½ä¸ºæ­¢ï¼ŒWebUI ä»ç„¶ä¼šæ˜¾ç¤ºè¯¥å€¼ï¼Œä½†ç°åœ¨å§‹ç»ˆä¸º 0ã€‚ Connectors ç§»é™¤ Kafka 0.8/0.9 Connector ç§»é™¤ ElasticSearch 2.x Connector ç§»é™¤ KafkaPartitioner æ”¹è¿›çš„ fallback æ–‡ä»¶ç³»ç»Ÿï¼Œä»¥åªå¤„ç†ç‰¹å®šçš„æ–‡ä»¶ç³»ç»Ÿ å°† FileSystem#getKind æ–¹æ³•è®¾ç½®è¿‡æœŸçš„ Runtime æµä½œä¸šåœ¨ Checkpoint åŒæ­¥éƒ¨åˆ†å¤±è´¥æ—¶ä¼šç«‹å³å¤±è´¥ï¼šæ— è®ºé…ç½®ä»€ä¹ˆå‚æ•°ï¼ŒCheckpoint åŒæ­¥éƒ¨åˆ†ä¸­çš„å¤±è´¥ï¼ˆå¦‚ç®—å­æŠ›å‡ºå¼‚å¸¸ï¼‰éƒ½å°†ç«‹å³ä½¿å…¶ä»»åŠ¡ï¼ˆå’Œä½œä¸šï¼‰å¤±è´¥ï¼Œä» Flink 1.5 ç‰ˆæœ¬å¼€å§‹ï¼Œå¯ä»¥é€šè¿‡è®¾ç½® setTolerableCheckpointFailureNumber(...) æˆ– setFailTaskOnCheckpointError(...) å‚æ•°æ¥å¿½ç•¥æ­¤ç±»çš„å¤±è´¥ï¼Œç°åœ¨è¿™ä¸¤ä¸ªå‚æ•°åªå½±å“å¼‚æ­¥çš„å¤±è´¥ã€‚ Checkpoint è¶…æ—¶ä¸å†è¢« CheckpointConfig#setTolerableCheckpointFailureNumber å¿½ç•¥ï¼šç°åœ¨å°† Checkpoint è¶…æ—¶è§†ä¸ºæ­£å¸¸çš„ Checkpoint æ•…éšœï¼Œå¹¶æ ¹æ® CheckpointConfigï¼ƒsetTolerableCheckpointFailureNumber é…ç½®çš„å€¼è¿›è¡Œæ£€æŸ¥ã€‚ å„ç§æ¥å£å˜æ›´ ç§»é™¤è¿‡æœŸçš„ StreamTask#getCheckpointLock() ï¼šåœ¨æ–¹æ³•åœ¨ Flink 1.10 ä¸­å·²ç»è®¾ç½®è¿‡æœŸäº†ï¼Œç›®å‰ä¸å†æä¾›è¯¥æ–¹æ³•ã€‚ç”¨æˆ·å¯ä»¥ä½¿ç”¨ MailboxExecutor æ¥æ‰§è¡Œéœ€è¦ä¸ä»»åŠ¡çº¿ç¨‹å®‰å…¨çš„æ“ä½œã€‚ flink-streaming-java æ¨¡å—ä¸å†ä¾èµ– flink-client æ¨¡å—ï¼šä» Flink 1.11.0 å¼€å§‹ï¼Œflink-streaming-java æ¨¡å—ä¸å†ä¾èµ– flink-client æ¨¡å—ï¼Œå¦‚æœä½ é¡¹ç›®ä¾èµ–äº flink-client æ¨¡å—ï¼Œéœ€è¦æ˜¾ç¤ºçš„æ·»åŠ å…¶ä¸ºä¾èµ–é¡¹ã€‚ AsyncWaitOperator æ˜¯å¯é“¾æ¥çš„ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œå°†å…è®¸ AsyncWaitOperator ä¸æ‰€æœ‰ç®—å­é“¾æ¥åœ¨ä¸€èµ·ï¼Œä½†å¸¦æœ‰ SourceFunction çš„ä»»åŠ¡é™¤å¤–ã€‚ æ›´æ”¹äº† ShuffleEnvironment æ¥å£çš„ createInputGates å’Œ createResultPartitionWriters æ–¹æ³•çš„å‚æ•°ç±»å‹ã€‚ CompositeTypeSerializerSnapshot#isOuterSnapshotCompatible æ–¹æ³•æ ‡ç¤ºè¿‡æœŸäº†ã€‚ ç§»é™¤äº†è¿‡æœŸçš„ TimestampExtractorï¼šå¯ä»¥ä½¿ç”¨ TimestampAssigner å’Œ WatermarkStrategiesã€‚ å°† ListCheckpointed æ ‡ç¤ºä¸ºè¿‡æœŸçš„ï¼šå¯ä»¥ä½¿ç”¨ CheckpointedFunction ä½œä¸ºä»£æ›¿ ç§»é™¤äº†è¿‡æœŸçš„ state è¿æ¥æ–¹æ³•ï¼šç§»é™¤äº† RuntimeContext#getFoldingState() ã€ OperatorStateStore#getSerializableListState() å’Œ OperatorStateStore#getOperatorState() è¿æ¥çŠ¶æ€çš„æ–¹æ³•ï¼Œè¿™æ„å‘³ç€åœ¨ 1.10 è¿è¡ŒæˆåŠŸçš„ä»£ç åœ¨ 1.11 ä¸Šæ˜¯è¿è¡Œä¸äº†çš„ã€‚ è¯¦æƒ…å‚è€ƒ https://ci.apache.org/projects/flink/flink-docs-master/release-notes/flink-1.11.html å…³æ³¨æˆ‘å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ ä¸“æ ä»‹ç»é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f Github ä»£ç ä»“åº“https://github.com/zhisheng17/flink-learning/ ä»¥åè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç éƒ½å°†æ”¾åœ¨è¿™ä¸ªä»“åº“é‡Œï¼ŒåŒ…å«äº†è‡ªå·±å­¦ä¹  flink çš„ä¸€äº› demo å’Œåšå®¢ åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€åŸç†ã€å®æˆ˜ã€æ€§èƒ½è°ƒä¼˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"å®æ—¶è®¡ç®—","slug":"å®æ—¶è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/å®æ—¶è®¡ç®—/"}]},{"title":"Apache Flink 1.10 TaskManager å†…å­˜ç®¡ç†ä¼˜åŒ–","date":"2020-05-15T16:00:00.000Z","path":"2020/05/16/flink-taskmanager-memory-model/","text":"Apache Flink 1.10 å¯¹ TaskManager çš„å†…å­˜æ¨¡å‹å’Œ Flink åº”ç”¨ç¨‹åºçš„é…ç½®é€‰é¡¹è¿›è¡Œäº†é‡å¤§å˜æ›´ã€‚è¿™äº›æœ€è¿‘å¼•å…¥çš„æ›´æ”¹åšåˆ°äº†å¯¹å†…å­˜æ¶ˆè€—æä¾›äº†ä¸¥æ ¼çš„æ§åˆ¶ï¼Œä½¿å¾— Flink åœ¨å„ç§éƒ¨ç½²ç¯å¢ƒï¼ˆä¾‹å¦‚ Kubernetesï¼ŒYarnï¼ŒMesosï¼‰æ›´å…·æœ‰é€‚åº”èƒ½åŠ›ï¼Œ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç» Flink 1.10 ä¸­çš„å†…å­˜æ¨¡å‹ã€å¦‚ä½•è®¾ç½®å’Œç®¡ç† Flink åº”ç”¨ç¨‹åºçš„å†…å­˜æ¶ˆè€—ä»¥åŠç¤¾åŒºåœ¨æœ€æ–°çš„ Apache Flink Release ç‰ˆæœ¬ä¸­çš„å˜åŒ–ã€‚ Flink å†…å­˜æ¨¡å‹çš„ä»‹ç»å¯¹ Apache Flink çš„å†…å­˜æ¨¡å‹æœ‰æ¸…æ™°çš„äº†è§£ï¼Œå¯ä»¥ä½¿æ‚¨æ›´æœ‰æ•ˆåœ°ç®¡ç†å„ç§æƒ…å†µä¸‹çš„èµ„æºä½¿ç”¨æƒ…å†µã€‚ ä¸‹å›¾æè¿°äº† Flink ä¸­çš„ä¸»è¦å†…å­˜ç»„ä»¶ï¼š TaskManager è¿›ç¨‹æ˜¯ä¸€ä¸ª JVM è¿›ç¨‹ï¼Œä»è¾ƒé«˜çš„è§’åº¦æ¥çœ‹ï¼Œå®ƒçš„å†…å­˜ç”± JVM Heap å’Œ Off-Heap ç»„æˆã€‚è¿™äº›ç±»å‹çš„å†…å­˜ç”± Flink ç›´æ¥ä½¿ç”¨ï¼Œæˆ–ç”± JVM ç”¨äºå…¶ç‰¹å®šç›®çš„ï¼ˆæ¯”å¦‚å…ƒç©ºé—´ metaspaceï¼‰ã€‚ Flink ä¸­æœ‰ä¸¤ä¸ªä¸»è¦çš„å†…å­˜ä½¿ç”¨è€…ï¼š ç”¨æˆ·ä»£ç ä¸­çš„ä½œä¸š task ç®—å­ Flink æ¡†æ¶æœ¬èº«çš„å†…éƒ¨æ•°æ®ç»“æ„ã€ç½‘ç»œç¼“å†²åŒº (Network Buffers)ç­‰ è¯·æ³¨æ„ï¼Œç”¨æˆ·ä»£ç å¯ä»¥ç›´æ¥è®¿é—®æ‰€æœ‰çš„å†…å­˜ç±»å‹ï¼šJVM å †ã€Direct å’Œ Native å†…å­˜ã€‚å› æ­¤ï¼ŒFlink ä¸èƒ½çœŸæ­£æ§åˆ¶å…¶åˆ†é…å’Œä½¿ç”¨ã€‚ä½†æ˜¯ï¼Œæœ‰ä¸¤ç§ä¾›ä½œä¸š Task ä½¿ç”¨å¹¶ç”± Flink ä¸¥æ ¼æ§åˆ¶çš„ Off-Heap å†…å­˜ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼š Managed Memory (Off-Heap) ç½‘ç»œç¼“å†²åŒº (Network Buffers) ç½‘ç»œç¼“å†²åŒº (Network Buffers) æ˜¯ JVM Direct å†…å­˜çš„ä¸€éƒ¨åˆ†ï¼Œåˆ†é…åœ¨ç®—å­å’Œç®—å­ä¹‹é—´ç”¨äºè¿›è¡Œç”¨æˆ·æ•°æ®çš„äº¤æ¢ã€‚ æ€ä¹ˆå»é…ç½® Flink çš„å†…å­˜åœ¨æœ€æ–° Flink 1.10 ç‰ˆæœ¬ä¸­ï¼Œä¸ºäº†æä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œæ¡†æ¶æä¾›äº†å†…å­˜ç»„ä»¶çš„é«˜çº§å’Œç»†ç²’åº¦è°ƒä¼˜ã€‚åœ¨ TaskManager ä¸­è®¾ç½®å†…å­˜åŸºæœ¬ä¸Šæœ‰ä¸‰ç§é€‰æ‹©ã€‚ å‰ä¸¤ä¸ªï¼ˆä¹Ÿæ˜¯æœ€ç®€å•çš„ï¼‰é€‰æ‹©æ˜¯éœ€è¦ä½ é…ç½®ä»¥ä¸‹ä¸¤ä¸ªé€‰é¡¹ä¹‹ä¸€ï¼Œä»¥ä¾› TaskManager çš„ JVM è¿›ç¨‹ä½¿ç”¨çš„æ€»å†…å­˜ï¼š Total Process Memoryï¼šFlink Java åº”ç”¨ç¨‹åºï¼ˆåŒ…æ‹¬ç”¨æˆ·ä»£ç ï¼‰å’Œ JVM è¿è¡Œæ•´ä¸ªè¿›ç¨‹æ‰€æ¶ˆè€—çš„æ€»å†…å­˜ã€‚ Total Flink Memoryï¼šä»… Flink Java åº”ç”¨ç¨‹åºæ¶ˆè€—çš„å†…å­˜ï¼ŒåŒ…æ‹¬ç”¨æˆ·ä»£ç ï¼Œä½†ä¸åŒ…æ‹¬ JVM ä¸ºå…¶è¿è¡Œè€Œåˆ†é…çš„å†…å­˜ã€‚ å¦‚æœæ˜¯ä»¥ standalone æ¨¡å¼éƒ¨ç½²ï¼Œåˆ™å»ºè®®é…ç½® Total Flink Memoryï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ˜¾å¼å£°æ˜ä¸º Flink åˆ†é…å¤šå°‘å†…å­˜æ˜¯ä¸€ç§å¸¸è§çš„åšæ³•ï¼Œè€Œå¤–éƒ¨ JVM å¼€é”€å´å¾ˆå°‘ã€‚ å¯¹äºåœ¨å®¹å™¨åŒ–ç¯å¢ƒï¼ˆä¾‹å¦‚ Kubernetesï¼ŒYarn æˆ– Mesosï¼‰ä¸­éƒ¨ç½² Flink çš„æƒ…å†µï¼Œå»ºè®®é…ç½® Total Process Memoryï¼Œå› ä¸ºå®ƒè¡¨ç¤ºæ‰€è¯·æ±‚å®¹å™¨çš„æ€»å†…å­˜å¤§å°ï¼Œå®¹å™¨åŒ–ç¯å¢ƒé€šå¸¸ä¸¥æ ¼æ‰§è¡Œæ­¤å†…å­˜é™åˆ¶ã€‚ å…¶ä½™çš„å†…å­˜ç»„ä»¶å°†æ ¹æ®å…¶é»˜è®¤å€¼æˆ–å…¶ä»–å·²é…ç½®çš„å‚æ•°è‡ªåŠ¨è¿›è¡Œè°ƒæ•´ã€‚Flink è¿˜ä¼šæ£€æŸ¥æ•´ä½“ä¸€è‡´æ€§ã€‚ä½ å¯ä»¥åœ¨ç›¸åº”çš„æ–‡æ¡£ä¸­æ‰¾åˆ°æœ‰å…³ä¸åŒå†…å­˜ç»„ä»¶çš„æ›´å¤šä¿¡æ¯ã€‚ æ­¤å¤–ï¼Œä½ å¯ä»¥ä½¿ç”¨ FLIP-49 çš„é…ç½®ç”µå­è¡¨æ ¼å°è¯•ä¸åŒçš„é…ç½®é€‰é¡¹ï¼Œå¹¶æ ¹æ®ä½ çš„æƒ…å†µæ£€æŸ¥ç›¸åº”çš„ç»“æœã€‚ å¦‚æœè¦ä» 1.10 ä¹‹å‰çš„ Flink ç‰ˆæœ¬è¿›è¡Œè¿ç§»ï¼Œæˆ‘ä»¬å»ºè®®ä½ éµå¾ª Flink æ–‡æ¡£çš„è¿ç§»æŒ‡å—ä¸­çš„æ­¥éª¤ã€‚ å…¶ä»–ç»„ä»¶åœ¨é…ç½® Flink çš„å†…å­˜æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ç›¸åº”é€‰é¡¹çš„å€¼å›ºå®šä¸åŒå†…å­˜ç»„ä»¶çš„å¤§å°ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å¤šä¸ªé€‰é¡¹è¿›è¡Œè°ƒæ•´ã€‚ä¸‹é¢æˆ‘ä»¬æä¾›æœ‰å…³å†…å­˜è®¾ç½®çš„æ›´å¤šä¿¡æ¯ã€‚ æŒ‰æ¯”ä¾‹ç»†åˆ† Total Flink Memoryæ­¤æ–¹æ³•å…è®¸æŒ‰æ¯”ä¾‹ç»†åˆ† Total Flink Memoryï¼Œå…¶ä¸­ Managed Memoryï¼ˆå¦‚æœæœªæ˜ç¡®è®¾ç½®ï¼‰å’Œç½‘ç»œç¼“å†²åŒºå¯ä»¥å ç”¨ä¸€éƒ¨åˆ†ã€‚ç„¶åï¼Œå°†å‰©ä½™çš„å†…å­˜åˆ†é…ç»™ Task Heapï¼ˆå¦‚æœæœªæ˜ç¡®è®¾ç½®ï¼‰å’Œå…¶ä»–å›ºå®šçš„ JVM Heap å’Œ Off-Heap ç»„ä»¶ã€‚ä¸‹å›¾æ˜¯è¿™ç§è®¾ç½®çš„ç¤ºä¾‹ï¼š è¯·æ³¨æ„ï¼š Flink ä¼šæ ¡éªŒåˆ†é…çš„ Network Memory å¤§å°åœ¨å…¶æœ€å°å€¼å’Œæœ€å¤§å€¼ä¹‹é—´ï¼Œå¦åˆ™ Flink çš„å¯åŠ¨ä¼šå¤±è´¥ï¼Œæœ€å¤§å€¼å’Œæœ€å°å€¼çš„é™åˆ¶å…·æœ‰é»˜è®¤å€¼ï¼Œè¿™äº›é»˜è®¤å€¼æ˜¯å¯ä»¥è¢«ç›¸åº”çš„é…ç½®é€‰é¡¹è¦†ç›–ã€‚ é€šå¸¸ï¼ŒFlink å°†é…ç½®çš„å æ¯”åˆ†æ•°è§†ä¸ºæç¤ºã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒçœŸæ­£åˆ†é…çš„å€¼å¯èƒ½ä¸å æ¯”åˆ†æ•°ä¸åŒ¹é…ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå°† Total Flink Memory å’Œ Task Heap é…ç½®ä¸ºå›ºå®šå€¼ï¼Œåˆ™ Managed Memory å°†è·å¾—ä¸€å®šæ¯”ä¾‹çš„å†…å­˜ï¼Œè€Œ Network Memory å°†è·å¾—å¯èƒ½ä¸è¯¥æ¯”ä¾‹ä¸å®Œå…¨åŒ¹é…çš„å‰©ä½™å†…å­˜ã€‚ æ§åˆ¶å®¹å™¨å†…å­˜é™åˆ¶çš„æ›´å¤šæç¤ºå †å†…å­˜å’Œ direct å†…å­˜çš„ä½¿ç”¨æ˜¯ç”± JVM ç®¡ç†çš„ã€‚åœ¨ Apache Flink æˆ–å…¶ç”¨æˆ·åº”ç”¨ç¨‹åºä¸­ï¼Œè¿˜æœ‰è®¸å¤šå…¶ä»– native å†…å­˜æ¶ˆè€—çš„å¯èƒ½æ¥æºï¼Œå®ƒä»¬ä¸æ˜¯ç”± Flink æˆ– JVM ç®¡ç†çš„ã€‚é€šå¸¸å¾ˆéš¾æ§åˆ¶å®ƒä»¬çš„é™åˆ¶å¤§å°ï¼Œè¿™ä¼šä½¿è°ƒè¯•æ½œåœ¨çš„å†…å­˜æ³„æ¼å˜å¾—å¤æ‚ã€‚ å¦‚æœ Flink çš„è¿›ç¨‹ä»¥ä¸å—ç®¡ç†çš„æ–¹å¼åˆ†é…äº†è¿‡å¤šçš„å†…å­˜ï¼Œåˆ™åœ¨å®¹å™¨åŒ–ç¯å¢ƒä¸­é€šå¸¸å¯èƒ½å¯¼è‡´ TaskManager å®¹å™¨ä¼šè¢«æ€æ­»ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯èƒ½å¾ˆéš¾ç†è§£å“ªç§ç±»å‹çš„å†…å­˜æ¶ˆè€—å·²è¶…è¿‡å…¶é™åˆ¶ã€‚ Flink 1.10 å¼•å…¥äº†ä¸€äº›ç‰¹å®šçš„è°ƒæ•´é€‰é¡¹ï¼Œä»¥æ¸…æ¥šåœ°è¡¨ç¤ºè¿™äº›ç»„ä»¶ã€‚ å°½ç®¡ Flink ä¸èƒ½å§‹ç»ˆä¸¥æ ¼æ‰§è¡Œä¸¥æ ¼çš„é™åˆ¶å’Œç•Œé™ï¼Œä½†æ­¤å¤„çš„æƒ³æ³•æ˜¯æ˜ç¡®è®¡åˆ’å†…å­˜ä½¿ç”¨æƒ…å†µã€‚ ä¸‹é¢æˆ‘ä»¬æä¾›ä¸€äº›ç¤ºä¾‹ï¼Œè¯´æ˜å†…å­˜è®¾ç½®å¦‚ä½•é˜²æ­¢å®¹å™¨è¶…å‡ºå…¶å†…å­˜é™åˆ¶ï¼š RocksDB çŠ¶æ€ä¸èƒ½å¤ªå¤§ï¼šRocksDB çŠ¶æ€åç«¯çš„å†…å­˜æ¶ˆè€—æ˜¯åœ¨ Managed Memory ä¸­è§£å†³çš„ã€‚ RocksDB é»˜è®¤æƒ…å†µä¸‹éµå®ˆå…¶é™åˆ¶ï¼ˆä»…è‡ª Flink 1.10 èµ·ï¼‰ã€‚ä½ å¯ä»¥å¢åŠ  Managed Memory çš„å¤§å°ä»¥æé«˜ RocksDB çš„æ€§èƒ½ï¼Œä¹Ÿå¯ä»¥å‡å° Managed Memory çš„å¤§å°ä»¥èŠ‚çœèµ„æºã€‚ ç”¨æˆ·ä»£ç æˆ–å…¶ä¾èµ–é¡¹ä¼šæ¶ˆè€—å¤§é‡çš„ off-heap å†…å­˜ï¼šè°ƒæ•´ Task Off-Heap é€‰é¡¹å¯ä»¥ä¸ºç”¨æˆ·ä»£ç æˆ–å…¶ä»»ä½•ä¾èµ–é¡¹åˆ†é…é¢å¤–çš„ direct æˆ– native å†…å­˜ã€‚Flink æ— æ³•æ§åˆ¶ native åˆ†é…ï¼Œä½†å®ƒè®¾ç½®äº† JVM Direct å†…å­˜åˆ†é…çš„é™åˆ¶ã€‚Direct å†…å­˜é™åˆ¶ç”± JVM å¼ºåˆ¶æ‰§è¡Œã€‚ JVM metaspace éœ€è¦é¢å¤–çš„å†…å­˜ï¼šå¦‚æœé‡åˆ° OutOfMemoryErrorï¼šMetaspaceï¼ŒFlink æä¾›äº†ä¸€ä¸ªå¢åŠ å…¶é™åˆ¶çš„é€‰é¡¹ï¼Œå¹¶ä¸” JVM å°†ç¡®ä¿ä¸è¶…è¿‡è¯¥é™åˆ¶ã€‚ JVM éœ€è¦æ›´å¤šå†…éƒ¨å†…å­˜ï¼šæ— æ³•ç›´æ¥æ§åˆ¶æŸäº›ç±»å‹çš„ JVM è¿›ç¨‹åˆ†é…ï¼Œä½†æ˜¯ Flink æä¾›äº† JVM å¼€é”€é€‰é¡¹ã€‚è¿™äº›é€‰é¡¹å…è®¸å£°æ˜é¢å¤–çš„å†…å­˜é‡ï¼Œè¿™äº›å†…å­˜æ˜¯ä¸ºè¿™äº›åˆ†é…æ‰€é¢„æœŸçš„ï¼Œå¹¶ä¸”æœªè¢«å…¶ä»–é€‰é¡¹è¦†ç›–ã€‚ ç»“è®ºæœ€æ–°çš„ Flink ç‰ˆæœ¬ï¼ˆFlink 1.10ï¼‰å¯¹ Flink çš„å†…å­˜é…ç½®è¿›è¡Œäº†ä¸€äº›é‡å¤§æ›´æ”¹ï¼Œä»è€Œå¯ä»¥æ¯”ä»¥å‰æ›´å¥½åœ°ç®¡ç†åº”ç”¨ç¨‹åºå†…å­˜å’Œè°ƒè¯• Flinkã€‚æœªæ¥ JobManager çš„å†…å­˜æ¨¡å‹ä¹Ÿä¼šé‡‡å–ç±»ä¼¼çš„æ›´æ”¹ï¼Œå¯ä»¥å‚è€ƒ FLIP-116ï¼Œå› æ­¤è¯·ç»§ç»­å…³æ³¨å³å°†å‘å¸ƒçš„æ–°ç‰ˆæœ¬ä¸­æ–°å¢çš„åŠŸèƒ½ã€‚å¦‚æœä½ å¯¹ç¤¾åŒºæœ‰ä»»ä½•å»ºè®®æˆ–é—®é¢˜ï¼Œæˆ‘ä»¬å»ºè®®ä½ æ³¨å†Œ Apache Flink é‚®ä»¶åˆ—è¡¨å¹¶å‚ä¸å…¶ä¸­çš„è®¨è®ºã€‚ åšå®¢è‹±æ–‡åœ°å€ï¼šhttps://flink.apache.org/news/2020/04/21/memory-management-improvements-flink-1.10.htmlä½œè€…: Andrey Zagrebinæœ¬æ–‡ç¿»è¯‘ä½œè€…ï¼šzhishengç¿»è¯‘åé¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2020/05/16/flink-taskmanager-memory-model/ å…³æ³¨æˆ‘å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f Github ä»£ç ä»“åº“https://github.com/zhisheng17/flink-learning/ ä»¥åè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç éƒ½å°†æ”¾åœ¨è¿™ä¸ªä»“åº“é‡Œï¼ŒåŒ…å«äº†è‡ªå·±å­¦ä¹  flink çš„ä¸€äº› demo å’Œåšå®¢ åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€å®æˆ˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"å®æ—¶è®¡ç®—","slug":"å®æ—¶è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/å®æ—¶è®¡ç®—/"}]},{"title":"Flink Forward 2020 PPT ä¸‹è½½","date":"2020-05-12T16:00:00.000Z","path":"2020/05/13/flink-forward-2020/","text":"Flink Forward 2020 æ˜¯åœ¨çº¿ä¸Šä¸¾åŠçš„ä¸€æ¬¡ä¼šè®® 1ã€ã€ŠKeynote:Introducing Stateful Functions 2.0: Stream Processing meets Serverless Applicationsã€‹Stephan Ewen â€“ Apache Flink PMC,Ververica Co-founder, CTO è®²è§£å˜‰å®¾ï¼šæé’°ï¼ˆç»é¡¶ï¼‰ â€“ Apache Flink Committerï¼ŒApache Flink 1.10 Release Managerï¼Œé˜¿é‡Œå·´å·´é«˜çº§æŠ€æœ¯ä¸“å®¶ 2ã€ã€ŠKeynote:Stream analytics made real with Pravega and Apache Flinkã€‹ Srikanth Satya â€“ VP of Engineering at DellEMC è®²è§£å˜‰å®¾ï¼šæ»•æ˜± â€“ DellEMC æŠ€æœ¯æ€»ç›‘ 3ã€ã€ŠKeynote:Apache Flink â€“ Completing Clouderaâ€™s End to End Streaming Platformã€‹ Marton Balassi â€“ Apache Flink PMC ï¼ŒSenior Solutions Architect at Cloudera Joe Witt â€“ VP of Engineering at Cloudera è®²è§£å˜‰å®¾ï¼šæ¨å…‹ç‰¹ï¼ˆé²å°¼ï¼‰ â€“ Apache Member, Apache Flink PMC, é˜¿é‡Œå·´å·´é«˜çº§æŠ€æœ¯ä¸“å®¶ 4ã€ã€ŠKeynote:The Evolution of Data Infrastructure at Splunkã€‹Eric Sammer â€“ Distinguished Engineer at Splunk è®²è§£å˜‰å®¾ï¼šç‹æ²»æ±Ÿï¼ˆæ·˜æ±Ÿï¼‰ â€“ é˜¿é‡Œå·´å·´é«˜çº§æŠ€æœ¯ä¸“å®¶ 5ã€ã€ŠFlink SQL ä¹‹ 2020ï¼šèˆæˆ‘å…¶è°ã€‹Fabian Hueske, &amp; Timo Walther è®²è§£å˜‰å®¾ï¼šä¼ç¿€ï¼ˆäº‘é‚ªï¼‰ï¼ŒApache Flink PMCï¼Œé˜¿é‡Œå·´å·´æŠ€æœ¯ä¸“å®¶ 6ã€ã€Šå¾®åšåŸºäº Flink çš„æœºå™¨å­¦ä¹ å®è·µã€‹ åˆ†äº«å˜‰å®¾ï¼š äºèŒœï¼Œå¾®åšæœºå™¨å­¦ä¹ ç ”å‘ä¸­å¿ƒé«˜çº§ç®—æ³•å·¥ç¨‹å¸ˆã€‚å¤šå¹´æ¥è‡´åŠ›äºä½¿ç”¨ Flink æ„å»ºå®æ—¶æ•°æ®å¤„ç†å’Œåœ¨çº¿æœºå™¨å­¦ä¹ æ¡†æ¶ï¼Œæœ‰ä¸°å¯Œçš„ç¤¾äº¤åª’ä½“åº”ç”¨æ¨èç³»ç»Ÿçš„å¼€å‘ç»éªŒã€‚ æ›¹å¯Œå¼ºï¼Œå¾®åšæœºå™¨å­¦ä¹ ç ”å‘ä¸­å¿ƒç³»ç»Ÿå·¥ç¨‹å¸ˆã€‚ç°è´Ÿè´£å¾®åšæœºå™¨å­¦ä¹ å¹³å°æ•°æ®è®¡ç®—æ¨¡å—ã€‚ä¸»è¦æ¶‰åŠå®æ—¶è®¡ç®— Flinkï¼ŒStormï¼ŒSpark Streamingï¼Œç¦»çº¿è®¡ç®— Hiveï¼ŒSpark ç­‰ã€‚ç›®å‰ä¸“æ³¨äº Flink åœ¨å¾®åšæœºå™¨å­¦ä¹ åœºæ™¯çš„åº”ç”¨ã€‚ äºç¿”ï¼Œå¾®åšæœºå™¨å­¦ä¹ ç ”å‘ä¸­å¿ƒç®—æ³•æ¶æ„å·¥ç¨‹å¸ˆã€‚ 7ã€ã€ŠFlinkâ€™s application at Didiã€‹ åˆ†äº«å˜‰å®¾ï¼šè–›åº· â€“ ç°ä»»æ»´æ»´æŠ€æœ¯ä¸“å®¶ï¼Œå®æ—¶è®¡ç®—è´Ÿè´£äºº 8ã€ã€ŠAlinkï¼šæå‡åŸºäº Flink çš„æœºå™¨å­¦ä¹ å¹³å°æ˜“ç”¨æ€§ã€‹ åˆ†äº«å˜‰å®¾ï¼šæ¨æ—­ï¼ˆå“æ•°ï¼‰ â€“ é˜¿é‡Œå·´å·´èµ„æ·±æŠ€æœ¯ä¸“å®¶ã€‚ 9ã€ã€ŠGoogle: æœºå™¨å­¦ä¹ å·¥ä½œæµçš„åˆ†å¸ƒå¼å¤„ç†ã€‹Ahmet Altay &amp; Reza Rokni &amp; Robert Crowe è®²è§£å˜‰å®¾ï¼šç§¦æ±Ÿæ° â€“ Apache Flink PMCï¼Œé˜¿é‡Œå·´å·´é«˜çº§æŠ€æœ¯ä¸“å®¶ 10ã€ã€ŠFlink + AI Flowï¼šè®© AI æ˜“å¦‚åæŒã€‹ åˆ†äº«å˜‰å®¾ï¼šç§¦æ±Ÿæ° â€“ Apache Flink PMCï¼Œé˜¿é‡Œå·´å·´é«˜çº§æŠ€æœ¯ä¸“å®¶ 11ã€ã€Šç»ˆäºç­‰åˆ°ä½ ï¼šPyFlink + Zeppelinã€‹ åˆ†äº«å˜‰å®¾ï¼š å­™é‡‘åŸï¼ˆé‡‘ç«¹ï¼‰ â€“ Apache Memberï¼ŒApache Flink PMCï¼Œé˜¿é‡Œå·´å·´é«˜çº§æŠ€æœ¯ä¸“å®¶ ç« å‰‘é”‹ï¼ˆç®€é”‹ï¼‰ â€“ Apache Memberï¼ŒApache Zeppelin PMCï¼Œé˜¿é‡Œå·´å·´é«˜çº§æŠ€æœ¯ä¸“å®¶ 12ã€ã€ŠUber ï¼šä½¿ç”¨ Flink CEP è¿›è¡Œåœ°ç†æƒ…å½¢æ£€æµ‹çš„å®è·µã€‹Teng (Niel) Hu è®²è§£å˜‰å®¾ï¼šä»˜å…¸ â€“ Apache Flink Committerï¼Œé˜¿é‡Œå·´å·´æŠ€æœ¯ä¸“å®¶ 13ã€ã€ŠAWS: å¦‚ä½•åœ¨å…¨æ‰˜ç®¡ Apache Flink æœåŠ¡ä¸­æä¾›åº”ç”¨é«˜å¯ç”¨ã€‹ Ryan Nienhuis &amp; Tirtha Chatterjee è®²è§£å˜‰å®¾ï¼šç« å‰‘é”‹ï¼ˆç®€é”‹ï¼‰ â€“ Apache Memberï¼ŒApache Zeppelin PMCï¼Œé˜¿é‡Œå·´å·´é«˜çº§æŠ€æœ¯ä¸“å®¶ 14ã€ã€ŠProduction-Ready Flink and Hive Integration â€“ what story you can tell now?ã€‹ Bowen Li è®²è§£å˜‰å®¾ï¼šæé”ï¼ˆå¤©ç¦»ï¼‰ â€“ Apache Hive PMCï¼Œé˜¿é‡Œå·´å·´æŠ€æœ¯ä¸“å®¶ 15ã€ã€ŠData Warehouse, Data Lakes, Whatâ€™s Next?ã€‹Xiaowei Jiang è®²è§£å˜‰å®¾ï¼šé‡‘æ™“å†›ï¼ˆä»™éšï¼‰ â€“ é˜¿é‡Œå·´å·´é«˜çº§æŠ€æœ¯ä¸“å®¶ 16ã€ã€ŠNetflix çš„ Flink è‡ªåŠ¨æ‰©ç¼©å®¹ã€‹ Abhay Amin è®²è§£å˜‰å®¾ï¼šå•æ–‡é¾™ï¼ˆé¾™ä¸‰ï¼‰ï¼Œé˜¿é‡Œå·´å·´æŠ€æœ¯ä¸“å®¶ 17ã€ã€ŠApache Flink è¯¯ç”¨ä¹‹ç—›ã€‹ Konstantin Knauf è®²è§£å˜‰å®¾ï¼šå­™é‡‘åŸï¼ˆé‡‘ç«¹ï¼‰ â€“ Apache Memberï¼ŒApache Flink PMCï¼Œé˜¿é‡Œå·´å·´é«˜çº§æŠ€æœ¯ä¸“å®¶ 18ã€ã€ŠA deep dive into Flink SQLã€‹ åˆ†äº«å˜‰å®¾ï¼šä¼ç¿€ï¼ˆäº‘é‚ªï¼‰ï¼ŒApache Flink PMCï¼Œé˜¿é‡Œå·´å·´æŠ€æœ¯ä¸“å®¶ 19ã€ã€ŠLyft: åŸºäºFlinkçš„å‡†å®æ—¶æµ·é‡æ•°æ®åˆ†æå¹³å°ã€‹ Ying Xu &amp; Kailash Hassan Dayanand è®²è§£å˜‰å®¾ï¼šç‹é˜³ï¼ˆäº¦ç¥ºï¼‰ï¼Œé˜¿é‡Œå·´å·´æŠ€æœ¯ä¸“å®¶ å¦‚ä½•è·å–ä¸Šé¢è¿™äº› PPTï¼Ÿä¸Šé¢çš„è¿™äº› PPT æœ¬äººå·²ç»æ•´ç†å¥½äº†ï¼Œä½ å¯ä»¥æ‰«æä¸‹é¢äºŒç»´ç ï¼Œå…³æ³¨å¾®ä¿¡å…¬ä¼—å·ï¼šzhishengï¼Œç„¶ååœ¨é‡Œé¢å›å¤å…³é”®å­—: ff2020 å³å¯è·å–å·²æ”¾å‡ºçš„ PPTã€‚","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"å®æ—¶è®¡ç®—","slug":"å®æ—¶è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/å®æ—¶è®¡ç®—/"}]},{"title":"å¦‚ä½•å®æ—¶ç›‘æ§ Flink é›†ç¾¤å’Œä½œä¸šï¼Ÿ","date":"2020-05-06T16:00:00.000Z","path":"2020/05/07/flink-job-monitor/","text":"Flink ç›¸å…³çš„ç»„ä»¶å’Œä½œä¸šçš„ç¨³å®šæ€§é€šå¸¸æ˜¯æ¯”è¾ƒå…³é”®çš„ï¼Œæ‰€ä»¥å¾—éœ€è¦å¯¹å®ƒä»¬è¿›è¡Œç›‘æ§ï¼Œå¦‚æœæœ‰å¼‚å¸¸ï¼Œåˆ™éœ€è¦åŠæ—¶å‘Šè­¦é€šçŸ¥ã€‚æœ¬ç« å…ˆä¼šæ•™ä¼šæ•™ä¼šå¤§å®¶å¦‚ä½•åˆ©ç”¨ç°æœ‰ Flink UI ä¸Šé¢çš„ä¿¡æ¯å»å‘ç°å’Œæ’æŸ¥é—®é¢˜ï¼Œä¼šæŒ‡æ˜ä¸€äº›æ¯”è¾ƒé‡è¦å’Œæˆ‘ä»¬éå¸¸å…³å¿ƒçš„æŒ‡æ ‡ï¼Œé€šè¿‡è¿™äº›æŒ‡æ ‡æˆ‘ä»¬èƒ½å¤Ÿç«‹é©¬å®šä½åˆ°é—®é¢˜çš„æ ¹æœ¬åŸå› ã€‚æ¥ç€ç¬”è€…ä¼šæ•™å¤§å®¶å¦‚ä½•å»åˆ©ç”¨ç°æœ‰çš„ Metrics Reporter å»æ„å»ºä¸€ä¸ª Flink çš„ç›‘æ§ç³»ç»Ÿï¼Œå®ƒå¯ä»¥æ”¶é›†åˆ°æ‰€æœ‰ä½œä¸šçš„ç›‘æ§æŒ‡æ ‡ï¼Œå¹¶ä¼šå­˜å‚¨è¿™äº›ç›‘æ§æŒ‡æ ‡æ•°æ®ï¼Œæœ€åè¿˜ä¼šæœ‰ä¸€ä¸ªç›‘æ§å¤§ç›˜åšæ•°æ®å¯è§†åŒ–ï¼Œé€šè¿‡è¿™ä¸ªå¤§ç›˜å¯ä»¥æ–¹ä¾¿æ’æŸ¥é—®é¢˜ã€‚ å®æ—¶ç›‘æ§ Flink åŠå…¶ä½œä¸šå½“å°† Flink JobManagerã€TaskManager éƒ½è¿è¡Œèµ·æ¥äº†ï¼Œå¹¶ä¸”ä¹Ÿéƒ¨ç½²äº†ä¸å°‘ Flink Jobï¼Œé‚£ä¹ˆå®ƒåˆ°åº•æ˜¯å¦è¿˜åœ¨è¿è¡Œã€è¿è¡Œçš„çŠ¶æ€å¦‚ä½•ã€èµ„æº TaskManager å’Œ Slot çš„ä¸ªæ•°æ˜¯å¦è¶³å¤Ÿã€Job å†…éƒ¨æ˜¯å¦å‡ºç°å¼‚å¸¸ã€è®¡ç®—é€Ÿåº¦æ˜¯å¦è·Ÿå¾—ä¸Šæ•°æ®ç”Ÿäº§çš„é€Ÿåº¦ ç­‰è¿™äº›é—®é¢˜å…¶å®å¯¹æˆ‘ä»¬æ¥è¯´æ˜¯æ¯”è¾ƒå…³æ³¨çš„ï¼Œæ‰€ä»¥å°±å¾ˆè¿«åˆ‡çš„éœ€è¦ä¸€ä¸ªç›‘æ§ç³»ç»Ÿå¸®æˆ‘ä»¬æŠŠæ•´ä¸ª Flink é›†ç¾¤çš„è¿è¡ŒçŠ¶æ€ç»™å±•ç¤ºå‡ºæ¥ã€‚é€šè¿‡ç›‘æ§ç³»ç»Ÿæˆ‘ä»¬èƒ½å¤Ÿå¾ˆå¥½çš„çŸ¥é“ Flink å†…éƒ¨çš„æ•´ä¸ªè¿è¡ŒçŠ¶æ€ï¼Œç„¶åæ‰èƒ½å¤Ÿæ ¹æ®é¡¹ç›®ç”Ÿäº§ç¯å¢ƒé‡åˆ°çš„é—®é¢˜ â€˜å¯¹ç—‡ä¸‹è¯â€™ã€‚ä¸‹é¢åˆ†åˆ«æ¥è®²ä¸‹ JobManagerã€TaskManagerã€Flink Job çš„ç›‘æ§ä»¥åŠæœ€å…³å¿ƒçš„ä¸€äº›ç›‘æ§æŒ‡æ ‡ã€‚ ç›‘æ§ JobManageræˆ‘ä»¬çŸ¥é“ JobManager æ˜¯ Flink é›†ç¾¤çš„ä¸­æ§èŠ‚ç‚¹ï¼Œç±»ä¼¼äº Apache Storm çš„ Nimbus ä»¥åŠ Apache Spark çš„ Driver çš„è§’è‰²ã€‚å®ƒè´Ÿè´£ä½œä¸šçš„è°ƒåº¦ã€ä½œä¸š Jar åŒ…çš„ç®¡ç†ã€Checkpoint çš„åè°ƒå’Œå‘èµ·ã€ä¸ TaskManager ä¹‹é—´çš„å¿ƒè·³æ£€æŸ¥ç­‰å·¥ä½œã€‚å¦‚æœ JobManager å‡ºç°é—®é¢˜çš„è¯ï¼Œå°±ä¼šå¯¼è‡´ä½œä¸š UI ä¿¡æ¯æŸ¥çœ‹ä¸äº†ï¼ŒTaskManager å’Œæ‰€æœ‰è¿è¡Œçš„ä½œä¸šéƒ½ä¼šå—åˆ°ä¸€å®šçš„å½±å“ï¼Œæ‰€ä»¥è¿™ä¹Ÿæ˜¯ä¸ºå•¥åœ¨ 7.1 èŠ‚ä¸­å¼ºè°ƒ JobManager çš„é«˜å¯ç”¨é—®é¢˜ã€‚ åœ¨ Flink è‡ªå¸¦çš„ UI ä¸Š JobManager é‚£ä¸ª Tab å±•ç¤ºçš„å…¶å®å¹¶æ²¡æœ‰æ˜¾ç¤ºå…¶å¯¹åº”çš„ Metricsï¼Œé‚£ä¹ˆå¯¹äº JobManager æ¥è¯´å¸¸è§æ¯”è¾ƒå…³å¿ƒçš„ç›‘æ§æŒ‡æ ‡æœ‰å“ªäº›å‘¢ï¼Ÿ åŸºç¡€æŒ‡æ ‡å› ä¸º Flink JobManager å…¶å®ä¹Ÿæ˜¯ä¸€ä¸ª Java çš„åº”ç”¨ç¨‹åºï¼Œé‚£ä¹ˆå®ƒè‡ªç„¶ä¹Ÿä¼šæœ‰ Java åº”ç”¨ç¨‹åºçš„æŒ‡æ ‡ï¼Œæ¯”å¦‚å†…å­˜ã€CPUã€GCã€ç±»åŠ è½½ã€çº¿ç¨‹ä¿¡æ¯ç­‰ã€‚ å†…å­˜ï¼šå†…å­˜åˆåˆ†å †å†…å­˜å’Œéå †å†…å­˜ï¼Œåœ¨ Flink ä¸­è¿˜æœ‰ Direct å†…å­˜ï¼Œæ¯ç§å†…å­˜åˆæœ‰åˆå§‹å€¼ã€ä½¿ç”¨å€¼ã€æœ€å¤§å€¼ç­‰æŒ‡æ ‡ï¼Œå› ä¸ºåœ¨ JobManager ä¸­çš„å·¥ä½œå…¶å®ç›¸å½“äº TaskManager æ¥è¯´æ¯”è¾ƒå°‘ï¼Œä¹Ÿä¸å­˜å‚¨äº‹ä»¶æ•°æ®ï¼Œæ‰€ä»¥é€šå¸¸ JobManager å ç”¨çš„å†…å­˜ä¸ä¼šå¾ˆå¤šï¼Œåœ¨ Flink JobManager ä¸­è‡ªå¸¦çš„å†…å­˜ Metrics æŒ‡æ ‡æœ‰ï¼š 123456789101112jobmanager_Status_JVM_Memory_Direct_Countjobmanager_Status_JVM_Memory_Direct_MemoryUsedjobmanager_Status_JVM_Memory_Direct_TotalCapacityjobmanager_Status_JVM_Memory_Heap_Committedjobmanager_Status_JVM_Memory_Heap_Maxjobmanager_Status_JVM_Memory_Heap_Usedjobmanager_Status_JVM_Memory_Mapped_Countjobmanager_Status_JVM_Memory_Mapped_MemoryUsedjobmanager_Status_JVM_Memory_Mapped_TotalCapacityjobmanager_Status_JVM_Memory_NonHeap_Committedjobmanager_Status_JVM_Memory_NonHeap_Maxjobmanager_Status_JVM_Memory_NonHeap_Used CPUï¼šJobManager åˆ†é…çš„ CPU ä½¿ç”¨æƒ…å†µï¼Œå¦‚æœä½¿ç”¨ç±»ä¼¼ K8S ç­‰èµ„æºè°ƒåº¦ç³»ç»Ÿï¼Œåˆ™éœ€è¦å¯¹æ¯ä¸ªå®¹å™¨è¿›è¡Œè®¾ç½®èµ„æºï¼Œæ¯”å¦‚ CPU é™åˆ¶ä¸èƒ½è¶…è¿‡å¤šå°‘ï¼Œåœ¨ Flink JobManager ä¸­è‡ªå¸¦çš„ CPU æŒ‡æ ‡æœ‰ï¼š 12jobmanager_Status_JVM_CPU_Loadjobmanager_Status_JVM_CPU_Time GCï¼šGC ä¿¡æ¯å¯¹äº Java åº”ç”¨æ¥è¯´æ˜¯é¿å…ä¸äº†çš„ï¼Œæ¯ç§ GC éƒ½æœ‰æ—¶é—´å’Œæ¬¡æ•°çš„æŒ‡æ ‡å¯ä»¥ä¾›å‚è€ƒï¼Œæä¾›çš„æŒ‡æ ‡æœ‰ï¼š 1234jobmanager_Status_JVM_GarbageCollector_PS_MarkSweep_Countjobmanager_Status_JVM_GarbageCollector_PS_MarkSweep_Timejobmanager_Status_JVM_GarbageCollector_PS_Scavenge_Countjobmanager_Status_JVM_GarbageCollector_PS_Scavenge_Time Checkpoint æŒ‡æ ‡å› ä¸º JobManager è´Ÿè´£äº†ä½œä¸šçš„ Checkpoint çš„åè°ƒå’Œå‘èµ·åŠŸèƒ½ï¼Œæ‰€ä»¥ Checkpoint ç›¸å…³çš„æŒ‡æ ‡å°±æœ‰è¡¨ç¤º Checkpoint æ‰§è¡Œçš„æ—¶é—´ã€Checkpoint çš„æ—¶é—´é•¿çŸ­ã€å®Œæˆçš„ Checkpoint çš„æ¬¡æ•°ã€Checkpoint å¤±è´¥çš„æ¬¡æ•°ã€Checkpoint æ­£åœ¨æ‰§è¡Œ Checkpoint çš„ä¸ªæ•°ç­‰ï¼Œå…¶å¯¹åº”çš„æŒ‡æ ‡å¦‚ä¸‹ï¼š 123456789jobmanager_job_lastCheckpointAlignmentBufferedjobmanager_job_lastCheckpointDurationjobmanager_job_lastCheckpointExternalPathjobmanager_job_lastCheckpointRestoreTimestampjobmanager_job_lastCheckpointSizejobmanager_job_numberOfCompletedCheckpointsjobmanager_job_numberOfFailedCheckpointsjobmanager_job_numberOfInProgressCheckpointsjobmanager_job_totalNumberOfCheckpoints é‡è¦çš„æŒ‡æ ‡å¦å¤–è¿˜æœ‰æ¯”è¾ƒé‡è¦çš„æŒ‡æ ‡å°±æ˜¯ Flink UI ä¸Šä¹Ÿæä¾›çš„ï¼Œç±»ä¼¼äº Slot æ€»å…±ä¸ªæ•°ã€Slot å¯ä½¿ç”¨çš„ä¸ªæ•°ã€TaskManager çš„ä¸ªæ•°ï¼ˆé€šè¿‡æŸ¥çœ‹è¯¥å€¼å¯ä»¥çŸ¥é“æ˜¯å¦æœ‰ TaskManager å‘ç”Ÿå¼‚å¸¸é‡å¯ï¼‰ã€æ­£åœ¨è¿è¡Œçš„ä½œä¸šæ•°é‡ã€ä½œä¸šè¿è¡Œçš„æ—¶é—´å’Œå®Œæˆçš„æ—¶é—´ã€ä½œä¸šçš„é‡å¯æ¬¡æ•°ï¼Œå¯¹åº”çš„æŒ‡æ ‡å¦‚ä¸‹ï¼š 12345678jobmanager_job_uptimejobmanager_numRegisteredTaskManagersjobmanager_numRunningJobsjobmanager_taskSlotsAvailablejobmanager_taskSlotsTotaljobmanager_job_downtimejobmanager_job_fullRestartsjobmanager_job_restartingTime ç›‘æ§ TaskManagerTaskManager åœ¨ Flink é›†ç¾¤ä¸­ä¹Ÿæ˜¯ä¸€ä¸ªä¸ªçš„è¿›ç¨‹å®ä¾‹ï¼Œå®ƒçš„æ•°é‡ä»£è¡¨ç€èƒ½å¤Ÿè¿è¡Œä½œä¸šä¸ªæ•°çš„èƒ½åŠ›ï¼Œæ‰€æœ‰çš„ Flink ä½œä¸šæœ€ç»ˆå…¶å®æ˜¯ä¼šåœ¨ TaskManager ä¸Šè¿è¡Œçš„ï¼ŒTaskManager ç®¡ç†ç€è¿è¡Œåœ¨å®ƒä¸Šé¢çš„æ‰€æœ‰ä½œä¸šçš„ Task çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸï¼ŒåŒ…æ‹¬äº† Task çš„å¯åŠ¨é”€æ¯ã€å†…å­˜ç®¡ç†ã€ç£ç›˜ IOã€ç½‘ç»œä¼ è¾“ç®¡ç†ç­‰ã€‚ å› ä¸ºæ‰€æœ‰çš„ Task éƒ½æ˜¯è¿è¡Œè¿è¡Œåœ¨ TaskManager ä¸Šçš„ï¼Œæœ‰çš„ Task å¯èƒ½ä¼šåšæ¯”è¾ƒå¤æ‚çš„æ“ä½œæˆ–è€…ä¼šå­˜å‚¨å¾ˆå¤šæ•°æ®åœ¨å†…å­˜ä¸­ï¼Œé‚£ä¹ˆå°±ä¼šæ¶ˆè€—å¾ˆå¤§çš„èµ„æºï¼Œæ‰€ä»¥é€šå¸¸æ¥è¯´ TaskManager è¦æ¯” JobManager æ¶ˆè€—çš„èµ„æºè¦å¤šï¼Œä½†æ˜¯è¿™ä¸ªèµ„æºå…·ä½“å¤šå°‘å…¶å®ä¹Ÿä¸å¥½é¢„ä¼°ï¼Œæ‰€ä»¥å¯èƒ½ä¼šå‡ºç°ç”±äºåˆ†é…èµ„æºçš„ä¸åˆç†ï¼Œå¯¼è‡´ TaskManager å‡ºç° OOM ç­‰é—®é¢˜ã€‚ä¸€æ—¦ TaskManager å› ä¸ºå„ç§é—®é¢˜å¯¼è‡´å´©æºƒé‡å¯çš„è¯ï¼Œè¿è¡Œåœ¨å®ƒä¸Šé¢çš„ Task ä¹Ÿéƒ½ä¼šå¤±è´¥ï¼ŒJobManager ä¸å®ƒçš„é€šä¿¡ä¹Ÿä¼šä¸¢å¤±ã€‚å› ä¸ºä½œä¸šå‡ºç° failoverï¼Œæ‰€ä»¥åœ¨é‡å¯è¿™æ®µæ—¶é—´å®ƒæ˜¯ä¸ä¼šå»æ¶ˆè´¹æ•°æ®çš„ï¼Œæ‰€ä»¥å¿…ç„¶å°±ä¼šå‡ºç°æ•°æ®æ¶ˆè´¹å»¶è¿Ÿçš„é—®é¢˜ã€‚å¯¹äºè¿™ç§æƒ…å†µé‚£ä¹ˆå¿…ç„¶å°±å¾ˆéœ€è¦ TaskManager çš„ç›‘æ§ä¿¡æ¯ï¼Œè¿™æ ·æ‰èƒ½å¤Ÿå¯¹æ•´ä¸ªé›†ç¾¤çš„ TaskManager åšä¸€ä¸ªæå‰é¢„è­¦ã€‚ é‚£ä¹ˆåœ¨ Flink ä¸­è‡ªå¸¦çš„ TaskManager Metrics æœ‰å“ªäº›å‘¢ï¼Ÿä¸»è¦ä¹Ÿæ˜¯ CPUã€ç±»åŠ è½½ã€GCã€å†…å­˜ã€ç½‘ç»œç­‰ã€‚å…¶å®è¿™äº›ä¿¡æ¯åœ¨ Flink UI ä¸Šä¹Ÿæ˜¯æœ‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä¸çŸ¥é“è¯»è€…æœ‰æ²¡æœ‰ç»†å¿ƒè§‚å¯Ÿè¿‡ã€‚ åœ¨è¿™ä¸ª TaskManager çš„ Metrics ç›‘æ§é¡µé¢é€šå¸¸æ¯”è¾ƒå…³å¿ƒçš„æŒ‡æ ‡æœ‰å†…å­˜ç›¸å…³çš„ï¼Œè¿˜æœ‰å°±æ˜¯ GC çš„æŒ‡æ ‡ï¼Œé€šå¸¸ä¸€ä¸ª TaskManager å‡ºç° OOM ä¹‹å‰ä¼šä¸æ–­çš„è¿›è¡Œ GCï¼Œåœ¨è¿™ä¸ª Metrics é¡µé¢å®ƒå±•ç¤ºäº†å¹´è½»ä»£å’Œè€å¹´ä»£çš„ GC ä¿¡æ¯ï¼ˆæ—¶é—´å’Œæ¬¡æ•°ï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¤§å®¶å¯ä»¥ç»†å¿ƒè§‚å¯Ÿä¸‹æ˜¯å¦ TaskManager OOM å‰è€å¹´ä»£å’Œæ–°ç”Ÿä»£çš„ GC æ¬¡æ•°æ¯”è¾ƒã€æ—¶é—´æ¯”è¾ƒé•¿ã€‚ åœ¨ Flink Reporter ä¸­æä¾›çš„ TaskManager Metrics æŒ‡æ ‡å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425taskmanager_Status_JVM_CPU_Loadtaskmanager_Status_JVM_CPU_Timetaskmanager_Status_JVM_ClassLoader_ClassesLoadedtaskmanager_Status_JVM_ClassLoader_ClassesUnloadedtaskmanager_Status_JVM_GarbageCollector_G1_Old_Generation_Counttaskmanager_Status_JVM_GarbageCollector_G1_Old_Generation_Timetaskmanager_Status_JVM_GarbageCollector_G1_Young_Generation_Counttaskmanager_Status_JVM_GarbageCollector_G1_Young_Generation_Timetaskmanager_Status_JVM_Memory_Direct_Counttaskmanager_Status_JVM_Memory_Direct_MemoryUsedtaskmanager_Status_JVM_Memory_Direct_TotalCapacitytaskmanager_Status_JVM_Memory_Heap_Committedtaskmanager_Status_JVM_Memory_Heap_Maxtaskmanager_Status_JVM_Memory_Heap_Usedtaskmanager_Status_JVM_Memory_Mapped_Counttaskmanager_Status_JVM_Memory_Mapped_MemoryUsedtaskmanager_Status_JVM_Memory_Mapped_TotalCapacitytaskmanager_Status_JVM_Memory_NonHeap_Committedtaskmanager_Status_JVM_Memory_NonHeap_Maxtaskmanager_Status_JVM_Memory_NonHeap_Usedtaskmanager_Status_JVM_Threads_Counttaskmanager_Status_Network_AvailableMemorySegmentstaskmanager_Status_Network_TotalMemorySegmentstaskmanager_Status_Shuffle_Netty_AvailableMemorySegmentstaskmanager_Status_Shuffle_Netty_TotalMemorySegments ç›‘æ§ Flink ä½œä¸šå¯¹äºè¿è¡Œçš„ä½œä¸šæ¥è¯´ï¼Œå…¶å®æˆ‘ä»¬ä¼šæ›´å…³å¿ƒå…¶è¿è¡ŒçŠ¶æ€ï¼Œå¦‚æœæ²¡æœ‰å…¶å¯¹åº”çš„ä¸€äº›ç›‘æ§ä¿¡æ¯ï¼Œé‚£ä¹ˆå¯¹äºæˆ‘ä»¬æ¥è¯´è¿™ä¸ª Job å°±æ˜¯ä¸€ä¸ªé»‘ç›’ï¼Œå®Œå…¨ä¸çŸ¥é“æ˜¯å¦åœ¨è¿è¡Œï¼ŒJob è¿è¡ŒçŠ¶æ€æ˜¯ä»€ä¹ˆã€Task è¿è¡ŒçŠ¶æ€æ˜¯ä»€ä¹ˆã€æ˜¯å¦åœ¨æ¶ˆè´¹æ•°æ®ã€æ¶ˆè´¹æ•°æ®æ˜¯å’‹æ ·ï¼ˆç»†åˆ†åˆ°æ¯ä¸ª Taskï¼‰ã€æ¶ˆè´¹é€Ÿåº¦èƒ½å¦è·Ÿä¸Šç”Ÿäº§æ•°æ®çš„é€Ÿåº¦ã€å¤„ç†æ•°æ®çš„è¿‡ç¨‹ä¸­æ˜¯å¦æœ‰é‡åˆ°ä»€ä¹ˆé”™è¯¯æ—¥å¿—ã€å¤„ç†æ•°æ®æ˜¯å¦æœ‰å‡ºç°åå‹é—®é¢˜ç­‰ç­‰ã€‚ ä¸Šé¢åˆ—ä¸¾çš„è¿™äº›é—®é¢˜é€šå¸¸æ¥è¯´æ˜¯æ¯”è¾ƒå…³å¿ƒçš„ï¼Œé‚£ä¹ˆåœ¨ Flink UI ä¸Šä¹Ÿæ˜¯æœ‰æä¾›çš„æŸ¥çœ‹å¯¹åº”çš„ä¿¡æ¯çš„ï¼Œç‚¹å¼€å¯¹åº”çš„ä½œä¸šå°±å¯ä»¥æŸ¥çœ‹åˆ°ä½œä¸šçš„æ‰§è¡Œå›¾ï¼Œæ¯ä¸ª Task çš„ä¿¡æ¯éƒ½æ˜¯ä¼šå±•ç¤ºå‡ºæ¥çš„ï¼ŒåŒ…å«äº†çŠ¶æ€ã€Bytes Receivedï¼ˆæ¥æ”¶åˆ°è®°å½•çš„å®¹é‡å¤§å°ï¼‰ã€Records Receivedï¼ˆæ¥æ”¶åˆ°è®°å½•çš„æ¡æ•°ï¼‰ã€Bytes Sentï¼ˆå‘å‡ºå»çš„è®°å½•çš„å®¹é‡å¤§å°ï¼‰ã€Records Sentï¼ˆå‘å‡ºå»è®°å½•çš„æ¡æ•°ï¼‰ã€å¼‚å¸¸ä¿¡æ¯ã€timelineï¼ˆä½œä¸šè¿è¡ŒçŠ¶æ€çš„æ—¶é—´çº¿ï¼‰ã€Checkpoint ä¿¡æ¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ è¿™äº›æŒ‡æ ‡ä¹Ÿå¯ä»¥é€šè¿‡ Flink çš„ Reporter è¿›è¡Œä¸ŠæŠ¥å­˜å‚¨åˆ°ç¬¬ä¸‰æ–¹çš„æ—¶åºæ•°æ®åº“ï¼Œç„¶åé€šè¿‡ç±»ä¼¼ Grafana å±•ç¤ºå‡ºæ¥ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚é€šè¿‡è¿™äº›ä¿¡æ¯å¤§æ¦‚å°±å¯ä»¥æ¸…æ¥šçš„çŸ¥é“ä¸€ä¸ª Job çš„æ•´ä¸ªè¿è¡ŒçŠ¶æ€ï¼Œç„¶åæ ¹æ®è¿™äº›è¿è¡ŒçŠ¶æ€å»åˆ†æä½œä¸šæ˜¯å¦æœ‰é—®é¢˜ã€‚ åœ¨æµä½œä¸šä¸­æœ€å…³é”®çš„æŒ‡æ ‡æ— éæ˜¯ä½œä¸šçš„å®æ—¶æ€§ï¼Œé‚£ä¹ˆå»¶è¿Ÿå°±æ˜¯è¡¡é‡ä½œä¸šçš„æ˜¯å¦å®æ—¶çš„ä¸€ä¸ªåŸºæœ¬å‚æ•°ï¼Œä½†æ˜¯å¯¹äºç°æœ‰çš„è¿™äº›ä¿¡æ¯å…¶å®è¿˜ä¸çŸ¥é“ä½œä¸šçš„æ¶ˆè´¹æ˜¯å¦æœ‰å»¶è¿Ÿï¼Œé€šå¸¸æ¥è¯´å¯ä»¥ç»“åˆ Kafka çš„ç›‘æ§å»æŸ¥çœ‹å¯¹åº”æ¶ˆè´¹çš„ Topic çš„ Group çš„ Lag ä¿¡æ¯ï¼Œå¦‚æœ Lag å¾ˆå¤§å°±è¡¨æ˜æœ‰æ•°æ®å †ç§¯äº†ï¼Œå¦å¤–è¿˜æœ‰ä¸€ä¸ªåŠæ³•å°±æ˜¯éœ€è¦è‡ªå·±åœ¨ä½œä¸šä¸­è‡ªå®šä¹‰ Metrics åšåŸ‹ç‚¹ï¼Œå°†ç®—å­åœ¨å¤„ç†æ•°æ®çš„ç³»ç»Ÿæ—¶é—´ä¸æ•°æ®è‡ªèº«çš„ Event Time åšä¸€ä¸ªå·®å€¼ï¼Œæ±‚å¾—å€¼å°±å¯ä»¥çŸ¥é“ç®—å­æ¶ˆè´¹çš„æ•°æ®æ˜¯ä»€ä¹ˆæ—¶å€™çš„äº†ã€‚æ¯”å¦‚åœ¨ 1571457964000ï¼ˆ2019-10-19 12:06:04ï¼‰Map ç®—å­æ¶ˆè´¹çš„æ•°æ®çš„äº‹ä»¶æ—¶é—´æ˜¯ 1571457604000ï¼ˆ2019-10-19 12:00:04ï¼‰ï¼Œç›¸å·®äº† 6 åˆ†é’Ÿï¼Œé‚£ä¹ˆå°±è¡¨æ˜æ¶ˆè´¹å»¶è¿Ÿäº† 6 åˆ†é’Ÿï¼Œç„¶åé€šè¿‡ Metrics Reporter å°†åŸ‹ç‚¹çš„ Metrics ä¿¡æ¯ä¸Šä¼ ï¼Œè¿™æ ·æœ€ç»ˆå°±å¯ä»¥è·å–åˆ°ä½œä¸šåœ¨æ¯ä¸ªç®—å­å¤„çš„æ¶ˆè´¹å»¶è¿Ÿçš„æ—¶é—´ã€‚ ä¸Šé¢çš„æ˜¯é’ˆå¯¹äºä½œä¸šå»¶è¿Ÿçš„åˆ¤æ–­æ–¹æ³•ï¼Œå¦å¤–åƒç±»ä¼¼äºä½œä¸šåå‹çš„æƒ…å†µï¼Œåœ¨ Flink çš„ UI ä¹Ÿä¼šæœ‰å±•ç¤ºï¼Œå…·ä½“æ€ä¹ˆå»åˆ†æå’Œå¤„ç†è¿™ç§é—®é¢˜åœ¨ 9.1 èŠ‚ä¸­æœ‰è¯¦ç»†è®²è§£ã€‚ æ ¹æ®è¿™äº›ç›‘æ§ä¿¡æ¯ä¸ä»…å¯ä»¥åšåˆ°æå‰é¢„è­¦ï¼Œåšå¥½èµ„æºçš„æ‰©å®¹ï¼ˆæ¯”å¦‚å¢åŠ å®¹å™¨çš„æ•°é‡ï¼å†…å­˜ï¼CPUï¼å¹¶è¡Œåº¦ï¼Slot ä¸ªæ•°ï¼‰ï¼Œä¹Ÿè¿˜å¯ä»¥æ‰¾å‡ºä½œä¸šé…ç½®çš„èµ„æºæ˜¯å¦æœ‰æµªè´¹ã€‚é€šå¸¸æ¥è¯´ä¸€ä¸ªä½œä¸šçš„ä¸Šçº¿å¯èƒ½æ˜¯ä¼šç»è¿‡èµ„æºçš„é¢„ä¼°ï¼Œç„¶åæ‰ä¼šå»ç”³è¯·è¿™ä¸ªä½œä¸šè¦é…ç½®å¤šå°‘èµ„æºï¼Œæ¯”å¦‚ç®—å­è¦ä½¿ç”¨å¤šå°‘å¹¶è¡Œåº¦ï¼Œæœ€åä¸Šçº¿åå¯ä»¥é€šè¿‡å®Œæ•´çš„è¿è¡Œç›‘æ§ä¿¡æ¯æŸ¥çœ‹è¯¥ä½œä¸šé…ç½®çš„å¹¶è¡Œåº¦æ˜¯å¦æœ‰è¿‡å¤šæˆ–è€…é…ç½®çš„å†…å­˜æ¯”è¾ƒå¤§ã€‚æ¯”å¦‚å‡ºç°ä¸‹é¢è¿™äº›æƒ…å†µçš„æ—¶å€™å¯èƒ½å°±æ˜¯èµ„æºå‡ºç°æµªè´¹äº†ï¼š ä½œä¸šæ¶ˆè´¹ä»æœªå‘ç”Ÿè¿‡å»¶è¿Ÿï¼Œå³ä½¿åœ¨æ•°æ®æµé‡é«˜å³°çš„æ—¶å€™ï¼Œä¹Ÿæœªå‘ç”Ÿè¿‡æ¶ˆè´¹å»¶è¿Ÿ ä½œä¸šè¿è¡Œæ‰€åœ¨çš„ TaskManager å †å†…å­˜ä½¿ç”¨ç‡å¼‚å¸¸çš„ä½ ä½œä¸šè¿è¡Œæ‰€åœ¨çš„ TaskManager çš„ GC æ—¶é—´å’Œæ¬¡æ•°éå¸¸è§„å¾‹ï¼Œæ²¡æœ‰å‡ºç°å¼‚å¸¸çš„ç°è±¡ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ åœ¨ Flink Metrics Reporter ä¸Šä¼ çš„æŒ‡æ ‡ä¸­å¤§æ¦‚æœ‰ä¸‹é¢è¿™äº›ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647taskmanager_job_task_Shuffle_Netty_Input_Buffers_outPoolUsagetaskmanager_job_task_Shuffle_Netty_Input_Buffers_outputQueueLengthtaskmanager_job_task_Shuffle_Netty_Output_Buffers_inPoolUsagetaskmanager_job_task_Shuffle_Netty_Output_Buffers_inputExclusiveBuffersUsagetaskmanager_job_task_Shuffle_Netty_Output_Buffers_inputFloatingBuffersUsagetaskmanager_job_task_Shuffle_Netty_Output_Buffers_inputQueueLengthtaskmanager_job_task_Shuffle_Netty_Output_numBuffersInLocaltaskmanager_job_task_Shuffle_Netty_Output_numBuffersInLocalPerSecondtaskmanager_job_task_Shuffle_Netty_Output_numBuffersInRemotetaskmanager_job_task_Shuffle_Netty_Output_numBuffersInRemotePerSecondtaskmanager_job_task_Shuffle_Netty_Output_numBytesInLocaltaskmanager_job_task_Shuffle_Netty_Output_numBytesInLocalPerSecondtaskmanager_job_task_Shuffle_Netty_Output_numBytesInRemotetaskmanager_job_task_Shuffle_Netty_Output_numBytesInRemotePerSecondtaskmanager_job_task_buffers_inPoolUsagetaskmanager_job_task_buffers_inputExclusiveBuffersUsagetaskmanager_job_task_buffers_inputFloatingBuffersUsagetaskmanager_job_task_buffers_inputQueueLengthtaskmanager_job_task_buffers_outPoolUsagetaskmanager_job_task_buffers_outputQueueLengthtaskmanager_job_task_checkpointAlignmentTimetaskmanager_job_task_currentInputWatermarktaskmanager_job_task_numBuffersInLocaltaskmanager_job_task_numBuffersInLocalPerSecondtaskmanager_job_task_numBuffersInRemotetaskmanager_job_task_numBuffersInRemotePerSecondtaskmanager_job_task_numBuffersOuttaskmanager_job_task_numBuffersOutPerSecondtaskmanager_job_task_numBytesIntaskmanager_job_task_numBytesInLocaltaskmanager_job_task_numBytesInLocalPerSecondtaskmanager_job_task_numBytesInPerSecondtaskmanager_job_task_numBytesInRemotetaskmanager_job_task_numBytesInRemotePerSecondtaskmanager_job_task_numBytesOuttaskmanager_job_task_numBytesOutPerSecondtaskmanager_job_task_numRecordsIntaskmanager_job_task_numRecordsInPerSecondtaskmanager_job_task_numRecordsOuttaskmanager_job_task_numRecordsOutPerSecondtaskmanager_job_task_operator_currentInputWatermarktaskmanager_job_task_operator_currentOutputWatermarktaskmanager_job_task_operator_numLateRecordsDroppedtaskmanager_job_task_operator_numRecordsIntaskmanager_job_task_operator_numRecordsInPerSecondtaskmanager_job_task_operator_numRecordsOuttaskmanager_job_task_operator_numRecordsOutPerSecond æœ€å…³å¿ƒçš„æ€§èƒ½æŒ‡æ ‡ä¸Šé¢å·²ç»æåŠåˆ° Flink çš„ JobManagerã€TaskManager å’Œè¿è¡Œçš„ Flink Job çš„ç›‘æ§ä»¥åŠå¸¸ç”¨çš„ç›‘æ§ä¿¡æ¯ï¼Œè¿™äº›æŒ‡æ ‡æœ‰çš„æ˜¯å¯ä»¥ç›´æ¥åœ¨ Flink çš„ UI ä¸Šè§‚å¯Ÿåˆ°çš„ï¼Œå¦å¤– Flink æä¾›äº† Metrics Reporter è¿›è¡Œä¸ŠæŠ¥å­˜å‚¨åˆ°ç›‘æ§ç³»ç»Ÿä¸­å»ï¼Œç„¶åé€šè¿‡å¯è§†åŒ–çš„å›¾è¡¨è¿›è¡Œå±•ç¤ºï¼Œåœ¨ 8.2 èŠ‚ä¸­å°†æ•™å¤§å®¶å¦‚ä½•æ„å»ºä¸€ä¸ªå®Œæ•´çš„ç›‘æ§ç³»ç»Ÿã€‚é‚£ä¹ˆæœ‰äº†è¿™ä¹ˆå¤šç›‘æ§æŒ‡æ ‡ï¼Œå…¶å®å“ªäº›æ˜¯æ¯”è¾ƒé‡è¦çš„å‘¢ï¼Œæ¯”å¦‚è¯´è¿™äº›æŒ‡æ ‡å‡ºç°å¼‚å¸¸çš„æ—¶å€™å¯ä»¥å‘å‡ºå‘Šè­¦åŠæ—¶è¿›è¡Œé€šçŸ¥ï¼Œè¿™æ ·å¯ä»¥åšåˆ°é¢„è­¦ä½œç”¨ï¼Œå¦å¤–è¿˜å¯ä»¥æ ¹æ®è¿™äº›ä¿¡æ¯è¿›è¡Œä½œä¸šèµ„æºçš„è¯„ä¼°ã€‚ä¸‹é¢åˆ—ä¸¾ä¸€äº›ç¬”è€…è§‰å¾—æ¯”è¾ƒé‡è¦çš„æŒ‡æ ‡ï¼š JobManageråœ¨ JobManager ä¸­æœ‰ç€è¯¥é›†ç¾¤ä¸­æ‰€æœ‰çš„ TaskManager çš„ä¸ªæ•°ã€Slot çš„æ€»ä¸ªæ•°ã€Slot çš„å¯ç”¨ä¸ªæ•°ã€è¿è¡Œçš„æ—¶é—´ã€ä½œä¸šçš„ Checkpoint æƒ…å†µï¼Œç¬”è€…è§‰å¾—è¿™å‡ ä¸ªæŒ‡æ ‡å¯ä»¥é‡ç‚¹å…³æ³¨ã€‚ TaskManager ä¸ªæ•°ï¼šå¦‚æœå‡ºç° TaskManager çªç„¶å‡å°‘ï¼Œå¯èƒ½æ˜¯å› ä¸ºæœ‰ TaskManager æŒ‚æ‰é‡å¯ï¼Œä¸€æ—¦è¯¥ TaskManager ä¹‹å‰è¿è¡Œäº†å¾ˆå¤šä½œä¸šï¼Œé‚£ä¹ˆé‡å¯å¸¦æ¥çš„å½±å“å¿…ç„¶æ˜¯å·¨å¤§çš„ã€‚ Slot ä¸ªæ•°ï¼šå–å†³äº TaskManager çš„ä¸ªæ•°ï¼Œå†³å®šäº†èƒ½è¿è¡Œä½œä¸šçš„æœ€å¤§å¹¶è¡Œåº¦ï¼Œå¦‚æœèµ„æºä¸å¤Ÿï¼ŒåŠæ—¶æ‰©å®¹ã€‚ ä½œä¸šè¿è¡Œæ—¶é—´ï¼šæ ¹æ®ä½œä¸šçš„è¿è¡Œæ—¶é—´æ¥åˆ¤æ–­ä½œä¸šæ˜¯å¦å­˜æ´»ï¼Œä¸­é€”æ˜¯å¦æ‰çº¿è¿‡ã€‚ Checkpoint æƒ…å†µï¼šCheckpoint æ˜¯ JobManager å‘èµ·çš„ï¼Œå¹¶ä¸”å…³ä¹åˆ°ä½œä¸šçš„çŠ¶æ€æ˜¯å¦å¯ä»¥å®Œæ•´çš„ä¿å­˜ã€‚ TaskManagerå› ä¸ºæ‰€æœ‰çš„ä½œä¸šæœ€ç»ˆéƒ½æ˜¯è¿è¡Œåœ¨ TaskManager ä¸Šï¼Œæ‰€ä»¥ TaskManager çš„ç›‘æ§æŒ‡æ ‡ä¹Ÿæ˜¯å¼‚å¸¸çš„ç›‘æ§ï¼Œå¹¶ä¸”ä½œä¸šçš„å¤æ‚åº¦ä¹Ÿä¼šå½±å“ TaskManager çš„èµ„æºä½¿ç”¨æƒ…å†µï¼Œæ‰€ä»¥ TaskManager çš„åŸºç¡€ç›‘æ§æŒ‡æ ‡æ¯”å¦‚å†…å­˜ã€GC å¦‚æœå‡ºç°å¼‚å¸¸æˆ–è€…è¶…å‡ºè®¾ç½®çš„é˜ˆå€¼åˆ™éœ€è¦ç«‹é©¬è¿›è¡Œå‘Šè­¦é€šçŸ¥ï¼Œé˜²æ­¢åé¢å¯¼è‡´å¤§æ‰¹é‡çš„ä½œä¸šå‡ºç°æ•…éšœé‡å¯ã€‚ å†…å­˜ä½¿ç”¨ç‡ï¼šéƒ¨åˆ†ä½œä¸šçš„ç®—å­ä¼šå°†æ‰€æœ‰çš„ State æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´ TaskManager çš„å†…å­˜ä½¿ç”¨ç‡ä¼šä¸Šå‡ï¼Œè¿˜æœ‰å°±æ˜¯å¯ä»¥æ ¹æ®è¯¥æŒ‡æ ‡çœ‹ä½œä¸šçš„åˆ©ç”¨ç‡ï¼Œä»è€Œæœ€åæ¥é‡æ–°åˆ’åˆ†èµ„æºçš„é…ç½®ã€‚ GC æƒ…å†µï¼šåˆ†æ—¶é—´å’Œæ¬¡æ•°ï¼Œä¸€æ—¦ TaskManager çš„å†…å­˜ç‡å¾ˆé«˜çš„æ—¶å€™ï¼Œå¿…å®šä¼´éšç€é¢‘ç¹çš„ GCï¼Œå¦‚æœåœ¨ GC çš„æ—¶å€™æ²¡æœ‰å¾—åˆ°åŠæ—¶çš„é¢„è­¦ï¼Œé‚£ä¹ˆå°†é¢ä¸´ OOM é£é™©ã€‚ Flink Jobä½œä¸šçš„ç¨³å®šæ€§å’ŒåŠæ—¶æ€§å…¶å®å°±æ˜¯å¤§å®¶æœ€å…³å¿ƒçš„ï¼Œå¸¸è§çš„æŒ‡æ ‡æœ‰ï¼šä½œä¸šçš„çŠ¶æ€ã€Task çš„çŠ¶æ€ã€ä½œä¸šç®—å­çš„æ¶ˆè´¹é€Ÿåº¦ã€ä½œä¸šå‡ºç°çš„å¼‚å¸¸æ—¥å¿—ã€‚ ä½œä¸šçš„çŠ¶æ€ï¼šåœ¨ UI ä¸Šæ˜¯å¯ä»¥çœ‹åˆ°ä½œä¸šçš„çŠ¶æ€ä¿¡æ¯ï¼Œå¸¸è§çš„çŠ¶æ€å˜æ›´ä¿¡æ¯å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ Task çš„çŠ¶æ€ï¼šå…¶å®å¯¼è‡´ä½œä¸šçš„çŠ¶æ€å‘ç”Ÿå˜åŒ–çš„åŸå› é€šå¸¸æ˜¯ç”±äº Task çš„è¿è¡ŒçŠ¶æ€å‡ºç°å¯¼è‡´ï¼Œæ‰€ä»¥ä¹Ÿéœ€è¦å¯¹ Task çš„è¿è¡ŒçŠ¶æ€è¿›è¡Œç›‘æ§ï¼ŒTask çš„è¿è¡ŒçŠ¶æ€å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ ä½œä¸šå¼‚å¸¸æ—¥å¿—ï¼šå¯¼è‡´ Task å‡ºç°çŠ¶æ€å¼‚å¸¸çš„æ ¹å› é€šå¸¸æ˜¯ä½œä¸šä¸­çš„ä»£ç å‡ºç°å„ç§å„æ ·çš„å¼‚å¸¸æ—¥å¿—ï¼Œæœ€åå¯èƒ½è¿˜ä¼šå¯¼è‡´ä½œä¸šæ— é™é‡å¯ï¼Œæ‰€ä»¥ä½œä¸šçš„å¼‚å¸¸æ—¥å¿—ä¹Ÿæ˜¯éœ€è¦åŠæ—¶å…³æ³¨ã€‚ ä½œä¸šé‡å¯æ¬¡æ•°ï¼šå½“ Task çŠ¶æ€å’Œä½œä¸šçš„çŠ¶æ€å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œå¦‚æœä½œä¸šä¸­é…ç½®äº†é‡å¯ç­–ç•¥æˆ–è€…å¼€å¯äº† Checkpoint åˆ™ä¼šè¿›è¡Œä½œä¸šé‡å¯çš„ï¼Œé‡å¯ä½œä¸šçš„å¸¦æ¥çš„å½±å“ä¹Ÿä¼šå¾ˆå¤šï¼Œå¹¶ä¸”ä¼šä¼´éšç€ä¸€äº›ä¸ç¡®å®šçš„å› ç´ ï¼Œæœ€ç»ˆå¯¼è‡´ä½œä¸šä¸€ç›´é‡å¯ï¼Œè¿™æ ·æ—¢ä¸èƒ½è§£å†³é—®é¢˜ï¼Œè¿˜ä¸€ç›´åœ¨å ç”¨ç€èµ„æºçš„æ¶ˆè€—ã€‚ ç®—å­çš„æ¶ˆè´¹é€Ÿåº¦ï¼šä»£è¡¨äº†ä½œä¸šçš„æ¶ˆè´¹èƒ½åŠ›ï¼Œè¿˜å¯ä»¥çŸ¥é“ä½œä¸šæ˜¯å¦å‘ç”Ÿå»¶è¿Ÿï¼Œå¯ä»¥åŒ…å«ç®—å­æ¥æ”¶çš„æ•°æ®é‡å’Œå‘å‡ºå»æ•°æ®é‡ï¼Œä»è€Œå¯ä»¥çŸ¥é“åœ¨ç®—å­å¤„æ˜¯å¦æœ‰å‘ç”Ÿæ•°æ®çš„ä¸¢å¤±ã€‚ å°ç»“ä¸åæ€æœ¬èŠ‚è®²äº† Flink ä¸­å¸¸è§çš„ç›‘æ§å¯¹è±¡ï¼Œæ¯”å¦‚ JobManagerã€TaskManager å’Œ Flink Jobï¼Œå¯¹äºè¿™å‡ ä¸ªåˆ†åˆ«ä»‹ç»äº†å…¶å†…éƒ¨å¤§æ¦‚æœ‰çš„ç›‘æ§æŒ‡æ ‡ï¼Œä»¥åŠåœ¨çœŸå®ç”Ÿäº§ç¯å¢ƒå…³å¿ƒçš„æŒ‡æ ‡ï¼Œä½ æ˜¯å¦è¿˜æœ‰å…¶ä»–çš„ç›‘æ§æŒ‡æ ‡éœ€è¦è¡¥å……å‘¢ï¼Ÿ æœ¬èŠ‚æ¶‰åŠçš„ç›‘æ§æŒ‡æ ‡å¯¹åº”çš„å«ä¹‰å¯ä»¥å‚è€ƒå®˜ç½‘é“¾æ¥ï¼šmetrics æœ¬èŠ‚æ¶‰åŠçš„ç›‘æ§æŒ‡æ ‡åˆ—è¡¨åœ°å€ï¼šflink_monitor_measurements å…³æ³¨æˆ‘å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f Github ä»£ç ä»“åº“https://github.com/zhisheng17/flink-learning/ ä»¥åè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç éƒ½å°†æ”¾åœ¨è¿™ä¸ªä»“åº“é‡Œï¼ŒåŒ…å«äº†è‡ªå·±å­¦ä¹  flink çš„ä¸€äº› demo å’Œåšå®¢ åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€å®æˆ˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"å®æ—¶è®¡ç®—","slug":"å®æ—¶è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/å®æ—¶è®¡ç®—/"}]},{"title":"åŸºäº Apache Flink çš„å®æ—¶ Error æ—¥å¿—å‘Šè­¦","date":"2020-04-14T16:00:00.000Z","path":"2020/04/15/flink-error-log-alert/","text":"å¤§æ•°æ®æ—¶ä»£ï¼Œéšç€å…¬å¸ä¸šåŠ¡ä¸æ–­çš„å¢é•¿ï¼Œæ•°æ®é‡è‡ªç„¶ä¹Ÿä¼šè·Ÿç€ä¸æ–­çš„å¢é•¿ï¼Œé‚£ä¹ˆä¸šåŠ¡åº”ç”¨å’Œé›†ç¾¤æœåŠ¡å™¨çš„çš„è§„æ¨¡ä¹Ÿä¼šé€æ¸æ‰©å¤§ï¼Œå‡ ç™¾å°æœåŠ¡å™¨åœ¨ä¸€èˆ¬çš„å…¬å¸å·²ç»æ˜¯å¾ˆå¸¸è§çš„äº†ã€‚é‚£ä¹ˆå°†åº”ç”¨æœåŠ¡éƒ¨ç½²åœ¨å¦‚æ­¤å¤šçš„æœåŠ¡å™¨ä¸Šï¼Œå¯¹å¼€å‘å’Œè¿ç»´äººå‘˜æ¥è¯´éƒ½æ˜¯ä¸€ä¸ªæŒ‘æˆ˜ã€‚ä¸€ä¸ªä¼˜ç§€çš„ç³»ç»Ÿè¿ç»´å¹³å°æ˜¯éœ€è¦å°†éƒ¨ç½²åœ¨è¿™ä¹ˆå¤šæœåŠ¡å™¨ä¸Šçš„åº”ç”¨ç›‘æ§ä¿¡æ¯æ±‡æ€»æˆä¸€ä¸ªç»Ÿä¸€çš„æ•°æ®å±•ç¤ºå¹³å°ï¼Œæ–¹ä¾¿è¿ç»´äººå‘˜åšæ—¥å¸¸çš„ç›‘æµ‹ã€æå‡è¿ç»´æ•ˆç‡ï¼Œè¿˜å¯ä»¥åŠæ—¶åé¦ˆåº”ç”¨çš„è¿è¡ŒçŠ¶æ€ç»™åº”ç”¨å¼€å‘äººå‘˜ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œåº”ç”¨çš„è¿è¡Œæ—¥å¿—éœ€è¦æŒ‰ç…§æ—¶é—´æ’åºåšä¸€ä¸ªå±•ç¤ºï¼Œå¹¶ä¸”æä¾›æ—¥å¿—ä¸‹è½½å’Œæ—¥å¿—æœç´¢ç­‰æœåŠ¡ï¼Œè¿™æ ·å¦‚æœåº”ç”¨å‡ºç°é—®é¢˜å¼€å‘äººå‘˜é¦–å…ˆå¯ä»¥æ ¹æ®åº”ç”¨æ—¥å¿—çš„é”™è¯¯ä¿¡æ¯è¿›è¡Œé—®é¢˜çš„æ’æŸ¥ã€‚é‚£ä¹ˆè¯¥å¦‚ä½•å®æ—¶çš„å°†åº”ç”¨çš„ Error æ—¥å¿—æ¨é€ç»™åº”ç”¨å¼€å‘äººå‘˜å‘¢ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†è®²è§£æ—¥å¿—çš„å¤„ç†æ–¹æ¡ˆã€‚ æ—¥å¿—å¤„ç†æ–¹æ¡ˆçš„æ¼”è¿›æ—¥å¿—å¤„ç†çš„æ–¹æ¡ˆä¹Ÿæ˜¯æœ‰ä¸€ä¸ªæ¼”è¿›çš„è¿‡ç¨‹ï¼Œè¦æƒ³å¼„æ¸…æ¥šæ•´ä¸ªè¿‡ç¨‹ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹æ—¥å¿—çš„ä»‹ç»ã€‚ ä»€ä¹ˆæ˜¯æ—¥å¿—ï¼Ÿæ—¥å¿—æ˜¯å¸¦æ—¶é—´æˆ³çš„åŸºäºæ—¶é—´åºåˆ—çš„æ•°æ®ï¼Œå®ƒå¯ä»¥åæ˜ ç³»ç»Ÿçš„è¿è¡ŒçŠ¶æ€ï¼ŒåŒ…æ‹¬äº†ä¸€äº›æ ‡è¯†ä¿¡æ¯ï¼ˆåº”ç”¨æ‰€åœ¨æœåŠ¡å™¨é›†ç¾¤åã€é›†ç¾¤æœºå™¨ IPã€æœºå™¨è®¾å¤‡ç³»ç»Ÿä¿¡æ¯ã€åº”ç”¨åã€åº”ç”¨ IDã€åº”ç”¨æ‰€å±é¡¹ç›®ç­‰ï¼‰ æ—¥å¿—å¤„ç†æ–¹æ¡ˆæ¼”è¿›æ—¥å¿—å¤„ç†æ–¹æ¡ˆçš„æ¼”è¿›è¿‡ç¨‹ï¼š æ—¥å¿—å¤„ç† v1.0: åº”ç”¨æ—¥å¿—åˆ†å¸ƒåœ¨å¾ˆå¤šæœºå™¨ä¸Šï¼Œéœ€è¦äººè‚‰æ‰‹åŠ¨å»æœºå™¨æŸ¥çœ‹æ—¥å¿—ä¿¡æ¯ã€‚ æ—¥å¿—å¤„ç† v2.0: åˆ©ç”¨ç¦»çº¿è®¡ç®—å¼•æ“ç»Ÿä¸€çš„å°†æ—¥å¿—æ”¶é›†ï¼Œå½¢æˆä¸€ä¸ªæ—¥å¿—æœç´¢åˆ†æå¹³å°ï¼Œæä¾›æœç´¢è®©ç”¨æˆ·æ ¹æ®å…³é”®å­—è¿›è¡Œæœç´¢å’Œåˆ†æï¼Œç¼ºç‚¹å°±æ˜¯åŠæ—¶æ€§æ¯”è¾ƒå·®ã€‚ æ—¥å¿—å¤„ç† v3.0: åˆ©ç”¨ Agent å®æ—¶çš„é‡‡é›†éƒ¨ç½²åœ¨æ¯å°æœºå™¨ä¸Šçš„æ—¥å¿—ï¼Œç„¶åç»Ÿä¸€å‘åˆ°æ—¥å¿—æ”¶é›†å¹³å°åšæ±‡æ€»ï¼Œå¹¶æä¾›å®æ—¶æ—¥å¿—åˆ†æå’Œæœç´¢çš„åŠŸèƒ½ï¼Œè¿™æ ·ä»æ—¥å¿—äº§ç”Ÿåˆ°æœç´¢åˆ†æå‡ºç»“æœåªæœ‰ç®€çŸ­çš„å»¶è¿Ÿï¼ˆåœ¨ç”¨æˆ·å®¹å¿æ—¶é—´èŒƒå›´ä¹‹å†…ï¼‰ï¼Œä¼˜ç‚¹æ˜¯å¿«ï¼Œä½†æ˜¯æ—¥å¿—æ•°æ®é‡å¤§çš„æƒ…å†µä¸‹å¸¦æ¥çš„æŒ‘æˆ˜ä¹Ÿå¤§ã€‚ æ—¥å¿—é‡‡é›†å·¥å…·å¯¹æ¯”ä¸Šé¢æåˆ°çš„æ—¥å¿—é‡‡é›†ï¼Œå…¶å®ç°åœ¨å·²ç»æœ‰å¾ˆå¤šå¼€æºçš„ç»„ä»¶æ”¯æŒå»é‡‡é›†æ—¥å¿—ï¼Œæ¯”å¦‚ Logstashã€Filebeatã€Fluentdã€Logagent ç­‰ï¼Œè¿™é‡Œç®€å•åšä¸ªå¯¹æ¯”ã€‚ LogstashLogstash æ˜¯ä¸€ä¸ªå¼€æºæ•°æ®æ”¶é›†å¼•æ“ï¼Œå…·æœ‰å®æ—¶ç®¡é“åŠŸèƒ½ã€‚Logstash å¯ä»¥åŠ¨æ€åœ°å°†æ¥è‡ªä¸åŒæ•°æ®æºçš„æ•°æ®ç»Ÿä¸€èµ·æ¥ï¼Œå¹¶å°†æ•°æ®æ ‡å‡†åŒ–åˆ°ä½ æ‰€é€‰æ‹©çš„ç›®çš„åœ°ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒLogstash å°†é‡‡é›†åˆ°çš„æ•°æ®ç”¨ä½œåˆ†æã€ç›‘æ§ã€å‘Šè­¦ç­‰ã€‚ ä¼˜åŠ¿ï¼šLogstash ä¸»è¦çš„ä¼˜ç‚¹å°±æ˜¯å®ƒçš„çµæ´»æ€§ï¼Œå®ƒæä¾›å¾ˆå¤šæ’ä»¶ï¼Œè¯¦ç»†çš„æ–‡æ¡£ä»¥åŠç›´ç™½çš„é…ç½®æ ¼å¼è®©å®ƒå¯ä»¥åœ¨å¤šç§åœºæ™¯ä¸‹åº”ç”¨ã€‚è€Œä¸”ç°åœ¨ ELK æ•´ä¸ªæŠ€æœ¯æ ˆåœ¨å¾ˆå¤šå…¬å¸åº”ç”¨çš„æ¯”è¾ƒå¤šï¼Œæ‰€ä»¥åŸºæœ¬ä¸Šå¯ä»¥åœ¨å¾€ä¸Šæ‰¾åˆ°å¾ˆå¤šç›¸å…³çš„å­¦ä¹ èµ„æºã€‚ åŠ£åŠ¿ï¼šLogstash è‡´å‘½çš„é—®é¢˜æ˜¯å®ƒçš„æ€§èƒ½ä»¥åŠèµ„æºæ¶ˆè€—(é»˜è®¤çš„å †å¤§å°æ˜¯ 1GB)ã€‚å°½ç®¡å®ƒçš„æ€§èƒ½åœ¨è¿‘å‡ å¹´å·²ç»æœ‰å¾ˆå¤§æå‡ï¼Œä¸å®ƒçš„æ›¿ä»£è€…ä»¬ç›¸æ¯”è¿˜æ˜¯è¦æ…¢å¾ˆå¤šçš„ï¼Œå®ƒåœ¨å¤§æ•°æ®é‡çš„æƒ…å†µä¸‹ä¼šæ˜¯ä¸ªé—®é¢˜ã€‚å¦ä¸€ä¸ªé—®é¢˜æ˜¯å®ƒç›®å‰ä¸æ”¯æŒç¼“å­˜ï¼Œç›®å‰çš„å…¸å‹æ›¿ä»£æ–¹æ¡ˆæ˜¯å°† Redis æˆ– Kafka ä½œä¸ºä¸­å¿ƒç¼“å†²æ± ï¼š Filebeatä½œä¸º Beats å®¶æ—çš„ä¸€å‘˜ï¼ŒFilebeat æ˜¯ä¸€ä¸ªè½»é‡çº§çš„æ—¥å¿—ä¼ è¾“å·¥å…·ï¼Œå®ƒçš„å­˜åœ¨æ­£å¼¥è¡¥äº† Logstash çš„ç¼ºç‚¹ï¼ŒFilebeat ä½œä¸ºä¸€ä¸ªè½»é‡çº§çš„æ—¥å¿—ä¼ è¾“å·¥å…·å¯ä»¥å°†æ—¥å¿—æ¨é€åˆ° Kafkaã€Logstashã€ElasticSearchã€Redisã€‚å®ƒçš„å¤„ç†æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä¼˜åŠ¿ï¼šFilebeat åªæ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶æ²¡æœ‰ä»»ä½•ä¾èµ–ã€‚å®ƒå ç”¨èµ„æºæå°‘ï¼Œå°½ç®¡å®ƒè¿˜ååˆ†å¹´è½»ï¼Œæ­£å¼å› ä¸ºå®ƒç®€å•ï¼Œæ‰€ä»¥å‡ ä¹æ²¡æœ‰ä»€ä¹ˆå¯ä»¥å‡ºé”™çš„åœ°æ–¹ï¼Œæ‰€ä»¥å®ƒçš„å¯é æ€§è¿˜æ˜¯å¾ˆé«˜çš„ã€‚å®ƒä¹Ÿä¸ºæˆ‘ä»¬æä¾›äº†å¾ˆå¤šå¯ä»¥è°ƒèŠ‚çš„ç‚¹ï¼Œä¾‹å¦‚ï¼šå®ƒä»¥ä½•ç§æ–¹å¼æœç´¢æ–°çš„æ–‡ä»¶ï¼Œä»¥åŠå½“æ–‡ä»¶æœ‰ä¸€æ®µæ—¶é—´æ²¡æœ‰å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä½•æ—¶é€‰æ‹©å…³é—­æ–‡ä»¶å¥æŸ„ã€‚ åŠ£åŠ¿ï¼šFilebeat çš„åº”ç”¨èŒƒå›´ååˆ†æœ‰é™ï¼Œæ‰€ä»¥åœ¨æŸäº›åœºæ™¯ä¸‹æˆ‘ä»¬ä¼šç¢°åˆ°é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½¿ç”¨ Logstash ä½œä¸ºä¸‹æ¸¸ç®¡é“ï¼Œæˆ‘ä»¬åŒæ ·ä¼šé‡åˆ°æ€§èƒ½é—®é¢˜ã€‚æ­£å› ä¸ºå¦‚æ­¤ï¼ŒFilebeat çš„èŒƒå›´åœ¨æ‰©å¤§ã€‚å¼€å§‹æ—¶ï¼Œå®ƒåªèƒ½å°†æ—¥å¿—å‘é€åˆ° Logstash å’Œ Elasticsearchï¼Œè€Œç°åœ¨å®ƒå¯ä»¥å°†æ—¥å¿—å‘é€ç»™ Kafka å’Œ Redisï¼Œåœ¨ 5.x ç‰ˆæœ¬ä¸­ï¼Œå®ƒè¿˜å…·å¤‡è¿‡æ»¤çš„èƒ½åŠ›ã€‚ FluentdFluentd åˆ›å»ºçš„åˆè¡·ä¸»è¦æ˜¯å°½å¯èƒ½çš„ä½¿ç”¨ JSON ä½œä¸ºæ—¥å¿—è¾“å‡ºï¼Œæ‰€ä»¥ä¼ è¾“å·¥å…·åŠå…¶ä¸‹æ¸¸çš„ä¼ è¾“çº¿ä¸éœ€è¦çŒœæµ‹å­å­—ç¬¦ä¸²é‡Œé¢å„ä¸ªå­—æ®µçš„ç±»å‹ã€‚è¿™æ ·å®ƒä¸ºå‡ ä¹æ‰€æœ‰çš„è¯­è¨€éƒ½æä¾›åº“ï¼Œè¿™ä¹Ÿæ„å‘³ç€å¯ä»¥å°†å®ƒæ’å…¥åˆ°è‡ªå®šä¹‰çš„ç¨‹åºä¸­ã€‚å®ƒçš„å¤„ç†æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä¼˜åŠ¿ï¼šå’Œå¤šæ•° Logstash æ’ä»¶ä¸€æ ·ï¼ŒFluentd æ’ä»¶æ˜¯ç”¨ Ruby è¯­è¨€å¼€å‘çš„éå¸¸æ˜“äºç¼–å†™ç»´æŠ¤ã€‚æ‰€ä»¥å®ƒæ•°é‡å¾ˆå¤šï¼Œå‡ ä¹æ‰€æœ‰çš„æºå’Œç›®æ ‡å­˜å‚¨éƒ½æœ‰æ’ä»¶(å„ä¸ªæ’ä»¶çš„æˆç†Ÿåº¦ä¹Ÿä¸å¤ªä¸€æ ·)ã€‚è¿™ä¹Ÿæ„å‘³è¿™å¯ä»¥ç”¨ Fluentd æ¥ä¸²è”æ‰€æœ‰çš„ä¸œè¥¿ã€‚ åŠ£åŠ¿ï¼šå› ä¸ºåœ¨å¤šæ•°åº”ç”¨åœºæ™¯ä¸‹å¾—åˆ° Fluentd ç»“æ„åŒ–çš„æ•°æ®ï¼Œå®ƒçš„çµæ´»æ€§å¹¶ä¸å¥½ã€‚ä½†æ˜¯ä»ç„¶å¯ä»¥é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼æ¥è§£æéç»“æ„åŒ–çš„æ•°æ®ã€‚å°½ç®¡æ€§èƒ½åœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹éƒ½å¾ˆå¥½ï¼Œä½†å®ƒå¹¶ä¸æ˜¯æœ€å¥½çš„ï¼Œå®ƒçš„ç¼“å†²åªå­˜åœ¨ä¸è¾“å‡ºç«¯ï¼Œå•çº¿ç¨‹æ ¸å¿ƒä»¥åŠ Ruby GIL å®ç°çš„æ’ä»¶æ„å‘³ç€å®ƒå¤§çš„èŠ‚ç‚¹ä¸‹æ€§èƒ½æ˜¯å—é™çš„ã€‚ LogagentLogagent æ˜¯ Sematext æä¾›çš„ä¼ è¾“å·¥å…·ï¼Œå®ƒç”¨æ¥å°†æ—¥å¿—ä¼ è¾“åˆ° Logsene(ä¸€ä¸ªåŸºäº SaaS å¹³å°çš„ Elasticsearch API)ï¼Œå› ä¸º Logsene ä¼šæš´éœ² Elasticsearch APIï¼Œæ‰€ä»¥ Logagent å¯ä»¥å¾ˆå®¹æ˜“å°†æ•°æ®æ¨é€åˆ° Elasticsearch ã€‚ ä¼˜åŠ¿ï¼šå¯ä»¥è·å– /var/log ä¸‹çš„æ‰€æœ‰ä¿¡æ¯ï¼Œè§£æå„ç§æ ¼å¼çš„æ—¥å¿—ï¼Œå¯ä»¥æ©ç›–æ•æ„Ÿçš„æ•°æ®ä¿¡æ¯ã€‚å®ƒè¿˜å¯ä»¥åŸºäº IP åš GeoIP ä¸°å¯Œåœ°ç†ä½ç½®ä¿¡æ¯ã€‚åŒæ ·ï¼Œå®ƒè½»é‡åˆå¿«é€Ÿï¼Œå¯ä»¥å°†å…¶ç½®å…¥ä»»ä½•æ—¥å¿—å—ä¸­ã€‚Logagent æœ‰æœ¬åœ°ç¼“å†²ï¼Œæ‰€ä»¥åœ¨æ•°æ®ä¼ è¾“ç›®çš„åœ°ä¸å¯ç”¨æ—¶ä¸ä¼šä¸¢å¤±æ—¥å¿—ã€‚ åŠ£åŠ¿ï¼šæ²¡æœ‰ Logstash çµæ´»ã€‚ æ—¥å¿—ç»“æ„è®¾è®¡å‰é¢ä»‹ç»äº†æ—¥å¿—å’Œå¯¹æ¯”äº†å¸¸ç”¨æ—¥å¿—é‡‡é›†å·¥å…·çš„ä¼˜åŠ¿å’ŒåŠ£åŠ¿ï¼Œé€šå¸¸åœ¨ä¸åŒç¯å¢ƒï¼Œä¸åŒæœºå™¨ä¸Šéƒ½ä¼šéƒ¨ç½²æ—¥å¿—é‡‡é›†å·¥å…·ï¼Œç„¶åé‡‡é›†å·¥å…·ä¼šå®æ—¶çš„å°†æ–°çš„æ—¥å¿—é‡‡é›†å‘é€åˆ°ä¸‹æ¸¸ï¼Œå› ä¸ºæ—¥å¿—æ•°æ®é‡æ¯•ç«Ÿå¤§ï¼Œæ‰€ä»¥å»ºè®®å‘åˆ° MQ ä¸­ï¼Œæ¯”å¦‚ Kafkaï¼Œè¿™æ ·å†æƒ³æ€ä¹ˆå¤„ç†è¿™äº›æ—¥å¿—å°±ä¼šæ¯”è¾ƒçµæ´»ã€‚å‡è®¾æˆ‘ä»¬å¿½ç•¥åº•å±‚é‡‡é›†å…·ä½“æ˜¯å“ªç§ï¼Œä½†æ˜¯è§„å®šé‡‡é›†å¥½çš„æ—¥å¿—ç»“æ„åŒ–æ•°æ®å¦‚ä¸‹ï¼š 12345678public class LogEvent &#123; private String type;//æ—¥å¿—çš„ç±»å‹(åº”ç”¨ã€å®¹å™¨ã€...) private Long timestamp;//æ—¥å¿—çš„æ—¶é—´æˆ³ private String level;//æ—¥å¿—çš„çº§åˆ«(debug/info/warn/error) private String message;//æ—¥å¿—å†…å®¹ //æ—¥å¿—çš„æ ‡è¯†(åº”ç”¨ IDã€åº”ç”¨åã€å®¹å™¨ IDã€æœºå™¨ IPã€é›†ç¾¤åã€...) private Map&lt;String, String&gt; tags = new HashMap&lt;&gt;();&#125; ç„¶åä¸Šé¢è¿™ç§ LogEvent çš„æ•°æ®ï¼ˆå‡è®¾é‡‡é›†å‘ä¸Šæ¥çš„æ˜¯è¿™ç§ç»“æ„æ•°æ®çš„ JSON ä¸²ï¼Œæ‰€ä»¥éœ€è¦åœ¨ Flink ä¸­åšä¸€ä¸ªååºåˆ—åŒ–è§£æï¼‰å°±ä¼šå¾€ Kafka ä¸æ–­çš„å‘é€æ•°æ®ï¼Œæ ·ä¾‹æ•°æ®å¦‚ä¸‹ï¼š 123456789101112&#123; \"type\": \"app\", \"timestamp\": 1570941591229, \"level\": \"error\", \"message\": \"Exception in thread \\\"main\\\" java.lang.NoClassDefFoundError: org/apache/flink/api/common/ExecutionConfig$GlobalJobParameters\", \"tags\": &#123; \"cluster_name\": \"zhisheng\", \"app_name\": \"zhisheng\", \"host_ip\": \"127.0.0.1\", \"app_id\": \"21\" &#125;&#125; é‚£ä¹ˆåœ¨ Flink ä¸­å¦‚ä½•å°†åº”ç”¨å¼‚å¸¸æˆ–è€…é”™è¯¯çš„æ—¥å¿—åšå®æ—¶å‘Šè­¦å‘¢ï¼Ÿ å¼‚å¸¸æ—¥å¿—å®æ—¶å‘Šè­¦é¡¹ç›®æ¶æ„æ•´ä¸ªå¼‚å¸¸æ—¥å¿—å®æ—¶å‘Šè­¦é¡¹ç›®çš„æ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ åº”ç”¨æ—¥å¿—æ•£åˆ—åœ¨ä¸åŒçš„æœºå™¨ï¼Œç„¶åæ¯å°æœºå™¨éƒ½æœ‰éƒ¨ç½²é‡‡é›†æ—¥å¿—çš„ Agentï¼ˆå¯ä»¥æ˜¯ä¸Šé¢çš„ Filebeatã€Logstash ç­‰ï¼‰ï¼Œè¿™äº› Agent ä¼šå®æ—¶çš„å°†åˆ†æ•£åœ¨ä¸åŒæœºå™¨ã€ä¸åŒç¯å¢ƒçš„åº”ç”¨æ—¥å¿—ç»Ÿä¸€çš„é‡‡é›†å‘åˆ° Kafka é›†ç¾¤ä¸­ï¼Œç„¶åå‘Šè­¦è¿™è¾¹æ˜¯æœ‰ä¸€ä¸ª Flink ä½œä¸šå»å®æ—¶çš„æ¶ˆè´¹ Kafka æ•°æ®åšä¸€ä¸ªå¼‚å¸¸å‘Šè­¦è®¡ç®—å¤„ç†ã€‚å¦‚æœè¿˜æƒ³åšæ—¥å¿—çš„æœç´¢åˆ†æï¼Œå¯ä»¥èµ·å¦å¤–ä¸€ä¸ªä½œä¸šå»å®æ—¶çš„å°† Kafka çš„æ—¥å¿—æ•°æ®å†™å…¥è¿› ElasticSearchï¼Œå†é€šè¿‡ Kibana é¡µé¢åšæœç´¢å’Œåˆ†æã€‚ æ—¥å¿—æ•°æ®å‘é€åˆ° Kafkaä¸Šé¢å·²ç»è®²äº†æ—¥å¿—æ•°æ® LogEvent çš„ç»“æ„å’Œæ ·ä¾‹æ•°æ®ï¼Œå› ä¸ºè¦åœ¨æœåŠ¡å™¨éƒ¨ç½²é‡‡é›†å·¥å…·å»é‡‡é›†åº”ç”¨æ—¥å¿—æ•°æ®å¯¹äºæœ¬åœ°æµ‹è¯•æ¥è¯´å¯èƒ½ç¨å¾®å¤æ‚ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œå°±åªé€šè¿‡ä»£ç æ¨¡æ‹Ÿæ„é€ æ•°æ®å‘åˆ° Kafka å»ï¼Œç„¶ååœ¨ Flink ä½œä¸šä¸­å»å®æ—¶æ¶ˆè´¹ Kafka ä¸­çš„æ•°æ®ï¼Œä¸‹é¢æ¼”ç¤ºæ„é€ æ—¥å¿—æ•°æ®å‘åˆ° Kafka çš„å·¥å…·ç±»ï¼Œè¿™ä¸ªå·¥å…·ç±»ä¸»è¦åˆ†ä¸¤å—ï¼Œæ„é€  LogEvent æ•°æ®å’Œå‘é€åˆ° Kafkaã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384@Slf4jpublic class BuildLogEventDataUtil &#123; //Kafka broker å’Œ topic ä¿¡æ¯ public static final String BROKER_LIST = \"localhost:9092\"; public static final String LOG_TOPIC = \"zhisheng_log\"; public static void writeDataToKafka() &#123; Properties props = new Properties(); props.put(\"bootstrap.servers\", BROKER_LIST); props.put(\"key.serializer\", \"org.apache.kafka.common.serialization.StringSerializer\"); props.put(\"value.serializer\", \"org.apache.kafka.common.serialization.StringSerializer\"); KafkaProducer producer = new KafkaProducer&lt;String, String&gt;(props); for (int i = 0; i &lt; 10000; i++) &#123; //æ¨¡æ‹Ÿæ„é€  LogEvent å¯¹è±¡ LogEvent logEvent = new LogEvent().builder() .type(\"app\") .timestamp(System.currentTimeMillis()) .level(logLevel()) .message(message(i + 1)) .tags(mapData()) .build();// System.out.println(logEvent); ProducerRecord record = new ProducerRecord&lt;String, String&gt;(LOG_TOPIC, null, null, GsonUtil.toJson(logEvent)); producer.send(record); &#125; producer.flush(); &#125; public static void main(String[] args) &#123; writeDataToKafka(); &#125; public static String message(int i) &#123; return \"è¿™æ˜¯ç¬¬ \" + i + \" è¡Œæ—¥å¿—ï¼\"; &#125; public static String logLevel() &#123; Random random = new Random(); int number = random.nextInt(4); switch (number) &#123; case 0: return \"debug\"; case 1: return \"info\"; case 2: return \"warn\"; case 3: return \"error\"; default: return \"info\"; &#125; &#125; public static String hostIp() &#123; Random random = new Random(); int number = random.nextInt(4); switch (number) &#123; case 0: return \"121.12.17.10\"; case 1: return \"121.12.17.11\"; case 2: return \"121.12.17.12\"; case 3: return \"121.12.17.13\"; default: return \"121.12.17.10\"; &#125; &#125; public static Map&lt;String, String&gt; mapData() &#123; Map&lt;String, String&gt; map = new HashMap&lt;&gt;(); map.put(\"app_id\", \"11\"); map.put(\"app_name\", \"zhisheng\"); map.put(\"cluster_name\", \"zhisheng\"); map.put(\"host_ip\", hostIp()); map.put(\"class\", \"BuildLogEventDataUtil\"); map.put(\"method\", \"main\"); map.put(\"line\", String.valueOf(new Random().nextInt(100))); //add more tag return map; &#125;&#125; å¦‚æœä¹‹å‰ Kafka ä¸­æ²¡æœ‰ zhisheng_log è¿™ä¸ª topicï¼Œè¿è¡Œè¿™ä¸ªå·¥å…·ç±»ä¹‹åä¹Ÿä¼šè‡ªåŠ¨åˆ›å»ºè¿™ä¸ª topic äº†ã€‚ Flink å®æ—¶å¤„ç†æ—¥å¿—æ•°æ®åœ¨ 3.7 ç« ä¸­å·²ç»è®²è¿‡å¦‚ä½•ä½¿ç”¨ Flink Kafka connector äº†ï¼Œæ¥ä¸‹æ¥å°±ç›´æ¥å†™ä»£ç å»æ¶ˆè´¹ Kafka ä¸­çš„æ—¥å¿—æ•°æ®ï¼Œä½œä¸šä»£ç å¦‚ä¸‹ï¼š 1234567891011121314public class LogEventAlert &#123; public static void main(String[] args) throws Exception &#123; final ParameterTool parameterTool = ExecutionEnvUtil.createParameterTool(args); StreamExecutionEnvironment env = ExecutionEnvUtil.prepare(parameterTool); Properties properties = KafkaConfigUtil.buildKafkaProps(parameterTool); FlinkKafkaConsumer011&lt;LogEvent&gt; consumer = new FlinkKafkaConsumer011&lt;&gt;( parameterTool.get(\"log.topic\"), new LogSchema(), properties); env.addSource(consumer) .print(); env.execute(\"log event alert\"); &#125;&#125; å› ä¸º Kafka çš„æ—¥å¿—æ•°æ®æ˜¯ JSON çš„ï¼Œæ‰€ä»¥åœ¨æ¶ˆè´¹çš„æ—¶å€™éœ€è¦é¢å¤–å®šä¹‰ Schema æ¥ååºåˆ—åŒ–æ•°æ®ï¼Œå®šä¹‰çš„ LogSchema å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324public class LogSchema implements DeserializationSchema&lt;LogEvent&gt;, SerializationSchema&lt;LogEvent&gt; &#123; private static final Gson gson = new Gson(); @Override public LogEvent deserialize(byte[] bytes) throws IOException &#123; return gson.fromJson(new String(bytes), LogEvent.class); &#125; @Override public boolean isEndOfStream(LogEvent logEvent) &#123; return false; &#125; @Override public byte[] serialize(LogEvent logEvent) &#123; return gson.toJson(logEvent).getBytes(Charset.forName(\"UTF-8\")); &#125; @Override public TypeInformation&lt;LogEvent&gt; getProducedType() &#123; return TypeInformation.of(LogEvent.class); &#125;&#125; é…ç½®æ–‡ä»¶ä¸­è®¾ç½®å¦‚ä¸‹ï¼š 123kafka.brokers=localhost:9092kafka.group.id=zhishenglog.topic=zhisheng_log æ¥ä¸‹æ¥å…ˆå¯åŠ¨ Kafkaï¼Œç„¶åè¿è¡Œ BuildLogEventDataUtil å·¥å…·ç±»ï¼Œå¾€ Kafka ä¸­å‘é€æ¨¡æ‹Ÿçš„æ—¥å¿—æ•°æ®ï¼Œæ¥ä¸‹æ¥è¿è¡Œ LogEventAlert ç±»ï¼Œå»æ¶ˆè´¹å°† Kafka ä¸­çš„æ•°æ®åšä¸€ä¸ªéªŒè¯ï¼Œè¿è¡Œç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¯ä»¥å‘ç°æœ‰æ—¥å¿—æ•°æ®æ‰“å°å‡ºæ¥äº†ã€‚ å¤„ç†åº”ç”¨å¼‚å¸¸æ—¥å¿—ä¸Šé¢å·²ç»èƒ½å¤Ÿå¤„ç†è¿™äº›æ—¥å¿—æ•°æ®äº†ï¼Œä½†æ˜¯éœ€æ±‚æ˜¯è¦å°†åº”ç”¨çš„å¼‚å¸¸æ—¥å¿—åšå‘Šè­¦ï¼Œæ‰€ä»¥åœ¨æ¶ˆè´¹åˆ°æ‰€æœ‰çš„æ•°æ®åéœ€è¦è¿‡æ»¤å‡ºå¼‚å¸¸çš„æ—¥å¿—ï¼Œæ¯”å¦‚å¯ä»¥ä½¿ç”¨ filter ç®—å­è¿›è¡Œè¿‡æ»¤ã€‚ 1.filter(logEvent -&gt; \"error\".equals(logEvent.getLevel())) è¿‡æ»¤ååªæœ‰ error çš„æ—¥å¿—æ•°æ®æ‰“å°å‡ºæ¥äº†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å†å°†ä½œä¸šæ‰“åŒ…é€šè¿‡ UI æäº¤åˆ°é›†ç¾¤è¿è¡Œçš„ç»“æœå¦‚ä¸‹ï¼š å†è·å–åˆ°è¿™äº› Error ç±»å‹çš„æ•°æ®åï¼Œå°±å¯ä»¥æ ¹æ®è¿™ä¸ªæ•°æ®æ„é€ æˆä¸€ä¸ªæ–°çš„ Eventï¼Œç»„è£…æˆå‘Šè­¦æ¶ˆæ¯ï¼Œç„¶ååœ¨ Sink å¤„è°ƒç”¨ä¸‹æ¸¸çš„é€šçŸ¥ç­–ç•¥è¿›è¡Œå‘Šè­¦é€šçŸ¥ï¼Œå½“ç„¶è¿™äº›å‘Šè­¦é€šçŸ¥ç­–ç•¥å¯èƒ½ä¼šå¾ˆå¤šï¼Œç„¶åè¿˜æœ‰æ”¶æ•›ç­–ç•¥ã€‚å…·ä½“çš„é€šçŸ¥ç­–ç•¥å’Œæ”¶æ•›ç­–ç•¥åœ¨è¿™èŠ‚ä¸åšç»†è®²ï¼Œæœ€åå‘å‡ºçš„åº”ç”¨å¼‚å¸¸æ—¥å¿—å‘Šè­¦æ¶ˆæ¯ä¸­ä¼šæºå¸¦ä¸€ä¸ªé“¾æ¥ï¼Œç‚¹å‡»è¯¥é“¾æ¥å¯ä»¥è·³è½¬åˆ°å¯¹åº”çš„åº”ç”¨å¼‚å¸¸é¡µé¢ï¼Œè¿™æ ·å°±å¯ä»¥æŸ¥çœ‹åº”ç”¨å †æ ˆçš„è¯¦ç»†æ—¥å¿—ï¼Œæ›´åŠ å¥½å®šä½é—®é¢˜ã€‚ å°ç»“ä¸åæ€æœ¬èŠ‚å¼€å§‹è®²äº†æ—¥å¿—å¤„ç†æ–¹æ¡ˆçš„æ¼”è¿›ï¼Œæ¥ç€åˆ†ææœ€æ–°æ—¥å¿—æ–¹æ¡ˆçš„å®ç°æ¶æ„ï¼ŒåŒ…å«å®ƒçš„æ—¥å¿—ç»“æ„è®¾è®¡å’Œå¼‚å¸¸æ—¥å¿—å®æ—¶å‘Šè­¦çš„æ–¹æ¡ˆï¼Œç„¶åé€šè¿‡æ¨¡æ‹Ÿæ—¥å¿—æ•°æ®å‘é€åˆ° Kafkaï¼ŒFlink å®æ—¶å»å¤„ç†è¿™ç§æ—¥å¿—çš„æ•°æ®è¿›è¡Œå‘Šè­¦ã€‚ æœ¬èŠ‚æ¶‰åŠçš„ä»£ç åœ°å€ï¼šflink-learning-monitor-alert å…³æ³¨æˆ‘å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f Github ä»£ç ä»“åº“https://github.com/zhisheng17/flink-learning/ ä»¥åè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç éƒ½å°†æ”¾åœ¨è¿™ä¸ªä»“åº“é‡Œï¼ŒåŒ…å«äº†è‡ªå·±å­¦ä¹  flink çš„ä¸€äº› demo å’Œåšå®¢ åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€å®æˆ˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"å®æ—¶è®¡ç®—","slug":"å®æ—¶è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/å®æ—¶è®¡ç®—/"}]},{"title":"Flink èƒ½å¦åŠ¨æ€æ›´æ”¹ Checkpoint é…ç½®","date":"2020-02-28T16:00:00.000Z","path":"2020/02/29/flink-nacos-checkpoint/","text":"å‰æ®µæ—¶é—´åœ¨ç¤¾åŒºé‚®ä»¶ä¸­çœ‹åˆ°æœ‰äººæé—®æ˜¯å¦å¯ä»¥åŠ¨æ€å¼€å¯ Checkpointï¼Œæ˜¨å¤©åœ¨é’‰é’‰ç¾¤ä¸­åˆçœ‹åˆ°æœ‰ä¸ªåŒå­¦åœ¨é—®èƒ½å¤ŸåŠ¨æ€è°ƒæ•´ Checkpoint çš„æ—¶é—´ï¼Œå…¶å®ä¸ä»…ä»…æ˜¯è¿™äº›ï¼Œåœ¨ç¤¾åŒºé‚®ä»¶å’Œç¾¤é‡Œç»å¸¸çœ‹åˆ°æœ‰é—®è¿™å—å†…å®¹çš„é—®é¢˜ï¼Œæ‰€ä»¥å¯ä»¥å‘ç°åœ¨ Flink ä¸­å…¶å®å…³äº Checkpoint ç›¸å…³çš„ä¸œè¥¿è¿˜æ˜¯éå¸¸é‡è¦ä¸”è§£å†³èµ·æ¥æ¯”è¾ƒéº»çƒ¦ï¼Œä¼°è®¡åº”è¯¥ä¹Ÿå›°æ‰°äº†ä¸å°‘äººã€‚ ä¸è¿‡ä»Šå¤©çš„è¯é¢˜ä¸æ˜¯åœ¨äºå»è®¨è®º Checkpoint çš„æœºåˆ¶ï¼Œå› ä¸ºå‰é¢ä¸¤ä¸ªé—®é¢˜éƒ½æ¶‰åŠåˆ°äº†åŠ¨æ€çš„å»é…ç½® Checkpoint çš„å‚æ•°ï¼ˆæ˜¯å¦å¼€å¯å’Œ Checkpoint çš„æ—¶é—´é—´éš”ï¼‰ï¼Œè€Œ zhisheng æˆ‘åœ¨å‰é¢é€šè¿‡ä¸¤ä¸ªè§†é¢‘è®²è§£äº† Flink å¦‚ä½•ä¸ Apollo å’Œ Nacos æ•´åˆå»åŠ¨æ€çš„æ›´æ”¹ä½œä¸šé…ç½®ï¼Œæ‰€ä»¥ç§åº•ä¸‹å°±æœ‰åŒå­¦æ‰¾æˆ‘å’¨è¯¢æ˜¯å¦å¯ä»¥åŠ¨æ€çš„æ›´æ”¹ Checkpoint é…ç½®ï¼Œæˆ‘å½“æ—¶å› ä¸ºçŸ¥é“å…¶å®æœ‰äº›å‚æ•°æ˜¯ä¸€æ—¦åˆå§‹åŒ–äº†ä¹‹åæ˜¯æ”¹ä¸äº†çš„ï¼Œä½†æ˜¯å…·ä½“ä»€ä¹ˆå‚æ•°æˆ‘ä¹Ÿä¸éš¾å…¨éƒ¨åˆ—ä¸¾ï¼Œæ‰€ä»¥åªå¥½å›ç­”é‚£ä½åŒå­¦è¯´ï¼šä»¥è‡ªå·±å®æµ‹çš„ç»“æœä¸ºå‡†å“ˆã€‚ æ‰€ä»¥è¿™é‡Œæˆ‘å°±ç»™å¤§å®¶æ¼”ç¤ºä¸€ä¸‹åˆ°åº•æ˜¯å¦å¯ä»¥åŠ¨æ€çš„æ›´æ”¹ Checkpoint é…ç½®ï¼Œè¯·çœ‹æˆ‘åœ¨ B ç«™çš„è§†é¢‘ï¼š https://www.bilibili.com/video/av92655075/ é€šè¿‡è¿™ä¸ªè§†é¢‘ï¼Œè™½ç„¶æˆ‘æ˜¯ä½¿ç”¨ Flink å’Œ Nacos æ•´åˆçš„ï¼Œä½œä¸šç›‘å¬åˆ°äº† Checkpoint çš„é…ç½®åšäº†ä¿®æ”¹ï¼Œä½†æ˜¯å¯ä»¥å‘ç°å…¶å® Checkpoint æ›´æ”¹åå…¶å®æ˜¯ä¸ç”Ÿæ•ˆçš„ã€‚ è¿™é‡Œä»…ä»ä¸ªäººçš„æ€è€ƒæ¥è§£é‡Šä¸€ä¸‹ï¼šå› ä¸º Flink æ˜¯ Lazy Evaluationï¼ˆå»¶è¿Ÿæ‰§è¡Œï¼‰ï¼Œå½“ç¨‹åºçš„ main æ–¹æ³•æ‰§è¡Œæ—¶ï¼Œæˆ‘ä»¬åˆ›å»ºçš„ env ä¼šä¾æ¬¡è¿›è¡Œå±æ€§çš„åˆå§‹åŒ–é…ç½®ï¼Œä½†æ˜¯æ•°æ®æºåŠ è½½æ•°æ®å’Œæ•°æ®è½¬æ¢ç­‰ç®—å­ä¸ä¼šç«‹é©¬æ‰§è¡Œï¼Œè¿™äº›ç®—å­æ“ä½œä¼šè¢«åˆ›å»ºå¹¶æ·»åŠ åˆ°ç¨‹åºçš„æ‰§è¡Œè®¡åˆ’ä¸­å»ï¼Œåªæœ‰å½“æ‰§è¡Œç¯å¢ƒ env çš„ execute æ–¹æ³•è¢«æ˜¾ç¤ºåœ°è§¦å‘æ‰§è¡Œæ—¶ï¼Œæ•´ä¸ªç¨‹åºæ‰å¼€å§‹æ‰§è¡Œå®é™…çš„æ“ä½œï¼ˆStreamGraph -&gt; JobGraph -&gt; ExecutionGraphï¼‰ï¼Œæ‰€ä»¥åœ¨ç¨‹åºæ‰§è¡Œ execute æ–¹æ³•åå†ä¿®æ”¹ env çš„é…ç½®å…¶å®å°±ä¸èµ·ä½œç”¨äº†ã€‚ å¦å¤–ç»™å¤§å®¶æ¥çœ‹ä¸‹é‚±ä»è´¤(è´Ÿè´£ Flink State ç›¸å…³)å¯¹èƒ½å¦åŠ¨æ€é…ç½® Checkpoint çš„å›ç­”ï¼š ç›¸å…³çš„æµ‹è¯•ä»£ç åœ¨: https://github.com/zhisheng17/flink-learning/blob/master/flink-learning-configration-center/flink-learning-configration-center-nacos æœ€åGitHub Flink å­¦ä¹ ä»£ç åœ°å€ï¼šhttps://github.com/zhisheng17/flink-learning å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€åŸç†ã€å®æˆ˜ã€æ€§èƒ½è°ƒä¼˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"},{"name":"Nacos","slug":"Nacos","permalink":"http://www.54tianzhisheng.cn/tags/Nacos/"}]},{"title":"Flink æ•´åˆ Apolloï¼ŒåŠ¨æ€æ›´æ–° Flink ä½œä¸šé…ç½®","date":"2020-02-22T16:00:00.000Z","path":"2020/02/23/flink-apollo/","text":"æœ¬äººè‡ªå·±å½•çš„è§†é¢‘ï¼Œè®²è§£ Flink æ•´å’Œ Apolloï¼ŒåŠ¨æ€æ›´æ–°ä½œä¸šé…ç½®ï¼Œæ— éœ€é‡å¯ä½œä¸šï¼ åœ¨ä¸Šä¸€ç¯‡è®²è§£ Flink ä¸ Nacos æ•´åˆçš„è§†é¢‘ ä¸­ï¼Œè®²è¿‡äº†å¸¸è§çš„å‡ ç§æ›´æ–°é…ç½®çš„æ–¹æ³•ï¼Œæœ€å¸¸ä½¿ç”¨çš„å¯èƒ½å°±æ˜¯é€šè¿‡å¹¿æ’­æµçš„æ–¹å¼ï¼Œç›¸ä¿¡çœ‹å®Œä¸Šä¸ªè§†é¢‘çš„ï¼Œä¼°è®¡å¯¹æ•´åˆ Nacos åšåŠ¨æ€æ›´æ–°é…ç½®åº”è¯¥é—®é¢˜ä¸å¤§ï¼Œzhisheng æˆ‘ä¹Ÿè§‰å¾—ç¨å¾®ç®€å•ï¼Œå°¤å…¶ Nacos æ­å»ºå®‰è£…ä¹Ÿæ¯”è¾ƒç®€å•ã€‚ä¸çŸ¥é“å¤§å®¶å…¬å¸æœ‰æ²¡æœ‰ä½¿ç”¨ Nacos å‘¢ï¼Ÿæˆ‘çŸ¥é“æœ‰çš„å…¬å¸ä½¿ç”¨ Apollo å±…å¤šï¼Œæ‰€ä»¥åé¢å°±æœ‰è¯»è€…é—®æˆ‘èƒ½ä¸èƒ½å‡ºä¸ªæ•´åˆ Apollo çš„è§†é¢‘ï¼Œæ‰€ä»¥æˆ‘è¶ç€å‘¨æœ«å¤§æ™šä¸Šçš„æ—¶é—´å°±å¼€å§‹æŠ˜è…¾äº†ä¸€ç•ªï¼Œæœ¬ç¯‡æ–‡ç« å°†ç»™å¤§å®¶è®²è§£ä¸ Apollo æ•´åˆï¼ŒåŠ¨æ€çš„æ›´æ–° Flink é…ç½®ã€‚ Apolloï¼ˆé˜¿æ³¢ç½—ï¼‰æ˜¯æºç¨‹æ¡†æ¶éƒ¨é—¨ç ”å‘çš„åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒï¼Œèƒ½å¤Ÿé›†ä¸­åŒ–ç®¡ç†åº”ç”¨ä¸åŒç¯å¢ƒã€ä¸åŒé›†ç¾¤çš„é…ç½®ï¼Œé…ç½®ä¿®æ”¹åèƒ½å¤Ÿå®æ—¶æ¨é€åˆ°åº”ç”¨ç«¯ï¼Œå¹¶ä¸”å…·å¤‡è§„èŒƒçš„æƒé™ã€æµç¨‹æ²»ç†ç­‰ç‰¹æ€§ï¼Œé€‚ç”¨äºå¾®æœåŠ¡é…ç½®ç®¡ç†åœºæ™¯ã€‚ å› ä¸ºå®ƒçš„è‡ªèº«æ¶æ„åŸå› ï¼Œå¯¼è‡´å®‰è£…å¯èƒ½ä¼šæ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦å®‰è£…å¥½å¤šä¸ªç»„ä»¶ï¼Œä¸ªäººè§‰å¾—æ¯” Nacos å¤æ‚ï¼Œå¹¸å¥½çš„æ˜¯å®˜æ–¹çš„æ–‡æ¡£æ¯”è¾ƒè¯¦ç»†ï¼Œè·Ÿç€å®‰è£…æ­¥éª¤æ¥è¯´è¿˜æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚zhisheng æˆ‘æ˜¯åªåœ¨è‡ªå·± Mac ç”µè„‘ä¸Šé¢å®‰è£…äº†ä¸€ä¸ªå•æœºç‰ˆçš„ï¼Œä»…ä¸ºæµ‹è¯•ä½¿ç”¨ã€‚ å¿«é€Ÿä¸Šæ‰‹çš„è¯·å‚è€ƒè¯¥é“¾æ¥ https://github.com/nobodyiam/apollo-build-scriptsï¼Œè¿™æ ·ä½ å°±èƒ½å¤Ÿåœ¨å‡ åˆ†é’Ÿå†…åœ¨æœ¬åœ°ç¯å¢ƒéƒ¨ç½²ã€å¯åŠ¨ Apollo é…ç½®ä¸­å¿ƒã€‚å¦å¤–è¿˜æä¾›äº† Quick Start çš„ Docker ç‰ˆæœ¬ï¼Œå¦‚æœä½ å¯¹ Docker æ¯”è¾ƒç†Ÿæ‚‰çš„è¯ï¼Œé‚£æ›´æ–¹ä¾¿äº†ã€‚ ä¸»è¦æ¼”ç¤ºæµç¨‹ï¼ˆå®‰è£… Apollo å’Œæ•´åˆ Flinkï¼‰ï¼Œæœ¬äººå½•äº†ä¸ªè§†é¢‘ï¼Œæ›´æ–¹ä¾¿å¤§å®¶å»å®æˆ˜æ“ä½œï¼Œæ¬¢è¿è§‚çœ‹ï¼š ä»£ç åœ°å€ï¼šhttps://github.com/zhisheng17/flink-learning/tree/master/flink-learning-configration-center/flink-learning-configration-center-apollo æ³¨æ„å¼•å…¥ Apollo çš„ä¾èµ–ï¼š 12345&lt;dependency&gt; &lt;groupId&gt;com.ctrip.framework.apollo&lt;/groupId&gt; &lt;artifactId&gt;apollo-client&lt;/artifactId&gt; &lt;version&gt;1.5.1&lt;/version&gt;&lt;/dependency&gt; æœ€åGitHub Flink å­¦ä¹ ä»£ç åœ°å€ï¼šhttps://github.com/zhisheng17/flink-learning å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€åŸç†ã€å®æˆ˜ã€æ€§èƒ½è°ƒä¼˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"},{"name":"Apollo","slug":"Apollo","permalink":"http://www.54tianzhisheng.cn/tags/Apollo/"}]},{"title":"Flink æ•´åˆ Nacosï¼Œè®© Flink ä½œä¸šé…ç½®åŠ¨æ€æ›´æ–°ä¸å†æ˜¯éš¾äº‹","date":"2020-02-21T16:00:00.000Z","path":"2020/02/22/flink-nacos/","text":"æœ¬äººè‡ªå·±å½•çš„è§†é¢‘ï¼Œè®²è§£ Flink æ•´å’Œ Nacosï¼ŒåŠ¨æ€æ›´æ–°ä½œä¸šé…ç½®ï¼Œæ— éœ€é‡å¯ä½œä¸šï¼ æˆ‘ä»¬çŸ¥é“ Flink ä½œä¸šçš„é…ç½®ä¸€èˆ¬éƒ½æ˜¯é€šè¿‡åœ¨ä½œä¸šå¯åŠ¨çš„æ—¶å€™é€šè¿‡å‚æ•°ä¼ é€’çš„ï¼Œæˆ–è€…é€šè¿‡è¯»å–é…ç½®æ–‡ä»¶çš„å‚æ•°ï¼Œåœ¨ä½œä¸šå¯åŠ¨ååˆå§‹åŒ–äº†ä¹‹åå¦‚æœå†æƒ³æ›´æ–°ä½œä¸šçš„é…ç½®ä¸€èˆ¬æœ‰ä¸¤ç§è§£å†³æ–¹æ³•ï¼š æ”¹å˜å¯åŠ¨å‚æ•°æˆ–è€…æ”¹å˜é…ç½®æ–‡ä»¶ï¼Œé‡å¯ä½œä¸šï¼Œè®©ä½œä¸šèƒ½å¤Ÿè¯»å–åˆ°ä¿®æ”¹åçš„é…ç½® é€šè¿‡è¯»å–é…ç½®æµï¼ˆéœ€è¦è‡ªå®šä¹‰ Source è¯»å–é…ç½®ï¼‰ï¼Œç„¶åæµå’Œæµè¿æ¥èµ·æ¥ è¿™ä¸¤ç§è§£å†³æ–¹æ³•ä¸€èˆ¬æ˜¯ä½¿ç”¨çš„æ¯”è¾ƒå¤šï¼Œå¯¹äºç¬¬ä¸€ç§æ–¹æ³•ï¼Œzhisheng æˆ‘æœ¬äººå…¶å®æ˜¯ä¸å¤ªå»ºè®®çš„ï¼Œé‡å¯ä½œä¸šä¼šå¸¦æ¥å¾ˆå¤šå½±å“ï¼ŒFlink ä½œä¸šå®Œæ•´çš„é‡å¯æµç¨‹åº”è¯¥æ˜¯ï¼šå½“ä½œä¸šåœæ‰çš„æ—¶å€™éœ€è¦å»åšä¸€æ¬¡ Savepointï¼ˆç›¸å½“äºæŠŠä½œä¸šçš„çŠ¶æ€åšä¸€æ¬¡å®Œæ•´çš„å¿«ç…§ï¼‰ï¼Œå¯åŠ¨çš„æ—¶å€™åˆéœ€è¦å°†ä½œä¸šä» Savepoint å¯åŠ¨ï¼Œæ•´ä¸ªæµç¨‹å¦‚æœçŠ¶æ€æ¯”è¾ƒå¤§çš„è¯ï¼Œåšä¸€æ¬¡ Savepoint å’Œä» Savepoint åˆå§‹åŒ–çš„æ—¶é—´ä¼šæ¯”è¾ƒä¹…ï¼Œç„¶è€Œæµå¤„ç†çš„åœºæ™¯ä¸‹é€šå¸¸æ•°æ®é‡éƒ½æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œé‚£ä¹ˆåœ¨è¿™æ®µæ—¶é—´å†…ï¼Œå¯èƒ½ä¼šé€ æˆä¸å°‘çš„æ•°æ®å †ç§¯ï¼ˆå¯èƒ½åˆ†é’Ÿå†…å°±ä¸Šåƒä¸‡æˆ–è€…æ›´å¤šï¼‰ï¼Œå½“ä½œä¸šå¯åŠ¨åå†å»è¿½è¿™åƒä¸‡é‡çº§çš„æ•°æ®ï¼Œå¯¹ä½œä¸šæ¥è¯´å‹åŠ›è‡ªç„¶ä¼šå¢å¤§ã€‚ å¯¹äºç¬¬äºŒç§æ–¹æ³•ä¹Ÿæ˜¯ä¸€ç§ç”¨çš„å¾ˆå¤šçš„æ–¹å¼ï¼Œè‡ªå·±ä¹Ÿæ¯”è¾ƒæ¨èï¼Œä¹‹å‰è‡ªå·±åœ¨ç¤¾åŒºç›´æ’­çš„æ—¶å€™ä¹Ÿæœ‰è®²è¿‡ç±»ä¼¼çš„æ–¹æ¡ˆï¼Œä½†æ˜¯ä»Šå¤©æˆ‘å‡†å¤‡è®²è§£å¦ä¸€ç§æ–¹æ³• â€”â€” æ•´åˆé…ç½®ä¸­å¿ƒï¼Œæ²¡çœ‹è§æœ‰äººè¿™ä¹ˆç”¨è¿‡ï¼Œæˆ‘ä¹Ÿç®—æ˜¯ç¬¬ä¸€ä¸ªåƒèƒèŸ¹çš„äººäº†ï¼è¯´åˆ°é…ç½®ä¸­å¿ƒï¼Œç›®å‰å›½å†…æœ‰ Apollo å’Œ Nacosï¼Œè¿™é‡Œå…ˆæ¥è®²ä¸‹å’Œ Nacos çš„æ•´åˆï¼Œä¸‹é¢çš„å®æˆ˜æ“ä½œè¯·çœ‹æˆ‘å½•åˆ¶çš„è§†é¢‘ã€‚ ä»£ç åœ°å€ï¼šhttps://github.com/zhisheng17/flink-learning/tree/master/flink-learning-configration-center/flink-learning-configration-center-nacos æˆ‘æœ¬äººå®‰è£…çš„ Nacos ä¾èµ–æ˜¯é˜¿é‡Œçš„ï¼Œå› ä¸ºè‡ªå·±æœ¬åœ°ç¼–è¯‘äº†ä¸€ä»½æºç ï¼Œæ‰€ä»¥å¯èƒ½ä¼šæœ‰è¿™äº›ä¾èµ–åœ¨è‡ªå·±æœ¬åœ°çš„ .m2 ç›®å½•ä¸­ï¼š 123456789101112131415&lt;dependency&gt; &lt;groupId&gt;com.alibaba.nacos&lt;/groupId&gt; &lt;artifactId&gt;nacos-core&lt;/artifactId&gt; &lt;version&gt;1.1.4&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;com.alibaba.nacos&lt;/groupId&gt; &lt;artifactId&gt;nacos-client&lt;/artifactId&gt; &lt;version&gt;1.1.4&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;com.alibaba.nacos&lt;/groupId&gt; &lt;artifactId&gt;nacos-common&lt;/artifactId&gt; &lt;version&gt;1.1.4&lt;/version&gt;&lt;/dependency&gt; ä½†æ˜¯æœ‰äº›åŒå­¦åé¦ˆè¯´ä¸Šé¢çš„ä¾èµ–å¼•å…¥ä¸ä¸Šï¼Œä¸€ç›´ä¸‹è½½ä¸äº†ï¼Œæ¯”å¦‚ nacos-coreï¼Œè¿™é‡Œå»ºè®®å» https://mvnrepository.com/search?q=nacos-core çœ‹ä¸€ä¸‹ç¬¬ä¸€ä¸ªï¼Œç„¶åå¼•ç”¨è¯•è¯•ã€‚ æœ€åGitHub Flink å­¦ä¹ ä»£ç åœ°å€ï¼šhttps://github.com/zhisheng17/flink-learning å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€åŸç†ã€å®æˆ˜ã€æ€§èƒ½è°ƒä¼˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"},{"name":"Nacos","slug":"Nacos","permalink":"http://www.54tianzhisheng.cn/tags/Nacos/"}]},{"title":"Flink 1.10 æ–°ç‰¹æ€§ç ”ç©¶","date":"2020-02-21T16:00:00.000Z","path":"2020/02/22/flink-1.10-release/","text":"Flink 1.10 release æ–‡æ¡£æè¿°äº†ä¸€äº›æ¯”è¾ƒé‡è¦çš„ç‚¹ï¼Œæ¯”å¦‚é…ç½®ã€æ“ä½œã€ä¾èµ–ã€1.9 ç‰ˆæœ¬å’Œ 1.10 ç‰ˆæœ¬ä¹‹é—´çš„åŒºåˆ«ï¼Œå¦‚æœä½ å‡†å¤‡å°† Flink å‡çº§åˆ° 1.10 ç‰ˆæœ¬ï¼Œå»ºè®®ä»”ç»†çœ‹å®Œä¸‹é¢çš„å†…å®¹ã€‚ é›†ç¾¤å’Œéƒ¨ç½² æ–‡ä»¶ç³»ç»Ÿéœ€è¦é€šè¿‡æ’ä»¶çš„æ–¹å¼åŠ è½½ Flink å®¢æˆ·ç«¯æ ¹æ®é…ç½®çš„ç±»åŠ è½½ç­–ç•¥åŠ è½½ï¼Œparent-first å’Œ child-first ä¸¤ç§æ–¹å¼ å…è®¸åœ¨æ‰€æœ‰çš„ TaskManager ä¸Šå‡åŒ€åœ°åˆ†å¸ƒä»»åŠ¡ï¼Œéœ€è¦åœ¨ flink-conf.yaml é…ç½®æ–‡ä»¶ä¸­é…ç½® cluster.evenly-spread-out-slots: true å‚æ•° é«˜å¯ç”¨å­˜å‚¨ç›®å½•åšäº†ä¿®æ”¹ï¼Œåœ¨ HA_STORAGE_DIR/HA_CLUSTER_ID ä¸‹ï¼ŒHA_STORAGE_DIR è·¯å¾„é€šè¿‡ high-availability.storageDir å‚æ•°é…ç½®ï¼ŒHA_CLUSTER_ID è·¯å¾„é€šè¿‡ high-availability.cluster-id å‚æ•°é…ç½® å½“ä½¿ç”¨ -yarnship å‘½ä»¤å‚æ•°æ—¶ï¼Œèµ„æºç›®å½•å’Œ jar æ–‡ä»¶ä¼šè¢«æ·»åŠ åˆ° classpath ä¸­ ç§»é™¤äº† --yn/--yarncontainer å‘½ä»¤å‚æ•° ç§»é™¤äº† --yst/--yarnstreaming å‘½ä»¤å‚æ•° Flink Mesos ä¼šæ‹’ç»æ‰æ‰€æœ‰çš„è¿‡æœŸè¯·æ±‚ é‡æ„äº† Flink çš„è°ƒåº¦ç¨‹åºï¼Œå…¶ç›®æ ‡æ˜¯ä½¿è°ƒåº¦ç­–ç•¥åœ¨æœªæ¥å¯ä»¥å®šåˆ¶ æ”¯æŒ Java 11ï¼Œå½“ä½¿ç”¨ Java 11 å¯åŠ¨ Flink æ—¶ï¼Œä¼šæœ‰äº› WARNING çš„æ—¥å¿—æé†’ï¼Œæ³¨æ„ï¼šCassandraã€Hiveã€HBase ç­‰ connector æ²¡æœ‰ä½¿ç”¨ Java 11 æµ‹è¯•è¿‡ å†…å­˜ç®¡ç† å…¨æ–°çš„ Task Executor å†…å­˜æ¨¡å‹ï¼Œä¼šå½±å“ standaloneã€YARNã€Mesosã€K8S çš„éƒ¨ç½²ï¼ŒJobManager çš„å†…å­˜æ¨¡å‹æ²¡æœ‰ä¿®æ”¹ã€‚å¦‚æœä½ åœ¨æ²¡æœ‰è°ƒæ•´çš„æƒ…å†µä¸‹ï¼Œé‡ç”¨ä»¥å‰çš„ Flink é…ç½®ï¼Œåˆ™æ–°çš„å†…å­˜æ¨¡å‹å¯èƒ½ä¼šå¯¼è‡´ JVM çš„è®¡ç®—å†…å­˜å‚æ•°ä¸åŒï¼Œä»è€Œå¯¼è‡´æ€§èƒ½çš„å˜åŒ–ã€‚ ä»¥ä¸‹é€‰é¡¹å·²ç»åˆ é™¤ï¼Œä¸å†èµ·ä½œç”¨ï¼š ä»¥ä¸‹é€‰é¡¹å·²ç»æ›¿æ¢æˆå…¶ä»–çš„é€‰é¡¹ï¼š RocksDB State Backend å†…å­˜å¯ä»¥æ§åˆ¶ï¼Œç”¨æˆ·å¯ä»¥è°ƒæ•´ RocksDB çš„å†™/è¯»å†…å­˜æ¯”ç‡ state.backend.rocksdb.memory.write-buffer-ratioï¼ˆé»˜è®¤æƒ…å†µä¸‹ 0.5ï¼‰å’Œä¸ºç´¢å¼•/è¿‡æ»¤å™¨ä¿ç•™çš„å†…å­˜éƒ¨åˆ† state.backend.rocksdb.memory.high-prio-pool-ratioï¼ˆé»˜è®¤æƒ…å†µä¸‹0.1ï¼‰ ç»†ç²’åº¦çš„ç®—å­ï¼ˆOperatorï¼‰èµ„æºç®¡ç†ï¼Œé…ç½®é€‰é¡¹ table.exec.resource.external-buffer-memoryï¼Œtable.exec.resource.hash-agg.memoryï¼Œtable.exec.resource.hash-join.memoryï¼Œå’Œ table.exec.resource.sort.memory å·²è¢«å¼ƒç”¨ Table API å’Œ SQL å°† ANY ç±»å‹é‡å‘½åä¸º RAW ç±»å‹ï¼Œè¯¥æ ‡è¯†ç¬¦ raw ç°åœ¨æ˜¯ä¿ç•™å…³é”®å­—ï¼Œåœ¨ç”¨ä½œ SQL å­—æ®µæˆ–å‡½æ•°åç§°æ—¶å¿…é¡»è½¬ä¹‰ é‡å‘½å Table Connector å±æ€§ï¼Œä»¥ä¾¿ç¼–å†™ DDL è¯­å¥æ—¶æä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œæ¯”å¦‚ Kafka Connector å±æ€§ connector.properties å’Œ connector.specific-offsetsã€Elasticsearch Connector å±æ€§ connector.hosts ä¹‹å‰ä¸ä¸´æ—¶è¡¨å’Œè§†å›¾è¿›è¡Œäº¤äº’çš„æ–¹æ³•å·²ç»è¢«å¼ƒç”¨ï¼Œç›®å‰ä½¿ç”¨ createTemporaryView() ç§»é™¤äº† ExternalCatalog APIï¼ˆExternalCatalogã€SchematicDescriptorã€MetadataDescriptorã€StatisticsDescriptorï¼‰ï¼Œå»ºè®®ä½¿ç”¨æ–°çš„ Catalog API é…ç½® ConfigOptions å¦‚æœæ— æ³•å°†é…ç½®çš„å€¼è§£ææˆæ‰€éœ€è¦çš„ç±»å‹ï¼Œåˆ™ä¼šæŠ›å‡º IllegalArgumentException å¼‚å¸¸ï¼Œä¹‹å‰æ˜¯ä¼šè¿”å›é»˜è®¤å€¼ å¢åŠ é»˜è®¤çš„é‡å¯ç­–ç•¥å»¶è¿Ÿæ—¶é—´ï¼ˆfixed-delay å’Œ failure-rate å·²ç»é»˜è®¤æ˜¯ 1sï¼Œä¹‹å‰æ˜¯ 0ï¼‰ ç®€åŒ–é›†ç¾¤çº§åˆ«çš„é‡å¯ç­–ç•¥é…ç½®ï¼Œç°åœ¨é›†ç¾¤çº§åˆ«çš„é‡å¯ç­–ç•¥ä»…ç”± restart-strategy é…ç½®å’Œæ˜¯å¦å¼€å¯ Checkpoint ç¡®å®š é»˜è®¤æƒ…å†µä¸‹ç¦ç”¨å†…å­˜æ˜ å°„çš„ BoundedBlockingSubpartition ç§»é™¤åŸºäºæœªè®¤è¯çš„ç½‘ç»œæµé‡æ§åˆ¶ ç§»é™¤ HighAvailabilityOptions ä¸­çš„ HA_JOB_DELAY é…ç½® çŠ¶æ€ï¼ˆStateï¼‰ é»˜è®¤å¼€å¯ TTL çš„çŠ¶æ€åå°æ¸…ç† å¼ƒç”¨ StateTtlConfig#Builder#cleanupInBackground() ä½¿ç”¨ RocksDBStateBackend æ—¶ï¼Œé»˜è®¤å°†è®¡æ—¶å™¨å­˜å‚¨åœ¨ RocksDB ä¸­ï¼Œä¹‹å‰æ˜¯å­˜å‚¨åœ¨å †å†…å­˜ï¼ˆHeapï¼‰ä¸­ StateTtlConfig#TimeCharacteristic å·²ç»è¢«ç§»é™¤ï¼Œç›®å‰ä½¿ç”¨ StateTtlConfig#TtlTimeCharacteristic æ–°å¢ MapState#isEmpty() æ–¹æ³•æ¥æ£€æŸ¥ MapState æ˜¯å¦ä¸ºç©ºï¼Œè¯¥æ–¹æ³•æ¯”ä½¿ç”¨ mapState.keys().iterator().hasNext() çš„é€Ÿåº¦å¿« 40% RocksDB å‡çº§ï¼Œå‘å¸ƒäº†è‡ªå·±çš„ FRocksDBï¼ˆåŸºäº RocksDB 5.17.2 ç‰ˆæœ¬ï¼‰ï¼Œä¸»è¦æ˜¯å› ä¸ºé«˜ç‰ˆæœ¬çš„ RocksDB åœ¨æŸäº›æƒ…å†µä¸‹æ€§èƒ½ä¼šä¸‹é™ é»˜è®¤ç¦ç”¨ RocksDB æ—¥å¿—è®°å½•ï¼Œéœ€è¦å¯ç”¨çš„è¯éœ€è¦åˆ©ç”¨ RocksDBOptionsFactory åˆ›å»º DBOptions å®ä¾‹ï¼Œå¹¶é€šè¿‡ setInfoLogLevel æ–¹æ³•è®¾ç½® INFO_LEVEL ä¼˜åŒ–ä» RocksDB Savepoint æ¢å¤çš„æœºåˆ¶ï¼Œä»¥å‰å¦‚æœä»åŒ…å«å¤§å‹ KV å¯¹çš„ RocksDB Savepoint æ¢å¤æ—¶ï¼Œç”¨æˆ·å¯èƒ½ä¼šé‡åˆ° OOMã€‚ç°åœ¨å¼•å…¥äº†å¯é…ç½®çš„å†…å­˜é™åˆ¶ï¼ŒRocksDBWriteBatchWrapper é»˜è®¤å€¼ä¸º 2MBã€‚RocksDBçš„WriteBatch å°†åœ¨è¾¾åˆ°å†…å­˜é™åˆ¶ä¹‹å‰åˆ·æ–°ã€‚å¯ä»¥åœ¨ flink-conf.yml ä¸­ä¿®æ”¹ state.backend.rocksdb.write-batch-size é…ç½® PyFlink ä¸å†æ”¯æŒ Python2 ç›‘æ§ InfluxdbReporter ä¼šè·³è¿‡ Inf å’Œ NaNï¼ˆInfluxDB ä¸æ”¯æŒçš„ç±»å‹ï¼Œæ¯”å¦‚ Double.POSITIVE_INFINITY, Double.NEGATIVE_INFINITY, Double.NaNï¼‰ è¿æ¥å™¨ï¼ˆConnectorsï¼‰ æ”¹å˜ Kinesis è¿æ¥å™¨çš„ License æ¥å£æ›´æ”¹ ExecutionConfigï¼ƒgetGlobalJobParameters() ä¸å†è¿”å› null MasterTriggerRestoreHook ä¸­çš„ triggerCheckpoint æ–¹æ³•å¿…é¡»æ—¶éé˜»å¡çš„ HA æœåŠ¡çš„å®¢æˆ·ç«¯/æœåŠ¡å™¨ç«¯åˆ†ç¦»ï¼ŒHighAvailabilityServices å·²åˆ†ç¦»æˆå®¢æˆ·ç«¯ ClientHighAvailabilityServices å’Œé›†ç¾¤ç«¯ HighAvailabilityServices HighAvailabilityServices#getWebMonitorLeaderElectionService() æ ‡è®°è¿‡æœŸ LeaderElectionService æ¥å£åšäº†æ›´æ”¹ å¼ƒç”¨ Checkpoint é” å¼ƒç”¨ OptionsFactory å’Œ ConfigurableOptionsFactory æ¥å£ å‚è€ƒï¼šhttps://github.com/apache/flink/blob/master/docs/release-notes/flink-1.10.zh.md çœ‹äº†ä¸‹å®˜æ–¹çš„è¿™ä»½æ–°ç‰ˆæœ¬çš„ä»‹ç»ï¼Œæ„Ÿè§‰è¿˜ç¼ºå°‘å¾ˆå¤šæ–°åŠŸèƒ½çš„ä»‹ç»ï¼Œæ¯”å¦‚ï¼š åœ¨ 1.10 ç‰ˆæœ¬ä¸­æŠŠ Blink ç‰ˆæœ¬çš„å“ªäº›åŠŸèƒ½æ•´åˆè¿‡æ¥äº† ç«Ÿç„¶æ²¡æœ‰å†™ Flink å¯¹åŸç”Ÿ Kubernetes çš„é›†æˆ PyFlink çš„ä»‹ç»æ˜¯è®¤çœŸçš„å—ï¼Ÿ å¯¹ Hive çš„ç”Ÿäº§çº§åˆ«é›†æˆï¼Œå®Œå…¨æ²¡æœ‰æåŠå‘€ Table API/SQL ä¼˜åŒ–ç‚¹è®²å¾—ä¸å¤ªå¤š å¯èƒ½å› ä¸ºç¯‡å¹…çš„é—®é¢˜ï¼Œè¿˜æœ‰å¾ˆå¤šç‰¹æ€§éƒ½æ²¡æœ‰è®²è§£å‡ºæ¥ï¼Œå¾—æˆ‘ä»¬è‡ªå·±å»æ‰¾æºç å­¦ä¹ ï¼ æœ€åGitHub Flink å­¦ä¹ ä»£ç åœ°å€ï¼šhttps://github.com/zhisheng17/flink-learning å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€åŸç†ã€å®æˆ˜ã€æ€§èƒ½è°ƒä¼˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"},{"name":"Nacos","slug":"Nacos","permalink":"http://www.54tianzhisheng.cn/tags/Nacos/"}]},{"title":"Flink Checkpoint é—®é¢˜æ’æŸ¥å®ç”¨æŒ‡å—","date":"2020-02-19T16:00:00.000Z","path":"2020/02/20/flink-checkpoint/","text":"åœ¨ Flink ä¸­ï¼ŒçŠ¶æ€å¯é æ€§ä¿è¯ç”± Checkpoint æ”¯æŒï¼Œå½“ä½œä¸šå‡ºç° failover çš„æƒ…å†µä¸‹ï¼ŒFlink ä¼šä»æœ€è¿‘æˆåŠŸçš„ Checkpoint æ¢å¤ã€‚ ä½œè€…ï¼šé‚±ä»è´¤ï¼ˆå±±æ™ºï¼‰è½¬è½½è‡ªï¼šhttps://www.jianshu.com/p/fc100f85a0fb åœ¨å®é™…æƒ…å†µä¸­ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šé‡åˆ° Checkpoint å¤±è´¥ï¼Œæˆ–è€… Checkpoint æ…¢çš„æƒ…å†µï¼Œæœ¬æ–‡ä¼šç»Ÿä¸€èŠä¸€èŠ Flink ä¸­ Checkpoint å¼‚å¸¸çš„æƒ…å†µï¼ˆåŒ…æ‹¬å¤±è´¥å’Œæ…¢ï¼‰ï¼Œä»¥åŠå¯èƒ½çš„åŸå› å’Œæ’æŸ¥æ€è·¯ã€‚ 1. Checkpoint æµç¨‹ç®€ä»‹é¦–å…ˆæˆ‘ä»¬éœ€è¦äº†è§£ Flink ä¸­ Checkpoint çš„æ•´ä¸ªæµç¨‹æ˜¯æ€æ ·çš„ï¼Œåœ¨äº†è§£æ•´ä¸ªæµç¨‹ä¹‹åï¼Œæˆ‘ä»¬æ‰èƒ½åœ¨å‡ºé—®é¢˜çš„æ—¶å€™ï¼Œæ›´å¥½çš„è¿›è¡Œå®šä½åˆ†æã€‚ ä»ä¸Šå›¾æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼ŒFlink çš„ Checkpoint åŒ…æ‹¬å¦‚ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š JM trigger checkpoint Source æ”¶åˆ° trigger checkpoint çš„ PRCï¼Œè‡ªå·±å¼€å§‹åš snapshotï¼Œå¹¶å¾€ä¸‹æ¸¸å‘é€ barrier ä¸‹æ¸¸æ¥æ”¶ barrierï¼ˆéœ€è¦ barrier éƒ½åˆ°é½æ‰ä¼šå¼€å§‹åš checkpointï¼‰ Task å¼€å§‹åŒæ­¥é˜¶æ®µ snapshot Task å¼€å§‹å¼‚æ­¥é˜¶æ®µ snapshot Task snapshot å®Œæˆï¼Œæ±‡æŠ¥ç»™ JM ä¸Šé¢çš„ä»»ä½•ä¸€ä¸ªæ­¥éª¤ä¸æˆåŠŸï¼Œæ•´ä¸ª checkpoint éƒ½ä¼šå¤±è´¥ã€‚ 2 Checkpoint å¼‚å¸¸æƒ…å†µæ’æŸ¥2.1 Checkpoint å¤±è´¥å¯ä»¥åœ¨ Checkpoint ç•Œé¢çœ‹åˆ°å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä¸‹å›¾ä¸­ Checkpoint 10423 å¤±è´¥äº†ã€‚ ç‚¹å‡» Checkpoint 10423 çš„è¯¦æƒ…ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç±»ç³»ä¸‹å›¾æ‰€ç¤ºçš„è¡¨æ ¼ï¼ˆä¸‹å›¾ä¸­å°† operator åå­—æˆªå–æ‰äº†ï¼‰ã€‚ ä¸Šå›¾ä¸­æˆ‘ä»¬çœ‹åˆ°ä¸‰è¡Œï¼Œè¡¨ç¤ºä¸‰ä¸ª operatorï¼Œå…¶ä¸­æ¯ä¸€åˆ—çš„å«ä¹‰åˆ†åˆ«å¦‚ä¸‹ï¼š å…¶ä¸­ Acknowledged ä¸€åˆ—è¡¨ç¤ºæœ‰å¤šå°‘ä¸ª subtask å¯¹è¿™ä¸ª Checkpoint è¿›è¡Œäº† ackï¼Œä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çŸ¥é“ç¬¬ä¸‰ä¸ª operator æ€»å…±æœ‰ 5 ä¸ª subtaskï¼Œä½†æ˜¯åªæœ‰ 4 ä¸ªè¿›è¡Œäº† ackï¼› ç¬¬äºŒåˆ— Latest Acknowledgement è¡¨ç¤ºè¯¥ operator çš„æ‰€æœ‰ subtask æœ€å ack çš„æ—¶é—´ï¼› End to End Duration è¡¨ç¤ºæ•´ä¸ª operator çš„æ‰€æœ‰ subtask ä¸­å®Œæˆ snapshot çš„æœ€é•¿æ—¶é—´ï¼› State Size è¡¨ç¤ºå½“å‰ Checkpoint çš„ state å¤§å° â€“ ä¸»è¦è¿™é‡Œå¦‚æœæ˜¯å¢é‡ checkpoint çš„è¯ï¼Œåˆ™è¡¨ç¤ºå¢é‡å¤§å°ï¼› Buffered During Alignment è¡¨ç¤ºåœ¨ barrier å¯¹é½é˜¶æ®µç§¯æ”’äº†å¤šå°‘æ•°æ®ï¼Œå¦‚æœè¿™ä¸ªæ•°æ®è¿‡å¤§ä¹Ÿé—´æ¥è¡¨ç¤ºå¯¹é½æ¯”è¾ƒæ…¢ï¼‰ï¼› Checkpoint å¤±è´¥å¤§è‡´åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼šCheckpoint Decline å’Œ Checkpoint Expireã€‚ 2.1.1 Checkpoint Declineæˆ‘ä»¬èƒ½ä» jobmanager.log ä¸­çœ‹åˆ°ç±»ä¼¼ä¸‹é¢çš„æ—¥å¿— Decline checkpoint 10423 by task 0b60f08bf8984085b59f8d9bc74ce2e1 of job 85d268e6fbc19411185f7e4868a44178. å…¶ä¸­10423 æ˜¯ checkpointIDï¼Œ0b60f08bf8984085b59f8d9bc74ce2e1 æ˜¯ execution idï¼Œ85d268e6fbc19411185f7e4868a44178 æ˜¯ job idï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ jobmanager.log ä¸­æŸ¥æ‰¾ execution idï¼Œæ‰¾åˆ°è¢«è°ƒåº¦åˆ°å“ªä¸ª taskmanager ä¸Šï¼Œç±»ä¼¼å¦‚ä¸‹æ‰€ç¤ºï¼š 122019-09-02 16:26:20,972 INFO [jobmanager-future-thread-61] org.apache.flink.runtime.executiongraph.ExecutionGraph - XXXXXXXXXXX (100/289) (87b751b1fd90e32af55f02bb2f9a9892) switched from SCHEDULED to DEPLOYING.2019-09-02 16:26:20,972 INFO [jobmanager-future-thread-61] org.apache.flink.runtime.executiongraph.ExecutionGraph - Deploying XXXXXXXXXXX (100/289) (attempt #0) to slot container_e24_1566836790522_8088_04_013155_1 on hostnameABCDE ä»ä¸Šé¢çš„æ—¥å¿—æˆ‘ä»¬çŸ¥é“è¯¥ execution è¢«è°ƒåº¦åˆ° hostnameABCDE çš„ container_e24_1566836790522_8088_04_013155_1 slot ä¸Šï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥åˆ° container container_e24_1566836790522_8088_04_013155 çš„ taskmanager.log ä¸­æŸ¥æ‰¾ Checkpoint å¤±è´¥çš„å…·ä½“åŸå› äº†ã€‚ å¦å¤–å¯¹äº Checkpoint Decline çš„æƒ…å†µï¼Œæœ‰ä¸€ç§æƒ…å†µæˆ‘ä»¬åœ¨è¿™é‡Œå•ç‹¬æŠ½å–å‡ºæ¥è¿›è¡Œä»‹ç»ï¼šCheckpoint Cancelã€‚ å½“å‰ Flink ä¸­å¦‚æœè¾ƒå°çš„ Checkpoint è¿˜æ²¡æœ‰å¯¹é½çš„æƒ…å†µä¸‹ï¼Œæ”¶åˆ°äº†æ›´å¤§çš„ Checkpointï¼Œåˆ™ä¼šæŠŠè¾ƒå°çš„ Checkpoint ç»™å–æ¶ˆæ‰ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç±»ä¼¼ä¸‹é¢çš„æ—¥å¿—ï¼š 1$taskNameWithSubTaskAndID: Received checkpoint barrier for checkpoint 20 before completing current checkpoint 19. Skipping current checkpoint. è¿™ä¸ªæ—¥å¿—è¡¨ç¤ºï¼Œå½“å‰ Checkpoint 19 è¿˜åœ¨å¯¹é½é˜¶æ®µï¼Œæˆ‘ä»¬æ”¶åˆ°äº† Checkpoint 20 çš„ barrierã€‚ç„¶åä¼šé€çº§é€šçŸ¥åˆ°ä¸‹æ¸¸çš„ task checkpoint 19 è¢«å–æ¶ˆäº†ï¼ŒåŒæ—¶ä¹Ÿä¼šé€šçŸ¥ JM å½“å‰ Checkpoint è¢« decline æ‰äº†ã€‚ åœ¨ä¸‹æ¸¸ task æ”¶åˆ°è¢« cancelBarrier çš„æ—¶å€™ï¼Œä¼šæ‰“å°ç±»ä¼¼å¦‚ä¸‹çš„æ—¥å¿—ï¼š 123456789101112DEBUG$taskNameWithSubTaskAndID: Checkpoint 19 canceled, aborting alignment.æˆ–è€…DEBUG$taskNameWithSubTaskAndID: Checkpoint 19 canceled, skipping alignment.æˆ–è€…WARN$taskNameWithSubTaskAndID: Received cancellation barrier for checkpoint 20 before completing current checkpoint 19. Skipping current checkpoint. ä¸Šé¢ä¸‰ç§æ—¥å¿—éƒ½è¡¨ç¤ºå½“å‰ task æ¥æ”¶åˆ°ä¸Šæ¸¸å‘é€è¿‡æ¥çš„ barrierCancel æ¶ˆæ¯ï¼Œä»è€Œå–æ¶ˆäº†å¯¹åº”çš„ Checkpointã€‚ 2.1.2 Checkpoint Expireå¦‚æœ Checkpoint åšçš„éå¸¸æ…¢ï¼Œè¶…è¿‡äº† timeout è¿˜æ²¡æœ‰å®Œæˆï¼Œåˆ™æ•´ä¸ª Checkpoint ä¹Ÿä¼šå¤±è´¥ã€‚å½“ä¸€ä¸ª Checkpoint ç”±äºè¶…æ—¶è€Œå¤±è´¥æ˜¯ï¼Œä¼šåœ¨ jobmanager.log ä¸­çœ‹åˆ°å¦‚ä¸‹çš„æ—¥å¿—ï¼š 1Checkpoint 1 of job 85d268e6fbc19411185f7e4868a44178 expired before completing. è¡¨ç¤º Chekpoint 1 ç”±äºè¶…æ—¶è€Œå¤±è´¥ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥å¯ä»¥çœ‹è¿™ä¸ªæ—¥å¿—åé¢æ˜¯å¦æœ‰ç±»ä¼¼ä¸‹é¢çš„æ—¥å¿—ï¼š 1Received late message for now expired checkpoint attempt 1 from 0b60f08bf8984085b59f8d9bc74ce2e1 of job 85d268e6fbc19411185f7e4868a44178. å¯ä»¥æŒ‰ç…§ 2.1.1 ä¸­çš„æ–¹æ³•æ‰¾åˆ°å¯¹åº”çš„ taskmanager.log æŸ¥çœ‹å…·ä½“ä¿¡æ¯ã€‚ ä¸‹é¢çš„æ—¥å¿—å¦‚æœæ˜¯ DEBUG çš„è¯ï¼Œæˆ‘ä»¬ä¼šåœ¨å¼€å§‹å¤„æ ‡è®° DEBUG æˆ‘ä»¬æŒ‰ç…§ä¸‹é¢çš„æ—¥å¿—æŠŠ TM ç«¯çš„ snapshot åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼Œå¼€å§‹åš snapshot å‰ï¼ŒåŒæ­¥é˜¶æ®µï¼Œå¼‚æ­¥é˜¶æ®µï¼š 12DEBUGStarting checkpoint (6751) CHECKPOINT on task taskNameWithSubtasks (4/4) è¿™ä¸ªæ—¥å¿—è¡¨ç¤º TM ç«¯ barrier å¯¹é½åï¼Œå‡†å¤‡å¼€å§‹åš Checkpointã€‚ 123DEBUG2019-08-06 13:43:02,613 DEBUG org.apache.flink.runtime.state.AbstractSnapshotStrategy - DefaultOperatorStateBackend snapshot (FsCheckpointStorageLocation &#123;fileSystem=org.apache.flink.core.fs.SafetyNetWrapperFileSystem@70442baf, checkpointDirectory=xxxxxxxx, sharedStateDirectory=xxxxxxxx, taskOwnedStateDirectory=xxxxxx, metadataFilePath=xxxxxx, reference=(default), fileStateSizeThreshold=1024&#125;, synchronous part) in thread Thread[Async calls on Source: xxxxxx_source -&gt; Filter (27/70),5,Flink Task Threads] took 0 ms. ä¸Šé¢çš„æ—¥å¿—è¡¨ç¤ºå½“å‰è¿™ä¸ª backend çš„åŒæ­¥é˜¶æ®µå®Œæˆï¼Œå…±ä½¿ç”¨äº† 0 msã€‚ 12DEBUGDefaultOperatorStateBackend snapshot (FsCheckpointStorageLocation &#123;fileSystem=org.apache.flink.core.fs.SafetyNetWrapperFileSystem@7908affe, checkpointDirectory=xxxxxx, sharedStateDirectory=xxxxx, taskOwnedStateDirectory=xxxxx, metadataFilePath=xxxxxx, reference=(default), fileStateSizeThreshold=1024&#125;, asynchronous part) in thread Thread[pool-48-thread-14,5,Flink Task Threads] took 369 ms ä¸Šé¢çš„æ—¥å¿—è¡¨ç¤ºå¼‚æ­¥é˜¶æ®µå®Œæˆï¼Œå¼‚æ­¥é˜¶æ®µä½¿ç”¨äº† 369 ms åœ¨ç°æœ‰çš„æ—¥å¿—æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬é€šè¿‡ä¸Šé¢ä¸‰ä¸ªæ—¥å¿—ï¼Œå®šä½ snapshot æ˜¯å¼€å§‹æ™šï¼ŒåŒæ­¥é˜¶æ®µåšçš„æ…¢ï¼Œè¿˜æ˜¯å¼‚æ­¥é˜¶æ®µåšçš„æ…¢ã€‚ç„¶åå†æŒ‰ç…§æƒ…å†µç»§ç»­è¿›ä¸€æ­¥æ’æŸ¥é—®é¢˜ã€‚ 2.2 Checkpoint æ…¢åœ¨ 2.1 èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº† Checkpoint å¤±è´¥çš„æ’æŸ¥æ€è·¯ï¼Œæœ¬èŠ‚ä¼šåˆ†æƒ…å†µä»‹ç» Checkpoint æ…¢çš„æƒ…å†µã€‚ Checkpoint æ…¢çš„æƒ…å†µå¦‚ä¸‹ï¼šæ¯”å¦‚ Checkpoint interval 1 åˆ†é’Ÿï¼Œè¶…æ—¶ 10 åˆ†é’Ÿï¼ŒCheckpoint ç»å¸¸éœ€è¦åš 9 åˆ†é’Ÿï¼ˆæˆ‘ä»¬å¸Œæœ› 1 åˆ†é’Ÿå·¦å³å°±èƒ½å¤Ÿåšå®Œï¼‰ï¼Œè€Œä¸”æˆ‘ä»¬é¢„æœŸ state size ä¸æ˜¯éå¸¸å¤§ã€‚ å¯¹äº Checkpoint æ…¢çš„æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§ä¸‹é¢çš„é¡ºåºé€ä¸€æ£€æŸ¥ã€‚ 2.2.0 Source Trigger Checkpoint æ…¢è¿™ä¸ªä¸€èˆ¬å‘ç”Ÿè¾ƒå°‘ï¼Œä½†æ˜¯ä¹Ÿæœ‰å¯èƒ½ï¼Œå› ä¸º source åš snapshot å¹¶å¾€ä¸‹æ¸¸å‘é€ barrier çš„æ—¶å€™ï¼Œéœ€è¦æŠ¢é”ï¼ˆè¿™ä¸ªç°åœ¨ç¤¾åŒºæ­£åœ¨è¿›è¡Œç”¨ mailBox çš„æ–¹å¼æ›¿ä»£å½“å‰æŠ¢é”çš„æ–¹å¼ï¼Œè¯¦æƒ…å‚è€ƒ[1])ã€‚å¦‚æœä¸€ç›´æŠ¢ä¸åˆ°é”çš„è¯ï¼Œåˆ™å¯èƒ½å¯¼è‡´ Checkpoint ä¸€ç›´å¾—ä¸åˆ°æœºä¼šè¿›è¡Œã€‚å¦‚æœåœ¨ Source æ‰€åœ¨çš„ taskmanager.log ä¸­æ‰¾ä¸åˆ°å¼€å§‹åš Checkpoint çš„ logï¼Œåˆ™å¯ä»¥è€ƒè™‘æ˜¯å¦å±äºè¿™ç§æƒ…å†µï¼Œå¯ä»¥é€šè¿‡ jstack è¿›è¡Œè¿›ä¸€æ­¥ç¡®è®¤é”çš„æŒæœ‰æƒ…å†µã€‚ 2.2.1 ä½¿ç”¨å¢é‡ Checkpointç°åœ¨ Flink ä¸­ Checkpoint æœ‰ä¸¤ç§æ¨¡å¼ï¼Œå…¨é‡ Checkpoint å’Œ å¢é‡ Checkpointï¼Œå…¶ä¸­å…¨é‡ Checkpoint ä¼šæŠŠå½“å‰çš„ state å…¨éƒ¨å¤‡ä»½ä¸€æ¬¡åˆ°æŒä¹…åŒ–å­˜å‚¨ï¼Œè€Œå¢é‡ Checkpointï¼Œåˆ™åªå¤‡ä»½ä¸Šä¸€æ¬¡ Checkpoint ä¸­ä¸å­˜åœ¨çš„ stateï¼Œå› æ­¤å¢é‡ Checkpoint æ¯æ¬¡ä¸Šä¼ çš„å†…å®¹ä¼šç›¸å¯¹æ›´å¥½ï¼Œåœ¨é€Ÿåº¦ä¸Šä¼šæœ‰æ›´å¤§çš„ä¼˜åŠ¿ã€‚ ç°åœ¨ Flink ä¸­ä»…åœ¨ RocksDBStateBackend ä¸­æ”¯æŒå¢é‡ Checkpointï¼Œå¦‚æœä½ å·²ç»ä½¿ç”¨ RocksDBStateBackendï¼Œå¯ä»¥é€šè¿‡å¼€å¯å¢é‡ Checkpoint æ¥åŠ é€Ÿï¼Œå…·ä½“çš„å¯ä»¥å‚è€ƒ [2]ã€‚ 2.2.2 ä½œä¸šå­˜åœ¨åå‹æˆ–è€…æ•°æ®å€¾æ–œæˆ‘ä»¬çŸ¥é“ task ä»…åœ¨æ¥å—åˆ°æ‰€æœ‰çš„ barrier ä¹‹åæ‰ä¼šè¿›è¡Œ snapshotï¼Œå¦‚æœä½œä¸šå­˜åœ¨åå‹ï¼Œæˆ–è€…æœ‰æ•°æ®å€¾æ–œï¼Œåˆ™ä¼šå¯¼è‡´å…¨éƒ¨çš„ channel æˆ–è€…æŸäº› channel çš„ barrier å‘é€æ…¢ï¼Œä»è€Œæ•´ä½“å½±å“ Checkpoint çš„æ—¶é—´ï¼Œè¿™ä¸¤ä¸ªå¯ä»¥é€šè¿‡å¦‚ä¸‹çš„é¡µé¢è¿›è¡Œæ£€æŸ¥ï¼š ä¸Šå›¾ä¸­æˆ‘ä»¬é€‰æ‹©äº†ä¸€ä¸ª taskï¼ŒæŸ¥çœ‹æ‰€æœ‰ subtask çš„åå‹æƒ…å†µï¼Œå‘ç°éƒ½æ˜¯ highï¼Œè¡¨ç¤ºåå‹æƒ…å†µä¸¥é‡ï¼Œè¿™ç§æƒ…å†µä¸‹ä¼šå¯¼è‡´ä¸‹æ¸¸æ¥æ”¶ barrier æ¯”è¾ƒæ™šã€‚ ä¸Šå›¾ä¸­æˆ‘ä»¬é€‰æ‹©å…¶ä¸­ä¸€ä¸ª operatorï¼Œç‚¹å‡»æ‰€æœ‰çš„ subtaskï¼Œç„¶åæŒ‰ç…§ Records Received/Bytes Received/TPS ä»å¤§åˆ°å°è¿›è¡Œæ’åºï¼Œèƒ½çœ‹åˆ°å‰é¢å‡ ä¸ª subtask ä¼šæ¯”å…¶ä»–çš„ subtask è¦å¤„ç†çš„æ•°æ®å¤šã€‚ å¦‚æœå­˜åœ¨åå‹æˆ–è€…æ•°æ®å€¾æ–œçš„æƒ…å†µï¼Œæˆ‘ä»¬éœ€è¦é¦–å…ˆè§£å†³åå‹æˆ–è€…æ•°æ®å€¾æ–œé—®é¢˜ä¹‹åï¼Œå†æŸ¥çœ‹ Checkpoint çš„æ—¶é—´æ˜¯å¦ç¬¦åˆé¢„æœŸã€‚ 2.2.2 Barrier å¯¹é½æ…¢ä»å‰é¢æˆ‘ä»¬çŸ¥é“ Checkpoint åœ¨ task ç«¯åˆ†ä¸º barrier å¯¹é½ï¼ˆæ”¶é½æ‰€æœ‰ä¸Šæ¸¸å‘é€è¿‡æ¥çš„ barrierï¼‰ï¼Œç„¶åå¼€å§‹åŒæ­¥é˜¶æ®µï¼Œå†åšå¼‚æ­¥é˜¶æ®µã€‚å¦‚æœ barrier ä¸€ç›´å¯¹ä¸é½çš„è¯ï¼Œå°±ä¸ä¼šå¼€å§‹åš snapshotã€‚ barrier å¯¹é½ä¹‹åä¼šæœ‰å¦‚ä¸‹æ—¥å¿—æ‰“å°ï¼š 12DEBUGStarting checkpoint (6751) CHECKPOINT on task taskNameWithSubtasks (4/4) å¦‚æœ taskmanager.log ä¸­æ²¡æœ‰è¿™ä¸ªæ—¥å¿—ï¼Œåˆ™è¡¨ç¤º barrier ä¸€ç›´æ²¡æœ‰å¯¹é½ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦äº†è§£å“ªäº›ä¸Šæ¸¸çš„ barrier æ²¡æœ‰å‘é€ä¸‹æ¥ï¼Œå¦‚æœä½ ä½¿ç”¨ At Least Once çš„è¯ï¼Œå¯ä»¥è§‚å¯Ÿä¸‹é¢çš„æ—¥å¿—ï¼š 12DEBUGReceived barrier for checkpoint 96508 from channel 5 è¡¨ç¤ºè¯¥ task æ”¶åˆ°äº† channel 5 æ¥çš„ barrierï¼Œç„¶åçœ‹å¯¹åº” Checkpointï¼Œå†æŸ¥çœ‹è¿˜å‰©å“ªäº›ä¸Šæ¸¸çš„ barrier æ²¡æœ‰æ¥å—åˆ°ï¼Œå¯¹äº ExactlyOnce æš‚æ—¶æ²¡æœ‰ç±»ä¼¼çš„æ—¥å¿—ï¼Œå¯ä»¥è€ƒè™‘è‡ªå·±æ·»åŠ ï¼Œæˆ–è€… jmap æŸ¥çœ‹ã€‚ 2.2.3 ä¸»çº¿ç¨‹å¤ªå¿™ï¼Œå¯¼è‡´æ²¡æœºä¼šåš snapshotåœ¨ task ç«¯ï¼Œæ‰€æœ‰çš„å¤„ç†éƒ½æ˜¯å•çº¿ç¨‹çš„ï¼Œæ•°æ®å¤„ç†å’Œ barrier å¤„ç†éƒ½ç”±ä¸»çº¿ç¨‹å¤„ç†ï¼Œå¦‚æœä¸»çº¿ç¨‹åœ¨å¤„ç†å¤ªæ…¢ï¼ˆæ¯”å¦‚ä½¿ç”¨ RocksDBBackendï¼Œstate æ“ä½œæ…¢å¯¼è‡´æ•´ä½“å¤„ç†æ…¢ï¼‰ï¼Œå¯¼è‡´ barrier å¤„ç†çš„æ…¢ï¼Œä¹Ÿä¼šå½±å“æ•´ä½“ Checkpoint çš„è¿›åº¦ï¼Œåœ¨è¿™ä¸€æ­¥æˆ‘ä»¬éœ€è¦èƒ½å¤ŸæŸ¥çœ‹æŸä¸ª PID å¯¹åº” hotmethodï¼Œè¿™é‡Œæ¨èä¸¤ä¸ªæ–¹æ³•ï¼š å¤šæ¬¡è¿ç»­ jstackï¼ŒæŸ¥çœ‹ä¸€ç›´å¤„äº RUNNABLE çŠ¶æ€çš„çº¿ç¨‹æœ‰å“ªäº›ï¼› ä½¿ç”¨å·¥å…· AsyncProfile dump ä¸€ä»½ç«ç„°å›¾ï¼ŒæŸ¥çœ‹å ç”¨ CPU æœ€å¤šçš„æ ˆï¼› å¦‚æœæœ‰å…¶ä»–æ›´æ–¹ä¾¿çš„æ–¹æ³•å½“ç„¶æ›´å¥½ï¼Œä¹Ÿæ¬¢è¿æ¨èã€‚ 2.2.4 åŒæ­¥é˜¶æ®µåšçš„æ…¢åŒæ­¥é˜¶æ®µä¸€èˆ¬ä¸ä¼šå¤ªæ…¢ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬é€šè¿‡æ—¥å¿—å‘ç°åŒæ­¥é˜¶æ®µæ¯”è¾ƒæ…¢çš„è¯ï¼Œå¯¹äºé RocksDBBackend æˆ‘ä»¬å¯ä»¥è€ƒè™‘æŸ¥çœ‹æ˜¯å¦å¼€å¯äº†å¼‚æ­¥ snapshotï¼Œå¦‚æœå¼€å¯äº†å¼‚æ­¥ snapshot è¿˜æ˜¯æ…¢ï¼Œéœ€è¦çœ‹æ•´ä¸ª JVM åœ¨å¹²å˜›ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å‰ä¸€èŠ‚ä¸­çš„å·¥å…·ã€‚å¯¹äº RocksDBBackend æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ iostate æŸ¥çœ‹ç£ç›˜çš„å‹åŠ›å¦‚ä½•ï¼Œå¦å¤–å¯ä»¥æŸ¥çœ‹ tm ç«¯ RocksDB çš„ log çš„æ—¥å¿—å¦‚ä½•ï¼ŒæŸ¥çœ‹å…¶ä¸­ SNAPSHOT çš„æ—¶é—´æ€»å…±å¼€é”€å¤šå°‘ã€‚ RocksDB å¼€å§‹ snapshot çš„æ—¥å¿—å¦‚ä¸‹ï¼š 12019/09/10-14:22:55.734684 7fef66ffd700 [utilities/checkpoint/checkpoint_impl.cc:83] Started the snapshot process -- creating snapshot in directory /tmp/flink-io-87c360ce-0b98-48f4-9629-2cf0528d5d53/XXXXXXXXXXX/chk-92729 snapshot ç»“æŸçš„æ—¥å¿—å¦‚ä¸‹ï¼š 12019/09/10-14:22:56.001275 7fef66ffd700 [utilities/checkpoint/checkpoint_impl.cc:145] Snapshot DONE. All is good #####2.2.6 å¼‚æ­¥é˜¶æ®µåšçš„æ…¢ å¯¹äºå¼‚æ­¥é˜¶æ®µæ¥è¯´ï¼Œtm ç«¯ä¸»è¦å°† state å¤‡ä»½åˆ°æŒä¹…åŒ–å­˜å‚¨ä¸Šï¼Œå¯¹äºé RocksDBBackend æ¥è¯´ï¼Œä¸»è¦ç“¶é¢ˆæ¥è‡ªäºç½‘ç»œï¼Œè¿™ä¸ªé˜¶æ®µå¯ä»¥è€ƒè™‘è§‚å¯Ÿç½‘ç»œçš„ metricï¼Œæˆ–è€…å¯¹åº”æœºå™¨ä¸Šèƒ½å¤Ÿè§‚å¯Ÿåˆ°ç½‘ç»œæµé‡çš„æƒ…å†µï¼ˆæ¯”å¦‚ iftop)ã€‚ å¯¹äº RocksDB æ¥è¯´ï¼Œåˆ™éœ€è¦ä»æœ¬åœ°è¯»å–æ–‡ä»¶ï¼Œå†™å…¥åˆ°è¿œç¨‹çš„æŒä¹…åŒ–å­˜å‚¨ä¸Šï¼Œæ‰€ä»¥ä¸ä»…éœ€è¦è€ƒè™‘ç½‘ç»œçš„ç“¶é¢ˆï¼Œè¿˜éœ€è¦è€ƒè™‘æœ¬åœ°ç£ç›˜çš„æ€§èƒ½ã€‚å¦å¤–å¯¹äº RocksDBBackend æ¥è¯´ï¼Œå¦‚æœè§‰å¾—ç½‘ç»œæµé‡ä¸æ˜¯ç“¶é¢ˆï¼Œä½†æ˜¯ä¸Šä¼ æ¯”è¾ƒæ…¢çš„è¯ï¼Œè¿˜å¯ä»¥å°è¯•è€ƒè™‘å¼€å¯å¤šçº¿ç¨‹ä¸Šä¼ åŠŸèƒ½[3]ã€‚ 3 æ€»ç»“åœ¨ç¬¬äºŒéƒ¨åˆ†å†…å®¹ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†å®˜æ–¹ç¼–è¯‘çš„åŒ…çš„æƒ…å†µä¸‹æ’æŸ¥ä¸€äº› Checkpoint å¼‚å¸¸æƒ…å†µçš„ä¸»è¦åœºæ™¯ï¼Œä»¥åŠç›¸åº”çš„æ’æŸ¥æ–¹æ³•ï¼Œå¦‚æœæ’æŸ¥äº†ä¸Šé¢æ‰€æœ‰çš„æƒ…å†µï¼Œè¿˜æ˜¯æ²¡æœ‰å‘ç°ç“¶é¢ˆæ‰€åœ¨ï¼Œåˆ™å¯ä»¥è€ƒè™‘æ·»åŠ æ›´è¯¦ç»†çš„æ—¥å¿—ï¼Œé€æ­¥å°†èŒƒå›´ç¼©å°ï¼Œç„¶åæœ€ç»ˆå®šä½åŸå› ã€‚ ä¸Šæ–‡æåˆ°çš„ä¸€äº› DEBUG æ—¥å¿—ï¼Œå¦‚æœ flink dist åŒ…æ˜¯è‡ªå·±ç¼–è¯‘çš„è¯ï¼Œåˆ™å»ºè®®å°† Checkpoint æ•´ä¸ªæ­¥éª¤å†…çš„ä¸€äº› DEBUG æ”¹ä¸º INFOï¼Œèƒ½å¤Ÿé€šè¿‡æ—¥å¿—äº†è§£æ•´ä¸ª Checkpoint çš„æ•´ä½“é˜¶æ®µï¼Œä»€ä¹ˆæ—¶å€™å®Œæˆäº†ä»€ä¹ˆé˜¶æ®µï¼Œä¹Ÿåœ¨ Checkpoint å¼‚å¸¸çš„æ—¶å€™ï¼Œå¿«é€ŸçŸ¥é“æ¯ä¸ªé˜¶æ®µéƒ½æ¶ˆè€—äº†å¤šå°‘æ—¶é—´ã€‚ å‚è€ƒå†…å®¹[1]ã€Change threading-model in StreamTask to a mailbox-based approach[2]ã€å¢é‡ checkpoint åŸç†ä»‹ç»[3]ã€RocksDBStateBackend å¤šçº¿ç¨‹ä¸Šä¼  State æœ€åGitHub Flink å­¦ä¹ ä»£ç åœ°å€ï¼šhttps://github.com/zhisheng17/flink-learning å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ ä¸“æ ä»‹ç»é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€åŸç†ã€å®æˆ˜ã€æ€§èƒ½è°ƒä¼˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"Apache Flink 1.10.0 é‡ç£…å‘å¸ƒï¼Œæ–°ç‰¹æ€§è§£è¯»","date":"2020-02-10T16:00:00.000Z","path":"2020/02/11/flink-1.10/","text":"Apache Flink ç¤¾åŒºè¿æ¥äº†æ¿€åŠ¨äººå¿ƒçš„ä¸¤ä½æ•°ä½ç‰ˆæœ¬å·ï¼ŒFlink 1.10.0 æ­£å¼å®£å‘Šå‘å¸ƒï¼ ä½œä¸º Flink ç¤¾åŒºè¿„ä»Šä¸ºæ­¢è§„æ¨¡æœ€å¤§çš„ä¸€æ¬¡ç‰ˆæœ¬å‡çº§ï¼ŒFlink 1.10 å®¹çº³äº†è¶…è¿‡ 200 ä½è´¡çŒ®è€…å¯¹è¶…è¿‡ 1200 ä¸ª issue çš„å¼€å‘å®ç°ï¼ŒåŒ…å«å¯¹ Flink ä½œä¸šçš„æ•´ä½“æ€§èƒ½åŠç¨³å®šæ€§çš„æ˜¾è‘—ä¼˜åŒ–ã€å¯¹åŸç”Ÿ Kubernetes çš„åˆæ­¥é›†æˆä»¥åŠå¯¹ Python æ”¯æŒï¼ˆPyFlinkï¼‰çš„é‡å¤§ä¼˜åŒ–ã€‚ Flink 1.10 åŒæ—¶è¿˜æ ‡å¿—ç€å¯¹ Blink çš„æ•´åˆå®£å‘Šå®Œæˆï¼Œéšç€å¯¹ Hive çš„ç”Ÿäº§çº§åˆ«é›†æˆåŠå¯¹ TPC-DS çš„å…¨é¢è¦†ç›–ï¼ŒFlink åœ¨å¢å¼ºæµå¼ SQL å¤„ç†èƒ½åŠ›çš„åŒæ—¶ä¹Ÿå…·å¤‡äº†æˆç†Ÿçš„æ‰¹å¤„ç†èƒ½åŠ›ã€‚æœ¬ç¯‡åšå®¢å°†å¯¹æ­¤æ¬¡ç‰ˆæœ¬å‡çº§ä¸­çš„ä¸»è¦æ–°ç‰¹æ€§åŠä¼˜åŒ–ã€å€¼å¾—æ³¨æ„çš„é‡è¦å˜åŒ–ä»¥åŠä½¿ç”¨æ–°ç‰ˆæœ¬çš„é¢„æœŸæ•ˆæœé€ä¸€è¿›è¡Œä»‹ç»ã€‚ æ–°ç‰ˆæœ¬çš„äºŒè¿›åˆ¶å‘å¸ƒåŒ…å’Œæºç åŒ…å·²ç»å¯ä»¥åœ¨æœ€æ–°çš„ Flink å®˜ç½‘ä¸‹è½½é¡µé¢æ‰¾åˆ°ã€‚æ›´å¤šç»†èŠ‚è¯·å‚è€ƒå®Œæ•´çš„ç‰ˆæœ¬æ›´æ–°æ—¥å¿—ä»¥åŠæœ€æ–°çš„ç”¨æˆ·æ–‡æ¡£ã€‚ æ–°ç‰¹æ€§åŠä¼˜åŒ–å†…å­˜ç®¡ç†åŠé…ç½®ä¼˜åŒ–Flink ç›®å‰çš„ TaskExecutor å†…å­˜æ¨¡å‹å­˜åœ¨ç€ä¸€äº›ç¼ºé™·ï¼Œå¯¼è‡´ä¼˜åŒ–èµ„æºåˆ©ç”¨ç‡æ¯”è¾ƒå›°éš¾ï¼Œä¾‹å¦‚ï¼š æµå’Œæ‰¹å¤„ç†å†…å­˜å ç”¨çš„é…ç½®æ¨¡å‹ä¸åŒï¼› æµå¤„ç†ä¸­çš„ RocksDB state backend éœ€è¦ä¾èµ–ç”¨æˆ·è¿›è¡Œå¤æ‚çš„é…ç½®ã€‚ ä¸ºäº†è®©å†…å­˜é…ç½®å˜çš„å¯¹äºç”¨æˆ·æ›´åŠ æ¸…æ™°ã€ç›´è§‚ï¼ŒFlink 1.10 å¯¹ TaskExecutor çš„å†…å­˜æ¨¡å‹å’Œé…ç½®é€»è¾‘è¿›è¡Œäº†è¾ƒå¤§çš„æ”¹åŠ¨ FLIP-49ã€‚è¿™äº›æ”¹åŠ¨ä½¿å¾— Flink èƒ½å¤Ÿæ›´å¥½åœ°é€‚é…æ‰€æœ‰éƒ¨ç½²ç¯å¢ƒï¼ˆä¾‹å¦‚ Kubernetes, Yarn, Mesosï¼‰ï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿæ›´åŠ ä¸¥æ ¼çš„æ§åˆ¶å…¶å†…å­˜å¼€é”€ã€‚ Managed å†…å­˜æ‰©å±•Managed å†…å­˜çš„èŒƒå›´æœ‰æ‰€æ‰©å±•ï¼Œè¿˜æ¶µç›–äº† RocksDB state backend ä½¿ç”¨çš„å†…å­˜ã€‚å°½ç®¡æ‰¹å¤„ç†ä½œä¸šæ—¢å¯ä»¥ä½¿ç”¨å †å†…å†…å­˜ä¹Ÿå¯ä»¥ä½¿ç”¨å †å¤–å†…å­˜ï¼Œä½¿ç”¨ RocksDB state backend çš„æµå¤„ç†ä½œä¸šå´åªèƒ½åˆ©ç”¨å †å¤–å†…å­˜ã€‚å› æ­¤ä¸ºäº†è®©ç”¨æˆ·æ‰§è¡Œæµå’Œæ‰¹å¤„ç†ä½œä¸šæ—¶æ— éœ€æ›´æ”¹é›†ç¾¤çš„é…ç½®ï¼Œæˆ‘ä»¬è§„å®šä»ç°åœ¨èµ· managed å†…å­˜åªèƒ½åœ¨å †å¤–ã€‚ ç®€åŒ– RocksDB é…ç½®æ­¤å‰ï¼Œé…ç½®åƒ RocksDB è¿™æ ·çš„å †å¤– state backend éœ€è¦è¿›è¡Œå¤§é‡çš„æ‰‹åŠ¨è°ƒè¯•ï¼Œä¾‹å¦‚å‡å° JVM å †ç©ºé—´ã€è®¾ç½® Flink ä½¿ç”¨å †å¤–å†…å­˜ç­‰ã€‚ç°åœ¨ï¼ŒFlink çš„å¼€ç®±é…ç½®å³å¯æ”¯æŒè¿™ä¸€åˆ‡ï¼Œä¸”åªéœ€è¦ç®€å•åœ°æ”¹å˜ managed å†…å­˜çš„å¤§å°å³å¯è°ƒæ•´ RocksDB state backend çš„å†…å­˜é¢„ç®—ã€‚ å¦ä¸€ä¸ªé‡è¦çš„ä¼˜åŒ–æ˜¯ï¼ŒFlink ç°åœ¨å¯ä»¥é™åˆ¶ RocksDB çš„ native å†…å­˜å ç”¨ï¼ˆFLINK-7289ï¼‰ï¼Œä»¥é¿å…è¶…è¿‡æ€»çš„å†…å­˜é¢„ç®—â€”â€”è¿™å¯¹äº Kubernetes ç­‰å®¹å™¨åŒ–éƒ¨ç½²ç¯å¢ƒå°¤ä¸ºé‡è¦ã€‚å…³äºå¦‚ä½•å¼€å¯ã€è°ƒè¯•è¯¥ç‰¹æ€§ï¼Œè¯·å‚è€ƒ RocksDB è°ƒè¯•ã€‚ æ³¨ï¼šFLIP-49 æ”¹å˜äº†é›†ç¾¤çš„èµ„æºé…ç½®è¿‡ç¨‹ï¼Œå› æ­¤ä»ä»¥å‰çš„ Flink ç‰ˆæœ¬å‡çº§æ—¶å¯èƒ½éœ€è¦å¯¹é›†ç¾¤é…ç½®è¿›è¡Œè°ƒæ•´ã€‚è¯¦ç»†çš„å˜æ›´æ—¥å¿—åŠè°ƒè¯•æŒ‡å—è¯·å‚è€ƒæ–‡æ¡£ ç»Ÿä¸€çš„ä½œä¸šæäº¤é€»è¾‘åœ¨æ­¤ä¹‹å‰ï¼Œæäº¤ä½œä¸šæ˜¯ç”±æ‰§è¡Œç¯å¢ƒè´Ÿè´£çš„ï¼Œä¸”ä¸ä¸åŒçš„éƒ¨ç½²ç›®æ ‡ï¼ˆä¾‹å¦‚ Yarn, Kubernetes, Mesosï¼‰ç´§å¯†ç›¸å…³ã€‚è¿™å¯¼è‡´ç”¨æˆ·éœ€è¦é’ˆå¯¹ä¸åŒç¯å¢ƒä¿ç•™å¤šå¥—é…ç½®ï¼Œå¢åŠ äº†ç®¡ç†çš„æˆæœ¬ã€‚ åœ¨ Flink 1.10 ä¸­ï¼Œä½œä¸šæäº¤é€»è¾‘è¢«æŠ½è±¡åˆ°äº†é€šç”¨çš„ Executor æ¥å£ï¼ˆFLIP-73ï¼‰ã€‚æ–°å¢åŠ çš„ ExecutorCLI ï¼ˆFLIP-81ï¼‰å¼•å…¥äº†ä¸ºä»»æ„æ‰§è¡Œç›®æ ‡æŒ‡å®šé…ç½®å‚æ•°çš„ç»Ÿä¸€æ–¹æ³•ã€‚æ­¤å¤–ï¼Œéšç€å¼•å…¥ JobClientï¼ˆFLINK-74ï¼‰è´Ÿè´£è·å– JobExecutionResultï¼Œè·å–ä½œä¸šæ‰§è¡Œç»“æœçš„é€»è¾‘ä¹Ÿå¾—ä»¥ä¸ä½œä¸šæäº¤è§£è€¦ã€‚ ä¸Šè¿°æ”¹å˜å‘ç”¨æˆ·æä¾›äº†ç»Ÿä¸€çš„ Flink å…¥å£ï¼Œä½¿å¾—åœ¨ Apache Beam æˆ– Zeppelin notebooks ç­‰ä¸‹æ¸¸æ¡†æ¶ä¸­ä»¥ç¼–ç¨‹æ–¹å¼ä½¿ç”¨ Flink å˜çš„æ›´åŠ å®¹æ˜“ã€‚å¯¹äºéœ€è¦åœ¨å¤šç§ä¸åŒç¯å¢ƒä½¿ç”¨ Flink çš„ç”¨æˆ·è€Œè¨€ï¼Œæ–°çš„åŸºäºé…ç½®çš„æ‰§è¡Œè¿‡ç¨‹åŒæ ·æ˜¾è‘—é™ä½äº†å†—ä½™ä»£ç é‡ä»¥åŠç»´æŠ¤å¼€é”€ã€‚ åŸç”Ÿ Kubernetes é›†æˆï¼ˆBetaï¼‰å¯¹äºæƒ³è¦åœ¨å®¹å™¨åŒ–ç¯å¢ƒä¸­å°è¯• Flink çš„ç”¨æˆ·æ¥è¯´ï¼Œæƒ³è¦åœ¨ Kubernetes ä¸Šéƒ¨ç½²å’Œç®¡ç†ä¸€ä¸ª Flink standalone é›†ç¾¤ï¼Œé¦–å…ˆéœ€è¦å¯¹å®¹å™¨ã€ç®—å­åŠåƒ kubectl è¿™æ ·çš„ç¯å¢ƒå·¥å…·æœ‰æ‰€äº†è§£ã€‚ åœ¨ Flink 1.10 ä¸­ï¼Œæˆ‘ä»¬æ¨å‡ºäº†åˆæ­¥çš„æ”¯æŒ session æ¨¡å¼çš„ä¸»åŠ¨ Kubernetes é›†æˆï¼ˆFLINK-9953ï¼‰ã€‚å…¶ä¸­ï¼Œâ€œä¸»åŠ¨â€æŒ‡ Flink ResourceManager (K8sResMngr) åŸç”Ÿåœ°ä¸ Kubernetes é€šä¿¡ï¼Œåƒ Flink åœ¨ Yarn å’Œ Mesos ä¸Šä¸€æ ·æŒ‰éœ€ç”³è¯· podã€‚ç”¨æˆ·å¯ä»¥åˆ©ç”¨ namespaceï¼Œåœ¨å¤šç§Ÿæˆ·ç¯å¢ƒä¸­ä»¥è¾ƒå°‘çš„èµ„æºå¼€é”€å¯åŠ¨ Flinkã€‚è¿™éœ€è¦ç”¨æˆ·æå‰é…ç½®å¥½ RBAC è§’è‰²å’Œæœ‰è¶³å¤Ÿæƒé™çš„æœåŠ¡è´¦å·ã€‚ æ­£å¦‚åœ¨ç»Ÿä¸€çš„ä½œä¸šæäº¤é€»è¾‘ä¸€èŠ‚ä¸­æåˆ°çš„ï¼ŒFlink 1.10 å°†å‘½ä»¤è¡Œå‚æ•°æ˜ å°„åˆ°äº†ç»Ÿä¸€çš„é…ç½®ã€‚å› æ­¤ï¼Œç”¨æˆ·å¯ä»¥å‚é˜… Kubernetes é…ç½®é€‰é¡¹ï¼Œåœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å‘ Kubernetes æäº¤ Flink ä½œä¸šã€‚ 1./bin/flink run -d -e kubernetes-session -Dkubernetes.cluster-id=&lt;ClusterId&gt; examples/streaming/WindowJoin.jar å¦‚æœä½ å¸Œæœ›ç¬¬ä¸€æ—¶é—´å°è¯•è¿™ä¸€ç‰¹æ€§ï¼Œæ¬¢è¿å‚è€ƒç›¸å…³æ–‡æ¡£ã€è¯•ç”¨å¹¶ä¸ç¤¾åŒºåˆ†äº«ä½ çš„åé¦ˆæ„è§ã€‚ Table API/SQL: ç”Ÿäº§å¯ç”¨çš„ Hive é›†æˆFlink 1.9 æ¨å‡ºäº†é¢„è§ˆç‰ˆçš„ Hive é›†æˆã€‚è¯¥ç‰ˆæœ¬å…è®¸ç”¨æˆ·ä½¿ç”¨ SQL DDL å°† Flink ç‰¹æœ‰çš„å…ƒæ•°æ®æŒä¹…åŒ–åˆ° Hive Metastoreã€è°ƒç”¨ Hive ä¸­å®šä¹‰çš„ UDF ä»¥åŠè¯»ã€å†™ Hive ä¸­çš„è¡¨ã€‚Flink 1.10 è¿›ä¸€æ­¥å¼€å‘å’Œå®Œå–„äº†è¿™ä¸€ç‰¹æ€§ï¼Œå¸¦æ¥äº†å…¨é¢å…¼å®¹ Hive ä¸»è¦ç‰ˆæœ¬çš„ç”Ÿäº§å¯ç”¨çš„ Hive é›†æˆã€‚ Batch SQL åŸç”Ÿåˆ†åŒºæ”¯æŒæ­¤å‰ï¼ŒFlink åªæ”¯æŒå†™å…¥æœªåˆ†åŒºçš„ Hive è¡¨ã€‚åœ¨ Flink 1.10 ä¸­ï¼ŒFlink SQL æ‰©å±•æ”¯æŒäº† INSERT OVERWRITE å’Œ PARTITION çš„è¯­æ³•ï¼ˆFLIP-63ï¼‰ï¼Œå…è®¸ç”¨æˆ·å†™å…¥ Hive ä¸­çš„é™æ€å’ŒåŠ¨æ€åˆ†åŒºã€‚ å†™å…¥é™æ€åˆ†åŒº 1INSERT &#123; INTO | OVERWRITE &#125; TABLE tablename1 [PARTITION (partcol1=val1, partcol2=val2 ...)] select_statement1 FROM from_statement; å†™å…¥åŠ¨æ€åˆ†åŒº 1INSERT &#123; INTO | OVERWRITE &#125; TABLE tablename1 select_statement1 FROM from_statement; å¯¹åˆ†åŒºè¡¨çš„å…¨é¢æ”¯æŒï¼Œä½¿å¾—ç”¨æˆ·åœ¨è¯»å–æ•°æ®æ—¶èƒ½å¤Ÿå—ç›Šäºåˆ†åŒºå‰ªæï¼Œå‡å°‘äº†éœ€è¦æ‰«æçš„æ•°æ®é‡ï¼Œä»è€Œå¤§å¹…æå‡äº†è¿™äº›æ“ä½œçš„æ€§èƒ½ã€‚ å…¶ä»–ä¼˜åŒ–é™¤äº†åˆ†åŒºå‰ªæï¼ŒFlink 1.10 çš„ Hive é›†æˆè¿˜å¼•å…¥äº†è®¸å¤šæ•°æ®è¯»å–æ–¹é¢çš„ä¼˜åŒ–ï¼Œä¾‹å¦‚ï¼š æŠ•å½±ä¸‹æ¨ï¼šFlink é‡‡ç”¨äº†æŠ•å½±ä¸‹æ¨æŠ€æœ¯ï¼Œé€šè¿‡åœ¨æ‰«æè¡¨æ—¶å¿½ç•¥ä¸å¿…è¦çš„åŸŸï¼Œæœ€å°åŒ– Flink å’Œ Hive è¡¨ä¹‹é—´çš„æ•°æ®ä¼ è¾“é‡ã€‚è¿™ä¸€ä¼˜åŒ–åœ¨è¡¨çš„åˆ—æ•°è¾ƒå¤šæ—¶å°¤ä¸ºæœ‰æ•ˆã€‚ LIMIT ä¸‹æ¨ï¼šå¯¹äºåŒ…å« LIMIT è¯­å¥çš„æŸ¥è¯¢ï¼ŒFlink åœ¨æ‰€æœ‰å¯èƒ½çš„åœ°æ–¹é™åˆ¶è¿”å›çš„æ•°æ®æ¡æ•°ï¼Œä»¥é™ä½é€šè¿‡ç½‘ç»œä¼ è¾“çš„æ•°æ®é‡ã€‚ è¯»å–æ•°æ®æ—¶çš„ ORC å‘é‡åŒ–ï¼š ä¸ºäº†æé«˜è¯»å– ORC æ–‡ä»¶çš„æ€§èƒ½ï¼Œå¯¹äº Hive 2.0.0 åŠä»¥ä¸Šç‰ˆæœ¬ä»¥åŠéå¤åˆæ•°æ®ç±»å‹çš„åˆ—ï¼ŒFlink ç°åœ¨é»˜è®¤ä½¿ç”¨åŸç”Ÿçš„ ORC å‘é‡åŒ–è¯»å–å™¨ã€‚ å°†å¯æ’æ‹”æ¨¡å—ä½œä¸º Flink å†…ç½®å¯¹è±¡ï¼ˆBetaï¼‰Flink 1.10 åœ¨ Flink table æ ¸å¿ƒå¼•å…¥äº†é€šç”¨çš„å¯æ’æ‹”æ¨¡å—æœºåˆ¶ï¼Œç›®å‰ä¸»è¦åº”ç”¨äºç³»ç»Ÿå†…ç½®å‡½æ•°ï¼ˆFLIP-68ï¼‰ã€‚é€šè¿‡æ¨¡å—ï¼Œç”¨æˆ·å¯ä»¥æ‰©å±• Flink çš„ç³»ç»Ÿå¯¹è±¡ï¼Œä¾‹å¦‚åƒä½¿ç”¨ Flink ç³»ç»Ÿå‡½æ•°ä¸€æ ·ä½¿ç”¨ Hive å†…ç½®å‡½æ•°ã€‚æ–°ç‰ˆæœ¬ä¸­åŒ…å«ä¸€ä¸ªé¢„å…ˆå®ç°å¥½çš„ HiveModuleï¼Œèƒ½å¤Ÿæ”¯æŒå¤šä¸ª Hive ç‰ˆæœ¬ï¼Œå½“ç„¶ç”¨æˆ·ä¹Ÿå¯ä»¥é€‰æ‹©ç¼–å†™è‡ªå·±çš„å¯æ’æ‹”æ¨¡å—ã€‚ å…¶ä»– Table API/SQL ä¼˜åŒ–SQL DDL ä¸­çš„ watermark å’Œè®¡ç®—åˆ—Flink 1.10 åœ¨ SQL DDL ä¸­å¢åŠ äº†é’ˆå¯¹æµå¤„ç†å®šä¹‰æ—¶é—´å±æ€§åŠäº§ç”Ÿ watermark çš„è¯­æ³•æ‰©å±•ï¼ˆFLIP-66ï¼‰ã€‚è¿™ä½¿å¾—ç”¨æˆ·å¯ä»¥åœ¨ç”¨ DDL è¯­å¥åˆ›å»ºçš„è¡¨ä¸Šè¿›è¡ŒåŸºäºæ—¶é—´çš„æ“ä½œï¼ˆä¾‹å¦‚çª—å£ï¼‰ä»¥åŠå®šä¹‰ watermark ç­–ç•¥ã€‚ 1234567CREATE TABLE table_name (WATERMARK FOR columnName AS &lt;watermark_strategy_expression&gt;) WITH (...) å…¶ä»– SQL DDL æ‰©å±•Flink ç°åœ¨ä¸¥æ ¼åŒºåˆ†ä¸´æ—¶/æŒä¹…ã€ç³»ç»Ÿ/ç›®å½•å‡½æ•°ï¼ˆFLIP-57ï¼‰ã€‚è¿™ä¸ä»…æ¶ˆé™¤äº†å‡½æ•°å¼•ç”¨ä¸­çš„æ­§ä¹‰ï¼Œè¿˜å¸¦æ¥äº†ç¡®å®šçš„å‡½æ•°è§£æé¡ºåºï¼ˆä¾‹å¦‚ï¼Œå½“å­˜åœ¨å‘½åå†²çªæ—¶ï¼Œæ¯”èµ·ç›®å½•å‡½æ•°ã€æŒä¹…å‡½æ•° Flink ä¼šä¼˜å…ˆä½¿ç”¨ç³»ç»Ÿå‡½æ•°ã€ä¸´æ—¶å‡½æ•°ï¼‰ã€‚ åœ¨ FLIP-57 çš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬æ‰©å±•äº† SQL DDL çš„è¯­æ³•ï¼Œæ”¯æŒåˆ›å»ºç›®å½•å‡½æ•°ã€ä¸´æ—¶å‡½æ•°ä»¥åŠä¸´æ—¶ç³»ç»Ÿå‡½æ•°ï¼ˆFLIP-79ï¼‰ï¼š 12345CREATE [TEMPORARY|TEMPORARY SYSTEM] FUNCTION[IF NOT EXISTS] [catalog_name.][db_name.]function_nameAS identifier [LANGUAGE JAVA|SCALA] å…³äºç›®å‰å®Œæ•´çš„ Flink SQL DDL æ”¯æŒï¼Œè¯·å‚è€ƒæœ€æ–°çš„æ–‡æ¡£ã€‚ æ³¨ï¼šä¸ºäº†ä»Šåæ­£ç¡®åœ°å¤„ç†å’Œä¿è¯å…ƒå¯¹è±¡ï¼ˆè¡¨ã€è§†å›¾ã€å‡½æ•°ï¼‰ä¸Šçš„è¡Œä¸ºä¸€è‡´æ€§ï¼ŒFlink åºŸå¼ƒäº† Table API ä¸­çš„éƒ¨åˆ†å¯¹è±¡ç”³æ˜æ–¹æ³•ï¼Œä»¥ä½¿ç•™ä¸‹çš„æ–¹æ³•æ›´åŠ æ¥è¿‘æ ‡å‡†çš„ SQL DDLï¼ˆFLIP-64ï¼‰ã€‚ æ‰¹å¤„ç†å®Œæ•´çš„ TPC-DS è¦†ç›–TPC-DS æ˜¯å¹¿æ³›ä½¿ç”¨çš„ä¸šç•Œæ ‡å‡†å†³ç­–æ”¯æŒ benchmarkï¼Œç”¨äºè¡¡é‡åŸºäº SQL çš„æ•°æ®å¤„ç†å¼•æ“æ€§èƒ½ã€‚Flink 1.10 ç«¯åˆ°ç«¯åœ°æ”¯æŒæ‰€æœ‰ TPC-DS æŸ¥è¯¢ï¼ˆFLINK-11491ï¼‰ï¼Œæ ‡å¿—ç€ Flink SQL å¼•æ“å·²ç»å…·å¤‡æ»¡è¶³ç°ä»£æ•°æ®ä»“åº“åŠå…¶ä»–ç±»ä¼¼çš„å¤„ç†éœ€æ±‚çš„èƒ½åŠ›ã€‚ PyFlink: æ”¯æŒåŸç”Ÿç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼ˆUDFï¼‰ä½œä¸º Flink å…¨é¢æ”¯æŒ Python çš„ç¬¬ä¸€æ­¥ï¼Œåœ¨ä¹‹å‰ç‰ˆæœ¬ä¸­æˆ‘ä»¬å‘å¸ƒäº†é¢„è§ˆç‰ˆçš„ PyFlinkã€‚åœ¨æ–°ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬ä¸“æ³¨äºè®©ç”¨æˆ·åœ¨ Table API/SQL ä¸­æ³¨å†Œå¹¶ä½¿ç”¨è‡ªå®šä¹‰å‡½æ•°ï¼ˆUDFï¼Œå¦ UDTF / UDAF è§„åˆ’ä¸­ï¼‰ï¼ˆFLIP-58ï¼‰ã€‚ å¦‚æœä½ å¯¹è¿™ä¸€ç‰¹æ€§çš„åº•å±‚å®ç°ï¼ˆåŸºäº Apache Beam çš„å¯ç§»æ¤æ¡†æ¶ï¼‰æ„Ÿå…´è¶£ï¼Œè¯·å‚è€ƒ FLIP-58 çš„ Architecture ç« èŠ‚ä»¥åŠ FLIP-78ã€‚è¿™äº›æ•°æ®ç»“æ„ä¸ºæ”¯æŒ Pandas ä»¥åŠä»Šåå°† PyFlink å¼•å…¥åˆ° DataStream API å¥ å®šäº†åŸºç¡€ã€‚ ä» Flink 1.10 å¼€å§‹ï¼Œç”¨æˆ·åªè¦æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å°±å¯ä»¥è½»æ¾åœ°é€šè¿‡ pip å®‰è£… PyFlinkï¼š 1pip install apache-flink é‡è¦å˜æ›´ FLINK-10725ï¼šFlink ç°åœ¨å¯ä»¥ä½¿ç”¨ Java 11 ç¼–è¯‘å’Œè¿è¡Œã€‚ FLINK-15495ï¼šSQL å®¢æˆ·ç«¯ç°åœ¨é»˜è®¤ä½¿ç”¨ Blink plannerï¼Œå‘ç”¨æˆ·æä¾›æœ€æ–°çš„ç‰¹æ€§åŠä¼˜åŒ–ã€‚Table API åŒæ ·è®¡åˆ’åœ¨ä¸‹ä¸ªç‰ˆæœ¬ä¸­ä»æ—§çš„ planner åˆ‡æ¢åˆ° Blink plannerï¼Œæˆ‘ä»¬å»ºè®®ç”¨æˆ·ç°åœ¨å°±å¼€å§‹å°è¯•å’Œç†Ÿæ‚‰ Blink plannerã€‚ FLINK-13025ï¼šæ–°çš„ Elasticsearch sink connector å…¨é¢æ”¯æŒ Elasticsearch 7.x ç‰ˆæœ¬ã€‚ FLINK-15115ï¼šKafka 0.8 å’Œ 0.9 çš„ connector å·²è¢«æ ‡è®°ä¸ºåºŸå¼ƒå¹¶ä¸å†ä¸»åŠ¨æ”¯æŒã€‚å¦‚æœä½ è¿˜åœ¨ä½¿ç”¨è¿™äº›ç‰ˆæœ¬æˆ–æœ‰å…¶ä»–ç›¸å…³é—®é¢˜ï¼Œè¯·é€šè¿‡ @dev é‚®ä»¶åˆ—è¡¨è”ç³»æˆ‘ä»¬ã€‚ FLINK-14516ï¼šéåŸºäºä¿¡ç”¨çš„ç½‘ç»œæµæ§åˆ¶å·²è¢«ç§»é™¤ï¼ŒåŒæ—¶ç§»é™¤çš„è¿˜æœ‰é…ç½®é¡¹â€œtaskmanager.network.credit.modelâ€ã€‚ä»Šåï¼ŒFlink å°†æ€»æ˜¯ä½¿ç”¨åŸºäºä¿¡ç”¨çš„ç½‘ç»œæµæ§åˆ¶ã€‚ FLINK-12122ï¼šåœ¨ Flink 1.5.0 ä¸­ï¼ŒFLIP-6 æ”¹å˜äº† slot åœ¨ TaskManager ä¹‹é—´çš„åˆ†å¸ƒæ–¹å¼ã€‚è¦æƒ³ä½¿ç”¨æ­¤å‰çš„è°ƒåº¦ç­–ç•¥ï¼Œæ—¢å°½å¯èƒ½å°†è´Ÿè½½åˆ†æ•£åˆ°æ‰€æœ‰å½“å‰å¯ç”¨çš„ TaskManagerï¼Œç”¨æˆ·å¯ä»¥åœ¨ flink-conf.yaml ä¸­è®¾ç½® â€œcluster.evenly-spread-out-slots: trueâ€ã€‚ FLINK-11956ï¼šs3-hadoop å’Œ s3-presto æ–‡ä»¶ç³»ç»Ÿä¸å†ä½¿ç”¨ç±»é‡å®šä½åŠ è½½æ–¹å¼ï¼Œè€Œæ˜¯ä½¿ç”¨æ’ä»¶æ–¹å¼åŠ è½½ï¼ŒåŒæ—¶æ— ç¼é›†æˆæ‰€æœ‰è®¤è¯æä¾›è€…ã€‚æˆ‘ä»¬å¼ºçƒˆå»ºè®®å…¶ä»–æ–‡ä»¶ç³»ç»Ÿä¹Ÿåªä½¿ç”¨æ’ä»¶åŠ è½½æ–¹å¼ï¼Œå¹¶å°†é™†ç»­ç§»é™¤é‡å®šä½åŠ è½½æ–¹å¼ã€‚ Flink 1.9 æ¨å‡ºäº†æ–°çš„ Web UIï¼ŒåŒæ—¶ä¿ç•™äº†åŸæ¥çš„ Web UI ä»¥å¤‡ä¸æ—¶ä¹‹éœ€ã€‚æˆªè‡³ç›®å‰ï¼Œæˆ‘ä»¬æ²¡æœ‰æ”¶åˆ°å…³äºæ–°çš„ UI å­˜åœ¨é—®é¢˜çš„åé¦ˆï¼Œå› æ­¤ç¤¾åŒºæŠ•ç¥¨å†³å®šåœ¨ Flink 1.10 ä¸­ç§»é™¤æ—§çš„ Web UIã€‚ å…³æ³¨æˆ‘å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f Github ä»£ç ä»“åº“https://github.com/zhisheng17/flink-learning/ ä»¥åè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç éƒ½å°†æ”¾åœ¨è¿™ä¸ªä»“åº“é‡Œï¼ŒåŒ…å«äº†è‡ªå·±å­¦ä¹  flink çš„ä¸€äº› demo å’Œåšå®¢ åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€å®æˆ˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"å®æ—¶è®¡ç®—","slug":"å®æ—¶è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/å®æ—¶è®¡ç®—/"}]},{"title":"Flink è§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€åŸç†ã€å®æˆ˜ã€æ€§èƒ½è°ƒä¼˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°","date":"2019-12-30T16:00:00.000Z","path":"2019/12/31/Flink-resources/","text":"Flink ä¸“æ é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f ä¸“æ å¤§çº²ï¼š Flink å­¦ä¹ é¡¹ç›®ä»£ç https://github.com/zhisheng17/flink-learning éº»çƒ¦è·¯è¿‡çš„å„ä½äº²ç»™è¿™ä¸ªé¡¹ç›®ç‚¹ä¸ª starï¼Œå¤ªä¸æ˜“äº†ï¼Œå†™äº†è¿™ä¹ˆå¤šï¼Œç®—æ˜¯å¯¹æˆ‘åšæŒä¸‹æ¥çš„ä¸€ç§é¼“åŠ±å§ï¼ æœ¬é¡¹ç›®ç»“æ„ How to buildMaybe your Maven conf file settings.xml mirrors can add aliyun central mirror : 123456&lt;mirror&gt; &lt;id&gt;alimaven&lt;/id&gt; &lt;mirrorOf&gt;central&lt;/mirrorOf&gt; &lt;name&gt;aliyun maven&lt;/name&gt; &lt;url&gt;https://maven.aliyun.com/repository/central&lt;/url&gt;&lt;/mirror&gt; then you can run the following command : 1mvn clean package -Dmaven.test.skip=true you can see following result if build success. Change2019/09/06 å°†è¯¥é¡¹ç›®çš„ Flink ç‰ˆæœ¬å‡çº§åˆ° 1.9.0ï¼Œæœ‰ä¸€äº›å˜åŠ¨ï¼ŒFlink 1.8.0 ç‰ˆæœ¬çš„ä»£ç ç»ç¾¤é‡Œè®¨è®ºä¿å­˜åœ¨åˆ†æ”¯ feature/flink-1.8.0 ä»¥ä¾¿éƒ¨åˆ†åŒå­¦éœ€è¦ã€‚ 2019/06/08 æ–°å¢ Flink å››æœ¬ç”µå­ä¹¦ç±çš„ PDFï¼Œåœ¨ books ç›®å½•ä¸‹ï¼š Introduction_to_Apache_Flink_book.pdf è¿™æœ¬ä¹¦æ¯”è¾ƒè–„ï¼Œå¤„äºä»‹ç»é˜¶æ®µï¼Œå›½å†…æœ‰è¿™æœ¬çš„ç¿»è¯‘ä¹¦ç± Learning Apache Flink.pdf è¿™æœ¬ä¹¦æ¯”è¾ƒåŸºç¡€ï¼Œåˆå­¦çš„è¯å¯ä»¥å¤šçœ‹çœ‹ Stream Processing with Apache Flink.pdf è¿™æœ¬ä¹¦æ˜¯ Flink PMC å†™çš„ Streaming System.pdf è¿™æœ¬ä¹¦è¯„ä»·ä¸æ˜¯ä¸€èˆ¬çš„é«˜ 2019/06/09 æ–°å¢æµå¤„ç†å¼•æ“ç›¸å…³çš„ Paperï¼Œåœ¨ paper ç›®å½•ä¸‹ï¼š æµå¤„ç†å¼•æ“ç›¸å…³çš„ Paper åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† Flink æºç é¡¹ç›®ç»“æ„ å­¦ä¹ èµ„æ–™å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·äº†ã€‚ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œç„¶åå›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ï¼Œè½¬è½½è¯·è”ç³»æœ¬äººè·å–æˆæƒï¼Œè¿è€…å¿…ç©¶ã€‚ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ æœ‰äººè¦é—®çŸ¥è¯†æ˜Ÿçƒé‡Œé¢æ›´æ–°ä»€ä¹ˆå†…å®¹ï¼Ÿå€¼å¾—åŠ å…¥å—ï¼Ÿ ç›®å‰çŸ¥è¯†æ˜Ÿçƒå†…å·²æ›´æ–°çš„ç³»åˆ—æ–‡ç« ï¼š å¤§æ•°æ®é‡ç£…ç‚¸å¼¹1ã€ã€Šå¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—å¼•æ“ Flinkã€‹å¼€ç¯‡è¯ 2ã€ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 3ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—æ¡†æ¶ Flink â€‹ 4ã€åˆ«å†å‚»å‚»çš„åˆ†ä¸æ¸…å¤§æ•°æ®æ¡†æ¶Flinkã€Blinkã€Spark Streamingã€Structured Streamingå’ŒStormä¹‹é—´çš„åŒºåˆ«äº†â€‹ 5ã€Flink ç¯å¢ƒå‡†å¤‡çœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 6ã€ä¸€æ–‡è®²è§£ä» Flink ç¯å¢ƒå®‰è£…åˆ°æºç ç¼–è¯‘è¿è¡Œ 7ã€é€šè¿‡ WordCount ç¨‹åºæ•™ä½ å¿«é€Ÿå…¥é—¨ä¸Šæ‰‹ Flink â€‹ 8ã€Flink å¦‚ä½•å¤„ç† Socket æ•°æ®åŠåˆ†æå®ç°è¿‡ç¨‹ 9ã€Flink job å¦‚ä½•åœ¨ Standaloneã€YARNã€Mesosã€K8S ä¸Šéƒ¨ç½²è¿è¡Œï¼Ÿ 10ã€Flink æ•°æ®è½¬æ¢å¿…é¡»ç†Ÿæ‚‰çš„ç®—å­ï¼ˆOperatorï¼‰ 11ã€Flink ä¸­ Processing Timeã€Event Timeã€Ingestion Time å¯¹æ¯”åŠå…¶ä½¿ç”¨åœºæ™¯åˆ†æ 12ã€å¦‚ä½•ä½¿ç”¨ Flink Window åŠ Window åŸºæœ¬æ¦‚å¿µä¸å®ç°åŸç† 13ã€å¦‚ä½•ä½¿ç”¨ DataStream API æ¥å¤„ç†æ•°æ®ï¼Ÿ 14ã€Flink WaterMark è¯¦è§£åŠç»“åˆ WaterMark å¤„ç†å»¶è¿Ÿæ•°æ® æºç ç³»åˆ—1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalonesession æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ é™¤äº†ã€Šä»1åˆ°100æ·±å…¥å­¦ä¹ Flinkã€‹æºç å­¦ä¹ è¿™ä¸ªç³»åˆ—æ–‡ç« ï¼Œã€Šä»0åˆ°1å­¦ä¹ Flinkã€‹çš„æ¡ˆä¾‹æ–‡ç« ä¹Ÿä¼šä¼˜å…ˆåœ¨çŸ¥è¯†æ˜Ÿçƒæ›´æ–°ï¼Œè®©å¤§å®¶å…ˆé€šè¿‡ä¸€äº› demo å­¦ä¹  Flinkï¼Œå†å»æ·±å…¥æºç å­¦ä¹ ï¼ å¦‚æœå­¦ä¹  Flink çš„è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°ä»€ä¹ˆé—®é¢˜ï¼Œå¯ä»¥åœ¨é‡Œé¢æé—®ï¼Œæˆ‘ä¼šä¼˜å…ˆè§£ç­”ï¼Œè¿™é‡Œåšä¸ªæŠ±æ­‰ï¼Œè‡ªå·±å¹³æ—¶å·¥ä½œä¹ŸæŒºå¿™ï¼Œå¾®ä¿¡çš„é—®é¢˜ä¸èƒ½åšå…¨éƒ¨åšä¸€äº›è§£ç­”ï¼Œä½†è‚¯å®šä¼šä¼˜å…ˆå›å¤ç»™çŸ¥è¯†æ˜Ÿçƒçš„ä»˜è´¹ç”¨æˆ·çš„ï¼Œåº†å¹¸çš„æ˜¯ç°åœ¨æ˜Ÿçƒé‡Œçš„æ´»è·ƒæ°›å›´è¿˜æ˜¯å¯ä»¥çš„ï¼Œæœ‰ä¸å°‘é—®é¢˜é€šè¿‡æé—®å’Œè§£ç­”çš„æ–¹å¼æ²‰æ·€äº†ä¸‹æ¥ã€‚ 1ã€ä¸ºä½•æˆ‘ä½¿ç”¨ ValueState ä¿å­˜çŠ¶æ€ Job æ¢å¤æ˜¯çŠ¶æ€æ²¡æ¢å¤ï¼Ÿ 2ã€flinkä¸­watermarkç©¶ç«Ÿæ˜¯å¦‚ä½•ç”Ÿæˆçš„ï¼Œç”Ÿæˆçš„è§„åˆ™æ˜¯ä»€ä¹ˆï¼Œæ€ä¹ˆç”¨æ¥å¤„ç†ä¹±åºæ•°æ® 3ã€æ¶ˆè´¹kafkaæ•°æ®çš„æ—¶å€™ï¼Œå¦‚æœé‡åˆ°äº†è„æ•°æ®ï¼Œæˆ–è€…æ˜¯ä¸ç¬¦åˆè§„åˆ™çš„æ•°æ®ç­‰ç­‰æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ 4ã€åœ¨Kafka é›†ç¾¤ä¸­æ€ä¹ˆæŒ‡å®šè¯»å–/å†™å…¥æ•°æ®åˆ°æŒ‡å®šbrokeræˆ–ä»æŒ‡å®šbrokerçš„offsetå¼€å§‹æ¶ˆè´¹ï¼Ÿ 5ã€Flinkèƒ½é€šè¿‡oozieæˆ–è€…azkabanæäº¤å—ï¼Ÿ 6ã€jobmanageræŒ‚æ‰åï¼Œæäº¤çš„jobæ€ä¹ˆä¸ç»è¿‡æ‰‹åŠ¨é‡æ–°æäº¤æ‰§è¡Œï¼Ÿ 7ã€ä½¿ç”¨flink-web-uiæäº¤ä½œä¸šå¹¶æ‰§è¡Œ ä½†æ˜¯/opt/flink/logç›®å½•ä¸‹æ²¡æœ‰æ—¥å¿—æ–‡ä»¶ è¯·é—®å…³äºflinkçš„æ—¥å¿—ï¼ˆåŒ…æ‹¬jobmanagerã€taskmanagerã€æ¯ä¸ªjobè‡ªå·±çš„æ—¥å¿—é»˜è®¤åˆ†åˆ«å­˜åœ¨å“ªä¸ªç›®å½• ï¼‰éœ€è¦æ€ä¹ˆé…ç½®ï¼Ÿ 8ã€é€šè¿‡flink ä»ªè¡¨ç›˜æäº¤çš„jar æ˜¯å­˜å‚¨åœ¨å“ªä¸ªç›®å½•ä¸‹ï¼Ÿ 9ã€ä»Kafkaæ¶ˆè´¹æ•°æ®è¿›è¡Œetlæ¸…æ´—ï¼ŒæŠŠç»“æœå†™å…¥hdfsæ˜ å°„æˆhiveè¡¨ï¼Œå‹ç¼©æ ¼å¼ã€hiveç›´æ¥èƒ½å¤Ÿè¯»å–flinkå†™å‡ºçš„æ–‡ä»¶ã€æŒ‰ç…§æ–‡ä»¶å¤§å°æˆ–è€…æ—¶é—´æ»šåŠ¨ç”Ÿæˆæ–‡ä»¶ 10ã€flink jaråŒ…ä¸Šä¼ è‡³é›†ç¾¤ä¸Šè¿è¡Œï¼ŒæŒ‚æ‰åï¼ŒæŒ‚æ‰æœŸé—´kafkaä¸­æœªè¢«æ¶ˆè´¹çš„æ•°æ®ï¼Œåœ¨é‡æ–°å¯åŠ¨ç¨‹åºåï¼Œæ˜¯è‡ªåŠ¨ä»checkpointè·å–æŒ‚æ‰ä¹‹å‰çš„kafka offsetä½ç½®ï¼Œè‡ªåŠ¨æ¶ˆè´¹ä¹‹å‰çš„æ•°æ®è¿›è¡Œå¤„ç†ï¼Œè¿˜æ˜¯éœ€è¦æŸäº›æ‰‹åŠ¨çš„æ“ä½œå‘¢ï¼Ÿ 11ã€flink å¯åŠ¨æ—¶ä¸è‡ªåŠ¨åˆ›å»º ä¸Šä¼ jarçš„è·¯å¾„ï¼Œèƒ½æŒ‡å®šä¸€ä¸ªåˆ›å»ºå¥½çš„ç›®å½•å— 12ã€Flink sink to es é›†ç¾¤ä¸ŠæŠ¥ slot ä¸å¤Ÿï¼Œå•æœºè·‘æ˜¯å¥½çš„ï¼Œä¸ºä»€ä¹ˆï¼Ÿ 13ã€Fllink to elasticsearchå¦‚ä½•åˆ›å»ºç´¢å¼•æ–‡æ¡£æœŸæ—¶é—´æˆ³ï¼Ÿ 14ã€blinkæœ‰æ²¡æœ‰apiæ–‡æ¡£æˆ–è€…demoï¼Œæ˜¯å¦å»ºè®®blinkç”¨äºç”Ÿäº§ç¯å¢ƒã€‚ 15ã€flinkçš„Python apiæ€æ ·ï¼Ÿbugå¤šå—ï¼Ÿ 16ã€Flink VS Spark Streaming VS Storm VS Kafka Stream 17ã€ä½ ä»¬åšå®æ—¶å¤§å±çš„æŠ€æœ¯æ¶æ„æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Ÿflumeâ†’kafkaâ†’flinkâ†’redisï¼Œç„¶ååç«¯å»redisé‡Œé¢ææ•°æ®ï¼Œé…±ç´«å¯è¡Œå—ï¼Ÿ 18ã€åšä¸€ä¸ªç»Ÿè®¡æŒ‡æ ‡çš„æ—¶å€™ï¼Œéœ€è¦åœ¨Flinkçš„è®¡ç®—è¿‡ç¨‹ä¸­å¤šæ¬¡è¯»å†™redisï¼Œæ„Ÿè§‰å¥½æ€ªï¼Œæ˜Ÿä¸»æœ‰æ²¡æœ‰å¥½çš„æ–¹æ¡ˆï¼Ÿ 19ã€Flink ä½¿ç”¨åœºæ™¯å¤§åˆ†æï¼Œåˆ—ä¸¾äº†å¾ˆå¤šçš„å¸¸ç”¨åœºæ™¯ï¼Œå¯ä»¥å¥½å¥½å‚è€ƒä¸€ä¸‹ 20ã€å°†kafkaä¸­æ•°æ®sinkåˆ°mysqlæ—¶ï¼Œmetadataçš„æ•°æ®ä¸ºç©ºï¼Œå¯¼å…¥mysqlæ•°æ®ä¸æˆåŠŸï¼Ÿï¼Ÿï¼Ÿ 21ã€ä½¿ç”¨äº†ValueStateæ¥ä¿å­˜ä¸­é—´çŠ¶æ€ï¼Œåœ¨è¿è¡Œæ—¶ä¸­é—´çŠ¶æ€ä¿å­˜æ­£å¸¸ï¼Œä½†æ˜¯åœ¨æ‰‹åŠ¨åœæ­¢åï¼Œå†é‡æ–°è¿è¡Œï¼Œå‘ç°ä¸­é—´çŠ¶æ€å€¼æ²¡æœ‰äº†ï¼Œä¹‹å‰å‡ºç°çš„é”®å€¼æ˜¯ä»0å¼€å§‹è®¡æ•°çš„ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿæ˜¯éœ€è¦å®ç°CheckpointedFunctionå—ï¼Ÿ 22ã€flink on yarn jobmanagerçš„HAéœ€è¦æ€ä¹ˆé…ç½®ã€‚è¿˜æ˜¯è¯´yarnç»™ç®¡ç†äº† 23ã€æœ‰ä¸¤ä¸ªæ•°æ®æµå°±è¡Œconnectï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯å®æ—¶æ•°æ®æµï¼ˆkafka è¯»å–)ï¼Œå¦ä¸€ä¸ªæ˜¯é…ç½®æµã€‚ç”±äºé…ç½®æµæ˜¯ä»å…³ç³»å‹æ•°æ®åº“ä¸­è¯»å–ï¼Œé€Ÿåº¦è¾ƒæ…¢ï¼Œå¯¼è‡´å®æ—¶æ•°æ®æµæµå…¥æ•°æ®çš„æ—¶å€™ï¼Œé…ç½®ä¿¡æ¯è¿˜æœªå‘é€ï¼Œè¿™æ ·ä¼šå¯¼è‡´æœ‰äº›å®æ—¶æ•°æ®è¯»å–ä¸åˆ°é…ç½®ä¿¡æ¯ã€‚ç›®å‰é‡‡å–çš„æªæ–½æ˜¯åœ¨connectæ–¹æ³•åçš„flatmapçš„å®ç°çš„åœ¨open æ–¹æ³•ä¸­ï¼Œæå‰åŠ è½½ä¸€æ¬¡é…ç½®ä¿¡æ¯ï¼Œæ„Ÿè§‰è¿™ç§å®ç°æ–¹å¼ä¸å‹å¥½ï¼Œè¯·é—®è¿˜æœ‰å…¶ä»–çš„å®ç°æ–¹å¼å—ï¼Ÿ 24ã€Flinkèƒ½é€šè¿‡oozieæˆ–è€…azkabanæäº¤å—ï¼Ÿ 25ã€ä¸é‡‡ç”¨yarméƒ¨ç½²flinkï¼Œè¿˜æœ‰å…¶ä»–çš„æ–¹æ¡ˆå—ï¼Ÿ ä¸»è¦æƒ³è§£å†³æœåŠ¡å™¨é‡å¯åï¼ŒflinkæœåŠ¡æ€ä¹ˆè‡ªåŠ¨æ‹‰èµ·ï¼Ÿ jobmanageræŒ‚æ‰åï¼Œæäº¤çš„jobæ€ä¹ˆä¸ç»è¿‡æ‰‹åŠ¨é‡æ–°æäº¤æ‰§è¡Œï¼Ÿ 26ã€åœ¨ä¸€ä¸ª Job é‡Œå°†åŒä»½æ•°æ®æ˜¨æ™šæ¸…æ´—æ“ä½œåï¼Œsink åˆ°åç«¯å¤šä¸ªåœ°æ–¹ï¼ˆçœ‹ä¸šåŠ¡éœ€æ±‚ï¼‰ï¼Œå¦‚ä½•ä¿æŒä¸€è‡´æ€§ï¼Ÿï¼ˆä¸€ä¸ªsinkå‡ºé”™ï¼Œå¦å¤–çš„ä¹Ÿä¿è¯ä¸èƒ½æ’å…¥ï¼‰ 27ã€flink sqlä»»åŠ¡åœ¨æŸä¸ªç‰¹å®šé˜¶æ®µä¼šå‘ç”Ÿtmå’Œjmä¸¢å¤±å¿ƒè·³ï¼Œæ˜¯ä¸æ˜¯ç”±äºgcæ—¶é—´è¿‡é•¿å‘¢ï¼Œ 28ã€æœ‰è¿™æ ·ä¸€ä¸ªéœ€æ±‚ï¼Œç»Ÿè®¡ç”¨æˆ·è¿‘ä¸¤å‘¨è¿›å…¥äº§å“è¯¦æƒ…é¡µçš„æ¥æºï¼ˆ1é¦–é¡µå¤§æœç´¢ï¼Œ2äº§å“é¢‘é“æœç´¢ï¼Œ3å…¶ä»–ï¼‰ï¼Œä¸ºphpåç«¯æä¾›æ•°æ®æ”¯æŒï¼Œè¯¥ä¿¡æ¯åœ¨ç«¯ä¸ŠæŠ¥äº‹ä»¶ä¸­ï¼Œphpç›´æ¥è·å–æœ‰ç‚¹å›°éš¾ã€‚ æˆ‘ç°åœ¨çš„è§£å†³æ–¹æ¡ˆ é€šè¿‡flinkæ»šåŠ¨çª—å£ï¼ˆåŠå°æ—¶ï¼‰ï¼Œç»Ÿè®¡ç”¨æˆ·åŠå°æ—¶å†…3ä¸ªæ¥æºpvï¼Œç„¶åæŒ‰ç…§æ—¥æœŸåºåˆ—åŒ–ï¼Œç›´æ¥å†™mysqlã€‚phpä»æ•°æ®åº“ä¸­è§£æå‡ºæ¥ï¼Œå†å»ç»Ÿè®¡è¿‘ä¸¤å‘¨å æ¯”ã€‚ é—®é¢˜1ï¼Œè¿™ä¸ªéœ€æ±‚é€‚åˆç”¨flinkå»åšå—ï¼Ÿ é—®é¢˜2ï¼Œæˆ‘çš„æ–¹æ¡ˆæ€»æ„Ÿè§‰æ€ªæ€ªçš„ï¼Œæœ‰æ²¡æœ‰å¥½çš„æ–¹æ¡ˆï¼Ÿ 29ã€ä¸€ä¸ªtask slot åªèƒ½åŒæ—¶è¿è¡Œä¸€ä¸ªä»»åŠ¡è¿˜æ˜¯å¤šä¸ªä»»åŠ¡å‘¢ï¼Ÿå¦‚æœtask slotè¿è¡Œçš„ä»»åŠ¡æ¯”è¾ƒå¤§ï¼Œä¼šå‡ºç°OOMçš„æƒ…å†µå—ï¼Ÿ 30ã€ä½ ä»¬æ€ä¹ˆå¯¹çº¿ä¸Šflinkåšç›‘æ§çš„ï¼Œå¦‚æœæ•´ä¸ªç¨‹åºå¤±è´¥äº†æ€ä¹ˆè‡ªåŠ¨é‡å¯ç­‰ç­‰ 31ã€flink cepè§„åˆ™åŠ¨æ€è§£ææœ‰æ¥è§¦å—ï¼Ÿæœ‰æ²¡æœ‰æˆå‹çš„æ¡†æ¶ï¼Ÿ 32ã€æ¯ä¸€ä¸ªWindowéƒ½æœ‰ä¸€ä¸ªwatermarkå—ï¼Ÿwindowæ˜¯æ€ä¹ˆæ ¹æ®watermarkè¿›è¡Œè§¦å‘æˆ–è€…é”€æ¯çš„ï¼Ÿ 33ã€ CheckPointä¸SavePointçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ 34ã€flinkå¯ä»¥åœ¨ç®—å­ä¸­å…±äº«çŠ¶æ€å—ï¼Ÿæˆ–è€…å¤§ä½¬ä½ æœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥å…±äº«çŠ¶æ€çš„å‘¢ï¼Ÿ 35ã€è¿è¡Œå‡ åˆ†é’Ÿå°±æŠ¥äº†ï¼Œçœ‹taskmageræ—¥å¿—ï¼ŒæŠ¥çš„æ˜¯ failed elasticsearch bulk request nullï¼Œå¯æ˜¯æˆ‘ä»£ç é‡Œé¢å·²ç»åšè¿‡ç©ºå€¼åˆ¤æ–­äº†å‘€ è€Œä¸”ä¹Ÿè¿‡æ»¤æ‰äº†ï¼Œflinkç‰ˆæœ¬1.7.2 esç‰ˆæœ¬6.3.1 36ã€è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬è°ƒå¹¶è¡Œåº¦ è¿˜æ˜¯é…ç½®å‚æ•°å¥½ 37ã€å¤§å®¶éƒ½ç”¨jdbcå†™ï¼Œå„ç§æ•°æ®åº“å¢åˆ æŸ¥æ”¹æ‹¼sqlæœ‰æ²¡æœ‰è§‰å¾—å¾ˆç´¯ï¼Œps.setä»£ç ä¸€å¤§å †ï¼Œè¿˜è¦è®¡ç®—æ¯ä¸ªå‚æ•°çš„ä½ç½® 38ã€å…³äºdatasourceçš„é…ç½®ï¼Œæ¯ä¸ªtaskmanagerå¯¹åº”ä¸€ä¸ªdatasource?è¿˜æ˜¯æ¯ä¸ªslot? å®é™…è¿è¡Œä¸‹æ¥ï¼Œæ¯ä¸ªslotä¸­datasorceçº¿ç¨‹æ± åªè¦è®¾ç½®1å°±è¡Œäº†ï¼Œå¤šäº†ä¹Ÿç”¨ä¸åˆ°? 39ã€kafkaç°åœ¨æ¯å¤©å‡ºç°æ•°æ®ä¸¢å¤±ï¼Œç°åœ¨å°æ‰¹é‡æ•°æ®ï¼Œä¸€å¤©200Wå·¦å³, kafkaç‰ˆæœ¬ä¸º 1.0.0ï¼Œé›†ç¾¤æ€»å…±7ä¸ªèŠ‚ç‚¹ï¼ŒTOPICæœ‰åå…­ä¸ªåˆ†åŒºï¼Œå•æ¡æŠ¥æ–‡1.5kå·¦å³ 40ã€æ ¹æ®key.hashçš„ç»å¯¹å€¼ å¯¹å¹¶å‘åº¦æ±‚æ¨¡ï¼Œè¿›è¡Œåˆ†ç»„ï¼Œå‡è®¾10å„å¹¶å‘åº¦ï¼Œå®é™…åªæœ‰8ä¸ªåˆ†åŒºæœ‰å¤„ç†æ•°æ®ï¼Œæœ‰2ä¸ªå§‹ç»ˆä¸å¤„ç†ï¼Œè¿˜æœ‰ä¸€ä¸ªåˆ†åŒºå¤„ç†çš„æ•°æ®æ˜¯å…¶ä»–çš„ä¸‰å€ï¼Œå¦‚æˆªå›¾ 41ã€flinkæ¯7å°æ—¶ä¸çŸ¥é“åœ¨å¤„ç†ä»€ä¹ˆï¼Œ CPU è´Ÿè½½ æ¯7å°æ—¶ï¼Œæœ‰ä¸€æ¬¡é«˜å³°ï¼Œ5åˆ†é’Ÿå†…å¹³å‡è´Ÿè½½è¶…è¿‡0.8ï¼Œå¦‚æˆªå›¾ 42ã€æœ‰æ²¡æœ‰Flinkå†™çš„é¡¹ç›®æ¨èï¼Ÿæˆ‘æƒ³çœ‹åˆ°ç”¨Flinkå†™çš„æ•´ä½“é¡¹ç›®æ˜¯æ€ä¹ˆç»„ç»‡çš„ï¼Œä¸å•å•æ˜¯ä¸€ä¸ªå•ä¾‹å­ 43ã€Flink æºç çš„ç»“æ„å›¾ 44ã€æˆ‘æƒ³æ ¹æ®ä¸åŒä¸šåŠ¡è¡¨ï¼ˆcase whenï¼‰è¿›è¡Œä¸åŒçš„redis sinkï¼ˆhash ï¼Œsetï¼‰ï¼Œæˆ‘è¦å¦‚ä½•æ“ä½œï¼Ÿ 45ã€è¿™ä¸ªéœ€è¦æ¸…ç†ä»€ä¹ˆæ•°æ®å‘€ï¼Œæˆ‘æŠŠhdfsé‡Œé¢çš„å·²ç»æ¸…ç†äº† å¯åŠ¨è¿˜æ˜¯æŠ¥è¿™ä¸ª 46ã€ åœ¨æµå¤„ç†ç³»ç»Ÿï¼Œåœ¨æœºå™¨å‘ç”Ÿæ•…éšœæ¢å¤ä¹‹åï¼Œä»€ä¹ˆæƒ…å†µæ¶ˆæ¯æœ€å¤šä¼šè¢«å¤„ç†ä¸€æ¬¡ï¼Ÿä»€ä¹ˆæƒ…å†µæ¶ˆæ¯æœ€å°‘ä¼šè¢«å¤„ç†ä¸€æ¬¡å‘¢ï¼Ÿ 47ã€æˆ‘æ£€æŸ¥ç‚¹éƒ½è°ƒåˆ°5åˆ†é’Ÿäº†ï¼Œè¿™æ˜¯ä»€ä¹ˆé—®é¢˜ 48ã€reduceæ–¹æ³•å é‚£ä¸ªäº¤æ˜“æ—¶é—´ æ€ä¹ˆä¸æ˜¯æœ€æ–°çš„ï¼Œæ˜¯ç¬¬ä¸€æ¬¡è¿›å…¥çš„é‚£ä¸ªæ—¶é—´ï¼Œ 49ã€Flink on Yarn æ¨¡å¼ï¼Œç”¨yarn sessionè„šæœ¬å¯åŠ¨çš„æ—¶å€™ï¼Œæˆ‘åœ¨åå°æ²¡æœ‰çœ‹åˆ°åˆ°Jobmanagerï¼ŒTaskManagerï¼ŒApplicationMasterè¿™å‡ ä¸ªè¿›ç¨‹ï¼Œæƒ³è¯·é—®ä¸€ä¸‹è¿™æ˜¯ä»€ä¹ˆåŸå› å‘¢ï¼Ÿå› ä¸ºä¹‹å‰çœ‹å®˜ç½‘çš„æ—¶å€™ï¼Œè¯´Jobmanagerå°±æ˜¯ä¸€ä¸ªjvmè¿›ç¨‹ï¼ŒTaskmanageä¹Ÿæ˜¯ä¸€ä¸ªJVMè¿›ç¨‹ 50ã€Flink on Yarnçš„æ—¶å€™å¾—æŒ‡å®š å¤šå°‘ä¸ªTaskManagerå’Œæ¯ä¸ªTaskManager slotå»è¿è¡Œä»»åŠ¡ï¼Œè¿™æ ·åšæ„Ÿè§‰ä¸å¤ªåˆç†ï¼Œå› ä¸ºç”¨æˆ·ä¹Ÿä¸çŸ¥é“éœ€è¦å¤šå°‘ä¸ªTaskManageré€‚åˆï¼ŒFlink æœ‰åŠ¨æ€å¯åŠ¨TaskManagerçš„æœºåˆ¶å—ã€‚ 51ã€å‚è€ƒè¿™ä¸ªä¾‹å­ï¼ŒFlink é›¶åŸºç¡€å®æˆ˜æ•™ç¨‹ï¼šå¦‚ä½•è®¡ç®—å®æ—¶çƒ­é—¨å•†å“ | Jarkâ€™s Blogï¼Œ çª—å£èšåˆçš„æ—¶å€™ï¼Œç”¨keywindowï¼Œç”¨çš„æ˜¯timeWindowAllï¼Œç„¶ååœ¨aggregateçš„æ—¶å€™ç”¨aggregate(new CustomAggregateFunction(), new CustomWindowFunction())ï¼Œæ‰“å°ç»“æœåï¼Œå‘ç°çª—å£ä¸­ä¸€ç›´ä½¿ç”¨çš„é‡å¤çš„æ•°æ®ï¼Œç»Ÿè®¡çš„ç»“æœä¹Ÿä¸å˜ï¼Œå»æ‰CustomWindowFunction()å°±æ­£å¸¸äº† ï¼Ÿ éå¸¸å¥‡æ€ª 52ã€ç”¨æˆ·è¿›å…¥äº§å“é¢„å®šé¡µé¢ï¼ˆç«¯åŸ‹ç‚¹ä¸ŠæŠ¥ï¼‰ï¼Œå¹¶å¡«å†™äº†ä¸€äº›ä¿¡æ¯ï¼ˆç«¯åŸ‹ç‚¹ä¸ŠæŠ¥ï¼‰ï¼Œä½†åŠå°æ—¶å†…å¹¶æ²¡æœ‰äº§ç”Ÿä»»ä½•è®¢å•ï¼Œç„¶åç»™è¯¥ç±»ç”¨æˆ·å‘é€ä¸€ä¸ªpushã€‚ 1. è¿™ç§éœ€æ±‚é€‚åˆç”¨flinkå»åšå—ï¼Ÿ2. å¦‚æœé€‚åˆï¼Œè¯´ä¸‹å¤§æ¦‚çš„æ€è·¯ 53ã€ä¸šåŠ¡åœºæ™¯æ˜¯å®æ—¶è·å–æ•°æ®å­˜redisï¼Œè¯·é—®æˆ‘è¦å¦‚ä½•æŒ‰å¤©ã€æŒ‰å‘¨ã€æŒ‰æœˆåˆ†åˆ«å­˜å…¥redisé‡Œï¼Ÿï¼ˆæ¯”æ–¹è¯´è¿‡äº†ä¸€å¤©è‡ªåŠ¨æ¢ä¸€ä¸ªä½ç½®å­˜redisï¼‰ 54ã€æœ‰äºº AggregatingState çš„ä¾‹å­å—, æ„Ÿè§‰å®˜æ–¹çš„ä¾‹å­å’Œ å®˜ç½‘çš„ä¸å¤ªä¸€æ ·? 55ã€flink-jdbcè¿™ä¸ªjaræœ‰å—ï¼Ÿæ€ä¹ˆæ²¡æ‰¾åˆ°å•Šï¼Ÿ1.8.0çš„æ²¡æ‰¾åˆ°ï¼Œ1.6.2çš„æœ‰ 56ã€ç°æœ‰ä¸ªå…³äºsavepointçš„é—®é¢˜ï¼Œæ“ä½œæµç¨‹ä¸ºï¼Œå–æ¶ˆä»»åŠ¡æ—¶è®¾ç½®ä¿å­˜ç‚¹ï¼Œæ›´æ–°ä»»åŠ¡ï¼Œä»ä¿å­˜ç‚¹å¯åŠ¨ä»»åŠ¡ï¼›ç°åœ¨é‡åˆ°ä¸ªé—®é¢˜ï¼Œå‡è®¾æˆ‘ä¸­é—´æŸä¸ªç®—å­é‡å†™ï¼ŒåŸå…ˆé€šè¿‡stateç¼–å†™ï¼Œæœ‰ç”¨å®šæ—¶å™¨ï¼Œç°åœ¨æ›´æ”¹åï¼Œé‡‡ç”¨çª—å£ï¼Œåæ­£å°±æ˜¯å®ç°æ–¹å¼å®Œå…¨ä¸ä¸€æ ·ï¼›ä»ä¿å­˜ç‚¹å¯åŠ¨å°±ä¼šä¸€ç›´æŠ¥é”™ï¼Œé‡å¯ï¼ŒåŸå…ˆçš„ä¿å­˜ç‚¹ä¸èƒ½è¿˜åŸï¼Œæ­¤æ—¶å°±ä¼šæœ‰å¾ˆå¤šæ•°æ®é‡å¤ç­‰å„ç§é—®é¢˜ï¼Œå¦‚ä½•æ‰èƒ½ä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼Œä¸é‡å¤ç­‰ï¼Œæ¢å¤åˆ°åœæ­¢çš„æ—¶å€™ï¼Œç°åœ¨æƒ³åˆ°çš„æ˜¯è®°ä¸‹kafkaçš„åç§»é‡ï¼Œå†åšå¤„ç†ï¼Œè²Œä¼¼ä¹Ÿä¸æ˜¯å¾ˆå¥½å¼„ï¼Œæœ‰ä»€ä¹ˆè§£å†³åŠæ³•å— 57ã€éœ€è¦åœ¨flinkè®¡ç®—appé¡µé¢è®¿é—®æ—¶é•¿ï¼Œæ¶ˆè´¹Kafkaè®¡ç®—åè¾“å‡ºåˆ°Kafkaã€‚ç¬¬ä¸€æ¡logéœ€è¦ç­‰å¾…ç¬¬äºŒæ¡logçš„æ—¶é—´æˆ³è®¡ç®—è®¿é—®æ—¶é•¿ã€‚æˆ‘æƒ³é—®çš„æ˜¯ï¼Œflinkæ˜¯åˆ†å¸ƒå¼çš„ï¼Œé‚£ä¹ˆå®ƒèƒ½å¦ä¿è¯æ‰§è¡Œçš„é¡ºåºæ€§ï¼Ÿåæ¥çš„æ•°æ®æœ‰æ²¡æœ‰å¯èƒ½å…ˆè¢«æ‰§è¡Œï¼Ÿ 58ã€æˆ‘å…¬å¸æƒ³åšå®æ—¶å¤§å±ï¼Œç°æœ‰æŠ€æœ¯æ˜¯å°†ä¸šåŠ¡æ‰€éœ€æŒ‡æ ‡å®æ—¶ç”¨sparkæ‹‰åˆ°redisé‡Œå­˜ç€ï¼Œç„¶åå†ç”¨ä¸€æ¡spark streamingæµè®¡ç®—ç®€å•ä¹˜é™¤è¿ç®—ï¼ŒæŒ‡æ ‡åŒ…å«äº†å„æœˆä»½çš„æ¯”è¾ƒã€‚è¯·é—®æˆ‘è¯¥å¦‚ä½•ç”¨flinkç®€åŒ–ä¸Šè¿°æµç¨‹ï¼Ÿ 59ã€flink on yarn æ–¹å¼ï¼Œè¿™æ ·ç†è§£ä¸çŸ¥é“å¯¹ä¸å¯¹ï¼Œyarn-sessionè¿™ä¸ªè„šæœ¬å…¶å®å°±æ˜¯å‡†å¤‡yarnç¯å¢ƒçš„ï¼Œæ‰§è¡Œrunä»»åŠ¡çš„æ—¶å€™ï¼Œæ ¹æ®yarn-sessionåˆå§‹åŒ–çš„yarnDescription æŠŠ flink ä»»åŠ¡çš„jobGraphæäº¤åˆ°yarnä¸Šå»æ‰§è¡Œ 60ã€åŒæ ·çš„ä»£ç é€»è¾‘å†™åœ¨å•ç‹¬çš„mainå‡½æ•°ä¸­å°±å¯ä»¥æˆåŠŸçš„æ¶ˆè´¹kafka ï¼Œå†™åœ¨ä¸€ä¸ªspring bootçš„ç¨‹åºä¸­ï¼Œæ¥å—å¤–éƒ¨è¯·æ±‚ï¼Œç„¶åæ‰§è¡Œç›¸åŒçš„é€»è¾‘å°±ä¸èƒ½æ¶ˆè´¹kafkaã€‚ä½ é‡åˆ°è¿‡å—ï¼Ÿèƒ½ç»™ä¸€äº›æŸ¥é—®é¢˜çš„å»ºè®®ï¼Œæˆ–è€…åœ¨å“ªé‡Œæ‰“ä¸ªæ–­ç‚¹ï¼Œèƒ½çœ‹åˆ°ä¸ºä»€ä¹ˆæ¶ˆè´¹ä¸åˆ°kafkaçš„æ¶ˆæ¯å‘¢ï¼Ÿ 61ã€è¯·é—®ä¸‹flinkå¯ä»¥å®ç°ä¸€ä¸ªæµä¸­åŒæ—¶å­˜åœ¨è®¢å•è¡¨å’Œè®¢å•å•†å“è¡¨çš„æ•°æ® ä¸¤è€…æ˜¯ä¸€å¯¹å¤šçš„å…³ç³» èƒ½å®ç°å¾—åˆ° ä»¥è®¢å•è¡¨ä¸ºä¸» ä¸€ä¸ªè®¢å•å¤šä¸ªå•†å“ è¿™ç§éœ€æ±‚å˜› 62ã€åœ¨ç”¨ä¸­é—´çŠ¶æ€çš„æ—¶å€™ï¼Œå¦‚æœä¸­é—´ä¸€äº›ä¿¡æ¯ä¿å­˜åœ¨stateä¸­ï¼Œæœ‰æ²¡æœ‰å¿…è¦åœ¨redisä¸­å†ä¿å­˜ä¸€ä»½ï¼Œæ¥åšç¬¬ä¸‰æ–¹çš„å­˜å‚¨ã€‚ 63ã€èƒ½å¦å‡ºä¸€æœŸflink stateçš„æ–‡ç« ã€‚ä»€ä¹ˆåœºæ™¯ä¸‹ç”¨ä»€ä¹ˆæ ·çš„stateï¼Ÿå¦‚ï¼Œæœ€ç®€å•çš„ï¼Œå®æ—¶ç´¯åŠ updateåˆ°stateã€‚ 64ã€flinkçš„åŒæµjoinåšä¸»æœ‰ä½¿ç”¨çš„ç»éªŒå—ï¼Ÿä¼šæœ‰ä»€ä¹ˆå¸¸è§çš„é—®é¢˜å— 65ã€çª—å£è§¦å‘çš„æ¡ä»¶é—®é¢˜ 66ã€flink å®šæ—¶ä»»åŠ¡æ€ä¹ˆåšï¼Ÿæœ‰ç›¸å…³çš„demoä¹ˆï¼Ÿ 67ã€æµå¼å¤„ç†è¿‡ç¨‹ä¸­æ•°æ®çš„ä¸€è‡´æ€§å¦‚ä½•ä¿è¯æˆ–è€…å¦‚ä½•æ£€æµ‹ 68ã€é‡å¯flinkå•æœºé›†ç¾¤ï¼Œè¿˜æŠ¥job not found å¼‚å¸¸ã€‚ 69ã€kafkaçš„æ•°æ®æ˜¯ç”¨ org.apache.kafka.common.serialization.ByteArraySerializeåºåˆ—åŒ–çš„ï¼Œflinkè¿™è¾¹æ¶ˆè´¹çš„æ—¶å€™æ€ä¹ˆé€šè¿‡FlinkKafkaConsumeråˆ›å»ºDataStreamï¼Ÿ 70ã€ç°åœ¨å…¬å¸æœ‰ä¸€ä¸ªéœ€æ±‚ï¼Œä¸€äº›ç”¨æˆ·çš„æ”¯ä»˜æ—¥å¿—ï¼Œé€šè¿‡slsæ”¶é›†ï¼Œè¦æŠŠè¿™äº›æ—¥å¿—å¤„ç†åï¼Œç»“æœå†™å…¥åˆ°MySQLï¼Œå…³é”®è¿™äº›æ—¥å¿—å¯èƒ½è¿ç€æ¥å¥½å‡ æ¡æ‰æ˜¯ä¸€ä¸ªç”¨æˆ·çš„ï¼Œå› ä¸ºå‘èµ·è¯·æ±‚ï¼Œå“åº”ç­‰æ¯ä¸ªç¯èŠ‚éƒ½æœ‰ç›¸åº”çš„æ—¥å¿—ï¼Œè¿™å‡ æ¡æ—¥å¿—ç»¼åˆå¤„ç†æ‰èƒ½å¾—åˆ°æœ€ç»ˆçš„ç»“æœï¼Œè¯·é—®åšä¸»æœ‰ä»€ä¹ˆå¥½çš„æ–¹æ³•æ²¡æœ‰ï¼Ÿ 71ã€flink æ”¯æŒhadoop ä¸»å¤‡ä¹ˆï¼Ÿ hadoopä¸»èŠ‚ç‚¹æŒ‚äº† flink ä¼šåˆ‡æ¢åˆ°hadoop å¤‡ç”¨èŠ‚ç‚¹ï¼Ÿ 72ã€è¯·æ•™å¤§å®¶: å®é™… flink å¼€å‘ä¸­ç”¨ scala å¤šè¿˜æ˜¯ javaå¤šäº›ï¼Ÿ åˆšå…¥æ‰‹ flink å¤§æ•°æ® scala éœ€è¦æ·±å…¥å­¦ä¹ ä¹ˆï¼Ÿ 73ã€æˆ‘ä½¿ç”¨çš„æ˜¯flinkæ˜¯1.7.2æœ€è¿‘ç”¨äº†splitçš„æ–¹å¼åˆ†æµï¼Œä½†æ˜¯åº•å±‚çš„SplitStreamä¸Šå´æ ‡æ³¨ä¸ºDeprecatedï¼Œè¯·é—®æ˜¯å®˜æ–¹ä¸æ¨èä½¿ç”¨åˆ†æµçš„æ–¹å¼å—ï¼Ÿ 74ã€KeyBy çš„æ­£ç¡®ç†è§£ï¼Œå’Œæ•°æ®å€¾æ–œé—®é¢˜çš„è§£é‡Š 75ã€ç”¨flinkæ—¶ï¼Œé‡åˆ°ä¸ªé—®é¢˜ checkpointå¤§æ¦‚æœ‰2Gå·¦å³ï¼Œ æœ‰èƒŒå‹æ—¶ï¼Œflinkä¼šé‡å¯æœ‰é‡åˆ°è¿‡è¿™ä¸ªé—®é¢˜å— 76ã€flinkä½¿ç”¨yarn-sessionæ–¹å¼éƒ¨ç½²ï¼Œå¦‚ä½•ä¿è¯yarn-sessionçš„ç¨³å®šæ€§ï¼Œå¦‚æœyarn-sessionæŒ‚äº†ï¼Œéœ€è¦é‡æ–°éƒ¨ç½²ä¸€ä¸ªyarn-sessionï¼Œå¦‚ä½•æ¢å¤ä¹‹å‰yarn-sessionä¸Šçš„jobå‘¢ï¼Œä¹‹å‰çš„checkpointè¿˜èƒ½ä½¿ç”¨å—ï¼Ÿ 77ã€æˆ‘æƒ³è¯·æ•™ä¸€ä¸‹å…³äºsinkçš„é—®é¢˜ã€‚æˆ‘ç°åœ¨çš„éœ€æ±‚æ˜¯ä»Kafkaæ¶ˆè´¹Jsonæ•°æ®ï¼Œè¿™ä¸ªJsonæ•°æ®å­—æ®µå¯èƒ½ä¼šå¢åŠ ï¼Œç„¶åå°†æ‹¿åˆ°çš„jsonæ•°æ®ä»¥parquetçš„æ ¼å¼å­˜å…¥hdfsã€‚ç°åœ¨æˆ‘å¯ä»¥æ‹¿åˆ°jsonæ•°æ®çš„schemaï¼Œä½†æ˜¯åœ¨ä¿å­˜parquetæ–‡ä»¶çš„æ—¶å€™ä¸çŸ¥é“æ€ä¹ˆå¤„ç†ã€‚ä¸€æ˜¯flinkæ²¡æœ‰ä¸“é—¨çš„format parquetï¼ŒäºŒæ˜¯å¯¹äºå¯å˜å­—æ®µçš„Jsonæ€ä¹ˆå¤„ç†æˆparquetæ¯”è¾ƒåˆé€‚ï¼Ÿ 78ã€flinkå¦‚ä½•åœ¨è¾ƒå¤§çš„æ•°æ®é‡ä¸­åšå»é‡è®¡ç®—ã€‚ 79ã€flinkèƒ½åœ¨æ²¡æœ‰æ•°æ®çš„æ—¶å€™ä¹Ÿå®šæ—¶æ‰§è¡Œç®—å­å—ï¼Ÿ 80ã€ä½¿ç”¨rocksdbçŠ¶æ€åç«¯ï¼Œè‡ªå®šä¹‰pojoæ€ä¹ˆå®ç°åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„ï¼Œæœ‰ç›¸å…³demoä¹ˆï¼Ÿ 81ã€check point è€æ˜¯å¤±è´¥ï¼Œæ˜¯ä¸æ˜¯è‡ªå®šä¹‰çš„pojoé—®é¢˜ï¼Ÿåˆ°æœ¬åœ°å¯ä»¥ï¼Œåˆ°hdfså°±ä¸è¡Œï¼Œç½‘ä¸Šä¹Ÿæœ‰å¾ˆå¤šç±»ä¼¼çš„é—®é¢˜ éƒ½æ²¡æœ‰ä¸€ä¸ªå¾ˆå¥½çš„è§£é‡Šå’Œè§£å†³æ–¹æ¡ˆ 82ã€cepè§„åˆ™å¦‚å›¾ï¼Œå½“startäº‹ä»¶è¿›å…¥æ—¶ï¼Œæ—¶é—´00:00:15ï¼Œè€Œåè¿›å…¥endäº‹ä»¶ï¼Œæ—¶é—´00:00:40ã€‚æˆ‘å‘ç°è§„åˆ™æ— æ³•å‘½ä¸­ã€‚è¯·é—®within æ˜¯ä»startäº‹ä»¶å¼€å§‹è®¡æ—¶ï¼Ÿè¿˜æ˜¯è·Ÿwindowä¸€æ ·æ ¹æ®ç³»ç»Ÿæ—¶é—´åˆ’åˆ†çš„ï¼Ÿå¦‚æœæ˜¯åè€…ï¼Œè¯·é—®æ€ä¹ˆé…ç½®æ‰èƒ½ä»startå¼€å§‹è®¡æ—¶ï¼Ÿ 83ã€Flinkèšåˆç»“æœç›´æ¥å†™Mysqlçš„å¹‚ç­‰æ€§è®¾è®¡é—®é¢˜ 84ã€Flink jobæ‰“å¼€äº†checkpointï¼Œç”¨çš„rocksdbï¼Œé€šè¿‡è§‚å¯Ÿhdfsä¸Šcheckpointç›®å½•ï¼Œä¸ºå•¥ç®—å‰¯æœ¬æ€»é‡ä¼šæš´å¢çˆ†å‡ 85ã€Flink æäº¤ä»»åŠ¡çš„ jaråŒ…å¯ä»¥æŒ‡å®šè·¯å¾„ä¸º HDFS ä¸Šçš„å— 86ã€åœ¨flink web Uiä¸Šæäº¤çš„ä»»åŠ¡ï¼Œè®¾ç½®çš„å¹¶è¡Œåº¦ä¸º2ï¼Œflinkæ˜¯stand aloneéƒ¨ç½²çš„ã€‚ä¸¤ä¸ªä»»åŠ¡éƒ½æ­£å¸¸çš„è¿è¡Œäº†å‡ å¤©äº†ï¼Œä»Šå¤©æœ‰ä¸ªåœ°æ–¹é€»è¾‘éœ€è¦ä¿®æ”¹ï¼Œäºæ˜¯å°†ä»»åŠ¡cancelæ‰(åœ¨å‘½ä»¤è¡Œcancelä¹Ÿè¯•äº†)ï¼Œç»“æœtaskmangeræŒ‚æ‰äº†ä¸€ä¸ªèŠ‚ç‚¹ã€‚åæ¥ç”¨å…¶ä»–ä»»åŠ¡è¯•äº†ï¼Œä¹ŸåŒæ ·ä¼šå¯¼è‡´èŠ‚ç‚¹æŒ‚æ‰ 87ã€ä¸€ä¸ªé…ç½®åŠ¨æ€æ›´æ–°çš„é—®é¢˜æŠ˜è…¾å¥½ä¹…ï¼ˆé…ç½®ç”¨ä¸ªé™æ€çš„mapå˜é‡å­˜ç€ï¼Œæœ‰ä¸ªçº¿ç¨‹å®šæ—¶å»æ•°æ®åº“ææ•°æ®ç„¶åå­˜åœ¨è¿™ä¸ªmapé‡Œé¢æ›´æ–°ä¸€æŠŠï¼‰ï¼Œæœ¬åœ° idea è°ƒè¯•æ²¡é—®é¢˜ï¼Œé›†ç¾¤éƒ¨ç½²å°±ä¸€ç›´æŠ¥ ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚ä¸‹æ¸¸çš„ç®—å­ä½¿ç”¨è¿™ä¸ªé™æ€å˜é‡mapå»get keyåœ¨é›†ç¾¤æ¨¡å¼ä¸‹ä¼šå‡ºç°è¿™ä¸ªç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œä¼°è®¡å°±æ˜¯æ‹¿ä¸åˆ° map 88ã€æ‰¹é‡å†™å…¥MySQLï¼Œå®ŒæˆHBaseæ‰¹é‡å†™å…¥ 89ã€ç”¨flinkæ¸…æ´—æ•°æ®ï¼Œå…¶ä¸­è¦è®¿é—®redisï¼Œæ ¹æ®redisçš„ç»“æœæ¥å†³å®šæ˜¯å¦æŠŠæ•°æ®ä¼ é€’åˆ°ä¸‹æµï¼Œè¿™æœ‰å¯èƒ½å®ç°å—ï¼Ÿ 90ã€ç›‘æ§é¡µé¢æµå¤„ç†çš„æ—¶å€™è¿™ä¸ªå‘é€å’Œæ¥æ”¶å­—èŠ‚ä¸º0ã€‚ 91ã€sinkåˆ°MySQLï¼Œå¦‚æœç›´æ¥ç”¨ideaçš„è¯å¯ä»¥è¿è¡Œï¼Œå¹¶ä¸”æˆåŠŸï¼Œå¤§å¤§çš„ä»£ç ä¸Šé¢ç”¨çš„FlinkKafkaConsumer010ï¼Œè€Œæˆ‘çš„Flinkç‰ˆæœ¬ä¸º1.7ï¼Œkafkaç‰ˆæœ¬ä¸º2.12ï¼Œæ‰€ä»¥å½“æˆ‘ç”¨FlinkKafkaConsumer010å°±æœ‰é—®é¢˜ï¼Œäºæ˜¯æ”¹ä¸º FlinkKafkaConsumerå°±å¯ä»¥ç›´æ¥åœ¨ideaå®Œæˆsinkåˆ°MySQLï¼Œä½†æ˜¯ä¸ºä½•å½“æˆ‘æŠŠè¯¥ç¨‹åºæ‰“æˆJaråŒ…ï¼Œå»è¿è¡Œçš„æ—¶å€™ï¼Œå°±æ˜¯æŠ¥FlinkKafkaConsumeræ‰¾ä¸åˆ°å‘¢ 92ã€SocketTextStreamWordCountä¸­è¾“å…¥ä¸­æ–‡ç»Ÿè®¡ä¸å‡ºæ¥ï¼Œè¯·é—®è¿™ä¸ªæ€ä¹ˆè§£å†³ï¼Œæˆ‘çŒœæµ‹åº”è¯¥æ˜¯éœ€è¦ä¿®æ”¹ä¸€ä¸‹ä»£ç ï¼Œåº”è¯¥æ˜¯è¿™ä¸ªä¾‹å­é»˜è®¤ç»Ÿè®¡è‹±æ–‡ 93ã€ Flink åº”ç”¨ç¨‹åºæœ¬åœ° ide é‡Œé¢è¿è¡Œçš„æ—¶å€™å¹¶è¡Œåº¦æ˜¯æ€ä¹ˆç®—çš„ï¼Ÿ 94ã€ è¯·é—®ä¸‹flinkä¸­å¯¹äºçª—å£çš„å…¨é‡èšåˆæœ‰applyå’Œprocessä¸¤ç§ ä»–ä»¬æœ‰å•¥åŒºåˆ«å‘¢ 95ã€ä¸çŸ¥é“å¤§å¤§ç†Ÿæ‚‰Hbaseä¸ï¼Œæˆ‘æƒ³ç›´æ¥åœ¨Hbaseä¸­æŸ¥è¯¢æŸä¸€åˆ—æ•°æ®ï¼Œå› ä¸ºæœ‰é‡å¤æ•°æ®ï¼Œæ‰€ä»¥æƒ³ä½¿ç”¨distinctç»Ÿè®¡å®é™…æ•°æ®é‡ï¼Œè¯·é—®Hbaseä¸­æœ‰æ²¡æœ‰ç±»ä¼¼äºsqlçš„distinctå…³é”®å­—ã€‚å¦‚æœæ²¡æœ‰ï¼Œæƒ³å®ç°è¿™ç§å¯ä»¥ä¸ï¼Ÿ 96ã€ æ¥åˆ†æä¸€ä¸‹ç°åœ¨Flink,Kafkaæ–¹é¢çš„å°±ä¸šå½¢åŠ¿ï¼Œä»¥åŠå‡†å¤‡å°±ä¸šè¯¥å¦‚ä½•å‡†å¤‡çš„è¿™æ–¹é¢å†…å®¹å‘¢ï¼Ÿ 97ã€ å¤§ä½¬çŸ¥é“flinkçš„dataStreamå¯ä»¥è½¬æ¢ä¸ºdataSetå—ï¼Ÿå› ä¸ºæ•°æ®éœ€è¦11åˆ†é’Ÿä¸€ä¸ªæ‰¹æ¬¡è®¡ç®—äº”å…­ä¸ªæŒ‡æ ‡ï¼Œå¹¶ä¸”æ¶‰åŠå¥½å‡ æ­¥reduceï¼Œè®¡ç®—çš„æŒ‡æ ‡ä¹‹é—´æœ‰è”ç³»ï¼Œç”¨Streamå¡ä½äº†ã€‚ 98ã€1.å¦‚ä½•åœ¨åŒä¸€çª—å£å†…å®ç°å¤šæ¬¡çš„èšåˆï¼Œæ¯”å¦‚åƒsparkä¸­çš„è¿™æ ·2.å¤šä¸ªå®æ—¶æµçš„jionå¯ä»¥ç”¨windowæ¥å¤„ç†ä¸€æ‰¹æ¬¡çš„æ•°æ®å—ï¼Ÿ 99ã€å†™çš„æ‰¹å¤„ç†çš„åŠŸèƒ½ï¼Œç°åœ¨æœ¬æœºè·‘æ˜¯æ²¡é—®é¢˜çš„ï¼Œå°±æ˜¯åœ¨linuxé›†ç¾¤ä¸Šå‡ºç°äº†é—®é¢˜ï¼Œå°±æ˜¯ä¸çŸ¥é“å¦‚æœé€šè¿‡æœ¬åœ°è°ƒç”¨è¿œç¨‹jaråŒ…ç„¶åä¼ å‚æ•°å’Œæ‹¿åˆ°ç»“æœå‚æ•°è¿”å›æœ¬æœº 100ã€æˆ‘ç”¨standaloneå¼€å¯ä¸€ä¸ªflinké›†ç¾¤ï¼Œä¸Šä¼ flinkå®˜æ–¹ç”¨ä¾‹Socket Window WordCountåšæµ‹è¯•ï¼Œå¼€å¯ä¸¤ä¸ªparallelismèƒ½æ­£å¸¸è¿è¡Œï¼Œä½†æ˜¯å¼€å¯4ä¸ªparallelismåå‡ºç°é”™è¯¯ 101ã€ æœ‰ä½¿ç”¨AssignerWithPunctuatedWatermarks çš„æ¡ˆä¾‹Demoå—ï¼Ÿç½‘ä¸Šæ‰¾äº†éƒ½æ˜¯AssignerWithPeriodicWatermarksçš„ï¼Œä¸çŸ¥é“å…·ä½“æ€ä¹ˆä½¿ç”¨ï¼Ÿ 102ã€ æœ‰ä¸€ä¸ªdatastream(ä»æ–‡ä»¶è¯»å–çš„)ï¼Œç„¶åæˆ‘ç”¨flink sqlè¿›è¡Œè®¡ç®—ï¼Œè¿™ä¸ªsqlæ˜¯ä¸€ä¸ªåŠ æ€»çš„è¿ç®—ï¼Œç„¶åé€šè¿‡retractStreamTableSinkå¯ä»¥æŠŠæ–‡ä»¶åšsqlçš„ç»“æœè¾“å‡ºåˆ°æ–‡ä»¶å—ï¼Ÿè¿™ä¸ªè¾“å‡ºåˆ°æ–‡ä»¶çš„æ¥å£æ˜¯ç”¨ä»€ä¹ˆå‘¢ï¼Ÿ 103ã€ ä¸ºå•¥splitè¿™ä¸ªæµè®¾ç½®ä¸ºè¿‡æœŸçš„ 104ã€ éœ€è¦ä½¿ç”¨flink tableçš„æ°´å°æœºåˆ¶æ§åˆ¶æ—¶é—´çš„ä¹±åºé—®é¢˜ï¼Œè¿™ç§åœºæ™¯ä¸‹æˆ‘å°±ä½¿ç”¨æ°´å°+çª—å£äº†ï¼Œæˆ‘ç°åœ¨å†™çš„demoé‡åˆ°äº†é—®é¢˜ï¼Œå°±æ˜¯åœ¨æŠŠè§¦å‘è®¡ç®—çš„çª—å£tableï¼ˆWindowedTableï¼‰è½¬æ¢æˆtableè¿›è¡Œsqlæ“ä½œæ—¶å‘ç°çª—å£ä¸­çš„æ•°æ®è¿˜æ˜¯ä¹±åºçš„ï¼Œæ˜¯ä¸æ˜¯flink tableçš„WindowedTableä¸æ”¯æŒæ°´å°çª—å£è½¬table-sqlçš„åŠŸèƒ½ 105ã€ Flink å¯¹ SQL çš„é‡è§†æ€§ 106ã€ flink jobæ‰“å¼€äº†checkpointï¼Œä»»åŠ¡è·‘äº†å‡ ä¸ªå°æ—¶åå°±å‡ºç°ä¸‹é¢çš„é”™ï¼Œæˆªå›¾æ˜¯æ‰“å‡ºæ¥çš„æ—¥å¿—ï¼Œæœ‰ä¸ªOOMï¼Œåˆé‡åˆ°è¿‡çš„æ²¡ï¼Ÿ 107ã€ æœ¬åœ°æµ‹è¯•æ˜¯æœ‰æ•°æ®çš„ï¼Œä¹‹å‰è¯¥ä»»åŠ¡æ”¾åœ¨é›†ç¾¤ä¹Ÿæ˜¯æœ‰æ•°æ®çš„ï¼Œå¯èƒ½æäº¤è¿‡å¤šæ¬¡ï¼Œç°åœ¨è¯»ä¸åˆ°æ•°æ®äº† group id ä¹Ÿæ¢è¿‡äº†ï¼Œ åªèƒ½é‡å¯é›†ç¾¤è§£å†³ä¹ˆï¼Ÿ 108ã€ä½¿ç”¨flinkæ¸…æ´—æ•°æ®å­˜åˆ°esä¸­ï¼Œç›´æ¥åœ¨flatmapä¸­å¯¹å¤„ç†å‡ºæ¥çš„æ•°æ®ç”¨esè‡ªå·±çš„ClientInterfaceç±»ç›´æ¥å°†æ•°æ®å­˜å…¥eså½“ä¸­ï¼Œä¸èµ°sinkï¼Œè¿™æ ·çš„å¤„ç†é€»è¾‘æ˜¯ä¸æ˜¯ä¼šæœ‰é—®é¢˜ã€‚ 108ã€ flinkä»kafkaæ‹¿æ•°æ®ï¼ˆå³å¢é‡æ•°æ®ï¼‰ä¸å­˜é‡æ•°æ®è¿›è¡Œå†…å­˜èšåˆçš„éœ€æ±‚ï¼Œç°åœ¨æœ‰ä¸€ä¸ªæ–¹æ¡ˆå°±æ˜¯ç¨‹åºå¯åŠ¨çš„æ—¶å€™å…ˆç”¨flink tableå°†å­˜é‡æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­åˆ›å»ºtableä¸­ï¼Œç„¶åå°†streamçš„å¢é‡æ•°æ®ä¸tableçš„æ•°æ®è¿›è¡Œå…³è”èšåˆåè¾“å‡ºç»“æŸï¼Œä¸çŸ¥é“è¿™ç§æ–¹æ¡ˆå¯è¡Œä¹ˆã€‚ç›®å‰ä¸ªäººè®¤ä¸ºæœ‰ä¸¤ä¸ªä¸»è¦é—®é¢˜ï¼š1æ˜¯å¢é‡æ•°æ®streamè½¬åŒ–æˆappend tableåä¸çŸ¥é“èƒ½ä¸å­˜é‡çš„tableå…³è”èšåˆä¸ï¼Œ2æ˜¯èšåˆåè¾“å‡ºçš„ç»“æœæ•°æ®æ˜¯å¦è¿‡äºé¢‘ç¹é€ æˆç½‘ç»œä¼ è¾“å‹åŠ›è¿‡å¤§ 109ã€ è®¾ç½®æ—¶é—´æ—¶é—´ç‰¹æ€§æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢, åˆ†åˆ«åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ä½¿ç”¨å‘¢?ä¸¤ç§è®¾ç½®æ—¶é—´å»¶è¿Ÿæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ , åˆ†åˆ«åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ä½¿ç”¨ 110ã€ flinkä»rabbitmqä¸­è¯»å–æ•°æ®ï¼Œè®¾ç½®äº†rabbitmqçš„CorrelationDataIdå’Œcheckpointä¸ºEXACTLY_ONCEï¼›å¦‚æœflinkå®Œæˆä¸€æ¬¡checkpointåï¼Œåœ¨è¿™æ¬¡checkpointä¹‹å‰æ¶ˆè´¹çš„æ•°æ®éƒ½ä¼šä»mqä¸­åˆ é™¤ã€‚å¦‚æœæŸæ¬¡flinkåœæœºæ›´æ–°ï¼Œé‚£å°±ä¼šå‡ºç°mqä¸­çš„ä¸€äº›æ•°æ®æ¶ˆè´¹ä½†æ˜¯å¤„äºUnackedçŠ¶æ€ã€‚åœ¨flinkåˆé‡æ–°å¼€å¯åè¿™æ‰¹æ•°æ®åˆä¼šé‡æ–°æ¶ˆè´¹ã€‚é‚£è¿™æ ·æ˜¯ä¸æ˜¯å°±ä¸èƒ½ä¿è¯EXACTLY_ONCEäº† 111ã€1. åœ¨Flink checkpoint ä¸­, åƒ operatorçš„çŠ¶æ€ä¿¡æ¯ æ˜¯åœ¨è®¾ç½®äº†checkpoint ä¹‹åè‡ªåŠ¨çš„è¿›è¡Œå¿«ç…§å— ?2. ä¸Šé¢è¿™ä¸ªå’Œæˆ‘ä»¬æ‰‹åŠ¨å­˜å‚¨çš„ Keyed State è¿›è¡Œå¿«ç…§(è¿™ä¸ªåº”è¯¥æ˜¯å¢é‡å¿«ç…§) 112ã€ç°åœ¨æœ‰ä¸ªå®æ—¶å•†å“æ•°ï¼Œäº¤æ˜“é¢è¿™ç§ç»Ÿè®¡éœ€æ±‚ï¼Œæ‰“ç®—ç”¨ flinkä»kafkaè¯»å–binglogæ—¥å¿—è¿›è¡Œè®¡ç®—ï¼Œä½†binglogæ¶‰åŠåˆ°insertå’Œupdateè¿™ç§æ“ä½œæ—¶ æ€ä¹ˆå¤„ç†æ‰èƒ½ç»Ÿè®¡å‡†ç¡®ï¼Œé¿å…é‚£ç§é‡å¤è®¡ç®—çš„é—®é¢˜ï¼Ÿ 113ã€æˆ‘è¿™è¾¹ç”¨flinkåšå®æ—¶ç›‘æ§ï¼ŒåŠŸèƒ½å¾ˆç®€å•ï¼Œå°±æ˜¯æ¯æ¡æ¶ˆæ¯åškeybyç„¶åä¸‰åˆ†é’Ÿçª—å£ï¼Œç„¶ååšäº›å»é‡æ“ä½œï¼Œè§¦å‘é˜ˆå€¼åˆ™æŠ¥è­¦ï¼Œç°åœ¨é—®é¢˜æ˜¯åŒä¸€ä¸ªæ—¶é—´çª—å£åŒä¸€ä¸ªäººçš„å‘Šè­¦ä¼šè§¦å‘ä¸¤æ¬¡ï¼Œé›†ç¾¤æ˜¯ä¸‰å°æœºå™¨ï¼Œstandalone clusterï¼Œåˆæ­¥ç»“æœæ˜¯ä¸‰ä¸ªç®—å­é‡Œæœ‰ä¸¤ä¸ªæ”¶åˆ°äº†åŒæ ·çš„æ•°æ® 114ã€åœ¨ä½¿ç”¨WaterMarkçš„æ—¶å€™ï¼Œé»˜è®¤æ˜¯æ¯200mså»è®¾ç½®ä¸€æ¬¡watermarkï¼Œé‚£ä¹ˆæ¯ä¸ªtaskmanagerä¹‹é—´ï¼Œç”±äºå¾—åˆ°çš„æ•°æ®ä¸åŒï¼Œæ‰€ä»¥å¾€å¾€äº§ç”Ÿçš„æœ€å¤§çš„watermarkä¸åŒã€‚ é‚£ä¹ˆè¿™ä¸ªæ—¶å€™ï¼Œæ˜¯å„ä¸ªtaskmanagerå¹¿æ’­è¿™ä¸ªwatermarkï¼Œå¾—åˆ°å…¨å±€çš„æœ€å¤§çš„watermarkï¼Œè¿˜æ˜¯è¯´å„ä¸ªtaskmanageréƒ½å„è‡ªç”¨è‡ªå·±çš„watermarkã€‚ä¸»è¦æ²¡çœ‹åˆ°å¹¿æ’­watermarkçš„æºç ã€‚ä¸çŸ¥é“æ˜¯è‡ªå·±è§‚å¯Ÿä¸ä»”ç»†è¿˜æ˜¯å°±æ˜¯æ²¡æœ‰å¹¿æ’­è¿™ä¸ªå˜é‡ã€‚ 115ã€ç°åœ¨é‡åˆ°ä¸€ä¸ªéœ€æ±‚ï¼Œéœ€è¦åœ¨jobå†…éƒ¨å®šæ—¶å»è¯»å–redisçš„ä¿¡æ¯ï¼Œæƒ³è¯·æ•™flinkèƒ½å®ç°åƒæ™®é€šç¨‹åºé‚£æ ·çš„å®šæ—¶ä»»åŠ¡å—ï¼Ÿ 116ã€æœ‰ä¸ªè§¦å‘äº‹ä»¶å¼€å§‹èšåˆï¼Œç­‰åˆ°æ•°é‡è¶³å¤Ÿï¼Œæˆ–è€…è¶…æ—¶åˆ™sinkæ¨mq ç¯å¢ƒ flink 1.6 ç”¨äº†mapState è®°å½•è§¦å‘äº‹ä»¶ 1 æ•°æ®è¶³å¤Ÿè¿™ä¸ªOK 2 è¶…æ—¶state ttl 1.6æ”¯æŒï¼Œä½†æ˜¯é—®é¢˜æ¥äº†ï¼Œå¦‚ä½•åœ¨è¶…æ—¶æ—¶å€™å¢åŠ è‡ªå®šä¹‰å¤„ç†ï¼Ÿ 117ã€è¯·é—®impalaè¿™ç§mppæ¶æ„çš„sqlå¼•æ“ï¼Œä¸ºä»€ä¹ˆç¨³å®šæ€§æ¯”è¾ƒå·®å‘¢ï¼Ÿ 118ã€watermarkè·Ÿå¹¶è¡Œåº¦ç›¸å…³ä¸æ˜¯ï¼Œè¿‡äºå…¨å±€äº†ï¼ŒæœŸæœ›æ˜¯keybyä¹‹åå†é’ˆå¯¹æ¯ä¸ªkeyed stream æ‰“watermarkï¼Œè¿™ä¸ªæœ‰ä»€ä¹ˆå¥½çš„å®è·µå‘¢ï¼Ÿ 119ã€è¯·é—®å¦‚æœæŠŠä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹è¯»å–æˆdatastreamå’Œdatasetï¼Œæœ‰ä»€ä¹ˆåŒºåˆ«å—ï¼Ÿï¼Ÿä»–ä»¬éƒ½æ˜¯ä¸€æ¡æ•°æ®ä¸€æ¡æ•°æ®çš„è¢«è¯»å–å—ï¼Ÿ 120ã€æœ‰æ²¡æœ‰kylinç›¸å…³çš„èµ„æ–™ï¼Œæˆ–è€…è°ƒä¼˜çš„ç»éªŒï¼Ÿ 121ã€flinkå…ˆä»jdbcè¯»å–é…ç½®è¡¨åˆ°æµä¸­ï¼Œå¦å¤–ä»kafkaä¸­æ–°å¢æˆ–è€…ä¿®æ”¹è¿™ä¸ªé…ç½®ï¼Œè¿™ä¸ªåœºæ™¯æ€ä¹ˆæŠŠä¸¤ä¸ªæµä¸€ä»½é…ç½®æµï¼Ÿæˆ‘ç”¨çš„connect,æ¥ç€å‘ä¸æˆå¹¿æ’­å˜é‡ï¼Œå†å’Œå®ä½“æµåˆå¹¶ï¼Œä½†åœ¨åˆå¹¶æ—¶æŠ¥Exception in thread â€œmainâ€ java.lang.IllegalArgumentException 122ã€Flink exactly-onceï¼Œkafkaç‰ˆæœ¬ä¸º0.11.0 ï¼ŒsinkåŸºäºFlinkKafkaProducer011 æ¯äº”åˆ†é’Ÿä¸€æ¬¡checkpointï¼Œä½†æ˜¯checkpointå¼€å§‹åç³»ç»Ÿç›´æ¥å¡æ­»ï¼Œat-lease-once ä¸€åˆ†é’Ÿèƒ½å®Œæˆçš„checkpointï¼Œ ç°åœ¨ååˆ†é’Ÿæ— æ³•å®Œæˆæ²¡è¿›åº¦è¿˜æ˜¯0ï¼Œ ä¸çŸ¥é“å“ªé‡Œå¡ä½äº† 123ã€flinkçš„çŠ¶æ€æ˜¯é»˜è®¤å­˜åœ¨äºå†…å­˜çš„(ä¹Ÿå¯ä»¥è®¾ç½®ä¸ºrocksdbæˆ–hdfs)ï¼Œè€Œcheckpointé‡Œé¢æ˜¯å®šæ—¶å­˜æ”¾æŸä¸ªæ—¶åˆ»çš„çŠ¶æ€ä¿¡æ¯ï¼Œå¯ä»¥è®¾ç½®hdfsæˆ–rocksdbæ˜¯è¿™æ ·ç†è§£çš„å—ï¼Ÿ 124ã€Flinkå¼‚æ­¥IOä¸­ï¼Œä¸‹å›¾è¿™ä¸¤ç§æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä¸ºå•¥è¦åŠ  CompletableFuture.supplyAsyncï¼Œä¸å¤ªæ˜ç™½ï¼Ÿ 125ã€flinkçš„çŠ¶æ€æ˜¯é»˜è®¤å­˜åœ¨äºå†…å­˜çš„(ä¹Ÿå¯ä»¥è®¾ç½®ä¸ºrocksdbæˆ–hdfs)ï¼Œè€Œcheckpointé‡Œé¢æ˜¯å®šæ—¶å­˜æ”¾æŸä¸ªæ—¶åˆ»çš„çŠ¶æ€ä¿¡æ¯ï¼Œå¯ä»¥è®¾ç½®hdfsæˆ–rocksdbæ˜¯è¿™æ ·ç†è§£çš„å—ï¼Ÿ 126ã€æœ‰ä¸ªè®¡ç®—åœºæ™¯ï¼Œä»kafkaæ¶ˆè´¹ä¸¤ä¸ªæ•°æ®æºï¼Œä¸¤ä¸ªæ•°æ®ç»“æ„éƒ½æœ‰æ—¶é—´æ®µæ¦‚å¿µï¼Œè®¡ç®—éœ€è¦åšçš„æ˜¯åŒ¹é…ä¸¤ä¸ªæ—¶é—´æ®µï¼ŒåŒ¹é…åˆ°äº†ï¼Œå°±ç”Ÿæˆä¸€æ¡æ–°çš„è®°å½•ã€‚è¯·é—®ä½¿ç”¨å“ªä¸ªå·¥å…·æ›´åˆé€‚ï¼Œflink tableè¿˜æ˜¯cepï¼Ÿè¯·å¤§ç¥æŒ‡ç‚¹ä¸€ä¸‹ æˆ‘è¿™è¾¹ä¹‹å‰çš„åšæ³•ï¼Œå°†ä¸¤ä¸ªæ•°æ®æµè½¬ä¸ºtable.ä¸¤ä¸ªtable over windowåjoinæˆæ–°çš„è¡¨ã€‚ç»“æœjobè·‘ä¸€ä¼šå°±oom. 127ã€ä¸€ä¸ªäº’è”ç½‘å…¬å¸ï¼Œæˆ–è€…ä¸€ä¸ªä¸šåŠ¡ç³»ç»Ÿï¼Œå¦‚æœæƒ³åšä¸€ä¸ªå…¨é¢çš„ç›‘æ§è¦æ€ä¹ˆåšï¼Ÿæœ‰ä»€ä¹ˆæˆç†Ÿçš„æ–¹æ¡ˆå¯ä»¥å‚è€ƒäº¤æµå—ï¼Ÿæœ‰ä»€ä¹ˆæœ‰ä»€ä¹ˆåº¦é‡æŒ‡æ ‡å—ï¼Ÿ 128ã€æ€ä¹ˆæ·±å…¥å­¦ä¹ flink,æˆ–è€…å…¶ä»–å¤§æ•°æ®ç»„ä»¶ï¼Œèƒ½ä¸ºæœªæ¥ç§‹æ‹›æ‰¾ä¸€ä»½å¤§æ•°æ®ç›¸å…³ï¼ˆè®¡ç®—æ–¹å‘ï¼‰çš„å·¥ä½œå¢åŠ è‡ªå·±çš„ç«äº‰åŠ›ï¼Ÿ 129ã€oppoçš„å®æ—¶æ•°ä»“ï¼Œå…¶ä¸­æ˜ç»†å±‚å’Œæ±‡æ€»å±‚éƒ½åœ¨kafkaä¸­ï¼Œä»–ä»¬çš„å…³ç³»åº“çš„å®æ—¶æ•°æ®ä¹ŸæŠ½å–åˆ°kafkaçš„odsï¼Œé‚£ä¹ˆåœ¨æ„å»ºæ•°ä»“çš„ï¼Œéœ€è¦join ä¸‰å››ä¸ªå¤§ä¸šåŠ¡è¡¨ï¼Œä¸šåŠ¡è¡¨ä¼šå˜åŒ–ï¼Œé‚£ä¹ˆæ˜¯å¤§çš„ä¸šåŠ¡è¡¨æ˜¯ä»kafkaçš„odsè¯»å–å—ï¼Ÿå®æ—¶æ•°ä»“ï¼Œå¤šä¸ªå¤§è¡¨joinå¯ä»¥å— 130ã€Tupleç±»å‹æœ‰ä»€ä¹ˆæ–¹æ³•è½¬æ¢æˆjsonå­—ç¬¦ä¸²å—ï¼Ÿç°åœ¨çš„åœºæ™¯æ˜¯ï¼Œç»“æœåœ¨å­˜å‚¨åˆ°sinkä¸­æ—¶å¸Œæœ›å­˜çš„æ˜¯jsonå­—ç¬¦ä¸²ï¼Œè¿™æ ·åº”ç”¨ç¨‹åºè·å–æ•°æ®æ¯”è¾ƒå¥½è½¬æ¢ä¸€ç‚¹ã€‚å¦‚æœTupleä¸å¥½è½¬æ¢jsonå­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆåº”è¯¥ä»¥ä»€ä¹ˆæ•°æ®æ ¼å¼å­˜å‚¨åˆ°sinkä¸­ 140ã€ç«¯åˆ°ç«¯çš„æ•°æ®ä¿è¯ï¼Œæ˜¯å¦æ„å‘³ç€ä¸­é—´å¤„ç†ç¨‹åºä¸­æ–­ï¼Œä¹Ÿä¸ä¼šé€ æˆè¯¥æ‰¹æ¬¡å¤„ç†å¤±è´¥çš„æ¶ˆæ¯ä¸¢å¤±ï¼Œå¤„ç†ç¨‹åºé‡æ–°å¯åŠ¨ä¹‹åï¼Œä¼šå†æ¬¡å¤„ç†ä¸Šæ¬¡æœªå¤„ç†çš„æ¶ˆæ¯ 141ã€å…³äºflink datastream windowç›¸å…³çš„ã€‚æ¯”å¦‚æˆ‘ç°åœ¨ä½¿ç”¨æ»šåŠ¨çª—å£ï¼Œç»Ÿè®¡ä¸€å‘¨å†…å»é‡ç”¨æˆ·æŒ‡æ ‡ï¼ŒæŒ‰ç…§æ­£å¸¸watermarkè§¦å‘è®¡ç®—ï¼Œéœ€è¦ç­‰åˆ°å½“å‰å‘¨çš„windowåˆ°è¾¾windowçš„endtimeæ—¶ï¼Œæ‰ä¼šè§¦å‘ï¼Œè¿™æ ·æŒ‡æ ‡ä¸€å‘¨åæ‰èƒ½äº§å‡ºç»“æœã€‚æˆ‘èƒ½ä¸èƒ½å®ç°ä¸€å°æ—¶è§¦å‘ä¸€æ¬¡è®¡ç®—ï¼Œæ¯æ¬¡ç»Ÿè®¡æˆªæ­¢åˆ°å½“å‰æ—¶é—´ï¼Œwindowä¸­æ‰€æœ‰åˆ°è¾¾å…ƒç´ çš„å»é‡æ•°é‡ã€‚ 142ã€FLIP-16 Loop Fault Tolerance æ˜¯è®²ç°åœ¨çš„checkpointæœºåˆ¶æ— æ³•åœ¨stream loopçš„æ—¶å€™å®¹é”™å—ï¼Ÿç°åœ¨è¿™ä¸ªé—®é¢˜è§£å†³äº†æ²¡æœ‰å‘€ï¼Ÿ 143ã€ç°åœ¨çš„éœ€æ±‚æ˜¯ï¼Œç»Ÿè®¡å„ä¸ªkeyçš„ä»Šæ—¥ç´¯è®¡å€¼ï¼Œä¸€åˆ†é’Ÿè¾“å‡ºä¸€æ¬¡ã€‚å¦‚ï¼Œå„ä¸ªç”¨æˆ·ä»Šæ—¥ç´¯è®¡ç‚¹å‡»æ¬¡æ•°ã€‚è¿™ç§éœ€æ±‚ç”¨datastreamè¿˜æ˜¯table APIæ–¹ä¾¿ç‚¹ï¼Ÿ 144ã€æœ¬åœ°ideaå¯ä»¥è·‘çš„å·¥ç¨‹ï¼Œæ”¾åœ¨standaloneé›†ç¾¤ä¸Šï¼Œæ€»æŠ¥é”™ï¼ŒæŠ¥é”™æˆªå›¾å¦‚ä¸‹ï¼Œå¤§ä½¬è¯·é—®è¿™æ˜¯å•¥åŸå›  145ã€æ¯”å¦‚ç°åœ¨ç”¨k8sèµ·äº†ä¸€ä¸ªflinké›†ç¾¤ï¼Œè¿™æ—¶å€™æ•°æ®æºkafkaæˆ–è€…hdfsä¼šåœ¨åŒä¸€ä¸ªé›†ç¾¤ä¸Šå—ï¼Œè¿˜æ˜¯ä¼šå•ç‹¬å†èµ·ä¸€ä¸ªhdfs/kafkaé›†ç¾¤ 146ã€flink kafka sink çš„FlinkFixedPartitioner åˆ†é…ç­–ç•¥ï¼Œåœ¨å¹¶è¡Œåº¦å°äºtopicçš„partitionsæ—¶ï¼Œä¸€ä¸ªå¹¶è¡Œå®ä¾‹å›ºå®šçš„å†™æ¶ˆæ¯åˆ°å›ºå®šçš„ä¸€ä¸ªpartitionï¼Œé‚£ä¹ˆå°±æœ‰ä¸€äº›partitionæ²¡æ•°æ®å†™è¿›å»ï¼Ÿ 147ã€åŸºäºäº‹ä»¶æ—¶é—´ï¼Œæ¯äº”åˆ†é’Ÿä¸€ä¸ªçª—å£ï¼Œäº”ç§’é’Ÿæ»‘åŠ¨ä¸€æ¬¡ï¼ŒåŒæ—¶watermarkçš„æ—¶é—´åŒæ ·æ˜¯åŸºäºäº‹ä»¶äº‹ä»¶æ—¶é—´çš„ï¼Œå»¶è¿Ÿè®¾ä¸º1åˆ†é’Ÿï¼Œå‡å¦‚æ•°æ®æµä»12ï¼š00å¼€å§‹ï¼Œå¦‚æœ12ï¼š07-12ï¼š09æœŸé—´æ²¡æœ‰äº§ç”Ÿä»»ä½•ä¸€æ¡æ•°æ®ï¼Œå³åœ¨12ï¼š07-12ï¼š09è¿™æ®µé—´çš„æ•°æ®æµæƒ…å†µä¸ºÂ·Â·Â·Â· ï¼ˆ12ï¼š07:00ï¼Œxxxï¼‰,(12:09:00,xxx)Â·Â·Â·Â·Â·Â·ï¼Œé‚£ä¹ˆçª—å£[12:02:05-12:07:05]ï¼Œ[12:02:10-12:07:10]ç­‰å‡ ä¸ªçª—å£çš„è®¡ç®—æ˜¯å¦æ„å‘³ç€åªæœ‰ç­‰åˆ°ï¼Œ12ï¼š09ï¼š00çš„æ•°æ®åˆ°è¾¾ä¹‹åæ‰ä¼šè§¦å‘ 148ã€ä½¿ç”¨flink1.7ï¼Œå½“æ¶ˆè´¹åˆ°æŸæ¡æ¶ˆæ¯(protobufæ ¼å¼)ï¼ŒæŠ¥Caused by: org.apache.kafka.common.KafkaException: Record batch for partition Notify-18 at offset 1803009 is invalid, cause: Record is corrupt è¿™ä¸ªå¼‚å¸¸ã€‚ å¦‚ä½•è®¾ç½®è·³è¿‡å·²æŸåçš„æ¶ˆæ¯ç»§ç»­æ¶ˆè´¹ä¸‹ä¸€æ¡æ¥ä¿è¯ä¸šåŠ¡ä¸ç»ˆæ–­ï¼Ÿ æˆ‘çœ‹äº†å®˜ç½‘kafka connectorsé‚£é‡Œï¼Œè¯´åœ¨DeserializationSchema.deserialize(â€¦)æ–¹æ³•ä¸­è¿”å›nullï¼Œflinkå°±ä¼šè·³è¿‡è¿™æ¡æ¶ˆæ¯ï¼Œç„¶è€Œä¾æ—§æŠ¥è¿™ä¸ªå¼‚å¸¸ 149ã€æ˜¯å¦å¯ä»¥æŠ½ç©ºæ€»ç»“ä¸€ç¯‡Flink çš„ watermark çš„åŸç†æ¡ˆä¾‹ï¼Ÿä¸€ç›´æ²¡ææ˜ç™½åŸºäºäº‹ä»¶æ—¶é—´å¤„ç†æ—¶çš„æ•°æ®ä¹±åºå’Œæ•°æ®è¿Ÿåˆ°åº•å’‹å›äº‹ 150ã€flinkä¸­rpcé€šä¿¡çš„åŸç†ï¼Œä¸å‡ ä¸ªç±»çš„è®²è§£ï¼Œæœ‰æ²¡æœ‰ç³»ç»Ÿè¯¦ç»†çš„æ–‡ç« æ ·ï¼Œå¦‚æœ‰æ±‚åˆ†äº«ï¼Œè°¢è°¢ 151ã€Flinkä¸­å¦‚ä½•ä½¿ç”¨åŸºäºäº‹ä»¶æ—¶é—´å¤„ç†ï¼Œä½†æ˜¯åˆä¸ä½¿ç”¨Watermarks? æˆ‘åœ¨ä¼šè¯çª—å£ä¸­ä½¿ç”¨é‡åˆ°ä¸€äº›é—®é¢˜ï¼Œå›¾ä¸€æ˜¯åŸºäºå¤„ç†æ—¶é—´çš„ï¼Œæµ‹è¯•ç»“æœsessionæ˜¯åŸºäºkeyby(ç”¨æˆ·)çš„ï¼Œå›¾äºŒæ˜¯åŸºäºäº‹ä»¶æ—¶é—´çš„ï¼Œä¸çŸ¥é“æ˜¯æˆ‘ç”¨æ³•ä¸å¯¹è¿˜æ˜¯æ€ä¹ˆçš„ï¼Œæµ‹è¯•ç»“æœå‘ç°å¹¶ä¸æ˜¯åŸºäºkeyby(ç”¨æˆ·çš„)ï¼Œè€Œæ˜¯å…¨å±€çš„sessionã€‚ä¸çŸ¥é“æ€ä¹ˆä¿®æ”¹ï¼Ÿ 152ã€flinkå®æ—¶è®¡ç®—å¹³å°ï¼Œyarnæ¨¡å¼æ—¥å¿—æ”¶é›†æ€ä¹ˆåšï¼Œä¸ºä»€ä¹ˆä¼šcheckpointå¤±è´¥ï¼ŒæŠ¥è­¦å¤„ç†ï¼Œåéœ€è¦åšä»€ä¹ˆå—ï¼Ÿjobç›‘æ§æ€ä¹ˆåš 153ã€æœ‰flinkä¸jstormçš„åœ¨ä¸åŒåº”ç”¨åœºæ™¯ä¸‹, æ€§èƒ½æ¯”è¾ƒçš„æ•°æ®å—? ä»ç½‘ç»œä¸Šèƒ½æ‰¾å¤§éƒ¨åˆ†éƒ½æ˜¯flinkä¸stormçš„æ¯”è¾ƒ. åœ¨jstormå®˜ç½‘ä¸Šæœ‰ä¸€ä»½æ¯”è¾ƒçš„å›¾è¡¨, æ„Ÿè§‰å‚è€ƒæ„ä¹‰ä¸å¤§, åº”è¯¥æ˜¯æ¯”è¾ƒæ—©çš„flinkç‰ˆæœ¬. 154ã€ä¸ºä»€ä¹ˆä½¿ç”¨SessionWindows.withGapçª—å£çš„è¯ï¼ŒStateå­˜ä¸äº†ä¸œè¥¿å‘€ï¼Œæ¯æ¬¡åŠ 1 ï¼Œæ‹¿å‡ºæ¥éƒ½æ˜¯null, æˆ‘æ¢æˆ TimeWindowå°±æ²¡é—®é¢˜ã€‚ 155ã€è¯·é—®ä¸€ä¸‹ï¼Œflink datastreamæµå¤„ç†æ€ä¹ˆç»Ÿè®¡å»é‡æŒ‡æ ‡ï¼Ÿ å®˜æ–¹æ–‡æ¡£ä¸­åªçœ‹åˆ°æ‰¹å¤„ç†æœ‰distinctæ¦‚å¿µã€‚ 156ã€å¥½å…¨çš„ä¸€ç¯‡æ–‡ç« ï¼Œå¯¹æ¯”åˆ†æ Flinkï¼ŒSpark Streamingï¼ŒStorm æ¡†æ¶ 157ã€å…³äº structured_streaming çš„ paper 158ã€zookeeperé›†ç¾¤åˆ‡æ¢é¢†å¯¼äº†ï¼Œflinké›†ç¾¤é¡¹ç›®é‡å¯äº†å°±æ²¡æœ‰æ•°æ®çš„è¾“å…¥å’Œè¾“å‡ºäº†ï¼Œè¿™ä¸ªè¯¥ä»å“ªæ–¹é¢å…¥æ‰‹è§£å†³ï¼Ÿ 159ã€æˆ‘æƒ³è¯·æ•™ä¸‹datastreamæ€ä¹ˆå’Œé™æ€æ•°æ®joinå‘¢ 160ã€æ—¶é’Ÿé—®é¢˜å¯¼è‡´æ”¶åˆ°äº†æ˜å¤©çš„æ•°æ®ï¼Œè¿™æ—¶å€™æœ‰ä»€ä¹ˆæ¯”è¾ƒå¥½çš„å¤„ç†æ–¹æ³•ï¼Ÿçœ‹åˆ°æœ‰äººè®¾ç½®ä¸€ä¸ªæœ€å¤§çš„è·³è·ƒé˜ˆå€¼ï¼Œå¦‚æœå½“å‰æ•°æ®æ—¶é—´ - å†å²æœ€å¤§æ—¶é—´ è¶…è¿‡é˜ˆå€¼å°±ä¸æ›´æ–°ã€‚å¦‚ä½•åˆç†çš„è®¾è®¡æ°´å°ï¼Œæœ‰æ²¡æœ‰ä¸€äº›ç»éªŒå‘¢ï¼Ÿ 161ã€å¤§ä½¬ä»¬flinkæ€ä¹ˆå®šæ—¶æŸ¥è¯¢æ•°æ®åº“ï¼Ÿ 162ã€ç°åœ¨æˆ‘ä»¬å…¬å¸æœ‰ä¸ªæƒ³æ³•ï¼Œå°±æ˜¯æä¾›ä¸€ä¸ªé¡µé¢ï¼Œåœ¨é¡µé¢ä¸Šé€‰æ‹©source sink å¡«å†™ä¸Šsqlè¯­å¥ï¼Œç„¶ååå°ç”Ÿæˆä¸€ä¸ªflinkçš„ä½œä¸šï¼Œç„¶åæäº¤åˆ°é›†ç¾¤ã€‚åŠŸèƒ½æœ‰ç‚¹ç±»ä¼¼äºåä¸ºçš„æ•°æ®ä¸­å°ï¼Œå°±æ˜¯é¡µé¢å‚»ç“œå¼æ“ä½œã€‚åå°èƒ½è‡ªåŠ¨æ ¹æ®ç›¸åº”é…ç½®å¾—åˆ°ç»“æœã€‚è¯·é—®æ‹˜ä½ çš„äº†è§£ï¼Œå¯ä»¥å®ç°å—ï¼Ÿå¦‚ä½•å®ç°ï¼Ÿæœ‰ä»€ä¹ˆå¥½çš„æ€è·¯ã€‚ç°åœ¨æˆ‘æ— ä»ä¸‹æ‰‹ 163ã€è¯·æ•™ä¸€ä¸‹ flink on yarn çš„ haæœºåˆ¶ 164ã€åœ¨ä¸€èˆ¬çš„æµå¤„ç†ä»¥åŠcep, éƒ½å¯ä»¥å¯¹äºeventtimeè®¾ç½®watermark, æœ‰æ—¶å¯èƒ½éœ€è¦è®¾ç½®ç›¸å¯¹å¤§ä¸€ç‚¹çš„å€¼, è¿™å†…å­˜å‹åŠ›å°±æ¯”è¾ƒå¤§, æœ‰æ²¡æœ‰åŠæ³•ä¸åº”ç”¨jvmä¸­çš„å†…å­˜, è€Œç”¨å †å¤–å†…å­˜, æˆ–è€…å…¶ä»–ç¼“å­˜, æœ€å¥½æœ‰cacheæœºåˆ¶, è¿™æ ·å¯ä»¥åº”å¯¹å¤§æµé‡çš„å³°å€¼. 165ã€è¯·æ•™ä¸€ä¸ªflink sqlçš„é—®é¢˜ã€‚æˆ‘æœ‰ä¸¤ä¸ªèšåˆåçš„æµè¡¨Aå’ŒBï¼ŒAå’ŒBjoinå¾—åˆ°Cè¡¨ã€‚åœ¨è®¾ç½®state TTL çš„æ—¶å€™æ˜¯ç›´æ¥å¯¹Cè¡¨è®¾ç½®è¿˜æ˜¯ï¼Œå¯¹Aè¡¨å’ŒBè¡¨è®¾ç½®æ¯”è¾ƒå¥½ï¼Ÿ 166ã€sparkæ”¹å†™ä¸ºflinkï¼Œä¼šä¸ä¼šå¾ˆå¤æ‚ï¼Œè¿˜æœ‰è¿™ä¸¤è€…åœ¨SQLæ–¹é¢çš„æ”¯æŒå·®åˆ«å¤§å—ï¼Ÿ 167ã€è¯·é—®flink allowedLatenesså¯¼è‡´çª—å£è¢«å¤šæ¬¡fireï¼Œæœ€ç»ˆæ•°æ®é‡å¤æ¶ˆè´¹ï¼Œè¿™ç§é—®é¢˜æ€ä¹ˆå¤„ç†ï¼Œæ•°æ®æ˜¯å†™åˆ°esä¸­ 168ã€è®¾ç½®taskmanager.numberOfTaskSlots: 4çš„æ—¶å€™æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯cpuæ²¡æœ‰å‹ä¸Šå»ï¼Œåªç”¨äº†30%å·¦å³ï¼Œäºæ˜¯è®¾ç½®äº†taskmanager.numberOfTaskSlots: 8ï¼Œä½†æ˜¯å°±æŠ¥é”™è¯¯æ‰¾ä¸åˆ°å…¶ä¸­ä¸€ä¸ªè‡ªå®šä¹‰çš„ç±»ï¼Œç„¶åkafkaæ•°æ®å°±ä¸æ¶ˆè´¹äº†ã€‚ä¸ºä»€ä¹ˆï¼Ÿcpuåˆ°å¤šå°‘åˆé€‚ï¼Ÿslotæ˜¯ä¸æ˜¯å’Œcpuæ•°é‡ä¸€è‡´æ˜¯æœ€ä½³é…ç½®ï¼Ÿkafkaåˆ†åŒºæ•°å¤šå°‘åˆé€‚ï¼Œæ˜¯ä¸æ˜¯å’Œslot,parallesimä¸€è‡´æœ€ä½³ï¼Ÿ 169ã€éœ€æ±‚æ˜¯æ ¹æ®æ¯æ¡æ—¥å¿—åˆ‡åˆ†å‡ºéœ€è¦9ä¸ªå­—æ®µï¼Œæœ‰äº”ä¸ªæŒ‡æ ‡å†æ ¹æ®9ä¸ªå­—æ®µçš„ä¸åŒç»„åˆå»åšè®¡ç®—ã€‚ ç¬¬ä¸€ä¸ªæ–¹æ³•æ˜¯ï¼šæˆ‘ç›®å‰åšæ³•æ˜¯åˆ‡åˆ†çš„9ä¸ªå­—æ®µå¼€5åˆ†é’Ÿå¤§å°1åˆ†é’Ÿè®¡ç®—ä¸€æ¬¡çš„æ»‘åŠ¨çª—å£çª—å£ï¼Œè¿›è¡Œä¸€æ¬¡reduceå»é‡ï¼Œç„¶åå†mapå–å‡ºéœ€è¦çš„å­—æ®µï¼Œç„¶åè¿‡æ»¤å†å¼€5åˆ†é’Ÿå¤§å°1åˆ†é’Ÿè®¡ç®—ä¸€æ¬¡çš„æ»‘åŠ¨çª—å£çª—å£è¿›è¡Œè®¡ç®—ä¿å­˜ç»“æœï¼Œè¿™ä¸ªæ€è·¯é‡åˆ°çš„é—®é¢˜æ˜¯ä¸Šä¸€ä¸ªæ»‘åŠ¨çª—å£ä¼šæ¯ä¸€åˆ†é’Ÿä¼šè®¡ç®—5åˆ†é’Ÿæ•°æ®ï¼Œåˆ°ç¬¬äºŒä¸ªçª—å£åˆ’å®šçš„5åˆ†é’ŸèŒƒå›´çš„æ•°æ®ä¼šæœ‰å¥½å¤šé‡å¤ï¼Œè¿™ä¸ªæ€è·¯ä¼šé€ æˆæ•°æ®é‡å¤ã€‚ ç¬¬äºŒä¸ªæ–¹æ³•æ˜¯ï¼šåˆ‡åˆ†çš„9ä¸ªå­—æ®µå¼€5åˆ†é’Ÿå¤§å°1åˆ†é’Ÿè®¡ç®—ä¸€æ¬¡çš„æ»‘åŠ¨çª—å£çª—å£ï¼Œå†prossæ–¹æ³•é‡Œå®Œæˆæ‰€æœ‰çš„è¿‡æ»¤ï¼Œèšåˆè®¡ç®—ï¼Œä½†æ˜¯å†é«˜å³°æœŸæ¯åˆ†é’Ÿ400ä¸‡æ¡æ•°æ®ï¼Œè¿™ä¸ªæ€è·¯æ‹…å¿ƒåœ¨é«˜å³°æœŸflinkè®¡ç®—ä¸è¿‡æ¥ 170ã€a,b,cä¸‰ä¸ªè¡¨ï¼Œaå’Œcæœ‰eventtimeï¼Œaå’Œcç›´æ¥joinå¯ä»¥ï¼Œaå’Œb joinåå†å’Œc join å°±ä¼šæŠ¥é”™ï¼Œè¿™æ˜¯æ€ä¹ˆå›äº‹å‘¢ 171ã€è‡ªå®šä¹‰çš„sourceæ˜¯è¿™æ ·çš„ï¼ˆå›¾ä¸€æ‰€ç¤ºï¼‰ ä½¿ç”¨çš„æ—¶å€™æ˜¯è¿™æ ·çš„ï¼ˆå›¾äºŒæ‰€ç¤ºï¼‰ï¼Œä¸ºä»€ä¹ˆæ— è®º sum.print().setParallelism(2)ï¼ˆå›¾2æ‰€ç¤ºï¼‰çš„å¹¶è¡Œåº¦è®¾ç½®æˆå‡ æœ€åç»“æœéƒ½æ˜¯è¿™æ ·çš„ 172ã€åˆšæ¥è§¦flinkï¼Œå¦‚æœ‰é—®çš„ä¸åˆé€‚çš„åœ°æ–¹ï¼Œè¯·è§è°…ã€‚ 1ã€ä¸ºä»€ä¹ˆè¯´flinkæ˜¯æœ‰çŠ¶æ€çš„è®¡ç®—ï¼Ÿ 2ã€è¿™ä¸ªçŠ¶æ€æ˜¯ä»€ä¹ˆï¼Ÿ3ã€çŠ¶æ€å­˜åœ¨å“ªé‡Œ 173ã€è¿™è¾¹ç”¨flink 1.8.1çš„ç‰ˆæœ¬ï¼Œé‡‡ç”¨flink on yarnï¼Œhadoopç‰ˆæœ¬2.6.0ã€‚ä»£ç æ˜¯ä¸€ä¸ªç®€å•çš„æ»šåŠ¨çª—å£ç»Ÿè®¡å‡½æ•°ï¼Œä½†å¯åŠ¨çš„æ—¶å€™æŠ¥é”™ï¼Œå¦‚ä¸‹å›¾ç‰‡ã€‚ ï¼ˆ2ï¼‰ç„¶åæˆ‘æŠŠflinkç‰ˆæœ¬æ¢æˆ1.7.1ï¼Œé‡æ–°æäº¤åˆ°2.6.0çš„yarnå¹³å°ï¼Œå°±èƒ½æ­£å¸¸è¿è¡Œäº†ã€‚ ï¼ˆ3ï¼‰æˆ‘ä»¬æµ‹è¯•é›†ç¾¤hadoopç‰ˆæœ¬æ˜¯3.0ï¼Œæˆ‘ç”¨flink 1.8.1ç‰ˆæœ¬å°†è¿™ä¸ªç¨‹åºå†æ¬¡æ‰“åŒ…ï¼Œæäº¤åˆ°3.0ç‰ˆæœ¬çš„yarnå¹³å°ï¼Œä¹Ÿèƒ½æ­£å¸¸è¿è¡Œã€‚ è²Œä¼¼æ˜¯flink 1.8.1ç‰ˆæœ¬ä¸yarn 2.6.0ç‰ˆæœ¬ä¸å…¼å®¹é€ æˆçš„è¿™ä¸ªé—®é¢˜ 174ã€StateBackendæˆ‘ä½¿ç”¨çš„æ˜¯MemoryStateBackendï¼Œ Stateæ˜¯æ€ä¹ˆé‡Šæ”¾å†…å­˜çš„ï¼Œä¾‹å¦‚æˆ‘åœ¨å‡½æ•°ä¸­ç”¨ValueStateå­˜å‚¨äº†å†å²çŠ¶æ€ä¿¡æ¯ã€‚ä½†æ˜¯å†å²çŠ¶æ€æ•°æ®æˆ‘æ²¡æœ‰æ‰‹åŠ¨é‡Šæ”¾ï¼Œé‚£ä¹ˆç¨‹åºä¼šè‡ªåŠ¨é‡Šæ”¾ä¹ˆï¼Ÿè¿˜æ˜¯ä¸€ç›´é©»ç•™åœ¨å†…å­˜ä¸­ 175ã€è¯·é—®è€å¸ˆæ˜¯å¦å¯ä»¥æä¾›ä¸€äº›Apachebeamçš„å­¦ä¹ èµ„æ–™ è°¢è°¢ 176ã€flink çš„ DataSetæˆ–è€…DataStreamæ”¯æŒç´¢å¼•æŸ¥è¯¢ä»¥åŠåˆ é™¤å—ï¼Œåƒspark rddï¼Œå¦‚æœä¸æ”¯æŒçš„è¯ï¼Œè¯¥è½¬æ¢æˆä»€ä¹ˆ 177ã€å…³äºflinkçš„çŠ¶æ€ï¼Œèƒ½å¦æŠŠå®ƒå½“åšæ•°æ®åº“ä½¿ç”¨ï¼Œç±»ä¼¼äºå†…å­˜æ•°æ®åº“ï¼Œåœ¨å¤„ç†è¿‡ç¨‹ä¸­å­˜ä¸šåŠ¡æ•°æ®ã€‚å¦‚æœæ˜¯æ•°æ®åº“å¯ä»¥ç®—æ˜¯åˆ†å¸ƒå¼æ•°æ®åº“å—?æ˜¯ä¸æ˜¯ä½¿ç”¨rocksdbè¿™ç§å­˜å‚¨æ–¹å¼æ‰ç®—æ˜¯?æ”¯æŒçš„å•åº“å¤§å°æ˜¯ä¸æ˜¯åªæ˜¯è·Ÿæœ¬åœ°æœºå™¨çš„ç£ç›˜å¤§å°ç›¸å…³?å¦‚æœä½¿ç”¨ç¡¬ç›˜å­˜å‚¨ä¼šä¸ä¼šæ•ˆç‡æ€§èƒ½æœ‰å½±å“ 178ã€æˆ‘è¿™è¾¹åšäº†ä¸ªhttp sinkï¼Œæƒ³è¦æ‰¹é‡å‘é€æ•°æ®ï¼Œä¸è¿‡ç°åœ¨åªèƒ½ç”¨æ•°é‡æ§åˆ¶å‘é€ï¼Œä½†æœ€åçš„å‡ ä¸ªè®°å½•æ²¡æ³•è§¦å‘å‘é€åŠ¨ä½œï¼Œæƒ³é—®ä¸‹æœ‰æ²¡æœ‰ä»€ä¹ˆåŠæ³• 179ã€è¯·é—®ä¸‹å¦‚ä½•åšå®šæ—¶å»é‡è®¡æ•°ï¼Œå°±æ˜¯æ ¹æ®æ—¶é—´åˆ†çª—å£ï¼Œçª—å£å†…æ ¹æ®idå»é‡è®¡æ•°å¾—å‡ºç»“æœï¼Œå¤šè°¢ã€‚è¯•äº†ä¸å°‘åŠæ³•ï¼Œæ²¡æœ‰ç®€å•ç›´æ¥åŠæ³• 180ã€æˆ‘æœ‰ä¸ªjobä½¿ç”¨äº†elastic search sink. è®¾ç½®äº†æ‰¹é‡5000ä¸€å†™å…¥ï¼Œä½†æ˜¯çœ‹esç›‘æ§æ˜¾ç¤ºæ¯ç§’åªèƒ½æ’å…¥500æ¡ã€‚æ˜¯ä¸æ˜¯bulkprocessorçš„currentrequestä¸º0æœ‰å…³ 181ã€æœ‰dockeréƒ¨ç½²flinkçš„èµ„æ–™å— 182ã€åœ¨è¯´æ˜KeyByçš„StreamGraphæ‰§è¡Œè¿‡ç¨‹æ—¶ï¼ŒkeyByçš„IDä¸ºå•¥æ˜¯6ï¼Ÿ æ ¹æ®å‰é¢è¯´ï¼ŒIDæ˜¯ä¸€ä¸ªé™æ€å˜é‡ï¼Œæ¯å–ä¸€æ¬¡å°±é€’å¢1ï¼Œæˆ‘è§‰å¾—åº”è¯¥æ˜¯3å•Šï¼Œæ˜¯æˆ‘ç†è§£é”™äº†å— 183ã€æœ‰æ²¡è®¡åˆ’å‡ºExecution Graphçš„è¿œç è§£æ 184ã€å¯ä»¥åˆ†äº«ä¸‹ç‰©ç†æ‰§è¡Œå›¾æ€æ ·åˆ’åˆ†taskï¼Œä»¥åŠtaskå¦‚ä½•æ‰§è¡Œï¼Œè¿˜æœ‰ä»–ä»¬ä¹‹é—´æ•°æ®å¦‚ä½•ä¼ é€’è¿™å—ä»£ç å˜›ï¼Ÿ 185ã€Flinkæºç å’Œè¿™ä¸ªå­¦ä¹ é¡¹ç›®çš„ç»“æ„å›¾ 186ã€è¯·é—®flink1.8ï¼Œå¦‚ä½•åšåˆ°åŠ¨æ€åŠ è½½å¤–éƒ¨udf-jaråŒ…å‘¢ï¼Ÿ 187ã€åŒä¸€ä¸ªTask Managerä¸­ä¸åŒçš„Slotæ˜¯æ€ä¹ˆäº¤äº’çš„ï¼Œæ¯”å¦‚ï¼šsourceå¤„ç†å®Œè¦ä¼ é€’ç»™mapçš„æ—¶å€™ï¼Œå¦‚æœåœ¨ä¸åŒçš„Slotä¸­ï¼Œä»–ä»¬çš„å†…å­˜æ˜¯ç›¸äº’éš”ç¦»ï¼Œæ˜¯æ€ä¹ˆäº¤äº’çš„å‘¢ï¼Ÿ æˆ‘çŒœæ˜¯é€šè¿‡åºåˆ—åŒ–å’Œååºåˆ—åŒ–å¯¹è±¡ï¼Œå¹¶ä¸”é€šè¿‡ç½‘ç»œæ¥è¿›è¡Œäº¤äº’çš„ 188ã€ä½ ä»¬æœ‰æ²¡æœ‰è¿™ç§ä¸šåŠ¡åœºæ™¯ã€‚flinkä»kafkaé‡Œé¢å–æ•°æ®ï¼Œæ¯ä¸€æ¡æ•°æ®é‡Œé¢æœ‰mongdbè¡¨Açš„id,è¿™æ—¶æˆ‘ä¼šåœ¨mapçš„æ—¶å€™é‡‡ç”¨flinkçš„å¼‚æ­¥IOè¿æ¥Aè¡¨ï¼Œç„¶åæŸ¥è¯¢å‡ºAè¡¨çš„å­—æ®µ1ï¼Œå†æ ¹æ®è¯¥å­—æ®µ1åˆéœ€è¦å¼‚æ­¥IOå»Bè¡¨æŸ¥è¯¢å­—æ®µ2ï¼Œç„¶ååˆæ ¹æ®å­—æ®µ2å»Cè¡¨æŸ¥è¯¢å­—æ®µ3â€¦..åƒè¿™æ ·çš„ä¸šåŠ¡åœºæ™¯ï¼Œå¦‚æœå¤šæ¥å‡ ç§é€»è¾‘ï¼Œæˆ‘åº”è¯¥ç”¨ä»€ä¹ˆæ–¹æ¡ˆæœ€å¥½å‘¢ 189ã€ä»Šå¤©æœ¬åœ°è¿è¡Œflinkç¨‹åºï¼Œæ¶ˆè´¹socketä¸­çš„æ•°æ®ï¼Œè¿ç»­åªèƒ½æ¶ˆè´¹ä¸¤æ¡ï¼Œç¬¬ä¸‰æ¡flinkå°±æ¶ˆè´¹ä¸äº†äº† 190ã€æºæ•°æ®ç»è¿‡è¿‡æ»¤ååˆ†æˆäº†ä¸¤æ¡æµï¼Œç„¶åå†åˆ†åˆ«æå–äº‹ä»¶æ—¶é—´å’Œæ°´å°ï¼Œåšæ—¶é—´çª—å£ï¼Œæˆ‘æµ‹è¯•æ—¶ä¸€æ¡æµæ²¡æœ‰æ•°æ®ï¼Œå¦ä¸€æ¡çš„æ•°æ®çœ‹æ—¥å¿—åˆ°äº†çª—å£æ“ä½œé‚£è¾¹å°±æ²¡èµ°ä¸‹å»ï¼Œè²Œä¼¼çª—å£ä¸€ç›´æ²¡æœ‰ç­‰åˆ°è§¦å‘ 191ã€æœ‰åšflink cepçš„å—ï¼Œæœ‰èµ„æ–™æ²¡ï¼Ÿ 192ã€éº»çƒ¦é—®ä¸€ä¸‹ BucketingSinkè·¨é›†ç¾¤å†™ï¼Œå¦‚æœä»»åŠ¡è¿è¡Œåœ¨hadoop Aé›†ç¾¤ï¼Œä»kafkaè¯»å–æ•°æ®å¤„ç†åå†™åˆ°Hadoo Bé›†ç¾¤ï¼Œå³ä½¿æŠŠcore-site.xmlå’Œhdfs-site.xmlæ‹·è´åˆ°ä»£ç resourcesä¸‹ï¼Œè·¯å¾„ä½¿ç”¨hdfs://hadoopB/xxxï¼Œä¼šæç¤ºava.lang.RuntimeException: Error while creating FileSystem when initializing the state of the BucketingSink.ï¼Œè·¨é›†ç¾¤å†™è¿™ä¸ªé—®é¢˜ flinkä¸æ”¯æŒå—ï¼Ÿ 193ã€æƒ³å’¨è¯¢ä¸‹ï¼Œå¦‚ä½•å¯¹flinkä¸­çš„datastreamå’Œdatasetè¿›è¡Œæ•°æ®é‡‡æ · 194ã€ä¸€ä¸ªflinkä½œä¸šç»å¸¸å‘ç”Ÿoomï¼Œå¯èƒ½æ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´çš„ã€‚ å¤„ç†æµç¨‹åªæœ‰15+å­—æ®µçš„è§£æï¼Œredisæ•°æ®è¯»å–ç­‰æ“ä½œï¼ŒTMé…ç½®10gã€‚ ä¸šåŠ¡ä¼šåœ¨å¤œé—´åˆ·æ•°æ®ï¼Œqpsèƒ½æ‰“åˆ°2500å·¦å³~ 195ã€æˆ‘çœ‹åˆ°flink 1.8çš„çŠ¶æ€è¿‡æœŸä»…æ”¯æŒProcessing Timeï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä½¿ç”¨çš„æ˜¯Event timeé‚£ä¹ˆçŠ¶æ€å°±ä¸ä¼šè¿‡æœŸå— 196ã€è¯·é—®æˆ‘æƒ³æ¯éš”ä¸€å°æ—¶ç»Ÿè®¡ä¸€ä¸ªå±æ€§ä»å½“å¤©é›¶ç‚¹åˆ°å½“å‰æ—¶é—´çš„å¹³å‡å€¼ï¼Œè¿™æ ·çš„æ—¶é—´çª—è¯¥å¦‚ä½•å®šä¹‰ï¼Ÿ 197ã€flinkä»»åŠ¡é‡Œé¢ååºåˆ—åŒ–ä¸€ä¸ªç±»ï¼ŒæŠ¥ClassNotFoundExceptionï¼Œå¯æ˜¯åŒ…é‡Œé¢æ˜¯æœ‰è¿™ä¸ªç±»çš„ï¼Œæœ‰é‡åˆ°è¿™ç§æƒ…å†µå—ï¼Ÿ 198ã€åœ¨æ„é€ StreamGraphï¼Œç±»ä¼¼PartitionTransformmation è¿™ç§ç±»å‹çš„ transformï¼Œä¸ºä»€ä¹ˆè¦æ·»åŠ æˆä¸€ä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå®é™…çš„ç‰©ç†èŠ‚ç‚¹å‘¢ï¼Ÿ 199ã€flinkæ¶ˆè´¹kafkaçš„æ•°æ®å†™å…¥åˆ°hdfsä¸­ï¼Œæˆ‘é‡‡ç”¨äº†BucketingSink è¿™ä¸ªsinkå°†operatorå‡ºæ¥çš„æ•°æ®å†™å…¥åˆ°hdfsæ–‡ä»¶ä¸Šï¼Œå¹¶é€šè¿‡åœ¨hiveä¸­å»ºå¤–éƒ¨è¡¨æ¥æŸ¥è¯¢è¿™ä¸ªã€‚ä½†ç°åœ¨æœ‰ä¸ªé—®é¢˜ï¼Œå¤„äºin-progressçš„æ–‡ä»¶ï¼Œhiveæ˜¯æ— æ³•è¯†åˆ«å‡ºæ¥è¯¥æ–‡ä»¶ä¸­çš„æ•°æ®ï¼Œå¯æˆ‘æƒ³èƒ½åœ¨hiveä¸­å®æ—¶æŸ¥è¯¢è¿›æ¥çš„æ•°æ®ï¼Œä¸”ä¸æƒ³äº§ç”Ÿå¾ˆå¤šçš„å°æ–‡ä»¶ï¼Œè¿™ä¸ªè¯¥å¦‚ä½•å¤„ç†å‘¢ 200ã€é‡‡ç”¨Flinkå•æœºé›†ç¾¤æ¨¡å¼ä¸€ä¸ªjobmanagerå’Œä¸¤ä¸ªtaskmanagerï¼Œæœºå™¨æ˜¯å•æœºæ˜¯24æ ¸ï¼Œç°åœ¨åšä¸ªç®€å•çš„åŠŸèƒ½ä»kafkaçš„ä¸€ä¸ªtopicè½¬æ»¡è¶³æ¡ä»¶çš„æ¶ˆæ¯åˆ°å¦ä¸€ä¸ªtopicï¼Œtopicçš„åˆ†åŒºæ˜¯30ï¼Œæˆ‘è®¾ç½®äº†ç¨‹åºé»˜è®¤å¹¶å‘ä¸º30ï¼Œç°åœ¨æ¯ç§’æ¶ˆè´¹2wå¤šæ•°æ®ï¼Œä¸å¤Ÿå¿«ï¼Œè¯·é—®å¯ä»¥æ€ä¹ˆæé«˜jobçš„æ€§èƒ½å‘¢ï¼Ÿ 201ã€Flink Metric æºç åˆ†æ 202ã€è¯·é—®æ€ä¹ˆç†è§£å®˜ç½‘çš„è¿™æ®µè¯ï¼ŸæŒ‰å®˜ç½‘çš„ä¾‹å­ï¼Œéš¾é“åªkeybyä¹‹åæ‰æœ‰keyed stateï¼Œæ‰èƒ½æ‰˜ç®¡Flinkå­˜å‚¨çŠ¶æ€ä¹ˆï¼Ÿsourceå’Œmapå¦‚æœæ²¡æœ‰è‡ªå®šä¹‰operator stateçš„è¯ï¼ŒçŠ¶æ€æ˜¯ä¸ä¼šè¢«ä¿å­˜çš„ï¼Ÿ 203ã€æƒ³ç”¨Flinkåšä¸šåŠ¡ç›‘æ§å‘Šè­¦ï¼Œå¹¶è¦èƒ½å¤Ÿæ”¯æŒåŠ¨æ€æ·»åŠ CEPè§„åˆ™ï¼Œé—®ä¸‹å¯ä»¥ç›´æ¥ä½¿ç”¨Flink CEPè¿˜æ˜¯siddhi CEP? æœ‰æ²¡æœ‰ç›¸å…³çš„èµ„æ–™å­¦ä¹ ä¸‹ï¼Ÿè°¢è°¢ï¼ 204ã€è¯·é—®ä¸€ä¸‹ï¼Œæœ‰æ²¡æœ‰å…³äºæ°´å°ï¼Œè§¦å‘å™¨çš„Javaæ–¹é¢çš„demoå•Š 205ã€è€å¸ˆï¼Œæœ€è¿‘æˆ‘ä»¬çº¿ä¸Šå¶å°”å‡ºç°è¿™ç§æƒ…å†µï¼Œå°±æ˜¯40ä¸ªå¹¶è¡Œåº¦ï¼Œå…¶ä»–æœ‰ä¸€ä¸ªå¹¶è¡Œåº¦CheckPointä¸€ç›´å¤±è´¥ï¼Œå…¶ä»–39ä¸ªå¹¶è¡Œåº¦éƒ½æ˜¯æ¯«ç§’çº§åˆ«å°±å¯ä»¥CheckPointæˆåŠŸï¼Œè¿™ä¸ªæ€ä¹ˆå®šä½é—®é¢˜å‘¢ï¼Ÿè¿˜æœ‰ä¸ªé—®é¢˜ CheckPointçš„æ—¶é—´åˆ†ä¸ºä¸‰éƒ¨åˆ† Checkpoint Duration (Asyncï¼‰å’Œ Checkpoint Duration (Syncï¼‰ï¼Œè¿˜æœ‰ä¸ª end to end å‡å»åŒæ­¥å’Œå¼‚æ­¥çš„æ—¶é—´ï¼Œè¿™ä¸‰éƒ¨åˆ† åˆ†åˆ«æŒ‡ä»£å“ªå—ï¼Ÿå¦‚æœå‘ç°è¿™ä¸‰è€…ä¸­çš„ä»»æ„ä¸€ä¸ªæ­¥éª¤æ—¶é—´é•¿ï¼Œè¯¥æ€ä¹ˆå»ä¼˜åŒ– 206ã€æˆ‘è¿™è¾¹æœ‰ä¸ªåœºæ™¯å¾ˆä¾èµ–æ¶ˆè´¹å‡ºæ¥çš„æ•°æ®çš„é¡ºåºã€‚åœ¨æºå¤´ä¾§åšäº†å¾ˆå¤šå¤„ç†ï¼Œå°†kafkaä¿®æ”¹æˆä¸€ä¸ªåˆ†åŒºç­‰ç­‰å¾ˆå¤šå°è¯•ï¼Œæœ€åæ¶ˆè´¹å‡ºæ¥çš„è¿˜æ˜¯ä¹±åºçš„ã€‚èƒ½ä¸èƒ½åœ¨flinkæ¶ˆè´¹çš„æ—¶å€™åšå¤„ç†ï¼Œæ¥ä¿è¯å¤„ç†çš„æ•°æ®çš„é¡ºåºã€‚ 207ã€æœ‰ä¸€ä¸ªç±»ä¼¼äºå®æ—¶è®¡ç®—ä»Šå¤©çš„pvï¼Œuvéœ€æ±‚ï¼Œé‡‡ç”¨source-&gt;keyby-&gt;window-&gt;trigger-&gt;processåï¼Œåœ¨processé‡Œé‡‡ç”¨ValueStateè®¡ç®—uv ,é—®é¢˜æ˜¯ è¿™ä¸ªwindowå†…ä¸€å¤©çš„æ‰€æœ‰æ•°æ®æ˜¯éƒ½ä¼šç¼“å­˜åˆ°flinkå˜›ï¼Ÿ ä¸€å¤©çš„æ•°æ®é‡å¦‚æœå¤§ç‚¹ï¼Œè¿™æ ·å®ç°å°±æœ‰é—®é¢˜äº†ï¼Œ è¿™ä¸ªæœ‰å…¶ä»–çš„å®ç°æ€è·¯å˜›ï¼Ÿ 208ã€Flink æ³¨è§£æºç è§£æ 209ã€å¦‚ä½•ç›‘æ§ Flink çš„ TaskManager å’Œ JobManager 210ã€é—®ä¸‹ï¼Œåœ¨çœŸå®æµè®¡ç®—è¿‡ç¨‹ä¸­ï¼Œå¹¶è¡Œåº¦çš„è®¾ç½®ï¼Œæ˜¯ä¸ kafka topicçš„partitionæ•°ä¸€æ ·çš„å—ï¼Ÿ 211ã€Flinkçš„æ—¥å¿— å¦‚æœè‡ªå·±åšå¹³å°å°è£…åœ¨è‡ªå·±çš„ç•Œé¢ä¸­ è¯·é—®job Manger å’Œ taskManger è¿˜æœ‰ç”¨æˆ·è‡ªå·±çš„ç¨‹åºæ—¥å¿— æ€ä¹ˆè·å–å‘¢ æœ‰apiè¿˜æ˜¯è‡ªå·±éœ€è¦åˆ©ç”¨flume é‡‡é›†åˆ°ELKï¼Ÿ 212ã€æˆ‘æƒ³é—®ä¸‹ä¸€èˆ¬ç”¨Flinkç»Ÿè®¡pv uvæ˜¯æ€ä¹ˆåšçš„ï¼Ÿuvå­˜åˆ°redis? æ¯ä¸ªuvéƒ½å­˜åˆ°redisï¼Œä¼šä¸ä¼šæ’‘çˆ†ï¼Ÿ 213ã€Flinkçš„Checkpoint æœºåˆ¶ï¼Œåœ¨æœ‰å¤šä¸ªsourceçš„æ—¶å€™ï¼Œbarrier n çš„æµå°†è¢«æš‚æ—¶æç½®ï¼Œä»å…¶ä»–æµæ¥æ”¶çš„è®°å½•å°†ä¸ä¼šè¢«å¤„ç†ï¼Œä½†æ˜¯ä¼šæ”¾è¿›ä¸€ä¸ªè¾“å…¥ç¼“å­˜input bufferã€‚å¦‚æœè¢«ç¼“å­˜çš„recordå¤§å°è¶…å‡ºäº†input bufferä¼šæ€ä¹ˆæ ·ï¼Ÿä¸å¯èƒ½ä¸€ç›´ç¼“å­˜ä¸‹å»å§ï¼Œå¦‚æœå…¶ä¸­æŸä¸€æ¡å°±ä¸€ç›´æ²¡æ•°æ®çš„è¯ï¼Œæ•´ä¸ªè¿‡ç¨‹å²‚ä¸æ˜¯å¡æ­»äº†ï¼Ÿ 214ã€å…¬å¸æƒ³å®æ—¶å±•ç¤ºè®¢å•æ•°æ®ï¼Œæ±‡æ€»é‡‘é¢ï¼Œå¹¶éœ€è¦å’Œå‰ç«¯äº¤äº’ï¼Œå®æ—¶ç”Ÿæˆæ•°æ®éœ€è¦å‘Šè¯‰å‰ç«¯ï¼Œå±•ç¤ºæˆæŠ˜çº¿å›¾ï¼Œè¿™ç§åœºæ™¯çš„æŠ€æœ¯é€‰å‹æ˜¯å¦‚ä½•å‘¢ï¼ŸåŒ…æ‹¬æ•°æ®çš„å­˜å‚¨ï¼Œä¸´æ—¶æ±‡æ€»æ•°æ®çš„å­˜å‚¨ï¼Œä½•ç§å½¢å¼å‘Šè¯‰å‰ç«¯ 215ã€è¯·é—®ä¸‹checkpointä¸­å­˜å‚¨äº†å“ªäº›ä¸œè¥¿ï¼Ÿ 216ã€æˆ‘è¿™è¾¹æœ‰ä¸ªéœ€æ±‚æ˜¯å®æ—¶è®¡ç®—å½“å‰è½¦è¾†ä¸å‰è½¦è·ç¦»ï¼Œç”¨ç»çº¬åº¦æ±‚è·ç¦»ã€‚å¤§æ¦‚6000å°è½¦ï¼Œ10ç§’ä¸€æ¡ç»çº¬åº¦æ•°æ®ã€‚gpsæµä¸è‡ªå·±joinçš„åœ°æ–¹åœ¨è¿›è¡Œcheckpointçš„æ—¶å€™ç‰¹åˆ«ç¼“ï¼Œæ¯æ¬¡è¦å¥½å‡ åˆ†é’Ÿã€‚checkpoint çŠ¶æ€åç«¯æ˜¯rocksDBã€‚æœ‰ä»€ä¹ˆæ¯”è¾ƒå¥½çš„æ–¹æ¡ˆå—ï¼Ÿè‡ªå·±å®ç°ä¸€ä¸ªç±»ä¼¼last_valueçš„å‡½æ•°å–è½¦è¾†æœ€æ–°çš„ç»çº¬å†joinï¼Œæˆ–è€…å¼„ä¸ª10ç§’çš„æ»‘åŠ¨çª—å£è¾“å‡ºè½¦è¾†æœ€æ–°çš„ç»çº¬åº¦å†è¿›è¡Œjoinï¼Œè¿™æ ·å¯è¡Œå—ï¼Ÿ 217ã€flinkåœ¨å¯åŠ¨çš„æ—¶å€™èƒ½ä¸èƒ½æŒ‡å®šä¸€ä¸ªæ—¶é—´ç‚¹ä»kafkaé‡Œé¢æ¢å¤æ•°æ®å‘¢ 218ã€æˆ‘ä»¬çº¿ä¸Šæœ‰ä¸ªé—®é¢˜ï¼Œå¾ˆå¤šä¸šåŠ¡éƒ½å»è¯»æŸä¸ªhiveè¡¨ï¼Œä½†æ˜¯å½“è¿™ä¸ªhiveè¡¨æ­£åœ¨å†™æ•°æ®çš„æ—¶å€™ï¼Œå¶å°”å‡ºç°è¿‡ è¯»åˆ°è¡¨é‡Œæ•°æ®ä¸ºç©ºçš„æƒ…å†µï¼Œè¿™ä¸ªé—®é¢˜æ€ä¹ˆè§£å†³å‘¢ï¼Ÿ 219ã€ä½¿ç”¨ InfluxDB å’Œ Grafana æ­å»ºç›‘æ§ Flink çš„å¹³å° 220ã€flinkæ¶ˆè´¹kafkaä¸¤ä¸ªä¸åŒçš„topic,ç„¶åè¿›è¡Œjoinæ“ä½œï¼Œå¦‚æœä½¿ç”¨äº‹ä»¶æ—¶é—´ï¼Œä¸¤ä¸ªtopicéƒ½è¦è®¾ç½®watermakerå—ï¼Œå¦‚æœåªè®¾ç½®äº†topic Açš„watermaker,topic Bçš„ä¸è®¾ç½®ä¼šæœ‰ä»€ä¹ˆå½±å“å—ï¼Ÿ 221ã€è¯·æ•™ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘çš„Flinkç¨‹åºè¿è¡Œä¸€æ®µæ—¶é—´å°±ä¼šæŠ¥è¿™ä¸ªé”™è¯¯ï¼Œå®šä½å¥½å¤šå¤©éƒ½æ²¡æœ‰å®šä½åˆ°ã€‚checkpoint æ—¶é—´æ˜¯5ç§’ï¼Œ20ç§’éƒ½ä¸è¡Œã€‚Caused by: java.io.IOException: Could not flush and close the file system output stream to hdfs://HDFSaaaa/flink/PointWideTable_OffTest_Test2/1eb66edcfccce6124c3b2d6ae402ec39/chk-355/1005127c-cee3-4099-8b61-aef819d72404 in order to obtain the stream state handle 222ã€Flinkçš„åå‹æœºåˆ¶ç›¸æ¯”äºStormçš„åå‹æœºåˆ¶æœ‰ä»€ä¹ˆä¼˜åŠ¿å‘¢ï¼Ÿé—®é¢˜2: Flinkçš„æŸä¸€ä¸ªèŠ‚ç‚¹å‘ç”Ÿæ•…éšœï¼Œæ˜¯å¦ä¼šå½±å“å…¶ä»–èŠ‚ç‚¹çš„æ­£å¸¸å·¥ä½œï¼Ÿè¿˜æ˜¯ä¼šé€šè¿‡Checkpointå®¹é”™æœºåˆ¶å—æŠŠä»»åŠ¡è½¬ç§»åˆ°å…¶ä»–èŠ‚ç‚¹å»è¿è¡Œå‘¢ï¼Ÿ 223ã€æˆ‘åœ¨éªŒè¯checkpointçš„æ—¶å€™é‡åˆ°ç»™é—®é¢˜ï¼Œä¸ç®¡æ˜¯key state è¿˜æ˜¯operator stateï¼Œé»˜è®¤å’ŒæŒ‡å®šuidæ˜¯å¯ä»¥çš„æ¢å¤stateæ•°æ®çš„ï¼Œå½“æŒ‡å®šuidHashæ—¶å€™æ— æ³•æ¢å¤stateæ•°æ®ï¼Œéº»çƒ¦å¤§å®¶ç»™è§£ç­”ä¸€æ ·ã€‚æˆ‘æ“ä½œstateæ˜¯å®ç°äº†CheckpointedFunctionæ¥å£ï¼Œè¦†å†™snapshotStateå’ŒinitializeStateï¼Œå†è¿™ä¸¤ä¸ªæ–¹æ³•é‡Œæ“ä½œçš„ï¼Œç„¶åè®©ç¨‹åºå®šæ—¶æŠ›å‡ºå¼‚å¸¸ï¼Œè§‚å¯Ÿå‘ç°æŒ‡å®šuidHashåsnapshotState()æ–¹æ³•é‡Œcontext.isRestored()ä¸ºfalseï¼Œä¸å¤ªæ˜ç™½å…·ä½“æ˜¯ä»€ä¹ˆåŸå›  224ã€kafka ä¸­çš„æ¯æ¡æ•°æ®éœ€è¦å’Œ es ä¸­çš„æ‰€æœ‰æ•°æ®(åŠ¨æ€å¢åŠ )å…³è”ï¼Œå…³è”ä¹‹åä¼šåšä¸€äº›é¢å¤–çš„æ“ä½œï¼Œè¿™ä¸ªæœ‰ä»€ä¹ˆæ¯”è¾ƒå¯è¡Œçš„æ–¹æ¡ˆï¼Ÿ 225ã€flinkæ¶ˆè´¹kafkaæ•°æ®ï¼Œè®¾ç½®1åˆ†é’Ÿcheckpointä¸€æ¬¡ï¼Œå‡å¦‚ç¬¬ä¸€æ¬¡checkpointå®Œæˆä»¥åï¼Œè¿˜æ²¡ç­‰åˆ°ä¸‹ä¸€æ¬¡checkpointï¼Œç¨‹åºå°±æŒ‚äº†ï¼Œkafka offsetè¿˜æ˜¯ç¬¬ä¸€æ¬¡checkpointè®°å½•çš„offset,é‚£ä¹ˆä¸‹æ¬¡é‡æ–°å¯åŠ¨ç¨‹åºï¼Œå²‚ä¸æ˜¯å¤šæ¶ˆè´¹æ•°æ®äº†ï¼Ÿé‚£flinkçš„ exactly oneæ¶ˆè´¹è¯­ä¹‰æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ 226ã€ç¨‹åºé¢‘ç¹å‘ç”ŸHeartbeat of TaskManager with id container_e36_1564049750010_5829_01_000024 timed out. å¿ƒè·³è¶…æ—¶ï¼Œä¸€å¤©å¤§æ¦‚10æ¬¡å·¦å³ã€‚æ˜¯å†…å­˜æ²¡ç»™å¤Ÿå—ï¼Ÿè¿˜æ˜¯ç½‘ç»œæ³¢åŠ¨å¼•èµ·çš„ 227ã€æœ‰æ²¡æœ‰æ€§èƒ½ä¼˜åŒ–æ–¹é¢çš„æŒ‡å¯¼æ–‡ç« ï¼Ÿ 228ã€flinkæ¶ˆè´¹kafkaæ˜¯å¦‚ä½•ç›‘æ§æ¶ˆè´¹æ˜¯å¦æ­£å¸¸çš„ï¼Œæœ‰å•¥å¥½åŠæ³•ï¼Ÿ 229ã€æˆ‘æŒ‰ç…§å®˜æ–¹çš„wordcountæ¡ˆä¾‹å†™äº†ä¸€ä¸ªä¾‹å­ï¼Œç„¶ååœ¨mainå‡½æ•°ä¸­èµ·äº†ä¸€ä¸ªçº¿ç¨‹ï¼ŒåŸæœ¬æ˜¯å‡†å¤‡å®šæ—¶å»æ›´æ–°æŸäº›é…ç½®ï¼Œå‡†å¤‡æµ‹è¯•ä¸€ä¸‹æ˜¯å¦å¯è¡Œï¼Œæ‰€ä»¥ç›´æ¥åœ¨çº¿ç¨‹å‡½æ•°ä¸­æ‰“å°ä¸€æ¡è¯­å¥æµ‹è¯•æ˜¯å¦å¯è¡Œã€‚ç°åœ¨æµ‹è¯•çš„ç»“æœæ˜¯ä¸å¯è¡Œï¼Œè²Œä¼¼è¿™ä¸ªçº¿ç¨‹æ ¹æœ¬å°±æ²¡æœ‰æ‰§è¡Œï¼Œè¯·é—®è¿™æ˜¯ä»€ä¹ˆåŸå› å‘¢ï¼Ÿ æŒ‰ç…§ç†è§£ï¼ŒJobClientä¸­ä¸æ˜¯åå°„ç±»æ‰§è¡Œmainå‡½æ•°å—ï¼Œ æ‰§è¡Œmainå‡½æ•°çš„æ—¶å€™ä¸ºä»€ä¹ˆæ²¡æœ‰æ‰§è¡Œè¿™ä¸ªçº¿ç¨‹çš„æ‰“å°å‡½æ•°å‘¢ï¼Ÿ 230ã€è¯·é—®æˆ‘æƒ³ä¿ç•™æœ€è¿‘å¤šä¸ªå®Œæˆçš„checkpointæ•°æ®ï¼Œæ˜¯é€šè¿‡è®¾ç½® state.checkpoints.num-retained å—ï¼Ÿè¦æ€ä¹ˆä½¿ç”¨ï¼Ÿ 231ã€æœ‰æ²¡æœ‰etlå®æ—¶æ•°ä»“ç›¸å…³æ¡ˆä¾‹ä¹ˆï¼Ÿæ¯”å¦‚äºŒåå¼ äº‹å®è¡¨æµjoin 232ã€ä¸ºä»€ä¹ˆæˆ‘æ‰”åˆ°flink çš„stream jobï¼Œç«‹åˆ»å°±finished 233ã€æœ‰æ²¡æœ‰åœ¨flinkä¸Šæœºå™¨å­¦ä¹ ç®—æ³•çš„ä¸€äº›ä¾‹å­å•Šï¼Œé™¤äº†å®˜ç½‘æä¾›çš„flink exampkeé‡Œçš„å’Œflink mlé‡Œå·²æœ‰çš„ 234ã€å¦‚æœæˆ‘æƒ³æ‰©å±•sqlçš„å…³é”®è¯ï¼Œæ¯”å¦‚æ·»åŠ ä¸€äº›æ•°æ®æ”¯æŒï¼Œæœ‰ä»€ä¹ˆæ€è·¯ï¼Œç°åœ¨æƒ³çš„æ„Ÿè§‰éƒ½è¦æ”¹calciteï¼ˆåˆšç¢°flinkæ„Ÿè§‰éš¾åº¦å¤ªå¤§äº†ï¼‰ 235ã€æˆ‘æƒ³å®ç°ç»Ÿè®¡æ¯5ç§’ä¸­æ¯ä¸ªç±»å‹çš„æ¬¡æ•°ï¼Œè¿™ä¸ªç°åœ¨ä¸è¾“å‡ºï¼Œé—®é¢˜å‡ºåœ¨å“ªå„¿å•Š 236ã€æˆ‘ç”¨flinkå¾€hbaseé‡Œå†™æ•°æ®ï¼Œæœ‰é‚£ç§ç›´æ¥æ‰¹é‡å†™hfileçš„æ–¹å¼çš„demoæ²¡ 237ã€è¯·é—®æ€ä¹ˆç›‘æ§Kafkaæ¶ˆè´¹æ˜¯å¦å»¶è¿Ÿï¼Œæ˜¯å¦å‡ºç°æ¶ˆæ¯ç§¯å‹ï¼Ÿä½ æœ‰demoå—ï¼Ÿè¿™ç§æ˜¯ç”¨Springbootè‡ªå·±å†™ä¸€ä¸ªç›‘æ§ï¼Œè¿˜æ˜¯å’‹æ•´å•Šï¼Ÿ 238ã€è¯·é—®æœ‰è®¡ç®—pv uvçš„ä¾‹å­å— 239ã€é€šè¿‡æ§åˆ¶æµåŠ¨æ€ä¿®æ”¹windowç®—å­çª—å£ç±»å‹å’Œé•¿åº¦è¦æ€ä¹ˆå†™ 240ã€flinkçš„è¿œç¨‹è°ƒè¯•èƒ½å‡ºä¸€ç‰ˆä¹ˆï¼Ÿç½‘ä¸Šèµ„æ–™å‘çš„å¤š 241ã€ä¼ä¸šé‡Œï¼ŒFlinkå¼€å‘ï¼Œjavaç”¨å¾—å¤šï¼Œè¿˜æ˜¯scalaç”¨å¾—å¤šï¼Ÿ 242ã€flinkçš„ä»»åŠ¡è¿è¡Œåœ¨yarnçš„ç¯å¢ƒä¸Šï¼Œåœ¨yarnçš„resourcemanageråœ¨è¿›è¡Œä¸»å¤‡åˆ‡æ¢æ—¶ï¼Œæ‰€æœ‰çš„flinkä»»åŠ¡éƒ½å¤±è´¥äº†ï¼Œè€ŒMRçš„ä»»åŠ¡å¯ä»¥æ­£å¸¸è¿è¡Œã€‚æŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼šAM is not registered for known application attempt: appattempt_1565306391442_89321_000001 or RM had restarted after AM registered . AM should re-register è¯·é—®è¿™æ˜¯ä»€ä¹ˆåŸå› ï¼Œè¯¥å¦‚ä½•å¤„ç†å‘¢ï¼Ÿ 243ã€è¯·æ•™ä¸€ä¸ªåˆ†å¸ƒå¼é—®é¢˜ï¼Œæ¯”å¦‚åœ¨Flinkçš„å¤šä¸ªTaskManagerä¸Šç»Ÿè®¡æŒ‡æ ‡countï¼ŒTM1æœ‰ä¸¤æ¡æ•°æ®ï¼ŒTM2æœ‰ä¸€æ¡æ•°æ®ï¼Œç¨‹åºæ˜¯æ€ä¹ˆè®¡ç®—å‡ºæ¥æ˜¯3å‘¢ï¼ŸåŸç†æ˜¯æ€ä¹ˆæ ·çš„ 244ã€ç°åœ¨å…¬å¸éƒ¨åˆ†sqlæŸ¥è¯¢oracleæ•°æ®ç‰¹åˆ«çš„æ…¢ï¼Œå› ä¸ºæŸ¥è¯¢æ¡ä»¶å¾ˆå¤šæƒ³é—®ä¸€ä¸‹æœ‰ä»€ä¹ˆæ–¹æ³•ï¼Œä¾‹å¦‚åŸºäºå¤§æ•°æ®ç»„ä»¶å¯ä»¥åŠ å¿«æŸ¥è¯¢é€Ÿåº¦çš„å—ï¼Ÿ 245ã€æƒ³å’¨è¯¢ä¸‹æœ‰æ²¡æœ‰åšè¿‡flinkåŒæ­¥é…ç½®åšè‡ªå®šä¹‰è®¡ç®—çš„ç³»ç»Ÿï¼Ÿæˆ–è€…æœ‰æ²¡æœ‰ä»€ä¹ˆå¥½çš„å»ºè®®ï¼Ÿä¸šåŠ¡è¯‰æ±‚æ˜¯å¸Œæœ›ä¸šåŠ¡ç”¨æˆ·å¯ä»¥è‡ªåŠ©é…ç½®è®¡ç®—è§„åˆ™åšæµå¼è®¡ç®— 246ã€æˆ‘è¿™è¾¹æœ‰ä¸ªå®æ—¶åŒæ­¥æ•°æ®çš„ä»»åŠ¡ï¼Œç™½å¤©è¿è¡Œçš„æ—¶å€™ä¸€ç›´æ˜¯æ­£å¸¸çš„ï¼Œä¸€åˆ°å‡Œæ™¨2ç‚¹å¤šä¹‹åå°±æ²¡æœ‰æ•°æ®sinkè¿›mysqlã€‚æ™šä¸Šä¼šæœ‰ä¸€äº›ç¦»çº¿ä»»åŠ¡å’Œä¸€äº›dataXä»»åŠ¡åŒæ­¥æ•°æ®åˆ°mysqlã€‚ä½†æ˜¯ä»»åŠ¡ä¸€åˆ‡éƒ½æ˜¯æ­£å¸¸çš„ï¼Œckä¹Ÿå¾ˆå¿«20msï¼Œæ•°æ®ä¹Ÿæ˜¯æ­£å¸¸æ¶ˆè´¹ã€‚çœ‹äº†yarnä¸Šçš„æ—¥å¿—ï¼Œæ²¡æœ‰ä»»ä½•errorã€‚è‡ªå®šä¹‰çš„sinké‡Œé¢ä¹Ÿè®¾ç½®äº†æ—¥å¿—æ‰“å°ï¼Œä½†æ˜¯logé‡Œæ²¡æœ‰ã€‚è¿™ç§å¦‚ä½•å¿«é€Ÿå®šä½é—®é¢˜ã€‚ 247ã€æœ‰æ²¡æœ‰flinkå¤„ç†å¼‚å¸¸æ•°æ®çš„æ¡ˆä¾‹èµ„æ–™ 248ã€flinkä¸­å¦‚ä½•ä¼ é€’ä¸€ä¸ªå…¨å±€å˜é‡ 249ã€å°4æ ¸16Gçš„Flink taskmanageré…ä¸€ä¸ªå•ç‹¬çš„Yarnéœ€è¦ä¸€å°å•¥æ ·çš„æœåŠ¡å™¨ï¼Ÿå…¶ä»–åŠŸèƒ½éƒ½ä¸éœ€è¦å°±ä¸€ä¸ªè°ƒåº¦çš„ä¸œè¥¿ï¼Ÿ 250ã€side-output çš„åˆ†äº« 251ã€ä½¿ç”¨ InfluxDB + Grafana ç›‘æ§flinkèƒ½å¦é…ç½®å‘Šè­¦ã€‚æ˜¯ä¸æ˜¯prometheusæ›´å¼ºå¤§ç‚¹ï¼Ÿ 252ã€æˆ‘ä»¬çº¿ä¸Šé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå¸¦çŠ¶æ€çš„ç®—å­æ²¡æœ‰æŒ‡å®š uidï¼Œç°åœ¨ä»£ç å¿…é¡»æ”¹ï¼Œé‚£ä¸ªå¸¦çŠ¶æ€çš„ç®—å­ ä¸èƒ½æ­£å¸¸æ¢å¤äº†ï¼Œæœ‰è§£å—ï¼Ÿé€šè¿‡æŸç§æ–¹å¼èƒ½è·å–åˆ°ç³»ç»Ÿä¹‹å‰è‡ªåŠ¨ç”Ÿæˆçš„uidå—ï¼Ÿ 253ã€tableEnv.registerDataStream(â€œOrdersâ€, ds, â€œuser, product, amount, proctime.proctime, rowtime.rowtimeâ€);è¯·é—®åƒè¿™æ ·æŠŠæµæ³¨å†Œæˆè¡¨çš„æ—¶å€™ï¼Œè¿™ä¸¤ä¸ªrowtimeåˆ†åˆ«æ˜¯ä»€ä¹ˆæ„æ€ 254ã€æˆ‘æƒ³é—®ä¸€ä¸‹ flink on yarn session æ¨¡å¼ä¸‹æäº¤ä»»åŠ¡å®˜ç½‘ç»™çš„ä¾‹å­æ˜¯ flink run -c xxx.MainClass job.jar è¿™é‡Œæ˜¯æ€ä¹ˆçŸ¥é“ yarn ä¸Šçš„å“ªä¸ªæ˜¯ flink çš„ appid å‘¢ï¼Ÿ 255ã€Flink Netty Connector è¿™ä¸ªæœ‰è¯¦ç»†çš„ä½¿ç”¨ä¾‹å­ï¼Ÿ é€šè¿‡Nettyå»ºç«‹çš„sourceèƒ½ç›´æ¥å›å¤æ¶ˆæ¯å—ï¼Ÿè¿˜æ˜¯åªèƒ½è¢«åŠ¨æ¥å—æ¶ˆæ¯ï¼Ÿ 256ã€è¯·é—®flink sqlclient æäº¤çš„ä½œä¸šå¯ä»¥ç”¨äºç”Ÿäº§ç¯å¢ƒå—ï¼Ÿ 257ã€flinkæ‰¹å¤„ç†å†™å›mysqlæ˜¯å¦æ²¡æ³•ç”¨tableEnv.sqlUpdate(â€œinsert into t2 select * from t1â€)ï¼Ÿä½œä¸ºsinkè¡¨çš„t2è¦å¦‚ä½•æ³¨å†Œï¼ŸæŸ¥è·Ÿjdbcç›¸å…³çš„å°±ä¸¤ä¸ªTableSinkï¼ŒJDBCAppendTableSinkç”¨äºBatchTableSinkï¼ŒJDBCUpertTablSinkç”¨äºStreamTableSinkã€‚å‰è€…åªæ¥å—insert into valuesè¯­æ³•ã€‚æ‰€ä»¥æˆ‘æ˜¯å…ˆé€šè¿‡select fromæŸ¥è¯¢è·å–åˆ°DataSetå†JDBCAppendTableSink.emitDataSet(ds)å®ç°çš„ï¼Œä½†è¿™æ ·è¾¾ä¸åˆ°sql rule anyç›®æ ‡ 258ã€è¯·é—®åœ¨streamæ¨¡å¼ä¸‹ï¼Œflinkçš„è®¡ç®—ç»“æœåœ¨ä¸è½åº“çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡ä»€ä¹ˆrestful apiè·å–è®¡ç®—ç»“æœå— 259ã€ç°åœ¨æˆ‘æœ‰åœºæ™¯ï¼Œéœ€è¦æŠŠä¸€å®šçš„æ¶ˆæ¯å‘é€ç»™kafka topicæŒ‡å®šçš„partitionï¼Œè¯¥æ€ä¹ˆæï¼Ÿ 260ã€è¯·é—®æˆ‘çš„jobä½œä¸šåœ¨ideaä¸Šè¿è¡Œæ­£å¸¸ æäº¤åˆ°ç”Ÿäº§é›†ç¾¤é‡Œæç¤ºCaused by: java.lang.NoSuchMethodError: org.apache.flink.api.java.ClosureCleaner.clean(Ljava/lang/Object;Z)Vè¯·é—®å¦‚ä½•è§£å†³ 261ã€é‡åˆ°ä¸€ä¸ªå¾ˆå¥‡æ€ªçš„é—®é¢˜ï¼Œåœ¨ä½¿ç”¨streamingSQLæ—¶ï¼Œå‘ç°timestampåœ¨datastreamçš„æ—¶å€™è¿˜æ˜¯æ­£å¸¸çš„ï¼Œåœ¨æ³¨å†Œæˆè¡¨printå‡ºæ¥çš„æ—¶å€™å°±å°‘äº†å…«å°æ—¶ï¼Œå¤§ä½¬çŸ¥é“æ˜¯ä»€ä¹ˆåŸå› ä¹ˆï¼Ÿ 262ã€è¯·é—®å°†flinkçš„äº§ç”Ÿçš„ä¸€äº›è®°å½•æ—¥å¿—å¼‚æ­¥åˆ°kafkaä¸­ï¼Œéœ€è¦å¦‚ä½•é…ç½®ï¼Œé…ç½®åå¿…é¡»è¦é‡å¯é›†ç¾¤æ‰ä¼šç”Ÿæ•ˆå— 263ã€æ˜Ÿä¸»ä½ å¥½ï¼Œé—®ä¸‹flink1.9å¯¹ç»´è¡¨joinçš„æ”¯æŒæ€ä¹ˆæ ·äº†ï¼Ÿæœ‰æ–‡æ¡£å— 264ã€è¯·é—®ä¸‹ flink slqï¼š SELECT city_name as city_name, count(1) as total, max(create_time) as create_time FROM * ã€‚ä»£ç é‡Œé¢è®¾ç½®çª—å£ä¸ºï¼š retractStream.timeWindowAll(Time.minutes(5))ä¸€ä¸ªglobalçª—å£ï¼Œæ•°æ®å†™å…¥hdfs ç»“æœæ•°æ®é‡å¤ ï¼Œå­˜åœ¨ä¸¤æ¡å®Œå…¨é‡å¤çš„æ•°æ®å¦‚ä¸‹ å¸¸å·ã€2283ã€ 1566230703ï¼‰ï¼šè¯·é—®è¿™æ˜¯ä¸ºä»€ä¹ˆ 265ã€æˆ‘ç”¨rocksdbå­˜å‚¨checkpointï¼Œçº¿ä¸Šè¿è¡Œä¸€æ®µæ—¶é—´å‘å±•checkpointå ç”¨ç©ºé—´è¶Šæ¥è¶Šå¤§ï¼Œæˆ‘æ˜¯ç›´æ¥å­˜æœ¬åœ°ç£ç›˜ä¸Šçš„ï¼Œæ€ä¹ˆæ ·èƒ½è®©å®ƒè‡ªåŠ¨æ¸…ç†å‘¢ï¼Ÿ 266ã€flinkåº”è¯¥åœ¨å“ªä¸ªç”¨æˆ·ä¸‹å¯åŠ¨å‘¢ï¼Œæ˜¯rootçš„è¿˜æ˜¯åœ¨å…¶ä»–çš„ç”¨æˆ·å‘¢ 267ã€linkå¯ä»¥è¯»å–lzoçš„æ–‡ä»¶å— 268ã€æ€ä¹ˆå¿«é€Ÿä»esé‡Œé¢ä¾¿åˆ©æ•°æ®ï¼Ÿæˆ‘ä»¬å…¬å¸ç°åœ¨æ‰€æœ‰çš„æ•°æ®éƒ½å­˜åœ¨Esé‡Œé¢çš„;æˆ‘å‘ç°æ¯æ¬¡ä»é‡Œé¢scanæ•°æ®çš„æ—¶å€™ç‰¹åˆ«æ…¢;ä½ é‚£æœ‰æ²¡æœ‰ä»€ä¹ˆå¥½çš„åŠæ³•ï¼Ÿ 269ã€å¦‚æœæƒ³è®©æ•°æ®æŒ‰ç…§å…¶ä¸­ä¸€ä¸ªå‡å¦‚f0è¿›è¡Œåˆ†åŒºï¼Œç„¶åæ¯ä¸€ä¸ªåˆ†åŒºåšå¤„ç†çš„æ—¶å€™å¹¶è¡Œåº¦éƒ½æ˜¯1æ€ä¹ˆè®¾ç½®å‘¢ 270ã€è¿‘åœ¨å†™ç®—å­çš„è¿‡ç¨‹ä¸­,ä½¿ç”¨scalaè¯­è¨€å†™flinkæ¯”è¾ƒå¿«,è€Œä¸”åœ¨processç®—å­ä¸­å®ç°ontimeæ–¹å¼æ—¶,å¯ä»¥ä½¿ç”¨scalaä¸­çš„listbuffæ¥è¾“å‡ºä¸€ä¸ªtop3çš„è®°å½•;é‚£ä¹ˆåˆ°äº†javaä¸­,åªèƒ½ç”¨ArrayListå°†flinkä¸­çš„ListStateä½¿ç”¨get()æ–¹æ³•å–å‡ºä¹‹åæ”¾åœ¨ArrayListå—? 271ã€è¯·é—®è€å¸ˆèƒ½å¦å‡ºä¸€äº›1.9ç‰ˆæœ¬ç»´è¡¨joinçš„ä¾‹å­ åŒ…æ‹¬asyncå’Œç»´è¡¨ç¼“å­˜ï¼Ÿ 272ã€flink kaka sourceè®¾ç½®ä¸ºä»ç»„å†…æ¶ˆè´¹ï¼Œæœ‰ä¸ªé—®é¢˜æ˜¯ç¬¬ä¸€æ¬¡å¯åŠ¨ä»»åŠ¡ï¼Œæˆ‘å‘ç°kafkaä¸­çš„å†å²æ•°æ®ä¸ä¼šè¢«æ¶ˆè´¹ï¼Œè€Œæ˜¯ä»å½“å‰çš„æ•°æ®å¼€å§‹æ¶ˆè´¹ï¼Œè€Œç¬¬äºŒæ¬¡å¯åŠ¨çš„æ—¶å€™æ‰ä¼šä»ç»„çš„offsetå¼€å§‹æ¶ˆè´¹ï¼Œæœ‰ä»€ä¹ˆåŠæ³•å¯ä»¥è®©ç¬¬ä¸€æ¬¡å¯åŠ¨ä»»åŠ¡çš„æ—¶å€™å¯ä»¥æ¶ˆè´¹kafkaä¸­çš„å†å²æ•°æ®å— 273ã€1.ä½¿ç”¨flinkå®šæ—¶å¤„ç†ç¦»çº¿æ•°æ®ï¼Œæœ‰æ—¶é—´æˆ³å­—æ®µï¼Œå¦‚ä½•æ±‚å‡ºæ¯åˆ†é’Ÿçš„æœ€å¤§å€¼ï¼Œç±»ä¼¼äºæµå¤„ç†çª—å£é‚£æ ·ï¼Œ2å¦‚æœæƒ³è‡ªå·±å®ç°æ‰¹æµç»Ÿä¸€ï¼Œæœ‰ä»€ä¹ˆå¥½çš„åˆå¹¶æ–¹å‘å—ï¼Ÿæ¯”å¦‚æƒ³è®©æµå¤„ç†ä½¿ç”¨æ‰¹å¤„ç†çš„ä¸€ä¸ªç®—å­ã€‚ 274ã€flinkæ€ä¹ˆå®ç°æµå¼æ•°æ®æ‰¹é‡å¯¹å¾…ï¼Ÿæµçš„æ•°æ®æ˜¯è‡ªå®šä¹‰çš„sourceï¼Œè¯»å–çš„rediså¤šä¸ªHashè¡¨ï¼Œéœ€è¦æ§åˆ¶æ‰¹æ¬¡çš„æ¦‚å¿µ 275ã€æœ‰äººè¯´ä¸æ¨èåœ¨ä¸€ä¸ªtaskä¸­å¼€å¤šä¸ªçº¿ç¨‹ï¼Œè¿™ä¸ªä½ æ€ä¹ˆçœ‹ï¼Ÿ 276ã€æƒ³åšä¸€ä¸ªè¿è¡Œåœ¨hbase+esæ¶æ„ä¸Šçš„sqlæŸ¥è¯¢æ–¹æ¡ˆï¼Œflink sqlèƒ½åšå—ï¼Œæˆ–è€…æœ‰æ²¡æœ‰å…¶ä»–çš„è§£å†³æ–¹æ¡ˆæˆ–è€…æ€è·¯ï¼Ÿ 277ã€æ­£åœ¨ç´§æ€¥åšç¬¬ä¸€ä¸ªç”¨åˆ°Flinkçš„é¡¹ç›®ï¼Œå’¨è¯¢ä¸€ä¸‹ï¼ŒFlink 1.8.1å†™å…¥ES7å°±æ˜¯ç”¨è‡ªå¸¦çš„Sinkå—ï¼Ÿæœ‰æ²¡æœ‰ä¾‹å­åˆ†äº«ä¸€ä¸‹ï¼Œæˆ‘æœåˆ°çš„éƒ½æ˜¯å†™ES6çš„ã€‚è¿™ç§è¦æ±‚æˆ‘çŸ¥é“ä¸é€‚åˆæï¼Œä¸»è¦æ˜¯æ€¥ï¼Œè‡ªå·±è¯•å‡ ä¸‹æ²¡æˆåŠŸã€‚T T 278ã€æ‰‹åŠ¨åœæ­¢ä»»åŠ¡åï¼Œå·²ç»ä¿å­˜äº†æœ€è¿‘ä¸€æ¬¡ä¿å­˜ç‚¹ï¼Œä»»åŠ¡é‡æ–°å¯åŠ¨åï¼Œå¦‚ä½•ä½¿ç”¨ä¸Šä¸€æ¬¡æ£€æŸ¥ç‚¹ï¼Ÿ 279ã€æ‰¹å¤„ç†ä½¿ç”¨æµç¯å¢ƒï¼ˆä¸ºäº†ä½¿ç”¨çª—å£ï¼‰ï¼Œé‚£å¦‚ä½•ç¡®å®šæ‰¹å¤„ç†ç»“æŸï¼Œå°±æ˜¯æˆ‘çš„ä»»åŠ¡å¯ä»¥çŸ¥é“æ‰¹æ–‡ä»¶è¯»å–å®Œäº‹ï¼Œå¹¶ä¸”å¤„ç†å®Œæ•°æ®åå…³é—­ä»»åŠ¡ï¼Œå¦‚æœä¸èƒ½ï¼Œé‚£æ‰¹å¤„ç†å¦‚ä½•å®ç°çª—å£åŠŸèƒ½ 280ã€å¦‚æœé™åˆ¶åªèƒ½åœ¨window å†…è¿›è¡Œå»é‡ï¼Œæ•°æ®é‡è¿˜æ¯”è¾ƒå¤§ï¼Œæœ‰ä»€ä¹ˆå¥½çš„æ–¹æ³•å—ï¼Ÿ 281ã€ç«¯åˆ°ç«¯exactly onceæœ‰æ²¡æœ‰å‡ºæ–‡ç«  282ã€æµæ€ä¹ˆåŠ¨æ€åŠ ï¼Ÿï¼Œæµæ€ä¹ˆåŠ¨æ€åˆ é™¤ï¼Ÿï¼Œå‚æ•°æ€ä¹ˆåŠ¨æ€ä¿®æ”¹ ï¼ˆå¹¿æ’­ 283ã€è‡ªå®šä¹‰çš„sourceæ•°æ®æºå®ç°äº†æœ‰æ‰¹æ¬¡çš„æ¦‚å¿µï¼Œç„¶åFlinkå°†è¿™ä¸ªä¸€ä¸ªæ‰¹æ¬¡æµæ³¨å†Œä¸ºå¤šä¸ªè¡¨joinæ“ä½œï¼Œæœ‰åŠæ³•çŸ¥é“è¿™ä¸ªsqlä»€ä¹ˆæ—¶å€™è®¡ç®—å®Œæˆäº†ï¼Ÿ 284ã€ç¼–è¯‘ Flink æŠ¥é”™ï¼Œç¾¤ä¸»é‡åˆ°è¿‡æ²¡ï¼Œä»€ä¹ˆåŸå›  285ã€[æˆ‘ç°åœ¨æ˜¯flink on yarnç”¨zookeeperåšHAç°åœ¨åœ¨zké‡ŒæŸ¥çœ‹æ£€æŸ¥ç‚¹ä¿¡æ¯ï¼Œä¸ºä»€ä¹ˆé‡Œé¢çš„æ–‡ä»¶æ˜¯ipï¼Œè€Œä¸æ˜¯è·¯å¾„å‘¢ï¼Ÿæˆ‘è¯¥å¦‚ä½•æ‹¿åˆ°é‚£ä¸ªè·¯å¾„ã€‚ - æ’é™¤rest api æ–¹å¼è·å–ï¼Œå› ä¸ºä»»åŠ¡å…³äº†restapiå°±æ²¡äº† -æ’é™¤history serverï¼Œæœ‰ç‚¹ä¸å¥½ç”¨](https://t.zsxq.com/nufIaey) 286ã€åœ¨ä½¿ç”¨streamfilesinkæ¶ˆè´¹kafkaä¹‹åè¿›è¡Œhdfså†™å…¥çš„æ—¶å€™ï¼Œå½“ç›´æ¥å…³é—­flinkç¨‹åºçš„æ—¶å€™ï¼Œä¸‹æ¬¡å†å¯åŠ¨ç¨‹åºæ¶ˆè´¹å†™å…¥hdfsçš„æ—¶å€™ï¼Œæ–‡ä»¶åˆæ˜¯ä»part-0-0å¼€å§‹ï¼Œè¿™æ ·å°±è·ŸåŸæ¥å†™å…¥çš„å†²çªäº†ï¼Œè¯¥æ–‡ä»¶å°±ä¸€ç›´å¤„äºingressçŠ¶æ€ã€‚ 287ã€ç°åœ¨æœ‰ä¸€ä¸ªå®æ—¶æ•°æ®åˆ†æçš„éœ€æ±‚ï¼Œæ•°æ®é‡ä¸å¤§ï¼Œä½†è¦æ±‚sinkåˆ°mysqlï¼Œå› ä¸ºæ˜¯å®æ—¶æ›´æ–°çš„ï¼Œæˆ‘ç°åœ¨èƒ½æƒ³åˆ°çš„å¤„ç†æ–¹æ³•å°±æ˜¯æ¯æ¬¡æ’å…¥ä¸€æ¡æ•°æ®çš„æ—¶å€™ï¼Œå…ˆä»mysqlè¯»æ•°æ®ï¼Œå¦‚æœæœ‰è¿™æ¡ï¼Œå°±æ‰§è¡Œupdateï¼Œæ²¡æœ‰çš„è¯å°±insertï¼Œä½†æ˜¯è¿™æ ·çš„è¯æ¯å†™ä¸€æ¡æ•°æ®å°±æœ‰ä¸¤æ¬¡äº¤äº’äº†ã€‚æƒ³é—®ä¸€ä¸‹è€å¸ˆæœ‰æ²¡æœ‰æ›´å¥½çš„åŠæ³•ï¼Œæˆ–è€…flinkæœ‰æ²¡æœ‰å†…ç½®çš„apiå¯ä»¥æ‰§è¡Œè¿™ç§ä¸ç¡®å®šæ˜¯æ›´æ–°è¿˜æ˜¯æ’å…¥çš„æ“ä½œ 288ã€Flinkè®¾ç½®äº†checkpointï¼Œjob manageä¼šå®šæœŸåˆ é™¤check pointæ•°æ®ï¼Œä½†æ˜¯task manageä¸åˆ é™¤ï¼Œè¿™ä¸ªæ˜¯ä»€ä¹ˆåŸå›  289ã€è¯·æ•™ä¸€ä¸‹ä½¿ç”¨rocksdbä½œä¸ºstatebackend ï¼Œåœ¨å“ªé‡Œå¯ä»¥ç›‘æ§rocksdb io å†…å­˜æŒ‡æ ‡å‘¢ 290ã€çŠ¶æ€çš„ä½¿ç”¨åœºæ™¯ï¼Œä»¥åŠç”¨æ³•èƒ½å‡ºä¸ªæ–‡ç« ä¸ï¼Œè¿™å—ä¸å¤ªäº†è§£ 291ã€è¯·é—®ä¸€ä¸‹ Flink 1.9 SQL APIä¸­distinct count æ˜¯å¦‚ä½•å®ç°é«˜æ•ˆçš„æµå¼å»é‡çš„ï¼Ÿ 292ã€åœ¨ç®—å­å†…å¦‚ä½•è·å–å½“å‰ç®—å­å¹¶è¡Œåº¦ä»¥åŠå½“å‰æ˜¯ç¬¬å‡ ä¸ªtask 293ã€æœ‰æ²¡æœ‰flink1.9ç»“åˆhiveçš„demoã€‚kafkaåˆ°hive 294ã€èƒ½ç»™è®²è®²apache calciteå— 295ã€è¯·é—®ä¸€ä¸‹åƒè¿™ç§çª—å£æ“ä½œï¼Œæ€ä¹ˆä¿è¯ç¨‹åºå¼‚å¸¸é‡å¯åä¿æŒæ•°æ®çš„çŠ¶æ€å‘¢ï¼Ÿ 296ã€è¯·é—®ä¸€ä¸‹ï¼Œæˆ‘åœ¨ä½¿ç”¨kafkasourceçš„æ—¶å€™ï¼ŒæŠŠæ¥è¿‡æ¥çš„Jsonstrè½¬åŒ–æˆè‡ªå®šä¹‰çš„ä¸€ä¸ªç±»å‹ï¼Œç”¨çš„æ˜¯gson. fromJsonï¼ˆjsonstr,classOf[Entity]ï¼‰æŠ¥å›¾ç‰‡ä¸Šçš„é”™è¯¯äº†ï¼Œä¸çŸ¥é“æ€ä¹ˆè§£å†³ï¼Œåœ¨ä¸è½¬ç›´æ¥æ‰“å°çš„æƒ…å†µä¸‹æ˜¯æ²¡é—®é¢˜çš„ 297ã€DataStreamè¯»æ•°æ®åº“çš„è¡¨ï¼Œåšå¤šè¡¨joinï¼Œèƒ½è®¾ç½®æ—¶é—´çª—å£ä¹ˆï¼Œä¸€å¤©å»åˆ·ä¸€æ¬¡ã€‚æµç¨‹åºä¼šä¸€ç›´æ‹‰æ•°æ®ï¼Œæ•°æ®åº“æ‰›ä¸ä½äº† 298ã€è¯·é—®ä¸€ä¸‹flinkæ”¯æŒå¤šè·¯å¾„é€šé…è¯»å–å—ï¼Ÿä¾‹å¦‚è·¯å¾„ï¼šs3n://pekdc2-deeplink-01/Kinesis/firehose/2019/07/03// ï¼Œé€šé…è¯»å–æ‰¾ä¸åˆ°è·¯å¾„ã€‚æ˜¯å¦éœ€è¦ç‰¹æ®Šè®¾ç½® 299ã€flink yarnç¯å¢ƒéƒ¨ç½² ä½†æ˜¯æŠŠå®¹å™¨çš„urlåœ°å€åˆ é™¤ã€‚å°±ä¼šè·³è½¬åˆ°çš„hadoopçš„é¦–é¡µã€‚æ€ä¹ˆå±è”½hadoopçš„yarné¦–é¡µåœ°å€å‘¢ï¼Ÿè¦ä¸æš´éœ²è¿™ä¸ªåœ°å€ç”¨æˆ·èƒ½çœ‹åˆ°æ‰€æœ‰ä»»åŠ¡å¾ˆå±é™© 300ã€flink sqlæ€ä¹ˆå†™ä¸€ä¸ªæµï¼Œæ¯ç§’è¾“å‡ºå½“å‰æ—¶é—´å‘¢ 301ã€å› ä¸ºæƒ³é€šè¿‡sqlå¼„ä¸€ä¸ªæ•°æ®æµã€‚å“ˆå“ˆ å¦å¤–æƒ³é—®ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘æŠŠå…¨å±€è®¾ç½®ä¸ºæ ¹æ®å¤„ç†æ—¶é—´çš„æ—¶é—´çª—å£ï¼Œé‚£ä¹ˆæˆ‘åœ¨processAllWindowFunctioné‡Œé¢è¦æ€ä¹ˆçŸ¥é“è¿›æ¥çš„æ¯ä¸ªå…ƒç´ çš„å¤„ç†æ—¶é—´æ˜¯å¤šå°‘å‘¢ï¼Ÿè¿™ä¸ªå…ƒç´ è¿›å…¥è¿™ä¸ªæ—¶é—´çª—å£çš„ä¾æ®æ˜¯ä»€ä¹ˆ 302ã€å¦‚ä½•å®ç°ä¸€ä¸ªè®¾å¤‡ä¸ŠæŠ¥çš„æ•°æ®å­˜å‚¨åˆ°åŒä¸€ä¸ªhdfsæ–‡ä»¶ä¸­ï¼Ÿ 303ã€æˆ‘è‡ªå·±å†™çš„kafkaç”Ÿäº§è€…æµ‹è¯•ï¼Œæ•°æ®æ ¼å¼ååˆ†ç®€å•ï¼ˆkey,iï¼‰keyæ˜¯ä¸€ä¸ªå›ºå®šçš„ä¸å˜çš„å­—ç¬¦ä¸²ï¼Œiæ˜¯è‡ªå¢çš„ï¼Œflink consumerè¿™è¾¹æˆ‘å¼€äº†checkpoint. å¹¶ä¸”æ˜¯exactly onceï¼Œç„¶åç¨‹åºå¾ˆç®€å•ï¼Œå°±æ˜¯flinkè¯»å–kafkaçš„æ•°æ®ç„¶åç›´æ¥æ‰“å°å‡ºæ¥ï¼Œæˆ‘å‘ç°æ¯”å¦‚æˆ‘çœ‹åˆ°æ‰“å°åˆ°keyï¼Œ10çš„æ—¶å€™æˆ‘ç›´æ¥å…³æ‰ç¨‹åºï¼Œç„¶åé‡æ–°å¯åŠ¨ç¨‹åºï¼ŒæŒ‰ç†æ¥è¯´åº”å½“æ˜¯ä»ä¸Šæ¬¡çš„offsetç»§ç»­æ¶ˆè´¹ï¼Œä¹Ÿå°±æ˜¯key,11ï¼Œä½†å®é™…ä¸Šæˆ‘çœ‹åˆ°çš„å¯èƒ½æ˜¯ä»keyï¼Œ9å¼€å§‹ï¼Œç„¶åä¾æ¬¡é€’å¢ï¼Œè¿™æ˜¯æ˜¯ä¸æ˜¯è¯´æ˜æ˜¯é‡å¤æ¶ˆè´¹äº†ï¼Œé‚£exactly oneéœ€è¦æ€ä¹ˆæ ·å»ä¿éšœï¼Ÿ 304ã€å‡è®¾æœ‰ä¸€ä¸ªæ•°æ®æºåœ¨æºæºä¸æ–­çš„äº§ç”Ÿæ•°æ®ï¼Œåˆ°Flinkçš„åå‹æ¥åˆ°sourceç«¯çš„æ—¶å€™ï¼Œç”±äºFlinkå¤„ç†æ•°æ®çš„é€Ÿåº¦è·Ÿä¸ä¸Šæ•°æ®æºäº§ç”Ÿæ•°æ®çš„é€Ÿåº¦ï¼Œ é—®é¢˜1: è¿™ä¸ªæ—¶å€™åœ¨Flinkçš„sourceç«¯ä¼šæ€ä¹ˆå¤„ç†å‘¢ï¼Ÿæ˜¯å°†å¤„ç†ä¸å®Œçš„æ•°æ®ä¸¢å¼ƒè¿˜æ˜¯è¿›è¡Œç¼“å­˜å‘¢ï¼Ÿ é—®é¢˜2: å¦‚æœæ˜¯ç¼“å­˜ï¼Œæ€ä¹ˆè¿›è¡Œç¼“å­˜å‘¢ï¼Ÿ 305ã€ä¸€ä¸ªstream åœ¨sinkå¤šä¸ªæ—¶ï¼Œè¿™å¤šä¸ªsinkæ˜¯ä¸²è¡Œ è¿˜æ˜¯å¹¶è¡Œçš„ã€‚ 306ã€æˆ‘æƒ³åœ¨æµä¸Šåšä¸€ä¸ªçª—å£ï¼Œè§¦å‘çª—å£çš„æ¡ä»¶æ˜¯å›ºå®šçš„æ—¶é—´é—´éš”æˆ–è€…æ•°æ®é‡è¾¾åˆ°é¢„åˆ‡å€¼ï¼Œä¸¤ä¸ªæ¡ä»¶åªè¦æœ‰ä¸€ä¸ªæ»¡è¶³å°±è§¦å‘ï¼Œé™¤äº†é‡å†™triggeråœ¨ï¼Œè¿˜æœ‰ä»€ä¹ˆåˆ«çš„æ–¹æ³•å—ï¼Ÿ 307ã€ä½¿ç”¨rocksdbä½œä¸ºçŠ¶æ€åç«¯ï¼Œå¯¹äºä½¿ç”¨sqlæ–¹å¼å¯¹æ—¶é—´å­—æ®µè¿›è¡Œgroup byï¼Œä»¥è¾¾åˆ°å»çª—å£åŒ–ï¼Œä½†æ˜¯è¿™æ ·æ²¡åŠæ³•å¯¹ä¹‹å‰çš„æ•°æ®æ¸…ç†ï¼Œå¯¼è‡´ç£ç›˜ç©ºé—´å¾ˆå¤§ï¼Œå¯¹äºè¿™ç§éç¼–ç æ–¹å¼ï¼Œæœ‰ä»€ä¹ˆåŠæ³•è®¾ç½®ttlï¼Œæ¸…ç†ä»¥å‰çš„æ•°æ®å— 308ã€è¯·é—®ä»€ä¹ˆæ—¶é—´çª—ä¸ºä»€ä¹ˆä¼šæœ‰TimeWindow{start=362160000, end=362220000} å’Œ TimeWindow{start=1568025300000, end=1568025360000}è¿™ä¸¤ç§å½¢å¼ï¼Œæˆ‘éƒ½ç”¨çš„æ˜¯ä¸€åˆ†é’Ÿçš„TumblingEventTimeWindowsï¼Œä¸ºä»€ä¹ˆä¼šå‡ºç°ä¸åŒçš„æƒ…å†µï¼Ÿ 309ã€æ¯”å¦‚æˆ‘ç»Ÿè®¡ä¸€å¤©çš„è®¢å•é‡ã€‚ä½†æ˜¯æŸä¸ªæ•°æ®å»¶è¿Ÿä¸€å¤©æ‰åˆ°è¾¾ã€‚æ¯”å¦‚2019.08.01è¿™ä¸€å¤©è®¢å•é‡åº”è¯¥æ˜¯1000ï¼Œä½†æ˜¯æœ‰ä¸ª100çš„å•æ®è¿Ÿåˆ°äº†ï¼Œåœ¨2019.08.02æ‰åˆ°è¾¾ï¼Œé‚£ä¹ˆå¯¼è‡´2019.08.01è¿™ä¸€å¤©ç»Ÿè®¡çš„æ˜¯900.åé¢æ€ä¹ˆçº æ­£è¿™ä¸ªé”™è¯¯çš„ç»“æœå‘¢ 310ã€flink streaming æ¨¡å¼ä¸‹åªä½¿ç”¨å †å†…å†…å­˜ä¹ˆ 311ã€å¦‚æœè€ƒè™‘åˆ°é›†ç¾¤çš„è¿ç§»ï¼ŒçŠ¶æ€èƒ½è¿ç§»å— 312ã€æˆ‘ä»¬ç°åœ¨æœ‰ä¸€ä¸ªä¸šåŠ¡åœºæ™¯ï¼Œæ•°æ®ä¸ŠæŠ¥çš„å€¼æ˜¯è¿™æ ·çš„æ ¼å¼ï¼ˆæ—¶é—´ï¼Œç´¯åŠ å€¼ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦è¿™æ ·çš„æ ¼å¼æ•°æ®ï¼ˆæ—¶é—´ï¼Œå½“å‰å€¼ï¼‰ã€‚å½“å‰å€¼=ç´¯åŠ å€¼-å‰ä¸€ä¸ªæ•°æ®çš„ç´¯åŠ å€¼ã€‚flinkå¦‚ä½•åšåˆ°å‘¢ï¼Œæœ‰è€ƒè™‘è¿‡stateæœºåˆ¶ï¼Œä½†æ˜¯æœåŠ¡å®•æœºåï¼Œstateå°±è¢«æ¸…ç©ºäº† 313ã€Flink On k8s ä¸ Flink on Yarnç›¸æ¯”çš„ä¼˜ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿé‚£ä¸ªæ›´é€‚åˆåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨å‘¢ 314ã€æœ‰æ²¡æœ‰datahubé“¾æ¥flinkçš„ è¿æ¥å™¨å‘€ 315ã€å•ç‚¹resourcemanager æŒ‚äº†ï¼Œå¯¹ä»»åŠ¡ä¼šäº§ç”Ÿä»€ä¹ˆå½±å“å‘¢ 316ã€flinkç›‘æ§binlog,è·Ÿå¦ä¸€å¼ ç»´è¡¨åšjoinåï¼Œsinkåˆ°MySQLçš„æœ€ç»ˆè¡¨ã€‚å¯¹äºæœ€ç»ˆè¡¨çš„å¢åˆ æ”¹æ“ä½œï¼Œéœ€è¦å®šä¹‰ä¸åŒçš„sinkä¹ˆï¼Ÿ 317ã€è¯·é—®çª—å£æ˜¯åœ¨ä»€ä¹ˆæ—¶å€™åˆå¹¶çš„å‘¢ï¼Ÿä¾‹å¦‚ï¼šæ•°æ®è¿›å…¥windowoperatorçš„processElementï¼Œå¦‚æœä¸æ˜¯sessionwindowï¼Œæ˜¯å¦ä¼šè¿›è¡Œçª—å£åˆå¹¶å‘¢ï¼Ÿ 318ã€Flinkä¸­ä¸€æ¡æµèƒ½å‚ä¸å¤šè·¯è®¡ç®—ï¼Œå¹¶å¤šå¤„è¾“å‡ºå—ï¼Ÿä»–ä»¬ä¹‹å‰ä¼šä¸ä¼šç›¸äº’å½±å“ï¼Ÿ 319ã€keyByç®—å­å®šä¹‰æ˜¯å°†ä¸€ä¸ªæµæ‹†åˆ†æˆä¸ç›¸äº¤çš„åˆ†åŒºï¼Œæ¯ä¸ªåˆ†åŒºåŒ…å«å…·æœ‰ç›¸åŒçš„keyçš„å…ƒç´ ã€‚æˆ‘ä¸æ˜ç™½çš„åœ°æ–¹æ˜¯: keyByæ€ä¹ˆè®¾ç½®åˆ†åŒºæ•°ï¼Œæ˜¯ç»™è¿™ä¸ªç®—å­è®¾ç½®å¹¶è¡Œåº¦å—ï¼Ÿ åˆ†åŒºæ•°å’Œslotæ•°é‡æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ 320ã€åŠ¨æ€cep-patternï¼Œèƒ½å¦è¯¦ç»†è¯´ä¸‹ï¼Ÿæ»´æ»´æ–¹æ¡ˆæœªå…¬å¸ƒï¼Œæ‚¨è´´å‡ºæ¥çš„å‡ å¼ å›¾ç‰‡æ˜¯åŸºäº1.7çš„ã€‚æˆ–è€…æœ‰ä»€ä¹ˆæƒ³æ³•ä¹Ÿå¯ä»¥è®²è§£ä¸‹ï¼Œè°¢è°¢äº† 321ã€é—®é¢˜1ï¼šä½¿ç”¨å¸¸é©»å‹session ./bin/yarn-session.sh -n 10 -s 3 -då¯åŠ¨ï¼Œè¿™ä¸ªæ—¶å€™åˆ†é…çš„èµ„æºæ˜¯yarn é˜Ÿåˆ—é‡Œé¢çš„, flinkæäº¤ä»»åŠ¡ flink run xx.jar, å…¶ä½™æœºå™¨æ˜¯æ€æ ·è·å–åˆ°flinkéœ€è¦è¿è¡Œæ—¶çš„ç¯å¢ƒçš„ï¼Œå› ä¸ºæˆ‘åªåœ¨é›†ç¾¤çš„ä¸€å°æœºå™¨ä¸Šæœ‰flink å®‰è£…åŒ…ã€‚ 322ã€flink task managerä¸­sloté—´çš„å†…å­˜éš”ç¦»ï¼Œcpuéš”ç¦»æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿflink è®¾è®¡slotçš„æ¦‚å¿µæœ‰ä»€ä¹ˆæ„ä¹‰ï¼Œä¸ºä»€ä¹ˆä¸åƒspark executoré‚£æ ·ï¼Œå†…éƒ¨æ²¡æœ‰åšéš”ç¦»ï¼Ÿ 323ã€sparkå’Œkafkaé›†æˆï¼Œdirectæ¨¡å¼ï¼Œsparkçš„ä¸€ä¸ªåˆ†åŒºå¯¹åº”kafkaçš„ä¸€ä¸ªä¸»é¢˜çš„ä¸€ä¸ªåˆ†åŒºã€‚é‚£flinkå’Œkafkaé›†æˆçš„æ—¶å€™ï¼Œæ€ä¹ˆæ¶ˆè´¹kafkaçš„æ•°æ®ï¼Œå‡è®¾kafkaæŸä¸ªä¸»é¢˜5ä¸ªpartition 324ã€./bin/flink run -m yarn-cluster æ‰§è¡Œçš„flink job ï¼Œä½œä¸šè‡ªå·±æ‰“å°çš„æ—¥å¿—é€šè¿‡yarn applicationçš„logæŸ¥çœ‹ä¸äº†ï¼Œåªæœ‰é›†ç¾¤è‡ªèº«çš„æ—¥å¿—ï¼Œç¨‹åºä¸­logger.infoæ‰“å°æ—¥å¿—å­˜æ”¾åœ¨å“ªï¼Œè¿˜æ˜¯æˆ‘æ‰“åŒ…çš„æ–¹å¼é—®é¢˜ï¼Œæ‰“æ—¥å¿—ç”¨çš„æ˜¯slf4jã€‚ 325ã€åœ¨ç‰©è”ç½‘å¹³å°ä¸­ï¼Œéœ€è¦å¯¹æ¯ä¸ªkeyä¸‹çš„æ•°æ®åšè¶Šé™åˆ¤æ–­ï¼Œç”±äºæ¯ä¸ªkeyçš„è¶Šé™å€¼æ˜¯ä¸åŒçš„ï¼Œè¶Šé™å€¼é…ç½®åœ¨å®æ—¶æ•°æ®åº“ä¸­ã€‚ è‹¥å°†è¶Šé™å€¼åŠ è½½åˆ°stateä¸­ï¼Œç”±äºkeyçš„é‡å¾ˆå¤§ï¼ˆå¤§æ¦‚3äº¿å·¦å³ï¼‰ï¼Œä¼šå¯¼è‡´stateå¤ªå¤§ï¼Œå¯èƒ½é€ æˆå†…å­˜æº¢å‡ºã€‚è‹¥åœ¨å¤„ç†æ•°æ®æ—¶ä»å®æ—¶æ•°æ®åº“ä¸­è¯»å–è¶Šé™å€¼ï¼Œç”±äºç½‘ç»œIOå¼€é”€ï¼Œå¯èƒ½é€ æˆå®æ—¶æ€§ä¸‹é™ã€‚è¯·é—®è¯¥å¦‚ä½•å¤„ç†ï¼Ÿè°¢è°¢ 326ã€å¦‚æœæˆ‘ä¸€ä¸ªflinkç¨‹åºæœ‰å¤šä¸ªwindowæ“ä½œï¼Œæ—¶é—´æˆ³å’Œwatermarkæ˜¯ä¸æ˜¯æ¯ä¸ªwindowéƒ½éœ€è¦åˆ†é…ï¼Œè¿˜æœ‰å°±æ˜¯äº‹ä»¶æ—¶é—´æ˜¯ä¸æ˜¯ä¸€å®šè¦åœ¨æ•°æ®æºä¸­å°±å­˜åœ¨æŸä¸ªå­—æ®µ 327ã€æœ‰æ²¡æœ‰flink1.9åˆšæ”¯æŒçš„ç”¨ddlé“¾æ¥kafkaå¹¶å†™å…¥hbaseçš„èµ„æ–™ï¼Œæˆ‘ä»¬å…¬å¸æƒ³æŠŠç¦»çº¿çš„æ•°ä»“é€æ¸è½¬æˆå®æ—¶çš„ï¼Œå†™sqlå¯¹äºæˆ‘ä»¬æ¥è¯´ä¸Šæ‰‹æ›´å¿«ä¸€äº›ï¼Œå°±æƒ³æ‰¾ä¸€äº›è¿™æ–¹é¢çš„èµ„æ–™å­¦ä¹ ä¸€ä¸‹ã€‚ 328ã€flink1.9 è¿›è¡Œäº†æ•°æ®ç±»å‹çš„è½¬åŒ–æ—¶å‘ç”Ÿäº†ä¸åŒ¹é…çš„é—®é¢˜ï¼Œ ç›®å‰ä½¿ç”¨çš„Typeè¢«å¼ƒç”¨ï¼Œæ¨èä½¿ç”¨æ˜¯datatypes ç±»å‹ï¼Œä½†æ˜¯ä¹‹å‰ä½¿ç”¨çš„Typeç±»å‹çš„æ–¹æ³• å¯¹åº”çš„schema typeinformation ç›®å‰è·Ÿdatatypesçš„è¿”å›å€¼ä¸å¯¹åº”ï¼Œè¯·é—®ä¸‹ è¯¥æ€ä¹ˆå»è°ƒæ•´é€‚é…ï¼Ÿ 329ã€linkä¸­å¤„ç†æ•°æ®å…¶ä¸­ä¸€æ¡å‡ºäº†å¼‚å¸¸éƒ½ä¼šå¯¼è‡´æ•´ä¸ªjobæŒ‚æ‰?æœ‰æ²¡æœ‰æ–¹æ³•(é™¤äº†å¼‚å¸¸æ•è·)è®©è¿™æ¡æ•°æ®è®°å½•é”™è¯¯æ—¥å¿—å°±è¡Œ ä¸‹é¢çš„æ•°æ®æ¥ç€å¤„ç†å‘¢? ç²—ç•¥çœ‹è¿‡ä¸€äº›å®¹é”™å¤„ç†ï¼Œæ˜¯å…³äºç¨‹åº¦æŒ‚äº†é‡å¯åä»æ£€æŸ¥ç‚¹æ‹‰å–æ•°æ®ï¼Œä½†æ˜¯å¦‚æœè¿™æ¡æ•°æ®æœ¬èº«å°±é—®æ(ç‰¹åˆ«ç”Ÿäº§ä¸Šï¼Œè¿™æ ·å°±å¯¼è‡´jobç›´æ¥æŒ‚äº†ï¼Œå½±å“æœ‰ç‚¹å¤§)ï¼Œé‚£åº”è¯¥æ€ä¹ˆè¿‡æ»¤æ‰è¿™æ¡é—®é¢˜æ•°æ®å‘¢(å¼‚å¸¸æ•è·æ˜¯æœ€åçš„æ–¹æ³• 330ã€æˆ‘åœ¨ä¸€ä¸ªåšæ—¥æŠ¥çš„ç»Ÿè®¡ä¸­ä½¿ç”¨rabbitmqåšæ•°æ®æºï¼Œä¸ºä»€ä¹ˆrabbitmqä¸­çš„æ•°æ®ä¸€ç›´å¤„äºunackedçŠ¶æ€ï¼Œæ¯åˆ†é’Ÿè§¦å‘ä¸€æ¬¡çª—å£è®¡ç®—ï¼Œå¹¶é©±é€è®¡ç®—è¿‡çš„å…ƒç´ ï¼Œæˆ‘åœ¨æµ‹è¯•ç¯å¢ƒæ•°æ®éƒ½èƒ½ack,ä½†æ˜¯ä¸€åˆ°ç”Ÿäº§ç¯å¢ƒå°±ä¸è¡Œäº†ï¼Œä¹Ÿæ²¡æœ‰æŠ¥é”™ï¼Œæœ‰å¯èƒ½æ˜¯å“ªé‡Œå‡ºäº†é—®é¢˜å•Š 331ã€æˆ‘ä»¬ç›®å‰æ•°æ®æµå‘æ˜¯è¿™æ ·çš„ï¼Œkafka source ï¼Œetlï¼Œredis sink ã€‚è¿™æ ·chk æ˜¯å¦å¯ä»¥ä¿è¯ç«¯åˆ°ç«¯è¯­ä¹‰å‘¢ï¼Ÿ 332ã€1.åœ¨é€šè¿‡ yarn-session æäº¤ flink job çš„æ—¶å€™ã€‚flink-core, flink-clients, flink-scala, flink-streaming-scala, scala-library, flink-connector-kafka-0.10 é‚£äº›åº”è¯¥å†™ provided scopeï¼Œé‚£äº›åº”è¯¥å†™ compile scopeï¼Œæ‰æ˜¯æ­£ç¡®ã€é¿å…ä¾èµ–å†²çªçš„å§¿åŠ¿ï¼Ÿ 2.flink-dist_2.11-1.8.0.jar ç©¶ç«ŸåŒ…å«äº†å“ªäº›ä¾èµ–ï¼Ÿï¼ˆè¿™ä¸ªæ–‡ä»¶æ‰“åŒ…æ–¹å¼ä¸åŒäº springbootï¼Œæ— æ³•æ¸…æ¥šçœ‹åˆ°æœ‰å“ªäº› jar ä¾èµ–ï¼‰ 333ã€Flink ä¸­ä½¿ç”¨ count window ä¼šæœ‰è¿™æ ·çš„é—®é¢˜å°±æ˜¯ï¼Œæœ€åæœ‰éƒ¨åˆ†æ•°æ®ä¸€ç›´æ²¡æœ‰è¾¾åˆ° count çš„å€¼ï¼Œç„¶åçª—å£å°±ä¸€ç›´ä¸è§¦å‘ï¼Œè¿™é‡Œçœ‹åˆ°ä¸ªæ€è·¯ï¼Œå¯ä»¥å°† time window + count window ç»„åˆèµ·æ¥ 334ã€flinkæµå¤„ç†æ—¶ï¼Œæ³¨å†Œä¸€ä¸ªæµæ•°æ®ä¸ºTableåï¼Œè¯¥æµçš„å†å²æ•°æ®ä¹Ÿä¼šä¸€ç›´åœ¨Tableé‡Œé¢ä¹ˆï¼Ÿä¸ºä»€ä¹ˆæ¯æ¬¡æ¥æ–°æ•°æ®ï¼Œå†å²å¤„ç†è¿‡å¾—æ•°æ®ä¼šé‡æ–°è¢«æ‰§è¡Œï¼Ÿ 335ã€availableæ˜¯å˜åŒ–æ•°æ®ï¼Œé™¤äº†æœ€æ–°çš„æ•°æ®è¢«æ’å…¥æ•°æ®åº“ï¼Œä¹‹å‰å¤„ç†è¿‡æ•°æ®åˆé‡æ–°æ‰§è¡Œäº†å‡ æ¬¡ 336ã€è¿™é‡Œä¸¤å¤©åœ¨ç ”ç©¶flinkçš„å¹¿æ’­å˜é‡ï¼Œå‘ç°ä¸€ä¸ªé—®é¢˜ï¼ŒDataSetæ•°æ®é›†ä¸­è·å–å¹¿æ’­å˜é‡ï¼Œè·å–çš„å†…å­˜åœ°å€æ˜¯ä¸€æ ·çš„ï¼ˆä¸€å°æœºå™¨ç»´æŠ¤ä¸€ä¸ªå¹¿æ’­æ•°æ®é›†ï¼‰ã€‚åœ¨DataStreamä¸­è·å–å¹¿æ’­å˜é‡å°±æˆäº†ä¸€ä¸ªtaskç»´æŠ¤ä¸€ä¸ªæ•°æ®é›†ã€‚ï¼ˆå¯èƒ½æ˜¯æˆ‘ä½¿ç”¨æ–¹å¼æœ‰é—®é¢˜ï¼‰ æ‰€ä»¥æƒ³è¯·æ•™ä¸‹æ˜Ÿä¸»ï¼ŒDataStreamä¸­è·å–ä¸€ä¸ªç”»é¢å˜é‡å¯ä»¥å¦‚DataSetä¸­ä¸€å°æœºå™¨ç»´æŠ¤ä¸€ä¸ªæ•°æ®å—ï¼Ÿ 337ã€Flinkç¨‹åºå¼€å¯checkpoint æœºåˆ¶åï¼Œç”¨yarnå‘½ä»¤å¤šæ¬¡killedä»¥åï¼Œckeckpointç›®å½•ä¸‹æœ‰å¤šä¸ªjob idï¼Œå†æ¬¡å¼€è¾Ÿèµ„æºé‡æ–°å¯åŠ¨ç¨‹åºï¼Œç¨‹åºå¦‚ä½•æ‰¾åˆ°ä¸Šä¸€æ¬¡jobidç›®å½•ä¸‹ï¼Œè€Œä¸æ˜¯æ‰¾åˆ°å…¶ä»–çš„jobidç›®å½•ä¸‹ï¼Ÿé»˜è®¤æ˜¯æœ€åä¸€ä¸ªè¿˜æ˜¯éœ€è¦åˆ¶å®šç‰¹å®šçš„jobidï¼Ÿ 338ã€å‘å±•æ˜¨å¤©çš„æ•°æ®é‡å¤æ’å…¥é—®é¢˜ï¼Œæ˜¯æŠŠkafkaé‡Œè¿›æ¥çš„æ•°æ®æµregisterDataStreamæ³¨å†Œä¸ºTableåšjoinæ—¶ï¼Œæ‰“å°è¡¨çš„é•¿åº¦å‘ç°ï¼Œæ•°æ®ä¼šä¸€ç›´å¾€è¡¨é‡Œè¿½åŠ ï¼Œæ€æ ·æ‰èƒ½æ¥ä¸€æ¡å¤„ç†ä¸€æ¡ï¼Œä¸å¾€ä¸Šè¿½åŠ å‘€ 339ã€flink1.9 sql æœ‰æ²¡æœ‰ç±»ä¼¼åˆ†åŒºè¡¨é‚£æ ·çš„å¤„ç†æ–¹å¼å‘¢ï¼Ÿæˆ‘ä»¬ç°åœ¨æœ‰ä¸€ä¸ªä¸šåŠ¡æ˜¯1ä¸ªsourceï¼Œä½†æ˜¯è¦åˆ†åˆ«è®¡ç®—5åˆ†é’Ÿï¼Œ10åˆ†é’Ÿï¼Œ15åˆ†é’Ÿçš„æ•°æ®ã€‚ 340ã€æˆ‘åˆšå¼„äº†ä¸ªæœåŠ¡å™¨ï¼Œåœ¨å¯åŠ¨åŸºç¡€çš„å‘½ä»¤æ—¶å€™å‘ç°taskæ²¡æœ‰å¯åŠ¨èµ·æ¥ï¼Œå¯¼è‡´webé¡µæ˜¯ä¸‰ä¸ª0ï¼Œæˆ‘çœ‹äº†logä¹Ÿæ²¡æœ‰æŠ¥é”™ä¿¡æ¯ï¼Œè¯·é—®æ‚¨çŸ¥é“å¯èƒ½æ˜¯ä»€ä¹ˆé—®é¢˜å—ï¼Ÿ 241ã€æˆ‘è‡ªå®šä¹‰äº†ä¸ª Sink extends RichSinkFunctionï¼Œæœ‰äº† fieldï¼š private transient Object lock; è¿™ä¸ª lock æˆ‘ç›´æ¥åˆå§‹åŒ– private transient Object lock = new Object(); å°±ä¸è¡Œï¼Œåœ¨ invoke é‡Œ ä½¿ç”¨lockæ—¶ç©ºæŒ‡é’ˆï¼Œå¦‚æœlockåœ¨ è‡ªå®šä¹‰ Sink çš„ æ„é€ å™¨åˆå§‹åŒ–ä¹Ÿä¸è¡Œã€‚ä½†æ˜¯åœ¨ open æ–¹æ³•é‡Œåˆå§‹åŒ–å°±å¯ä»¥ï¼Œä¸ºä»€ä¹ˆï¼Ÿèƒ½è§£é‡Šä¸€ä¸‹ æ‰§è¡ŒåŸç†å—ï¼Ÿå¦‚æœä¸€ä¸ªslot è¿è¡Œç€5ä¸ª sinkå®ä¾‹ï¼Œé‚£ä¹ˆ è¿™ä¸ªsinkå¯¹è±¡ä¼šnew 5ä¸ªè¿˜æ˜¯1ä¸ªï¼Ÿ 342ã€è¯·é—®Kafkaçš„broker ä¸ªæ•°æ€ä¹ˆä¼°ç®—ï¼Ÿ 343ã€flink on yarnå¦‚ä½•è¿œç¨‹è°ƒè¯• 344ã€ç›®å‰æœ‰ä¸ªéœ€æ±‚ï¼šå°±æ˜¯æºæ•°æ®æ˜¯dataAã€dataBã€DataCé€šè¿‡kafkaä¸‰ä¸ªtopicè·å–ï¼Œç„¶åè¿›è¡Œåˆå¹¶ã€‚ ä½†æ˜¯æœ‰æœ‰å‡ ä¸ªé—®é¢˜ï¼Œç›®å‰ä¸çŸ¥é“æ€ä¹ˆè§£å†³ï¼š dataA=â€id:10001,info:,date:2019-08-01 12:23:33,entry1:1,entryInfo1:â€œ dataB=â€id:10001,org:,entry:1â€ dataC=â€id:10001,location:â€œ (1) å¦‚ä½•å°†ä¸‰ä¸ªæµåˆå¹¶ï¼Ÿ (1) æ•°æ®ä¸­dataAæ˜¯æœ‰æ—¶é—´çš„ï¼Œä½†æ˜¯dataBå’ŒdataCä¸­éƒ½æ²¡æœ‰æ—¶é—´æˆ³ï¼Œé‚£ä¹ˆå¦‚ä½•è§£å†³eventTimeåŠè¿Ÿåˆ°ä¹±åºçš„é—®é¢˜ï¼Ÿå¸®å¿™çœ‹ä¸‹ï¼Œè°¢è°¢ 345ã€æˆ‘flinkä»kafkaè¯»jsonæ•°æ®ï¼Œåœ¨ååºåˆ—åŒ–åä¸­æ–‡éƒ¨åˆ†å˜æˆäº†ä¸€ä¸²é—®å·ï¼Œè¯·é—®å¦‚ä½•åšæ‰èƒ½ä½¿ä¸­æ–‡æ­£å¸¸ 346ã€æˆ‘æœ‰å¥½å‡ ä¸ªFlinkç¨‹åºï¼ˆç‹¬ç«‹jarï¼‰ï¼Œåœ¨çº¿ä¸šåŠ¡æ•°æ®åˆ†ææ—¶éƒ½ä¼šç”¨åˆ°åŒæ ·çš„ä¸€æ‰¹MySQLä¸­çš„é…ç½®æ•°æ®(5åƒå¤šæ¡)ï¼Œç°åœ¨çš„å®ç°æ–¹æ³•æ˜¯æ¯ä¸€ä¸ªç¨‹åºéƒ½æ˜¯ç‹¬ç«‹æŠŠè¿™äº›é…ç½®æ•°æ®è£…åˆ°å†…å­˜ä¸­ï¼Œä¾¿äºå¿«é€Ÿä½¿ç”¨ï¼Œä½†ç°åœ¨æ„Ÿè§‰æœ‰äº›æµªè´¹èµ„æºå’Œç»“æ„ä¸å¤Ÿç¾è§‚ï¼Œè¯·é—®è¿™ç±»æƒ…å†µæœ‰ä»€ä¹ˆå…¶ä»–çš„è§£å†³æ–¹æ¡ˆå—ï¼Ÿè°¢è°¢ 347ã€Flink checkpoint é€‰ RocksDBStateBackend è¿˜æ˜¯ FsStatebackEnd ï¼Œæˆ‘ä»¬ç›®å‰æ˜¯ä»»åŠ¡æ‰§è¡Œä¸€æ®µæ—¶é—´ä¹‹å ä»»åŠ¡å°±ä¼šè¢«å¡æ­»ã€‚ 348ã€flink on k8sçš„é«˜å¯ç”¨ã€æ‰©ç¼©å®¹è¿™å—ç›®å‰è¿˜æœ‰å“ªäº›é—®é¢˜ï¼Ÿ 349ã€æœ‰ä¸ªé—®é¢˜é—®ä¸€ä¸‹ï¼Œæ˜¯è¿™æ ·çš„ç°åœ¨Kafka4ä¸ªåˆ†åŒºæ¯ç§’é’Ÿç”Ÿäº§4000å¤šåˆ°5000æ¡æ—¥å¿—æ•°æ®ï¼Œä½†æ˜¯åœ¨æ¶ˆè´¹è€…FLINKè¿™è¾¹æ¥æ”¶æˆ‘åªå¼€äº†4ä¸ªsoltæ¥æ”¶ï¼Œè¿™è¾¹åªæ˜¯æ¥æ”¶ååšåˆ‡åˆ†å­˜å‚¨ï¼Œç°åœ¨å‡ºç°äº†å»¶è¿Ÿç°è±¡ï¼Œæˆ‘ä¸æ¸…æ¥šæ˜¯æˆ‘è¿™è¾¹å¤„åˆ‡åˆ†æ…¢äº†è¿˜æ˜¯Flinkæ¥æ”¶kafkaçš„æ•°æ®æ…¢äº†ï¼ŸFlink UIç•Œé¢æ˜¾ç¤ºè¿™ä¸¤ä¸ªèƒŒå‹é«˜ ç­‰ç­‰ç­‰ï¼Œè¿˜æœ‰å¾ˆå¤šï¼Œå¤åˆ¶ç²˜è´´çš„æˆ‘æ‰‹ç´¯å•Š ğŸ˜‚ å¦å¤–é‡Œé¢è¿˜ä¼šåŠæ—¶åˆ†äº« Flink çš„ä¸€äº›æœ€æ–°çš„èµ„æ–™ï¼ˆåŒ…æ‹¬æ•°æ®ã€è§†é¢‘ã€PPTã€ä¼˜ç§€åšå®¢ï¼ŒæŒç»­æ›´æ–°ï¼Œä¿è¯å…¨ç½‘æœ€å…¨ï¼Œå› ä¸ºæˆ‘çŸ¥é“ Flink ç›®å‰çš„èµ„æ–™è¿˜ä¸å¤šï¼‰ å…³äºè‡ªå·±å¯¹ Flink å­¦ä¹ çš„ä¸€äº›æƒ³æ³•å’Œå»ºè®® Flink å…¨ç½‘æœ€å…¨èµ„æ–™è·å–ï¼ŒæŒç»­æ›´æ–°ï¼Œç‚¹å‡»å¯ä»¥è·å– å†å°±æ˜¯æ˜Ÿçƒç”¨æˆ·ç»™æˆ‘æçš„ä¸€ç‚¹è¦æ±‚ï¼šä¸å®šæœŸåˆ†äº«ä¸€äº›è‡ªå·±é‡åˆ°çš„ Flink é¡¹ç›®çš„å®æˆ˜ï¼Œç”Ÿäº§é¡¹ç›®é‡åˆ°çš„é—®é¢˜ï¼Œæ˜¯å¦‚ä½•è§£å†³çš„ç­‰ç»éªŒä¹‹è°ˆï¼ 1ã€å¦‚ä½•æŸ¥çœ‹è‡ªå·±çš„ Job æ‰§è¡Œè®¡åˆ’å¹¶è·å–æ‰§è¡Œè®¡åˆ’å›¾ 2ã€å½“å®æ—¶å‘Šè­¦é‡åˆ° Kafka åƒä¸‡æ•°æ®é‡å †ç§¯è¯¥å’‹åŠï¼Ÿ 3ã€å¦‚ä½•åœ¨æµæ•°æ®ä¸­æ¯”ä¸¤ä¸ªæ•°æ®çš„å¤§å°ï¼Ÿå¤šç§è§£å†³æ–¹æ³• 4ã€kafka ç³»åˆ—æ–‡ç«  5ã€Flinkç¯å¢ƒéƒ¨ç½²ã€åº”ç”¨é…ç½®åŠè¿è¡Œåº”ç”¨ç¨‹åº 6ã€ç›‘æ§å¹³å°è¯¥æœ‰æ¶æ„æ˜¯é•¿è¿™æ ·å­çš„ 7ã€ã€Šå¤§æ•°æ®â€œé‡ç£…ç‚¸å¼¹â€â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flinkã€‹ä¸“æ ç³»åˆ—æ–‡ç« ç›®å½•å¤§çº² 8ã€ã€Šå¤§æ•°æ®â€œé‡ç£…ç‚¸å¼¹â€â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flinkã€‹Chat ä»˜è´¹æ–‡ç«  9ã€Apache Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 10ã€Flink On K8s 11ã€Flink-metrics-core 12ã€Flink-metrics-datadog 13ã€Flink-metrics-dropwizard 14ã€Flink-metrics-graphite 15ã€Flink-metrics-influxdb 16ã€Flink-metrics-jmx 17ã€Flink-metrics-slf4j 18ã€Flink-metrics-statsd 19ã€Flink-metrics-prometheus 20ã€Flink æ³¨è§£æºç è§£æ 21ã€ä½¿ç”¨ InfluxDB å’Œ Grafana æ­å»ºç›‘æ§ Flink çš„å¹³å° 22ã€ä¸€æ–‡ææ‡‚Flinkå†…éƒ¨çš„Exactly Onceå’ŒAt Least Once 23ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—æ¡†æ¶ Flink å½“ç„¶ï¼Œé™¤äº†æ›´æ–° Flink ç›¸å…³çš„ä¸œè¥¿å¤–ï¼Œæˆ‘è¿˜ä¼šæ›´æ–°ä¸€äº›å¤§æ•°æ®ç›¸å…³çš„ä¸œè¥¿ï¼Œå› ä¸ºæˆ‘ä¸ªäººä¹‹å‰ä¸æ˜¯å¤§æ•°æ®å¼€å‘ï¼Œæ‰€ä»¥ç°åœ¨ä¹Ÿè¦ç‹‚è¡¥äº›çŸ¥è¯†ï¼æ€»ä¹‹ï¼Œå¸Œæœ›è¿›æ¥çš„ç«¥é‹ä»¬ä¸€èµ·å…±åŒè¿›æ­¥ï¼ 1ã€Java æ ¸å¿ƒçŸ¥è¯†ç‚¹æ•´ç†.pdf 2ã€å‡å¦‚æˆ‘æ˜¯é¢è¯•å®˜ï¼Œæˆ‘ä¼šé—®ä½ è¿™äº›é—®é¢˜ 3ã€Kafka ç³»åˆ—æ–‡ç« å’Œå­¦ä¹ è§†é¢‘ 4ã€é‡æ–°å®šä¹‰ Flink ç¬¬äºŒæœŸ pdf 5ã€GitChat Flink æ–‡ç« ç­”ç–‘è®°å½• 6ã€Java å¹¶å‘è¯¾ç¨‹è¦æŒæ¡çš„çŸ¥è¯†ç‚¹ 7ã€Lightweight Asynchronous Snapshots for Distributed Dataflows 8ã€Apache Flinkâ„¢- Stream and Batch Processing in a Single Engine 9ã€FlinkçŠ¶æ€ç®¡ç†ä¸å®¹é”™æœºåˆ¶ 10ã€Flink æµæ‰¹ä¸€ä½“çš„æŠ€æœ¯æ¶æ„ä»¥åŠåœ¨é˜¿é‡Œçš„å®è·µ 11ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 12ã€Flink æµæ‰¹ä¸€ä½“çš„æŠ€æœ¯æ¶æ„ä»¥åŠåœ¨é˜¿é‡Œçš„å®è·µ 13ã€Stream Processing with Apache Flink pdf 14ã€Flink ç»“åˆæœºå™¨å­¦ä¹ ç®—æ³•çš„ç›‘æ§å¹³å°å®è·µ 15ã€ã€Šå¤§æ•°æ®é‡ç£…ç‚¸å¼¹-å®æ—¶è®¡ç®—Flinkã€‹é¢„å¤‡ç¯‡â€”â€”å¤§æ•°æ®å®æ—¶è®¡ç®—ä»‹ç»åŠå…¶å¸¸ç”¨ä½¿ç”¨åœºæ™¯ pdf å’Œè§†é¢‘ 16ã€ã€Šå¤§æ•°æ®é‡ç£…ç‚¸å¼¹-å®æ—¶è®¡ç®—Flinkã€‹å¼€ç¯‡è¯ pdf å’Œè§†é¢‘ 17ã€å››æœ¬ Flink ä¹¦ 18ã€æµå¤„ç†ç³»ç»Ÿ çš„ç›¸å…³ paper 19ã€Apache Flink 1.9 ç‰¹æ€§è§£è¯» 20ã€æ‰“é€ åŸºäºFlink Table APIçš„æœºå™¨å­¦ä¹ ç”Ÿæ€ 21ã€åŸºäºFlink on Kubernetesçš„å¤§æ•°æ®å¹³å° 22ã€åŸºäºApache Flinkçš„é«˜æ€§èƒ½æœºå™¨å­¦ä¹ ç®—æ³•åº“ 23ã€Apache Flinkåœ¨å¿«æ‰‹çš„åº”ç”¨ä¸å®è·µ 24ã€Apache Flink-1.9ä¸Hiveçš„å…¼å®¹æ€§ 25ã€æ‰“é€ åŸºäºFlink Table APIçš„æœºå™¨å­¦ä¹ ç”Ÿæ€ 26ã€æµå¤„ç†ç³»ç»Ÿçš„ç›¸å…³ paper","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ç¾å›¢ç‚¹è¯„åŸºäº Flink çš„å®æ—¶æ•°ä»“å¹³å°å®è·µ","date":"2019-12-29T16:00:00.000Z","path":"2019/12/30/flink-meituan-real-time-warehouse/","text":"æ•°æ®ä»“åº“çš„å»ºè®¾æ˜¯â€œæ•°æ®æ™ºèƒ½â€å¿…ä¸å¯å°‘çš„ä¸€ç¯ï¼Œä¹Ÿæ˜¯å¤§è§„æ¨¡æ•°æ®åº”ç”¨ä¸­å¿…ç„¶é¢ä¸´çš„æŒ‘æˆ˜ï¼Œè€Œ Flink å®æ—¶æ•°ä»“åœ¨æ•°æ®é“¾è·¯ä¸­æ‰®æ¼”ç€æä¸ºé‡è¦çš„è§’è‰²ã€‚æœ¬æ–‡ä¸­ï¼Œç¾å›¢ç‚¹è¯„é«˜çº§æŠ€æœ¯ä¸“å®¶é²æ˜Šä¸ºå¤§å®¶åˆ†äº«äº†ç¾å›¢ç‚¹è¯„åŸºäº Apache Flink çš„å®æ—¶æ•°ä»“å¹³å°å®è·µã€‚ æœ¬æ–‡æˆæƒè½¬è‡ªç¤¾åŒºå…¬ä¼—å·ï¼ŒåŸæ–‡åœ°å€ ç›®å½•ï¼š ä¸€ã€ç¾å›¢ç‚¹è¯„å®æ—¶è®¡ç®—æ¼”è¿›ç¾å›¢ç‚¹è¯„å®æ—¶è®¡ç®—æ¼”è¿›å†ç¨‹åœ¨ 2016 å¹´ï¼Œç¾å›¢ç‚¹è¯„å°±å·²ç»åŸºäº Storm å®æ—¶è®¡ç®—å¼•æ“å®ç°äº†åˆæ­¥çš„å¹³å°åŒ–ã€‚2017 å¹´åˆï¼Œæˆ‘ä»¬å¼•å…¥äº† Spark Streaming ç”¨äºç‰¹å®šåœºæ™¯çš„æ”¯æŒï¼Œä¸»è¦æ˜¯åœ¨æ•°æ®åŒæ­¥åœºæ™¯æ–¹é¢çš„å°è¯•ã€‚åœ¨ 2017 å¹´åº•ï¼Œç¾å›¢ç‚¹è¯„å®æ—¶è®¡ç®—å¹³å°å¼•å…¥äº† Flinkã€‚ç›¸æ¯”äº Storm å’Œ Spark Streamingï¼ŒFlink åœ¨å¾ˆå¤šæ–¹é¢éƒ½å…·æœ‰ä¼˜åŠ¿ã€‚è¿™ä¸ªé˜¶æ®µæˆ‘ä»¬è¿›è¡Œäº†æ·±åº¦çš„å¹³å°åŒ–ï¼Œä¸»è¦å…³æ³¨ç‚¹æ˜¯å®‰å…¨ã€ç¨³å®šå’Œæ˜“ç”¨ã€‚ä» 19 å¹´å¼€å§‹ï¼Œæˆ‘ä»¬è‡´åŠ›äºå»ºè®¾åŒ…æ‹¬å®æ—¶æ•°ä»“ã€æœºå™¨å­¦ä¹ ç­‰ç‰¹å®šåœºæ™¯çš„è§£å†³æ–¹æ¡ˆæ¥ä¸ºä¸šåŠ¡æä¾›æ›´å¥½çš„æ”¯æŒã€‚ å®æ—¶è®¡ç®—å¹³å°ç›®å‰ï¼Œç¾å›¢ç‚¹è¯„çš„å®æ—¶è®¡ç®—å¹³å°æ—¥æ´»è·ƒä½œä¸šæ•°é‡ä¸ºä¸‡çº§ï¼Œé«˜å³°æ—¶ä½œä¸šå¤„ç†çš„æ¶ˆæ¯é‡è¾¾åˆ°æ¯ç§’ 1.5 äº¿æ¡ï¼Œè€Œæœºå™¨è§„æ¨¡ä¹Ÿå·²ç»è¾¾åˆ°äº†å‡ åƒå°ï¼Œå¹¶ä¸”æœ‰å‡ åƒä½ç”¨æˆ·æ­£åœ¨ä½¿ç”¨å®æ—¶è®¡ç®—æœåŠ¡ã€‚ å®æ—¶è®¡ç®—å¹³å°æ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºçš„æ˜¯ç¾å›¢ç‚¹è¯„å®æ—¶è®¡ç®—å¹³å°çš„æ¶æ„ã€‚ æœ€åº•å±‚æ˜¯æ”¶é›†å±‚ï¼Œè¿™ä¸€å±‚è´Ÿè´£æ”¶é›†ç”¨æˆ·çš„å®æ—¶æ•°æ®ï¼ŒåŒ…æ‹¬ Binlogã€åç«¯æœåŠ¡æ—¥å¿—ä»¥åŠ IoT æ•°æ®ï¼Œç»è¿‡æ—¥å¿—æ”¶é›†å›¢é˜Ÿå’Œ DB æ”¶é›†å›¢é˜Ÿçš„å¤„ç†ï¼Œæ•°æ®å°†ä¼šè¢«æ”¶é›†åˆ° Kafka ä¸­ã€‚è¿™äº›æ•°æ®ä¸åªæ˜¯å‚ä¸å®æ—¶è®¡ç®—ï¼Œä¹Ÿä¼šå‚ä¸ç¦»çº¿è®¡ç®—ã€‚ æ”¶é›†å±‚ä¹‹ä¸Šæ˜¯å­˜å‚¨å±‚ï¼Œè¿™ä¸€å±‚é™¤äº†ä½¿ç”¨ Kafka åšæ¶ˆæ¯é€šé“ä¹‹å¤–ï¼Œè¿˜ä¼šåŸºäº HDFS åšçŠ¶æ€æ•°æ®å­˜å‚¨ä»¥åŠåŸºäº HBase åšç»´åº¦æ•°æ®çš„å­˜å‚¨ã€‚ å­˜å‚¨å±‚ä¹‹ä¸Šæ˜¯å¼•æ“å±‚ï¼ŒåŒ…æ‹¬ Storm å’Œ Flinkã€‚å®æ—¶è®¡ç®—å¹³å°ä¼šåœ¨å¼•æ“å±‚ä¸ºç”¨æˆ·æä¾›ä¸€äº›æ¡†æ¶çš„å°è£…ä»¥åŠå…¬å…±åŒ…å’Œç»„ä»¶çš„æ”¯æŒã€‚ åœ¨å¼•æ“å±‚ä¹‹ä¸Šå°±æ˜¯å¹³å°å±‚äº†ï¼Œå¹³å°å±‚ä»æ•°æ®ã€ä»»åŠ¡å’Œèµ„æºä¸‰ä¸ªè§†è§’å»ç®¡ç†ã€‚ æ¶æ„çš„æœ€ä¸Šå±‚æ˜¯åº”ç”¨å±‚ï¼ŒåŒ…æ‹¬äº†å®æ—¶æ•°ä»“ã€æœºå™¨å­¦ä¹ ã€æ•°æ®åŒæ­¥ä»¥åŠäº‹ä»¶é©±åŠ¨åº”ç”¨ç­‰ã€‚ æœ¬æ¬¡åˆ†äº«ä¸»è¦ä»‹ç»å®æ—¶æ•°ä»“æ–¹é¢çš„å»ºè®¾æƒ…å†µã€‚ ä»åŠŸèƒ½è§’åº¦æ¥çœ‹ï¼Œç¾å›¢ç‚¹è¯„çš„å®æ—¶è®¡ç®—å¹³å°ä¸»è¦åŒ…æ‹¬ä½œä¸šå’Œèµ„æºç®¡ç†ä¸¤ä¸ªæ–¹é¢çš„åŠŸèƒ½ã€‚å…¶ä¸­ï¼Œä½œä¸šéƒ¨åˆ†åŒ…æ‹¬ä½œä¸šé…ç½®ã€ä½œä¸šå‘å¸ƒä»¥åŠä½œä¸šçŠ¶æ€ä¸‰ä¸ªæ–¹é¢çš„åŠŸèƒ½ã€‚ åœ¨ä½œä¸šé…ç½®æ–¹é¢ï¼Œåˆ™åŒ…æ‹¬ä½œä¸šè®¾ç½®ã€è¿è¡Œæ—¶è®¾ç½®ä»¥åŠæ‹“æ‰‘ç»“æ„è®¾ç½®ï¼› åœ¨ä½œä¸šå‘å¸ƒæ–¹é¢ï¼Œåˆ™åŒ…æ‹¬ç‰ˆæœ¬ç®¡ç†ã€ç¼–è¯‘/å‘å¸ƒ/å›æ»šç­‰ï¼› ä½œä¸šçŠ¶æ€åˆ™åŒ…æ‹¬è¿è¡Œæ—¶çŠ¶æ€ã€è‡ªå®šä¹‰æŒ‡æ ‡å’ŒæŠ¥è­¦ä»¥åŠå‘½ä»¤/è¿è¡Œæ—¶æ—¥å¿—ç­‰ã€‚ åœ¨èµ„æºç®¡ç†æ–¹é¢ï¼Œåˆ™ä¸ºç”¨æˆ·æä¾›äº†å¤šç§Ÿæˆ·èµ„æºéš”ç¦»ä»¥åŠèµ„æºäº¤ä»˜å’Œéƒ¨ç½²çš„èƒ½åŠ›ã€‚ ä¸šåŠ¡æ•°ä»“å®è·µ æµé‡ å‰é¢æåˆ°ï¼Œç°åœ¨çš„ç¾å›¢ç‚¹è¯„å®æ—¶è®¡ç®—å¹³å°æ›´å¤šåœ°ä¼šå…³æ³¨åœ¨å®‰å…¨ã€æ˜“ç”¨å’Œç¨³å®šæ–¹é¢ï¼Œè€Œåº”ç”¨ä¸Šå¾ˆå¤§çš„ä¸€ä¸ªåœºæ™¯å°±æ˜¯ä¸šåŠ¡æ•°ä»“ã€‚æ¥ä¸‹æ¥ä¼šä¸ºå¤§å®¶åˆ†äº«å‡ ä¸ªä¸šåŠ¡æ•°ä»“çš„ä¾‹å­ã€‚ ç¬¬ä¸€ä¸ªä¾‹å­æ˜¯æµé‡ï¼Œæµé‡æ•°ä»“æ˜¯æµé‡ç±»ä¸šåŠ¡çš„åŸºç¡€æœåŠ¡ï¼Œä»ä¸šåŠ¡é€šé“è€Œè¨€ï¼Œä¼šæœ‰ä¸åŒé€šé“çš„åŸ‹ç‚¹å’Œä¸åŒé¡µé¢çš„åŸ‹ç‚¹æ•°æ®ï¼Œé€šè¿‡æ—¥å¿—æ”¶é›†é€šé“ä¼šè¿›è¡ŒåŸºç¡€æ˜ç»†å±‚çš„æ‹†åˆ†ï¼ŒæŒ‰ç…§ä¸šåŠ¡ç»´åº¦åˆ’åˆ†ä¸åŒçš„ä¸šåŠ¡é€šé“ï¼Œå¦‚ç¾å›¢é€šé“ã€å¤–å–é€šé“ç­‰ã€‚ åŸºäºä¸šåŠ¡é€šé“è¿˜ä¼šè¿›è¡Œä¸€æ¬¡æ›´åŠ ç»†ç²’åº¦çš„æ‹†åˆ†ï¼Œæ¯”å¦‚æ›å…‰æ—¥å¿—ã€çŒœä½ å–œæ¬¢ã€æ¨èç­‰ã€‚ä»¥ä¸Šè¿™äº›åŒ…æ‹¬ä¸¤ç§ä½¿ç”¨æ–¹å¼ï¼Œä¸€ç§æ˜¯ä»¥æµçš„æ–¹å¼æä¾›ä¸‹æ¸¸å…¶ä»–ä¸šåŠ¡æ–¹ä½¿ç”¨ï¼Œå¦å¤–ä¸€æ–¹é¢å°±æ˜¯åšä¸€äº›æµé‡æ–¹é¢çš„å®æ—¶åˆ†æã€‚ ä¸‹å›¾ä¸­å³è¾¹æ˜¯æµé‡æ•°ä»“çš„æ¶æ„å›¾ï¼Œè‡ªä¸‹å‘ä¸Šåˆ†ä¸ºå››å±‚ï¼Œåˆ†åˆ«æ˜¯ SDK å±‚ï¼ŒåŒ…æ‹¬äº†å‰ç«¯ã€å°ç¨‹åºä»¥åŠ APP çš„åŸ‹ç‚¹ï¼›å…¶ä¸Šæ˜¯æ”¶é›†å±‚ï¼ŒåŸ‹ç‚¹æ—¥å¿—è½åœ°åˆ° Nginxï¼Œé€šè¿‡æ—¥å¿—æ”¶é›†é€šé“æ”¶åˆ° Kafka ä¸­ã€‚åœ¨è®¡ç®—å±‚ï¼Œæµé‡å›¢é˜ŸåŸºäº Storm èƒ½åŠ›å®ç°äº†ä¸Šå±‚çš„ SQL å°è£…ï¼Œå¹¶å®ç°äº† SQL åŠ¨æ€æ›´æ–°çš„ç‰¹æ€§ï¼Œåœ¨ SQL å˜æ›´æ—¶ä¸å¿…é‡å¯ä½œä¸šã€‚ å¹¿å‘Šå®æ—¶æ•ˆæœ è¿™é‡Œå†ä¸¾ä¸€ä¸ªåŸºäºæµé‡æ•°ä»“çš„ä¾‹å­-å¹¿å‘Šå®æ—¶æ•ˆæœéªŒè¯ã€‚ä¸‹å›¾ä¸­å·¦ä¾§æ˜¯å¹¿å‘Šå®æ—¶æ•ˆæœçš„å¯¹æ¯”å›¾ã€‚å¹¿å‘Šçš„æ‰“ç‚¹ä¸€èˆ¬åˆ†ä¸ºè¯·æ±‚ï¼ˆPVï¼‰æ‰“ç‚¹ã€SPVï¼ˆServer PVï¼‰æ‰“ç‚¹ã€CPVï¼ˆClient PVï¼‰æ›å…‰æ‰“ç‚¹å’Œ CPV ç‚¹å‡»æ‰“ç‚¹ï¼Œåœ¨æ‰€æœ‰æ‰“ç‚¹ä¸­éƒ½ä¼šåŒ…å«ä¸€ä¸ªæµé‡çš„ requestID å’Œå‘½ä¸­çš„å®éªŒè·¯å¾„ã€‚æ ¹æ® requestID å’Œå‘½ä¸­çš„å®éªŒè·¯å¾„å¯ä»¥å°†æ‰€æœ‰çš„æ—¥å¿—è¿›è¡Œ joinï¼Œå¾—åˆ°ä¸€ä¸ª request ä¸­éœ€è¦çš„æ‰€æœ‰æ•°æ®ï¼Œç„¶åå°†æ•°æ®å­˜å…¥ Durid ä¸­è¿›è¡Œåˆ†æï¼Œæ”¯æŒå®é™… CTRã€é¢„ä¼° CTR ç­‰æ•ˆæœéªŒè¯ã€‚ å³æ—¶é…é€ è¿™é‡Œåˆ—ä¸¾çš„å¦å¤–ä¸€ä¸ªä¸šåŠ¡æ•°ä»“å®è·µçš„ä¾‹å­æ˜¯å³æ—¶é…é€ã€‚å®æ—¶æ•°æ®åœ¨å³æ—¶é…é€çš„è¿è¥ç­–ç•¥ä¸Šå‘æŒ¥äº†é‡è¦ä½œç”¨ã€‚ä»¥é€è¾¾æ—¶é—´é¢„ä¼°ä¸ºä¾‹ï¼Œäº¤ä»˜æ—¶é—´è¡¡é‡çš„æ˜¯éª‘æ‰‹é€é¤çš„äº¤ä»˜éš¾åº¦ï¼Œæ•´ä¸ªå±¥çº¦æ—¶é—´åˆ†ä¸ºäº†å¤šä¸ªæ—¶é—´æ®µï¼Œé…é€æ•°ä»“ä¼šåŸºäº Storm åšç‰¹å¾æ•°æ®çš„æ¸…æ´—ã€æå–ï¼Œä¾›ç®—æ³•å›¢é˜Ÿè¿›è¡Œè®­ç»ƒå¹¶å¾—åˆ°æ—¶é—´é¢„ä¼°çš„ç»“æœã€‚è¿™ä¸ªè¿‡ç¨‹æ¶‰åŠåˆ°å•†å®¶ã€éª‘æ‰‹ä»¥åŠç”¨æˆ·çš„å¤šæ–¹å‚ä¸ï¼Œæ•°æ®çš„ç‰¹å¾ä¼šéå¸¸å¤šï¼Œæ•°æ®é‡ä¹Ÿä¼šéå¸¸å¤§ã€‚ æ€»ç»“ ä¸šåŠ¡å®æ—¶æ•°ä»“å¤§è‡´åˆ†ä¸ºä¸‰ç±»åœºæ™¯ï¼šæµé‡ç±»ã€ä¸šåŠ¡ç±»å’Œç‰¹å¾ç±»ï¼Œè¿™ä¸‰ç§åœºæ™¯å„æœ‰ä¸åŒã€‚ åœ¨æ•°æ®æ¨¡å‹ä¸Šï¼Œæµé‡ç±»æ˜¯æ‰å¹³åŒ–çš„å®½è¡¨ï¼Œä¸šåŠ¡æ•°ä»“æ›´å¤šæ˜¯åŸºäºèŒƒå¼çš„å»ºæ¨¡ï¼Œç‰¹å¾æ•°æ®æ˜¯ KV å­˜å‚¨ã€‚ ä»æ•°æ®æ¥æºåŒºåˆ†ï¼Œæµé‡æ•°ä»“çš„æ•°æ®æ¥æºä¸€èˆ¬æ˜¯æ—¥å¿—æ•°æ®ï¼›ä¸šåŠ¡æ•°ä»“çš„æ•°æ®æ¥æºæ˜¯ä¸šåŠ¡ binlog æ•°æ®ï¼›ç‰¹å¾æ•°ä»“çš„æ•°æ®æ¥æºåˆ™å¤šç§å¤šæ ·ã€‚ ä»æ•°æ®é‡è€Œè¨€ï¼Œæµé‡å’Œç‰¹å¾æ•°ä»“éƒ½æ˜¯æµ·é‡æ•°æ®ï¼Œæ¯å¤©ç™¾äº¿çº§ä»¥ä¸Šï¼Œè€Œä¸šåŠ¡æ•°ä»“çš„æ•°æ®é‡ä¸€èˆ¬æ¯å¤©ç™¾ä¸‡åˆ°åƒä¸‡çº§ã€‚ ä»æ•°æ®æ›´æ–°é¢‘ç‡è€Œè¨€ï¼Œæµé‡æ•°æ®æå°‘æ›´æ–°ï¼Œåˆ™ä¸šåŠ¡å’Œç‰¹å¾æ•°æ®æ›´æ–°è¾ƒå¤šã€‚æµé‡æ•°æ®ä¸€èˆ¬å…³æ³¨æ—¶åºå’Œè¶‹åŠ¿ï¼Œä¸šåŠ¡æ•°æ®å’Œç‰¹å¾æ•°æ®å…³æ³¨çŠ¶æ€å˜æ›´ã€‚ åœ¨æ•°æ®å‡†ç¡®æ€§ä¸Šï¼Œæµé‡æ•°æ®è¦æ±‚è¾ƒä½ï¼Œè€Œä¸šåŠ¡æ•°æ®å’Œç‰¹å¾æ•°æ®è¦æ±‚è¾ƒé«˜ã€‚ åœ¨æ¨¡å‹è°ƒæ•´é¢‘ç‡ä¸Šï¼Œä¸šåŠ¡æ•°æ®è°ƒæ•´é¢‘ç‡è¾ƒé«˜ï¼Œæµé‡æ•°æ®å’Œç‰¹å¾æ•°æ®è°ƒæ•´é¢‘ç‡è¾ƒä½ã€‚ äºŒã€åŸºäº Flink çš„å®æ—¶æ•°ä»“å¹³å°ä¸Šé¢ä¸ºå¤§å®¶ä»‹ç»äº†å®æ—¶æ•°ä»“çš„ä¸šåŠ¡åœºæ™¯ï¼Œæ¥ä¸‹æ¥ä¸ºå¤§å®¶ä»‹ç»å®æ—¶æ•°ä»“çš„æ¼”è¿›è¿‡ç¨‹å’Œç¾å›¢ç‚¹è¯„çš„å®æ—¶æ•°ä»“å¹³å°å»ºè®¾æ€è·¯ã€‚ ä¼ ç»Ÿæ•°ä»“æ¨¡å‹ä¸ºäº†æ›´æœ‰æ•ˆåœ°ç»„ç»‡å’Œç®¡ç†æ•°æ®ï¼Œæ•°ä»“å»ºè®¾å¾€å¾€ä¼šè¿›è¡Œæ•°æ®åˆ†å±‚ï¼Œä¸€èˆ¬è‡ªä¸‹è€Œä¸Šåˆ†ä¸ºå››å±‚ï¼šODSï¼ˆæ“ä½œæ•°æ®å±‚ï¼‰ã€DWDï¼ˆæ•°æ®æ˜ç»†å±‚ï¼‰ã€DWSï¼ˆæ±‡æ€»å±‚ï¼‰å’Œåº”ç”¨å±‚ã€‚å³æ—¶æŸ¥è¯¢ä¸»è¦é€šè¿‡ Prestoã€Hive å’Œ Spark å®ç°ã€‚ å®æ—¶æ•°ä»“æ¨¡å‹å®æ—¶æ•°ä»“çš„åˆ†å±‚æ–¹å¼ä¸€èˆ¬ä¹Ÿéµå®ˆä¼ ç»Ÿæ•°æ®ä»“åº“æ¨¡å‹ï¼Œä¹Ÿåˆ†ä¸ºäº† ODS æ“ä½œæ•°æ®é›†ã€DWD æ˜ç»†å±‚å’Œ DWS æ±‡æ€»å±‚ä»¥åŠåº”ç”¨å±‚ã€‚ä½†å®æ—¶æ•°ä»“æ¨¡å‹çš„å¤„ç†çš„æ–¹å¼å´å’Œä¼ ç»Ÿæ•°ä»“æœ‰æ‰€å·®åˆ«ï¼Œå¦‚æ˜ç»†å±‚å’Œæ±‡æ€»å±‚çš„æ•°æ®ä¸€èˆ¬ä¼šæ”¾åœ¨ Kafka ä¸Šï¼Œç»´åº¦æ•°æ®ä¸€èˆ¬è€ƒè™‘åˆ°æ€§èƒ½é—®é¢˜åˆ™ä¼šæ”¾åœ¨ HBase æˆ–è€… Tair ç­‰ KV å­˜å‚¨ä¸Šï¼Œå³å¸­æŸ¥è¯¢åˆ™å¯ä»¥ä½¿ç”¨ Flink å®Œæˆã€‚ å‡†å®æ—¶æ•°ä»“æ¨¡å‹åœ¨ä»¥ä¸Šä¸¤ç§æ•°ä»“æ¨¡å‹ä¹‹å¤–ï¼Œæˆ‘ä»¬å‘ç°ä¸šåŠ¡æ–¹åœ¨å®è·µè¿‡ç¨‹ä¸­è¿˜æœ‰ä¸€ç§å‡†å®æ—¶æ•°ä»“æ¨¡å‹ï¼Œå…¶ç‰¹ç‚¹æ˜¯ä¸å®Œå…¨åŸºäºæµå»åšï¼Œè€Œæ˜¯å°†æ˜ç»†å±‚æ•°æ®å¯¼å…¥åˆ° OLAP å­˜å‚¨ä¸­ï¼ŒåŸºäº OLAP çš„è®¡ç®—èƒ½åŠ›å»åšæ±‡æ€»å¹¶è¿›è¡Œè¿›ä¸€æ­¥çš„åŠ å·¥ã€‚ å®æ—¶æ•°ä»“å’Œä¼ ç»Ÿæ•°ä»“çš„å¯¹æ¯”å®æ—¶æ•°ä»“å’Œä¼ ç»Ÿæ•°ä»“çš„å¯¹æ¯”ä¸»è¦å¯ä»¥ä»å››ä¸ªæ–¹é¢è€ƒè™‘ï¼š ç¬¬ä¸€ä¸ªæ˜¯åˆ†å±‚æ–¹å¼ï¼Œç¦»çº¿æ•°ä»“ä¸ºäº†è€ƒè™‘åˆ°æ•ˆç‡é—®é¢˜ï¼Œä¸€èˆ¬ä¼šé‡‡å–ç©ºé—´æ¢æ—¶é—´çš„æ–¹å¼ï¼Œå±‚çº§åˆ’åˆ†ä¼šæ¯”è¾ƒå¤šï¼›åˆ™å®æ—¶æ•°ä»“è€ƒè™‘åˆ°å®æ—¶æ€§é—®é¢˜ï¼Œä¸€èˆ¬åˆ†å±‚ä¼šæ¯”è¾ƒå°‘ï¼Œå¦å¤–ä¹Ÿå‡å°‘äº†ä¸­é—´æµç¨‹å‡ºé”™çš„å¯èƒ½æ€§ã€‚ ç¬¬äºŒä¸ªæ˜¯äº‹å®æ•°æ®å­˜å‚¨æ–¹é¢ï¼Œç¦»çº¿æ•°ä»“ä¼šåŸºäº HDFSï¼Œå®æ—¶æ•°ä»“åˆ™ä¼šåŸºäºæ¶ˆæ¯é˜Ÿåˆ—ï¼ˆå¦‚ Kafkaï¼‰ã€‚ ç¬¬ä¸‰ä¸ªæ˜¯ç»´åº¦æ•°æ®å­˜å‚¨ï¼Œå®æ—¶æ•°ä»“ä¼šå°†æ•°æ®æ”¾åœ¨ KV å­˜å‚¨ä¸Šé¢ã€‚ ç¬¬å››ä¸ªæ˜¯æ•°æ®åŠ å·¥è¿‡ç¨‹ï¼Œç¦»çº¿æ•°ä»“ä¸€èˆ¬ä»¥ Hiveã€Spark ç­‰æ‰¹å¤„ç†ä¸ºä¸»ï¼Œè€Œå®æ—¶æ•°ä»“åˆ™æ˜¯åŸºäºå®æ—¶è®¡ç®—å¼•æ“å¦‚ Stormã€Flink ç­‰ï¼Œä»¥æµå¤„ç†ä¸ºä¸»ã€‚ å®æ—¶æ•°ä»“å»ºè®¾æ–¹æ¡ˆå¯¹æ¯”ä¸‹å›¾ä¸­å¯¹äºå®æ—¶æ•°ä»“çš„ä¸¤ç§å»ºè®¾æ–¹å¼ï¼Œå³å‡†å®æ—¶æ•°ä»“å’Œå®æ—¶æ•°ä»“ä¸¤ç§æ–¹å¼è¿›è¡Œäº†å¯¹æ¯”ã€‚å®ƒä»¬çš„å®ç°æ–¹å¼åˆ†åˆ«æ˜¯åŸºäº OLAP å¼•æ“å’Œæµè®¡ç®—å¼•æ“ï¼Œå®æ—¶åº¦åˆ™åˆ†åˆ«æ˜¯åˆ†é’Ÿå’Œç§’çº§ã€‚ åœ¨è°ƒåº¦å¼€é”€æ–¹é¢ï¼Œå‡†å®æ—¶æ•°ä»“æ˜¯æ‰¹å¤„ç†è¿‡ç¨‹ï¼Œå› æ­¤ä»ç„¶éœ€è¦è°ƒåº¦ç³»ç»Ÿæ”¯æŒï¼Œè™½ç„¶è°ƒåº¦å¼€é”€æ¯”ç¦»çº¿æ•°ä»“å°‘ä¸€äº›ï¼Œä½†æ˜¯ä¾ç„¶å­˜åœ¨ï¼Œè€Œå®æ—¶æ•°ä»“å´æ²¡æœ‰è°ƒåº¦å¼€é”€ã€‚ åœ¨ä¸šåŠ¡çµæ´»æ€§æ–¹é¢ï¼Œå› ä¸ºå‡†å®æ—¶æ•°ä»“åŸºäº OLAP å¼•æ“å®ç°ï¼Œçµæ´»æ€§ä¼˜äºåŸºäºæµè®¡ç®—çš„æ–¹å¼ã€‚ åœ¨å¯¹æ•°æ®æ™šåˆ°çš„å®¹å¿åº¦æ–¹é¢ï¼Œå› ä¸ºå‡†å®æ—¶æ•°ä»“å¯ä»¥åŸºäºä¸€ä¸ªå‘¨æœŸå†…çš„æ•°æ®è¿›è¡Œå…¨é‡è®¡ç®—ï¼Œå› æ­¤å¯¹äºæ•°æ®æ™šåˆ°çš„å®¹å¿åº¦ä¹Ÿæ˜¯æ¯”è¾ƒé«˜çš„ï¼Œè€Œå®æ—¶æ•°ä»“ä½¿ç”¨çš„æ˜¯å¢é‡è®¡ç®—ï¼Œå¯¹äºæ•°æ®æ™šåˆ°çš„å®¹å¿åº¦æ›´ä½ä¸€äº›ã€‚ åœ¨æ‰©å±•æ€§æ–¹é¢ï¼Œå› ä¸ºå‡†å®æ—¶æ•°ä»“çš„è®¡ç®—å’Œå­˜å‚¨æ˜¯ä¸€ä½“çš„ï¼Œå› æ­¤ç›¸æ¯”äºå®æ—¶æ•°ä»“ï¼Œæ‰©å±•æ€§æ›´å¼±ä¸€äº›ã€‚ åœ¨é€‚ç”¨åœºæ™¯æ–¹é¢ï¼Œå‡†å®æ—¶æ•°ä»“ä¸»è¦ç”¨äºæœ‰å®æ—¶æ€§è¦æ±‚ä½†ä¸å¤ªé«˜ã€æ•°æ®é‡ä¸å¤§ä»¥åŠå¤šè¡¨å…³è”å¤æ‚å’Œä¸šåŠ¡å˜æ›´é¢‘ç¹çš„åœºæ™¯ï¼Œå¦‚äº¤æ˜“ç±»å‹çš„å®æ—¶åˆ†æï¼Œå®æ—¶æ•°ä»“åˆ™æ›´é€‚ç”¨äºå®æ—¶æ€§è¦æ±‚é«˜ã€æ•°æ®é‡å¤§çš„åœºæ™¯ï¼Œå¦‚å®æ—¶ç‰¹å¾ã€æµé‡åˆ†å‘ä»¥åŠæµé‡ç±»å‹å®æ—¶åˆ†æã€‚ æ€»ç»“ä¸€ä¸‹ï¼ŒåŸºäº OLAP å¼•æ“çš„å»ºè®¾æ–¹å¼æ˜¯æ•°æ®é‡ä¸å¤ªå¤§ï¼Œä¸šåŠ¡æµé‡ä¸å¤ªé«˜æƒ…å†µä¸‹ä¸ºäº†æé«˜æ—¶æ•ˆæ€§å’Œå¼€å‘æ•ˆç‡çš„ä¸€ä¸ªæŠ˜ä¸­æ–¹æ¡ˆï¼Œä»æœªæ¥çš„å‘å±•è¶‹åŠ¿æ¥çœ‹ï¼ŒåŸºäºæµè®¡ç®—çš„å®æ—¶æ•°ä»“æ›´å…·æœ‰å‘å±•å‰æ™¯ã€‚ ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆä»ä¸šåŠ¡å®è·µè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†ä¸šåŠ¡å»ºè®¾å®æ—¶æ•°ä»“çš„å…±åŒéœ€æ±‚ï¼ŒåŒ…æ‹¬å‘ç°ä¸åŒä¸šåŠ¡çš„å…ƒæ•°æ®æ˜¯å‰²è£‚çš„ï¼Œä¸šåŠ¡å¼€å‘ä¹Ÿå€¾å‘äºä½¿ç”¨ SQL æ–¹å¼åŒæ—¶å¼€å‘ç¦»çº¿æ•°ä»“å’Œå®æ—¶æ•°ä»“ï¼Œéœ€è¦æ›´å¤šçš„è¿ç»´å·¥å…·æ”¯æŒã€‚å› æ­¤æˆ‘ä»¬è§„åˆ’äº†ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆï¼Œå¸Œæœ›èƒ½å¤Ÿå°†æ•´ä¸ªæµç¨‹è´¯é€šã€‚ è¿™é‡Œçš„ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆä¸»è¦ä¸ºç”¨æˆ·æä¾›äº†æ•°æ®å¼€å‘å·¥ä½œå¹³å°ã€å…ƒæ•°æ®ç®¡ç†ã€‚åŒæ—¶æˆ‘ä»¬è€ƒè™‘åˆ°ä¸šåŠ¡ä»ç”Ÿäº§åˆ°åº”ç”¨è¿‡ç¨‹ä¸­çš„é—®é¢˜ï¼Œæˆ‘ä»¬ OLAP ç”Ÿäº§å¹³å°ï¼Œä»å»ºæ¨¡æ–¹å¼ã€ç”Ÿäº§ä»»åŠ¡ç®¡ç†å’Œèµ„æºæ–¹é¢è§£å†³ OLAP ç”Ÿäº§é—®é¢˜ã€‚å·¦ä¾§æ˜¯æˆ‘ä»¬å·²ç»å…·å¤‡æ•°æ®å®‰å…¨ä½“ç³»ã€èµ„æºä½“ç³»å’Œæ•°æ®æ²»ç†ï¼Œè¿™äº›æ˜¯ç¦»çº¿æ•°ä»“å’Œå®æ—¶æ•°ä»“å¯ä»¥å…±ç”¨çš„ã€‚ ä¸ºä½•é€‰æ‹© Flinkï¼Ÿå®æ—¶æ•°ä»“å¹³å°å»ºè®¾ä¹‹æ‰€ä»¥é€‰æ‹© Flink æ˜¯åŸºäºä»¥ä¸‹å››ä¸ªæ–¹é¢çš„è€ƒè™‘ï¼Œè¿™ä¹Ÿæ˜¯å®æ—¶æ•°ä»“æ–¹é¢å…³æ³¨çš„æ¯”è¾ƒæ ¸å¿ƒçš„é—®é¢˜ã€‚ ç¬¬ä¸€ä¸ªæ˜¯çŠ¶æ€ç®¡ç†ï¼Œå®æ—¶æ•°ä»“é‡Œé¢ä¼šè¿›è¡Œå¾ˆå¤šçš„èšåˆè®¡ç®—ï¼Œè¿™äº›éƒ½éœ€è¦å¯¹äºçŠ¶æ€è¿›è¡Œè®¿é—®å’Œç®¡ç†ï¼ŒFlink åœ¨è¿™æ–¹é¢æ¯”è¾ƒæˆç†Ÿã€‚ ç¬¬äºŒä¸ªæ˜¯è¡¨ä¹‰èƒ½åŠ›ï¼ŒFlink æä¾›æä¸ºä¸°å¯Œçš„å¤šå±‚æ¬¡ APIï¼ŒåŒ…æ‹¬ Stream APIã€Table API ä»¥åŠ Flink SQLã€‚ ç¬¬ä¸‰ä¸ªæ˜¯ç”Ÿæ€å®Œå–„ï¼Œå®æ—¶æ•°ä»“çš„ç”¨é€”å¹¿æ³›ï¼Œç”¨æˆ·å¯¹äºå¤šç§å­˜å‚¨æœ‰è®¿é—®éœ€æ±‚ï¼ŒFlink å¯¹äºè¿™æ–¹é¢çš„æ”¯æŒä¹Ÿæ¯”è¾ƒå®Œå–„ã€‚ æœ€åä¸€ç‚¹å°±æ˜¯ Flink æä¾›äº†æµæ‰¹ç»Ÿä¸€çš„å¯èƒ½æ€§ã€‚ å®æ—¶æ•°ä»“å¹³å° å»ºè®¾æ€è·¯ å®æ—¶æ•°ä»“å¹³å°çš„å»ºè®¾æ€è·¯ä»å¤–åˆ°å†…åˆ†ä¸ºäº†å››ä¸ªå±‚æ¬¡ï¼Œæˆ‘ä»¬è®¤ä¸ºå¹³å°åº”è¯¥åšçš„äº‹æƒ…æ˜¯ä¸ºç”¨æˆ·æä¾›æŠ½è±¡çš„è¡¨è¾¾èƒ½åŠ›ï¼Œåˆ†åˆ«æ˜¯æ¶ˆæ¯è¡¨è¾¾ã€æ•°æ®è¡¨è¾¾ã€è®¡ç®—è¡¨è¾¾ä»¥åŠæµå’Œæ‰¹ç»Ÿä¸€ã€‚ å®æ—¶æ•°ä»“å¹³å°æ¶æ„ å¦‚ä¸‹å›¾æ‰€ç¤ºçš„æ˜¯ç¾å›¢ç‚¹è¯„çš„å®æ—¶æ•°ä»“å¹³å°æ¶æ„ï¼Œä»ä¸‹å¾€ä¸Šçœ‹ï¼Œèµ„æºå±‚å’Œå­˜å‚¨å±‚å¤ç”¨äº†å®æ—¶è®¡ç®—å¹³å°çš„èƒ½åŠ›ï¼Œåœ¨å¼•æ“å±‚åˆ™ä¼šåŸºäº Flink Streaming å®ç°ä¸€äº›æ‰©å±•èƒ½åŠ›ï¼ŒåŒ…æ‹¬å¯¹ UDF çš„é›†æˆå’Œ Connector çš„é›†æˆã€‚å†å¾€ä¸Šæ˜¯åŸºäº Flink SQL ç‹¬ç«‹å‡ºæ¥çš„ SQL å±‚ï¼Œä¸»è¦è´Ÿè´£è§£æã€æ ¡éªŒå’Œä¼˜åŒ–ã€‚åœ¨è¿™ä¹‹ä¸Šæ˜¯å¹³å°å±‚ï¼ŒåŒ…æ‹¬å¼€å‘å·¥ä½œå°ã€å…ƒæ•°æ®ã€UDF å¹³å°ä»¥åŠ OLAP å¹³å°ã€‚æœ€ä¸Šå±‚åˆ™æ˜¯å¹³å°æ‰€æ”¯æŒçš„å®æ—¶æ•°ä»“çš„åº”ç”¨ï¼ŒåŒ…æ‹¬å®æ—¶æŠ¥è¡¨ã€å®æ—¶ OLAPã€å®æ—¶ Dashboard å’Œå®æ—¶ç‰¹å¾ç­‰ã€‚ æ¶ˆæ¯è¡¨è¾¾-æ•°æ®æ¥å…¥ åœ¨æ¶ˆæ¯è¡¨è¾¾å±‚é¢ï¼Œå› ä¸º Binlogã€åŸ‹ç‚¹æ—¥å¿—ã€åç«¯æ—¥å¿—ä»¥åŠ IoT æ•°æ®ç­‰çš„æ•°æ®æ ¼å¼æ˜¯ä¸ä¸€è‡´çš„ï¼Œå› æ­¤ç¾å›¢ç‚¹è¯„çš„å®æ—¶æ•°ä»“å¹³å°æä¾›æ•°æ®æ¥å…¥çš„æµç¨‹ï¼Œèƒ½å¤Ÿå¸®åŠ©å¤§å®¶æŠŠæ•°æ®åŒæ­¥åˆ° ODS å±‚ã€‚è¿™é‡Œä¸»è¦å®ç°äº†ä¸¤ä»¶äº‹æƒ…ï¼Œåˆ†åˆ«æ˜¯ç»Ÿä¸€æ¶ˆæ¯åè®®å’Œå±è”½å¤„ç†ç»†èŠ‚ã€‚ å¦‚ä¸‹å›¾å·¦ä¾§æ˜¯æ¥å…¥è¿‡ç¨‹çš„ä¸€ä¸ªä¾‹å­ï¼Œå¯¹äº Binlog ç±»å‹æ•°æ®ï¼Œå®æ—¶æ•°ä»“å¹³å°è¿˜ä¸ºå¤§å®¶æä¾›äº†åˆ†åº“åˆ†è¡¨çš„æ”¯æŒï¼Œèƒ½å¤Ÿå°†å±äºåŒä¸€ä¸ªä¸šåŠ¡çš„ä¸åŒçš„åˆ†åº“åˆ†è¡¨æ•°æ®æ ¹æ®ä¸šåŠ¡è§„åˆ™æ”¶é›†åˆ°åŒä¸€ä¸ª ODS è¡¨ä¸­å»ã€‚ è®¡ç®—è¡¨è¾¾-æ‰©å±• DDL ç¾å›¢ç‚¹è¯„å®æ—¶æ•°ä»“å¹³å°åŸºäº Flink æ‰©å±•äº† DDLï¼Œè¿™éƒ¨åˆ†å·¥ä½œçš„ä¸»è¦ç›®çš„æ˜¯å»ºè®¾å…ƒæ•°æ®ä½“ç³»ï¼Œæ‰“é€šå†…éƒ¨çš„ä¸»æµå®æ—¶å­˜å‚¨ï¼ŒåŒ…æ‹¬ KV æ•°æ®ã€OLAP æ•°æ®ç­‰ã€‚ç”±äºå¼€å‘å·¥ä½œå°å’Œå…ƒæ•°æ®ä½“ç³»æ˜¯æ‰“é€šçš„ï¼Œå› æ­¤å¾ˆå¤šæ•°æ®çš„ç»†èŠ‚å¹¶ä¸éœ€è¦å¤§å®¶åœ¨ DDL ä¸­æ˜ç¡®åœ°å£°æ˜å‡ºæ¥ï¼Œåªéœ€è¦åœ¨å£°æ˜ä¸­å†™ä¸Šæ•°æ®çš„åå­—ï¼Œå’Œè¿è¡Œæ—¶çš„ä¸€äº›è®¾ç½®ï¼Œæ¯”å¦‚ MQ ä»æœ€æ–°æ¶ˆè´¹è¿˜æ˜¯æœ€æ—§æ¶ˆè´¹æˆ–è€…ä»æŸä¸ªæ—¶é—´æˆ³æ¶ˆè´¹å³å¯ï¼Œå…¶ä»–çš„æ•°æ®è®¿é—®æ–¹å¼æ˜¯ä¸€è‡´çš„ã€‚ è®¡ç®—è¡¨è¾¾-UDF å¹³å° å¯¹äº UDF å¹³å°è€Œè¨€ï¼Œéœ€è¦ä»ä¸‰ä¸ªå±‚é¢è€ƒè™‘ï¼š é¦–å…ˆæ˜¯æ•°æ®å®‰å…¨æ€§ã€‚ä¹‹å‰çš„æ•°ä»“å»ºè®¾è¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·å¯ä»¥ä¸Šä¼  Jar åŒ…å»ç›´æ¥å¼•ç”¨ UDFï¼Œè¿™æ ·åšæ˜¯æœ‰å±é™©æ€§å­˜åœ¨çš„ï¼Œå¹¶ä¸”æˆ‘ä»¬æ— æ³•çŸ¥é“æ•°æ®çš„æµå‘ã€‚ä»æ•°æ®å®‰å…¨çš„è§’åº¦æ¥è€ƒè™‘ï¼Œå¹³å°ä¼šè¿›è¡Œä»£ç å®¡è®¡å’Œè¡€ç¼˜å…³ç³»åˆ†æï¼Œå¯¹äºå†å²é£é™©ç»„ä»¶æˆ–è€…å­˜åœ¨é—®é¢˜çš„ç»„ä»¶å¯ä»¥è¿›è¡Œç»„ä»¶æ”¶æ•›ã€‚ ç¬¬äºŒä¸ªå±‚é¢ï¼Œåœ¨æ•°æ®å®‰å…¨åŸºç¡€ä¸Šæˆ‘ä»¬è¿˜ä¼šå…³æ³¨ UDF çš„è¿è¡Œè´¨é‡ï¼Œå¹³å°å°†ä¼šä¸ºç”¨æˆ·æä¾›æ¨¡æ¿ã€ç”¨ä¾‹ä»¥åŠæµ‹è¯•çš„ç®¡ç†ï¼Œä¸ºç”¨æˆ·å±è”½ç¼–è¯‘æ‰“åŒ…ã€Jar åŒ…ç®¡ç†çš„è¿‡ç¨‹ï¼Œå¹¶ä¸”ä¼šåœ¨ UDF æ¨¡æ¿ä¸­è¿›è¡ŒæŒ‡æ ‡æ—¥å¿—çš„åŸ‹ç‚¹å’Œå¼‚å¸¸å¤„ç†ã€‚ ç¬¬ä¸‰ä¸ªå±‚é¢æ˜¯ UDF çš„å¤ç”¨èƒ½åŠ›ï¼Œå› ä¸ºä¸€ä¸ªä¸šåŠ¡æ–¹å¼€å‘çš„ UDFï¼Œå…¶ä»–ä¸šåŠ¡æ–¹å¾ˆå¯èƒ½ä¹Ÿä¼šä½¿ç”¨ï¼Œä½†æ˜¯å‡çº§è¿‡ç¨‹ä¸­å¯èƒ½ä¼šå¸¦æ¥ä¸å…¼å®¹çš„é—®é¢˜ï¼Œå› æ­¤ï¼Œå¹³å°ä¸ºä¸šåŠ¡æä¾›äº†é¡¹ç›®ç®¡ç†ã€å‡½æ•°ç®¡ç†å’Œç‰ˆæœ¬ç®¡ç†çš„èƒ½åŠ›ã€‚ UDF çš„åº”ç”¨å…¶å®éå¸¸å¹¿æ³›ï¼ŒUDF å¹³å°å¹¶ä¸æ˜¯åªæ”¯æŒå®æ—¶æ•°ä»“ï¼Œä¹Ÿä¼šåŒæ—¶æ”¯æŒç¦»çº¿æ•°ä»“ã€æœºå™¨å­¦ä¹ ä»¥åŠæŸ¥è¯¢æœåŠ¡ç­‰åº”ç”¨åœºæ™¯ã€‚ä¸‹å›¾ä¸­å³ä¾§å±•ç¤ºçš„æ˜¯ UDF çš„ä½¿ç”¨æ¡ˆä¾‹ï¼Œå·¦å›¾æ˜¯ UDF çš„å¼€å‘æµç¨‹ï¼Œç”¨æˆ·åªéœ€è¦å…³å¿ƒæ³¨å†Œæµç¨‹ï¼Œæ¥ä¸‹æ¥çš„ç¼–è¯‘æ‰“åŒ…ã€æµ‹è¯•ä»¥åŠä¸Šä¼ ç­‰éƒ½ç”±å¹³å°å®Œæˆï¼›å³å›¾æ˜¯ UDF çš„ä½¿ç”¨æµç¨‹ä¸­ï¼Œç”¨æˆ·åªéœ€è¦å£°æ˜ UDFï¼Œå¹³å°ä¼šè¿›è¡Œè§£ææ ¡éªŒã€è·¯å¾„è·å–ä»¥åŠåœ¨ä½œä¸šæäº¤çš„æ—¶å€™è¿›è¡Œé›†æˆã€‚ å®æ—¶æ•°ä»“å¹³å°-Web IDE æœ€åä»‹ç»ä¸€ä¸‹å®æ—¶æ•°ä»“å¹³å°çš„å¼€å‘å·¥ä½œå°ï¼Œä»¥ Web IDE çš„å½¢å¼é›†æˆäº†æ¨¡å‹ã€ä½œä¸šä»¥åŠ UDF çš„ç®¡ç†ï¼Œç”¨æˆ·å¯ä»¥åœ¨ Web IDE ä¸Šä»¥ SQL æ–¹å¼å¼€å‘ã€‚å¹³å°ä¼šå¯¹ SQL åšä¸€äº›ç‰ˆæœ¬çš„ç®¡ç†ï¼Œå¹¶ä¸”æ”¯æŒç”¨æˆ·å›é€€åˆ°å·²éƒ¨ç½²æˆåŠŸçš„ç‰ˆæœ¬ä¸Šå»ã€‚ ä¸‰ã€æœªæ¥å‘å±•ä¸æ€è€ƒèµ„æºè‡ªåŠ¨è°ƒä¼˜ä»æ•´ä¸ªå®æ—¶è®¡ç®—è§’åº¦æ¥è€ƒè™‘ï¼Œç›®å‰ç¾å›¢ç‚¹è¯„çš„å®æ—¶è®¡ç®—å¹³å°çš„èŠ‚ç‚¹æ•°å·²ç»è¾¾åˆ°äº†å‡ åƒå°ï¼Œæœªæ¥å¾ˆå¯èƒ½ä¼šè¾¾åˆ°ä¸Šä¸‡å°ï¼Œå› æ­¤èµ„æºä¼˜åŒ–è¿™ä»¶äº‹æƒ…å¾ˆå¿«å°±ä¼šè¢«æä¸Šæ—¥ç¨‹ã€‚ç”±äºä¸šåŠ¡æœ¬èº«çš„æµé‡å­˜åœ¨é«˜å³°å’Œä½è°·ï¼Œå¯¹äºä¸€ä¸ªå®æ—¶ä»»åŠ¡æ¥è¯´ï¼Œå¯èƒ½åœ¨é«˜å³°æ—¶éœ€è¦å¾ˆå¤šèµ„æºï¼Œä½†æ˜¯åœ¨ä½è°·æ—¶å¹¶ä¸éœ€è¦é‚£ä¹ˆå¤šèµ„æºã€‚ å¦å¤–ä¸€æ–¹é¢ï¼Œæ³¢å³°æœ¬èº«ä¹Ÿæ˜¯ä¼šå‘ç”Ÿå˜åŒ–çš„ï¼Œæœ‰å¯èƒ½éšç€ä¸šåŠ¡çš„ä¸Šæ¶¨ä½¿å¾—åŸæ¥åˆ†é…çš„èµ„æºæ•°é‡ä¸å¤Ÿç”¨ã€‚å› æ­¤ï¼Œèµ„æºè‡ªåŠ¨è°ƒä¼˜æœ‰ä¸¤ä¸ªå«ä¹‰ï¼Œä¸€ä¸ªæ˜¯æŒ‡èƒ½å¤Ÿé€‚é…ä½œä¸šçš„é«˜å³°æµé‡ä¸Šæ¶¨ï¼Œè‡ªåŠ¨é€‚é… Max å€¼ï¼›å¦å¤–ä¸€ä¸ªå«ä¹‰æ˜¯æŒ‡ä½¿å¾—ä½œä¸šèƒ½å¤Ÿåœ¨é«˜å³°è¿‡å»ä¹‹åè‡ªåŠ¨é€‚åº”æµé‡å‡å°‘ï¼Œèƒ½å¤Ÿå¿«é€Ÿç¼©å®¹ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æ¯ä¸ªä»»åŠ¡ç”šè‡³æ˜¯ç®—å­çš„å†å²è¿è¡Œæƒ…å†µï¼Œæ‹Ÿåˆå¾—åˆ°ç®—å­ã€æµé‡ä¸èµ„æºçš„å…³ç³»å‡½æ•°ï¼Œåœ¨æµé‡å˜åŒ–æ—¶åŒæ­¥è°ƒæ•´èµ„æºé‡ã€‚ ä»¥ä¸Šæ˜¯èµ„æºä¼˜åŒ–çš„æ€è·¯ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜éœ€è¦è€ƒè™‘å½“èµ„æºå®Œæˆä¼˜åŒ–ä¹‹ååº”è¯¥å¦‚ä½•åˆ©ç”¨ã€‚ä¸ºäº†ä¿è¯å¯ç”¨æ€§ï¼Œå®æ—¶å’Œç¦»çº¿ä»»åŠ¡ä¸€èˆ¬ä¼šåˆ†å¼€éƒ¨ç½²ï¼Œå¦åˆ™å¸¦å®½ã€IO éƒ½å¯èƒ½è¢«ç¦»çº¿è®¡ç®—æ‰“æ»¡å¯¼è‡´å®æ—¶ä»»åŠ¡å»¶è¿Ÿã€‚è€Œä»èµ„æºä½¿ç”¨ç‡è§’åº¦å‡ºå‘ï¼Œåˆ™éœ€è¦è€ƒè™‘å®æ—¶å’Œç¦»çº¿çš„æ··åˆéƒ¨ç½²ï¼Œæˆ–è€…ä»¥æµçš„æ–¹å¼æ¥å¤„ç†ä¸€äº›å®æ—¶æ€§è¦æ±‚å¹¶ä¸æ˜¯éå¸¸é«˜çš„ä»»åŠ¡ã€‚è¿™å°±è¦æ±‚æ›´ç»†ç²’åº¦çš„èµ„æºéš”ç¦»å’Œæ›´å¿«çš„èµ„æºé‡Šæ”¾ã€‚ æ¨åŠ¨å®æ—¶æ•°ä»“å»ºè®¾æ–¹å¼å‡çº§å®æ—¶æ•°ä»“çš„å»ºè®¾ä¸€èˆ¬åˆ†ä¸ºå‡ ä¸ªæ­¥éª¤ï¼š é¦–å…ˆï¼Œä¸šåŠ¡æå‡ºéœ€æ±‚ï¼Œåç»­ä¼šè¿›è¡Œè®¾è®¡å»ºæ¨¡ã€ä¸šåŠ¡é€»è¾‘å¼€å‘å’Œåº•å±‚æŠ€æœ¯å®ç°ã€‚ç¾å›¢ç‚¹è¯„çš„å®æ—¶æ•°ä»“å»ºè®¾æ€è·¯æ˜¯å°†æŠ€æœ¯å®ç°ç»Ÿä¸€è¡¨è¾¾ï¼Œè®©ä¸šåŠ¡å…³æ³¨é€»è¾‘å¼€å‘ï¼Œè€Œé€»è¾‘å¼€å‘ä¹Ÿå¯ä»¥åŸºäºé…ç½®åŒ–æ‰‹æ®µå®ç°è‡ªåŠ¨æ„å»ºã€‚ å†ä¸Šä¸€å±‚æ˜¯å¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚å®ç°æ™ºèƒ½å»ºæ¨¡ï¼Œå°†è®¾è®¡å»ºæ¨¡è¿‡ç¨‹å®ç°è‡ªåŠ¨åŒ–ã€‚ ç›®å‰ï¼Œç¾å›¢ç‚¹è¯„çš„å®æ—¶æ•°ä»“å¹³å°å»ºè®¾å·¥ä½œè¿˜é›†ä¸­åœ¨ç»Ÿä¸€è¡¨è¾¾çš„å±‚æ¬¡ï¼Œè·ç¦»ç†æƒ³çŠ¶æ€ä»ç„¶æœ‰æ¯”è¾ƒé•¿çš„ä¸€æ®µè·¯è¦èµ°ã€‚ Flink Forward Asia 2019 PPT ä¸‹è½½é“¾æ¥ç»™ä½ ä»¬å‡†å¤‡å¥½å•¦ï¼å…¬ä¼—å·(zhisheng)é‡Œé¢å›å¤ ffa å³å¯ä¸‹è½½ï¼Œä¹Ÿå¯ä»¥æ‰«æä¸‹é¢çš„äºŒç»´ç å…³æ³¨ï¼Œå›å¤ ffa å³å¯ä¸‹è½½ã€‚ æ›´å¤š Flink åšå®¢Github ä»£ç ä»“åº“https://github.com/zhisheng17/flink-learning/ ä»¥åè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç éƒ½å°†æ”¾åœ¨è¿™ä¸ªä»“åº“é‡Œï¼ŒåŒ…å«äº†è‡ªå·±å­¦ä¹  flink çš„ä¸€äº› demo å’Œåšå®¢ã€‚ æœ¬æ–‡çš„é¡¹ç›®ä»£ç åœ¨ https://github.com/zhisheng17/flink-learning/tree/master/flink-learning-connectors/flink-learning-connectors-rabbitmq åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€å®æˆ˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"åŸºäº Apache Flink çš„ç›‘æ§å‘Šè­¦ç³»ç»Ÿ","date":"2019-12-22T16:00:00.000Z","path":"2019/12/23/flink-monitor-alert/","text":"æœ¬äººåœ¨ Flink ç¤¾åŒºé’‰é’‰ç¾¤ç›´æ’­çš„è§†é¢‘ ç›‘æ§å‘Šè­¦ æœ€åGitHub Flink å­¦ä¹ ä»£ç åœ°å€ï¼šhttps://github.com/zhisheng17/flink-learning å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€åŸç†ã€å®æˆ˜ã€æ€§èƒ½è°ƒä¼˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"},{"name":"ç›‘æ§å‘Šè­¦","slug":"ç›‘æ§å‘Šè­¦","permalink":"http://www.54tianzhisheng.cn/tags/ç›‘æ§å‘Šè­¦/"}]},{"title":"åŸºäº Apache Flink çš„å¤§è§„æ¨¡å‡†å®æ—¶æ•°æ®åˆ†æå¹³å°","date":"2019-12-09T16:00:00.000Z","path":"2019/12/10/flink-real-time-data-analysis-platform/","text":"æœ¬æ–‡æ¥è‡ª Flink Forward Asia 2019 Lyft å…¬å¸çš„åˆ†äº«ï¼Œä½œè€…æ˜¯å¾èµ¢å’Œé«˜ç«‹ï¼Œæ„Ÿè°¢ï¼ æˆæƒè½¬è½½è‡ªç¤¾åŒºå…¬ä¼—å·ï¼šåŸæ–‡åœ°å€ ä¸€ã€Lyft çš„æµæ•°æ®ä¸åœºæ™¯ å…³äº LyftLyft æ˜¯ä½äºåŒ—ç¾çš„ä¸€ä¸ªå…±äº«äº¤é€šå¹³å°ï¼Œå’Œå¤§å®¶æ‰€ç†ŸçŸ¥çš„ Uber å’Œå›½å†…çš„æ»´æ»´ç±»ä¼¼ï¼ŒLyft ä¹Ÿä¸ºæ°‘ä¼—æä¾›å…±äº«å‡ºè¡Œçš„æœåŠ¡ã€‚Lyft çš„å®—æ—¨æ˜¯æä¾›ä¸–ç•Œæœ€å¥½çš„äº¤é€šæ–¹æ¡ˆæ¥æ”¹å–„äººä»¬çš„ç”Ÿæ´»ã€‚ Lyft çš„æµæ•°æ®åœºæ™¯Lyft çš„æµæ•°æ®å¯ä»¥å¤§è‡´åˆ†ä¸ºä¸‰ç±»ï¼Œç§’çº§åˆ«ã€åˆ†é’Ÿçº§åˆ«å’Œä¸é«˜äº 5 åˆ†é’Ÿçº§åˆ«ã€‚åˆ†é’Ÿçº§åˆ«æµæ•°æ®ä¸­ï¼Œè‡ªé€‚åº”å®šä»·ç³»ç»Ÿã€æ¬ºè¯ˆå’Œå¼‚å¸¸æ£€æµ‹ç³»ç»Ÿæ˜¯æœ€å¸¸ç”¨çš„ï¼Œæ­¤å¤–è¿˜æœ‰ Lyft æœ€æ–°ç ”å‘çš„æœºå™¨å­¦ä¹ ç‰¹å¾å·¥ç¨‹ã€‚ä¸é«˜äº 5 åˆ†é’Ÿçº§åˆ«çš„åœºæ™¯åˆ™åŒ…æ‹¬å‡†å®æ—¶æ•°æ®äº¤äº’æŸ¥è¯¢ç›¸å…³çš„ç³»ç»Ÿã€‚ Lyft æ•°æ®åˆ†æå¹³å°æ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºçš„æ˜¯ Lyft ä¹‹å‰çš„æ•°æ®åˆ†æå¹³å°æ¶æ„ã€‚Lyft çš„å¤§éƒ¨åˆ†æµæ•°æ®éƒ½æ˜¯æ¥è‡ªäºäº‹ä»¶ï¼Œè€Œäº‹ä»¶äº§ç”Ÿçš„æ¥æºä¸»è¦æœ‰ä¸¤ç§ï¼Œåˆ†åˆ«æ˜¯æ‰‹æœº APP å’Œåç«¯æœåŠ¡ï¼Œæ¯”å¦‚ä¹˜å®¢ã€å¸æœºã€æ”¯ä»˜ä»¥åŠä¿é™©ç­‰æœåŠ¡éƒ½ä¼šäº§ç”Ÿå„ç§å„æ ·çš„äº‹ä»¶ï¼Œè€Œè¿™äº›äº‹ä»¶éƒ½éœ€è¦å®æ—¶å“åº”ã€‚ åœ¨åˆ†æå¹³å°è¿™éƒ¨åˆ†ï¼Œäº‹ä»¶ä¼šæµå‘ AWS çš„ Kinesis ä¸Šé¢ï¼Œè¿™é‡Œçš„ Kinesis ä¸ Apache Kafka éå¸¸ç±»ä¼¼ï¼Œæ˜¯ä¸€ç§ AWS ä¸Šä¸“æœ‰çš„ PubSub æœåŠ¡ï¼Œè€Œè¿™äº›æ•°æ®æµéƒ½ä¼šé‡åŒ–æˆæ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶åˆ™éƒ½ä¼šå­˜å‚¨åœ¨ AWS çš„ S3 ä¸Šé¢ï¼Œå¹¶ä¸”å¾ˆå¤šæ‰¹å¤„ç†ä»»åŠ¡éƒ½ä¼šå¼¹å‡ºä¸€äº›æ•°æ®å­é›†ã€‚åœ¨åˆ†æç³»ç»Ÿæ–¹é¢ï¼ŒLyft ä½¿ç”¨çš„æ˜¯å¼€æºç¤¾åŒºä¸­æ¯”è¾ƒæ´»è·ƒçš„ presto æŸ¥è¯¢å¼•æ“ã€‚Lyft æ•°æ®åˆ†æå¹³å°çš„ç”¨æˆ·ä¸»è¦æœ‰å››ç§ï¼Œå³æ•°æ®å·¥ç¨‹å¸ˆã€æ•°æ®åˆ†æå¸ˆä»¥åŠæœºå™¨å­¦ä¹ ä¸“å®¶å’Œæ·±åº¦å­¦ä¹ ä¸“å®¶ï¼Œä»–ä»¬å¾€å¾€éƒ½æ˜¯é€šè¿‡åˆ†æå¼•æ“å®ç°ä¸æ•°æ®çš„äº¤äº’ã€‚ æ—¢å¾€å¹³å°çš„é—®é¢˜Lyft ä¹‹æ‰€ä»¥è¦åŸºäº Apache Flink å®ç°å¤§è§„æ¨¡å‡†å®æ—¶æ•°æ®åˆ†æå¹³å°ï¼Œæ˜¯å› ä¸ºä»¥å¾€çš„å¹³å°å­˜åœ¨ä¸€äº›é—®é¢˜ã€‚æ¯”å¦‚è¾ƒé«˜çš„å»¶è¿Ÿï¼Œå¯¼å…¥æ•°æ®æ— æ³•æ»¡è¶³å‡†å®æ—¶æŸ¥è¯¢çš„è¦æ±‚ï¼›å¹¶ä¸”åŸºäº Kinesis Client Library çš„æµå¼æ•°æ®å¯¼å…¥æ€§èƒ½ä¸è¶³ï¼›å¯¼å…¥æ•°æ®å­˜åœ¨å¤ªå¤šå°æ–‡ä»¶å¯¼è‡´ä¸‹æ¸¸æ“ä½œæ€§èƒ½ä¸è¶³ï¼›æ•°æ® ETL å¤§å¤šæ˜¯é«˜å»¶è¿Ÿå¤šæ—¥å¤šæ­¥çš„æ¶æ„ï¼›æ­¤å¤–ï¼Œä»¥å¾€çš„å¹³å°å¯¹äºåµŒå¥—æ•°æ®æä¾›çš„æ”¯æŒä¹Ÿä¸è¶³ã€‚ äºŒã€å‡†å®æ—¶æ•°æ®åˆ†æå¹³å°å’Œæ¶æ„ å‡†å®æ—¶å¹³å°æ¶æ„åœ¨æ–°çš„å‡†å®æ—¶å¹³å°æ¶æ„ä¸­ï¼ŒLyft é‡‡ç”¨ Flink å®ç°æµæ•°æ®æŒä¹…åŒ–ã€‚Lyft ä½¿ç”¨äº‘ç«¯å­˜å‚¨ï¼Œè€Œä½¿ç”¨ Flink ç›´æ¥å‘äº‘ç«¯å†™ä¸€ç§å«åš Parquet çš„æ•°æ®æ ¼å¼ï¼ŒParquet æ˜¯ä¸€ç§åˆ—æ•°æ®å­˜å‚¨æ ¼å¼ï¼Œèƒ½å¤Ÿæœ‰æ•ˆåœ°æ”¯æŒäº¤äº’å¼æ•°æ®æŸ¥è¯¢ã€‚Lyft åœ¨ Parquet åŸå§‹æ•°æ®ä¸Šæ¶æ„å®æ—¶æ•°ä»“ï¼Œå®æ—¶æ•°ä»“çš„ç»“æ„è¢«å­˜å‚¨åœ¨ Hive çš„ Table é‡Œé¢ï¼ŒHive Table çš„ metadata å­˜å‚¨åœ¨ Hive metastore é‡Œé¢ã€‚ å¹³å°ä¼šå¯¹äºåŸå§‹æ•°æ®åšå¤šçº§çš„éé˜»å¡ ETL åŠ å·¥ï¼Œæ¯ä¸€çº§éƒ½æ˜¯éé˜»å¡çš„(nonblocking)ï¼Œä¸»è¦æ˜¯å‹ç¼©å’Œå»é‡çš„æ“ä½œï¼Œä»è€Œå¾—åˆ°æ›´é«˜è´¨é‡çš„æ•°æ®ã€‚å¹³å°ä¸»è¦ä½¿ç”¨ Apache Airflow å¯¹äº ETL æ“ä½œè¿›è¡Œè°ƒåº¦ã€‚æ‰€æœ‰çš„ Parquet æ ¼å¼çš„åŸå§‹æ•°æ®éƒ½å¯ä»¥è¢« presto æŸ¥è¯¢ï¼Œäº¤äº’å¼æŸ¥è¯¢çš„ç»“æœå°†èƒ½å¤Ÿä»¥ BI æ¨¡å‹çš„æ–¹å¼æ˜¾ç¤ºç»™ç”¨æˆ·ã€‚ å¹³å°è®¾è®¡Lyft åŸºäº Apache Flink å®ç°çš„å¤§è§„æ¨¡å‡†å®æ—¶æ•°æ®åˆ†æå¹³å°å…·æœ‰å‡ ä¸ªç‰¹ç‚¹ï¼š é¦–å…ˆï¼Œå¹³å°å€ŸåŠ© Flink å®ç°é«˜é€Ÿæœ‰æ•ˆçš„æµæ•°æ®æ¥å…¥ï¼Œä½¿å¾—äº‘ä¸Šé›†ç¾¤è§„æ¨¡ç¼©å‡ä¸ºåŸæ¥çš„ååˆ†ä¹‹ä¸€ï¼Œå› æ­¤å¤§å¤§é™ä½äº†è¿ç»´æˆæœ¬ã€‚ å…¶æ¬¡ï¼ŒParquet æ ¼å¼çš„æ•°æ®æ”¯æŒäº¤äº’å¼æŸ¥è¯¢ï¼Œå½“ç”¨æˆ·ä»…å¯¹äºæŸå‡ ä¸ªåˆ—æ•°æ®æ„Ÿå…´è¶£æ—¶å¯ä»¥é€šè¿‡åˆ†åŒºå’Œé€‰æ‹©åˆ—çš„æ–¹å¼è¿‡æ»¤ä¸å¿…è¦çš„æ•°æ®ï¼Œä»è€Œæå‡æŸ¥è¯¢çš„æ€§èƒ½ã€‚ å†æ¬¡ï¼ŒåŸºäº AWS çš„äº‘ç«¯å­˜å‚¨ï¼Œå¹³å°çš„æ•°æ®æ— éœ€ç‰¹æ®Šå­˜å‚¨å½¢å¼ã€‚ ä¹‹åï¼Œå¤šçº§ ETL è¿›ç¨‹èƒ½å¤Ÿç¡®ä¿æ›´å¥½çš„æ€§èƒ½å’Œæ•°æ®è´¨é‡ã€‚ æœ€åï¼Œè¿˜èƒ½å¤Ÿå…¼é¡¾æ€§èƒ½å®¹é”™åŠå¯æ¼”è¿›æ€§ã€‚ å¹³å°ç‰¹å¾åŠåº”ç”¨Lyft å‡†å®æ—¶æ•°æ®åˆ†æå¹³å°éœ€è¦æ¯å¤©å¤„ç†åƒäº¿çº§äº‹ä»¶ï¼Œèƒ½å¤Ÿåšåˆ°æ•°æ®å»¶è¿Ÿå°äº 5 åˆ†é’Ÿï¼Œè€Œé“¾è·¯ä¸­ä½¿ç”¨çš„ç»„ä»¶ç¡®ä¿äº†æ•°æ®å®Œæ•´æ€§ï¼ŒåŒæ—¶åŸºäº ETL å»å†—ä½™æ“ä½œå®ç°äº†æ•°æ®å•ä¸€æ€§ä¿è¯ã€‚ æ•°æ®ç§‘å­¦å®¶å’Œæ•°æ®å·¥ç¨‹å¸ˆåœ¨å»ºæ¨¡æ—¶ä¼šéœ€è¦è¿›è¡Œè‡ªå‘çš„äº¤äº’å¼æŸ¥è¯¢ï¼Œæ­¤å¤–ï¼Œå¹³å°ä¹Ÿä¼šæä¾›å®æ—¶æœºå™¨å­¦ä¹ æ¨¡å‹æ­£ç¡®æ€§é¢„è­¦ï¼Œä»¥åŠå®æ—¶æ•°æ®é¢æ¿æ¥ç›‘æ§ä¾›éœ€å¸‚åœºå¥åº·çŠ¶å†µã€‚ åŸºäº Flink çš„å‡†å®æ—¶æ•°æ®å¯¼å…¥ä¸‹å›¾å¯ä»¥çœ‹åˆ°å½“äº‹ä»¶åˆ°è¾¾ Kinesis ä¹‹åå°±ä¼šè¢«å­˜å‚¨æˆä¸º EventBatchã€‚é€šè¿‡ Flink-Kinesis è¿æ¥å™¨å¯ä»¥å°†äº‹ä»¶æå–å‡ºæ¥å¹¶é€åˆ° FlatMap å’Œ Record Counter ä¸Šé¢ï¼ŒFlatMap å°†äº‹ä»¶æ‰“æ’’å¹¶é€åˆ°ä¸‹æ¸¸çš„ Global Record Aggregator å’Œ Tagging Partitioning ä¸Šé¢ï¼Œæ¯å½“åš CheckPoint æ—¶ä¼šå…³é—­æ–‡ä»¶å¹¶åšä¸€ä¸ªæŒä¹…åŒ–æ“ä½œï¼Œé’ˆå¯¹äº StreamingFileSink çš„ç‰¹å¾ï¼Œå¹³å°è®¾ç½®äº†æ¯ä¸‰åˆ†é’Ÿåšä¸€æ¬¡ CheckPoint æ“ä½œï¼Œè¿™æ ·å¯ä»¥ä¿è¯å½“äº‹ä»¶è¿›å…¥ Kinesis è¿æ¥å™¨ä¹‹ååœ¨ä¸‰åˆ†é’Ÿä¹‹å†…å°±èƒ½å¤ŸæŒä¹…åŒ–ã€‚ ä»¥ä¸Šçš„æ–¹å¼ä¼šé€ æˆå¤ªå¤šæ•°é‡çš„å°æ–‡ä»¶é—®é¢˜ï¼Œå› ä¸ºæ•°æ®é“¾è·¯æ”¯æŒæˆåƒä¸Šä¸‡ç§æ–‡ä»¶ï¼Œå› æ­¤ä½¿ç”¨äº† Subtasks è®°å½•æœ¬åœ°äº‹ä»¶æƒé‡ï¼Œå¹¶é€šè¿‡å…¨å±€è®°å½•èšåˆå™¨æ¥è®¡ç®—äº‹ä»¶å…¨å±€æƒé‡å¹¶å¹¿æ’­åˆ°ä¸‹æ¸¸å»ã€‚è€Œ Operator æ¥æ”¶åˆ°äº‹ä»¶æƒé‡ä¹‹åå°†ä¼šå°†äº‹ä»¶åˆ†é…ç»™ Sinkã€‚ ETL å¤šçº§å‹ç¼©å’Œå»é‡ä¸Šè¿°çš„æ•°æ®é“¾è·¯ä¹Ÿä¼šåš ETL å¤šçº§å‹ç¼©å’Œå»é‡å·¥ä½œï¼Œä¸»è¦æ˜¯ Parquet åŸå§‹æ•°æ®ä¼šç»è¿‡æ¯å°æ—¶çš„æ™ºèƒ½å‹ç¼©å»é‡çš„ ETL å·¥ä½œï¼Œäº§ç”Ÿæ›´å¤§çš„ Parquet Fileã€‚åŒç†ï¼Œå¯¹äºå°æ—¶çº§åˆ«å‹ç¼©å»é‡ä¸å¤Ÿçš„æ–‡ä»¶ï¼Œæ¯å¤©è¿˜ä¼šå†è¿›è¡Œä¸€æ¬¡å‹ç¼©å»é‡ã€‚å¯¹äºæ–°äº§ç”Ÿçš„æ•°æ®ä¼šæœ‰ä¸€ä¸ªåŸå­æ€§çš„åˆ†åŒºäº¤æ¢ï¼Œä¹Ÿå°±æ˜¯è¯´å½“äº§ç”Ÿæ–°çš„æ•°æ®ä¹‹åï¼ŒETL Job ä¼šè®© Hive metastore é‡Œçš„è¡¨åˆ†åŒºæŒ‡å‘æ–°çš„æ•°æ®å’Œåˆ†åŒºã€‚è¿™é‡Œçš„è¿‡ç¨‹ä½¿ç”¨äº†å¯å‘æ€§ç®—æ³•æ¥åˆ†æå“ªäº›äº‹ä»¶å¿…é¡»è¦ç»è¿‡å‹ç¼©å’Œå»é‡ä»¥åŠå‹ç¼©å»é‡çš„æ—¶é—´é—´éš”çº§åˆ«ã€‚æ­¤å¤–ï¼Œä¸ºäº†æ»¡è¶³éšç§å’Œåˆè§„çš„è¦æ±‚ï¼Œä¸€äº› ETL æ•°æ®ä¼šè¢«ä¿å­˜æ•°ä»¥å¹´è®¡çš„æ—¶é—´ã€‚ ä¸‰ã€å¹³å°æ€§èƒ½åŠå®¹é”™æ·±å…¥åˆ†æ äº‹ä»¶æ—¶é—´é©±åŠ¨çš„åˆ†åŒºæ„Ÿæµ‹Flink å’Œ ETL æ˜¯é€šè¿‡äº‹ä»¶æ—¶é—´é©±åŠ¨çš„åˆ†åŒºæ„Ÿæµ‹å®ç°åŒæ­¥çš„ã€‚S3 é‡‡ç”¨çš„æ˜¯æ¯”è¾ƒå¸¸è§çš„åˆ†åŒºæ ¼å¼ï¼Œæœ€åçš„åˆ†åŒºæ˜¯ç”±æ—¶é—´æˆ³å†³å®šçš„ï¼Œæ—¶é—´æˆ³åˆ™æ˜¯åŸºäº EventTime çš„ï¼Œè¿™æ ·çš„å¥½å¤„åœ¨äºèƒ½å¤Ÿå¸¦æ¥ Flink å’Œ ETL å…±åŒçš„æ—¶é—´æºï¼Œè¿™æ ·æœ‰åŠ©äºåŒæ­¥æ“ä½œã€‚æ­¤å¤–ï¼ŒåŸºäºäº‹ä»¶æ—¶é—´èƒ½å¤Ÿä½¿å¾—ä¸€äº›å›å¡«æ“ä½œå’Œä¸»æ“ä½œå®ç°ç±»ä¼¼çš„ç»“æœã€‚Flink å¤„ç†å®Œæ¯ä¸ªå°æ—¶çš„äº‹ä»¶åä¼šå‘äº‹ä»¶åˆ†åŒºå†™å…¥ä¸€ä¸ª Success æ–‡ä»¶ï¼Œè¿™ä»£è¡¨è¯¥å°æ—¶çš„äº‹ä»¶å·²ç»å¤„ç†å®Œæ¯•ï¼ŒETL å¯ä»¥å¯¹äºè¯¥å°æ—¶çš„æ–‡ä»¶è¿›è¡Œæ“ä½œäº†ã€‚ Flink æœ¬èº«çš„æ°´å°å¹¶ä¸èƒ½ç›´æ¥ç”¨åˆ° Lyft çš„åº”ç”¨åœºæ™¯å½“ä¸­ï¼Œä¸»è¦æ˜¯å› ä¸ºå½“ Flink å¤„ç†å®Œæ—¶é—´æˆ³å¹¶ä¸æ„å‘³ç€å®ƒå·²ç»è¢«æŒä¹…åŒ–åˆ°å­˜å‚¨å½“ä¸­ï¼Œæ­¤æ—¶å°±éœ€è¦å¼•å…¥åˆ†åŒºæ°´å°çš„æ¦‚å¿µï¼Œè¿™æ ·ä¸€æ¥æ¯ä¸ª Sink Source å°±èƒ½å¤ŸçŸ¥é“å½“å‰å†™å…¥çš„åˆ†åŒºï¼Œå¹¶ä¸”ç»´æŠ¤ä¸€ä¸ªåˆ†åŒº IDï¼Œå¹¶ä¸”é€šè¿‡ Global State Aggregator èšåˆæ¯ä¸ªåˆ†åŒºçš„ä¿¡æ¯ã€‚æ¯ä¸ª Subtasks èƒ½å¤ŸçŸ¥é“å…¨å±€çš„ä¿¡æ¯ï¼Œå¹¶å°†æ°´å°å®šä¹‰ä¸ºåˆ†åŒºæ—¶é—´æˆ³ä¸­æœ€å°çš„ä¸€ä¸ªã€‚ ETL ä¸»è¦æœ‰ä¸¤ä¸ªç‰¹ç‚¹ï¼Œåˆ†åˆ«æ˜¯åŠæ—¶æ€§å’Œå»é‡ï¼Œè€Œ ETL çš„ä¸»è¦åŠŸèƒ½åœ¨äºå»é‡å’Œå‹ç¼©ï¼Œæœ€é‡è¦çš„æ˜¯åœ¨éé˜»å¡çš„æƒ…å†µä¸‹å°±è¿›è¡Œå»é‡ã€‚å‰é¢ä¹Ÿæåˆ° Smart ETLï¼Œæ‰€è°“ Smart å°±æ˜¯æ™ºèƒ½æ„ŸçŸ¥ï¼Œéœ€è¦ä¸¤ä¸ªç›¸åº”çš„ä¿¡æ¯æ¥å¼•å¯¼ Global State Aggregatorï¼Œåˆ†åˆ«æ˜¯åˆ†åŒºå®Œæ•´æ€§æ ‡è¯† SuccessFileï¼Œåœ¨æ¯ä¸ªåˆ†åŒºè¿˜æœ‰å‡ ä¸ªç›¸åº”çš„ States ç»Ÿè®¡ä¿¡æ¯èƒ½å¤Ÿå‘Šè¯‰ä¸‹æ¸¸çš„ ETL æ€æ ·å»é‡å’Œå‹ç¼©ä»¥åŠæ“ä½œçš„é¢‘ç‡å’ŒèŒƒå›´ã€‚ Schema æ¼”è¿›çš„æŒ‘æˆ˜ETL é™¤äº†å»é‡å’Œå‹ç¼©çš„æŒ‘æˆ˜ä¹‹å¤–ï¼Œè¿˜ç»å¸¸ä¼šé‡åˆ° Schema çš„æ¼”åŒ–æŒ‘æˆ˜ã€‚Schema æ¼”åŒ–çš„æŒ‘æˆ˜åˆ†ä¸ºä¸‰ä¸ªæ–¹é¢ï¼Œå³ä¸åŒå¼•æ“çš„æ•°æ®ç±»å‹ã€åµŒå¥—ç»“æ„çš„æ¼”å˜ã€æ•°æ®ç±»å‹æ¼”å˜å¯¹å»é‡é€»è¾‘çš„å½±å“ã€‚ S3 æ·±å…¥åˆ†æLyft çš„æ•°æ®å­˜å‚¨ç³»ç»Ÿå…¶å®å¯ä»¥è®¤ä¸ºæ˜¯æ•°æ®æ¹–ï¼Œå¯¹äº S3 è€Œè¨€ï¼ŒLyft ä¹Ÿæœ‰ä¸€äº›æ€§èƒ½çš„ä¼˜åŒ–è€ƒé‡ã€‚S3 æœ¬èº«å†…éƒ¨ä¹Ÿæ˜¯æœ‰åˆ†åŒºçš„ï¼Œä¸ºäº†ä½¿å…¶å…·æœ‰å¹¶è¡Œçš„è¯»å†™æ€§èƒ½ï¼Œæ·»åŠ äº† S3 çš„ç†µæ•°å‰ç¼€ï¼Œåœ¨åˆ†åŒºé‡Œé¢ä¹Ÿå¢åŠ äº†æ ‡è®°æ–‡ä»¶ï¼Œè¿™ä¸¤ç§åšæ³•èƒ½å¤Ÿæå¤§åœ°é™ä½ S3 çš„ IO æ€§èƒ½çš„å½±å“ã€‚æ ‡è¯†ç¬¦å¯¹äºèƒ½å¦è§¦å‘ ETL æ“ä½œä¼šäº§ç”Ÿå½±å“ï¼Œä¸æ­¤åŒæ—¶ä¹Ÿæ˜¯å¯¹äº presto çš„é›†æˆï¼Œèƒ½å¤Ÿè®© presto å†³å®šä»€ä¹ˆæƒ…å†µä¸‹èƒ½å¤Ÿæ‰«æå¤šå°‘ä¸ªæ–‡ä»¶ã€‚ Parquet ä¼˜åŒ–æ–¹æ¡ˆLyft çš„å‡†å®æ—¶æ•°æ®åˆ†æå¹³å°åœ¨ Parquet æ–¹é¢åšäº†å¾ˆå¤šä¼˜åŒ–ï¼Œæ¯”å¦‚æ–‡ä»¶æ•°æ®å€¼å¤§å°èŒƒå›´ç»Ÿè®¡ä¿¡æ¯ã€æ–‡ä»¶ç³»ç»Ÿç»Ÿè®¡ä¿¡æ¯ã€åŸºäºä¸»é”®æ•°æ®å€¼çš„æ’åºåŠ å¿« presto çš„æŸ¥è¯¢é€Ÿåº¦ä»¥åŠäºŒçº§ç´¢å¼•çš„ç”Ÿæˆã€‚ åŸºäºæ•°æ®å›å¡«çš„å¹³å°å®¹é”™æœºåˆ¶å¦‚ä¸‹ä¸¤ä¸ªå›¾æ‰€ç¤ºçš„æ˜¯ Lyft å‡†å®æ—¶æ•°æ®åˆ†æå¹³å°çš„åŸºäºæ•°æ®å›å¡«çš„å¹³å°å®¹é”™æœºåˆ¶ã€‚å¯¹äº Flink è€Œè¨€ï¼Œå› ä¸ºå¹³å°çš„è¦æ±‚æ˜¯è¾¾åˆ°å‡†å®æ—¶ï¼Œè€Œ Flink çš„ Job å‡ºç°å¤±æ•ˆçš„æ—¶å€™å¯èƒ½ä¼šè¶…è¿‡ä¸€å®šçš„æ—¶é—´ï¼Œå½“ Job é‡æ–°å¼€å§‹ä¹‹åå°±ä¼šå½¢æˆä¸¤ä¸ªæ•°æ®æµï¼Œä¸»æ•°æ®æµæ€»æ˜¯ä»æœ€æ–°çš„æ•°æ®å¼€å§‹å¾€ä¸‹æ‰§è¡Œï¼Œé™„åŠ æ•°æ®æµåˆ™å¯ä»¥å›æº¯åˆ°ä¹‹å‰ä¸­æ–­çš„ä½ç½®è¿›è¡Œæ‰§è¡Œç›´åˆ°ä¸­æ–­ç»“æŸçš„ä½ç½®ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯æ—¢èƒ½ä¿è¯ä¸»æ•°æ®æµçš„å‡†å®æ—¶ç‰¹æ€§ï¼ŒåŒæ—¶é€šè¿‡å›å¡«æ•°æ®æµä¿è¯æ•°æ®çš„å®Œæ•´æ€§ã€‚ å¯¹äº ETL è€Œè¨€ï¼ŒåŸºäºæ•°æ®å›å¡«çš„å¹³å°å®¹é”™æœºåˆ¶åˆ™è¡¨ç°åœ¨ Airflow çš„å¹‚ç­‰è°ƒåº¦ç³»ç»Ÿã€åŸå­å‹ç¼©å’Œ HMS äº¤æ¢æ“ä½œã€åˆ†åŒºè‡ªå»ºè‡ªä¿®å¤ä½“ç³»å’Œ Schema æ•´åˆã€‚ å››ã€æ€»ç»“ä¸æœªæ¥å±•æœ› ä½“éªŒä¸ç»éªŒæ•™è®­åˆ©ç”¨ Flink èƒ½å¤Ÿå‡†å®æ—¶æ³¨å…¥ Parquet æ•°æ®ï¼Œä½¿å¾—äº¤äº’å¼æŸ¥è¯¢ä½“éªŒä¸ºå¯èƒ½ã€‚åŒæ—¶ï¼ŒFlink åœ¨ Lyft ä¸­çš„åº”ç”¨å¾ˆå¤šåœ°æ–¹ä¹Ÿéœ€è¦æé«˜ï¼Œè™½ç„¶ Flink åœ¨å¤§å¤šæ•°æƒ…å†µçš„å»¶æ—¶éƒ½èƒ½å¤Ÿå¾—åˆ°ä¿è¯ï¼Œä½†æ˜¯é‡å¯å’Œéƒ¨ç½²çš„æ—¶å€™ä»ç„¶å¯èƒ½é€ æˆåˆ†é’Ÿçº§åˆ«çš„å»¶æ—¶ï¼Œè¿™ä¼šå¯¹äº SLO äº§ç”Ÿä¸€å®šå½±å“ã€‚ æ­¤å¤–ï¼ŒLyft ç›®å‰åšçš„ä¸€ä»¶äº‹æƒ…å°±æ˜¯æ”¹å–„éƒ¨ç½²ç³»ç»Ÿä½¿å…¶èƒ½å¤Ÿæ”¯æŒ Kubernetesï¼Œå¹¶ä¸”ä½¿å¾—å…¶èƒ½å¤Ÿæ¥è¿‘ 0 å®•æœºæ—¶é—´çš„æ•ˆæœã€‚å› ä¸º Lyft å‡†å®æ—¶æ•°æ®åˆ†æå¹³å°åœ¨äº‘ç«¯è¿è¡Œï¼Œå› æ­¤åœ¨å°†æ•°æ®ä¸Šä¼ åˆ° S3 çš„æ—¶å€™ä¼šäº§ç”Ÿä¸€äº›éšæœºçš„ç½‘ç»œæƒ…å†µï¼Œé€ æˆ Sink Subtasks çš„åœæ»ï¼Œè¿›è€Œé€ æˆæ•´ä¸ª Flink Job çš„åœæ»ã€‚è€Œé€šè¿‡å¼•å…¥ä¸€äº› Time Out æœºåˆ¶æ¥æ£€æµ‹ Sink Subtasks çš„åœæ»ï¼Œä½¿å¾—æ•´ä¸ª Flink Job èƒ½å¤Ÿé¡ºåˆ©è¿è¡Œä¸‹å»ã€‚ ETL åˆ†åŒºæ„Ÿåº”èƒ½å¤Ÿé™ä½æˆæœ¬å’Œå»¶è¿Ÿï¼ŒæˆåŠŸæ–‡ä»¶åˆ™èƒ½å¤Ÿè¡¨ç¤ºä»€ä¹ˆæ—¶å€™å¤„ç†å®Œæˆã€‚æ­¤å¤–ï¼ŒS3 æ–‡ä»¶å¸ƒå±€å¯¹æ€§èƒ½æå‡çš„å½±å“è¿˜æ˜¯éå¸¸å¤§çš„ï¼Œç›®å‰è€Œè¨€å¼•å…¥ç†µæ•°è¿˜å±äºç»éªŒæ€»ç»“ï¼Œåç»­ Lyft ä¹Ÿä¼šå¯¹äºè¿™äº›è¿›è¡Œæ€»ç»“åˆ†æå¹¶ä¸”å…¬å¼€ã€‚å› ä¸ºä½¿ç”¨ Parquet æ•°æ®ï¼Œå› æ­¤å¯¹äº Schema çš„å…¼å®¹æ€§è¦æ±‚å°±éå¸¸é«˜ï¼Œå¦‚æœå¼•å…¥äº†ä¸å…¼å®¹äº‹ä»¶åˆ™ä¼šä½¿å¾—ä¸‹æ¸¸çš„ ETL ç˜«ç—ªï¼Œå› æ­¤ Lyft å·²ç»åšåˆ°çš„å°±æ˜¯åœ¨æ•°æ®é“¾è·¯ä¸Šæ¸¸å¯¹äº Schema çš„å…¼å®¹æ€§è¿›è¡Œæ£€æŸ¥ï¼Œæ£€æµ‹å¹¶æ‹’ç»ç”¨æˆ·æäº¤ä¸å…¼å®¹çš„ Schemaã€‚ æœªæ¥å±•æœ›Lyft å¯¹äºå‡†å®æ—¶æ•°æ®åˆ†æå¹³å°ä¹Ÿæœ‰ä¸€äº›è®¾æƒ³ã€‚ é¦–å…ˆï¼ŒLyft å¸Œæœ›å°† Flink éƒ¨ç½²åœ¨ Kubernetes é›†ç¾¤ç¯å¢ƒä¸‹è¿è¡Œï¼Œä½¿å¾— Kubernetes èƒ½å¤Ÿç®¡ç†è¿™äº› Flink Jobï¼ŒåŒæ—¶ä¹Ÿèƒ½å¤Ÿå……åˆ†åˆ©ç”¨ Kubernetes é›†ç¾¤çš„é«˜å¯æ‰©å±•æ€§ã€‚ å…¶æ¬¡ï¼ŒLyft ä¹Ÿå¸Œæœ›å®ç°é€šç”¨çš„æµæ•°æ®å¯¼å…¥æ¡†æ¶ï¼Œå‡†å®æ—¶æ•°æ®åˆ†æå¹³å°ä¸ä»…ä»…æ”¯æŒäº‹ä»¶ï¼Œä¹Ÿèƒ½å¤Ÿæ”¯æŒæ•°æ®åº“ä»¥åŠæœåŠ¡æ—¥å¿—ç­‰æ•°æ®ã€‚ å†æ¬¡ï¼ŒLyft å¸Œæœ›å¹³å°èƒ½å¤Ÿå®ç° ETL æ™ºèƒ½å‹ç¼©ä»¥åŠäº‹ä»¶é©±åŠ¨ ETLï¼Œä½¿å¾—å›å¡«ç­‰äº‹ä»¶èƒ½å¤Ÿè‡ªåŠ¨è§¦å‘ç›¸åº”çš„ ETL è¿‡ç¨‹ï¼Œå®ç°å’Œä»¥å‰çš„æ•°æ®çš„åˆå¹¶ï¼ŒåŒæ—¶å°†å»¶æ—¶æ•°æ®å¯¼å…¥æ¥å¯¹äº ETL è¿‡ç¨‹è¿›è¡Œæ›´æ–°ã€‚ æœ€åï¼ŒLyft è¿˜å¸Œæœ›å‡†å®æ—¶æ•°æ®åˆ†æå¹³å°èƒ½å¤Ÿå®ç°å­˜å‚¨è¿‡ç¨‹çš„æ”¹è¿›ä»¥åŠæŸ¥è¯¢ä¼˜åŒ–ï¼Œå€ŸåŠ© Parquet çš„ç»Ÿè®¡æ•°æ®æ¥æ”¹å–„ presto çš„æŸ¥è¯¢æ€§èƒ½ï¼Œå€ŸåŠ©è¡¨æ ¼ç®¡ç†ç›¸å…³çš„å¼€æºè½¯ä»¶å¯¹å­˜å‚¨ç®¡ç†è¿›è¡Œæ€§èƒ½æ”¹å–„ï¼ŒåŒæ—¶å®ç°æ›´å¤šçš„åŠŸèƒ½ã€‚ Flink Forward Asia 2019 PPT ä¸‹è½½é“¾æ¥ç»™ä½ ä»¬å‡†å¤‡å¥½å•¦ï¼å…¬ä¼—å·(zhisheng)é‡Œé¢å›å¤ ffa å³å¯ä¸‹è½½ï¼Œä¹Ÿå¯ä»¥æ‰«æä¸‹é¢çš„äºŒç»´ç å…³æ³¨ï¼Œå›å¤ ffa å³å¯ä¸‹è½½ã€‚ æ›´å¤š Flink åšå®¢Github ä»£ç ä»“åº“https://github.com/zhisheng17/flink-learning/ ä»¥åè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç éƒ½å°†æ”¾åœ¨è¿™ä¸ªä»“åº“é‡Œï¼ŒåŒ…å«äº†è‡ªå·±å­¦ä¹  flink çš„ä¸€äº› demo å’Œåšå®¢ã€‚ æœ¬æ–‡çš„é¡¹ç›®ä»£ç åœ¨ https://github.com/zhisheng17/flink-learning/tree/master/flink-learning-connectors/flink-learning-connectors-rabbitmq åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€å®æˆ˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"Flink Forward Asia 2019 PPT ä¸‹è½½","date":"2019-12-06T16:00:00.000Z","path":"2019/12/07/Flink_Forward_Asia_2019/","text":"Flink Forward Asia 2019 åœ¨åŒ—äº¬å¬å¼€çš„ï¼Œæœ‰ä¸»ä¼šåœºå’Œå‡ ä¸ªåˆ†ä¼šåœºï¼ˆä¼ä¸šå®è·µã€Apache Flink æ ¸å¿ƒæŠ€æœ¯ã€å¼€æºå¤§æ•°æ®ç”Ÿæ€ã€å®æ—¶æ•°ä»“ã€äººå·¥æ™ºèƒ½ï¼‰ï¼Œå†…å®¹æ¶‰åŠå¾ˆå¤šï¼Œå¯ä»¥æŸ¥çœ‹ä¸‹é¢çš„ PPTã€‚ ä¸»ä¼šåœº1ã€ã€ŠStateful Functions: Building general-purpose Applications and Services on Apache Flinkã€‹ 2ã€ã€ŠApache Flink Heading Towards A Unified Engineã€‹ 3ã€ã€ŠStorage Reimagined for a Streaming Worldã€‹ 4ã€ã€ŠLyft åŸºäº Apache Flink çš„å¤§è§„æ¨¡å‡†å®æ—¶æ•°æ®åˆ†æå¹³å°ã€‹ ä¼ä¸šå®è·µ1ã€ã€ŠApache Flink åœ¨å­—èŠ‚è·³åŠ¨çš„å®è·µä¸ä¼˜åŒ–ã€‹ 2ã€ã€ŠApache Flinkåœ¨å¿«æ‰‹å®æ—¶å¤šç»´åˆ†æåœºæ™¯çš„åº”ç”¨ã€‹ 3ã€ã€Šbilibili å®æ—¶å¹³å°çš„æ¶æ„ä¸å®è·µã€‹ 4ã€ã€ŠApache Flink èµ„æºåŠ¨æ€è°ƒæ•´åŠå…¶å®è·µã€‹ 5ã€ã€ŠApache Flinkåœ¨æ»´æ»´çš„åº”ç”¨ä¸å®è·µã€‹ 6ã€ã€ŠApache Flink åœ¨ç½‘æ˜“çš„å®è·µã€‹ 7ã€ã€ŠApache Flink åœ¨ä¸­å›½å†œä¸šé“¶è¡Œçš„æ¢ç´¢å’Œå®è·µã€‹ 8ã€ã€ŠåŸºäº Apache Flink çš„çˆ±å¥‡è‰ºå®æ—¶è®¡ç®—å¹³å°å»ºè®¾å®è·µã€‹ 9ã€ã€Šå®æ—¶è®¡ç®—åœ¨è´å£³çš„å®è·µã€‹ 10ã€ã€ŠåŸºäº Apache Flink æ„å»º CEPï¼ˆComplex Event Processï¼‰å¼•æ“çš„æŒ‘æˆ˜å’Œå®è·µã€‹ Apache Flink æ ¸å¿ƒæŠ€æœ¯1ã€ã€ŠPluggable Shuffle Service and Unaligned Checkpointã€‹ 2ã€ã€Šæ¼‚ç§»è®¡ç®— â€“ è·¨ DC è·¨æ•°æ®æºçš„é«˜æ€§èƒ½ SQL å¼•æ“ã€‹ 3ã€ã€ŠNew Source API â€“ Make it Easy! ã€‹ 4ã€ã€ŠStateful Functions: Unlocking the next wave of applications with Stream Processingã€‹ 5ã€ã€ŠApache Flinkæ–°åœºæ™¯â€”â€”OLAPå¼•æ“ã€‹ 6ã€ã€ŠNew Feature and Improvements on State Backends in Flink 1.10ã€‹ 7ã€ã€Šé˜¿é‡Œå·´å·´åœ¨ Apache Flink å¤§è§„æ¨¡æŒä¹…åŒ–å­˜å‚¨çš„å®è·µä¹‹é“ã€‹ 8ã€ã€ŠUsing Apache Flink as a Unified Data Processing Platformã€‹ 9ã€ã€Šæ·±å…¥æ¢ç´¢ Apache Flink SQL æµæ‰¹ç»Ÿä¸€çš„æŸ¥è¯¢å¼•æ“ä¸æœ€ä½³å®è·µã€‹ 10ã€ã€ŠApache Flink æµæ‰¹ä¸€ä½“çš„èµ„æºç®¡ç†ä¸ä»»åŠ¡è°ƒåº¦ã€‹ å¼€æºå¤§æ•°æ®ç”Ÿæ€1ã€ã€ŠYuniKorn å¯¹ Apache Flink on K8s çš„è°ƒåº¦ä¼˜åŒ–ã€‹ 2ã€ã€Šæµå¤„ç†åŸºå‡†æµ‹è¯•ã€‹ 3ã€ã€ŠApache Flink and the Apache Wayã€‹ 4ã€ã€ŠDelivering stream data reliably with Pravegaã€‹ 5ã€ã€ŠDeep dive into Pyflink &amp; integration with Zeppelinã€‹ 6ã€ã€ŠApache Flink ä¸ Apache Hive çš„é›†æˆã€‹ 7ã€ã€Šè¶£å¤´æ¡åŸºäº Apache Flink+ClickHouse æ„å»ºå®æ—¶æ•°æ®åˆ†æå¹³å°ã€‹ 8ã€ã€ŠåŸºäº Apache Flink çš„è¾¹ç¼˜æµå¼è®¡ç®—ã€‹ 9ã€ã€ŠåŸºäº Apache Pulsar å’Œ Apache Flink è¿›è¡Œæ‰¹æµä¸€ä½“çš„å¼¹æ€§æ•°æ®å¤„ç†ã€‹ 10ã€ã€ŠThe integretion of Apache Flink SQL and Apache Calciteã€‹ å®æ—¶æ•°ä»“1ã€ã€Šç¾å›¢ç‚¹è¯„åŸºäº Apache Flink çš„å®æ—¶æ•°ä»“å¹³å°å®è·µã€‹ 2ã€ã€Šå°ç±³æµå¼å¹³å°æ¶æ„æ¼”è¿›ä¸å®è·µã€‹ 3ã€ã€ŠNetflixï¼šEvolving Keystone to an Open Collaborative Real-time ETL Platformã€‹ 4ã€ã€Šèœé¸Ÿä¾›åº”é“¾å®æ—¶æ•°æ®æŠ€æœ¯æ¶æ„çš„æ¼”è¿›ã€‹ 5ã€ã€ŠOPPO åŸºäº Apache Flink çš„å®æ—¶æ•°ä»“å®è·µã€‹ äººå·¥æ™ºèƒ½1ã€ã€ŠDeep Learning On Apache Flinkã€‹ 2ã€ã€Šåœ¨ Apache Flink ä¸Šä½¿ç”¨ Analytics-Zoo è¿›è¡Œå¤§æ•°æ®åˆ†æä¸æ·±åº¦å­¦ä¹ æ¨¡å‹æ¨ç†çš„æ¶æ„ä¸å®è·µã€‹ 3ã€ã€Šæºç¨‹å®æ—¶æ™ºèƒ½æ£€æµ‹å¹³å°å®è·µã€‹ 4ã€ã€ŠåŸºäºApache Flinkçš„æœºå™¨å­¦ä¹ ç®—æ³•å¹³å°å®è·µä¸å¼€æºã€‹ 5ã€ã€ŠApache Flink AIç”Ÿæ€ç³»ç»Ÿå·¥ä½œã€‹ å¦‚ä½•è·å–ä¸Šé¢è¿™äº› PPTï¼Ÿä¸Šé¢çš„è¿™äº› PPT æœ¬äººå·²ç»æ•´ç†å¥½äº†ï¼Œä½ å¯ä»¥å…³æ³¨å¾®ä¿¡å…¬ä¼—å·ï¼šzhishengï¼Œç„¶ååœ¨é‡Œé¢å›å¤å…³é”®å­—: ffa å³å¯è·å–å·²æ”¾å‡ºçš„ PPTã€‚ å¦å¤–ä½ ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤š Flink çš„æ–‡ç« åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€åŸç†ã€å®æˆ˜ã€æ€§èƒ½è°ƒä¼˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"é˜¿é‡Œå·´å·´ Flink è¸©å‘ç»éªŒï¼šå¦‚ä½•å¤§å¹…é™ä½ HDFS å‹åŠ›ï¼Ÿ","date":"2019-11-29T16:00:00.000Z","path":"2019/11/30/flink-checkpoint-hdfs/","text":"ä¼—æ‰€å‘¨çŸ¥ï¼ŒFlink æ˜¯å½“å‰æœ€ä¸ºå¹¿æ³›ä½¿ç”¨çš„è®¡ç®—å¼•æ“ä¹‹ä¸€ï¼Œå®ƒä½¿ç”¨ Checkpoint æœºåˆ¶è¿›è¡Œå®¹é”™å¤„ç† [1]ï¼ŒCheckpoint ä¼šå°†çŠ¶æ€å¿«ç…§å¤‡ä»½åˆ°åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿï¼Œä¾›åç»­æ¢å¤ä½¿ç”¨ã€‚åœ¨ Alibaba å†…éƒ¨ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„å­˜å‚¨ä¸»è¦æ˜¯ HDFSï¼Œå½“åŒä¸€ä¸ªé›†ç¾¤çš„ Job åˆ°è¾¾ä¸€å®šæ•°é‡åï¼Œä¼šå¯¹ HDFS é€ æˆéå¸¸å¤§çš„å‹åŠ›ï¼Œæœ¬æ–‡å°†ä»‹ç»ä¸€ç§å¤§å¹…åº¦é™ä½ HDFS å‹åŠ›çš„æ–¹æ³•â€”â€”å°æ–‡ä»¶åˆå¹¶ã€‚ æœ¬æ–‡è½¬è‡ªï¼šhttps://www.infoq.cn/article/OLlJNzQpTOHfyrgOG8xq ä½œè€…ï¼šé‚±ä»è´¤ èƒŒæ™¯ä¸ç®¡ä½¿ç”¨ FsStateBackendã€RocksDBStateBackend è¿˜æ˜¯ NiagaraStateBackendï¼ŒFlink åœ¨è¿›è¡Œ Checkpoint çš„æ—¶å€™ï¼ŒTM ä¼šå°†çŠ¶æ€å¿«ç…§å†™åˆ°åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œç„¶åå°†æ–‡ä»¶å¥æŸ„å‘ç»™ JMï¼ŒJM å®Œæˆå…¨å±€ checkpoint å¿«ç…§çš„å­˜å‚¨ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ å¯¹äºå…¨é‡ Checkpoint æ¥è¯´ï¼ŒTM å°†æ¯ä¸ª Checkpoint å†…éƒ¨çš„æ•°æ®éƒ½å†™åˆ°åŒä¸€ä¸ªæ–‡ä»¶ï¼Œè€Œå¯¹äº RocksDBStateBackend/NiagaraStateBackend çš„å¢é‡ Checkpoint [2] æ¥è¯´ï¼Œåˆ™ä¼šå°†æ¯ä¸ª sst æ–‡ä»¶å†™åˆ°ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿçš„æ–‡ä»¶å†…ã€‚å½“ä½œä¸šé‡å¾ˆå¤§ï¼Œä¸”ä½œä¸šçš„å¹¶å‘å¾ˆå¤§æ—¶ï¼Œåˆ™ä¼šå¯¹åº•å±‚ HDFS å½¢æˆéå¸¸å¤§çš„å‹åŠ›ï¼š1ï¼‰å¤§é‡çš„ RPC è¯·æ±‚ä¼šå½±å“ RPC çš„å“åº”æ—¶é—´ï¼ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼‰ï¼›2ï¼‰å¤§é‡æ–‡ä»¶å¯¹ NameNode å†…å­˜é€ æˆå¾ˆå¤§å‹åŠ›ã€‚ åœ¨ Flink ä¸­æ›¾ç»å°è¯•ä½¿ç”¨ ByteStreamStateHandle æ¥è§£å†³å°æ–‡ä»¶å¤šçš„é—®é¢˜ [3]ï¼Œå°†å°äºä¸€å®šé˜ˆå€¼çš„ state ç›´æ¥å‘é€åˆ° JMï¼Œç”± JM ç»Ÿä¸€å†™åˆ°åˆ†å¸ƒå¼æ–‡ä»¶ä¸­ï¼Œä»è€Œé¿å…åœ¨ TM ç«¯ç”Ÿæˆå°æ–‡ä»¶ã€‚ä½†æ˜¯è¿™ä¸ªæ–¹æ¡ˆæœ‰ä¸€å®šçš„å±€é™æ€§ï¼Œé˜ˆå€¼è®¾ç½®å¤ªå°ï¼Œè¿˜ä¼šæœ‰å¾ˆå¤šå°æ–‡ä»¶ç”Ÿæˆï¼Œé˜ˆå€¼è®¾ç½®å¤ªå¤§ï¼Œåˆ™ä¼šå¯¼è‡´ JM å†…å­˜æ¶ˆè€—å¤ªå¤šæœ‰ OOM çš„é£é™©ã€‚ 1 å°æ–‡ä»¶åˆå¹¶æ–¹æ¡ˆé’ˆå¯¹ä¸Šé¢çš„é—®é¢˜æˆ‘ä»¬æå‡ºä¸€ç§è§£å†³æ–¹æ¡ˆâ€”â€”å°æ–‡ä»¶åˆå¹¶ã€‚ åœ¨åŸæ¥çš„å®ç°ä¸­ï¼Œæ¯ä¸ª sst æ–‡ä»¶ä¼šæ‰“å¼€ä¸€ä¸ª CheckpointOutputStreamï¼Œæ¯ä¸ª CheckpointOutputStream å¯¹åº”ä¸€ä¸ª FSDataOutputStreamï¼Œå°†æœ¬åœ°æ–‡ä»¶å†™å¾€ä¸€ä¸ªåˆ†å¸ƒå¼æ–‡ä»¶ï¼Œç„¶åå…³é—­ FSDataOutputStreamï¼Œç”Ÿæˆä¸€ä¸ª StateHandleã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å°æ–‡ä»¶åˆå¹¶åˆ™ä¼šé‡ç”¨æ‰“å¼€çš„ FSDataOutputStreamï¼Œç›´è‡³æ–‡ä»¶å¤§å°è¾¾åˆ°é¢„è®¾çš„é˜ˆå€¼ä¸ºæ­¢ï¼Œæ¢å¥è¯è¯´å¤šä¸ª sst æ–‡ä»¶ä¼šé‡ç”¨åŒä¸€ä¸ª DFS ä¸Šçš„æ–‡ä»¶ï¼Œæ¯ä¸ª sst æ–‡ä»¶å ç”¨ DFS æ–‡ä»¶ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œæœ€ç»ˆå¤šä¸ª StateHandle å…±ç”¨ä¸€ä¸ªç‰©ç†æ–‡ä»¶ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ åœ¨æ¥ä¸‹æ¥çš„ç« èŠ‚ä¸­æˆ‘ä»¬ä¼šæè¿°å®ç°çš„ç»†èŠ‚ï¼Œå…¶ä¸­éœ€è¦é‡ç‚¹è€ƒè™‘çš„åœ°æ–¹åŒ…æ‹¬ï¼š å¹¶å‘ Checkpoint çš„æ”¯æŒ Flink å¤©ç”Ÿæ”¯æŒå¹¶å‘ Checkpointï¼Œå°æ–‡ä»¶åˆå¹¶æ–¹æ¡ˆåˆ™ä¼šå°†å¤šä¸ªæ–‡ä»¶å†™å¾€åŒä¸€ä¸ªåˆ†å¸ƒå¼å­˜å‚¨æ–‡ä»¶ä¸­ï¼Œå¦‚æœè€ƒè™‘ä¸å½“ï¼Œæ•°æ®ä¼šå†™ä¸²æˆ–è€…æŸåï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æœ‰ä¸€ç§æœºåˆ¶ä¿è¯è¯¥æ–¹æ¡ˆçš„æ­£ç¡®æ€§ï¼Œè¯¦ç»†æè¿°å‚è€ƒ 2.1 èŠ‚ã€‚ é˜²æ­¢è¯¯åˆ æ–‡ä»¶ æˆ‘ä»¬ä½¿ç”¨å¼•ç”¨è®¡æ•°æ¥è®°å½•æ–‡ä»¶çš„ä½¿ç”¨æƒ…å†µï¼Œä»…é€šè¿‡æ–‡ä»¶å¼•ç”¨è®¡æ•°æ˜¯å¦é™ä¸º 0 è¿›è¡Œåˆ¤æ–­åˆ é™¤ï¼Œåˆ™å¯èƒ½è¯¯åˆ æ–‡ä»¶ï¼Œå¦‚ä½•ä¿è¯æ–‡ä»¶ä¸ä¼šè¢«é”™è¯¯åˆ é™¤ï¼Œæˆ‘ä»¬å°†ä¼šåœ¨ 2.2 èŠ‚è¿›è¡Œé˜è¿°ã€‚ é™ä½ç©ºé—´æ”¾å¤§ ä½¿ç”¨å°æ–‡ä»¶åˆå¹¶ä¹‹åï¼Œåªè¦æ–‡ä»¶ä¸­è¿˜æœ‰ä¸€ä¸ª statehandle è¢«ä½¿ç”¨ï¼Œæ•´ä¸ªåˆ†å¸ƒå¼æ–‡ä»¶å°±ä¸èƒ½è¢«åˆ é™¤ï¼Œå› æ­¤ä¼šå ç”¨æ›´å¤šçš„ç©ºé—´ï¼Œæˆ‘ä»¬åœ¨ 2.3 èŠ‚æè¿°äº†è§£å†³è¯¥é—®é¢˜çš„è¯¦ç»†æ–¹æ¡ˆã€‚ å¼‚å¸¸å¤„ç† æˆ‘ä»¬å°†åœ¨ 2.4 èŠ‚é˜è¿°å¦‚ä½•å¤„ç†å¼‚å¸¸æƒ…å†µï¼ŒåŒ…æ‹¬ JM å¼‚å¸¸å’Œ TM å¼‚å¸¸çš„æƒ…å†µã€‚ 2.5 èŠ‚ä¸­ä¼šè¯¦ç»†æè¿°åœ¨ Checkpoint è¢«å–æ¶ˆæˆ–è€…å¤±è´¥åï¼Œå¦‚ä½•å–æ¶ˆ TM ç«¯çš„ Snapshotï¼Œå¦‚æœä¸å–æ¶ˆ TM ç«¯çš„ Snapshotï¼Œåˆ™ä¼šå¯¼è‡´ TM ç«¯å®é™…è¿è¡Œçš„ Snapshot æ¯”æ­£å¸¸çš„å¤šã€‚ åœ¨ç¬¬ 3 èŠ‚ä¸­é˜è¿°äº†å°æ–‡ä»¶åˆå¹¶æ–¹æ¡ˆä¸ç°æœ‰æ–¹æ¡ˆçš„å…¼å®¹æ€§ï¼›ç¬¬ 4 èŠ‚åˆ™ä¼šæè¿°å°æ–‡ä»¶åˆå¹¶æ–¹æ¡ˆçš„ä¼˜åŠ¿å’Œä¸è¶³ï¼›æœ€ååœ¨ç¬¬ 5 èŠ‚æˆ‘ä»¬å±•ç¤ºåœ¨ç”Ÿäº§ç¯å¢ƒä¸‹å–å¾—çš„æ•ˆæœã€‚ 2 è®¾è®¡å®ç°æœ¬èŠ‚ä¸­æˆ‘ä»¬ä¼šè¯¦ç»†æè¿°æ•´ä¸ªå°æ–‡ä»¶åˆå¹¶çš„ç»†èŠ‚ï¼Œä»¥åŠå…¶ä¸­çš„è®¾è®¡è¦ç‚¹ã€‚ è¿™é‡Œæˆ‘ä»¬å¤§è‡´å›å¿†ä¸€ä¸‹ TM ç«¯ Snapshot çš„è¿‡ç¨‹ï¼š TM ç«¯ barrier å¯¹é½ TM Snapshot åŒæ­¥æ“ä½œ TM Snapshot å¼‚æ­¥æ“ä½œ å…¶ä¸­ä¸Šä¼  sst æ–‡ä»¶åˆ°åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿåœ¨ä¸Šé¢çš„ç¬¬ä¸‰æ­¥ï¼ŒåŒä¸€ä¸ª Checkpoint å†…çš„æ–‡ä»¶é¡ºåºä¸Šä¼ ï¼Œå¤šä¸ª Checkpoint çš„æ–‡ä»¶ä¸Šä¼ å¯èƒ½åŒæ—¶è¿›è¡Œã€‚ 2.1 å¹¶å‘ Checkpoint æ”¯æŒFlink å¤©ç”Ÿæ”¯æŒå¹¶å‘ Checkpointï¼Œå› æ­¤å°æ–‡ä»¶åˆå¹¶æ–¹æ¡ˆä¹Ÿéœ€è¦èƒ½å¤Ÿæ”¯æŒå¹¶å‘ Checkpointï¼Œå¦‚æœä¸åŒ Checkpoint çš„ sst æ–‡ä»¶åŒæ—¶å†™å¾€ä¸€ä¸ªåˆ†å¸ƒå¼æ–‡ä»¶ï¼Œåˆ™ä¼šå¯¼è‡´æ–‡ä»¶å†…å®¹æŸåï¼Œåç»­æ— æ³•ä»è¯¥æ–‡ä»¶è¿›è¡Œ restoreã€‚ åœ¨ FLINK-11937[4] çš„ææ¡ˆä¸­ï¼Œæˆ‘ä»¬ä¼šå°†æ¯ä¸ª Checkpoint çš„ state æ–‡ä»¶å†™åˆ°åŒä¸€ä¸ª HDFS æ–‡ä»¶ï¼Œä¸åŒ Checkpoint çš„ state å†™åˆ°ä¸åŒçš„ HDFS æ–‡ä»¶ â€“ æ¢å¥è¯è¯´ï¼ŒHDFS æ–‡ä»¶ä¸è·¨ Checkpoint å…±ç”¨ï¼Œä»è€Œé¿å…äº†å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶å†™å…¥åŒä¸€ä¸ªæ–‡ä»¶çš„æƒ…å†µã€‚ åç»­æˆ‘ä»¬ä¼šç»§ç»­æ¨è¿›è·¨ Checkpoint å…±ç”¨æ–‡ä»¶çš„æ–¹æ¡ˆï¼Œå½“ç„¶åœ¨è·¨ Checkpoint å…±ç”¨æ–‡ä»¶çš„æ–¹æ¡ˆä¸­ï¼Œå¹¶è¡Œçš„ Checkpoint ä¹Ÿä¼šå†™å¾€ä¸åŒçš„ HDFS æ–‡ä»¶ã€‚ 2.2 é˜²æ­¢è¯¯åˆ æ–‡ä»¶å¤ç”¨åº•å±‚æ–‡ä»¶ä¹‹åï¼Œæˆ‘ä»¬ä½¿ç”¨å¼•ç”¨è®¡æ•°è¿½è¸ªæ–‡ä»¶çš„ä½¿ç”¨æƒ…å†µï¼Œåœ¨æ–‡ä»¶å¼•ç”¨æ•°é™ä¸º 0 çš„æƒ…å†µä¸‹åˆ é™¤æ–‡ä»¶ã€‚ä½†æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ–‡ä»¶å¼•ç”¨æ•°ä¸º 0 çš„æ—¶å€™ï¼Œå¹¶ä¸ä»£è¡¨æ–‡ä»¶ä¸ä¼šè¢«ç»§ç»­ä½¿ç”¨ï¼Œå¯èƒ½å¯¼è‡´æ–‡ä»¶è¯¯åˆ ã€‚ä¸‹é¢æˆ‘ä»¬ä¼šè¯¦ç»†æè¿°å¼€å¯å¹¶å‘ Checkpoint åå¯èƒ½å¯¼è‡´æ–‡ä»¶è¯¯åˆ çš„æƒ…å†µï¼Œä»¥åŠè§£å†³æ–¹æ¡ˆã€‚ ä»¥ä¸‹å›¾ä¸ºä¾‹ï¼ŒmaxConcurrentlyCheckpoint = 2 ä¸Šå›¾ä¸­å…±æœ‰ 3 ä¸ª Checkpointï¼Œå…¶ä¸­ chk-1 å·²ç»å®Œæˆï¼Œchk-2 å’Œ chk-3 éƒ½åŸºäº chk-1 è¿›è¡Œï¼Œchk-2 åœ¨ chk-3 å‰å®Œæˆï¼Œchk-3 åœ¨æ³¨å†Œ 4.sst çš„æ—¶å€™å‘ç°ï¼Œå‘ç° 4.sst åœ¨ chk-2 ä¸­å·²ç»æ³¨å†Œè¿‡ï¼Œä¼šé‡ç”¨ chk-2 ä¸­ 4.sst å¯¹åº”çš„ stateHandleï¼Œç„¶åå–æ¶ˆ chk-3 ä¸­çš„ 4.sst çš„æ³¨å†Œï¼Œå¹¶ä¸”åˆ é™¤ stateHandleï¼Œåœ¨å¤„ç†å®Œ chk-3 ä¸­ 4.sst ä¹‹åï¼Œè¯¥ stateHandle å¯¹åº”çš„åˆ†å¸ƒå¼æ–‡ä»¶çš„å¼•ç”¨è®¡æ•°ä¸º 0ï¼Œå¦‚æœæˆ‘ä»¬è¿™ä¸ªæ—¶å€™åˆ é™¤åˆ†å¸ƒå¼æ–‡ä»¶ï¼Œåˆ™ä¼šåŒæ—¶åˆ é™¤ 5.sst å¯¹åº”çš„å†…å®¹ï¼Œå¯¼è‡´åç»­æ— æ³•ä» chk-3 æ¢å¤ã€‚ è¿™é‡Œçš„é—®é¢˜æ˜¯å¦‚ä½•åœ¨ stateHandle å¯¹åº”çš„åˆ†å¸ƒå¼æ–‡ä»¶å¼•ç”¨è®¡æ•°é™ä¸º 0 çš„æ—¶å€™æ­£ç¡®åˆ¤æ–­æ˜¯å¦è¿˜ä¼šç»§ç»­å¼•ç”¨è¯¥æ–‡ä»¶ï¼Œå› æ­¤åœ¨æ•´ä¸ª Checkpoint å®Œæˆå¤„ç†ä¹‹åå†åˆ¤æ–­æŸä¸ªåˆ†å¸ƒå¼æ–‡ä»¶èƒ½å¦åˆ é™¤ï¼Œå¦‚æœçœŸä¸ª Checkpoint å®Œæˆå‘ç°æ–‡ä»¶æ²¡æœ‰è¢«å¼•ç”¨ï¼Œåˆ™å¯ä»¥å®‰å…¨åˆ é™¤ï¼Œå¦åˆ™ä¸è¿›è¡Œåˆ é™¤ã€‚ 2.3 é™ä½ç©ºé—´æ”¾å¤§ä½¿ç”¨å°æ–‡ä»¶åˆå¹¶æ–¹æ¡ˆåï¼Œæ¯ä¸ª sst æ–‡ä»¶å¯¹åº”åˆ†å¸ƒå¼æ–‡ä»¶ä¸­çš„ä¸€ä¸ª segmentï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æ–‡ä»¶ä»…èƒ½åœ¨æ‰€æœ‰ segment éƒ½ä¸å†ä½¿ç”¨æ—¶è¿›è¡Œåˆ é™¤ï¼Œä¸Šå›¾ä¸­æœ‰ 4 ä¸ª segmentï¼Œä»… segment-4 è¢«ä½¿ç”¨ï¼Œä½†æ˜¯æ•´ä¸ªæ–‡ä»¶éƒ½ä¸èƒ½åˆ é™¤ï¼Œå…¶ä¸­ segment[1-3] çš„ç©ºé—´è¢«æµªè´¹æ‰äº†ï¼Œä»å®é™…ç”Ÿäº§ç¯å¢ƒä¸­çš„æ•°æ®å¯çŸ¥ï¼Œæ•´ä½“çš„ç©ºé—´æ”¾å¤§ç‡ï¼ˆå®é™…å ç”¨çš„ç©ºé—´ / çœŸå®æœ‰ç”¨çš„ç©ºé—´ï¼‰åœ¨ 1.3 - 1.6 ä¹‹é—´ã€‚ ä¸ºäº†è§£å†³ç©ºé—´æ”¾å¤§çš„é—®é¢˜ï¼Œåœ¨ TM ç«¯èµ·å¼‚æ­¥çº¿ç¨‹å¯¹æ”¾å¤§ç‡è¶…è¿‡é˜ˆå€¼çš„æ–‡ä»¶è¿›è¡Œå‹ç¼©ã€‚è€Œä¸”ä»…å¯¹å·²ç»å…³é—­çš„æ–‡ä»¶è¿›è¡Œå‹ç¼©ã€‚ æ•´ä¸ªå‹ç¼©çš„æµç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š è®¡ç®—æ¯ä¸ªæ–‡ä»¶çš„æ”¾å¤§ç‡ å¦‚æœæ”¾å¤§ç‡è¾ƒå°åˆ™ç›´æ¥è·³åˆ°æ­¥éª¤ 7 å¦‚æœæ–‡ä»¶ A çš„æ”¾å¤§ç‡è¶…è¿‡é˜ˆå€¼ï¼Œåˆ™ç”Ÿæˆä¸€ä¸ªå¯¹åº”çš„æ–°æ–‡ä»¶ Aâ€˜ï¼ˆå¦‚æœè¿™ä¸ªè¿‡ç¨‹ä¸­åˆ›å»ºæ–‡ä»¶å¤±è´¥ï¼Œåˆ™ç”± TM è´Ÿè´£æ¸…ç†å·¥ä½œï¼‰ è®°å½• A ä¸ Aâ€™ çš„æ˜ å°„å…³ç³» åœ¨ä¸‹ä¸€æ¬¡ Checkpoint X å¾€ JM å‘é€è½åœ¨æ–‡ä»¶ A ä¸­çš„ StateHandle æ—¶ï¼Œåˆ™ä½¿ç”¨ A` ä¸­çš„ä¿¡æ¯ç”Ÿæˆä¸€ä¸ªæ–°çš„ StateHandle å‘é€ç»™ JM Checkpoint X å®Œæˆåï¼Œæˆ‘ä»¬å¢åŠ  Aâ€˜ çš„å¼•ç”¨è®¡æ•°ï¼Œå‡å°‘ A çš„å¼•ç”¨è®¡æ•°ï¼Œåœ¨å¼•ç”¨è®¡æ•°é™ä¸º 0 åå°†æ–‡ä»¶ A åˆ é™¤ï¼ˆå¦‚æœ JM å¢åŠ äº† Aâ€™ çš„å¼•ç”¨ï¼Œç„¶åå‡ºç°å¼‚å¸¸ï¼Œåˆ™ä¼šä»ä¸Šæ¬¡æˆåŠŸçš„ Checkpoint é‡æ–°æ„å»ºæ•´ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼‰ æ–‡ä»¶å‹ç¼©å®Œæˆ 2.4 å¼‚å¸¸æƒ…å†µå¤„ç†åœ¨ Checkpoint çš„è¿‡ç¨‹ä¸­ï¼Œä¸»è¦æœ‰ä¸¤ç§å¼‚å¸¸ï¼šJM å¼‚å¸¸å’Œ TM å¼‚å¸¸ï¼Œæˆ‘ä»¬å°†åˆ†æƒ…å†µé˜è¿°ã€‚ 2.4.1 JM å¼‚å¸¸JM ç«¯ä¸»è¦è®°å½• StateHandle ä»¥åŠæ–‡ä»¶çš„å¼•ç”¨è®¡æ•°ï¼Œå¼•ç”¨è®¡æ•°ç›¸å…³æ•°æ®ä¸éœ€è¦æŒä¹…åŒ–åˆ°å¤–å­˜ä¸­ï¼Œå› æ­¤ä¸éœ€è¦ç‰¹æ®Šçš„å¤„ç†ï¼Œä¹Ÿä¸éœ€è¦è€ƒè™‘ transaction ç­‰ç›¸å…³æ“ä½œï¼Œå¦‚æœ JM å‘é€ failoverï¼Œåˆ™å¯ä»¥ç›´æ¥ä»æœ€è¿‘ä¸€æ¬¡ complete Checkpoint æ¢å¤ï¼Œå¹¶é‡å»ºå¼•ç”¨è®¡æ•°å³å¯ã€‚ 2.4.2 TM å¼‚å¸¸TM å¼‚å¸¸å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼š1ï¼‰è¯¥æ–‡ä»¶åœ¨ä¹‹å‰ Checkpoint ä¸­å·²ç»æ±‡æŠ¥è¿‡ç»™ JMï¼›2ï¼‰æ–‡ä»¶å°šæœªæ±‡æŠ¥è¿‡ç»™ JMï¼Œæˆ‘ä»¬ä¼šåˆ†æƒ…å†µé˜è¿°ã€‚ æ–‡ä»¶å·²ç»æ±‡æŠ¥è¿‡ç»™ JM æ–‡ä»¶æ±‡æŠ¥è¿‡ç»™ JMï¼Œå› æ­¤åœ¨ JM ç«¯æœ‰æ–‡ä»¶çš„å¼•ç”¨è®¡æ•°ï¼Œæ–‡ä»¶çš„åˆ é™¤ç”± JM æ§åˆ¶ï¼Œå½“æ–‡ä»¶çš„å¼•ç”¨è®¡æ•°å˜ä¸º 0 ä¹‹åï¼ŒJM å°†åˆ é™¤è¯¥æ–‡ä»¶ã€‚ æ–‡ä»¶å°šæœªæ±‡æŠ¥ç»™ JM è¯¥æ–‡ä»¶æš‚æ—¶å°šæœªæ±‡æŠ¥è¿‡ç»™ JMï¼Œè¯¥æ–‡ä»¶ä¸å†è¢«ä½¿ç”¨ï¼Œä¹Ÿä¸ä¼šè¢« JM æ„ŸçŸ¥ï¼Œæˆä¸ºå­¤å„¿æ–‡ä»¶ã€‚è¿™ç§æƒ…å†µæš‚æ—¶æœ‰å¤–å›´å·¥å…·ç»Ÿä¸€è¿›è¡Œæ¸…ç†ã€‚ 2.5 å–æ¶ˆ TM ç«¯ snapshotåƒå‰é¢ç« èŠ‚æ‰€è¯´ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ Checkpoint è¶…æ—¶ / å¤±è´¥æ—¶ï¼Œå–æ¶ˆ TM ç«¯çš„ snapshotï¼Œè€Œ Flink åˆ™æ²¡æœ‰ç›¸åº”çš„é€šçŸ¥æœºåˆ¶ï¼Œç°åœ¨ FLINK-8871[5] åœ¨è¿½è¸ªç›¸åº”çš„ä¼˜åŒ–ï¼Œæˆ‘ä»¬åœ¨å†…éƒ¨å¢åŠ äº†ç›¸å…³å®ç°ï¼Œå½“ Checkpoint å¤±è´¥æ—¶ä¼šå‘é€ RPC æ•°æ®ç»™ TMï¼ŒTM ç«¯æ¥å—åˆ°ç›¸åº”çš„ RPC æ¶ˆæ¯åï¼Œä¼šå–æ¶ˆç›¸åº”çš„ snapshotã€‚ 3 å…¼å®¹æ€§å°æ–‡ä»¶åˆå¹¶åŠŸèƒ½æ”¯æŒä»ä¹‹å‰çš„ç‰ˆæœ¬æ— ç¼è¿ç§»è¿‡æ¥ã€‚ä»ä¹‹å‰çš„ Checkpoint restore çš„çš„æ­¥éª¤å¦‚ä¸‹ï¼š æ¯ä¸ª TM åˆ†åˆ°è‡ªå·±éœ€è¦ restore çš„ state handle TM ä»è¿œç¨‹ä¸‹è½½ state handle å¯¹åº”çš„æ•°æ® ä»æœ¬åœ°è¿›è¡Œæ¢å¤ å°æ–‡ä»¶åˆå¹¶ä¸»è¦å½±å“çš„æ˜¯ç¬¬ 2 æ­¥ï¼Œä»è¿œç¨‹ä¸‹è½½å¯¹åº”æ•°æ®çš„æ—¶å€™å¯¹ä¸åŒçš„ StateHandle è¿›è¡Œé€‚é…ï¼Œå› æ­¤ä¸å½±å“æ•´ä½“çš„å…¼å®¹æ€§ã€‚ 4 ä¼˜åŠ¿å’Œä¸è¶³ ä¼˜åŠ¿ï¼šå¤§å¹…åº¦é™ä½ HDFS çš„å‹åŠ›ï¼šåŒ…æ‹¬ RPC å‹åŠ›ä»¥åŠ NameNode å†…å­˜çš„å‹åŠ› ä¸è¶³ï¼šä¸æ”¯æŒ State å¤šçº¿ç¨‹ä¸Šä¼ çš„åŠŸèƒ½ï¼ˆState ä¸Šä¼ æš‚æ—¶ä¸æ˜¯ Checkpoint çš„ç“¶é¢ˆï¼‰ 5 çº¿ä¸Šç¯å¢ƒçš„ç»“æœåœ¨è¯¥æ–¹æ¡ˆä¸Šçº¿åï¼Œå¯¹ Namenode çš„å‹åŠ›å¤§å¹…é™ä½ï¼Œä¸‹é¢çš„æˆªå›¾æ¥è‡ªçº¿ä¸Šç”Ÿäº§é›†ç¾¤ï¼Œä»æ•°æ®æ¥çœ‹ï¼Œæ–‡ä»¶åˆ›å»ºå’Œå…³é—­çš„ RPC æœ‰æ˜æ˜¾ä¸‹é™ï¼ŒRPC çš„å“åº”æ—¶é—´ä¹Ÿæœ‰å¤§å¹…åº¦é™ä½ï¼Œç¡®ä¿é¡ºåˆ©åº¦è¿‡åŒåä¸€ã€‚ å‚è€ƒæ–‡çŒ®[1] https://ci.apache.org/projects/flink/flink-docs-stable/ops/state/checkpoints.html [2] https://flink.apache.org/features/2018/01/30/incremental-checkpointing.html [3] https://www.slideshare.net/dataArtisans/stephan-ewen-experiences-running-flink-at-very-large-scale [4] https://issues.apache.org/jira/browse/FLINK-11937 [5] https://issues.apache.org/jira/browse/FLINK-8871 æœ€åGitHub Flink å­¦ä¹ ä»£ç åœ°å€ï¼šhttps://github.com/zhisheng17/flink-learning å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ ä¸“æ ä»‹ç»é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€åŸç†ã€å®æˆ˜ã€æ€§èƒ½è°ƒä¼˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"58 åŒåŸåŸºäº Flink çš„åƒäº¿çº§å®æ—¶è®¡ç®—å¹³å°æ¶æ„å®è·µ","date":"2019-11-29T16:00:00.000Z","path":"2019/11/30/flink-in-58/","text":"58 åŒåŸä½œä¸ºè¦†ç›–ç”Ÿæ´»å…¨é¢†åŸŸçš„æœåŠ¡å¹³å°ï¼Œä¸šåŠ¡è¦†ç›–æ‹›è˜ã€æˆ¿äº§ã€æ±½è½¦ã€é‡‘èã€äºŒæ‰‹åŠæœ¬åœ°æœåŠ¡ç­‰å„ä¸ªæ–¹é¢ã€‚ä¸°å¯Œçš„ä¸šåŠ¡çº¿å’Œåºå¤§çš„ç”¨æˆ·æ•°æ¯å¤©äº§ç”Ÿæµ·é‡ç”¨æˆ·æ•°æ®éœ€è¦å®æ—¶åŒ–çš„è®¡ç®—åˆ†æï¼Œå®æ—¶è®¡ç®—å¹³å°å®šä½äºä¸ºé›†å›¢æµ·é‡æ•°æ®æä¾›é«˜æ•ˆã€ç¨³å®šã€åˆ†å¸ƒå¼å®æ—¶è®¡ç®—çš„åŸºç¡€æœåŠ¡ã€‚æœ¬æ–‡ä¸»è¦ä»‹ç» 58 åŒåŸåŸºäº Flink æ‰“é€ çš„ä¸€ç«™å¼å®æ—¶è®¡ç®—å¹³å° Wstreamã€‚ æœ¬æ–‡è½¬è‡ªï¼šdbaplus ç¤¾ç¾¤å…¬ä¼—å· ä½œè€…ï¼šå†¯æµ·æ¶› / ä¸‡çŸ³åº·ï¼Œè´Ÿè´£ 58 åŒåŸå®æ—¶è®¡ç®—å¹³å°å»ºè®¾ã€‚ å®æ—¶è®¡ç®—åœºæ™¯å’Œå¾ˆå¤šäº’è”ç½‘å…¬å¸ä¸€æ ·ï¼Œå®æ—¶è®¡ç®—åœ¨ 58 æ‹¥æœ‰ä¸°å¯Œçš„åœºæ™¯éœ€æ±‚ï¼Œä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ç±»ï¼š å®æ—¶æ•°æ® ETLï¼šå®æ—¶æ¶ˆè´¹ Kafka æ•°æ®è¿›è¡Œæ¸…æ´—ã€è½¬æ¢ã€ç»“æ„åŒ–å¤„ç†ç”¨äºä¸‹æ¸¸è®¡ç®—å¤„ç†ã€‚ å®æ—¶æ•°ä»“ï¼šå®æ—¶åŒ–æ•°æ®è®¡ç®—ï¼Œä»“åº“æ¨¡å‹åŠ å·¥å’Œå­˜å‚¨ã€‚å®æ—¶åˆ†æä¸šåŠ¡åŠç”¨æˆ·å„ç±»æŒ‡æ ‡ï¼Œè®©è¿è¥æ›´åŠ å®æ—¶åŒ–ã€‚ å®æ—¶ç›‘æ§ï¼šå¯¹ç³»ç»Ÿå’Œç”¨æˆ·è¡Œä¸ºè¿›è¡Œå®æ—¶æ£€æµ‹å’Œåˆ†æï¼Œå¦‚ä¸šåŠ¡æŒ‡æ ‡å®æ—¶ç›‘æ§ï¼Œè¿ç»´çº¿ä¸Šç¨³å®šæ€§ç›‘æ§ï¼Œé‡‘èé£æ§ç­‰ã€‚ å®æ—¶åˆ†æï¼šç‰¹å¾å¹³å°ï¼Œç”¨æˆ·ç”»åƒï¼Œå®æ—¶ä¸ªæ€§åŒ–æ¨èç­‰ã€‚ å¹³å°æ¼”è¿› åœ¨å®æ—¶è®¡ç®—å¹³å°å»ºè®¾è¿‡ç¨‹ä¸­ï¼Œä¸»è¦æ˜¯è·Ÿè¿›å¼€æºç¤¾åŒºå‘å±•ä»¥åŠå®é™…ä¸šåŠ¡éœ€æ±‚ï¼Œè®¡ç®—æ¡†æ¶ç»å†äº† Storm åˆ° Spark Streaming åˆ° Flink çš„å‘å±•ï¼ŒåŒæ—¶å»ºè®¾ä¸€ç«™å¼å®æ—¶è®¡ç®—å¹³å°ï¼Œæ—¨åœ¨æå‡ç”¨æˆ·å®æ—¶è®¡ç®—éœ€æ±‚å¼€å‘ä¸Šçº¿ç®¡ç†ç›‘æ§æ•ˆç‡ï¼Œä¼˜åŒ–å¹³å°ç®¡ç†ã€‚ å®æ—¶è®¡ç®—å¼•æ“å‰æœŸåŸºäº Storm å’Œ Spark Streaming æ„å»º, å¾ˆå¤šæƒ…å†µä¸‹å¹¶ä¸èƒ½å¾ˆå¥½çš„æ»¡è¶³ä¸šåŠ¡éœ€æ±‚ï¼Œå¦‚å•†ä¸šéƒ¨é—¨åŸºäº Spark Streaming æ„å»ºçš„ç‰¹å¾å¹³å°å¸Œæœ›å°†è®¡ç®—å»¶è¿Ÿç”±åˆ†é’Ÿçº§é™ä½åˆ°ç§’çº§ï¼Œæå‡ç”¨æˆ·ä½“éªŒï¼Œè¿ç»´ç›‘æ§å¹³å°åŸºäº Storm åˆ†æå…¬å¸å…¨é‡ nginx æ—¥å¿—å¯¹çº¿ä¸Šä¸šåŠ¡è¿›è¡Œç›‘æ§ï¼Œéœ€è¦ç§’çº§ç”šè‡³æ¯«ç§’çº§åˆ«çš„å»¶è¿Ÿï¼ŒStorm çš„ååèƒ½åŠ›æˆä¸ºç“¶é¢ˆã€‚ åŒæ—¶éšç€å®æ—¶éœ€æ±‚ä¸æ–­å¢åŠ ï¼Œåœºæ™¯æ›´åŠ ä¸°å¯Œï¼Œåœ¨è¿½æ±‚ä»»åŠ¡é«˜ååä½å»¶è¿Ÿçš„åŸºç¡€ä¸Šï¼Œå¯¹è®¡ç®—è¿‡ç¨‹ä¸­é—´çŠ¶æ€ç®¡ç†ï¼Œçµæ´»çª—å£æ”¯æŒï¼Œä»¥åŠ exactly once è¯­ä¹‰ä¿éšœçš„è¯‰æ±‚è¶Šæ¥è¶Šå¤šã€‚Apache Flink å¼€æºä¹‹åï¼Œæ”¯æŒé«˜ååä½å»¶è¿Ÿçš„æ¶æ„è®¾è®¡ä»¥åŠé«˜å¯ç”¨çš„ç¨³å®šæ€§ï¼ŒåŒæ—¶æ‹¥æœ‰å®æ—¶è®¡ç®—åœºæ™¯ä¸€ç³»åˆ—ç‰¹æ€§ä»¥åŠæ”¯æŒå®æ—¶ Sql æ¨¡å‹ï¼Œä½¿æˆ‘ä»¬å†³å®šé‡‡ç”¨ Flink ä½œä¸ºæ–°ä¸€ä»£å®æ—¶è®¡ç®—å¹³å°çš„è®¡ç®—å¼•æ“ã€‚ å¹³å°è§„æ¨¡ å®æ—¶è®¡ç®—å¹³å°å½“å‰ä¸»è¦åŸºäº Storm/Spark Streaming/Flinkï¼Œé›†ç¾¤å…±è®¡ 500 å¤šå°æœºå™¨ï¼Œæ¯å¤©å¤„ç†æ•°æ®é‡ 6000 äº¿ +ï¼Œå…¶ä¸­ Flink ç»è¿‡è¿‘ä¸€å¹´çš„å»ºè®¾ï¼Œä»»åŠ¡å æ¯”å·²ç»è¾¾åˆ° 50%ã€‚ Flink ç¨³å®šæ€§Flink ä½œä¸ºå®æ—¶è®¡ç®—é›†ç¾¤ï¼Œå¯ç”¨æ€§è¦æ±‚è¿œé«˜äºç¦»çº¿è®¡ç®—é›†ç¾¤ã€‚ä¸ºä¿éšœé›†ç¾¤å¯ç”¨æ€§ï¼Œå¹³å°ä¸»è¦é‡‡ç”¨ä»»åŠ¡éš”ç¦»ä»¥åŠé«˜å¯ç”¨é›†ç¾¤æ¶æ„ä¿éšœç¨³å®šæ€§ã€‚ ä»»åŠ¡éš”ç¦»åœ¨åº”ç”¨å±‚é¢ä¸»è¦åŸºäºä¸šåŠ¡çº¿ä»¥åŠåœºæ™¯è¿›è¡Œæœºå™¨éš”ç¦»ï¼Œé˜Ÿåˆ—èµ„æºåˆ†é…ç®¡ç†ï¼Œé¿å…é›†ç¾¤æŠ–åŠ¨é€ æˆå…¨å±€å½±å“ã€‚ é›†ç¾¤æ¶æ„Flink é›†ç¾¤é‡‡ç”¨äº† ON YARN æ¨¡å¼ç‹¬ç«‹éƒ¨ç½²ï¼Œä¸ºå‡å°‘é›†ç¾¤ç»´æŠ¤å·¥ä½œé‡ï¼Œåº•å±‚ HDFS åˆ©ç”¨å…¬å¸ç»Ÿä¸€ HDFS Federation æ¶æ„ä¸‹å»ºç«‹ç‹¬ç«‹çš„ namespaceï¼Œå‡å°‘ Flink ä»»åŠ¡åœ¨ checkpoint é‡‡ç”¨ hdfs/rocksdb ä½œä¸ºçŠ¶æ€å­˜å‚¨åç«¯åœºæ™¯ä¸‹ç”±äº hdfs æŠ–åŠ¨å‡ºç°é¢‘ç¹å¼‚å¸¸å¤±è´¥ã€‚ åœ¨èµ„æºéš”ç¦»å±‚é¢ï¼Œå¼•å…¥ Node Label æœºåˆ¶å®ç°é‡è¦ä»»åŠ¡è¿è¡Œåœ¨ç‹¬ç«‹æœºå™¨ï¼Œä¸åŒè®¡ç®—æ€§è´¨ä»»åŠ¡è¿è¡Œåœ¨åˆé€‚çš„æœºå™¨ä¸‹ï¼Œæœ€å¤§åŒ–æœºå™¨èµ„æºçš„åˆ©ç”¨ç‡ã€‚åŒæ—¶åœ¨ YARN èµ„æºéš”ç¦»åŸºç¡€ä¸Šå¢åŠ  Cgroup è¿›è¡Œç‰©ç† cpu éš”ç¦»ï¼Œå‡å°‘ä»»åŠ¡é—´æŠ¢å å½±å“ï¼Œä¿éšœä»»åŠ¡è¿è¡Œç¨³å®šæ€§ã€‚ å¹³å°åŒ–ç®¡ç†Wstream æ˜¯ä¸€å¥—åŸºäº Apache Flink æ„å»ºçš„ä¸€ç«™å¼ã€é«˜æ€§èƒ½å®æ—¶å¤§æ•°æ®å¤„ç†å¹³å°ã€‚æä¾› SQL åŒ–æµå¼æ•°æ®åˆ†æèƒ½åŠ›ï¼Œå¤§å¹…é™ä½æ•°æ®å®æ—¶åˆ†æé—¨æ§›ï¼Œæ”¯æŒé€šè¿‡ DDL å®ç° source/sink ä»¥åŠç»´è¡¨ï¼Œæ”¯æŒ UDF/UDAF/UDTFï¼Œä¸ºç”¨æˆ·æä¾›æ›´å¼ºå¤§çš„æ•°æ®å®æ—¶å¤„ç†èƒ½åŠ›ã€‚æ”¯æŒå¤šæ ·å¼åº”ç”¨æ„å»ºæ–¹å¼ FlinkJar/Stream SQL/Flink-Stormï¼Œä»¥æ»¡è¶³ä¸åŒç”¨æˆ·çš„å¼€å‘éœ€æ±‚ï¼ŒåŒæ—¶é€šè¿‡è°ƒè¯•ï¼Œç›‘æ§ï¼Œè¯Šæ–­ï¼Œæ¢æŸ¥ç»“æœç­‰è¾…åŠ©æ‰‹æ®µå®Œå–„ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚ ###æµå¼ sql èƒ½åŠ›å»ºè®¾Stream SQL æ˜¯å¹³å°ä¸ºäº†æ‰“é€  sql åŒ–å®æ—¶è®¡ç®—èƒ½åŠ›ï¼Œå‡å°å®æ—¶è®¡ç®—å¼€å‘é—¨æ§›ï¼ŒåŸºäºå¼€æºçš„ Flinkï¼Œå¯¹åº•å±‚ sql æ¨¡å—è¿›è¡Œæ‰©å±•å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š æ”¯æŒè‡ªå®šä¹‰ DDL è¯­æ³•ï¼ˆåŒ…æ‹¬æºè¡¨, è¾“å‡ºè¡¨, ç»´è¡¨ï¼‰ æ”¯æŒè‡ªå®šä¹‰ UDF/UDTF/UDAF è¯­æ³• å®ç°äº†æµä¸ç»´è¡¨çš„ join, åŒæµ join åœ¨æ”¯æŒå¤§æ•°æ®å¼€æºç»„ä»¶çš„åŒæ—¶ï¼Œä¹Ÿæ‰“é€šäº†å…¬å¸ä¸»æµçš„å®æ—¶å­˜å‚¨å¹³å°ã€‚åŒæ—¶ä¸ºç”¨æˆ·æä¾›åŸºäº Sql client çš„ cli æ–¹å¼ä»¥åŠåœ¨ Wstream é›†æˆäº†å¯¹å®æ—¶ sql èƒ½åŠ›çš„æ”¯æŒï¼Œä¸ºç”¨æˆ·æä¾›åœ¨çº¿å¼€å‘è°ƒè¯• sql ä»»åŠ¡çš„ç¼–è¾‘å™¨ï¼ŒåŒæ—¶æ”¯æŒä»£ç é«˜äº®ï¼Œæ™ºèƒ½æç¤ºï¼Œè¯­æ³•æ ¡éªŒåŠè¿è¡Œæ—¶æ ¡éªŒï¼Œå°½å¯èƒ½é¿å…ç”¨æˆ·æäº¤åˆ°é›†ç¾¤çš„ä»»åŠ¡å‡ºç°å¼‚å¸¸ã€‚ å¦å¤–ä¹Ÿä¸ºç”¨æˆ·æä¾›äº†å‘å¯¼åŒ–é…ç½®æ–¹å¼ï¼Œè§£å†³ç”¨æˆ·å®šä¹‰ table éœ€è¦äº†è§£å¤æ‚çš„å‚æ•°è®¾ç½®ï¼Œç”¨æˆ·åªéœ€å…³å¿ƒä¸šåŠ¡é€»è¾‘å¤„ç†ï¼Œåƒå¼€å‘ç¦»çº¿ Hive ä¸€æ ·ä½¿ç”¨ sql å¼€å‘å®æ—¶ä»»åŠ¡ã€‚ Storm ä»»åŠ¡è¿ç§» Flinkåœ¨å®Œå–„ Flink å¹³å°å»ºè®¾çš„åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯åŠ¨ Storm ä»»åŠ¡è¿ç§» Flink è®¡åˆ’ï¼Œæ—¨åœ¨æå‡å®æ—¶è®¡ç®—å¹³å°æ•´ä½“æ•ˆç‡ï¼Œå‡å°‘æœºå™¨æˆæœ¬å’Œè¿ç»´æˆæœ¬ã€‚Flink-Storm ä½œä¸ºå®˜æ–¹æä¾› Flink å…¼å®¹ Storm ç¨‹åºä¸ºæˆ‘ä»¬å®ç°æ— ç¼è¿ç§»æä¾›äº†å¯è¡Œæ€§ï¼Œä½†æ˜¯ä½œä¸º beta ç‰ˆæœ¬ï¼Œåœ¨å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­å­˜åœ¨å¾ˆå¤šæ— æ³•æ»¡è¶³ç°å®åœºæ™¯çš„æƒ…å†µï¼Œå› æ­¤æˆ‘ä»¬è¿›è¡Œäº†å¤§é‡æ”¹è¿›ï¼Œä¸»è¦åŒ…æ‹¬å®ç° Storm ä»»åŠ¡ on yarn ï¼Œè¿ç§»ä¹‹åä»»åŠ¡ at least once è¯­ä¹‰ä¿éšœï¼Œå…¼å®¹ Storm çš„ tick tuple æœºåˆ¶ç­‰ç­‰ã€‚ é€šè¿‡å¯¹ Fink-Storm çš„ä¼˜åŒ–ï¼Œåœ¨æ— éœ€ç”¨æˆ·ä¿®æ”¹ä»£ç çš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬å·²ç»é¡ºåˆ©å®Œæˆå¤šä¸ª Storm ç‰ˆæœ¬é›†ç¾¤ä»»åŠ¡è¿ç§»å’Œé›†ç¾¤ä¸‹çº¿ï¼Œåœ¨ä¿éšœå®æ—¶æ€§åŠååé‡çš„åŸºç¡€ä¸Šå¯ä»¥èŠ‚çº¦è®¡ç®—èµ„æº 40% ä»¥ä¸Šï¼ŒåŒæ—¶å€ŸåŠ© yarn ç»Ÿä¸€ç®¡ç†å®æ—¶è®¡ç®—å¹³å°æ— éœ€ç»´æŠ¤å¤šå¥— Storm é›†ç¾¤ï¼Œæ•´ä½“æå‡äº†å¹³å°èµ„æºåˆ©ç”¨ç‡ï¼Œå‡è½»å¹³å°è¿ç»´å·¥ä½œé‡ã€‚ ä»»åŠ¡è¯Šæ–­æŒ‡æ ‡ç›‘æ§Flink webUI æä¾›äº†å¤§é‡çš„è¿è¡Œæ—¶ä¿¡æ¯ä¾›ç”¨æˆ·äº†è§£ä»»åŠ¡å½“å‰è¿è¡ŒçŠ¶å†µï¼Œä½†æ˜¯å­˜åœ¨æ— æ³•è·å–å†å² metrics çš„é—®é¢˜å¯¼è‡´ç”¨æˆ·æ— æ³•äº†è§£ä»»åŠ¡å†å²è¿è¡ŒçŠ¶æ€ï¼Œå› æ­¤æˆ‘ä»¬é‡‡ç”¨äº† Flink åŸç”Ÿæ”¯æŒçš„ Prometheus è¿›è¡Œå®æ—¶æŒ‡æ ‡é‡‡é›†å’Œå­˜å‚¨ã€‚ Prometheus æ˜¯ä¸€ä¸ªå¼€æºçš„ç›‘æ§å’ŒæŠ¥è­¦ç³»ç»Ÿï¼Œé€šè¿‡ pushgateway çš„æ–¹å¼å®æ—¶ä¸ŠæŠ¥ metricsï¼ŒPrometheus é›†ç¾¤é‡‡ç”¨ Fedration éƒ¨ç½²æ¨¡å¼ï¼Œmeta èŠ‚ç‚¹å®šæ—¶æŠ“å–æ‰€æœ‰å­èŠ‚ç‚¹æŒ‡æ ‡è¿›è¡Œæ±‡æ€»ï¼Œæ–¹ä¾¿ç»Ÿä¸€æ•°æ®æºæä¾›ç»™ Grafana è¿›è¡Œå¯è§†åŒ–ä»¥åŠå‘Šè­¦é…ç½®ã€‚ ä»»åŠ¡å»¶è¿Ÿååèƒ½åŠ›å’Œå»¶è¿Ÿä½œä¸ºè¡¡é‡å®æ—¶ä»»åŠ¡æ€§èƒ½æœ€é‡è¦çš„æŒ‡æ ‡ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦é€šè¿‡è¿™ä¸¤ä¸ªæŒ‡æ ‡æ¥è°ƒæ•´ä»»åŠ¡å¹¶å‘åº¦å’Œèµ„æºé…ç½®ã€‚Flink Metrics æä¾› latencyTrackingInterval å‚æ•°å¯ç”¨ä»»åŠ¡å»¶è¿Ÿè·Ÿè¸ªï¼Œæ‰“å¼€ä¼šæ˜¾è‘—å½±å“é›†ç¾¤å’Œä»»åŠ¡æ€§èƒ½ï¼Œå®˜æ–¹é«˜åº¦å»ºè®®åªåœ¨ debug ä¸‹ä½¿ç”¨ã€‚ åœ¨å®è·µåœºæ™¯ä¸‹ï¼ŒFlink ä»»åŠ¡æ•°æ®æºåŸºæœ¬éƒ½æ˜¯ Kafkaï¼Œå› æ­¤æˆ‘ä»¬é‡‡ç”¨ topic æ¶ˆè´¹å †ç§¯ä½œä¸ºè¡¡é‡ä»»åŠ¡å»¶è¿Ÿçš„æŒ‡æ ‡ï¼Œç›‘æ§æ¨¡å—å®æ—¶é€šè¿‡ Flink rest è·å–ä»»åŠ¡æ­£åœ¨æ¶ˆè´¹ topic çš„ offsetï¼ŒåŒæ—¶é€šè¿‡ Kafka JMX è·å–å¯¹åº” topic çš„ logsizeï¼Œé‡‡ç”¨ logsizeâ€“ offset ä½œä¸º topic çš„å †ç§¯ã€‚ æ—¥å¿—æ£€ç´¢Flink ä½œä¸ºåˆ†å¸ƒå¼è®¡ç®—å¼•æ“ï¼Œæ‰€æœ‰ä»»åŠ¡ä¼šç”± YARN ç»Ÿä¸€è°ƒåº¦åˆ°ä»»æ„çš„è®¡ç®—èŠ‚ç‚¹ï¼Œå› æ­¤ä»»åŠ¡çš„è¿è¡Œæ—¥å¿—ä¼šåˆ†å¸ƒåœ¨ä¸åŒçš„æœºå™¨ï¼Œç”¨æˆ·å®šä½æ—¥å¿—å›°éš¾ã€‚æˆ‘ä»¬é€šè¿‡è°ƒæ•´ log4j æ—¥å¿—æ¡†æ¶é»˜è®¤æœºåˆ¶ï¼ŒæŒ‰å¤©åˆ‡åˆ†ä»»åŠ¡æ—¥å¿—ï¼Œå®šæœŸæ¸…ç†è¿‡æœŸæ—¥å¿—ï¼Œé¿å…å¼‚å¸¸ä»»åŠ¡é¢‘ç¹å†™æ»¡ç£ç›˜å¯¼è‡´è®¡ç®—èŠ‚ç‚¹ä¸å¯ç”¨çš„æƒ…å†µï¼ŒåŒæ—¶åœ¨æ‰€æœ‰è®¡ç®—èŠ‚ç‚¹éƒ¨ç½² agent å®æ—¶é‡‡é›†æ—¥å¿—ï¼Œæ±‡èšå†™å…¥ Kafkaï¼Œé€šè¿‡æ—¥å¿—åˆ†å‘å¹³å°å®æ—¶å°†æ•°æ®åˆ†å‘åˆ° ESï¼Œæ–¹ä¾¿ç”¨æˆ·è¿›è¡Œæ—¥å¿—æ£€ç´¢å’Œå®šä½é—®é¢˜ã€‚ Flink ä¼˜åŒ–åœ¨å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿé’ˆå¯¹ä¸šåŠ¡åœºæ™¯è¿›è¡Œäº†ä¸€äº›ä¼˜åŒ–å’Œæ‰©å±•ï¼Œä¸»è¦åŒ…æ‹¬ï¼š 1ï¼‰Storm ä»»åŠ¡éœ€è¦ Storm å¼•æ“æä¾› ack æœºåˆ¶ä¿éšœæ¶ˆæ¯ä¼ é€’ at least once è¯­ä¹‰ï¼Œè¿ç§»åˆ° Flink æ— æ³•ä½¿ç”¨ ack æœºåˆ¶ï¼Œæˆ‘ä»¬é€šè¿‡å®šåˆ¶ KafakSpout å®ç° checkpoint ç›¸å…³æ¥å£ï¼Œé€šè¿‡ Flink checkpoint æœºåˆ¶å®ç°æ¶ˆæ¯ä¼ é€’ä¸ä¸¢å¤±ã€‚å¦å¤– Flink-Storm é»˜è®¤åªèƒ½æ”¯æŒ standalone çš„æäº¤æ–¹å¼ï¼Œæˆ‘ä»¬é€šè¿‡å®ç° yarn client ç›¸å…³æ¥å£å¢åŠ äº† storm on yarn çš„æ”¯æŒã€‚ 2ï¼‰Flink 1.6 æ¨èçš„æ˜¯ä¸€ä¸ª TaskManager å¯¹åº”ä¸€ä¸ª slot çš„ä½¿ç”¨æ–¹å¼ï¼Œåœ¨ç”³è¯·èµ„æºçš„æ—¶å€™æ ¹æ®æœ€å¤§å¹¶å‘åº¦ç”³è¯·å¯¹åº”æ•°é‡çš„ TaskMangerï¼Œè¿™æ ·å¯¼è‡´çš„é—®é¢˜å°±æ˜¯åœ¨ä»»åŠ¡è®¾ç½® task slots ä¹‹åéœ€è¦ç”³è¯·çš„èµ„æºå¤§äºå®é™…èµ„æºã€‚ æˆ‘ä»¬é€šè¿‡åœ¨ ResoureManager è¯·æ±‚èµ„æºç®¡ç†å™¨ SlotManager çš„æ—¶å€™å¢åŠ  TaskManagerSlot ç›¸å…³ä¿¡æ¯ï¼Œç”¨äºç»´æŠ¤ç”³è¯·åˆ°çš„å¾…åˆ†é… TaskManager å’Œ slotï¼Œä¹‹åå¯¹äº SlotRequests è¯·æ±‚ä¸æ˜¯ç›´æ¥ç”³è¯· TaskManagerï¼Œè€Œæ˜¯å…ˆä» SlotManager ç”³è¯·æ˜¯å¦æœ‰è¶³å¤Ÿ slotï¼Œæ²¡æœ‰æ‰ä¼šå¯åŠ¨æ–°çš„ TaskManger, è¿™æ ·å°±å®ç°äº†ç”³è¯·èµ„æºç­‰äºå®é™…æ¶ˆè€—èµ„æºï¼Œé¿å…ä»»åŠ¡åœ¨èµ„æºè¶³å¤Ÿçš„æƒ…å†µä¸‹æ— æ³•å¯åŠ¨ã€‚ 3ï¼‰Kafak Connector æ”¹é€ ï¼Œå¢åŠ è‡ªåŠ¨æ¢è¡Œæ”¯æŒï¼Œå¦å¤–é’ˆå¯¹ 08source æ— æ³•è®¾ç½® client.idï¼Œé€šè¿‡å°† client.id ç”Ÿæˆæœºåˆ¶ä¼˜åŒ–æˆæ›´æœ‰æ ‡è¯†æ„ä¹‰çš„ idï¼Œä¾¿äº Kafka å±‚é¢ç®¡æ§ã€‚ 4ï¼‰Flink æäº¤ä»»åŠ¡æ— æ³•æ”¯æŒç¬¬ä¸‰æ–¹ä¾èµ– jar åŒ…å’Œé…ç½®æ–‡ä»¶ä¾› TaskManager ä½¿ç”¨ï¼Œæˆ‘ä»¬é€šè¿‡ä¿®æ”¹ flink å¯åŠ¨è„šæœ¬ï¼Œå¢åŠ ç›¸å…³å‚æ•°æ”¯æŒå¤–éƒ¨ä¼ è¾“æ–‡ä»¶ï¼Œä¹‹ååœ¨ä»»åŠ¡å¯åŠ¨è¿‡ç¨‹ä¸­é€šè¿‡å°†å¯¹åº”çš„ jar åŒ…å’Œæ–‡ä»¶åŠ å…¥ classpathï¼Œå€ŸåŠ© yarn çš„æ–‡ä»¶ç®¡ç†æœºåˆ¶å®ç°ç±»ä¼¼ spark å¯¹åº”çš„ä½¿ç”¨æ–¹å¼ï¼Œæ–¹ä¾¿ç”¨æˆ·ä½¿ç”¨ã€‚ 5ï¼‰ä¸šåŠ¡åœºæ™¯å­˜åœ¨å¤§é‡å®æ—¶å†™å…¥ hdfs éœ€æ±‚ï¼ŒFlink è‡ªå¸¦ BucketingSink é»˜è®¤åªæ”¯æŒ string å’Œ avro æ ¼å¼ï¼Œæˆ‘ä»¬åœ¨æ­¤åŸºç¡€ä¸ŠåŒæ—¶æ”¯æŒäº† LZO åŠ Parquet æ ¼å¼å†™å…¥ï¼Œæå¤§æå‡æ•°æ®å†™å…¥æ€§èƒ½ã€‚ åç»­è§„åˆ’å®æ—¶è®¡ç®—å¹³å°å½“å‰æ­£åœ¨è¿›è¡Œ Storm ä»»åŠ¡è¿ç§» Flink é›†ç¾¤ï¼Œç›®å‰å·²ç»åŸºæœ¬å®Œæˆï¼Œå¤§å¹…æå‡äº†å¹³å°èµ„æºåˆ©ç”¨ç‡å’Œè®¡ç®—æ•ˆç‡ã€‚åç»­å°†ç»§ç»­è°ƒç ”å®Œå–„ Flink ç›¸å…³èƒ½åŠ›ï¼Œæ¨åŠ¨ Flink åœ¨æ›´å¤šçš„å®æ—¶åœºæ™¯ä¸‹çš„åº”ç”¨ï¼ŒåŒ…æ‹¬å®æ—¶è§„åˆ™å¼•æ“ï¼Œå®æ—¶æœºå™¨å­¦ä¹ ç­‰ã€‚ æœ€åGitHub Flink å­¦ä¹ ä»£ç åœ°å€ï¼šhttps://github.com/zhisheng17/flink-learning å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ ä¸“æ ä»‹ç»é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€åŸç†ã€å®æˆ˜ã€æ€§èƒ½è°ƒä¼˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"åŸºäº Flink æ„å»ºå…³è”åˆ†æå¼•æ“çš„æŒ‘æˆ˜å’Œå®è·µ","date":"2019-11-29T16:00:00.000Z","path":"2019/11/30/flink-aqniu/","text":"å¦‚ä½•æ„å»ºæµå¼å…³è”åˆ†æå¼•æ“ï¼Ÿ æœ¬æ–‡è½¬è½½è‡ªå¥‡å®‰ä¿¡å®˜ç½‘ï¼Œä½œè€…ï¼šå¥‡å®‰ä¿¡é›†å›¢é«˜çº§ç ”å‘æ€»ç›‘éŸ©é¹ åŸæ–‡åœ°å€ï¼šhttps://www.aqniu.com/tools-tech/59894.html éšç€äº‘è®¡ç®—ã€å¤§æ•°æ®ç­‰æ–°ä¸€ä»£ITæŠ€æœ¯åœ¨å„è¡Œä¸šçš„æ·±å…¥åº”ç”¨ï¼Œæ”¿ä¼æœºæ„ITè§„æ¨¡å’Œå¤æ‚ç¨‹åº¦ä¸æ–­æé«˜ï¼Œç½‘ç»œæµé‡ã€æ—¥å¿—ç­‰å„ç±»æ•°æ®è§„æ¨¡å¤§å¹…æå‡ã€‚ä¸æ­¤åŒæ—¶ï¼Œç½‘ç»œæ”»é˜²æ—¥ç›Šæ¿€çƒˆï¼Œç½‘ç»œå®‰å…¨å¨èƒé€æ¸å‡¸æ˜¾å‡ºæ¥ï¼Œè¿™å¯¹äºSOC/SIEMäº§å“çš„æ€§èƒ½æå‡ºäº†ä¸€ä¸ªå¾ˆå¤§çš„æŒ‘æˆ˜ã€‚å› æ­¤ï¼Œå¥‡å®‰ä¿¡ç‹¬ç«‹ç ”å‘äº†å›½å†…é¦–æ¬¾æµå¼åˆ†å¸ƒå¼å…³è”åˆ†æå¼•æ“Sabreï¼Œæ­è½½äºå…¬å¸æ——ä¸‹æ€åŠ¿æ„ŸçŸ¥ä¸å®‰å…¨è¿è¥å¹³å°ï¼ˆä¸‹æ–‡ç®€ç§°NGSOCï¼‰ï¼Œä»è€Œå¤§å¹…æå‡NGSOCçš„æ•°æ®åˆ†æèƒ½åŠ›å’Œç½‘ç»œå®‰å…¨æ£€æµ‹èƒ½åŠ›ã€‚ æœ¬æ–‡å°†ä»æŠ€æœ¯ç ”å‘çš„è§’åº¦ï¼Œå…¨é¢é˜è¿°Sabreçš„ç”±æ¥ã€‚ 1.Sabreæ˜¯ä»€ä¹ˆï¼ŸSabreæ˜¯å¥‡å®‰ä¿¡ç ”å‘çš„æ–°ä¸€ä»£æµå¼åˆ†å¸ƒå¼å…³è”åˆ†æå¼•æ“ï¼Œæ˜¯CEPï¼ˆComplex Event Processingï¼Œå¤æ‚äº‹ä»¶å¤„ç†ï¼‰æŠ€æœ¯åœ¨å¤§æ•°æ®é¢†åŸŸçš„ä¸€ä¸ªå…·ä½“å®ç°ã€‚å¥‡å®‰ä¿¡ç ”å‘å…³è”å¼•æ“å·²æœ‰æ•°å¹´å†å²ï¼Œä¸­é—´ç»å†äº†ä¸‰æ¬¡ä¸»è¦çš„æŠ€æœ¯æ¼”è¿›ï¼Œåœ¨2015å¹´ä¹‹å‰ï¼Œå¥‡å®‰ä¿¡ä½¿ç”¨çš„æ˜¯åŸºäºå¼€æºCEPè½¯ä»¶Esperç ”å‘çš„å…³è”å¼•æ“ï¼Œç”±äºä¸€äº›æ¶æ„å’Œè®¾è®¡ä¸Šçš„é—®é¢˜ï¼Œæ•´ä½“æ€§èƒ½ä¸æ˜¯éå¸¸ç†æƒ³ï¼Œä¹Ÿä¸æ”¯æŒå¤šæœºæ‰©å±•ï¼›åœ¨2016-2017å¹´ï¼Œç”¨C++å¼€å‘äº†ä¸€ä¸ªé«˜æ€§èƒ½å¼•æ“ï¼Œä»£å·Dolphinï¼Œå¯ä»¥åœ¨å•æœºä¸Šå®ç°å¾ˆé«˜çš„æ€§èƒ½ï¼›åœ¨2018å¹´ï¼Œä»æŠ€æœ¯ä¸Šå…¨é¢è½¬å‘Flinkæ¡†æ¶ï¼Œæå¤§å¢å¼ºäº†ç³»ç»Ÿçš„å¯æ‰©å±•æ€§ï¼Œæ¨å‡ºäº†Sabreå¼•æ“ä½œä¸ºNGSOCçš„æ ¸å¿ƒæ£€æµ‹å¼•æ“ã€‚ Sabreåº”ç”¨äºå¥‡å®‰ä¿¡çš„æ€åŠ¿æ„ŸçŸ¥ä¸å®‰å…¨è¿è¥å¹³å°ï¼ˆNGSOCï¼‰äº§å“ä¸­ï¼ŒNGSOCä¸»è¦æœåŠ¡äºä¸­å¤§å‹æ”¿ä¼å®¢æˆ·ï¼Œç›®å‰å·²ç»æˆåŠŸåº”ç”¨äº200+å¤§å‹æ”¿ä¼æœºæ„ï¼Œåœ¨å›½å†…å®‰å…¨ç®¡ç†å¹³å°å¸‚åœºå æœ‰ç‡ç¬¬ä¸€ï¼Œå…¶ä¸­æ­è½½çš„Sabreå¼•æ“æä¾›äº†æ ¸å¿ƒçš„å®‰å…¨æ£€æµ‹èƒ½åŠ›ã€‚å’Œå¾ˆå¤šäº’è”ç½‘å…¬å¸å†…éƒ¨è‡ªå»ºæ•°æ®å¤„ç†å¹³å°ä¸åŒçš„æ˜¯ï¼ŒSabreæ›´æ³¨é‡çš„æ˜¯æŠ€æœ¯çš„å·¥ç¨‹åŒ–äº¤ä»˜ï¼Œå› æ­¤åœ¨è®¾è®¡å’Œå®ç°ä¸Šå’Œä¸€èˆ¬åŸºäºFlinkçš„ä¸šåŠ¡ç³»ç»Ÿç›¸æ¯”ä¼šæœ‰è¾ƒå¤§å·®å¼‚ã€‚ 2.ä¸ºä»€ä¹ˆè¦å¼€å‘Sabreï¼Ÿéšç€ç½‘ç»œåº”ç”¨è§„æ¨¡å’Œå¤æ‚åº¦çš„ä¸æ–­æé«˜ï¼Œç½‘ç»œä¸­ä¼ è¾“çš„æ•°æ®é‡æ€¥å‰§ä¸Šå‡ï¼Œç½‘ç»œæ”»é˜²å¯¹æŠ—æ—¥è¶‹æ¿€çƒˆï¼Œä¼ä¸šå†…éƒ¨æ–°çš„å®‰å…¨é—®é¢˜å¼€å§‹æ˜¾ç°ï¼Œå®æ—¶å…³è”åˆ†æå¼•æ“ï¼Œä½œä¸ºNGSOCæ£€æµ‹ä½“ç³»ä¸­çš„æ ¸å¿ƒç»„ä»¶ï¼Œä¹Ÿé‡åˆ°äº†è¶Šæ¥è¶Šå¤šçš„æŒ‘æˆ˜ï¼š (1) æ€§èƒ½ä¼˜åŒ–é—®é¢˜ã€‚ä¸»è¦é’ˆå¯¹éšç€æ–°å‹æ”»å‡»çš„ä¸æ–­å‡ºç°ï¼Œå…³è”åˆ†æè§„åˆ™è§„æ¨¡ä¸æ–­ä¸Šå‡å¯¼è‡´çš„æ€§èƒ½é—®é¢˜ã€‚ä¼ ç»Ÿå¼€æºå…³è”å¼•æ“å¾€å¾€åŠ è½½å‡ åæ¡è§„åˆ™å³è¾¾åˆ°äº†æ€§èƒ½ç“¶é¢ˆï¼Œè€ŒNGSOCçš„åº”ç”¨åœºæ™¯ä¸­ï¼Œå…³è”å¼•æ“éœ€è¦æ”¯æ’‘è§„æ¨¡ä¸Šåƒçš„å…³è”è§„åˆ™ã€‚åœ¨æœ‰é™çš„ç¡¬ä»¶èµ„æºæ¡ä»¶ä¸‹ï¼Œå¦‚ä½•é¿å…ç³»ç»Ÿæ•´ä½“æ€§èƒ½éšè§„åˆ™æ¡æ•°ä¸Šå‡è€Œå‘ç”Ÿçº¿æ€§ä¸‹é™ï¼Œæˆä¸ºå…³è”å¼•æ“çš„ä¸€ä¸ªä¸»è¦æŒ‘æˆ˜ã€‚ (2) è§„åˆ™çš„è¯­ä¹‰æ‰©å±•é—®é¢˜ã€‚åœ¨ç½‘ç»œå®‰å…¨äº‹ä»¶äº•å–·å¼å‘ç”Ÿçš„ä»Šå¤©ï¼Œå®‰å…¨éœ€æ±‚è¿…é€Ÿæ‰©å±•ã€‚ä¸ºäº†èƒ½å¤Ÿåœ¨æœ‰é™æ—¶é—´å†…å¯¹ç‰¹å®šè¯­ä¹‰çš„å¿«é€Ÿæ”¯æŒï¼Œå…³è”å¼•æ“çš„æ•´ä½“æ¶æ„å¿…é¡»å¼‚å¸¸çµæ´»ï¼Œæ‰èƒ½é€‚åº”æœªæ¥å®‰å…¨åˆ†æåœºæ™¯çš„å„ç§éœ€æ±‚ï¼Œè€ŒåŸºäºå¼€æºå…³è”å¼•æ“å®ç°çš„äº§å“ä¼šåœ¨æ¿€çƒˆçš„éœ€æ±‚å˜åŒ–æ—¶é‡åˆ°å¾ˆå¤šé—®é¢˜ã€‚ (3) ç³»ç»Ÿæ‰©å±•æ€§é—®é¢˜ã€‚ä¸»è¦æŒ‡åˆ†å¸ƒå¼ç¯å¢ƒä¸‹èŠ‚ç‚¹çš„æ‰©å±•ã€‚éšç€ä¼ä¸šç½‘ç»œæµé‡å’Œä¸šåŠ¡èµ„äº§çš„ä¸æ–­æ‰©å®¹ï¼ŒNGSOCçš„ç³»ç»Ÿå¤„ç†èƒ½åŠ›å¿…é¡»èƒ½éšä¼ä¸šä¸šåŠ¡è§„æ¨¡çš„ä¸æ–­æ‰©å¼ è€ŒåŠ¨æ€æ‰©å±•ã€‚æœªæ¥çš„åˆ†å¸ƒå¼å…³è”åˆ†æå¼•æ“éœ€è¦æ”¯æŒæ•°ç™¾èŠ‚ç‚¹çš„è§„æ¨¡ï¼Œä»¥èƒ½å¤Ÿä¸ç°æœ‰çš„å¤§æ•°æ®å¹³å°æ— ç¼é›†æˆã€‚ ä¸Stormã€Spark Streamingç­‰æµå¼è®¡ç®—æ¡†æ¶ç›¸æ¯”ï¼ŒFlinkå…·æœ‰ç¼–ç¨‹æ¥å£ä¸°å¯Œã€è‡ªå¸¦å¤šç§Windowç®—å­ã€æ”¯æŒExactly-Onceã€é«˜æ€§èƒ½åˆ†å¸ƒå¼æ£€æŸ¥ç‚¹ã€æ‰¹æµè®¡ç®—æ¨¡å¼ç»Ÿä¸€ç­‰ä¼˜ç‚¹ã€‚ä¸”Flinkå‘å±•è¾ƒä¸ºè¿…é€Ÿï¼Œå¼€æºç¤¾åŒºæä¸ºæ´»è·ƒï¼Œæ˜¯ç›®å‰æœ€å…·å‘å±•æ½œåŠ›çš„æµå¼è®¡ç®—æ¡†æ¶ï¼Œæ˜¯æœªæ¥å®æ—¶è®¡ç®—æ‰§ç‰›è€³è€…ã€‚ç”±äºFlinkä¸ºäº‹ä»¶é©±åŠ¨çš„å®æ—¶å…³è”åˆ†æå¼•æ“åœ¨åº•å±‚æ¡†æ¶ä¸Šæä¾›äº†æœ‰åŠ›æ”¯æŒï¼Œå› æ­¤å¥‡å®‰ä¿¡çš„ä¸‹ä¸€ä»£å…³è”åˆ†æå¼•æ“Sabreæ˜¯åŸºäºFlinkæµå¼è®¡ç®—æ¡†æ¶å®ç°çš„ã€‚ åœ¨é€‰æ‹©äº†Flinkä¹‹åï¼Œå‘ç°Flinkå¼€æºæ–¹æ¡ˆç›´æ¥åº”ç”¨äºå®‰å…¨æ£€æµ‹é¢†åŸŸï¼Œä»æœ‰å¾ˆå¤§çš„æŠ€æœ¯éšœç¢ã€‚ å’Œäº’è”ç½‘ä¼ä¸šå†…éƒ¨ä½¿ç”¨çš„å¤§å‹é›†ç¾¤ç›¸æ¯”ï¼ŒNGSOCé¢å‘çš„ä¼ä¸šçº§åº”ç”¨é›†ç¾¤è§„æ¨¡è¾ƒå°ï¼Œç¡¬ä»¶èµ„æºå—é™ï¼Œä¸”å®¢æˆ·çš„å®šåˆ¶éœ€æ±‚è¾ƒå¤šï¼Œå¯¼è‡´å®‰å…¨ç›‘æµ‹çš„è§„åˆ™è¦æ±‚æ›´ä¸¥æ ¼ï¼Œå¼•æ“å‘å¸ƒæˆæœ¬è¾ƒé«˜ã€‚ä½†æ˜¯ï¼Œç°æœ‰çš„Flinkå¼€æºè§£å†³æ–¹æ¡ˆï¼Œæˆ–è€…éœ€è¦æ ¹æ®ä¸šåŠ¡éœ€æ±‚è¿›è¡Œæ”¹é€ ï¼Œæˆ–è€…æ€§èƒ½è¾ƒå·®ï¼Œå‡ä¸èƒ½è¾ƒå¥½åœ°è§£å†³ä¸Šè¿°é—®é¢˜ã€‚é¦–å…ˆï¼ŒåŸç”ŸFlinkåªæä¾›äº†å‡½æ•°å¼ç¼–ç¨‹æ¨¡å¼ï¼Œå³éœ€è¦ç›´æ¥ç¼–å†™å¤åˆç‰¹å®šä¸šåŠ¡éœ€æ±‚çš„å›ºå®šç¨‹åºä»£ç ï¼Œç”±æ­¤å¯¼è‡´å¼€å‘æµ‹è¯•å‘¨æœŸè¾ƒé•¿ï¼Œä¸ä¾¿äºåŠ¨æ€æ›´æ–°è§„åˆ™ï¼Œå¯å¤ç”¨æ€§è¾ƒå¼±ï¼Œä¸”ä¸èƒ½ä»å…¨å±€è¯­ä¹‰å±‚é¢è¿›è¡Œä¼˜åŒ–ï¼Œæ€§èƒ½è¾ƒå·®ã€‚å…¶æ¬¡ï¼ŒFlink-CEPä»…æ˜¯ä¸€ä¸ªå—é™çš„åºåˆ—ç®—å­ï¼Œåœ¨è¿è¡Œæ—¶éœ€è¦å°†æ‰€æœ‰æ•°æ®ä¼ è¾“åˆ°CEPç®—å­ï¼Œç„¶ååœ¨CEPç®—å­ä¸­ä¸²è¡Œæ‰§è¡Œå„ä¸ªæ¡ä»¶è¯­å¥ã€‚è¿™ç§æ±‡é›†åˆ°å•ç‚¹çš„è¿è¡Œæ¨¡å¼ï¼Œè¾ƒå¤šçš„å†—ä½™æ•°æ®éœ€è¦æ‰§è¡Œæ¡ä»¶åŒ¹é…ï¼Œäº§ç”Ÿäº†ä¸å¿…è¦çš„ç½‘ç»œè´Ÿè½½ï¼Œè€Œä¸”é™ä½äº†CPUåˆ©ç”¨ç‡ã€‚å†æ¬¡ï¼Œè¿˜å­˜åœ¨ä¸€äº›éå®˜æ–¹å¼€æºçš„è½»é‡çº§CEPå¼•æ“ï¼Œæ¯”å¦‚Flink-siddhiï¼ŒåŠŸèƒ½ç®€å•ï¼Œä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„è§£å†³æ–¹æ¡ˆã€‚ é¢å‘ä¼ä¸šçº§çš„ç½‘ç»œå®‰å…¨ç›‘æµ‹å¼•æ“å…·æœ‰ä¸€äº›ç‰¹å®šéœ€æ±‚ï¼Œå½“å‰è§£å†³æ–¹æ¡ˆå¯¹æ­¤æ”¯æŒè¾ƒå·®ã€‚æ¯”å¦‚ï¼Œç°å®æƒ…å†µï¼Œå®¢æˆ·å¯¹ç®—å­å®ä¾‹å’ŒTaskmanageræ¦‚å¿µè¾ƒä¸ºæ¨¡ç³Šï¼ŒçœŸæ­£å…³å¿ƒçš„è¿è¡ŒçŠ¶æ€çš„åŸºæœ¬å•ä½æ˜¯è§„åˆ™ã€‚è€ŒFlinkç›‘æ§é¡µé¢æ˜¾ç¤ºçš„æ˜¯ç®—å­å®ä¾‹åŠTaskmanagerè¿›ç¨‹æ•´ä½“å†…å­˜çš„è¿è¡ŒçŠ¶æ€ï¼Œè€Œåœ¨ç½‘ç»œå®‰å…¨ç›‘æ§çš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œå¯¹è¿è¡ŒçŠ¶æ€å’Œèµ„æºçš„ç›‘æ§å‡éœ€è¦ç»†åŒ–åˆ°è§„åˆ™å±‚é¢ã€‚å…¶æ¬¡ï¼Œåœ¨ç®—å­å±‚é¢ï¼ŒFlinkåŸç”ŸWindowç®—å­ï¼Œæ²¡æœ‰è¾ƒå¥½çš„èµ„æºï¼ˆCPU/å†…å­˜ï¼‰ä¿æŠ¤æœºåˆ¶ï¼Œä¸”å­˜åœ¨å¤§é‡é‡å¤å‘Šè­¦ï¼Œä¸ç¬¦åˆç½‘ç»œå®‰å…¨ç›‘æµ‹é¢†åŸŸçš„ä¸šåŠ¡éœ€æ±‚ã€‚å†æ¬¡ï¼ŒFlinkç¼ºä¹ä¸€äº›å¿…è¦ç®—å­ï¼Œä¾‹å¦‚ä¸æ”¯æŒâ€œä¸å‘ç”Ÿç®—å­â€ã€‚ä¸€ä¸ªè¾ƒä¸ºå¸¸è§çš„åº”ç”¨åœºæ™¯ï¼ŒæŸæ¡è§„åˆ™æŒ‡å®šåœ¨è¾ƒé•¿æ—¶é—´å†…æ²¡æ”¶åˆ°æŸå°æœåŠ¡å™¨çš„ç³»ç»Ÿæ—¥å¿—ï¼Œåˆ™è®¤ä¸ºæ­¤å°æœåŠ¡å™¨å‘ç”Ÿäº†å¼‚å¸¸ï¼Œéœ€è¦åŠæ—¶é€šçŸ¥ç”¨æˆ·ã€‚ ç»¼ä¸Šæ‰€è¿°ï¼Œç°æœ‰è§£å†³æ–¹æ¡ˆåº”ç”¨äºç½‘ç»œå®‰å…¨ç›‘æµ‹é¢†åŸŸå‡ä¼šé‡åˆ°é—®é¢˜ï¼Œç”±æ­¤å¥‡å®‰ä¿¡é›†å›¢åŸºäºFlinkæ„å»ºäº†ä¸€ç§å…¨æ–°çš„CEPå¼•æ“ã€‚ 3.Sabreå¦‚ä½•å¤„ç†æ•°æ®ï¼Ÿ ä¸Šå›¾ä¸ºNGSOCçš„æ•°æ®å¤„ç†æ¶æ„å›¾ï¼Œå±•ç¤ºäº†æ•´ä¸ªç³»ç»Ÿçš„æ•°æ®æµã€‚è‡ªä¸‹è€Œä¸Šï¼ŒNGSOCçš„æ•°æ®å¤„ç†è¿‡ç¨‹ç”±å››éƒ¨åˆ†ç»„æˆï¼Œå…¶æ ¸å¿ƒæ˜¯ç”±â€œæµå¼åˆ†å¸ƒå¼å…³è”åˆ†æå¼•æ“Sabreâ€æ„æˆçš„æ•°æ®å¤„ç†å±‚PROCESSï¼Œä¸”Sabreè¿è¡Œçš„ç¡¬ä»¶ç¯å¢ƒæ˜¯ç”±å¤šä¸ªèŠ‚ç‚¹ç»„æˆçš„åˆ†å¸ƒå¼é›†ç¾¤ã€‚å³ä¾§çš„è§„åˆ™é…ç½®ç®¡ç†æ¨¡å—ä¾›ä¸“ä¸šçš„å®‰å…¨äººå‘˜ä½¿ç”¨ï¼Œå¯é€šè¿‡ç±»Visioå›¾çš„ç•Œé¢è¾ƒä¸ºå‹å¥½ä¾¿æ·åœ°é…ç½®è§„åˆ™ï¼›è§„åˆ™ç®¡ç†æ¨¡å—å…·æœ‰æ·»åŠ ã€åˆ é™¤ã€ç¼–è¾‘å’ŒæŸ¥æ‰¾è§„åˆ™çš„åŠŸèƒ½ï¼Œå¹¶å¯æ‰¹é‡å¯åŠ¨/åœç”¨å¤šä¸ªè§„åˆ™ï¼Œè§„åˆ™ç®¡ç†æ¨¡å—ä¼šå°†å¤„äºå¯åŠ¨çŠ¶æ€çš„æœ‰æ•ˆè§„åˆ™ç»Ÿä¸€å‘é€ç»™Sabreå¼•æ“ã€‚æœ€ä¸Šæ–¹çš„ç»¿è‰²éƒ¨åˆ†ä¸ºç»“æœå¤„ç†å±‚RESULTï¼ŒSabreä¼šå°†å¤„ç†ç»“æœâ€œå‘Šè­¦â€æˆ–â€œå…³è”äº‹ä»¶â€å‘é€ç»™ä¸‹çº§å“åº”æ¨¡å—ï¼Œå®ç°å“åº”è”åŠ¨ã€åˆ†æè°ƒæŸ¥åŠè¿½è¸ªæº¯æºç­‰åŠŸèƒ½ã€‚æœ€ä¸‹æ–¹çš„è“è‰²éƒ¨åˆ†ä¸ºæ—¥å¿—é‡‡é›†å±‚COLLECTï¼Œä¸»è¦æœ‰â€œç½‘ç»œæµé‡æ—¥å¿—é‡‡é›†å™¨â€ã€â€œè®¾å¤‡åŠç³»ç»Ÿæ—¥å¿—é‡‡é›†å™¨â€å’Œâ€œå…¶ä»–ç±»å‹çš„æ—¥å¿—é‡‡é›†å™¨ï¼ˆæ¯”å¦‚ï¼šé˜²ç«å¢™ã€å…¥ä¾µæ£€æµ‹ç³»ç»ŸIDSã€å…¥ä¾µé˜²æŠ¤ç³»ç»ŸIPSã€é«˜çº§å¨èƒç›‘æµ‹ç³»ç»ŸAPTç­‰ç­‰ï¼‰â€ä¸‰å¤§ç±»ã€‚ä¸­é—´éƒ¨åˆ†ä¸ºæ—¥å¿—è§£æå±‚PARSEï¼Œç½‘ç»œæµé‡æ—¥å¿—å’Œç³»ç»Ÿå®‰å…¨æ—¥å¿—æ ¼å¼å¤šç§å¤šæ ·ï¼Œé¡»å°†ä¸Šè¿°ä¸¤ç±»åŸå§‹æ—¥å¿—æ•°æ®æ ¼å¼åŒ–ï¼Œè€Œå…¶ä»–ç±»å‹çš„æ—¥å¿—ï¼ˆæ¯”å¦‚ï¼šå¨èƒæƒ…æŠ¥ã€æ¼æ´ã€èµ„äº§ï¼‰æœ¬èº«å³ä¸ºæ ¼å¼åŒ–æ•°æ®ï¼Œæœ€ç»ˆæ‰€æœ‰æ ¼å¼åŒ–æ•°æ®å‡éœ€ç»Ÿä¸€å­˜å‚¨åˆ°é«˜æ€§èƒ½æ¶ˆæ¯é˜Ÿåˆ—Kafkaã€‚ 4.Sabreçš„å…³é”®æŠ€æœ¯(1) ç³»ç»Ÿæ¶æ„ ä¸Šå›¾ä¸ºSabreç³»ç»Ÿæ•´ä½“æ¶æ„å›¾ã€‚Sabreæ•´ä½“æ¶æ„åŒ…å«ä¸‰å¤§æ ¸å¿ƒæ¨¡å—ï¼Œä¸­é—´æ˜¯Sabre-serverï¼Œå·¦ä¾§æ˜¯é…ç½®ç«¯ï¼Œå³ä¾§æ˜¯Sabreè¿è¡Œç«¯ã€‚æ ¸å¿ƒæ•°æ®æµå­˜åœ¨ä¸¤æ¡ä¸»çº¿ï¼Œçº¢çº¿è¡¨ç¤ºè§„åˆ™çš„æäº¤ã€ç¼–è¯‘ã€å‘å¸ƒå’Œè¿è¡Œæµç¨‹ã€‚ç»¿çº¿è¡¨ç¤ºçŠ¶æ€ç›‘æ§çš„ç”Ÿæˆã€æ”¶é›†ã€ç»Ÿè®¡å’Œå±•ç¤ºæµç¨‹ã€‚å¦‚å›¾æ‰€ç¤ºï¼Œæ­¤æ¶æ„ä¸Hiveæä¸ºç›¸ä¼¼ï¼Œæ˜¯ä¸€ç§é€šç”¨çš„å¤§æ•°æ®OLAPç³»ç»Ÿæ¶æ„ã€‚ä¸‹é¢è¯¦ç»†ä»‹ç»ä¸‰å¤§æ ¸å¿ƒæ¨¡å—å’Œä¸¤å¤§æ ¸å¿ƒæ•°æ®æµã€‚ é¦–å…ˆï¼Œé€šè¿‡è§„åˆ™é…ç½®ç«¯åˆ›å»ºè§„åˆ™ï¼Œé‡‡ç”¨æ€§èƒ½ä¿æŠ¤é…ç½®ç«¯ä¿®æ”¹æ€§èƒ½ä¿æŠ¤ç­–ç•¥ï¼Œç„¶åå°†ä»»åŠ¡æ‰€å±çš„è§„åˆ™æ–‡ä»¶å’Œæ€§èƒ½ä¿æŠ¤ç­–ç•¥æ–‡ä»¶ä¸€å¹¶æ¨é€åˆ°Sabre-serveræä¾›çš„RESTæ¥å£ï¼Œè¯¥æ¥å£ä¼šè°ƒç”¨æ–‡ä»¶è§£æåŠä¼˜åŒ–æ–¹æ³•æ„å»ºè§„åˆ™æœ‰å‘æ— ç¯å›¾ã€‚æ¥ç€æ‰§è¡Œè¯æ³•è¯­æ³•åˆ†ææ–¹æ³•ï¼Œå°†è§„åˆ™æœ‰å‘æ— ç¯å›¾ä¸­å„ä¸ªèŠ‚ç‚¹çš„EPLè½¬æ¢ä¸ºä¸å…¶å¯¹åº”çš„ASTï¼ˆAbstract Syntax Treeï¼ŒæŠ½è±¡è¯­æ³•æ ‘ï¼‰ï¼Œå†å°†ASTç¿»è¯‘ä¸ºä»»åŠ¡javaä»£ç ã€‚æœ€åè°ƒç”¨mavenå‘½ä»¤æ‰“åŒ…javaä»£ç ä¸ºä»»åŠ¡jaråŒ…ï¼Œå¹¶å°†ä»»åŠ¡jaråŒ…åŠåŸºç¡€è¿è¡Œåº“ä¸€å¹¶æäº¤åˆ°Flink-on-YARNé›†ç¾¤ã€‚ Flinkæœ‰å¤šç§è¿è¡Œæ¨¡å¼ï¼ˆä¾‹å¦‚ standalone Flink clusterã€Flink cluster on YARNã€Flink job on YARNç­‰ï¼‰ï¼ŒSabreé‡‡ç”¨äº†â€œFlink job on YARNâ€æ¨¡å¼ï¼Œåœ¨å¥‡å®‰ä¿¡NGSOCåº”ç”¨çš„ç‰¹å®šåœºæ™¯ä¸‹ï¼Œé‡‡ç”¨YARNå¯ç»Ÿä¸€ç»´æŠ¤ç¡¬ä»¶èµ„æºï¼Œå¹¶ä¸”ä½¿ç”¨ Flink job on YARN å¯ä¸Hadoopå¹³å°è¿›è¡Œæ— ç¼å¯¹æ¥ï¼Œä»¥æ­¤å®ç°äº†å¾ˆå¥½çš„ä»»åŠ¡é—´èµ„æºéš”ç¦»ã€‚ åœ¨Sabreä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼ŒKafkaæ•°æ®æºå‘å¼•æ“æä¾›åŸå§‹äº‹ä»¶ã€‚å¼•æ“å¤„ç†ç»“æœåˆ†ä¸ºå›æ³¨äº‹ä»¶å’Œå‘Šè­¦äº‹ä»¶ä¸¤ç±»ã€‚å‘Šè­¦äº‹ä»¶ä¼šç›´æ¥è¾“å‡ºåˆ°ç›®çš„Kafkaï¼Œä¾›ä¸‹çº§åº”ç”¨æ¶ˆè´¹ã€‚å›æ³¨äº‹ä»¶è¡¨ç¤ºä¸€æ¡è§„åˆ™çš„å¤„ç†ç»“æœå¯ç›´æ¥å›æ³¨åˆ°ä¸‹çº§è§„åˆ™ï¼Œä½œä¸ºä¸‹çº§è§„åˆ™çš„æ•°æ®æºäº‹ä»¶ï¼Œç”±æ­¤å¯å®ç°è§„åˆ™çš„ç›¸äº’å¼•ç”¨ã€‚ ç»¿çº¿æµç¨‹è¡¨ç¤ºä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ä¼šå®šæ—¶è¾“å‡ºèŠ‚ç‚¹çš„è¿è¡Œç›‘æ§æ¶ˆæ¯åˆ°Sabre-serverçš„ç›‘æ§æ¶ˆæ¯ç¼“å­˜å™¨ï¼Œç„¶åç›‘æ§æ¶ˆæ¯ç»Ÿè®¡å™¨å†æ±‡æ€»å„ä¸ªè§„åˆ™å®ä¾‹çš„è¿è¡Œç›‘æ§æ¶ˆæ¯ï¼Œç»Ÿè®¡ä¸ºæ•´æ¡è§„åˆ™çš„è¿è¡Œç›‘æ§çŠ¶æ€ï¼Œæœ€åé€šè¿‡Sabre-serveræä¾›çš„RESTæ¥å£æ¨é€ç»™è§„åˆ™ç›‘æ§ç«¯ã€‚ (2) åŠŸèƒ½è®¾è®¡ ç®—å­çš„è®¾è®¡å’Œå®ç°æ˜¯æ„å»ºCEPçš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚ ä¸Šå›¾å±•ç¤ºäº†Flinkå’ŒSabreç®—å­çš„æ¯”è¾ƒå…³ç³»ã€‚åŒ…å«ä¸‰åˆ—ï¼šFlinkåŸç”Ÿç®—å­ã€Sabreç®—å­ã€ä¸¤è€…ä¹‹é—´çš„æ¯”è¾ƒç»“æœï¼ˆç›¸åŒã€å®ç°ã€ä¼˜åŒ–ã€æ–°å¢ï¼‰ã€‚Sabreå…±æœ‰13ç§å®Œå…¨è‡ªç ”çš„æ ¸å¿ƒç®—å­ï¼Œå…¶ä¸­Datasourceã€CustomKafkaSinkå’ŒCustomDatabaseæŒ‰ç…§ Flinkæ¥å£è¦æ±‚åšäº†å…·ä½“å®ç°ï¼ŒFilterã€Keyã€Joinå’ŒAggregationæŒ‰ç…§FlinkåŸæœ‰ç®—å­çš„è¯­ä¹‰åšäº†é‡æ–°å®ç°ï¼ŒCustomWindowå’ŒSequenceåœ¨FlinkåŸæœ‰ç®—å­è¯­ä¹‰çš„åŸºç¡€ä¸Šåšäº†ä¼˜åŒ–å®ç°ã€‚ ç”±äºFlinkåŸæœ‰FilterFunctionç®—å­åªèƒ½ç®€å•è¿”å›å¸ƒå°”å€¼ï¼Œä»¥è‡´è¾“å‡ºç»“æœçš„æ§åˆ¶èƒ½åŠ›è¾ƒå·®ï¼Œè€Œé‡æ–°å®ç°çš„Filterç®—å­å¯åŒæ—¶æ‰§è¡Œå¤šç§ä¸šåŠ¡é€»è¾‘ï¼Œå°†ä¸€ä¸ªâ€œåŸå§‹äº‹ä»¶â€è¾“å‡ºä¸€ä¸ªæˆ–å¤šä¸ªâ€œå¤„ç†äº‹ä»¶â€ã€‚Sabreè¿˜å®ç°äº†ä¸€ç§é’ˆå¯¹çª—å£çš„å…¨å±€è§¦å‘å™¨Triggerï¼ŒTriggerèƒ½å¤Ÿå°†å¤šä¸ªå­è®¡ç®—æ€§ç®—å­ç»„åˆä¸ºå¤æ‚è¡¨è¾¾å¼ï¼Œå¹¶å®ç°äº†å…·æœ‰GroupBy/DistinctåŠŸèƒ½çš„Keyç®—å­ä»¥é€‚é…æ­¤Triggerç®—å­ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼ŒJoinå’ŒAggregationçš„æ—¶é—´èŒƒå›´ç”±Windowé™å®šï¼Œè€ŒFlinkåŸæœ‰Windowç®—å­ä¸é€‚åˆç½‘ç»œå®‰å…¨ç›‘æµ‹éœ€æ±‚ï¼Œä¸ºæ­¤Sabreè®¾è®¡äº†ä¸€ç§â€œè‡ªå®šä¹‰Windowç®—å­â€ï¼Œä¸”é‡æ–°å®ç°äº†ä¸â€œè‡ªå®šä¹‰Windowç®—å­â€ç›¸åŒ¹é…çš„Joinå’ŒAggregationç®—å­ã€‚ ä¸Šå›¾å±•ç¤ºäº†Sabreç®—å­é—´çš„å…³è”å…³ç³»ã€‚åºåˆ—Sequenceã€èšåˆAggregationã€ä¸å‘ç”ŸNotOccurã€æµå¼æœºå™¨å­¦ä¹ StreamMLå’Œè¿æ¥Joinå‡å±äºWindowæ‰§è¡Œæ—¶é—´åŒ…å«çš„è®¡ç®—æ€§ç®—å­ã€‚è“è‰²è™šçº¿è¡¨ç¤ºå¼•ç”¨åŠ¨æ€æ•°æ®ï¼Œç´«è‰²è™šçº¿è¡¨ç¤ºFilteræ— é¡»ç»è¿‡Windowå¯ç›´è¿è¾“å‡ºç»„ä»¶ã€‚ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä¸ºæ»¡è¶³å¤æ‚åœºæ™¯éœ€æ±‚ï¼Œä¸€ç§è§„åˆ™çš„è¾“å‡ºå¯ç›´æ¥ä½œä¸ºå¦ä¸€ç§è§„åˆ™çš„è¾“å…¥ã€‚é€šè¿‡è¿™ç§è§„åˆ™æ‹†åˆ†çš„æ–¹å¼ï¼Œèƒ½åˆ†å±‚æ„é€ è¾ƒä¸ºå¤æ‚çš„â€œå¤šçº§è§„åˆ™â€ã€‚å¦‚ï¼šä¸Šé¢çš„â€œæš´åŠ›æ¢æµ‹â€è§„åˆ™ç»“æœå¯ä»¥ç›´æ¥å›æ³¨åˆ°ä¸‹é¢çš„â€œç™»é™†æˆåŠŸ â€è§„åˆ™ï¼Œè€Œæ— é¡»é¢å¤–çš„é€šä¿¡ç»„ä»¶ã€‚ (3) æ€§èƒ½ä¼˜åŒ– å› ä¸ºé‡‡ç”¨äº†Flinkä½œä¸ºåº•å±‚è¿è¡Œç»„ä»¶ï¼Œæ‰€ä»¥Sabreå…·æœ‰ä¸Flinkç­‰åŒçš„æ‰§è¡Œæ€§èƒ½ã€‚å¹¶ä¸”ï¼Œé’ˆå¯¹ç½‘ç»œå®‰å…¨ç›‘æµ‹é¢†åŸŸçš„ç‰¹å®šéœ€æ±‚ï¼Œè¿˜åšäº†å¦‚ä¸‹çš„æ€§èƒ½ä¼˜åŒ–å·¥ä½œï¼š 1ï¼‰å…¨å±€ç»„ä»¶ï¼ˆæ•°æ®æºã€åŠ¨æ€è¡¨ï¼‰å¼•ç”¨ä¼˜åŒ–ã€‚ç”±äºKafkaç±»å‹çš„æ•°æ®æºtopicæœ‰é™ï¼Œè€Œè§„åˆ™æ•°é‡å¯åŠ¨æ€æ‰©å±•ï¼Œå¯¼è‡´å¤šä¸ªè§„åˆ™ä¼šæœ‰æå¤§æ¦‚ç‡å…±ç”¨åŒä¸€ä¸ªæ•°æ®æºï¼Œæ ¹æ®EPLè¯­ä¹‰ç­‰ä»·åŸåˆ™åˆå¹¶ç›¸åŒçš„æ•°æ®æºï¼Œè¿›è€Œå¯ä»¥å‡å°‘æ•°æ®è¾“å…¥æ€»é‡åŠçº¿ç¨‹æ€»æ•°ã€‚ 2ï¼‰å…¨æ–°çš„åŒ¹é…å¼•æ“ã€‚åºåˆ—Sequenceç®—å­é‡‡ç”¨äº†æ–°é¢–çš„æµå¼çŠ¶æ€æœºå¼•æ“ï¼Œå¤ç”¨äº†çŠ¶æ€æœºç¼“å­˜çš„çŠ¶æ€ï¼Œæå‡äº†åŒ¹é…é€Ÿåº¦ã€‚ç±»ä¼¼ä¼˜åŒ–è¿˜åŒ…å«å¤§è§„æ¨¡IPåŒ¹é…å¼•æ“å’Œå¤§è§„æ¨¡ä¸²åŒ¹é…å¼•æ“ã€‚ 3ï¼‰è¡¨è®¡ç®—è¡¨è¾¾å¼ä¼˜åŒ–ã€‚å¯¹äºè§„åˆ™ä¸­å¼•ç”¨çš„åŠ¨æ€è¡¨ï¼Œä¼šæ ¹æ®è¡¨è¾¾å¼çš„å…·ä½“ç‰¹æ€§æ„å»ºå…¶å¯¹åº”çš„æœ€ä¼˜è®¡ç®—æ•°æ®ç»“æ„ï¼Œä»¥é¿å…æ‰«æå…¨è¡¨æ•°æ®ï¼Œè¿›è€Œç¡®ä¿äº†æ‰§è¡Œçš„æ—¶é—´å¤æ‚åº¦ä¸ºå¸¸é‡å€¼ã€‚ 4ï¼‰è‡ªå®šä¹‰æµå¼Windowç®—å­ã€‚é‡‡ç”¨â€œæ—¶é—´æ§½â€æŠ€æœ¯å®ç°äº†ä¹±åºçº æ­£åŠŸèƒ½ï¼Œå¹¶å…·æœ‰å¯ä»¥å®æ—¶è¾“å‡ºæ— é‡å¤ã€æ— é—æ¼å‘Šè­¦çš„ç‰¹æ€§ã€‚ 5ï¼‰å­—æ®µè‡ªåŠ¨æ¨å¯¼ï¼Œä¼˜åŒ–äº‹ä»¶ç»“æ„ã€‚æ ¹æ®è§„åˆ™å‰åé€»è¾‘å…³ç³»ï¼Œæ¨å¯¼å‡ºè§„åˆ™ä¸­æ ‡æ³¨ä½¿ç”¨çš„åŸå§‹æ—¥å¿—ç›¸å…³å­—æ®µï¼Œæ— é¡»è¾“å‡ºæ‰€æœ‰å­—æ®µï¼Œä»¥æ­¤ä¼˜åŒ–è¾“å‡ºäº‹ä»¶ç»“æ„ï¼Œå‡å°‘è¾“å‡ºäº‹ä»¶å¤§å°ã€‚ 6ï¼‰æ•°æ®åˆ†åŒºè‡ªåŠ¨æ¨å¯¼ï¼Œä¼˜åŒ–æµæ‹“æ‰‘ã€‚ç”±äºåŠŸèƒ½éœ€è¦ï¼ŒWindowå¾€å¾€ä¼šç¼“å­˜å¤§é‡æ•°æ®ï¼Œä»¥è‡´æ¶ˆè€—è¾ƒå¤šå†…å­˜ã€‚é€šè¿‡å¯¹å…¨å±€çª—å£Hashä¼˜åŒ–ï¼Œé¿å…æ‰€æœ‰å…¨å±€çª—å£éƒ½åˆ†é…åˆ°åŒä¸€ä¸ªTaskmanagerè¿›ç¨‹ï¼Œç”±æ­¤æé«˜äº†å¼•æ“æ•´ä½“å†…å­˜çš„åˆ©ç”¨ç‡ã€‚ (4) æœºå™¨å­¦ä¹  æœºå™¨å­¦ä¹ åœ¨ç½‘ç»œå¼‚å¸¸æ£€æµ‹ä¸Šå·²ç»è¶Šæ¥è¶Šé‡è¦ï¼Œä¸ºé€‚åº”å®æ—¶æ£€æµ‹çš„éœ€æ±‚ï¼ŒSabreæ²¡æœ‰ä½¿ç”¨Flink MachineLearningï¼Œè€Œæ˜¯å¼•å…¥äº†è‡ªç ”çš„æµå¼æœºå™¨å­¦ä¹ ç®—å­StreamMLã€‚Flink MachineLearningæ˜¯ä¸€ç§åŸºäºæ‰¹æ¨¡å¼DataSetApiå®ç°çš„æœºå™¨å­¦ä¹ å‡½æ•°åº“ï¼Œè€ŒStreamMLæ˜¯ä¸€ç§æµå¼çš„æœºå™¨å­¦ä¹ ç®—å­ï¼Œå…¶ç›®çš„æ˜¯ä¸ºäº†æ»¡è¶³ç½‘ç»œå®‰å…¨ç›‘æµ‹çš„ç‰¹å®šéœ€æ±‚ã€‚ä¸é˜¿é‡Œå·´å·´å¼€æºçš„Alinkç›¸æ¯”ï¼ŒStreamMLå…è®¸æœºå™¨å­¦ä¹ ç®—æ³•å·¥ç¨‹å¸ˆé€šè¿‡é…ç½®è§„åˆ™çš„æ–¹å¼å³å¯å¿«é€ŸéªŒè¯ç®—æ³•æ¨¡å‹ï¼Œæ— éœ€ç¼–å†™ä»»ä½•ç¨‹åºä»£ç ã€‚å¹¶ä¸”ï¼Œæµå¼æœºå™¨å­¦ä¹ ç®—å­StreamMLå®ç°äº†â€œæ¨¡å‹è®­ç»ƒ/æ›´æ–°â€ä¸â€œæ¨¡å‹ä½¿ç”¨â€ç»Ÿä¸€çš„ç†å¿µã€‚å…¶æ ¸å¿ƒåŠŸèƒ½æ˜¯é€šè¿‡ç®—æ³•ã€æŠ€æœ¯åŠæ¨¡å‹å®ç°æ•°æ®è®­ç»ƒåŠå¯¹æ–°æ•°æ®æ£€æµ‹ã€‚è¯¥æµå¼æœºå™¨å­¦ä¹ ç®—å­StreamMLå¼•å…¥çš„è¾“å…¥æœ‰ä¸‰ç±»ï¼Œåˆ†åˆ«æ˜¯ï¼šäº‹ä»¶æµã€æ£€æµ‹å¯¹è±¡å’Œå¯¹è±¡å±æ€§ï¼›è¾“å‡ºä¹ŸåŒ…å«ä¸‰ç±»ï¼Œåˆ†åˆ«æ˜¯ï¼šäº‹ä»¶ã€å‘Šè­¦å’Œé¢„è­¦ã€‚ æµå¼æœºå™¨å­¦ä¹ ç®—å­StreamMLçš„ç»„ä»¶æ ˆåŒ…å«ä¸‰éƒ¨åˆ†ï¼Œä»ä¸‹å¾€ä¸Šä¾æ¬¡ä¸ºï¼šæœºå™¨å­¦ä¹ æ–¹æ³•ã€åº”ç”¨åœºæ™¯å’Œäº§å“ä¸šåŠ¡ã€‚é€šè¿‡åŸºæœ¬çš„æœºå™¨å­¦ä¹ ç®—æ³•ï¼ˆæ¯”å¦‚ï¼šç»Ÿè®¡å­¦ä¹ ç®—æ³•ã€åºåˆ—åˆ†æç®—æ³•ã€èšç±»åˆ†æç®—æ³•ï¼‰ï¼Œæµå¼æœºå™¨å­¦ä¹ ç®—å­StreamMLå¯æ»¡è¶³å…·ä½“ç‰¹å®šçš„å®‰å…¨ç›‘æµ‹åº”ç”¨åœºæ™¯ï¼ˆæ¯”å¦‚ï¼šè¡Œä¸ºç‰¹å¾å¼‚å¸¸æ£€æµ‹ã€æ—¶é—´åºåˆ—å¼‚å¸¸æ£€æµ‹ã€ç¾¤ç»„èšç±»åˆ†æï¼‰ï¼Œè¿›è€Œä¸ºç”¨æˆ·æä¾›å¯ç†è§£çš„äº§å“ä¸šåŠ¡ï¼ˆæ¯”å¦‚ï¼šåŸºçº¿ã€ç”¨æˆ·åŠå®ä½“è¡Œä¸ºåˆ†æUEBAï¼‰ã€‚ è¡Œä¸ºç‰¹å¾å¼‚å¸¸æ£€æµ‹ï¼šæ ¹æ®é‡‡é›†çš„æ ·æœ¬æ•°æ®ï¼ˆé•¿æ—¶é—´ï¼‰å¯¹ç»Ÿè®¡åˆ†æå¯¹è±¡å»ºç«‹è¡Œä¸ºåŸºçº¿ï¼Œå¹¶ä»¥æ­¤åŸºçº¿ä¸ºå‡†ï¼Œæ£€æµ‹å‘ç°åç¦»æ­£å¸¸è¡Œä¸ºæ¨¡å¼çš„è¡Œä¸ºã€‚ä¾‹å¦‚ï¼šè¯¥ç”¨æˆ·é€šå¸¸ä»å“ªé‡Œå‘èµ·è¿æ¥ï¼Ÿå“ªä¸ªè¿è¥å•†ï¼Ÿå“ªä¸ªå›½å®¶ï¼Ÿå“ªä¸ªåœ°åŒºï¼Ÿè¿™ä¸ªç”¨æˆ·è¡Œä¸ºå¼‚å¸¸åœ¨ç»„ç»‡å†…æ˜¯å¦ä¸ºå¸¸è§å¼‚å¸¸ï¼Ÿ æ—¶é—´åºåˆ—å¼‚å¸¸æ£€æµ‹ï¼šæ ¹æ®æŸä¸€ä¸ªæˆ–å¤šä¸ªç»Ÿè®¡å±æ€§ï¼Œåˆ¤æ–­æŒ‰æ—¶é—´é¡ºåºæ’åˆ—çš„æ•°å€¼åºåˆ—æ˜¯å¦å¼‚å¸¸ï¼Œç”±æ­¤é€šè¿‡ç›‘æµ‹æŒ‡æ ‡å˜åŒ–æ¥å‘ç°å®‰å…¨äº‹ä»¶ã€‚ä¾‹å¦‚ï¼šç›‘æµ‹æŸç½‘ç«™æ¯å°æ—¶çš„è®¿é—®é‡ä»¥é˜²æ­¢DDOSæ”»å‡»ï¼›å»ºæ¨¡æ¯ä¸ªè´¦å·ä¼ è¾“æ–‡ä»¶å¤§å°çš„å¹³å‡å€¼ï¼Œæ£€æµ‹å‡ºä¼ è¾“æ–‡ä»¶å¤§å°çš„å¹³å‡å€¼ç¦»ç¾¤çš„è´¦å·ã€‚ ç¾¤ç»„èšç±»åˆ†æï¼šå¯¹æ•°æ®çš„ç‰¹å¾å±æ€§é—´æ½œåœ¨ç›¸å…³æ€§è¿›è¡ŒæŒ–æ˜ï¼Œå°†å…·æœ‰ç±»ä¼¼ç‰¹å¾å€¼çš„æ•°æ®è¿›è¡Œåˆ†ç»„èšç±»ã€‚ä¾‹å¦‚ï¼šè¯¥ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰ä»»ä½•ç‰¹æ®Šç‰¹å¾ï¼Ÿå¯æ‰§è¡Œæƒé™/ç‰¹æƒç”¨æˆ·ï¼ŸåŸºäºæ‰§è¡Œçš„æ“ä½œå‘½ä»¤å’Œå¯è®¿é—®çš„å®ä½“ï¼Œæ¥è¯†åˆ«ITç®¡ç†å‘˜ã€DBAå’Œå…¶å®ƒé«˜æƒé™ç”¨æˆ·ã€‚ 5.Sabreå¦‚ä½•å¿«é€Ÿé€‚é…å¤æ‚çš„å®¢æˆ·ç¯å¢ƒ?ç”±äºå®¢æˆ·è§„æ¨¡è¾ƒå¤§ï¼Œé¡¹ç›®ç§ç±»è¾ƒå¤šï¼Œéƒ¨ç½²ç¯å¢ƒè¾ƒä¸ºå¤æ‚ï¼Œæˆ–è€…å­˜åœ¨å¤šç§Yarné›†ç¾¤ç‰ˆæœ¬ï¼Œæˆ–è€…Sabreéœ€ä½œä¸ºå•ä¸€Flinkåº”ç”¨å‘å¸ƒåˆ°å®¢æˆ·å·²éƒ¨ç½²çš„Flinké›†ç¾¤ã€‚å¦‚ä½•èŠ‚çœæˆæœ¬åŠæé«˜å®æ–½æ•ˆç‡ï¼Œå¿«é€Ÿé€‚é…ä¸Šè¿°å¤æ‚çš„éƒ¨ç½²ç¯å¢ƒæ˜¯ä¸ªäºŸéœ€è§£å†³çš„é—®é¢˜ï¼Œä¸ºæ­¤Sabreçš„è®¾è®¡åŸåˆ™æ˜¯ä»…é‡‡ç”¨Flinkçš„åˆ†å¸ƒå¼è®¡ç®—èƒ½åŠ›ï¼Œä¸šåŠ¡ä»£ç å°½å¯èƒ½å‡å°‘å¯¹APIå±‚çš„ä¾èµ–ï¼Œä»¥ä¾¿äºå…¼å®¹å¤šç§Flinkç‰ˆæœ¬ã€‚å¦‚å›¾æ‰€ç¤ºï¼ŒDeployã€Coreã€APIsã€Librarieså››å±‚æ˜¯å¤§å®¶ç†ŸçŸ¥çš„FlinkåŸºæœ¬çš„ç»„ä»¶æ ˆã€‚Sabreå¯¹APIå±‚çš„ä¾èµ–é™åˆ°äº†æœ€ä½ï¼Œåªå¼•ç”¨äº†DataStreamã€KeyedStreamå’ŒSplitStreamä¸‰ç§æ•°æ®æµAPIã€‚å‡½æ•°ä¾èµ–åˆ™åŒ…æ‹¬DataStreamçš„assignTimestampsã€flatMapã€unionã€keyByã€splitã€processã€addSinkç­‰å‡½æ•°ï¼ŒKeyedStreamæœ€åŸºç¡€çš„processå‡½æ•°ï¼Œä»¥åŠSplitStreamçš„selectå‡½æ•°ã€‚ç”±äºä¾èµ–çš„Flink APIè¾ƒå°‘ï¼ŒSabreå¯ä»¥å¾ˆå®¹æ˜“é€‚é…åˆ°å„ä¸ªFlinkç‰ˆæœ¬ï¼Œä»è€Œå…·æœ‰è‰¯å¥½çš„Flinkç‰ˆæœ¬å…¼å®¹æ€§ã€‚ 6.å¦‚ä½•ä¿éšœSabreç¨³å®šè¿è¡Œï¼Ÿä¸ºå‡å°‘å¼•æ“çš„ç»´æŠ¤æˆæœ¬ï¼Œéœ€è¦ä¿éšœå¼•æ“åœ¨è¶…é™æ•°æ®é‡çš„æ¡ä»¶ä¸‹äº¦ç„¶èƒ½å¤Ÿç¨³å®šè¿è¡Œï¼ŒSabreä¸»è¦åšäº†ä¸¤ä¸ªä¼˜åŒ–ï¼šæµé‡æ§åˆ¶å’Œè‡ªæˆ‘ä¿æŠ¤ã€‚ ä¸ºäº†å¢å¼ºSabreå¼•æ“çš„å¥å£®æ€§ï¼Œé¿å…å› è§„åˆ™é…ç½®é”™è¯¯ï¼Œå¯¼è‡´ç”Ÿæˆå¤§é‡æ— æ•ˆå‘Šè­¦ï¼Œåœ¨è¾“å‡ºç«¯åšäº†æµé‡æ§åˆ¶ï¼Œä»¥æ›´å¥½åœ°ä¿æŠ¤ä¸‹çº§åº”ç”¨ã€‚å½“ä¸‹çº§æŠ—å‹èƒ½åŠ›è¾ƒå¼±æ—¶ï¼ˆä¾‹å¦‚æ•°æ®åº“ï¼‰ï¼Œæ•´ä¸ªç³»ç»Ÿä¼šåšè¾“å‡ºé™çº§ã€‚ å¦ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œè·‘åœ¨JVMä¸Šçš„ç¨‹åºï¼Œç»å¸¸ä¼šé‡åˆ°ç”±äºé•¿æ—¶é—´ Full GCå¯¼è‡´OOMçš„é”™è¯¯ï¼Œå¹¶ä¸”æ­¤æ—¶CPUå ç”¨ç‡å¾€å¾€éå¸¸é«˜ï¼ŒFlinkåŒæ ·å­˜åœ¨ä¸Šè¿°é—®é¢˜ã€‚è‡ªæˆ‘ä¿æŠ¤åŠŸèƒ½é‡‡ç”¨äº†åŒæ—¶å…¼é¡¾â€œWindowéš¶å±è§„åˆ™çš„ä¼˜å…ˆçº§â€åŠâ€œWindowå¼•ç”¨è§„åˆ™æ•°é‡â€ä¸¤ä¸ªæ¡ä»¶çš„åŠ æƒç®—æ³•ï¼Œä»¥æ­¤æ ¹æ®å…¨å±€è§„åˆ™è¯­ä¹‰å®ç°è‡ªåŠ¨æ¨å¯¼Windowä¼˜å…ˆçº§ï¼Œå¹¶æ ¹æ®æ­¤ä¼˜å…ˆçº§ç¡®å®šå„ä¸ªWindowçš„è‡ªæˆ‘ä¿æŠ¤é¡ºåºã€‚å®æ—¶ç›‘æ§CPUåŠå†…å­˜å ç”¨ï¼Œå½“è¶…è¿‡ä¸€å®šé˜ˆå€¼æ—¶ï¼Œæ™ºèƒ½ä¼˜åŒ–äº‹ä»¶åˆ†å¸ƒï¼Œä»¥é˜²å‡ºç°CPUé•¿æœŸè¿‡é«˜æˆ–å†…å­˜ä½¿ç”¨ç‡è¿‡å¤§è€Œå¯¼è‡´çš„OOMé—®é¢˜ã€‚ ç›®å‰ï¼ŒåŸºäºFlinkæ„å»ºçš„Sabreå¼•æ“è¿˜åœ¨ç»§ç»­å¼€å‘æ–°çš„åŠŸèƒ½ï¼Œå¹¶ä¼šæŒç»­ä¼˜åŒ–å¼•æ“æ€§èƒ½ã€‚æœªæ¥å°†æ€»ç»“å‡ç»ƒé¡¹ç›®ä¸­çš„ä¼˜ç§€å®è·µï¼Œå¹¶åŠæ—¶å›é¦ˆç»™Apache Flinkç¤¾åŒºã€‚ æœ€åGitHub Flink å­¦ä¹ ä»£ç åœ°å€ï¼šhttps://github.com/zhisheng17/flink-learning å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ ä¸“æ ä»‹ç»é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€åŸç†ã€å®æˆ˜ã€æ€§èƒ½è°ƒä¼˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€Šå¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹ç›®å½•å¤§çº²","date":"2019-11-23T16:00:00.000Z","path":"2019/11/24/flink-in-action-directory/","text":"åŸºäº Flink 1.9 è®²è§£çš„ä¹¦ç±ç›®å½•å¤§çº²ï¼Œå« Flink å…¥é—¨ã€æ¦‚å¿µã€åŸç†ã€å®æˆ˜ã€æ€§èƒ½è°ƒä¼˜ã€æºç è§£æç­‰å†…å®¹ã€‚æ¶‰åŠ Flink Connectorã€Metricsã€Libraryã€DataStream APIã€Table API &amp; SQL ç­‰å†…å®¹çš„å­¦ä¹ æ¡ˆä¾‹ï¼Œè¿˜æœ‰ Flink è½åœ°åº”ç”¨çš„å¤§å‹é¡¹ç›®æ¡ˆä¾‹åˆ†äº«ã€‚ ä¹¦ç±å’Œä¸“æ åŒæ—¶åœ¨è¿›è¡Œï¼Œæ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…ä¸“æ ï¼Œæå‰æŸ¥çœ‹ä¹¦ç±å†…å®¹ã€‚ é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f ä¹¦ç±ç›®å½•å¤§çº²1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274281é¢„å¤‡ç¯‡ç¬¬ä¸€ç« â€”â€”å®æ—¶è®¡ç®—å¼•æ“ 1.1ä½ çš„å…¬å¸æ˜¯å¦éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ 1.1.1 å®æ—¶è®¡ç®—éœ€æ±‚ 1.1.2 æ•°æ®å®æ—¶é‡‡é›† 1.1.3 æ•°æ®å®æ—¶è®¡ç®— 1.1.4 æ•°æ®å®æ—¶ä¸‹å‘ 1.1.5 å®æ—¶è®¡ç®—åœºæ™¯ 1.1.6 ç¦»çº¿è®¡ç®— vs å®æ—¶è®¡ç®— 1.1.7 å®æ—¶è®¡ç®—é¢ä¸´çš„æŒ‘æˆ˜ 1.1.8 å°ç»“ä¸åæ€ 1.2å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—æ¡†æ¶ Flink 1.2.1 Flink ç®€ä»‹ 1.2.2 Flink æ•´ä½“æ¶æ„ 1.2.3 Flink çš„å¤šç§æ–¹å¼éƒ¨ç½² 1.2.4 Flink åˆ†å¸ƒå¼è¿è¡Œæµç¨‹ 1.2.5 Flink API 1.2.6 Flink ç¨‹åºä¸æ•°æ®æµç»“æ„ 1.2.7 ä¸°å¯Œçš„ Connector 1.2.8 äº‹ä»¶æ—¶é—´&amp;å¤„ç†æ—¶é—´è¯­ä¹‰ 1.2.9 çµæ´»çš„çª—å£æœºåˆ¶ 1.2.10 å¹¶è¡Œæ‰§è¡Œä»»åŠ¡æœºåˆ¶ 1.2.11 çŠ¶æ€å­˜å‚¨å’Œå®¹é”™ 1.2.12 è‡ªå·±çš„å†…å­˜ç®¡ç†æœºåˆ¶ 1.2.13 å¤šç§æ‰©å±•åº“ 1.2.14 å°ç»“ä¸åæ€ 1.3å¤§æ•°æ®è®¡ç®—æ¡†æ¶å¯¹æ¯” 1.3.1 Flink 1.3.2 Blink 1.3.3 Spark 1.3.4 Spark Streaming 1.3.5 Structured Streaming 1.3.6 Flink VS Spark 1.3.7 Storm 1.3.8 Flink VS Storm 1.3.9 å…¨éƒ¨å¯¹æ¯”ç»“æœ 1.3.10 å°ç»“ä¸åæ€ 1.4æ€»ç»“2ç¬¬äºŒç« â€”â€”Flink å…¥é—¨ 2.1Flink ç¯å¢ƒå‡†å¤‡ 2.1.1 JDK å®‰è£…ä¸é…ç½® 2.1.2 Maven å®‰è£…ä¸é…ç½® 2.1.3 IDE å®‰è£…ä¸é…ç½® 2.1.4 MySQL å®‰è£…ä¸é…ç½® 2.1.5 Kafka å®‰è£…ä¸é…ç½® 2.1.6 ElasticSearch å®‰è£…ä¸é…ç½® 2.1.7 å°ç»“ä¸åæ€ 2.2Flink ç¯å¢ƒæ­å»º 2.2.1 Flink ä¸‹è½½ä¸å®‰è£… 2.2.2 Flink å¯åŠ¨ä¸è¿è¡Œ 2.2.3 Flink ç›®å½•é…ç½®æ–‡ä»¶è§£è¯» 2.2.4 Flink æºç ä¸‹è½½ 2.2.5 Flink æºç ç¼–è¯‘ 2.2.6 å°† Flink æºç å¯¼å…¥åˆ° IDE 2.2.7 å°ç»“ä¸åæ€ 2.3æ¡ˆä¾‹1ï¼šWordCount åº”ç”¨ç¨‹åº 2.3.1 ä½¿ç”¨ Maven åˆ›å»ºé¡¹ç›® 2.3.2 ä½¿ç”¨ IDEA åˆ›å»ºé¡¹ç›® 2.3.3 æµè®¡ç®— WordCount åº”ç”¨ç¨‹åºä»£ç å®ç° 2.3.4 è¿è¡Œæµè®¡ç®— WordCount åº”ç”¨ç¨‹åº 2.3.5 æµè®¡ç®— WordCount åº”ç”¨ç¨‹åºä»£ç åˆ†æ 2.3.6 å°ç»“ä¸åæ€ 2.4æ¡ˆä¾‹2ï¼šå®æ—¶å¤„ç† Socket æ•°æ® 2.4.1 ä½¿ç”¨ IDEA åˆ›å»ºé¡¹ç›® 2.4.2 å®æ—¶å¤„ç† Socket æ•°æ®åº”ç”¨ç¨‹åºä»£ç å®ç° 2.4.3 è¿è¡Œå®æ—¶å¤„ç† Socket æ•°æ®åº”ç”¨ç¨‹åº 2.4.4 å®æ—¶å¤„ç† Socket æ•°æ®åº”ç”¨ç¨‹åºä»£ç åˆ†æ 2.4.5 Flink ä¸­ä½¿ç”¨ Lambda è¡¨è¾¾å¼ 2.4.5 å°ç»“ä¸åæ€ 2.5æ€»ç»“ 2åŸºç¡€ç¯‡3ç¬¬ä¸‰ç« â€”â€”Flink ä¸­çš„æµè®¡ç®—å¤„ç† 3.1Flink å¤šç§æ—¶é—´è¯­ä¹‰å¯¹æ¯” 3.1.1 Processing Time 3.1.2 Event Time 3.1.3 Ingestion Time 3.1.4 ä¸‰ç§ Time çš„å¯¹æ¯”ç»“æœ 3.1.5 ä½¿ç”¨åœºæ™¯åˆ†æ 3.1.6 Time ç­–ç•¥è®¾ç½® 3.1.7 å°ç»“ä¸åæ€ 3.2Flink Window åŸºç¡€æ¦‚å¿µä¸å®ç°åŸç† 3.2.1 Window ç®€ä»‹ 3.2.2 Window æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 3.2.3 Flink è‡ªå¸¦çš„ Window 3.2.4 Time Window çš„ç”¨æ³•åŠæºç åˆ†æ 3.2.5 Count Window çš„ç”¨æ³•åŠæºç åˆ†æ 3.2.6 Session Window çš„ç”¨æ³•åŠæºç åˆ†æ 3.2.7 å¦‚ä½•è‡ªå®šä¹‰ Windowï¼Ÿ 3.2.8 Window æºç åˆ†æ 3.2.9 Window ç»„ä»¶ä¹‹ WindowAssigner çš„ç”¨æ³•åŠæºç åˆ†æ 3.2.10 Window ç»„ä»¶ä¹‹ Trigger çš„ç”¨æ³•åŠæºç åˆ†æ 3.2.11 Window ç»„ä»¶ä¹‹ Evictor çš„ç”¨æ³•åŠæºç åˆ†æ 3.2.12 å°ç»“ä¸åæ€ 3.3å¿…é¡»ç†Ÿæ‚‰çš„æ•°æ®è½¬æ¢ Operator(ç®—å­) 3.3.1 DataStream Operator 3.3.2 DataSet Operator 3.3.3 æµè®¡ç®—ä¸æ‰¹è®¡ç®—ç»Ÿä¸€çš„æ€è·¯ 3.3.4 å°ç»“ä¸åæ€ 3.4ä½¿ç”¨ DataStream API æ¥å¤„ç†æ•°æ® 3.4.1 DataStream çš„ç”¨æ³•åŠåˆ†æ 3.4.2 SingleOutputStreamOperator çš„ç”¨æ³•åŠåˆ†æ 3.4.3 KeyedStream çš„ç”¨æ³•åŠåˆ†æ 3.4.4 SplitStream çš„ç”¨æ³•åŠåˆ†æ 3.4.5 WindowedStream çš„ç”¨æ³•åŠåˆ†æ 3.4.6 AllWindowedStream çš„ç”¨æ³•åŠåˆ†æ 3.4.7 ConnectedStreams çš„ç”¨æ³•åŠåˆ†æ 3.4.8 BroadcastStream çš„ç”¨æ³•åŠåˆ†æ 3.4.9 BroadcastConnectedStream çš„ç”¨æ³•åŠåˆ†æ 3.4.10 QueryableStateStream çš„ç”¨æ³•åŠåˆ†æ 3.4.11 å°ç»“ä¸åæ€ 3.5Watermark çš„ç”¨æ³•å’Œç»“åˆ Window å¤„ç†å»¶è¿Ÿæ•°æ® 3.5.1 Watermark ç®€ä»‹ 3.5.2 Flink ä¸­çš„ Watermark çš„è®¾ç½® 3.5.3 Punctuated Watermark 3.5.4 Periodic Watermark 3.5.5 æ¯ä¸ª Kafka åˆ†åŒºçš„æ—¶é—´æˆ³ 3.5.6 å°† Watermark ä¸ Window ç»“åˆèµ·æ¥å¤„ç†å»¶è¿Ÿæ•°æ® 3.5.7 å¤„ç†å»¶è¿Ÿæ•°æ®çš„ä¸‰ç§æ–¹æ³• 3.5.8 å°ç»“ä¸åæ€ 3.6Flink å¸¸ç”¨çš„ Source Connector å’Œ Sink Connector ä»‹ç» 3.6.1 Data Source ç®€ä»‹ 3.6.2 å¸¸ç”¨çš„ Data Source 3.6.3 Data Sink ç®€ä»‹ 3.6.4 å¸¸ç”¨çš„ Data Sink 3.6.5 å°ç»“ä¸åæ€ 3.7Flink Connector â€”â€” Kafka çš„ä½¿ç”¨å’Œæºç åˆ†æ 3.7.1 å‡†å¤‡ç¯å¢ƒå’Œä¾èµ– 3.7.2 å°†æµ‹è¯•æ•°æ®å‘é€åˆ° Kafka Topic 3.7.3 Flink å¦‚ä½•æ¶ˆè´¹ Kafka æ•°æ®ï¼Ÿ 3.7.4 Flink å¦‚ä½•å°†è®¡ç®—åçš„æ•°æ®å‘é€åˆ° Kafkaï¼Ÿ 3.7.5 FlinkKafkaConsumer æºç åˆ†æ 3.7.6 FlinkKafkaProducer æºç åˆ†æ 3.7.7 ä½¿ç”¨ Flink-connector-kafka å¯èƒ½ä¼šé‡åˆ°çš„é—®é¢˜ 3.7.8 å°ç»“ä¸åæ€ 3.8è‡ªå®šä¹‰ Flink Connector 3.8.1 è‡ªå®šä¹‰ Source Connector 3.8.2 RichSourceFunction çš„ç”¨æ³•åŠæºç åˆ†æ 3.8.3 è‡ªå®šä¹‰ Sink Connector 3.8.4 RichSinkFunction çš„ç”¨æ³•åŠæºç åˆ†æ 3.8.5 å°ç»“ä¸åæ€ 3.9Flink Connector â€”â€” ElasticSearch çš„ç”¨æ³•å’Œåˆ†æ 3.9.1 å‡†å¤‡ç¯å¢ƒå’Œä¾èµ– 3.9.2 ä½¿ç”¨ Flink å°†æ•°æ®å†™å…¥åˆ° ElasticSearch åº”ç”¨ç¨‹åº 3.9.3 éªŒè¯æ•°æ®æ˜¯å¦å†™å…¥ ElasticSearchï¼Ÿ 3.9.4 å¦‚ä½•ä¿è¯åœ¨æµ·é‡æ•°æ®å®æ—¶å†™å…¥ä¸‹ ElasticSearch çš„ç¨³å®šæ€§ï¼Ÿ 3.9.5 ä½¿ç”¨ Flink-connector-elasticsearch å¯èƒ½ä¼šé‡åˆ°çš„é—®é¢˜ 3.9.6 å°ç»“ä¸åæ€ 3.10Flink Connector â€”â€” HBase çš„ç”¨æ³• 3.10.1 å‡†å¤‡ç¯å¢ƒå’Œä¾èµ– 3.10.2 Flink ä½¿ç”¨ TableInputFormat è¯»å– HBase æ‰¹é‡æ•°æ® 3.10.3 Flink ä½¿ç”¨ TableOutputFormat å‘ HBase å†™å…¥æ•°æ® 3.10.4 Flink ä½¿ç”¨ HBaseOutputFormat å‘ HBase å®æ—¶å†™å…¥æ•°æ® 3.10.5 é¡¹ç›®è¿è¡ŒåŠéªŒè¯ 3.10.6 å°ç»“ä¸åæ€ 3.11Flink Connector â€”â€” Redis çš„ç”¨æ³• 3.11.1 å®‰è£… Redis 3.11.2 å°†å•†å“æ•°æ®å‘é€åˆ° Kafka 3.11.3 Flink æ¶ˆè´¹ Kafka ä¸­çš„å•†å“æ•°æ® 3.11.4 Redis Connector ç®€ä»‹ 3.11.5 Flink å†™å…¥æ•°æ®åˆ° Redis 3.11.6 é¡¹ç›®è¿è¡ŒåŠéªŒè¯ 3.11.7 å°ç»“ä¸åæ€ 3.12ä½¿ç”¨ Side Output åˆ†æµ 3.12.1 ä½¿ç”¨ Filter åˆ†æµ 3.12.2 ä½¿ç”¨ Split åˆ†æµ 3.12.3 ä½¿ç”¨ Side Output åˆ†æµ 3.12.4 å°ç»“ä¸åæ€ 3.13æ€»ç»“ 3è¿›é˜¶ç¯‡4ç¬¬å››ç« â€”â€”Flink ä¸­çš„çŠ¶æ€åŠå®¹é”™æœºåˆ¶ 4.1æ·±åº¦è®²è§£ Flink ä¸­çš„çŠ¶æ€ 4.1.1 ä¸ºä»€ä¹ˆéœ€è¦ Stateï¼Ÿ 4.1.2 State çš„ç§ç±» 4.1.3 Keyed State 4.1.4 Operator State 4.1.5 Raw and Managed State 4.1.6 å¦‚ä½•ä½¿ç”¨æ‰˜ç®¡çš„ Keyed State 4.1.7 State TTL(å­˜æ´»æ—¶é—´) 4.1.8 å¦‚ä½•ä½¿ç”¨æ‰˜ç®¡çš„ Operator State 4.1.9 Stateful Source Functions 4.1.10 Broadcast State 4.1.11 Queryable State 4.1.12 å°ç»“ä¸åæ€ 4.2Flink çŠ¶æ€åç«¯å­˜å‚¨ 4.2.1 State Backends 4.2.2 MemoryStateBackend çš„ç”¨æ³•åŠåˆ†æ 4.2.3 FsStateBackend çš„ç”¨æ³•åŠåˆ†æ 4.2.4 RocksDBStateBackend çš„ç”¨æ³•åŠåˆ†æ 4.2.5 å¦‚ä½•é€‰æ‹©çŠ¶æ€åç«¯å­˜å‚¨ï¼Ÿ 4.2.6 å°ç»“ä¸åæ€ 4.3Flink Checkpoint å’Œ Savepoint çš„åŒºåˆ«åŠå…¶é…ç½®ä½¿ç”¨ 4.3.1 Checkpoint ç®€ä»‹åŠä½¿ç”¨ 4.3.2 Savepoint ç®€ä»‹åŠä½¿ç”¨ 4.3.3 Savepoint ä¸ Checkpoint çš„åŒºåˆ« 4.3.4 Checkpoint æµç¨‹ 4.3.5 å¦‚ä½•ä» Checkpoint ä¸­æ¢å¤çŠ¶æ€ 4.3.6 å¦‚ä½•ä» Savepoint ä¸­æ¢å¤çŠ¶æ€ 4.3.6 å°ç»“ä¸åæ€ 4.4æ€»ç»“ 5ç¬¬äº”ç« â€”â€”Table API &amp; SQL 5.1Flink Table &amp; SQL æ¦‚å¿µä¸é€šç”¨ API 5.1.1 æ–°å¢ Blink SQL æŸ¥è¯¢å¤„ç†å™¨ 5.1.2 ä¸ºä»€ä¹ˆé€‰æ‹© Table API &amp; SQLï¼Ÿ 5.1.3 Flink Table é¡¹ç›®æ¨¡å— 5.1.4 ä¸¤ç§ planner ä¹‹é—´çš„åŒºåˆ« 5.1.5 æ·»åŠ é¡¹ç›®ä¾èµ– 5.1.6 åˆ›å»ºä¸€ä¸ª TableEnvironment 5.1.7 Table API &amp; SQL åº”ç”¨ç¨‹åºçš„ç»“æ„ 5.1.8 Catalog ä¸­æ³¨å†Œ Table 5.1.9 æ³¨å†Œå¤–éƒ¨çš„ Catalog 5.1.10 æŸ¥è¯¢ Table 5.1.11 æäº¤ Table 5.1.12 ç¿»è¯‘å¹¶æ‰§è¡ŒæŸ¥è¯¢ 5.1.13 å°ç»“ä¸åæ€ 5.2Flink Table API &amp; SQL åŠŸèƒ½ 5.2.1 Flink Table å’Œ SQL ä¸ DataStream å’Œ DataSet é›†æˆ 5.2.2 æŸ¥è¯¢ä¼˜åŒ– 5.2.3 æ•°æ®ç±»å‹ 5.2.4 æ—¶é—´å±æ€§ 5.2.5 SQL Connector 5.2.6 SQL Client 5.2.7 Hive 5.2.8 å°ç»“ä¸åæ€ 5.3æ€»ç»“ 6ç¬¬å…­ç« â€”â€”æ‰©å±•åº“ 6.1Flink CEP ç®€ä»‹åŠå…¶ä½¿ç”¨åœºæ™¯ 6.1.1 CEP ç®€ä»‹ 6.1.2 è§„åˆ™å¼•æ“å¯¹æ¯” 6.1.3 Flink CEP ç®€ä»‹ 6.1.4 Flink CEP åŠ¨æ€æ›´æ–°è§„åˆ™ 6.1.5 Flink CEP ä½¿ç”¨åœºæ™¯åˆ†æ 6.1.6 å°ç»“ä¸åæ€ 6.2ä½¿ç”¨ Flink CEP å¤„ç†å¤æ‚äº‹ä»¶ 6.2.1 å‡†å¤‡ä¾èµ– 6.2.2 Flink CEP å…¥é—¨åº”ç”¨ç¨‹åº 6.2.3 Pattern API 6.2.4 æ£€æµ‹ Pattern 6.2.5 CEP æ—¶é—´å±æ€§ 6.2.6 å°ç»“ä¸åæ€ 6.3Flink æ‰©å±•åº“â€”â€”State Processor API 6.3.1 State Processor API ç®€ä»‹ 6.3.2 åœ¨ Flink 1.9 ä¹‹å‰æ˜¯å¦‚ä½•å¤„ç†çŠ¶æ€çš„ï¼Ÿ 6.3.3 ä½¿ç”¨ State Processor API è¯»å†™ä½œä¸šçŠ¶æ€ 6.3.4 ä½¿ç”¨ DataSet è¯»å–ä½œä¸šçŠ¶æ€ 6.3.5 ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ DataSet APIï¼Ÿ 6.3.6 å°ç»“ä¸åæ€ 6.4Flink æ‰©å±•åº“â€”â€”Machine Learning 6.4.1 Flink-ML ç®€ä»‹ 6.4.2 ä½¿ç”¨ Flink-ML 6.4.3 ä½¿ç”¨ Flink-ML Pipeline 6.4.4 å°ç»“ä¸åæ€ 6.5Flink æ‰©å±•åº“â€”â€”Gelly 6.5.1 Gelly ç®€ä»‹ 6.5.2 ä½¿ç”¨ Gelly 6.5.3 Gelly API 6.5.4 å°ç»“ä¸åæ€ 6.6 æ€»ç»“4é«˜çº§ç¯‡7ç¬¬ä¸ƒç« â€”â€”Flink ä½œä¸šç¯å¢ƒéƒ¨ç½² 7.1Flink é…ç½®è¯¦è§£åŠå¦‚ä½•é…ç½®é«˜å¯ç”¨ï¼Ÿ 7.1.1 Flink é…ç½®è¯¦è§£ 7.1.2 Log çš„é…ç½® 7.1.3 å¦‚ä½•é…ç½® JobManager é«˜å¯ç”¨ï¼Ÿ 7.1.4 å°ç»“ä¸åæ€ 7.2Flink ä½œä¸šå¦‚ä½•åœ¨ Standaloneã€YARNã€Mesosã€K8S ä¸Šéƒ¨ç½²è¿è¡Œï¼Ÿ 7.2.1 Standalone 7.2.2 YARN 7.2.3 Mesos 7.3.4 Kubernetes 7.2.5 å°ç»“ä¸åæ€ 7.3æ€»ç»“ 8ç¬¬å…«ç« â€”â€”Flink ç›‘æ§ 8.1å®æ—¶ç›‘æ§ Flink åŠå…¶ä½œä¸š 8.1.1 ç›‘æ§ JobManager 8.1.2 ç›‘æ§ TaskManager 8.1.3 ç›‘æ§ Flink ä½œä¸š 8.1.4 æœ€å…³å¿ƒçš„æ€§èƒ½æŒ‡æ ‡ 8.1.5 å°ç»“ä¸åæ€ 8.2æ­å»ºä¸€å¥— Flink ç›‘æ§ç³»ç»Ÿ 8.2.1 åˆ©ç”¨ API è·å–ç›‘æ§æ•°æ® 8.2.2 Metrics ç±»å‹ç®€ä»‹ 8.2.3 åˆ©ç”¨ JMXReporter è·å–ç›‘æ§æ•°æ® 8.2.4 åˆ©ç”¨ PrometheusReporter è·å–ç›‘æ§æ•°æ® 8.2.5 åˆ©ç”¨ PrometheusPushGatewayReporter è·å–ç›‘æ§æ•°æ® 8.2.6 åˆ©ç”¨ InfluxDBReporter è·å–ç›‘æ§æ•°æ® 8.2.7 å®‰è£… InfluxDB å’Œ Grafana 8.2.8 é…ç½® Grafana å±•ç¤ºç›‘æ§æ•°æ® 8.2.9 å°ç»“ä¸åæ€ 8.3æ€»ç»“9ç¬¬ä¹ç« â€”â€”Flink æ€§èƒ½è°ƒä¼˜ 9.1å¦‚ä½•å¤„ç† Flink Job Backpressure ï¼ˆåå‹ï¼‰é—®é¢˜ï¼Ÿ 9.1.1 Flink æµå¤„ç†ä¸ºä»€ä¹ˆéœ€è¦ç½‘ç»œæµæ§ 9.1.2 Flink 1.5 ä¹‹å‰çš„ç½‘ç»œæµæ§æœºåˆ¶ 9.1.3 åŸºäº Credit çš„åå‹æœºåˆ¶ 9.1.4 å®šä½äº§ç”Ÿåå‹çš„ä½ç½® 9.1.5 åˆ†æå’Œå¤„ç†åå‹é—®é¢˜ 9.1.6 å°ç»“ä¸åæ€ 9.2å¦‚ä½•æŸ¥çœ‹ Flink ä½œä¸šæ‰§è¡Œè®¡åˆ’ï¼Ÿ 9.2.1 å¦‚ä½•è·å–æ‰§è¡Œè®¡åˆ’ JSONï¼Ÿ 9.2.2 ç”Ÿæˆæ‰§è¡Œè®¡åˆ’å›¾ 9.2.3 æ·±å…¥æ¢ç©¶ Flink ä½œä¸šæ‰§è¡Œè®¡åˆ’ 9.2.4 Flink ä¸­ç®—å­ chain èµ·æ¥çš„æ¡ä»¶ 9.2.5 å¦‚ä½•ç¦æ­¢ Operator chainï¼Ÿ 9.2.6 å°ç»“ä¸åæ€ 9.3Flink Parallelism å’Œ Slot æ·±åº¦ç†è§£ 9.3.1 Parallelism ç®€ä»‹ 9.3.2 å¦‚ä½•è®¾ç½® Parallelismï¼Ÿ 9.3.3 Slot ç®€ä»‹ 9.3.4 Slot å’Œ Parallelism çš„å…³ç³» 9.3.5 å¯èƒ½ä¼šé‡åˆ° Slot å’Œ Parallelism çš„é—®é¢˜ 9.3.6 å°ç»“ä¸åæ€ 9.4å¦‚ä½•åˆç†çš„è®¾ç½® Flink ä½œä¸šå¹¶è¡Œåº¦ï¼Ÿ 9.4.1 Source ç«¯å¹¶è¡Œåº¦çš„é…ç½® 9.4.2 ä¸­é—´ Operator å¹¶è¡Œåº¦çš„é…ç½® 9.4.3 Sink ç«¯å¹¶è¡Œåº¦çš„é…ç½® 9.4.4 Operator Chain 9.4.5 å°ç»“ä¸åæ€ 9.5Flink ä¸­å¦‚ä½•ä¿è¯ Exactly Onceï¼Ÿ 9.5.1 Flink å†…éƒ¨å¦‚ä½•ä¿è¯ Exactly Onceï¼Ÿ 9.5.2 ç«¯å¯¹ç«¯å¦‚ä½•ä¿è¯ Exactly Onceï¼Ÿ 9.5.3 åˆ†æ FlinkKafkaConsumer çš„è®¾è®¡æ€æƒ³ 9.5.4 å°ç»“ä¸åæ€ 9.6å¦‚ä½•å¤„ç† Flink ä¸­æ•°æ®å€¾æ–œé—®é¢˜ï¼Ÿ 9.6.1 æ•°æ®å€¾æ–œç®€ä»‹ 9.6.2 åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ•°æ®å€¾æ–œ 9.6.3 åˆ†æå’Œè§£å†³æ•°æ®å€¾æ–œé—®é¢˜ 9.6.4 å°ç»“ä¸åæ€ 9.7æ€»ç»“10ç¬¬åç« â€”â€”Flink æœ€ä½³å®è·µ 10.1å¦‚ä½•è®¾ç½® Flink Job RestartStrategyï¼ˆé‡å¯ç­–ç•¥ï¼‰ï¼Ÿ 10.1.1 å¸¸è§é”™è¯¯å¯¼è‡´ Flink ä½œä¸šé‡å¯ 10.1.2 RestartStrategy ç®€ä»‹ 10.1.3 ä¸ºä»€ä¹ˆéœ€è¦ RestartStrategyï¼Ÿ 10.1.4 å¦‚ä½•é…ç½® RestartStrategyï¼Ÿ 10.1.5 RestartStrategy æºç åˆ†æ 10.1.6 Failover Strategiesï¼ˆæ•…éšœæ¢å¤ç­–ç•¥ï¼‰ 10.1.7 å°ç»“ä¸åæ€ 10.2å¦‚ä½•ä½¿ç”¨ Flink ParameterTool è¯»å–é…ç½®ï¼Ÿ 10.2.1 Flink Job é…ç½® 10.2.2 ParameterTool ç®¡ç†é…ç½® 10.2.3 ParameterTool æºç åˆ†æ 10.2.4 å°ç»“ä¸åæ€ 10.3æ€»ç»“ 5å®æˆ˜ç¯‡11ç¬¬åä¸€ç« â€”â€”Flink å®æˆ˜ 11.1å¦‚ä½•ç»Ÿè®¡ç½‘ç«™å„é¡µé¢ä¸€å¤©å†…çš„ PV å’Œ UVï¼Ÿ 11.1.1 ç»Ÿè®¡ç½‘ç«™å„é¡µé¢ä¸€å¤©å†…çš„ PV 11.1.2 ç»Ÿè®¡ç½‘ç«™å„é¡µé¢ä¸€å¤©å†… UV çš„ä¸‰ç§æ–¹æ¡ˆ 11.1.3 å°ç»“ä¸åæ€ 11.2å¦‚ä½•ä½¿ç”¨ Flink ProcessFunction å¤„ç†å®•æœºå‘Šè­¦? 11.2.1 ProcessFunction ç®€ä»‹ 11.2.2 CoProcessFunction ç®€ä»‹ 11.2.3 Timer ç®€ä»‹ 11.2.4 å¦‚æœåˆ©ç”¨ ProcessFunction å¤„ç†å®•æœºå‘Šè­¦ï¼Ÿ 11.2.5 å°ç»“ä¸åæ€ 11.3å¦‚ä½•åˆ©ç”¨ Async Iï¼O è¯»å–å‘Šè­¦è§„åˆ™ï¼Ÿ 11.3.1 ä¸ºä»€ä¹ˆéœ€è¦ Async I/Oï¼Ÿ 11.3.2 Async I/O API 11.3.3 åˆ©ç”¨ Async I/O è¯»å–å‘Šè­¦è§„åˆ™éœ€æ±‚åˆ†æ 11.3.4 å¦‚ä½•ä½¿ç”¨ Async I/O è¯»å–å‘Šè­¦è§„åˆ™æ•°æ® 11.3.5 å°ç»“ä¸åæ€ 11.4å¦‚ä½•åˆ©ç”¨å¹¿æ’­å˜é‡åŠ¨æ€æ›´æ–°å‘Šè­¦è§„åˆ™ï¼Ÿ 11.4.1 BroadcastVariable ç®€ä»‹ 11.4.2 å¦‚ä½•ä½¿ç”¨ BroadcastVariable ï¼Ÿ 11.4.3 åˆ©ç”¨å¹¿æ’­å˜é‡åŠ¨æ€æ›´æ–°å‘Šè­¦è§„åˆ™æ•°æ®éœ€æ±‚åˆ†æ 11.4.4 è¯»å–å‘Šè­¦è§„åˆ™æ•°æ® 11.4.5 ç›‘æ§æ•°æ®è¿æ¥è§„åˆ™æ•°æ® 11.4.6 å°ç»“ä¸åæ€ 11.5å¦‚ä½•å®æ—¶å°†åº”ç”¨ Error æ—¥å¿—å‘Šè­¦ï¼Ÿ 11.5.1 æ—¥å¿—å¤„ç†æ–¹æ¡ˆçš„æ¼”è¿› 11.5.2 æ—¥å¿—é‡‡é›†å·¥å…·å¯¹æ¯” 11.5.3 æ—¥å¿—ç»“æ„è®¾è®¡ 11.5.4 å¼‚å¸¸æ—¥å¿—å®æ—¶å‘Šè­¦é¡¹ç›®æ¶æ„ 11.5.5 æ—¥å¿—æ•°æ®å‘é€åˆ° Kafka 11.5.6 Flink å®æ—¶å¤„ç†æ—¥å¿—æ•°æ® 11.5.7 å¤„ç†åº”ç”¨å¼‚å¸¸æ—¥å¿— 11.5.8 å°ç»“ä¸åæ€ 11.6æ€»ç»“ 6æ¡ˆä¾‹ç¯‡12ç¬¬åäºŒç« â€”â€”Flink æ¡ˆä¾‹ 12.1åŸºäº Flink å®æ—¶å¤„ç†æµ·é‡æ—¥å¿— 12.2.1 å®æ—¶å¤„ç†æµ·é‡æ—¥å¿—éœ€æ±‚åˆ†æ 12.2.2 å®æ—¶å¤„ç†æµ·é‡æ—¥å¿—æ¶æ„è®¾è®¡ 12.2.3 æ—¥å¿—å®æ—¶é‡‡é›† 12.2.4 æ—¥å¿—æ ¼å¼ç»Ÿä¸€ 12.2.5 æ—¥å¿—å®æ—¶æ¸…æ´— 12.2.6 æ—¥å¿—å®æ—¶å‘Šè­¦ 12.2.7 æ—¥å¿—å®æ—¶å­˜å‚¨ 12.2.8 æ—¥å¿—å®æ—¶å±•ç¤º 12.2.9 å°ç»“ä¸åæ€ 12.2åŸºäº Flink çš„ç™¾äº¿æ•°æ®å®æ—¶å»é‡ 12.2.1 å»é‡çš„é€šç”¨è§£å†³æ–¹æ¡ˆ 12.2.2 ä½¿ç”¨ BloomFilter å®ç°å»é‡ 12.2.3 ä½¿ç”¨ HBase ç»´æŠ¤å…¨å±€ Set å®ç°å»é‡ 12.2.4 ä½¿ç”¨ Flink çš„ KeyedState å®ç°å»é‡ 12.2.5 ä½¿ç”¨ RocksDBStateBackend çš„ä¼˜åŒ–æ–¹æ³• 12.2.6 å°ç»“ä¸åæ€ 12.3åŸºäº Flink çš„å®æ—¶ç›‘æ§å‘Šè­¦ç³»ç»Ÿ 12.3.1 ç›‘æ§ç³»ç»Ÿçš„è¯‰æ±‚ 12.3.2 ç›‘æ§ç³»ç»ŸåŒ…å«çš„å†…å®¹ 12.3.3 Metricsï¼Traceï¼Log æ•°æ®å®æ—¶é‡‡é›† 12.3.4 æ¶ˆæ¯é˜Ÿåˆ—å¦‚ä½•æ’‘ä½é«˜å³°æµé‡ 12.3.5 æŒ‡æ ‡æ•°æ®å®æ—¶è®¡ç®— 12.3.6 æä¾›åŠæ—¶ä¸”å‡†ç¡®çš„æ ¹å› åˆ†æå‘Šè­¦ 12.3.7 AIOps æ™ºèƒ½è¿ç»´é“è·¯æ¢ç´¢ 12.3.8 å¦‚ä½•ä¿éšœé«˜å³°æµé‡å®æ—¶å†™å…¥å­˜å‚¨ç³»ç»Ÿçš„ç¨³å®šæ€§ 12.3.9 ç›‘æ§æ•°æ®ä½¿ç”¨å¯è§†åŒ–å›¾è¡¨å±•ç¤º 12.3.10 å°ç»“ä¸åæ€ 12.4æ€»ç»“","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"æ•°æ®ä»“åº“ç®€ä»‹ã€å‘å±•ã€æ¶æ„æ¼”è¿›ã€å®æ—¶æ•°ä»“å»ºè®¾ã€ä¸ç¦»çº¿æ•°ä»“å¯¹æ¯”","date":"2019-11-22T16:00:00.000Z","path":"2019/11/23/real-time-warehouse/","text":"æ•°æ®ä»“åº“ä¹Ÿæ˜¯å…¬å¸æ•°æ®å‘å±•åˆ°ä¸€å®šè§„æ¨¡åå¿…ç„¶ä¼šæä¾›çš„ä¸€ç§åŸºç¡€æœåŠ¡ï¼Œæ•°æ®ä»“åº“çš„å»ºè®¾ä¹Ÿæ˜¯â€œæ•°æ®æ™ºèƒ½â€ä¸­å¿…ä¸å¯å°‘çš„ä¸€ç¯ã€‚æœ¬æ–‡å°†ä»æ•°æ®ä»“åº“çš„ç®€ä»‹ã€ç»å†äº†æ€æ ·çš„å‘å±•ã€å¦‚ä½•å»ºè®¾ã€æ¶æ„æ¼”å˜ã€åº”ç”¨æ¡ˆä¾‹ä»¥åŠå®æ—¶æ•°ä»“ä¸ç¦»çº¿æ•°ä»“çš„å¯¹æ¯”å…­ä¸ªæ–¹é¢å…¨é¢åˆ†äº«å…³äºæ•°ä»“çš„è¯¦ç»†å†…å®¹ã€‚ æœ¬æ–‡ä½œè€…ï¼šéƒ­åï¼ˆä»˜ç©ºï¼‰ åŸåœ°åœ°å€ï¼šhttps://ververica.cn/developers/how-to-do-real-time-counting/ 1. æ•°æ®ä»“åº“ç®€ä»‹æ•°æ®ä»“åº“æ˜¯ä¸€ä¸ªé¢å‘ä¸»é¢˜çš„ï¼ˆSubject Orientedï¼‰ã€é›†æˆçš„ï¼ˆIntegrateï¼‰ã€ç›¸å¯¹ç¨³å®šçš„ï¼ˆNon-Volatileï¼‰ã€åæ˜ å†å²å˜åŒ–ï¼ˆTime Variantï¼‰çš„æ•°æ®é›†åˆï¼Œç”¨äºæ”¯æŒç®¡ç†å†³ç­–ã€‚ æ•°æ®ä»“åº“æ˜¯ä¼´éšç€ä¼ä¸šä¿¡æ¯åŒ–å‘å±•èµ·æ¥çš„ï¼Œåœ¨ä¼ä¸šä¿¡æ¯åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œéšç€ä¿¡æ¯åŒ–å·¥å…·çš„å‡çº§å’Œæ–°å·¥å…·çš„åº”ç”¨ï¼Œæ•°æ®é‡å˜çš„è¶Šæ¥è¶Šå¤§ï¼Œæ•°æ®æ ¼å¼è¶Šæ¥è¶Šå¤šï¼Œå†³ç­–è¦æ±‚è¶Šæ¥è¶Šè‹›åˆ»ï¼Œæ•°æ®ä»“åº“æŠ€æœ¯ä¹Ÿåœ¨ä¸åœçš„å‘å±•ã€‚ æ•°æ®ä»“åº“çš„è¶‹åŠ¿ï¼š å®æ—¶æ•°æ®ä»“åº“ä»¥æ»¡è¶³å®æ—¶åŒ–&amp;è‡ªåŠ¨åŒ–å†³ç­–éœ€æ±‚ï¼› å¤§æ•°æ®&amp;æ•°æ®æ¹–ä»¥æ”¯æŒå¤§é‡&amp;å¤æ‚æ•°æ®ç±»å‹ï¼ˆæ–‡æœ¬ã€å›¾åƒã€è§†é¢‘ã€éŸ³é¢‘ï¼‰ï¼› 2. æ•°æ®ä»“åº“çš„å‘å±•æ•°æ®ä»“åº“æœ‰ä¸¤ä¸ªç¯èŠ‚ï¼šæ•°æ®ä»“åº“çš„æ„å»ºä¸æ•°æ®ä»“åº“çš„åº”ç”¨ã€‚ æ—©æœŸæ•°æ®ä»“åº“æ„å»ºä¸»è¦æŒ‡çš„æ˜¯æŠŠä¼ä¸šçš„ä¸šåŠ¡æ•°æ®åº“å¦‚ ERPã€CRMã€SCM ç­‰æ•°æ®æŒ‰ç…§å†³ç­–åˆ†æçš„è¦æ±‚å»ºæ¨¡å¹¶æ±‡æ€»åˆ°æ•°æ®ä»“åº“å¼•æ“ä¸­ï¼Œå…¶åº”ç”¨ä»¥æŠ¥è¡¨ä¸ºä¸»ï¼Œç›®çš„æ˜¯æ”¯æŒç®¡ç†å±‚å’Œä¸šåŠ¡äººå‘˜å†³ç­–ï¼ˆä¸­é•¿æœŸç­–ç•¥å‹å†³ç­–ï¼‰ã€‚ éšç€ä¸šåŠ¡å’Œç¯å¢ƒçš„å‘å±•ï¼Œè¿™ä¸¤æ–¹é¢éƒ½åœ¨å‘ç”Ÿç€å‰§çƒˆå˜åŒ–ã€‚ éšç€ITæŠ€æœ¯èµ°å‘äº’è”ç½‘ã€ç§»åŠ¨åŒ–ï¼Œæ•°æ®æºå˜å¾—è¶Šæ¥è¶Šä¸°å¯Œï¼Œåœ¨åŸæ¥ä¸šåŠ¡æ•°æ®åº“çš„åŸºç¡€ä¸Šå‡ºç°äº†éç»“æ„åŒ–æ•°æ®ï¼Œæ¯”å¦‚ç½‘ç«™ logï¼ŒIoT è®¾å¤‡æ•°æ®ï¼ŒAPP åŸ‹ç‚¹æ•°æ®ç­‰ï¼Œè¿™äº›æ•°æ®é‡æ¯”ä»¥å¾€ç»“æ„åŒ–çš„æ•°æ®å¤§äº†å‡ ä¸ªé‡çº§ï¼Œå¯¹ ETL è¿‡ç¨‹ã€å­˜å‚¨éƒ½æå‡ºäº†æ›´é«˜çš„è¦æ±‚ï¼› äº’è”ç½‘çš„åœ¨çº¿ç‰¹æ€§ä¹Ÿå°†ä¸šåŠ¡éœ€æ±‚æ¨å‘äº†å®æ—¶åŒ–ï¼Œéšæ—¶æ ¹æ®å½“å‰å®¢æˆ·è¡Œä¸ºè€Œè°ƒæ•´ç­–ç•¥å˜å¾—è¶Šæ¥è¶Šå¸¸è§ï¼Œæ¯”å¦‚å¤§ä¿ƒè¿‡ç¨‹ä¸­åº“å­˜ç®¡ç†ï¼Œè¿è¥ç®¡ç†ç­‰ï¼ˆå³æ—¢æœ‰ä¸­è¿œæœŸç­–ç•¥å‹ï¼Œä¹Ÿæœ‰çŸ­æœŸæ“ä½œå‹ï¼‰ï¼›åŒæ—¶å…¬å¸ä¸šåŠ¡äº’è”ç½‘åŒ–ä¹‹åå¯¼è‡´åŒæ—¶æœåŠ¡çš„å®¢æˆ·å‰§å¢ï¼Œæœ‰äº›æƒ…å†µäººå·¥éš¾ä»¥å®Œå…¨å¤„ç†ï¼Œè¿™å°±éœ€è¦æœºå™¨è‡ªåŠ¨å†³ç­–ã€‚æ¯”å¦‚æ¬ºè¯ˆæ£€æµ‹å’Œç”¨æˆ·å®¡æ ¸ã€‚ æ€»ç»“æ¥çœ‹ï¼Œå¯¹æ•°æ®ä»“åº“çš„éœ€æ±‚å¯ä»¥æŠ½è±¡æˆä¸¤æ–¹é¢ï¼šå®æ—¶äº§ç”Ÿç»“æœã€å¤„ç†å’Œä¿å­˜å¤§é‡å¼‚æ„æ•°æ®ã€‚ æ³¨ï¼šè¿™é‡Œä¸è®¨è®ºæ•°æ®æ¹–æŠ€æœ¯ã€‚ 3. æ•°æ®ä»“åº“å»ºè®¾æ–¹æ³•è®º3.1 é¢å‘ä¸»é¢˜ä»å…¬å¸ä¸šåŠ¡å‡ºå‘ï¼Œæ˜¯åˆ†æçš„å®è§‚é¢†åŸŸï¼Œæ¯”å¦‚ä¾›åº”å•†ä¸»é¢˜ã€å•†å“ä¸»é¢˜ã€å®¢æˆ·ä¸»é¢˜å’Œä»“åº“ä¸»é¢˜ 3.2 ä¸ºå¤šç»´æ•°æ®åˆ†ææœåŠ¡æ•°æ®æŠ¥è¡¨ï¼›æ•°æ®ç«‹æ–¹ä½“ï¼Œä¸Šå·ã€ä¸‹é’»ã€åˆ‡ç‰‡ã€æ—‹è½¬ç­‰åˆ†æåŠŸèƒ½ã€‚ 3.3 åèŒƒå¼æ•°æ®æ¨¡å‹ä»¥äº‹å®è¡¨å’Œç»´åº¦è¡¨ç»„æˆçš„æ˜Ÿå‹æ•°æ®æ¨¡å‹ 4. æ•°æ®ä»“åº“æ¶æ„çš„æ¼”å˜æ•°æ®ä»“åº“æ¦‚å¿µæ˜¯ Inmon äº 1990 å¹´æå‡ºå¹¶ç»™å‡ºäº†å®Œæ•´çš„å»ºè®¾æ–¹æ³•ã€‚éšç€äº’è”ç½‘æ—¶ä»£æ¥ä¸´ï¼Œæ•°æ®é‡æš´å¢ï¼Œå¼€å§‹ä½¿ç”¨å¤§æ•°æ®å·¥å…·æ¥æ›¿ä»£ç»å…¸æ•°ä»“ä¸­çš„ä¼ ç»Ÿå·¥å…·ã€‚æ­¤æ—¶ä»…ä»…æ˜¯å·¥å…·çš„å–ä»£ï¼Œæ¶æ„ä¸Šå¹¶æ²¡æœ‰æ ¹æœ¬çš„åŒºåˆ«ï¼Œå¯ä»¥æŠŠè¿™ä¸ªæ¶æ„å«åšç¦»çº¿å¤§æ•°æ®æ¶æ„ã€‚ åæ¥éšç€ä¸šåŠ¡å®æ—¶æ€§è¦æ±‚çš„ä¸æ–­æé«˜ï¼Œäººä»¬å¼€å§‹åœ¨ç¦»çº¿å¤§æ•°æ®æ¶æ„åŸºç¡€ä¸ŠåŠ äº†ä¸€ä¸ªåŠ é€Ÿå±‚ï¼Œä½¿ç”¨æµå¤„ç†æŠ€æœ¯ç›´æ¥å®Œæˆé‚£äº›å®æ—¶æ€§è¦æ±‚è¾ƒé«˜çš„æŒ‡æ ‡è®¡ç®—ï¼Œè¿™ä¾¿æ˜¯ Lambda æ¶æ„ã€‚ å†åæ¥ï¼Œå®æ—¶çš„ä¸šåŠ¡è¶Šæ¥è¶Šå¤šï¼Œäº‹ä»¶åŒ–çš„æ•°æ®æºä¹Ÿè¶Šæ¥è¶Šå¤šï¼Œå®æ—¶å¤„ç†ä»æ¬¡è¦éƒ¨åˆ†å˜æˆäº†ä¸»è¦éƒ¨åˆ†ï¼Œæ¶æ„ä¹Ÿåšäº†ç›¸åº”è°ƒæ•´ï¼Œå‡ºç°äº†ä»¥å®æ—¶äº‹ä»¶å¤„ç†ä¸ºæ ¸å¿ƒçš„ Kappa æ¶æ„ã€‚ 4.1 ç¦»çº¿å¤§æ•°æ®æ¶æ„æ•°æ®æºé€šè¿‡ç¦»çº¿çš„æ–¹å¼å¯¼å…¥åˆ°ç¦»çº¿æ•°ä»“ä¸­ã€‚ä¸‹æ¸¸åº”ç”¨æ ¹æ®ä¸šåŠ¡éœ€æ±‚é€‰æ‹©ç›´æ¥è¯»å– DM æˆ–åŠ ä¸€å±‚æ•°æ®æœåŠ¡ï¼Œæ¯”å¦‚ MySQL æˆ– Redisã€‚æ•°æ®ä»“åº“ä»æ¨¡å‹å±‚é¢åˆ†ä¸ºä¸‰å±‚ï¼š ODSï¼Œæ“ä½œæ•°æ®å±‚ï¼Œä¿å­˜åŸå§‹æ•°æ®ï¼› DWDï¼Œæ•°æ®ä»“åº“æ˜ç»†å±‚ï¼Œæ ¹æ®ä¸»é¢˜å®šä¹‰å¥½äº‹å®ä¸ç»´åº¦è¡¨ï¼Œä¿å­˜æœ€ç»†ç²’åº¦çš„äº‹å®æ•°æ®ï¼› DMï¼Œæ•°æ®é›†å¸‚/è½»åº¦æ±‡æ€»å±‚ï¼Œåœ¨ DWD å±‚çš„åŸºç¡€ä¹‹ä¸Šæ ¹æ®ä¸åŒçš„ä¸šåŠ¡éœ€æ±‚åšè½»åº¦æ±‡æ€»ï¼› å…¸å‹çš„æ•°ä»“å­˜å‚¨æ˜¯ HDFS/Hiveï¼ŒETL å¯ä»¥æ˜¯ MapReduce è„šæœ¬æˆ– HiveSQLã€‚ 4.2 Lambda æ¶æ„éšç€å¤§æ•°æ®åº”ç”¨çš„å‘å±•ï¼Œäººä»¬é€æ¸å¯¹ç³»ç»Ÿçš„å®æ—¶æ€§æå‡ºäº†è¦æ±‚ï¼Œä¸ºäº†è®¡ç®—ä¸€äº›å®æ—¶æŒ‡æ ‡ï¼Œå°±åœ¨åŸæ¥ç¦»çº¿æ•°ä»“çš„åŸºç¡€ä¸Šå¢åŠ äº†ä¸€ä¸ªå®æ—¶è®¡ç®—çš„é“¾è·¯ï¼Œå¹¶å¯¹æ•°æ®æºåšæµå¼æ”¹é€ ï¼ˆå³æŠŠæ•°æ®å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼‰ï¼Œå®æ—¶è®¡ç®—å»è®¢é˜…æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç›´æ¥å®ŒæˆæŒ‡æ ‡å¢é‡çš„è®¡ç®—ï¼Œæ¨é€åˆ°ä¸‹æ¸¸çš„æ•°æ®æœåŠ¡ä¸­å»ï¼Œç”±æ•°æ®æœåŠ¡å±‚å®Œæˆç¦»çº¿&amp;å®æ—¶ç»“æœçš„åˆå¹¶ã€‚ æ³¨ï¼šæµå¤„ç†è®¡ç®—çš„æŒ‡æ ‡æ‰¹å¤„ç†ä¾ç„¶è®¡ç®—ï¼Œæœ€ç»ˆä»¥æ‰¹å¤„ç†ä¸ºå‡†ï¼Œå³æ¯æ¬¡æ‰¹å¤„ç†è®¡ç®—åä¼šè¦†ç›–æµå¤„ç†çš„ç»“æœã€‚ï¼ˆè¿™ä»…ä»…æ˜¯æµå¤„ç†å¼•æ“ä¸å®Œå–„åšçš„æŠ˜ä¸­ï¼‰ Lambda æ¶æ„é—®é¢˜ï¼š åŒæ ·çš„éœ€æ±‚éœ€è¦å¼€å‘ä¸¤å¥—ä¸€æ ·çš„ä»£ç ï¼šè¿™æ˜¯ Lambda æ¶æ„æœ€å¤§çš„é—®é¢˜ï¼Œä¸¤å¥—ä»£ç ä¸ä»…ä»…æ„å‘³ç€å¼€å‘å›°éš¾ï¼ˆåŒæ ·çš„éœ€æ±‚ï¼Œä¸€ä¸ªåœ¨æ‰¹å¤„ç†å¼•æ“ä¸Šå®ç°ï¼Œä¸€ä¸ªåœ¨æµå¤„ç†å¼•æ“ä¸Šå®ç°ï¼Œè¿˜è¦åˆ†åˆ«æ„é€ æ•°æ®æµ‹è¯•ä¿è¯ä¸¤è€…ç»“æœä¸€è‡´ï¼‰ï¼ŒåæœŸç»´æŠ¤æ›´åŠ å›°éš¾ï¼Œæ¯”å¦‚éœ€æ±‚å˜æ›´åéœ€è¦åˆ†åˆ«æ›´æ”¹ä¸¤å¥—ä»£ç ï¼Œç‹¬ç«‹æµ‹è¯•ç»“æœï¼Œä¸”ä¸¤ä¸ªä½œä¸šéœ€è¦åŒæ­¥ä¸Šçº¿ã€‚ èµ„æºå ç”¨å¢å¤šï¼šåŒæ ·çš„é€»è¾‘è®¡ç®—ä¸¤æ¬¡ï¼Œæ•´ä½“èµ„æºå ç”¨ä¼šå¢å¤šï¼ˆå¤šå‡ºå®æ—¶è®¡ç®—è¿™éƒ¨åˆ† 4.3 Kappa æ¶æ„Lambda æ¶æ„è™½ç„¶æ»¡è¶³äº†å®æ—¶çš„éœ€æ±‚ï¼Œä½†å¸¦æ¥äº†æ›´å¤šçš„å¼€å‘ä¸è¿ç»´å·¥ä½œï¼Œå…¶æ¶æ„èƒŒæ™¯æ˜¯æµå¤„ç†å¼•æ“è¿˜ä¸å®Œå–„ï¼Œæµå¤„ç†çš„ç»“æœåªä½œä¸ºä¸´æ—¶çš„ã€è¿‘ä¼¼çš„å€¼æä¾›å‚è€ƒã€‚åæ¥éšç€ Flink ç­‰æµå¤„ç†å¼•æ“çš„å‡ºç°ï¼Œæµå¤„ç†æŠ€æœ¯å¾ˆæˆç†Ÿäº†ï¼Œè¿™æ—¶ä¸ºäº†è§£å†³ä¸¤å¥—ä»£ç çš„é—®é¢˜ï¼ŒLickedIn çš„ Jay Kreps æå‡ºäº† Kappa æ¶æ„ã€‚ Kappa æ¶æ„å¯ä»¥è®¤ä¸ºæ˜¯ Lambda æ¶æ„çš„ç®€åŒ–ç‰ˆï¼ˆåªè¦ç§»é™¤ lambda æ¶æ„ä¸­çš„æ‰¹å¤„ç†éƒ¨åˆ†å³å¯ï¼‰ã€‚ åœ¨ Kappa æ¶æ„ä¸­ï¼Œéœ€æ±‚ä¿®æ”¹æˆ–å†å²æ•°æ®é‡æ–°å¤„ç†éƒ½é€šè¿‡ä¸Šæ¸¸é‡æ”¾å®Œæˆã€‚ Kappa æ¶æ„æœ€å¤§çš„é—®é¢˜æ˜¯æµå¼é‡æ–°å¤„ç†å†å²çš„ååèƒ½åŠ›ä¼šä½äºæ‰¹å¤„ç†ï¼Œä½†è¿™ä¸ªå¯ä»¥é€šè¿‡å¢åŠ è®¡ç®—èµ„æºæ¥å¼¥è¡¥ã€‚ Kappa æ¶æ„çš„é‡æ–°å¤„ç†è¿‡ç¨‹ï¼š é‡æ–°å¤„ç†æ˜¯äººä»¬å¯¹ Kappa æ¶æ„æœ€æ‹…å¿ƒçš„ç‚¹ï¼Œä½†å®é™…ä¸Šå¹¶ä¸å¤æ‚ï¼š é€‰æ‹©ä¸€ä¸ªå…·æœ‰é‡æ”¾åŠŸèƒ½çš„ã€èƒ½å¤Ÿä¿å­˜å†å²æ•°æ®å¹¶æ”¯æŒå¤šæ¶ˆè´¹è€…çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ ¹æ®éœ€æ±‚è®¾ç½®å†å²æ•°æ®ä¿å­˜çš„æ—¶é•¿ï¼Œæ¯”å¦‚ Kafkaï¼Œå¯ä»¥ä¿å­˜å…¨éƒ¨å†å²æ•°æ®ã€‚ å½“æŸä¸ªæˆ–æŸäº›æŒ‡æ ‡æœ‰é‡æ–°å¤„ç†çš„éœ€æ±‚æ—¶ï¼ŒæŒ‰ç…§æ–°é€»è¾‘å†™ä¸€ä¸ªæ–°ä½œä¸šï¼Œç„¶åä»ä¸Šæ¸¸æ¶ˆæ¯é˜Ÿåˆ—çš„æœ€å¼€å§‹é‡æ–°æ¶ˆè´¹ï¼ŒæŠŠç»“æœå†™åˆ°ä¸€ä¸ªæ–°çš„ä¸‹æ¸¸è¡¨ä¸­ã€‚ å½“æ–°ä½œä¸šèµ¶ä¸Šè¿›åº¦åï¼Œåº”ç”¨åˆ‡æ¢æ•°æ®æºï¼Œè¯»å– 2 ä¸­äº§ç”Ÿçš„æ–°ç»“æœè¡¨ã€‚ åœæ­¢è€çš„ä½œä¸šï¼Œåˆ é™¤è€çš„ç»“æœè¡¨ã€‚ 4.4 Lambda æ¶æ„ä¸ Kappa æ¶æ„çš„å¯¹æ¯” åœ¨çœŸå®çš„åœºæ™¯ä¸­ï¼Œå¾ˆå¤šæ—¶å€™å¹¶ä¸æ˜¯å®Œå…¨è§„èŒƒçš„ Lambda æ¶æ„æˆ– Kappa æ¶æ„ï¼Œå¯ä»¥æ˜¯ä¸¤è€…çš„æ··åˆï¼Œæ¯”å¦‚å¤§éƒ¨åˆ†å®æ—¶æŒ‡æ ‡ä½¿ç”¨ Kappa æ¶æ„å®Œæˆè®¡ç®—ï¼Œå°‘é‡å…³é”®æŒ‡æ ‡ï¼ˆæ¯”å¦‚é‡‘é¢ç›¸å…³ï¼‰ä½¿ç”¨ Lambda æ¶æ„ç”¨æ‰¹å¤„ç†é‡æ–°è®¡ç®—ï¼Œå¢åŠ ä¸€æ¬¡æ ¡å¯¹è¿‡ç¨‹ã€‚ Kappa æ¶æ„å¹¶ä¸æ˜¯ä¸­é—´ç»“æœå®Œå…¨ä¸è½åœ°ï¼Œç°åœ¨å¾ˆå¤šå¤§æ•°æ®ç³»ç»Ÿéƒ½éœ€è¦æ”¯æŒæœºå™¨å­¦ä¹ ï¼ˆç¦»çº¿è®­ç»ƒï¼‰ï¼Œæ‰€ä»¥å®æ—¶ä¸­é—´ç»“æœéœ€è¦è½åœ°å¯¹åº”çš„å­˜å‚¨å¼•æ“ä¾›æœºå™¨å­¦ä¹ ä½¿ç”¨ï¼Œå¦å¤–æœ‰æ—¶å€™è¿˜éœ€è¦å¯¹æ˜ç»†æ•°æ®æŸ¥è¯¢ï¼Œè¿™ç§åœºæ™¯ä¹Ÿéœ€è¦æŠŠå®æ—¶æ˜ç»†å±‚å†™å‡ºåˆ°å¯¹åº”çš„å¼•æ“ä¸­ã€‚å‚è€ƒåé¢çš„æ¡ˆä¾‹ã€‚ å¦å¤–ï¼Œéšç€æ•°æ®å¤šæ ·æ€§çš„å‘å±•ï¼Œæ•°æ®ä»“åº“è¿™ç§æå‰è§„å®š schema çš„æ¨¡å¼æ˜¾å¾—è¶Šæ¥éš¾ä»¥æ”¯æŒçµæ´»çš„æ¢ç´¢&amp;åˆ†æéœ€æ±‚ï¼Œè¿™æ—¶å€™ä¾¿å‡ºç°äº†ä¸€ç§æ•°æ®æ¹–æŠ€æœ¯ï¼Œå³æŠŠåŸå§‹æ•°æ®å…¨éƒ¨ç¼“å­˜åˆ°æŸä¸ªå¤§æ•°æ®å­˜å‚¨ä¸Šï¼Œåç»­åˆ†ææ—¶å†æ ¹æ®éœ€æ±‚å»è§£æåŸå§‹æ•°æ®ã€‚ç®€å•çš„è¯´ï¼Œæ•°æ®ä»“åº“æ¨¡å¼æ˜¯ schema on writeï¼Œæ•°æ®æ¹–æ¨¡å¼æ˜¯ schema on readã€‚ 5. å®æ—¶æ•°ä»“æ¡ˆä¾‹èœé¸Ÿä»“é…å®æ—¶æ•°æ®ä»“åº“æœ¬æ¡ˆä¾‹å‚è€ƒè‡ªèœé¸Ÿä»“é…å›¢é˜Ÿçš„åˆ†äº«ï¼Œæ¶‰åŠå…¨å±€è®¾è®¡ã€æ•°æ®æ¨¡å‹ã€æ•°æ®ä¿éšœç­‰å‡ ä¸ªæ–¹é¢ã€‚ æ³¨ï¼šç‰¹åˆ«æ„Ÿè°¢ç¼˜æ¡¥åŒå­¦çš„æ— ç§åˆ†äº«ã€‚ 5.1 æ•´ä½“è®¾è®¡æ•´ä½“è®¾è®¡å¦‚ä¸‹å›¾ï¼ŒåŸºäºä¸šåŠ¡ç³»ç»Ÿçš„æ•°æ®ï¼Œæ•°æ®æ¨¡å‹é‡‡ç”¨ä¸­é—´å±‚çš„è®¾è®¡ç†å¿µï¼Œå»ºè®¾ä»“é…å®æ—¶æ•°ä»“ï¼›è®¡ç®—å¼•æ“ï¼Œé€‰æ‹©æ›´æ˜“ç”¨ã€æ€§èƒ½è¡¨ç°æ›´ä½³çš„å®æ—¶è®¡ç®—ä½œä¸ºä¸»è¦çš„è®¡ç®—å¼•æ“ï¼›æ•°æ®æœåŠ¡ï¼Œé€‰æ‹©å¤©å·¥æ•°æ®æœåŠ¡ä¸­é—´ä»¶ï¼Œé¿å…ç›´è¿æ•°æ®åº“ï¼Œä¸”åŸºäºå¤©å·¥å¯ä»¥åšåˆ°ä¸»å¤‡é“¾è·¯çµæ´»é…ç½®ç§’çº§åˆ‡æ¢ï¼›æ•°æ®åº”ç”¨ï¼Œå›´ç»•å¤§ä¿ƒå…¨é“¾è·¯ï¼Œä»æ´»åŠ¨è®¡åˆ’ã€æ´»åŠ¨å¤‡è´§ã€æ´»åŠ¨ç›´æ’­ã€æ´»åŠ¨å”®åã€æ´»åŠ¨å¤ç›˜äº”ä¸ªç»´åº¦ï¼Œå»ºè®¾ä»“é…å¤§ä¿ƒæ•°æ®ä½“ç³»ã€‚ 5.2 æ•°æ®æ¨¡å‹ä¸ç®¡æ˜¯ä»è®¡ç®—æˆæœ¬ï¼Œè¿˜æ˜¯ä»æ˜“ç”¨æ€§ï¼Œè¿˜æ˜¯ä»å¤ç”¨æ€§ï¼Œè¿˜æ˜¯ä»ä¸€è‡´æ€§ç­‰ç­‰ï¼Œæˆ‘ä»¬éƒ½å¿…é¡»é¿å…çƒŸå›±å¼çš„å¼€å‘æ¨¡å¼ï¼Œè€Œæ˜¯ä»¥ä¸­é—´å±‚çš„æ–¹å¼å»ºè®¾ä»“é…å®æ—¶æ•°ä»“ã€‚ä¸ç¦»çº¿ä¸­é—´å±‚åŸºæœ¬ä¸€è‡´ï¼Œæˆ‘ä»¬å°†å®æ—¶ä¸­é—´å±‚åˆ†ä¸ºä¸¤å±‚ã€‚ ç¬¬ä¸€å±‚ DWD å…¬å…±å®æ—¶æ˜ç»†å±‚ å®æ—¶è®¡ç®—è®¢é˜…ä¸šåŠ¡æ•°æ®æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç„¶åé€šè¿‡æ•°æ®æ¸…æ´—ã€å¤šæ•°æ®æº joinã€æµå¼æ•°æ®ä¸ç¦»çº¿ç»´åº¦ä¿¡æ¯ç­‰çš„ç»„åˆï¼Œå°†ä¸€äº›ç›¸åŒç²’åº¦çš„ä¸šåŠ¡ç³»ç»Ÿã€ç»´è¡¨ä¸­çš„ç»´åº¦å±æ€§å…¨éƒ¨å…³è”åˆ°ä¸€èµ·ï¼Œå¢åŠ æ•°æ®æ˜“ç”¨æ€§å’Œå¤ç”¨æ€§ï¼Œå¾—åˆ°æœ€ç»ˆçš„å®æ—¶æ˜ç»†æ•°æ®ã€‚è¿™éƒ¨åˆ†æ•°æ®æœ‰ä¸¤ä¸ªåˆ†æ”¯ï¼Œä¸€éƒ¨åˆ†ç›´æ¥è½åœ°åˆ° ADSï¼Œä¾›å®æ—¶æ˜ç»†æŸ¥è¯¢ä½¿ç”¨ï¼Œä¸€éƒ¨åˆ†å†å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œä¾›ä¸‹å±‚è®¡ç®—ä½¿ç”¨ï¼› ç¬¬äºŒå±‚ DWS å…¬å…±å®æ—¶æ±‡æ€»å±‚ ä»¥æ•°æ®åŸŸ+ä¸šåŠ¡åŸŸçš„ç†å¿µå»ºè®¾å…¬å…±æ±‡æ€»å±‚ï¼Œä¸ç¦»çº¿æ•°ä»“ä¸åŒçš„æ˜¯ï¼Œè¿™é‡Œæ±‡æ€»å±‚åˆ†ä¸ºè½»åº¦æ±‡æ€»å±‚å’Œé«˜åº¦æ±‡æ€»å±‚ï¼Œå¹¶åŒæ—¶äº§å‡ºï¼Œè½»åº¦æ±‡æ€»å±‚å†™å…¥ ADSï¼Œç”¨äºå‰ç«¯äº§å“å¤æ‚çš„ olap æŸ¥è¯¢åœºæ™¯ï¼Œæ»¡è¶³è‡ªåŠ©åˆ†æå’Œäº§å‡ºæŠ¥è¡¨çš„éœ€æ±‚ï¼›é«˜åº¦æ±‡æ€»å±‚å†™å…¥ Hbaseï¼Œç”¨äºå‰ç«¯æ¯”è¾ƒç®€å•çš„ kv æŸ¥è¯¢åœºæ™¯ï¼Œæå‡æŸ¥è¯¢æ€§èƒ½ï¼Œæ¯”å¦‚å®æ—¶å¤§å±ç­‰ï¼› æ³¨ï¼š ADS æ˜¯ä¸€æ¬¾æä¾› OLAP åˆ†ææœåŠ¡çš„å¼•æ“ã€‚å¼€æºæä¾›ç±»ä¼¼åŠŸèƒ½çš„æœ‰ï¼ŒElastic Searchã€Kylinã€Druid ç­‰ï¼› æ¡ˆä¾‹ä¸­é€‰æ‹©æŠŠæ•°æ®å†™å…¥åˆ° Hbase ä¾› KV æŸ¥è¯¢ï¼Œä¹Ÿå¯æ ¹æ®æƒ…å†µé€‰æ‹©å…¶ä»–å¼•æ“ï¼Œæ¯”å¦‚æ•°æ®é‡ä¸å¤šï¼ŒæŸ¥è¯¢å‹åŠ›ä¹Ÿä¸å¤§çš„è¯ï¼Œå¯ä»¥ç”¨ MySQLï¼› å› ä¸»é¢˜å»ºæ¨¡ä¸ä¸šåŠ¡å…³ç³»è¾ƒå¤§ï¼Œè¿™é‡Œä¸åšæè¿°ï¼› 5.3 æ•°æ®ä¿éšœé˜¿é‡Œå·´å·´æ¯å¹´éƒ½æœ‰åŒåä¸€ç­‰å¤§ä¿ƒï¼Œå¤§ä¿ƒæœŸé—´æµé‡ä¸æ•°æ®é‡éƒ½ä¼šæš´å¢ã€‚å®æ—¶ç³»ç»Ÿè¦ä¿è¯å®æ—¶æ€§ï¼Œç›¸å¯¹ç¦»çº¿ç³»ç»Ÿå¯¹æ•°æ®é‡è¦æ›´æ•æ„Ÿï¼Œå¯¹ç¨³å®šæ€§è¦æ±‚æ›´é«˜ã€‚æ‰€ä»¥ä¸ºäº†åº”å¯¹è¿™ç§åœºæ™¯ï¼Œè¿˜éœ€è¦åœ¨è¿™ç§åœºæ™¯ä¸‹åšä¸¤ç§å‡†å¤‡ï¼š å¤§ä¿ƒå‰çš„ç³»ç»Ÿå‹æµ‹ï¼› å¤§ä¿ƒä¸­çš„ä¸»å¤‡é“¾è·¯ä¿éšœï¼› èœé¸ŸåŒ11ã€Œä»“å‚¨é…é€æ•°æ®å®æ—¶åŒ–ã€è¯¦æƒ…äº†è§£ï¼šhttps://yq.aliyun.com/articles/658787 6. å®æ—¶æ•°ä»“ä¸ç¦»çº¿æ•°ä»“çš„å¯¹æ¯”åœ¨çœ‹è¿‡å‰é¢çš„å™è¿°ä¸èœé¸Ÿæ¡ˆä¾‹ä¹‹åï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹å®æ—¶æ•°ä»“ä¸ç¦»çº¿æ•°ä»“åœ¨å‡ æ–¹é¢çš„å¯¹æ¯”ï¼š é¦–å…ˆï¼Œä»æ¶æ„ä¸Šï¼Œå®æ—¶æ•°ä»“ä¸ç¦»çº¿æ•°ä»“æœ‰æ¯”è¾ƒæ˜æ˜¾çš„åŒºåˆ«ï¼Œå®æ—¶æ•°ä»“ä»¥ Kappa æ¶æ„ä¸ºä¸»ï¼Œè€Œç¦»çº¿æ•°ä»“ä»¥ä¼ ç»Ÿå¤§æ•°æ®æ¶æ„ä¸ºä¸»ã€‚Lambda æ¶æ„å¯ä»¥è®¤ä¸ºæ˜¯ä¸¤è€…çš„ä¸­é—´æ€ã€‚ å…¶æ¬¡ï¼Œä»å»ºè®¾æ–¹æ³•ä¸Šï¼Œå®æ—¶æ•°ä»“å’Œç¦»çº¿æ•°ä»“åŸºæœ¬è¿˜æ˜¯æ²¿ç”¨ä¼ ç»Ÿçš„æ•°ä»“ä¸»é¢˜å»ºæ¨¡ç†è®ºï¼Œäº§å‡ºäº‹å®å®½è¡¨ã€‚å¦å¤–å®æ—¶æ•°ä»“ä¸­å®æ—¶æµæ•°æ®çš„ join æœ‰éšè—æ—¶é—´è¯­ä¹‰ï¼Œåœ¨å»ºè®¾ä¸­éœ€æ³¨æ„ã€‚ æœ€åï¼Œä»æ•°æ®ä¿éšœçœ‹ï¼Œå®æ—¶æ•°ä»“å› ä¸ºè¦ä¿è¯å®æ—¶æ€§ï¼Œæ‰€ä»¥å¯¹æ•°æ®é‡çš„å˜åŒ–è¾ƒä¸ºæ•æ„Ÿã€‚åœ¨å¤§ä¿ƒç­‰åœºæ™¯ä¸‹éœ€è¦æå‰åšå¥½å‹æµ‹å’Œä¸»å¤‡ä¿éšœå·¥ä½œï¼Œè¿™æ˜¯ä¸ç¦»çº¿æ•°æ®çš„ä¸€ä¸ªè¾ƒä¸ºæ˜æ˜¾çš„åŒºåˆ«ã€‚ å…³æ³¨æˆ‘å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f Github ä»£ç ä»“åº“https://github.com/zhisheng17/flink-learning/ ä»¥åè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç éƒ½å°†æ”¾åœ¨è¿™ä¸ªä»“åº“é‡Œï¼ŒåŒ…å«äº†è‡ªå·±å­¦ä¹  flink çš„ä¸€äº› demo å’Œåšå®¢ åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€åŸç†ã€å®æˆ˜ã€æ€§èƒ½è°ƒä¼˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"è¯¦è§£ Flink Metrics åŸç†ä¸ç›‘æ§å®æˆ˜","date":"2019-11-22T16:00:00.000Z","path":"2019/11/23/flink-metrics/","text":"æœ¬æ–‡ä¸»è¦è®²è§£ Metricsã€å¦‚ä½•ä½¿ç”¨ Metrics åˆ†æé—®é¢˜å¹¶è§£å†³é—®é¢˜ï¼Œå¹¶å¯¹ Metrics ç›‘æ§å®æˆ˜è¿›è¡Œè§£é‡Šè¯´æ˜ã€‚ æœ¬æ–‡ä½œè€…ï¼šApache Flink Contributor åˆ˜å½ª ä»€ä¹ˆæ˜¯ Metricsï¼ŸFlink æä¾›çš„ Metrics å¯ä»¥åœ¨ Flink å†…éƒ¨æ”¶é›†ä¸€äº›æŒ‡æ ‡ï¼Œé€šè¿‡è¿™äº›æŒ‡æ ‡è®©å¼€å‘äººå‘˜æ›´å¥½åœ°ç†è§£ä½œä¸šæˆ–é›†ç¾¤çš„çŠ¶æ€ã€‚ç”±äºé›†ç¾¤è¿è¡Œåå¾ˆéš¾å‘ç°å†…éƒ¨çš„å®é™…çŠ¶å†µï¼Œè·‘å¾—æ…¢æˆ–å¿«ï¼Œæ˜¯å¦å¼‚å¸¸ç­‰ï¼Œå¼€å‘äººå‘˜æ— æ³•å®æ—¶æŸ¥çœ‹æ‰€æœ‰çš„ Task æ—¥å¿—ï¼Œæ¯”å¦‚ä½œä¸šå¾ˆå¤§æˆ–è€…æœ‰å¾ˆå¤šä½œä¸šçš„æƒ…å†µä¸‹ï¼Œè¯¥å¦‚ä½•å¤„ç†ï¼Ÿæ­¤æ—¶ Metrics å¯ä»¥å¾ˆå¥½çš„å¸®åŠ©å¼€å‘äººå‘˜äº†è§£ä½œä¸šçš„å½“å‰çŠ¶å†µã€‚ Metric TypesMetrics çš„ç±»å‹å¦‚ä¸‹ï¼š é¦–å…ˆï¼Œå¸¸ç”¨çš„å¦‚ Counterï¼Œå†™è¿‡ mapreduce ä½œä¸šçš„å¼€å‘äººå‘˜å°±åº”è¯¥å¾ˆç†Ÿæ‚‰ Counterï¼Œå…¶å®å«ä¹‰éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå°±æ˜¯å¯¹ä¸€ä¸ªè®¡æ•°å™¨è¿›è¡Œç´¯åŠ ï¼Œå³å¯¹äºå¤šæ¡æ•°æ®å’Œå¤šå…†æ•°æ®ä¸€ç›´å¾€ä¸ŠåŠ çš„è¿‡ç¨‹ã€‚ ç¬¬äºŒï¼ŒGaugeï¼ŒGauge æ˜¯æœ€ç®€å•çš„ Metricsï¼Œå®ƒåæ˜ ä¸€ä¸ªå€¼ã€‚æ¯”å¦‚è¦çœ‹ç°åœ¨ Java heap å†…å­˜ç”¨äº†å¤šå°‘ï¼Œå°±å¯ä»¥æ¯æ¬¡å®æ—¶çš„æš´éœ²ä¸€ä¸ª Gaugeï¼ŒGauge å½“å‰çš„å€¼å°±æ˜¯heapä½¿ç”¨çš„é‡ã€‚ ç¬¬ä¸‰ï¼ŒMeterï¼ŒMeter æ˜¯æŒ‡ç»Ÿè®¡ååé‡å’Œå•ä½æ—¶é—´å†…å‘ç”Ÿâ€œäº‹ä»¶â€çš„æ¬¡æ•°ã€‚å®ƒç›¸å½“äºæ±‚ä¸€ç§é€Ÿç‡ï¼Œå³äº‹ä»¶æ¬¡æ•°é™¤ä»¥ä½¿ç”¨çš„æ—¶é—´ã€‚ ç¬¬å››ï¼ŒHistogramï¼ŒHistogram æ¯”è¾ƒå¤æ‚ï¼Œä¹Ÿå¹¶ä¸å¸¸ç”¨ï¼ŒHistogram ç”¨äºç»Ÿè®¡ä¸€äº›æ•°æ®çš„åˆ†å¸ƒï¼Œæ¯”å¦‚è¯´ Quantileã€Meanã€StdDevã€Maxã€Min ç­‰ã€‚ Metric GroupMetric åœ¨ Flink å†…éƒ¨æœ‰å¤šå±‚ç»“æ„ï¼Œä»¥ Group çš„æ–¹å¼ç»„ç»‡ï¼Œå®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªæ‰å¹³åŒ–çš„ç»“æ„ï¼ŒMetric Group + Metric Name æ˜¯ Metrics çš„å”¯ä¸€æ ‡è¯†ã€‚ Metric Group çš„å±‚çº§æœ‰ TaskManagerMetricGroup å’ŒTaskManagerJobMetricGroupï¼Œæ¯ä¸ª Job å…·ä½“åˆ°æŸä¸€ä¸ª task çš„ groupï¼Œtask åˆåˆ†ä¸º TaskIOMetricGroup å’Œ OperatorMetricGroupã€‚Operator ä¸‹é¢ä¹Ÿæœ‰ IO ç»Ÿè®¡å’Œä¸€äº› Metricsï¼Œæ•´ä¸ªå±‚çº§å¤§æ¦‚å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚Metrics ä¸ä¼šå½±å“ç³»ç»Ÿï¼Œå®ƒå¤„åœ¨ä¸åŒçš„ç»„ä¸­ï¼Œå¹¶ä¸” Flinkæ”¯æŒè‡ªå·±å»åŠ  Groupï¼Œå¯ä»¥æœ‰è‡ªå·±çš„å±‚çº§ã€‚ 123456789â€¢TaskManagerMetricGroup â€¢TaskManagerJobMetricGroup â€¢TaskMetricGroup â€¢TaskIOMetricGroup â€¢OperatorMetricGroup â€¢$&#123;User-defined Group&#125; / $&#123;User-defined Metrics&#125; â€¢OperatorIOMetricGroupâ€¢JobManagerMetricGroup â€¢JobManagerJobMetricGroup JobManagerMetricGroup ç›¸å¯¹ç®€å•ï¼Œç›¸å½“äº Masterï¼Œå®ƒçš„å±‚çº§ä¹Ÿç›¸å¯¹è¾ƒå°‘ã€‚ Metrics å®šä¹‰è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œå³æŒ‡æ ‡çš„ä¿¡æ¯å¯ä»¥è‡ªå·±æ”¶é›†ï¼Œè‡ªå·±ç»Ÿè®¡ï¼Œåœ¨å¤–éƒ¨ç³»ç»Ÿèƒ½å¤Ÿçœ‹åˆ° Metrics çš„ä¿¡æ¯ï¼Œå¹¶èƒ½å¤Ÿå¯¹å…¶è¿›è¡Œèšåˆè®¡ç®—ã€‚ å¦‚ä½•ä½¿ç”¨ Metricsï¼ŸSystem MetricsSystem Metricsï¼Œå°†æ•´ä¸ªé›†ç¾¤çš„çŠ¶æ€å·²ç»æ¶µç›–å¾—éå¸¸è¯¦ç»†ã€‚å…·ä½“åŒ…æ‹¬ä»¥ä¸‹æ–¹é¢ï¼š Master çº§åˆ«å’Œ Work çº§åˆ«çš„ JVM å‚æ•°ï¼Œå¦‚ load å’Œ timeï¼›å…¶ Memory åˆ’åˆ†ä¹Ÿå¾ˆè¯¦ç»†ï¼ŒåŒ…æ‹¬ heap çš„ä½¿ç”¨æƒ…å†µã€non-heap çš„ä½¿ç”¨æƒ…å†µã€direct çš„ä½¿ç”¨æƒ…å†µï¼Œä»¥åŠ mapped çš„ä½¿ç”¨æƒ…å†µï¼›Threads å¯ä»¥çœ‹åˆ°å…·ä½“æœ‰å¤šå°‘çº¿ç¨‹ï¼›è¿˜æœ‰éå¸¸å®ç”¨çš„ Garbage Collectionã€‚ Network ä½¿ç”¨æ¯”è¾ƒå¹¿æ³›ï¼Œå½“éœ€è¦è§£å†³ä¸€äº›æ€§èƒ½é—®é¢˜çš„æ—¶å€™ï¼ŒNetwork éå¸¸å®ç”¨ã€‚Flink ä¸åªæ˜¯ç½‘ç»œä¼ è¾“ï¼Œè¿˜æ˜¯ä¸€ä¸ªæœ‰å‘æ— ç¯å›¾çš„ç»“æ„ï¼Œå¯ä»¥çœ‹åˆ°å®ƒçš„æ¯ä¸ªä¸Šä¸‹æ¸¸éƒ½æ˜¯ä¸€ç§ç®€å•çš„ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ã€‚Flink é€šè¿‡ç½‘ç»œç›¸å½“äºæ ‡å‡†çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¸­é—´é€šè¿‡æœ‰é™é•¿åº¦çš„é˜Ÿåˆ—æ¨¡å‹ã€‚å¦‚æœæƒ³è¦è¯„ä¼°å®šä½æ€§èƒ½ï¼Œä¸­é—´é˜Ÿåˆ—ä¼šè¿…é€Ÿç¼©å°é—®é¢˜çš„èŒƒå›´ï¼Œèƒ½å¤Ÿå¾ˆå¿«çš„æ‰¾åˆ°é—®é¢˜ç“¶é¢ˆã€‚ 123456789101112â€¢CPUâ€¢Memoryâ€¢Threadsâ€¢Garbage Collectionâ€¢Networkâ€¢Classloaderâ€¢Clusterâ€¢Availabilityâ€¢Checkpointingâ€¢StateBackendâ€¢IOâ€¢è¯¦è§: [https://ci.apache.org/projects/flink/flink-docs-release-1.8/monitoring/metrics.html#system-metrics](https://ci.apache.org/projects/flink/flink-docs-release-1.8/monitoring/metrics.html) è¿ç»´é›†ç¾¤çš„äººä¼šæ¯”è¾ƒå…³å¿ƒ Cluster çš„ç›¸å…³ä¿¡æ¯ï¼Œå¦‚æœä½œä¸šå¤ªå¤§ï¼Œåˆ™éœ€è¦éå¸¸å…³æ³¨ Checkpointingï¼Œå®ƒæœ‰å¯èƒ½ä¼šåœ¨ä¸€äº›å¸¸è§„çš„æŒ‡æ ‡ä¸Šæ— æ³•ä½“ç°å‡ºæ½œåœ¨é—®é¢˜ã€‚æ¯”å¦‚ Checkpointing é•¿æ—¶é—´æ²¡æœ‰å·¥ä½œï¼Œæ•°æ®æµçœ‹èµ·æ¥æ²¡æœ‰å»¶è¿Ÿï¼Œæ­¤æ—¶å¯èƒ½ä¼šå‡ºç°ä½œä¸šä¸€åˆ‡æ­£å¸¸çš„å‡è±¡ã€‚å¦å¤–ï¼Œå¦‚æœè¿›è¡Œäº†ä¸€è½® failover é‡å¯ä¹‹åï¼Œå› ä¸º Checkpointing é•¿æ—¶é—´æ²¡æœ‰å·¥ä½œï¼Œæœ‰å¯èƒ½ä¼šå›æ»šåˆ°å¾ˆé•¿ä¸€æ®µæ—¶é—´ä¹‹å‰çš„çŠ¶æ€ï¼Œæ•´ä¸ªä½œä¸šå¯èƒ½å°±ç›´æ¥åºŸæ‰äº†ã€‚ RocksDB æ˜¯ç”Ÿäº§ç¯å¢ƒå½“ä¸­æ¯”è¾ƒå¸¸ç”¨çš„ state backend å®ç°ï¼Œå¦‚æœæ•°æ®é‡è¶³å¤Ÿå¤§ï¼Œå°±éœ€è¦å¤šå…³æ³¨ RocksDB çš„ Metricsï¼Œå› ä¸ºå®ƒéšç€æ•°æ®é‡çš„å¢å¤§ï¼Œæ€§èƒ½å¯èƒ½ä¼šä¸‹é™ã€‚ User-defined Metricsé™¤äº†ç³»ç»Ÿçš„ Metrics ä¹‹å¤–ï¼ŒFlink æ”¯æŒè‡ªå®šä¹‰ Metrics ï¼Œå³ User-defined Metricsã€‚ä¸Šæ–‡è¯´çš„éƒ½æ˜¯ç³»ç»Ÿæ¡†æ¶æ–¹é¢ï¼Œå¯¹äºè‡ªå·±çš„ä¸šåŠ¡é€»è¾‘ä¹Ÿå¯ä»¥ç”¨ Metrics æ¥æš´éœ²ä¸€äº›æŒ‡æ ‡ï¼Œä»¥ä¾¿è¿›è¡Œç›‘æ§ã€‚ User-defined Metrics ç°åœ¨æåŠçš„éƒ½æ˜¯ datastream çš„ APIï¼Œtableã€sql å¯èƒ½éœ€è¦ context ååŠ©ï¼Œä½†å¦‚æœå†™ UDFï¼Œå®ƒä»¬å…¶å®æ˜¯å¤§åŒå°å¼‚çš„ã€‚ Datastream çš„ API æ˜¯ç»§æ‰¿ RichFunction ï¼Œç»§æ‰¿ RichFunction æ‰å¯ä»¥æœ‰ Metrics çš„æ¥å£ã€‚ç„¶åé€šè¿‡ RichFunction ä¼šå¸¦æ¥ä¸€ä¸ª getRuntimeContext().getMetricGroup().addGroup(â€¦) çš„æ–¹æ³•ï¼Œè¿™é‡Œå°±æ˜¯ User-defined Metrics çš„å…¥å£ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯ä»¥è‡ªå®šä¹‰ user-defined Metric Groupã€‚å¦‚æœæƒ³å®šä¹‰å…·ä½“çš„ Metricsï¼ŒåŒæ ·éœ€è¦ç”¨getRuntimeContext().getMetricGroup().counter/gauge/meter/histogram(â€¦) æ–¹æ³•ï¼Œå®ƒä¼šæœ‰ç›¸åº”çš„æ„é€ å‡½æ•°ï¼Œå¯ä»¥å®šä¹‰åˆ°è‡ªå·±çš„ Metrics ç±»å‹ä¸­ã€‚ 123ç»§æ‰¿ RichFunction â€¢Register user-defined Metric Group: getRuntimeContext().getMetricGroup().addGroup(â€¦) â€¢Register user-defined Metric: getRuntimeContext().getMetricGroup().counter/gauge/meter/histogram(â€¦) User-defined Metrics Exampleä¸‹é¢é€šè¿‡ä¸€æ®µç®€å•çš„ä¾‹å­è¯´æ˜å¦‚ä½•ä½¿ç”¨ Metricsã€‚æ¯”å¦‚ï¼Œå®šä¹‰äº†ä¸€ä¸ª Counter ä¼ ä¸€ä¸ª nameï¼ŒCounter é»˜è®¤çš„ç±»å‹æ˜¯ single counterï¼ˆFlink å†…ç½®çš„ä¸€ä¸ªå®ç°ï¼‰ï¼Œå¯ä»¥å¯¹ Counter è¿›è¡Œ incï¼ˆï¼‰æ“ä½œï¼Œå¹¶åœ¨ä»£ç é‡Œé¢ç›´æ¥è·å–ã€‚ Meter ä¹Ÿæ˜¯è¿™æ ·ï¼ŒFlink æœ‰ä¸€ä¸ªå†…ç½®çš„å®ç°æ˜¯ Meterviewï¼Œå› ä¸º Meter æ˜¯å¤šé•¿æ—¶é—´å†…å‘ç”Ÿäº‹ä»¶çš„è®°å½•ï¼Œæ‰€ä»¥å®ƒæ˜¯è¦æœ‰ä¸€ä¸ªå¤šé•¿æ—¶é—´çš„çª—å£ã€‚å¹³å¸¸ç”¨ Meter æ—¶ç›´æ¥ markEvent()ï¼Œç›¸å½“äºåŠ ä¸€ä¸ªäº‹ä»¶ä¸åœåœ°æ‰“ç‚¹ï¼Œæœ€åç”¨ getrateï¼ˆï¼‰ çš„æ–¹æ³•ç›´æ¥æŠŠè¿™ä¸€æ®µæ—¶é—´å‘ç”Ÿçš„äº‹ä»¶é™¤ä¸€ä¸‹ç»™ç®—å‡ºæ¥ã€‚ Gauge å°±æ¯”è¾ƒç®€å•äº†ï¼ŒæŠŠå½“å‰çš„æ—¶é—´æ‰“å‡ºæ¥ï¼Œç”¨ Lambda è¡¨è¾¾å¼ç›´æ¥æŠŠ System::currentTimeMillis æ‰“è¿›å»å°±å¯ä»¥ï¼Œç›¸å½“äºæ¯æ¬¡è°ƒç”¨çš„æ—¶å€™éƒ½ä¼šå»çœŸæ­£è°ƒä¸€ä¸‹ç³»ç»Ÿå½“å¤©æ—¶é—´è¿›è¡Œè®¡ç®—ã€‚ Histogram ç¨å¾®å¤æ‚ä¸€ç‚¹ï¼ŒFlink ä¸­ä»£ç æä¾›äº†ä¸¤ç§å®ç°ï¼Œåœ¨æ­¤å–ä¸€å…¶ä¸­ä¸ªå®ç°ï¼Œä»ç„¶éœ€è¦ä¸€ä¸ªçª—å£å¤§å°ï¼Œæ›´æ–°çš„æ—¶å€™å¯ä»¥ç»™å®ƒä¸€ä¸ªå€¼ã€‚ è¿™äº› Metrics ä¸€èˆ¬éƒ½ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚å¦‚æœæƒ³è¦ç”¨å¤šçº¿ç¨‹ï¼Œå°±éœ€è¦åŠ åŒæ­¥ï¼Œæ›´å¤šè¯¦æƒ…è¯·å‚è€ƒä¸‹é¢é“¾æ¥ã€‚ 12345678â€¢Counter processedCount = getRuntimeContext().getMetricGroup().counter(&quot;processed_count&quot;); processedCount.inc();â€¢Meter processRate = getRuntimeContext().getMetricGroup().meter(&quot;rate&quot;, new MeterView(60)); processRate.markEvent();â€¢getRuntimeContext().getMetricGroup().gauge(&quot;current_timestamp&quot;, System::currentTimeMillis);â€¢Histogram histogram = getRuntimeContext().getMetricGroup().histogram(&quot;histogram&quot;, new DescriptiveStatisticsHistogram(1000)); histogram.update(1024);â€¢[https://ci.apache.org/projects/flink/flink-docs-release-1.8/monitoring/metrics.html#metric-types] è·å– Metricsè·å– Metrics æœ‰ä¸‰ç§æ–¹æ³•ï¼Œé¦–å…ˆå¯ä»¥åœ¨ WebUI ä¸Šçœ‹åˆ°ï¼›å…¶æ¬¡å¯ä»¥é€šè¿‡ RESTful API è·å–ï¼ŒRESTful API å¯¹ç¨‹åºæ¯”è¾ƒå‹å¥½ï¼Œæ¯”å¦‚å†™è‡ªåŠ¨åŒ–è„šæœ¬æˆ–ç¨‹åºï¼Œè‡ªåŠ¨åŒ–è¿ç»´å’Œæµ‹è¯•ï¼Œé€šè¿‡ RESTful API è§£æè¿”å›çš„ Json æ ¼å¼å¯¹ç¨‹åºæ¯”è¾ƒå‹å¥½ï¼›æœ€åï¼Œè¿˜å¯ä»¥é€šè¿‡ Metric Reporter è·å–ï¼Œç›‘æ§ä¸»è¦ä½¿ç”¨ Metric Reporter åŠŸèƒ½ã€‚ è·å– Metrics çš„æ–¹å¼åœ¨ç‰©ç†æ¶æ„ä¸Šæ˜¯æ€æ ·å®ç°çš„ï¼Ÿ äº†è§£èƒŒæ™¯å’ŒåŸç†ä¼šå¯¹ä½¿ç”¨æœ‰æ›´æ·±åˆ»çš„ç†è§£ã€‚WebUI å’Œ RESTful API æ˜¯é€šè¿‡ä¸­å¿ƒåŒ–èŠ‚ç‚¹å®šæœŸæŸ¥è¯¢æŠŠå„ä¸ªç»„ä»¶ä¸­çš„ Metrics æ‹‰ä¸Šæ¥çš„å®ç°æ–¹å¼ã€‚å…¶ä¸­ï¼Œfetch ä¸ä¸€å®šæ˜¯å®æ—¶æ›´æ–°çš„ï¼Œé»˜è®¤ä¸º 10 ç§’ï¼Œæ‰€ä»¥æœ‰å¯èƒ½åœ¨ WebUI å’Œ RESTful API ä¸­åˆ·æ–°çš„æ•°æ®ä¸æ˜¯å®æ—¶æƒ³è¦å¾—åˆ°çš„æ•°æ®ï¼›æ­¤å¤–ï¼Œfetch æœ‰å¯èƒ½ä¸åŒæ­¥ï¼Œæ¯”å¦‚ä¸¤ä¸ªç»„ä»¶ï¼Œä¸€è¾¹åœ¨åŠ å¦ä¸€è¾¹æ²¡æœ‰åŠ¨ï¼Œå¯èƒ½æ˜¯ç”±äºæŸç§åŸå› è¶…æ—¶æ²¡æœ‰æ‹‰è¿‡æ¥ï¼Œè¿™æ ·æ˜¯æ— æ³•æ›´æ–°ç›¸å…³å€¼çš„ï¼Œå®ƒæ˜¯ try best çš„æ“ä½œï¼Œæ‰€ä»¥æœ‰æ—¶æˆ‘ä»¬çœ‹åˆ°çš„æŒ‡æ ‡æœ‰å¯èƒ½ä¼šå»¶è¿Ÿï¼Œæˆ–è®¸ç­‰å¾…åç›¸å…³å€¼å°±æ›´æ–°äº†ã€‚ çº¢è‰²çš„è·¯å¾„é€šè¿‡ MetricFetcherï¼Œä¼šæœ‰ä¸€ä¸ªä¸­å¿ƒåŒ–çš„èŠ‚ç‚¹æŠŠå®ƒä»¬èšåˆåœ¨ä¸€èµ·å±•ç¤ºã€‚è€Œ MetricReporter ä¸ä¸€æ ·ï¼Œæ¯ä¸€ä¸ªå•ç‹¬çš„ç‚¹ç›´æ¥æ±‡æŠ¥ï¼Œå®ƒæ²¡æœ‰ä¸­å¿ƒåŒ–èŠ‚ç‚¹å¸®åŠ©åšèšåˆã€‚å¦‚æœæƒ³è¦èšåˆï¼Œéœ€è¦åœ¨ç¬¬ä¸‰æ–¹ç³»ç»Ÿä¸­è¿›è¡Œï¼Œæ¯”å¦‚å¸¸è§çš„ TSDB ç³»ç»Ÿã€‚å½“ç„¶ï¼Œä¸æ˜¯ä¸­å¿ƒåŒ–ç»“æ„ä¹Ÿæ˜¯å®ƒçš„å¥½å¤„ï¼Œå®ƒå¯ä»¥å…å»ä¸­å¿ƒåŒ–èŠ‚ç‚¹å¸¦æ¥çš„é—®é¢˜ï¼Œæ¯”å¦‚å†…å­˜æ”¾ä¸ä¸‹ç­‰ï¼ŒMetricReporter æŠŠåŸå§‹æ•°æ®ç›´æ¥ Reporter å‡ºæ¥ï¼Œç”¨åŸå§‹æ•°æ®åšå¤„ç†ä¼šæœ‰æ›´å¼ºå¤§çš„åŠŸèƒ½ã€‚ Metric ReporterFlink å†…ç½®äº†å¾ˆå¤š Reporterï¼Œå¯¹å¤–éƒ¨ç³»ç»Ÿçš„æŠ€æœ¯é€‰å‹å¯ä»¥å‚è€ƒï¼Œæ¯”å¦‚ JMX æ˜¯ java è‡ªå¸¦çš„æŠ€æœ¯ï¼Œä¸ä¸¥æ ¼å±äºç¬¬ä¸‰æ–¹ã€‚è¿˜æœ‰ InfluxDBã€Prometheusã€Slf4jï¼ˆç›´æ¥æ‰“ log é‡Œï¼‰ç­‰ï¼Œè°ƒè¯•æ—¶å€™å¾ˆå¥½ç”¨ï¼Œå¯ä»¥ç›´æ¥çœ‹ loggerï¼ŒFlink æœ¬èº«è‡ªå¸¦æ—¥å¿—ç³»ç»Ÿï¼Œä¼šæ‰“åˆ° Flink æ¡†æ¶åŒ…é‡Œé¢å»ã€‚è¯¦è§ï¼šè¯¦è§ï¼šhttps://ci.apache.org/projects/flink/flink-docs-release-1.8/monitoring/metrics.html#reporter 12345678//é…ç½®metrics.reporters: your_monitor,jmxmetrics.reporter.jmx.class: org.apache.flink.metrics.jmx.JMXReportermetrics.reporter.jmx.port: 1025-10000metrics.reporter.your_monitor.class: com.your_company.YourMonitorClassmetrics.reporter.your_monitor.interval: 10 SECONDSmetrics.reporter.your_monitor.config.a: your_a_valuemetrics.reporter.your_monitor.config.b: your_b_value Metric Reporter æ˜¯å¦‚ä½•é…ç½®çš„ï¼Ÿå¦‚ä¸Šæ‰€ç¤ºï¼Œé¦–å…ˆ Metrics Reporters çš„åå­—ç”¨é€—å·åˆ†éš”ï¼Œç„¶åé€šè¿‡ metrics.reporter.jmx.class çš„ classname åå°„æ‰¾ reporterï¼Œè¿˜éœ€è¦æ‹¿åˆ° metrics.reporter.jmx.port çš„é…ç½®ï¼Œæ¯”å¦‚åƒç¬¬ä¸‰æ–¹ç³»ç»Ÿé€šè¿‡ç½‘ç»œå‘é€çš„æ¯”è¾ƒå¤šã€‚ä½†è¦çŸ¥é“å¾€å“ªé‡Œå‘ï¼Œip åœ°å€ã€port ä¿¡æ¯æ˜¯æ¯”è¾ƒå¸¸è§çš„ã€‚æ­¤å¤–è¿˜æœ‰ metrics.reporter.your_monitor.class æ˜¯å¿…é¡»è¦æœ‰çš„ï¼Œå¯ä»¥è‡ªå·±å®šä¹‰é—´éš”æ—¶é—´ï¼ŒFlink å¯ä»¥è§£æï¼Œä¸éœ€è¦è‡ªè¡Œå»è¯»ï¼Œå¹¶ä¸”è¿˜å¯ä»¥å†™è‡ªå·±çš„ configã€‚ å®æˆ˜ï¼šåˆ©ç”¨ Metrics ç›‘æ§å¸¸ç”¨ Metrics åšè‡ªåŠ¨åŒ–è¿ç»´å’Œæ€§èƒ½åˆ†æã€‚ è‡ªåŠ¨åŒ–è¿ç»´ è‡ªåŠ¨åŒ–è¿ç»´æ€ä¹ˆåšï¼Ÿ é¦–å…ˆï¼Œæ”¶é›†ä¸€äº›å…³é”®çš„ Metrics ä½œä¸ºå†³ç­–ä¾æ®ï¼Œåˆ©ç”¨ Metric Reporter æ”¶é›† Metrics åˆ°å­˜å‚¨/åˆ†æç³»ç»Ÿ (ä¾‹å¦‚ TSDB)ï¼Œæˆ–è€…ç›´æ¥é€šè¿‡ RESTful API è·å–ã€‚æœ‰äº†æ•°æ®ä¹‹åï¼Œå¯ä»¥å®šåˆ¶ç›‘æ§è§„åˆ™ï¼Œå…³æ³¨å…³é”®æŒ‡æ ‡ï¼ŒFailoverã€Checkpoint,ã€ä¸šåŠ¡ Delay ä¿¡æ¯ã€‚å®šåˆ¶è§„åˆ™ç”¨é€”æœ€å¹¿çš„æ˜¯å¯ä»¥ç”¨æ¥æŠ¥è­¦ï¼Œçœå»å¾ˆå¤šäººå·¥çš„å·¥ä½œï¼Œå¹¶ä¸”å¯ä»¥å®šåˆ¶ failover å¤šå°‘æ¬¡æ—¶éœ€è¦äººä¸ºä»‹å…¥ã€‚å½“å‡ºç°é—®é¢˜æ—¶ï¼Œæœ‰é’‰é’‰æŠ¥è­¦ã€é‚®ä»¶æŠ¥è­¦ã€çŸ­ä¿¡æŠ¥è­¦ã€ç”µè¯æŠ¥è­¦ç­‰é€šçŸ¥å·¥å…·ã€‚è‡ªåŠ¨åŒ–è¿ç»´çš„ä¼˜åŠ¿æ˜¯å¯ä»¥é€šè¿‡å¤§ç›˜ã€æŠ¥è¡¨çš„å½¢å¼æ¸…æ™°çš„æŸ¥çœ‹æ•°æ®ï¼Œé€šè¿‡å¤§ç›˜æ—¶åˆ»äº†è§£ä½œä¸šæ€»ä½“ä¿¡æ¯ï¼Œé€šè¿‡æŠ¥è¡¨åˆ†æä¼˜åŒ–ã€‚ æ€§èƒ½åˆ†ææ€§èƒ½åˆ†æä¸€èˆ¬éµå¾ªå¦‚ä¸‹çš„æµç¨‹ï¼š é¦–å…ˆä»å‘ç°é—®é¢˜å¼€å§‹ï¼Œå¦‚æœæœ‰ Metrics ç³»ç»Ÿï¼Œå†é…ä¸Šç›‘æ§æŠ¥è­¦ï¼Œå°±å¯ä»¥å¾ˆå¿«å®šä½é—®é¢˜ã€‚ç„¶åå¯¹é—®é¢˜è¿›è¡Œå‰–æï¼Œå¤§ç›˜çœ‹é—®é¢˜ä¼šæ¯”è¾ƒæ–¹ä¾¿ï¼Œé€šè¿‡å…·ä½“çš„ System Metrics åˆ†æï¼Œç¼©å°èŒƒå›´ï¼ŒéªŒè¯å‡è®¾ï¼Œæ‰¾åˆ°ç“¶é¢ˆï¼Œè¿›è€Œåˆ†æåŸå› ï¼Œä»ä¸šåŠ¡é€»è¾‘ã€JVMã€ æ“ä½œç³»ç»Ÿã€Stateã€æ•°æ®åˆ†å¸ƒç­‰å¤šç»´åº¦è¿›è¡Œåˆ†æï¼›å¦‚æœè¿˜ä¸èƒ½æ‰¾åˆ°é—®é¢˜åŸå› ï¼Œå°±åªèƒ½å€ŸåŠ© profiling å·¥å…·äº†ã€‚ å®æˆ˜ï¼šâ€œæˆ‘çš„ä»»åŠ¡æ…¢ï¼Œæ€ä¹ˆåŠâ€â€œä»»åŠ¡æ…¢ï¼Œæ€ä¹ˆåŠï¼Ÿâ€å¯ä»¥ç§°ä¹‹ä¸ºæ— æ³•è§£ç­”çš„ç»ˆæé—®é¢˜ä¹‹ä¸€ã€‚ å…¶åŸå› åœ¨äºè¿™ç§é—®é¢˜æ˜¯ç³»ç»Ÿæ¡†æ¶é—®é¢˜ï¼Œæ¯”å¦‚çœ‹åŒ»ç”Ÿæ—¶å‘Šè¯‰åŒ»ç”Ÿèº«ä½“ä¸èˆ’æœï¼Œç„¶åå°±è®©åŒ»ç”Ÿä¸‹ç»“è®ºã€‚è€Œé€šå¸¸åŒ»ç”Ÿéœ€è¦é€šè¿‡ä¸€ç³»åˆ—çš„æ£€æŸ¥æ¥ç¼©å°èŒƒå›´ï¼Œç¡®å®šé—®é¢˜ã€‚åŒç†ï¼Œä»»åŠ¡æ…¢çš„é—®é¢˜ä¹Ÿéœ€è¦ç»è¿‡å¤šè½®å‰–ææ‰èƒ½å¾—åˆ°æ˜ç¡®çš„ç­”æ¡ˆã€‚ é™¤äº†ä¸ç†Ÿæ‚‰ Flink æœºåˆ¶ä»¥å¤–ï¼Œå¤§å¤šæ•°äººçš„é—®é¢˜æ˜¯å¯¹äºæ•´ä¸ªç³»ç»Ÿè·‘èµ·æ¥æ˜¯é»‘ç›’ï¼Œæ ¹æœ¬ä¸çŸ¥é“ç³»ç»Ÿåœ¨å¦‚ä½•è¿è¡Œï¼Œç¼ºå°‘ä¿¡æ¯ï¼Œæ— æ³•äº†è§£ç³»ç»ŸçŠ¶æ€ã€‚æ­¤æ—¶ï¼Œä¸€ä¸ªæœ‰æ•ˆçš„ç­–ç•¥æ˜¯æ±‚åŠ© Metrics æ¥äº†è§£ç³»ç»Ÿå†…éƒ¨çš„çŠ¶å†µï¼Œä¸‹é¢é€šè¿‡ä¸€äº›å…·ä½“çš„ä¾‹å­æ¥è¯´æ˜ã€‚ å‘ç°é—®é¢˜ æ¯”å¦‚ä¸‹å›¾ failover æŒ‡æ ‡ï¼Œçº¿ä¸Šæœ‰ä¸€ä¸ªä¸æ˜¯ 0ï¼Œå…¶å®ƒéƒ½æ˜¯ 0ï¼Œæ­¤æ—¶å°±å‘ç°é—®é¢˜äº†ã€‚ å†æ¯”å¦‚ä¸‹å›¾ Input æŒ‡æ ‡æ­£å¸¸éƒ½åœ¨å››ã€äº”ç™¾ä¸‡ï¼Œçªç„¶è·Œæˆ 0ï¼Œè¿™é‡Œä¹Ÿå­˜åœ¨é—®é¢˜ã€‚ ä¸šåŠ¡å»¶æ—¶é—®é¢˜å¦‚ä¸‹å›¾ï¼Œæ¯”å¦‚å¤„ç†åˆ°çš„æ•°æ®è·Ÿå½“å‰æ—¶é—´æ¯”å¯¹ï¼Œå‘ç°å¤„ç†çš„æ•°æ®æ˜¯ä¸€å°æ—¶å‰çš„æ•°æ®ï¼Œå¹³æ—¶éƒ½æ˜¯å¤„ç†ä¸€ç§’ä¹‹å‰çš„æ•°æ®ï¼Œè¿™ä¹Ÿæ˜¯æœ‰é—®é¢˜çš„ã€‚ ç¼©å°èŒƒå›´ï¼Œå®šä½ç“¶é¢ˆ å½“å‡ºç°ä¸€ä¸ªåœ°æ–¹æ¯”è¾ƒæ…¢ï¼Œä½†æ˜¯ä¸çŸ¥é“å“ªé‡Œæ…¢æ—¶ï¼Œå¦‚ä¸‹å›¾çº¢è‰²éƒ¨åˆ†ï¼ŒOUTQ å¹¶å‘å€¼å·²ç»è¾¾åˆ° 100% äº†ï¼Œå…¶å®ƒéƒ½è¿˜æ¯”è¾ƒæ­£å¸¸ï¼Œç”šè‡³ä¼˜ç§€ã€‚åˆ°è¿™é‡Œç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹å‡ºç°äº†é—®é¢˜ï¼Œç”Ÿäº§è€… INQ æ˜¯æ»¡çš„ï¼Œæ¶ˆè´¹è€… OUT_Q ä¹Ÿæ˜¯æ»¡çš„ï¼Œä»å›¾ä¸­çœ‹å‡ºèŠ‚ç‚¹ 4 å·²ç»å¾ˆæ…¢äº†ï¼ŒèŠ‚ç‚¹ 1 äº§ç”Ÿçš„æ•°æ®èŠ‚ç‚¹ 4 å¤„ç†ä¸è¿‡æ¥ï¼Œè€ŒèŠ‚ç‚¹ 5 çš„æ€§èƒ½éƒ½å¾ˆæ­£å¸¸ï¼Œè¯´æ˜èŠ‚ç‚¹ 1 å’ŒèŠ‚ç‚¹ 4 ä¹‹é—´çš„é˜Ÿåˆ—å·²ç»å µäº†ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é‡ç‚¹æŸ¥çœ‹èŠ‚ç‚¹ 1 å’ŒèŠ‚ç‚¹ 4ï¼Œç¼©å°äº†é—®é¢˜èŒƒå›´ã€‚ 500 ä¸ª InBps éƒ½å…·æœ‰ 256 ä¸ª PARALLEL ï¼Œè¿™ä¹ˆå¤šä¸ªç‚¹ä¸å¯èƒ½ä¸€ä¸€å»çœ‹ï¼Œå› æ­¤éœ€è¦åœ¨èšåˆæ—¶æŠŠ index æ˜¯ç¬¬å‡ ä¸ªå¹¶å‘åšä¸€ä¸ªæ ‡ç­¾ã€‚èšåˆæŒ‰ç€æ ‡ç­¾è¿›è¡Œåˆ’åˆ†ï¼Œçœ‹å“ªä¸€ä¸ªå¹¶å‘æ˜¯ 100%ã€‚åœ¨å›¾ä¸­å¯ä»¥åˆ’åˆ†å‡ºæœ€é«˜çš„ä¸¤ä¸ªçº¿ï¼Œå³çº¿ 324 å’Œçº¿ 115ï¼Œè¿™æ ·å°±åˆè¿›ä¸€æ­¥çš„ç¼©å°äº†èŒƒå›´ã€‚ åˆ©ç”¨ Metrics ç¼©å°èŒƒå›´çš„æ–¹å¼å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå°±æ˜¯ç”¨ Checkpoint Alignment è¿›è¡Œå¯¹é½ï¼Œè¿›è€Œç¼©å°èŒƒå›´ï¼Œä½†è¿™ç§æ–¹æ³•ç”¨çš„è¾ƒå°‘ã€‚ å¤šç»´åº¦åˆ†æ åˆ†æä»»åŠ¡æœ‰æ—¶å€™ä¸ºä»€ä¹ˆç‰¹åˆ«æ…¢å‘¢ï¼Ÿ å½“å®šä½åˆ°æŸä¸€ä¸ª Task å¤„ç†ç‰¹åˆ«æ…¢æ—¶ï¼Œéœ€è¦å¯¹æ…¢çš„å› ç´ åšå‡ºåˆ†æã€‚åˆ†æä»»åŠ¡æ…¢çš„å› ç´ æ˜¯æœ‰ä¼˜å…ˆçº§çš„ï¼Œå¯ä»¥ä»ä¸Šå‘ä¸‹æŸ¥ï¼Œç”±ä¸šåŠ¡æ–¹é¢å‘åº•å±‚ç³»ç»Ÿã€‚å› ä¸ºå¤§éƒ¨åˆ†é—®é¢˜éƒ½å‡ºç°åœ¨ä¸šåŠ¡ç»´åº¦ä¸Šï¼Œæ¯”å¦‚æŸ¥çœ‹ä¸šåŠ¡ç»´åº¦çš„å½±å“å¯ä»¥æœ‰ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼Œå¹¶å‘åº¦æ˜¯å¦åˆç†ã€æ•°æ®æ³¢å³°æ³¢è°·ã€æ•°æ®å€¾æ–œï¼›å…¶æ¬¡ä¾æ¬¡ä» Garbage Collectionã€Checkpoint Alignmentã€State Backend æ€§èƒ½è§’åº¦è¿›è¡Œåˆ†æï¼›æœ€åä»ç³»ç»Ÿæ€§èƒ½è§’åº¦è¿›è¡Œåˆ†æï¼Œæ¯”å¦‚ CPUã€å†…å­˜ã€Swapã€Disk IOã€ååé‡ã€å®¹é‡ã€Network IOã€å¸¦å®½ç­‰ã€‚ Q &amp; AQï¼šMetrics æ˜¯ç³»ç»Ÿå†…éƒ¨çš„ç›‘æ§ï¼Œé‚£æ˜¯å¦å¯ä»¥ä½œä¸º Flink æ—¥å¿—åˆ†æçš„è¾“å‡ºï¼Ÿ å¯ä»¥ï¼Œä½†æ˜¯æ²¡æœ‰å¿…è¦ï¼Œéƒ½ç”¨ Flink å»å¤„ç†å…¶ä»–ç³»ç»Ÿçš„æ—¥å¿—äº†ï¼Œè¾“å‡ºæˆ–æŠ¥è­¦ç›´æ¥å½“åš sink è¾“å‡ºå°±å¥½äº†ã€‚å› ä¸º Metrics æ˜¯ç»Ÿè®¡å†…éƒ¨çŠ¶æ€ï¼Œä½ è¿™æ˜¯å¤„ç†æ­£å¸¸è¾“å…¥æ•°æ®ï¼Œç›´æ¥è¾“å‡ºå°±å¯ä»¥äº†ã€‚ Qï¼šReporter æ˜¯æœ‰ä¸“é—¨çš„çº¿ç¨‹å—ï¼Ÿ æ¯ä¸ª Reporter éƒ½æœ‰è‡ªå·±å•ç‹¬çš„çº¿ç¨‹ã€‚åœ¨ Flink çš„å†…éƒ¨ï¼Œçº¿ç¨‹å…¶å®è¿˜æ˜¯æŒºå¤šçš„ï¼Œå¦‚æœè·‘ä¸€ä¸ªä½œä¸šï¼Œç›´æ¥åˆ° TaskManager ä¸Šï¼Œjstack å°±èƒ½çœ‹åˆ°çº¿ç¨‹çš„è¯¦æƒ…ã€‚ å…³æ³¨æˆ‘å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f Github ä»£ç ä»“åº“https://github.com/zhisheng17/flink-learning/ ä»¥åè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç éƒ½å°†æ”¾åœ¨è¿™ä¸ªä»“åº“é‡Œï¼ŒåŒ…å«äº†è‡ªå·±å­¦ä¹  flink çš„ä¸€äº› demo å’Œåšå®¢ åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€åŸç†ã€å®æˆ˜ã€æ€§èƒ½è°ƒä¼˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ã€Šå¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–ã€‹æ–°ä¸“æ ","date":"2019-11-14T16:00:00.000Z","path":"2019/11/15/flink-in-action/","text":"åŸºäº Flink 1.9 è®²è§£çš„ä¸“æ ï¼Œæ¶‰åŠå…¥é—¨ã€æ¦‚å¿µã€åŸç†ã€å®æˆ˜ã€æ€§èƒ½è°ƒä¼˜ã€ç³»ç»Ÿæ¡ˆä¾‹çš„è®²è§£ã€‚ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f ä¸“æ äº®ç‚¹ å…¨ç½‘é¦–ä¸ªä½¿ç”¨æœ€æ–°ç‰ˆæœ¬ Flink 1.9 è¿›è¡Œå†…å®¹è®²è§£ï¼ˆè¯¥ç‰ˆæœ¬æ›´æ–°å¾ˆå¤§ï¼Œæ¶æ„åŠŸèƒ½éƒ½æœ‰æ›´æ–°ï¼‰ï¼Œé¢†è·‘äºç›®å‰å¸‚é¢ä¸Šå¸¸è§çš„ Flink 1.7 ç‰ˆæœ¬çš„æ•™å­¦è¯¾ç¨‹ã€‚ åŒ…å«å¤§é‡çš„å®æˆ˜æ¡ˆä¾‹å’Œä»£ç å»è®²è§£åŸç†ï¼Œæœ‰åŠ©äºè¯»è€…ä¸€è¾¹å­¦ä¹ ä¸€è¾¹æ•²ä»£ç ï¼Œè¾¾åˆ°æ›´å¿«ï¼Œæ›´æ·±åˆ»çš„å­¦ä¹ å¢ƒç•Œã€‚ç›®å‰å¸‚é¢ä¸Šçš„ä¹¦ç±æ²¡æœ‰ä»»ä½•å®æˆ˜çš„å†…å®¹ï¼Œè¿˜åªæ˜¯è®²è§£çº¯æ¦‚å¿µå’Œç¿»è¯‘å®˜ç½‘ã€‚ åœ¨ä¸“æ é«˜çº§ç¯‡ä¸­ï¼Œæ ¹æ® Flink å¸¸è§çš„é¡¹ç›®é—®é¢˜æä¾›äº†æ’æŸ¥å’Œè§£å†³çš„æ€ç»´æ–¹æ³•ï¼Œå¹¶é€šè¿‡è¿™äº›é—®é¢˜æ¢ç©¶äº†ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç±»é—®é¢˜ã€‚ åœ¨å®æˆ˜å’Œæ¡ˆä¾‹ç¯‡ï¼Œå›´ç»•å¤§å‚å…¬å¸çš„ç»å…¸éœ€æ±‚è¿›è¡Œåˆ†æï¼ŒåŒ…æ‹¬æ¶æ„è®¾è®¡ã€æ¯ä¸ªç¯èŠ‚çš„æ“ä½œã€ä»£ç å®ç°éƒ½æœ‰ä¸€ä¸€è®²è§£ã€‚ ä¸ºä»€ä¹ˆè¦å­¦ä¹  Flinkï¼Ÿéšç€å¤§æ•°æ®çš„ä¸æ–­å‘å±•ï¼Œå¯¹æ•°æ®çš„åŠæ—¶æ€§è¦æ±‚è¶Šæ¥è¶Šé«˜ï¼Œå®æ—¶åœºæ™¯éœ€æ±‚ä¹Ÿå˜å¾—è¶Šæ¥è¶Šå¤šï¼Œä¸»è¦åˆ†ä¸‹é¢å‡ å¤§ç±»ï¼š ä¸ºäº†æ»¡è¶³è¿™äº›å®æ—¶åœºæ™¯çš„éœ€æ±‚ï¼Œè¡ç”Ÿå‡ºä¸å°‘è®¡ç®—å¼•æ“æ¡†æ¶ã€‚ç°æœ‰å¸‚é¢ä¸Šçš„å¤§æ•°æ®è®¡ç®—å¼•æ“çš„å¯¹æ¯”å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å¯ä»¥å‘ç°æ— è®ºä» Flink çš„æ¶æ„è®¾è®¡ä¸Šï¼Œè¿˜æ˜¯ä»å…¶åŠŸèƒ½å®Œæ•´æ€§å’Œæ˜“ç”¨æ€§æ¥è®²éƒ½æ˜¯é¢†å…ˆçš„ï¼Œå†åŠ ä¸Š Flink æ˜¯é˜¿é‡Œå·´å·´ä¸»æ¨çš„è®¡ç®—å¼•æ“æ¡†æ¶ï¼Œæ‰€ä»¥ä»å»å¹´å¼€å§‹å°±è¶Šæ¥è¶Šç«äº†ï¼ ç›®å‰ï¼Œé˜¿é‡Œå·´å·´ã€è…¾è®¯ã€ç¾å›¢ã€åä¸ºã€æ»´æ»´å‡ºè¡Œã€æºç¨‹ã€é¥¿äº†ä¹ˆã€çˆ±å¥‡è‰ºã€æœ‰èµã€å”¯å“ä¼šç­‰å¤§å‚éƒ½å·²ç»å°† Flink å®è·µäºå…¬å¸å¤§å‹é¡¹ç›®ä¸­ï¼Œå¸¦èµ·äº†ä¸€æ³¢ Flink é£æ½®ï¼ŒåŠ¿å¿…ä¹Ÿä¼šè®© Flink äººæ‰å¸‚åœºäº§ç”Ÿä¾›ä¸åº”æ±‚çš„æ‹›è˜ç°è±¡ã€‚ ä¸“æ å†…å®¹ é¢„å¤‡ç¯‡ä»‹ç»å®æ—¶è®¡ç®—å¸¸è§çš„ä½¿ç”¨åœºæ™¯ï¼Œè®²è§£ Flink çš„ç‰¹æ€§ï¼Œå¹¶ä¸”å¯¹æ¯”äº† Spark Streamingã€Structured Streaming å’Œ Storm ç­‰å¤§æ•°æ®å¤„ç†å¼•æ“ï¼Œç„¶åå‡†å¤‡ç¯å¢ƒå¹¶é€šè¿‡ä¸¤ä¸ª Flink åº”ç”¨ç¨‹åºå¸¦å¤§å®¶ä¸Šæ‰‹ Flinkã€‚ åŸºç¡€ç¯‡æ·±å…¥è®²è§£ Flink ä¸­ Timeã€Windowã€Watermarkã€Connector åŸç†ï¼Œå¹¶æœ‰å¤§é‡æ–‡ç« ç¯‡å¹…ï¼ˆå«è¯¦ç»†ä»£ç ï¼‰è®²è§£å¦‚ä½•å»ä½¿ç”¨è¿™äº› Connectorï¼ˆæ¯”å¦‚ Kafkaã€ElasticSearchã€HBaseã€Redisã€MySQL ç­‰ï¼‰ï¼Œå¹¶ä¸”ä¼šè®²è§£ä½¿ç”¨è¿‡ç¨‹ä¸­å¯èƒ½ä¼šé‡åˆ°çš„å‘ï¼Œè¿˜æ•™å¤§å®¶å¦‚ä½•å»è‡ªå®šä¹‰ Connectorã€‚ è¿›é˜¶ç¯‡è®²è§£ Flink ä¸­ Stateã€Checkpointã€Savepointã€å†…å­˜ç®¡ç†æœºåˆ¶ã€CEPã€Tableï¼SQL APIã€Machine Learning ã€Gellyã€‚åœ¨è¿™ç¯‡ä¸­ä¸ä»…åªè®²æ¦‚å¿µï¼Œè¿˜ä¼šè®²è§£å¦‚ä½•å»ä½¿ç”¨ Stateã€å¦‚ä½•é…ç½® Checkpointã€Checkpoint çš„æµç¨‹å’Œå¦‚ä½•åˆ©ç”¨ CEP å¤„ç†å¤æ‚äº‹ä»¶ã€‚ é«˜çº§ç¯‡é‡ç‚¹ä»‹ç» Flink ä½œä¸šä¸Šçº¿åçš„ç›‘æ§è¿ç»´ï¼šå¦‚ä½•ä¿è¯é«˜å¯ç”¨ã€å¦‚ä½•å®šä½å’Œæ’æŸ¥åå‹é—®é¢˜ã€å¦‚ä½•åˆç†çš„è®¾ç½®ä½œä¸šçš„å¹¶è¡Œåº¦ã€å¦‚ä½•ä¿è¯ Exactly Onceã€å¦‚ä½•å¤„ç†æ•°æ®å€¾æ–œé—®é¢˜ã€å¦‚ä½•è°ƒä¼˜æ•´ä¸ªä½œä¸šçš„æ‰§è¡Œæ•ˆç‡ã€å¦‚ä½•ç›‘æ§ Flink åŠå…¶ä½œä¸šï¼Ÿ å®æˆ˜ç¯‡æ•™å¤§å®¶å¦‚ä½•åˆ†æå®æ—¶è®¡ç®—åœºæ™¯çš„éœ€æ±‚ï¼Œå¹¶ä½¿ç”¨ Flink é‡Œé¢çš„æŠ€æœ¯å»å®ç°è¿™äº›éœ€æ±‚ï¼Œæ¯”å¦‚å®æ—¶ç»Ÿè®¡ PVï¼UVã€å®æ—¶ç»Ÿè®¡å•†å“é”€å”®é¢ TopKã€åº”ç”¨ Error æ—¥å¿—å®æ—¶å‘Šè­¦ã€æœºå™¨å®•æœºå‘Šè­¦ã€‚è¿™äº›éœ€æ±‚å¦‚ä½•ä½¿ç”¨ Flink å®ç°çš„éƒ½ä¼šæä¾›å®Œæ•´çš„ä»£ç ä¾›å¤§å®¶å‚è€ƒï¼Œé€šè¿‡è¿™äº›éœ€æ±‚ä½ å¯ä»¥å­¦åˆ° ProcessFunctionã€Async Iï¼Oã€å¹¿æ’­å˜é‡ç­‰çŸ¥è¯†çš„ä½¿ç”¨æ–¹å¼ã€‚ ç³»ç»Ÿæ¡ˆä¾‹ç¯‡è®²è§£å¤§å‹æµé‡ä¸‹çš„çœŸå®æ¡ˆä¾‹ï¼šå¦‚ä½•å»å®æ—¶å¤„ç†æµ·é‡æ—¥å¿—ï¼ˆé”™è¯¯æ—¥å¿—å®æ—¶å‘Šè­¦ï¼æ—¥å¿—å®æ—¶ ETLï¼æ—¥å¿—å®æ—¶å±•ç¤ºï¼æ—¥å¿—å®æ—¶æœç´¢ï¼‰ã€åŸºäº Flink çš„ç™¾äº¿æ•°æ®å®æ—¶å»é‡å®è·µï¼ˆä»å»é‡çš„é€šç”¨è§£å†³æ–¹æ¡ˆ â€“&gt; ä½¿ç”¨ BloomFilter æ¥å®ç°å»é‡ â€“&gt; ä½¿ç”¨ Flink çš„ KeyedState å®ç°å»é‡ï¼‰ã€‚ å¤šå›¾è®²è§£ Flink çŸ¥è¯†ç‚¹ ä½ å°†è·å¾—ä»€ä¹ˆ æŒæ¡ Flink ä¸å…¶ä»–è®¡ç®—æ¡†æ¶çš„åŒºåˆ« æŒæ¡ Flink Timeï¼Windowï¼Watermarkï¼Connectors æ¦‚å¿µå’Œå®ç°åŸç† æŒæ¡ Flink Stateï¼Checkpointï¼Savepoint çŠ¶æ€ä¸å®¹é”™ ç†Ÿç»ƒä½¿ç”¨ DataStreamï¼DataSetï¼Tableï¼SQL API å¼€å‘ Flink ä½œä¸š æŒæ¡ Flink ä½œä¸šéƒ¨ç½²ï¼è¿ç»´ï¼ç›‘æ§ï¼æ€§èƒ½è°ƒä¼˜ å­¦ä¼šå¦‚ä½•åˆ†æå¹¶å®Œæˆå®æ—¶è®¡ç®—éœ€æ±‚ è·å¾—å¤§å‹é«˜å¹¶å‘æµé‡ç³»ç»Ÿæ¡ˆä¾‹å®æˆ˜é¡¹ç›®ç»éªŒ é€‚å®œäººç¾¤ Flink çˆ±å¥½è€… å®æ—¶è®¡ç®—å¼€å‘å·¥ç¨‹å¸ˆ å¤§æ•°æ®å¼€å‘å·¥ç¨‹å¸ˆ è®¡ç®—æœºä¸“ä¸šç ”ç©¶ç”Ÿ æœ‰å®æ—¶è®¡ç®—åœºæ™¯åœºæ™¯çš„ Java å¼€å‘å·¥ç¨‹å¸ˆ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ä¸€æ–‡å½»åº•ææ‡‚ Flink ç½‘ç»œæµæ§ä¸åå‹æœºåˆ¶","date":"2019-08-25T16:00:00.000Z","path":"2019/08/26/flink-back-pressure/","text":"çœ‹å®Œæœ¬æ–‡ï¼Œä½ èƒ½getåˆ°ä»¥ä¸‹çŸ¥è¯† Flink æµå¤„ç†ä¸ºä»€ä¹ˆéœ€è¦ç½‘ç»œæµæ§ï¼Ÿ Flink V1.5 ç‰ˆä¹‹å‰ç½‘ç»œæµæ§ä»‹ç» Flink V1.5 ç‰ˆä¹‹å‰çš„åå‹ç­–ç•¥å­˜åœ¨çš„é—®é¢˜ Creditçš„åå‹ç­–ç•¥å®ç°åŸç†ï¼ŒCreditæ˜¯å¦‚ä½•è§£å†³ Flink 1.5 ä¹‹å‰çš„é—®é¢˜ï¼Ÿ å¯¹æ¯”sparkï¼Œéƒ½è¯´flinkå»¶è¿Ÿä½ï¼Œæ¥ä¸€æ¡å¤„ç†ä¸€æ¡ï¼ŒçœŸæ˜¯è¿™æ ·å—ï¼Ÿå…¶å®Flinkå†…éƒ¨ä¹Ÿæœ‰Bufferæœºåˆ¶ï¼ŒBufferæœºåˆ¶å…·ä½“æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ Flink å¦‚ä½•åœ¨ååé‡å’Œå»¶è¿Ÿä¹‹é—´åšæƒè¡¡ï¼Ÿ åç»­ç›¸å…³åšå®¢ Flink åå‹ç›¸å…³ Metrics ä»‹ç» åŸºäº Flink çš„æµæ§æœºåˆ¶å’Œåå‹å¦‚ä½•å®šä½ Flink ä»»åŠ¡çš„ç“¶é¢ˆã€‚æˆ–è€…è¯´ï¼Œå¦‚æœä¸€ä¸ªå¹³æ—¶æ­£å¸¸çš„ Flink ä»»åŠ¡çªç„¶å‡ºç°å»¶è¿Ÿäº†ï¼Œæ€ä¹ˆæ¥å®šä½é—®é¢˜ï¼Ÿåˆ°åº•æ˜¯ Kafka è¯»å–æ•°æ®æ…¢ï¼Œè¿˜æ˜¯ä¸­é—´æŸä¸ªè®¡ç®—ç¯èŠ‚æ¯”è¾ƒæ¶ˆè€—èµ„æºä½¿å¾—å˜æ…¢ï¼Œè¿˜æ˜¯ç”±äºæœ€åçš„å†™å…¥å¤–éƒ¨å­˜å‚¨æ—¶æ¯”è¾ƒæ…¢ï¼Ÿ Flink æµå¤„ç†ä¸ºä»€ä¹ˆéœ€è¦ç½‘ç»œæµæ§ï¼Ÿåˆ†æä¸€ä¸ªç®€å•çš„ Flink æµä»»åŠ¡ï¼Œä¸‹å›¾æ˜¯ä¸€ä¸ªç®€å•çš„Flinkæµä»»åŠ¡æ‰§è¡Œå›¾ï¼šä»»åŠ¡é¦–å…ˆä» Kafka ä¸­è¯»å–æ•°æ®ã€ map ç®—å­å¯¹æ•°æ®è¿›è¡Œè½¬æ¢ã€keyBy æŒ‰ç…§æŒ‡å®š key å¯¹æ•°æ®è¿›è¡Œåˆ†åŒºï¼ˆç›¸åŒ key çš„æ•°æ®ç»è¿‡ keyBy ååˆ†åˆ°åŒä¸€ä¸ª subtask å®ä¾‹ä¸­ï¼‰ï¼ŒkeyBy åå¯¹æ•°æ®æ¥ç€è¿›è¡Œ map è½¬æ¢ï¼Œç„¶åä½¿ç”¨ Sink å°†æ•°æ®è¾“å‡ºåˆ°å¤–éƒ¨å­˜å‚¨ã€‚ ä¼—æ‰€å‘¨çŸ¥ï¼Œåœ¨å¤§æ•°æ®å¤„ç†ä¸­ï¼Œæ— è®ºæ˜¯æ‰¹å¤„ç†è¿˜æ˜¯æµå¤„ç†ï¼Œå•ç‚¹å¤„ç†çš„æ€§èƒ½æ€»æ˜¯æœ‰é™çš„ï¼Œæˆ‘ä»¬çš„å•ä¸ª Job ä¸€èˆ¬ä¼šè¿è¡Œåœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šï¼Œå¤šä¸ªèŠ‚ç‚¹å…±åŒé…åˆæ¥æå‡æ•´ä¸ªç³»ç»Ÿçš„å¤„ç†æ€§èƒ½ã€‚å›¾ä¸­ï¼Œä»»åŠ¡è¢«åˆ‡åˆ†æˆ 4 ä¸ªå¯ç‹¬ç«‹æ‰§è¡Œçš„ subtaskï¼ˆ A0ã€A1ã€B0ã€B1ï¼‰ï¼Œåœ¨æ•°æ®å¤„ç†è¿‡ç¨‹ä¸­ï¼Œå°±ä¼šå­˜åœ¨ shuffleï¼ˆæ•°æ®ä¼ è¾“ï¼‰çš„è¿‡ç¨‹ã€‚ä¾‹å¦‚ï¼Œsubtask A0 å¤„ç†å®Œçš„æ•°æ®ç»è¿‡ keyBy åå‘é€åˆ° subtask B0ã€B1 æ‰€åœ¨èŠ‚ç‚¹å»å¤„ç†ã€‚ é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œä¸‹å›¾ä¸­ï¼Œä¸Šæ¸¸ Producer å‘ä¸‹æ¸¸ Consumer å‘é€æ•°æ®ï¼Œåœ¨å‘é€ç«¯å’Œæ¥å—ç«¯éƒ½æœ‰ç›¸åº”çš„ Send Buffer å’Œ Receive Bufferï¼Œä½†æ˜¯ä¸Šæ¸¸ Producer ç”Ÿæˆæ•°æ®çš„é€Ÿç‡æ¯”ä¸‹æ¸¸ Consumer æ¶ˆè´¹æ•°æ®çš„é€Ÿç‡å¿«ã€‚Producer ç”Ÿäº§æ•°æ® 2MB/sï¼Œ Consumer æ¶ˆè´¹æ•°æ® 1MB/sï¼ŒReceive Buffer åªæœ‰ 5MBï¼Œæ‰€ä»¥è¿‡äº†5ç§’åï¼Œæ¥æ”¶ç«¯çš„ Receive Buffer æ»¡äº†ã€‚ï¼ˆå¯ä»¥æŠŠä¸‹å›¾ä¸­çš„ Producer å½“åšä¸Šé¢æ¡ˆä¾‹ä¸­çš„ subtask A0ï¼ŒæŠŠä¸‹å›¾ä¸­çš„ Consumer å½“åšä¸Šé¢æ¡ˆä¾‹ä¸­çš„ subtask B0ï¼‰ ä¸‹æ¸¸æ¥æ”¶åŒºçš„ Receive Buffer æœ‰é™ï¼Œå¦‚æœä¸Šæ¸¸ä¸€ç›´æœ‰æºæºä¸æ–­çš„æ•°æ®ï¼Œé‚£ä¹ˆå°†ä¼šé¢ä¸´ç€ä»¥ä¸‹ä¸¤ä¸ªæƒ…å†µï¼š ä¸‹æ¸¸æ¶ˆè´¹è€…ä¼šä¸¢å¼ƒæ–°åˆ°è¾¾çš„æ•°æ®ï¼Œå› ä¸ºä¸‹æ¸¸æ¶ˆè´¹è€…çš„ç¼“å†²åŒºæ”¾ä¸ä¸‹ ä¸ºäº†ä¸ä¸¢å¼ƒæ•°æ®ï¼Œæ‰€ä»¥ä¸‹æ¸¸æ¶ˆè´¹è€…çš„ Receive Buffer æŒç»­æ‰©å¼ ï¼Œæœ€åè€—å°½æ¶ˆè´¹è€…çš„å†…å­˜ï¼ŒOOMï¼Œç¨‹åºæŒ‚æ‰ å¸¸è¯†å‘Šè¯‰æˆ‘ä»¬ï¼Œè¿™ä¸¤ç§æƒ…å†µåœ¨ç”Ÿäº§ç¯å¢ƒéƒ½æ˜¯ä¸èƒ½æ¥å—çš„ï¼Œç¬¬ä¸€ç§ä¼šæŠŠæ•°æ®ä¸¢å¼ƒã€ç¬¬äºŒç§ä¼šæŠŠæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæŒ‚æ‰ã€‚æ‰€ä»¥ï¼Œè¯¥é—®é¢˜çš„è§£å†³æ–¹æ¡ˆä¸åº”è¯¥æ˜¯ä¸‹æ¸¸ Receive Buffer ä¸€ç›´ç´¯ç§¯æ•°æ®ï¼Œè€Œæ˜¯ä¸Šæ¸¸ Producer å‘ç°ä¸‹æ¸¸ Consumer å¤„ç†æ¯”è¾ƒæ…¢ä¹‹åï¼Œåº”è¯¥åœ¨ Producer ç«¯åšå‡ºé™æµçš„ç­–ç•¥ï¼Œé˜²æ­¢åœ¨ä¸‹æ¸¸ Consumer ç«¯æ— é™åˆ¶çš„æ•°æ®å †ç§¯ã€‚ é‚£ä¸Šæ¸¸ Producer ç«¯è¯¥å¦‚ä½•åšé™æµå‘¢ï¼Ÿå¯ä»¥é‡‡ç”¨ä¸‹å›¾æ‰€ç¤ºé™æ€é™æµçš„ç­–ç•¥ï¼š é™æ€é™é€Ÿçš„æ€æƒ³å°±æ˜¯ï¼Œæå‰å·²çŸ¥ä¸‹æ¸¸ Consumer çš„æ¶ˆè´¹é€Ÿç‡ï¼Œç„¶åé€šè¿‡åœ¨ä¸Šæ¸¸ Producer ç«¯ä½¿ç”¨ç±»ä¼¼ä»¤ç‰Œæ¡¶çš„æ€æƒ³ï¼Œé™åˆ¶ Producer ç«¯ç”Ÿäº§æ•°æ®çš„é€Ÿç‡ï¼Œä»è€Œæ§åˆ¶ä¸Šæ¸¸ Producer ç«¯å‘ä¸‹æ¸¸ Consumer ç«¯å‘é€æ•°æ®çš„é€Ÿç‡ã€‚ä½†æ˜¯é™æ€é™é€Ÿä¼šå­˜åœ¨é—®é¢˜ï¼š é€šå¸¸æ— æ³•äº‹å…ˆé¢„ä¼°ä¸‹æ¸¸ Consumer ç«¯èƒ½æ‰¿å—çš„æœ€å¤§é€Ÿç‡ å°±ç®—é€šè¿‡æŸç§æ–¹å¼é¢„ä¼°å‡ºä¸‹æ¸¸ Consumer ç«¯èƒ½æ‰¿å—çš„æœ€å¤§é€Ÿç‡ï¼Œä¸‹æ¸¸åº”ç”¨ç¨‹åºä¹Ÿå¯èƒ½ä¼šå› ä¸ºç½‘ç»œæŠ–åŠ¨ã€ CPU å…±äº«ç«äº‰ã€å†…å­˜ç´§å¼ ã€IOé˜»å¡ç­‰åŸå› é€ æˆä¸‹æ¸¸åº”ç”¨ç¨‹åºçš„ååé‡é™ä½ï¼Œç„¶ååˆä¼šå‡ºç°ä¸Šé¢æ‰€è¯´çš„ä¸‹æ¸¸æ¥æ”¶åŒºçš„ Receive Buffer æœ‰é™ï¼Œä¸Šæ¸¸ä¸€ç›´æœ‰æºæºä¸æ–­çš„æ•°æ®å‘é€åˆ°ä¸‹æ¸¸çš„é—®é¢˜ï¼Œè¿˜æ˜¯ä¼šé€ æˆä¸‹æ¸¸è¦ä¹ˆä¸¢æ•°æ®ï¼Œè¦ä¹ˆä¸ºäº†ä¸ä¸¢æ•°æ® buffer ä¸æ–­æ‰©å……å¯¼è‡´ä¸‹æ¸¸ OOMçš„é—®é¢˜ ç»¼ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬å‘ç°äº†ï¼Œä¸Šæ¸¸ Producer ç«¯å¿…é¡»æœ‰ä¸€ä¸ªé™æµçš„ç­–ç•¥ï¼Œä¸”é™æ€é™æµæ˜¯ä¸å¯é çš„ï¼Œäºæ˜¯å°±éœ€è¦ä¸€ä¸ªåŠ¨æ€é™æµçš„ç­–ç•¥ã€‚å¯ä»¥é‡‡ç”¨ä¸‹å›¾åŠ¨æ€åé¦ˆæ‰€ç¤ºï¼š ä¸‹æ¸¸ Consumer ç«¯ä¼šé¢‘ç¹åœ°å‘ä¸Šæ¸¸ Producer ç«¯è¿›è¡ŒåŠ¨æ€åé¦ˆï¼Œå‘Šè¯‰ Producer ä¸‹æ¸¸ Consumer çš„è´Ÿè½½èƒ½åŠ›ï¼Œä»è€Œ Producer ç«¯åŠ¨æ€è°ƒæ•´å‘ä¸‹æ¸¸ Consumer å‘é€æ•°æ®çš„é€Ÿç‡å®ç° Producer ç«¯çš„åŠ¨æ€é™æµã€‚å½“ Consumer ç«¯å¤„ç†è¾ƒæ…¢æ—¶ï¼ŒConsumer å°†è´Ÿè½½åé¦ˆåˆ° Producer ç«¯ï¼ŒProducerç«¯ä¼šæ ¹æ®åé¦ˆé€‚å½“é™ä½ Producer è‡ªèº«ä»ä¸Šæ¸¸æˆ–è€… Source ç«¯è¯»æ•°æ®çš„é€Ÿç‡æ¥é™ä½å‘ä¸‹æ¸¸ Consumer å‘é€æ•°æ®çš„é€Ÿç‡ã€‚å½“ Consumer å¤„ç†è´Ÿè½½èƒ½åŠ›æå‡åï¼ŒåˆåŠæ—¶å‘ Producer ç«¯åé¦ˆï¼ŒProducer ä¼šé€šè¿‡æå‡ä»ä¸Šæ¸¸æˆ– Source ç«¯è¯»æ•°æ®çš„é€Ÿç‡æ¥æå‡å‘ä¸‹æ¸¸å‘é€æ•°æ®çš„é€Ÿç‡ã€‚é€šè¿‡è¿™ä¸ªåŠ¨æ€åé¦ˆæ¥æå‡æ•´ä¸ªç³»ç»Ÿçš„ååé‡ã€‚ è¡¥å……ä¸€ç‚¹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå‡å¦‚æˆ‘ä»¬çš„ Job åˆ†ä¸º Task Aã€Bã€Cï¼ŒTask A æ˜¯ Source Taskã€Task B å¤„ç†æ•°æ®ã€Task C æ˜¯ Sink Taskã€‚å‡å¦‚ Task C ç”±äºå„ç§åŸå› ååé‡é™ä½ï¼Œä¼šå°†è´Ÿè½½ä¿¡æ¯åé¦ˆç»™ Task Bï¼ŒTask B ä¼šé™ä½å‘ Task C å‘é€æ•°æ®çš„é€Ÿç‡ï¼Œæ­¤æ—¶å¦‚æœ Task B å¦‚æœè¿˜æ˜¯ä¸€ç›´ä» Task A è¯»å–æ•°æ®ï¼Œé‚£ä¹ˆæŒ‰ç…§åŒæ ·çš„é“ç†ï¼Œæ•°æ®ä¼šæŠŠ Task B çš„ Send Buffer å’Œ Receive Buffer æ’‘çˆ†ï¼Œåˆä¼šå‡ºç°ä¸Šé¢æè¿°çš„é—®é¢˜ã€‚æ‰€ä»¥ï¼Œå½“ Task B çš„ Send Buffer å’Œ Receive Buffer è¢«ç”¨å®Œåï¼ŒTask B ä¼šç”¨åŒæ ·çš„åŸç†å°†è´Ÿè½½ä¿¡æ¯åé¦ˆç»™ Task Aï¼ŒTask A æ”¶åˆ° Task B çš„è´Ÿè½½ä¿¡æ¯åï¼Œä¼šé™ä½ ç»™ Task B å‘é€æ•°æ®çš„é€Ÿç‡ï¼Œä»¥æ­¤ç±»æ¨ã€‚ ä¸Šé¢è¿™ä¸ªæµç¨‹ï¼Œå°±æ˜¯ Flink åŠ¨æ€é™æµï¼ˆåå‹æœºåˆ¶ï¼‰çš„ç®€å•æè¿°ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ° Flink çš„åå‹å…¶å®æ˜¯ä»ä¸‹æ¸¸å¾€ä¸Šæ¸¸ä¼ æ’­çš„ï¼Œä¸€ç›´å¾€ä¸Šä¼ æ’­åˆ° Source Task åï¼ŒSource Task æœ€ç»ˆä¼šé™ä½ä» Source ç«¯è¯»å–æ•°æ®çš„é€Ÿç‡ã€‚å¦‚æœä¸‹æ¸¸ Task C çš„è´Ÿè½½èƒ½åŠ›æå‡åï¼Œä¼šåŠæ—¶åé¦ˆç»™ Task Bï¼Œäºæ˜¯ Task B ä¼šæå‡å¾€ Task C å‘é€æ•°æ®çš„é€Ÿç‡ï¼ŒTask B åˆå°†è´Ÿè½½æå‡çš„ä¿¡æ¯åé¦ˆç»™ Task Aï¼ŒTask A å°±ä¼šæå‡ä» Source ç«¯è¯»å–æ•°æ®çš„é€Ÿç‡ï¼Œä»è€Œæå‡æ•´ä¸ªç³»ç»Ÿçš„è´Ÿè½½èƒ½åŠ›ã€‚ è¯»åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬åº”è¯¥çŸ¥é“ Flink ä¸ºä»€ä¹ˆéœ€è¦ä¸€ä¸ªç½‘ç»œæµæ§æœºåˆ¶äº†ï¼Œå¹¶ä¸”çŸ¥é“ Flink çš„ç½‘ç»œæµæ§æœºåˆ¶å¿…é¡»æ˜¯ä¸€ä¸ªåŠ¨æ€åé¦ˆçš„è¿‡ç¨‹ã€‚ä½†æ˜¯è¿˜æœ‰ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š æ•°æ®å…·ä½“æ˜¯æ€ä¹ˆä»ä¸Šæ¸¸ Producer ç«¯å‘é€åˆ°ä¸‹æ¸¸ Consumer ç«¯çš„ï¼Ÿ Flink çš„åŠ¨æ€é™æµå…·ä½“æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿä¸‹æ¸¸çš„è´Ÿè½½èƒ½åŠ›å’Œå‹åŠ›æ˜¯å¦‚ä½•ä¼ é€’ç»™ä¸Šæ¸¸çš„ï¼Ÿ æˆ‘ä»¬å¸¦ç€è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œå­¦ä¹ ä¸‹é¢çš„ Flink ç½‘ç»œæµæ§ä¸åå‹æœºåˆ¶ Flink V1.5 ç‰ˆä¹‹å‰ç½‘ç»œæµæ§ä»‹ç»åœ¨ Flink V1.5 ç‰ˆä¹‹å‰ï¼Œå…¶å® Flink å¹¶æ²¡æœ‰åˆ»æ„åšä¸Šè¿°æ‰€è¯´çš„åŠ¨æ€åé¦ˆã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæ²¡æœ‰åšä¸Šè¿°çš„åŠ¨æ€åé¦ˆæœºåˆ¶ï¼ŒFlink éš¾é“ä¸æ€•æ•°æ®ä¸¢å¤±æˆ–è€…ä¸Šæ¸¸å’Œä¸‹æ¸¸çš„ä¸€äº› Buffer æŠŠå†…å­˜æ’‘çˆ†å—ï¼Ÿå½“ç„¶ä¸æ€•äº†ï¼Œå› ä¸º Flink å·²ç»ä¾èµ–å…¶ä»–æœºåˆ¶æ¥å®ç°äº†æ‰€è°“çš„åŠ¨æ€åé¦ˆã€‚å…¶å®å¾ˆç®€å•ï¼Œè®©æˆ‘ä»¬ç»§ç»­å¾€ä¸‹çœ‹ã€‚ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¯¹äºä¸€ä¸ª Flink ä»»åŠ¡ï¼ŒåŠ¨æ€åé¦ˆå¯ä»¥æŠ½è±¡æˆä»¥ä¸‹ä¸¤ä¸ªé˜¶æ®µï¼š è·¨ Taskï¼ŒåŠ¨æ€åé¦ˆå¦‚ä½•ä»ä¸‹æ¸¸ Task çš„ Receive Buffer åé¦ˆç»™ä¸Šæ¸¸ Task çš„ Send Buffer å½“ä¸‹æ¸¸ Task C çš„ Receive Buffer æ»¡äº†ï¼Œå¦‚ä½•å‘Šè¯‰ä¸Šæ¸¸ Task B åº”è¯¥é™ä½æ•°æ®å‘é€é€Ÿç‡ å½“ä¸‹æ¸¸ Task C çš„ Receive Buffer ç©ºäº†ï¼Œå¦‚ä½•å‘Šè¯‰ä¸Šæ¸¸ Task B åº”è¯¥æå‡æ•°æ®å‘é€é€Ÿç‡ æ³¨ï¼šè¿™é‡Œåˆåˆ†äº†ä¸¤ç§æƒ…å†µï¼ŒTask B å’Œ Task C å¯èƒ½åœ¨åŒä¸€å°èŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œä¹Ÿæœ‰å¯èƒ½ä¸åœ¨åŒä¸€ä¸ªå°èŠ‚ç‚¹è¿è¡Œ Task B å’Œ Task C åœ¨åŒä¸€å°èŠ‚ç‚¹ä¸Šè¿è¡ŒæŒ‡çš„æ˜¯ï¼šä¸€å°èŠ‚ç‚¹è¿è¡Œäº†ä¸€ä¸ªæˆ–å¤šä¸ª TaskManagerï¼ŒåŒ…å«äº†å¤šä¸ª Slotï¼ŒTask B å’Œ Task C éƒ½è¿è¡Œåœ¨è¿™å°èŠ‚ç‚¹ä¸Šï¼Œä¸” Task B æ˜¯ Task C çš„ä¸Šæ¸¸ï¼Œç»™ Task C å‘é€æ•°æ®ã€‚æ­¤æ—¶ Task B ç»™ Task C å‘é€æ•°æ®å®é™…ä¸Šæ˜¯åŒä¸€ä¸ª JVM å†…çš„æ•°æ®å‘é€ï¼Œæ‰€ä»¥ä¸å­˜åœ¨ç½‘ç»œé€šä¿¡ Task B å’Œ Task C ä¸åœ¨åŒä¸€å°èŠ‚ç‚¹ä¸Šè¿è¡ŒæŒ‡çš„æ˜¯ï¼šTask B å’Œ Task C è¿è¡Œåœ¨ä¸åŒçš„ TaskManager ä¸­ï¼Œä¸” Task B æ˜¯ Task C çš„ä¸Šæ¸¸ï¼Œç»™ Task C å‘é€æ•°æ®ã€‚æ­¤æ—¶ Task B ç»™ Task C å‘é€æ•°æ®æ˜¯è·¨èŠ‚ç‚¹çš„ï¼Œæ‰€ä»¥ä¼šå­˜åœ¨ç½‘ç»œé€šä¿¡ Task å†…ï¼ŒåŠ¨æ€åé¦ˆå¦‚ä½•ä»å†…éƒ¨çš„ Send Buffer åé¦ˆç»™å†…éƒ¨çš„ Receive Buffer å½“ Task B çš„ Send Buffer æ»¡äº†ï¼Œå¦‚ä½•å‘Šè¯‰ Task B å†…éƒ¨çš„ Receive Buffer ä¸‹æ¸¸ Send Buffer æ»¡äº†ã€ä¸‹æ¸¸å¤„ç†æ€§èƒ½ä¸è¡Œäº†ï¼Ÿå› ä¸ºè¦è®© Task B çš„ Receive Buffer æ„Ÿå—åˆ°å‹åŠ›ï¼Œæ‰èƒ½æŠŠä¸‹æ¸¸çš„å‹åŠ›ä¼ é€’åˆ° Task A å½“ Task B çš„ Send Buffer ç©ºäº†ï¼Œå¦‚ä½•å‘Šè¯‰ Task B å†…éƒ¨çš„ Receive Buffer ä¸‹æ¸¸ Send Buffer ç©ºäº†ï¼Œä¸‹æ¸¸å¤„ç†æ€§èƒ½å¾ˆå¼ºï¼Œä¸Šæ¸¸åŠ å¿«å¤„ç†æ•°æ®å§ è·¨ TaskManagerï¼Œåå‹å¦‚ä½•å‘ä¸Šæ¸¸ä¼ æ’­å…ˆäº†è§£ä¸€ä¸‹ Flink çš„ TaskManager ä¹‹é—´ç½‘ç»œä¼ è¾“çš„æ•°æ®æµå‘ï¼š å›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° TaskManager A ç»™ TaskManager B å‘é€æ•°æ®ï¼ŒTaskManager A åšä¸º Producerï¼ŒTaskManager B åšä¸º Consumerã€‚Producer ç«¯çš„ Operator å®ä¾‹ä¼šäº§ç”Ÿæ•°æ®ï¼Œæœ€åé€šè¿‡ç½‘ç»œå‘é€ç»™ Consumer ç«¯çš„ Operator å®ä¾‹ã€‚Producer ç«¯ Operator å®ä¾‹ç”Ÿäº§çš„æ•°æ®é¦–å…ˆç¼“å­˜åˆ° TaskManager å†…éƒ¨çš„ NetWork Bufferã€‚NetWork ä¾èµ– Netty æ¥åšé€šä¿¡ï¼ŒProducer ç«¯çš„ Netty å†…éƒ¨æœ‰ ChannelOutbound Bufferï¼ŒConsumer ç«¯çš„ Netty å†…éƒ¨æœ‰ ChannelInbound Bufferã€‚Netty æœ€ç»ˆè¿˜æ˜¯è¦é€šè¿‡ Socket å‘é€ç½‘ç»œè¯·æ±‚ï¼ŒSocket è¿™ä¸€å±‚ä¹Ÿä¼šæœ‰ Bufferï¼ŒProducer ç«¯æœ‰ Send Bufferï¼ŒConsumer ç«¯æœ‰ Receive Bufferã€‚ æ€»ç»“ä¸€ä¸‹ï¼Œç°åœ¨æœ‰ä¸¤ä¸ª TaskManager Aã€Bï¼ŒTaskManager A ä¸­ Producer Operator å¤„ç†å®Œçš„æ•°æ®ç”± TaskManager B ä¸­ Consumer Operator å¤„ç†ã€‚é‚£ä¹ˆ Producer Operator å¤„ç†å®Œçš„æ•°æ®æ˜¯æ€ä¹ˆåˆ°è¾¾ Consumer Operator çš„ï¼Ÿé¦–å…ˆ Producer Operator ä»è‡ªå·±çš„ä¸Šæ¸¸æˆ–è€…å¤–éƒ¨æ•°æ®æºè¯»å–åˆ°æ•°æ®åï¼Œå¯¹ä¸€æ¡æ¡çš„æ•°æ®è¿›è¡Œå¤„ç†ï¼Œå¤„ç†å®Œçš„æ•°æ®é¦–å…ˆè¾“å‡ºåˆ° Producer Operator å¯¹åº”çš„ NetWork Buffer ä¸­ã€‚Buffer å†™æ»¡æˆ–è€…è¶…æ—¶åï¼Œå°±ä¼šè§¦å‘å°† NetWork Buffer ä¸­çš„æ•°æ®æ‹·è´åˆ° Producer ç«¯ Netty çš„ ChannelOutbound Bufferï¼Œä¹‹ååˆæŠŠæ•°æ®æ‹·è´åˆ° Socket çš„ Send Buffer ä¸­ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªä»ç”¨æˆ·æ€æ‹·è´åˆ°å†…æ ¸æ€çš„è¿‡ç¨‹ï¼Œæœ€åé€šè¿‡ Socket å‘é€ç½‘ç»œè¯·æ±‚ï¼ŒæŠŠ Send Buffer ä¸­çš„æ•°æ®å‘é€åˆ° Consumer ç«¯çš„ Receive Bufferã€‚æ•°æ®åˆ°è¾¾ Consumer ç«¯åï¼Œå†ä¾æ¬¡ä» Socket çš„ Receive Buffer æ‹·è´åˆ° Netty çš„ ChannelInbound Bufferï¼Œå†æ‹·è´åˆ° Consumer Operator çš„ NetWork Bufferï¼Œæœ€å Consumer Operator å°±å¯ä»¥è¯»åˆ°æ•°æ®è¿›è¡Œå¤„ç†äº†ã€‚è¿™å°±æ˜¯ä¸¤ä¸ª TaskManager ä¹‹é—´çš„æ•°æ®ä¼ è¾“è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å‘é€æ–¹å’Œæ¥æ”¶æ–¹å„æœ‰ä¸‰å±‚çš„ Bufferã€‚ äº†è§£äº†æ•°æ®ä¼ è¾“æµç¨‹ï¼Œæˆ‘ä»¬å†å…·ä½“äº†è§£ä¸€ä¸‹è·¨ TaskManager çš„åå‹è¿‡ç¨‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒProducer ç«¯ç”Ÿäº§æ•°æ®é€Ÿç‡ä¸º 2ï¼ŒConsumer æ¶ˆè´¹æ•°æ®é€Ÿç‡ä¸º 1ã€‚æŒç»­ä¸‹å»ï¼Œä¸‹æ¸¸æ¶ˆè´¹è¾ƒæ…¢ï¼ŒBuffer å®¹é‡åˆæ˜¯æœ‰é™çš„ï¼Œé‚£ Flink åå‹æ˜¯æ€ä¹ˆåšçš„ï¼Ÿ ä¸Šé¢ä»‹ç»åï¼Œæˆ‘ä»¬çŸ¥é“æ¯ä¸ª Operator è®¡ç®—æ•°æ®æ—¶ï¼Œè¾“å‡ºå’Œè¾“å…¥éƒ½æœ‰å¯¹åº”çš„ NetWork Bufferï¼Œè¿™ä¸ª NetWork Buffer å¯¹åº”åˆ° Flink å°±æ˜¯å›¾ä¸­æ‰€ç¤ºçš„ ResultSubPartition å’Œ InputChannelã€‚ResultSubPartition å’Œ InputChannel éƒ½æ˜¯å‘ LocalBufferPool ç”³è¯· Buffer ç©ºé—´ï¼Œç„¶å LocalBufferPool å†å‘ NetWork BufferPool ç”³è¯·å†…å­˜ç©ºé—´ã€‚è¿™é‡Œï¼ŒNetWork BufferPool æ˜¯ TaskManager å†…æ‰€æœ‰ Task å…±äº«çš„ BufferPoolï¼ŒTaskManager åˆå§‹åŒ–æ—¶å°±ä¼šå‘å †å¤–å†…å­˜ç”³è¯· NetWork BufferPoolã€‚LocalBufferPool æ˜¯æ¯ä¸ª Task è‡ªå·±çš„ BufferPoolï¼Œå‡å¦‚ä¸€ä¸ª TaskManager å†…è¿è¡Œç€ 5 ä¸ª Taskï¼Œé‚£ä¹ˆå°±ä¼šæœ‰ 5 ä¸ª LocalBufferPoolï¼Œä½† TaskManager å†…æ°¸è¿œåªæœ‰ä¸€ä¸ª NetWork BufferPoolã€‚Netty çš„ Buffer ä¹Ÿæ˜¯åˆå§‹åŒ–æ—¶ç›´æ¥å‘å †å¤–å†…å­˜ç”³è¯·å†…å­˜ç©ºé—´ã€‚è™½ç„¶å¯ä»¥ç”³è¯·ï¼Œä½†æ˜¯å¿…é¡»æ˜ç™½å†…å­˜ç”³è¯·è‚¯å®šæ˜¯æœ‰é™åˆ¶çš„ï¼Œä¸å¯èƒ½æ— é™åˆ¶çš„ç”³è¯·ï¼Œæˆ‘ä»¬åœ¨å¯åŠ¨ä»»åŠ¡æ—¶å¯ä»¥æŒ‡å®šè¯¥ä»»åŠ¡æœ€å¤šå¯èƒ½ç”³è¯·å¤šå¤§çš„å†…å­˜ç©ºé—´ç”¨äº NetWork Bufferã€‚ æˆ‘ä»¬ç»§ç»­åˆ†ææˆ‘ä»¬çš„åœºæ™¯ï¼Œ Producer ç«¯ç”Ÿäº§æ•°æ®é€Ÿç‡ä¸º2ï¼ŒConsumer ç«¯æ¶ˆè´¹æ•°æ®é€Ÿç‡ä¸º1ã€‚æ•°æ®ä» Task A çš„ ResultSubPartition æŒ‰ç…§ä¸Šé¢çš„æµç¨‹æœ€åä¼ è¾“åˆ° Task B çš„ InputChannel ä¾› Task B è¯»å–å¹¶è®¡ç®—ã€‚æŒç»­ä¸€æ®µæ—¶é—´åï¼Œç”±äº Task B æ¶ˆè´¹æ¯”è¾ƒæ…¢ï¼Œå¯¼è‡´ InputChannel è¢«å æ»¡äº†ï¼Œæ‰€ä»¥ InputChannel å‘ LocalBufferPool ç”³è¯·æ–°çš„ Buffer ç©ºé—´ï¼ŒLocalBufferPool åˆ†é…ç»™ InputChannel ä¸€äº› Bufferã€‚ å†æŒç»­ä¸€æ®µæ—¶é—´åï¼ŒInputChannel é‡å¤å‘ LocalBufferPool ç”³è¯· Buffer ç©ºé—´ï¼Œå¯¼è‡´ LocalBufferPool ä¹Ÿæ»¡äº†ï¼Œæ‰€ä»¥ LocalBufferPool å‘ NetWork BufferPool ç”³è¯· Buffer ç©ºé—´ï¼ŒNetWork BufferPool ç»™ LocalBufferPool åˆ†é… Bufferã€‚ å†æŒç»­ä¸‹å»ï¼ŒNetWork BufferPool æ»¡äº†ï¼Œæˆ–è€…è¯´ NetWork BufferPool ä¸èƒ½æŠŠè‡ªå·±çš„ Buffer å…¨åˆ†é…ç»™ Task B å¯¹åº”çš„ LocalBufferPool ï¼Œå› ä¸º TaskManager ä¸Šä¸€èˆ¬ä¼šè¿è¡Œäº†å¤šä¸ª Taskï¼Œæ¯ä¸ª Task åªèƒ½ä½¿ç”¨ NetWork BufferPool ä¸­çš„ä¸€éƒ¨åˆ†ã€‚æ‰€ä»¥ï¼Œå¯ä»¥è®¤ä¸º Task B æŠŠè‡ªå·±å¯ä»¥ä½¿ç”¨çš„ InputChannel ã€ LocalBufferPool å’Œ NetWork BufferPool éƒ½ç”¨å®Œäº†ã€‚æ­¤æ—¶ Netty è¿˜æƒ³æŠŠæ•°æ®å†™å…¥åˆ° InputChannelï¼Œä½†æ˜¯å‘ç° InputChannel æ»¡äº†ï¼Œæ‰€ä»¥ Socket å±‚ä¼šæŠŠ Netty çš„ autoRead disableï¼ŒNetty ä¸ä¼šå†ä» Socket ä¸­å»è¯»æ¶ˆæ¯ã€‚å¯ä»¥çœ‹åˆ°ä¸‹å›¾ä¸­å¤šä¸ª âŒï¼Œè¡¨ç¤º Buffer å·²æ»¡ï¼Œæ•°æ®å·²ç»ä¸èƒ½å¾€ä¸‹æ¸¸å†™äº†ï¼Œå‘ç”Ÿäº†é˜»å¡ã€‚ ç”±äº Netty ä¸ä» Socket çš„ Receive Buffer è¯»æ•°æ®äº†ï¼Œæ‰€ä»¥å¾ˆå¿« Socket çš„ Receive Buffer å°±ä¼šå˜æ»¡ï¼ŒTCP çš„ Socket é€šä¿¡æœ‰åŠ¨æ€åé¦ˆçš„æµæ§æœºåˆ¶ï¼Œä¼šæŠŠå®¹é‡ä¸º0çš„æ¶ˆæ¯åé¦ˆç»™ä¸Šæ¸¸å‘é€ç«¯ï¼Œæ‰€ä»¥ä¸Šæ¸¸çš„ Socket å°±ä¸ä¼šå¾€ä¸‹æ¸¸å†å‘é€æ•°æ® ã€‚ Task A æŒç»­ç”Ÿäº§æ•°æ®ï¼Œå‘é€ç«¯ Socket çš„ Send Buffer å¾ˆå¿«è¢«æ‰“æ»¡ï¼Œæ‰€ä»¥ Task A ç«¯çš„ Netty ä¹Ÿä¼šåœæ­¢å¾€ Socket å†™æ•°æ®ã€‚ æ¥ä¸‹æ¥ï¼Œæ•°æ®ä¼šåœ¨ Netty çš„ Buffer ä¸­ç¼“å­˜æ•°æ®ï¼Œä½† Netty çš„ Buffer æ˜¯æ— ç•Œçš„ã€‚ä½†å¯ä»¥è®¾ç½® Netty çš„é«˜æ°´ä½ï¼Œå³ï¼šè®¾ç½®ä¸€ä¸ª Netty ä¸­ Buffer çš„ä¸Šé™ã€‚æ‰€ä»¥æ¯æ¬¡ ResultSubPartition å‘ Netty ä¸­å†™æ•°æ®æ—¶ï¼Œéƒ½ä¼šæ£€æµ‹ Netty æ˜¯å¦å·²ç»åˆ°è¾¾é«˜æ°´ä½ï¼Œå¦‚æœè¾¾åˆ°é«˜æ°´ä½å°±ä¸ä¼šå†å¾€ Netty ä¸­å†™æ•°æ®ï¼Œé˜²æ­¢ Netty çš„ Buffer æ— é™åˆ¶çš„å¢é•¿ã€‚ æ¥ä¸‹æ¥ï¼Œæ•°æ®ä¼šåœ¨ Task A çš„ ResultSubPartition ä¸­ç´¯ç§¯ï¼ŒResultSubPartition æ»¡äº†åï¼Œä¼šå‘ LocalBufferPool ç”³è¯·æ–°çš„ Buffer ç©ºé—´ï¼ŒLocalBufferPool åˆ†é…ç»™ ResultSubPartition ä¸€äº› Bufferã€‚ æŒç»­ä¸‹å» LocalBufferPool ä¹Ÿä¼šç”¨å®Œï¼ŒLocalBufferPool å†å‘ NetWork BufferPool ç”³è¯· Bufferã€‚ ç„¶å NetWork BufferPool ä¹Ÿä¼šç”¨å®Œï¼Œæˆ–è€…è¯´ NetWork BufferPool ä¸èƒ½æŠŠè‡ªå·±çš„ Buffer å…¨åˆ†é…ç»™ Task A å¯¹åº”çš„ LocalBufferPool ï¼Œå› ä¸º TaskManager ä¸Šä¸€èˆ¬ä¼šè¿è¡Œäº†å¤šä¸ª Taskï¼Œæ¯ä¸ª Task åªèƒ½ä½¿ç”¨ NetWork BufferPool ä¸­çš„ä¸€éƒ¨åˆ†ã€‚æ­¤æ—¶ï¼ŒTask A å·²ç»ç”³è¯·ä¸åˆ°ä»»ä½•çš„ Buffer äº†ï¼ŒTask A çš„ Record Writer è¾“å‡ºå°±è¢« wait ï¼ŒTask A ä¸å†ç”Ÿäº§æ•°æ®ã€‚ é€šè¿‡ä¸Šè¿°çš„è¿™ä¸ªæµç¨‹ï¼Œæ¥åŠ¨æ€åé¦ˆï¼Œä¿éšœå„ä¸ª Buffer éƒ½ä¸ä¼šå› ä¸ºæ•°æ®å¤ªå¤šå¯¼è‡´å†…å­˜æº¢å‡ºã€‚ä¸Šé¢æè¿°äº†æ•´ä¸ªé˜»å¡çš„æµç¨‹ï¼Œå½“ä¸‹æ¸¸ Task B æŒç»­æ¶ˆè´¹ï¼ŒBuffer çš„å¯ç”¨å®¹é‡ä¼šå¢åŠ ï¼Œæ‰€æœ‰è¢«é˜»å¡çš„æ•°æ®é€šé“ä¼šè¢«ä¸€ä¸ªä¸ªæ‰“å¼€ï¼Œä¹‹å Task A åˆå¯ä»¥å¼€å§‹æ­£å¸¸çš„ç”Ÿäº§æ•°æ®äº†ã€‚ ä¹‹å‰ä»‹ç»ï¼ŒTask ä¹‹é—´çš„æ•°æ®ä¼ è¾“å¯èƒ½å­˜åœ¨ä¸Šæ¸¸çš„ Task A å’Œä¸‹æ¸¸çš„ Task B è¿è¡Œåœ¨åŒä¸€å°èŠ‚ç‚¹çš„æƒ…å†µï¼Œæ•´ä¸ªæµç¨‹ä¸ä¸Šè¿°ç±»ä¼¼ï¼Œåªä¸è¿‡ç”±äº Task A å’Œ B è¿è¡Œåœ¨åŒä¸€ä¸ª JVMï¼Œæ‰€ä»¥ä¸éœ€è¦ç½‘ç»œä¼ è¾“çš„ç¯èŠ‚ï¼ŒTask B çš„ InputChannel ä¼šç›´æ¥ä» Task A çš„ ResultSubPartition è¯»å–æ•°æ®ã€‚ Task å†…éƒ¨ï¼Œåå‹å¦‚ä½•å‘ä¸Šæ¸¸ä¼ æ’­å‡å¦‚ Task A çš„ä¸‹æ¸¸æ‰€æœ‰ Buffer éƒ½å æ»¡äº†ï¼Œé‚£ä¹ˆ Task A çš„ Record Writer ä¼šè¢« blockï¼ŒTask A çš„ Record Readerã€Operatorã€Record Writer éƒ½å±äºåŒä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰€ä»¥ Task A çš„ Record Reader ä¹Ÿä¼šè¢« blockã€‚ ç„¶åå¯ä»¥æŠŠè¿™é‡Œçš„ Task A ç±»æ¯”æˆä¸Šé¢æ‰€è¯´çš„ Task Bï¼ŒTask A ä¸Šæ¸¸æŒç»­é«˜é€Ÿç‡å‘é€æ•°æ®åˆ° Task A å°±ä¼šå¯¼è‡´å¯ç”¨çš„ InputChannelã€ LocalBufferPool å’Œ NetWork BufferPool éƒ½ä¼šè¢«ç”¨å®Œã€‚ç„¶å Netty ã€Socket åŒç†å°†å‹åŠ›ä¼ è¾“åˆ° Task A çš„ä¸Šæ¸¸ã€‚ å‡è®¾ Task A çš„ä¸Šæ¸¸æ˜¯ Task Xï¼Œé‚£ä¹ˆ Task A å°†å‹åŠ›åé¦ˆç»™ Task X çš„è¿‡ç¨‹ä¸ Task B å°†å‹åŠ›åé¦ˆç»™ Task A çš„è¿‡ç¨‹æ˜¯ä¸€æ ·çš„ã€‚æ•´ä¸ª Flink çš„åå‹æ˜¯ä»ä¸‹æ¸¸å¾€ä¸Šæ¸¸ä¼ æ’­çš„ï¼Œä¸€ç›´ä¼ æ’­åˆ° Source Taskï¼ŒSource Task æœ‰å‹åŠ›åï¼Œä¼šé™ä½ä»å¤–éƒ¨ç»„ä»¶ä¸­è¯»å–æ•°æ®çš„é€Ÿç‡ï¼Œä¾‹å¦‚ï¼šSource Task ä¼šé™ä½ä» Kafka ä¸­è¯»å–æ•°æ®çš„é€Ÿç‡ï¼Œæ¥é™ä½æ•´ä¸ª Flink Job ä¸­ç¼“å­˜çš„æ•°æ®ï¼Œä»è€Œé™ä½è´Ÿè½½ã€‚ æ‰€ä»¥å¾—å‡ºçš„ç»“è®ºæ˜¯ï¼šFlink 1.5ä¹‹å‰å¹¶æ²¡æœ‰ç‰¹æ®Šçš„æœºåˆ¶æ¥å¤„ç†åå‹ï¼Œå› ä¸º Flink ä¸­çš„æ•°æ®ä¼ è¾“ç›¸å½“äºå·²ç»æä¾›äº†åº”å¯¹åå‹çš„æœºåˆ¶ã€‚ Flink V1.5 ç‰ˆä¹‹å‰çš„åå‹ç­–ç•¥å­˜åœ¨çš„é—®é¢˜çœ‹ç€æŒºå®Œç¾çš„åå‹æœºåˆ¶ï¼Œå…¶å®æ˜¯æœ‰é—®é¢˜çš„ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬çš„ä»»åŠ¡æœ‰4ä¸ª SubTaskï¼ŒSubTask A æ˜¯ SubTask Bçš„ä¸Šæ¸¸ï¼Œå³ SubTask A ç»™ SubTask B å‘é€æ•°æ®ã€‚Job è¿è¡Œåœ¨ä¸¤ä¸ª TaskManagerä¸­ï¼Œ TaskManager 1 è¿è¡Œç€ SubTask A.1 å’Œ SubTask A.2ï¼Œ TaskManager 2 è¿è¡Œç€ SubTask B.3 å’Œ SubTask B.4ã€‚ç°åœ¨å‡å¦‚ç”±äºCPUå…±äº«æˆ–è€…å†…å­˜ç´§å¼ æˆ–è€…ç£ç›˜IOç“¶é¢ˆé€ æˆ SubTask B.4 é‡åˆ°ç“¶é¢ˆã€å¤„ç†é€Ÿç‡æœ‰æ‰€ä¸‹é™ï¼Œä½†æ˜¯ä¸Šæ¸¸æºæºä¸æ–­åœ°ç”Ÿäº§æ•°æ®ï¼Œæ‰€ä»¥å¯¼è‡´ SubTask A.2 ä¸ SubTask B.4 äº§ç”Ÿåå‹ã€‚ è¿™é‡Œéœ€è¦æ˜ç¡®ä¸€ç‚¹ï¼šä¸åŒ Job ä¹‹é—´çš„æ¯ä¸ªï¼ˆè¿œç¨‹ï¼‰ç½‘ç»œè¿æ¥å°†åœ¨ Flink çš„ç½‘ç»œå †æ ˆä¸­è·å¾—è‡ªå·±çš„TCPé€šé“ã€‚ ä½†æ˜¯ï¼Œå¦‚æœåŒä¸€ Task çš„ä¸åŒ SubTask è¢«å®‰æ’åˆ°åŒä¸€ä¸ªTaskManagerï¼Œåˆ™å®ƒä»¬ä¸å…¶ä»– TaskManager çš„ç½‘ç»œè¿æ¥å°†è¢«å¤šè·¯å¤ç”¨å¹¶å…±äº«ä¸€ä¸ªTCPä¿¡é“ä»¥å‡å°‘èµ„æºä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œå›¾ä¸­çš„ A.1 -&gt; B.3ã€A.1 -&gt; B.4ã€A.2 -&gt; B.3ã€A.2 -&gt; B.4 è¿™å››æ¡å°†ä¼šå¤šè·¯å¤ç”¨å…±äº«ä¸€ä¸ª TCP ä¿¡é“ã€‚ ç°åœ¨ SubTask B.3 å¹¶æ²¡æœ‰å‹åŠ›ï¼Œä»ä¸Šé¢è·¨ TaskManager çš„åå‹æµç¨‹ï¼Œæˆ‘ä»¬çŸ¥é“å½“ä¸Šå›¾ä¸­ SubTask A.2 ä¸ SubTask B.4 äº§ç”Ÿåå‹æ—¶ï¼Œä¼šæŠŠ TaskManager1 ç«¯è¯¥ä»»åŠ¡å¯¹åº” Socket çš„ Send Buffer å’Œ TaskManager2 ç«¯è¯¥ä»»åŠ¡å¯¹åº” Socket çš„ Receive Buffer å æ»¡ï¼Œå¤šè·¯å¤ç”¨çš„ TCP é€šé“å·²ç»è¢«å ä½äº†ï¼Œä¼šå¯¼è‡´ SubTask A.1 å’Œ SubTask A.2 è¦å‘é€ç»™ SubTask B.3 çš„æ•°æ®å…¨è¢«é˜»å¡äº†ï¼Œä»è€Œå¯¼è‡´æœ¬æ¥æ²¡æœ‰å‹åŠ›çš„ SubTask B.3 ç°åœ¨æ¥æ”¶ä¸åˆ°æ•°æ®äº†ã€‚æ‰€ä»¥ï¼ŒFlink 1.5 ç‰ˆä¹‹å‰çš„åå‹æœºåˆ¶ä¼šå­˜åœ¨å½“ä¸€ä¸ª Task å‡ºç°åå‹æ—¶ï¼Œå¯èƒ½å¯¼è‡´å…¶ä»–æ­£å¸¸çš„ Task æ¥æ”¶ä¸åˆ°æ•°æ®ã€‚ Creditçš„åå‹ç­–ç•¥å®ç°åŸç†Flink 1.5 ä¹‹åï¼Œä¸ºäº†è§£å†³ä¸Šè¿°æ‰€æè¿°çš„é—®é¢˜ï¼Œå¼•å…¥äº†åŸºäº Credit çš„åå‹æœºåˆ¶ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåå‹æœºåˆ¶ä½œç”¨äº Flink çš„åº”ç”¨å±‚ï¼Œå³åœ¨ ResultSubPartition å’Œ InputChannel è¿™ä¸€å±‚å¼•å…¥äº†åå‹æœºåˆ¶ã€‚æ¯æ¬¡ä¸Šæ¸¸ SubTask A.2 ç»™ä¸‹æ¸¸ SubTask B.4 å‘é€æ•°æ®æ—¶ï¼Œä¼šæŠŠ Buffer ä¸­çš„æ•°æ®å’Œä¸Šæ¸¸ ResultSubPartition å †ç§¯çš„æ•°æ®é‡ Backlog sizeå‘ç»™ä¸‹æ¸¸ï¼Œä¸‹æ¸¸ä¼šæ¥æ”¶ä¸Šæ¸¸å‘æ¥çš„æ•°æ®ï¼Œå¹¶å‘ä¸Šæ¸¸åé¦ˆç›®å‰ä¸‹æ¸¸ç°åœ¨çš„ Credit å€¼ï¼ŒCredit å€¼è¡¨ç¤ºç›®å‰ä¸‹æ¸¸å¯ä»¥æ¥æ”¶ä¸Šæ¸¸çš„ Buffer é‡ï¼Œ1 ä¸ªBuffer ç­‰ä»·äº 1 ä¸ª Credit ã€‚ ä¾‹å¦‚ï¼Œä¸Šæ¸¸ SubTask A.2 å‘é€å®Œæ•°æ®åï¼Œè¿˜æœ‰ 5 ä¸ª Buffer è¢«ç§¯å‹ï¼Œé‚£ä¹ˆä¼šæŠŠå‘é€æ•°æ®å’Œ Backlog size = 5 ä¸€å—å‘é€ç»™ä¸‹æ¸¸ SubTask B.4ï¼Œä¸‹æ¸¸æ¥å—åˆ°æ•°æ®åï¼ŒçŸ¥é“ä¸Šæ¸¸ç§¯å‹äº† 5 ä¸ªBufferï¼Œäºæ˜¯å‘ Buffer Pool ç”³è¯· Bufferï¼Œç”±äºå®¹é‡æœ‰é™ï¼Œä¸‹æ¸¸ InputChannel ç›®å‰ä»…æœ‰ 2 ä¸ª Buffer ç©ºé—´ï¼Œæ‰€ä»¥ï¼ŒSubTask B.4 ä¼šå‘ä¸Šæ¸¸ SubTask A.2 åé¦ˆ Channel Credit = 2ã€‚ç„¶åä¸Šæ¸¸ä¸‹ä¸€æ¬¡æœ€å¤šåªç»™ä¸‹æ¸¸å‘é€ 2 ä¸ª Buffer çš„æ•°æ®ï¼Œè¿™æ ·æ¯æ¬¡ä¸Šæ¸¸å‘é€çš„æ•°æ®éƒ½æ˜¯ä¸‹æ¸¸ InputChannel çš„ Buffer å¯ä»¥æ‰¿å—çš„æ•°æ®é‡ï¼Œæ‰€ä»¥é€šè¿‡è¿™ç§åé¦ˆç­–ç•¥ï¼Œä¿è¯äº†ä¸ä¼šåœ¨å…¬ç”¨çš„ Netty å’Œ TCP è¿™ä¸€å±‚æ•°æ®å †ç§¯è€Œå½±å“å…¶ä»– SubTask é€šä¿¡ã€‚ ResultSubPartition ä¼šæŠŠ buffer å’Œ backlog size åŒæ—¶å‘é€ç»™ä¸‹æ¸¸ï¼Œä¸‹æ¸¸å‘ä¸Šæ¸¸åé¦ˆ creditã€‚å†ç”¨ä¸€ä¸ªæ¡ˆä¾‹æ¥è¯¦ç»†åœ°æè¿°ä¸€ä¸‹æ•´ä¸ªè¿‡ç¨‹ã€‚ Task A å‘ Task B å‘é€äº†æ•°æ® å’Œ backlog size =3ï¼Œä¸‹æ¸¸ InputChannel æ¥å—å®Œ åï¼Œå‘ç°ä¸Šæ¸¸ç›®å‰ç§¯å‹äº† 3 æ¡æ•°æ®ï¼Œä½†æ˜¯è‡ªå·±çš„ç¼“å†²åŒºä¸å¤Ÿï¼Œäºæ˜¯å‘ LocalBufferPool ç”³è¯· buffer ç©ºé—´ï¼Œç”³è¯·æˆåŠŸåï¼Œå‘ä¸Šæ¸¸åé¦ˆ credit = 3ï¼Œè¡¨ç¤ºä¸‹æ¸¸ç›®å‰å¯ä»¥æ¥å— 3 æ¡è®°å½•ï¼ˆå®é™…ä¸Šæ˜¯ä»¥ Buffer ä¸ºå•ä½ï¼Œè€Œä¸æ˜¯è®°å½•æ•°ï¼ŒFlink å°†çœŸå®è®°å½•åºåˆ—åŒ–åçš„äºŒè¿›åˆ¶æ•°æ®æ”¾åˆ° Buffer ä¸­ï¼‰ï¼Œç„¶åä¸Šæ¸¸ä¸‹æ¬¡æœ€å¤šå‘é€ 3 æ¡æ•°æ®ç»™ä¸‹æ¸¸ã€‚ æŒç»­ä¸‹å»ï¼Œä¸Šæ¸¸ç”Ÿäº§æ•°æ®é€Ÿç‡æ¯”ä¸‹æ¸¸æ¶ˆè´¹é€Ÿç‡å¿«ï¼Œæ‰€ä»¥ LocalBufferPool å’Œ NetWork BufferPool éƒ½ä¼šè¢«ç”³è¯·å®Œï¼Œä¸‹æ¸¸çš„ InputChannel æ²¡æœ‰å¯ç”¨çš„ç¼“å†²åŒºäº†ï¼Œæ‰€ä»¥ä¼šå‘ä¸Šæ¸¸åé¦ˆ credit = 0ï¼Œç„¶åä¸Šæ¸¸å°±ä¸ä¼šå‘é€æ•°æ®åˆ° Nettyã€‚æ‰€ä»¥åŸºäº Credit çš„åå‹ç­–ç•¥ä¸ä¼šå¯¼è‡´ Netty å’Œ Socket çš„æ•°æ®ç§¯å‹ã€‚å½“ç„¶ä¸Šæ¸¸ä¹Ÿä¸ä¼šä¸€ç›´ä¸å‘é€æ•°æ®åˆ°ä¸‹æ¸¸ï¼Œä¸Šæ¸¸ä¼šå®šæœŸåœ°ä»…å‘é€ backlog size ç»™ä¸‹æ¸¸ï¼Œç›´åˆ°ä¸‹æ¸¸åé¦ˆ credit &gt; 0 æ—¶ï¼Œä¸Šæ¸¸å°±ä¼šç»§ç»­å‘é€çœŸæ­£çš„æ•°æ®åˆ°ä¸‹æ¸¸äº†ã€‚ åŸºäº Credit çš„åå‹æœºåˆ¶è¿˜å¸¦æ¥äº†ä¸€ä¸ªä¼˜åŠ¿ï¼šç”±äºæˆ‘ä»¬åœ¨å‘é€æ–¹å’Œæ¥æ”¶æ–¹ä¹‹é—´ç¼“å­˜è¾ƒå°‘çš„æ•°æ®ï¼Œå¯èƒ½ä¼šæ›´æ—©åœ°å°†åå‹åé¦ˆç»™ä¸Šæ¸¸ï¼Œç¼“å†²æ›´å¤šæ•°æ®åªæ˜¯æŠŠæ•°æ®ç¼“å†²åœ¨å†…å­˜ä¸­ï¼Œå¹¶æ²¡æœ‰æé«˜å¤„ç†æ€§èƒ½ã€‚ Flink å¦‚ä½•åœ¨ååé‡å’Œå»¶è¿Ÿä¹‹é—´åšæƒè¡¡ï¼ŸFlink å¤©ç„¶æ”¯æŒæµå¼å¤„ç†ï¼Œå³æ¯æ¥ä¸€æ¡æ•°æ®å°±èƒ½å¤„ç†ä¸€æ¡ï¼Œè€Œä¸æ˜¯åƒ Spark Streaming ä¸€æ ·ï¼Œå®Œå…¨æ˜¯å¾®æ‰¹å¤„ç†ã€‚ä½†æ˜¯ä¸ºäº†æé«˜ååé‡ï¼Œé»˜è®¤ä½¿ç”¨çš„ Flink å¹¶ä¸æ˜¯æ¯æ¥ä¸€æ¡æ•°æ®å°±å¤„ç†ä¸€æ¡ã€‚é‚£è¿™ä¸ªåˆ°åº•æ˜¯æ€ä¹ˆæ§åˆ¶çš„å‘¢ï¼Ÿ æˆ‘ä»¬åˆ†æäº†ä¸Šè¿°çš„ç½‘ç»œä¼ è¾“åï¼ŒçŸ¥é“æ¯ä¸ª SubTask è¾“å‡ºçš„æ•°æ®å¹¶ä¸æ˜¯ç›´æ¥è¾“å‡ºåˆ°ä¸‹æ¸¸ï¼Œè€Œæ˜¯åœ¨ ResultSubPartition ä¸­æœ‰ä¸€ä¸ª Buffer ç”¨æ¥ç¼“å­˜ä¸€æ‰¹æ•°æ®åï¼Œå† Flush åˆ° Netty å‘é€åˆ°ä¸‹æ¸¸ SubTaskã€‚é‚£åˆ°åº•å“ªäº›æƒ…å†µä¼šè§¦å‘ Buffer Flush åˆ° Netty å‘¢ï¼Ÿ Buffer å˜æ»¡æ—¶ Buffer timeout æ—¶ ç‰¹æ®Šäº‹ä»¶æ¥ä¸´æ—¶ï¼Œä¾‹å¦‚ï¼šCheckPoint çš„ barrier æ¥ä¸´æ—¶ Flink åœ¨æ•°æ®ä¼ è¾“æ—¶ï¼Œä¼šæŠŠæ•°æ®åºåˆ—åŒ–æˆäºŒè¿›åˆ¶ç„¶åå†™åˆ° Buffer ä¸­ï¼Œå½“ Buffer æ»¡äº†ï¼Œéœ€è¦ Flushï¼ˆé»˜è®¤ä¸º32KiBï¼Œé€šè¿‡taskmanager.memory.segment-sizeè®¾ç½®ï¼‰ã€‚ä½†æ˜¯å½“æµé‡ä½å³°æˆ–è€…æµ‹è¯•ç¯èŠ‚ï¼Œå¯èƒ½1åˆ†é’Ÿéƒ½æ²¡æœ‰ 32 KBçš„æ•°æ®ï¼Œå°±ä¼šå¯¼è‡´1åˆ†é’Ÿå†…çš„æ•°æ®éƒ½ç§¯æ”’åœ¨ Buffer ä¸­ä¸ä¼šå‘é€åˆ°ä¸‹æ¸¸ Task å»å¤„ç†ï¼Œä»è€Œå¯¼è‡´æ•°æ®å‡ºç°å»¶è¿Ÿï¼Œè¿™å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³çœ‹åˆ°çš„ã€‚æ‰€ä»¥ Flink æœ‰ä¸€ä¸ª Buffer timeout çš„ç­–ç•¥ï¼Œæ„æ€æ˜¯å½“æ•°æ®é‡æ¯”è¾ƒå°‘ï¼ŒBuffer ä¸€ç›´æ²¡æœ‰å˜æ»¡æ—¶ï¼Œåå°çš„ Output flusher çº¿ç¨‹ä¼šå¼ºåˆ¶åœ°å°† Buffer ä¸­çš„æ•°æ® Flush åˆ°ä¸‹æ¸¸ã€‚Flink ä¸­é»˜è®¤ timeout æ—¶é—´æ˜¯ 100msï¼Œå³ï¼šBuffer ä¸­çš„æ•°æ®è¦ä¹ˆå˜æ»¡æ—¶ Flushï¼Œè¦ä¹ˆæœ€å¤šç­‰ 100ms ä¹Ÿä¼š Flush æ¥ä¿è¯æ•°æ®ä¸ä¼šå‡ºç°å¾ˆå¤§çš„å»¶è¿Ÿã€‚å½“ç„¶è¿™ä¸ªå¯ä»¥é€šè¿‡ env.setBufferTimeout(timeoutMillis) æ¥æ§åˆ¶è¶…æ—¶æ—¶é—´ã€‚ timeoutMillis &gt; 0 è¡¨ç¤ºæœ€é•¿ç­‰å¾… timeoutMillis æ—¶é—´ï¼Œå°±ä¼šflush timeoutMillis = 0 è¡¨ç¤ºæ¯æ¡æ•°æ®éƒ½ä¼šè§¦å‘ flushï¼Œç›´æ¥å°†æ•°æ®å‘é€åˆ°ä¸‹æ¸¸ï¼Œç›¸å½“äºæ²¡æœ‰Bufferäº†(é¿å…è®¾ç½®ä¸º0ï¼Œå¯èƒ½å¯¼è‡´æ€§èƒ½ä¸‹é™) timeoutMillis = -1 è¡¨ç¤ºåªæœ‰ç­‰åˆ° bufferæ»¡äº†æˆ– CheckPointçš„æ—¶å€™ï¼Œæ‰ä¼šflushã€‚ç›¸å½“äºå–æ¶ˆäº† timeout ç­–ç•¥ ä¸¥æ ¼æ¥è®²ï¼ŒOutput flusher ä¸æä¾›ä»»ä½•ä¿è¯â€”â€”å®ƒåªå‘ Netty å‘é€é€šçŸ¥ï¼Œè€Œ Netty çº¿ç¨‹ä¼šæŒ‰ç…§èƒ½åŠ›ä¸æ„æ„¿è¿›è¡Œå¤„ç†ã€‚è¿™ä¹Ÿæ„å‘³ç€å¦‚æœå­˜åœ¨åå‹ï¼Œåˆ™ Output flusher æ˜¯æ— æ•ˆçš„ã€‚è¨€å¤–ä¹‹æ„ï¼Œå¦‚æœåå‹å¾ˆä¸¥é‡ï¼Œä¸‹æ¸¸ Buffer éƒ½æ»¡äº†ï¼Œå½“ç„¶ä¸èƒ½å¼ºåˆ¶ä¸€ç›´å¾€ä¸‹æ¸¸å‘æ•°æ®ã€‚ ä¸€äº›ç‰¹æ®Šçš„æ¶ˆæ¯å¦‚æœé€šè¿‡ RecordWriter å‘é€ï¼Œä¹Ÿä¼šè§¦å‘ç«‹å³ Flush ç¼“å­˜çš„æ•°æ®ã€‚å…¶ä¸­æœ€é‡è¦çš„æ¶ˆæ¯åŒ…æ‹¬ Checkpoint barrier ä»¥åŠ end-of-partition äº‹ä»¶ï¼Œè¿™äº›äº‹ä»¶åº”è¯¥å°½å¿«è¢«å‘é€ï¼Œè€Œä¸åº”è¯¥ç­‰å¾… Buffer è¢«å¡«æ»¡æˆ–è€… Output flusher çš„ä¸‹ä¸€æ¬¡ Flushã€‚å½“ç„¶å¦‚æœå‡ºç°åå‹ï¼ŒCheckPoint barrier ä¹Ÿä¼šç­‰å¾…ï¼Œä¸èƒ½å‘é€åˆ°ä¸‹æ¸¸ã€‚ å¼•å…¥ Network buffers ä»¥è·å¾—æ›´é«˜çš„èµ„æºåˆ©ç”¨ç‡å’Œæ›´é«˜çš„ååé‡ï¼Œä»£ä»·æ˜¯è®©ä¸€äº›è®°å½•åœ¨ Buffer ä¸­ç­‰å¾…ä¸€æ®µæ—¶é—´ã€‚è™½ç„¶å¯ä»¥é€šè¿‡ç¼“å†²åŒºè¶…æ—¶ç»™å‡ºæ­¤ç­‰å¾…æ—¶é—´çš„ä¸Šé™ï¼Œä½†ä½ å¯èƒ½çŸ¥é“æœ‰å…³è¿™ä¸¤ä¸ªç»´åº¦ï¼ˆå»¶è¿Ÿå’Œååé‡ï¼‰ä¹‹é—´æƒè¡¡çš„æ›´å¤šä¿¡æ¯ï¼šæ˜¾ç„¶ï¼Œæ— æ³•åŒæ—¶è·å¾—è¿™ä¸¤è€…ã€‚ä¸‹å›¾æ˜¯ Flink å®˜ç½‘çš„åšå®¢å±•ç¤ºçš„ä¸åŒçš„ buffer timeout ä¸‹å¯¹åº”çš„ååé‡ï¼Œä»0æ¯«ç§’å¼€å§‹ï¼ˆæ¯ä¸ªè®°å½•éƒ½ flushï¼‰åˆ°100æ¯«ç§’ï¼ˆé»˜è®¤å€¼ï¼‰ï¼Œæµ‹è¯•åœ¨å…·æœ‰ 100 ä¸ªèŠ‚ç‚¹æ¯ä¸ªèŠ‚ç‚¹ 8 ä¸ª Slot çš„ç¾¤é›†ä¸Šè¿è¡Œï¼Œæ¯ä¸ªèŠ‚ç‚¹è¿è¡Œæ²¡æœ‰ä¸šåŠ¡é€»è¾‘çš„ Taskï¼Œå› æ­¤åªç”¨äºæµ‹è¯•ç½‘ç»œåè®®æ ˆã€‚ä¸ºäº†è¿›è¡Œæ¯”è¾ƒï¼Œè¿˜æµ‹è¯•äº†ä½å»¶è¿Ÿæ”¹è¿›ä¹‹å‰çš„ Flink 1.4 ç‰ˆæœ¬ã€‚ å¦‚å›¾ï¼Œä½¿ç”¨ Flink 1.5+ï¼Œå³ä½¿æ˜¯éå¸¸ä½çš„ Buffer timeoutï¼ˆä¾‹å¦‚1msï¼Œå¯¹äºä½å»¶è¿Ÿåœºæ™¯ï¼‰ä¹Ÿæä¾›é«˜è¾¾è¶…æ—¶é»˜è®¤å‚æ•°ï¼ˆ100msï¼‰75ï¼… çš„æœ€å¤§ååï¼Œä½†ä¼šç¼“å­˜æ›´å°‘çš„æ•°æ®ã€‚ä½†æ˜¯ç¬”è€…ä»ç„¶ä¸ç†è§£ä¸ºä»€ä¹ˆ timeout è®¾ç½®ä¸º0æ—¶ï¼Œååé‡ç«Ÿç„¶èƒ½æ¯” Flink 1.4 çš„ååé‡æé«˜é‚£ä¹ˆå¤šã€‚Credit åªæ˜¯è§£å†³äº†åå‹çš„é—®é¢˜ï¼Œå¹¶ä¸èƒ½ä¼˜åŒ–ä½å»¶è¿Ÿçš„ååé‡ã€‚æ¨åè€å¸ˆçš„å›ç­”æ˜¯ç½‘ç»œåè®®æ ˆåšäº†å…¶ä»–ä¼˜åŒ–è€Œä¸”æ€§èƒ½æµ‹è¯•æ˜¯åœ¨ç‰¹å®šåœºæ™¯ä¸‹åšçš„ã€‚ç¬”è€…åç»­ä¼šç»§ç»­æ·±å…¥å­¦ä¹ ç ”ç©¶ Flink ç½‘ç»œé€šä¿¡æ¥è§£å†³ç¬”è€…ç›®å‰çš„ç–‘é—®ã€‚ æœ¬æ–‡ä½œè€…ï¼šèŒƒç£Š åŸæ–‡é“¾æ¥åœ°å€ï¼šhttps://www.jianshu.com/p/2779e73abcb8 å‚è€ƒæ–‡çŒ®Flinkå®˜ç½‘ flink-chinaç³»åˆ—è¯¾ç¨‹â€”-2.7 Flinkç½‘ç»œæµæ§åŠåå‹å‰–æ Flink å®˜ç½‘ä¸¤ç¯‡å…³äº Flink ç½‘ç»œåè®®æ ˆçš„åšå®¢: A Deep-Dive into Flinkâ€™s Network Stack Flink Network Stack Vol. 2: Monitoring, Metrics, and that Backpressure Thing å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ å¦å¤–ä½ å¦‚æœæ„Ÿå…´è¶£çš„è¯ï¼Œä¹Ÿå¯ä»¥å…³æ³¨æˆ‘çš„å…¬ä¼—å·ã€‚ ä¸“æ ä»‹ç»é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f Github ä»£ç ä»“åº“https://github.com/zhisheng17/flink-learning/ ä»¥åè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç éƒ½å°†æ”¾åœ¨è¿™ä¸ªä»“åº“é‡Œï¼ŒåŒ…å«äº†è‡ªå·±å­¦ä¹  flink çš„ä¸€äº› demo å’Œåšå®¢ã€‚ åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€åŸç†ã€å®æˆ˜ã€æ€§èƒ½è°ƒä¼˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"}]},{"title":"æ»´æ»´å®æ—¶è®¡ç®—å‘å±•ä¹‹è·¯åŠå¹³å°æ¶æ„å®è·µ","date":"2019-08-24T16:00:00.000Z","path":"2019/08/25/flink-didi/","text":"æ»´æ»´çš„æ ¸å¿ƒä¸šåŠ¡æ˜¯ä¸€ä¸ªå®æ—¶åœ¨çº¿æœåŠ¡ï¼Œå› æ­¤å…·æœ‰ä¸°å¯Œçš„å®æ—¶æ•°æ®å’Œå®æ—¶è®¡ç®—åœºæ™¯ã€‚æœ¬æ–‡å°†ä»‹ç»æ»´æ»´å®æ—¶è®¡ç®—å‘å±•ä¹‹è·¯ä»¥åŠå¹³å°æ¶æ„å®è·µã€‚ å®æ—¶è®¡ç®—æ¼”è¿›éšç€æ»´æ»´ä¸šåŠ¡çš„å‘å±•ï¼Œæ»´æ»´çš„å®æ—¶è®¡ç®—æ¶æ„ä¹Ÿåœ¨å¿«é€Ÿæ¼”å˜ã€‚åˆ°ç›®å‰ä¸ºæ­¢å¤§æ¦‚ç»å†äº†ä¸‰ä¸ªé˜¶æ®µï¼š ä¸šåŠ¡æ–¹è‡ªå»ºå°é›†ç¾¤é˜¶æ®µï¼› é›†ä¸­å¼å¤§é›†ç¾¤ã€å¹³å°åŒ–é˜¶æ®µï¼› SQLåŒ–é˜¶æ®µã€‚ ä¸‹å›¾æ ‡è¯†äº†å…¶ä¸­é‡è¦çš„é‡Œç¨‹ç¢‘ï¼Œç¨åä¼šç»™å‡ºè¯¦ç»†é˜è¿°ï¼š åœ¨2017å¹´ä»¥å‰ï¼Œæ»´æ»´å¹¶æ²¡æœ‰ç»Ÿä¸€çš„å®æ—¶è®¡ç®—å¹³å°ï¼Œè€Œæ˜¯å„ä¸ªä¸šåŠ¡æ–¹è‡ªå»ºå°é›†ç¾¤ã€‚å…¶ä¸­ç”¨åˆ°çš„å¼•æ“æœ‰Stormã€JStormã€Spark Streamingã€Samzaç­‰ã€‚ä¸šåŠ¡æ–¹è‡ªå»ºå°é›†ç¾¤æ¨¡å¼å­˜åœ¨å¦‚ä¸‹å¼Šç«¯ï¼š éœ€è¦é¢„å…ˆé‡‡è´­å¤§é‡æœºå™¨ï¼Œç”±äºå•ä¸ªä¸šåŠ¡ç‹¬å ï¼Œèµ„æºåˆ©ç”¨ç‡é€šå¸¸æ¯”è¾ƒä½ï¼› ç¼ºä¹æœ‰æ•ˆçš„ç›‘æ§æŠ¥è­¦ä½“ç³»ï¼› ç»´æŠ¤éš¾åº¦å¤§ï¼Œéœ€è¦ç‰µæ¶‰ä¸šåŠ¡æ–¹å¤§é‡ç²¾åŠ›æ¥ä¿éšœé›†ç¾¤çš„ç¨³å®šæ€§ï¼› ç¼ºä¹æœ‰æ•ˆæŠ€æœ¯æ”¯æŒï¼Œä¸”å„è‡ªæ²‰æ·€çš„ä¸œè¥¿éš¾ä»¥å…±äº«ã€‚ ä¸ºäº†æœ‰æ•ˆè§£å†³ä»¥ä¸Šé—®é¢˜ï¼Œæ»´æ»´ä»2017å¹´å¹´åˆå¼€å§‹æ„å»ºç»Ÿä¸€çš„å®æ—¶è®¡ç®—é›†ç¾¤åŠå¹³å°ã€‚ æŠ€æœ¯é€‰å‹ä¸Šï¼Œæˆ‘ä»¬åŸºäºæ»´æ»´ç°çŠ¶é€‰æ‹©äº†å†…éƒ¨ç”¨å¤§è§„æ¨¡æ•°æ®æ¸…æ´—çš„Spark Streamingå¼•æ“ï¼ŒåŒæ—¶å¼•å…¥On-YARNæ¨¡å¼ï¼Œå¹¶åˆ©ç”¨YARNçš„å¤šç§Ÿæˆ·ä½“ç³»æ„å»ºäº†è®¤è¯ã€é‰´æƒã€èµ„æºéš”ç¦»ã€è®¡è´¹ç­‰æœºåˆ¶ã€‚ ç›¸å¯¹äºç¦»çº¿è®¡ç®—ï¼Œå®æ—¶è®¡ç®—ä»»åŠ¡å¯¹äºç¨³å®šæ€§æœ‰ç€æ›´é«˜çš„è¦æ±‚ï¼Œä¸ºæ­¤æˆ‘ä»¬æ„å»ºäº†ä¸¤å±‚èµ„æºéš”ç¦»ä½“ç³»ï¼š ç¬¬ä¸€å±‚æ˜¯åŸºäºCGroupåšè¿›ç¨‹ï¼ˆContainerï¼‰çº§åˆ«çš„CPUåŠå†…å­˜éš”ç¦»ï¼› ç¬¬äºŒå±‚æ˜¯ç‰©ç†æœºå™¨çº§åˆ«çš„éš”ç¦»ã€‚ æˆ‘ä»¬é€šè¿‡æ”¹é€ YARNçš„FairSchedulerä½¿å…¶æ”¯æŒNode Labelã€‚è¾¾åˆ°çš„æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æ™®é€šä¸šåŠ¡çš„ä»»åŠ¡æ··è·‘åœ¨åŒä¸€ä¸ªLabelæœºå™¨ä¸Šï¼Œè€Œç‰¹æ®Šä¸šåŠ¡çš„ä»»åŠ¡è·‘åœ¨ä¸“ç”¨Labelçš„æœºå™¨ä¸Šã€‚ é€šè¿‡é›†ä¸­å¼å¤§é›†ç¾¤å’Œå¹³å°åŒ–å»ºè®¾ï¼ŒåŸºæœ¬æ¶ˆé™¤äº†ä¸šåŠ¡æ–¹è‡ªå»ºå°é›†ç¾¤å¸¦æ¥çš„å¼Šç«¯ï¼Œå®æ—¶è®¡ç®—ä¹Ÿè¿›å…¥äº†ç¬¬äºŒé˜¶æ®µã€‚ ä¼´éšç€ä¸šåŠ¡çš„å‘å±•ï¼Œæˆ‘ä»¬å‘ç°Spark Streamingçš„Micro Batchæ¨¡å¼åœ¨ä¸€äº›ä½å»¶æ—¶çš„æŠ¥è­¦ä¸šåŠ¡åŠåœ¨çº¿ä¸šåŠ¡ä¸Šæ˜¾å¾—æ‰è¥Ÿè§è‚˜ã€‚äºæ˜¯æˆ‘ä»¬å¼•å…¥äº†åŸºäºNative Streamingæ¨¡å¼çš„Flinkä½œä¸ºæ–°ä¸€ä»£å®æ—¶è®¡ç®—å¼•æ“ã€‚ Flinkä¸ä»…å»¶æ—¶å¯ä»¥åšåˆ°æ¯«ç§’çº§ï¼Œè€Œä¸”æä¾›äº†åŸºäºProcess Time/Event Timeä¸°å¯Œçš„çª—å£å‡½æ•°ã€‚åŸºäºFlinkæˆ‘ä»¬è”åˆä¸šåŠ¡æ–¹æ„æ¶äº†æ»´æ»´æµé‡æœ€å¤§çš„ä¸šåŠ¡ç½‘å…³ç›‘æ§ç³»ç»Ÿï¼Œå¹¶å¿«é€Ÿæ”¯æŒäº†è¯¸å¦‚ä¹˜å®¢ä½ç½®å˜åŒ–é€šçŸ¥ã€è½¨è¿¹å¼‚å¸¸æ£€æµ‹ç­‰å¤šä¸ªçº¿ä¸Šä¸šåŠ¡ã€‚ å®æ—¶è®¡ç®—å¹³å°æ¶æ„ä¸ºäº†æœ€å¤§ç¨‹åº¦æ–¹ä¾¿ä¸šåŠ¡æ–¹å¼€å‘å’Œç®¡ç†æµè®¡ç®—ä»»åŠ¡ï¼Œæˆ‘ä»¬æ„å»ºäº†å¦‚å›¾æ‰€ç¤ºçš„å®æ—¶è®¡ç®—å¹³å°ï¼š åœ¨æµè®¡ç®—å¼•æ“åŸºç¡€ä¸Šæä¾›äº†StreamSQL IDEã€ç›‘æ§æŠ¥è­¦ã€è¯Šæ–­ä½“ç³»ã€è¡€ç¼˜å…³ç³»ã€ä»»åŠ¡ç®¡æ§ç­‰èƒ½åŠ›ã€‚å„è‡ªçš„ä½œç”¨å¦‚ä¸‹ï¼š StreamSQL IDEã€‚ä¸‹æ–‡ä¼šä»‹ç»ï¼Œæ˜¯ä¸€ä¸ªWebåŒ–çš„SQL IDEï¼› ç›‘æ§æŠ¥è­¦ã€‚æä¾›ä»»åŠ¡çº§çš„å­˜æ´»ã€å»¶æ—¶ã€æµé‡ç­‰ç›‘æ§ä»¥åŠåŸºäºç›‘æ§çš„æŠ¥è­¦èƒ½åŠ›ï¼› è¯Šæ–­ä½“ç³»ã€‚åŒ…æ‹¬æµé‡æ›²çº¿ã€Checkpointã€GCã€èµ„æºä½¿ç”¨ç­‰æ›²çº¿è§†å›¾ï¼Œä»¥åŠå®æ—¶æ—¥å¿—æ£€ç´¢èƒ½åŠ›ã€‚ è¡€ç¼˜å…³ç³»ã€‚æˆ‘ä»¬åœ¨æµè®¡ç®—å¼•æ“ä¸­å†…ç½®äº†è¡€ç¼˜ä¸ŠæŠ¥èƒ½åŠ›ï¼Œè¿›è€Œåœ¨å¹³å°ä¸Šå‘ˆç°æµä»»åŠ¡ä¸ä¸Šä¸‹æ¸¸çš„è¡€ç¼˜å…³ç³»ï¼› ä»»åŠ¡ç®¡æ§ã€‚å®ç°äº†å¤šç§Ÿæˆ·ä½“ç³»ä¸‹ä»»åŠ¡æäº¤ã€å¯åœã€èµ„äº§ç®¡ç†ç­‰èƒ½åŠ›ã€‚é€šè¿‡WebåŒ–ä»»åŠ¡æäº¤æ¶ˆé™¤äº†ä¼ ç»Ÿå®¢æˆ·æœºæ¨¡å¼ï¼Œä½¿å¾—å¹³å°å…¥å£å®Œå…¨å¯æ§ï¼Œå†…ç½®å‚æ•°åŠç‰ˆæœ¬ä¼˜åŒ–å¾—ä»¥å¿«é€Ÿä¸Šçº¿ã€‚ å®æ—¶è§„åˆ™åŒ¹é…æœåŠ¡å»ºè®¾åœ¨æ»´æ»´å†…éƒ¨æœ‰å¤§é‡çš„å®æ—¶è¿è¥åœºæ™¯ï¼Œæ¯”å¦‚â€œæŸåŸå¸‚ä¹˜å®¢å†’æ³¡å10ç§’æ²¡æœ‰ä¸‹å•â€ã€‚é’ˆå¯¹è¿™ç±»æ£€æµ‹äº‹ä»¶ä¹‹é—´ä¾èµ–å…³ç³»çš„åœºæ™¯ï¼Œç”¨Finkçš„CEPæ˜¯éå¸¸åˆé€‚çš„ã€‚ ä½†æ˜¯ç¤¾åŒºç‰ˆæœ¬çš„CEPä¸æ”¯æŒæè¿°è¯­è¨€ï¼Œæ¯ä¸ªè§„åˆ™éœ€è¦å¼€å‘ä¸€ä¸ªåº”ç”¨ï¼ŒåŒæ—¶ä¸æ”¯æŒåŠ¨æ€æ›´æ–°è§„åˆ™ã€‚ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œæ»´æ»´åšäº†å¤§é‡åŠŸèƒ½æ‰©å±•åŠä¼˜åŒ–å·¥ä½œã€‚åŠŸèƒ½æ‰©å±•æ–¹é¢ä¸»è¦æ”¹åŠ¨æœ‰ï¼š æ”¯æŒwaitç®—å­ã€‚å¯¹äºåˆšæ‰ä¾‹å­ä¸­çš„è¿è¥è§„åˆ™ï¼Œç¤¾åŒºç‰ˆæœ¬æ˜¯è¡¨è¾¾ä¸äº†çš„ã€‚æ»´æ»´é€šè¿‡å¢åŠ waitç®—å­ï¼Œå®ç°äº†è¿™ç±»éœ€æ±‚ï¼› æ”¯æŒDSLè¯­è¨€ã€‚åŸºäºGroovyå’ŒAviatorè§£æå¼•æ“ï¼Œæˆ‘ä»¬å®ç°äº†å¦‚ä¸‹å›¾æ‰€ç¤ºçš„DSLæè¿°è§„åˆ™èƒ½åŠ›ï¼š å•ä»»åŠ¡å¤šè§„åˆ™åŠè§„åˆ™åŠ¨æ€æ›´æ–°ã€‚ç”±äºå®æ—¶è¿è¥è§„åˆ™ç”±ä¸€çº¿è¿è¥åŒå­¦æ¥é…ç½®ï¼Œæ‰€ä»¥è§„åˆ™æ•°é‡ï¼Œè§„åˆ™å†…å®¹åŠè§„åˆ™ç”Ÿå‘½å‘¨æœŸä¼šç»å¸¸å‘ç”Ÿå˜åŒ–ã€‚è¿™ç§æƒ…å†µæ¯ä¸ªè§„åˆ™ä¸€ä¸ªåº”ç”¨æ˜¯ä¸å¤ªç°å®çš„ã€‚ä¸ºæ­¤æˆ‘ä»¬å¼€å‘äº†å¤šè§„åˆ™æ¨¡å¼ä¸”æ”¯æŒäº†åŠ¨æ€æ›´æ–°ã€‚ é™¤äº†åŠŸèƒ½æ‹“å±•ä¹‹å¤–ï¼Œä¸ºäº†åº”å¯¹å¤§è§„æ¨¡è¿è¥è§„åˆ™çš„æŒ‘æˆ˜ï¼Œæ»´æ»´åœ¨CEPæ€§èƒ½ä¸Šä¹Ÿåšäº†å¤§é‡ä¼˜åŒ–ï¼Œä¸»è¦æœ‰ï¼š SharedBufferé‡æ„ã€‚åŸºäºFlink MapStateé‡æ„SharedBufferï¼Œå‡å°‘æ¯æ¬¡æ•°æ®å¤„ç†è¿‡ç¨‹ä¸­çš„çŠ¶æ€äº¤äº’ã€‚åŒæ—¶å‰¥ç¦»è§„åˆ™å’Œç”¨æˆ·æ•°æ®æå¤§é™ä½æ¯æ¬¡åŒ¹é…çš„æ—¶å€™ä»çŠ¶æ€ä¸­ååºåˆ—åŒ–çš„æ•°æ®é‡ï¼› å¢åŠ è®¿é—®ç¼“å­˜ï¼ˆå·²è´¡çŒ®ç¤¾åŒºï¼‰ã€‚ç¼“å­˜SharedBufferæ•°æ®ä¸­æ¯æ¬¡å¤„ç†æ‰€éœ€è¦æ›´æ–°çš„å¼•ç”¨è®¡æ•°ï¼Œå»¶ç¼“æ›´æ–°ï¼› ç®€åŒ–event timeè¯­ä¹‰å¤„ç†ã€‚é¿å…keyåœ¨å¾ˆåˆ†æ•£æƒ…å†µä¸‹æ¯æ¬¡watermarkæ›´æ–°æ—¶è¦éå†æ‰€æœ‰keyçš„æ•°æ®ï¼› å¤ç”¨conditionContextï¼ˆå·²è´¡çŒ®ç¤¾åŒºï¼‰ã€‚å‡å°‘æ¡ä»¶æŸ¥è¯¢æ—¶å¯¹partialMatchå…ƒç´ çš„åå¤æŸ¥è¯¢ã€‚ ä»¥ä¸Šä¼˜åŒ–å°†CEPæ€§èƒ½æå‡äº†å¤šä¸ªæ•°é‡çº§ã€‚é…åˆåŠŸèƒ½æ‰©å±•ï¼Œæˆ‘ä»¬åœ¨æ»´æ»´å†…éƒ¨æä¾›äº†å¦‚å›¾æ‰€ç¤ºçš„æœåŠ¡æ¨¡å¼ï¼š ä¸šåŠ¡æ–¹åªéœ€è¦æ¸…æ´—æ•°æ®å¹¶æä¾›è§„åˆ™åˆ—è¡¨APIå³å¯å…·å¤‡è´Ÿè´£è§„åˆ™çš„å®æ—¶åŒ¹é…èƒ½åŠ›ã€‚ ç›®å‰æ»´æ»´CEPå·²ç»åœ¨å¿«è½¦ä¸ªæ€§åŒ–è¿è¥ã€å®æ—¶å¼‚å¸¸å·¥å•æ£€æµ‹ç­‰ä¸šåŠ¡ä¸Šè½åœ°ï¼Œå–å¾—äº†è‰¯å¥½çš„æ•ˆæœã€‚ StreamSQLå»ºè®¾æ­£å¦‚ç¦»çº¿è®¡ç®—ä¸­Hiveä¹‹äºMapReduceä¸€æ ·ï¼Œæµå¼SQLä¹Ÿæ˜¯å¿…ç„¶çš„å‘å±•è¶‹åŠ¿ã€‚é€šè¿‡SQLåŒ–å¯ä»¥å¤§å¹…åº¦é™ä½ä¸šåŠ¡æ–¹å¼€å‘æµè®¡ç®—çš„éš¾åº¦ï¼Œä¸šåŠ¡æ–¹ä¸å†éœ€è¦å­¦ä¹ Java/Scalaï¼Œä¹Ÿä¸éœ€è¦ç†è§£å¼•æ“æ‰§è¡Œç»†èŠ‚åŠå„ç±»å‚æ•°è°ƒä¼˜ã€‚ ä¸ºæ­¤æˆ‘ä»¬åœ¨2018å¹´å¯åŠ¨äº†StreamSQLå»ºè®¾é¡¹ç›®ï¼Œåœ¨ç¤¾åŒºFlink SQLåŸºç¡€ä¸Šæ‹“å±•äº†ä»¥ä¸‹èƒ½åŠ›ï¼š æ‰©å±•DDLè¯­æ³•ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ‰“é€šäº†æ»´æ»´å†…éƒ¨ä¸»æµçš„æ¶ˆæ¯é˜Ÿåˆ—ä»¥åŠå®æ—¶å­˜å‚¨ç³»ç»Ÿ(StreamSQLå†…ç½®æ‰“é€šæ¶ˆæ¯é˜Ÿåˆ—åŠå®æ–½å­˜å‚¨)ï¼š é€šè¿‡å†…ç½®å¸¸è§æ¶ˆæ¯æ ¼å¼ï¼ˆå¦‚jsonã€binlogã€æ ‡å‡†æ—¥å¿—ï¼‰çš„è§£æèƒ½åŠ›ï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥è½»æ¾å†™å‡ºDDLè¯­æ³•ï¼Œå¹¶é¿å…é‡å¤å†™æ ¼å¼è§£æè¯­å¥ã€‚ æ‹“å±•UDFã€‚é’ˆå¯¹æ»´æ»´å†…éƒ¨å¸¸è§å¤„ç†é€»è¾‘ï¼Œå†…ç½®äº†å¤§é‡UDFï¼ŒåŒ…æ‹¬å­—ç¬¦ä¸²å¤„ç†ã€æ—¥æœŸå¤„ç†ã€Mapå¯¹è±¡å¤„ç†ã€ç©ºé—´ä½ç½®å¤„ç†ç­‰ã€‚ æ”¯æŒåˆ†æµè¯­æ³•ã€‚å•ä¸ªè¾“å…¥æºå¤šä¸ªè¾“å‡ºæµåœ¨æ»´æ»´å†…éƒ¨éå¸¸å¸¸è§ï¼Œä¸ºæ­¤æˆ‘ä»¬æ”¹é€ äº†Calciteä½¿å…¶æ”¯æŒåˆ†æµè¯­ä¹‰ã€‚ æ”¯æŒåŸºäºTTLçš„joinè¯­ä¹‰ã€‚ä¼ ç»Ÿçš„Window Joinå› ä¸ºå­˜åœ¨windowè¾¹ç•Œæ•°æ®çªå˜æƒ…å†µï¼Œä¸èƒ½æ»¡è¶³æ»´æ»´å†…éƒ¨çš„éœ€æ±‚ã€‚ä¸ºæ­¤æˆ‘ä»¬å¼•å…¥äº†TTL Stateï¼Œå¹¶åŸºäºæ­¤å¼€å‘äº†åŸºäºTTL Joinçš„åŒæµjoinä»¥åŠç»´è¡¨joinã€‚ StreamSQL IDEã€‚å‰æ–‡æåˆ°å¹³å°åŒ–ä¹‹åæˆ‘ä»¬æ²¡æœ‰æä¾›å®¢æˆ·æœºï¼Œè€Œæ˜¯é€šè¿‡Webæäº¤å’Œç®¡æ§ä»»åŠ¡ã€‚å› æ­¤æˆ‘ä»¬ä¹Ÿç›¸åº”å¼€å‘äº†StreamSQL IDEï¼Œå®ç°Webä¸Šå¼€å‘StreamSQLï¼ŒåŒæ—¶æä¾›äº†è¯­æ³•æ£€æµ‹ã€DEBUGã€è¯Šæ–­ç­‰èƒ½åŠ›ã€‚ ç›®å‰StreamSQLåœ¨æ»´æ»´å·²ç»æˆåŠŸè½åœ°ï¼Œæµè®¡ç®—å¼€å‘æˆæœ¬å¾—åˆ°å¤§å¹…åº¦é™ä½ã€‚é¢„æœŸæœªæ¥å°†æ‰¿æ‹…80%çš„æµè®¡ç®—ä¸šåŠ¡é‡ã€‚ æ€»ç»“ä½œä¸ºä¸€å®¶å‡ºè¡Œé¢†åŸŸçš„äº’è”ç½‘å…¬å¸ï¼Œæ»´æ»´å¯¹å®æ—¶è®¡ç®—æœ‰å¤©ç„¶çš„éœ€æ±‚ã€‚ è¿‡å»çš„ä¸€å¹´å¤šæ—¶é—´é‡Œï¼Œæˆ‘ä»¬ä»é›¶æ„å»ºäº†é›†ä¸­å¼å®æ—¶è®¡ç®—å¹³å°ï¼Œæ”¹å˜äº†ä¸šåŠ¡æ–¹è‡ªå»ºå°é›†ç¾¤çš„å±€é¢ã€‚ä¸ºæ»¡è¶³ä½å»¶æ—¶ä¸šåŠ¡çš„éœ€æ±‚ï¼ŒæˆåŠŸè½åœ°äº†Flink Streamingï¼Œå¹¶åŸºäºFlinkæ„å»ºäº†å®æ—¶è§„åˆ™åŒ¹é…ï¼ˆCEPï¼‰æœåŠ¡ä»¥åŠStreamSQLï¼Œä½¿å¾—æµè®¡ç®—å¼€å‘èƒ½åŠ›å¤§å¹…åº¦é™ä½ã€‚æœªæ¥å°†è¿›ä¸€æ­¥æ‹“å±•StreamSQLï¼Œå¹¶åœ¨æ‰¹æµç»Ÿä¸€ã€IoTã€å®æ—¶æœºå™¨å­¦ä¹ ç­‰é¢†åŸŸæ¢ç´¢å’Œå»ºè®¾ã€‚ å…³æ³¨æˆ‘å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ Github ä»£ç ä»“åº“https://github.com/zhisheng17/flink-learning/ ä»¥åè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç éƒ½å°†æ”¾åœ¨è¿™ä¸ªä»“åº“é‡Œï¼ŒåŒ…å«äº†è‡ªå·±å­¦ä¹  flink çš„ä¸€äº› demo å’Œåšå®¢ åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€åŸç†ã€å®æˆ˜ã€æ€§èƒ½è°ƒä¼˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ ä¸“æ ä»‹ç»é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"}]},{"title":"Flink Connector æ·±åº¦è§£æ","date":"2019-08-23T16:00:00.000Z","path":"2019/08/24/Flink-Connector/","text":"ä½œè€…ä»‹ç»ï¼šè‘£äº­äº­ï¼Œå¿«æ‰‹å¤§æ•°æ®æ¶æ„å®æ—¶è®¡ç®—å¼•æ“å›¢é˜Ÿè´Ÿè´£äººã€‚ç›®å‰è´Ÿè´£ Flink å¼•æ“åœ¨å¿«æ‰‹å†…çš„ç ”å‘ã€åº”ç”¨ä»¥åŠå‘¨è¾¹å­ç³»ç»Ÿå»ºè®¾ã€‚2013 å¹´æ¯•ä¸šäºå¤§è¿ç†å·¥å¤§å­¦ï¼Œæ›¾å°±èŒäºå¥‡è™ 360ã€58 é›†å›¢ã€‚ä¸»è¦ç ”ç©¶é¢†åŸŸåŒ…æ‹¬ï¼šåˆ†å¸ƒå¼è®¡ç®—ã€è°ƒåº¦ç³»ç»Ÿã€åˆ†å¸ƒå¼å­˜å‚¨ç­‰ç³»ç»Ÿã€‚ æœ¬æ–‡ä¸»è¦åˆ†äº«Flink connectorç›¸å…³å†…å®¹ï¼Œåˆ†ä¸ºä»¥ä¸‹ä¸‰ä¸ªéƒ¨åˆ†çš„å†…å®¹ï¼šç¬¬ä¸€éƒ¨åˆ†ä¼šé¦–å…ˆä»‹ç»ä¸€ä¸‹Flink Connectoræœ‰å“ªäº›ã€‚ç¬¬äºŒéƒ¨åˆ†ä¼šé‡ç‚¹ä»‹ç»åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç»å¸¸ä½¿ç”¨çš„kafka connectorçš„åŸºæœ¬çš„åŸç†ä»¥åŠä½¿ç”¨æ–¹æ³•ã€‚ç¬¬ä¸‰éƒ¨åˆ†ç­”ç–‘ç¯èŠ‚ï¼Œçœ‹å¤§å®¶æœ‰æ²¡æœ‰ä¸€äº›é—®é¢˜ã€‚ Flink Streaming ConnectorFlinkæ˜¯æ–°ä¸€ä»£æµæ‰¹ç»Ÿä¸€çš„è®¡ç®—å¼•æ“ï¼Œå®ƒéœ€è¦ä»ä¸åŒçš„ç¬¬ä¸‰æ–¹å­˜å‚¨å¼•æ“ä¸­æŠŠæ•°æ®è¯»è¿‡æ¥ï¼Œè¿›è¡Œå¤„ç†ï¼Œç„¶åå†å†™å‡ºåˆ°å¦å¤–çš„å­˜å‚¨å¼•æ“ä¸­ã€‚Connectorçš„ä½œç”¨å°±ç›¸å½“äºä¸€ä¸ªè¿æ¥å™¨ï¼Œè¿æ¥ Flink è®¡ç®—å¼•æ“è·Ÿå¤–ç•Œå­˜å‚¨ç³»ç»Ÿã€‚Flinké‡Œæœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼Œå½“ç„¶ä¹Ÿä¸é™äºè¿™å‡ ç§æ–¹å¼å¯ä»¥è·Ÿå¤–ç•Œè¿›è¡Œæ•°æ®äº¤æ¢ï¼šç¬¬ä¸€ç§ Flinké‡Œé¢é¢„å®šä¹‰äº†ä¸€äº›sourceå’Œsinkã€‚ç¬¬äºŒç§ FLinkå†…éƒ¨ä¹Ÿæä¾›äº†ä¸€äº›Boundled connectorsã€‚ç¬¬ä¸‰ç§ å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹apache Bahiré¡¹ç›®ä¸­æä¾›çš„è¿æ¥å™¨ã€‚ç¬¬å››ç§æ˜¯é€šè¿‡å¼‚æ­¥IOæ–¹å¼ã€‚ä¸‹é¢åˆ†åˆ«ç®€å•ä»‹ç»ä¸€ä¸‹è¿™å››ç§æ•°æ®è¯»å†™çš„æ–¹å¼ã€‚ é¢„å®šä¹‰çš„sourceå’ŒsinkFlinké‡Œé¢„å®šä¹‰äº†ä¸€éƒ¨åˆ†sourceå’Œsinkã€‚åœ¨è¿™é‡Œåˆ†äº†å‡ ç±»ã€‚ åŸºäºæ–‡ä»¶çš„sourceå’Œsinkã€‚ å¦‚æœè¦ä»æ–‡æœ¬æ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ env.readTextFile(path) å°±å¯ä»¥ä»¥æ–‡æœ¬çš„å½¢å¼è¯»å–è¯¥æ–‡ä»¶ä¸­çš„å†…å®¹ã€‚å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ env.readFile(fileInputFormat, path) æ ¹æ®æŒ‡å®šçš„fileInputFormatæ ¼å¼è¯»å–æ–‡ä»¶ä¸­çš„å†…å®¹ã€‚ å¦‚æœæ•°æ®åœ¨FLinkå†…è¿›è¡Œäº†ä¸€ç³»åˆ—çš„è®¡ç®—ï¼Œæƒ³æŠŠç»“æœå†™å‡ºåˆ°æ–‡ä»¶é‡Œï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨å†…éƒ¨é¢„å®šä¹‰çš„ä¸€äº›sinkï¼Œæ¯”å¦‚å°†ç»“æœå·²æ–‡æœ¬æˆ–csvæ ¼å¼å†™å‡ºåˆ°æ–‡ä»¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨DataStreamçš„writeAsText(path)å’Œ writeAsCsv(path)ã€‚ åŸºäºSocketçš„Sourceå’ŒSink æä¾›Socketçš„host nameåŠportï¼Œå¯ä»¥ç›´æ¥ç”¨StreamExecutionEnvironmenté¢„å®šçš„æ¥å£socketTextStreamåˆ›å»ºåŸºäºSocketçš„sourceï¼Œä»è¯¥socketä¸­ä»¥æ–‡æœ¬çš„å½¢å¼è¯»å–æ•°æ®ã€‚å½“ç„¶å¦‚æœæƒ³æŠŠç»“æœå†™å‡ºåˆ°å¦å¤–ä¸€ä¸ªSocketï¼Œä¹Ÿå¯ä»¥ç›´æ¥è°ƒç”¨DataStream writeToSocketã€‚ åŸºäºå†…å­˜ Collectionsã€Iterators çš„Sourceå¯ä»¥ç›´æ¥åŸºäºå†…å­˜ä¸­çš„é›†åˆæˆ–è€…è¿­ä»£å™¨ï¼Œè°ƒç”¨StreamExecutionEnvironment fromCollectionã€fromElementsæ„å»ºç›¸åº”çš„sourceã€‚ç»“æœæ•°æ®ä¹Ÿå¯ä»¥ç›´æ¥printã€printToErrorçš„æ–¹å¼å†™å‡ºåˆ°æ ‡å‡†è¾“å‡ºæˆ–æ ‡å‡†é”™è¯¯ã€‚ è¯¦ç»†ä¹Ÿå¯ä»¥å‚è€ƒFlinkæºç ä¸­æä¾›çš„ä¸€äº›ç›¸å¯¹åº”çš„Examplesæ¥æŸ¥çœ‹å¼‚å¸¸é¢„å®šä¹‰sourceå’Œsinkçš„ä½¿ç”¨æ–¹æ³•ï¼Œä¾‹å¦‚WordCountã€SocketWindowWordCountã€‚ Bundled ConnectorsFlinké‡Œå·²ç»æä¾›äº†ä¸€äº›ç»‘å®šçš„Connectorï¼Œä¾‹å¦‚kafka sourceå’Œsinkï¼ŒEs sinkç­‰ã€‚è¯»å†™kafkaã€esã€rabbitMQæ—¶å¯ä»¥ç›´æ¥ä½¿ç”¨ç›¸åº”connectorçš„apiå³å¯ã€‚ç¬¬äºŒéƒ¨åˆ†ä¼šè¯¦ç»†ä»‹ç»ç”Ÿäº§ç¯å¢ƒä¸­æœ€å¸¸ç”¨çš„kafka connectorã€‚ è™½ç„¶è¯¥éƒ¨åˆ†æ˜¯Flink é¡¹ç›®æºä»£ç é‡Œçš„ä¸€éƒ¨åˆ†ï¼Œä½†æ˜¯çœŸæ­£æ„ä¹‰ä¸Šä¸ç®—ä½œflinkå¼•æ“ç›¸å…³é€»è¾‘ï¼Œå¹¶ä¸”è¯¥éƒ¨åˆ†æ²¡æœ‰æ‰“åŒ…åœ¨äºŒè¿›åˆ¶çš„å‘å¸ƒåŒ…é‡Œé¢ã€‚æ‰€ä»¥åœ¨æäº¤Jobæ—¶å€™éœ€è¦æ³¨æ„ï¼Œjobä»£ç jaråŒ…ä¸­ä¸€å®šè¦å°†ç›¸åº”çš„connetorç›¸å…³ç±»æ‰“åŒ…è¿›å»ï¼Œå¦åˆ™åœ¨æäº¤ä½œä¸šæ—¶å°±ä¼šå¤±è´¥ï¼Œæç¤ºæ‰¾ä¸åˆ°ç›¸åº”çš„ç±»ï¼Œæˆ–åˆå§‹åŒ–æŸäº›ç±»å¼‚å¸¸ã€‚ Apache Bahirä¸­çš„è¿æ¥å™¨Apache Bahir æœ€åˆæ˜¯ä» Apache Spark ä¸­ç‹¬ç«‹å‡ºæ¥é¡¹ç›®æä¾›ï¼Œä»¥æä¾›ä¸é™äº Spark ç›¸å…³çš„æ‰©å±•/æ’ä»¶ã€è¿æ¥å™¨å’Œå…¶ä»–å¯æ’å…¥ç»„ä»¶çš„å®ç°ã€‚é€šè¿‡æä¾›å¤šæ ·åŒ–çš„æµè¿æ¥å™¨ï¼ˆstreaming connectorsï¼‰å’Œ SQL æ•°æ®æºæ‰©å±•åˆ†æå¹³å°çš„è¦†ç›–é¢ã€‚å¦‚æœ‰éœ€è¦å†™åˆ°flumeã€redisçš„éœ€æ±‚çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨è¯¥é¡¹ç›®æä¾›çš„connectorã€‚ Async I/Oæµè®¡ç®—ä¸­ç»å¸¸éœ€è¦ä¸å¤–éƒ¨å­˜å‚¨ç³»ç»Ÿäº¤äº’ï¼Œæ¯”å¦‚éœ€è¦å…³è”mysqlä¸­çš„æŸä¸ªè¡¨ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœç”¨åŒæ­¥I/Oçš„æ–¹å¼ï¼Œä¼šé€ æˆç³»ç»Ÿä¸­å‡ºç°å¤§çš„ç­‰å¾…æ—¶é—´ï¼Œå½±å“ååå’Œå»¶è¿Ÿã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¼‚æ­¥I/Oå¯ä»¥å¹¶å‘å¤„ç†å¤šä¸ªè¯·æ±‚ï¼Œæé«˜ååï¼Œå‡å°‘å»¶è¿Ÿã€‚ Asyncçš„åŸç†å¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š&lt;https://ci.apache.org/projects/flink/flink-docs-release-1.3/dev/stream/asyncio.html Flink Kafka Connectoræœ¬ç« é‡ç‚¹ä»‹ç»ç”Ÿäº§ç¯å¢ƒä¸­æœ€å¸¸ç”¨åˆ°çš„Flink kafka connectorã€‚ä½¿ç”¨flinkçš„åŒå­¦ï¼Œä¸€å®šä¼šå¾ˆç†Ÿæ‚‰kafkaï¼Œå®ƒæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„ã€åˆ†åŒºçš„ã€å¤šå‰¯æœ¬çš„ã€ æ”¯æŒé«˜ååçš„ã€å‘å¸ƒè®¢é˜…æ¶ˆæ¯ç³»ç»Ÿã€‚ç”Ÿäº§ç¯å¢ƒç¯å¢ƒä¸­ä¹Ÿç»å¸¸ä¼šè·Ÿkafkaè¿›è¡Œä¸€äº›æ•°æ®çš„äº¤æ¢ï¼Œæ¯”å¦‚åˆ©ç”¨kafka consumerè¯»å–æ•°æ®ï¼Œç„¶åè¿›è¡Œä¸€ç³»åˆ—çš„å¤„ç†ä¹‹åï¼Œå†å°†ç»“æœå†™å‡ºåˆ°kafkaä¸­ã€‚è¿™é‡Œä¼šä¸»è¦åˆ†ä¸¤ä¸ªéƒ¨åˆ†è¿›è¡Œä»‹ç»ï¼Œä¸€æ˜¯Flink kafka Consumerï¼Œä¸€ä¸ªæ˜¯Flink kafka Producerã€‚ é¦–å…ˆçœ‹ä¸€ä¸ªä¾‹å­æ¥ä¸²è”ä¸‹Flink kafka connectorã€‚ä»£ç é€»è¾‘é‡Œä¸»è¦æ˜¯ä»kafkaé‡Œè¯»æ•°æ®ï¼Œç„¶ååšç®€å•çš„å¤„ç†ï¼Œå†å†™å›åˆ°kafkaä¸­ã€‚ åˆ†åˆ«ç”¨çº¢è‰²æ¡† æ¡†å‡º å¦‚ä½•æ„é€ ä¸€ä¸ªSource sink Function. Flinkæä¾›äº†ç°æˆçš„æ„é€ FLinkKafkaConsumerã€Producerçš„æ¥å£ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œå› ä¸ºkafkaæœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œå¤šä¸ªç‰ˆæœ¬ä¹‹é—´çš„æ¥å£åè®®ä¼šä¸åŒã€‚Flinké’ˆå¯¹ä¸åŒç‰ˆæœ¬çš„kafkaæœ‰ç›¸åº”çš„ç‰ˆæœ¬çš„Consumerå’ŒProducerã€‚ä¾‹å¦‚ï¼šé’ˆå¯¹08ã€09ã€10ã€11ç‰ˆæœ¬ï¼ŒFlinkå¯¹åº”çš„consumeråˆ†åˆ«æ˜¯FlinkKafkaConsumer08ã€09ã€010ã€011ï¼Œproducerä¹Ÿæ˜¯ã€‚ Flink kafka Consumerååºåˆ—åŒ–æ•°æ®å› ä¸ºkafkaä¸­æ•°æ®éƒ½æ˜¯ä»¥äºŒè¿›åˆ¶byteå½¢å¼å­˜å‚¨çš„ã€‚è¯»åˆ°flinkç³»ç»Ÿä¸­ä¹‹åï¼Œéœ€è¦å°†äºŒè¿›åˆ¶æ•°æ®è½¬åŒ–ä¸ºå…·ä½“çš„javaã€scalaå¯¹è±¡ã€‚å…·ä½“éœ€è¦å®ç°ä¸€ä¸ªschemaç±»ï¼Œå®šä¹‰å¦‚ä½•åºåˆ—åŒ–å’Œååºåˆ—æ•°æ®ã€‚ååºåˆ—åŒ–æ—¶éœ€è¦å®ç°DeserializationSchemaæ¥å£ï¼Œå¹¶é‡å†™deserialize(byte[] message)å‡½æ•°ï¼Œå¦‚æœæ˜¯ååºåˆ—åŒ–kafkaä¸­kvçš„æ•°æ®æ—¶ï¼Œéœ€è¦å®ç°KeyedDeserializationSchemaæ¥å£ï¼Œå¹¶é‡å†™deserialize(byte[] messageKey, byte[] message, String topic, int partition, long offset)å‡½æ•°ã€‚ å¦å¤–Flinkä¸­ä¹Ÿæä¾›äº†ä¸€äº›å¸¸ç”¨çš„åºåˆ—åŒ–ååºåˆ—åŒ–çš„schemaç±»ã€‚ä¾‹å¦‚ï¼ŒSimpleStringSchemaï¼ŒæŒ‰å­—ç¬¦ä¸²æ–¹å¼è¿›è¡Œåºåˆ—åŒ–ã€ååºåˆ—åŒ–ã€‚TypeInformationSerializationSchemaï¼Œå®ƒå¯æ ¹æ®Flinkçš„TypeInformationä¿¡æ¯æ¥æ¨æ–­å‡ºéœ€è¦é€‰æ‹©çš„schemaã€‚JsonDeserializationSchema ä½¿ç”¨jacksonååºåˆ—åŒ–jsonæ ¼å¼æ¶ˆæ¯ï¼Œå¹¶è¿”å›ObjectNodeï¼Œå¯ä»¥ä½¿ç”¨.get(â€œpropertyâ€)æ–¹æ³•æ¥è®¿é—®ç›¸åº”å­—æ®µã€‚ æ¶ˆè´¹èµ·å§‹ä½ç½®è®¾ç½®å¦‚ä½•è®¾ç½®ä½œä¸šä»kafkaæ¶ˆè´¹æ•°æ®æœ€å¼€å§‹çš„èµ·å§‹ä½ç½®ï¼Œè¿™ä¸€éƒ¨åˆ†flinkä¹Ÿæä¾›äº†éå¸¸å¥½çš„å°è£…ã€‚åœ¨æ„é€ å¥½çš„FlinkKafkaConsumerç±»åé¢è°ƒç”¨å¦‚ä¸‹ç›¸åº”å‡½æ•°ï¼Œè®¾ç½®åˆé€‚çš„å…¶å®ä½ç½®ã€‚ setStartFromGroupOffsetsï¼Œä¹Ÿæ˜¯é»˜è®¤çš„ç­–ç•¥ï¼Œä»group offsetä½ç½®è¯»å–æ•°æ®ï¼Œgroup offsetæŒ‡çš„æ˜¯kafka brokerç«¯è®°å½•çš„æŸä¸ªgroupçš„æœ€åä¸€æ¬¡çš„æ¶ˆè´¹ä½ç½®ã€‚ä½†æ˜¯kafka brokerç«¯æ²¡æœ‰è¯¥groupä¿¡æ¯ï¼Œä¼šæ ¹æ®kafkaçš„å‚æ•°â€auto.offset.resetâ€çš„è®¾ç½®æ¥å†³å®šä»å“ªä¸ªä½ç½®å¼€å§‹æ¶ˆè´¹ã€‚ setStartFromEarliestï¼Œä»kafkaæœ€æ—©çš„ä½ç½®å¼€å§‹è¯»å–ã€‚ setStartFromLatestï¼Œä»kafkaæœ€æ–°çš„ä½ç½®å¼€å§‹è¯»å–ã€‚ setStartFromTimestamp(long)ï¼Œä»æ—¶é—´æˆ³å¤§äºæˆ–ç­‰äºæŒ‡å®šæ—¶é—´æˆ³çš„ä½ç½®å¼€å§‹è¯»å–ã€‚Kafkaæ—¶æˆ³ï¼Œæ˜¯æŒ‡kafkaä¸ºæ¯æ¡æ¶ˆæ¯å¢åŠ å¦ä¸€ä¸ªæ—¶æˆ³ã€‚è¯¥æ—¶æˆ³å¯ä»¥è¡¨ç¤ºæ¶ˆæ¯åœ¨proudcerç«¯ç”Ÿæˆæ—¶çš„æ—¶é—´ã€æˆ–è¿›å…¥åˆ°kafka brokeræ—¶çš„æ—¶é—´ã€‚ setStartFromSpecificOffsetsï¼Œä»æŒ‡å®šåˆ†åŒºçš„offsetä½ç½®å¼€å§‹è¯»å–ï¼Œå¦‚æŒ‡å®šçš„offsetsä¸­ä¸å­˜æŸä¸ªåˆ†åŒºï¼Œè¯¥åˆ†åŒºä»group offsetä½ç½®å¼€å§‹è¯»å–ã€‚æ­¤æ—¶éœ€è¦ç”¨æˆ·ç»™å®šä¸€ä¸ªå…·ä½“çš„åˆ†åŒºã€offsetçš„é›†åˆã€‚ ä¸€äº›å…·ä½“çš„ä½¿ç”¨æ–¹æ³•å¯ä»¥å‚è€ƒä¸‹å›¾ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå› ä¸ºflinkæ¡†æ¶æœ‰å®¹é”™æœºåˆ¶ï¼Œå¦‚æœä½œä¸šæ•…éšœï¼Œå¦‚æœä½œä¸šå¼€å¯checkpointï¼Œä¼šä»ä¸Šä¸€æ¬¡checkpointçŠ¶æ€å¼€å§‹æ¢å¤ã€‚æˆ–è€…åœ¨åœæ­¢ä½œä¸šçš„æ—¶å€™ä¸»åŠ¨åšsavepointï¼Œå¯åŠ¨ä½œä¸šæ—¶ä»savepointå¼€å§‹æ¢å¤ã€‚è¿™ä¸¤ç§æƒ…å†µä¸‹æ¢å¤ä½œä¸šæ—¶ï¼Œä½œä¸šæ¶ˆè´¹èµ·å§‹ä½ç½®æ˜¯ä»ä¹‹å‰ä¿å­˜çš„çŠ¶æ€ä¸­æ¢å¤ï¼Œä¸ä¸Šé¢æåˆ°è·Ÿkafkaè¿™äº›å•ç‹¬çš„é…ç½®æ— å…³ã€‚ topicå’ŒpartitionåŠ¨æ€å‘ç°å®é™…çš„ç”Ÿäº§ç¯å¢ƒä¸­å¯èƒ½æœ‰è¿™æ ·ä¸€äº›éœ€æ±‚ï¼Œæ¯”å¦‚åœºæ™¯ä¸€ï¼Œæœ‰ä¸€ä¸ªflinkä½œä¸šéœ€è¦å°†äº”ä»½æ•°æ®èšåˆåˆ°ä¸€èµ·ï¼Œäº”ä»½æ•°æ®å¯¹åº”äº”ä¸ªkafka topicï¼Œéšç€ä¸šåŠ¡å¢é•¿ï¼Œæ–°å¢ä¸€ç±»æ•°æ®ï¼ŒåŒæ—¶æ–°å¢äº†ä¸€ä¸ªkafka topicï¼Œå¦‚ä½•åœ¨ä¸é‡å¯ä½œä¸šçš„æƒ…å†µä¸‹ä½œä¸šè‡ªåŠ¨æ„ŸçŸ¥æ–°çš„topicã€‚åœºæ™¯äºŒï¼Œä½œä¸šä»ä¸€ä¸ªå›ºå®šçš„kafka topicè¯»æ•°æ®ï¼Œå¼€å§‹è¯¥topicæœ‰10ä¸ªpartitionï¼Œä½†éšç€ä¸šåŠ¡çš„å¢é•¿æ•°æ®é‡å˜å¤§ï¼Œéœ€è¦å¯¹kafka partitionä¸ªæ•°è¿›è¡Œæ‰©å®¹ï¼Œç”±10ä¸ªæ‰©å®¹åˆ°20ã€‚è¯¥æƒ…å†µä¸‹å¦‚ä½•åœ¨ä¸é‡å¯ä½œä¸šæƒ…å†µä¸‹åŠ¨æ€æ„ŸçŸ¥æ–°æ‰©å®¹çš„partitionï¼Ÿ é’ˆå¯¹ä¸Šé¢çš„ä¸¤ç§åœºæ™¯ï¼Œé¦–å…ˆéœ€è¦åœ¨æ„å»ºFlinkKafkaConsumeræ—¶çš„propertiesä¸­è®¾ç½®flink.partition-discovery.interval-milliså‚æ•°ä¸ºéè´Ÿå€¼ï¼Œè¡¨ç¤ºå¼€å¯åŠ¨æ€å‘ç°çš„å¼€å…³ï¼Œä»¥åŠè®¾ç½®çš„æ—¶é—´é—´éš”ã€‚æ­¤æ—¶FLinkKafkaConsumerå†…éƒ¨ä¼šå¯åŠ¨ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹å®šæœŸå»kafkaè·å–æœ€æ–°çš„metaä¿¡æ¯ã€‚é’ˆå¯¹åœºæ™¯ä¸€ï¼Œè¿˜éœ€åœ¨æ„å»ºFlinkKafkaConsumeræ—¶ï¼Œtopicçš„æè¿°å¯ä»¥ä¼ ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼æè¿°çš„patternã€‚æ¯æ¬¡è·å–æœ€æ–°kafka metaæ—¶è·å–æ­£åˆ™åŒ¹é…çš„æœ€æ–°topicåˆ—è¡¨ã€‚é’ˆå¯¹åœºæ™¯äºŒï¼Œè®¾ç½®å‰é¢çš„åŠ¨æ€å‘ç°å‚æ•°ï¼Œåœ¨å®šæœŸè·å–kafkaæœ€æ–°metaä¿¡æ¯æ—¶ä¼šåŒ¹é…æ–°çš„partitionã€‚ä¸ºäº†ä¿è¯æ•°æ®çš„æ­£ç¡®æ€§ï¼Œæ–°å‘ç°çš„partitionä»æœ€æ—©çš„ä½ç½®å¼€å§‹è¯»å–ã€‚ commit offsetæ–¹å¼Flink kafka consumer commit offsetæ–¹å¼éœ€è¦åŒºåˆ†æ˜¯å¦å¼€å¯äº†checkpointã€‚ å¦‚æœcheckpointå…³é—­ï¼Œcommit offsetè¦ä¾èµ–äºkafkaå®¢æˆ·ç«¯çš„auto commitã€‚éœ€è®¾ç½®enable.auto.commitï¼Œ auto.commit.interval.ms å‚æ•°åˆ°consumer propertiesï¼Œå°±ä¼šæŒ‰å›ºå®šçš„æ—¶é—´é—´éš”å®šæœŸauto commit offsetåˆ°kafkaã€‚ å¦‚æœå¼€å¯checkpointï¼Œè¿™ä¸ªæ—¶å€™ä½œä¸šæ¶ˆè´¹çš„offsetæ˜¯Flinkåœ¨stateä¸­è‡ªå·±ç®¡ç†å’Œå®¹é”™ã€‚æ­¤æ—¶æäº¤offsetåˆ°kafkaï¼Œä¸€èˆ¬éƒ½æ˜¯ä½œä¸ºå¤–éƒ¨è¿›åº¦çš„ç›‘æ§ï¼Œæƒ³å®æ—¶çŸ¥é“ä½œä¸šæ¶ˆè´¹çš„ä½ç½®å’Œlagæƒ…å†µã€‚æ­¤æ—¶éœ€è¦setCommitOffsetsOnCheckpointsä¸ºtrueæ¥è®¾ç½®å½“checkpointæˆåŠŸæ—¶æäº¤offsetåˆ°kafkaã€‚æ­¤æ—¶commit offsetçš„é—´éš”å°±å–å†³äºcheckpointçš„é—´éš”ï¼Œæ‰€ä»¥æ­¤æ—¶ä»kafkaä¸€ä¾§çœ‹åˆ°çš„lagå¯èƒ½å¹¶éå®Œå…¨å®æ—¶ï¼Œå¦‚æœcheckpointé—´éš”æ¯”è¾ƒé•¿lagæ›²çº¿å¯èƒ½ä¼šæ˜¯ä¸€ä¸ªé”¯é½¿çŠ¶ã€‚ Timestamp Extraction/Watermarkç”Ÿæˆæˆ‘ä»¬çŸ¥é“å½“flinkä½œä¸šå†…ä½¿ç”¨EventTimeå±æ€§æ—¶ï¼Œéœ€è¦æŒ‡å®šä»æ¶ˆæ¯ä¸­æå–æ—¶æˆ³å’Œç”Ÿæˆæ°´ä½çš„å‡½æ•°ã€‚FlinkKakfaConsumeræ„é€ çš„sourceåç›´æ¥è°ƒç”¨assignTimestampsAndWatermarkså‡½æ•°è®¾ç½®æ°´ä½ç”Ÿæˆå™¨çš„å¥½å¤„æ˜¯æ­¤æ—¶æ˜¯æ¯ä¸ªpartitionä¸€ä¸ªwatermark assignerï¼Œå¦‚ä¸‹å›¾ã€‚sourceç”Ÿæˆçš„ç¡æˆ³ä¸ºå¤šä¸ªpartitionæ—¶æˆ³å¯¹é½åçš„æœ€å°æ—¶æˆ³ã€‚æ­¤æ—¶åœ¨ä¸€ä¸ªsourceè¯»å–å¤šä¸ªpartitionï¼Œå¹¶ä¸”partitionä¹‹é—´æ•°æ®æ—¶æˆ³æœ‰ä¸€å®šå·®è·çš„æƒ…å†µä¸‹ï¼Œå› ä¸ºåœ¨sourceç«¯watermarkåœ¨partitionçº§åˆ«æœ‰å¯¹é½ï¼Œä¸ä¼šå¯¼è‡´æ•°æ®è¯»å–è¾ƒæ…¢partitionæ•°æ®ä¸¢å¤±ã€‚ Flink kafka ProducerProducer åˆ†åŒºä½¿ç”¨FlinkKafkaProducerå¾€kafkaä¸­å†™æ•°æ®æ—¶ï¼Œå¦‚æœä¸å•ç‹¬è®¾ç½®partitionç­–ç•¥ï¼Œä¼šé»˜è®¤ä½¿ç”¨FlinkFixedPartitionerï¼Œè¯¥partitioneråˆ†åŒºçš„æ–¹å¼æ˜¯taskæ‰€åœ¨çš„å¹¶å‘idå¯¹topic æ€»partitionæ•°å–ä½™ï¼šparallelInstanceId % partitions.lengthã€‚æ­¤æ—¶å¦‚æœsinkä¸º4ï¼Œparititionä¸º1ï¼Œåˆ™4ä¸ªtaskå¾€åŒä¸€ä¸ªpartitionä¸­å†™æ•°æ®ã€‚ä½†å½“sink task&lt; partition ä¸ªæ•°æ—¶ä¼šæœ‰éƒ¨åˆ†partitionæ²¡æœ‰æ•°æ®å†™å…¥ï¼Œä¾‹å¦‚sink taskä¸º2ï¼Œpartitionæ€»æ•°ä¸º4ï¼Œåˆ™åé¢ä¸¤ä¸ªpartitionå°†æ²¡æœ‰æ•°æ®å†™å…¥ã€‚å¦‚æœæ„å»ºFlinkKafkaProduceræ—¶ï¼Œpartitionè®¾ç½®ä¸ºnullï¼Œæ­¤æ—¶ä¼šä½¿ç”¨kafka produceré»˜è®¤åˆ†åŒºæ–¹å¼ï¼Œékeyå†™å…¥çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨round-robinçš„æ–¹å¼è¿›è¡Œåˆ†åŒºï¼Œæ¯ä¸ªtaskéƒ½ä¼šè½®è®­çš„å†™ä¸‹æ¸¸çš„æ‰€æœ‰partitionã€‚è¯¥æ–¹å¼ä¸‹æ¸¸çš„partitionæ•°æ®ä¼šæ¯”è¾ƒå‡è¡¡ï¼Œä½†æ˜¯ç¼ºç‚¹æ˜¯partitionä¸ªæ•°è¿‡å¤šçš„æƒ…å†µä¸‹ç»´æŒè¿‡å¤šçš„ç½‘ç»œé“¾æ¥ï¼Œå³æ¯ä¸ªtaskéƒ½ä¼šç»´æŒè·Ÿæ‰€æœ‰partitionæ‰€åœ¨brokerçš„é“¾æ¥ã€‚ å®¹é”™Flink kafka 09ã€010ç‰ˆæœ¬ä¸‹ï¼Œé€šè¿‡setLogFailuresOnlyä¸ºfalseï¼ŒsetFlushOnCheckpointä¸ºtrueï¼Œèƒ½è¾¾åˆ°at-least-onceè¯­ä¹‰ã€‚setLogFailuresOnlyï¼Œé»˜è®¤ä¸ºfalseï¼Œæ˜¯æ§åˆ¶å†™kafkaå¤±è´¥æ—¶ï¼Œæ˜¯å¦åªæ‰“å°å¤±è´¥çš„logä¸æŠ›å¼‚å¸¸è®©ä½œä¸šåœæ­¢ã€‚setFlushOnCheckpointï¼Œé»˜è®¤ä¸ºtrueï¼Œæ˜¯æ§åˆ¶æ˜¯å¦åœ¨checkpointæ—¶fluseæ•°æ®åˆ°kafkaï¼Œä¿è¯æ•°æ®å·²ç»å†™åˆ°kafkaã€‚å¦åˆ™æ•°æ®æœ‰å¯èƒ½è¿˜ç¼“å­˜åœ¨kafka å®¢æˆ·ç«¯çš„bufferä¸­ï¼Œå¹¶æ²¡æœ‰çœŸæ­£å†™å‡ºåˆ°kafkaï¼Œæ­¤æ—¶ä½œä¸šæŒ‚æ‰æ•°æ®å³ä¸¢å¤±ï¼Œä¸èƒ½åšåˆ°è‡³å°‘ä¸€æ¬¡çš„è¯­ä¹‰ã€‚ Flink kafka 011ç‰ˆæœ¬ä¸‹ï¼Œé€šè¿‡ä¸¤é˜¶æ®µæäº¤çš„sinkç»“åˆkafkaäº‹åŠ¡çš„åŠŸèƒ½ï¼Œå¯ä»¥ä¿è¯ç«¯åˆ°ç«¯ç²¾å‡†ä¸€æ¬¡ã€‚è¯¦ç»†åŸç†å¯ä»¥å‚è€ƒï¼šhttps://www.ververica.com/blog/end-to-end-exactly-once-processing-apache-flink-apache-kafkaã€‚ Q&amp;A(1)åœ¨flink consumerçš„å¹¶è¡Œåº¦çš„è®¾ç½®ï¼šæ˜¯å¯¹åº”topicçš„partitionsä¸ªæ•°å—ï¼Ÿè¦æ˜¯æœ‰å¤šä¸ªä¸»é¢˜æ•°æ®æºï¼Œå¹¶è¡Œåº¦æ˜¯è®¾ç½®æˆæ€»ä½“çš„partitionsæ•°å—ï¼Ÿç­”ï¼šè¿™ä¸ªå¹¶ä¸æ˜¯ç»å¯¹çš„ï¼Œè·Ÿtopicçš„æ•°æ®é‡ä¹Ÿæœ‰å…³ï¼Œå¦‚æœæ•°æ®é‡ä¸å¤§ï¼Œä¹Ÿå¯ä»¥è®¾ç½®å°äºpartitionsä¸ªæ•°çš„å¹¶å‘æ•°ã€‚ä½†ä¸è¦è®¾ç½®å¹¶å‘æ•°å¤§äºpartitionsæ€»æ•°ï¼Œå› ä¸ºè¿™ç§æƒ…å†µä¸‹æŸäº›å¹¶å‘å› ä¸ºåˆ†é…ä¸åˆ°partitionå¯¼è‡´æ²¡æœ‰æ•°æ®å¤„ç†ã€‚ (2)å¦‚æœ partitioner ä¼  null çš„æ—¶å€™æ˜¯ round-robin å‘åˆ°æ¯ä¸€ä¸ªpartitionï¼Ÿå¦‚æœæœ‰ key çš„æ—¶å€™è¡Œä¸ºæ˜¯ kafka é‚£ç§æŒ‰ç…§ key åˆ†å¸ƒåˆ°å…·ä½“åˆ†åŒºçš„è¡Œä¸ºå—ï¼Ÿç­”ï¼šå¦‚æœåœ¨æ„é€ FlinkKafkaProduceræ—¶ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®å•ç‹¬çš„partitionerï¼Œåˆ™é»˜è®¤ä½¿ç”¨FlinkFixedPartitionerï¼Œæ­¤æ—¶æ— è®ºæ˜¯å¸¦keyçš„æ•°æ®ï¼Œè¿˜æ˜¯ä¸å¸¦keyã€‚å¦‚æœä¸»åŠ¨è®¾ç½®partitionerä¸ºnullæ—¶ï¼Œä¸å¸¦keyçš„æ•°æ®ä¼šround-robinçš„æ–¹å¼å†™å‡ºï¼Œå¸¦keyçš„æ•°æ®ä¼šæ ¹æ®keyï¼Œç›¸åŒkeyæ•°æ®åˆ†åŒºçš„ç›¸åŒçš„partitionï¼Œå¦‚æœkeyä¸ºnullï¼Œå†è½®è¯¢å†™ã€‚ä¸å¸¦keyçš„æ•°æ®ä¼šè½®è¯¢å†™å„partitionã€‚ (3)å¦‚æœcheckpointæ—¶é—´è¿‡é•¿ï¼Œoffsetæœªæäº¤åˆ°kafkaï¼Œæ­¤æ—¶èŠ‚ç‚¹å®•æœºäº†ï¼Œé‡å¯ä¹‹åçš„é‡å¤æ¶ˆè´¹å¦‚ä½•ä¿è¯å‘¢ï¼Ÿé¦–å…ˆå¼€å¯checkpointæ—¶offsetæ˜¯flinké€šè¿‡çŠ¶æ€stateç®¡ç†å’Œæ¢å¤çš„ï¼Œå¹¶ä¸æ˜¯ä»kafkaçš„offsetä½ç½®æ¢å¤ã€‚åœ¨checkpointæœºåˆ¶ä¸‹ï¼Œä½œä¸šä»æœ€è¿‘ä¸€æ¬¡checkpointæ¢å¤ï¼Œæœ¬èº«æ˜¯ä¼šå›æ”¾éƒ¨åˆ†å†å²æ•°æ®ï¼Œå¯¼è‡´éƒ¨åˆ†æ•°æ®é‡å¤æ¶ˆè´¹ï¼ŒFlinkå¼•æ“ä»…ä¿è¯è®¡ç®—çŠ¶æ€çš„ç²¾å‡†ä¸€æ¬¡ï¼Œè¦æƒ³åšåˆ°ç«¯åˆ°ç«¯ç²¾å‡†ä¸€æ¬¡éœ€è¦ä¾èµ–ä¸€äº›å¹‚ç­‰çš„å­˜å‚¨ç³»ç»Ÿæˆ–è€…äº‹åŠ¡æ“ä½œã€‚ å…³æ³¨æˆ‘å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ Github ä»£ç ä»“åº“https://github.com/zhisheng17/flink-learning/ ä»¥åè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç éƒ½å°†æ”¾åœ¨è¿™ä¸ªä»“åº“é‡Œï¼ŒåŒ…å«äº†è‡ªå·±å­¦ä¹  flink çš„ä¸€äº› demo å’Œåšå®¢ åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€å®æˆ˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"}]},{"title":"å¦‚ä½•ä½¿ç”¨ Flink æ¯å¤©å®æ—¶å¤„ç†ç™¾äº¿æ¡æ—¥å¿—ï¼Ÿ","date":"2019-08-22T16:00:00.000Z","path":"2019/08/23/flink-ebay/","text":"Sherlock.IO æ˜¯ eBay ç°æœ‰çš„ç›‘æ§å¹³å°ï¼Œæ¯å¤©è¦å¤„ç†ä¸Šç™¾äº¿æ¡æ—¥å¿—ã€äº‹ä»¶å’ŒæŒ‡æ ‡ã€‚Flink Streaming job å®æ—¶å¤„ç†ç³»ç»Ÿç”¨äºå¤„ç†å…¶ä¸­çš„æ—¥å¿—å’Œäº‹ä»¶ã€‚ æœ¬æ–‡å°†ç»“åˆç›‘æ§ç³»ç»Ÿ Flink çš„ç°çŠ¶ï¼Œå…·ä½“è®²è¿° Flink åœ¨ç›‘æ§ç³»ç»Ÿä¸Šçš„å®è·µå’Œåº”ç”¨ï¼Œå¸Œæœ›ç»™åŒä¸šäººå‘˜ä¸€äº›å€Ÿé‰´å’Œå¯å‘ã€‚ ç›‘æ§ç³»ç»Ÿ Flink çš„ç°çŠ¶eBay çš„ç›‘æ§å¹³å° Sherlock.IO æ¯å¤©å¤„ç†ç€ä¸Šç™¾äº¿æ¡æ—¥å¿—ï¼ˆlogï¼‰ï¼Œäº‹ä»¶ï¼ˆeventï¼‰å’ŒæŒ‡æ ‡ï¼ˆmetricï¼‰ã€‚ é€šè¿‡æ„å»º Flink Streaming job å®æ—¶å¤„ç†ç³»ç»Ÿï¼Œç›‘æ§å›¢é˜Ÿèƒ½å¤ŸåŠæ—¶å°†æ—¥å¿—å’Œäº‹ä»¶çš„å¤„ç†ç»“æœåé¦ˆç»™ç”¨æˆ·ã€‚ å½“å‰ï¼Œç›‘æ§å›¢é˜Ÿç»´æŠ¤ç€ 8 ä¸ª Flink é›†ç¾¤ï¼Œæœ€å¤§çš„é›†ç¾¤è§„æ¨¡è¾¾åˆ°ä¸Šåƒä¸ª TaskManagerï¼Œæ€»å…±è¿è¡Œç€ä¸Šç™¾ä¸ªä½œä¸šï¼ˆjobï¼‰ï¼Œä¸€äº›ä½œä¸šå·²ç»ç¨³å®šè¿è¡Œäº†åŠå¹´ä»¥ä¸Šã€‚ å…ƒæ•°æ®é©±åŠ¨ä¸ºäº†è®©ç”¨æˆ·å’Œç®¡ç†å‘˜èƒ½å¤Ÿæ›´åŠ å¿«æ·åœ°åˆ›å»º Flink ä½œä¸šå¹¶è°ƒæ•´å‚æ•°ï¼Œç›‘æ§å›¢é˜Ÿåœ¨ Flink ä¸Šæ­å»ºäº†ä¸€å¥—å…ƒæ•°æ®å¾®æœåŠ¡ï¼ˆmetadata serviceï¼‰ã€‚ è¯¥æœåŠ¡èƒ½å¤Ÿç”¨ Json æ¥æè¿°ä¸€ä¸ªä½œä¸šçš„ DAGï¼Œä¸”ç›¸åŒçš„ DAG å…±ç”¨åŒä¸€ä¸ªä½œä¸šï¼Œèƒ½å¤Ÿæ›´åŠ æ–¹ä¾¿åœ°åˆ›å»ºä½œä¸šï¼Œæ— éœ€è°ƒç”¨ Flink APIã€‚ Sherlock.IO æµå¤„ç†æ•´ä½“çš„æ¶æ„å¦‚å›¾ 1 æ‰€ç¤ºï¼š ç›®å‰ï¼Œç”¨è¿™å¥—å…ƒæ•°æ®å¾®æœåŠ¡åˆ›å»ºçš„ä½œä¸šä»…æ”¯æŒä»¥ Kafka ä½œä¸ºæ•°æ®æºï¼Œåªè¦æ•°æ®æ¥å…¥åˆ° Kafkaï¼Œç”¨æˆ·å°±å¯ä»¥å®šä¹‰ Capability æ¥å¤„ç†é€»è¾‘ä»è€Œé€šè¿‡ Flink Streaming å¤„ç†æ•°æ®ã€‚ å…ƒæ•°æ®å¾®æœåŠ¡å…ƒæ•°æ®å¾®æœåŠ¡æ¡†æ¶å¦‚å›¾ 2 æ‰€ç¤ºï¼Œæœ€ä¸Šå±‚æ˜¯å…ƒæ•°æ®å¾®æœåŠ¡æä¾›çš„ Restful API, ç”¨æˆ·é€šè¿‡è°ƒç”¨ API æ¥æè¿°å’Œæäº¤ä½œä¸šã€‚ æè¿°ä½œä¸šçš„å…ƒæ•°æ®åŒ…å«ä¸‰ä¸ªéƒ¨åˆ†ï¼š Capability Policy Resource Flink é€‚é…å™¨ï¼ˆAdaptorï¼‰è¿æ¥äº† Flink Streaming API å’Œå…ƒæ•°æ®å¾®æœåŠ¡ APIï¼Œä¸”ä¼šæ ¹æ®å…ƒæ•°æ®å¾®æœåŠ¡æè¿°çš„ä½œä¸šè°ƒç”¨ Flink Streaming API æ¥åˆ›å»ºä½œä¸šï¼Œä»è€Œå±è”½ Flink Stream APIã€‚ å› æ­¤ï¼Œç”¨æˆ·ä¸ç”¨äº†è§£ Flink Streaming API å°±å¯ä»¥åˆ›å»º Flink ä½œä¸šã€‚æœªæ¥å¦‚æœéœ€è¦è¿ç§»åˆ°å…¶ä»–çš„æµå¤„ç†æ¡†æ¶ï¼Œåªè¦å¢åŠ ä¸€ä¸ªé€‚é…å™¨ï¼Œå°±å¯ä»¥å°†ç°æœ‰çš„ä½œä¸šè¿ç§»åˆ°æ–°çš„æµå¤„ç†æ¡†æ¶ä¸Šã€‚ â‘ Capability Capability å®šä¹‰äº†ä½œä¸šçš„ DAG ä»¥åŠæ¯ä¸ªç®—å­ï¼ˆOperatorï¼‰æ‰€ç”¨çš„ Classï¼Œå›¾ 3 æ˜¯äº‹ä»¶å¤„ç†ï¼ˆeventProcessï¼‰Capabilityï¼Œå®ƒæœ€ç»ˆä¼šç”Ÿæˆå¦‚å›¾ 4 çš„ DAGï¼š äº‹ä»¶å¤„ç† Capability å…ˆä» Kafka è¯»å‡ºæ•°æ®ï¼Œå†å†™åˆ° Elasticsearch ä¸­ã€‚ è¯¥ Capability å°†è¯¥ä½œä¸šå‘½åä¸ºâ€œeventProcessâ€ï¼Œå¹¶å®šä¹‰å…¶å¹¶è¡Œåº¦ä¸ºâ€œ5â€ï¼Œå…¶ç®—å­ä¸ºâ€œEventEsIndexSinkCapabilityâ€ï¼Œ å…¶æ•°æ®æµä¸ºâ€œSourceâ†’Sinkâ€ã€‚ â‘¡Policy æ¯ä¸ªå‘½åç©ºé—´ï¼ˆNamespaceï¼‰éœ€è¦å®šä¹‰ä¸€ä¸ªæˆ–å¤šä¸ª Policyï¼Œæ¯ä¸ª Policy æŒ‡å®šäº†ç›¸åº”çš„ Capabilityï¼Œå³æŒ‡å®šäº†ç”¨å“ªä¸€å¥— DAG æ¥è¿è¡Œè¿™ä¸ª Policyã€‚ Policy è¿˜å®šä¹‰äº†è¿™ä¸ªä½œä¸šçš„ç›¸å…³é…ç½®ï¼Œä¾‹å¦‚ä»å“ªä¸ª Kafka topic ä¸­è¯»å–æ•°æ®ï¼Œå†™åˆ° ElasticSearch çš„å“ªä¸ªç´¢å¼•ï¼ˆIndexï¼‰ä¸­ï¼Œä¸­é—´æ˜¯å¦è¦è·³è¿‡æŸäº›ç®—å­ç­‰ç­‰ã€‚ å…¶æ¬¡ï¼ŒPolicy è¿˜èƒ½ä½œä¸ºä¸€ä¸ªç®€æ˜“çš„è¿‡æ»¤å™¨ï¼ˆFilterï¼‰ï¼Œå¯ä»¥é€šè¿‡é…ç½® Jexl è¡¨è¾¾å¼è¿‡æ»¤æ‰ä¸€äº›ä¸éœ€è¦çš„æ•°æ®ï¼Œæé«˜ä½œä¸šçš„ååé‡ã€‚ å¦å¤–ï¼Œæˆ‘ä»¬è¿˜å®ç°äº† Zookeeper å®šæ—¶æ›´æ–°çš„æœºåˆ¶ï¼Œä½¿å¾— Policy ä¿®æ”¹åä¸å†éœ€è¦é‡å¯ä½œä¸šï¼Œåªè¦æ˜¯åœ¨æ›´æ–°æ—¶é—´é—´éš”å†…ï¼Œè¯¥å‘½åç©ºé—´çš„ Policy ä¿®æ”¹å°±ä¼šè¢«è‡ªåŠ¨åº”ç”¨åˆ°ä½œä¸šä¸Šã€‚ å›¾ 5 æ˜¯å‘½åç©ºé—´ä¸º paas çš„ Policy ç¤ºä¾‹ï¼š â‘¢Resource Resource å®šä¹‰äº†æŸä¸ªå‘½åç©ºé—´æ‰€éœ€è¦çš„èµ„æºï¼Œæ¯”å¦‚ Flink é›†ç¾¤ï¼Œ Kafka brokerï¼ŒES é›†ç¾¤ç­‰ç­‰ã€‚ æˆ‘ä»¬æœ‰å¤šä¸ª Flink é›†ç¾¤å’Œ ES é›†ç¾¤ï¼Œé€šè¿‡ Resource é…ç½®ï¼Œä½œä¸šå¯ä»¥çŸ¥é“æŸä¸ªå‘½åç©ºé—´çš„æ—¥å¿—åº”è¯¥å†™åˆ°å“ªä¸ª ES é›†ç¾¤ï¼Œå¹¶å¯ä»¥åˆ¤æ–­è¯¥å‘½åç©ºé—´çš„æ•°æ®åº”è¯¥ä»å“ªä¸ª Kafka é›†ç¾¤è¯»å–ã€‚ å…±äº«ä½œä¸šä¸ºäº†å‡å°‘ä½œä¸šæ•°é‡ï¼Œæˆ‘ä»¬å¯ä»¥è®©ç›¸åŒçš„ DAG å¤ç”¨åŒä¸€ä¸ªä½œä¸šã€‚æˆ‘ä»¬å…ˆç»™ä¸åŒçš„ Policy æŒ‡å®šç›¸åŒçš„ Capabilityï¼Œåœ¨è¯¥ Capability èµ„æºè¶³å¤Ÿçš„æƒ…å†µä¸‹ï¼Œè¿™äº› Policy å°±ä¼šè¢«è°ƒåº¦åˆ°åŒä¸€ä¸ªä½œä¸šä¸Šã€‚ ä»¥ SQL çš„ Capability ä¸ºä¾‹ï¼Œæ¯ä¸ª Policy çš„ SQL è¯­å¥ä¸å°½ç›¸åŒï¼Œå¦‚æœä¸ºæ¯ä¸ª Policy éƒ½åˆ›å»ºä¸€ä¸ªä½œä¸šï¼Œ Job Manager çš„å¼€é”€å°±ä¼šå¾ˆå¤§ï¼Œä¸”ä¸å¥½ç®¡ç†ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä¸º SQL Capability é…ç½® 20 ä¸ª Slotï¼Œæ¯ä¸ª Policy å ç”¨ä¸€ä¸ª Slotã€‚é‚£ä¹ˆè¯¥ Capability ç”Ÿæˆçš„ä½œä¸šå°±å¯ä»¥è¿è¡Œ 20 ä¸ª Policyã€‚ ä½œä¸šè¿è¡Œæ—¶ï¼Œä» Source è¯»è¿›æ¥çš„æ•°æ®ä¼šè¢«æ‰“ä¸Šç›¸åº” Policy çš„æ ‡ç­¾ï¼Œå¹¶æ‰§è¡Œè¯¥ Policy å®šä¹‰çš„ SQL è¯­å¥ï¼Œä»è€Œå®ç°ä¸åŒ Policy å…±äº«åŒä¸€ä¸ªä½œä¸šï¼Œå¤§å¤§å‡å°‘äº†ä½œä¸šçš„æ•°é‡ã€‚ ç”¨å…±äº«ä½œä¸šè¿˜æœ‰ä¸€ä¸ªå¥½å¤„ï¼šå¦‚æœå¤šä¸ªå‘½åç©ºé—´çš„æ•°æ®åœ¨ä¸€ä¸ª Kafka topic é‡Œï¼Œé‚£ä¹ˆåªè¦è¯»ä¸€éæ•°æ®å³å¯ï¼Œä¸ç”¨æ¯ä¸ªå‘½åç©ºé—´éƒ½è¯»ä¸€æ¬¡ topic å†è¿‡æ»¤ï¼Œè¿™æ ·å°±å¤§å¤§æé«˜äº†å¤„ç†çš„æ•ˆç‡ã€‚ Flink ä½œä¸šçš„ä¼˜åŒ–å’Œç›‘æ§äº†è§£å…ƒæ•°æ®é©±åŠ¨åï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹å¯ä»¥é€šè¿‡å“ªäº›æ–¹æ³•å®ç° Flink ä½œä¸šçš„ä¼˜åŒ–å’Œç›‘æ§ã€‚ Heartbeat åœ¨ Flink é›†ç¾¤çš„è¿ç»´è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¾ˆéš¾ç›‘æ§ä½œä¸šçš„è¿è¡Œæƒ…å†µã€‚å³ä½¿å¼€å¯äº†æ£€æŸ¥ç‚¹ï¼ˆcheckpointï¼‰ï¼Œæˆ‘ä»¬ä¹Ÿæ— æ³•ç¡®å®šæ˜¯å¦ä¸¢å¤±æ•°æ®æˆ–ä¸¢å¤±äº†å¤šå°‘æ•°æ®ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¸ºæ¯ä¸ªä½œä¸šæ³¨å…¥äº† Heartbeat ä»¥ç›‘æ§å…¶è¿è¡Œæƒ…å†µã€‚ Heartbeat å°±åƒ Flink ä¸­ç”¨æ¥ç›‘æ§å»¶è¿Ÿçš„â€œLatencyMarkerâ€ä¸€æ ·ï¼Œå®ƒä¼šæµè¿‡æ¯ä¸ªä½œä¸šçš„ç®¡é“ã€‚ ä½†ä¸ LatencyMarker ä¸åŒçš„æ˜¯ï¼Œå½“ Heartbeat é‡åˆ° DAG çš„åˆ†æ”¯æ—¶ï¼Œå®ƒä¼šåˆ†è£‚å¹¶æµå‘æ¯ä¸ªåˆ†æ”¯ï¼Œè€Œä¸åƒ LatencyMarker é‚£æ ·éšæœºæµå‘æŸä¸€ä¸ªåˆ†æ”¯ã€‚ å¦ä¸€ä¸ªä¸åŒç‚¹åœ¨äº Heartbeat ä¸æ˜¯ç”± Flink è‡ªèº«äº§ç”Ÿï¼Œè€Œæ˜¯ç”±å…ƒæ•°æ®å¾®æœåŠ¡å®šæ—¶äº§ç”Ÿï¼Œè€Œåç”±æ¯ä¸ªä½œä¸šæ¶ˆè´¹ã€‚ å¦‚ä¸Šæ–‡ä¸­å›¾ 4 æ‰€ç¤ºï¼Œæ¯ä¸ªä½œä¸šåœ¨å¯åŠ¨çš„æ—¶å€™ä¼šé»˜è®¤åŠ ä¸€ä¸ª Heartbeat çš„æ•°æ®æºã€‚ Heartbeat æµå…¥æ¯ä¸ªä½œä¸šåï¼Œä¼šéšæ•°æ®æµä¸€èµ·ç»è¿‡æ¯ä¸ªèŠ‚ç‚¹ï¼Œåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šæ‰“ä¸Šå½“å‰èŠ‚ç‚¹çš„æ ‡ç­¾ï¼Œç„¶åè·³è¿‡è¯¥èŠ‚ç‚¹çš„å¤„ç†é€»è¾‘æµå‘ä¸‹ä¸ªèŠ‚ç‚¹ã€‚ ç›´åˆ° Heartbeat æµåˆ°æœ€åä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼Œå®ƒä¼šä»¥æŒ‡æ ‡ï¼ˆMetricï¼‰çš„å½¢å¼å‘é€åˆ° Sherlock.IOï¼ˆeBay ç›‘æ§å¹³å°ï¼‰ã€‚ è¯¥æŒ‡æ ‡åŒ…å«äº† Heartbeat äº§ç”Ÿçš„æ—¶é—´ï¼Œæµå…¥ä½œä¸šçš„æ—¶é—´ä»¥åŠåˆ°è¾¾æ¯ä¸ªèŠ‚ç‚¹çš„æ—¶é—´ã€‚ é€šè¿‡è¿™ä¸ªæŒ‡æ ‡ï¼Œæˆ‘ä»¬å¯ä»¥åˆ¤æ–­è¯¥ä½œä¸šåœ¨è¯»å– Kafka æ—¶æ˜¯å¦å»¶æ—¶ï¼Œä»¥åŠä¸€æ¡æ•°æ®è¢«æ•´ä¸ªç®¡é“å¤„ç†æ‰€ç”¨çš„æ—¶é—´å’Œæ¯ä¸ªèŠ‚ç‚¹å¤„ç†æ•°æ®æ‰€ç”¨çš„æ—¶é—´ï¼Œè¿›è€Œåˆ¤æ–­è¯¥ä½œä¸šçš„æ€§èƒ½ç“¶é¢ˆã€‚ ç”±äº Heartbeat æ˜¯å®šæ—¶å‘é€çš„ï¼Œå› æ­¤æ¯ä¸ªä½œä¸šæ”¶åˆ°çš„ Heartbeat ä¸ªæ•°åº”è¯¥ä¸€è‡´ã€‚è‹¥æœ€åå‘å‡ºçš„æŒ‡æ ‡ä¸ªæ•°ä¸æœŸæœ›ä¸ä¸€è‡´ï¼Œåˆ™å¯ä»¥è¿›ä¸€æ­¥åˆ¤æ–­æ˜¯å¦æœ‰æ•°æ®ä¸¢å¤±ã€‚ å›¾ 6 æè¿°äº†æŸ Flink ä½œä¸šä¸­çš„æ•°æ®æµä»¥åŠ Heartbeat çš„è¿è¡ŒçŠ¶æ€ï¼š å¯ç”¨æ€§æœ‰äº† Heartbeatï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨æ¥å®šä¹‰é›†ç¾¤çš„å¯ç”¨æ€§ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å…ˆå®šä¹‰åœ¨ä»€ä¹ˆæƒ…å†µä¸‹å±äºä¸å¯ç”¨çš„ï¼š â‘ Flink ä½œä¸šé‡å¯ å½“å†…å­˜ä¸è¶³ï¼ˆOutofMemoryï¼‰æˆ–ä»£ç è¿è¡Œé”™è¯¯æ—¶ï¼Œä½œä¸šå°±å¯èƒ½ä¼šæ„å¤–é‡å¯ã€‚æˆ‘ä»¬è®¤ä¸ºé‡å¯è¿‡ç¨‹ä¸­é€ æˆçš„æ•°æ®ä¸¢å¤±æ˜¯ä¸å¯ç”¨çš„æƒ…å†µä¹‹ä¸€ã€‚å› æ­¤æˆ‘ä»¬çš„ç›®æ ‡ä¹‹ä¸€æ˜¯è®© Flink ä½œä¸šèƒ½å¤Ÿé•¿æ—¶é—´ç¨³å®šè¿è¡Œã€‚ â‘¡Flink ä½œä¸šä¸­æ­¢ æœ‰æ—¶å› ä¸ºåŸºç¡€è®¾æ–½çš„é—®é¢˜å¯¼è‡´ç‰©ç†æœºæˆ–è€…å®¹å™¨æ²¡å¯åŠ¨èµ·æ¥ï¼Œæˆ–æ˜¯åœ¨ Flink ä½œä¸šå‘ç”Ÿé‡å¯æ—¶ç”±äº Slot ä¸å¤Ÿè€Œæ— æ³•å¯åŠ¨ï¼Œæˆ–è€…æ˜¯å› ä¸º Flink ä½œä¸šçš„é‡å¯æ¬¡æ•°å·²ç»è¶…è¿‡äº†æœ€å¤§é‡å¯æ¬¡æ•°ï¼ˆrest.retry.max-attemptsï¼‰ï¼ŒFlink ä½œä¸šå°±ä¼šä¸­æ­¢ã€‚ æ­¤æ—¶éœ€è¦äººå·¥å¹²é¢„æ‰èƒ½å°†ä½œä¸šé‡æ–°å¯åŠ¨èµ·æ¥ã€‚æˆ‘ä»¬è®¤ä¸º Flink ä½œä¸šä¸­æ­¢æ—¶ï¼Œä¹Ÿæ˜¯ä¸å¯ç”¨çš„æƒ…å†µä¹‹ä¸€ã€‚ â‘£Flink ä½œä¸šåœ¨è¿è¡Œä¸­ä¸å†å¤„ç†æ•°æ® å‘ç”Ÿè¿™ç§æƒ…å†µï¼Œä¸€èˆ¬æ˜¯å› ä¸ºé‡åˆ°äº†åå‹ï¼ˆBackPressureï¼‰ã€‚é€ æˆåå‹çš„åŸå› æœ‰å¾ˆå¤šç§ï¼Œæ¯”å¦‚ä¸Šæ¸¸çš„æµé‡è¿‡å¤§ï¼Œæˆ–è€…æ˜¯ä¸­é—´æŸä¸ªç®—å­çš„å¤„ç†èƒ½åŠ›ä¸å¤Ÿï¼Œæˆ–è€…æ˜¯ä¸‹æ¸¸å­˜å‚¨èŠ‚ç‚¹é‡åˆ°æ€§èƒ½ç“¶é¢ˆç­‰ç­‰ã€‚ è™½ç„¶çŸ­æ—¶é—´å†…çš„åå‹ä¸ä¼šé€ æˆæ•°æ®ä¸¢å¤±ï¼Œä½†å®ƒä¼šå½±å“æ•°æ®çš„å®æ—¶æ€§ï¼Œæœ€æ˜æ˜¾çš„å˜åŒ–æ˜¯å»¶è¿Ÿè¿™ä¸ªæŒ‡æ ‡ä¼šå˜å¤§ã€‚ æˆ‘ä»¬è®¤ä¸ºåå‹å‘ç”Ÿæ—¶æ˜¯ä¸å¯ç”¨çš„æƒ…å†µä¹‹ä¸€ã€‚é’ˆå¯¹ä»¥ä¸Šä¸‰ç§æƒ…å†µï¼Œæˆ‘ä»¬éƒ½å¯ä»¥ç”¨ Heartbeat æ¥ç›‘æ§ï¼Œå¹¶è®¡ç®—å¯ç”¨æ€§ã€‚ æ¯”å¦‚ç¬¬ä¸€ç§æƒ…å†µï¼Œå¦‚æœä½œä¸šé‡å¯æ—¶å‘ç”Ÿäº†æ•°æ®ä¸¢å¤±ï¼Œé‚£ä¹ˆç›¸åº”çš„é‚£æ®µç®¡é“çš„ Heartbeat ä¹Ÿä¼šä¸¢å¤±ï¼Œä»è€Œæˆ‘ä»¬å¯ä»¥ç›‘æµ‹å‡ºæ˜¯å¦æœ‰æ•°æ®ä¸¢å¤±ä»¥åŠç²—ç²’åº¦åœ°ä¼°ç®—æ•°æ®ä¸¢äº†å¤šå°‘ã€‚ å¯¹äºç¬¬äºŒç§æƒ…å†µï¼Œå½“ä½œä¸šä¸­æ­¢æ—¶ï¼ŒHeartBeat ä¹Ÿä¸ä¼šè¢«å¤„ç†ï¼Œå› æ­¤å¯ä»¥å¾ˆå¿«å‘ç°ä½œä¸šåœæ­¢è¿è¡Œå¹¶è®© on-call åŠæ—¶å¹²é¢„ã€‚ ç¬¬ä¸‰ç§æƒ…å†µå½“åå‹å‘ç”Ÿæ—¶ï¼ŒHeartBeat ä¹Ÿä¼šè¢«é˜»å¡åœ¨å‘ç”Ÿåå‹çš„ä¸Šæ¸¸ï¼Œå› æ­¤ on-call ä¹Ÿå¯ä»¥å¾ˆå¿«åœ°å‘ç°åå‹å‘ç”Ÿå¹¶è¿›è¡Œäººå·¥å¹²é¢„ã€‚ ç»¼ä¸Šï¼ŒHeartbeat å¯ä»¥å¾ˆå¿«ç›‘æµ‹å‡º Flink ä½œä¸šçš„è¿è¡Œæƒ…å†µã€‚é‚£ä¹ˆï¼Œå¦‚ä½•è¯„ä¼°å¯ç”¨æ€§å‘¢ï¼Ÿ ç”±äº Heartbeat æ˜¯å®šæ—¶å‘ç”Ÿçš„ï¼Œé»˜è®¤æƒ…å†µä¸‹æˆ‘ä»¬è®¾ç½®æ¯ 10 ç§’å‘ä¸€æ¬¡ã€‚1 åˆ†é’Ÿå†…æˆ‘ä»¬æœŸæœ›æ¯ä¸ªä½œä¸šçš„æ¯æ¡ç®¡é“èƒ½å¤Ÿå‘å‡º 6 ä¸ªå¸¦æœ‰ä½œä¸šä¿¡æ¯çš„ Heartbeatï¼Œé‚£ä¹ˆæ¯å¤©å°±å¯ä»¥æ”¶åˆ° 8640 ä¸ª Heartbeatã€‚ å› æ­¤ï¼Œä¸€ä¸ªä½œä¸šçš„å¯ç”¨æ€§å¯ä»¥å®šä¹‰ä¸ºï¼š Flink ä½œä¸šéš”ç¦»Slot æ˜¯ Flink è¿è¡Œä½œä¸šçš„æœ€å°å•ä½[1]ï¼Œæ¯ä¸ª TaskManager å¯ä»¥åˆ†é…ä¸€ä¸ªè‡³å¤šä¸ª Slotï¼ˆä¸€èˆ¬åˆ†é…çš„ä¸ªæ•°ä¸ºè¯¥ TaskManager çš„ CPU æ•°ï¼‰ã€‚ æ ¹æ® Flink ä½œä¸šçš„å¹¶è¡Œåº¦ï¼Œä¸€ä¸ªä½œä¸šå¯ä»¥åˆ†é…åˆ°å¤šä¸ª TaskManager ä¸Šï¼Œè€Œä¸€ä¸ª TaskManager ä¹Ÿå¯èƒ½è¿è¡Œç€å¤šä¸ªä½œä¸šã€‚ ç„¶è€Œï¼Œä¸€ä¸ª TaskManager å°±æ˜¯ä¸€ä¸ª JVMï¼Œå½“å¤šä¸ªä½œä¸šåˆ†é…åˆ°ä¸€ä¸ª TaskManager ä¸Šæ—¶ï¼Œå°±ä¼šæœ‰æŠ¢å¤ºèµ„æºçš„æƒ…å†µå‘ç”Ÿã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä¸€ä¸ª TaskManager åˆ†é…äº† 3 ä¸ª Slotï¼ˆ3 ä¸ª CPUï¼‰å’Œ 8G å †å†…å­˜ã€‚ å½“ JobManager è°ƒåº¦ä½œä¸šçš„æ—¶å€™ï¼Œæœ‰å¯èƒ½å°† 3 ä¸ªä¸åŒä½œä¸šçš„çº¿ç¨‹è°ƒåº¦åˆ°è¯¥ TaskManager ä¸Šï¼Œé‚£ä¹ˆè¿™ 3 ä¸ªä½œä¸šå°±ä¼šåŒæ—¶æŠ¢å¤º CPU å’Œå†…å­˜çš„èµ„æºã€‚å½“å…¶ä¸­ä¸€ä¸ªä½œä¸šç‰¹åˆ«è€— CPU æˆ–å†…å­˜çš„æ—¶å€™ï¼Œå°±ä¼šå½±å“å…¶ä»–ä¸¤ä¸ªä½œä¸šã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬é€šè¿‡é…ç½® Flink å¯ä»¥å®ç°ä½œä¸šçš„éš”ç¦»ï¼Œå¦‚å›¾ 7 æ‰€ç¤ºï¼š é€šè¿‡ä»¥ä¸Šé…ç½®ï¼Œå¯ä»¥é™å®šæ¯ä¸ª TaskManager ç‹¬å  CPU å’Œå†…å­˜çš„èµ„æºï¼Œä¸”ä¸ä¼šå¤šä¸ªä½œä¸šæŠ¢å ï¼Œå®ç°ä½œä¸šä¹‹é—´çš„éš”ç¦»ã€‚ åå‹æˆ‘ä»¬è¿ç»´ Flink é›†ç¾¤çš„æ—¶å€™å‘ç°ï¼Œå‡ºç°æœ€å¤šçš„é—®é¢˜å°±æ˜¯åå‹ã€‚åœ¨ 3.2 ä¸­æåˆ°è¿‡ï¼Œå‘ç”Ÿåå‹çš„åŸå› æœ‰å¾ˆå¤šç§ï¼Œä½†æ— è®ºä»€ä¹ˆåŸå› ï¼Œæ•°æ®æœ€ç»ˆéƒ½ä¼šè¢«ç§¯å‹åœ¨å‘ç”Ÿåå‹ä¸Šæ¸¸çš„ç®—å­çš„æœ¬åœ°ç¼“å†²åŒºï¼ˆlocalBufferï¼‰ä¸­ã€‚ æˆ‘ä»¬çŸ¥é“ï¼Œæ¯ä¸€ä¸ª TaskManager æœ‰ä¸€ä¸ªæœ¬åœ°ç¼“å†²æ± , æ¯ä¸€ä¸ªç®—å­æ•°æ®è¿›æ¥åä¼šæŠŠæ•°æ®å¡«å……åˆ°æœ¬åœ°ç¼“å†²æ± ä¸­ï¼Œæ•°æ®ä»è¿™ä¸ªç®—å­å‡ºå»åä¼šå›æ”¶è¿™å—å†…å­˜ã€‚ å½“è¢«åå‹åï¼Œæ•°æ®å‘ä¸å‡ºå»ï¼Œæœ¬åœ°ç¼“å†²æ± å†…å­˜å°±æ— æ³•é‡Šæ”¾ï¼Œå¯¼è‡´ä¸€ç›´è¯·æ±‚ç¼“å†²åŒºï¼ˆrequestBufferï¼‰ã€‚ ç”±äº Heartbeat åªèƒ½ç›‘æ§å‡ºæ˜¯å¦å‘ç”Ÿäº†åå‹ï¼Œä½†æ— æ³•å®šä½åˆ°æ˜¯å“ªä¸ªç®—å­å‡ºäº†é—®é¢˜ã€‚ å› æ­¤æˆ‘ä»¬å®šæ—¶åœ°å°†æ¯ä¸ªç®—å­çš„ StackTrace æ‰“å°å‡ºæ¥ï¼Œå½“å‘ç”Ÿåå‹æ—¶ï¼Œé€šè¿‡ StackTrace å°±å¯ä»¥çŸ¥é“æ˜¯å“ªä¸ªç®—å­çš„ç“¶é¢ˆã€‚ å¦‚å›¾8æ‰€ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥æ¸…æ™°åœ°çœ‹åˆ°å‘ç”Ÿåå‹çš„ Flink ä½œä¸šåŠå…¶æ‰€åœ¨çš„ Taskmanagerã€‚å†é€šè¿‡ Thread Dumpï¼Œæˆ‘ä»¬å°±å¯ä»¥å®šä½åˆ°ä»£ç çš„é—®é¢˜ã€‚ å…¶ä»–ç›‘æ§æ‰‹æ®µFlink æœ¬èº«æä¾›äº†å¾ˆå¤šæœ‰ç”¨çš„æŒ‡æ ‡[2]æ¥ç›‘æ§ Flink ä½œä¸šçš„è¿è¡Œæƒ…å†µï¼Œåœ¨æ­¤åŸºç¡€ä¸Šæˆ‘ä»¬è¿˜åŠ äº†ä¸€äº›ä¸šåŠ¡ä¸Šçš„æŒ‡æ ‡ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜ä½¿ç”¨äº†ä»¥ä¸‹å·¥å…·ç›‘æ§ Flink ä½œä¸šã€‚ â‘ History server Flink çš„ History server[3]å¯ä»¥æŸ¥è¯¢å·²å®Œæˆä½œä¸šçš„çŠ¶æ€å’ŒæŒ‡æ ‡ã€‚æ¯”å¦‚ä¸€ä¸ªä½œä¸šçš„é‡å¯æ¬¡æ•°ã€å®ƒè¿è¡Œçš„æ—¶é—´ã€‚ æˆ‘ä»¬å¸¸å¸¸ç”¨å®ƒæ‰¾å‡ºè¿è¡Œä¸æ­£å¸¸çš„ä½œä¸šã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ History server çš„ Attempt æŒ‡æ ‡çŸ¥é“æ¯ä¸ªä½œä¸šé‡å¯çš„æ¬¡æ•°ï¼Œä»è€Œå¿«é€Ÿå»ç°åœºæ‰¾åˆ°é‡å¯çš„åŸå› ï¼Œé¿å…ä¸‹æ¬¡å†å‘ç”Ÿã€‚ â‘¡ç›‘æ§ä½œä¸šå’Œé›†ç¾¤ è™½ç„¶ Flink æœ‰ HA çš„æ¨¡å¼ï¼Œä½†åœ¨æç«¯æƒ…å†µä¸‹ï¼Œä¾‹å¦‚æ•´ä¸ªé›†ç¾¤å‡ºç°é—®é¢˜æ—¶ï¼Œéœ€è¦ on-call å³æ—¶å‘è§‰å¹¶äººå·¥å¹²é¢„ã€‚ æˆ‘ä»¬åœ¨å…ƒæ•°æ®å¾®æœåŠ¡ä¸­ä¿å­˜äº†æœ€åä¸€æ¬¡æäº¤ä½œä¸šæˆåŠŸçš„å…ƒæ•°æ®ï¼Œå®ƒè®°å½•äº†åœ¨æ¯ä¸ª Flink é›†ç¾¤ä¸Šåº”è¯¥è¿è¡Œå“ªäº›ä½œä¸šã€‚ å®ˆæŠ¤çº¿ç¨‹ï¼ˆDaemon threadï¼‰ä¼šæ¯åˆ†é’Ÿå»æ¯”è¾ƒè¿™ä¸ªå…ƒæ•°æ®å’Œ Flink ä¸Šè¿è¡Œçš„ä½œä¸šï¼Œè‹¥å‘ç° JobManager è¿ä¸é€šæˆ–è€…æœ‰ä½œä¸šè¿è¡Œä¸ä¸€è‡´åˆ™ç«‹åˆ»å‘å‡ºå‘Šè­¦ï¼ˆAlertï¼‰é€šçŸ¥ on-callã€‚ å®ä¾‹ä¸‹é¢ä»‹ç»å‡ ä¸ªå·²ç»è¿è¡Œåœ¨ç›‘æ§ç³»ç»Ÿä¸Šçš„ Flink æµå¤„ç†ç³»ç»Ÿçš„åº”ç”¨ï¼š Event Alerting å½“å‰ç›‘æ§å›¢é˜Ÿæ˜¯åŸºäº Flink Streaming åšäº‹ä»¶å‘Šè­¦ï¼ˆEvent alertingï¼‰ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå‘Šè­¦ç®—å­ EventAlertingCapabilityï¼Œè¯¥ Capability å¯ä»¥å¤„ç†æ¯ä¸ª Policy è‡ªå®šä¹‰çš„è§„åˆ™ã€‚ å¦‚å›¾ 9 å®šä¹‰çš„ä¸€æ¡æ€§èƒ½ç›‘æ§è§„åˆ™ï¼š è¯¥è§„åˆ™çš„å«ä¹‰æ˜¯å½“æ€§èƒ½æ£€æµ‹å™¨çš„åº”ç”¨ä¸ºâ€œr1roverâ€, ä¸»æœºä»¥â€œr1roverâ€å¼€å¤´ï¼Œä¸”æ•°å€¼å¤§äº 90 æ—¶ï¼Œå°±è§¦å‘å‘Šè­¦ã€‚ä¸”ç”Ÿæˆçš„å‘Šè­¦ä¼šå‘é€åˆ°æŒ‡å®šçš„ Kafka topic ä¸­ä¾›ä¸‹æ¸¸ç»§ç»­å¤„ç†ã€‚ EventzonEventzon å°±åƒ eBay çš„äº‹ä»¶ä¸­å¿ƒï¼Œå®ƒæ”¶é›†äº†ä»å„ä¸ªåº”ç”¨ï¼Œæ¡†æ¶ï¼ŒåŸºç¡€æ¶æ„å‘è¿‡æ¥çš„äº‹ä»¶ï¼Œæœ€åé€šè¿‡ç›‘æ§å›¢é˜Ÿçš„ Flink Streaming å®æ—¶ç”Ÿæˆå‘Šè­¦ã€‚ ç”±äºå„ä¸ªäº‹ä»¶çš„æ•°æ®æºä¸åŒï¼Œå®ƒä»¬çš„å…ƒæ•°æ®ä¹Ÿä¸åŒï¼Œå› æ­¤æ— æ³•ç”¨ä¸€æ¡ç»Ÿä¸€çš„è§„åˆ™æ¥æè¿°å®ƒã€‚ æˆ‘ä»¬ä¸“é—¨å®šä¹‰äº†ä¸€å¥—ä½œä¸šæ¥å¤„ç† Eventzon çš„äº‹ä»¶ï¼Œå®ƒåŒ…å«äº†å¤šä¸ª Capabilityï¼Œæ¯”å¦‚ Filter Capabilityï¼Œç”¨æ¥è¿‡æ»¤éæ³•çš„æˆ–è€…ä¸ç¬¦åˆæ¡ä»¶çš„äº‹ä»¶ï¼›åˆæ¯”å¦‚ Deduplicate Capabilityï¼Œå¯ä»¥ç”¨æ¥å»é™¤é‡å¤çš„äº‹ä»¶ã€‚ Eventzon çš„æ‰€æœ‰äº‹ä»¶ç»è¿‡ä¸€æ•´å¥—ä½œä¸šåï¼Œä¼šç”Ÿæˆæœ‰æ•ˆçš„å‘Šè­¦ï¼Œå¹¶æ ¹æ®é€šçŸ¥æœºåˆ¶é€šè¿‡ E-mailã€Slack æˆ– Pagerduty å‘ç»™ç›¸å…³å›¢é˜Ÿã€‚ NetmonNetmon çš„å…¨ç§°ä¸º Network Monitoring, å³ç½‘ç»œç›‘æ§ï¼Œå®ƒå¯ä»¥ç”¨æ¥ç›‘æ§æ•´ä¸ª eBay ç½‘ç»œè®¾å¤‡çš„å¥åº·çŠ¶æ€ã€‚å®ƒçš„æ•°æ®æºæ¥è‡ª eBay çš„äº¤æ¢æœºï¼Œè·¯ç”±å™¨ç­‰ç½‘ç»œè®¾å¤‡çš„æ—¥å¿—ã€‚ Netmon çš„ä½œç”¨æ˜¯æ ¹æ®è¿™äº›æ—¥å¿—æ‰¾å‡ºä¸€äº›ç‰¹å®šçš„ä¿¡æ¯ï¼Œå¾€å¾€æ˜¯ä¸€äº›é”™è¯¯çš„æ—¥å¿—ï¼Œä»¥æ­¤æ¥ç”Ÿæˆå‘Šè­¦ã€‚ eBay çš„æ¯ä¸€å°è®¾å¤‡éƒ½è¦â€œç™»è®°é€ å†Œâ€ï¼Œæ¯å°è®¾å¤‡å°†æ—¥å¿—å‘è¿‡æ¥åï¼Œæˆ‘ä»¬é€šè¿‡ EnrichCapability ä»â€œå†Œå­â€ä¸­æŸ¥è¯¢è¿™å°è®¾å¤‡çš„ä¿¡æ¯ï¼Œå¹¶æŠŠç›¸å…³ä¿¡æ¯æ¯”å¦‚ IP åœ°å€ï¼Œæ‰€åœ¨çš„æ•°æ®ä¸­å¿ƒï¼Œæ‰€åœ¨çš„æœºæ¶ç­‰å¡«å……åˆ°æ—¥å¿—ä¿¡æ¯ä¸­ä½œä¸ºäº‹ä»¶ä¿å­˜ã€‚ å½“è®¾å¤‡äº§ç”Ÿä¸€äº›ç‰¹å®šçš„é”™è¯¯æ—¥å¿—æ—¶, å®ƒä¼šè¢«ç›¸åº”çš„è§„åˆ™åŒ¹é…ç„¶åç”Ÿæˆå‘Šè­¦ï¼Œè¯¥å‘Šè­¦ä¼šè¢« EventProcess Capability ä¿å­˜åˆ° Elasticsearch ä¸­å®æ—¶æ˜¾ç¤ºåˆ° Netmon çš„ç›‘æ§å¹³å°ï¼ˆdashboardï¼‰ä¸Šã€‚ æœ‰æ—¶å› ä¸ºç½‘ç»œæŠ–åŠ¨å¯¼è‡´ä¸€äº›çŸ­æš‚çš„é”™è¯¯å‘ç”Ÿï¼Œä½†ç³»ç»Ÿè¿‡ä¸€ä¼šå„¿å°±ä¼šè‡ªåŠ¨æ¢å¤ã€‚ å½“ä¸Šè¿°æƒ…å†µå‘ç”Ÿæ—¶ï¼ŒNetmon ä¼šæœ‰ç›¸åº”çš„è§„åˆ™å°†å‘ç”Ÿåœ¨ç½‘ç»œæŠ–åŠ¨æ—¶ç”Ÿæˆçš„å‘Šè­¦æ ‡è®°ä¸ºâ€œå·²è§£å†³â€ï¼ˆResolvedï¼‰ã€‚ å¯¹äºä¸€äº›å¿…é¡»äººå·¥å¹²é¢„çš„å‘Šè­¦ï¼Œè¿ç»´äººå‘˜å¯ä»¥é€šè¿‡ç½‘ç»œç›‘æ§å¹³å°ï¼ˆNetmon dashboardï¼‰æ‰‹åŠ¨ç‚¹å‡»â€œå·²è§£å†³â€ï¼Œå®Œæˆè¯¥å‘Šè­¦çš„ç”Ÿå‘½å‘¨æœŸã€‚ æ€»ç»“ä¸å±•æœ›eBay çš„ç›‘æ§å›¢é˜Ÿå¸Œæœ›èƒ½æ ¹æ®ç”¨æˆ·æä¾›çš„æŒ‡æ ‡ã€äº‹ä»¶å’Œæ—¥å¿—ä»¥åŠç›¸åº”çš„å‘Šè­¦è§„åˆ™å®æ—¶å‘Šè­¦ç”¨æˆ·ã€‚ Flink Streaming èƒ½å¤Ÿæä¾›ä½å»¶æ—¶çš„å¤„ç†ä»è€Œèƒ½å¤Ÿè¾¾åˆ°æˆ‘ä»¬ä½å»¶æ—¶çš„è¦æ±‚ï¼Œå¹¶ä¸”å®ƒé€‚åˆæ¯”è¾ƒå¤æ‚çš„å¤„ç†é€»è¾‘ã€‚ ç„¶è€Œåœ¨è¿ç»´ Flink çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå‘ç°äº†ç”±äºä½œä¸šé‡å¯ç­‰åŸå› å¯¼è‡´è¯¯æŠ¥å°‘æŠ¥å‘Šè­¦çš„æƒ…å†µå‘ç”Ÿï¼Œä»è€Œè¯¯å¯¼å®¢æˆ·ã€‚å› æ­¤ä»Šåæˆ‘ä»¬ä¼šåœ¨ Flink çš„ç¨³å®šæ€§å’Œé«˜å¯ç”¨æ€§ä¸ŠæŠ•å…¥æ›´å¤šã€‚ æˆ‘ä»¬ä¹Ÿå¸Œæœ›åœ¨ç›‘æ§æŒ‡æ ‡ã€æ—¥å¿—ä¸Šèƒ½å¤Ÿé›†æˆä¸€äº›å¤æ‚çš„ AI ç®—æ³•ï¼Œä»è€Œèƒ½å¤Ÿç”Ÿæˆæ›´åŠ æœ‰æ•ˆç²¾ç¡®çš„å‘Šè­¦ï¼Œæˆä¸ºè¿ç»´äººå‘˜çš„ä¸€æŠŠåˆ©å™¨ã€‚ å‚è€ƒæ–‡çŒ®ï¼š[1]https://ci.apache.org/projects/flink/flink-docs-release-1.7/concepts/runtime.html#task-slots-and-resources [2]https://ci.apache.org/projects/flink/flink-docs-release-1.7/monitoring/metrics.html [3]https://ci.apache.org/projects/flink/flink-docs-release-1.4/monitoring/historyserver.html ä½œè€…ï¼šé¡¾æ¬£æ€¡ç¼–è¯‘å‡ºå¤„ï¼šhttps://yq.aliyun.com/articles/714592?utm_content=g_1000072645 å…³æ³¨æˆ‘å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ Github ä»£ç ä»“åº“https://github.com/zhisheng17/flink-learning/ ä»¥åè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç éƒ½å°†æ”¾åœ¨è¿™ä¸ªä»“åº“é‡Œï¼ŒåŒ…å«äº†è‡ªå·±å­¦ä¹  flink çš„ä¸€äº› demo å’Œåšå®¢ åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€å®æˆ˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"}]},{"title":"ä¿®æ”¹ä»£ç 150ä¸‡è¡Œï¼Apache Flink 1.9.0åšäº†è¿™äº›é‡å¤§ä¿®æ”¹ï¼","date":"2019-08-21T16:00:00.000Z","path":"2019/08/22/flink-1.9/","text":"å¯¼è¯»ï¼š8æœˆ22æ—¥ï¼ŒApache Flink 1.9.0 æ­£å¼å‘å¸ƒã€‚æ—©åœ¨ä»Šå¹´1æœˆï¼Œé˜¿é‡Œä¾¿å®£å¸ƒå°†å†…éƒ¨è¿‡å»å‡ å¹´æ‰“ç£¨çš„å¤§æ•°æ®å¤„ç†å¼•æ“Blinkè¿›è¡Œå¼€æºå¹¶å‘ Apache Flink è´¡çŒ®ä»£ç ã€‚æ­¤æ¬¡ç‰ˆæœ¬åœ¨ç»“æ„ä¸Šæœ‰é‡å¤§å˜æ›´ï¼Œä¿®æ”¹ä»£ç è¾¾150ä¸‡è¡Œï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¸€èµ·æ¢³ç† Flink 1.9.0 ä¸­éå¸¸å€¼å¾—å…³æ³¨çš„é‡è¦åŠŸèƒ½ä¸ç‰¹æ€§ã€‚ æœ¬æ–‡ä½œè€…ï¼šæ¨å…‹ç‰¹(é²å°¼) Flink 1.9.0æ˜¯é˜¿é‡Œå†…éƒ¨ç‰ˆæœ¬ Blink åˆå¹¶å…¥ Flink åçš„é¦–æ¬¡å‘ç‰ˆï¼Œä¿®æ”¹ä»£ç 150ä¸‡è¡Œï¼Œæ­¤æ¬¡å‘ç‰ˆä¸ä»…åœ¨ç»“æ„ä¸Šæœ‰é‡å¤§å˜æ›´ï¼Œåœ¨åŠŸèƒ½ç‰¹æ€§ä¸Šä¹Ÿæ›´åŠ å¼ºå¤§ä¸å®Œå–„ã€‚æœ¬æ–‡å°†ä¸ºå¤§å®¶ä»‹ç» Flink 1.9.0 æœ‰å“ªäº›é‡å¤§å˜æ›´ä¸æ–°å¢åŠŸèƒ½ç‰¹æ€§ã€‚ åœ¨æ­¤å…ˆç®€å•å›é¡¾ä¸€ä¸‹é˜¿é‡Œå·´å·´Blink å¼€æºçš„éƒ¨åˆ†è¦ç‚¹ï¼š Blink å¼€æºçš„å†…å®¹ä¸»è¦æ˜¯é˜¿é‡Œå·´å·´åŸºäºå¼€æº Flink å¼•æ“ï¼Œä¾æ‰˜é›†å›¢å†…éƒ¨ä¸šåŠ¡ï¼Œåœ¨æµè®¡ç®—å’Œæ‰¹å¤„ç†ä¸Šç§¯ç´¯çš„å¤§é‡æ–°åŠŸèƒ½ã€æ€§èƒ½ä¼˜åŒ–ã€ç¨³å®šæ€§æå‡ç­‰æ ¸å¿ƒä»£ç ã€‚ Blink ä»¥åˆ†æ”¯çš„å½¢å¼å¼€æºï¼Œå³å¼€æºåä¼šæˆä¸º Apache Flinké¡¹ç›®ä¸‹çš„ä¸€ä¸ªåˆ†æ”¯ã€‚ Blink å¼€æºçš„ç›®æ ‡ä¸æ˜¯å¸Œæœ›æˆä¸ºå¦ä¸€ä¸ªæ´»è·ƒçš„é¡¹ç›®ï¼Œè€Œæ˜¯å°†Flink åšçš„æ›´å¥½ã€‚é€šè¿‡å¼€æºçš„æ–¹å¼è®©å¤§å®¶äº†è§£æ‰€æœ‰ Blink çš„å®ç°ç»†èŠ‚ï¼Œæé«˜ Blink åŠŸèƒ½mergeè¿›å…¥Flink çš„æ•ˆç‡ï¼Œä¸ç¤¾åŒºåä½œæ›´é«˜æ•ˆã€‚ åŠå¹´çš„æ—¶é—´è¿‡å»äº†ï¼Œéšç€ Flink 1.9.0 ç‰ˆæœ¬çš„å‘å¸ƒï¼Œåœ¨æ­¤æˆ‘ä»¬å¯ä»¥éª„å‚²çš„å®£å¸ƒï¼šBlink å›¢é˜Ÿå·²ç»å®ç°äº†ä¹‹å‰çš„è¯ºè¨€ï¼å°½ç®¡ä¸æ˜¯æ‰€æœ‰åŠŸèƒ½éƒ½é¡ºåˆ© merge å›äº†ç¤¾åŒºï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬å’Œç¤¾åŒºçš„å…±åŒåŠªåŠ›ä¸‹ï¼ŒFlink æ­£åœ¨æœç€å®ƒæœ€åˆçš„æ¢¦æƒ³å¤§è¸æ­¥çš„è¿ˆè¿›ã€‚ å…ˆå’Œå¤§å®¶åˆ†äº«å‡ ä¸ª Flink 1.9.0 ç‰ˆæœ¬ä¸ä¹‹å‰ä¸ªç‰ˆæœ¬çš„å¯¹æ¯”æ•°å­—ï¼š ä»è§£å†³çš„ issue æ•°é‡å’Œä»£ç  commit æ•°é‡æ¥çœ‹ï¼Œ1.9.0 å·²ç»è¾¾åˆ°ç”šè‡³è¶…è¿‡äº†ä¹‹å‰ä¸¤ä¸ªç‰ˆæœ¬çš„æ€»å’Œã€‚ ä»ä¿®æ”¹çš„ä»£ç è¡Œæ•°æ¥çœ‹ï¼Œè¾¾åˆ°äº†æƒŠäººçš„150 ä¸‡è¡Œã€‚è™½ç„¶å—ä¸€äº›æ¨¡å—é‡æ„ä»¥åŠ Blink merge ç­‰å› ç´ çš„å½±å“ï¼Œä½†ä¸å¯å¦è®¤çš„æ˜¯ï¼Œ1.9.0 ç‰ˆæœ¬ä¸€å®šæ˜¯ Flink æœ‰å²ä»¥æ¥å¼€å‘è€…ä»¬æœ€æ´»è·ƒçš„ç‰ˆæœ¬ã€‚ ä»Contributor æ•°é‡æ¥çœ‹ï¼ŒFlink ä¹Ÿå·²ç»å¸å¼•äº†è¶Šæ¥è¶Šå¤šçš„è´¡çŒ®è€…ã€‚æˆ‘ç›¸ä¿¡å…¶ä¸­å°±æœ‰ä¸å°‘æ¥è‡ªä¸­å›½çš„ç”¨æˆ·å’Œå¼€å‘è€…ï¼Œç¤¾åŒºä¹Ÿå“åº”å·å¬å¼€é€šäº†ä¸­æ–‡é‚®ä»¶åˆ—è¡¨ã€‚ é‚£ä¹ˆï¼Œ1.9.0 ç‰ˆæœ¬ç©¶ç«Ÿç”±å“ªäº›å˜æ›´è€Œå¼•å‘äº†å¦‚æ­¤å¤§é‡çš„ä¿®æ”¹ï¼Œä»¥ä¸‹å°†è¯¦ç»†è¯´æ˜ã€‚ æ¶æ„å‡çº§åŸºæœ¬ä¸Šï¼Œç³»ç»Ÿå¦‚æœæœ‰éå¸¸å¤§çš„å˜åŠ¨ï¼Œé‚£ä¸€å®šæ˜¯æ¶æ„å‡çº§å¸¦æ¥çš„ã€‚è¿™æ¬¡ä¹Ÿä¸ä¾‹å¤–ï¼ŒFlink åœ¨æµæ‰¹èåˆçš„æ–¹å‘ä¸Šè¿ˆè¿›äº†ä¸€å¤§æ­¥ã€‚é¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ Flinkä¹‹å‰ç‰ˆæœ¬çš„æ¶æ„å›¾ï¼š ç›¸ä¿¡ç†Ÿæ‚‰Flink çš„è¯»è€…ä»¬å¯¹å·¦è¾¹çš„æ¶æ„å›¾ä¸€å®šä¸ä¼šæ„Ÿåˆ°é™Œç”Ÿã€‚ç®€å•æ¥è¯´ï¼ŒFlink åœ¨å…¶åˆ†å¸ƒå¼æµå¼æ‰§è¡Œå¼•æ“ä¹‹ä¸Šï¼Œæœ‰ä¸¤å¥—ç›¸å¯¹ç‹¬ç«‹çš„ DataStream å’Œ DataSet APIï¼Œåˆ†åˆ«æ¥æè¿°æµè®¡ç®—å’Œæ‰¹å¤„ç†çš„ä½œä¸šã€‚åœ¨è¿™ä¸¤ä¸ª APIä¹‹ä¸Šï¼Œåˆ™æä¾›äº†ä¸€ä¸ªæµæ‰¹ç»Ÿä¸€çš„APIï¼Œå³ Table API å’ŒSQLã€‚ç”¨æˆ·å¯ä»¥ä½¿ç”¨ç›¸åŒçš„Table API ç¨‹åºæˆ–è€… SQL æ¥æè¿°æµæ‰¹ä½œä¸šï¼Œåªæ˜¯åœ¨è¿è¡Œæ—¶éœ€è¦å‘Šè¯‰ Flink å¼•æ“å¸Œæœ›ä»¥æµçš„å½¢å¼è¿è¡Œè¿˜æ˜¯ä»¥æ‰¹çš„æµå¼è¿è¡Œï¼Œæ­¤æ—¶ Table å±‚çš„ä¼˜åŒ–å™¨å°±ä¼šå°†ç¨‹åºä¼˜åŒ–æˆ DataStream ä½œä¸šæˆ–è€… DataSet ä½œä¸šã€‚ ä½†æ˜¯å¦‚æœæˆ‘ä»¬ä»”ç»†æŸ¥çœ‹ DataStream å’Œ DataSet åº•å±‚çš„å®ç°ç»†èŠ‚ï¼Œä¼šå‘ç°è¿™ä¸¤ä¸ª API å…±äº«çš„ä¸œè¥¿å…¶å®ä¸å¤šã€‚å®ƒä»¬æœ‰å„è‡ªç‹¬ç«‹çš„ç¿»è¯‘å’Œä¼˜åŒ–çš„æµç¨‹ï¼Œè€Œä¸”åœ¨çœŸæ­£è¿è¡Œçš„æ—¶å€™ï¼Œä¸¤è€…ä¹Ÿä½¿ç”¨äº†å®Œå…¨ä¸åŒçš„ Taskã€‚è¿™æ ·çš„ä¸ä¸€è‡´å¯¹ç”¨æˆ·å’Œå¼€å‘è€…æ¥è®²å¯èƒ½å­˜åœ¨é—®é¢˜ã€‚ ä»ç”¨æˆ·çš„è§’åº¦æ¥è¯´ï¼Œä»–ä»¬åœ¨ç¼–å†™ä½œä¸šçš„æ—¶å€™éœ€è¦åœ¨ä¸¤ä¸ª API ä¹‹é—´è¿›è¡Œé€‰æ‹©ï¼Œè€Œè¿™ä¸¤ä¸ª API ä¸ä»…è¯­ä¹‰ä¸åŒï¼ŒåŒæ—¶æ”¯æŒçš„ connector ç§ç±»ä¹Ÿä¸åŒï¼Œéš¾å…ä¼šé€ æˆä¸€äº›å›°æ‰°ã€‚Table å°½ç®¡åœ¨ API ä¸Šå·²ç»è¿›è¡Œäº†ç»Ÿä¸€ï¼Œä½†å› ä¸ºåº•å±‚å®ç°è¿˜æ˜¯åŸºäº DataStream å’Œ DataSetï¼Œä¹Ÿä¼šå—åˆ°åˆšæ‰ä¸ä¸€è‡´çš„é—®é¢˜çš„å½±å“ã€‚ ä»å¼€å‘è€…è§’åº¦æ¥è¯´ï¼Œç”±äºè¿™ä¸¤å¥—æµç¨‹ç›¸å¯¹ç‹¬ç«‹ï¼Œå› æ­¤åŸºæœ¬ä¸Šå¾ˆéš¾åšåˆ°ä»£ç çš„å¤ç”¨ã€‚æˆ‘ä»¬åœ¨å¼€å‘ä¸€äº›æ–°åŠŸèƒ½çš„æ—¶å€™ï¼Œå¾€å¾€éœ€è¦å°†ç±»ä¼¼çš„åŠŸèƒ½å¼€å‘ä¸¤æ¬¡ï¼Œå¹¶ä¸”æ¯ç§ API çš„å¼€å‘è·¯å¾„éƒ½æ¯”è¾ƒé•¿ï¼ŒåŸºæœ¬éƒ½å±äºç«¯åˆ°ç«¯çš„ä¿®æ”¹ï¼Œè¿™å¤§å¤§é™ä½äº†æˆ‘ä»¬çš„å¼€å‘æ•ˆç‡ã€‚å¦‚æœä¸¤æ¡ç‹¬ç«‹çš„æŠ€æœ¯æ ˆé•¿æœŸå­˜åœ¨ï¼Œä¸ä»…ä¼šé€ æˆäººåŠ›çš„é•¿æœŸæµªè´¹ï¼Œæœ€ç»ˆå¯èƒ½è¿˜ä¼šå¯¼è‡´æ•´ä¸ª Flink çš„åŠŸèƒ½å¼€å‘å˜æ…¢ã€‚ åœ¨ Blink ä¸€äº›å…ˆè¡Œæ¢ç´¢çš„åŸºç¡€ä¹‹ä¸Šï¼Œæˆ‘ä»¬å’Œç¤¾åŒºçš„å¼€å‘äººå‘˜è¿›è¡Œäº†å¯†åˆ‡çš„è®¨è®ºï¼Œæœ€ç»ˆåŸºæœ¬æ•²å®šäº† Flink æœªæ¥çš„æŠ€æœ¯æ¶æ„è·¯çº¿ã€‚ åœ¨ Flink çš„æœªæ¥ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬å°†èˆå¼ƒ DataSet APIï¼Œç”¨æˆ·çš„ API ä¸»è¦ä¼šåˆ†ä¸ºåæè¿°ç‰©ç†æ‰§è¡Œè®¡åˆ’çš„ DataStream API ä»¥åŠåæè¿°å…³ç³»å‹è®¡åˆ’çš„ Table &amp; SQLã€‚DataStream API æä¾›ç»™ç”¨æˆ·æ›´å¤šçš„æ˜¯ä¸€ç§â€œæ‰€è§å³æ‰€å¾—â€çš„ä½“éªŒï¼Œç”±ç”¨æˆ·è‡ªè¡Œæè¿°å’Œç¼–æ’ç®—å­çš„å…³ç³»ï¼Œå¼•æ“ä¸ä¼šåšè¿‡å¤šçš„å¹²æ¶‰å’Œä¼˜åŒ–ã€‚è€ŒTable API &amp; SQL åˆ™ç»§ç»­ä¿æŒç°åœ¨çš„é£æ ¼ï¼Œæä¾›å…³ç³»è¡¨è¾¾å¼APIï¼Œå¼•æ“ä¼šæ ¹æ®ç”¨æˆ·çš„æ„å›¾æ¥è¿›è¡Œä¼˜åŒ–ï¼Œå¹¶é€‰æ‹©æœ€ä¼˜çš„æ‰§è¡Œè®¡åˆ’ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼Œä»¥åè¿™ä¸¤ä¸ª API éƒ½ä¼šå„è‡ªåŒæ—¶æä¾›æµè®¡ç®—å’Œæ‰¹å¤„ç†çš„åŠŸèƒ½ã€‚è¿™ä¸¤ä¸ªç”¨æˆ· API ä¹‹ä¸‹ï¼Œåœ¨å®ç°å±‚å®ƒä»¬éƒ½ä¼šå…±äº«ç›¸åŒçš„æŠ€æœ¯æ ˆï¼Œæ¯”å¦‚ä¼šç”¨ç»Ÿä¸€çš„ DAG æ•°æ®ç»“æ„æ¥æè¿°ä½œä¸šï¼Œä½¿ç”¨ç»Ÿä¸€çš„ StreamOperator æ¥ç¼–å†™ç®—å­é€»è¾‘ï¼ŒåŒ…æ‹¬ä½¿ç”¨ç»Ÿä¸€çš„æµå¼åˆ†å¸ƒå¼æ‰§è¡Œå¼•æ“ã€‚ TableAPI &amp; SQLåœ¨å¼€æº Blink æ—¶ï¼ŒBlink çš„Table æ¨¡å—å·²ç»ä½¿ç”¨äº† Flink æœªæ¥è®¾æƒ³çš„æ–°æ¶æ„ã€‚å› æ­¤ Flink 1.9 ç‰ˆæœ¬ä¸­ï¼ŒTable æ¨¡å—é¡ºç†æˆç« çš„æˆä¸ºäº†æ¶æ„è°ƒæ•´åç¬¬ä¸€ä¸ªåƒèƒèŸ¹çš„äººã€‚ä½†æ˜¯ï¼Œä¸ºäº†å°½é‡ä¸å½±å“ä¹‹å‰ç‰ˆæœ¬ç”¨æˆ·çš„ä½“éªŒï¼Œæˆ‘ä»¬è¿˜æ˜¯éœ€è¦æ‰¾åˆ°ä¸€ä¸ªæ–¹å¼è®©ä¸¤ç§æ¶æ„èƒ½å¤Ÿå¹¶å­˜ã€‚ åŸºäºè¿™ä¸ªç›®çš„ï¼Œç¤¾åŒºçš„å¼€å‘äººå‘˜åšäº†ä¸€ç³»åˆ—çš„åŠªåŠ›ï¼ŒåŒ…æ‹¬å°† Table æ¨¡å—è¿›è¡Œæ‹†åˆ†ï¼ˆFLIP-32ï¼ŒFLIP å³ Flink Improvement Proposalsï¼Œä¸“é—¨è®°å½•ä¸€äº›å¯¹Flink åšè¾ƒå¤§ä¿®æ”¹çš„æè®®ï¼‰ï¼Œå¯¹ Java å’Œ Scala çš„ API è¿›è¡Œä¾èµ–æ¢³ç†ï¼Œå¹¶ä¸”æå‡ºäº† Planner æ¥å£ä»¥æ”¯æŒå¤šç§ä¸åŒçš„ Planner å®ç°ã€‚Planner å°†è´Ÿè´£å…·ä½“çš„ä¼˜åŒ–å’Œå°† Table ä½œä¸šç¿»è¯‘æˆæ‰§è¡Œå›¾çš„å·¥ä½œï¼Œæˆ‘ä»¬å¯ä»¥å°†åŸæ¥çš„å®ç°å…¨éƒ¨æŒªè‡³ Flink Planner ä¸­ï¼Œç„¶åæŠŠå¯¹æ¥æ–°æ¶æ„çš„ä»£ç æ”¾åœ¨ Blink Planneré‡Œã€‚ å›¾ä¸­çš„ Query Processor å°±æ˜¯ Planner çš„å®ç° è¿™æ ·çš„åšæ³•ä¸€ä¸¾ä¸¤å¾—ã€‚ä¸ä»…è®© Table æ¨¡å—åœ¨ç»è¿‡æ‹†åˆ†åæ›´åŠ æ¸…æ™°ï¼Œæ›´é‡è¦çš„æ˜¯ä¸å½±å“è€ç‰ˆæœ¬ç”¨æˆ·çš„ä½“éªŒã€‚ åœ¨ 1.9 ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬å·²ç»merge äº†å¤§éƒ¨åˆ†å½“åˆä» Blink å¼€æºå‡ºæ¥çš„ SQLåŠŸèƒ½ã€‚è¿™äº›éƒ½æ˜¯è¿‘å‡ å¹´åœ¨é˜¿é‡Œå†…éƒ¨åœºæ™¯ç»è¿‡åƒé”¤ç™¾ç‚¼è€Œæ²‰æ·€å‡ºæ¥çš„æ–°åŠŸèƒ½å’Œæ€§èƒ½ä¸Šçš„ä¼˜åŒ–ï¼Œç›¸ä¿¡èƒ½å¤Ÿä¿ƒä½¿Flink æ›´ä¸Šä¸€ä¸ªå°é˜¶ï¼ é™¤äº†æ¶æ„å‡çº§ä¹‹å¤–ï¼ŒTable æ¨¡å—åœ¨ 1.9 ç‰ˆæœ¬è¿˜åšäº†å‡ ä¸ªç›¸å¯¹æ¯”è¾ƒå¤§çš„é‡æ„å’Œæ–°åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š FLIP-37ï¼šé‡æ„ Table API ç±»å‹ç³»ç»Ÿ FLIP-29ï¼šTable å¢åŠ é¢å‘å¤šè¡Œå¤šåˆ—æ“ä½œçš„ API FLINK-10232ï¼šåˆæ­¥çš„ SQL DDL æ”¯æŒ FLIP-30ï¼šå…¨æ–°çš„ç»Ÿä¸€çš„ Catalog API FLIP-38ï¼šTable API å¢åŠ  Python ç‰ˆæœ¬ æœ‰äº†è¿™äº›æ–°åŠŸèƒ½åŠ æŒï¼Œå†ç»è¿‡åç»­ä¿®å¤å’Œå®Œå–„ï¼ŒFlink Table API å’Œ SQL åœ¨æœªæ¥å°†ä¼šå‘æŒ¥è¶Šæ¥è¶Šé‡è¦çš„ä½œç”¨ã€‚ æ‰¹å¤„ç†æ”¹è¿›Flinkçš„æ‰¹å¤„ç†åŠŸèƒ½åœ¨ 1.9 ç‰ˆæœ¬æœ‰äº†é‡å¤§è¿›æ­¥ï¼Œåœ¨æ¶æ„è°ƒæ•´åï¼ŒFlink 1.9 åŠ å…¥äº†å¥½å‡ é¡¹å¯¹æ‰¹å¤„ç†çš„åŠŸèƒ½æ”¹è¿›ã€‚ é¦–å½“å…¶å†²çš„æ˜¯ä¼˜åŒ–æ‰¹å¤„ç†çš„é”™è¯¯æ¢å¤ä»£ä»·ï¼šFLIP-1ï¼ˆFine Grained Recovery from Task Failuresï¼‰ï¼Œä»è¿™ä¸ª FLIP çš„ç¼–å·å°±å¯ä»¥çœ‹å‡ºï¼Œè¯¥ä¼˜åŒ–å…¶å®å¾ˆæ—©å°±å·²ç»æå‡ºï¼Œ1.9 ç‰ˆæœ¬ç»ˆäºæœ‰æœºä¼šå°† FLIP-1 ä¸­æœªå®Œæˆçš„åŠŸèƒ½è¿›è¡Œäº†æ”¶å°¾ã€‚åœ¨æ–°ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœæ‰¹å¤„ç†ä½œä¸šæœ‰é”™è¯¯å‘ç”Ÿï¼Œé‚£ä¹ˆ Flink é¦–å…ˆä¼šå»è®¡ç®—è¿™ä¸ªé”™è¯¯çš„å½±å“èŒƒå›´ï¼Œå³ Failover Regionã€‚å› ä¸ºåœ¨æ‰¹å¤„ç†ä½œä¸šä¸­ï¼Œæœ‰äº›èŠ‚ç‚¹ä¹‹é—´å¯ä»¥é€šè¿‡ç½‘ç»œè¿›è¡ŒPipeline çš„æ•°æ®ä¼ è¾“ï¼Œä½†å…¶ä»–ä¸€äº›èŠ‚ç‚¹å¯ä»¥é€šè¿‡ Blocking çš„æ–¹å¼å…ˆæŠŠè¾“å‡ºæ•°æ®å­˜ä¸‹æ¥ï¼Œç„¶åä¸‹æ¸¸å†å»è¯»å–å­˜å‚¨çš„æ•°æ®çš„æ–¹å¼è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚å¦‚æœç®—å­è¾“å‡ºçš„æ•°æ®å·²ç»å®Œæ•´çš„è¿›è¡Œäº†ä¿å­˜ï¼Œé‚£ä¹ˆå°±æ²¡æœ‰å¿…è¦æŠŠè¿™ä¸ªç®—å­æ‹‰èµ·é‡è·‘ï¼Œè¿™æ ·ä¸€æ¥å°±å¯ä»¥æŠŠé”™è¯¯æ¢å¤æ§åˆ¶åœ¨ä¸€ä¸ªç›¸å¯¹è¾ƒå°çš„èŒƒå›´é‡Œã€‚ å¦‚æœä½œä¸šæç«¯ä¸€ç‚¹ï¼Œåœ¨æ¯ä¸€ä¸ªéœ€è¦Shuffle çš„åœ°æ–¹éƒ½è¿›è¡Œæ•°æ®è½ç›˜ï¼Œé‚£ä¹ˆå°±å’Œ MapReduce ä»¥åŠ Spark çš„è¡Œä¸ºç±»ä¼¼äº†ã€‚åªæ˜¯ Flink æ”¯æŒæ›´é«˜çº§çš„ç”¨æ³•ï¼Œä½ å¯ä»¥è‡ªè¡Œæ§åˆ¶æ¯ç§ Shuffle æ˜¯ä½¿ç”¨ç½‘ç»œæ¥ç›´è¿ï¼Œè¿˜æ˜¯é€šè¿‡æ–‡ä»¶è½ç›˜æ¥è¿›è¡Œã€‚ æœ‰äº†åŸºäºæ–‡ä»¶çš„Shuffle ä¹‹åï¼Œå¤§å®¶å¾ˆå®¹æ˜“å°±ä¼šè”æƒ³åˆ°ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥æŠŠè¿™ä¸ª Shuffle çš„å®ç°å˜æˆæ’ä»¶åŒ–ã€‚æ²¡é”™ï¼Œç¤¾åŒºä¹Ÿæ­£åœ¨æœè¿™ä¸ªæ–¹å‘è¿›è¡Œæ”¹è¿›ï¼šFLIP-31ï¼ˆPluggable Shuffle Serviceï¼‰ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ Yarn çš„ Auxliary Service æ¥ä½œä¸ºä¸€ç§ Shuffle çš„å®ç°ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥å»å†™ä¸€ä¸ªåˆ†å¸ƒå¼æœåŠ¡æ¥å¸®åŠ©æ‰¹å¤„ç†ä»»åŠ¡è¿›è¡ŒShuffleã€‚æœ€è¿‘ï¼ŒFacebook ä¹Ÿåˆ†äº«äº†ä¸€äº›è¿™æ–¹é¢çš„å·¥ä½œï¼Œè€Œä¸”åœ¨é˜¿é‡Œå†…éƒ¨ï¼Œæˆ‘ä»¬å·²ç»ä½¿ç”¨è¿™æ ·çš„æ¶æ„ï¼Œæ”¯æŒäº†å•ä½œä¸šå¤„ç†æ•°ç™¾TB é‡çº§çš„è§„æ¨¡ã€‚Flink å…·å¤‡äº†è¿™æ ·çš„æ’ä»¶æœºåˆ¶åï¼Œå¯ä»¥è½»æ¾çš„å¯¹æ¥è¿™äº›æ›´åŠ é«˜æ•ˆçµæ´»çš„å®ç°ï¼Œè®©Shuffle è¿™ä¸ªæ‰¹å¤„ç†çš„è€å¤§éš¾é—®é¢˜å¾—åˆ°è¾ƒå¥½çš„è§£å†³ã€‚ æµå¤„ç†æ”¹è¿›æµè®¡ç®—æ¯•ç«Ÿè¿˜æ˜¯ Flink å‘è¿¹çš„ä¸»è¦é¢†åŸŸï¼Œåœ¨ 1.9 ç‰ˆæœ¬å½“ç„¶ä¹Ÿä¸èƒ½å¿˜äº†åœ¨è¿™æ–¹é¢åšä¸€äº›æ”¹è¿›ã€‚è¿™ä¸ªç‰ˆæœ¬å¢åŠ äº†ä¸€ä¸ªéå¸¸å®ç”¨çš„åŠŸèƒ½ï¼Œå³FLIP-43ï¼ˆState Processor APIï¼‰ã€‚Flink çš„ State æ•°æ®çš„è®¿é—®ï¼Œä»¥åŠç”± State æ•°æ®ç»„æˆçš„ Savepoint çš„è®¿é—®ä¸€ç›´æ˜¯ç¤¾åŒºç”¨æˆ·å‘¼å£°æ¯”è¾ƒé«˜çš„ä¸€ä¸ªåŠŸèƒ½ã€‚åœ¨ 1.9 ä¹‹å‰çš„ç‰ˆæœ¬ï¼ŒFlink å¼€å‘äº† Queryable Stateï¼Œä¸è¿‡è¿™ä¸ªåŠŸèƒ½çš„ä½¿ç”¨åœºæ™¯æ¯”è¾ƒæœ‰é™ï¼Œä½¿ç”¨æ•ˆæœä¹Ÿä¸å¤ªç†æƒ³ï¼Œå› æ­¤ç”¨çš„äººä¸€ç›´ä¸å¤šã€‚è¿™æ¬¡çš„ State Processor API åˆ™æä¾›äº†æ›´åŠ çµæ´»çš„è®¿é—®æ‰‹æ®µï¼Œä¹Ÿèƒ½å¤Ÿè®©ç”¨æˆ·å®Œæˆä¸€äº›æ¯”è¾ƒé»‘ç§‘æŠ€çš„åŠŸèƒ½ï¼š ç”¨æˆ·å¯ä»¥ä½¿ç”¨è¿™ä¸ª API äº‹å…ˆä»å…¶ä»–å¤–éƒ¨ç³»ç»Ÿè¯»å–æ•°æ®ï¼ŒæŠŠå®ƒä»¬è½¬å­˜ä¸º Flink Savepoint çš„æ ¼å¼ï¼Œç„¶åè®© Flink ä½œä¸šä»è¿™ä¸ª Savepoint å¯åŠ¨ã€‚è¿™æ ·ä¸€æ¥ï¼Œå°±èƒ½é¿å…å¾ˆå¤šå†·å¯åŠ¨çš„é—®é¢˜ã€‚ ä½¿ç”¨ Flink çš„æ‰¹å¤„ç† API ç›´æ¥åˆ†æState çš„æ•°æ®ã€‚State æ•°æ®ä¸€ç›´ä»¥æ¥å¯¹ç”¨æˆ·æ˜¯ä¸ªé»‘ç›’ï¼Œè¿™é‡Œé¢å­˜å‚¨çš„æ•°æ®æ˜¯å¯¹æ˜¯é”™ï¼Œæ˜¯å¦æœ‰å¼‚å¸¸ï¼Œç”¨æˆ·éƒ½æ— ä»è€ŒçŸ¥ã€‚æœ‰äº†è¿™ä¸ª API ä¹‹åï¼Œç”¨æˆ·å°±å¯ä»¥åƒåˆ†æå…¶ä»–æ•°æ®ä¸€æ ·ï¼Œæ¥å¯¹ State æ•°æ®è¿›è¡Œåˆ†æã€‚ è„æ•°æ®è®¢æ­£ã€‚å‡å¦‚æœ‰ä¸€æ¡è„æ•°æ®æ±¡æŸ“äº†ä½ çš„ Stateï¼Œç”¨æˆ·è¿˜å¯ä»¥ä½¿ç”¨è¿™ä¸ª API å¯¹è¿™æ ·çš„é—®é¢˜è¿›è¡Œä¿®å¤å’Œè®¢æ­£ã€‚ çŠ¶æ€è¿ç§»ã€‚å½“ç”¨æˆ·ä¿®æ”¹äº†ä½œä¸šé€»è¾‘ï¼Œæƒ³å¤ç”¨å¤§éƒ¨åˆ†åŸæ¥ä½œä¸šçš„ Stateï¼Œä½†åˆå¸Œæœ›åšä¸€äº›å¾®è°ƒã€‚é‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨è¿™ä¸ª API æ¥å®Œæˆç›¸åº”çš„å·¥ä½œã€‚ ä¸Šé¢åˆ—ä¸¾çš„éƒ½æ˜¯æµè®¡ç®—é¢†åŸŸéå¸¸å¸¸è§çš„éœ€æ±‚å’Œé—®é¢˜ï¼Œéƒ½æœ‰æœºä¼šé€šè¿‡è¿™ä¸ªçµæ´»çš„ API è¿›è¡Œè§£å†³ï¼Œå› æ­¤æˆ‘ä¸ªäººéå¸¸çœ‹å¥½è¿™ä¸ª API çš„åº”ç”¨å‰æ™¯ã€‚ è¯´åˆ° Savepointï¼Œè¿™é‡Œä¹Ÿæä¸€ä¸‹ç¤¾åŒºå®Œæˆçš„å¦å¤–ä¸€ä¸ªå®ç”¨åŠŸèƒ½ï¼Œå³FLIP-34ï¼ˆStop with Savepointï¼‰ã€‚å¤§å®¶éƒ½çŸ¥é“ Flink ä¼šå‘¨æœŸæ€§çš„è¿›è¡Œ Checkpointï¼Œå¹¶ä¸”ç»´æŠ¤äº†ä¸€ä¸ªå…¨å±€çš„çŠ¶æ€å¿«ç…§ã€‚å‡å¦‚æˆ‘ä»¬ç¢°åˆ°è¿™ç§åœºæ™¯ï¼šç”¨æˆ·åœ¨ä¸¤ä¸ªCheckpoint å‘¨æœŸä¸­é—´ä¸»åŠ¨æš‚åœäº†ä½œä¸šï¼Œç„¶åè¿‡ä¸€ä¼šåˆè¿›è¡Œé‡å¯ã€‚è¿™æ ·ï¼ŒFlink ä¼šè‡ªåŠ¨è¯»å–ä¸Šä¸€æ¬¡æˆåŠŸä¿å­˜çš„å…¨å±€çŠ¶æ€å¿«ç…§ï¼Œå¹¶å¼€å§‹è®¡ç®—ä¸Šä¸€æ¬¡å…¨å±€å¿«ç…§ä¹‹åçš„æ•°æ®ã€‚è™½ç„¶è¿™ä¹ˆåšèƒ½ä¿è¯çŠ¶æ€æ•°æ®çš„ä¸å¤šä¸å°‘ï¼Œä½†æ˜¯è¾“å‡ºåˆ° Sink çš„å´å·²ç»æœ‰é‡å¤æ•°æ®äº†ã€‚æœ‰äº†è¿™ä¸ªåŠŸèƒ½ä¹‹åï¼ŒFlink ä¼šåœ¨æš‚åœä½œä¸šçš„åŒæ—¶åšä¸€æ¬¡å…¨å±€å¿«ç…§ï¼Œå¹¶å­˜å‚¨åˆ°Savepointã€‚ä¸‹æ¬¡å¯åŠ¨æ—¶ï¼Œä¼šä»è¿™ä¸ª Savepoint å¯åŠ¨ä½œä¸šï¼Œè¿™æ · Sink å°±ä¸ä¼šæ”¶åˆ°é¢„æœŸå¤–çš„é‡å¤æ•°æ®äº†ã€‚ä¸è¿‡ï¼Œè¿™ä¸ªåšæ³•å¹¶ä¸èƒ½è§£å†³ä½œä¸šåœ¨è¿è¡Œè¿‡ç¨‹ä¸­è‡ªåŠ¨Failoverè€Œå¼•èµ·çš„è¾“å‡ºåˆ° Sink æ•°æ®é‡å¤é—®é¢˜ã€‚ Hiveé›†æˆHiveä¸€ç›´æ˜¯ Hadoop ç”Ÿæ€ä¸­ä¸€è‚¡ä¸å¯å¿½è§†çš„é‡è¦åŠ›é‡ã€‚ä¸ºäº†æ›´å¥½çš„æ¨å¹¿ Flink çš„æ‰¹å¤„ç†åŠŸèƒ½ï¼Œå’Œ Hive çš„é›†æˆå¿…ä¸å¯å°‘ã€‚åœ¨ 1.9 ç‰ˆæœ¬çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¾ˆå¼€å¿ƒè¿æ¥äº†ä¸¤ä½ Apache Hive PMC æ¥æ¨è¿› Flink å’Œ Hive çš„é›†æˆå·¥ä½œã€‚ é¦–å…ˆè¦è§£å†³çš„æ˜¯ä½¿ç”¨ Flink è¯»å– Hive æ•°æ®çš„é—®é¢˜ã€‚é€šè¿‡ FLIP-30 æå‡ºçš„ç»Ÿä¸€çš„ Catalog API çš„å¸®åŠ©ï¼Œç›®å‰ Flink å·²ç»å®Œæ•´æ‰“é€šäº†å¯¹ Hive Meta Store çš„è®¿é—®ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¢åŠ äº† Hive çš„ Connectorï¼Œç›®å‰å·²æ”¯æŒ CSV, Sequence File, Orc, Parquet ç­‰æ ¼å¼ã€‚ç”¨æˆ·åªéœ€è¦é…ç½® HMS çš„è®¿é—®æ–¹å¼ï¼Œå°±å¯ä»¥ä½¿ç”¨ Flink ç›´æ¥è¯»å– Hive çš„è¡¨è¿›è¡Œæ“ä½œã€‚åœ¨æ­¤åŸºç¡€ä¹‹ä¸Šï¼ŒFlink è¿˜å¢åŠ äº†å¯¹ Hive è‡ªå®šä¹‰å‡½æ•°çš„å…¼å®¹ï¼Œåƒ UDFï¼Œ UDTFå’Œ UDAFï¼Œéƒ½å¯ä»¥ç›´æ¥è¿è¡Œåœ¨Flink SQLé‡Œã€‚ åœ¨å†™çš„æ”¯æŒä¸Šï¼Œç›®å‰Flink è¿˜æ”¯æŒçš„æ¯”è¾ƒç®€å•ï¼Œæš‚æ—¶åªèƒ½ INSERT INTO ä¸€å¼ æ–°è¡¨ã€‚ä¸è¿‡å’Œ Hive çš„å…¼å®¹ä¸€ç›´æ˜¯ç¤¾åŒºå·¥ä½œä¸­ä¸€ä¸ªé«˜ä¼˜å…ˆçº§çš„äº‹æƒ…ï¼Œç›¸ä¿¡åç»­çš„ç‰ˆæœ¬ä¼šæœ‰æŒç»­çš„æ”¹å–„ã€‚ æ€»ç»“Flink1.9.0 ç‰ˆæœ¬ç»è¿‡å¤§åŠå¹´çš„ç´§å¼ å¼€å‘ï¼Œç»ˆäºé¡ºåˆ©å‘å¸ƒã€‚åœ¨è¿™è¿‡ç¨‹ä¸­ï¼ŒFlink ç¤¾åŒºä¸ä»…è¿æ¥äº†ç›¸å½“å¤šçš„ä¸­å›½å¼€å‘è€…å’Œç”¨æˆ·ï¼Œè¿˜è¿æ¥äº†æµ·é‡çš„ä»£ç è´¡çŒ®ï¼Œé¢„ç¤ºç€ä¸€ä¸ªè‰¯å¥½çš„å¼€ç«¯ã€‚æœªæ¥ï¼Œæ— è®ºæ˜¯åŠŸèƒ½è¿˜æ˜¯ç”Ÿæ€ï¼Œæˆ‘ä»¬ä¼šç»§ç»­åœ¨ Flink ç¤¾åŒºåŠ å¤§æŠ•å…¥ï¼Œè®© Flink åœ¨æ•´ä¸ªä¸­å›½ä¹ƒè‡³å…¨ä¸–ç•Œå¤§è§„æ¨¡çš„ä½¿ç”¨èµ·æ¥ã€‚æˆ‘ä»¬ä¹Ÿè¡·å¿ƒå¸Œæœ›æœ‰æ›´å¤šçš„å¼€å‘è€…å¯ä»¥åŠ å…¥æˆ‘ä»¬ï¼ŒåŠ å…¥Flink ç¤¾åŒºï¼Œä¸€èµ·æŠŠ Apache Flink åšçš„è¶Šæ¥è¶Šå¥½ï¼ å…³æ³¨æˆ‘å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ ä¸“æ ä»‹ç»é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f Github ä»£ç ä»“åº“https://github.com/zhisheng17/flink-learning/ ä»¥åè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç éƒ½å°†æ”¾åœ¨è¿™ä¸ªä»“åº“é‡Œï¼ŒåŒ…å«äº†è‡ªå·±å­¦ä¹  flink çš„ä¸€äº› demo å’Œåšå®¢ åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€åŸç†ã€å®æˆ˜ã€æ€§èƒ½è°ƒä¼˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"}]},{"title":"ä¸€æ–‡ææ‡‚ Flink çš„ Exactly Once å’Œ At Least Once","date":"2019-08-20T16:00:00.000Z","path":"2019/08/21/Flink-Exactly_Once_vs_At_Least_Once/","text":"æœ¬æ–‡ä¸»è¦ä¸ºäº†è®©ä½ ææ‡‚ Flink çš„ Exactly Once å’Œ At Least Onceï¼Œå¦‚æœçœ‹å®Œä¹‹åï¼Œä½ æœ‰ä»€ä¹ˆä¸æ‡‚çš„ï¼Œå¯ä»¥ç•™è¨€ æœ¬æ–‡ç”±çŸ¥è¯†æ˜Ÿçƒå°ä¼™ä¼´ èŒƒç‘ æŠ•ç¨¿ï¼ŒåŸæ–‡åœ°å€ï¼šhttps://www.jianshu.com/p/8d6569361999 çœ‹å®Œæœ¬æ–‡ï¼Œä½ èƒ½ get åˆ°ä»¥ä¸‹çŸ¥è¯† ä»‹ç» CheckPoint å¦‚ä½•ä¿éšœ Flink ä»»åŠ¡çš„é«˜å¯ç”¨ CheckPoint ä¸­çš„çŠ¶æ€ç®€ä»‹ å¦‚ä½•å®ç°å…¨åŸŸä¸€è‡´çš„åˆ†å¸ƒå¼å¿«ç…§ï¼Ÿ ä»€ä¹ˆæ˜¯ barrierï¼Ÿä»€ä¹ˆæ˜¯ barrier å¯¹é½ï¼Ÿ è¯æ˜äº†ï¼šä¸ºä»€ä¹ˆ barrier å¯¹é½å°±æ˜¯ Exactly Onceï¼Ÿä¸ºä»€ä¹ˆ barrier ä¸å¯¹é½å°±æ˜¯ At Least Onceï¼Ÿ Flinkç®€ä»‹æœ‰çŠ¶æ€å‡½æ•°å’Œè¿ç®—ç¬¦åœ¨å„ä¸ªå…ƒç´ /äº‹ä»¶çš„å¤„ç†ä¸­å­˜å‚¨æ•°æ®ï¼ˆçŠ¶æ€æ•°æ®å¯ä»¥ä¿®æ”¹å’ŒæŸ¥è¯¢ï¼Œå¯ä»¥è‡ªå·±ç»´æŠ¤ï¼Œæ ¹æ®è‡ªå·±çš„ä¸šåŠ¡åœºæ™¯ï¼Œä¿å­˜å†å²æ•°æ®æˆ–è€…ä¸­é—´ç»“æœåˆ°çŠ¶æ€ä¸­ï¼‰ ä¾‹å¦‚ï¼š å½“åº”ç”¨ç¨‹åºæœç´¢æŸäº›äº‹ä»¶æ¨¡å¼æ—¶ï¼ŒçŠ¶æ€å°†å­˜å‚¨åˆ°ç›®å‰ä¸ºæ­¢é‡åˆ°çš„äº‹ä»¶åºåˆ—ã€‚ åœ¨æ¯åˆ†é’Ÿ/å°æ—¶/å¤©èšåˆäº‹ä»¶æ—¶ï¼ŒçŠ¶æ€ä¿å­˜å¾…å¤„ç†çš„èšåˆã€‚ å½“åœ¨æ•°æ®ç‚¹æµä¸Šè®­ç»ƒæœºå™¨å­¦ä¹ æ¨¡å‹æ—¶ï¼ŒçŠ¶æ€ä¿æŒæ¨¡å‹å‚æ•°çš„å½“å‰ç‰ˆæœ¬ã€‚ å½“éœ€è¦ç®¡ç†å†å²æ•°æ®æ—¶ï¼ŒçŠ¶æ€å…è®¸æœ‰æ•ˆè®¿é—®è¿‡å»å‘ç”Ÿçš„äº‹ä»¶ã€‚ ä»€ä¹ˆæ˜¯çŠ¶æ€ï¼Ÿ æ— çŠ¶æ€è®¡ç®—çš„ä¾‹å­ æ¯”å¦‚ï¼šæˆ‘ä»¬åªæ˜¯è¿›è¡Œä¸€ä¸ªå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œè¾“å…¥ aï¼Œè¾“å‡º a_666,è¾“å…¥bï¼Œè¾“å‡º b_666 è¾“å‡ºçš„ç»“æœè·Ÿä¹‹å‰çš„çŠ¶æ€æ²¡å…³ç³»ï¼Œç¬¦åˆå¹‚ç­‰æ€§ã€‚ å¹‚ç­‰æ€§ï¼šå°±æ˜¯ç”¨æˆ·å¯¹äºåŒä¸€æ“ä½œå‘èµ·çš„ä¸€æ¬¡è¯·æ±‚æˆ–è€…å¤šæ¬¡è¯·æ±‚çš„ç»“æœæ˜¯ä¸€è‡´çš„ï¼Œä¸ä¼šå› ä¸ºå¤šæ¬¡ç‚¹å‡»è€Œäº§ç”Ÿäº†å‰¯ä½œç”¨ æœ‰çŠ¶æ€è®¡ç®—çš„ä¾‹å­ è®¡ç®—pvã€uv è¾“å‡ºçš„ç»“æœè·Ÿä¹‹å‰çš„çŠ¶æ€æœ‰å…³ç³»ï¼Œä¸ç¬¦åˆå¹‚ç­‰æ€§ï¼Œè®¿é—®å¤šæ¬¡ï¼Œpvä¼šå¢åŠ  Flinkçš„CheckPointåŠŸèƒ½ç®€ä»‹ Flink CheckPoint çš„å­˜åœ¨å°±æ˜¯ä¸ºäº†è§£å†³flinkä»»åŠ¡failoveræ‰ä¹‹åï¼Œèƒ½å¤Ÿæ­£å¸¸æ¢å¤ä»»åŠ¡ã€‚é‚£CheckPointå…·ä½“åšäº†å“ªäº›åŠŸèƒ½ï¼Œä¸ºä»€ä¹ˆä»»åŠ¡æŒ‚æ‰ä¹‹åï¼Œé€šè¿‡CheckPointèƒ½ä½¿å¾—ä»»åŠ¡æ¢å¤å‘¢ï¼Ÿ CheckPointæ˜¯é€šè¿‡ç»™ç¨‹åºå¿«ç…§çš„æ–¹å¼ä½¿å¾—å°†å†å²æŸäº›æ—¶åˆ»çš„çŠ¶æ€ä¿å­˜ä¸‹æ¥ï¼Œå½“ä»»åŠ¡æŒ‚æ‰ä¹‹åï¼Œé»˜è®¤ä»æœ€è¿‘ä¸€æ¬¡ä¿å­˜çš„å®Œæ•´å¿«ç…§å¤„è¿›è¡Œæ¢å¤ä»»åŠ¡ã€‚é—®é¢˜æ¥äº†ï¼Œå¿«ç…§æ˜¯ä»€ä¹ˆé¬¼ï¼Ÿèƒ½åƒå—ï¼Ÿ SnapShotç¿»è¯‘ä¸ºå¿«ç…§ï¼ŒæŒ‡å°†ç¨‹åºä¸­æŸäº›ä¿¡æ¯å­˜ä¸€ä»½ï¼ŒåæœŸå¯ä»¥ç”¨æ¥æ¢å¤ã€‚å¯¹äºä¸€ä¸ªFlinkä»»åŠ¡æ¥è®²ï¼Œå¿«ç…§é‡Œé¢åˆ°åº•ä¿å­˜ç€ä»€ä¹ˆä¿¡æ¯å‘¢ï¼Ÿ æ™¦æ¶©éš¾æ‡‚çš„æ¦‚å¿µæ€ä¹ˆåŠï¼Ÿå½“ç„¶ç”¨æ¡ˆä¾‹æ¥ä»£æ›¿å’¯ï¼Œç”¨æ¡ˆä¾‹è®©å¤§å®¶ç†è§£å¿«ç…§é‡Œé¢åˆ°åº•å­˜ä»€ä¹ˆä¿¡æ¯ã€‚é€‰ä¸€ä¸ªå¤§å®¶éƒ½æ¯”è¾ƒæ¸…æ¥šçš„æŒ‡æ ‡ï¼Œappçš„pvï¼Œflinkè¯¥æ€ä¹ˆç»Ÿè®¡å‘¢ï¼Ÿ æˆ‘ä»¬ä»Kafkaè¯»å–åˆ°ä¸€æ¡æ¡çš„æ—¥å¿—ï¼Œä»æ—¥å¿—ä¸­è§£æå‡ºapp_idï¼Œç„¶åå°†ç»Ÿè®¡çš„ç»“æœæ”¾åˆ°å†…å­˜ä¸­ä¸€ä¸ªMapé›†åˆï¼Œapp_idåšä¸ºkeyï¼Œå¯¹åº”çš„pvåšä¸ºvalueï¼Œæ¯æ¬¡åªéœ€è¦å°†ç›¸åº”app_id çš„pvå€¼+1åputåˆ°Mapä¸­å³å¯ flinkçš„Source taskè®°å½•äº†å½“å‰æ¶ˆè´¹åˆ°kafka test topicçš„æ‰€æœ‰partitionçš„offsetï¼Œä¸ºäº†æ–¹ä¾¿ç†è§£CheckPointçš„ä½œç”¨ï¼Œè¿™é‡Œå…ˆç”¨ä¸€ä¸ªpartitionè¿›è¡Œè®²è§£ï¼Œå‡è®¾åä¸º â€œtestâ€çš„ topicåªæœ‰ä¸€ä¸ªpartition0 ä¾‹ï¼šï¼ˆ0ï¼Œ1000ï¼‰ è¡¨ç¤º0å·partitionç›®å‰æ¶ˆè´¹åˆ°offsetä¸º1000çš„æ•°æ® flinkçš„pv taskè®°å½•äº†å½“å‰è®¡ç®—çš„å„appçš„pvå€¼ï¼Œä¸ºäº†æ–¹ä¾¿è®²è§£ï¼Œæˆ‘è¿™é‡Œæœ‰ä¸¤ä¸ªappï¼šapp1ã€app2 ä¾‹ï¼šï¼ˆapp1ï¼Œ50000ï¼‰ï¼ˆapp2ï¼Œ10000ï¼‰ è¡¨ç¤ºapp1å½“å‰pvå€¼ä¸º50000 è¡¨ç¤ºapp2å½“å‰pvå€¼ä¸º10000 æ¯æ¥ä¸€æ¡æ•°æ®ï¼Œåªéœ€è¦ç¡®å®šç›¸åº”app_idï¼Œå°†ç›¸åº”çš„valueå€¼+1åputåˆ°mapä¸­å³å¯ è¯¥æ¡ˆä¾‹ä¸­ï¼ŒCheckPointåˆ°åº•è®°å½•äº†ä»€ä¹ˆä¿¡æ¯å‘¢ï¼Ÿ offsetï¼šï¼ˆ0ï¼Œ1000ï¼‰ pvï¼šï¼ˆapp1ï¼Œ50000ï¼‰ï¼ˆapp2ï¼Œ10000ï¼‰ è®°å½•çš„å…¶å®å°±æ˜¯ç¬¬næ¬¡CheckPointæ¶ˆè´¹çš„offsetä¿¡æ¯å’Œå„appçš„pvå€¼ä¿¡æ¯ï¼Œè®°å½•ä¸€ä¸‹å‘ç”ŸCheckPointå½“å‰çš„çŠ¶æ€ä¿¡æ¯ï¼Œå¹¶å°†è¯¥çŠ¶æ€ä¿¡æ¯ä¿å­˜åˆ°ç›¸åº”çš„çŠ¶æ€åç«¯ã€‚ï¼ˆæ³¨ï¼šçŠ¶æ€åç«¯æ˜¯ä¿å­˜çŠ¶æ€çš„åœ°æ–¹ï¼Œå†³å®šçŠ¶æ€å¦‚ä½•ä¿å­˜ï¼Œå¦‚ä½•ä¿éšœçŠ¶æ€é«˜å¯ç”¨ï¼Œæˆ‘ä»¬åªéœ€è¦çŸ¥é“ï¼Œæˆ‘ä»¬èƒ½ä»çŠ¶æ€åç«¯æ‹¿åˆ°offsetä¿¡æ¯å’Œpvä¿¡æ¯å³å¯ã€‚çŠ¶æ€åç«¯å¿…é¡»æ˜¯é«˜å¯ç”¨çš„ï¼Œå¦åˆ™æˆ‘ä»¬çš„çŠ¶æ€åç«¯ç»å¸¸å‡ºç°æ•…éšœï¼Œä¼šå¯¼è‡´æ— æ³•é€šè¿‡checkpointæ¥æ¢å¤æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼‰ chk-100 è¯¥çŠ¶æ€ä¿¡æ¯è¡¨ç¤ºç¬¬100æ¬¡CheckPointçš„æ—¶å€™ï¼Œ partition 0 offsetæ¶ˆè´¹åˆ°äº†1000ï¼Œpvç»Ÿè®¡ç»“æœä¸ºï¼ˆapp1ï¼Œ50000ï¼‰ï¼ˆapp2ï¼Œ10000ï¼‰ ä»»åŠ¡æŒ‚äº†ï¼Œå¦‚ä½•æ¢å¤ï¼Ÿ å‡å¦‚æˆ‘ä»¬è®¾ç½®äº†ä¸‰åˆ†é’Ÿè¿›è¡Œä¸€æ¬¡CheckPointï¼Œä¿å­˜äº†ä¸Šè¿°æ‰€è¯´çš„ chk-100 çš„CheckPointçŠ¶æ€åï¼Œè¿‡äº†åç§’é’Ÿï¼Œoffsetå·²ç»æ¶ˆè´¹åˆ° ï¼ˆ0ï¼Œ1100ï¼‰ï¼Œpvç»Ÿè®¡ç»“æœå˜æˆäº†ï¼ˆapp1ï¼Œ50080ï¼‰ï¼ˆapp2ï¼Œ10020ï¼‰ï¼Œä½†æ˜¯çªç„¶ä»»åŠ¡æŒ‚äº†ï¼Œæ€ä¹ˆåŠï¼Ÿ è«æ…Œï¼Œå…¶å®å¾ˆç®€å•ï¼Œflinkåªéœ€è¦ä»æœ€è¿‘ä¸€æ¬¡æˆåŠŸçš„CheckPointä¿å­˜çš„offsetï¼ˆ0ï¼Œ1000ï¼‰å¤„æ¥ç€æ¶ˆè´¹å³å¯ï¼Œå½“ç„¶pvå€¼ä¹Ÿè¦æŒ‰ç…§çŠ¶æ€é‡Œçš„pvå€¼ï¼ˆapp1ï¼Œ50000ï¼‰ï¼ˆapp2ï¼Œ10000ï¼‰è¿›è¡Œç´¯åŠ ï¼Œä¸èƒ½ä»ï¼ˆapp1ï¼Œ50080ï¼‰ï¼ˆapp2ï¼Œ10020ï¼‰å¤„è¿›è¡Œç´¯åŠ ï¼Œå› ä¸º partition 0 offsetæ¶ˆè´¹åˆ° 1000æ—¶ï¼Œpvç»Ÿè®¡ç»“æœä¸ºï¼ˆapp1ï¼Œ50000ï¼‰ï¼ˆapp2ï¼Œ10000ï¼‰ å½“ç„¶å¦‚æœä½ æƒ³ä»offset ï¼ˆ0ï¼Œ1100ï¼‰pvï¼ˆapp1ï¼Œ50080ï¼‰ï¼ˆapp2ï¼Œ10020ï¼‰è¿™ä¸ªçŠ¶æ€æ¢å¤ï¼Œä¹Ÿæ˜¯åšä¸åˆ°çš„ï¼Œå› ä¸ºé‚£ä¸ªæ—¶åˆ»ç¨‹åºçªç„¶æŒ‚äº†ï¼Œè¿™ä¸ªçŠ¶æ€æ ¹æœ¬æ²¡æœ‰ä¿å­˜ä¸‹æ¥ã€‚æˆ‘ä»¬èƒ½åšçš„æœ€é«˜æ•ˆæ–¹å¼å°±æ˜¯ä»æœ€è¿‘ä¸€æ¬¡æˆåŠŸçš„CheckPointå¤„æ¢å¤ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä¸€ç›´æ‰€è¯´çš„chk-100 ä»¥ä¸Šè®²è§£ï¼ŒåŸºæœ¬å°±æ˜¯CheckPointæ‰¿æ‹…çš„å·¥ä½œï¼Œæè¿°çš„åœºæ™¯æ¯”è¾ƒç®€å• ç–‘é—®ï¼Œè®¡ç®—pvçš„taskåœ¨ä¸€ç›´è¿è¡Œï¼Œå®ƒæ€ä¹ˆçŸ¥é“ä»€ä¹ˆæ—¶å€™å»åšè¿™ä¸ªå¿«ç…§ï¼Ÿæˆ–è€…è¯´è®¡ç®—pvçš„taskæ€ä¹ˆä¿éšœå®ƒè‡ªå·±è®¡ç®—çš„pvå€¼ï¼ˆapp1ï¼Œ50000ï¼‰ï¼ˆapp2ï¼Œ10000ï¼‰å°±æ˜¯offsetï¼ˆ0ï¼Œ1000ï¼‰é‚£ä¸€åˆ»çš„ç»Ÿè®¡ç»“æœå‘¢ï¼Ÿ + barrierä»Source Taskå¤„ç”Ÿæˆï¼Œä¸€ç›´æµåˆ°Sink Taskï¼ŒæœŸé—´æ‰€æœ‰çš„Taskåªè¦ç¢°åˆ°barrierï¼Œå°±ä¼šè§¦å‘è‡ªèº«è¿›è¡Œå¿«ç…§ + CheckPoint barrier n-1å¤„åšçš„å¿«ç…§å°±æ˜¯æŒ‡Jobä»å¼€å§‹å¤„ç†åˆ° barrier n-1æ‰€æœ‰çš„çŠ¶æ€æ•°æ® + barrier n å¤„åšçš„å¿«ç…§å°±æ˜¯æŒ‡ä»Jobå¼€å§‹åˆ°å¤„ç†åˆ° barrier næ‰€æœ‰çš„çŠ¶æ€æ•°æ® + å¯¹åº”åˆ°pvæ¡ˆä¾‹ä¸­å°±æ˜¯ï¼ŒSource Taskæ¥æ”¶åˆ°JobManagerçš„ç¼–å·ä¸ºchk-100çš„CheckPointè§¦å‘è¯·æ±‚åï¼Œå‘ç°è‡ªå·±æ°å¥½æ¥æ”¶åˆ°kafka offsetï¼ˆ0ï¼Œ1000ï¼‰å¤„çš„æ•°æ®ï¼Œæ‰€ä»¥ä¼šå¾€offsetï¼ˆ0ï¼Œ1000ï¼‰æ•°æ®ä¹‹åoffsetï¼ˆ0ï¼Œ1001ï¼‰æ•°æ®ä¹‹å‰å®‰æ’ä¸€ä¸ªbarrierï¼Œç„¶åè‡ªå·±å¼€å§‹åšå¿«ç…§ï¼Œä¹Ÿå°±æ˜¯å°†offsetï¼ˆ0ï¼Œ1000ï¼‰ä¿å­˜åˆ°çŠ¶æ€åç«¯chk-100ä¸­ã€‚ç„¶åbarrieræ¥ç€å¾€ä¸‹æ¸¸å‘é€ï¼Œå½“ç»Ÿè®¡pvçš„taskæ¥æ”¶åˆ°barrieråï¼Œä¹Ÿä¼šæš‚åœå¤„ç†æ•°æ®ï¼Œå°†è‡ªå·±å†…å­˜ä¸­ä¿å­˜çš„pvä¿¡æ¯ï¼ˆapp1ï¼Œ50000ï¼‰ï¼ˆapp2ï¼Œ10000ï¼‰ä¿å­˜åˆ°çŠ¶æ€åç«¯chk-100ä¸­ã€‚OKï¼Œflinkå¤§æ¦‚å°±æ˜¯é€šè¿‡è¿™ä¸ªåŸç†æ¥ä¿å­˜å¿«ç…§çš„ + ç»Ÿè®¡pvçš„taskæ¥æ”¶åˆ°barrierï¼Œå°±æ„å‘³ç€barrierä¹‹å‰çš„æ•°æ®éƒ½å¤„ç†äº†ï¼Œæ‰€ä»¥è¯´ï¼Œä¸ä¼šå‡ºç°ä¸¢æ•°æ®çš„æƒ…å†µ + barrierçš„ä½œç”¨å°±æ˜¯ä¸ºäº†æŠŠæ•°æ®åŒºåˆ†å¼€ï¼ŒCheckPointè¿‡ç¨‹ä¸­æœ‰ä¸€ä¸ªåŒæ­¥åšå¿«ç…§çš„ç¯èŠ‚ä¸èƒ½å¤„ç†barrierä¹‹åçš„æ•°æ®ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ + å¦‚æœåšå¿«ç…§çš„åŒæ—¶ï¼Œä¹Ÿåœ¨å¤„ç†æ•°æ®ï¼Œé‚£ä¹ˆå¤„ç†çš„æ•°æ®å¯èƒ½ä¼šä¿®æ”¹å¿«ç…§å†…å®¹ï¼Œæ‰€ä»¥å…ˆæš‚åœå¤„ç†æ•°æ®ï¼ŒæŠŠå†…å­˜ä¸­å¿«ç…§ä¿å­˜å¥½åï¼Œå†å¤„ç†æ•°æ® + ç»“åˆæ¡ˆä¾‹æ¥è®²å°±æ˜¯ï¼Œç»Ÿè®¡pvçš„taskæƒ³å¯¹ï¼ˆapp1ï¼Œ50000ï¼‰ï¼ˆapp2ï¼Œ10000ï¼‰åšå¿«ç…§ï¼Œä½†æ˜¯å¦‚æœæ•°æ®è¿˜åœ¨å¤„ç†ï¼Œå¯èƒ½å¿«ç…§è¿˜æ²¡ä¿å­˜ä¸‹æ¥ï¼ŒçŠ¶æ€å·²ç»å˜æˆäº†ï¼ˆapp1ï¼Œ50001ï¼‰ï¼ˆapp2ï¼Œ10001ï¼‰ï¼Œå¿«ç…§å°±ä¸å‡†ç¡®äº†ï¼Œå°±ä¸èƒ½ä¿éšœExactly Onceäº† + flinkæ˜¯åœ¨æ•°æ®ä¸­åŠ äº†ä¸€ä¸ªå«åšbarrierçš„ä¸œè¥¿ï¼ˆbarrierä¸­æ–‡ç¿»è¯‘ï¼šæ …æ ï¼‰ï¼Œä¸‹å›¾ä¸­çº¢åœˆå¤„å°±æ˜¯ä¸¤ä¸ªbarrier æ€»ç»“ æµå¼è®¡ç®—ä¸­çŠ¶æ€äº¤äº’ ç®€æ˜“åœºæ™¯ç²¾ç¡®ä¸€æ¬¡çš„å®¹é”™æ–¹æ³• + æ¶ˆè´¹åˆ°Yä½ç½®çš„æ—¶å€™ï¼Œå°†Yå¯¹åº”çš„çŠ¶æ€ä¿å­˜ä¸‹æ¥ + æ¶ˆè´¹åˆ°Xä½ç½®çš„æ—¶å€™ï¼Œå°†Xå¯¹åº”çš„çŠ¶æ€ä¿å­˜ä¸‹æ¥ + å‘¨æœŸæ€§åœ°å¯¹æ¶ˆè´¹offsetå’Œç»Ÿè®¡çš„çŠ¶æ€ä¿¡æ¯æˆ–ç»Ÿè®¡ç»“æœè¿›è¡Œå¿«ç…§ å¤šå¹¶è¡Œåº¦ã€å¤šOperatoræƒ…å†µä¸‹ï¼ŒCheckPointè¿‡ç¨‹ åˆ†å¸ƒå¼çŠ¶æ€å®¹é”™é¢ä¸´çš„é—®é¢˜ä¸æŒ‘æˆ˜ å¦‚ä½•ç¡®ä¿çŠ¶æ€æ‹¥æœ‰ç²¾ç¡®ä¸€æ¬¡çš„å®¹é”™ä¿è¯ï¼Ÿ å¦‚ä½•åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹æ›¿å¤šä¸ªæ‹¥æœ‰æœ¬åœ°çŠ¶æ€çš„ç®—å­äº§ç”Ÿä¸€ä¸ªå…¨åŸŸä¸€è‡´çš„å¿«ç…§ï¼Ÿ å¦‚ä½•åœ¨ä¸ä¸­æ–­è¿ç®—çš„å‰æä¸‹äº§ç”Ÿå¿«ç…§ï¼Ÿ å¤šå¹¶è¡Œåº¦ã€å¤šOperatorå®ä¾‹çš„æƒ…å†µä¸‹ï¼Œå¦‚ä½•åšå…¨åŸŸä¸€è‡´çš„å¿«ç…§ æ‰€æœ‰çš„Operatorè¿è¡Œè¿‡ç¨‹ä¸­é‡åˆ°barrieråï¼Œéƒ½å¯¹è‡ªèº«çš„çŠ¶æ€è¿›è¡Œä¸€æ¬¡å¿«ç…§ï¼Œä¿å­˜åˆ°ç›¸åº”çŠ¶æ€åç«¯ + å¯¹åº”åˆ°pvæ¡ˆä¾‹ï¼šæœ‰çš„Operatorè®¡ç®—çš„app1çš„pvï¼Œæœ‰çš„Operatorè®¡ç®—çš„app2çš„pvï¼Œå½“ä»–ä»¬ç¢°åˆ°barrieræ—¶ï¼Œéƒ½éœ€è¦å°†ç›®å‰ç»Ÿè®¡çš„pvä¿¡æ¯å¿«ç…§åˆ°çŠ¶æ€åç«¯ å¤šOperatorçŠ¶æ€æ¢å¤ å…·ä½“æ€ä¹ˆåšè¿™ä¸ªå¿«ç…§å‘¢ï¼Ÿ åˆ©ç”¨ä¹‹å‰æ‰€æœ‰çš„barrierç­–ç•¥ JobManagerå‘Source Taskå‘é€CheckPointTriggerï¼ŒSource Taskä¼šåœ¨æ•°æ®æµä¸­å®‰æ’CheckPoint barrier Source Taskè‡ªèº«åšå¿«ç…§ï¼Œå¹¶ä¿å­˜åˆ°çŠ¶æ€åç«¯ Source Taskå°†barrierè·Ÿæ•°æ®æµä¸€å—å¾€ä¸‹æ¸¸å‘é€ å½“ä¸‹æ¸¸çš„Operatorå®ä¾‹æ¥æ”¶åˆ°CheckPoint barrieråï¼Œå¯¹è‡ªèº«åšå¿«ç…§ ä¸Šè¿°å›¾ä¸­ï¼Œæœ‰4ä¸ªå¸¦çŠ¶æ€çš„Operatorå®ä¾‹ï¼Œç›¸åº”çš„çŠ¶æ€åç«¯å°±å¯ä»¥æƒ³è±¡æˆå¡«4ä¸ªæ ¼å­ã€‚æ•´ä¸ªCheckPoint çš„è¿‡ç¨‹å¯ä»¥å½“åšOperatorå®ä¾‹å¡«è‡ªå·±æ ¼å­çš„è¿‡ç¨‹ï¼ŒOperatorå®ä¾‹å°†è‡ªèº«çš„çŠ¶æ€å†™åˆ°çŠ¶æ€åç«¯ä¸­ç›¸åº”çš„æ ¼å­ï¼Œå½“æ‰€æœ‰çš„æ ¼å­å¡«æ»¡å¯ä»¥ç®€å•çš„è®¤ä¸ºä¸€æ¬¡å®Œæ•´çš„CheckPointåšå®Œäº† ä¸Šé¢åªæ˜¯å¿«ç…§çš„è¿‡ç¨‹ï¼Œæ•´ä¸ªCheckPointæ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ 1ã€JobManagerç«¯çš„ CheckPointCoordinatorå‘ æ‰€æœ‰SourceTaskå‘é€CheckPointTriggerï¼ŒSource Taskä¼šåœ¨æ•°æ®æµä¸­å®‰æ’CheckPoint barrier 2ã€å½“taskæ”¶åˆ°æ‰€æœ‰çš„barrieråï¼Œå‘è‡ªå·±çš„ä¸‹æ¸¸ç»§ç»­ä¼ é€’barrierï¼Œç„¶åè‡ªèº«æ‰§è¡Œå¿«ç…§ï¼Œå¹¶å°†è‡ªå·±çš„çŠ¶æ€å¼‚æ­¥å†™å…¥åˆ°æŒä¹…åŒ–å­˜å‚¨ä¸­ å¢é‡CheckPointåªæ˜¯æŠŠæœ€æ–°çš„ä¸€éƒ¨åˆ†æ›´æ–°å†™å…¥åˆ° å¤–éƒ¨å­˜å‚¨ ä¸ºäº†ä¸‹æ¸¸å°½å¿«åšCheckPointï¼Œæ‰€ä»¥ä¼šå…ˆå‘é€barrieråˆ°ä¸‹æ¸¸ï¼Œè‡ªèº«å†åŒæ­¥è¿›è¡Œå¿«ç…§ 3ã€å½“taskå®Œæˆå¤‡ä»½åï¼Œä¼šå°†å¤‡ä»½æ•°æ®çš„åœ°å€ï¼ˆstate handleï¼‰é€šçŸ¥ç»™JobManagerçš„CheckPointCoordinator å¦‚æœCheckPointçš„æŒç»­æ—¶é•¿è¶…è¿‡ äº†CheckPointè®¾å®šçš„è¶…æ—¶æ—¶é—´ï¼ŒCheckPointCoordinator è¿˜æ²¡æœ‰æ”¶é›†å®Œæ‰€æœ‰çš„ State Handleï¼ŒCheckPointCoordinatorå°±ä¼šè®¤ä¸ºæœ¬æ¬¡CheckPointå¤±è´¥ï¼Œä¼šæŠŠè¿™æ¬¡CheckPointäº§ç”Ÿçš„æ‰€æœ‰ çŠ¶æ€æ•°æ®å…¨éƒ¨åˆ é™¤ 4ã€ æœ€å CheckPoint Coordinator ä¼šæŠŠæ•´ä¸ª StateHandle å°è£…æˆ completed CheckPoint Metaï¼Œå†™å…¥åˆ°hdfs barrierå¯¹é½ ä»€ä¹ˆæ˜¯barrierå¯¹é½ï¼Ÿ + ä¸€æ—¦Operatorä»è¾“å…¥æµæ¥æ”¶åˆ°CheckPoint barrier nï¼Œå®ƒå°±ä¸èƒ½å¤„ç†æ¥è‡ªè¯¥æµçš„ä»»ä½•æ•°æ®è®°å½•ï¼Œç›´åˆ°å®ƒä»å…¶ä»–æ‰€æœ‰è¾“å…¥æ¥æ”¶åˆ°barrier nä¸ºæ­¢ã€‚å¦åˆ™ï¼Œå®ƒä¼šæ··åˆå±äºå¿«ç…§nçš„è®°å½•å’Œå±äºå¿«ç…§n + 1çš„è®°å½• + æ¥æ”¶åˆ°barrier nçš„æµæš‚æ—¶è¢«æç½®ã€‚ä»è¿™äº›æµæ¥æ”¶çš„è®°å½•ä¸ä¼šè¢«å¤„ç†ï¼Œè€Œæ˜¯æ”¾å…¥è¾“å…¥ç¼“å†²åŒºã€‚ + ä¸Šå›¾ä¸­ç¬¬2ä¸ªå›¾ï¼Œè™½ç„¶æ•°å­—æµå¯¹åº”çš„barrierå·²ç»åˆ°è¾¾äº†ï¼Œä½†æ˜¯barrierä¹‹åçš„1ã€2ã€3è¿™äº›æ•°æ®åªèƒ½æ”¾åˆ°bufferä¸­ï¼Œç­‰å¾…å­—æ¯æµçš„barrieråˆ°è¾¾ + ä¸€æ—¦æœ€åæ‰€æœ‰è¾“å…¥æµéƒ½æ¥æ”¶åˆ°barrier nï¼ŒOperatorå°±ä¼šæŠŠç¼“å†²åŒºä¸­pending çš„è¾“å‡ºæ•°æ®å‘å‡ºå»ï¼Œç„¶åæŠŠCheckPoint barrier næ¥ç€å¾€ä¸‹æ¸¸å‘é€ + è¿™é‡Œè¿˜ä¼šå¯¹è‡ªèº«è¿›è¡Œå¿«ç…§ + ä¹‹åï¼ŒOperatorå°†ç»§ç»­å¤„ç†æ¥è‡ªæ‰€æœ‰è¾“å…¥æµçš„è®°å½•ï¼Œåœ¨å¤„ç†æ¥è‡ªæµçš„è®°å½•ä¹‹å‰å…ˆå¤„ç†æ¥è‡ªè¾“å…¥ç¼“å†²åŒºçš„è®°å½• ä»€ä¹ˆæ˜¯barrierä¸å¯¹é½ï¼Ÿ ä¸Šè¿°å›¾2ä¸­ï¼Œå½“è¿˜æœ‰å…¶ä»–è¾“å…¥æµçš„barrierè¿˜æ²¡æœ‰åˆ°è¾¾æ—¶ï¼Œä¼šæŠŠå·²åˆ°è¾¾çš„barrierä¹‹åçš„æ•°æ®1ã€2ã€3æç½®åœ¨ç¼“å†²åŒºï¼Œç­‰å¾…å…¶ä»–æµçš„barrieråˆ°è¾¾åæ‰èƒ½å¤„ç† barrierä¸å¯¹é½å°±æ˜¯æŒ‡å½“è¿˜æœ‰å…¶ä»–æµçš„barrierè¿˜æ²¡åˆ°è¾¾æ—¶ï¼Œä¸ºäº†ä¸å½±å“æ€§èƒ½ï¼Œä¹Ÿä¸ç”¨ç†ä¼šï¼Œç›´æ¥å¤„ç†barrierä¹‹åçš„æ•°æ®ã€‚ç­‰åˆ°æ‰€æœ‰æµçš„barrierçš„éƒ½åˆ°è¾¾åï¼Œå°±å¯ä»¥å¯¹è¯¥OperatoråšCheckPointäº† ä¸ºä»€ä¹ˆè¦è¿›è¡Œbarrierå¯¹é½ï¼Ÿä¸å¯¹é½åˆ°åº•è¡Œä¸è¡Œï¼Ÿ ç­”ï¼šExactly Onceæ—¶å¿…é¡»barrierå¯¹é½ï¼Œå¦‚æœbarrierä¸å¯¹é½å°±å˜æˆäº†At Least Once åé¢çš„éƒ¨åˆ†ä¸»è¦è¯æ˜è¿™å¥è¯ CheckPointçš„ç›®çš„å°±æ˜¯ä¸ºäº†ä¿å­˜å¿«ç…§ï¼Œå¦‚æœä¸å¯¹é½ï¼Œé‚£ä¹ˆåœ¨chk-100å¿«ç…§ä¹‹å‰ï¼Œå·²ç»å¤„ç†äº†ä¸€äº›chk-100 å¯¹åº”çš„offsetä¹‹åçš„æ•°æ®ï¼Œå½“ç¨‹åºä»chk-100æ¢å¤ä»»åŠ¡æ—¶ï¼Œchk-100å¯¹åº”çš„offsetä¹‹åçš„æ•°æ®è¿˜ä¼šè¢«å¤„ç†ä¸€æ¬¡ï¼Œæ‰€ä»¥å°±å‡ºç°äº†é‡å¤æ¶ˆè´¹ã€‚å¦‚æœå¬ä¸æ‡‚æ²¡å…³ç³»ï¼Œåé¢æœ‰æ¡ˆä¾‹è®©æ‚¨æ‡‚ ç»“åˆpvæ¡ˆä¾‹æ¥çœ‹ï¼Œä¹‹å‰çš„æ¡ˆä¾‹ä¸ºäº†ç®€å•ï¼Œæè¿°çš„kafkaçš„topicåªæœ‰1ä¸ªpartitionï¼Œè¿™é‡Œä¸ºäº†è®²è¿°barrierå¯¹é½ï¼Œæ‰€ä»¥topicæœ‰2ä¸ªpartittion + Flink åŒæ ·ä¼šèµ·å››ä¸ªOperatorå®ä¾‹ï¼Œæˆ‘è¿˜ç§°ä»–ä»¬æ˜¯ TaskA0ã€TaskA1ã€TaskB0ã€TaskB1ã€‚å››ä¸ªOperatorä¼šä»çŠ¶æ€åç«¯è¯»å–ä¿å­˜çš„çŠ¶æ€ä¿¡æ¯ã€‚ + ä»offsetï¼š(0ï¼Œ10000)(1ï¼Œ10005) å¼€å§‹æ¶ˆè´¹ï¼Œå¹¶ä¸”åŸºäº pvï¼š(app0ï¼Œ8000) (app1ï¼Œ12050)å€¼è¿›è¡Œç´¯åŠ ç»Ÿè®¡ + ç„¶åä½ å°±åº”è¯¥ä¼šå‘ç°è¿™ä¸ªapp1çš„pvå€¼12050å®é™…ä¸Šå·²ç»åŒ…å«äº†partition1çš„offset 10005~10200çš„æ•°æ®ï¼Œæ‰€ä»¥partition1ä»offset 10005æ¢å¤ä»»åŠ¡æ—¶ï¼Œpartition1çš„offset 10005~10200çš„æ•°æ®è¢«æ¶ˆè´¹äº†ä¸¤æ¬¡ + TaskB1è®¾ç½®çš„barrierä¸å¯¹é½ï¼Œæ‰€ä»¥CheckPoint chk-100å¯¹åº”çš„çŠ¶æ€ä¸­å¤šæ¶ˆè´¹äº†barrierä¹‹åçš„ä¸€äº›æ•°æ®ï¼ˆTaskA1å‘é€ï¼‰ï¼Œé‡å¯åæ˜¯ä»chk-100ä¿å­˜çš„offsetæ¢å¤ï¼Œè¿™å°±æ˜¯æ‰€è¯´çš„At Least Once + ç”±äºä¸Šé¢è¯´TaskB0è®¾ç½®çš„barrierå¯¹é½ï¼Œæ‰€ä»¥app0ä¸ä¼šå‡ºç°é‡å¤æ¶ˆè´¹ï¼Œå› ä¸ºapp0æ²¡æœ‰æ¶ˆè´¹offsetï¼š(0ï¼Œ10000)(1ï¼Œ10005) ä¹‹åçš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„Exactly Once + chk-100 + offsetï¼š(0ï¼Œ10000)(1ï¼Œ10005) + pvï¼š(app0ï¼Œ8000) (app1ï¼Œ12050) + è™½ç„¶çŠ¶æ€ä¿å­˜çš„pvå€¼åé«˜äº†ï¼Œä½†æ˜¯ä¸èƒ½è¯´æ˜é‡å¤å¤„ç†ï¼Œå› ä¸ºæˆ‘çš„TaskA1å¹¶æ²¡æœ‰å†æ¬¡å»æ¶ˆè´¹partition1çš„offset 10005~10200çš„æ•°æ®ï¼Œæ‰€ä»¥ç›¸å½“äºä¹Ÿæ²¡æœ‰é‡å¤æ¶ˆè´¹ï¼Œåªæ˜¯å±•ç¤ºçš„ç»“æœæ›´å®æ—¶äº† + è¿™é‡Œå‡å¦‚TaskA0æ¶ˆè´¹çš„partition0çš„offsetä¸º10000ï¼ŒTaskA1æ¶ˆè´¹çš„partition1çš„offsetä¸º10005ã€‚é‚£ä¹ˆçŠ¶æ€ä¸­ä¼šä¿å­˜ (0ï¼Œ10000)(1ï¼Œ10005)ï¼Œè¡¨ç¤º0å·partitionæ¶ˆè´¹åˆ°äº†offsetä¸º10000çš„ä½ç½®ï¼Œ1å·partitionæ¶ˆè´¹åˆ°äº†offsetä¸º10005çš„ä½ç½® + ç»“åˆä¸šåŠ¡ï¼Œå…ˆä»‹ç»ä¸€ä¸‹ä¸Šè¿°æ‰€æœ‰ç®—å­åœ¨ä¸šåŠ¡ä¸­çš„åŠŸèƒ½ + Sourceçš„kafkaçš„Consumerï¼Œä»kakfaä¸­è¯»å–æ•°æ®åˆ°flinkåº”ç”¨ä¸­ + TaskAä¸­çš„mapå°†è¯»å–åˆ°çš„ä¸€æ¡kafkaæ—¥å¿—è½¬æ¢ä¸ºæˆ‘ä»¬éœ€è¦ç»Ÿè®¡çš„app_id + keyBy æŒ‰ç…§app_idè¿›è¡ŒkeyByï¼Œç›¸åŒçš„app_id ä¼šåˆ†åˆ°ä¸‹æ¸¸TaskBçš„åŒä¸€ä¸ªå®ä¾‹ä¸­ + TaskBçš„mapåœ¨çŠ¶æ€ä¸­æŸ¥å‡ºè¯¥app_id å¯¹åº”çš„pvå€¼ï¼Œç„¶å+1ï¼Œå­˜å‚¨åˆ°çŠ¶æ€ä¸­ + åˆ©ç”¨Sinkå°†ç»Ÿè®¡çš„pvå€¼å†™å…¥åˆ°å¤–éƒ¨å­˜å‚¨ä»‹è´¨ä¸­ + æˆ‘ä»¬ä»kafkaçš„ä¸¤ä¸ªpartitionæ¶ˆè´¹æ•°æ®ï¼ŒTaskAå’ŒTaskBéƒ½æœ‰ä¸¤ä¸ªå¹¶è¡Œåº¦ï¼Œæ‰€ä»¥æ€»å…±flinkæœ‰4ä¸ªOperatorå®ä¾‹ï¼Œè¿™é‡Œæˆ‘ä»¬ç§°ä¹‹ä¸º TaskA0ã€TaskA1ã€TaskB0ã€TaskB1 + å‡è®¾å·²ç»æˆåŠŸåšäº†99æ¬¡CheckPointï¼Œè¿™é‡Œè¯¦ç»†è§£é‡Šç¬¬100æ¬¡CheckPointè¿‡ç¨‹ + JobManagerå†…éƒ¨æœ‰ä¸ªå®šæ—¶è°ƒåº¦ï¼Œå‡å¦‚ç°åœ¨10ç‚¹00åˆ†00ç§’åˆ°äº†ç¬¬100æ¬¡CheckPointçš„æ—¶é—´äº†ï¼ŒJobManagerçš„CheckPointCoordinatorè¿›ç¨‹ä¼šå‘æ‰€æœ‰çš„Source Taskå‘é€CheckPointTriggerï¼Œä¹Ÿå°±æ˜¯å‘TaskA0ã€TaskA1å‘é€CheckPointTrigger + TaskA0ã€TaskA1æ¥æ”¶åˆ°CheckPointTriggerï¼Œä¼šå¾€æ•°æ®æµä¸­å®‰æ’barrierï¼Œå°†barrierå‘é€åˆ°ä¸‹æ¸¸ï¼Œåœ¨è‡ªå·±çš„çŠ¶æ€ä¸­è®°å½•barrierå®‰æ’çš„offsetä½ç½®ï¼Œç„¶åè‡ªèº«åšå¿«ç…§ï¼Œå°†offsetä¿¡æ¯ä¿å­˜åˆ°çŠ¶æ€åç«¯ + ç„¶åTaskAçš„mapå’ŒkeyByç®—å­ä¸­å¹¶æ²¡æœ‰çŠ¶æ€ï¼Œæ‰€ä»¥ä¸éœ€è¦è¿›è¡Œå¿«ç…§ + æ¥ç€æ•°æ®å’Œbarrieréƒ½å‘ä¸‹æ¸¸TaskBå‘é€ï¼Œç›¸åŒçš„app_id ä¼šå‘é€åˆ°ç›¸åŒçš„TaskBå®ä¾‹ä¸Šï¼Œè¿™é‡Œå‡è®¾æœ‰ä¸¤ä¸ªappï¼šapp0å’Œapp1ï¼Œç»è¿‡keyByåï¼Œå‡è®¾app0åˆ†åˆ°äº†TaskB0ä¸Šï¼Œapp1åˆ†åˆ°äº†TaskB1ä¸Šã€‚åŸºäºä¸Šé¢æè¿°ï¼ŒTaskA0å’ŒTaskA1ä¸­çš„æ‰€æœ‰app0çš„æ•°æ®éƒ½å‘é€åˆ°TaskB0ä¸Šï¼Œæ‰€æœ‰app1çš„æ•°æ®éƒ½å‘é€åˆ°TaskB1ä¸Š + ç°åœ¨æˆ‘ä»¬å‡è®¾TaskB0åšCheckPointçš„æ—¶å€™barrierå¯¹é½äº†ï¼ŒTaskB1åšCheckPointçš„æ—¶å€™barrierä¸å¯¹é½ï¼Œå½“ç„¶ä¸èƒ½è¿™ä¹ˆé…ç½®ï¼Œæˆ‘å°±æ˜¯ä¸¾è¿™ä¹ˆä¸ªä¾‹å­ï¼Œå¸¦å¤§å®¶åˆ†æä¸€ä¸‹barrierå¯¹ä¸å¯¹é½åˆ°åº•å¯¹ç»Ÿè®¡ç»“æœæœ‰ä»€ä¹ˆå½±å“ï¼Ÿ + ä¸Šé¢è¯´äº†chk-100çš„è¿™æ¬¡CheckPointï¼Œoffsetä½ç½®ä¸º(0ï¼Œ10000)(1ï¼Œ10005)ï¼ŒTaskB0ä½¿ç”¨barrierå¯¹é½ï¼Œä¹Ÿå°±æ˜¯è¯´TaskB0ä¸ä¼šå¤„ç†barrierä¹‹åçš„æ•°æ®ï¼Œæ‰€ä»¥TaskB0åœ¨chk-100å¿«ç…§çš„æ—¶å€™ï¼ŒçŠ¶æ€åç«¯ä¿å­˜çš„app0çš„pvæ•°æ®æ˜¯ä»ç¨‹åºå¼€å§‹å¯åŠ¨åˆ°kafka offsetä½ç½®ä¸º(0ï¼Œ10000)(1ï¼Œ10005)çš„æ‰€æœ‰æ•°æ®è®¡ç®—å‡ºæ¥çš„pvå€¼ï¼Œä¸€æ¡ä¸å¤šï¼ˆæ²¡å¤„ç†barrierä¹‹åï¼Œæ‰€ä»¥ä¸ä¼šé‡å¤ï¼‰ï¼Œä¸€æ¡ä¸å°‘(barrierä¹‹å‰çš„æ‰€æœ‰æ•°æ®éƒ½å¤„ç†äº†ï¼Œæ‰€ä»¥ä¸ä¼šä¸¢å¤±)ï¼Œå‡å¦‚ä¿å­˜çš„çŠ¶æ€ä¿¡æ¯ä¸º(app0ï¼Œ8000)è¡¨ç¤ºæ¶ˆè´¹åˆ°(0ï¼Œ10000)(1ï¼Œ10005)offsetçš„æ—¶å€™ï¼Œapp0çš„pvå€¼ä¸º8000 + TaskB1ä½¿ç”¨çš„barrierä¸å¯¹é½ï¼Œå‡å¦‚TaskA0ç”±äºæœåŠ¡å™¨çš„CPUæˆ–è€…ç½‘ç»œç­‰å…¶ä»–æ³¢åŠ¨ï¼Œå¯¼è‡´TaskA0å¤„ç†æ•°æ®è¾ƒæ…¢ï¼Œè€ŒTaskA1å¾ˆç¨³å®šï¼Œæ‰€ä»¥å¤„ç†æ•°æ®æ¯”è¾ƒå¿«ã€‚å¯¼è‡´çš„ç»“æœå°±æ˜¯TaskB1å…ˆæ¥æ”¶åˆ°äº†TaskA1çš„barrierï¼Œç”±äºé…ç½®çš„barrierä¸å¯¹é½ï¼Œæ‰€ä»¥TaskB1ä¼šæ¥ç€å¤„ç†TaskA1 barrierä¹‹åçš„æ•°æ®ï¼Œè¿‡äº†2ç§’åï¼ŒTaskB1æ¥æ”¶åˆ°äº†TaskA0çš„barrierï¼Œäºæ˜¯å¯¹çŠ¶æ€ä¸­å­˜å‚¨çš„app1çš„pvå€¼å¼€å§‹åšCheckPoint å¿«ç…§ï¼Œä¿å­˜çš„çŠ¶æ€ä¿¡æ¯ä¸º(app1ï¼Œ12050)ï¼Œä½†æ˜¯æˆ‘ä»¬çŸ¥é“è¿™ä¸ª(app1ï¼Œ12050)å®é™…ä¸Šå¤šå¤„ç†äº†2ç§’TaskA1å‘æ¥çš„barrierä¹‹åçš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯kafka topicå¯¹åº”çš„partition1 offset 10005ä¹‹åçš„æ•°æ®ï¼Œapp1çœŸå®çš„pvæ•°æ®è‚¯å®šè¦å°äºè¿™ä¸ª12050ï¼Œpartition1çš„offsetä¿å­˜çš„offsetè™½ç„¶æ˜¯10005ï¼Œä½†æ˜¯æˆ‘ä»¬å®é™…ä¸Šå¯èƒ½å·²ç»å¤„ç†åˆ°äº†offset 10200çš„æ•°æ®ï¼Œå‡è®¾å°±æ˜¯å¤„ç†åˆ°äº†10200 + åˆ†æåˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å…ˆæ¢³ç†ä¸€ä¸‹æˆ‘ä»¬çš„çŠ¶æ€ä¿å­˜äº†ä»€ä¹ˆï¼š + æ¥ç€ç¨‹åºåœ¨ç»§ç»­è¿è¡Œï¼Œè¿‡äº†10ç§’ï¼Œç”±äºæŸä¸ªæœåŠ¡å™¨æŒ‚äº†ï¼Œå¯¼è‡´æˆ‘ä»¬çš„å››ä¸ªOperatorå®ä¾‹æœ‰ä¸€ä¸ªOperatoræŒ‚äº†ï¼Œæ‰€ä»¥Flinkä¼šä»æœ€è¿‘ä¸€æ¬¡çš„çŠ¶æ€æ¢å¤ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åˆšåˆšè¯¦ç»†è®²çš„chk-100å¤„æ¢å¤ï¼Œé‚£å…·ä½“æ˜¯æ€ä¹ˆæ¢å¤çš„å‘¢ï¼Ÿ çœ‹åˆ°è¿™é‡Œä½ åº”è¯¥å·²ç»çŸ¥é“äº†å“ªç§æƒ…å†µä¼šå‡ºç°é‡å¤æ¶ˆè´¹äº†ï¼Œä¹Ÿåº”è¯¥è¦æŒæ¡ä¸ºä»€ä¹ˆbarrierå¯¹é½å°±æ˜¯Exactly Onceï¼Œä¸ºä»€ä¹ˆbarrierä¸å¯¹é½å°±æ˜¯ At Least Once åˆ†æäº†è¿™ä¹ˆå¤šï¼Œè¿™é‡Œæˆ‘å†è¡¥å……ä¸€ä¸ªé—®é¢˜ï¼Œåˆ°åº•ä»€ä¹ˆæ—¶å€™ä¼šå‡ºç°barrierå¯¹é½ï¼Ÿ é¦–å…ˆè®¾ç½®äº†Flinkçš„CheckPointè¯­ä¹‰æ˜¯ï¼šExactly Once Operatorå®ä¾‹å¿…é¡»æœ‰å¤šä¸ªè¾“å…¥æµæ‰ä¼šå‡ºç°barrierå¯¹é½ å¯¹é½ï¼Œæ±‰è¯­è¯æ±‡ï¼Œé‡Šä¹‰ä¸ºä½¿ä¸¤ä¸ªä»¥ä¸Šäº‹ç‰©é…åˆæˆ–æ¥è§¦å¾—æ•´é½ã€‚ç”±æ±‰è¯­è§£é‡Šå¯å¾—å¯¹é½è‚¯å®šéœ€è¦ä¸¤ä¸ªä»¥ä¸Šäº‹ç‰©ï¼Œæ‰€ä»¥ï¼Œå¿…é¡»æœ‰å¤šä¸ªæµæ‰å«å¯¹é½ã€‚barrierå¯¹é½å…¶å®ä¹Ÿå°±æ˜¯ä¸Šæ¸¸å¤šä¸ªæµé…åˆä½¿å¾—æ•°æ®å¯¹é½çš„è¿‡ç¨‹ è¨€å¤–ä¹‹æ„ï¼šå¦‚æœOperatorå®ä¾‹åªæœ‰ä¸€ä¸ªè¾“å…¥æµï¼Œå°±æ ¹æœ¬ä¸å­˜åœ¨barrierå¯¹é½ï¼Œè‡ªå·±è·Ÿè‡ªå·±é»˜è®¤æ°¸è¿œéƒ½æ˜¯å¯¹é½çš„ åšå®¢å‘å‡ºå»åï¼Œæ„Ÿè°¢ä¸Šæµ·å§œåŒå­¦æé—®çš„å‡ ä¸ªé—®é¢˜ï¼Œæœ€åè·Ÿå§œåŒå­¦è¯­éŸ³äº†2ä¸ªå¤šå°æ—¶ï¼Œäº¤æµäº†å¾ˆå¤šFlinkç›¸å…³æŠ€æœ¯ï¼Œæœ€åæç‚¼äº†ä»¥ä¸‹ä¸‰ä¸ªé—®é¢˜ï¼Œå½“ç„¶è®¨è®ºçš„å¾ˆå¤šFlinkçš„å…¶ä»–æŠ€æœ¯å¹¶æ²¡æœ‰æ”¾åˆ°è¯¥åšå®¢ä¸­ ç¬¬ä¸€ç§åœºæ™¯è®¡ç®—PVï¼Œkafkaåªæœ‰ä¸€ä¸ªpartitionï¼Œç²¾ç¡®ä¸€æ¬¡ï¼Œè‡³å°‘ä¸€æ¬¡å°±æ²¡æœ‰åŒºåˆ«ï¼Ÿ ç­”ï¼šå¦‚æœåªæœ‰ä¸€ä¸ªpartitionï¼Œå¯¹åº”flinkä»»åŠ¡çš„Source Taskå¹¶è¡Œåº¦åªèƒ½æ˜¯1ï¼Œç¡®å®æ²¡æœ‰åŒºåˆ«ï¼Œä¸ä¼šæœ‰è‡³å°‘ä¸€æ¬¡çš„å­˜åœ¨äº†ï¼Œè‚¯å®šæ˜¯ç²¾ç¡®ä¸€æ¬¡ã€‚å› ä¸ºåªæœ‰barrierä¸å¯¹é½æ‰ä¼šæœ‰å¯èƒ½é‡å¤å¤„ç†ï¼Œè¿™é‡Œå¹¶è¡Œåº¦éƒ½å·²ç»ä¸º1ï¼Œé»˜è®¤å°±æ˜¯å¯¹é½çš„ï¼Œåªæœ‰å½“ä¸Šæ¸¸æœ‰å¤šä¸ªå¹¶è¡Œåº¦çš„æ—¶å€™ï¼Œå¤šä¸ªå¹¶è¡Œåº¦å‘åˆ°ä¸‹æ¸¸çš„barrieræ‰éœ€è¦å¯¹é½ï¼Œå•å¹¶è¡Œåº¦ä¸ä¼šå‡ºç°barrierä¸å¯¹é½ï¼Œæ‰€ä»¥å¿…ç„¶ç²¾ç¡®ä¸€æ¬¡ã€‚å…¶å®è¿˜æ˜¯è¦ç†è§£barrierå¯¹é½å°±æ˜¯Exactly Onceä¸ä¼šé‡å¤æ¶ˆè´¹ï¼Œbarrierä¸å¯¹é½å°±æ˜¯ At Least Onceå¯èƒ½é‡å¤æ¶ˆè´¹ï¼Œè¿™é‡Œåªæœ‰å•ä¸ªå¹¶è¡Œåº¦æ ¹æœ¬ä¸ä¼šå­˜åœ¨barrierä¸å¯¹é½ï¼Œæ‰€ä»¥ä¸ä¼šå­˜åœ¨è‡³å°‘ä¸€æ¬¡è¯­ä¹‰ ä¸ºäº†ä¸‹æ¸¸å°½å¿«åšCheckPointï¼Œæ‰€ä»¥ä¼šå…ˆå‘é€barrieråˆ°ä¸‹æ¸¸ï¼Œè‡ªèº«å†åŒæ­¥è¿›è¡Œå¿«ç…§ï¼›è¿™ä¸€æ­¥ï¼Œå¦‚æœå‘ä¸‹å‘é€barrieråï¼Œè‡ªå·±åŒæ­¥å¿«ç…§æ…¢æ€ä¹ˆåŠï¼Ÿä¸‹æ¸¸å·²ç»åŒæ­¥å¥½äº†ï¼Œè‡ªå·±è¿˜æ²¡ï¼Ÿ ç­”: å¯èƒ½ä¼šå‡ºç°ä¸‹æ¸¸æ¯”ä¸Šæ¸¸å¿«ç…§è¿˜æ—©çš„æƒ…å†µï¼Œä½†æ˜¯è¿™ä¸å½±å“å¿«ç…§ç»“æœï¼Œåªæ˜¯ä¸‹æ¸¸å¿«ç…§çš„æ›´åŠæ—¶äº†ï¼Œæˆ‘åªè¦ä¿éšœä¸‹æ¸¸æŠŠbarrierä¹‹å‰çš„æ•°æ®éƒ½å¤„ç†äº†ï¼Œå¹¶ä¸”ä¸å¤„ç†barrierä¹‹åçš„æ•°æ®ï¼Œç„¶ååšå¿«ç…§ï¼Œé‚£ä¹ˆä¸‹æ¸¸ä¹ŸåŒæ ·æ”¯æŒç²¾ç¡®ä¸€æ¬¡ã€‚è¿™ä¸ªé—®é¢˜ä½ ä¸è¦ä»å…¨å±€æ€è€ƒï¼Œä½ å•ç‹¬æ€è€ƒä¸Šæ¸¸å’Œä¸‹æ¸¸çš„å®ä¾‹ï¼Œä½ ä¼šå‘ç°ä¸Šä¸‹æ¸¸çš„çŠ¶æ€éƒ½æ˜¯å‡†ç¡®çš„ï¼Œæ—¢æ²¡æœ‰ä¸¢ï¼Œä¹Ÿæ²¡æœ‰é‡å¤è®¡ç®—ã€‚è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œå¦‚æœæœ‰ä¸€ä¸ªOperator çš„CheckPointå¤±è´¥äº†æˆ–è€…å› ä¸ºCheckPointè¶…æ—¶ä¹Ÿä¼šå¯¼è‡´å¤±è´¥ï¼Œé‚£ä¹ˆJobManagerä¼šè®¤ä¸ºæ•´ä¸ªCheckPointå¤±è´¥ã€‚å¤±è´¥çš„CheckPointæ˜¯ä¸èƒ½ç”¨æ¥æ¢å¤ä»»åŠ¡çš„ï¼Œå¿…é¡»æ‰€æœ‰çš„ç®—å­çš„CheckPointéƒ½æˆåŠŸï¼Œé‚£ä¹ˆè¿™æ¬¡CheckPointæ‰èƒ½è®¤ä¸ºæ˜¯æˆåŠŸçš„ï¼Œæ‰èƒ½ç”¨æ¥æ¢å¤ä»»åŠ¡ æˆ‘ç¨‹åºä¸­Flinkçš„CheckPointè¯­ä¹‰è®¾ç½®äº† Exactly Onceï¼Œä½†æ˜¯æˆ‘çš„mysqlä¸­çœ‹åˆ°æ•°æ®é‡å¤äº†ï¼Ÿç¨‹åºä¸­è®¾ç½®äº†1åˆ†é’Ÿ1æ¬¡CheckPointï¼Œä½†æ˜¯5ç§’å‘mysqlå†™ä¸€æ¬¡æ•°æ®ï¼Œå¹¶commit ç­”ï¼šFlinkè¦æ±‚end to endçš„ç²¾ç¡®ä¸€æ¬¡éƒ½å¿…é¡»å®ç°TwoPhaseCommitSinkFunctionã€‚å¦‚æœä½ çš„chk-100æˆåŠŸäº†ï¼Œè¿‡äº†30ç§’ï¼Œç”±äº5ç§’commitä¸€æ¬¡ï¼Œæ‰€ä»¥å®é™…ä¸Šå·²ç»å†™å…¥äº†6æ‰¹æ•°æ®è¿›å…¥mysqlï¼Œä½†æ˜¯çªç„¶ç¨‹åºæŒ‚äº†ï¼Œä»chk100å¤„æ¢å¤ï¼Œè¿™æ ·çš„è¯ï¼Œä¹‹å‰æäº¤çš„6æ‰¹æ•°æ®å°±ä¼šé‡å¤å†™å…¥ï¼Œæ‰€ä»¥å‡ºç°äº†é‡å¤æ¶ˆè´¹ã€‚Flinkçš„ç²¾ç¡®ä¸€æ¬¡æœ‰ä¸¤ç§æƒ…å†µï¼Œä¸€ä¸ªæ˜¯Flinkå†…éƒ¨çš„ç²¾ç¡®ä¸€æ¬¡ï¼Œä¸€ä¸ªæ˜¯ç«¯å¯¹ç«¯çš„ç²¾ç¡®ä¸€æ¬¡ï¼Œè¿™ä¸ªåšå®¢æ‰€æè¿°çš„éƒ½æ˜¯å…³äºFlinkå†…éƒ¨å»çš„ç²¾ç¡®ä¸€æ¬¡ï¼Œæˆ‘åæœŸå†å‘ä¸€ä¸ªåšå®¢è¯¦ç»†ä»‹ç»ä¸€ä¸‹Flinkç«¯å¯¹ç«¯çš„ç²¾ç¡®ä¸€æ¬¡å¦‚ä½•å®ç° å…³æ³¨æˆ‘å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ Github ä»£ç ä»“åº“https://github.com/zhisheng17/flink-learning/ ä»¥åè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç éƒ½å°†æ”¾åœ¨è¿™ä¸ªä»“åº“é‡Œï¼ŒåŒ…å«äº†è‡ªå·±å­¦ä¹  flink çš„ä¸€äº› demo å’Œåšå®¢ åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€å®æˆ˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ ä¸“æ ä»‹ç»é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"}]},{"title":"ç¾å›¢ç‚¹è¯„åŸºäº Flink çš„å®æ—¶æ•°ä»“å»ºè®¾å®è·µ","date":"2019-08-19T16:00:00.000Z","path":"2019/08/20/Flink-meituan-dw/","text":"å¼•è¨€è¿‘äº›å¹´ï¼Œä¼ä¸šå¯¹æ•°æ®æœåŠ¡å®æ—¶åŒ–æœåŠ¡éœ€æ±‚æ—¥ç›Šå¢å¤šã€‚æœ¬æ–‡æ•´ç†äº†å¸¸è§å®æ—¶æ•°æ®ç»„ä»¶çš„æ€§èƒ½ç‰¹ç‚¹å’Œé€‚ç”¨åœºæ™¯ï¼Œä»‹ç»äº†ç¾å›¢å¦‚ä½•é€šè¿‡ Flink å¼•æ“æ„å»ºå®æ—¶æ•°æ®ä»“åº“ï¼Œä»è€Œæä¾›é«˜æ•ˆã€ç¨³å¥çš„å®æ—¶æ•°æ®æœåŠ¡ã€‚æ­¤å‰æˆ‘ä»¬ç¾å›¢æŠ€æœ¯åšå®¢å‘å¸ƒè¿‡ä¸€ç¯‡æ–‡ç« ã€Šæµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯”ã€‹ï¼Œå¯¹ Flink å’Œ Storm ä¸¤ä¸ªå¼•æ“çš„è®¡ç®—æ€§èƒ½è¿›è¡Œäº†æ¯”è¾ƒã€‚æœ¬æ–‡ä¸»è¦é˜è¿°ä½¿ç”¨ Flink åœ¨å®é™…æ•°æ®ç”Ÿäº§ä¸Šçš„ç»éªŒã€‚ å®æ—¶å¹³å°åˆæœŸæ¶æ„åœ¨å®æ—¶æ•°æ®ç³»ç»Ÿå»ºè®¾åˆæœŸï¼Œä¸šåŠ¡éœ€æ±‚ä¹Ÿç›¸å¯¹è¾ƒå°‘ï¼Œè¿˜æ²¡æœ‰å½¢æˆå®Œæ•´çš„æ•°æ®ä½“ç³»ã€‚æˆ‘ä»¬é‡‡ç”¨çš„æ˜¯â€œä¸€è·¯åˆ°åº•â€çš„å¼€å‘æ¨¡å¼ï¼šé€šè¿‡åœ¨å®æ—¶è®¡ç®—å¹³å°ä¸Šéƒ¨ç½² Storm ä½œä¸šå¤„ç†å®æ—¶æ•°æ®é˜Ÿåˆ—æ¥æå–æ•°æ®æŒ‡æ ‡ï¼Œç›´æ¥æ¨é€åˆ°å®æ—¶åº”ç”¨æœåŠ¡ä¸­ã€‚ ä½†æ˜¯ï¼Œéšç€äº§å“å’Œä¸šåŠ¡äººå‘˜å¯¹å®æ—¶æ•°æ®éœ€æ±‚çš„ä¸æ–­å¢å¤šï¼Œæ–°çš„æŒ‘æˆ˜ä¹Ÿéšä¹‹å‘ç”Ÿã€‚ 1ã€æ•°æ®æŒ‡æ ‡è¶Šæ¥è¶Šå¤šï¼Œâ€œçƒŸå›±å¼â€çš„å¼€å‘å¯¼è‡´ä»£ç è€¦åˆé—®é¢˜ä¸¥é‡ã€‚ 2ã€éœ€æ±‚è¶Šæ¥è¶Šå¤šï¼Œæœ‰çš„éœ€è¦æ˜ç»†æ•°æ®ï¼Œæœ‰çš„éœ€è¦ OLAP åˆ†æã€‚å•ä¸€çš„å¼€å‘æ¨¡å¼éš¾ä»¥åº”ä»˜å¤šç§éœ€æ±‚ã€‚ 3ã€ç¼ºå°‘å®Œå–„çš„ç›‘æ§ç³»ç»Ÿï¼Œæ— æ³•åœ¨å¯¹ä¸šåŠ¡äº§ç”Ÿå½±å“ä¹‹å‰å‘ç°å¹¶ä¿®å¤é—®é¢˜ã€‚ å®æ—¶æ•°æ®ä»“åº“çš„æ„å»ºä¸ºè§£å†³ä»¥ä¸Šé—®é¢˜ï¼Œæˆ‘ä»¬æ ¹æ®ç”Ÿäº§ç¦»çº¿æ•°æ®çš„ç»éªŒï¼Œé€‰æ‹©ä½¿ç”¨åˆ†å±‚è®¾è®¡æ–¹æ¡ˆæ¥å»ºè®¾å®æ—¶æ•°æ®ä»“åº“ï¼Œå…¶åˆ†å±‚æ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š è¯¥æ–¹æ¡ˆç”±ä»¥ä¸‹å››å±‚æ„æˆï¼š ODS å±‚ï¼šBinlog å’Œæµé‡æ—¥å¿—ä»¥åŠå„ä¸šåŠ¡å®æ—¶é˜Ÿåˆ—ã€‚ æ•°æ®æ˜ç»†å±‚ï¼šä¸šåŠ¡é¢†åŸŸæ•´åˆæå–äº‹å®æ•°æ®ï¼Œç¦»çº¿å…¨é‡å’Œå®æ—¶å˜åŒ–æ•°æ®æ„å»ºå®æ—¶ç»´åº¦æ•°æ®ã€‚ æ•°æ®æ±‡æ€»å±‚ï¼šä½¿ç”¨å®½è¡¨æ¨¡å‹å¯¹æ˜ç»†æ•°æ®è¡¥å……ç»´åº¦æ•°æ®ï¼Œå¯¹å…±æ€§æŒ‡æ ‡è¿›è¡Œæ±‡æ€»ã€‚ App å±‚ï¼šä¸ºäº†å…·ä½“éœ€æ±‚è€Œæ„å»ºçš„åº”ç”¨å±‚ï¼Œé€šè¿‡ RPC æ¡†æ¶å¯¹å¤–æä¾›æœåŠ¡ã€‚ é€šè¿‡å¤šå±‚è®¾è®¡æˆ‘ä»¬å¯ä»¥å°†å¤„ç†æ•°æ®çš„æµç¨‹æ²‰æ·€åœ¨å„å±‚å®Œæˆã€‚æ¯”å¦‚åœ¨æ•°æ®æ˜ç»†å±‚ç»Ÿä¸€å®Œæˆæ•°æ®çš„è¿‡æ»¤ã€æ¸…æ´—ã€è§„èŒƒã€è„±æ•æµç¨‹ï¼›åœ¨æ•°æ®æ±‡æ€»å±‚åŠ å·¥å…±æ€§çš„å¤šç»´æŒ‡æ ‡æ±‡æ€»æ•°æ®ã€‚æé«˜äº†ä»£ç çš„å¤ç”¨ç‡å’Œæ•´ä½“ç”Ÿäº§æ•ˆç‡ã€‚åŒæ—¶å„å±‚çº§å¤„ç†çš„ä»»åŠ¡ç±»å‹ç›¸ä¼¼ï¼Œå¯ä»¥é‡‡ç”¨ç»Ÿä¸€çš„æŠ€æœ¯æ–¹æ¡ˆä¼˜åŒ–æ€§èƒ½ï¼Œä½¿æ•°ä»“æŠ€æœ¯æ¶æ„æ›´ç®€æ´ã€‚ æŠ€æœ¯é€‰å‹1. å­˜å‚¨å¼•æ“çš„è°ƒç ”å®æ—¶æ•°ä»“åœ¨è®¾è®¡ä¸­ä¸åŒäºç¦»çº¿æ•°ä»“åœ¨å„å±‚çº§ä½¿ç”¨åŒç§å‚¨å­˜æ–¹æ¡ˆï¼Œæ¯”å¦‚éƒ½å­˜å‚¨åœ¨ Hive ã€DB ä¸­çš„ç­–ç•¥ã€‚é¦–å…ˆå¯¹ä¸­é—´è¿‡ç¨‹çš„è¡¨ï¼Œé‡‡ç”¨å°†ç»“æ„åŒ–çš„æ•°æ®é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å­˜å‚¨å’Œé«˜é€Ÿ KV å­˜å‚¨æ··åˆçš„æ–¹æ¡ˆã€‚å®æ—¶è®¡ç®—å¼•æ“å¯ä»¥é€šè¿‡ç›‘å¬æ¶ˆæ¯æ¶ˆè´¹æ¶ˆæ¯é˜Ÿåˆ—å†…çš„æ•°æ®ï¼Œè¿›è¡Œå®æ—¶è®¡ç®—ã€‚è€Œåœ¨é«˜é€Ÿ KV å­˜å‚¨ä¸Šçš„æ•°æ®åˆ™å¯ä»¥ç”¨äºå¿«é€Ÿå…³è”è®¡ç®—ï¼Œæ¯”å¦‚ç»´åº¦æ•°æ®ã€‚ å…¶æ¬¡åœ¨åº”ç”¨å±‚ä¸Šï¼Œé’ˆå¯¹æ•°æ®ä½¿ç”¨ç‰¹ç‚¹é…ç½®å­˜å‚¨æ–¹æ¡ˆç›´æ¥å†™å…¥ã€‚é¿å…äº†ç¦»çº¿æ•°ä»“åº”ç”¨å±‚åŒæ­¥æ•°æ®æµç¨‹å¸¦æ¥çš„å¤„ç†å»¶è¿Ÿã€‚ä¸ºäº†è§£å†³ä¸åŒç±»å‹çš„å®æ—¶æ•°æ®éœ€æ±‚ï¼Œåˆç†çš„è®¾è®¡å„å±‚çº§å­˜å‚¨æ–¹æ¡ˆï¼Œæˆ‘ä»¬è°ƒç ”äº†ç¾å›¢å†…éƒ¨ä½¿ç”¨æ¯”è¾ƒå¹¿æ³›çš„å‡ ç§å­˜å‚¨æ–¹æ¡ˆã€‚ æ ¹æ®ä¸åŒä¸šåŠ¡åœºæ™¯ï¼Œå®æ—¶æ•°ä»“å„ä¸ªæ¨¡å‹å±‚æ¬¡ä½¿ç”¨çš„å­˜å‚¨æ–¹æ¡ˆå¤§è‡´å¦‚ä¸‹ï¼š 1ã€æ•°æ®æ˜ç»†å±‚ å¯¹äºç»´åº¦æ•°æ®éƒ¨åˆ†åœºæ™¯ä¸‹å…³è”çš„é¢‘ç‡å¯è¾¾ 10ä¸‡å¤šTPSï¼Œæˆ‘ä»¬é€‰æ‹© Cellarï¼ˆç¾å›¢å†…éƒ¨åŸºäºTairå¼€å‘çš„KVå­˜å‚¨ï¼‰ ä½œä¸ºå­˜å‚¨ï¼Œå°è£…ç»´åº¦æœåŠ¡ä¸ºå®æ—¶æ•°ä»“æä¾›ç»´åº¦æ•°æ®ã€‚ 2ã€æ•°æ®æ±‡æ€»å±‚ å¯¹äºé€šç”¨çš„æ±‡æ€»æŒ‡æ ‡ï¼Œéœ€è¦è¿›è¡Œå†å²æ•°æ®å…³è”çš„æ•°æ®ï¼Œé‡‡ç”¨å’Œç»´åº¦æ•°æ®ä¸€æ ·çš„æ–¹æ¡ˆé€šè¿‡ Cellar ä½œä¸ºå­˜å‚¨ï¼Œç”¨æœåŠ¡çš„æ–¹å¼è¿›è¡Œå…³è”æ“ä½œã€‚ 3ã€æ•°æ®åº”ç”¨å±‚ åº”ç”¨å±‚è®¾è®¡ç›¸å¯¹å¤æ‚ï¼Œå†å¯¹æ¯”äº†å‡ ç§ä¸åŒå­˜å‚¨æ–¹æ¡ˆåã€‚æˆ‘ä»¬åˆ¶å®šäº†ä»¥æ•°æ®è¯»å†™é¢‘ç‡ 1000 QPS ä¸ºåˆ†ç•Œçš„åˆ¤æ–­ä¾æ®ã€‚å¯¹äºè¯»å†™å¹³å‡é¢‘ç‡é«˜äº 1000 QPS ä½†æŸ¥è¯¢ä¸å¤ªå¤æ‚çš„å®æ—¶åº”ç”¨ï¼Œæ¯”å¦‚å•†æˆ·å®æ—¶çš„ç»è¥æ•°æ®ã€‚é‡‡ç”¨ Cellar ä¸ºå­˜å‚¨ï¼Œæä¾›å®æ—¶æ•°æ®æœåŠ¡ã€‚å¯¹äºä¸€äº›æŸ¥è¯¢å¤æ‚çš„å’Œéœ€è¦æ˜ç»†åˆ—è¡¨çš„åº”ç”¨ï¼Œä½¿ç”¨ Elasticsearch ä½œä¸ºå­˜å‚¨åˆ™æ›´ä¸ºåˆé€‚ã€‚è€Œä¸€äº›æŸ¥è¯¢é¢‘ç‡ä½ï¼Œæ¯”å¦‚ä¸€äº›å†…éƒ¨è¿è¥çš„æ•°æ®ã€‚Druid é€šè¿‡å®æ—¶å¤„ç†æ¶ˆæ¯æ„å»ºç´¢å¼•ï¼Œå¹¶é€šè¿‡é¢„èšåˆå¯ä»¥å¿«é€Ÿçš„æä¾›å®æ—¶æ•°æ® OLAP åˆ†æåŠŸèƒ½ã€‚å¯¹äºä¸€äº›å†å²ç‰ˆæœ¬çš„æ•°æ®äº§å“è¿›è¡Œå®æ—¶åŒ–æ”¹é€ æ—¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ MySQL å­˜å‚¨ä¾¿äºäº§å“è¿­ä»£ã€‚ 2. è®¡ç®—å¼•æ“çš„è°ƒç ”åœ¨å®æ—¶å¹³å°å»ºè®¾åˆæœŸæˆ‘ä»¬ä½¿ç”¨ Storm å¼•æ“æ¥è¿›è¡Œå®æ—¶æ•°æ®å¤„ç†ã€‚Storm å¼•æ“è™½ç„¶åœ¨çµæ´»æ€§å’Œæ€§èƒ½ä¸Šéƒ½è¡¨ç°ä¸é”™ã€‚ä½†æ˜¯ç”±äº API è¿‡äºåº•å±‚ï¼Œåœ¨æ•°æ®å¼€å‘è¿‡ç¨‹ä¸­éœ€è¦å¯¹ä¸€äº›å¸¸ç”¨çš„æ•°æ®æ“ä½œè¿›è¡ŒåŠŸèƒ½å®ç°ã€‚æ¯”å¦‚è¡¨å…³è”ã€èšåˆç­‰ï¼Œäº§ç”Ÿäº†å¾ˆå¤šé¢å¤–çš„å¼€å‘å·¥ä½œï¼Œä¸ä»…å¼•å…¥äº†å¾ˆå¤šå¤–éƒ¨ä¾èµ–æ¯”å¦‚ç¼“å­˜ï¼Œè€Œä¸”å®é™…ä½¿ç”¨æ—¶æ€§èƒ½ä¹Ÿä¸æ˜¯å¾ˆç†æƒ³ã€‚åŒæ—¶ Storm å†…çš„æ•°æ®å¯¹è±¡ Tuple æ”¯æŒçš„åŠŸèƒ½ä¹Ÿå¾ˆç®€å•ï¼Œé€šå¸¸éœ€è¦å°†å…¶è½¬æ¢ä¸º Java å¯¹è±¡æ¥å¤„ç†ã€‚ å¯¹äºè¿™ç§åŸºäºä»£ç å®šä¹‰çš„æ•°æ®æ¨¡å‹ï¼Œé€šå¸¸æˆ‘ä»¬åªèƒ½é€šè¿‡æ–‡æ¡£æ¥è¿›è¡Œç»´æŠ¤ã€‚ä¸ä»…éœ€è¦é¢å¤–çš„ç»´æŠ¤å·¥ä½œï¼ŒåŒæ—¶åœ¨å¢æ”¹å­—æ®µæ—¶ä¹Ÿå¾ˆéº»çƒ¦ã€‚ç»¼åˆæ¥çœ‹ä½¿ç”¨ Storm å¼•æ“æ„å»ºå®æ—¶æ•°ä»“éš¾åº¦è¾ƒå¤§ã€‚æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ–°çš„å®æ—¶å¤„ç†æ–¹æ¡ˆï¼Œè¦èƒ½å¤Ÿå®ç°ï¼š æä¾›é«˜çº§ APIï¼Œæ”¯æŒå¸¸è§çš„æ•°æ®æ“ä½œæ¯”å¦‚å…³è”èšåˆï¼Œæœ€å¥½æ˜¯èƒ½æ”¯æŒ SQLã€‚ å…·æœ‰çŠ¶æ€ç®¡ç†å’Œè‡ªåŠ¨æ”¯æŒä¹…åŒ–æ–¹æ¡ˆï¼Œå‡å°‘å¯¹å­˜å‚¨çš„ä¾èµ–ã€‚ ä¾¿äºæ¥å…¥å…ƒæ•°æ®æœåŠ¡ï¼Œé¿å…é€šè¿‡ä»£ç ç®¡ç†æ•°æ®ç»“æ„ã€‚ å¤„ç†æ€§èƒ½è‡³å°‘è¦å’Œ Storm ä¸€è‡´ã€‚ æˆ‘ä»¬å¯¹ä¸»è¦çš„å®æ—¶è®¡ç®—å¼•æ“è¿›è¡Œäº†æŠ€æœ¯è°ƒç ”ã€‚æ€»ç»“äº†å„ç±»å¼•æ“ç‰¹æ€§å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š ä»è°ƒç ”ç»“æœæ¥çœ‹ï¼ŒFlink å’Œ Spark Streaming çš„ API ã€å®¹é”™æœºåˆ¶ä¸çŠ¶æ€æŒä¹…åŒ–æœºåˆ¶éƒ½å¯ä»¥è§£å†³ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬ç›®å‰ä½¿ç”¨ Storm ä¸­é‡åˆ°çš„é—®é¢˜ã€‚ä½† Flink åœ¨æ•°æ®å»¶è¿Ÿä¸Šå’Œ Storm æ›´æ¥è¿‘ï¼Œå¯¹ç°æœ‰åº”ç”¨å½±å“æœ€å°ã€‚è€Œä¸”åœ¨å…¬å¸å†…éƒ¨çš„æµ‹è¯•ä¸­ Flink çš„ååæ€§èƒ½å¯¹æ¯” Storm æœ‰åå€å·¦å³æå‡ã€‚ç»¼åˆè€ƒé‡æˆ‘ä»¬é€‰å®š Flink å¼•æ“ä½œä¸ºå®æ—¶æ•°ä»“çš„å¼€å‘å¼•æ“ã€‚ æ›´åŠ å¼•èµ·æˆ‘ä»¬æ³¨æ„çš„æ˜¯ï¼ŒFlink çš„ Table æŠ½è±¡å’Œ SQL æ”¯æŒã€‚è™½ç„¶ä½¿ç”¨ Strom å¼•æ“ä¹Ÿå¯ä»¥å¤„ç†ç»“æ„åŒ–æ•°æ®ã€‚ä½†æ¯•ç«Ÿä¾æ—§æ˜¯åŸºäºæ¶ˆæ¯çš„å¤„ç† API ï¼Œåœ¨ä»£ç å±‚å±‚é¢ä¸Šä¸èƒ½å®Œå…¨äº«å—æ“ä½œç»“æ„åŒ–æ•°æ®çš„ä¾¿åˆ©ã€‚è€Œ Flink ä¸ä»…æ”¯æŒäº†å¤§é‡å¸¸ç”¨çš„ SQL è¯­å¥ï¼ŒåŸºæœ¬è¦†ç›–äº†æˆ‘ä»¬çš„å¼€å‘åœºæ™¯ã€‚è€Œä¸” Flink çš„ Table å¯ä»¥é€šè¿‡ TableSchema è¿›è¡Œç®¡ç†ï¼Œæ”¯æŒä¸°å¯Œçš„æ•°æ®ç±»å‹å’Œæ•°æ®ç»“æ„ä»¥åŠæ•°æ®æºã€‚å¯ä»¥å¾ˆå®¹æ˜“çš„å’Œç°æœ‰çš„å…ƒæ•°æ®ç®¡ç†ç³»ç»Ÿæˆ–é…ç½®ç®¡ç†ç³»ç»Ÿç»“åˆã€‚é€šè¿‡ä¸‹å›¾æˆ‘ä»¬å¯ä»¥æ¸…æ™°çš„çœ‹å‡º Storm å’Œ Flink åœ¨å¼€å‘ç»Ÿè¿‡ç¨‹ä¸­çš„åŒºåˆ«ã€‚ åœ¨ä½¿ç”¨ Storm å¼€å‘æ—¶å¤„ç†é€»è¾‘ä¸å®ç°éœ€è¦å›ºåŒ–åœ¨ Bolt çš„ä»£ç ã€‚Flink åˆ™å¯ä»¥é€šè¿‡ SQL è¿›è¡Œå¼€å‘ï¼Œä»£ç å¯è¯»æ€§æ›´é«˜ï¼Œé€»è¾‘çš„å®ç°ç”±å¼€æºæ¡†æ¶æ¥ä¿è¯å¯é é«˜æ•ˆï¼Œå¯¹ç‰¹å®šåœºæ™¯çš„ä¼˜åŒ–åªè¦ä¿®æ”¹ Flink SQL ä¼˜åŒ–å™¨åŠŸèƒ½å®ç°å³å¯ï¼Œè€Œä¸å½±å“é€»è¾‘ä»£ç ã€‚ä½¿æˆ‘ä»¬å¯ä»¥æŠŠæ›´å¤šçš„ç²¾åŠ›æ”¾åˆ°æ•°æ®å¼€å‘ä¸­ï¼Œè€Œä¸æ˜¯é€»è¾‘çš„å®ç°ã€‚å½“éœ€è¦ç¦»çº¿æ•°æ®å’Œå®æ—¶æ•°æ®å£å¾„ç»Ÿä¸€çš„åœºæ™¯æ—¶ï¼Œæˆ‘ä»¬åªéœ€å¯¹ç¦»çº¿å£å¾„çš„ SQL è„šæœ¬ç¨åŠ æ”¹é€ å³å¯ï¼Œæå¤§åœ°æé«˜äº†å¼€å‘æ•ˆç‡ã€‚åŒæ—¶å¯¹æ¯”å›¾ä¸­ Flink å’Œ Storm ä½¿ç”¨çš„æ•°æ®æ¨¡å‹ï¼ŒStorm éœ€è¦é€šè¿‡ä¸€ä¸ª Java çš„ Class å»å®šä¹‰æ•°æ®ç»“æ„ï¼ŒFlink Table åˆ™å¯ä»¥é€šè¿‡å…ƒæ•°æ®æ¥å®šä¹‰ã€‚å¯ä»¥å¾ˆå¥½çš„å’Œæ•°æ®å¼€å‘ä¸­çš„å…ƒæ•°æ®ï¼Œæ•°æ®æ²»ç†ç­‰ç³»ç»Ÿç»“åˆï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚ Flinkä½¿ç”¨å¿ƒå¾—åœ¨åˆ©ç”¨ Flink-Table æ„å»ºå®æ—¶æ•°æ®ä»“åº“è¿‡ç¨‹ä¸­ã€‚æˆ‘ä»¬é’ˆå¯¹ä¸€äº›æ„å»ºæ•°æ®ä»“åº“çš„å¸¸ç”¨æ“ä½œï¼Œæ¯”å¦‚æ•°æ®æŒ‡æ ‡çš„ç»´åº¦æ‰©å……ï¼Œæ•°æ®æŒ‰ä¸»é¢˜å…³è”ï¼Œä»¥åŠæ•°æ®çš„èšåˆè¿ç®—é€šè¿‡ Flink æ¥å®ç°æ€»ç»“äº†ä¸€äº›ä½¿ç”¨å¿ƒå¾—ã€‚ ç»´åº¦æ‰©å…… æ•°æ®æŒ‡æ ‡çš„ç»´åº¦æ‰©å……ï¼Œæˆ‘ä»¬é‡‡ç”¨çš„æ˜¯é€šè¿‡ç»´åº¦æœåŠ¡è·å–ç»´åº¦ä¿¡æ¯ã€‚è™½ç„¶åŸºäº Cellar çš„ç»´åº¦æœåŠ¡é€šå¸¸çš„å“åº”å»¶è¿Ÿå¯ä»¥åœ¨ 1ms ä»¥ä¸‹ã€‚ä½†æ˜¯ä¸ºäº†è¿›ä¸€æ­¥ä¼˜åŒ– Flink çš„ååï¼Œæˆ‘ä»¬å¯¹ç»´åº¦æ•°æ®çš„å…³è”å…¨éƒ¨é‡‡ç”¨äº†å¼‚æ­¥æ¥å£è®¿é—®çš„æ–¹å¼ï¼Œé¿å…äº†ä½¿ç”¨ RPC è°ƒç”¨å½±å“æ•°æ®ååã€‚ å¯¹äºä¸€äº›æ•°æ®é‡å¾ˆå¤§çš„æµï¼Œæ¯”å¦‚æµé‡æ—¥å¿—æ•°æ®é‡åœ¨ 10ä¸‡ç§’/æ¡è¿™ä¸ªé‡çº§ã€‚åœ¨å…³è” UDF çš„æ—¶å€™å†…ç½®äº†ç¼“å­˜æœºåˆ¶ï¼Œå¯ä»¥æ ¹æ®å‘½ä¸­ç‡å’Œæ—¶é—´å¯¹ç¼“å­˜è¿›è¡Œæ·˜æ±°ï¼Œé…åˆç”¨å…³è”çš„ Key å€¼è¿›è¡Œåˆ†åŒºï¼Œæ˜¾è‘—å‡å°‘äº†å¯¹å¤–éƒ¨æœåŠ¡çš„è¯·æ±‚æ¬¡æ•°ï¼Œæœ‰æ•ˆçš„å‡å°‘äº†å¤„ç†å»¶è¿Ÿå’Œå¯¹å¤–éƒ¨ç³»ç»Ÿçš„å‹åŠ›ã€‚ æ•°æ®å…³è” æ•°æ®ä¸»é¢˜åˆå¹¶ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯å¤šä¸ªæ•°æ®æºçš„å…³è”ï¼Œç®€å•çš„æ¥è¯´å°±æ˜¯ Join æ“ä½œã€‚Flink çš„ Table æ˜¯å»ºç«‹åœ¨æ— é™æµè¿™ä¸ªæ¦‚å¿µä¸Šçš„ã€‚åœ¨è¿›è¡Œ Join æ“ä½œæ—¶å¹¶ä¸èƒ½åƒç¦»çº¿æ•°æ®ä¸€æ ·å¯¹ä¸¤ä¸ªå®Œæ•´çš„è¡¨è¿›è¡Œå…³è”ã€‚é‡‡ç”¨çš„æ˜¯åœ¨çª—å£æ—¶é—´å†…å¯¹æ•°æ®è¿›è¡Œå…³è”çš„æ–¹æ¡ˆï¼Œç›¸å½“äºä»ä¸¤ä¸ªæ•°æ®æµä¸­å„è‡ªæˆªå–ä¸€æ®µæ—¶é—´çš„æ•°æ®è¿›è¡Œ Join æ“ä½œã€‚æœ‰ç‚¹ç±»ä¼¼äºç¦»çº¿æ•°æ®é€šè¿‡é™åˆ¶åˆ†åŒºæ¥è¿›è¡Œå…³è”ã€‚åŒæ—¶éœ€è¦æ³¨æ„ Flink å…³è”è¡¨æ—¶å¿…é¡»æœ‰è‡³å°‘ä¸€ä¸ªâ€œç­‰äºâ€å…³è”æ¡ä»¶ï¼Œå› ä¸ºç­‰å·ä¸¤è¾¹çš„å€¼ä¼šç”¨æ¥åˆ†ç»„ã€‚ ç”±äº Flink ä¼šç¼“å­˜çª—å£å†…çš„å…¨éƒ¨æ•°æ®æ¥è¿›è¡Œå…³è”ï¼Œç¼“å­˜çš„æ•°æ®é‡å’Œå…³è”çš„çª—å£å¤§å°æˆæ­£æ¯”ã€‚å› æ­¤ Flink çš„å…³è”æŸ¥è¯¢ï¼Œæ›´é€‚åˆå¤„ç†ä¸€äº›å¯ä»¥é€šè¿‡ä¸šåŠ¡è§„åˆ™é™åˆ¶å…³è”æ•°æ®æ—¶é—´èŒƒå›´çš„åœºæ™¯ã€‚æ¯”å¦‚å…³è”ä¸‹å•ç”¨æˆ·è´­ä¹°ä¹‹å‰ 30 åˆ†é’Ÿå†…çš„æµè§ˆæ—¥å¿—ã€‚è¿‡å¤§çš„çª—å£ä¸ä»…ä¼šæ¶ˆè€—æ›´å¤šçš„å†…å­˜ï¼ŒåŒæ—¶ä¼šäº§ç”Ÿæ›´å¤§çš„ Checkpoint ï¼Œå¯¼è‡´ååä¸‹é™æˆ– Checkpoint è¶…æ—¶ã€‚åœ¨å®é™…ç”Ÿäº§ä¸­å¯ä»¥ä½¿ç”¨ RocksDB å’Œå¯ç”¨å¢é‡ä¿å­˜ç‚¹æ¨¡å¼ï¼Œå‡å°‘ Checkpoint è¿‡ç¨‹å¯¹ååäº§ç”Ÿå½±å“ã€‚ å¯¹äºä¸€äº›éœ€è¦å…³è”çª—å£æœŸå¾ˆé•¿çš„åœºæ™¯ï¼Œæ¯”å¦‚å…³è”çš„æ•°æ®å¯èƒ½æ˜¯å‡ å¤©ä»¥å‰çš„æ•°æ®ã€‚å¯¹äºè¿™äº›å†å²æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶ç†è§£ä¸ºæ˜¯ä¸€ç§å·²ç»å›ºå®šä¸å˜çš„â€ç»´åº¦â€ã€‚å¯ä»¥å°†éœ€è¦è¢«å…³è”çš„å†å²æ•°æ®é‡‡ç”¨å’Œç»´åº¦æ•°æ®ä¸€è‡´çš„å¤„ç†æ–¹æ³•ï¼šâ€ç¼“å­˜ + ç¦»çº¿â€æ•°æ®æ–¹å¼å­˜å‚¨ï¼Œç”¨æ¥å£çš„æ–¹å¼è¿›è¡Œå…³è”ã€‚å¦å¤–éœ€è¦æ³¨æ„ Flink å¯¹å¤šè¡¨å…³è”æ˜¯ç›´æ¥é¡ºåºé“¾æ¥çš„ï¼Œå› æ­¤éœ€è¦æ³¨æ„å…ˆè¿›è¡Œç»“æœé›†å°çš„å…³è”ã€‚ èšåˆè¿ç®— ä½¿ç”¨èšåˆè¿ç®—æ—¶ï¼ŒFlink å¯¹å¸¸è§çš„èšåˆè¿ç®—å¦‚æ±‚å’Œã€æå€¼ã€å‡å€¼ç­‰éƒ½æœ‰æ”¯æŒã€‚ç¾ä¸­ä¸è¶³çš„æ˜¯å¯¹äº Distinct çš„æ”¯æŒï¼ŒFlink-1.6 ä¹‹å‰çš„é‡‡ç”¨çš„æ–¹æ¡ˆæ˜¯é€šè¿‡å…ˆå¯¹å»é‡å­—æ®µè¿›è¡Œåˆ†ç»„å†èšåˆå®ç°ã€‚å¯¹äºéœ€è¦å¯¹å¤šä¸ªå­—æ®µå»é‡èšåˆçš„åœºæ™¯ï¼Œåªèƒ½åˆ†åˆ«è®¡ç®—å†è¿›è¡Œå…³è”å¤„ç†æ•ˆç‡å¾ˆä½ã€‚ä¸ºæ­¤æˆ‘ä»¬å¼€å‘äº†è‡ªå®šä¹‰çš„ UDAFï¼Œå®ç°äº† MapView ç²¾ç¡®å»é‡ã€BloomFilter éç²¾ç¡®å»é‡ã€ HyperLogLog è¶…ä½å†…å­˜å»é‡æ–¹æ¡ˆåº”å¯¹å„ç§å®æ—¶å»é‡åœºæ™¯ã€‚ ä½†æ˜¯åœ¨ä½¿ç”¨è‡ªå®šä¹‰çš„ UDAF æ—¶ï¼Œéœ€è¦æ³¨æ„ RocksDBStateBackend æ¨¡å¼å¯¹äºè¾ƒå¤§çš„ Key è¿›è¡Œæ›´æ–°æ“ä½œæ—¶åºåˆ—åŒ–å’Œååºåˆ—åŒ–è€—æ—¶å¾ˆå¤šã€‚å¯ä»¥è€ƒè™‘ä½¿ç”¨ FsStateBackend æ¨¡å¼æ›¿ä»£ã€‚å¦å¤–è¦æ³¨æ„çš„ä¸€ç‚¹ Flink æ¡†æ¶åœ¨è®¡ç®—æ¯”å¦‚ Rank è¿™æ ·çš„åˆ†æå‡½æ•°æ—¶ï¼Œéœ€è¦ç¼“å­˜æ¯ä¸ªåˆ†ç»„çª—å£ä¸‹çš„å…¨éƒ¨æ•°æ®æ‰èƒ½è¿›è¡Œæ’åºï¼Œä¼šæ¶ˆè€—å¤§é‡å†…å­˜ã€‚å»ºè®®åœ¨è¿™ç§åœºæ™¯ä¸‹ä¼˜å…ˆè½¬æ¢ä¸º TopN çš„é€»è¾‘ï¼Œçœ‹æ˜¯å¦å¯ä»¥è§£å†³éœ€æ±‚ã€‚ ä¸‹å›¾å±•ç¤ºä¸€ä¸ªå®Œæ•´çš„ä½¿ç”¨ Flink å¼•æ“ç”Ÿäº§ä¸€å¼ å®æ—¶æ•°æ®è¡¨çš„è¿‡ç¨‹ï¼š å®æ—¶æ•°ä»“æˆæœé€šè¿‡ä½¿ç”¨å®æ—¶æ•°ä»“ä»£æ›¿åŸæœ‰æµç¨‹ï¼Œæˆ‘ä»¬å°†æ•°æ®ç”Ÿäº§ä¸­çš„å„ä¸ªæµç¨‹æŠ½è±¡åˆ°å®æ—¶æ•°ä»“çš„å„å±‚å½“ä¸­ã€‚å®ç°äº†å…¨éƒ¨å®æ—¶æ•°æ®åº”ç”¨çš„æ•°æ®æºç»Ÿä¸€ï¼Œä¿è¯äº†åº”ç”¨æ•°æ®æŒ‡æ ‡ã€ç»´åº¦çš„å£å¾„çš„ä¸€è‡´ã€‚åœ¨å‡ æ¬¡æ•°æ®å£å¾„å‘ç”Ÿä¿®æ”¹çš„åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡å¯¹ä»“åº“æ˜ç»†å’Œæ±‡æ€»è¿›è¡Œæ”¹é€ ï¼Œåœ¨å®Œå…¨ä¸ç”¨ä¿®æ”¹åº”ç”¨ä»£ç çš„æƒ…å†µä¸‹å°±å®Œæˆå…¨éƒ¨åº”ç”¨çš„å£å¾„åˆ‡æ¢ã€‚åœ¨å¼€å‘è¿‡ç¨‹ä¸­é€šè¿‡ä¸¥æ ¼çš„æŠŠæ§æ•°æ®åˆ†å±‚ã€ä¸»é¢˜åŸŸåˆ’åˆ†ã€å†…å®¹ç»„ç»‡æ ‡å‡†è§„èŒƒå’Œå‘½åè§„åˆ™ã€‚ä½¿æ•°æ®å¼€å‘çš„é“¾è·¯æ›´ä¸ºæ¸…æ™°ï¼Œå‡å°‘äº†ä»£ç çš„è€¦åˆã€‚å†é…åˆä¸Šä½¿ç”¨ Flink SQL è¿›è¡Œå¼€å‘ï¼Œä»£ç åŠ ç®€æ´ã€‚å•ä¸ªä½œä¸šçš„ä»£ç é‡ä»å¹³å‡ 300+ è¡Œçš„ Java ä»£ç  ï¼Œç¼©å‡åˆ°å‡ åè¡Œçš„ SQL è„šæœ¬ã€‚é¡¹ç›®çš„å¼€å‘æ—¶é•¿ä¹Ÿå¤§å¹…å‡çŸ­ï¼Œä¸€äººæ—¥å¼€å‘å¤šä¸ªå®æ—¶æ•°æ®æŒ‡æ ‡æƒ…å†µä¹Ÿä¸å°‘è§ã€‚ é™¤æ­¤ä»¥å¤–æˆ‘ä»¬é€šè¿‡é’ˆå¯¹æ•°ä»“å„å±‚çº§å·¥ä½œå†…å®¹çš„ä¸åŒç‰¹ç‚¹ï¼Œå¯ä»¥è¿›è¡Œé’ˆå¯¹æ€§çš„æ€§èƒ½ä¼˜åŒ–å’Œå‚æ•°é…ç½®ã€‚æ¯”å¦‚ ODS å±‚ä¸»è¦è¿›è¡Œæ•°æ®çš„è§£æã€è¿‡æ»¤ç­‰æ“ä½œï¼Œä¸éœ€è¦ RPC è°ƒç”¨å’Œèšåˆè¿ç®—ã€‚æˆ‘ä»¬é’ˆå¯¹æ•°æ®è§£æè¿‡ç¨‹è¿›è¡Œä¼˜åŒ–ï¼Œå‡å°‘ä¸å¿…è¦çš„ JSON å­—æ®µè§£æï¼Œå¹¶ä½¿ç”¨æ›´é«˜æ•ˆçš„ JSON åŒ…ã€‚åœ¨èµ„æºåˆ†é…ä¸Šï¼Œå•ä¸ª CPU åªé…ç½® 1GB çš„å†…å­˜å³å¯æ»¡éœ€æ±‚ã€‚ è€Œæ±‡æ€»å±‚ä¸»è¦åˆ™ä¸»è¦è¿›è¡Œèšåˆä¸å…³è”è¿ç®—ï¼Œå¯ä»¥é€šè¿‡ä¼˜åŒ–èšåˆç®—æ³•ã€å†…å¤–å­˜å…±åŒè¿ç®—æ¥æé«˜æ€§èƒ½ã€å‡å°‘æˆæœ¬ã€‚èµ„æºé…ç½®ä¸Šä¹Ÿä¼šåˆ†é…æ›´å¤šçš„å†…å­˜ï¼Œé¿å…å†…å­˜æº¢å‡ºã€‚é€šè¿‡è¿™äº›ä¼˜åŒ–æ‰‹æ®µï¼Œè™½ç„¶ç›¸æ¯”åŸæœ‰æµç¨‹å®æ—¶æ•°ä»“çš„ç”Ÿäº§é“¾è·¯æ›´é•¿ï¼Œä½†æ•°æ®å»¶è¿Ÿå¹¶æ²¡æœ‰æ˜æ˜¾å¢åŠ ã€‚åŒæ—¶å®æ—¶æ•°æ®åº”ç”¨æ‰€ä½¿ç”¨çš„è®¡ç®—èµ„æºä¹Ÿæœ‰æ˜æ˜¾å‡å°‘ã€‚ å±•æœ›æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å°†å®æ—¶ä»“åº“å»ºè®¾æˆå¯ä»¥å’Œç¦»çº¿ä»“åº“æ•°æ®å‡†ç¡®æ€§ï¼Œä¸€è‡´æ€§åª²ç¾çš„æ•°æ®ç³»ç»Ÿã€‚ä¸ºå•†å®¶ï¼Œä¸šåŠ¡äººå‘˜ä»¥åŠç¾å›¢ç”¨æˆ·æä¾›åŠæ—¶å¯é çš„æ•°æ®æœåŠ¡ã€‚åŒæ—¶ä½œä¸ºåˆ°é¤å®æ—¶æ•°æ®çš„ç»Ÿä¸€å‡ºå£ï¼Œä¸ºé›†å›¢å…¶ä»–ä¸šåŠ¡éƒ¨é—¨åŠ©åŠ›ã€‚ æœªæ¥æˆ‘ä»¬å°†æ›´åŠ å…³æ³¨åœ¨æ•°æ®å¯é æ€§å’Œå®æ—¶æ•°æ®æŒ‡æ ‡ç®¡ç†ã€‚å»ºç«‹å®Œå–„çš„æ•°æ®ç›‘æ§ï¼Œæ•°æ®è¡€ç¼˜æ£€æµ‹ï¼Œäº¤å‰æ£€æŸ¥æœºåˆ¶ã€‚åŠæ—¶å¯¹å¼‚å¸¸æ•°æ®æˆ–æ•°æ®å»¶è¿Ÿè¿›è¡Œç›‘æ§å’Œé¢„è­¦ã€‚åŒæ—¶ä¼˜åŒ–å¼€å‘æµç¨‹ï¼Œé™ä½å¼€å‘å®æ—¶æ•°æ®å­¦ä¹ æˆæœ¬ã€‚è®©æ›´å¤šæœ‰å®æ—¶æ•°æ®éœ€æ±‚çš„äººï¼Œå¯ä»¥è‡ªå·±åŠ¨æ‰‹è§£å†³é—®é¢˜ã€‚ å…³äºä½œè€… æœ¬æ–‡è½¬è½½è‡ªç¾å›¢æŠ€æœ¯å…¬ä¼—å·ï¼Œä½œè€…æ˜¯ä¼Ÿä¼¦ï¼Œ ç¾å›¢åˆ°åº—é¤é¥®æŠ€æœ¯éƒ¨å®æ—¶æ•°æ®è´Ÿè´£äººï¼Œ2017å¹´åŠ å…¥ç¾å›¢ï¼Œé•¿æœŸä»äº‹æ•°æ®å¹³å°ã€å®æ—¶æ•°æ®è®¡ç®—ã€æ•°æ®æ¶æ„æ–¹é¢çš„å¼€å‘å·¥ä½œã€‚åœ¨ä½¿ç”¨ Flink è¿›è¡Œå®æ—¶æ•°æ®ç”Ÿäº§å’Œæé«˜ç”Ÿäº§æ•ˆç‡ä¸Šï¼Œæœ‰ä¸€äº›å¿ƒå¾—å’Œäº§å‡ºã€‚åŒæ—¶ä¹Ÿåœ¨ç§¯ææ¨å¹¿ Flink åœ¨å®æ—¶æ•°æ®å¤„ç†ä¸­çš„å®æˆ˜ç»éªŒ å…³æ³¨æˆ‘å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f Github ä»£ç ä»“åº“https://github.com/zhisheng17/flink-learning/ ä»¥åè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç éƒ½å°†æ”¾åœ¨è¿™ä¸ªä»“åº“é‡Œï¼ŒåŒ…å«äº†è‡ªå·±å­¦ä¹  flink çš„ä¸€äº› demo å’Œåšå®¢ åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€å®æˆ˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æ•°æ®ä»“åº“","slug":"æ•°æ®ä»“åº“","permalink":"http://www.54tianzhisheng.cn/tags/æ•°æ®ä»“åº“/"}]},{"title":"ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink","date":"2019-08-18T16:00:00.000Z","path":"2019/08/19/flink/","text":"å‰è¨€åœ¨ä¸Šä¸€ç¯‡æ–‡ç«  ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ ä¸­æˆ‘è®²è§£äº†æ—¥å¸¸ä¸­å¸¸è§çš„å®æ—¶éœ€æ±‚ï¼Œç„¶ååˆ†æäº†è¿™äº›éœ€æ±‚çš„å®ç°æ–¹å¼ï¼Œæ¥ç€å¯¹æ¯”äº†å®æ—¶è®¡ç®—å’Œç¦»çº¿è®¡ç®—ã€‚éšç€è¿™äº›å¹´å¤§æ•°æ®çš„é£é€Ÿå‘å±•ï¼Œä¹Ÿå‡ºç°äº†ä¸å°‘è®¡ç®—çš„æ¡†æ¶ï¼ˆHadoopã€Stormã€Sparkã€Flinkï¼‰ã€‚åœ¨ç½‘ä¸Šæœ‰äººå°†å¤§æ•°æ®è®¡ç®—å¼•æ“çš„å‘å±•åˆ†ä¸ºå››ä¸ªé˜¶æ®µã€‚ ç¬¬ä¸€ä»£ï¼šHadoop æ‰¿è½½çš„ MapReduce ç¬¬äºŒä»£ï¼šæ”¯æŒ DAGï¼ˆæœ‰å‘æ— ç¯å›¾ï¼‰æ¡†æ¶çš„è®¡ç®—å¼•æ“ Tez å’Œ Oozieï¼Œä¸»è¦è¿˜æ˜¯æ‰¹å¤„ç†ä»»åŠ¡ ç¬¬ä¸‰ä»£ï¼šæ”¯æŒ Job å†…éƒ¨çš„ DAGï¼ˆæœ‰å‘æ— ç¯å›¾ï¼‰ï¼Œä»¥ Spark ä¸ºä»£è¡¨ ç¬¬å››ä»£ï¼šå¤§æ•°æ®ç»Ÿä¸€è®¡ç®—å¼•æ“ï¼ŒåŒ…æ‹¬æµå¤„ç†ã€æ‰¹å¤„ç†ã€AIã€Machine Learningã€å›¾è®¡ç®—ç­‰ï¼Œä»¥ Flink ä¸ºä»£è¡¨ æˆ–è®¸ä¼šæœ‰äººä¸åŒæ„ä»¥ä¸Šçš„åˆ†ç±»ï¼Œæˆ‘è§‰å¾—å…¶å®è¿™å¹¶ä¸é‡è¦çš„ï¼Œé‡è¦çš„æ˜¯ä½“ä¼šå„ä¸ªæ¡†æ¶çš„å·®å¼‚ï¼Œä»¥åŠæ›´é€‚åˆçš„åœºæ™¯ã€‚å¹¶è¿›è¡Œç†è§£ï¼Œæ²¡æœ‰å“ªä¸€ä¸ªæ¡†æ¶å¯ä»¥å®Œç¾çš„æ”¯æŒæ‰€æœ‰çš„åœºæ™¯ï¼Œä¹Ÿå°±ä¸å¯èƒ½æœ‰ä»»ä½•ä¸€ä¸ªæ¡†æ¶èƒ½å®Œå…¨å–ä»£å¦ä¸€ä¸ªã€‚ æœ¬æ–‡å°†å¯¹ Flink çš„æ•´ä½“æ¶æ„å’Œ Flink çš„å¤šç§ç‰¹æ€§åšä¸ªè¯¦ç»†çš„ä»‹ç»ï¼åœ¨è®² Flink ä¹‹å‰çš„è¯ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ æ•°æ®é›†ç±»å‹ å’Œ æ•°æ®è¿ç®—æ¨¡å‹ çš„ç§ç±»ã€‚ æ•°æ®é›†ç±»å‹ æ— ç©·æ•°æ®é›†ï¼šæ— ç©·çš„æŒç»­é›†æˆçš„æ•°æ®é›†åˆ æœ‰ç•Œæ•°æ®é›†ï¼šæœ‰é™ä¸ä¼šæ”¹å˜çš„æ•°æ®é›†åˆ é‚£ä¹ˆé‚£äº›å¸¸è§çš„æ— ç©·æ•°æ®é›†æœ‰å“ªäº›å‘¢ï¼Ÿ ç”¨æˆ·ä¸å®¢æˆ·ç«¯çš„å®æ—¶äº¤äº’æ•°æ® åº”ç”¨å®æ—¶äº§ç”Ÿçš„æ—¥å¿— é‡‘èå¸‚åœºçš„å®æ—¶äº¤æ˜“è®°å½• â€¦ æ•°æ®è¿ç®—æ¨¡å‹ æµå¼ï¼šåªè¦æ•°æ®ä¸€ç›´åœ¨äº§ç”Ÿï¼Œè®¡ç®—å°±æŒç»­åœ°è¿›è¡Œ æ‰¹å¤„ç†ï¼šåœ¨é¢„å…ˆå®šä¹‰çš„æ—¶é—´å†…è¿è¡Œè®¡ç®—ï¼Œå½“è®¡ç®—å®Œæˆæ—¶é‡Šæ”¾è®¡ç®—æœºèµ„æº é‚£ä¹ˆæˆ‘ä»¬å†æ¥çœ‹çœ‹ Flink å®ƒæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ Flink æ˜¯ä»€ä¹ˆï¼Ÿ Flink æ˜¯ä¸€ä¸ªé’ˆå¯¹æµæ•°æ®å’Œæ‰¹æ•°æ®çš„åˆ†å¸ƒå¼å¤„ç†å¼•æ“ï¼Œä»£ç ä¸»è¦æ˜¯ç”± Java å®ç°ï¼Œéƒ¨åˆ†ä»£ç æ˜¯ Scalaã€‚å®ƒå¯ä»¥å¤„ç†æœ‰ç•Œçš„æ‰¹é‡æ•°æ®é›†ã€ä¹Ÿå¯ä»¥å¤„ç†æ— ç•Œçš„å®æ—¶æ•°æ®é›†ã€‚å¯¹ Flink è€Œè¨€ï¼Œå…¶æ‰€è¦å¤„ç†çš„ä¸»è¦åœºæ™¯å°±æ˜¯æµæ•°æ®ï¼Œæ‰¹æ•°æ®åªæ˜¯æµæ•°æ®çš„ä¸€ä¸ªæé™ç‰¹ä¾‹è€Œå·²ï¼Œæ‰€ä»¥ Flink ä¹Ÿæ˜¯ä¸€æ¬¾çœŸæ­£çš„æµæ‰¹ç»Ÿä¸€çš„è®¡ç®—å¼•æ“ã€‚ Flink æä¾›äº† Stateã€Checkpointã€Timeã€Window ç­‰ï¼Œå®ƒä»¬ä¸º Flink æä¾›äº†åŸºçŸ³ï¼Œæœ¬ç¯‡æ–‡ç« ä¸‹é¢ä¼šç¨ä½œè®²è§£ï¼Œå…·ä½“æ·±åº¦åˆ†æåé¢ä¼šæœ‰ä¸“é—¨çš„æ–‡ç« æ¥è®²è§£ã€‚ Flink æ•´ä½“ç»“æ„ ä»ä¸‹è‡³ä¸Šï¼š 1ã€éƒ¨ç½²ï¼šFlink æ”¯æŒæœ¬åœ°è¿è¡Œï¼ˆIDE ä¸­ç›´æ¥è¿è¡Œç¨‹åºï¼‰ã€èƒ½åœ¨ç‹¬ç«‹é›†ç¾¤ï¼ˆStandalone æ¨¡å¼ï¼‰æˆ–è€…åœ¨è¢« YARNã€Mesosã€K8s ç®¡ç†çš„é›†ç¾¤ä¸Šè¿è¡Œï¼Œä¹Ÿèƒ½éƒ¨ç½²åœ¨äº‘ä¸Šã€‚ 2ã€è¿è¡Œï¼šFlink çš„æ ¸å¿ƒæ˜¯åˆ†å¸ƒå¼æµå¼æ•°æ®å¼•æ“ï¼Œæ„å‘³ç€æ•°æ®ä»¥ä¸€æ¬¡ä¸€ä¸ªäº‹ä»¶çš„å½¢å¼è¢«å¤„ç†ã€‚ 3ã€APIï¼šDataStreamã€DataSetã€Tableã€SQL APIã€‚ 4ã€æ‰©å±•åº“ï¼šFlink è¿˜åŒ…æ‹¬ç”¨äº CEPï¼ˆå¤æ‚äº‹ä»¶å¤„ç†ï¼‰ã€æœºå™¨å­¦ä¹ ã€å›¾å½¢å¤„ç†ç­‰åœºæ™¯ã€‚ Flink æ”¯æŒå¤šç§æ–¹å¼éƒ¨ç½² Flink æ”¯æŒå¤šç§æ¨¡å¼ä¸‹çš„è¿è¡Œã€‚ Localï¼šç›´æ¥åœ¨ IDE ä¸­è¿è¡Œ Flink Job æ—¶åˆ™ä¼šåœ¨æœ¬åœ°å¯åŠ¨ä¸€ä¸ª mini Flink é›†ç¾¤ Standaloneï¼šåœ¨ Flink ç›®å½•ä¸‹æ‰§è¡Œ bin/start-cluster.sh è„šæœ¬åˆ™ä¼šå¯åŠ¨ä¸€ä¸ª Standalone æ¨¡å¼çš„é›†ç¾¤ YARNï¼šYARN æ˜¯ Hadoop é›†ç¾¤çš„èµ„æºç®¡ç†ç³»ç»Ÿï¼Œå®ƒå¯ä»¥åœ¨ç¾¤é›†ä¸Šè¿è¡Œå„ç§åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºï¼ŒFlink å¯ä¸å…¶ä»–åº”ç”¨å¹¶è¡Œäº YARN ä¸­ï¼ŒFlink on YARN çš„æ¶æ„å¦‚ä¸‹ï¼š Kubernetesï¼šKubernetes æ˜¯ Google å¼€æºçš„å®¹å™¨é›†ç¾¤ç®¡ç†ç³»ç»Ÿï¼Œåœ¨ Docker æŠ€æœ¯çš„åŸºç¡€ä¸Šï¼Œä¸ºå®¹å™¨åŒ–çš„åº”ç”¨æä¾›éƒ¨ç½²è¿è¡Œã€èµ„æºè°ƒåº¦ã€æœåŠ¡å‘ç°å’ŒåŠ¨æ€ä¼¸ç¼©ç­‰ä¸€ç³»åˆ—å®Œæ•´åŠŸèƒ½ï¼Œæé«˜äº†å¤§è§„æ¨¡å®¹å™¨é›†ç¾¤ç®¡ç†çš„ä¾¿æ·æ€§ï¼ŒFlink ä¹Ÿæ”¯æŒéƒ¨ç½²åœ¨ Kubernetes ä¸Šï¼Œåœ¨ GitHub çœ‹åˆ°æœ‰ä¸‹é¢è¿™ç§è¿è¡Œæ¶æ„çš„ã€‚ é€šå¸¸ä¸Šé¢å››ç§å±…å¤šï¼Œå¦å¤–è¿˜æ”¯æŒ AWSã€MapRã€Aliyun OSS ç­‰ã€‚ Flink åˆ†å¸ƒå¼è¿è¡ŒFlink ä½œä¸šæäº¤æ¶æ„æµç¨‹å¯è§ä¸‹å›¾ï¼š 1ã€Program Codeï¼šæˆ‘ä»¬ç¼–å†™çš„ Flink åº”ç”¨ç¨‹åºä»£ç  2ã€Job Clientï¼šJob Client ä¸æ˜¯ Flink ç¨‹åºæ‰§è¡Œçš„å†…éƒ¨éƒ¨åˆ†ï¼Œä½†å®ƒæ˜¯ä»»åŠ¡æ‰§è¡Œçš„èµ·ç‚¹ã€‚ Job Client è´Ÿè´£æ¥å—ç”¨æˆ·çš„ç¨‹åºä»£ç ï¼Œç„¶ååˆ›å»ºæ•°æ®æµï¼Œå°†æ•°æ®æµæäº¤ç»™ Job Manager ä»¥ä¾¿è¿›ä¸€æ­¥æ‰§è¡Œã€‚ æ‰§è¡Œå®Œæˆåï¼ŒJob Client å°†ç»“æœè¿”å›ç»™ç”¨æˆ· 3ã€Job Managerï¼šä¸»è¿›ç¨‹ï¼ˆä¹Ÿç§°ä¸ºä½œä¸šç®¡ç†å™¨ï¼‰åè°ƒå’Œç®¡ç†ç¨‹åºçš„æ‰§è¡Œã€‚ å®ƒçš„ä¸»è¦èŒè´£åŒ…æ‹¬å®‰æ’ä»»åŠ¡ï¼Œç®¡ç† checkpoint ï¼Œæ•…éšœæ¢å¤ç­‰ã€‚æœºå™¨é›†ç¾¤ä¸­è‡³å°‘è¦æœ‰ä¸€ä¸ª masterï¼Œmaster è´Ÿè´£è°ƒåº¦ taskï¼Œåè°ƒ checkpoints å’Œå®¹ç¾ï¼Œé«˜å¯ç”¨è®¾ç½®çš„è¯å¯ä»¥æœ‰å¤šä¸ª masterï¼Œä½†è¦ä¿è¯ä¸€ä¸ªæ˜¯ leader, å…¶ä»–æ˜¯ standby; Job Manager åŒ…å« Actor systemã€Schedulerã€Check pointing ä¸‰ä¸ªé‡è¦çš„ç»„ä»¶ 4ã€Task Managerï¼šä» Job Manager å¤„æ¥æ”¶éœ€è¦éƒ¨ç½²çš„ Taskã€‚Task Manager æ˜¯åœ¨ JVM ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œä»»åŠ¡çš„å·¥ä½œèŠ‚ç‚¹ã€‚ ä»»åŠ¡æ‰§è¡Œçš„å¹¶è¡Œæ€§ç”±æ¯ä¸ª Task Manager ä¸Šå¯ç”¨çš„ä»»åŠ¡æ§½ï¼ˆSlot ä¸ªæ•°ï¼‰å†³å®šã€‚ æ¯ä¸ªä»»åŠ¡ä»£è¡¨åˆ†é…ç»™ä»»åŠ¡æ§½çš„ä¸€ç»„èµ„æºã€‚ ä¾‹å¦‚ï¼Œå¦‚æœ Task Manager æœ‰å››ä¸ªæ’æ§½ï¼Œé‚£ä¹ˆå®ƒå°†ä¸ºæ¯ä¸ªæ’æ§½åˆ†é… 25ï¼… çš„å†…å­˜ã€‚ å¯ä»¥åœ¨ä»»åŠ¡æ§½ä¸­è¿è¡Œä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ã€‚ åŒä¸€æ’æ§½ä¸­çš„çº¿ç¨‹å…±äº«ç›¸åŒçš„ JVMã€‚åŒä¸€ JVM ä¸­çš„ä»»åŠ¡å…±äº« TCP è¿æ¥å’Œå¿ƒè·³æ¶ˆæ¯ã€‚Task Manager çš„ä¸€ä¸ª Slot ä»£è¡¨ä¸€ä¸ªå¯ç”¨çº¿ç¨‹ï¼Œè¯¥çº¿ç¨‹å…·æœ‰å›ºå®šçš„å†…å­˜ï¼Œæ³¨æ„ Slot åªå¯¹å†…å­˜éš”ç¦»ï¼Œæ²¡æœ‰å¯¹ CPU éš”ç¦»ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒFlink å…è®¸å­ä»»åŠ¡å…±äº« Slotï¼Œå³ä½¿å®ƒä»¬æ˜¯ä¸åŒ task çš„ subtaskï¼Œåªè¦å®ƒä»¬æ¥è‡ªç›¸åŒçš„ jobã€‚è¿™ç§å…±äº«å¯ä»¥æœ‰æ›´å¥½çš„èµ„æºåˆ©ç”¨ç‡ã€‚ Flink API Flink æä¾›äº†ä¸åŒçš„æŠ½è±¡çº§åˆ«çš„ API ä»¥å¼€å‘æµå¼æˆ–æ‰¹å¤„ç†åº”ç”¨ã€‚ æœ€åº•å±‚æä¾›äº†æœ‰çŠ¶æ€æµã€‚å®ƒå°†é€šè¿‡ Process Function åµŒå…¥åˆ° DataStream API ä¸­ã€‚å®ƒå…è®¸ç”¨æˆ·å¯ä»¥è‡ªç”±åœ°å¤„ç†æ¥è‡ªä¸€ä¸ªæˆ–å¤šä¸ªæµæ•°æ®çš„äº‹ä»¶ï¼Œå¹¶ä½¿ç”¨ä¸€è‡´æ€§ã€å®¹é”™çš„çŠ¶æ€ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œç”¨æˆ·å¯ä»¥æ³¨å†Œäº‹ä»¶æ—¶é—´å’Œå¤„ç†äº‹ä»¶å›è°ƒï¼Œä»è€Œä½¿ç¨‹åºå¯ä»¥å®ç°å¤æ‚çš„è®¡ç®—ã€‚ DataStream / DataSet API æ˜¯ Flink æä¾›çš„æ ¸å¿ƒ API ï¼ŒDataSet å¤„ç†æœ‰ç•Œçš„æ•°æ®é›†ï¼ŒDataStream å¤„ç†æœ‰ç•Œæˆ–è€…æ— ç•Œçš„æ•°æ®æµã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡å„ç§æ–¹æ³•ï¼ˆmap / flatmap / window / keyby / sum / max / min / avg / join ç­‰ï¼‰å°†æ•°æ®è¿›è¡Œè½¬æ¢æˆ–è€…è®¡ç®—ã€‚ Table API æ˜¯ä»¥è¡¨ä¸ºä¸­å¿ƒçš„å£°æ˜å¼ DSLï¼Œå…¶ä¸­è¡¨å¯èƒ½ä¼šåŠ¨æ€å˜åŒ–ï¼ˆåœ¨è¡¨è¾¾æµæ•°æ®æ—¶ï¼‰ã€‚Table API æä¾›äº†ä¾‹å¦‚ selectã€projectã€joinã€group-byã€aggregate ç­‰æ“ä½œï¼Œä½¿ç”¨èµ·æ¥å´æ›´åŠ ç®€æ´ï¼ˆä»£ç é‡æ›´å°‘ï¼‰ã€‚ä½ å¯ä»¥åœ¨è¡¨ä¸ DataStream/DataSet ä¹‹é—´æ— ç¼åˆ‡æ¢ï¼Œä¹Ÿå…è®¸ç¨‹åºå°† Table API ä¸ DataStream ä»¥åŠ DataSet æ··åˆä½¿ç”¨ã€‚ Flink æä¾›çš„æœ€é«˜å±‚çº§çš„æŠ½è±¡æ˜¯ SQL ã€‚è¿™ä¸€å±‚æŠ½è±¡åœ¨è¯­æ³•ä¸è¡¨è¾¾èƒ½åŠ›ä¸Šä¸ Table API ç±»ä¼¼ï¼Œä½†æ˜¯æ˜¯ä»¥ SQLæŸ¥è¯¢è¡¨è¾¾å¼çš„å½¢å¼è¡¨ç°ç¨‹åºã€‚SQL æŠ½è±¡ä¸ Table API äº¤äº’å¯†åˆ‡ï¼ŒåŒæ—¶ SQL æŸ¥è¯¢å¯ä»¥ç›´æ¥åœ¨ Table API å®šä¹‰çš„è¡¨ä¸Šæ‰§è¡Œã€‚ Flink ç¨‹åºä¸æ•°æ®æµç»“æ„ ä¸€ä¸ªå®Œæ•´çš„ Flink åº”ç”¨ç¨‹åºç»“æ„å°±æ˜¯å¦‚ä¸Šä¸¤å›¾æ‰€ç¤ºï¼š 1ã€Sourceï¼šæ•°æ®è¾“å…¥ï¼ŒFlink åœ¨æµå¤„ç†å’Œæ‰¹å¤„ç†ä¸Šçš„ source å¤§æ¦‚æœ‰ 4 ç±»ï¼šåŸºäºæœ¬åœ°é›†åˆçš„ sourceã€åŸºäºæ–‡ä»¶çš„ sourceã€åŸºäºç½‘ç»œå¥—æ¥å­—çš„ sourceã€è‡ªå®šä¹‰çš„ sourceã€‚è‡ªå®šä¹‰çš„ source å¸¸è§çš„æœ‰ Apache kafkaã€Amazon Kinesis Streamsã€RabbitMQã€Twitter Streaming APIã€Apache NiFi ç­‰ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥å®šä¹‰è‡ªå·±çš„ sourceã€‚ 2ã€Transformationï¼šæ•°æ®è½¬æ¢çš„å„ç§æ“ä½œï¼Œæœ‰ Map / FlatMap / Filter / KeyBy / Reduce / Fold / Aggregations / Window / WindowAll / Union / Window join / Split / Select / Project ç­‰ï¼Œæ“ä½œå¾ˆå¤šï¼Œå¯ä»¥å°†æ•°æ®è½¬æ¢è®¡ç®—æˆä½ æƒ³è¦çš„æ•°æ®ã€‚ 3ã€Sinkï¼šæ•°æ®è¾“å‡ºï¼ŒFlink å°†è½¬æ¢è®¡ç®—åçš„æ•°æ®å‘é€çš„åœ°ç‚¹ ï¼Œä½ å¯èƒ½éœ€è¦å­˜å‚¨ä¸‹æ¥ï¼ŒFlink å¸¸è§çš„ Sink å¤§æ¦‚æœ‰å¦‚ä¸‹å‡ ç±»ï¼šå†™å…¥æ–‡ä»¶ã€æ‰“å°å‡ºæ¥ã€å†™å…¥ socket ã€è‡ªå®šä¹‰çš„ sink ã€‚è‡ªå®šä¹‰çš„ sink å¸¸è§çš„æœ‰ Apache kafkaã€RabbitMQã€MySQLã€ElasticSearchã€Apache Cassandraã€Hadoop FileSystem ç­‰ï¼ŒåŒç†ä½ ä¹Ÿå¯ä»¥å®šä¹‰è‡ªå·±çš„ sinkã€‚ Flink æ”¯æŒå¤šç§æ‰©å±•åº“Flink æ‹¥æœ‰ä¸°å¯Œçš„åº“æ¥è¿›è¡Œæœºå™¨å­¦ä¹ ï¼Œå›¾å½¢å¤„ç†ï¼Œå…³ç³»æ•°æ®å¤„ç†ç­‰ã€‚ç”±äºå…¶æ¶æ„ï¼Œå¾ˆå®¹æ˜“æ‰§è¡Œå¤æ‚çš„äº‹ä»¶å¤„ç†å’Œè­¦æŠ¥ã€‚ Flink æä¾›å¤šç§ Time è¯­ä¹‰Flink æ”¯æŒå¤šç§ Timeï¼Œæ¯”å¦‚ Event timeã€Ingestion Timeã€Processing Timeï¼Œåé¢çš„æ–‡ç«  Flink ä¸­ Processing Timeã€Event Timeã€Ingestion Time å¯¹æ¯”åŠå…¶ä½¿ç”¨åœºæ™¯åˆ†æ ä¸­ä¼šå¾ˆè¯¦ç»†çš„è®²è§£ Flink ä¸­ Time çš„æ¦‚å¿µã€‚ Flink æä¾›çµæ´»çš„çª—å£æœºåˆ¶Flink æ”¯æŒå¤šç§ Windowï¼Œæ¯”å¦‚ Time Windowã€Count Windowã€Session Windowï¼Œè¿˜æ”¯æŒè‡ªå®šä¹‰ Windowã€‚åé¢çš„æ–‡ç«  å¦‚ä½•ä½¿ç”¨ Flink Window åŠ Window åŸºæœ¬æ¦‚å¿µä¸å®ç°åŸç† ä¸­ä¼šå¾ˆè¯¦ç»†çš„è®²è§£ Flink ä¸­ Window çš„æ¦‚å¿µã€‚ Flink å¹¶è¡Œçš„æ‰§è¡Œä»»åŠ¡Flink çš„ç¨‹åºå†…åœ¨æ˜¯å¹¶è¡Œå’Œåˆ†å¸ƒå¼çš„ï¼Œæ•°æ®æµå¯ä»¥è¢«åˆ†åŒºæˆ stream partitionsï¼Œoperators è¢«åˆ’åˆ†ä¸º operator subtasks; è¿™äº› subtasks åœ¨ä¸åŒçš„æœºå™¨æˆ–å®¹å™¨ä¸­åˆ†ä¸åŒçš„çº¿ç¨‹ç‹¬ç«‹è¿è¡Œï¼›operator subtasks çš„æ•°é‡åœ¨å…·ä½“çš„ operator å°±æ˜¯å¹¶è¡Œè®¡ç®—æ•°ï¼Œç¨‹åºä¸åŒçš„ operator é˜¶æ®µå¯èƒ½æœ‰ä¸åŒçš„å¹¶è¡Œæ•°ï¼›å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œsource operator çš„å¹¶è¡Œæ•°ä¸º 2ï¼Œä½†æœ€åçš„ sink operator ä¸º 1ï¼š Flink æ”¯æŒçŠ¶æ€å­˜å‚¨Flink æ˜¯ä¸€æ¬¾æœ‰çŠ¶æ€çš„æµå¤„ç†æ¡†æ¶ï¼Œå®ƒæä¾›äº†ä¸°å¯Œçš„çŠ¶æ€è®¿é—®æ¥å£ï¼ŒæŒ‰ç…§æ•°æ®çš„åˆ’åˆ†æ–¹å¼ï¼Œå¯ä»¥åˆ†ä¸º Keyed State å’Œ Operator Stateï¼Œåœ¨ Keyed State ä¸­åˆæä¾›äº†å¤šç§æ•°æ®ç»“æ„ï¼š ValueState MapState ListState ReducingState AggregatingState å¦å¤–çŠ¶æ€å­˜å‚¨ä¹Ÿæ”¯æŒå¤šç§æ–¹å¼ï¼š MemoryStateBackendï¼šå­˜å‚¨åœ¨å†…å­˜ä¸­ FsStateBackendï¼šå­˜å‚¨åœ¨æ–‡ä»¶ä¸­ RocksDBStateBackendï¼šå­˜å‚¨åœ¨ RocksDB ä¸­ Flink æ”¯æŒå®¹é”™æœºåˆ¶Flink ä¸­æ”¯æŒä½¿ç”¨ Checkpoint æ¥æé«˜ç¨‹åºçš„å¯é æ€§ï¼Œå¼€å¯äº† Checkpoint ä¹‹åï¼ŒFlink ä¼šæŒ‰ç…§ä¸€å®šçš„æ—¶é—´é—´éš”å¯¹ç¨‹åºçš„è¿è¡ŒçŠ¶æ€è¿›è¡Œå¤‡ä»½ï¼Œå½“å‘ç”Ÿæ•…éšœæ—¶ï¼ŒFlink ä¼šå°†æ‰€æœ‰ä»»åŠ¡çš„çŠ¶æ€æ¢å¤è‡³æœ€åä¸€æ¬¡å‘ç”Ÿ Checkpoint ä¸­çš„çŠ¶æ€ï¼Œå¹¶ä»é‚£é‡Œå¼€å§‹é‡æ–°å¼€å§‹æ‰§è¡Œã€‚ å¦å¤– Flink è¿˜æ”¯æŒæ ¹æ® Savepoint ä»å·²åœæ­¢ä½œä¸šçš„è¿è¡ŒçŠ¶æ€è¿›è¡Œæ¢å¤ï¼Œè¿™ç§æ–¹å¼éœ€è¦é€šè¿‡å‘½ä»¤è¿›è¡Œè§¦å‘ã€‚ Flink å®ç°äº†è‡ªå·±çš„å†…å­˜ç®¡ç†æœºåˆ¶Flink åœ¨ JVM ä¸­æä¾›äº†è‡ªå·±çš„å†…å­˜ç®¡ç†ï¼Œä½¿å…¶ç‹¬ç«‹äº Java çš„é»˜è®¤åƒåœ¾æ”¶é›†å™¨ã€‚ å®ƒé€šè¿‡ä½¿ç”¨æ•£åˆ—ï¼Œç´¢å¼•ï¼Œç¼“å­˜å’Œæ’åºæœ‰æ•ˆåœ°è¿›è¡Œå†…å­˜ç®¡ç†ã€‚æˆ‘ä»¬åœ¨åé¢çš„æ–‡ç«  æ·±å…¥æ¢ç´¢ Flink å†…å­˜ç®¡ç†æœºåˆ¶ ä¼šæ·±å…¥è®²è§£ Flink é‡Œé¢çš„å†…å­˜ç®¡ç†æœºåˆ¶ã€‚ æ€»ç»“æœ¬ç¯‡æ–‡ç« å¯¹ Flink åšäº†ä¸€ä¸ªè¯¦ç»†çš„ä»‹ç»ï¼Œå°† Flink çš„ç‰¹ç‚¹ä¸€ä¸€åšäº†æè¿°ï¼Œåé¢æ–‡ç« ä¸­æˆ‘ä»¬ä¹Ÿä¼šè¿›ä¸€æ­¥åœ°å¯¹è¿™é‡Œé¢çš„ç‰¹ç‚¹è¿›è¡ŒåŸç†è§£æã€‚æœ¬æ–‡çš„åœ°å€æ˜¯ http://www.54tianzhisheng.cn/2019/08/19/flink/ ï¼Œæœªç»å…è®¸ç¦æ­¢ä»»ä½•å½¢å¼çš„è½¬è½½ï¼Œè¿è€…å¿…ç©¶ã€‚ æœ€åGitHub Flink å­¦ä¹ ä»£ç åœ°å€ï¼šhttps://github.com/zhisheng17/flink-learning å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€åŸç†ã€å®æˆ˜ã€æ€§èƒ½è°ƒä¼˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ","date":"2019-08-17T16:00:00.000Z","path":"2019/08/18/flink-side-output/","text":"å‰è¨€ä¹‹å‰åœ¨ Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ è®²è¿‡ Flink ä½¿ç”¨è¿ç»­çš„ Split ä¼šæœ‰é—®é¢˜ï¼Œå½“æ—¶æä¾›äº†å‡ ç§è§£å†³æ–¹æ³•ï¼Œæœ‰ä¸€ç§æ–¹æ³•å°±æ˜¯ä½¿ç”¨ Side Output æ¥è¿›è¡Œï¼Œå½“æ—¶ç•™äº†ä¸ªä½™å¿µï¼Œé‚£ä¹ˆå°±åœ¨è¿™ç¯‡æ–‡ç« è¯¦ç»†çš„è®²ä¸€æ³¢ï¼Œæ•™å¤§å®¶å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµã€‚ Side Outputé€šå¸¸æˆ‘ä»¬åœ¨å¤„ç†æ•°æ®çš„æ—¶å€™ï¼Œæœ‰æ—¶å€™æƒ³å¯¹ä¸åŒæƒ…å†µçš„æ•°æ®è¿›è¡Œä¸åŒçš„å¤„ç†ï¼Œé‚£ä¹ˆå°±éœ€è¦æŠŠæ•°æ®æµè¿›è¡Œåˆ†æµã€‚æ¯”å¦‚æˆ‘ä»¬åœ¨é‚£ç¯‡æ–‡ç« é‡Œé¢çš„ä¾‹å­ï¼šéœ€è¦å°†ä» Kafka è¿‡æ¥çš„å‘Šè­¦å’Œæ¢å¤æ•°æ®è¿›è¡Œåˆ†ç±»æ‹†åˆ†ï¼Œç„¶ååœ¨å¯¹æ¯ç§æ•°æ®å†åˆ†ä¸ºå‘Šè­¦æ•°æ®å’Œæ¢å¤æ•°æ®ã€‚ å¦‚æœæ˜¯ä½¿ç”¨ filter æ¥è¿›è¡Œæ‹†åˆ†ï¼Œä¹Ÿèƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œä½†æ¯æ¬¡ç­›é€‰è¿‡æ»¤éƒ½è¦ä¿ç•™æ•´ä¸ªæµï¼Œç„¶åé€šè¿‡éå†æ•´ä¸ªæµæ¥è·å–ç›¸åº”çš„æ•°æ®ï¼Œæ˜¾ç„¶å¾ˆæµªè´¹æ€§èƒ½ã€‚å‡å¦‚èƒ½å¤Ÿåœ¨ä¸€ä¸ªæµé‡Œé¢å°±è¿›è¡Œå¤šæ¬¡è¾“å‡ºå°±å¥½äº†ï¼Œæ°å¥½ Flink çš„ Side Output åˆ™æä¾›äº†è¿™æ ·çš„åŠŸèƒ½ã€‚ å¦‚ä½•ä½¿ç”¨ï¼Ÿè¦ä½¿ç”¨ Side Output çš„è¯ï¼Œä½ é¦–å…ˆéœ€è¦åšçš„æ˜¯å®šä¹‰ä¸€ä¸ª OutputTag æ¥æ ‡è¯† Side Outputï¼Œä»£è¡¨è¿™ä¸ª Tag æ˜¯è¦æ”¶é›†å“ªç§ç±»å‹çš„æ•°æ®ï¼Œå¦‚æœæ˜¯è¦æ”¶é›†å¤šç§ä¸ä¸€æ ·ç±»å‹çš„æ•°æ®ï¼Œé‚£ä¹ˆä½ å°±éœ€è¦å®šä¹‰å¤šç§ OutputTagã€‚ä¾‹å¦‚ï¼šå¦‚æœæˆ‘è¦å°†å‘Šè­¦/æ¢å¤çš„æ•°æ®åˆ†ä¸ºæœºå™¨ã€å®¹å™¨ã€ä¸­é—´ä»¶ç­‰çš„æ•°æ®ï¼Œé‚£ä¹ˆæˆ‘ä»¬èµ·ç å°±å¾—å®šä¹‰ä¸‰ä¸ª OutputTagï¼Œå¦‚ä¸‹ï¼š 123456private static final OutputTag&lt;AlertEvent&gt; middleware = new OutputTag&lt;AlertEvent&gt;(\"MIDDLEWARE\") &#123;&#125;;private static final OutputTag&lt;AlertEvent&gt; machine = new OutputTag&lt;AlertEvent&gt;(\"MACHINE\") &#123;&#125;;private static final OutputTag&lt;AlertEvent&gt; docker = new OutputTag&lt;AlertEvent&gt;(\"DOCKER\") &#123;&#125;; ç„¶åå‘¢ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢å‡ ç§å‡½æ•°æ¥å¤„ç†æ•°æ®ï¼Œåœ¨å¤„ç†æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œè¿›è¡Œåˆ¤æ–­å°†ä¸åŒç§ç±»å‹çš„æ•°æ®å­˜åˆ°ä¸åŒçš„ OutputTag ä¸­å»ã€‚ ProcessFunction KeyedProcessFunction CoProcessFunction ProcessWindowFunction ProcessAllWindowFunction æ¯”å¦‚ï¼š 12345678910111213141516//dataStream æ˜¯æ€»çš„æ•°æ®æµSingleOutputStreamOperator&lt;AlertEvent, AlertEvent&gt; outputStream = dataStream.process(new ProcessFunction&lt;AlertEvent, AlertEvent&gt;() &#123; @Override public void processElement(AlertEvent value, Context ctx, Collector&lt;AlertEvent&gt; out) throws Exception &#123; if (\"MACHINE\".equals(value.type)) &#123; ctx.output(machine, value); &#125; else if (\"DOCKER\".equals(value.type)) &#123; ctx.output(docker, value); &#125; else if (\"MIDDLEWARE\".equals(value.type)) &#123; ctx.output(middleware, value); &#125; else &#123; //å…¶ä»–çš„ä¸šåŠ¡é€»è¾‘ out.collect(value); &#125; &#125;&#125;) å¥½äº†ï¼Œæ—¢ç„¶ä¸Šé¢æˆ‘ä»¬å·²ç»å°†ä¸åŒç±»å‹çš„æ•°æ®è¿›è¡Œæ”¾åˆ°ä¸åŒçš„ OutputTag é‡Œé¢äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¯¥å¦‚ä½•å»è·å–å‘¢ï¼Ÿä½ å¯ä»¥ä½¿ç”¨ getSideOutput æ–¹æ³•æ¥è·å–ä¸åŒ OutputTag çš„æ•°æ®ï¼Œæ¯”å¦‚ï¼š 12345678//æœºå™¨ç›¸å…³çš„å‘Šè­¦&amp;æ¢å¤æ•°æ®outputStream.getSideOutput(machine).print();//å®¹å™¨ç›¸å…³çš„å‘Šè­¦&amp;æ¢å¤æ•°æ®outputStream.getSideOutput(docker).print();//ä¸­é—´ä»¶ç›¸å…³çš„å‘Šè­¦&amp;æ¢å¤æ•°æ®outputStream.getSideOutput(middleware).print(); è¿™æ ·ä½ å°±å¯ä»¥è·å–åˆ° Side Output æ•°æ®äº†ã€‚ å¦å¤–ä½ è¿˜å¯ä»¥çœ‹ä¸‹æˆ‘åœ¨ Github æ”¾çš„ä¸€ä¸ªå®Œæ•´ demo ä»£ç : https://github.com/zhisheng17/flink-learning/blob/master/flink-learning-examples/src/main/java/com/zhisheng/examples/streaming/sideoutput/Main.java æ€»ç»“æœ¬æ–‡è®²äº†å¦‚ä½•ä½¿ç”¨ Side Output æ¥è¿›è¡Œåˆ†æµï¼Œæ¯”è¾ƒç®€å•ï¼Œå¤§å®¶å¯ä»¥ç¨å¾®é˜…è¯»ä¸€ä¸‹ demo ä»£ç å°±å¯ä»¥å¾ˆæ¸…æ¥šäº†è§£ã€‚ æœ¬æ–‡åœ°å€æ˜¯ï¼šhttp://www.54tianzhisheng.cn/2019/08/18/flink-side-output/ å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ çŸ¥è¯†æ˜Ÿçƒ ä¸“æ ä»‹ç»é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f Github ä»£ç ä»“åº“https://github.com/zhisheng17/flink-learning/ ä»¥åè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç éƒ½å°†æ”¾åœ¨è¿™ä¸ªä»“åº“é‡Œï¼ŒåŒ…å«äº†è‡ªå·±å­¦ä¹  flink çš„ä¸€äº› demo å’Œåšå®¢ åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€å®æˆ˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ","date":"2019-08-05T16:00:00.000Z","path":"2019/08/06/flink-streaming-system/","text":"åˆç†çš„éœ€æ±‚é€‰æ‹©æ°å½“çš„æŠ€æœ¯æ ˆ å‰è¨€ å…ˆå¹¿è€Œå‘Šä¹‹ï¼Œæœ¬æ–‡æ‘˜è‡ªæœ¬äººã€Šå¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flinkã€‹è¯¾ç¨‹ç¬¬äºŒç¯‡ï¼Œå†…å®¹é¦–å‘è‡ªæˆ‘çš„çŸ¥è¯†æ˜Ÿçƒï¼Œåé¢æŒç»­åœ¨æ˜Ÿçƒé‡Œæ›´æ–°ã€‚ è‡ªå·±ä¹‹å‰å‘å¸ƒè¿‡ä¸€ç¯‡ Chat ã€Šå¤§æ•°æ®â€œé‡ç£…ç‚¸å¼¹â€ï¼šå®æ—¶è®¡ç®—æ¡†æ¶ Flinkã€‹ï¼Œé‡Œé¢ä»‹ç»äº†å¤šç§éœ€æ±‚ï¼š 1234567891011121314151617å°ç”°ï¼Œä½ çœ‹èƒ½ä¸èƒ½åšä¸ªç›‘æ§å¤§å±å®æ—¶æŸ¥çœ‹ä¿ƒé”€æ´»åŠ¨é”€å”®é¢ï¼ˆGMVï¼‰ï¼Ÿå°æœ±ï¼Œæä¿ƒé”€æ´»åŠ¨çš„æ—¶å€™èƒ½ä¸èƒ½å®æ—¶ç»Ÿè®¡ä¸‹ç½‘ç«™çš„ PV/UV å•Šï¼Ÿå°é¹ï¼Œæˆ‘ä»¬ç°åœ¨æä¿ƒé”€æ´»åŠ¨èƒ½ä¸èƒ½å®æ—¶ç»Ÿè®¡é”€é‡ Top5 å•Šï¼Ÿå°æï¼Œæ€ä¹ˆå›äº‹å•Šï¼Ÿç°åœ¨æä¿ƒé”€æ´»åŠ¨ç»“æœæœåŠ¡å™¨å®•æœºäº†éƒ½æ²¡å‘Šè­¦ï¼Œèƒ½ä¸èƒ½åŠ ä¸€ä¸ªï¼Ÿå°åˆ˜ï¼ŒæœåŠ¡å™¨è¿™ä¼šå¥½å¡ï¼Œæ˜¯ä¸æ˜¯å‡ºäº†ä»€ä¹ˆé—®é¢˜å•Šï¼Œä½ çœ‹èƒ½ä¸èƒ½åšä¸ªç›‘æ§å¤§å±å®æ—¶æŸ¥çœ‹æœºå™¨çš„è¿è¡Œæƒ…å†µï¼Ÿå°èµµï¼Œæˆ‘ä»¬çº¿ä¸Šçš„åº”ç”¨é¢‘ç¹å‡ºç° Error æ—¥å¿—ï¼Œä½†æ˜¯åªæœ‰é äººè‚‰ä¸Šæœºå™¨æŸ¥çœ‹æ‰çŸ¥é“æƒ…å†µï¼Œèƒ½ä¸èƒ½åœ¨å‡ºç°é”™è¯¯çš„æ—¶å€™åŠæ—¶å‘Šè­¦é€šçŸ¥ï¼Ÿå°å¤ï¼Œæˆ‘ä»¬ 1 å…ƒç§’æ€ä¿ƒé”€æ´»åŠ¨ä¸­æœ‰ä»¶å•†å“è¢«æŸä¸ªç”¨æˆ·è–…äº† 100 ä»¶ï¼Œæ€ä¹ˆéƒ½æ²¡æœ‰é£æ§å•Šï¼Ÿå°å®‹ï¼Œä½ çœ‹æˆ‘ä»¬æä¿ƒé”€æ´»åŠ¨èƒ½ä¸èƒ½æ ¹æ®æ¯ä¸ªé¡¾å®¢çš„æµè§ˆè®°å½•å®æ—¶æ¨èä¸åŒçš„å•†å“å•Šï¼Ÿâ€¦â€¦ å¤§æ•°æ®å‘å±•è‡³ä»Šï¼Œæ•°æ®å‘ˆæŒ‡æ•°å€çš„å¢é•¿ï¼Œå¯¹å®æ•ˆæ€§çš„è¦æ±‚ä¹Ÿè¶Šæ¥è¶Šé«˜ï¼Œäºæ˜¯åƒä¸Šé¢è¿™ç§éœ€æ±‚ä¹Ÿå˜å¾—è¶Šæ¥è¶Šå¤šäº†ã€‚ é‚£è¿™äº›åœºæ™¯å¯¹åº”ç€ä»€ä¹ˆä¸šåŠ¡éœ€æ±‚å‘¢ï¼Ÿæˆ‘ä»¬æ¥æ€»ç»“ä¸‹ï¼Œå¤§æ¦‚å¦‚ä¸‹ï¼š åˆçœ‹è¿™äº›éœ€æ±‚ï¼Œæ˜¯ä¸æ˜¯æ„Ÿè§‰å¾ˆéš¾ï¼Ÿ é‚£ä¹ˆæˆ‘ä»¬æ¥ä¸‹æ¥æ¥åˆ†æä¸€ä¸‹è¯¥æ€ä¹ˆå»å®ç°ï¼Ÿ ä»è¿™äº›éœ€æ±‚æ¥çœ‹ï¼Œæœ€æ ¹æœ¬çš„ä¸šåŠ¡éƒ½æ˜¯éœ€è¦å®æ—¶æŸ¥çœ‹æ•°æ®ä¿¡æ¯ï¼Œé‚£ä¹ˆé¦–å…ˆæˆ‘ä»¬å¾—æƒ³æƒ³å¦‚ä½•å»é‡‡é›†è¿™äº›å®æ—¶æ•°æ®ï¼Œç„¶åå°†é‡‡é›†çš„å®æ—¶æ•°æ®è¿›è¡Œå®æ—¶çš„è®¡ç®—ï¼Œæœ€åå°†è®¡ç®—åçš„ç»“æœä¸‹å‘åˆ°ç¬¬ä¸‰æ–¹ã€‚ æ•°æ®å®æ—¶é‡‡é›†å°±ä¸Šé¢è¿™äº›éœ€æ±‚ï¼Œæˆ‘ä»¬éœ€è¦é‡‡é›†äº›ä»€ä¹ˆæ•°æ®å‘¢ï¼Ÿ ä¹°å®¶æœç´¢è®°å½•ä¿¡æ¯ ä¹°å®¶æµè§ˆçš„å•†å“ä¿¡æ¯ ä¹°å®¶ä¸‹å•è®¢å•ä¿¡æ¯ ç½‘ç«™çš„æ‰€æœ‰æµè§ˆè®°å½• æœºå™¨ CPU/MEM/IO ä¿¡æ¯ åº”ç”¨æ—¥å¿—ä¿¡æ¯ æ•°æ®å®æ—¶è®¡ç®—é‡‡é›†åçš„æ•°æ®å®æ—¶ä¸ŠæŠ¥åï¼Œéœ€è¦åšå®æ—¶çš„è®¡ç®—ï¼Œé‚£æˆ‘ä»¬æ€ä¹ˆå®ç°è®¡ç®—å‘¢ï¼Ÿ è®¡ç®—æ‰€æœ‰å•†å“çš„æ€»é”€å”®é¢ ç»Ÿè®¡å•ä¸ªå•†å“çš„é”€é‡ï¼Œæœ€åæ±‚ Top5 å…³è”ç”¨æˆ·ä¿¡æ¯å’Œæµè§ˆä¿¡æ¯ã€ä¸‹å•ä¿¡æ¯ ç»Ÿè®¡ç½‘ç«™æ‰€æœ‰çš„è¯·æ±‚ IP å¹¶ç»Ÿè®¡æ¯ä¸ª IP çš„è¯·æ±‚æ•°é‡ è®¡ç®—ä¸€åˆ†é’Ÿå†…æœºå™¨ CPU/MEM/IO çš„å¹³å‡å€¼ã€75 åˆ†ä½æ•°å€¼ è¿‡æ»¤å‡º Error çº§åˆ«çš„æ—¥å¿—ä¿¡æ¯ æ•°æ®å®æ—¶ä¸‹å‘å®æ—¶è®¡ç®—åçš„æ•°æ®ï¼Œéœ€è¦åŠæ—¶çš„ä¸‹å‘åˆ°ä¸‹æ¸¸ï¼Œè¿™é‡Œè¯´çš„ä¸‹æ¸¸ä»£è¡¨å¯èƒ½æ˜¯ï¼š å‘Šè­¦æ–¹å¼ï¼ˆé‚®ä»¶ã€çŸ­ä¿¡ã€é’‰é’‰ã€å¾®ä¿¡ï¼‰ åœ¨è®¡ç®—å±‚ä¼šå°†è®¡ç®—ç»“æœä¸é˜ˆå€¼è¿›è¡Œæ¯”è¾ƒï¼Œè¶…è¿‡é˜ˆå€¼è§¦å‘å‘Šè­¦ï¼Œè®©è¿ç»´æå‰æ”¶åˆ°é€šçŸ¥ï¼ŒåŠæ—¶åšå¥½åº”å¯¹æªæ–½ï¼Œå‡å°‘æ•…éšœçš„æŸå¤±å¤§å°ã€‚ å­˜å‚¨ï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ã€DBã€æ–‡ä»¶ç³»ç»Ÿç­‰ï¼‰ æ•°æ®å­˜å‚¨åï¼Œç›‘æ§å¤§ç›˜ï¼ˆDashboardï¼‰ä»å­˜å‚¨ï¼ˆElasticSearchã€HBase ç­‰ï¼‰é‡Œé¢æŸ¥è¯¢å¯¹åº”æŒ‡æ ‡çš„æ•°æ®å°±å¯ä»¥æŸ¥çœ‹å®æ—¶çš„ç›‘æ§ä¿¡æ¯ï¼Œåšåˆ°å¯¹ä¿ƒé”€æ´»åŠ¨çš„å•†å“é”€é‡ã€é”€å”®é¢ï¼Œæœºå™¨ CPUã€MEM ç­‰æœ‰å®æ—¶ç›‘æ§ï¼Œè¿è¥ã€è¿ç»´ã€å¼€å‘ã€é¢†å¯¼éƒ½å¯ä»¥å®æ—¶æŸ¥çœ‹å¹¶ä½œå‡ºå¯¹åº”çš„æªæ–½ã€‚ è®©è¿è¥çŸ¥é“å“ªäº›å•†å“æ˜¯çˆ†æ¬¾ï¼Œå“ªäº›åº—é“ºæˆäº¤é¢æœ€å¤šï¼Œå“ªäº›å•†å“æˆäº¤é¢æœ€é«˜ï¼Œå“ªäº›å•†å“æµè§ˆé‡æœ€å¤šï¼› è®©è¿ç»´å¯ä»¥æ—¶åˆ»äº†è§£æœºå™¨çš„è¿è¡ŒçŠ¶å†µï¼Œå‡ºç°å®•æœºæˆ–è€…å…¶ä»–ä¸ç¨³å®šæƒ…å†µå¯ä»¥åŠæ—¶å¤„ç†ï¼› è®©å¼€å‘çŸ¥é“è‡ªå·±é¡¹ç›®è¿è¡Œçš„æƒ…å†µï¼Œä» Error æ—¥å¿—çŸ¥é“å‡ºç°äº†å“ªäº› Bugï¼› è®©é¢†å¯¼çŸ¥é“è¿™æ¬¡ä¿ƒé”€èµšäº†å¤šå°‘ moneyã€‚ ä»æ•°æ®é‡‡é›†åˆ°æ•°æ®è®¡ç®—å†åˆ°æ•°æ®ä¸‹å‘ï¼Œæ•´ä¸ªæµç¨‹åœ¨ä¸Šé¢çš„åœºæ™¯å¯¹å®æ—¶æ€§è¦æ±‚è¿˜æ˜¯å¾ˆé«˜çš„ï¼Œä»»ä½•ä¸€ä¸ªåœ°æ–¹å‡ºç°é—®é¢˜éƒ½å°†å½±å“æœ€åçš„æ•ˆæœï¼ å®æ—¶è®¡ç®—åœºæ™¯å‰é¢è¯´äº†è¿™ä¹ˆå¤šåœºæ™¯ï¼Œè¿™é‡Œæˆ‘ä»¬æ€»ç»“ä¸€ä¸‹å®æ—¶è®¡ç®—å¸¸ç”¨çš„åœºæ™¯æœ‰å“ªäº›å‘¢ï¼Ÿ äº¤é€šä¿¡å·ç¯æ•°æ® é“è·¯ä¸Šè½¦æµé‡ç»Ÿè®¡ï¼ˆæ‹¥å µçŠ¶å†µï¼‰ å…¬å®‰è§†é¢‘ç›‘æ§ æœåŠ¡å™¨è¿è¡ŒçŠ¶æ€ç›‘æ§ é‡‘èè¯åˆ¸å…¬å¸å®æ—¶è·Ÿè¸ªè‚¡å¸‚æ³¢åŠ¨ï¼Œè®¡ç®—é£é™©ä»·å€¼ æ•°æ®å®æ—¶ ETL é“¶è¡Œæˆ–è€…æ”¯ä»˜å…¬å¸æ¶‰åŠé‡‘èç›—çªƒçš„é¢„è­¦ â€¦â€¦ å¦å¤–æˆ‘è‡ªå·±åœ¨æˆ‘çš„ç¾¤é‡Œä¹Ÿæœ‰åšè¿‡è°ƒç ”ï¼ˆä¸å®Œå…¨ç»Ÿè®¡ï¼‰ï¼Œä»–ä»¬åœ¨å…¬å¸ Flinkï¼ˆä¸€ä¸ªå®æ—¶è®¡ç®—æ¡†æ¶ï¼‰ä½¿ç”¨åœºæ™¯æœ‰è¿™äº›ï¼š æ€»ç»“ä¸€ä¸‹å¤§æ¦‚æœ‰ä¸‹é¢è¿™å››ç±»ï¼š å®æ—¶æ•°æ®å­˜å‚¨ å®æ—¶æ•°æ®å­˜å‚¨çš„æ—¶å€™åšä¸€äº›å¾®èšåˆã€è¿‡æ»¤æŸäº›å­—æ®µã€æ•°æ®è„±æ•ï¼Œç»„å»ºæ•°æ®ä»“åº“ï¼Œå®æ—¶ ETLã€‚ å®æ—¶æ•°æ®åˆ†æ å®æ—¶æ•°æ®æ¥å…¥æœºå™¨å­¦ä¹ æ¡†æ¶ï¼ˆTensorFlowï¼‰æˆ–è€…ä¸€äº›ç®—æ³•è¿›è¡Œæ•°æ®å»ºæ¨¡ã€åˆ†æï¼Œç„¶ååŠ¨æ€çš„ç»™å‡ºå•†å“æ¨èã€å¹¿å‘Šæ¨è å®æ—¶ç›‘æ§å‘Šè­¦ é‡‘èç›¸å…³æ¶‰åŠäº¤æ˜“ã€å®æ—¶é£æ§ã€è½¦æµé‡é¢„è­¦ã€æœåŠ¡å™¨ç›‘æ§å‘Šè­¦ã€åº”ç”¨æ—¥å¿—å‘Šè­¦ å®æ—¶æ•°æ®æŠ¥è¡¨ æ´»åŠ¨è¥é”€æ—¶é”€å”®é¢/é”€å”®é‡å¤§å±ï¼ŒTopN å•†å“ è¯´åˆ°å®æ—¶è®¡ç®—ï¼Œè¿™é‡Œä¸å¾—ä¸è®²ä¸€ä¸‹å’Œä¼ ç»Ÿçš„ç¦»çº¿è®¡ç®—çš„åŒºåˆ«ï¼ å®æ—¶è®¡ç®— VS ç¦»çº¿è®¡ç®—å†è®²è¿™ä¸¤ä¸ªåŒºåˆ«ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æµå¤„ç†å’Œæ‰¹å¤„ç†çš„åŒºåˆ«ï¼š æµå¤„ç†ä¸æ‰¹å¤„ç† çœ‹å®Œæµå¤„ç†ä¸æ‰¹å¤„ç†è¿™ä¸¤è€…çš„åŒºåˆ«ä¹‹åï¼Œæˆ‘ä»¬æ¥æŠ½è±¡ä¸€ä¸‹å‰é¢æ–‡ç« çš„åœºæ™¯éœ€æ±‚ï¼ˆå®æ—¶è®¡ç®—ï¼‰ï¼š å®æ—¶è®¡ç®—éœ€è¦ä¸æ–­çš„ä» MQ ä¸­è¯»å–é‡‡é›†çš„æ•°æ®ï¼Œç„¶åå¤„ç†è®¡ç®—åå¾€ DB é‡Œå­˜å‚¨ï¼Œåœ¨è®¡ç®—è¿™å±‚ä½ æ— æ³•æ„ŸçŸ¥åˆ°ä¼šæœ‰å¤šå°‘æ•°æ®é‡è¿‡æ¥ã€è¦åšä¸€äº›ç®€å•çš„æ“ä½œï¼ˆè¿‡æ»¤ã€èšåˆç­‰ï¼‰ã€åŠæ—¶å°†æ•°æ®ä¸‹å‘ã€‚ ç›¸æ¯”ä¼ ç»Ÿçš„ç¦»çº¿è®¡ç®—ï¼Œå®ƒå´æ˜¯è¿™æ ·çš„ï¼š åœ¨è®¡ç®—è¿™å±‚ï¼Œå®ƒä» DBï¼ˆä¸é™ MySQLï¼Œè¿˜æœ‰å…¶ä»–çš„å­˜å‚¨ä»‹è´¨ï¼‰é‡Œé¢è¯»å–æ•°æ®ï¼Œè¯¥æ•°æ®ä¸€èˆ¬å°±æ˜¯å›ºå®šçš„ï¼ˆå‰ä¸€å¤©ã€å‰ä¸€æ˜ŸæœŸã€å‰ä¸€ä¸ªæœˆï¼‰ï¼Œç„¶åå†åšä¸€äº›å¤æ‚çš„è®¡ç®—æˆ–è€…ç»Ÿè®¡åˆ†æï¼Œæœ€åç”Ÿæˆå¯ä¾›ç›´è§‚æŸ¥çœ‹çš„æŠ¥è¡¨ï¼ˆdashboardï¼‰ã€‚ ç¦»çº¿è®¡ç®—çš„ç‰¹ç‚¹ æ•°æ®é‡å¤§ä¸”æ—¶é—´å‘¨æœŸé•¿ï¼ˆä¸€å¤©ã€ä¸€æ˜ŸæœŸã€ä¸€ä¸ªæœˆã€åŠå¹´ã€ä¸€å¹´ï¼‰ åœ¨å¤§é‡æ•°æ®ä¸Šè¿›è¡Œå¤æ‚çš„æ‰¹é‡è¿ç®— æ•°æ®åœ¨è®¡ç®—ä¹‹å‰å·²ç»å›ºå®šï¼Œä¸å†ä¼šå‘ç”Ÿå˜åŒ– èƒ½å¤Ÿæ–¹ä¾¿çš„æŸ¥è¯¢æ‰¹é‡è®¡ç®—çš„ç»“æœ å®æ—¶è®¡ç®—çš„ç‰¹ç‚¹åœ¨å¤§æ•°æ®ä¸­ä¸ç¦»çº¿è®¡ç®—å¯¹åº”çš„åˆ™æ˜¯å®æ—¶è®¡ç®—ï¼Œé‚£ä¹ˆå®æ—¶è®¡ç®—æœ‰ä»€ä¹ˆç‰¹ç‚¹å‘¢ï¼Ÿç”±äºåº”ç”¨åœºæ™¯çš„å„ä¸ç›¸åŒï¼Œæ‰€ä»¥è¿™ä¸¤ç§è®¡ç®—å¼•æ“æ¥æ”¶æ•°æ®çš„æ–¹å¼ä¹Ÿä¸å¤ªä¸€æ ·ï¼šç¦»çº¿è®¡ç®—çš„æ•°æ®æ˜¯å›ºå®šçš„ï¼ˆä¸å†ä¼šå‘ç”Ÿå˜åŒ–ï¼‰ï¼Œé€šå¸¸ç¦»çº¿è®¡ç®—çš„ä»»åŠ¡éƒ½æ˜¯å®šæ—¶çš„ï¼Œå¦‚ï¼šæ¯å¤©æ™šä¸Š 0 ç‚¹çš„æ—¶å€™å®šæ—¶è®¡ç®—å‰ä¸€å¤©çš„æ•°æ®ï¼Œç”ŸæˆæŠ¥è¡¨ï¼›ç„¶è€Œå®æ—¶è®¡ç®—çš„æ•°æ®æºå´æ˜¯æµå¼çš„ã€‚ è¿™é‡Œæˆ‘ä¸å¾—ä¸è®²è®²ä»€ä¹ˆæ˜¯æµå¼æ•°æ®å‘¢ï¼Ÿæˆ‘çš„ç†è§£æ˜¯æ¯”å¦‚ä½ åœ¨æ·˜å®ä¸Šä¸‹å•äº†æŸä¸ªå•†å“æˆ–è€…ç‚¹å‡»æµè§ˆäº†æŸä»¶å•†å“ï¼Œä½ å°±ä¼šå‘ç°ä½ çš„é¡µé¢ç«‹é©¬å°±ä¼šç»™ä½ æ¨èè¿™ç§å•†å“çš„å¹¿å‘Šå’Œç±»ä¼¼å•†å“çš„åº—é“ºï¼Œè¿™ç§å°±æ˜¯å±äºå®æ—¶æ•°æ®å¤„ç†ç„¶åä½œå‡ºç›¸å…³æ¨èï¼Œè¿™ç±»æ•°æ®éœ€è¦ä¸æ–­çš„ä»ä½ åœ¨ç½‘é¡µä¸Šçš„ç‚¹å‡»åŠ¨ä½œä¸­è·å–æ•°æ®ï¼Œä¹‹åè¿›è¡Œå®æ—¶åˆ†æç„¶åç»™å‡ºæ¨èã€‚ æµå¼æ•°æ®çš„ç‰¹ç‚¹ æ•°æ®å®æ—¶åˆ°è¾¾ æ•°æ®åˆ°è¾¾æ¬¡åºç‹¬ç«‹ï¼Œä¸å—åº”ç”¨ç³»ç»Ÿæ‰€æ§åˆ¶ æ•°æ®è§„æ¨¡å¤§ä¸”æ— æ³•é¢„çŸ¥å®¹é‡ åŸå§‹æ•°æ®ä¸€ç»å¤„ç†ï¼Œé™¤éç‰¹æ„ä¿å­˜ï¼Œå¦åˆ™ä¸èƒ½è¢«å†æ¬¡å–å‡ºå¤„ç†ï¼Œæˆ–è€…å†æ¬¡æå–æ•°æ®ä»£ä»·æ˜‚è´µ å®æ—¶è®¡ç®—çš„ä¼˜åŠ¿å®æ—¶è®¡ç®—ä¸€æ—¶çˆ½ï¼Œä¸€ç›´å®æ—¶è®¡ç®—ä¸€ç›´çˆ½ï¼Œå¯¹äºæŒç»­ç”Ÿæˆæœ€æ–°æ•°æ®çš„åœºæ™¯ï¼Œé‡‡ç”¨æµæ•°æ®å¤„ç†æ˜¯éå¸¸æœ‰åˆ©çš„ã€‚ä¾‹å¦‚ï¼Œå†ç›‘æ§æœåŠ¡å™¨çš„ä¸€äº›è¿è¡ŒæŒ‡æ ‡çš„æ—¶å€™ï¼Œèƒ½æ ¹æ®é‡‡é›†ä¸Šæ¥çš„å®æ—¶æ•°æ®è¿›è¡Œåˆ¤æ–­ï¼Œå½“è¶…å‡ºä¸€å®šé˜ˆå€¼çš„æ—¶å€™å‘å‡ºè­¦æŠ¥ï¼Œè¿›è¡Œæé†’ä½œç”¨ã€‚å†å¦‚é€šè¿‡å¤„ç†æµæ•°æ®ç”Ÿæˆç®€å•çš„æŠ¥å‘Šï¼Œå¦‚äº”åˆ†é’Ÿçš„çª—å£èšåˆæ•°æ®å¹³å‡å€¼ã€‚å¤æ‚çš„äº‹æƒ…è¿˜æœ‰åœ¨æµæ•°æ®ä¸­è¿›è¡Œæ•°æ®å¤šç»´åº¦å…³è”ã€èšåˆã€å¡é€‰ï¼Œä»è€Œæ‰¾åˆ°å¤æ‚äº‹ä»¶ä¸­çš„æ ¹å› ã€‚æ›´ä¸ºå¤æ‚çš„æ˜¯åšä¸€äº›å¤æ‚çš„æ•°æ®åˆ†ææ“ä½œï¼Œå¦‚åº”ç”¨æœºå™¨å­¦ä¹ ç®—æ³•ï¼Œç„¶åæ ¹æ®ç®—æ³•å¤„ç†åçš„æ•°æ®ç»“æœæå–å‡ºæœ‰æ•ˆçš„ä¿¡æ¯ï¼Œä½œå‡ºã€ç»™å‡ºä¸ä¸€æ ·çš„æ¨èå†…å®¹ï¼Œè®©ä¸åŒçš„äººå¯ä»¥çœ‹è§ä¸åŒçš„ç½‘é¡µï¼ˆåƒäººåƒé¢ï¼‰ã€‚ ä½¿ç”¨å®æ—¶æ•°æ®æµé¢ä¸´çš„æŒ‘æˆ˜ æ•°æ®å¤„ç†å”¯ä¸€æ€§ï¼ˆå¦‚ä½•ä¿è¯æ•°æ®åªå¤„ç†ä¸€æ¬¡ï¼Ÿè‡³å°‘ä¸€æ¬¡ï¼Ÿæœ€å¤šä¸€æ¬¡ï¼Ÿï¼‰ æ•°æ®å¤„ç†çš„åŠæ—¶æ€§ï¼ˆé‡‡é›†çš„å®æ—¶æ•°æ®é‡å¤ªå¤§çš„è¯å¯èƒ½ä¼šå¯¼è‡´çŸ­æ—¶é—´å†…å¤„ç†ä¸è¿‡æ¥ï¼Œå¦‚ä½•ä¿è¯æ•°æ®èƒ½å¤ŸåŠæ—¶çš„å¤„ç†ï¼Œä¸å‡ºç°æ•°æ®å †ç§¯ï¼Ÿï¼‰ æ•°æ®å¤„ç†å±‚å’Œå­˜å‚¨å±‚çš„å¯æ‰©å±•æ€§ï¼ˆå¦‚ä½•æ ¹æ®é‡‡é›†çš„å®æ—¶æ•°æ®é‡çš„å¤§å°æä¾›åŠ¨æ€æ‰©ç¼©å®¹ï¼Ÿï¼‰ æ•°æ®å¤„ç†å±‚å’Œå­˜å‚¨å±‚çš„å®¹é”™æ€§ï¼ˆå¦‚ä½•ä¿è¯æ•°æ®å¤„ç†å±‚å’Œå­˜å‚¨å±‚é«˜å¯ç”¨ï¼Œå‡ºç°æ•…éšœæ—¶æ•°æ®å¤„ç†å±‚å’Œå­˜å‚¨å±‚æœåŠ¡ä¾æ—§å¯ç”¨ï¼Ÿï¼‰ æ€»ç»“æœ¬æ–‡ä»æ—¥å¸¸éœ€æ±‚æ¥åˆ†æè¯¥å¦‚ä½•å»å®ç°è¿™ç±»éœ€æ±‚ï¼Œéœ€è¦å®æ—¶é‡‡é›†ã€å®æ—¶è®¡ç®—ã€å®æ—¶ä¸‹å‘ï¼Œå¹¶ç”¨å›¾ç‰‡æŠŠéœ€æ±‚å®Œæˆåçš„æ•ˆæœå›¾å±•ç¤ºäº†å‡ºæ¥ï¼Œæ¥ç€æˆ‘ä»¬åˆ†æäº†å¯¹å®æ—¶æ€§è¦æ±‚é«˜çš„è®¡ç®—è¿™å—ï¼Œç„¶åå°†ç¦»çº¿è®¡ç®—ä¸å®æ—¶è®¡ç®—è¿›è¡Œäº†å¯¹æ¯”ã€æ‰¹å¤„ç†ä¸æµå¤„ç†è¿›è¡Œå¯¹æ¯”ã€ç¦»çº¿è®¡ç®—çš„ç‰¹ç‚¹ä¸å®æ—¶è®¡ç®—çš„ç‰¹ç‚¹è¿›è¡Œäº†å¯¹æ¯”ï¼Œå†åŠ ä¸Šæˆ‘è‡ªå·±çš„è°ƒç ”ç»“æœï¼Œå½’çº³äº†å®æ—¶è®¡ç®—çš„å››ç§ä½¿ç”¨åœºæ™¯ï¼Œæå‡ºäº†ä½¿ç”¨å®æ—¶è®¡ç®—æ—¶è¦é¢ä¸´çš„æŒ‘æˆ˜ã€‚å› ä¸ºå„ç§éœ€æ±‚ï¼Œä¹Ÿå°±é€ å°±äº†ç°åœ¨ä¸æ–­å‡ºç°å®æ—¶è®¡ç®—æ¡†æ¶ï¼Œè€Œä¸‹æ–‡æˆ‘ä»¬å°†é‡ç£…ä»‹ç»æˆ‘ä»¬æ¨èçš„å®æ—¶è®¡ç®—æ¡†æ¶ â€”â€” Flinkã€‚ Github ä»£ç ä»“åº“https://github.com/zhisheng17/flink-learning/ ä»¥åè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç éƒ½å°†æ”¾åœ¨è¿™ä¸ªä»“åº“é‡Œï¼ŒåŒ…å«äº†è‡ªå·±å­¦ä¹  flink çš„ä¸€äº› demo å’Œåšå®¢ã€‚ å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ ä¸“æ ä»‹ç»é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€å®æˆ˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"Flink Clients æºç è§£æ","date":"2019-07-03T16:00:00.000Z","path":"2019/07/04/Flink-code-clients/","text":"Flink-Client æ¨¡å—ä¸­çš„ç±»ç»“æ„å¦‚ä¸‹ï¼š https://t.zsxq.com/IMzNZjY åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€å®æˆ˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"Flink Annotations æºç è§£æ","date":"2019-07-02T16:00:00.000Z","path":"2019/07/03/Flink-code-Annotations/","text":"Flink-Annotations æ¨¡å—ä¸­çš„ç±»ç»“æ„å¦‚ä¸‹ï¼š https://t.zsxq.com/f6eAu3J åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€åŸç†ã€å®æˆ˜ã€æ€§èƒ½è°ƒä¼˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"Flink Metrics æºç è§£æ","date":"2019-07-01T16:00:00.000Z","path":"2019/07/02/Flink-code-metrics/","text":"Flink Metrics æœ‰å¦‚ä¸‹æ¨¡å—ï¼š Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus ä½¿ç”¨ InflubDB å’Œ Grafana ç›‘æ§ Flink JobManager TaskManager å’Œ Job åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€åŸç†ã€å®æˆ˜ã€æ€§èƒ½è°ƒä¼˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯»","date":"2019-06-30T16:00:00.000Z","path":"2019/07/01/flink-1.9-preview/","text":"ä»Šå¤©åœ¨ Apache Flink meetup Â·åŒ—äº¬ç«™è¿›è¡Œ Flink 1.9 é‡å¤§æ–°ç‰¹æ€§è¿›è¡Œäº†è®²è§£ï¼Œä¸¤ä½è®²å¸ˆåˆ†åˆ«æ˜¯ æˆ´èµ„åŠ›/æ¨å…‹ç‰¹ï¼Œzhisheng æˆ‘ä¹Ÿä»çœ‹å®Œäº†æ•´ä¸ª 1.9 ç‰¹æ€§è§£è¯»çš„ç›´æ’­ï¼Œé¢„è®¡ Flink 1.9 ç‰ˆæœ¬æ­£å¼å‘å¸ƒæ—¶é—´å¤§æ¦‚æ˜¯ 7 æœˆåº• 8 æœˆåˆå·¦å³æ­£å¼å‘å¸ƒï¼Œä¸‹é¢ä¸€èµ·æ¥çœ‹çœ‹ç›´æ’­å†…å®¹ï¼š æ¶æ„æ”¹åŠ¨ Table/SQL API Runtime ç”Ÿæ€ æœ€åGitHub Flink å­¦ä¹ ä»£ç åœ°å€ï¼šhttps://github.com/zhisheng17/flink-learning å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ ä¸“æ ä»‹ç»é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€åŸç†ã€å®æˆ˜ã€æ€§èƒ½è°ƒä¼˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº†","date":"2019-06-25T16:00:00.000Z","path":"2019/06/26/flink-TensorFlow/","text":"1ï¼å‰è¨€éšç€äº’è”ç½‘çš„è¿…é€Ÿå‘å±•ï¼Œå„ä¸ªå…¬å¸éƒ½å»ºç«‹äº†è‡ªå·±çš„ç›‘æ§ä½“ç³»ï¼Œç”¨äºæå‰å‘ç°é—®é¢˜é™ä½æŸå¤±ï¼Œæºç¨‹äº¦æ˜¯å¦‚æ­¤ã€‚ç„¶è€Œæºç¨‹çš„ç›‘æ§ä½“ç³»å­˜åœ¨ä»¥ä¸‹ä¸‰ä¸ªé—®é¢˜ï¼š æœ¬æ–‡è½¬è‡ª AI å‰çº¿å…¬ä¼—å·ï¼Œä½œè€… | æ½˜å›½åº† ç¼–è¾‘ | Natalie Flink å·²ç»æ¸æ¸æˆä¸ºå®æ—¶è®¡ç®—å¼•æ“çš„é¦–é€‰ä¹‹ä¸€ï¼Œä»ç®€å•çš„å®æ—¶ ETL åˆ°å¤æ‚çš„ CEP åœºæ™¯ï¼ŒFlink éƒ½èƒ½å¤Ÿå¾ˆå¥½åœ°é©¾é©­ã€‚æœ¬æ–‡æ•´ç†è‡ªæºç¨‹å®æ—¶è®¡ç®—è´Ÿè´£äººæ½˜å›½åº†åœ¨ QCon å…¨çƒè½¯ä»¶å¼€å‘å¤§ä¼šï¼ˆåŒ—äº¬ç«™ï¼‰2019 çš„æ¼”è®²ï¼Œä»–ä»‹ç»äº†æºç¨‹å¦‚ä½•åŸºäº Flink ä¸ TensorFlow æ„å»ºå®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Œä»¥è§£å†³è§„åˆ™å‘Šè­¦ç³»ç»Ÿå‡†ç¡®ç‡ä½ã€æ—¶æ•ˆæ€§ä½ã€è§„åˆ™é…ç½®å¤æ‚ä¸è€—è´¹äººåŠ›ç­‰è¯¸å¤šé—®é¢˜ï¼Œå®ç°äº†ä¸šåŠ¡æŒ‡æ ‡æ¯«ç§’çº§å»¶è¿Ÿä¸æ™ºèƒ½åŒ–æ£€æµ‹ï¼ŒåŒæ—¶ä¾æ‰˜ Flink å®ç°äº†å¼ºå¤§çš„å®¹é”™æœºåˆ¶ã€‚ ç›‘æ§ç³»ç»Ÿç¹å¤š ç›‘æ§å‘Šè­¦é…ç½®å¤æ‚ æ²¡æœ‰ç»Ÿä¸€è§„èŒƒ é¦–å…ˆæºç¨‹ç›®å‰å…‰å…¬å¸çº§åˆ«çš„ç›‘æ§ç³»ç»Ÿå°±æœ‰ä¸‰å¥—ï¼Œå„ä¸ª BU ä¸ºäº†æ»¡è¶³è‡ªå·±çš„ä¸šåŠ¡ç›‘æ§éœ€æ±‚ä¹Ÿé™†ç»­å¼€å‘äº†è®¸å¤šè‡ªå·±çš„ç›‘æ§ç³»ç»Ÿã€‚å…¶æ¬¡è¿™äº›ç›‘æ§ç³»ç»Ÿéƒ½æ˜¯åŸºäºè§„åˆ™æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨å¼‚å¸¸ï¼Œæ¯”å¦‚å½“æ»¡è¶³åŒç¯æ¯”è¿ç»­å‡ ä¸ªç‚¹ä¸Šå‡æˆ–ä¸‹é™åˆ°ç”¨æˆ·é…ç½®çš„é˜ˆå€¼æ—¶è§¦å‘å‘Šè­¦ã€‚æœ€åæ˜¯æ²¡æœ‰ç»Ÿä¸€çš„è§„èŒƒï¼Œè¿™é‡ŒæŒ‡çš„æ˜¯ä¸¤ä¸ªè§„èŒƒï¼Œç¬¬ä¸€ï¼Œæ²¡æœ‰ç»Ÿä¸€çš„è§„åˆ™å‘Šè­¦é…ç½®è§„èŒƒï¼Œä¸åŒçš„ç›‘æ§ç³»ç»Ÿéƒ½å¸¦æœ‰ä¸åŒçš„è§„åˆ™å‘Šè­¦é…ç½®æ–¹å¼ï¼›ç¬¬äºŒï¼Œæ²¡æœ‰ç»Ÿä¸€çš„å¼‚å¸¸åˆ¤æ–­è§„èŒƒï¼Œç ”å‘äººå‘˜æˆ– QA äººå‘˜éƒ½æ˜¯æ ¹æ®è‡ªå·±å¯¹ä¸šåŠ¡çš„ç†è§£ï¼Œé€šè¿‡ä¸»è§‚åˆ¤æ–­æŒ‡æ ‡è¾¾åˆ°ä¸€å®šé˜€å€¼æ—¶ç›‘æ§ç³»ç»Ÿéœ€è¦è¿›è¡Œå‘Šè­¦ã€‚ åŸºäºä»¥ä¸Šçš„ä¸‰ç‚¹é—®é¢˜ç»™ç”¨æˆ·å¸¦æ¥äº†è¯¸å¤šä¸ä¾¿ï¼Œé¦–å…ˆæ˜¯è§„åˆ™å‘Šè­¦ç»´æŠ¤æˆæœ¬é«˜ï¼Œç”¨æˆ·æ—¶å¸¸éœ€è¦åŸºäºå¤šä¸ªç›‘æ§ç³»ç»Ÿä»¥ä¸åŒçš„æ–¹å¼é…ç½®è§„åˆ™å‘Šè­¦ï¼Œè€Œä¸”è¿˜éœ€è¦æ ¹æ®å‘Šè­¦çš„æƒ…å†µæŒç»­è°ƒæ•´é˜ˆå€¼ï¼Œå¯¼è‡´ä¸€ä¸ªè§„åˆ™å‘Šè­¦ä»é…ç½®åˆ°æœ€ç»ˆèƒ½å¤Ÿäº§ç”Ÿè¾ƒå¥½çš„æ•ˆæœéœ€è¦ä¸€ä¸ªå¾ˆé•¿çš„å‘¨æœŸã€‚å…¶æ¬¡ï¼ŒåŸºäºè§„åˆ™å‘Šè­¦å¾€å¾€è¡¨ç°ä¸å°½å¦‚äººæ„ï¼Œä¼šå¯¼è‡´å‡†ç¡®ç‡ä½ã€è¦†ç›–ç‡ä½å’Œæ—¶æ•ˆæ€§ä½çš„ä¸‰ä½çŠ¶å†µã€‚ç”¨æˆ·å¾ˆå¤šæƒ…å†µä¸‹ä¸ºäº†æé«˜å¼‚å¸¸çš„è¦†ç›–ç‡é™ä½æ¼æŠ¥çš„æƒ…å†µï¼Œä¸å¾—ä¸å°†è§„åˆ™å‘Šè­¦çš„é˜€å€¼è®¾ç½®çš„éå¸¸æ•æ„Ÿï¼Œè™½ç„¶è¿™æ ·èƒ½å¤Ÿè¦†ç›–æ›´å¤šçš„å¼‚å¸¸åœºæ™¯ï¼Œå´å¯¼è‡´äº†å¤§é‡çš„è¯¯æŠ¥ï¼Œè§„åˆ™å‘Šè­¦çš„å‡†ç¡®æ€§ä¹Ÿå°±å¤§å¤§æŠ˜æ‰£ã€‚ ä¸ºäº†åº”å¯¹ä¸Šè¿°çš„è¯¸å¤šé—®é¢˜ï¼Œæºç¨‹æ‰“é€ äº†è‡ªå·±çš„å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å° Prophetã€‚ç®€å•æ¦‚æ‹¬ï¼ŒProphet æ˜¯ä¸€ä¸ªåŸºäºæ—¶åºç±»å‹æ•°æ®ã€ä»¥å¹³å°ä¸ºæ¥å…¥å¯¹è±¡ã€å»è§„åˆ™åŒ–ä¸ºç›®æ ‡çš„å¼‚å¸¸æ£€æµ‹ç³»ç»Ÿï¼ŒåŸºäºæ·±åº¦å­¦ä¹ ç®—æ³•å®ç°å¼‚å¸¸çš„æ™ºèƒ½æ£€æµ‹ï¼ŒåŸºäºå®æ—¶è®¡ç®—å¼•æ“å®ç°å¼‚å¸¸çš„å®æ—¶æ£€æµ‹ï¼Œæä¾›äº†ç»Ÿä¸€çš„å¼‚å¸¸æ£€æµ‹è§£å†³æ–¹æ¡ˆã€‚æ¥ä¸‹æ¥çš„æ–‡ç« ä¼šè¯¦ç»†ä»‹ç»æˆ‘ä»¬æ˜¯å¦‚ä½•ä¾æ¬¡å®ç°äº†å¼‚å¸¸çš„æ™ºèƒ½åŒ–ã€å®æ—¶åŒ–æ£€æµ‹ä»¥åŠå¹³å°çš„æ„å»ºã€‚ 2ï¼ æ™ºèƒ½åŒ–2.1 æ·±åº¦å­¦ä¹ ç®—æ³•é€‰æ‹©ç›®å‰ä¸šç•Œé‡‡ç”¨æ¯”è¾ƒå¤šçš„æ–¹å¼æ˜¯å¼•å…¥ç»Ÿè®¡åˆ†æçš„å„ç§æ–¹æ³•ï¼Œæ¡†å®šä¸€ä¸ªæ»‘åŠ¨çš„æ ·æœ¬é›†ï¼Œå¯¹è¿™ä¸ªæ ·æœ¬é›†è¿›è¡Œä¸€äº›æ•°æ®å¤„ç†å’Œè½¬åŒ–ï¼Œç»è¿‡å½’ä¸€åŒ–ï¼Œå»å‘¨æœŸï¼Œå»è¶‹åŠ¿ï¼Œå†å°†æœ€æ–°é‡‡é›†åˆ°çš„æ•°æ®ç‚¹ç»è¿‡åŒæ ·çš„è½¬æ¢ï¼Œå’Œæ ·æœ¬é›†çš„æ®‹å·®åºåˆ—çš„ç»Ÿè®¡é‡è¿›è¡Œæ¯”è¾ƒï¼Œæ¯”å¦‚è·ç¦»ã€æ–¹å·®ã€ç§»åŠ¨å¹³å‡ã€åˆ†ä½æ•°ç­‰ï¼Œè¶…å‡ºä¸€å®šçš„èŒƒå›´å°±åˆ¤æ–­ä¸ºå¼‚å¸¸ï¼Œæˆ–æ˜¯ç»¼åˆå„ç§ç¦»ç¾¤ç‚¹è®¡ç®—çš„æ–¹æ³•æ¥åšä¸ªæŠ•ç¥¨ï¼Œå¤šæ•°ç®—æ³•è®¤ä¸ºå¼‚å¸¸åˆ™æŠ¥å¼‚å¸¸ã€‚èµ·åˆæˆ‘ä»¬ä¹Ÿå€Ÿé‰´äº†è¿™ç§åšæ³•ï¼Œå´å‘ç°è™½ç„¶å¯ä»¥ä¸ç”¨ç»´æŠ¤å‘Šè­¦è§„åˆ™äº†ï¼Œä½†æŠ¥è­¦çš„è´¨é‡å¹¶æ²¡æœ‰æå‡ã€‚ æˆ‘ä»¬éœ€è¦è®¾è®¡ä¸€å¥—æ–°çš„ç®—æ³•ï¼Œé™ä½æŠ¥è­¦æ€»é‡åˆ°å¯ä»¥äººå·¥é€ä¸ªå¤„ç†çš„ç¨‹åº¦ï¼ŒåŒæ—¶ä¸èƒ½ä»¥å¢åŠ æ¼æŠ¥çœŸæ­£çš„ç”Ÿäº§è®¢å•æ•…éšœä¸ºä»£ä»·ï¼Œå¹¶ä¸”è¿™å¥—ç®—æ³•çš„è®¾è®¡è¿˜ä¸èƒ½å¤ªå¤æ‚ï¼Œå½±å“åˆ°å‘Šè­¦çš„å®æ—¶æ€§ï¼Œæœ€å¥½è¿˜èƒ½åšåˆ°ç®—æ³•å³æœåŠ¡ï¼Œæœ‰è¾ƒå¼ºçš„å¯ç§»æ¤æ€§ï¼Œæä¾›ç»™å…¶ä»–çš„ç›‘æ§ç³»ç»Ÿä½¿ç”¨ã€‚è‡ªç„¶è€Œç„¶çš„ï¼ŒåŸºäºç¥ç»ç½‘ç»œçš„æ·±åº¦å­¦ä¹ ç®—æ³• æˆä¸ºæˆ‘ä»¬è¿›ä¸€æ­¥æ¢ç´¢çš„å·¥å…·ã€‚ RNN ç®—æ³•æ¯”è¾ƒé€‚åˆå¤„ç†åºåˆ—å˜åŒ–çš„æ•°æ®ï¼Œç¬¦åˆæˆ‘ä»¬æ—¶åºç‰¹å¾çš„åœºæ™¯ï¼Œä½†æ˜¯å­˜åœ¨æ¢¯åº¦æ¶ˆå¤±å’Œè¿‡æ‹Ÿåˆçš„ç°è±¡ã€‚è€Œä»–çš„æ”¹è¿›ç‰ˆ LSTM ç®—æ³•ï¼Œèƒ½å¤Ÿé€šè¿‡æ§åˆ¶ä¼ è¾“çŠ¶æ€æ¥é€‰æ‹©æ€§åœ°è®°ä½è¾ƒé‡è¦çš„é•¿æœŸæ•°æ®ï¼Œèƒ½åœ¨æ›´é•¿çš„åºåˆ—ä¸Šæœ‰è‰¯å¥½çš„è¡¨ç°ï¼Œä¸šç•Œä¹Ÿæœ‰å¾ˆå¤šæˆåŠŸçš„åº”ç”¨ã€‚LSTM ç®—æ³•çš„å¼‚å¸¸æ£€æµ‹æ–¹å¼æ˜¯åŸºäºæŒ‡æ ‡çš„å†å²æ•°æ®è®­ç»ƒå‡ºæ¨¡å‹å¹¶åŸºäºç°æœ‰æ•°æ®é¢„æµ‹æŒ‡æ ‡æœªæ¥çš„èµ°åŠ¿ï¼ŒåŸºäºé¢„æµ‹æ•°æ®ä¸ç°å®æ•°æ®å„ç§åå·®æ¥åˆ¤æ–­æŒ‡æ ‡æ˜¯å¦æœ‰å¼‚å¸¸ã€‚è¿™æ ·å¥½å¤„åœ¨äºæ¯ä¸ªæŒ‡æ ‡éƒ½ä¼šè®­ç»ƒä¸€ä¸ªè‡ªå·±çš„æ¨¡å‹ï¼Œèƒ½å¤Ÿè¾¾åˆ°å¾ˆé«˜çš„ç²¾åº¦ï¼Œä½†æ˜¯ä¹Ÿå¸¦æ¥äº†ä¸€å®šçš„å¼Šç«¯ï¼Œéœ€è¦æ¶ˆè€—è¾ƒå¤šçš„è®­ç»ƒä¸æ£€æµ‹èµ„æºã€‚ DNN ç®—æ³•çš„æ£€æµ‹æ–¹å¼ä¸ LSTM çš„æ–¹å¼ä¸åŒï¼Œæˆ‘ä»¬åŸºäºå°æ³¢å˜æ¢ç®—æ³•æå–ç›‘æ§æŒ‡æ ‡ä¸åŒé¢‘åŸŸçš„ç‰¹å¾å–‚ç»™ DNN æ¨¡å‹ï¼Œç›´æ¥è¾“å‡ºæ˜¯å¦å­˜åœ¨å¼‚å¸¸ã€‚è¿™ç§çš„å¥½å¤„åœ¨äºä¸€ä¸ª DNN æ¨¡å‹å°±èƒ½å¤Ÿæ»¡è¶³æ‰€æœ‰å¼‚å¸¸æ£€æµ‹åœºæ™¯çš„éœ€æ±‚ï¼Œä½†æ˜¯ç›¸å¯¹çš„ç‰¹å¾å·¥ç¨‹ä¹Ÿè¦å¤æ‚å¾ˆå¤šï¼Œæˆ‘ä»¬éœ€è¦å¤§é‡çš„äººå·¥æ ‡è®°æ•°æ®æ¥æé«˜æ¨¡å‹çš„ç²¾åº¦ã€‚ æœ€åæ— è®ºæ˜¯åŸºäº LSTM ç®—æ³•è¿˜æ˜¯ DNN ç®—æ³•å®ç°çš„å¼‚å¸¸æ£€æµ‹éœ€è¦æ ¹æ®å„è‡ªæ‰€éœ€çš„ä¸åŒåœºæ™¯æ¥å†³å®šä½¿ç”¨å“ªä¸ªã€‚åœ¨æºç¨‹ï¼Œå¯¹äºæœ€é‡è¦çš„è®¢å•ã€æ”¯ä»˜ç±»æŒ‡æ ‡ï¼Œæˆ‘ä»¬éƒ½æ˜¯é‡‡å– LSTM ç®—æ³•ï¼Œå•ä¸ªæŒ‡æ ‡è®­ç»ƒå•ä¸ªæ¨¡å‹ï¼Œå¯¹äºå…¶ä»–ä¸€äº›éé‡è¦çš„æŒ‡æ ‡å¯ä»¥ä½¿ç”¨ DNN ç®—æ³•ã€‚ 2.2 æ¨¡å‹è®­ç»ƒé€‰å®šå¥½æ·±åº¦å­¦ä¹ ç®—æ³•ä¹‹åï¼Œæˆ‘ä»¬ä¹Ÿå°±å¼€å§‹å°è¯•æ¨¡å‹çš„è®­ç»ƒã€‚æˆ‘ä»¬é¦–å…ˆå–å¾—ç›‘æ§æŒ‡æ ‡çš„å†å²æ•°æ®å¯¹å…¶è¿›è¡Œæ¸…æ´—ï¼Œå…¶ä¸­éœ€è¦å¯¹ä¸€äº›ç©ºå€¼è¿›è¡Œæ’è¡¥ï¼ŒèŠ‚å‡æ—¥æ•°æ®å¯¹äºæ•°æ®æ¨¡å‹çš„å½±å“å¾ˆå¤§ï¼Œå¯¼è‡´è®­ç»ƒå‡ºæ¥çš„æ•°æ®æœ‰åå·®ï¼Œæˆ‘ä»¬ä¹Ÿé€‰æ‹©æ€§çš„å‰”é™¤èŠ‚å‡æ—¥æœŸé—´çš„æ•°æ®ï¼›å¦‚æœå†å²æ•°æ®ä¸­çš„æŸä¸ªåŒºé—´æ•°æ®æ˜¯å¼‚å¸¸åŒºé—´ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦ä½¿ç”¨é¢„æµ‹å€¼æ›¿æ¢å¼‚å¸¸åŒºé—´çš„æ•°å€¼ã€‚ åšå®Œæ•°æ®æ¸…æ´—ä¹‹åï¼Œä¹Ÿå°±éœ€è¦å®ç°ç‰¹å¾å·¥ç¨‹ã€‚æˆ‘ä»¬ä½¿ç”¨äº†å¤šå°ºåº¦æ»‘åŠ¨çª—å£æ—¶åºç‰¹å¾çš„æ–¹æ³•ï¼Œå°†ä¸€ä¸ªæ»‘åŠ¨çª—å£å†…çš„æ•°æ®å’Œå‰ n ä¸ªå‘¨æœŸåšç»Ÿè®¡é‡ä¸Šçš„å¯¹æ¯”ï¼Œå‡å€¼ã€æ–¹å·®ã€å˜åŒ–ç‡ç­‰è¿™äº›ï¼Œè¿™æ ·åŸºæœ¬ä¸Šå°±å¯ä»¥æŠŠæ˜æ˜¾çš„å‘¨æœŸæ€§å’Œå¹³ç¨³å‹æ•°æ®ç»™åˆ†ç¦»å‡ºæ¥ã€‚å‰©ä¸‹çš„æ—¶åºä¸­ï¼Œæœ‰äº›æ˜¯æ³¢åŠ¨å¾ˆå¤§çš„éšæœºåºåˆ—ï¼Œæœ‰çš„åˆ™æ˜¯å¸¦æœ‰è¶‹åŠ¿çš„å‘¨æœŸæ€§åºåˆ—ï¼Œé€šè¿‡æ—¶åºåˆ†ææ³•æŠŠå‘¨æœŸæ€§å»æ‰ï¼Œå†ç”¨é¢‘åŸŸåˆ†æå°è¯•åˆ†è§£æˆé¢‘è°±ã€‚å¯¹äºå¸¦æœ‰æ˜æ˜¾é¢‘è°±çš„ï¼Œåˆ™å½’ç±»ä¸ºå‘¨æœŸå‹æ—¶åºï¼Œè€Œé¢‘è°±æ‚ä¹±çš„ï¼Œåˆ™å½’ç±»ä¸ºéå‘¨æœŸæ€§ã€‚ åœ¨åšå®Œç‰¹å¾æå–ä¸æŒ‡æ ‡åˆ†ç±»ä¹‹åï¼Œæˆ‘ä»¬ä¹Ÿå°±æ ¹æ®æŒ‡æ ‡çš„ç±»å‹ä½¿ç”¨ä¸åŒçš„ç®—æ³•è¿›è¡Œæ¨¡å‹è®­ç»ƒã€‚æˆ‘ä»¬æ ¹æ®çº¿ä¸Šçš„äººå·¥æ ‡æ³¨æ•°æ®æŒç»­æ€§çš„ä¼˜åŒ–æˆ‘ä»¬çš„æ¨¡å‹ã€‚æˆ‘ä»¬ç»å†è¿‡åˆæœŸä¸åœçš„è°ƒå‚å’ŒéªŒè¯ä¹‹åï¼Œæˆ‘ä»¬å°†æ¨¡å‹è®­ç»ƒçš„é¢‘ç‡è®¾ä¸ºäº†ä¸¤å‘¨ï¼Œæˆ‘ä»¬æ¯ä¸¤å‘¨é‡æ–°èµ°ä¸‹å›¾ä¸­çš„æ•´ä¸ªæµç¨‹ï¼Œè¿™ä¸ªä¹Ÿæ˜¯æ ¹æ®æˆ‘ä»¬ä¸šåŠ¡å˜æ›´çš„é¢‘ç‡æ‰€åšçš„è€ƒè™‘ã€‚ 3ï¼ å®æ—¶åŒ–3.1 Why Flinkï¼Ÿåœ¨è§£å†³äº†æ™ºèƒ½åŒ–å¼‚å¸¸æ£€æµ‹çš„é—®é¢˜åï¼Œæˆ‘ä»¬å¼€å§‹è€ƒè™‘æé«˜æˆ‘ä»¬çš„æ—¶æ•ˆæ€§ã€‚ä»¥å¾€çš„è§„åˆ™å‘Šè­¦ï¼Œä»æ•°æ®äº§ç”Ÿåˆ°è½åœ°åˆ°ç›‘æ§ç³»ç»Ÿï¼Œå†åˆ°è§¦å‘è§„åˆ™åˆ¤æ–­ï¼ŒæœŸé—´å·²ç»ç»å†äº†ä¸€å®šå»¶è¿Ÿã€‚å¹¶ä¸”å¾ˆå¤šè§„åˆ™å‘Šè­¦å¾€å¾€éœ€è¦è¿ç»­ 3 ä¸ªç‚¹æˆ–åˆ™ 5 ä¸ªç‚¹è§¦å‘ä¸‹è·Œæˆ–ä¸Šå‡è§„åˆ™åˆ¤æ–­æ‰ä¼šå‘Šè­¦ï¼Œè¿™æ ·å¦‚æœä¸€ä¸ªæŒ‡æ ‡çš„é‡‡é›†ç²’åº¦æ˜¯ä¸€åˆ†é’Ÿï¼Œé‚£ä¹ˆå¼‚å¸¸å¾€å¾€éœ€è¦è¿‡å¥½å‡ åˆ†é’Ÿæ‰ä¼šè¢«å‘ç°ã€‚ä¸ºäº†è§£å†³æ—¶æ•ˆæ€§çš„é—®é¢˜ï¼Œæˆ‘ä»¬å°è¯•å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ã€‚ç°åœ¨å¸¸è§çš„å®æ—¶è®¡ç®—å¼•æ“æœ‰ Stormã€Spark Streaming ä»¥åŠ Flinkï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆæˆ‘ä»¬æœ€ç»ˆé€‰æ‹©äº† Flinkï¼Ÿ é¦–å…ˆç¬¬ä¸€ç‚¹å°±æ˜¯ Flink æä¾›äº†å¼ºå¤§çš„å®¹é”™ä¿éšœï¼Œæ‰€æœ‰çš„å®æ—¶ä½œä¸šæ— è®ºæä¾›äº†å¤šä¹ˆç¹å¤šçš„åŠŸèƒ½ï¼Œå¦‚æœåœ¨ä½œä¸šçš„å®¹é”™ä¿éšœä¸Šåšçš„ä¸å¥½ï¼Œå¯¹äºç”¨æˆ·éƒ½æ˜¯ä¸å¯æ¥å—çš„ã€‚æˆ‘ä»¬çš„æ•°æ®æºæ˜¯ Kafkaï¼ŒåŸºäº Flink çš„ Checkpoint ä¸ Kafka çš„ Offset å›æº¯åŠŸèƒ½èƒ½å¤Ÿå®ç°æ•°æ®æºåˆ°æ‰§è¡Œå¼•æ“å±‚é¢çš„ Exactly Once çš„è¯­ä¹‰ä¿è¯ï¼ŒåŸºäºå¹‚ç­‰æˆ–äº‹ç‰©ä¿è¯æœ€ç»ˆè¾“å‡ºçš„ Exactly Once è¯­ä¹‰ã€‚ ç¬¬äºŒç‚¹ï¼ŒFlink æä¾›äº†é«˜æ•ˆçš„çŠ¶æ€ç®¡ç†ï¼Œæˆ‘ä»¬åœ¨åšå¼‚å¸¸æ£€æµ‹çš„æ—¶å€™éœ€è¦ä¿å­˜å¼‚å¸¸åŒºé—´çš„é¢„æµ‹æ•°æ®ç”¨äºä¸‹ä¸€è½®çš„å¼‚å¸¸æ£€æµ‹ï¼Œè¿™ä¸ªåç»­ä¼šè®²åˆ°ã€‚ ç¬¬ä¸‰ç‚¹ä¸ç¬¬å››ç‚¹æ”¾åœ¨ä¸€èµ·è®²å°±æ˜¯ï¼ŒFlink æä¾›äº†åŸºäº Event Time çš„ä¸°å¯Œçª—å£å‡½æ•°ï¼ŒSpark Streaming è™½ç„¶ä¹Ÿæä¾›äº†å¯¹çª—å£çš„æ”¯æŒï¼Œä½†æ˜¯å…¶æœ¬è´¨ä¸Šè¿˜éƒ½æ˜¯åŸºäº Processing Time çš„æ•°æ®å¤„ç†ã€‚ç»ˆä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬æœ€ç»ˆé€‰æ‹©äº† Flink ä½œä¸ºæˆ‘ä»¬çš„å®æ—¶è®¡ç®—å¼•æ“ã€‚ 3.2 å®æ—¶æ£€æµ‹åœ¨é€‰æ‹©å¥½å®æ—¶è®¡ç®—å¼•æ“åï¼Œæˆ‘ä»¬ä¹Ÿå°±å¼€å§‹å°è¯•åœ¨ Flink ä¸­åŠ è½½ Tensorflow çš„æ¨¡å‹ç”¨æ¥å®æ—¶åšå¼‚å¸¸æ£€æµ‹ã€‚é¦–å…ˆæˆ‘ä»¬å°†æ‰€æœ‰è®­ç»ƒå¥½çš„ Tensorflow æ¨¡å‹ä»¥.pb çš„æ ¼å¼ä¸Šä¼ åˆ° HDFS å¹¶å°†æ–°å¢æˆ–æ›´æ–°çš„æ¨¡å‹é…ç½®æ›´æ–°åˆ°é…ç½®ä¸­å¿ƒ QConfig ä¸Šã€‚Flink ä½œä¸šåœ¨å¯åŠ¨æˆ–è¿è¡Œä¸­æ—¶ï¼Œç›‘å¬é…ç½®ä¸­å¿ƒä¸­éœ€è¦ç›‘æ§çš„æŒ‡æ ‡å¹¶å°è¯•ä» HDFS ä¸ŠåŠ è½½æ¨¡å‹ã€‚ç”±äºåæœŸæ¨¡å‹è¾ƒå¤šï¼Œä¸ºäº†é¿å…é‡å¤åŠ è½½å’Œè´Ÿè½½å‡è¡¡ï¼Œæ‰€æœ‰æŒ‡æ ‡ä¼šå…ˆæ ¹æ® id keyBy åˆ†å‘åˆ°ä¸åŒçš„ TaskManager ä¸Šï¼Œæ¯ä¸ª TaskManager åªåŠ è½½å±äºè‡ªå·±é‚£éƒ¨åˆ†çš„æ¨¡å‹ã€‚ æ¨¡å‹åŠ è½½å®Œæ¯•åï¼Œæˆ‘ä»¬åŸºäº Flink æ»‘åŠ¨çª—å£ä¸ Event Time å®ç°æ•°æ®å®æ—¶æ¶ˆè´¹ä¸é¢„æµ‹ã€‚çª—å£æ»‘åŠ¨çš„æ—¶é—´ä¸ºæŒ‡æ ‡çš„æ—¶é—´ç²’åº¦ï¼ˆä¸‹å›¾ä¸­ä¸º 1 åˆ†é’Ÿï¼‰ï¼Œçª—å£é•¿åº¦ä¸ºåä¸ªæŒ‡æ ‡æ—¶é—´ç²’åº¦ï¼ˆä¸‹å›¾ä¸­ä¸º 10 åˆ†é’Ÿï¼‰ã€‚ä¸€ä¸ªçª—å£ä¸­æ€»è®¡ 10 æ¡æ•°æ®ï¼Œæˆ‘ä»¬é‡‡ç”¨å‰é¢ 5 æ¡æ•°æ®é¢„æµ‹ç¬¬ 6 ä¸ªä½ç½®çš„æ•°æ®ï¼Œç„¶ååŸºäº 2 åˆ° 4 çš„å®é™…æ•°å€¼åŠ ä¸Šç¬¬ 6 æ¡çš„é¢„æµ‹æ•°æ®é¢„æµ‹ç¬¬ 7 ä¸ªæ•°æ®ã€‚ä¾æ­¤ç±»æ¨ï¼Œæœ€ç»ˆæˆ‘ä»¬è·å–åˆ°äº†çª—å£ä¸­å 5 ä½çš„é¢„æµ‹å€¼ä¸å®é™…å€¼ï¼ŒåŸºäº 5 ä¸ªé¢„æµ‹å€¼ä¸å®é™…å€¼å¯¹æ¯”æ£€æµ‹æ˜¯å¦å­˜åœ¨å¼‚å¸¸ã€‚ ç„¶è€Œå®é™…çš„æ¶ˆè´¹è¿‡ç¨‹ä¸­å¹¶ä¸ä¼šåƒä¸Šé¢è¯´çš„é‚£ä¹ˆç®€å•ï¼Œé¦–å…ˆä¸€ä¸ªçª—å£å†…å¯èƒ½å­˜åœ¨ç¼ºå¤±æ•°æ®çš„æƒ…å†µï¼Œæˆ‘ä»¬é‡‡ç”¨çª—å£å†…å…¶ä½™æ•°æ®çš„å‡å€¼ä¸æ ‡å‡†å·®è¡¥é½ã€‚å…¶æ¬¡ï¼Œåœ¨ä¸Šä¸ªæ—¶é—´æ®µå¦‚æœå­˜åœ¨å¼‚å¸¸ï¼Œæˆ‘ä»¬æ— æ³•ç›´æ¥ä½¿ç”¨åŸå§‹çš„å€¼å»é¢„æµ‹æ•°å€¼ï¼Œå› ä¸ºè¿™ä¸ªåŸå§‹å€¼å¯èƒ½æ˜¯ä¸€ä¸ªå¼‚å¸¸å€¼ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸Šä¸ªæ—¶é—´æ®µçš„é¢„æµ‹å€¼æ¥æ›¿æ¢è¿™ä¸ªå¼‚å¸¸å€¼ï¼Œè¿™æ ·èƒ½å¤Ÿä¿è¯æˆ‘ä»¬çš„é¢„æµ‹çº¿ä¸è¢«å¸¦è·‘åã€‚ä¸Šä¸€ä¸ªçª—å£çš„é¢„æµ‹å€¼æˆ‘ä»¬é‡‡ç”¨ flink ä¸­çš„ state æ¥å­˜å‚¨ã€‚ åœ¨å–å¾—å½“å‰çª—å£å 5 ä¸ªé¢„æµ‹å€¼ä¸å®é™…å€¼ä¹‹åï¼Œæˆ‘ä»¬å°±å¼€å§‹è¿›å¼‚å¸¸æ£€æµ‹äº†ã€‚æˆ‘ä»¬ä¼šæ ¹æ®å¼‚å¸¸çš„ç±»å‹ï¼ˆæ¯”å¦‚ä¸Šå‡æˆ–ä¸‹é™ï¼‰ä¸æ•æ„Ÿåº¦æ¥åšä¸åŒçš„åˆ¤æ–­ï¼Œä¸‹å›¾ä¸­çš„ä¸‰ä¸ªå¼‚å¸¸æ›²çº¿åˆ†åˆ«å¯¹åº”äº†é«˜ä¸­ä½ä¸‰ä¸ªæ•æ„Ÿçš„åœºæ™¯ï¼Œåœ¨ä½¿ç”¨é«˜æ•åº¦æ—¶ï¼Œå¯èƒ½åªè¦æœ‰ä¸€ä¸ªä¸‹è·Œçš„æŠ–åŠ¨ï¼Œæˆ‘ä»¬å¯èƒ½å°±è®¤ä¸ºå…¶æ˜¯ä¸€ä¸ªæ½œåœ¨çš„å¼‚å¸¸ï¼Œä¸­æ•æ„Ÿåº¦éœ€è¦è¿ç»­ä¸¤ä¸ªä¸‹è·Œçš„æƒ…å†µï¼Œä½æ•æ„Ÿåº¦åˆ™éœ€åœ¨ä¸‹é™å¹…åº¦éå¸¸å¤§çš„æƒ…å†µä¸‹æ‰ä¼šè®¤å®šä¸ºæ½œåœ¨å¼‚å¸¸ã€‚ æˆ‘ä»¬ä¼šåŸºäºé¢„æµ‹å€¼ä¸å®é™…æ•°æ®çš„åå·®æ¥å…ˆåšä¸€ä¸ªæ½œåœ¨åˆ¤æ–­ï¼Œå½“è®¤å®šå®ƒæ˜¯ä¸€ä¸ªæ½œåœ¨å¼‚å¸¸æ—¶ï¼Œæˆ‘ä»¬ä¼šåœ¨åŸºäºé¢„æµ‹å€¼ä¸å†å²åŒæœŸæ•°æ®çš„å‡å€¼ä¸æ ‡å‡†å·®åšåˆ¤æ–­ï¼Œè¿™æ ·æœ€ç»ˆå¾—å‡ºå½“å‰çš„çª—å£æ˜¯å¦å­˜åœ¨å¼‚å¸¸ã€‚æˆ‘ä»¬è¿™è¾¹åœ¨å¼‚å¸¸åˆ¤æ–­çš„æ—¶å€™è¿˜æ˜¯é‡‡ç”¨äº†ç»Ÿè®¡å­¦ä½œä¸ºåˆ¤æ–­æ–¹å¼ï¼Œå¦‚æœåœ¨æ ·æœ¬è¶³å¤Ÿçš„æƒ…å†µä¸‹ï¼Œå®Œå…¨å¯ä»¥ä½¿ç”¨æœºå™¨å­¦ä¹ ï¼Œè®­ç»ƒä¸€ä¸ªå¼‚å¸¸æ£€æµ‹æ¨¡å‹æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨å¼‚å¸¸ã€‚ 4. Prophet4.1 Prophet ç³»ç»Ÿæ¶æ„åœ¨è®²è¿°å®Œå¦‚ä½•å®ç°æ™ºèƒ½åŒ–ä¸å®æ—¶åŒ–å¼‚å¸¸æ£€æµ‹ä¹‹åï¼Œç›¸ä¿¡å¤§å®¶å¯¹äº Prophet å·²ç»æœ‰äº†ä¸€å®šçš„è®¤çŸ¥ã€‚ä¸‹å›¾å±•ç¤ºäº†æ•´ä¸ª Prophet å¹³å°çš„ç³»ç»Ÿæ¶æ„ï¼Œé¦–å…ˆæ˜¯æœ€åº•å±‚çš„ Hadoop é›†ç¾¤æ‰¿æ‹…äº†åˆ†å¸ƒå¼å­˜å‚¨ä¸èµ„æºè°ƒåº¦çš„åŠŸèƒ½ï¼ŒHDFS ç”¨æ¥å­˜å‚¨ Tensorflow è®­ç»ƒå¥½çš„æ¨¡å‹ï¼Œæ‰€æœ‰ Flink ä½œä¸šè¿è¡Œåœ¨ Yarn é›†ç¾¤ä¸Šã€‚ä¸­é—´å±‚çš„æ¶ˆæ¯é˜Ÿåˆ—æ‰¿æ‹…äº†å®æ—¶æ•°æ®æºçš„ä½œç”¨ï¼Œæ‰€æœ‰æŒ‡æ ‡çš„å†å²æ•°æ®å­˜å‚¨åœ¨æ—¶åºæ•°æ®åº“ä¸­ï¼Œå®æ—¶åŒ–ä¸æ™ºèƒ½åŒ–æ£€æµ‹ä¾æ‰˜äº Flink ä¸ Tensorflow ä¸¤å¥—å¼•æ“å®ç°ã€‚æœ€ä¸Šå±‚çš„ Prophet ä»¥å¹³å°çš„æ–¹å¼å¯¹å¤–æä¾›æœåŠ¡ï¼ŒClog ç”¨äºæ—¥å¿—å­˜å‚¨ä¸æ’éšœï¼ŒMuise æ˜¯æˆ‘ä»¬çš„å®æ—¶è®¡ç®—å¹³å°ï¼ŒQconfig ç”¨äºå­˜å‚¨äºç›‘æ§æŒ‡æ ‡ç›¸å…³çš„é…ç½®ä¿¡æ¯ï¼Œæœ€å Hickwall ç”¨äºç›‘æ§ä½œä¸šçš„å„é¡¹æŒ‡æ ‡ã€‚ 4.2 Prophet æ“ä½œæµç¨‹ä¸€ä¸ªç”¨æˆ·æƒ³è¦é…ç½®æ™ºèƒ½å‘Šè­¦åªéœ€è¦åšä¸¤ä»¶äº‹ï¼Œé¦–å…ˆåœ¨æˆ‘ä»¬çš„å¹³å°ä¸Šé…ç½®æ™ºèƒ½å‘Šè­¦ï¼Œç”±äºæˆ‘ä»¬å¤§éƒ¨åˆ†å¯¹æ¥çš„æ˜¯ç›‘æ§å¹³å°ï¼Œæ‰€ä»¥ç”¨æˆ·å¤§å¤šæ˜¯åœ¨å„ä¸ªç›‘æ§å¹³å°ä¸Šé…ç½®æ™ºèƒ½å‘Šè­¦ï¼Œç„¶åç›‘æ§å¹³å°è°ƒç”¨æˆ‘ä»¬çš„æœåŠ¡æ³¨å†Œç›‘æ§æŒ‡æ ‡ã€‚ç„¶åç”¨æˆ·éœ€è¦æŒ‰ç…§æˆ‘ä»¬å®šä¹‰å¥½çš„æ ¼å¼å°†åŸå§‹æ•°æ®å‘é€åˆ°æˆ‘ä»¬çš„ Kafka æ¶ˆæ¯é˜Ÿåˆ—ï¼Œè¿™ä¸€æ­¥åœ¨å¯¹æ¥å¹³å°æ—¶ï¼Œä¹Ÿç”±å¹³å°åšäº†ï¼Œæ‰€ä»¥ç›´æ¥åœ¨æˆ‘ä»¬å¹³å°ä¸Šé…ç½®ç›‘æ§æŒ‡æ ‡çš„ç”¨æˆ·å¾ˆå°‘ã€‚å½“ä¸€ä¸ªç”¨æˆ·æ³¨å†Œå¥½ç›‘æ§æŒ‡æ ‡åï¼Œæˆ‘ä»¬å¹³å°ä¼šå…ˆæ£€æµ‹è¯¥æŒ‡æ ‡çš„å†å²æ•°æ®æ˜¯å¦è¶³å¤Ÿï¼Œå¦‚æœè¶³å¤Ÿåˆ™è§¦å‘æ¨¡å‹è®­ç»ƒçš„æµç¨‹ï¼Œè®­ç»ƒå¥½çš„æ¨¡å‹ä¼šä¸Šä¼ åˆ° HDFSã€‚å¦‚æœå†å²æ•°æ®ä¸è¶³ï¼ŒProphet ä¼šæŒç»­å®æ—¶å­˜å‚¨ç”¨æˆ·æŒ‡æ ‡çš„æ•°æ®ï¼Œå½“æ»¡è¶³æ•°æ®é‡çš„éœ€æ±‚æ—¶ï¼Œé‡æ–°è§¦å‘æ¨¡å‹è®­ç»ƒã€‚å½“æ¨¡å‹è®­ç»ƒå®Œæˆåï¼Œæˆ‘ä»¬ä¼šæ›´æ–°é…ç½®ä¸­å¿ƒï¼Œå‘ŠçŸ¥ Flink ä½œä¸šæœ‰æ–°çš„æˆ–æ›´æ–°çš„æŒ‡æ ‡æ¨¡å‹å·²ç»å°±ä½ã€‚ å®æ—¶è¿™å—çš„æµç¨‹æ˜¯ Flink å¯åŠ¨æˆ–è¿è¡Œä¸­ä¸€æ—¦ç›‘å¬åˆ°æœ‰æ–°çš„æˆ–æ›´æ–°çš„æ¨¡å‹ï¼Œä½œä¸šä¼šé‡æ–°åŠ è½½æ¨¡å‹ã€‚å¦å¤– Flink ä¼šå®æ—¶ä» Kafka ä¸­æ¶ˆè´¹æ•°æ®ï¼Œå®æ—¶çš„è¿‡æ¨¡å‹åšå¼‚å¸¸æ£€æµ‹ï¼Œæœ€ç»ˆå°†å¼‚å¸¸å‘Šè­¦å›ååˆ° Kafkaï¼Œå„ä¸ªå¹³å°æ¶ˆè´¹è‡ªå·±çš„å¼‚å¸¸å‘Šè­¦æ•°æ®å¹¶ç»™ç›¸å…³çš„è´Ÿè´£äººå‘é€å‘Šè­¦é€šçŸ¥ã€‚ 4.3 å¹³å°ç°çŠ¶ç›®å‰ Prophet å·²ç»è¦†ç›–äº†æºç¨‹æ‰€æœ‰çš„ä¸šåŠ¡çº¿ï¼Œæ¥å…¥äº†åä½™ä¸ªç›‘æ§å¹³å°ï¼Œå…¶ä¸­åŒ…å«å…¬å¸çº§çš„ç›‘æ§ç³»ç»Ÿ Sitemon ä¸ Hickwallï¼Œç›‘æ§äº† 7000+ ä¸ªä¸šåŠ¡æŒ‡æ ‡ï¼ŒåŒ…å«è®¢å•ã€æ”¯ä»˜ã€åº”ç”¨ã€æœåŠ¡ç­‰å¤šç§ä¸šåŠ¡ç±»å‹æŒ‡æ ‡ã€‚ åœ¨å¹³å°è¿è¡Œçš„åŠå¹´æ—¶é—´å†…ï¼Œæˆ‘ä»¬çš„ç®—æ³•èƒ½å¤Ÿè¾¾åˆ° 90% çš„å¬å›ç‡ï¼ˆä¹Ÿå°±æ˜¯å¼‚å¸¸è¦†ç›–ç‡ï¼‰ï¼›ç”±äºæˆ‘ä»¬ä¸šåŠ¡æ–¹éœ€æ±‚æ˜¯å°½é‡è¦†ç›–æ›´å¤šçš„å¼‚å¸¸ï¼Œä¸è¦æ¼æŠ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„å‡†ç¡®ç‡ä¿æŒåœ¨ 75% å·¦å³ï¼›åœ¨å¼•å…¥äº† Flink å®æ—¶æ¶ˆè´¹æ•°æ®ä¸æ£€æµ‹ï¼Œæå¤§çš„é™ä½äº†æˆ‘ä»¬å‘Šè­¦çš„å»¶è¿Ÿï¼Œè¾¾åˆ°äº†æ¯«ç§’çº§çš„å»¶è¿Ÿï¼›å¯¹æ¯”è§„åˆ™å‘Šè­¦ï¼Œæˆ‘ä»¬å¸®åŠ©ç”¨æˆ·é™ä½äº† 10 å€çš„å‘Šè­¦æ•°é‡ï¼Œæå‡äº† 10 å€çš„ç”¨æˆ·æ•ˆç‡ã€‚ ä¸‹å›¾å±•ç¤ºäº†ä» 18 å¹´ 10 æœˆ Prophet ä¸Šçº¿ä»¥æ¥è‡³ 19 å¹´ 4 æœˆåº•ï¼Œæ™ºèƒ½å‘Šè­¦ä¸è§„åˆ™å‘Šè­¦å¯¹å¼‚å¸¸çš„è¦†ç›–ç‡å¯¹æ¯”ã€‚æ€»è®¡å‘ç”Ÿ 176 èµ·å¼‚å¸¸ï¼Œå…¶ä¸­ Prophet å›¾è¡¨ä¸­æ˜¾ç¤ºçš„æ˜¯è¦†ç›–äº† 90% çš„å¼‚å¸¸ï¼Œä½†å…¶å®çœŸæ­£çš„è¦†ç›–ç‡è¦é«˜äº 90%ï¼Œå…¶ä¸­ 18 ä¸ªæœªè¦†ç›–å¼‚å¸¸æœ‰ 15 ä¸ªæ˜¯ç”±äºåˆæœŸç®—æ³•ä¸€ç›´å¤„äºè°ƒæ•´é˜¶æ®µå¯¼è‡´äº†æ¼æŠ¥ã€‚åœ¨ 19 å¹´ä¹‹åï¼Œæˆ‘ä»¬çš„å¼‚å¸¸è¦†ç›–ç‡èƒ½å¤Ÿè¾¾åˆ°æ¥è¿‘ 100%ã€‚ç›¸æ¯”è¾ƒè§„åˆ™å‘Šè­¦ï¼Œæˆ‘ä»¬çš„è¦†ç›–ç‡ä¸Šå‡äº† 22%ï¼ŒåŠæ—¶çš„å¸®åŠ©ç”¨æˆ·é™ä½æŸå¤±ã€‚ ä¸‹å›¾å±•ç¤ºäº†æ™ºèƒ½å‘Šè­¦ä¸è§„åˆ™å‘Šè­¦åœ¨å‘Šè­¦æ•°é‡ä¸Šçš„å¯¹æ¯”ï¼Œè§„åˆ™å‘Šè­¦çš„æ•°é‡åŸºæœ¬æ˜¯æ™ºèƒ½å‘Šè­¦çš„ 2 åˆ° 5 å€ï¼Œä½†æ˜¯è¿™å¹¶éæ˜¯ç«™åœ¨åŒä¸€å±‚é¢ä¸Šçš„å¯¹æ¯”ï¼Œå…¶ä¸­æ™ºèƒ½å‘Šè­¦çš„æ•°é‡æ˜¯åŸºäº 800 ç›‘æ§æŒ‡æ ‡ï¼Œè€Œè§„åˆ™å‘Šè­¦æ˜¯åŸºäº 200 ä¸ªç›‘æ§ï¼Œå¦‚æœè§„åˆ™å‘Šè­¦çš„æŒ‡æ ‡æ•°é‡ä¸æ™ºèƒ½å‘Šè­¦çš„æŒå¹³ï¼Œé‚£æ™ºèƒ½å‘Šè­¦é™ä½çš„å‘Šè­¦æ•°é‡ä¼šæ›´ä¸ºæ˜¾è‘—ã€‚å‘Šè­¦æ•°é‡å¯¹äºç”¨æˆ·çš„æ•ˆç‡æå‡æ˜¯ååˆ†æ˜æ˜¾çš„ï¼Œä»¥å¾€ç”¨æˆ·æ¯å¤©éœ€è¦èŠ±è´¹å¤§é‡çš„ç²¾åŠ›å»æ’æŸ¥æ¯ä¸€ä¸ªå‘Šè­¦é‚®ä»¶ï¼Œåœ¨ä½¿ç”¨äº†æ™ºèƒ½å‘Šè­¦åï¼Œè¿™éƒ¨åˆ†å¸®åŠ©ç”¨æˆ·å‡å°‘çš„æ—¶é—´æ˜¯å®å®åœ¨åœ¨çš„æ•ˆç‡æå‡ã€‚ 5ï¼ æŒ‘æˆ˜ä¸å±•æœ›Prophet åœ¨æºç¨‹æŠ•å…¥ç”Ÿäº§ä½¿ç”¨å·²æœ‰åŠå¹´ä¹‹ä¹…ï¼Œåœ¨è¿™æœŸé—´æˆ‘ä»¬ä¹Ÿé‡åˆ°è¿‡å½¢å½¢è‰²è‰²çš„æŒ‘æˆ˜ã€‚ é¦–å…ˆï¼ŒåŸºäº LSTM ç®—æ³•çš„å¼‚å¸¸æ£€æµ‹æ–¹å¼å­˜åœ¨ä¸€ä¸ªæ˜æ˜¾çš„å¼Šç«¯ï¼Œæˆ‘ä»¬éœ€è¦å¯¹æ¯ä¸€ä¸ªæŒ‡æ ‡è®­ç»ƒä¸€ä¸ªæ¨¡å‹ï¼Œè¿™æ ·æ— è®ºæ˜¯æ¨¡å‹è®­ç»ƒæ‰€éœ€çš„èµ„æºä»¥åŠå®æ—¶ä½œä¸šåŠ è½½æ¨¡å‹æ‰€éœ€çš„èµ„æºéƒ½æ¶ˆè€—æ¯”è¾ƒå¤§ã€‚ å…¶æ¬¡ï¼ŒLSTM ç®—æ³•å¯¹äºæ³¢åŠ¨å‰§çƒˆçš„éå‘¨æœŸå‹æŒ‡æ ‡è¡¨ç°ä¸æ˜¯ååˆ†è‰¯å¥½ï¼Œæœ‰ä¸€äº›ä¸šåŠ¡ä¼šä¸å®šæœŸçš„åšä¸€äº›æ´»åŠ¨å¯¼è‡´ä¸šåŠ¡æŒ‡æ ‡çš„çªå¢æˆ–çªå‡ï¼Œè¿™ç§è¶‹åŠ¿æ˜¯æ— æ³•ä»å†å²æ•°æ®ä¸­å­¦ä¹ åˆ°ã€‚ ç„¶åï¼Œå¯¹äºä¸€äº›ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡ç±»å‹çš„æ•°æ®ä¹Ÿæ— éœ€ä½¿ç”¨æ™ºèƒ½å‘Šè­¦ï¼Œè§„åˆ™å‘Šè­¦å¯èƒ½æ›´åŠ æ–¹ä¾¿ï¼Œæ¯”å¦‚å½“æœåŠ¡å™¨çš„ cpu ä½¿ç”¨ç‡è¾¾åˆ° 95% çš„æ—¶å€™å°±å‘Šè­¦ã€‚ æœ€åï¼ŒèŠ‚å‡æ—¥å¯¹äºæ™ºèƒ½å‘Šè­¦çš„å½±å“ååˆ†ä¹‹å¤§ï¼Œä¸šåŠ¡æŒ‡æ ‡é€šå¸¸ä¼šåœ¨èŠ‚å‡æ—¥å‰å‘ˆå€æ•°çš„å¢é•¿ï¼Œå‡æ—¥æœŸé—´åˆæ›¾å€æ•°çš„ä¸‹é™ï¼Œè¿™æ ·å¯¼è‡´äº†å¤§é‡æ¼æŠ¥æˆ–è¯¯æŠ¥ã€‚ é’ˆå¯¹ä»¥ä¸Šçš„é—®é¢˜ï¼Œæˆ‘ä»¬ä¹Ÿåœ¨æŒç»­çš„æ”¹è¿›ä¹‹ä¸­ã€‚é¦–å…ˆï¼ŒåŸºäº DNN ç®—æ³•çš„é€šç”¨æ¨¡å‹å·²ç»åœ¨çº¿ä¸‹é™ªè·‘äº†æ•°æœˆä¹‹ä¹…ï¼Œè™½ç„¶åœ¨ç²¾åº¦ä¸Šæ¯” LSTM ç®—æ³•çš„å¼‚å¸¸æ£€æµ‹æ–¹å¼ç¨æœ‰é€Šè‰²ï¼Œä½†åœ¨æˆ‘ä»¬æŒç»­ä¼˜åŒ–ä¹‹åå·²ç»åŸºæœ¬èƒ½å¤Ÿ hold ä½çº¿ä¸Šéé‡è¦æŒ‡æ ‡çš„å‘Šè­¦éœ€æ±‚ï¼Œå®ç°å•ä¸ªæ¨¡å‹ç›‘æ§æ•°åƒä¸ªæŒ‡æ ‡çš„åŠŸèƒ½ï¼Œå¤§å¤§é™ä½äº†èµ„æºæŸè€—ã€‚æˆ‘ä»¬åœ¨åº”å¯¹èŠ‚å‡æ—¥å¯¹æ™ºèƒ½æ£€æµ‹å½±å“æ—¶å¼•å…¥äº†å¢é•¿ç³»æ•°çš„æ¦‚å¿µï¼Œç”¨æ¥æ‹‰å‡æˆ–é™ä½é¢„æµ‹å€¼ï¼Œå¹¶ä¸”é‡‡ç”¨ä¸€å®šæ–¹å¼å°†å¢é•¿ç³»æ•°æŒç»­è¡°å‡ï¼Œé˜²æ­¢å¢é•¿ç³»æ•°å¯¼è‡´é¢„æµ‹å€¼çš„è·‘åã€‚å…³äºç®—æ³•çš„ç»†èŠ‚ä»¥åŠå„ç§åœºæ™¯ä¸‹çš„åº”å¯¹æ–¹å¼ç”±äºç¯‡å¹…å…³ç³»æ— æ³•åœ¨æœ¬ç¯‡æ–‡ç« ä¸­ä¸€ä¸€å±•å¼€ï¼Œå¦‚æœå¯¹ç®—æ³•ç›¸å…³ç»†èŠ‚æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥åœ¨è¯„è®ºåŒºç•™è¨€ï¼Œæˆ‘ä»¬è¿™è¾¹ä¹Ÿä¼šè€ƒè™‘è®©ç®—æ³•åŒäº‹å¦èµ·ç‚‰ç¶ï¼Œè¯¦ç»†çš„ä»‹ç»ç®—æ³•ã€ç‰¹å¾å·¥ç¨‹ç­‰ç›¸å…³è¯é¢˜ã€‚ Prophet åç»­ä¹Ÿä¼šé™†ç»­çš„æ¥å…¥æºç¨‹æ‰€æœ‰çš„ç›‘æ§ç³»ç»Ÿï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬ä¸€ç›´åŠªåŠ›åœ¨åšçš„äº‹ã€‚å®æ—¶è®¡ç®—ä¸äººå·¥æ™ºèƒ½ä¸å…‰åœ¨å¼‚å¸¸æ£€æµ‹è¿™ä¸ªåœºæ™¯ä¸‹æœ‰å¾ˆå¥½çš„å‘æŒ¥ï¼Œåœ¨å¾ˆå¤šå…¶ä»–çš„åœºæ™¯ä¸‹ä¹Ÿèƒ½å¤Ÿæœ‰äº®çœ¼çš„è¡¨ç°ï¼Œæ¯”å¦‚é£æ§ã€ä¸ªæ€§åŒ–æ¨èã€æ’åºç­‰ï¼Œæœ¬ç¯‡æ–‡ç« ä¹Ÿç®—æ˜¯æŠ›ç –å¼•ç‰ï¼Œå¸Œæœ›ç»™å¤§å®¶èƒ½å¤Ÿå¸¦æ¥ä¸€äº›å…¶æ³•ï¼Œè¿™æ ·å¯ä»¥å°†è¿™å¥—æ–¹å¼æ›´å¤šçš„ä½¿ç”¨åœ¨å…¶ä»–çš„åœºæ™¯ä¸‹ã€‚ æœ€åGitHub Flink å­¦ä¹ ä»£ç åœ°å€ï¼šhttps://github.com/zhisheng17/flink-learning å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ ä¸“æ ä»‹ç»é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€åŸç†ã€å®æˆ˜ã€æ€§èƒ½è°ƒä¼˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯”","date":"2019-06-20T16:00:00.000Z","path":"2019/06/21/flink-in-360/","text":"æœ¬æ–‡ä»æ•°æ®ä¼ è¾“å’Œæ•°æ®å¯é æ€§çš„è§’åº¦å‡ºå‘ï¼Œå¯¹æ¯”æµ‹è¯•äº†Stormä¸Flinkåœ¨æµå¤„ç†ä¸Šçš„æ€§èƒ½ï¼Œå¹¶å¯¹æµ‹è¯•ç»“æœè¿›è¡Œåˆ†æï¼Œç»™å‡ºåœ¨ä½¿ç”¨Flinkæ—¶æé«˜æ€§èƒ½çš„å»ºè®®ã€‚ ä½œè€… å¼ é¦¨äºˆï¼Œ360 å¤§æ•°æ®è®¡ç®—å¹³å°è´Ÿè´£äººã€‚åŒ—äº¬é‚®ç”µå¤§å­¦ç¡•å£«ï¼Œ2015å¹´åŠ å…¥360ç³»ç»Ÿéƒ¨ï¼Œä¸€ç›´è‡´åŠ›äºå…¬å¸å¤§æ•°æ®è®¡ç®—å¹³å°çš„æ˜“ç”¨æ€§ã€ç¨³å®šæ€§å’Œæ€§èƒ½ä¼˜åŒ–çš„ç ”å‘å·¥ä½œã€‚ç›®å‰ä¸»è¦è´Ÿè´£Flinkçš„ç ”å‘ï¼Œå®Œæˆå…¬å¸è®¡ç®—å¼•æ“çš„å¤§ä¸€ç»Ÿã€‚ Apache Stormã€Apache Sparkå’ŒApache Flinkéƒ½æ˜¯å¼€æºç¤¾åŒºä¸­éå¸¸æ´»è·ƒçš„åˆ†å¸ƒå¼è®¡ç®—å¹³å°ï¼Œåœ¨å¾ˆå¤šå…¬å¸å¯èƒ½åŒæ—¶ä½¿ç”¨ç€å…¶ä¸­ä¸¤ç§ç”šè‡³ä¸‰ç§ã€‚å¯¹äºå®æ—¶è®¡ç®—æ¥è¯´ï¼ŒStormä¸Flinkçš„åº•å±‚è®¡ç®—å¼•æ“æ˜¯åŸºäºæµçš„ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€æ¡ä¸€æ¡çš„æ•°æ®è¿›è¡Œå¤„ç†ï¼Œä¸”å¤„ç†çš„æ¨¡å¼æ˜¯æµæ°´çº¿æ¨¡å¼ï¼Œå³æ‰€æœ‰çš„å¤„ç†è¿›ç¨‹åŒæ—¶å­˜åœ¨ï¼Œæ•°æ®åœ¨è¿™äº›è¿›ç¨‹ä¹‹é—´æµåŠ¨å¤„ç†ã€‚è€ŒSparkæ˜¯åŸºäºæ‰¹é‡æ•°æ®çš„å¤„ç†ï¼Œå³ä¸€å°æ‰¹ä¸€å°æ‰¹çš„æ•°æ®è¿›è¡Œå¤„ç†ï¼Œä¸”å¤„ç†çš„é€»è¾‘åœ¨ä¸€æ‰¹æ•°æ®å‡†å¤‡å¥½ä¹‹åæ‰ä¼šè¿›è¡Œè®¡ç®—ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æŠŠåŒæ ·åŸºäºæµå¤„ç†çš„Stormå’ŒFlinkæ‹¿æ¥åšå¯¹æ¯”æµ‹è¯•åˆ†æã€‚ åœ¨æˆ‘ä»¬åšæµ‹è¯•ä¹‹å‰ï¼Œè°ƒç ”äº†ä¸€äº›å·²æœ‰çš„å¤§æ•°æ®å¹³å°æ€§èƒ½æµ‹è¯•æŠ¥å‘Šï¼Œæ¯”å¦‚ï¼Œé›…è™çš„Streaming-benchmarksï¼Œæˆ–è€…Intelçš„HiBenchç­‰ç­‰ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰å¾ˆå¤šçš„è®ºæ–‡ä¹Ÿä»ä¸åŒçš„è§’åº¦å¯¹åˆ†å¸ƒå¼è®¡ç®—å¹³å°è¿›è¡Œäº†æµ‹è¯•ã€‚è™½ç„¶è¿™äº›æµ‹è¯•caseå„æœ‰ä¸åŒçš„ä¾§é‡ç‚¹ï¼Œä½†ä»–ä»¬éƒ½ç”¨åˆ°äº†åŒæ ·çš„ä¸¤ä¸ªæŒ‡æ ‡ï¼Œå³ååå’Œå»¶è¿Ÿã€‚ååè¡¨ç¤ºå•ä½æ—¶é—´å†…æ‰€èƒ½å¤„ç†çš„æ•°æ®é‡ï¼Œæ˜¯å¯ä»¥é€šè¿‡å¢å¤§å¹¶å‘æ¥æé«˜çš„ã€‚å»¶è¿Ÿä»£è¡¨å¤„ç†ä¸€æ¡æ•°æ®æ‰€éœ€è¦çš„æ—¶é—´ï¼Œä¸ååé‡æˆåæ¯”å…³ç³»ã€‚ åœ¨æˆ‘ä»¬è®¾è®¡è®¡ç®—é€»è¾‘æ—¶ï¼Œé¦–å…ˆè€ƒè™‘ä¸€ä¸‹æµå¤„ç†çš„è®¡ç®—æ¨¡å‹ã€‚ä¸Šå›¾æ˜¯ä¸€ä¸ªç®€å•çš„æµè®¡ç®—æ¨¡å‹ï¼Œåœ¨Sourceä¸­å°†æ•°æ®å–å‡ºï¼Œå‘å¾€ä¸‹æ¸¸Taskï¼Œå¹¶åœ¨Taskä¸­è¿›è¡Œå¤„ç†ï¼Œæœ€åè¾“å‡ºã€‚å¯¹äºè¿™æ ·çš„ä¸€ä¸ªè®¡ç®—æ¨¡å‹ï¼Œå»¶è¿Ÿæ—¶é—´ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šæ•°æ®ä¼ è¾“æ—¶é—´ã€Taskè®¡ç®—æ—¶é—´å’Œæ•°æ®æ’é˜Ÿæ—¶é—´ã€‚æˆ‘ä»¬å‡è®¾èµ„æºè¶³å¤Ÿï¼Œæ•°æ®ä¸ç”¨æ’é˜Ÿã€‚åˆ™å»¶è¿Ÿæ—¶é—´å°±åªç”±æ•°æ®ä¼ è¾“æ—¶é—´å’ŒTaskè®¡ç®—æ—¶é—´ç»„æˆã€‚è€Œåœ¨Taskä¸­å¤„ç†æ‰€éœ€è¦çš„æ—¶é—´ä¸ç”¨æˆ·çš„é€»è¾‘æ¯æ¯ç›¸å…³ï¼Œæ‰€ä»¥å¯¹äºä¸€ä¸ªè®¡ç®—å¹³å°æ¥è¯´ï¼Œæ•°æ®ä¼ è¾“çš„æ—¶é—´æ‰æ›´èƒ½åæ˜ è¿™ä¸ªè®¡ç®—å¹³å°çš„èƒ½åŠ›ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åœ¨è®¾è®¡æµ‹è¯•Caseæ—¶ï¼Œä¸ºäº†æ›´å¥½çš„ä½“ç°å‡ºæ•°æ®ä¼ è¾“çš„èƒ½åŠ›ï¼ŒTaskä¸­æ²¡æœ‰è®¾è®¡ä»»ä½•è®¡ç®—é€»è¾‘ã€‚ åœ¨ç¡®å®šæ•°æ®æºæ—¶ï¼Œæˆ‘ä»¬ä¸»è¦è€ƒè™‘æ˜¯åœ¨è¿›ç¨‹ä¸­ç›´æ¥ç”Ÿæˆæ•°æ®ï¼Œè¿™ç§æ–¹æ³•åœ¨å¾ˆå¤šä¹‹å‰çš„æµ‹è¯•æ ‡å‡†ä¸­ä¹ŸåŒæ ·æœ‰ä½¿ç”¨ã€‚è¿™æ ·åšæ˜¯å› ä¸ºæ•°æ®çš„äº§ç”Ÿä¸ä¼šå—åˆ°å¤–ç•Œæ•°æ®æºç³»ç»Ÿçš„æ€§èƒ½é™åˆ¶ã€‚ä½†ç”±äºåœ¨æˆ‘ä»¬å…¬å¸å†…éƒ¨å¤§éƒ¨åˆ†çš„å®æ—¶è®¡ç®—æ•°æ®éƒ½æ¥æºäºkafkaï¼Œæ‰€ä»¥æˆ‘ä»¬å¢åŠ äº†ä»kafkaä¸­è¯»å–æ•°æ®çš„æµ‹è¯•ã€‚ å¯¹äºæ•°æ®ä¼ è¾“æ–¹å¼ï¼Œå¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼šè¿›ç¨‹é—´çš„æ•°æ®ä¼ è¾“å’Œè¿›ç¨‹å†…çš„æ•°æ®ä¼ è¾“ã€‚ è¿›ç¨‹é—´çš„æ•°æ®ä¼ è¾“æ˜¯æŒ‡è¿™æ¡æ•°æ®ä¼šç»è¿‡åºåˆ—åŒ–ã€ç½‘ç»œä¼ è¾“å’Œååºåˆ—åŒ–ä¸‰ä¸ªæ­¥éª¤ã€‚åœ¨Flinkä¸­ï¼Œ2ä¸ªå¤„ç†é€»è¾‘åˆ†å¸ƒåœ¨ä¸åŒçš„TaskManagerä¸Šï¼Œè¿™ä¸¤ä¸ªå¤„ç†é€»è¾‘ä¹‹é—´çš„æ•°æ®ä¼ è¾“å°±å¯ä»¥å«åšè¿›ç¨‹é—´çš„æ•°æ®ä¼ è¾“ã€‚Flinkç½‘ç»œä¼ è¾“æ˜¯é‡‡ç”¨çš„NettyæŠ€æœ¯ã€‚åœ¨Stormä¸­ï¼Œè¿›ç¨‹é—´çš„æ•°æ®ä¼ è¾“æ˜¯workerä¹‹é—´çš„æ•°æ®ä¼ è¾“ã€‚æ—©ç‰ˆæœ¬çš„stormç½‘ç»œä¼ è¾“ä½¿ç”¨çš„ZeroMQï¼Œç°åœ¨ä¹Ÿæ”¹æˆäº†Nettyã€‚ è¿›ç¨‹å†…çš„æ•°æ®ä¼ è¾“æ˜¯æŒ‡ä¸¤ä¸ªå¤„ç†é€»è¾‘åœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­ã€‚åœ¨Flinkä¸­ï¼Œè¿™ä¸¤ä¸ªå¤„ç†é€»è¾‘è¢«Chainåœ¨äº†ä¸€èµ·ï¼Œåœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­é€šè¿‡æ–¹æ³•è°ƒç”¨ä¼ å‚çš„å½¢å¼è¿›ç¨‹æ•°æ®ä¼ è¾“ã€‚åœ¨Stormä¸­ï¼Œä¸¤ä¸ªå¤„ç†é€»è¾‘å˜æˆäº†ä¸¤ä¸ªçº¿ç¨‹ï¼Œé€šè¿‡ä¸€ä¸ªå…±äº«çš„é˜Ÿåˆ—è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚ Stormå’ŒFlinkéƒ½æœ‰å„è‡ªçš„å¯é æ€§æœºåˆ¶ã€‚åœ¨Stormä¸­ï¼Œä½¿ç”¨ACKæœºåˆ¶æ¥ä¿è¯æ•°æ®çš„å¯é æ€§ã€‚è€Œåœ¨Flinkä¸­æ˜¯é€šè¿‡checkpointæœºåˆ¶æ¥ä¿è¯çš„ï¼Œè¿™æ˜¯æ¥æºäºchandy-lamportç®—æ³•ã€‚ äº‹å®ä¸Šexactly-onceå¯é æ€§çš„ä¿è¯è·Ÿå¤„ç†çš„é€»è¾‘å’Œç»“æœè¾“å‡ºçš„è®¾è®¡æœ‰å…³ã€‚æ¯”å¦‚ç»“æœè¦è¾“å‡ºåˆ°kafkaä¸­ï¼Œè€Œè¾“å‡ºåˆ°kafkaçš„æ•°æ®æ— æ³•å›æ»šï¼Œè¿™å°±æ— æ³•ä¿è¯exactly-onceã€‚æˆ‘ä»¬åœ¨æµ‹è¯•çš„æ—¶å€™é€‰ç”¨çš„at-least-onceè¯­ä¹‰çš„å¯é æ€§å’Œä¸ä¿è¯å¯é æ€§ä¸¤ç§ç­–ç•¥è¿›è¡Œæµ‹è¯•ã€‚ ä¸Šå›¾æ˜¯æˆ‘ä»¬æµ‹è¯•çš„ç¯å¢ƒå’Œå„ä¸ªå¹³å°çš„ç‰ˆæœ¬ã€‚ ä¸Šå›¾å±•ç¤ºçš„æ˜¯Flinkåœ¨è‡ªäº§æ•°æ®çš„æƒ…å†µä¸‹ï¼Œä¸åŒçš„ä¼ è¾“æ–¹å¼å’Œå¯é æ€§çš„ååé‡ï¼šåœ¨è¿›ç¨‹å†…+ä¸å¯é ã€è¿›ç¨‹å†…+å¯é ã€è¿›ç¨‹é—´+ä¸å¯é ã€è¿›ç¨‹é—´+å¯é ã€‚å¯ä»¥çœ‹åˆ°è¿›ç¨‹å†…çš„æ•°æ®ä¼ è¾“æ˜¯è¿›ç¨‹é—´çš„æ•°æ®ä¼ è¾“çš„3.8å€ã€‚æ˜¯å¦å¼€å¯checkpointæœºåˆ¶å¯¹Flinkçš„ååå½±å“å¹¶ä¸å¤§ã€‚å› æ­¤æˆ‘ä»¬åœ¨ä½¿ç”¨Flinkæ—¶ï¼Œè¿›æ¥ä½¿ç”¨è¿›ç¨‹å†…çš„ä¼ è¾“ï¼Œä¹Ÿå°±æ˜¯å°½å¯èƒ½çš„è®©ç®—å­å¯ä»¥Chainèµ·æ¥ã€‚ é‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸ºä»€ä¹ˆChainèµ·æ¥çš„æ€§èƒ½å¥½è¿™ä¹ˆå¤šï¼Œè¦å¦‚ä½•åœ¨å†™Flinkä»£ç çš„è¿‡ç¨‹ä¸­è®©Flinkçš„ç®—å­Chainèµ·æ¥ä½¿ç”¨è¿›ç¨‹é—´çš„æ•°æ®ä¼ è¾“ã€‚ å¤§å®¶çŸ¥é“æˆ‘ä»¬åœ¨Flinkä»£ç æ—¶ä¸€å®šä¼šåˆ›å»ºä¸€ä¸ªenvï¼Œè°ƒç”¨envçš„disableOperatorChainning()æ–¹æ³•ä¼šä½¿å¾—æ‰€æœ‰çš„ç®—å­éƒ½æ— æ³•chainèµ·æ¥ã€‚æˆ‘ä»¬ä¸€èˆ¬æ˜¯åœ¨debugçš„æ—¶å€™å›è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œæ–¹ä¾¿è°ƒè¯•é—®é¢˜ã€‚ å¦‚æœå…è®¸Chainçš„æƒ…å†µä¸‹ï¼Œä¸Šå›¾ä¸­Sourceå’ŒmapFunctionå°±ä¼šChainèµ·æ¥ï¼Œæ”¾åœ¨ä¸€ä¸ªTaskä¸­è®¡ç®—ã€‚åä¹‹ï¼Œå¦‚æœä¸å…è®¸Chainï¼Œåˆ™ä¼šæ”¾åˆ°ä¸¤ä¸ªTaskä¸­ã€‚ å¯¹äºæ²¡æœ‰Chainèµ·æ¥çš„ä¸¤ä¸ªç®—å­ï¼Œä»–ä»¬è¢«æ”¾åˆ°äº†ä¸åŒçš„ä¸¤ä¸ªTaskä¸­ï¼Œé‚£ä¹ˆä»–ä»¬ä¹‹é—´çš„æ•°æ®ä¼ è¾“æ˜¯è¿™æ ·çš„ï¼šSourceFunctionå–åˆ°æ•°æ®åºåˆ—åŒ–åæ”¾å…¥å†…å­˜ï¼Œç„¶åé€šè¿‡ç½‘ç»œä¼ è¾“ç»™MapFunctionæ‰€åœ¨çš„è¿›ç¨‹ï¼Œè¯¥è¿›ç¨‹å°†æ•°æ®æ–¹åºåˆ—åŒ–åä½¿ç”¨ã€‚ å¯¹äºChainèµ·æ¥çš„ä¸¤ä¸ªç®—å­ï¼Œä»–ä»¬è¢«æ”¾åˆ°åŒä¸€ä¸ªTaskä¸­ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªç®—å­ä¹‹é—´çš„æ•°æ®ä¼ è¾“åˆ™æ˜¯ï¼šSourceFunctionå–åˆ°æ•°æ®åï¼Œè¿›è¡Œä¸€æ¬¡æ·±æ‹·è´ï¼Œç„¶åMapFunctionæŠŠæ·±æ‹·è´å‡ºæ¥çš„è¿™ä¸ªå¯¹è±¡ä½œä¸ºè¾“å…¥æ•°æ®ã€‚ è™½ç„¶Flinkåœ¨åºåˆ—åŒ–ä¸Šåšäº†å¾ˆå¤šä¼˜åŒ–ï¼Œè·Ÿä¸ç”¨åºåˆ—åŒ–å’Œä¸ç”¨ç½‘ç»œä¼ è¾“çš„è¿›ç¨‹å†…æ•°æ®ä¼ è¾“å¯¹æ¯”ï¼Œæ€§èƒ½è¿˜æ˜¯å·®å¾ˆå¤šã€‚æ‰€ä»¥æˆ‘ä»¬å°½å¯èƒ½çš„æŠŠç®—å­Chainèµ·æ¥ã€‚ ä¸æ˜¯ä»»ä½•ä¸¤ä¸ªç®—å­éƒ½å¯ä»¥Chainèµ·æ¥çš„ï¼Œè¦æŠŠç®—å­Chainèµ·æ¥æœ‰å¾ˆå¤šæ¡ä»¶ï¼šç¬¬ä¸€ï¼Œä¸‹æ¸¸ç®—å­åªèƒ½æ¥å—ä¸€ç§ä¸Šæ¸¸æ•°æ®æµï¼Œæ¯”å¦‚Mapæ¥å—çš„æµä¸èƒ½æ˜¯ä¸€æ¡unionåçš„æµï¼›å…¶æ¬¡ä¸Šä¸‹æ¸¸çš„å¹¶å‘æ•°ä¸€å®šè¦ä¸€æ ·ï¼›ç¬¬ä¸‰ï¼Œç®—å­è¦ä½¿ç”¨åŒä¸€ä¸ªèµ„æºGroupï¼Œé»˜è®¤æ˜¯ä¸€è‡´çš„ï¼Œéƒ½æ˜¯defaultï¼›ç¬¬å››ï¼Œå°±æ˜¯ä¹‹å‰è¯´çš„envä¸­ä¸èƒ½è°ƒç”¨disableOperatorChainning()æ–¹æ³•ï¼Œæœ€åï¼Œä¸Šæ¸¸å‘é€æ•°æ®çš„æ–¹æ³•æ˜¯Forwardçš„ï¼Œæ¯”å¦‚ï¼Œå¼€å‘æ—¶æ²¡æœ‰è°ƒç”¨rebalance()æ–¹æ³•ï¼Œæ²¡æœ‰keyby()ï¼Œæ²¡æœ‰boardcastç­‰ã€‚ å¯¹æ¯”ä¸€ä¸‹è‡ªäº§æ•°æ®æ—¶ï¼Œä½¿ç”¨è¿›ç¨‹å†…é€šä¿¡ï¼Œä¸”ä¸ä¿è¯æ•°æ®å¯é æ€§çš„æƒ…å†µä¸‹ï¼ŒFlinkä¸Stormçš„ååã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒFlinkçš„æ€§èƒ½æ˜¯Stormçš„15å€ã€‚Flinkååèƒ½è¾¾åˆ°2060ä¸‡æ¡/sã€‚ä¸ä»…å¦‚æ­¤ï¼Œå¦‚æœåœ¨å¼€å‘æ—¶è°ƒç”¨äº†env.getConfig().enableObjectReuse()æ–¹æ³•ï¼ŒFlinkçš„ä½†å¹¶å‘ååèƒ½è¾¾åˆ°4090ä¸‡æ¡/sã€‚ å½“è°ƒç”¨äº†enableObjectReuseæ–¹æ³•åï¼ŒFlinkä¼šæŠŠä¸­é—´æ·±æ‹·è´çš„æ­¥éª¤éƒ½çœç•¥æ‰ï¼ŒSourceFunctionäº§ç”Ÿçš„æ•°æ®ç›´æ¥ä½œä¸ºMapFunctionçš„è¾“å…¥ã€‚ä½†éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªæ–¹æ³•ä¸èƒ½éšä¾¿è°ƒç”¨ï¼Œå¿…é¡»è¦ç¡®ä¿ä¸‹æ¸¸Functionåªæœ‰ä¸€ç§ï¼Œæˆ–è€…ä¸‹æ¸¸çš„Functionå‡ä¸ä¼šæ”¹å˜å¯¹è±¡å†…éƒ¨çš„å€¼ã€‚å¦åˆ™å¯èƒ½ä¼šæœ‰çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ã€‚ å½“å¯¹æ¯”åœ¨ä¸åŒå¯é æ€§ç­–ç•¥çš„æƒ…å†µä¸‹ï¼ŒFlinkä¸Stormçš„è¡¨ç°æ—¶ï¼Œæˆ‘ä»¬å‘ç°ï¼Œä¿è¯å¯é æ€§å¯¹Flinkçš„å½±å“éå¸¸å°ï¼Œä½†å¯¹Stormçš„å½±å“éå¸¸å¤§ã€‚æ€»çš„æ¥è¯´ï¼Œåœ¨ä¿è¯å¯é çš„æƒ…å†µä¸‹ï¼ŒFlinkå•å¹¶å‘çš„ååæ˜¯Stormçš„15å€ï¼Œè€Œä¸ä¿è¯å¯é çš„æƒ…å†µä¸‹ï¼ŒFlinkçš„æ€§èƒ½æ˜¯Stormçš„66å€ã€‚ä¼šäº§ç”Ÿè¿™æ ·çš„ç»“æœï¼Œä¸»è¦æ˜¯å› ä¸ºFlinkä¸Stormä¿è¯æ•°æ®å¯é æ€§çš„æœºåˆ¶ä¸åŒã€‚ è€ŒStormçš„ACKæœºåˆ¶ä¸ºäº†ä¿è¯æ•°æ®çš„å¯é æ€§ï¼Œå¼€é”€æ›´å¤§ã€‚ å·¦è¾¹çš„å›¾å±•ç¤ºçš„æ˜¯Stormçš„Ackæœºåˆ¶ã€‚Spoutæ¯å‘é€ä¸€æ¡æ•°æ®åˆ°Boltï¼Œå°±ä¼šäº§ç”Ÿä¸€æ¡ackçš„ä¿¡æ¯ç»™ackerï¼Œå½“Boltå¤„ç†å®Œè¿™æ¡æ•°æ®åä¹Ÿä¼šå‘é€ackä¿¡æ¯ç»™ackerã€‚å½“ackeræ”¶åˆ°è¿™æ¡æ•°æ®çš„æ‰€æœ‰ackä¿¡æ¯æ—¶ï¼Œä¼šå›å¤Spoutä¸€æ¡ackä¿¡æ¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºä¸€ä¸ªåªæœ‰ä¸¤çº§ï¼ˆspout+boltï¼‰çš„æ‹“æ‰‘æ¥è¯´ï¼Œæ¯å‘é€ä¸€æ¡æ•°æ®ï¼Œå°±ä¼šä¼ è¾“3æ¡ackä¿¡æ¯ã€‚è¿™3æ¡ackä¿¡æ¯åˆ™æ˜¯ä¸ºäº†ä¿è¯å¯é æ€§æ‰€éœ€è¦çš„å¼€é”€ã€‚ å³è¾¹çš„å›¾å±•ç¤ºçš„æ˜¯Flinkçš„Checkpointæœºåˆ¶ã€‚Flinkä¸­Checkpointä¿¡æ¯çš„å‘èµ·è€…æ˜¯JobManagerã€‚å®ƒä¸åƒStormä¸­é‚£æ ·ï¼Œæ¯æ¡ä¿¡æ¯éƒ½ä¼šæœ‰ackä¿¡æ¯çš„å¼€é”€ï¼Œè€Œä¸”æŒ‰æ—¶é—´æ¥è®¡ç®—èŠ±é”€ã€‚ç”¨æˆ·å¯ä»¥è®¾ç½®åšcheckpointçš„é¢‘ç‡ï¼Œæ¯”å¦‚10ç§’é’Ÿåšä¸€æ¬¡checkpointã€‚æ¯åšä¸€æ¬¡checkpointï¼ŒèŠ±é”€åªæœ‰ä»Sourceå‘å¾€mapçš„1æ¡checkpointä¿¡æ¯ï¼ˆJobManagerå‘å‡ºæ¥çš„checkpointä¿¡æ¯èµ°çš„æ˜¯æ§åˆ¶æµï¼Œä¸æ•°æ®æµæ— å…³ï¼‰ã€‚ä¸stormç›¸æ¯”ï¼ŒFlinkçš„å¯é æ€§æœºåˆ¶å¼€é”€è¦ä½å¾—å¤šã€‚è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆä¿è¯å¯é æ€§å¯¹Flinkçš„æ€§èƒ½å½±å“è¾ƒå°ï¼Œè€Œstormçš„å½±å“ç¡®å¾ˆå¤§çš„åŸå› ã€‚ æœ€åä¸€ç»„è‡ªäº§æ•°æ®çš„æµ‹è¯•ç»“æœå¯¹æ¯”æ˜¯Flinkä¸Stormåœ¨è¿›ç¨‹é—´çš„æ•°æ®ä¼ è¾“çš„å¯¹æ¯”ï¼Œå¯ä»¥çœ‹åˆ°è¿›ç¨‹é—´æ•°æ®ä¼ è¾“çš„æƒ…å†µä¸‹ï¼ŒFlinkä½†å¹¶å‘ååæ˜¯Stormçš„4.7å€ã€‚ä¿è¯å¯é æ€§çš„æƒ…å†µä¸‹ï¼Œæ˜¯Stormçš„14å€ã€‚ ä¸Šå›¾å±•ç¤ºçš„æ˜¯æ¶ˆè´¹kafkaä¸­æ•°æ®æ—¶ï¼ŒStormä¸Flinkçš„ä½†å¹¶å‘ååæƒ…å†µã€‚å› ä¸ºæ¶ˆè´¹çš„æ˜¯kafkaä¸­çš„æ•°æ®ï¼Œæ‰€ä»¥ååé‡è‚¯å®šä¼šæ”¶åˆ°kafkaçš„å½±å“ã€‚æˆ‘ä»¬å‘ç°æ€§èƒ½çš„ç“¶é¢ˆæ˜¯åœ¨SourceFunctionä¸Šï¼Œäºæ˜¯å¢åŠ äº†topicçš„partitionæ•°å’ŒSourceFunctionå–æ•°æ®çº¿ç¨‹çš„å¹¶å‘æ•°ï¼Œä½†æ˜¯MapFunctionçš„å¹¶å‘æ•°ä»ç„¶æ˜¯1.åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å‘ç°flinkçš„ç“¶é¢ˆè½¬ç§»åˆ°ä¸Šæ¸¸å¾€ä¸‹æ¸¸å‘æ•°æ®çš„åœ°æ–¹ã€‚è€ŒStormçš„ç“¶é¢ˆç¡®æ˜¯åœ¨ä¸‹æ¸¸æ”¶æ•°æ®ååºåˆ—åŒ–çš„åœ°æ–¹ã€‚ ä¹‹å‰çš„æ€§èƒ½åˆ†æä½¿æˆ‘ä»¬åŸºäºæ•°æ®ä¼ è¾“å’Œæ•°æ®å¯é æ€§çš„è§’åº¦å‡ºå‘ï¼Œå•çº¯çš„å¯¹Flinkä¸Stormè®¡ç®—å¹³å°æœ¬èº«è¿›è¡Œäº†æ€§èƒ½åˆ†æã€‚ä½†å®é™…ä½¿ç”¨æ—¶ï¼Œtaskæ˜¯è‚¯å®šæœ‰è®¡ç®—é€»è¾‘çš„ï¼Œè¿™å°±åŠ¿å¿…æ›´å¤šçš„æ¶‰åŠåˆ°CPUï¼Œå†…å­˜ç­‰èµ„æºé—®é¢˜ã€‚æˆ‘ä»¬å°†æ¥æ‰“ç®—åšä¸€ä¸ªæ™ºèƒ½åˆ†æå¹³å°ï¼Œå¯¹ç”¨æˆ·çš„ä½œä¸šè¿›è¡Œæ€§èƒ½åˆ†æã€‚é€šè¿‡æ”¶é›†åˆ°çš„æŒ‡æ ‡ä¿¡æ¯ï¼Œåˆ†æå‡ºä½œä¸šçš„ç“¶é¢ˆåœ¨å“ªï¼Œå¹¶ç»™å‡ºä¼˜åŒ–å»ºè®®ã€‚ æœ€åGitHub Flink å­¦ä¹ ä»£ç åœ°å€ï¼šhttps://github.com/zhisheng17/flink-learning å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€åŸç†ã€å®æˆ˜ã€æ€§èƒ½è°ƒä¼˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç†","date":"2019-06-19T16:00:00.000Z","path":"2019/06/20/flink-kafka-Exactly-Once/","text":"Apache Flink è‡ª2017å¹´12æœˆå‘å¸ƒçš„1.4.0ç‰ˆæœ¬å¼€å§‹ï¼Œä¸ºæµè®¡ç®—å¼•å…¥äº†ä¸€ä¸ªé‡è¦çš„é‡Œç¨‹ç¢‘ç‰¹æ€§ï¼šTwoPhaseCommitSinkFunctionï¼ˆç›¸å…³çš„ Jiraï¼‰ã€‚å®ƒæå–äº†ä¸¤é˜¶æ®µæäº¤åè®®çš„é€šç”¨é€»è¾‘ï¼Œä½¿å¾—é€šè¿‡ Flink æ¥æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once ç¨‹åºæˆä¸ºå¯èƒ½ã€‚åŒæ—¶æ”¯æŒä¸€äº›æ•°æ®æºï¼ˆsourceï¼‰å’Œè¾“å‡ºç«¯ï¼ˆsinkï¼‰ï¼ŒåŒ…æ‹¬ Apache Kafka 0.11åŠæ›´é«˜ç‰ˆæœ¬ã€‚å®ƒæä¾›äº†ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œç”¨æˆ·åªéœ€è¦å®ç°å°‘æ•°æ–¹æ³•å°±èƒ½å®ç°ç«¯åˆ°ç«¯çš„ Exactly-Once è¯­ä¹‰ã€‚ æœ¬æ–‡ä½œè€…æ˜¯ Piotr Nowojskiï¼Œç¿»è¯‘è‡ª å‘¨å‡¯æ³¢åŸæ–‡åœ°å€ï¼šhttps://www.ververica.com/blog/end-to-end-exactly-once-processing-apache-flink-apache-kafka æœ‰å…³ TwoPhaseCommitSinkFunction çš„ä½¿ç”¨è¯¦è§æ–‡æ¡£: TwoPhaseCommitSinkFunctionã€‚æˆ–è€…å¯ä»¥ç›´æ¥é˜…è¯» Kafka 0.11 sink çš„æ–‡æ¡£: kafkaã€‚ æ¥ä¸‹æ¥ä¼šè¯¦ç»†åˆ†æè¿™ä¸ªæ–°åŠŸèƒ½ä»¥åŠFlinkçš„å®ç°é€»è¾‘ï¼Œåˆ†ä¸ºå¦‚ä¸‹å‡ ç‚¹ã€‚ æè¿° Flink checkpoint æœºåˆ¶æ˜¯å¦‚ä½•ä¿è¯Flinkç¨‹åºç»“æœçš„ Exactly-Once çš„ æ˜¾ç¤º Flink å¦‚ä½•é€šè¿‡ä¸¤é˜¶æ®µæäº¤åè®®ä¸æ•°æ®æºå’Œæ•°æ®è¾“å‡ºç«¯äº¤äº’ï¼Œä»¥æä¾›ç«¯åˆ°ç«¯çš„ Exactly-Once ä¿è¯ é€šè¿‡ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œäº†è§£å¦‚ä½•ä½¿ç”¨ TwoPhaseCommitSinkFunction å®ç° Exactly-Once çš„æ–‡ä»¶è¾“å‡º Flink åº”ç”¨ç¨‹åºä¸­çš„ Exactly-Once è¯­ä¹‰å½“æˆ‘ä»¬è¯´ã€Exactly-Onceã€æ—¶ï¼ŒæŒ‡çš„æ˜¯æ¯ä¸ªè¾“å…¥çš„äº‹ä»¶åªå½±å“æœ€ç»ˆç»“æœä¸€æ¬¡ã€‚å³ä½¿æœºå™¨æˆ–è½¯ä»¶å‡ºç°æ•…éšœï¼Œæ—¢æ²¡æœ‰é‡å¤æ•°æ®ï¼Œä¹Ÿä¸ä¼šä¸¢æ•°æ®ã€‚ Flink å¾ˆä¹…ä¹‹å‰å°±æä¾›äº† Exactly-Once è¯­ä¹‰ã€‚åœ¨è¿‡å»å‡ å¹´ä¸­ï¼Œæˆ‘ä»¬å¯¹ Flink çš„ checkpoint æœºåˆ¶æœ‰è¿‡æ·±å…¥çš„æè¿°ï¼Œè¿™æ˜¯ Flink æœ‰èƒ½åŠ›æä¾› Exactly-Once è¯­ä¹‰çš„æ ¸å¿ƒã€‚Flink æ–‡æ¡£è¿˜æä¾›äº†è¯¥åŠŸèƒ½çš„å…¨é¢æ¦‚è¿°ã€‚ åœ¨ç»§ç»­ä¹‹å‰ï¼Œå…ˆçœ‹ä¸‹å¯¹ checkpoint æœºåˆ¶çš„ç®€è¦ä»‹ç»ï¼Œè¿™å¯¹ç†è§£åé¢çš„ä¸»é¢˜è‡³å…³é‡è¦ã€‚ ä¸€æ¬¡ checkpoint æ˜¯ä»¥ä¸‹å†…å®¹çš„ä¸€è‡´æ€§å¿«ç…§ï¼š åº”ç”¨ç¨‹åºçš„å½“å‰çŠ¶æ€ è¾“å…¥æµçš„ä½ç½® Flink å¯ä»¥é…ç½®ä¸€ä¸ªå›ºå®šçš„æ—¶é—´ç‚¹ï¼Œå®šæœŸäº§ç”Ÿ checkpointï¼Œå°† checkpoint çš„æ•°æ®å†™å…¥æŒä¹…å­˜å‚¨ç³»ç»Ÿï¼Œä¾‹å¦‚ S3 æˆ– HDFS ã€‚å°† checkpoint æ•°æ®å†™å…¥æŒä¹…å­˜å‚¨æ˜¯å¼‚æ­¥å‘ç”Ÿçš„ï¼Œè¿™æ„å‘³ç€ Flink åº”ç”¨ç¨‹åºåœ¨ checkpoint è¿‡ç¨‹ä¸­å¯ä»¥ç»§ç»­å¤„ç†æ•°æ®ã€‚ å¦‚æœå‘ç”Ÿæœºå™¨æˆ–è½¯ä»¶æ•…éšœï¼Œé‡æ–°å¯åŠ¨åï¼ŒFlink åº”ç”¨ç¨‹åºå°†ä»æœ€æ–°çš„ checkpoint ç‚¹æ¢å¤å¤„ç†ï¼› Flink ä¼šæ¢å¤åº”ç”¨ç¨‹åºçŠ¶æ€ï¼Œå°†è¾“å…¥æµå›æ»šåˆ°ä¸Šæ¬¡ checkpoint ä¿å­˜çš„ä½ç½®ï¼Œç„¶åé‡æ–°å¼€å§‹è¿è¡Œã€‚è¿™æ„å‘³ç€ Flink å¯ä»¥åƒä»æœªå‘ç”Ÿè¿‡æ•…éšœä¸€æ ·è®¡ç®—ç»“æœã€‚ åœ¨ Flink 1.4.0 ä¹‹å‰ï¼ŒExactly-Once è¯­ä¹‰ä»…é™äº Flink åº”ç”¨ç¨‹åºå†…éƒ¨ï¼Œå¹¶æ²¡æœ‰æ‰©å±•åˆ° Flink æ•°æ®å¤„ç†å®Œåå‘é€çš„å¤§å¤šæ•°å¤–éƒ¨ç³»ç»Ÿã€‚Flink åº”ç”¨ç¨‹åºä¸å„ç§æ•°æ®è¾“å‡ºç«¯è¿›è¡Œäº¤äº’ï¼Œå¼€å‘äººå‘˜éœ€è¦æœ‰èƒ½åŠ›è‡ªå·±ç»´æŠ¤ç»„ä»¶çš„ä¸Šä¸‹æ–‡æ¥ä¿è¯ Exactly-Once è¯­ä¹‰ã€‚ ä¸ºäº†æä¾›ç«¯åˆ°ç«¯çš„ Exactly-Once è¯­ä¹‰ - ä¹Ÿå°±æ˜¯è¯´ï¼Œé™¤äº† Flink åº”ç”¨ç¨‹åºå†…éƒ¨ï¼Œ Flink å†™å…¥çš„å¤–éƒ¨ç³»ç»Ÿä¹Ÿéœ€è¦èƒ½æ»¡è¶³ Exactly-Once è¯­ä¹‰ - è¿™äº›å¤–éƒ¨ç³»ç»Ÿå¿…é¡»æä¾›æäº¤æˆ–å›æ»šçš„æ–¹æ³•ï¼Œç„¶åé€šè¿‡ Flink çš„ checkpoint æœºåˆ¶æ¥åè°ƒã€‚ åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œåè°ƒæäº¤å’Œå›æ»šçš„å¸¸ç”¨æ–¹æ³•æ˜¯ä¸¤é˜¶æ®µæäº¤åè®®ã€‚åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®º Flink çš„ TwoPhaseCommitSinkFunction æ˜¯å¦‚ä½•åˆ©ç”¨ä¸¤é˜¶æ®µæäº¤åè®®æ¥æä¾›ç«¯åˆ°ç«¯çš„ Exactly-Once è¯­ä¹‰ã€‚ Flink åº”ç”¨ç¨‹åºç«¯åˆ°ç«¯çš„ Exactly-Once è¯­ä¹‰æˆ‘ä»¬å°†ä»‹ç»ä¸¤é˜¶æ®µæäº¤åè®®ï¼Œä»¥åŠå®ƒå¦‚ä½•åœ¨ä¸€ä¸ªè¯»å†™ Kafka çš„ Flink ç¨‹åºä¸­å®ç°ç«¯åˆ°ç«¯çš„ Exactly-Once è¯­ä¹‰ã€‚Kafka æ˜¯ä¸€ä¸ªæµè¡Œçš„æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œç»å¸¸ä¸ Flink ä¸€èµ·ä½¿ç”¨ã€‚Kafka åœ¨æœ€è¿‘çš„ 0.11 ç‰ˆæœ¬ä¸­æ·»åŠ äº†å¯¹äº‹åŠ¡çš„æ”¯æŒã€‚è¿™æ„å‘³ç€ç°åœ¨é€šè¿‡ Flink è¯»å†™ Kafka ï¼Œå¹¶æä¾›ç«¯åˆ°ç«¯çš„ Exactly-Once è¯­ä¹‰æœ‰äº†å¿…è¦çš„æ”¯æŒã€‚ Flink å¯¹ç«¯åˆ°ç«¯çš„ Exactly-Once è¯­ä¹‰çš„æ”¯æŒä¸ä»…å±€é™äº Kafka ï¼Œæ‚¨å¯ä»¥å°†å®ƒä¸ä»»ä½•ä¸€ä¸ªæä¾›äº†å¿…è¦çš„åè°ƒæœºåˆ¶çš„æº/è¾“å‡ºç«¯ä¸€èµ·ä½¿ç”¨ã€‚ä¾‹å¦‚ Pravegaï¼Œæ¥è‡ª DELL/EMC çš„å¼€æºæµåª’ä½“å­˜å‚¨ç³»ç»Ÿï¼Œé€šè¿‡ Flink çš„ TwoPhaseCommitSinkFunction ä¹Ÿèƒ½æ”¯æŒç«¯åˆ°ç«¯çš„ Exactly-Once è¯­ä¹‰ã€‚ åœ¨ä»Šå¤©è®¨è®ºçš„è¿™ä¸ªç¤ºä¾‹ç¨‹åºä¸­ï¼Œæˆ‘ä»¬æœ‰ï¼š ä» Kafka è¯»å–çš„æ•°æ®æºï¼ˆ Flink å†…ç½®çš„ KafkaConsumerï¼‰ çª—å£èšåˆ å°†æ•°æ®å†™å› Kafka çš„æ•°æ®è¾“å‡ºç«¯ï¼ˆ Flink å†…ç½®çš„ KafkaProducer ï¼‰ è¦ä½¿æ•°æ®è¾“å‡ºç«¯æä¾› Exactly-Once ä¿è¯ï¼Œå®ƒå¿…é¡»å°†æ‰€æœ‰æ•°æ®é€šè¿‡ä¸€ä¸ªäº‹åŠ¡æäº¤ç»™ Kafkaã€‚æäº¤æ†ç»‘äº†ä¸¤ä¸ª checkpoint ä¹‹é—´çš„æ‰€æœ‰è¦å†™å…¥çš„æ•°æ®ã€‚è¿™å¯ç¡®ä¿åœ¨å‘ç”Ÿæ•…éšœæ—¶èƒ½å›æ»šå†™å…¥çš„æ•°æ®ã€‚ä½†æ˜¯åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œé€šå¸¸ä¼šæœ‰å¤šä¸ªå¹¶å‘è¿è¡Œçš„å†™å…¥ä»»åŠ¡çš„ï¼Œç®€å•çš„æäº¤æˆ–å›æ»šæ˜¯ä¸å¤Ÿçš„ï¼Œå› ä¸ºæ‰€æœ‰ç»„ä»¶å¿…é¡»åœ¨æäº¤æˆ–å›æ»šæ—¶â€œä¸€è‡´â€æ‰èƒ½ç¡®ä¿ä¸€è‡´çš„ç»“æœã€‚Flink ä½¿ç”¨ä¸¤é˜¶æ®µæäº¤åè®®åŠé¢„æäº¤é˜¶æ®µæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ åœ¨ checkpoint å¼€å§‹çš„æ—¶å€™ï¼Œå³ä¸¤é˜¶æ®µæäº¤åè®®çš„â€œé¢„æäº¤â€é˜¶æ®µã€‚å½“ checkpoint å¼€å§‹æ—¶ï¼ŒFlink çš„ JobManager ä¼šå°† checkpoint barrierï¼ˆå°†æ•°æ®æµä¸­çš„è®°å½•åˆ†ä¸ºè¿›å…¥å½“å‰ checkpoint ä¸è¿›å…¥ä¸‹ä¸€ä¸ª checkpoint ï¼‰æ³¨å…¥æ•°æ®æµã€‚ brarrier åœ¨ operator ä¹‹é—´ä¼ é€’ã€‚å¯¹äºæ¯ä¸€ä¸ª operatorï¼Œå®ƒè§¦å‘ operator çš„çŠ¶æ€å¿«ç…§å†™å…¥åˆ° state backendã€‚ æ•°æ®æºä¿å­˜äº†æ¶ˆè´¹ Kafka çš„åç§»é‡(offset)ï¼Œä¹‹åå°† checkpoint barrier ä¼ é€’ç»™ä¸‹ä¸€ä¸ª operatorã€‚ è¿™ç§æ–¹å¼ä»…é€‚ç”¨äº operator å…·æœ‰ã€å†…éƒ¨ã€çŠ¶æ€ã€‚æ‰€è°“å†…éƒ¨çŠ¶æ€ï¼Œæ˜¯æŒ‡ Flink statebackend ä¿å­˜å’Œç®¡ç†çš„ -ä¾‹å¦‚ï¼Œç¬¬äºŒä¸ª operator ä¸­ window èšåˆç®—å‡ºæ¥çš„ sum å€¼ã€‚å½“ä¸€ä¸ªè¿›ç¨‹æœ‰å®ƒçš„å†…éƒ¨çŠ¶æ€çš„æ—¶å€™ï¼Œé™¤äº†åœ¨ checkpoint ä¹‹å‰éœ€è¦å°†æ•°æ®å˜æ›´å†™å…¥åˆ° state backend ï¼Œä¸éœ€è¦åœ¨é¢„æäº¤é˜¶æ®µæ‰§è¡Œä»»ä½•å…¶ä»–æ“ä½œã€‚Flink è´Ÿè´£åœ¨ checkpoint æˆåŠŸçš„æƒ…å†µä¸‹æ­£ç¡®æäº¤è¿™äº›å†™å…¥ï¼Œæˆ–è€…åœ¨å‡ºç°æ•…éšœæ—¶ä¸­æ­¢è¿™äº›å†™å…¥ã€‚ ç¤ºä¾‹ Flink åº”ç”¨ç¨‹åºå¯åŠ¨é¢„æäº¤é˜¶æ®µä½†æ˜¯ï¼Œå½“è¿›ç¨‹å…·æœ‰ã€å¤–éƒ¨ã€çŠ¶æ€æ—¶ï¼Œéœ€è¦ä½œäº›é¢å¤–çš„å¤„ç†ã€‚å¤–éƒ¨çŠ¶æ€é€šå¸¸ä»¥å†™å…¥å¤–éƒ¨ç³»ç»Ÿï¼ˆå¦‚ Kafkaï¼‰çš„å½¢å¼å‡ºç°ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸ºäº†æä¾› Exactly-Once ä¿è¯ï¼Œå¤–éƒ¨ç³»ç»Ÿå¿…é¡»æ”¯æŒäº‹åŠ¡ï¼Œè¿™æ ·æ‰èƒ½å’Œä¸¤é˜¶æ®µæäº¤åè®®é›†æˆã€‚ åœ¨æœ¬æ–‡ç¤ºä¾‹ä¸­çš„æ•°æ®éœ€è¦å†™å…¥ Kafkaï¼Œå› æ­¤æ•°æ®è¾“å‡ºç«¯ï¼ˆ Data Sink ï¼‰æœ‰å¤–éƒ¨çŠ¶æ€ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåœ¨é¢„æäº¤é˜¶æ®µï¼Œé™¤äº†å°†å…¶çŠ¶æ€å†™å…¥ state backend ä¹‹å¤–ï¼Œæ•°æ®è¾“å‡ºç«¯è¿˜å¿…é¡»é¢„å…ˆæäº¤å…¶å¤–éƒ¨äº‹åŠ¡ã€‚ å½“ checkpoint barrier åœ¨æ‰€æœ‰ operator éƒ½ä¼ é€’äº†ä¸€éï¼Œå¹¶ä¸”è§¦å‘çš„ checkpoint å›è°ƒæˆåŠŸå®Œæˆæ—¶ï¼Œé¢„æäº¤é˜¶æ®µå°±ç»“æŸäº†ã€‚æ‰€æœ‰è§¦å‘çš„çŠ¶æ€å¿«ç…§éƒ½è¢«è§†ä¸ºè¯¥ checkpoint çš„ä¸€éƒ¨åˆ†ã€‚checkpoint æ˜¯æ•´ä¸ªåº”ç”¨ç¨‹åºçŠ¶æ€çš„å¿«ç…§ï¼ŒåŒ…æ‹¬é¢„å…ˆæäº¤çš„å¤–éƒ¨çŠ¶æ€ã€‚å¦‚æœå‘ç”Ÿæ•…éšœï¼Œæˆ‘ä»¬å¯ä»¥å›æ»šåˆ°ä¸Šæ¬¡æˆåŠŸå®Œæˆå¿«ç…§çš„æ—¶é—´ç‚¹ã€‚ ä¸‹ä¸€æ­¥æ˜¯é€šçŸ¥æ‰€æœ‰ operatorï¼Œcheckpoint å·²ç»æˆåŠŸäº†ã€‚è¿™æ˜¯ä¸¤é˜¶æ®µæäº¤åè®®çš„æäº¤é˜¶æ®µï¼ŒJobManager ä¸ºåº”ç”¨ç¨‹åºä¸­çš„æ¯ä¸ª operator å‘å‡º checkpoint å·²å®Œæˆçš„å›è°ƒã€‚ æ•°æ®æºå’Œ windnow operator æ²¡æœ‰å¤–éƒ¨çŠ¶æ€ï¼Œå› æ­¤åœ¨æäº¤é˜¶æ®µï¼Œè¿™äº› operator ä¸å¿…æ‰§è¡Œä»»ä½•æ“ä½œã€‚ä½†æ˜¯ï¼Œæ•°æ®è¾“å‡ºç«¯ï¼ˆData Sinkï¼‰æ‹¥æœ‰å¤–éƒ¨çŠ¶æ€ï¼Œæ­¤æ—¶åº”è¯¥æäº¤å¤–éƒ¨äº‹åŠ¡ã€‚ æˆ‘ä»¬å¯¹ä¸Šè¿°çŸ¥è¯†ç‚¹æ€»ç»“ä¸‹ï¼š ä¸€æ—¦æ‰€æœ‰ operator å®Œæˆé¢„æäº¤ï¼Œå°±æäº¤ä¸€ä¸ª commitã€‚ å¦‚æœè‡³å°‘æœ‰ä¸€ä¸ªé¢„æäº¤å¤±è´¥ï¼Œåˆ™æ‰€æœ‰å…¶ä»–æäº¤éƒ½å°†ä¸­æ­¢ï¼Œæˆ‘ä»¬å°†å›æ»šåˆ°ä¸Šä¸€ä¸ªæˆåŠŸå®Œæˆçš„ checkpoint ã€‚ åœ¨é¢„æäº¤æˆåŠŸä¹‹åï¼Œæäº¤çš„ commit éœ€è¦ä¿è¯æœ€ç»ˆæˆåŠŸ - operator å’Œå¤–éƒ¨ç³»ç»Ÿéƒ½éœ€è¦ä¿éšœè¿™ç‚¹ã€‚å¦‚æœ commit å¤±è´¥ï¼ˆä¾‹å¦‚ï¼Œç”±äºé—´æ­‡æ€§ç½‘ç»œé—®é¢˜ï¼‰ï¼Œæ•´ä¸ª Flink åº”ç”¨ç¨‹åºå°†å¤±è´¥ï¼Œåº”ç”¨ç¨‹åºå°†æ ¹æ®ç”¨æˆ·çš„é‡å¯ç­–ç•¥é‡æ–°å¯åŠ¨ï¼Œè¿˜ä¼šå°è¯•å†æäº¤ã€‚è¿™ä¸ªè¿‡ç¨‹è‡³å…³é‡è¦ï¼Œå› ä¸ºå¦‚æœ commit æœ€ç»ˆæ²¡æœ‰æˆåŠŸï¼Œå°†ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šæ‰€æœ‰ operator éƒ½åŒæ„ checkpoint çš„æœ€ç»ˆç»“æœï¼šæ‰€æœ‰ operator éƒ½åŒæ„æ•°æ®å·²æäº¤ï¼Œæˆ–æäº¤è¢«ä¸­æ­¢å¹¶å›æ»šã€‚ åœ¨ Flink ä¸­å®ç°ä¸¤é˜¶æ®µæäº¤ Operatorå®Œæ•´çš„å®ç°ä¸¤é˜¶æ®µæäº¤åè®®å¯èƒ½æœ‰ç‚¹å¤æ‚ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆ Flink å°†å®ƒçš„é€šç”¨é€»è¾‘æå–åˆ°æŠ½è±¡ç±» TwoPhaseCommitSinkFunction ä¸­çš„åŸå› ã€‚ æ¥ä¸‹æ¥åŸºäºè¾“å‡ºåˆ°æ–‡ä»¶çš„ç®€å•ç¤ºä¾‹ï¼Œè¯´æ˜å¦‚ä½•ä½¿ç”¨ TwoPhaseCommitSinkFunction ã€‚ç”¨æˆ·åªéœ€è¦å®ç°å››ä¸ªå‡½æ•°ï¼Œå°±èƒ½ä¸ºæ•°æ®è¾“å‡ºç«¯å®ç° Exactly-Once è¯­ä¹‰ï¼š beginTransaction - åœ¨äº‹åŠ¡å¼€å§‹å‰ï¼Œæˆ‘ä»¬åœ¨ç›®æ ‡æ–‡ä»¶ç³»ç»Ÿçš„ä¸´æ—¶ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ã€‚éšåï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¤„ç†æ•°æ®æ—¶å°†æ•°æ®å†™å…¥æ­¤æ–‡ä»¶ã€‚ preCommit - åœ¨é¢„æäº¤é˜¶æ®µï¼Œæˆ‘ä»¬åˆ·æ–°æ–‡ä»¶åˆ°å­˜å‚¨ï¼Œå…³é—­æ–‡ä»¶ï¼Œä¸å†é‡æ–°å†™å…¥ã€‚æˆ‘ä»¬è¿˜å°†ä¸ºå±äºä¸‹ä¸€ä¸ª checkpoint çš„ä»»ä½•åç»­æ–‡ä»¶å†™å…¥å¯åŠ¨ä¸€ä¸ªæ–°çš„äº‹åŠ¡ã€‚ commit - åœ¨æäº¤é˜¶æ®µï¼Œæˆ‘ä»¬å°†é¢„æäº¤é˜¶æ®µçš„æ–‡ä»¶åŸå­åœ°ç§»åŠ¨åˆ°çœŸæ­£çš„ç›®æ ‡ç›®å½•ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¼šå¢åŠ è¾“å‡ºæ•°æ®å¯è§æ€§çš„å»¶è¿Ÿã€‚ abort - åœ¨ä¸­æ­¢é˜¶æ®µï¼Œæˆ‘ä»¬åˆ é™¤ä¸´æ—¶æ–‡ä»¶ã€‚ æˆ‘ä»¬çŸ¥é“ï¼Œå¦‚æœå‘ç”Ÿä»»ä½•æ•…éšœï¼ŒFlink ä¼šå°†åº”ç”¨ç¨‹åºçš„çŠ¶æ€æ¢å¤åˆ°æœ€æ–°çš„ä¸€æ¬¡ checkpoint ç‚¹ã€‚ä¸€ç§æç«¯çš„æƒ…å†µæ˜¯ï¼Œé¢„æäº¤æˆåŠŸäº†ï¼Œä½†åœ¨è¿™æ¬¡ commit çš„é€šçŸ¥åˆ°è¾¾ operator ä¹‹å‰å‘ç”Ÿäº†æ•…éšœã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒFlink ä¼šå°† operator çš„çŠ¶æ€æ¢å¤åˆ°å·²ç»é¢„æäº¤ï¼Œä½†å°šæœªçœŸæ­£æäº¤çš„çŠ¶æ€ã€‚ æˆ‘ä»¬éœ€è¦åœ¨é¢„æäº¤é˜¶æ®µä¿å­˜è¶³å¤Ÿå¤šçš„ä¿¡æ¯åˆ° checkpoint çŠ¶æ€ä¸­ï¼Œä»¥ä¾¿åœ¨é‡å¯åèƒ½æ­£ç¡®çš„ä¸­æ­¢æˆ–æäº¤äº‹åŠ¡ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè¿™äº›ä¿¡æ¯æ˜¯ä¸´æ—¶æ–‡ä»¶å’Œç›®æ ‡ç›®å½•çš„è·¯å¾„ã€‚ TwoPhaseCommitSinkFunction å·²ç»æŠŠè¿™ç§æƒ…å†µè€ƒè™‘åœ¨å†…äº†ï¼Œå¹¶ä¸”åœ¨ä» checkpoint ç‚¹æ¢å¤çŠ¶æ€æ—¶ï¼Œä¼šä¼˜å…ˆå‘å‡ºä¸€ä¸ª commit ã€‚æˆ‘ä»¬éœ€è¦ä»¥å¹‚ç­‰æ–¹å¼å®ç°æäº¤ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œè¿™å¹¶ä¸éš¾ã€‚åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è¯†åˆ«å‡ºè¿™æ ·çš„æƒ…å†µï¼šä¸´æ—¶æ–‡ä»¶ä¸åœ¨ä¸´æ—¶ç›®å½•ä¸­ï¼Œä½†å·²ç»ç§»åŠ¨åˆ°ç›®æ ‡ç›®å½•äº†ã€‚ åœ¨ TwoPhaseCommitSinkFunction ä¸­ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–è¾¹ç•Œæƒ…å†µä¹Ÿä¼šè€ƒè™‘åœ¨å†…ï¼Œè¯·å‚è€ƒ Flink æ–‡æ¡£äº†è§£æ›´å¤šä¿¡æ¯ã€‚ æ€»ç»“æ€»ç»“ä¸‹æœ¬æ–‡æ¶‰åŠçš„ä¸€äº›è¦ç‚¹ï¼š Flink çš„ checkpoint æœºåˆ¶æ˜¯æ”¯æŒä¸¤é˜¶æ®µæäº¤åè®®å¹¶æä¾›ç«¯åˆ°ç«¯çš„ Exactly-Once è¯­ä¹‰çš„åŸºç¡€ã€‚ è¿™ä¸ªæ–¹æ¡ˆçš„ä¼˜ç‚¹æ˜¯: Flink ä¸åƒå…¶ä»–ä¸€äº›ç³»ç»Ÿé‚£æ ·ï¼Œé€šè¿‡ç½‘ç»œä¼ è¾“å­˜å‚¨æ•°æ® - ä¸éœ€è¦åƒå¤§å¤šæ•°æ‰¹å¤„ç†ç¨‹åºé‚£æ ·å°†è®¡ç®—çš„æ¯ä¸ªé˜¶æ®µå†™å…¥ç£ç›˜ã€‚ Flink çš„ TwoPhaseCommitSinkFunction æå–äº†ä¸¤é˜¶æ®µæäº¤åè®®çš„é€šç”¨é€»è¾‘ï¼ŒåŸºäºæ­¤å°† Flink å’Œæ”¯æŒäº‹åŠ¡çš„å¤–éƒ¨ç³»ç»Ÿç»“åˆï¼Œæ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once æˆä¸ºå¯èƒ½ã€‚ ä» Flink 1.4.0 å¼€å§‹ï¼ŒPravega å’Œ Kafka 0.11 producer éƒ½æä¾›äº† Exactly-Once è¯­ä¹‰ï¼›Kafka åœ¨0.11ç‰ˆæœ¬é¦–æ¬¡å¼•å…¥äº†äº‹åŠ¡ï¼Œä¸ºåœ¨ Flink ç¨‹åºä¸­ä½¿ç”¨ Kafka producer æä¾› Exactly-Once è¯­ä¹‰æä¾›äº†å¯èƒ½æ€§ã€‚ Kafka 0.11 producerçš„äº‹åŠ¡æ˜¯åœ¨ TwoPhaseCommitSinkFunction åŸºç¡€ä¸Šå®ç°çš„ï¼Œå’Œ at-least-once producer ç›¸æ¯”åªå¢åŠ äº†éå¸¸ä½çš„å¼€é”€ã€‚ è¿™æ˜¯ä¸ªä»¤äººå…´å¥‹çš„åŠŸèƒ½ï¼ŒæœŸå¾… Flink TwoPhaseCommitSinkFunction åœ¨æœªæ¥æ”¯æŒæ›´å¤šçš„æ•°æ®æ¥æ”¶ç«¯ã€‚ æœ€åGitHub Flink å­¦ä¹ ä»£ç åœ°å€ï¼šhttps://github.com/zhisheng17/flink-learning å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ ä¸“æ ä»‹ç»é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€åŸç†ã€å®æˆ˜ã€æ€§èƒ½è°ƒä¼˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç»","date":"2019-06-17T16:00:00.000Z","path":"2019/06/18/flink-state/","text":"æœ‰çŠ¶æ€çš„æµæ•°æ®å¤„ç† æœ¬æ–‡æ•´ç†è‡ªå»å¹´8æœˆ11æ—¥åœ¨åŒ—äº¬ä¸¾è¡Œçš„ Flink Meetup ä¼šè®®ï¼Œåˆ†äº«å˜‰å®¾æ–½æ™“ç½¡ï¼Œç›®å‰åœ¨é˜¿é‡Œå¤§æ•°æ®å›¢é˜Ÿéƒ¨ä»äº‹Blinkæ–¹é¢çš„ç ”å‘ï¼Œç°åœ¨ä¸»è¦è´Ÿè´£BlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™ç›¸å…³æŠ€æœ¯çš„ç ”å‘ã€‚ 1.1. ä»€ä¹ˆæ˜¯æœ‰çŠ¶æ€çš„è®¡ç®—è®¡ç®—ä»»åŠ¡çš„ç»“æœä¸ä»…ä»…ä¾èµ–äºè¾“å…¥ï¼Œè¿˜ä¾èµ–äºå®ƒçš„å½“å‰çŠ¶æ€ï¼Œå…¶å®å¤§å¤šæ•°çš„è®¡ç®—éƒ½æ˜¯æœ‰çŠ¶æ€çš„è®¡ç®—ã€‚ æ¯”å¦‚wordcount,ç»™ä¸€äº›word,å…¶è®¡ç®—å®ƒçš„count,è¿™æ˜¯ä¸€ä¸ªå¾ˆå¸¸è§çš„ä¸šåŠ¡åœºæ™¯ã€‚countåšä¸ºè¾“å‡ºï¼Œåœ¨è®¡ç®—çš„è¿‡ç¨‹ä¸­è¦ä¸æ–­çš„æŠŠè¾“å…¥ç´¯åŠ åˆ°countä¸Šå»ï¼Œé‚£ä¹ˆcountå°±æ˜¯ä¸€ä¸ªstateã€‚ 1.2.ä¼ ç»Ÿæµè®¡ç®—ç¼ºå°‘å¯¹äºç¨‹åºçŠ¶æ€çš„æœ‰æ•ˆæ”¯æŒçŠ¶æ€æ•°æ®çš„å­˜å‚¨å’Œè®¿é—®ï¼› çŠ¶æ€æ•°æ®çš„å¤‡ä»½å’Œæ¢å¤ï¼› çŠ¶æ€æ•°æ®çš„åˆ’åˆ†å’ŒåŠ¨æ€æ‰©å®¹ï¼› åœ¨ä¼ ç»Ÿçš„æ‰¹å¤„ç†ä¸­ï¼Œæ•°æ®æ˜¯åˆ’åˆ†ä¸ºå—åˆ†ç‰‡å»å®Œæˆçš„ï¼Œç„¶åæ¯ä¸€ä¸ªTaskå»å¤„ç†ä¸€ä¸ªåˆ†ç‰‡ã€‚å½“åˆ†ç‰‡æ‰§è¡Œå®Œæˆåï¼ŒæŠŠè¾“å‡ºèšåˆèµ·æ¥å°±æ˜¯æœ€ç»ˆçš„ç»“æœã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹å½“ä¸­ï¼Œå¯¹äºstateçš„éœ€æ±‚è¿˜æ˜¯æ¯”è¾ƒå°çš„ã€‚ å¯¹äºæµè®¡ç®—è€Œè¨€ï¼Œå¯¹Stateæœ‰éå¸¸é«˜çš„è¦æ±‚ï¼Œå› ä¸ºåœ¨æµç³»ç»Ÿä¸­è¾“å…¥æ˜¯ä¸€ä¸ªæ— é™åˆ¶çš„æµï¼Œä¼šè¿è¡Œå¾ˆé•¿ä¸€æ®µæ—¶é—´ï¼Œç”šè‡³è¿è¡Œå‡ å¤©æˆ–è€…å‡ ä¸ªæœˆéƒ½ä¸ä¼šåœæœºã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹å½“ä¸­ï¼Œå°±éœ€è¦å°†çŠ¶æ€æ•°æ®å¾ˆå¥½çš„ç®¡ç†èµ·æ¥ã€‚å¾ˆä¸å¹¸çš„æ˜¯ï¼Œåœ¨ä¼ ç»Ÿçš„æµè®¡ç®—ç³»ç»Ÿä¸­ï¼Œå¯¹çŠ¶æ€ç®¡ç†æ”¯æŒå¹¶ä¸æ˜¯å¾ˆå®Œå–„ã€‚æ¯”å¦‚storm,æ²¡æœ‰ä»»ä½•ç¨‹åºçŠ¶æ€çš„æ”¯æŒï¼Œä¸€ç§å¯é€‰çš„æ–¹æ¡ˆæ˜¯storm+hbaseè¿™æ ·çš„æ–¹å¼å»å®ç°ï¼ŒæŠŠè¿™çŠ¶æ€æ•°æ®å­˜æ”¾åœ¨Hbaseä¸­ï¼Œè®¡ç®—çš„æ—¶å€™å†æ¬¡ä»Hbaseè¯»å–çŠ¶æ€æ•°æ®ï¼Œåšæ›´æ–°åœ¨å†™å…¥è¿›å»ã€‚è¿™æ ·å°±ä¼šæœ‰å¦‚ä¸‹å‡ ä¸ªé—®é¢˜ 1.3.Flinkä¸°å¯Œçš„çŠ¶æ€è®¿é—®å’Œé«˜æ•ˆçš„å®¹é”™æœºåˆ¶Flinkåœ¨æœ€æ—©è®¾è®¡çš„æ—¶å€™å°±æ„è¯†åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œå¹¶æä¾›äº†ä¸°å¯Œçš„çŠ¶æ€è®¿é—®å’Œå®¹é”™æœºåˆ¶ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š Flinkä¸­çš„çŠ¶æ€ç®¡ç† 2.1.æŒ‰ç…§æ•°æ®çš„åˆ’åˆ†å’Œæ‰©å¼ æ–¹å¼ Keyed States Operator States 2.1.1. Keyed States Keyed Statesçš„ä½¿ç”¨ Flinkä¹Ÿæä¾›äº†Keyed Stateså¤šç§æ•°æ®ç»“æ„ç±»å‹ Keyed Statesçš„åŠ¨æ€æ‰©å®¹ 2.1.2.Operator State Operator Statesçš„ä½¿ç”¨ Operator Statesçš„æ•°æ®ç»“æ„ä¸åƒKeyed Statesä¸°å¯Œï¼Œç°åœ¨åªæ”¯æŒListã€‚ Operator Stateså¤šç§æ‰©å±•æ–¹å¼ Operator Statesçš„åŠ¨æ€æ‰©å±•æ˜¯éå¸¸çµæ´»çš„ï¼Œç°æä¾›äº†3ç§æ‰©å±•ï¼Œä¸‹é¢åˆ†åˆ«ä»‹ç»ï¼š ListState:å¹¶å‘åº¦åœ¨æ”¹å˜çš„æ—¶å€™ï¼Œä¼šå°†å¹¶å‘ä¸Šçš„æ¯ä¸ªListéƒ½å–å‡ºï¼Œç„¶åæŠŠè¿™äº›Liståˆå¹¶åˆ°ä¸€ä¸ªæ–°çš„List,ç„¶åæ ¹æ®å…ƒç´ çš„ä¸ªæ•°åœ¨å‡åŒ€åˆ†é…ç»™æ–°çš„Task; UnionListState:ç›¸æ¯”äºListStateæ›´åŠ çµæ´»ï¼ŒæŠŠåˆ’åˆ†çš„æ–¹å¼äº¤ç»™ç”¨æˆ·å»åšï¼Œå½“æ”¹å˜å¹¶å‘çš„æ—¶å€™ï¼Œä¼šå°†åŸæ¥çš„Listæ‹¼æ¥èµ·æ¥ã€‚ç„¶åä¸åšåˆ’åˆ†ï¼Œç›´æ¥äº¤ç»™ç”¨æˆ·ï¼› BroadcastState:å¦‚å¤§è¡¨å’Œå°è¡¨åšJoinæ—¶ï¼Œå°è¡¨å¯ä»¥ç›´æ¥å¹¿æ’­ç»™å¤§è¡¨çš„åˆ†åŒºï¼Œåœ¨æ¯ä¸ªå¹¶å‘ä¸Šçš„æ•°æ®éƒ½æ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚åšçš„æ›´æ–°ä¹Ÿç›¸åŒï¼Œå½“æ”¹å˜å¹¶å‘çš„æ—¶å€™ï¼ŒæŠŠè¿™äº›æ•°æ®COPYåˆ°æ–°çš„Taskå³å¯ï¼› ä»¥ä¸Šæ˜¯Flink Operator Statesæä¾›çš„3ç§æ‰©å±•æ–¹å¼ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚åšé€‰æ‹©ã€‚ ä½¿ç”¨Checkpointæé«˜ç¨‹åºçš„å¯é æ€§ç”¨æˆ·å¯ä»¥æ ¹æ®çš„ç¨‹åºé‡Œé¢çš„é…ç½®å°†checkpointæ‰“å¼€ï¼Œç»™å®šä¸€ä¸ªæ—¶é—´é—´éš”åï¼Œæ¡†æ¶ä¼šæŒ‰ç…§æ—¶é—´é—´éš”ç»™ç¨‹åºçš„çŠ¶æ€è¿›è¡Œå¤‡ä»½ã€‚å½“å‘ç”Ÿæ•…éšœæ—¶ï¼ŒFlinkä¼šå°†æ‰€æœ‰Taskçš„çŠ¶æ€ä¸€èµ·æ¢å¤åˆ°Checkpointçš„çŠ¶æ€ã€‚ä»å“ªä¸ªä½ç½®å¼€å§‹é‡æ–°æ‰§è¡Œã€‚ Flinkä¹Ÿæä¾›äº†å¤šç§æ­£ç¡®æ€§çš„ä¿éšœï¼ŒåŒ…æ‹¬ï¼š AT LEAST ONCE; Exactly once; å¤‡ä»½ä¸ºä¿å­˜åœ¨Stateä¸­çš„ç¨‹åºçŠ¶æ€æ•°æ® Flinkä¹Ÿæä¾›äº†ä¸€å¥—æœºåˆ¶ï¼Œå…è®¸æŠŠè¿™äº›çŠ¶æ€æ”¾åˆ°å†…å­˜å½“ä¸­ã€‚åšCheckpointçš„æ—¶å€™ï¼Œç”±Flinkå»å®Œæˆæ¢å¤ã€‚ ä»å·²åœæ­¢ä½œä¸šçš„è¿è¡ŒçŠ¶æ€ä¸­æ¢å¤ å½“ç»„ä»¶å‡çº§çš„æ—¶å€™ï¼Œéœ€è¦åœæ­¢å½“å‰ä½œä¸šã€‚è¿™ä¸ªæ—¶å€™éœ€è¦ä»ä¹‹å‰åœæ­¢çš„ä½œä¸šå½“ä¸­æ¢å¤ï¼ŒFlinkæä¾›äº†2ç§æœºåˆ¶æ¢å¤ä½œä¸š: Savepoint:æ˜¯ä¸€ç§ç‰¹æ®Šçš„checkpointï¼Œåªä¸è¿‡ä¸åƒcheckpointå®šæœŸçš„ä»ç³»ç»Ÿä¸­å»è§¦å‘çš„ï¼Œå®ƒæ˜¯ç”¨æˆ·é€šè¿‡å‘½ä»¤è§¦å‘ï¼Œå­˜å‚¨æ ¼å¼å’Œcheckpointä¹Ÿæ˜¯ä¸ç›¸åŒçš„ï¼Œä¼šå°†æ•°æ®æŒ‰ç…§ä¸€ä¸ªæ ‡å‡†çš„æ ¼å¼å­˜å‚¨ï¼Œä¸ç®¡é…ç½®ä»€ä¹ˆæ ·ï¼ŒFlinkéƒ½ä¼šä»è¿™ä¸ªcheckpointæ¢å¤ï¼Œæ˜¯ç”¨æ¥åšç‰ˆæœ¬å‡çº§ä¸€ä¸ªéå¸¸å¥½çš„å·¥å…·ï¼› External Checkpointï¼šå¯¹å·²æœ‰checkpointçš„ä¸€ç§æ‰©å±•ï¼Œå°±æ˜¯è¯´åšå®Œä¸€æ¬¡å†…éƒ¨çš„ä¸€æ¬¡Checkpointåï¼Œè¿˜ä¼šåœ¨ç”¨æˆ·ç»™å®šçš„ä¸€ä¸ªç›®å½•ä¸­ï¼Œå¤šå­˜å‚¨ä¸€ä»½checkpointçš„æ•°æ®ï¼› çŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶å®ç°ä¸‹é¢ä»‹ç»ä¸€ä¸‹çŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶å®ç°æ–¹å¼ï¼ŒFlinkæä¾›äº†3ç§ä¸åŒçš„StateBackend MemoryStateBackend FsStateBackend RockDBStateBackend ç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©ï¼Œå¦‚æœæ•°æ®é‡è¾ƒå°ï¼Œå¯ä»¥å­˜æ”¾åˆ°MemoryStateBackendå’ŒFsStateBackendä¸­ï¼Œå¦‚æœæ•°æ®é‡è¾ƒå¤§ï¼Œå¯ä»¥æ”¾åˆ°RockDBä¸­ã€‚ HeapKeyedStateBackend RockDBKeyedStateBackend Checkpointçš„æ‰§è¡Œæµç¨‹ Checkpointçš„æ‰§è¡Œæµç¨‹æ˜¯æŒ‰ç…§Chandy-Lamportç®—æ³•å®ç°çš„ Checkpoint Barrierçš„å¯¹é½ å…¨é‡Checkpoint å…¨é‡Checkpointä¼šåœ¨æ¯ä¸ªèŠ‚ç‚¹åšå¤‡ä»½æ•°æ®æ—¶ï¼Œåªéœ€è¦å°†æ•°æ®éƒ½ä¾¿åˆ©ä¸€éï¼Œç„¶åå†™åˆ°å¤–éƒ¨å­˜å‚¨ä¸­ï¼Œè¿™ç§æƒ…å†µä¼šå½±å“å¤‡ä»½æ€§èƒ½ã€‚åœ¨æ­¤åŸºç¡€ä¸Šåšäº†ä¼˜åŒ–ã€‚ RockDBçš„å¢é‡Checkpoint RockDBçš„æ•°æ®ä¼šæ›´æ–°åˆ°å†…å­˜ï¼Œå½“å†…å­˜æ»¡æ—¶ï¼Œä¼šå†™å…¥åˆ°ç£ç›˜ä¸­ã€‚å¢é‡çš„æœºåˆ¶ä¼šå°†æ–°äº§ç”Ÿçš„æ–‡ä»¶COPYæŒä¹…åŒ–ä¸­ï¼Œè€Œä¹‹å‰äº§ç”Ÿçš„æ–‡ä»¶å°±ä¸éœ€è¦COPYåˆ°æŒä¹…åŒ–ä¸­å»äº†ã€‚é€šè¿‡è¿™ç§æ–¹å¼å‡å°‘COPYçš„æ•°æ®é‡ï¼Œå¹¶æé«˜æ€§èƒ½ã€‚ é˜¿é‡Œç›¸å…³å·¥ä½œä»‹ç»4.1.Flinkåœ¨é˜¿é‡Œçš„æˆé•¿è·¯çº¿ é˜¿é‡Œæ˜¯ä»2015å¹´å¼€å§‹è°ƒç ”Flink,2015å¹´10æœˆå¯åŠ¨Blinké¡¹ç›®ï¼Œå¹¶å®Œå–„Flinkåœ¨å¤§è§„æ¨¡ç”Ÿäº§ä¸‹çš„ä¸€äº›ä¼˜åŒ–å’Œæ”¹è¿›ã€‚2016å¹´åŒ11é‡‡ç”¨äº†Blinkç³»ç»Ÿï¼Œä¸ºæœç´¢ï¼Œæ¨èï¼Œå¹¿å‘Šä¸šåŠ¡æä¾›æœåŠ¡ã€‚2017å¹´5æœˆBlinkå·²æˆä¸ºé˜¿é‡Œçš„å®æ—¶è®¡ç®—å¼•æ“ã€‚ 4.2.é˜¿é‡Œåœ¨çŠ¶æ€ç®¡ç†å’Œå®¹é”™ç›¸å…³çš„å·¥ä½œ æ­£åœ¨åšçš„å·¥ä½œï¼ŒåŸºäºStateé‡æ„Windowæ–¹é¢çš„ä¸€äº›ä¼˜åŒ–ï¼Œé˜¿é‡Œä¹Ÿæ­£åœ¨å°†åŠŸèƒ½åšå®Œå–„ã€‚åç»­å°†åŒ…æ‹¬asynchronous Checkpointçš„åŠŸèƒ½å®Œå–„ï¼Œå¹¶å’Œç¤¾åŒºè¿›ä¸€æ­¥æ²Ÿé€šå’Œåˆä½œã€‚å¸®åŠ©Flinkç¤¾åŒºå®Œå–„ç›¸å…³æ–¹é¢çš„å·¥ä½œã€‚ æœ€åGitHub Flink å­¦ä¹ ä»£ç åœ°å€ï¼šhttps://github.com/zhisheng17/flink-learning å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ ä¸“æ ä»‹ç»é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€å®æˆ˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯”","date":"2019-06-16T16:00:00.000Z","path":"2019/06/17/flink-vs-storm/","text":"1. èƒŒæ™¯Apache Flink å’Œ Apache Storm æ˜¯å½“å‰ä¸šç•Œå¹¿æ³›ä½¿ç”¨çš„ä¸¤ä¸ªåˆ†å¸ƒå¼å®æ—¶è®¡ç®—æ¡†æ¶ã€‚å…¶ä¸­ Apache Stormï¼ˆä»¥ä¸‹ç®€ç§°â€œStormâ€ï¼‰åœ¨ç¾å›¢ç‚¹è¯„å®æ—¶è®¡ç®—ä¸šåŠ¡ä¸­å·²æœ‰è¾ƒä¸ºæˆç†Ÿçš„è¿ç”¨ï¼ˆå¯å‚è€ƒ Storm çš„å¯é æ€§ä¿è¯æµ‹è¯•ï¼‰ï¼Œæœ‰ç®¡ç†å¹³å°ã€å¸¸ç”¨ API å’Œç›¸åº”çš„æ–‡æ¡£ï¼Œå¤§é‡å®æ—¶ä½œä¸šåŸºäº Storm æ„å»ºã€‚è€Œ Apache Flinkï¼ˆä»¥ä¸‹ç®€ç§°â€œFlinkâ€ï¼‰åœ¨è¿‘æœŸå€å—å…³æ³¨ï¼Œå…·æœ‰é«˜ååã€ä½å»¶è¿Ÿã€é«˜å¯é å’Œç²¾ç¡®è®¡ç®—ç­‰ç‰¹æ€§ï¼Œå¯¹äº‹ä»¶çª—å£æœ‰å¾ˆå¥½çš„æ”¯æŒï¼Œç›®å‰åœ¨ç¾å›¢ç‚¹è¯„å®æ—¶è®¡ç®—ä¸šåŠ¡ä¸­ä¹Ÿå·²æœ‰ä¸€å®šåº”ç”¨ã€‚ æœ¬æ–‡è½¬è½½è‡ªç¾å›¢æŠ€æœ¯å›¢é˜Ÿå…¬ä¼—å·ï¼Œä½œè€…ï¼šæ¢¦ç‘¶ ä¸ºæ·±å…¥ç†Ÿæ‚‰äº†è§£ Flink æ¡†æ¶ï¼ŒéªŒè¯å…¶ç¨³å®šæ€§å’Œå¯é æ€§ï¼Œè¯„ä¼°å…¶å®æ—¶å¤„ç†æ€§èƒ½ï¼Œè¯†åˆ«è¯¥ä½“ç³»ä¸­çš„ç¼ºç‚¹ï¼Œæ‰¾åˆ°å…¶æ€§èƒ½ç“¶é¢ˆå¹¶è¿›è¡Œä¼˜åŒ–ï¼Œç»™ç”¨æˆ·æä¾›æœ€é€‚åˆçš„å®æ—¶è®¡ç®—å¼•æ“ï¼Œæˆ‘ä»¬ä»¥å®è·µç»éªŒä¸°å¯Œçš„ Storm æ¡†æ¶ä½œä¸ºå¯¹ç…§ï¼Œè¿›è¡Œäº†ä¸€ç³»åˆ—å®éªŒæµ‹è¯• Flink æ¡†æ¶çš„æ€§èƒ½ï¼Œè®¡ç®— Flink ä½œä¸ºç¡®ä¿â€œè‡³å°‘ä¸€æ¬¡â€å’Œâ€œæ°å¥½ä¸€æ¬¡â€è¯­ä¹‰çš„å®æ—¶è®¡ç®—æ¡†æ¶æ—¶å¯¹èµ„æºçš„æ¶ˆè€—ï¼Œä¸ºå®æ—¶è®¡ç®—å¹³å°èµ„æºè§„åˆ’ã€æ¡†æ¶é€‰æ‹©ã€æ€§èƒ½è°ƒä¼˜ç­‰å†³ç­–åŠ Flink å¹³å°çš„å»ºè®¾æå‡ºå»ºè®®å¹¶æä¾›æ•°æ®æ”¯æŒï¼Œä¸ºåç»­çš„ SLA å»ºè®¾æä¾›ä¸€å®šå‚è€ƒã€‚ Flink ä¸ Storm ä¸¤ä¸ªæ¡†æ¶å¯¹æ¯”ï¼š 2. æµ‹è¯•ç›®æ ‡è¯„ä¼°ä¸åŒåœºæ™¯ã€ä¸åŒæ•°æ®å‹åŠ›ä¸‹ Flink å’Œ Storm ä¸¤ä¸ªå®æ—¶è®¡ç®—æ¡†æ¶ç›®å‰çš„æ€§èƒ½è¡¨ç°ï¼Œè·å–å…¶è¯¦ç»†æ€§èƒ½æ•°æ®å¹¶æ‰¾åˆ°å¤„ç†æ€§èƒ½çš„æé™ï¼›äº†è§£ä¸åŒé…ç½®å¯¹ Flink æ€§èƒ½å½±å“çš„ç¨‹åº¦ï¼Œåˆ†æå„ç§é…ç½®çš„é€‚ç”¨åœºæ™¯ï¼Œä»è€Œå¾—å‡ºè°ƒä¼˜å»ºè®®ã€‚ 2.1 æµ‹è¯•åœºæ™¯â€œè¾“å…¥-è¾“å‡ºâ€ç®€å•å¤„ç†åœºæ™¯ é€šè¿‡å¯¹â€œè¾“å…¥-è¾“å‡ºâ€è¿™æ ·ç®€å•å¤„ç†é€»è¾‘åœºæ™¯çš„æµ‹è¯•ï¼Œå°½å¯èƒ½å‡å°‘å…¶å®ƒå› ç´ çš„å¹²æ‰°ï¼Œåæ˜ ä¸¤ä¸ªæ¡†æ¶æœ¬èº«çš„æ€§èƒ½ã€‚ åŒæ—¶æµ‹ç®—æ¡†æ¶å¤„ç†èƒ½åŠ›çš„æé™ï¼Œå¤„ç†æ›´åŠ å¤æ‚çš„é€»è¾‘çš„æ€§èƒ½ä¸ä¼šæ¯”çº¯ç²¹â€œè¾“å…¥-è¾“å‡ºâ€æ›´é«˜ã€‚ ç”¨æˆ·ä½œä¸šè€—æ—¶è¾ƒé•¿çš„åœºæ™¯ å¦‚æœç”¨æˆ·çš„å¤„ç†é€»è¾‘è¾ƒä¸ºå¤æ‚ï¼Œæˆ–æ˜¯è®¿é—®äº†æ•°æ®åº“ç­‰å¤–éƒ¨ç»„ä»¶ï¼Œå…¶æ‰§è¡Œæ—¶é—´ä¼šå¢å¤§ï¼Œä½œä¸šçš„æ€§èƒ½ä¼šå—åˆ°å½±å“ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æµ‹è¯•äº†ç”¨æˆ·ä½œä¸šè€—æ—¶è¾ƒé•¿çš„åœºæ™¯ä¸‹ä¸¤ä¸ªæ¡†æ¶çš„è°ƒåº¦æ€§èƒ½ã€‚ çª—å£ç»Ÿè®¡åœºæ™¯ å®æ—¶è®¡ç®—ä¸­å¸¸æœ‰å¯¹æ—¶é—´çª—å£æˆ–è®¡æ•°çª—å£è¿›è¡Œç»Ÿè®¡çš„éœ€æ±‚ï¼Œä¾‹å¦‚ä¸€å¤©ä¸­æ¯äº”åˆ†é’Ÿçš„è®¿é—®é‡ï¼Œæ¯ 100 ä¸ªè®¢å•ä¸­æœ‰å¤šå°‘ä¸ªä½¿ç”¨äº†ä¼˜æƒ ç­‰ã€‚Flink åœ¨çª—å£æ”¯æŒä¸Šçš„åŠŸèƒ½æ¯” Storm æ›´åŠ å¼ºå¤§ï¼ŒAPI æ›´åŠ å®Œå–„ï¼Œä½†æ˜¯æˆ‘ä»¬åŒæ—¶ä¹Ÿæƒ³äº†è§£åœ¨çª—å£ç»Ÿè®¡è¿™ä¸ªå¸¸ç”¨åœºæ™¯ä¸‹ä¸¤ä¸ªæ¡†æ¶çš„æ€§èƒ½ã€‚ ç²¾ç¡®è®¡ç®—åœºæ™¯ï¼ˆå³æ¶ˆæ¯æŠ•é€’è¯­ä¹‰ä¸ºâ€œæ°å¥½ä¸€æ¬¡â€ï¼‰ Storm ä»…èƒ½ä¿è¯â€œè‡³å¤šä¸€æ¬¡â€ (At Most Once) å’Œâ€œè‡³å°‘ä¸€æ¬¡â€ (At Least Once) çš„æ¶ˆæ¯æŠ•é€’è¯­ä¹‰ï¼Œå³å¯èƒ½å­˜åœ¨é‡å¤å‘é€çš„æƒ…å†µã€‚æœ‰å¾ˆå¤šä¸šåŠ¡åœºæ™¯å¯¹æ•°æ®çš„ç²¾ç¡®æ€§è¦æ±‚è¾ƒé«˜ï¼Œå¸Œæœ›æ¶ˆæ¯æŠ•é€’ä¸é‡ä¸æ¼ã€‚Flink æ”¯æŒâ€œæ°å¥½ä¸€æ¬¡â€ (Exactly Once) çš„è¯­ä¹‰ï¼Œä½†æ˜¯åœ¨é™å®šçš„èµ„æºæ¡ä»¶ä¸‹ï¼Œæ›´åŠ ä¸¥æ ¼çš„ç²¾ç¡®åº¦è¦æ±‚å¯èƒ½å¸¦æ¥æ›´é«˜çš„ä»£ä»·ï¼Œä»è€Œå½±å“æ€§èƒ½ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æµ‹è¯•äº†åœ¨ä¸åŒæ¶ˆæ¯æŠ•é€’è¯­ä¹‰ä¸‹ä¸¤ä¸ªæ¡†æ¶çš„æ€§èƒ½ï¼Œå¸Œæœ›ä¸ºç²¾ç¡®è®¡ç®—åœºæ™¯çš„èµ„æºè§„åˆ’æä¾›æ•°æ®å‚è€ƒã€‚ 2.2 æ€§èƒ½æŒ‡æ ‡ååé‡ï¼ˆThroughputï¼‰ å•ä½æ—¶é—´å†…ç”±è®¡ç®—æ¡†æ¶æˆåŠŸåœ°ä¼ é€æ•°æ®çš„æ•°é‡ï¼Œæœ¬æ¬¡æµ‹è¯•ååé‡çš„å•ä½ä¸ºï¼šæ¡/ç§’ã€‚ åæ˜ äº†ç³»ç»Ÿçš„è´Ÿè½½èƒ½åŠ›ï¼Œåœ¨ç›¸åº”çš„èµ„æºæ¡ä»¶ä¸‹ï¼Œå•ä½æ—¶é—´å†…ç³»ç»Ÿèƒ½å¤„ç†å¤šå°‘æ•°æ®ã€‚ * ååé‡å¸¸ç”¨äºèµ„æºè§„åˆ’ï¼ŒåŒæ—¶ä¹Ÿç”¨äºååŠ©åˆ†æç³»ç»Ÿæ€§èƒ½ç“¶é¢ˆï¼Œä»è€Œè¿›è¡Œç›¸åº”çš„èµ„æºè°ƒæ•´ä»¥ä¿è¯ç³»ç»Ÿèƒ½è¾¾åˆ°ç”¨æˆ·æ‰€è¦æ±‚çš„å¤„ç†èƒ½åŠ›ã€‚å‡è®¾å•†å®¶æ¯å°æ—¶èƒ½åšäºŒåä»½åˆé¤ï¼ˆååé‡ 20 ä»½/å°æ—¶ï¼‰ï¼Œä¸€ä¸ªå¤–å–å°å“¥æ¯å°æ—¶åªèƒ½é€ä¸¤ä»½ï¼ˆååé‡ 2 ä»½/å°æ—¶ï¼‰ï¼Œè¿™ä¸ªç³»ç»Ÿçš„ç“¶é¢ˆå°±åœ¨å°å“¥é…é€è¿™ä¸ªç¯èŠ‚ï¼Œå¯ä»¥ç»™è¯¥å•†å®¶å®‰æ’åä¸ªå¤–å–å°å“¥é…é€ã€‚ å»¶è¿Ÿï¼ˆLatencyï¼‰ æ•°æ®ä»è¿›å…¥ç³»ç»Ÿåˆ°æµå‡ºç³»ç»Ÿæ‰€ç”¨çš„æ—¶é—´ï¼Œæœ¬æ¬¡æµ‹è¯•å»¶è¿Ÿçš„å•ä½ä¸ºï¼šæ¯«ç§’ã€‚ åæ˜ äº†ç³»ç»Ÿå¤„ç†çš„å®æ—¶æ€§ã€‚ é‡‘èäº¤æ˜“åˆ†æç­‰å¤§é‡å®æ—¶è®¡ç®—ä¸šåŠ¡å¯¹å»¶è¿Ÿæœ‰è¾ƒé«˜è¦æ±‚ï¼Œå»¶è¿Ÿè¶Šä½ï¼Œæ•°æ®å®æ—¶æ€§è¶Šå¼ºã€‚ å‡è®¾å•†å®¶åšä¸€ä»½åˆé¤éœ€è¦ 5 åˆ†é’Ÿï¼Œå°å“¥é…é€éœ€è¦ 25 åˆ†é’Ÿï¼Œè¿™ä¸ªæµç¨‹ä¸­ç”¨æˆ·æ„Ÿå—åˆ°äº† 30 åˆ†é’Ÿçš„å»¶è¿Ÿã€‚å¦‚æœæ›´æ¢é…é€æ–¹æ¡ˆåå»¶è¿Ÿå˜æˆäº† 60 åˆ†é’Ÿï¼Œç­‰é€åˆ°äº†é¥­èœéƒ½å‡‰äº†ï¼Œè¿™ä¸ªæ–°çš„æ–¹æ¡ˆå°±æ˜¯æ— æ³•æ¥å—çš„ã€‚ 3. æµ‹è¯•ç¯å¢ƒä¸º Storm å’Œ Flink åˆ†åˆ«æ­å»ºç”± 1 å°ä¸»èŠ‚ç‚¹å’Œ 2 å°ä»èŠ‚ç‚¹æ„æˆçš„ Standalone é›†ç¾¤è¿›è¡Œæœ¬æ¬¡æµ‹è¯•ã€‚å…¶ä¸­ä¸ºäº†è§‚å¯Ÿ Flink åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­çš„æ€§èƒ½ï¼Œå¯¹äºéƒ¨åˆ†æµ‹å†…å®¹ä¹Ÿè¿›è¡Œäº† on Yarn ç¯å¢ƒçš„æµ‹è¯•ã€‚ 3.1 é›†ç¾¤å‚æ•° 3.2 æ¡†æ¶å‚æ•° 4. æµ‹è¯•æ–¹æ³•4.1 æµ‹è¯•æµç¨‹ æ•°æ®ç”Ÿäº§ Data Generator æŒ‰ç‰¹å®šé€Ÿç‡ç”Ÿæˆæ•°æ®ï¼Œå¸¦ä¸Šè‡ªå¢çš„ id å’Œ eventTime æ—¶é—´æˆ³å†™å…¥ Kafka çš„ä¸€ä¸ª Topicï¼ˆTopic Dataï¼‰ã€‚ æ•°æ®å¤„ç† Storm Task å’Œ Flink Task ï¼ˆæ¯ä¸ªæµ‹è¯•ç”¨ä¾‹ä¸åŒï¼‰ä» Kafka Topic Data ç›¸åŒçš„ Offset å¼€å§‹æ¶ˆè´¹ï¼Œå¹¶å°†ç»“æœåŠç›¸åº” inTimeã€outTime æ—¶é—´æˆ³åˆ†åˆ«å†™å…¥ä¸¤ä¸ª Topicï¼ˆTopic Storm å’Œ Topic Flinkï¼‰ä¸­ã€‚ æŒ‡æ ‡ç»Ÿè®¡ Metrics Collector æŒ‰ outTime çš„æ—¶é—´çª—å£ä»è¿™ä¸¤ä¸ª Topic ä¸­ç»Ÿè®¡æµ‹è¯•æŒ‡æ ‡ï¼Œæ¯äº”åˆ†é’Ÿå°†ç›¸åº”çš„æŒ‡æ ‡å†™å…¥ MySQL è¡¨ä¸­ã€‚Metrics Collector æŒ‰ outTime å–äº”åˆ†é’Ÿçš„æ»šåŠ¨æ—¶é—´çª—å£ï¼Œè®¡ç®—äº”åˆ†é’Ÿçš„å¹³å‡ååï¼ˆè¾“å‡ºæ•°æ®çš„æ¡æ•°ï¼‰ã€äº”åˆ†é’Ÿå†…çš„å»¶è¿Ÿï¼ˆoutTime - eventTime æˆ– outTime - inTimeï¼‰çš„ä¸­ä½æ•°åŠ 99 çº¿ç­‰æŒ‡æ ‡ï¼Œå†™å…¥ MySQL ç›¸åº”çš„æ•°æ®è¡¨ä¸­ã€‚æœ€åå¯¹ MySQL è¡¨ä¸­çš„ååè®¡ç®—å‡å€¼ï¼Œå»¶è¿Ÿä¸­ä½æ•°åŠå»¶è¿Ÿ 99 çº¿é€‰å–ä¸­ä½æ•°ï¼Œç»˜åˆ¶å›¾åƒå¹¶åˆ†æã€‚ 4.2 é»˜è®¤å‚æ•° Storm å’Œ Flink é»˜è®¤å‡ä¸º At Least Once è¯­ä¹‰ã€‚ Storm å¼€å¯ ACKï¼ŒACKer æ•°é‡ä¸º 1ã€‚ Flink çš„ Checkpoint æ—¶é—´é—´éš”ä¸º 30 ç§’ï¼Œé»˜è®¤ StateBackend ä¸º Memoryã€‚ ä¿è¯ Kafka ä¸æ˜¯æ€§èƒ½ç“¶é¢ˆï¼Œå°½å¯èƒ½æ’é™¤ Kafka å¯¹æµ‹è¯•ç»“æœçš„å½±å“ã€‚ æµ‹è¯•å»¶è¿Ÿæ—¶æ•°æ®ç”Ÿäº§é€Ÿç‡å°äºæ•°æ®å¤„ç†èƒ½åŠ›ï¼Œå‡è®¾æ•°æ®è¢«å†™å…¥ Kafka åç«‹åˆ»è¢«è¯»å–ï¼Œå³ eventTime ç­‰äºæ•°æ®è¿›å…¥ç³»ç»Ÿçš„æ—¶é—´ã€‚ æµ‹è¯•ååé‡æ—¶ä» Kafka Topic çš„æœ€æ—§å¼€å§‹è¯»å–ï¼Œå‡è®¾è¯¥ Topic ä¸­çš„æµ‹è¯•æ•°æ®é‡å……è¶³ã€‚ 4.3 æµ‹è¯•ç”¨ä¾‹Identity Identity ç”¨ä¾‹ä¸»è¦æ¨¡æ‹Ÿâ€œè¾“å…¥-è¾“å‡ºâ€ç®€å•å¤„ç†åœºæ™¯ï¼Œåæ˜ ä¸¤ä¸ªæ¡†æ¶æœ¬èº«çš„æ€§èƒ½ã€‚ è¾“å…¥æ•°æ®ä¸ºâ€œmsgId, eventTimeâ€ï¼Œå…¶ä¸­ eventTime è§†ä¸ºæ•°æ®ç”Ÿæˆæ—¶é—´ã€‚å•æ¡è¾“å…¥æ•°æ®çº¦ 20 Bã€‚ è¿›å…¥ä½œä¸šå¤„ç†æµç¨‹æ—¶è®°å½• inTimeï¼Œä½œä¸šå¤„ç†å®Œæˆåï¼ˆå‡†å¤‡è¾“å‡ºæ—¶ï¼‰è®°å½• outTimeã€‚ ä½œä¸šä» Kafka Topic Data ä¸­è¯»å–æ•°æ®åï¼Œåœ¨å­—ç¬¦ä¸²æœ«å°¾è¿½åŠ æ—¶é—´æˆ³ï¼Œç„¶åç›´æ¥è¾“å‡ºåˆ° Kafkaã€‚ è¾“å‡ºæ•°æ®ä¸ºâ€œmsgId, eventTime, inTime, outTimeâ€ã€‚å•æ¡è¾“å‡ºæ•°æ®çº¦ 50 Bã€‚ Sleep Sleep ç”¨ä¾‹ä¸»è¦æ¨¡æ‹Ÿç”¨æˆ·ä½œä¸šè€—æ—¶è¾ƒé•¿çš„åœºæ™¯ï¼Œåæ˜ å¤æ‚ç”¨æˆ·é€»è¾‘å¯¹æ¡†æ¶å·®å¼‚çš„å‰Šå¼±ï¼Œæ¯”è¾ƒä¸¤ä¸ªæ¡†æ¶çš„è°ƒåº¦æ€§èƒ½ã€‚ è¾“å…¥æ•°æ®å’Œè¾“å‡ºæ•°æ®å‡ä¸ Identity ç›¸åŒã€‚ è¯»å…¥æ•°æ®åï¼Œç­‰å¾…ä¸€å®šæ—¶é•¿ï¼ˆ1 msï¼‰ååœ¨å­—ç¬¦ä¸²æœ«å°¾è¿½åŠ æ—¶é—´æˆ³åè¾“å‡º Windowed Word Count Windowed Word Count ç”¨ä¾‹ä¸»è¦æ¨¡æ‹Ÿçª—å£ç»Ÿè®¡åœºæ™¯ï¼Œåæ˜ ä¸¤ä¸ªæ¡†æ¶åœ¨è¿›è¡Œçª—å£ç»Ÿè®¡æ—¶æ€§èƒ½çš„å·®å¼‚ã€‚ æ­¤å¤–ï¼Œè¿˜ç”¨å…¶è¿›è¡Œäº†ç²¾ç¡®è®¡ç®—åœºæ™¯çš„æµ‹è¯•ï¼Œåæ˜  Flink æ°å¥½ä¸€æ¬¡æŠ•é€’çš„æ€§èƒ½ã€‚ è¾“å…¥ä¸º JSON æ ¼å¼ï¼ŒåŒ…å« msgIdã€eventTime å’Œä¸€ä¸ªç”±è‹¥å¹²å•è¯ç»„æˆçš„å¥å­ï¼Œå•è¯ä¹‹é—´ç”±ç©ºæ ¼åˆ†éš”ã€‚å•æ¡è¾“å…¥æ•°æ®çº¦ 150 Bã€‚ è¯»å…¥æ•°æ®åè§£æ JSONï¼Œç„¶åå°†å¥å­åˆ†å‰²ä¸ºç›¸åº”å•è¯ï¼Œå¸¦ eventTime å’Œ inTime æ—¶é—´æˆ³å‘ç»™ CountWindow è¿›è¡Œå•è¯è®¡æ•°ï¼ŒåŒæ—¶è®°å½•ä¸€ä¸ªçª—å£ä¸­æœ€å¤§æœ€å°çš„ eventTime å’Œ inTimeï¼Œæœ€åå¸¦ outTime æ—¶é—´æˆ³è¾“å‡ºåˆ° Kafka ç›¸åº”çš„ Topicã€‚ Spout/Source åŠ OutputBolt/Output/Sink å¹¶å‘åº¦æ’ä¸º 1ï¼Œå¢å¤§å¹¶å‘åº¦æ—¶ä»…å¢å¤§ JSONParserã€CountWindow çš„å¹¶å‘åº¦ã€‚ ç”±äº Storm å¯¹ window çš„æ”¯æŒè¾ƒå¼±ï¼ŒCountWindow ä½¿ç”¨ä¸€ä¸ª HashMap æ‰‹åŠ¨å®ç°ï¼ŒFlink ç”¨äº†åŸç”Ÿçš„ CountWindow å’Œç›¸åº”çš„ Reduce å‡½æ•°ã€‚ 5. æµ‹è¯•ç»“æœ5.1 Identity å•çº¿ç¨‹ååé‡ ä¸Šå›¾ä¸­è“è‰²æŸ±å½¢ä¸ºå•çº¿ç¨‹ Storm ä½œä¸šçš„ååï¼Œæ©™è‰²æŸ±å½¢ä¸ºå•çº¿ç¨‹ Flink ä½œä¸šçš„ååã€‚ Identity é€»è¾‘ä¸‹ï¼ŒStorm å•çº¿ç¨‹ååä¸º 8.7 ä¸‡æ¡/ç§’ï¼ŒFlink å•çº¿ç¨‹ååå¯è¾¾ 35 ä¸‡æ¡/ç§’ã€‚ å½“ Kafka Data çš„ Partition æ•°ä¸º 1 æ—¶ï¼ŒFlink çš„ååçº¦ä¸º Storm çš„ 3.2 å€ï¼›å½“å…¶ Partition æ•°ä¸º 8 æ—¶ï¼ŒFlink çš„ååçº¦ä¸º Storm çš„ 4.6 å€ã€‚ ç”±æ­¤å¯ä»¥çœ‹å‡ºï¼ŒFlink ååçº¦ä¸º Storm çš„ 3-5 å€ã€‚ 5.2 Identity å•çº¿ç¨‹ä½œä¸šå»¶è¿Ÿ é‡‡ç”¨ outTime - eventTime ä½œä¸ºå»¶è¿Ÿï¼Œå›¾ä¸­è“è‰²æŠ˜çº¿ä¸º Stormï¼Œæ©™è‰²æŠ˜çº¿ä¸º Flinkã€‚è™šçº¿ä¸º 99 çº¿ï¼Œå®çº¿ä¸ºä¸­ä½æ•°ã€‚ ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºéšç€æ•°æ®é‡é€æ¸å¢å¤§ï¼ŒIdentity çš„å»¶è¿Ÿé€æ¸å¢å¤§ã€‚å…¶ä¸­ 99 çº¿çš„å¢å¤§é€Ÿåº¦æ¯”ä¸­ä½æ•°å¿«ï¼ŒStorm çš„ å¢å¤§é€Ÿåº¦æ¯” Flink å¿«ã€‚ å…¶ä¸­ QPS åœ¨ 80000 ä»¥ä¸Šçš„æµ‹è¯•æ•°æ®è¶…è¿‡äº† Storm å•çº¿ç¨‹çš„ååèƒ½åŠ›ï¼Œæ— æ³•å¯¹ Storm è¿›è¡Œæµ‹è¯•ï¼Œåªæœ‰ Flink çš„æ›²çº¿ã€‚ å¯¹æ¯”æŠ˜çº¿æœ€å³ç«¯çš„æ•°æ®å¯ä»¥çœ‹å‡ºï¼ŒStorm QPS æ¥è¿‘ååæ—¶å»¶è¿Ÿä¸­ä½æ•°çº¦ 100 æ¯«ç§’ï¼Œ99 çº¿çº¦ 700 æ¯«ç§’ï¼ŒFlink ä¸­ä½æ•°çº¦ 50 æ¯«ç§’ï¼Œ99 çº¿çº¦ 300 æ¯«ç§’ã€‚Flink åœ¨æ»¡ååæ—¶çš„å»¶è¿Ÿçº¦ä¸º Storm çš„ä¸€åŠã€‚ 5.3 Sleep ååé‡ ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼ŒSleep 1 æ¯«ç§’æ—¶ï¼ŒStorm å’Œ Flink å•çº¿ç¨‹çš„ååå‡åœ¨ 900 æ¡/ç§’å·¦å³ï¼Œä¸”éšç€å¹¶å‘å¢å¤§åŸºæœ¬å‘ˆçº¿æ€§å¢å¤§ã€‚ å¯¹æ¯”è“è‰²å’Œæ©™è‰²çš„æŸ±å½¢å¯ä»¥å‘ç°ï¼Œæ­¤æ—¶ä¸¤ä¸ªæ¡†æ¶çš„ååèƒ½åŠ›åŸºæœ¬ä¸€è‡´ã€‚ 5.4 Sleep å•çº¿ç¨‹ä½œä¸šå»¶è¿Ÿï¼ˆä¸­ä½æ•°ï¼‰ ä¾ç„¶é‡‡ç”¨ outTime - eventTime ä½œä¸ºå»¶è¿Ÿï¼Œä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼ŒSleep 1 æ¯«ç§’æ—¶ï¼ŒFlink çš„å»¶è¿Ÿä»ä½äº Stormã€‚ 5.5 Windowed Word Count å•çº¿ç¨‹ååé‡ å•çº¿ç¨‹æ‰§è¡Œå¤§å°ä¸º 10 çš„è®¡æ•°çª—å£ï¼Œååé‡ç»Ÿè®¡å¦‚å›¾ã€‚ ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼ŒStorm ååçº¦ä¸º 1.2 ä¸‡æ¡/ç§’ï¼ŒFlink Standalone çº¦ä¸º 4.3 ä¸‡æ¡/ç§’ã€‚Flink ååä¾ç„¶ä¸º Storm çš„ 3 å€ä»¥ä¸Šã€‚ 5.6 Windowed Word Count Flink At Least Once ä¸ Exactly Once ååé‡å¯¹æ¯” ç”±äºåŒä¸€ç®—å­çš„å¤šä¸ªå¹¶è¡Œä»»åŠ¡å¤„ç†é€Ÿåº¦å¯èƒ½ä¸åŒï¼Œåœ¨ä¸Šæ¸¸ç®—å­ä¸­ä¸åŒå¿«ç…§é‡Œçš„å†…å®¹ï¼Œç»è¿‡ä¸­é—´å¹¶è¡Œç®—å­çš„å¤„ç†ï¼Œåˆ°è¾¾ä¸‹æ¸¸ç®—å­æ—¶å¯èƒ½è¢«è®¡å…¥åŒä¸€ä¸ªå¿«ç…§ä¸­ã€‚è¿™æ ·ä¸€æ¥ï¼Œè¿™éƒ¨åˆ†æ•°æ®ä¼šè¢«é‡å¤å¤„ç†ã€‚å› æ­¤ï¼ŒFlink åœ¨ Exactly Once è¯­ä¹‰ä¸‹éœ€è¦è¿›è¡Œå¯¹é½ï¼Œå³å½“å‰æœ€æ—©çš„å¿«ç…§ä¸­æ‰€æœ‰æ•°æ®å¤„ç†å®Œä¹‹å‰ï¼Œå±äºä¸‹ä¸€ä¸ªå¿«ç…§çš„æ•°æ®ä¸è¿›è¡Œå¤„ç†ï¼Œè€Œæ˜¯åœ¨ç¼“å­˜åŒºç­‰å¾…ã€‚å½“å‰æµ‹è¯•ç”¨ä¾‹ä¸­ï¼Œåœ¨ JSON Parser å’Œ CountWindowã€CountWindow å’Œ Output ä¹‹é—´å‡éœ€è¦è¿›è¡Œå¯¹é½ï¼Œæœ‰ä¸€å®šæ¶ˆè€—ã€‚ä¸ºä½“ç°å‡ºå¯¹é½åœºæ™¯ï¼ŒSource/Output/Sink å¹¶å‘åº¦çš„å¹¶å‘åº¦ä»ä¸º 1ï¼Œæé«˜äº† JSONParser/CountWindow çš„å¹¶å‘åº¦ã€‚å…·ä½“æµç¨‹ç»†èŠ‚å‚è§å‰æ–‡ Windowed Word Count æµç¨‹å›¾ã€‚ ä¸Šå›¾ä¸­æ©™è‰²æŸ±å½¢ä¸º At Least Once çš„ååé‡ï¼Œé»„è‰²æŸ±å½¢ä¸º Exactly Once çš„ååé‡ã€‚å¯¹æ¯”ä¸¤è€…å¯ä»¥çœ‹å‡ºï¼Œåœ¨å½“å‰å¹¶å‘æ¡ä»¶ä¸‹ï¼ŒExactly Once çš„ååè¾ƒ At Least Once è€Œè¨€ä¸‹é™äº† 6.3% 5.7 Windowed Word Count Storm At Least Once ä¸ At Most Once ååé‡å¯¹æ¯” Storm å°† ACKer æ•°é‡è®¾ç½®ä¸ºé›¶åï¼Œæ¯æ¡æ¶ˆæ¯åœ¨å‘é€æ—¶å°±è‡ªåŠ¨ ACKï¼Œä¸å†ç­‰å¾… Bolt çš„ ACKï¼Œä¹Ÿä¸å†é‡å‘æ¶ˆæ¯ï¼Œä¸º At Most Once è¯­ä¹‰ã€‚ ä¸Šå›¾ä¸­è“è‰²æŸ±å½¢ä¸º At Least Once çš„ååé‡ï¼Œæµ…è“è‰²æŸ±å½¢ä¸º At Most Once çš„ååé‡ã€‚å¯¹æ¯”ä¸¤è€…å¯ä»¥çœ‹å‡ºï¼Œåœ¨å½“å‰å¹¶å‘æ¡ä»¶ä¸‹ï¼ŒAt Most Once è¯­ä¹‰ä¸‹çš„ååè¾ƒ At Least Once è€Œè¨€æé«˜äº† 16.8% 5.8 Windowed Word Count å•çº¿ç¨‹ä½œä¸šå»¶è¿Ÿ Identity å’Œ Sleep è§‚æµ‹çš„éƒ½æ˜¯ outTime - eventTimeï¼Œå› ä¸ºä½œä¸šå¤„ç†æ—¶é—´è¾ƒçŸ­æˆ– Thread.sleep() ç²¾åº¦ä¸é«˜ï¼ŒoutTime - inTime ä¸ºé›¶æˆ–æ²¡æœ‰æ¯”è¾ƒæ„ä¹‰ï¼›Windowed Word Count ä¸­å¯ä»¥æœ‰æ•ˆæµ‹å¾— outTime - inTime çš„æ•°å€¼ï¼Œå°†å…¶ä¸ outTime - eventTime ç”»åœ¨åŒä¸€å¼ å›¾ä¸Šï¼Œå…¶ä¸­ outTime - eventTime ä¸ºè™šçº¿ï¼ŒoutTime - InTime ä¸ºå®çº¿ã€‚ è§‚å¯Ÿæ©™è‰²çš„ä¸¤æ¡æŠ˜çº¿å¯ä»¥å‘ç°ï¼ŒFlink ç”¨ä¸¤ç§æ–¹å¼ç»Ÿè®¡çš„å»¶è¿Ÿéƒ½ç»´æŒåœ¨è¾ƒä½æ°´å¹³ï¼›è§‚å¯Ÿä¸¤æ¡è“è‰²çš„æ›²çº¿å¯ä»¥å‘ç°ï¼ŒStorm çš„ outTime - inTime è¾ƒä½ï¼ŒoutTime - eventTime ä¸€ç›´è¾ƒé«˜ï¼Œå³ inTime å’Œ eventTime ä¹‹é—´çš„å·®å€¼ä¸€ç›´è¾ƒå¤§ï¼Œå¯èƒ½ä¸ Storm å’Œ Flink çš„æ•°æ®è¯»å…¥æ–¹å¼æœ‰å…³ã€‚ è“è‰²æŠ˜çº¿è¡¨æ˜ Storm çš„å»¶è¿Ÿéšæ•°æ®é‡çš„å¢å¤§è€Œå¢å¤§ï¼Œè€Œæ©™è‰²æŠ˜çº¿è¡¨æ˜ Flink çš„å»¶è¿Ÿéšç€æ•°æ®é‡çš„å¢å¤§è€Œå‡å°ï¼ˆæ­¤å¤„æœªæµ‹è‡³ Flink ååé‡ï¼Œæ¥è¿‘ååæ—¶ Flink å»¶è¿Ÿä¾ç„¶ä¼šä¸Šå‡ï¼‰ã€‚ å³ä½¿ä»…å…³æ³¨ outTime - inTimeï¼ˆå³å›¾ä¸­å®çº¿éƒ¨åˆ†ï¼‰ï¼Œä¾ç„¶å¯ä»¥å‘ç°ï¼Œå½“ QPS é€æ¸å¢å¤§çš„æ—¶å€™ï¼ŒFlink åœ¨å»¶è¿Ÿä¸Šçš„ä¼˜åŠ¿å¼€å§‹ä½“ç°å‡ºæ¥ã€‚ 5.9 Windowed Word Count Flink At Least Once ä¸ Exactly Once å»¶è¿Ÿå¯¹æ¯” å›¾ä¸­é»„è‰²ä¸º 99 çº¿ï¼Œæ©™è‰²ä¸ºä¸­ä½æ•°ï¼Œè™šçº¿ä¸º At Least Onceï¼Œå®çº¿ä¸º Exactly Onceã€‚å›¾ä¸­ç›¸åº”é¢œè‰²çš„è™šå®æ›²çº¿éƒ½åŸºæœ¬é‡åˆï¼Œå¯ä»¥çœ‹å‡º Flink Exactly Once çš„å»¶è¿Ÿä¸­ä½æ•°æ›²çº¿ä¸ At Least Once åŸºæœ¬è´´åˆï¼Œåœ¨å»¶è¿Ÿä¸Šæ€§èƒ½æ²¡æœ‰å¤ªå¤§å·®å¼‚ã€‚ 5.10 Windowed Word Count Storm At Least Once ä¸ At Most Once å»¶è¿Ÿå¯¹æ¯” å›¾ä¸­è“è‰²ä¸º 99 çº¿ï¼Œæµ…è“è‰²ä¸ºä¸­ä½æ•°ï¼Œè™šçº¿ä¸º At Least Onceï¼Œå®çº¿ä¸º At Most Onceã€‚QPS åœ¨ 4000 åŠä»¥å‰çš„æ—¶å€™ï¼Œè™šçº¿å®çº¿åŸºæœ¬é‡åˆï¼›QPS åœ¨ 6000 æ—¶ä¸¤è€…å·²æœ‰å·®å¼‚ï¼Œè™šçº¿ç•¥é«˜ï¼›QPS æ¥è¿‘ 8000 æ—¶ï¼Œå·²è¶…è¿‡ At Least Once è¯­ä¹‰ä¸‹ Storm çš„ååï¼Œå› æ­¤åªæœ‰å®çº¿ä¸Šçš„ç‚¹ã€‚ å¯ä»¥çœ‹å‡ºï¼ŒQPS è¾ƒä½æ—¶ Storm At Most Once ä¸ At Least Once çš„å»¶è¿Ÿè§‚å¯Ÿä¸åˆ°å·®å¼‚ï¼Œéšç€ QPS å¢å¤§å·®å¼‚å¼€å§‹å¢å¤§ï¼ŒAt Most Once çš„å»¶è¿Ÿè¾ƒä½ã€‚ 5.11 Windowed Word Count Flink ä¸åŒ StateBackends ååé‡å¯¹æ¯” Flink æ”¯æŒ Standalone å’Œ on Yarn çš„é›†ç¾¤éƒ¨ç½²æ¨¡å¼ï¼ŒåŒæ—¶æ”¯æŒ Memoryã€FileSystemã€RocksDB ä¸‰ç§çŠ¶æ€å­˜å‚¨åç«¯ï¼ˆStateBackendsï¼‰ã€‚ç”±äºçº¿ä¸Šä½œä¸šéœ€è¦ï¼Œæµ‹è¯•äº†è¿™ä¸‰ç§ StateBackends åœ¨ä¸¤ç§é›†ç¾¤éƒ¨ç½²æ¨¡å¼ä¸Šçš„æ€§èƒ½å·®å¼‚ã€‚å…¶ä¸­ï¼ŒStandalone æ—¶çš„å­˜å‚¨è·¯å¾„ä¸º JobManager ä¸Šçš„ä¸€ä¸ªæ–‡ä»¶ç›®å½•ï¼Œon Yarn æ—¶å­˜å‚¨è·¯å¾„ä¸º HDFS ä¸Šä¸€ä¸ªæ–‡ä»¶ç›®å½•ã€‚ å¯¹æ¯”ä¸‰ç»„æŸ±å½¢å¯ä»¥å‘ç°ï¼Œä½¿ç”¨ FileSystem å’Œ Memory çš„ååå·®å¼‚ä¸å¤§ï¼Œä½¿ç”¨ RocksDB çš„ååä»…å…¶ä½™ä¸¤è€…çš„ååˆ†ä¹‹ä¸€å·¦å³ã€‚ å¯¹æ¯”ä¸¤ç§é¢œè‰²å¯ä»¥å‘ç°ï¼ŒStandalone å’Œ on Yarn çš„æ€»ä½“å·®å¼‚ä¸å¤§ï¼Œä½¿ç”¨ FileSystem å’Œ Memory æ—¶ on Yarn æ¨¡å¼ä¸‹ååç¨é«˜ï¼Œä½¿ç”¨ RocksDB æ—¶ Standalone æ¨¡å¼ä¸‹çš„ååç¨é«˜ã€‚ 5.12 Windowed Word Count Flink ä¸åŒ StateBackends å»¶è¿Ÿå¯¹æ¯” ä½¿ç”¨ FileSystem å’Œ Memory ä½œä¸º Backends æ—¶ï¼Œå»¶è¿ŸåŸºæœ¬ä¸€è‡´ä¸”è¾ƒä½ã€‚ ä½¿ç”¨ RocksDB ä½œä¸º Backends æ—¶ï¼Œå»¶è¿Ÿç¨é«˜ï¼Œä¸”ç”±äºååè¾ƒä½ï¼Œåœ¨è¾¾åˆ°ååç“¶é¢ˆå‰çš„å»¶è¿Ÿé™¡å¢ã€‚å…¶ä¸­ on Yarn æ¨¡å¼ä¸‹ååæ›´ä½ï¼Œæ¥è¿‘ååæ—¶çš„å»¶è¿Ÿæ›´é«˜ã€‚ 6. ç»“è®ºåŠå»ºè®®6.1 æ¡†æ¶æœ¬èº«æ€§èƒ½ ç”± 5.1ã€5.5 çš„æµ‹è¯•ç»“æœå¯ä»¥çœ‹å‡ºï¼ŒStorm å•çº¿ç¨‹ååçº¦ä¸º 8.7 ä¸‡æ¡/ç§’ï¼ŒFlink å•çº¿ç¨‹ååå¯è¾¾ 35 ä¸‡æ¡/ç§’ã€‚Flink ååçº¦ä¸º Storm çš„ 3-5 å€ã€‚ ç”± 5.2ã€5.8 çš„æµ‹è¯•ç»“æœå¯ä»¥çœ‹å‡ºï¼ŒStorm QPS æ¥è¿‘ååæ—¶å»¶è¿Ÿï¼ˆå« Kafka è¯»å†™æ—¶é—´ï¼‰ä¸­ä½æ•°çº¦ 100 æ¯«ç§’ï¼Œ99 çº¿çº¦ 700 æ¯«ç§’ï¼ŒFlink ä¸­ä½æ•°çº¦ 50 æ¯«ç§’ï¼Œ99 çº¿çº¦ 300 æ¯«ç§’ã€‚Flink åœ¨æ»¡ååæ—¶çš„å»¶è¿Ÿçº¦ä¸º Storm çš„ä¸€åŠï¼Œä¸”éšç€ QPS é€æ¸å¢å¤§ï¼ŒFlink åœ¨å»¶è¿Ÿä¸Šçš„ä¼˜åŠ¿å¼€å§‹ä½“ç°å‡ºæ¥ã€‚ ç»¼ä¸Šå¯å¾—ï¼ŒFlink æ¡†æ¶æœ¬èº«æ€§èƒ½ä¼˜äº Stormã€‚ 6.2 å¤æ‚ç”¨æˆ·é€»è¾‘å¯¹æ¡†æ¶å·®å¼‚çš„å‰Šå¼±å¯¹æ¯” 5.1 å’Œ 5.3ã€5.2 å’Œ 5.4 çš„æµ‹è¯•ç»“æœå¯ä»¥å‘ç°ï¼Œå•ä¸ª Bolt Sleep æ—¶é•¿è¾¾åˆ° 1 æ¯«ç§’æ—¶ï¼ŒFlink çš„å»¶è¿Ÿä»ä½äº Stormï¼Œä½†ååä¼˜åŠ¿å·²åŸºæœ¬æ— æ³•ä½“ç°ã€‚ å› æ­¤ï¼Œç”¨æˆ·é€»è¾‘è¶Šå¤æ‚ï¼Œæœ¬èº«è€—æ—¶è¶Šé•¿ï¼Œé’ˆå¯¹è¯¥é€»è¾‘çš„æµ‹è¯•ä½“ç°å‡ºæ¥çš„æ¡†æ¶çš„å·®å¼‚è¶Šå°ã€‚ 6.3 ä¸åŒæ¶ˆæ¯æŠ•é€’è¯­ä¹‰çš„å·®å¼‚ ç”± 5.6ã€5.7ã€5.9ã€5.10 çš„æµ‹è¯•ç»“æœå¯ä»¥çœ‹å‡ºï¼ŒFlink Exactly Once çš„ååè¾ƒ At Least Once è€Œè¨€ä¸‹é™ 6.3%ï¼Œå»¶è¿Ÿå·®å¼‚ä¸å¤§ï¼›Storm At Most Once è¯­ä¹‰ä¸‹çš„ååè¾ƒ At Least Once æå‡ 16.8%ï¼Œå»¶è¿Ÿç¨æœ‰ä¸‹é™ã€‚ ç”±äº Storm ä¼šå¯¹æ¯æ¡æ¶ˆæ¯è¿›è¡Œ ACKï¼ŒFlink æ˜¯åŸºäºä¸€æ‰¹æ¶ˆæ¯åšçš„æ£€æŸ¥ç‚¹ï¼Œä¸åŒçš„å®ç°åŸç†å¯¼è‡´ä¸¤è€…åœ¨ At Least Once è¯­ä¹‰çš„èŠ±è´¹å·®å¼‚è¾ƒå¤§ï¼Œä»è€Œå½±å“äº†æ€§èƒ½ã€‚è€Œ Flink å®ç° Exactly Once è¯­ä¹‰ä»…å¢åŠ äº†å¯¹é½æ“ä½œï¼Œå› æ­¤åœ¨ç®—å­å¹¶å‘é‡ä¸å¤§ã€æ²¡æœ‰å‡ºç°æ…¢èŠ‚ç‚¹çš„æƒ…å†µä¸‹å¯¹ Flink æ€§èƒ½çš„å½±å“ä¸å¤§ã€‚Storm At Most Once è¯­ä¹‰ä¸‹çš„æ€§èƒ½ä»ç„¶ä½äº Flinkã€‚ 6.4 Flink çŠ¶æ€å­˜å‚¨åç«¯é€‰æ‹©Flink æä¾›äº†å†…å­˜ã€æ–‡ä»¶ç³»ç»Ÿã€RocksDB ä¸‰ç§ StateBackendsï¼Œç»“åˆ 5.11ã€5.12 çš„æµ‹è¯•ç»“æœï¼Œä¸‰è€…çš„å¯¹æ¯”å¦‚ä¸‹ï¼š 6.5 æ¨èä½¿ç”¨ Flink çš„åœºæ™¯ç»¼åˆä¸Šè¿°æµ‹è¯•ç»“æœï¼Œä»¥ä¸‹å®æ—¶è®¡ç®—åœºæ™¯å»ºè®®è€ƒè™‘ä½¿ç”¨ Flink æ¡†æ¶è¿›è¡Œè®¡ç®—ï¼š + è¦æ±‚æ¶ˆæ¯æŠ•é€’è¯­ä¹‰ä¸º Exactly Once çš„åœºæ™¯ï¼› + æ•°æ®é‡è¾ƒå¤§ï¼Œè¦æ±‚é«˜ååä½å»¶è¿Ÿçš„åœºæ™¯ï¼› + éœ€è¦è¿›è¡ŒçŠ¶æ€ç®¡ç†æˆ–çª—å£ç»Ÿè®¡çš„åœºæ™¯ã€‚ 7. å±•æœ› æœ¬æ¬¡æµ‹è¯•ä¸­å°šæœ‰ä¸€äº›å†…å®¹æ²¡æœ‰è¿›è¡Œæ›´åŠ æ·±å…¥çš„æµ‹è¯•ï¼Œæœ‰å¾…åç»­æµ‹è¯•è¡¥å……ã€‚ä¾‹å¦‚ï¼š Exactly Once åœ¨å¹¶å‘é‡å¢å¤§çš„æ—¶å€™æ˜¯å¦ååä¼šæ˜æ˜¾ä¸‹é™ï¼Ÿ ç”¨æˆ·è€—æ—¶åˆ° 1ms æ—¶æ¡†æ¶çš„å·®å¼‚å·²ç»ä¸å†æ˜æ˜¾ï¼ˆThread.sleep() çš„ç²¾åº¦åªèƒ½åˆ°æ¯«ç§’ï¼‰ï¼Œç”¨æˆ·è€—æ—¶åœ¨ä»€ä¹ˆèŒƒå›´å†… Flink çš„ä¼˜åŠ¿ä¾ç„¶èƒ½ä½“ç°å‡ºæ¥ï¼Ÿ æœ¬æ¬¡æµ‹è¯•ä»…è§‚å¯Ÿäº†ååé‡å’Œå»¶è¿Ÿä¸¤é¡¹æŒ‡æ ‡ï¼Œå¯¹äºç³»ç»Ÿçš„å¯é æ€§ã€å¯æ‰©å±•æ€§ç­‰é‡è¦çš„æ€§èƒ½æŒ‡æ ‡æ²¡æœ‰åœ¨ç»Ÿè®¡æ•°æ®å±‚é¢è¿›è¡Œå…³æ³¨ï¼Œæœ‰å¾…åç»­è¡¥å……ã€‚ Flink ä½¿ç”¨ RocksDBStateBackend æ—¶çš„ååè¾ƒä½ï¼Œæœ‰å¾…è¿›ä¸€æ­¥æ¢ç´¢å’Œä¼˜åŒ–ã€‚ å…³äº Flink çš„æ›´é«˜çº§ APIï¼Œå¦‚ Table API &amp; SQL åŠ CEP ç­‰ï¼Œéœ€è¦è¿›ä¸€æ­¥äº†è§£å’Œå®Œå–„ã€‚ 8. å‚è€ƒå†…å®¹ åˆ†å¸ƒå¼æµå¤„ç†æ¡†æ¶â€”â€”åŠŸèƒ½å¯¹æ¯”å’Œæ€§èƒ½è¯„ä¼°. intel-hadoop/HiBench: HiBench is a big data benchmark suite. Yahooçš„æµè®¡ç®—å¼•æ“åŸºå‡†æµ‹è¯•. Extending the Yahoo! Streaming Benchmark. æœ€åGitHub Flink å­¦ä¹ ä»£ç åœ°å€ï¼šhttps://github.com/zhisheng17/flink-learning å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€åŸç†ã€å®æˆ˜ã€æ€§èƒ½è°ƒä¼˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“","date":"2019-06-15T16:00:00.000Z","path":"2019/06/16/flink-sql-oppo/","text":"ä¸€.OPPO å®æ—¶æ•°ä»“çš„æ¼”è¿›æ€è·¯ æœ¬æ–‡è½¬è½½è‡ª AI å‰çº¿å…¬ä¼—å·ï¼Œä½œè€…å¼ ä¿Šï¼Œç¼–è¾‘ | Vincent æœ¬æ–‡æ•´ç†è‡ª 2019 å¹´ 4 æœˆ 13 æ—¥åœ¨æ·±åœ³ä¸¾è¡Œçš„ Flink Meetup ä¼šè®®ï¼Œåˆ†äº«å˜‰å®¾å¼ ä¿Šï¼Œç›®å‰æ‹…ä»» OPPO å¤§æ•°æ®å¹³å°ç ”å‘è´Ÿè´£äººï¼Œä¹Ÿæ˜¯ Apache Flink contributorã€‚æœ¬æ–‡ä¸»è¦å†…å®¹å¦‚ä¸‹ï¼š OPPO å®æ—¶æ•°ä»“çš„æ¼”è¿›æ€è·¯ï¼› åŸºäº Flink SQL çš„æ‰©å±•å·¥ä½œï¼› æ„å»ºå®æ—¶æ•°ä»“çš„åº”ç”¨æ¡ˆä¾‹ï¼› æœªæ¥å·¥ä½œçš„æ€è€ƒå’Œå±•æœ›ã€‚ 1.1.OPPO ä¸šåŠ¡ä¸æ•°æ®è§„æ¨¡å¤§å®¶éƒ½çŸ¥é“ OPPO æ˜¯åšæ™ºèƒ½æ‰‹æœºçš„ï¼Œä½†å¹¶ä¸çŸ¥é“ OPPO ä¸äº’è”ç½‘ä»¥åŠå¤§æ•°æ®æœ‰ä»€ä¹ˆå…³ç³»ï¼Œä¸‹å›¾æ¦‚è¦ä»‹ç»äº† OPPO çš„ä¸šåŠ¡ä¸æ•°æ®æƒ…å†µï¼š OPPO ä½œä¸ºæ‰‹æœºå‚å•†ï¼ŒåŸºäº Android å®šåˆ¶äº†è‡ªå·±çš„ ColorOS ç³»ç»Ÿï¼Œå½“å‰æ—¥æ´»è·ƒç”¨æˆ·è¶…è¿‡ 2 äº¿ã€‚å›´ç»• ColorOSï¼ŒOPPO æ„å»ºäº†å¾ˆå¤šäº’è”ç½‘åº”ç”¨ï¼Œæ¯”å¦‚åº”ç”¨å•†åº—ã€æµè§ˆå™¨ã€ä¿¡æ¯æµç­‰ã€‚åœ¨è¿è¥è¿™äº›äº’è”ç½‘åº”ç”¨çš„è¿‡ç¨‹ä¸­ï¼ŒOPPO ç§¯ç´¯äº†å¤§é‡çš„æ•°æ®ï¼Œä¸Šå›¾å³è¾¹æ˜¯æ•´ä½“æ•°æ®è§„æ¨¡çš„æ¼”è¿›ï¼šä» 2012 å¹´å¼€å§‹æ¯å¹´éƒ½æ˜¯ 2~3 å€çš„å¢é•¿é€Ÿåº¦ï¼Œæˆªè‡³ç›®å‰æ€»æ•°æ®é‡å·²ç»è¶…è¿‡ 100PBï¼Œæ—¥å¢æ•°æ®é‡è¶…è¿‡ 200TBã€‚ è¦æ”¯æ’‘è¿™ä¹ˆå¤§çš„ä¸€ä¸ªæ•°æ®é‡ï¼ŒOPPO ç ”å‘å‡ºä¸€æ•´å¥—çš„æ•°æ®ç³»ç»Ÿä¸æœåŠ¡ï¼Œå¹¶é€æ¸å½¢æˆäº†è‡ªå·±çš„æ•°æ®ä¸­å°ä½“ç³»ã€‚ 1.2.OPPO æ•°æ®ä¸­å° ä»Šå¹´å¤§å®¶éƒ½åœ¨è°ˆæ•°æ®ä¸­å°ï¼ŒOPPO æ˜¯å¦‚ä½•ç†è§£æ•°æ®ä¸­å°çš„å‘¢ï¼Ÿæˆ‘ä»¬æŠŠå®ƒåˆ†æˆäº† 4 ä¸ªå±‚æ¬¡ï¼š æœ€ä¸‹å±‚æ˜¯ç»Ÿä¸€å·¥å…·ä½“ç³»ï¼Œæ¶µç›–äº†â€æ¥å…¥ - æ²»ç† - å¼€å‘ - æ¶ˆè´¹â€å…¨æ•°æ®é“¾è·¯ï¼› åŸºäºå·¥å…·ä½“ç³»ä¹‹ä¸Šæ„å»ºäº†æ•°æ®ä»“åº“ï¼Œåˆ’åˆ†æˆâ€åŸå§‹å±‚ - æ˜ç»†å±‚ - æ±‡æ€»å±‚ - åº”ç”¨å±‚â€ï¼Œè¿™ä¹Ÿæ˜¯ç»å…¸çš„æ•°ä»“æ¶æ„ï¼› å†å¾€ä¸Šæ˜¯å…¨åŸŸçš„æ•°æ®ä½“ç³»ï¼Œä»€ä¹ˆæ˜¯å…¨åŸŸå‘¢ï¼Ÿå°±æ˜¯æŠŠå…¬å¸æ‰€æœ‰çš„ä¸šåŠ¡æ•°æ®éƒ½æ‰“é€šï¼Œå½¢æˆç»Ÿä¸€çš„æ•°æ®èµ„äº§ï¼Œæ¯”å¦‚ ID-Mappingã€ç”¨æˆ·æ ‡ç­¾ç­‰ï¼› æœ€ç»ˆï¼Œæ•°æ®è¦èƒ½è¢«ä¸šåŠ¡ç”¨èµ·æ¥ï¼Œéœ€è¦åœºæ™¯é©±åŠ¨çš„æ•°æ®äº§å“ä¸æœåŠ¡ã€‚ ä»¥ä¸Šå°±æ˜¯ OPPO æ•°æ®ä¸­å°çš„æ•´ä¸ªä½“ç³»ï¼Œè€Œæ•°æ®ä»“åº“åœ¨å…¶ä¸­å¤„äºéå¸¸åŸºç¡€ä¸æ ¸å¿ƒçš„ä½ç½®ã€‚ 1.3. æ„å»º OPPO ç¦»çº¿æ•°ä»“ è¿‡å¾€ 2ã€3 å¹´ï¼Œæˆ‘ä»¬çš„é‡ç‚¹èšç„¦åœ¨ç¦»çº¿æ•°ä»“çš„æ„å»ºã€‚ä¸Šå›¾å¤§è‡´æè¿°äº†æ•´ä¸ªæ„å»ºè¿‡ç¨‹ï¼šé¦–å…ˆï¼Œæ•°æ®æ¥æºåŸºæœ¬æ˜¯æ‰‹æœºã€æ—¥å¿—æ–‡ä»¶ä»¥åŠ DB æ•°æ®åº“ï¼Œæˆ‘ä»¬åŸºäº Apache NiFi æ‰“é€ äº†é«˜å¯ç”¨ã€é«˜ååçš„æ¥å…¥ç³»ç»Ÿï¼Œå°†æ•°æ®ç»Ÿä¸€è½å…¥ HDFSï¼Œå½¢æˆåŸå§‹å±‚ï¼›ç´§æ¥ç€ï¼ŒåŸºäº Hive çš„å°æ—¶çº§ ETL ä¸å¤©çº§æ±‡æ€» Hive ä»»åŠ¡ï¼Œåˆ†åˆ«è´Ÿè´£è®¡ç®—ç”Ÿæˆæ˜ç»†å±‚ä¸æ±‡æ€»å±‚ï¼›æœ€åï¼Œåº”ç”¨å±‚æ˜¯åŸºäº OPPO å†…éƒ¨ç ”å‘çš„æ•°æ®äº§å“ï¼Œä¸»è¦æ˜¯æŠ¥è¡¨åˆ†æã€ç”¨æˆ·ç”»åƒä»¥åŠæ¥å£æœåŠ¡ã€‚æ­¤å¤–ï¼Œä¸­é—´çš„æ˜ç»†å±‚è¿˜æ”¯æŒåŸºäº Presto çš„å³å¸­æŸ¥è¯¢ä¸è‡ªåŠ©ææ•°ã€‚ ä¼´éšç€ç¦»çº¿æ•°ä»“çš„é€æ­¥å®Œå–„ï¼Œä¸šåŠ¡å¯¹å®æ—¶æ•°ä»“çš„è¯‰æ±‚ä¹Ÿæ„ˆå‘å¼ºçƒˆã€‚ 1.4. æ•°ä»“å®æ—¶åŒ–çš„è¯‰æ±‚ å¯¹äºæ•°ä»“å®æ—¶åŒ–çš„è¯‰æ±‚ï¼Œå¤§å®¶é€šå¸¸éƒ½æ˜¯ä»ä¸šåŠ¡è§†è§’æ¥çœ‹ï¼Œä½†å…¶å®ç«™åœ¨å¹³å°çš„è§’åº¦ï¼Œå®æ—¶åŒ–ä¹Ÿèƒ½å¸¦æ¥åˆ‡å®çš„å¥½å¤„ã€‚é¦–å…ˆï¼Œä»ä¸šåŠ¡ä¾§æ¥çœ‹ï¼ŒæŠ¥è¡¨ã€æ ‡ç­¾ã€æ¥å£ç­‰éƒ½ä¼šæœ‰å®æ—¶çš„åº”ç”¨åœºæ™¯ï¼Œåˆ†åˆ«å‚è§ä¸Šå›¾å·¦è¾¹çš„å‡ ä¸ªæ¡ˆä¾‹ï¼›å…¶æ¬¡ï¼Œå¯¹å¹³å°ä¾§æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥ä»ä¸‰ä¸ªæ¡ˆä¾‹æ¥çœ‹ï¼šç¬¬ä¸€ï¼ŒOPPO å¤§é‡çš„æ‰¹é‡ä»»åŠ¡éƒ½æ˜¯ä» 0 ç‚¹å¼€å§‹å¯åŠ¨ï¼Œéƒ½æ˜¯é€šè¿‡ T+1 çš„æ–¹å¼å»åšæ•°æ®å¤„ç†ï¼Œè¿™ä¼šå¯¼è‡´è®¡ç®—è´Ÿè½½é›†ä¸­çˆ†å‘ï¼Œå¯¹é›†ç¾¤çš„å‹åŠ›å¾ˆå¤§ï¼›ç¬¬äºŒï¼Œæ ‡ç­¾å¯¼å…¥ä¹Ÿå±äºä¸€ç§ T+1 æ‰¹é‡ä»»åŠ¡ï¼Œæ¯æ¬¡å…¨é‡å¯¼å…¥éƒ½ä¼šè€—è´¹å¾ˆé•¿çš„æ—¶é—´ï¼›ç¬¬ä¸‰ï¼Œæ•°æ®è´¨é‡çš„ç›‘æ§ä¹Ÿå¿…é¡»æ˜¯ T+1 çš„ï¼Œå¯¼è‡´æ²¡åŠæ³•åŠæ—¶å‘ç°æ•°æ®çš„ä¸€äº›é—®é¢˜ã€‚ æ—¢ç„¶ä¸šåŠ¡ä¾§å’Œå¹³å°ä¾§éƒ½æœ‰å®æ—¶åŒ–çš„è¿™ä¸ªè¯‰æ±‚ï¼Œé‚£ OPPO æ˜¯å¦‚ä½•æ¥æ„å»ºè‡ªå·±çš„å®æ—¶æ•°ä»“å‘¢ï¼Ÿ 1.5. ç¦»çº¿åˆ°å®æ—¶çš„å¹³æ»‘è¿ç§» æ— è®ºæ˜¯ä¸€ä¸ªå¹³å°è¿˜æ˜¯ä¸€ä¸ªç³»ç»Ÿï¼Œéƒ½ç¦»ä¸å¼€ä¸Šä¸‹ä¸¤ä¸ªå±‚æ¬¡çš„æ„æˆï¼šä¸Šå±‚æ˜¯ APIï¼Œæ˜¯é¢å‘ç”¨æˆ·çš„ç¼–ç¨‹æŠ½è±¡ä¸æ¥å£ï¼›ä¸‹å±‚æ˜¯ Runtimeï¼Œæ˜¯é¢å‘å†…æ ¸çš„æ‰§è¡Œå¼•æ“ã€‚æˆ‘ä»¬å¸Œæœ›ä»ç¦»çº¿åˆ°å®æ—¶çš„è¿ç§»æ˜¯å¹³æ»‘çš„ï¼Œæ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿä» API è¿™å±‚æ¥çœ‹ï¼Œæ•°ä»“çš„æŠ½è±¡æ˜¯ Tableã€ç¼–ç¨‹æ¥å£æ˜¯ SQL+UDFï¼Œç¦»çº¿æ•°ä»“æ—¶ä»£ç”¨æˆ·å·²ç»ä¹ æƒ¯äº†è¿™æ ·çš„ APIï¼Œè¿ç§»åˆ°å®æ—¶æ•°ä»“åæœ€å¥½ä¹Ÿèƒ½ä¿æŒä¸€è‡´ã€‚è€Œä» Runtime è¿™å±‚æ¥çœ‹ï¼Œè®¡ç®—å¼•æ“ä» Hive æ¼”è¿›åˆ°äº† Flinkï¼Œå­˜å‚¨å¼•æ“ä» HDFS æ¼”è¿›åˆ°äº† Kafkaã€‚ åŸºäºä»¥ä¸Šçš„æ€è·¯ï¼Œåªéœ€è¦æŠŠä¹‹å‰æåˆ°çš„ç¦»çº¿æ•°ä»“ pipeline æ”¹é€ ä¸‹ï¼Œå°±å¾—åˆ°äº†å®æ—¶æ•°ä»“ pipelineã€‚ 1.6. æ„å»º OPPO å®æ—¶æ•°ä»“ HDFS æ›¿æ¢ä¸º Kafkaã€‚ä»æ€»ä½“æµç¨‹æ¥çœ‹ï¼ŒåŸºæœ¬æ¨¡å‹æ˜¯ä¸å˜çš„ï¼Œè¿˜æ˜¯ç”±åŸå§‹å±‚ã€æ˜ç»†å±‚ã€æ±‡æ€»å±‚ã€åº”ç”¨å±‚çš„çº§è”è®¡ç®—æ¥æ„æˆã€‚ å› æ­¤ï¼Œè¿™é‡Œçš„æ ¸å¿ƒé—®é¢˜æ˜¯å¦‚ä½•åŸºäº Flink æ„å»ºå‡ºè¿™ä¸ª pipelineï¼Œä¸‹é¢å°±ä»‹ç»ä¸‹æˆ‘ä»¬åŸºäº Flink SQL æ‰€åšçš„ä¸€äº›å·¥ä½œã€‚ äºŒ. åŸºäº Flink SQL çš„æ‰©å±•å·¥ä½œ2.1.Why Flink SQLé¦–å…ˆï¼Œä¸ºä»€ä¹ˆè¦ç”¨ Flink SQL? ä¸‹å›¾å±•ç¤ºäº† Flink æ¡†æ¶çš„åŸºæœ¬ç»“æ„ï¼Œæœ€ä¸‹é¢æ˜¯ Runtimeï¼Œè¿™ä¸ªæ‰§è¡Œå¼•æ“æˆ‘ä»¬è®¤ä¸ºæœ€æ ¸å¿ƒçš„ä¼˜åŠ¿æ˜¯å››ä¸ªï¼šç¬¬ä¸€ï¼Œä½å»¶è¿Ÿï¼Œé«˜ååï¼›ç¬¬äºŒï¼Œç«¯åˆ°ç«¯çš„ Exactly-onceï¼›ç¬¬ä¸‰ï¼Œå¯å®¹é”™çš„çŠ¶æ€ç®¡ç†ï¼›ç¬¬å››ï¼ŒWindow &amp; Event time çš„æ”¯æŒã€‚åŸºäº Runtime æŠ½è±¡å‡º 3 ä¸ªå±‚æ¬¡çš„ APIï¼ŒSQL å¤„äºæœ€ä¸Šå±‚ã€‚ Flink SQL API æœ‰å“ªäº›ä¼˜åŠ¿å‘¢ï¼Ÿæˆ‘ä»¬ä¹Ÿä»å››ä¸ªæ–¹é¢å»çœ‹ï¼šç¬¬ä¸€ï¼Œæ”¯æŒ ANSI SQL çš„æ ‡å‡†ï¼›ç¬¬äºŒï¼Œæ”¯æŒä¸°å¯Œçš„æ•°æ®ç±»å‹ä¸å†…ç½®å‡½æ•°ï¼ŒåŒ…æ‹¬å¸¸è§çš„ç®—æœ¯è¿ç®—ä¸ç»Ÿè®¡èšåˆï¼›ç¬¬ä¸‰ï¼Œå¯è‡ªå®šä¹‰ Source/Sinkï¼ŒåŸºäºæ­¤å¯ä»¥çµæ´»åœ°æ‰©å±•ä¸Šä¸‹æ¸¸ï¼›ç¬¬å››ï¼Œæ‰¹æµç»Ÿä¸€ï¼ŒåŒæ ·çš„ SQLï¼Œæ—¢å¯ä»¥è·‘ç¦»çº¿ä¹Ÿå¯ä»¥è·‘å®æ—¶ã€‚ é‚£ä¹ˆï¼ŒåŸºäº Flink SQL API å¦‚ä½•ç¼–ç¨‹å‘¢ï¼Ÿä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„æ¼”ç¤ºï¼š é¦–å…ˆæ˜¯å®šä¹‰ä¸æ³¨å†Œè¾“å…¥ / è¾“å‡ºè¡¨ï¼Œè¿™é‡Œåˆ›å»ºäº† 2 å¼  Kakfa çš„è¡¨ï¼ŒæŒ‡å®š kafka ç‰ˆæœ¬æ˜¯ä»€ä¹ˆã€å¯¹åº”å“ªä¸ª topicï¼›æ¥ä¸‹æ¥æ˜¯æ³¨å†Œ UDFï¼Œç¯‡å¹…åŸå› è¿™é‡Œæ²¡æœ‰åˆ—å‡º UDF çš„å®šä¹‰ï¼›æœ€åæ˜¯æ‰æ˜¯æ‰§è¡ŒçœŸæ­£çš„ SQLã€‚å¯ä»¥çœ‹åˆ°ï¼Œä¸ºäº†æ‰§è¡Œ SQLï¼Œéœ€è¦åšè¿™ä¹ˆå¤šçš„ç¼–ç å·¥ä½œï¼Œè¿™å¹¶ä¸æ˜¯æˆ‘ä»¬å¸Œæœ›æš´éœ²ç»™ç”¨æˆ·çš„æ¥å£ã€‚ 2.2. åŸºäº WEB çš„å¼€å‘ IDE å‰é¢æåˆ°è¿‡ï¼Œæ•°ä»“çš„æŠ½è±¡æ˜¯ Tableï¼Œç¼–ç¨‹æ¥å£æ˜¯ SQL+UDFã€‚å¯¹äºç”¨æˆ·æ¥è¯´ï¼Œå¹³å°æä¾›çš„ç¼–ç¨‹ç•Œé¢åº”è¯¥æ˜¯ç±»ä¼¼ä¸Šå›¾çš„é‚£ç§ï¼Œæœ‰ç”¨è¿‡ HUE åšäº¤äº’æŸ¥è¯¢çš„åº”è¯¥å¾ˆç†Ÿæ‚‰ã€‚å·¦è¾¹çš„èœå•æ˜¯ Table åˆ—è¡¨ï¼Œå³è¾¹æ˜¯ SQL ç¼–è¾‘å™¨ï¼Œå¯ä»¥åœ¨ä¸Šé¢ç›´æ¥å†™ SQLï¼Œç„¶åæäº¤æ‰§è¡Œã€‚è¦å®ç°è¿™æ ·ä¸€ç§äº¤äº’æ–¹å¼ï¼ŒFlink SQL é»˜è®¤æ˜¯æ— æ³•å®ç°çš„ï¼Œä¸­é—´å­˜åœ¨ gapï¼Œæ€»ç»“ä¸‹æ¥å°± 2 ç‚¹ï¼šç¬¬ä¸€ï¼Œå…ƒæ•°æ®çš„ç®¡ç†ï¼Œæ€ä¹ˆå»åˆ›å»ºåº“è¡¨ï¼Œæ€ä¹ˆå»ä¸Šä¼  UDFï¼Œä½¿å¾—ä¹‹ååœ¨ SQL ä¸­å¯ç›´æ¥å¼•ç”¨ï¼›ç¬¬äºŒï¼ŒSQL ä½œä¸šçš„ç®¡ç†ï¼Œæ€ä¹ˆå»ç¼–è¯‘ SQLï¼Œæ€ä¹ˆå»æäº¤ä½œä¸šã€‚ åœ¨æŠ€æœ¯è°ƒç ”è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å‘ç°äº† Uber åœ¨ 2017 å¹´å¼€æºçš„ AthenaX æ¡†æ¶ã€‚ 2.3.AthenaXï¼šåŸºäº REST çš„ SQL ç®¡ç†å™¨ AthenaX å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªåŸºäº REST çš„ SQL ç®¡ç†å™¨ï¼Œå®ƒæ˜¯æ€ä¹ˆå®ç° SQL ä½œä¸šä¸å…ƒæ•°æ®ç®¡ç†çš„å‘¢ï¼Ÿ å¯¹äº SQL ä½œä¸šæäº¤ï¼ŒAthenaX ä¸­æœ‰ä¸€ä¸ª Job çš„æŠ½è±¡ï¼Œå°è£…äº†è¦æ‰§è¡Œçš„ SQL ä»¥åŠä½œä¸šèµ„æºç­‰ä¿¡æ¯ã€‚æ‰€æœ‰çš„ Job ç”±ä¸€ä¸ª JobStore æ¥æ‰˜ç®¡ï¼Œå®ƒå®šæœŸè·Ÿ YARN å½“ä¸­å¤„äº Running çŠ¶æ€çš„ App åšä¸€ä¸ªåŒ¹é…ã€‚å¦‚æœä¸ä¸€è‡´ï¼Œå°±ä¼šå‘ YARN æäº¤å¯¹åº”çš„ Jobã€‚ å¯¹äºå…ƒæ•°æ®ç®¡ç†ï¼Œæ ¸å¿ƒçš„é—®é¢˜æ˜¯å¦‚ä½•å°†å¤–éƒ¨åˆ›å»ºçš„åº“è¡¨æ³¨å…¥ Flinkï¼Œä½¿å¾— SQL ä¸­å¯ä»¥è¯†åˆ«åˆ°ã€‚å®é™…ä¸Šï¼ŒFlink æœ¬èº«å°±é¢„ç•™äº†ä¸å¤–éƒ¨å…ƒæ•°æ®å¯¹æ¥çš„èƒ½åŠ›ï¼Œåˆ†åˆ«æä¾›äº† ExternalCatalog å’Œ ExternalCatalogTable è¿™ä¸¤ä¸ªæŠ½è±¡ã€‚AthenaX åœ¨æ­¤åŸºç¡€ä¸Šå†å°è£…å‡ºä¸€ä¸ª TableCatalogï¼Œåœ¨æ¥å£å±‚é¢åšäº†ä¸€å®šçš„æ‰©å±•ã€‚åœ¨æäº¤ SQL ä½œä¸šçš„é˜¶æ®µï¼ŒAthenaX ä¼šè‡ªåŠ¨å°† TableCatalog æ³¨å†Œåˆ° Flinkï¼Œå†è°ƒç”¨ Flink SQL çš„æ¥å£å°† SQL ç¼–è¯‘ä¸º Flink çš„å¯æ‰§è¡Œå•å…ƒ JobGraphï¼Œå¹¶æœ€ç»ˆæäº¤åˆ° YARN ç”Ÿæˆæ–°çš„ Appã€‚ AthenaX è™½ç„¶å®šä¹‰å¥½äº† TableCatalog æ¥å£ï¼Œä½†å¹¶æ²¡æœ‰æä¾›å¯ç›´æ¥ä½¿ç”¨çš„å®ç°ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬æ€ä¹ˆæ¥å®ç°ï¼Œä»¥ä¾¿å¯¹æ¥åˆ°æˆ‘ä»¬å·²æœ‰çš„å…ƒæ•°æ®ç³»ç»Ÿå‘¢ï¼Ÿ 2.4.Flink SQL æ³¨å†Œåº“è¡¨çš„è¿‡ç¨‹é¦–å…ˆï¼Œæˆ‘ä»¬å¾—ææ¸…æ¥š Flink SQL å†…éƒ¨æ˜¯å¦‚ä½•æ³¨å†Œåº“è¡¨çš„ã€‚æ•´ä¸ªè¿‡ç¨‹æ¶‰åŠåˆ°ä¸‰ä¸ªåŸºæœ¬çš„æŠ½è±¡ï¼šTableDescriptorã€TableFactory ä»¥åŠ TableEnvironmentã€‚ TableDescriptor é¡¾åæ€ä¹‰ï¼Œæ˜¯å¯¹è¡¨çš„æè¿°ï¼Œå®ƒç”±ä¸‰ä¸ªå­æè¿°ç¬¦æ„æˆï¼šç¬¬ä¸€æ˜¯ Connectorï¼Œæè¿°æ•°æ®çš„æ¥æºï¼Œæ¯”å¦‚ Kafkaã€ES ç­‰ï¼›ç¬¬äºŒæ˜¯ Formatï¼Œæè¿°æ•°æ®çš„æ ¼å¼ï¼Œæ¯”å¦‚ csvã€jsonã€avro ç­‰ï¼›ç¬¬ä¸‰æ˜¯ Schemaï¼Œæè¿°æ¯ä¸ªå­—æ®µçš„åç§°ä¸ç±»å‹ã€‚TableDescriptor æœ‰ä¸¤ä¸ªåŸºæœ¬çš„å®ç°â€”â€”ConnectTableDescriptor ç”¨äºæè¿°å†…éƒ¨è¡¨ï¼Œä¹Ÿå°±æ˜¯ç¼–ç¨‹æ–¹å¼åˆ›å»ºçš„è¡¨ï¼›ExternalCatalogTable ç”¨äºæè¿°å¤–éƒ¨è¡¨ã€‚ æœ‰äº† TableDescriptorï¼Œæ¥ä¸‹æ¥éœ€è¦ TableFactory æ ¹æ®æè¿°ä¿¡æ¯æ¥å®ä¾‹åŒ– Tableã€‚ä¸åŒçš„æè¿°ä¿¡æ¯éœ€è¦ä¸åŒçš„ TableFactory æ¥å¤„ç†ï¼ŒFlink å¦‚ä½•æ‰¾åˆ°åŒ¹é…çš„ TableFactory å®ç°å‘¢ï¼Ÿå®é™…ä¸Šï¼Œä¸ºäº†ä¿è¯æ¡†æ¶çš„å¯æ‰©å±•æ€§ï¼ŒFlink é‡‡ç”¨äº† Java SPI æœºåˆ¶æ¥åŠ è½½æ‰€æœ‰å£°æ˜è¿‡çš„ TableFactoryï¼Œé€šè¿‡éå†çš„æ–¹å¼å»å¯»æ‰¾å“ªä¸ª TableFactory æ˜¯åŒ¹é…è¯¥ TableDescriptor çš„ã€‚TableDescriptor åœ¨ä¼ é€’ç»™ TableFactory å‰ï¼Œè¢«è½¬æ¢æˆä¸€ä¸ª mapï¼Œæ‰€æœ‰çš„æè¿°ä¿¡æ¯éƒ½ç”¨ key-value å½¢å¼æ¥è¡¨è¾¾ã€‚TableFactory å®šä¹‰äº†ä¸¤ä¸ªç”¨äºè¿‡æ»¤åŒ¹é…çš„æ–¹æ³•â€”â€”ä¸€ä¸ªæ˜¯ requiredContext()ï¼Œç”¨äºæ£€æµ‹æŸäº›ç‰¹å®š key çš„ value æ˜¯å¦åŒ¹é…ï¼Œæ¯”å¦‚ connector.type æ˜¯å¦ä¸º kakfaï¼›å¦ä¸€ä¸ªæ˜¯ supportedProperties()ï¼Œç”¨äºæ£€æµ‹ key æ˜¯å¦èƒ½è¯†åˆ«ï¼Œå¦‚æœå‡ºç°ä¸è¯†åˆ«çš„ keyï¼Œè¯´æ˜æ— æ³•åŒ¹é…ã€‚ åŒ¹é…åˆ°äº†æ­£ç¡®çš„ TableFactoryï¼Œæ¥ä¸‹æ¥å°±æ˜¯åˆ›å»ºçœŸæ­£çš„ Tableï¼Œç„¶åå°†å…¶é€šè¿‡ TableEnvironment æ³¨å†Œã€‚æœ€ç»ˆæ³¨å†ŒæˆåŠŸçš„ Tableï¼Œæ‰èƒ½åœ¨ SQL ä¸­å¼•ç”¨ã€‚ 2.5.Flink SQL å¯¹æ¥å¤–éƒ¨æ•°æ®æºææ¸…æ¥šäº† Flink SQL æ³¨å†Œåº“è¡¨çš„è¿‡ç¨‹ï¼Œç»™æˆ‘ä»¬å¸¦æ¥è¿™æ ·ä¸€ä¸ªæ€è·¯ï¼šå¦‚æœå¤–éƒ¨å…ƒæ•°æ®åˆ›å»ºçš„è¡¨ä¹Ÿèƒ½è¢«è½¬æ¢æˆ TableFactory å¯è¯†åˆ«çš„ mapï¼Œé‚£ä¹ˆå°±èƒ½è¢«æ— ç¼åœ°æ³¨å†Œåˆ° TableEnvironmentã€‚åŸºäºè¿™ä¸ªæ€è·¯ï¼Œæˆ‘ä»¬å®ç°äº† Flink SQL ä¸å·²æœ‰å…ƒæ•°æ®ä¸­å¿ƒçš„å¯¹æ¥ï¼Œå¤§è‡´è¿‡ç¨‹å‚è§ä¸‹å›¾ï¼š é€šè¿‡å…ƒæ•°æ®ä¸­å¿ƒåˆ›å»ºçš„è¡¨ï¼Œéƒ½ä¼šå°†å…ƒæ•°æ®ä¿¡æ¯å­˜å‚¨åˆ° MySQLï¼Œæˆ‘ä»¬ç”¨ä¸€å¼ è¡¨æ¥è®°å½• Table çš„åŸºæœ¬ä¿¡æ¯ï¼Œç„¶åå¦å¤–ä¸‰å¼ è¡¨åˆ†åˆ«è®°å½• Connectorã€Formatã€Schema è½¬æ¢æˆ key-value åçš„æè¿°ä¿¡æ¯ã€‚ä¹‹æ‰€ä»¥æ‹†å¼€æˆä¸‰å¼ è¡¨ï¼Œæ˜¯ä¸ºäº†èƒ½å¤Ÿèƒ½ç‹¬ç«‹çš„æ›´æ–°è¿™ä¸‰ç§æè¿°ä¿¡æ¯ã€‚æ¥ä¸‹æ¥æ˜¯å®šåˆ¶å®ç°çš„ ExternalCatalogï¼Œèƒ½å¤Ÿè¯»å– MySQL è¿™å››å¼ è¡¨ï¼Œå¹¶è½¬æ¢æˆ map ç»“æ„ã€‚ 2.6. å®æ—¶è¡¨ - ç»´è¡¨å…³è”åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬çš„å¹³å°å·²ç»å…·å¤‡äº†å…ƒæ•°æ®ç®¡ç†ä¸ SQL ä½œä¸šç®¡ç†çš„èƒ½åŠ›ï¼Œä½†æ˜¯è¦çœŸæ­£å¼€æ”¾ç»™ç”¨æˆ·ä½¿ç”¨ï¼Œè¿˜æœ‰ä¸€ç‚¹åŸºæœ¬ç‰¹æ€§å­˜åœ¨ç¼ºå¤±ã€‚é€šè¿‡æˆ‘ä»¬å»æ„å»ºæ•°ä»“ï¼Œæ˜Ÿå‹æ¨¡å‹æ˜¯æ— æ³•é¿å…çš„ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„æ¡ˆä¾‹ï¼šä¸­é—´çš„äº‹å®è¡¨è®°å½•äº†å¹¿å‘Šç‚¹å‡»æµï¼Œå‘¨è¾¹æ˜¯å…³äºç”¨æˆ·ã€å¹¿å‘Šã€äº§å“ã€æ¸ é“çš„ç»´åº¦è¡¨ã€‚ å‡å®šæˆ‘ä»¬æœ‰ä¸€ä¸ª SQL åˆ†æï¼Œéœ€è¦å°†ç‚¹å‡»æµè¡¨ä¸ç”¨æˆ·ç»´è¡¨è¿›è¡Œå…³è”ï¼Œè¿™ä¸ªç›®å‰åœ¨ Flink SQL ä¸­åº”è¯¥æ€ä¹ˆæ¥å®ç°ï¼Ÿæˆ‘ä»¬æœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼Œä¸€ä¸ªåŸºäº UDFï¼Œä¸€ä¸ªåŸºäº SQL è½¬æ¢ï¼Œä¸‹é¢åˆ†åˆ«å±•å¼€æ¥è®²ä¸€ä¸‹ã€‚ 2.7. åŸºäº UDF çš„ç»´è¡¨å…³è”é¦–å…ˆæ˜¯åŸºäº UDF çš„å®ç°ï¼Œéœ€è¦ç”¨æˆ·å°†åŸå§‹ SQL æ”¹å†™ä¸ºå¸¦ UDF è°ƒç”¨çš„ SQLï¼Œè¿™é‡Œæ˜¯ userDimFuncï¼Œä¸Šå›¾å³è¾¹æ˜¯å®ƒçš„ä»£ç å®ç°ã€‚UserDimFunc ç»§æ‰¿äº† Flink SQL æŠ½è±¡çš„ TableFunctionï¼Œå®ƒæ˜¯å…¶ä¸­ä¸€ç§ UDF ç±»å‹ï¼Œå¯ä»¥å°†ä»»æ„ä¸€è¡Œæ•°æ®è½¬æ¢æˆä¸€è¡Œæˆ–å¤šè¡Œæ•°æ®ã€‚ä¸ºäº†å®ç°ç»´è¡¨å…³è”ï¼Œåœ¨ UDF åˆå§‹åŒ–æ—¶éœ€è¦ä» MySQL å…¨é‡åŠ è½½ç»´è¡¨çš„æ•°æ®ï¼Œç¼“å­˜åœ¨å†…å­˜ cache ä¸­ã€‚åç»­å¯¹æ¯è¡Œæ•°æ®çš„å¤„ç†ï¼ŒTableFunction ä¼šè°ƒç”¨ eval() æ–¹æ³•ï¼Œåœ¨ eval() ä¸­æ ¹æ® user_id å»æŸ¥æ‰¾ cacheï¼Œä»è€Œå®ç°å…³è”ã€‚å½“ç„¶ï¼Œè¿™é‡Œæ˜¯å‡å®šç»´è¡¨æ•°æ®æ¯”è¾ƒå°ï¼Œå¦‚æœæ•°æ®é‡å¾ˆå¤§ï¼Œä¸é€‚åˆå…¨é‡çš„åŠ è½½ä¸ç¼“å­˜ï¼Œè¿™é‡Œä¸åšå±•å¼€äº†ã€‚ åŸºäº UDF çš„å®ç°ï¼Œå¯¹ç”¨æˆ·å’Œå¹³å°æ¥è¯´éƒ½ä¸å¤ªå‹å¥½ï¼šç”¨æˆ·éœ€è¦å†™å¥‡æ€ªçš„ SQL è¯­å¥ï¼Œæ¯”å¦‚å›¾ä¸­çš„ LATERAL TABLEï¼›å¹³å°éœ€è¦ä¸ºæ¯ä¸ªå…³è”åœºæ™¯å®šåˆ¶ç‰¹å®šçš„ UDFï¼Œç»´æŠ¤æˆæœ¬å¤ªé«˜ã€‚æœ‰æ²¡æœ‰æ›´å¥½çš„æ–¹å¼å‘¢ï¼Ÿä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹åŸºäº SQL è½¬æ¢çš„å®ç°ã€‚ 2.8. åŸºäº SQL è½¬æ¢çš„ç»´è¡¨å…³è”æˆ‘ä»¬å¸Œæœ›è§£å†³åŸºäº UDF å®ç°æ‰€å¸¦æ¥çš„é—®é¢˜ï¼Œç”¨æˆ·ä¸éœ€è¦æ”¹å†™åŸå§‹ SQLï¼Œå¹³å°ä¸éœ€è¦å¼€å‘å¾ˆå¤š UDFã€‚æœ‰ä¸€ç§æ€è·¯æ˜¯ï¼Œæ˜¯å¦å¯ä»¥åœ¨ SQL äº¤ç»™ Flink ç¼–è¯‘ä¹‹å‰ï¼ŒåŠ ä¸€å±‚ SQL çš„è§£æä¸æ”¹å†™ï¼Œè‡ªåŠ¨å®ç°ç»´è¡¨çš„å…³è”ï¼Ÿç»è¿‡ä¸€å®šçš„æŠ€æœ¯è°ƒç ”ä¸ POCï¼Œæˆ‘ä»¬å‘ç°æ˜¯è¡Œå¾—é€šçš„ï¼Œæ‰€ä»¥ç§°ä¹‹ä¸ºåŸºäº SQL è½¬æ¢çš„å®ç°ã€‚ä¸‹é¢å°†è¯¥æ€è·¯å±•å¼€è§£é‡Šä¸‹ã€‚ é¦–å…ˆï¼Œå¢åŠ çš„ SQL è§£ææ˜¯ä¸ºäº†è¯†åˆ« SQL ä¸­æ˜¯å¦å­˜åœ¨é¢„å…ˆå®šä¹‰çš„ç»´åº¦è¡¨ï¼Œæ¯”å¦‚ä¸Šå›¾ä¸­çš„ user_dimã€‚ä¸€æ—¦è¯†åˆ«åˆ°ç»´è¡¨ï¼Œå°†è§¦å‘ SQL æ”¹å†™çš„æµç¨‹ï¼Œå°†çº¢æ¡†æ ‡æ³¨çš„ join è¯­å¥æ”¹å†™æˆæ–°çš„ Tableï¼Œè¿™ä¸ª Table æ€ä¹ˆå¾—åˆ°å‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“ï¼Œæµè®¡ç®—é¢†åŸŸè¿‘å¹´æ¥å‘å±•å‡ºâ€œæµè¡¨äºŒè±¡æ€§â€çš„ç†å¿µï¼ŒFlink ä¹Ÿæ˜¯è¯¥ç†å¿µçš„è·µè¡Œè€…ã€‚è¿™æ„å‘³ç€ï¼Œåœ¨ Flink ä¸­ Stream ä¸ Table ä¹‹é—´æ˜¯å¯ä»¥ç›¸äº’è½¬æ¢çš„ã€‚æˆ‘ä»¬æŠŠ ad_clicks å¯¹åº”çš„ Table è½¬æ¢æˆ Streamï¼Œå†è°ƒç”¨ flatmap å½¢æˆå¦ä¸€ä¸ª Streamï¼Œæœ€åå†è½¬æ¢å› Tableï¼Œå°±å¾—åˆ°äº† ad_clicks_userã€‚æœ€åçš„é—®é¢˜æ˜¯ï¼Œflatmap æ˜¯å¦‚ä½•å®ç°ç»´è¡¨å…³è”çš„ï¼Ÿ Flink ä¸­å¯¹äº Stream çš„ flatmap æ“ä½œï¼Œå®é™…ä¸Šæ˜¯æ‰§è¡Œä¸€ä¸ª RichFlatmapFuncitonï¼Œæ¯æ¥ä¸€è¡Œæ•°æ®å°±è°ƒç”¨å…¶ flatmap() æ–¹æ³•åšè½¬æ¢ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥å®šåˆ¶ä¸€ä¸ª RichFlatmapFunctionï¼Œæ¥å®ç°ç»´è¡¨æ•°æ®çš„åŠ è½½ã€ç¼“å­˜ã€æŸ¥æ‰¾ä»¥åŠå…³è”ï¼ŒåŠŸèƒ½ä¸åŸºäº UDF çš„ TableFunction å®ç°ç±»ä¼¼ã€‚ æ—¢ç„¶ RichFlatmapFunciton çš„å®ç°é€»è¾‘ä¸ TableFunction ç›¸ä¼¼ï¼Œé‚£ä¸ºä»€ä¹ˆç›¸æ¯”åŸºäº UDF çš„æ–¹å¼ï¼Œè¿™ç§å®ç°èƒ½æ›´åŠ é€šç”¨å‘¢ï¼Ÿæ ¸å¿ƒçš„ç‚¹åœ¨äºå¤šäº†ä¸€å±‚ SQL è§£æï¼Œå¯ä»¥å°†ç»´è¡¨çš„ä¿¡æ¯è·å–å‡ºæ¥ï¼ˆæ¯”å¦‚ç»´è¡¨åã€å…³è”å­—æ®µã€select å­—æ®µç­‰ï¼‰ï¼Œå†å°è£…æˆ JoinContext ä¼ é€’ç»™ RichFlatmapFuncitonï¼Œä½¿å¾—çš„è¡¨è¾¾èƒ½åŠ›å°±å…·å¤‡é€šç”¨æ€§äº†ã€‚ ä¸‰. æ„å»ºå®æ—¶æ•°ä»“çš„åº”ç”¨æ¡ˆä¾‹ä¸‹é¢åˆ†äº«å‡ ä¸ªå…¸å‹çš„åº”ç”¨æ¡ˆä¾‹ï¼Œéƒ½æ˜¯åœ¨æˆ‘ä»¬çš„å¹³å°ä¸Šç”¨ Flink SQL æ¥å®ç°çš„ã€‚ 3.1. å®æ—¶ ETL æ‹†åˆ†è¿™é‡Œæ˜¯ä¸€ä¸ªå…¸å‹çš„å®æ—¶ ETL é“¾è·¯ï¼Œä»å¤§è¡¨ä¸­æ‹†åˆ†å‡ºå„ä¸šåŠ¡å¯¹åº”çš„å°è¡¨ï¼š OPPO çš„æœ€å¤§æ•°æ®æ¥æºæ˜¯æ‰‹æœºç«¯åŸ‹ç‚¹ï¼Œä»æ‰‹æœº APP è¿‡æ¥çš„æ•°æ®æœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼Œæ‰€æœ‰çš„æ•°æ®æ˜¯é€šè¿‡ç»Ÿä¸€çš„å‡ ä¸ªé€šé“ä¸ŠæŠ¥è¿‡æ¥ã€‚å› ä¸ºä¸å¯èƒ½æ¯ä¸€æ¬¡ä¸šåŠ¡æœ‰æ–°çš„åŸ‹ç‚¹ï¼Œéƒ½è¦å»å‡çº§å®¢æˆ·ç«¯ï¼Œå»å¢åŠ æ–°çš„é€šé“ã€‚æ¯”å¦‚æˆ‘ä»¬æœ‰ä¸ª sdk_log é€šé“ï¼Œæ‰€æœ‰ APP åº”ç”¨çš„åŸ‹ç‚¹éƒ½å¾€è¿™ä¸ªé€šé“ä¸ŠæŠ¥æ•°æ®ï¼Œå¯¼è‡´è¿™ä¸ªé€šé“å¯¹åº”çš„åŸå§‹å±‚è¡¨å·¨å¤§ï¼Œä¸€å¤©å‡ åä¸ª TBã€‚ä½†å®é™…ä¸Šï¼Œæ¯ä¸ªä¸šåŠ¡åªå…³å¿ƒå®ƒè‡ªèº«çš„é‚£éƒ¨åˆ†æ•°æ®ï¼Œè¿™å°±è¦æ±‚æˆ‘ä»¬åœ¨åŸå§‹å±‚è¿›è¡Œ ETL æ‹†åˆ†ã€‚ è¿™ä¸ª SQL é€»è¾‘æ¯”è¾ƒç®€å•ï¼Œæ— éæ˜¯æ ¹æ®æŸäº›ä¸šåŠ¡å­—æ®µåšç­›é€‰ï¼Œæ’å…¥åˆ°ä¸åŒçš„ä¸šåŠ¡è¡¨ä¸­å»ã€‚å®ƒçš„ç‰¹ç‚¹æ˜¯ï¼Œå¤šè¡Œ SQL æœ€ç»ˆåˆå¹¶æˆä¸€ä¸ª SQL æäº¤ç»™ Flink æ‰§è¡Œã€‚å¤§å®¶æ‹…å¿ƒçš„æ˜¯ï¼ŒåŒ…å«äº† 4 ä¸ª SQLï¼Œä¼šä¸ä¼šå¯¹åŒä¸€ä»½æ•°æ®é‡å¤è¯»å– 4 æ¬¡ï¼Ÿå…¶å®ï¼Œåœ¨ Flink ç¼–è¯‘ SQL çš„é˜¶æ®µæ˜¯ä¼šåšä¸€äº›ä¼˜åŒ–çš„ï¼Œå› ä¸ºæœ€ç»ˆæŒ‡å‘çš„æ˜¯åŒä¸€ä¸ª kafka topicï¼Œæ‰€ä»¥åªä¼šè¯»å– 1 æ¬¡æ•°æ®ã€‚ å¦å¤–ï¼ŒåŒæ ·çš„ Flink SQLï¼Œæˆ‘ä»¬åŒæ—¶ç”¨äºç¦»çº¿ä¸å®æ—¶æ•°ä»“çš„ ETL æ‹†åˆ†ï¼Œåˆ†åˆ«è½å…¥ HDFS ä¸ Kafkaã€‚Flink ä¸­æœ¬èº«æ”¯æŒå†™å…¥ HDFS çš„ Sinkï¼Œæ¯”å¦‚ RollingFileSinkã€‚ 3.2. å®æ—¶æŒ‡æ ‡ç»Ÿè®¡è¿™é‡Œæ˜¯ä¸€ä¸ªå…¸å‹çš„è®¡ç®—ä¿¡æ¯æµ CTR çš„è¿™ä¸ªæ¡ˆä¾‹ï¼Œåˆ†åˆ«è®¡ç®—ä¸€å®šæ—¶é—´æ®µå†…çš„æ›å…‰ä¸ç‚¹å‡»æ¬¡æ•°ï¼Œç›¸é™¤å¾—åˆ°ç‚¹å‡»ç‡å¯¼å…¥ Mysqlï¼Œç„¶åé€šè¿‡æˆ‘ä»¬å†…éƒ¨çš„æŠ¥è¡¨ç³»ç»Ÿæ¥å¯è§†åŒ–ã€‚è¿™ä¸ª SQL çš„ç‰¹ç‚¹æ˜¯å®ƒç”¨åˆ°äº†çª—å£ (Tumbling Window) ä»¥åŠå­æŸ¥è¯¢ã€‚ 3.3. å®æ—¶æ ‡ç­¾å¯¼å…¥è¿™é‡Œæ˜¯ä¸€ä¸ªå®æ—¶æ ‡ç­¾å¯¼å…¥çš„æ¡ˆä¾‹ï¼Œæ‰‹æœºç«¯å®æ—¶æ„ŸçŸ¥åˆ°å½“å‰ç”¨æˆ·çš„ç»çº¬åº¦ï¼Œè½¬æ¢æˆå…·ä½“ POI åå¯¼å…¥ ESï¼Œæœ€ç»ˆåœ¨æ ‡ç­¾ç³»ç»Ÿä¸Šåšç”¨æˆ·å®šå‘ã€‚ è¿™ä¸ª SQL çš„ç‰¹ç‚¹æ˜¯ç”¨äº† AggregateFunctionï¼Œåœ¨ 5 åˆ†é’Ÿçš„çª—å£å†…ï¼Œæˆ‘ä»¬åªå…³å¿ƒç”¨æˆ·æœ€æ–°ä¸€æ¬¡ä¸ŠæŠ¥çš„ç»çº¬åº¦ã€‚AggregateFunction æ˜¯ä¸€ç§ UDF ç±»å‹ï¼Œé€šå¸¸æ˜¯ç”¨äºèšåˆæŒ‡æ ‡çš„ç»Ÿè®¡ï¼Œæ¯”å¦‚è®¡ç®— sum æˆ–è€… averageã€‚åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œç”±äºæˆ‘ä»¬åªå…³å¿ƒæœ€æ–°çš„ç»çº¬åº¦ï¼Œæ‰€ä»¥æ¯æ¬¡éƒ½æ›¿æ¢è€çš„æ•°æ®å³å¯ã€‚ å››. æœªæ¥å·¥ä½œçš„æ€è€ƒå’Œå±•æœ›æœ€åï¼Œç»™å¤§å®¶åˆ†äº«ä¸€ä¸‹å…³äºæœªæ¥å·¥ä½œï¼Œæˆ‘ä»¬çš„ä¸€äº›æ€è€ƒä¸è§„åˆ’ï¼Œè¿˜ä¸æ˜¯å¤ªæˆç†Ÿï¼ŒæŠ›å‡ºæ¥å’Œå¤§å®¶æ¢è®¨ä¸€ä¸‹ã€‚ 4.1. ç«¯åˆ°ç«¯çš„å®æ—¶æµå¤„ç†ä»€ä¹ˆæ˜¯ç«¯åˆ°ç«¯ï¼Ÿä¸€ç«¯æ˜¯é‡‡é›†åˆ°çš„åŸå§‹æ•°æ®ï¼Œå¦ä¸€ç«¯æ˜¯æŠ¥è¡¨ / æ ‡ç­¾ / æ¥å£è¿™äº›å¯¹æ•°æ®çš„å‘ˆç°ä¸åº”ç”¨ï¼Œè¿æ¥ä¸¤ç«¯çš„æ˜¯ä¸­é—´å®æ—¶æµã€‚å½“å‰æˆ‘ä»¬åŸºäº SQL çš„å®æ—¶æµå¤„ç†ï¼Œæºè¡¨æ˜¯ Kafkaï¼Œç›®æ ‡è¡¨ä¹Ÿæ˜¯ Kafkaï¼Œç»Ÿä¸€ç»è¿‡ Kafka åå†å¯¼å…¥åˆ° Druid/ES/HBaseã€‚è¿™æ ·è®¾è®¡çš„ç›®çš„æ˜¯æé«˜æ•´ä½“æµç¨‹çš„ç¨³å®šæ€§ä¸å¯ç”¨æ€§ï¼šé¦–å…ˆï¼Œkafka ä½œä¸ºä¸‹æ¸¸ç³»ç»Ÿçš„ç¼“å†²ï¼Œå¯ä»¥é¿å…ä¸‹æ¸¸ç³»ç»Ÿçš„å¼‚å¸¸å½±å“å®æ—¶æµçš„è®¡ç®—ï¼ˆä¸€ä¸ªç³»ç»Ÿä¿æŒç¨³å®šï¼Œæ¯”èµ·å¤šä¸ªç³»ç»ŸåŒæ—¶ç¨³å®šï¼Œæ¦‚ç‡ä¸Šæ›´é«˜ç‚¹ï¼‰ï¼›å…¶æ¬¡ï¼Œkafka åˆ° kafka çš„å®æ—¶æµï¼Œexactly-once è¯­ä¹‰æ˜¯æ¯”è¾ƒæˆç†Ÿçš„ï¼Œä¸€è‡´æ€§ä¸Šæœ‰ä¿è¯ã€‚ ç„¶åï¼Œä¸Šè¿°çš„ç«¯åˆ°ç«¯å…¶å®æ˜¯ç”±å‰²è£‚çš„ä¸‰ä¸ªæ­¥éª¤æ¥å®Œæˆçš„ï¼Œæ¯ä¸€æ­¥å¯èƒ½éœ€è¦ç”±ä¸åŒè§’è‰²äººå»è´Ÿè´£å¤„ç†ï¼šæ•°æ®å¤„ç†éœ€è¦æ•°æ®å¼€å‘äººå‘˜ï¼Œæ•°æ®å¯¼å…¥éœ€è¦å¼•æ“å¼€å‘äººå‘˜ï¼Œæ•°æ®èµ„äº§åŒ–éœ€è¦äº§å“å¼€å‘äººå‘˜ã€‚ æˆ‘ä»¬çš„å¹³å°èƒ½å¦æŠŠç«¯åˆ°ç«¯ç»™è‡ªåŠ¨åŒ–èµ·æ¥ï¼Œåªéœ€è¦ä¸€æ¬¡ SQL æäº¤å°±èƒ½æ‰“é€šå¤„ç†ã€å¯¼å…¥ã€èµ„äº§åŒ–è¿™ä¸‰æ­¥ï¼Ÿåœ¨è¿™ä¸ªæ€è·¯ä¸‹ï¼Œæ•°æ®å¼€å‘ä¸­çœ‹åˆ°çš„ä¸å†æ˜¯ Kafka Tableï¼Œè€Œåº”è¯¥æ˜¯é¢å‘åœºæ™¯çš„å±•ç¤ºè¡¨ / æ ‡ç­¾è¡¨ / æ¥å£è¡¨ã€‚æ¯”å¦‚å¯¹äºå±•ç¤ºè¡¨ï¼Œåˆ›å»ºè¡¨çš„æ—¶å€™åªè¦æŒ‡å®šç»´åº¦ã€æŒ‡æ ‡ç­‰å­—æ®µï¼Œå¹³å°ä¼šå°†å®æ—¶æµç»“æœæ•°æ®ä» Kafka è‡ªåŠ¨å¯¼å…¥ Druidï¼Œå†åœ¨æŠ¥è¡¨ç³»ç»Ÿè‡ªåŠ¨å¯¼å…¥ Druid æ•°æ®æºï¼Œç”šè‡³è‡ªåŠ¨ç”ŸæˆæŠ¥è¡¨æ¨¡æ¿ã€‚ 4.2. å®æ—¶æµçš„è¡€ç¼˜åˆ†æå…³äºè¡€ç¼˜åˆ†æï¼Œåšè¿‡ç¦»çº¿æ•°ä»“çš„æœ‹å‹éƒ½å¾ˆæ¸…æ¥šå®ƒçš„é‡è¦æ€§ï¼Œå®ƒåœ¨æ•°æ®æ²»ç†ä¸­éƒ½èµ·ç€ä¸å¯æˆ–ç¼ºçš„å…³é”®ä½œç”¨ã€‚å¯¹äºå®æ—¶æ•°ä»“æ¥è¯´ä¹Ÿè«ä¸å¦‚æ­¤ã€‚æˆ‘ä»¬å¸Œæœ›æ„å»ºç«¯åˆ°ç«¯çš„è¡€ç¼˜å…³ç³»ï¼Œä»é‡‡é›†ç³»ç»Ÿçš„æ¥å…¥é€šé“å¼€å§‹ï¼Œåˆ°ä¸­é—´æµç»çš„å®æ—¶è¡¨ä¸å®æ—¶ä½œä¸šï¼Œå†åˆ°æ¶ˆè´¹æ•°æ®çš„äº§å“ï¼Œéƒ½èƒ½å¾ˆæ¸…æ™°åœ°å±•ç°å‡ºæ¥ã€‚åŸºäºè¡€ç¼˜å…³ç³»çš„åˆ†æï¼Œæˆ‘ä»¬æ‰èƒ½è¯„ä¼°æ•°æ®çš„åº”ç”¨ä»·å€¼ï¼Œæ ¸ç®—æ•°æ®çš„è®¡ç®—æˆæœ¬ã€‚ 4.3. ç¦»çº¿ - å®æ—¶æ•°ä»“ä¸€ä½“åŒ–æœ€åæä¸€ä¸ªæ–¹å‘æ˜¯ç¦»çº¿å®æ—¶æ•°ä»“çš„ä¸€ä½“åŒ–ã€‚æˆ‘ä»¬è®¤ä¸ºçŸ­æœŸå†…ï¼Œå®æ—¶æ•°ä»“æ— æ³•æ›¿ä»£ç¦»çº¿æ•°ä»“ï¼Œä¸¤è€…å¹¶å­˜æ˜¯æ–°å¸¸æ€ã€‚åœ¨ç¦»çº¿æ•°ä»“æ—¶ä»£ï¼Œæˆ‘ä»¬ç§¯ç´¯çš„å·¥å…·ä½“ç³»ï¼Œå¦‚ä½•å»é€‚é…å®æ—¶æ•°ä»“ï¼Œå¦‚ä½•å®ç°ç¦»çº¿ä¸å®æ—¶æ•°ä»“çš„ä¸€ä½“åŒ–ç®¡ç†ï¼Ÿç†è®ºä¸Šæ¥è®²ï¼Œå®ƒä»¬çš„æ•°æ®æ¥æºæ˜¯ä¸€è‡´çš„ï¼Œä¸Šå±‚æŠ½è±¡ä¹Ÿéƒ½æ˜¯ Table ä¸ SQLï¼Œä½†æœ¬è´¨ä¸Šä¹Ÿæœ‰ä¸åŒçš„ç‚¹ï¼Œæ¯”å¦‚æ—¶é—´ç²’åº¦ä»¥åŠè®¡ç®—æ¨¡å¼ã€‚å¯¹äºæ•°æ®å·¥å…·ä¸äº§å“æ¥è¯´ï¼Œéœ€è¦åšå“ªäº›æ”¹é€ æ¥å®ç°å®Œå…¨çš„ä¸€ä½“åŒ–ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬åœ¨æ¢ç´¢å’Œæ€è€ƒçš„ã€‚ æœ€åGitHub Flink å­¦ä¹ ä»£ç åœ°å€ï¼šhttps://github.com/zhisheng17/flink-learning å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ ä¸“æ ä»‹ç»é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€åŸç†ã€å®æˆ˜ã€æ€§èƒ½è°ƒä¼˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ","date":"2019-06-14T16:00:00.000Z","path":"2019/06/15/Stream-processing/","text":"æœ¬æ–‡æ•´ç†è‡ª Flink åˆ›å§‹å…¬å¸ dataArtisansï¼ˆç°åœ¨ä¸ºVervericaï¼‰ è”åˆåˆ›å§‹äººå…¼ CTO Stephan Ewen åœ¨ Flink Forward China 2018 ä¸Šçš„æ¼”è®²ã€ŠStream Processing takes on Everythingã€‹ã€‚è¿™ä¸ªæ¼”è®²ä¸»é¢˜çœ‹ä¼¼æ¯”è¾ƒæ¿€è¿›ï¼šæµå¤„ç†è§£å†³æ‰€æœ‰é—®é¢˜ã€‚å¾ˆå¤šäººå¯¹äº Flink å¯èƒ½è¿˜åœç•™åœ¨æœ€åˆçš„è®¤çŸ¥ï¼Œè§‰å¾— Flink æ˜¯ä¸€ä¸ªæµå¤„ç†å¼•æ“ï¼Œå®é™…ä¸Š Flink å¯ä»¥åšå¾ˆå¤šå…¶ä»–çš„å·¥ä½œï¼Œæ¯”å¦‚æ‰¹å¤„ç†ã€åº”ç”¨ç¨‹åºã€‚åœ¨è¿™ä¸ªæ¼”è®²ä¸­ï¼ŒStephan é¦–å…ˆä¼šç®€å•è¯´æ˜ä»–å¯¹ Flink åŠŸèƒ½çš„è§‚ç‚¹ï¼Œç„¶åæ·±å…¥ä»‹ç»ä¸€ä¸ªç‰¹å®šé¢†åŸŸçš„åº”ç”¨å’Œäº‹ä»¶å¤„ç†åœºæ™¯ã€‚è¿™ä¸ªåœºæ™¯ä¹çœ‹èµ·æ¥ä¸æ˜¯ä¸€ä¸ªæµå¤„ç†çš„ä½¿ç”¨åœºæ™¯ï¼Œä½†æ˜¯åœ¨ Stephan çœ‹æ¥ï¼Œå®ƒå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªå¾ˆæœ‰è¶£çš„æµå¤„ç†ä½¿ç”¨åœºæ™¯ã€‚ æœ¬æ–‡è½¬è‡ª AI å‰çº¿å…¬ä¼—å·ï¼Œä½œè€…ï½œStephan Ewenï¼Œç­–åˆ’ç¼–è¾‘ï½œNatalieï¼Œç¼–è¾‘ï½œDebraï¼Œæ•´ç†ï½œç§¦æ±Ÿæ° ä¸Šå›¾å¯¹ä¸ºä»€ä¹ˆæµå¤„ç†å¯ä»¥å¤„ç†ä¸€åˆ‡ä½œå‡ºè¯ é‡Šï¼Œå°†æ•°æ®çœ‹åšæµæ˜¯ä¸€ä¸ªè‡ªç„¶è€Œåˆååˆ†å¼ºå¤§çš„æƒ³æ³•ã€‚å¤§éƒ¨åˆ†æ•°æ®çš„äº§ç”Ÿè¿‡ç¨‹éƒ½æ˜¯éšæ—¶é—´ç”Ÿæˆçš„æµï¼Œæ¯”å¦‚ä¸€ä¸ª Petabyte çš„æ•°æ®ä¸ä¼šå‡­ç©ºäº§ç”Ÿã€‚è¿™äº›æ•°æ®é€šå¸¸éƒ½æ˜¯ä¸€äº›äº‹ä»¶çš„ç§¯ç´¯ï¼Œæ¯”å¦‚æ”¯ä»˜ã€å°†å•†å“æ”¾å…¥è´­ç‰©è½¦ï¼Œç½‘é¡µæµè§ˆï¼Œä¼ æ„Ÿå™¨é‡‡æ ·è¾“å‡ºï¼Œ åŸºäºæ•°æ®æ˜¯æµçš„æƒ³æ³•ï¼Œæˆ‘ä»¬å¯¹æ•°æ®å¤„ç†å¯ä»¥æœ‰ç›¸åº”çš„ç†è§£ã€‚æ¯”å¦‚å°†è¿‡å»çš„å†å²æ•°æ®çœ‹åšæ˜¯ä¸€ä¸ªæˆªæ­¢åˆ°æŸä¸€æ—¶åˆ»çš„æœ‰é™çš„æµï¼Œæˆ–æ˜¯å°†ä¸€ä¸ªå®æ—¶å¤„ç†åº”ç”¨çœ‹æˆæ˜¯ä»æŸä¸€ä¸ªæ—¶åˆ»å¼€å§‹å¤„ç†æœªæ¥åˆ°è¾¾çš„æ•°æ®ã€‚å¯èƒ½åœ¨æœªæ¥æŸä¸ªæ—¶åˆ»å®ƒä¼šåœæ­¢ï¼Œé‚£ä¹ˆå®ƒå°±å˜æˆäº†å¤„ç†ä»å¼€å§‹æ—¶åˆ»åˆ°åœæ­¢æ—¶åˆ»çš„æœ‰é™æ•°æ®çš„æ‰¹å¤„ç†ã€‚å½“ç„¶ï¼Œå®ƒä¹Ÿæœ‰å¯èƒ½ä¸€ç›´è¿è¡Œä¸‹å»ï¼Œä¸æ–­å¤„ç†æ–°åˆ°è¾¾çš„æ•°æ®ã€‚è¿™ä¸ªå¯¹æ•°æ®çš„é‡è¦ç†è§£æ–¹å¼éå¸¸å¼ºå¤§ï¼ŒåŸºäºè¿™ä¸€ç†è§£ï¼ŒFlink å¯ä»¥æ”¯æŒæ•´ä¸ªæ•°æ®å¤„ç†èŒƒç•´å†…çš„æ‰€æœ‰åœºæ™¯ã€‚ æœ€å¹¿ä¸ºäººçŸ¥çš„ Flink ä½¿ç”¨åœºæ™¯æ˜¯æµåˆ†æã€è¿ç»­å¤„ç†ï¼ˆæˆ–è€…è¯´æ¸è¿›å¼å¤„ç†ï¼‰ï¼Œè¿™äº›åœºæ™¯ä¸­ Flink å®æ—¶æˆ–è€…è¿‘å®æ—¶çš„å¤„ç†æ•°æ®ï¼Œæˆ–è€…é‡‡é›†ä¹‹å‰æåˆ°çš„å†å²æ•°æ®å¹¶ä¸”è¿ç»­çš„å¯¹è¿™äº›äº‹ä»¶è¿›è¡Œè®¡ç®—ã€‚æ™“ä¼Ÿåœ¨ä¹‹å‰çš„æ¼”è®²ä¸­æåˆ°ä¸€ä¸ªéå¸¸å¥½çš„ä¾‹å­æ¥è¯´æ˜æ€ä¹ˆæ ·é€šè¿‡å¯¹ Flink è¿›è¡Œä¸€äº›ä¼˜åŒ–ï¼Œè¿›è€Œå¯ä»¥é’ˆå¯¹æœ‰é™æ•°æ®é›†åšä¸€äº›ç‰¹åˆ«çš„å¤„ç†ï¼Œè¿™ä½¿å¾— Flink èƒ½å¤Ÿå¾ˆå¥½çš„æ”¯æŒæ‰¹å¤„ç†çš„åœºæ™¯ï¼Œä»æ€§èƒ½ä¸Šæ¥è¯´èƒ½å¤Ÿä¸æœ€å…ˆè¿›çš„æ‰¹å¤„ç†å¼•æ“ç›¸åª²ç¾ã€‚è€Œåœ¨è¿™æ ¹è½´çš„å¦ä¸€å¤´ï¼Œæ˜¯æˆ‘ä»Šå¤©çš„æ¼”è®²å°†è¦è¯´æ˜çš„åœºæ™¯ â€“ äº‹ä»¶é©±åŠ¨çš„åº”ç”¨ã€‚è¿™ç±»åº”ç”¨æ™®éå­˜åœ¨äºä»»ä½•æœåŠ¡æˆ–è€…å¾®æœåŠ¡çš„æ¶æ„ä¸­ã€‚è¿™ç±»åº”ç”¨æ¥æ”¶å„ç±»äº‹ä»¶ï¼ˆå¯èƒ½æ˜¯ RPC è°ƒç”¨ã€HTTP è¯·æ±‚ï¼‰ï¼Œå¹¶ä¸”å¯¹è¿™äº›äº‹ä»¶ä½œå‡ºä¸€äº›å“åº”ï¼Œæ¯”å¦‚æŠŠå•†å“æ”¾è¿›è´­ç‰©è½¦ï¼Œæˆ–è€…åŠ å…¥ç¤¾äº¤ç½‘ç»œä¸­çš„æŸä¸ªç¾¤ç»„ã€‚ åœ¨æˆ‘è¿›ä¸€æ­¥å±•å¼€ä»Šå¤©çš„æ¼”è®²ä¹‹å‰ï¼Œæˆ‘æƒ³å…ˆå¯¹ç¤¾åŒºåœ¨ Flink çš„ä¼ ç»Ÿé¢†åŸŸï¼ˆå®æ—¶åˆ†æã€è¿ç»­å¤„ç†ï¼‰è¿‘æœŸæ‰€åšçš„å·¥ä½œåšä¸€ä¸ªä»‹ç»ã€‚Flink 1.7 åœ¨ 2018 å¹´ 11 æœˆ 30 æ—¥å·²ç»å‘å¸ƒã€‚åœ¨ Flink 1.7 ä¸­ä¸ºå…¸å‹çš„æµå¤„ç†åœºæ™¯åŠ å…¥äº†ä¸€äº›éå¸¸æœ‰è¶£çš„åŠŸèƒ½ã€‚æ¯”å¦‚æˆ‘ä¸ªäººéå¸¸æ„Ÿå…´è¶£çš„åœ¨æµå¼ SQL ä¸­å¸¦æ—¶é—´ç‰ˆæœ¬çš„ Joinã€‚ä¸€ä¸ªåŸºæœ¬æƒ³æ³•æ˜¯æœ‰ä¸¤ä¸ªä¸åŒçš„æµï¼Œå…¶ä¸­ä¸€ä¸ªæµè¢«å®šä¹‰ä¸ºéšæ—¶é—´å˜åŒ–çš„å‚ç…§è¡¨ï¼Œå¦ä¸€ä¸ªæ˜¯ä¸å‚ç…§è¡¨è¿›è¡Œ Join çš„äº‹ä»¶æµã€‚æ¯”å¦‚äº‹ä»¶æµæ˜¯ä¸€ä¸ªè®¢å•æµï¼Œå‚ç…§è¡¨æ˜¯ä¸æ–­è¢«æ›´æ–°çš„æ±‡ç‡ï¼Œè€Œæ¯ä¸ªè®¢å•éœ€è¦ä½¿ç”¨æœ€æ–°çš„æ±‡ç‡æ¥è¿›è¡Œæ¢ç®—ï¼Œå¹¶å°†æ¢ç®—çš„ç»“æœè¾“å‡ºåˆ°ç»“æœè¡¨ã€‚è¿™ä¸ªä¾‹å­åœ¨æ ‡å‡†çš„ SQL å½“ä¸­å®é™…ä¸Šå¹¶ä¸å®¹æ˜“è¡¨è¾¾ï¼Œä½†åœ¨æˆ‘ä»¬å¯¹ Streaming SQL åšäº†ä¸€ç‚¹å°çš„æ‰©å±•ä»¥åï¼Œè¿™ä¸ªé€»è¾‘è¡¨è¾¾å˜å¾—éå¸¸ç®€å•ï¼Œæˆ‘ä»¬å‘ç°è¿™æ ·çš„è¡¨è¾¾æœ‰éå¸¸å¤šçš„åº”ç”¨åœºæ™¯ã€‚ å¦ä¸€ä¸ªåœ¨æµå¤„ç†é¢†åŸŸååˆ†å¼ºå¤§çš„æ–°åŠŸèƒ½æ˜¯å°†å¤æ‚äº‹ä»¶å¤„ç†ï¼ˆCEPï¼‰å’Œ SQL ç›¸ç»“åˆã€‚CEP åº”ç”¨è§‚å¯Ÿäº‹ä»¶æ¨¡å¼ã€‚æ¯”å¦‚æŸä¸ª CEP åº”ç”¨è§‚å¯Ÿè‚¡å¸‚ï¼Œå½“æœ‰ä¸¤ä¸ªä¸Šæ¶¨åç´§è·Ÿä¸€ä¸ªä¸‹è·Œæ—¶ï¼Œè¿™ä¸ªåº”ç”¨å¯èƒ½åšäº›äº¤æ˜“ã€‚å†æ¯”å¦‚ä¸€ä¸ªè§‚å¯Ÿæ¸©åº¦è®¡çš„åº”ç”¨ï¼Œå½“å®ƒå‘ç°æœ‰æ¸©åº¦è®¡åœ¨ä¸¤ä¸ªè¶…è¿‡ 90 æ‘„æ°åº¦çš„è¯»æ•°ä¹‹åçš„ä¸¤åˆ†é’Ÿé‡Œæ²¡æœ‰ä»»ä½•æ“ä½œï¼Œå¯èƒ½ä¼šè¿›è¡Œä¸€äº›æ“ä½œã€‚ä¸ SQL çš„ç»“åˆä½¿è¿™ç±»é€»è¾‘çš„è¡¨è¾¾ä¹Ÿå˜å¾—éå¸¸ç®€å•ã€‚ ç¬¬ä¸‰ä¸ª Flink 1.7 ä¸­åšäº†å¾ˆå¤šå·¥ä½œçš„åŠŸèƒ½æ˜¯ Schema å‡çº§ã€‚è¿™ä¸ªåŠŸèƒ½å’ŒåŸºäºæµçš„åº”ç”¨ç´§å¯†ç›¸å…³ã€‚å°±åƒä½ å¯ä»¥å¯¹æ•°æ®åº“è¿›è¡Œæ•°æ® Schema å‡çº§ä¸€æ ·ï¼Œä½ å¯ä»¥ä¿®æ”¹ Flink è¡¨ä¸­åˆ—çš„ç±»å‹æˆ–è€…é‡æ–°å†™ä¸€ä¸ªåˆ—ï¼Œ å¦å¤–æˆ‘æƒ³ç®€å•ä»‹ç»çš„æ˜¯æµå¤„ç†æŠ€æœ¯ä¸ä»…ä»…æ˜¯ç®€å•å¯¹æ•°æ®è¿›è¡Œè®¡ç®—ï¼Œè¿™è¿˜åŒ…æ‹¬äº†å¾ˆå¤šä¸å¤–éƒ¨ç³»ç»Ÿè¿›è¡Œäº‹åŠ¡äº¤äº’ã€‚æµå¤„ç†å¼•æ“éœ€è¦åœ¨é‡‡ç”¨ä¸åŒåè®®çš„ç³»ç»Ÿä¹‹é—´ä»¥äº‹åŠ¡çš„æ–¹å¼ç§»åŠ¨æ•°æ®ï¼Œå¹¶ä¿è¯è®¡ç®—è¿‡ç¨‹å’Œæ•°æ®çš„ä¸€è‡´æ€§ã€‚è¿™ä¸€éƒ¨åˆ†åŠŸèƒ½ä¹Ÿæ˜¯åœ¨ Flink 1.7 ä¸­å¾—åˆ°äº†å¢å¼ºã€‚ ä»¥ä¸Šæˆ‘å¯¹ Flink 1.7 çš„æ–°åŠŸèƒ½å‘å¤§å®¶åšäº†ç®€å•æ€»ç»“ã€‚ä¸‹é¢è®©æˆ‘ä»¬æ¥çœ‹çœ‹ä»Šå¤©æˆ‘æ¼”è®²çš„ä¸»è¦éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯åˆ©ç”¨ Flink æ¥æ­å»ºåº”ç”¨å’ŒæœåŠ¡ã€‚æˆ‘å°†è¯´æ˜ä¸ºä»€ä¹ˆæµå¤„ç†æ˜¯ä¸€ä¸ªæ­å»ºåº”ç”¨å’ŒæœåŠ¡æˆ–è€…å¾®æœåŠ¡çš„æœ‰è¶£æŠ€æœ¯ã€‚ æˆ‘å°†ä»å·¦è¾¹è¿™ä¸ªé«˜åº¦ç®€åŒ–çš„å›¾è¯´èµ·ï¼Œæˆ‘ä»¬ä¸€ä¼šå„¿å°†èŠä¸€äº›å…¶ä¸­çš„ç»†èŠ‚ã€‚é¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªç†è§£åº”ç”¨ç®€å•çš„è§†è§’ã€‚å¦‚å·¦å›¾æ‰€ç¤ºï¼Œä¸€ä¸ªåº”ç”¨å¯ä»¥æ˜¯ä¸€ä¸ª Containerï¼Œä¸€ä¸ª Spring åº”ç”¨ï¼Œæˆ–è€… Java åº”ç”¨ã€Ruby åº”ç”¨ï¼Œç­‰ç­‰ã€‚è¿™ä¸ªåº”ç”¨ä»è¯¸å¦‚ RPCï¼ŒHTTP ç­‰æ¸ é“æ¥æ”¶è¯·æ±‚ï¼Œç„¶åä¾æ®è¯·æ±‚è¿›è¡Œæ•°æ®åº“å˜æ›´ã€‚è¿™ä¸ªåº”ç”¨ä¹Ÿå¯èƒ½è°ƒç”¨å¦ä¸€ä¸ªå¾®æœåŠ¡å¹¶è¿›è¡Œä¸‹ä¸€æ­¥çš„å¤„ç†ã€‚æˆ‘ä»¬å¯ä»¥éå¸¸è‡ªç„¶çš„æƒ³åˆ°è¿›å…¥åˆ°åº”ç”¨çš„è¿™äº›è¯·æ±‚å¯ä»¥çœ‹åšæ˜¯ä¸ªäº‹ä»¶ç»„æˆçš„åºåˆ—ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠŠå®ƒä»¬çœ‹åšæ˜¯äº‹ä»¶æµã€‚å¯èƒ½è¿™äº›äº‹ä»¶è¢«ç¼“å­˜åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œè€Œåº”ç”¨ä¼šä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ¶ˆè´¹è¿™äº›äº‹ä»¶è¿›è¡Œå¤„ç†ï¼Œå½“åº”ç”¨éœ€è¦å“åº”ä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œå®ƒå°†ç»“æœè¾“å‡ºåˆ°å¦ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œè€Œè¯·æ±‚å‘é€æ–¹å¯ä»¥ä»è¿™ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ä¸­æ¶ˆè´¹å¾—åˆ°æ‰€å‘é€è¯·æ±‚çš„å“åº”ã€‚åœ¨è¿™å¼ å›¾ä¸­æˆ‘ä»¬å·²ç»å¯ä»¥çœ‹åˆ°ä¸€äº›æœ‰è¶£çš„ä¸åŒã€‚ ç¬¬ä¸€ä¸ªä¸åŒæ˜¯åœ¨è¿™å¼ å›¾ä¸­åº”ç”¨å’Œæ•°æ®åº“ä¸å†æ˜¯åˆ†å¼€çš„ä¸¤ä¸ªå®ä½“ï¼Œè€Œæ˜¯è¢«ä¸€ä¸ªæœ‰çŠ¶æ€çš„æµå¤„ç†åº”ç”¨æ‰€ä»£æ›¿ã€‚æ‰€ä»¥åœ¨æµå¤„ç†åº”ç”¨çš„æ¶æ„ä¸­ï¼Œä¸å†æœ‰åº”ç”¨å’Œæ•°æ®åº“çš„è¿æ¥äº†ï¼Œå®ƒä»¬è¢«æ”¾åˆ°äº†ä¸€èµ·ã€‚è¿™ä¸ªåšæ³•æœ‰åˆ©æœ‰å¼Šï¼Œä½†å…¶ä¸­æœ‰äº›å¥½å¤„æ˜¯éå¸¸é‡è¦çš„ã€‚é¦–å…ˆæ˜¯æ€§èƒ½ä¸Šçš„å¥½å¤„æ˜¯æ˜æ˜¾çš„ï¼Œå› ä¸ºåº”ç”¨ä¸å†éœ€è¦å’Œæ•°æ®åº“è¿›è¡Œäº¤äº’ï¼Œå¤„ç†å¯ä»¥åŸºäºå†…å­˜ä¸­çš„å˜é‡è¿›è¡Œã€‚å…¶æ¬¡è¿™ç§åšæ³•æœ‰å¾ˆå¥½å¹¶ä¸”å¾ˆç®€å•çš„ä¸€è‡´æ€§ã€‚ è¿™å¼ å›¾è¢«ç®€åŒ–äº†å¾ˆå¤šï¼Œå®é™…ä¸Šæˆ‘ä»¬é€šå¸¸ä¼šæœ‰å¾ˆå¤šä¸ªåº”ç”¨ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªè¢«éš”ç¦»çš„åº”ç”¨ï¼Œå¾ˆå¤šæƒ…å†µä¸‹ä½ çš„åº”ç”¨ä¼šæ›´ç¬¦åˆè¿™å¼ å›¾ã€‚ç³»ç»Ÿä¸­æœ‰ä¸ªæ¥æ”¶è¯·æ±‚çš„æ¥å£ï¼Œç„¶åè¯·æ±‚è¢«å‘é€åˆ°ç¬¬ä¸€ä¸ªåº”ç”¨ï¼Œå¯èƒ½ä¼šå†è¢«å‘åˆ°å¦ä¸€ä¸ªåº”ç”¨ï¼Œç„¶åå¾—åˆ°ç›¸åº”ã€‚åœ¨å›¾ä¸­æœ‰äº›åº”ç”¨ä¼šæ¶ˆè´¹ä¸­é—´ç»“æœçš„æµã€‚è¿™å¼ å›¾å·²ç»å±•ç¤ºäº†ä¸ºä»€ä¹ˆæµå¤„ç†æ˜¯æ›´é€‚åˆæ¯”è¾ƒå¤æ‚çš„å¾®æœåŠ¡åœºæ™¯çš„æŠ€æœ¯ã€‚å› ä¸ºå¾ˆå¤šæ—¶å€™ç³»ç»Ÿä¸­ä¸ä¼šæœ‰ä¸€ä¸ªç›´æ¥æ¥æ”¶ç”¨æˆ·è¯·æ±‚å¹¶ç›´æ¥å“åº”çš„æœåŠ¡ï¼Œé€šå¸¸æ¥è¯´ä¸€ä¸ªå¾®æœåŠ¡éœ€è¦è·Ÿå…¶ä»–å¾®æœåŠ¡é€šä¿¡ã€‚è¿™æ­£å¦‚åœ¨æµå¤„ç†çš„æ¶æ„ä¸­ä¸åŒåº”ç”¨åœ¨åˆ›å»ºè¾“å‡ºæµï¼ŒåŒæ—¶åŸºäºè¡ç”Ÿå‡ºçš„æµå†åˆ›å»ºå¹¶è¾“å‡ºæ–°çš„æµã€‚ åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬çœ‹åˆ°çš„å†…å®¹å¤šå°‘è¿˜æ¯”è¾ƒç›´è§‚ã€‚è€Œå¯¹åŸºäºæµå¤„ç†æŠ€æœ¯çš„å¾®æœåŠ¡æ¶æ„è€Œè¨€ï¼Œäººä»¬æœ€å¸¸é—®çš„ä¸€ä¸ªé—®é¢˜æ˜¯å¦‚ä½•ä¿è¯äº‹åŠ¡æ€§ï¼Ÿå¦‚æœç³»ç»Ÿä¸­ä½¿ç”¨çš„æ˜¯æ•°æ®åº“ï¼Œé€šå¸¸æ¥è¯´éƒ½ä¼šæœ‰éå¸¸æˆç†Ÿå¤æ‚çš„æ•°æ®æ ¡éªŒå’Œäº‹åŠ¡æ¨¡å‹ã€‚è¿™ä¹Ÿæ˜¯æ•°æ®åº“åœ¨è¿‡å»è®¸å¤šå¹´ä¸­ååˆ†æˆåŠŸçš„åŸå› ã€‚å¼€å§‹ä¸€ä¸ªäº‹åŠ¡ï¼Œå¯¹æ•°æ®åšä¸€äº›æ“ä½œï¼Œæäº¤æˆ–è€…æ’¤é”€ä¸€ä¸ªäº‹åŠ¡ã€‚è¿™ä¸ªæœºåˆ¶ä½¿å¾—æ•°æ®å®Œæ•´æ€§å¾—åˆ°äº†ä¿è¯ï¼ˆä¸€è‡´æ€§ï¼ŒæŒä¹…æ€§ç­‰ç­‰ï¼‰ã€‚ é‚£ä¹ˆåœ¨æµå¤„ç†ä¸­æˆ‘ä»¬æ€ä¹ˆåšåˆ°åŒæ ·çš„äº‹æƒ…å‘¢ï¼Ÿä½œä¸ºä¸€ä¸ªä¼˜ç§€çš„æµå¤„ç†å¼•æ“ï¼ŒFlink æ”¯æŒäº†æ°å¥½ä¸€æ¬¡è¯­ä¹‰ï¼Œä¿è¯äº†æ¯ä¸ªäº‹ä»¶åªä¼šè¢«å¤„ç†ä¸€éã€‚ä½†æ˜¯è¿™ä¾ç„¶å¯¹æŸäº›æ“ä½œæœ‰é™åˆ¶ï¼Œè¿™ä¹Ÿæˆä¸ºäº†ä½¿ç”¨æµå¤„ç†åº”ç”¨çš„ä¸€ä¸ªéšœç¢ã€‚æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªéå¸¸ç®€å•æµå¤„ç†åº”ç”¨ä¾‹å­æ¥çœ‹æˆ‘ä»¬å¯ä»¥åšä¸€äº›ä»€ä¹ˆæ‰©å±•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬ä¼šçœ‹åˆ°ï¼Œè§£å†³åŠæ³•å…¶å®å‡ºå¥‡çš„ç®€å•ã€‚ è®©æˆ‘ä»¬ä»¥è¿™ä¸ªæ•™ç§‘ä¹¦å¼çš„äº‹åŠ¡ä¸ºä¾‹å­æ¥çœ‹ä¸€ä¸‹äº‹åŠ¡æ€§åº”ç”¨çš„è¿‡ç¨‹ã€‚è¿™ä¸ªç³»ç»Ÿç»´æŠ¤äº†è´¦æˆ·å’Œå…¶ä¸­å­˜æ¬¾ä½™é¢çš„ä¿¡æ¯ã€‚è¿™æ ·çš„ä¿¡æ¯å¯èƒ½æ˜¯é“¶è¡Œæˆ–è€…åœ¨çº¿æ”¯ä»˜ç³»ç»Ÿçš„åœºæ™¯ä¸­ç”¨åˆ°çš„ã€‚å‡è®¾æˆ‘ä»¬æƒ³è¦å¤„ç†ç±»ä¼¼ä¸‹é¢çš„äº‹åŠ¡ï¼šå¦‚æœè´¦æˆ· A ä¸­çš„ä½™é¢å¤§äº 100ï¼Œé‚£ä¹ˆä»è´¦æˆ· A ä¸­è½¬è´¦ 50 å…ƒåˆ°è´¦æˆ· Bã€‚è¿™æ˜¯ä¸ªéå¸¸ç®€å•çš„ä¸¤ä¸ªè´¦æˆ·ä¹‹é—´è¿›è¡Œè½¬è´¦çš„ä¾‹å­ã€‚ æ•°æ®åº“å¯¹äºè¿™æ ·çš„äº‹åŠ¡å·²ç»æœ‰äº†ä¸€ä¸ªæ ¸å¿ƒçš„èŒƒå¼ï¼Œä¹Ÿå°±æ˜¯åŸå­æ€§ï¼Œä¸€è‡´æ€§ï¼Œéš”ç¦»æ€§å’ŒæŒä¹…æ€§ï¼ˆACIDï¼‰ã€‚è¿™æ˜¯èƒ½å¤Ÿè®©ç”¨æˆ·æ”¾å¿ƒä½¿ç”¨äº‹åŠ¡çš„å‡ ä¸ªåŸºæœ¬ä¿è¯ã€‚æœ‰äº†ä»–ä»¬ï¼Œç”¨æˆ·ä¸ç”¨æ‹…å¿ƒé’±åœ¨è½¬è´¦è¿‡ç¨‹ä¸­ä¼šä¸¢å¤±æˆ–è€…å…¶ä»–é—®é¢˜ã€‚è®©æˆ‘ä»¬ç”¨è¿™ä¸ªä¾‹å­æ¥æ”¾åˆ°æµå¤„ç†åº”ç”¨ä¸­ï¼Œæ¥è®©æµå¤„ç†åº”ç”¨ä¹Ÿèƒ½æä¾›å’Œæ•°æ®ç›¸åŒçš„ ACID æ”¯æŒï¼š åŸå­æ€§è¦æ±‚ä¸€ä¸ªè½¬è´¦è¦ä¸å°±å®Œå…¨å®Œæˆï¼Œä¹Ÿå°±æ˜¯è¯´è½¬è´¦é‡‘é¢ä»ä¸€ä¸ªè´¦æˆ·å‡å°‘ï¼Œå¹¶å¢åŠ åˆ°å¦ä¸€ä¸ªè´¦æˆ·ï¼Œè¦ä¸å°±ä¸¤ä¸ªè´¦æˆ·çš„ä½™é¢éƒ½æ²¡æœ‰å˜åŒ–ã€‚è€Œä¸ä¼šåªæœ‰ä¸€ä¸ªè´¦æˆ·ä½™é¢æ”¹å˜ã€‚å¦åˆ™çš„è¯é’±å°±ä¼šå‡­ç©ºå‡å°‘æˆ–è€…å‡­ç©ºå¢åŠ ã€‚ ä¸€è‡´æ€§å’Œéš”ç¦»æ€§æ˜¯è¯´å¦‚æœæœ‰å¾ˆå¤šç”¨æˆ·åŒæ—¶æƒ³è¦è¿›è¡Œè½¬è´¦ï¼Œé‚£ä¹ˆè¿™äº›è½¬è´¦è¡Œä¸ºä¹‹é—´åº”è¯¥äº’ä¸å¹²æ‰°ï¼Œæ¯ä¸ªè½¬è´¦è¡Œä¸ºåº”è¯¥è¢«ç‹¬ç«‹çš„å®Œæˆï¼Œå¹¶ä¸”å®Œæˆåæ¯ä¸ªè´¦æˆ·çš„ä½™é¢åº”è¯¥æ˜¯æ­£ç¡®çš„ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœä¸¤ä¸ªç”¨æˆ·åŒæ—¶æ“ä½œåŒä¸€ä¸ªè´¦æˆ·ï¼Œç³»ç»Ÿä¸åº”è¯¥å‡ºé”™ã€‚ æŒä¹…æ€§æŒ‡çš„æ˜¯å¦‚æœä¸€ä¸ªæ“ä½œå·²ç»å®Œæˆï¼Œé‚£ä¹ˆè¿™ä¸ªæ“ä½œçš„ç»“æœä¼šè¢«å¦¥å–„çš„ä¿å­˜è€Œä¸ä¼šä¸¢å¤±ã€‚ æˆ‘ä»¬å‡è®¾æŒä¹…æ€§å·²ç»è¢«æ»¡è¶³ã€‚ä¸€ä¸ªæµå¤„ç†å™¨æœ‰çŠ¶æ€ï¼Œè¿™ä¸ªçŠ¶æ€ä¼šè¢« checkpointï¼Œæ‰€ä»¥æµå¤„ç†å™¨çš„çŠ¶æ€æ˜¯å¯æ¢å¤çš„ã€‚ä¹Ÿå°±æ˜¯è¯´åªè¦æˆ‘ä»¬å®Œæˆäº†ä¸€ä¸ªä¿®æ”¹ï¼Œå¹¶ä¸”è¿™ä¸ªä¿®æ”¹è¢« checkpoint äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªä¿®æ”¹å°±æ˜¯æŒä¹…åŒ–çš„ã€‚ è®©æˆ‘ä»¬æ¥çœ‹çœ‹å¦å¤–ä¸‰ä¸ªä¾‹å­ã€‚è®¾æƒ³ä¸€ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬ç”¨æµå¤„ç†åº”ç”¨æ¥å®ç°è¿™æ ·ä¸€ä¸ªè½¬è´¦ç³»ç»Ÿä¼šå‘ç”Ÿä»€ä¹ˆã€‚æˆ‘ä»¬å…ˆæŠŠé—®é¢˜ç®€åŒ–ä¸€äº›ï¼Œå‡è®¾è½¬è´¦ä¸éœ€è¦æœ‰æ¡ä»¶ï¼Œä»…ä»…æ˜¯å°† 50 å…ƒä»è´¦æˆ· A è½¬åˆ°è´¦æˆ·ï¼Œä¹Ÿå°±æ˜¯è¯´è´¦æˆ· A çš„ä½™é¢å‡å°‘ 50 å…ƒè€Œè´¦æˆ· B çš„ä½™é¢å¢åŠ  50 å…ƒã€‚æˆ‘ä»¬çš„ç³»ç»Ÿæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„å¹¶è¡Œç³»ç»Ÿï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå•æœºç³»ç»Ÿã€‚ç®€å•èµ·è§æˆ‘ä»¬å‡è®¾ç³»ç»Ÿä¸­åªæœ‰ä¸¤å°æœºå™¨ï¼Œè¿™ä¸¤å°æœºå™¨å¯ä»¥æ˜¯ä¸åŒçš„ç‰©ç†æœºæˆ–è€…æ˜¯åœ¨ YARN æˆ–è€… Kubernetes ä¸Šä¸åŒçš„å®¹å™¨ã€‚æ€»ä¹‹å®ƒä»¬æ˜¯ä¸¤ä¸ªä¸åŒçš„æµå¤„ç†å™¨å®ä¾‹ï¼Œæ•°æ®åˆ†å¸ƒåœ¨è¿™ä¸¤ä¸ªæµå¤„ç†å™¨ä¸Šã€‚æˆ‘ä»¬å‡è®¾è´¦æˆ· A çš„æ•°æ®ç”±å…¶ä¸­ä¸€å°æœºå™¨ç»´æŠ¤ï¼Œè€Œè´¦æˆ· B çš„æ•°æ®æœ‰å¦ä¸€å°æœºå™¨ç»´æŠ¤ã€‚ ç°åœ¨æˆ‘ä»¬è¦åšä¸ªè½¬è´¦ï¼Œå°† 50 å…ƒä»è´¦æˆ· A è½¬ç§»åˆ°è´¦æˆ· Bï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªè¯·æ±‚æ”¾è¿›é˜Ÿåˆ—ä¸­ï¼Œç„¶åè¿™ä¸ªè½¬è´¦è¯·æ±‚è¢«åˆ†è§£ä¸ºå¯¹è´¦æˆ· A å’Œ B åˆ†åˆ«è¿›è¡Œæ“ä½œï¼Œå¹¶ä¸”æ ¹æ®é”®å°†è¿™ä¸¤ä¸ªæ“ä½œè·¯ç”±åˆ°ç»´æŠ¤è´¦æˆ· A å’Œç»´æŠ¤è´¦æˆ· B çš„è¿™ä¸¤å°æœºå™¨ä¸Šï¼Œè¿™ä¸¤å°æœºå™¨åˆ†åˆ«æ ¹æ®è¦æ±‚å¯¹è´¦æˆ· A å’Œè´¦æˆ· B çš„ä½™é¢è¿›è¡Œæ”¹åŠ¨ã€‚è¿™å¹¶ä¸æ˜¯äº‹åŠ¡æ“ä½œï¼Œè€Œåªæ˜¯ä¸¤ä¸ªç‹¬ç«‹æ— æ„ä¹‰çš„æ”¹åŠ¨ã€‚ä¸€æ—¦æˆ‘ä»¬å°†è½¬è´¦çš„è¯·æ±‚æ”¹çš„ç¨å¾®å¤æ‚ä¸€äº›å°±ä¼šå‘ç°é—®é¢˜ã€‚ ä¸‹é¢æˆ‘ä»¬å‡è®¾è½¬è´¦æ˜¯æœ‰æ¡ä»¶çš„ï¼Œæˆ‘ä»¬åªæƒ³åœ¨è´¦æˆ· A çš„ä½™é¢è¶³å¤Ÿçš„æƒ…å†µä¸‹æ‰è¿›è¡Œè½¬è´¦ï¼Œè¿™æ ·å°±å·²ç»æœ‰äº›ä¸å¤ªå¯¹äº†ã€‚å¦‚æœæˆ‘ä»¬è¿˜æ˜¯åƒä¹‹å‰é‚£æ ·æ“ä½œï¼Œå°†è¿™ä¸ªè½¬è´¦è¯·æ±‚åˆ†åˆ«å‘é€ç»™ç»´æŠ¤è´¦æˆ· A å’Œ B çš„ä¸¤å°æœºå™¨ï¼Œå¦‚æœ A æ²¡æœ‰è¶³å¤Ÿçš„ä½™é¢ï¼Œé‚£ä¹ˆ A çš„ä½™é¢ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œè€Œ B çš„ä½™é¢å¯èƒ½å·²ç»è¢«æ”¹åŠ¨äº†ã€‚æˆ‘ä»¬å°±è¿åäº†ä¸€è‡´æ€§çš„è¦æ±‚ã€‚ æˆ‘ä»¬çœ‹åˆ°æˆ‘ä»¬éœ€è¦é¦–å…ˆä»¥æŸç§æ–¹å¼ç»Ÿä¸€åšå‡ºæ˜¯å¦éœ€è¦æ›´æ”¹ä½™é¢çš„å†³å®šï¼Œå¦‚æœè¿™ä¸ªç»Ÿä¸€çš„å†³å®šä¸­ä½™é¢éœ€è¦è¢«ä¿®æ”¹ï¼Œæˆ‘ä»¬å†è¿›è¡Œä¿®æ”¹ä½™é¢çš„æ“ä½œã€‚æ‰€ä»¥æˆ‘ä»¬å…ˆç»™ç»´æŠ¤ A çš„ä½™é¢çš„æœºå™¨å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œè®©å®ƒæŸ¥çœ‹ A çš„ä½™é¢ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥å¯¹ B åšåŒæ ·çš„äº‹æƒ…ï¼Œä½†æ˜¯è¿™ä¸ªä¾‹å­é‡Œé¢æˆ‘ä»¬ä¸å…³å¿ƒ B çš„ä½™é¢ã€‚ç„¶åæˆ‘ä»¬æŠŠæ‰€æœ‰è¿™æ ·çš„æ¡ä»¶æ£€æŸ¥çš„è¯·æ±‚æ±‡æ€»èµ·æ¥å»æ£€éªŒæ¡ä»¶æ˜¯å¦æ»¡è¶³ã€‚å› ä¸º Flink è¿™æ ·çš„æµå¤„ç†å™¨æ”¯æŒè¿­ä»£ï¼Œå¦‚æœæ»¡è¶³è½¬è´¦æ¡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªä½™é¢æ”¹åŠ¨çš„æ“ä½œæ”¾è¿›è¿­ä»£çš„åé¦ˆæµå½“ä¸­æ¥å‘Šè¯‰å¯¹åº”çš„èŠ‚ç‚¹æ¥è¿›è¡Œä½™é¢ä¿®æ”¹ã€‚åä¹‹å¦‚æœæ¡ä»¶ä¸æ»¡è¶³ï¼Œé‚£ä¹ˆä½™é¢æ”¹åŠ¨çš„æ“ä½œå°†ä¸ä¼šè¢«æ”¾è¿›åé¦ˆæµã€‚è¿™ä¸ªä¾‹å­é‡Œé¢ï¼Œé€šè¿‡è¿™ç§æ–¹å¼æˆ‘ä»¬å¯ä»¥æ­£ç¡®çš„è¿›è¡Œè½¬è´¦æ“ä½œã€‚ä»æŸç§è§’åº¦ä¸Šæ¥è¯´æˆ‘ä»¬å®ç°äº†åŸå­æ€§ï¼ŒåŸºäºä¸€ä¸ªæ¡ä»¶æˆ‘ä»¬å¯ä»¥è¿›è¡Œå…¨éƒ¨çš„ä½™é¢ä¿®æ”¹ï¼Œæˆ–è€…ä¸è¿›è¡Œä»»ä½•ä½™é¢ä¿®æ”¹ã€‚è¿™éƒ¨åˆ†ä¾ç„¶è¿˜æ˜¯æ¯”è¾ƒç›´è§‚çš„ï¼Œæ›´å¤§çš„å›°éš¾æ˜¯åœ¨äºå¦‚ä½•åšåˆ°å¹¶å‘è¯·æ±‚çš„éš”ç¦»æ€§ã€‚ å‡è®¾æˆ‘ä»¬çš„ç³»ç»Ÿæ²¡æœ‰å˜ï¼Œä½†æ˜¯ç³»ç»Ÿä¸­æœ‰å¤šä¸ªå¹¶å‘çš„è¯·æ±‚ã€‚æˆ‘ä»¬åœ¨ä¹‹å‰çš„æ¼”è®²ä¸­å·²ç»çŸ¥é“ï¼Œè¿™æ ·çš„å¹¶å‘å¯èƒ½è¾¾åˆ°æ¯ç§’é’Ÿå‡ åäº¿æ¡ã€‚å¦‚å›¾ï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿå¯èƒ½ä»ä¸¤ä¸ªæµä¸­åŒæ—¶æ¥å—è¯·æ±‚ã€‚å¦‚æœè¿™ä¸¤ä¸ªè¯·æ±‚åŒæ—¶åˆ°è¾¾ï¼Œæˆ‘ä»¬åƒä¹‹å‰é‚£æ ·å°†æ¯ä¸ªè¯·æ±‚æ‹†åˆ†æˆå¤šä¸ªè¯·æ±‚ï¼Œé¦–å…ˆæ£€æŸ¥ä½™é¢æ¡ä»¶ï¼Œç„¶åè¿›è¡Œä½™é¢æ“ä½œã€‚ç„¶è€Œæˆ‘ä»¬å‘ç°è¿™ä¼šå¸¦æ¥é—®é¢˜ã€‚ç®¡ç†è´¦æˆ· A çš„æœºå™¨ä¼šé¦–å…ˆæ£€æŸ¥ A çš„ä½™é¢æ˜¯å¦å¤§äº 50ï¼Œç„¶ååˆä¼šæ£€æŸ¥ A çš„ä½™é¢æ˜¯å¦å¤§äº 100ï¼Œå› ä¸ºä¸¤ä¸ªæ¡ä»¶éƒ½æ»¡è¶³ï¼Œæ‰€ä»¥ä¸¤ç¬”è½¬è´¦æ“ä½œéƒ½ä¼šè¿›è¡Œï¼Œä½†å®é™…ä¸Šè´¦æˆ· A ä¸Šçš„ä½™é¢å¯èƒ½æ— æ³•åŒæ—¶å®Œæˆä¸¤ç¬”è½¬è´¦ï¼Œè€Œåªèƒ½å®Œæˆ 50 å…ƒæˆ–è€… 100 å…ƒçš„è½¬è´¦ä¸­çš„ä¸€ç¬”ã€‚è¿™é‡Œæˆ‘ä»¬éœ€è¦è¿›ä¸€æ­¥æ€è€ƒæ€ä¹ˆæ ·æ¥å¤„ç†å¹¶å‘çš„è¯·æ±‚ï¼Œæˆ‘ä»¬ä¸èƒ½åªæ˜¯ç®€å•åœ°å¹¶å‘å¤„ç†è¯·æ±‚ï¼Œè¿™ä¼šè¿åäº‹åŠ¡çš„ä¿è¯ã€‚ä»æŸç§è§’åº¦æ¥è¯´ï¼Œè¿™æ˜¯æ•´ä¸ªæ•°æ®åº“äº‹åŠ¡çš„æ ¸å¿ƒã€‚æ•°æ®åº“çš„ä¸“å®¶ä»¬èŠ±äº†ä¸€äº›æ—¶é—´æä¾›äº†ä¸åŒè§£å†³æ–¹æ¡ˆï¼Œæœ‰çš„æ–¹æ¡ˆæ¯”è¾ƒç®€å•ï¼Œæœ‰çš„åˆ™å¾ˆå¤æ‚ã€‚ä½†æ‰€æœ‰çš„æ–¹æ¡ˆéƒ½ä¸æ˜¯é‚£ä¹ˆå®¹æ˜“ï¼Œå°¤å…¶æ˜¯åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿå½“ä¸­ã€‚ åœ¨æµå¤„ç†ä¸­æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿç›´è§‰ä¸Šè®²ï¼Œå¦‚æœæˆ‘ä»¬èƒ½å¤Ÿè®©æ‰€æœ‰çš„äº‹åŠ¡éƒ½æŒ‰ç…§é¡ºåºä¾æ¬¡å‘ç”Ÿï¼Œé‚£ä¹ˆé—®é¢˜å°±è§£å†³äº†ï¼Œè¿™ä¹Ÿè¢«æˆä¸ºå¯åºåˆ—åŒ–çš„ç‰¹æ€§ã€‚ä½†æ˜¯æˆ‘ä»¬å½“ç„¶ä¸å¸Œæœ›æ‰€æœ‰çš„è¯·æ±‚éƒ½è¢«ä¾æ¬¡é¡ºåºå¤„ç†ï¼Œè¿™ä¸æˆ‘ä»¬ä½¿ç”¨åˆ†å¸ƒå¼ç³»ç»Ÿçš„åˆè¡·ç›¸è¿èƒŒã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¿è¯è¿™äº›è¯·æ±‚æœ€åçš„äº§ç”Ÿçš„å½±å“çœ‹èµ·æ¥æ˜¯æŒ‰ç…§é¡ºåºå‘ç”Ÿçš„ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªè¯·æ±‚äº§ç”Ÿçš„å½±å“æ˜¯åŸºäºå‰ä¸€ä¸ªè¯·æ±‚äº§ç”Ÿå½±å“çš„åŸºç¡€ä¹‹ä¸Šçš„ã€‚æ¢å¥è¯è¯´ä¹Ÿå°±æ˜¯ä¸€ä¸ªäº‹åŠ¡çš„ä¿®æ”¹éœ€è¦åœ¨å‰ä¸€ä¸ªäº‹åŠ¡çš„æ‰€æœ‰ä¿®æ”¹éƒ½å®Œæˆåæ‰èƒ½è¿›è¡Œã€‚è¿™ç§å¸Œæœ›ä¸€ä»¶äº‹åœ¨å¦ä¸€ä»¶äº‹ä¹‹åå‘ç”Ÿçš„è¦æ±‚çœ‹èµ·æ¥å¾ˆç†Ÿæ‚‰ï¼Œè¿™ä¼¼ä¹æ˜¯æˆ‘ä»¬ä»¥å‰åœ¨æµå¤„ç†ä¸­æ›¾ç»é‡åˆ°è¿‡çš„é—®é¢˜ã€‚æ˜¯çš„ï¼Œè¿™å¬ä¸Šå»åƒæ˜¯äº‹ä»¶æ—¶é—´ã€‚ç”¨é«˜åº¦ç®€åŒ–çš„æ–¹å¼æ¥è§£é‡Šï¼Œå¦‚æœæ‰€æœ‰çš„è¯·æ±‚éƒ½åœ¨ä¸åŒçš„äº‹ä»¶æ—¶é—´äº§ç”Ÿï¼Œå³ä½¿ç”±äºç§ç§åŸå› ä»–ä»¬åˆ°è¾¾å¤„ç†å™¨çš„æ—¶é—´æ˜¯ä¹±åºçš„ï¼Œæµå¤„ç†å™¨ä¾ç„¶ä¼šæ ¹æ®ä»–ä»¬çš„äº‹ä»¶æ—¶é—´æ¥å¯¹ä»–ä»¬è¿›è¡Œå¤„ç†ã€‚æµå¤„ç†å™¨ä¼šä½¿å¾—æ‰€æœ‰çš„äº‹ä»¶çš„å½±å“çœ‹ä¸Šå»éƒ½æ˜¯æŒ‰é¡ºåºå‘ç”Ÿçš„ã€‚æŒ‰äº‹ä»¶æ—¶é—´å¤„ç†æ˜¯ Flink å·²ç»æ”¯æŒçš„åŠŸèƒ½ã€‚ é‚£ä¹ˆè¯¦ç»†è¯´æ¥ï¼Œæˆ‘ä»¬åˆ°åº•æ€ä¹ˆè§£å†³è¿™ä¸ªä¸€è‡´æ€§é—®é¢˜å‘¢ï¼Ÿå‡è®¾æˆ‘ä»¬æœ‰å¹¶è¡Œçš„è¯·æ±‚è¾“å…¥å¹¶è¡Œçš„äº‹åŠ¡è¯·æ±‚ï¼Œè¿™äº›è¯·æ±‚è¯»å–æŸäº›è¡¨ä¸­çš„è®°å½•ï¼Œç„¶åä¿®æ”¹æŸäº›è¡¨ä¸­çš„è®°å½•ã€‚æˆ‘ä»¬é¦–å…ˆéœ€è¦åšçš„æ˜¯æŠŠè¿™äº›äº‹åŠ¡è¯·æ±‚æ ¹æ®äº‹ä»¶æ—¶é—´é¡ºåºæ‘†æ”¾ã€‚è¿™äº›è¯·æ±‚çš„äº‹åŠ¡æ—¶é—´ä¸èƒ½å¤Ÿç›¸åŒï¼Œä½†æ˜¯ä»–ä»¬ä¹‹é—´çš„æ—¶é—´ä¹Ÿéœ€è¦è¶³å¤Ÿæ¥è¿‘ï¼Œè¿™æ˜¯å› ä¸ºåœ¨äº‹ä»¶æ—¶é—´çš„å¤„ç†è¿‡ç¨‹ä¸­ä¼šå¼•å…¥ä¸€å®šçš„å»¶è¿Ÿï¼Œæˆ‘ä»¬éœ€è¦ä¿è¯æ‰€å¤„ç†çš„äº‹ä»¶æ—¶é—´åœ¨å‘å‰æ¨è¿›ã€‚å› æ­¤ç¬¬ä¸€æ­¥æ˜¯å®šä¹‰äº‹åŠ¡æ‰§è¡Œçš„é¡ºåºï¼Œä¹Ÿå°±æ˜¯è¯´éœ€è¦æœ‰ä¸€ä¸ªèªæ˜çš„ç®—æ³•æ¥ä¸ºæ¯ä¸ªäº‹åŠ¡åˆ¶å®šäº‹ä»¶æ—¶é—´ã€‚ åœ¨å›¾ä¸Šï¼Œå‡è®¾è¿™ä¸‰ä¸ªäº‹åŠ¡çš„äº‹ä»¶æ—¶é—´åˆ†åˆ«æ˜¯ T+2, T å’Œ T+1ã€‚é‚£ä¹ˆç¬¬äºŒä¸ªäº‹åŠ¡çš„å½±å“éœ€è¦åœ¨ç¬¬ä¸€å’Œç¬¬ä¸‰ä¸ªäº‹åŠ¡ä¹‹å‰ã€‚ä¸åŒçš„äº‹åŠ¡æ‰€åšçš„ä¿®æ”¹æ˜¯ä¸åŒçš„ï¼Œæ¯ä¸ªäº‹åŠ¡éƒ½ä¼šäº§ç”Ÿä¸åŒçš„æ“ä½œè¯·æ±‚æ¥ä¿®æ”¹çŠ¶æ€ã€‚æˆ‘ä»¬ç°åœ¨éœ€è¦å°†å¯¹è®¿é—®æ¯ä¸ªè¡Œå’ŒçŠ¶æ€çš„äº‹ä»¶è¿›è¡Œæ’åºï¼Œä¿è¯ä»–ä»¬çš„è®¿é—®æ˜¯ç¬¦åˆäº‹ä»¶æ—¶é—´é¡ºåºçš„ã€‚è¿™ä¹Ÿæ„å‘³ç€é‚£äº›ç›¸äº’ä¹‹é—´æ²¡æœ‰å…³ç³»çš„äº‹åŠ¡ä¹‹é—´è‡ªç„¶ä¹Ÿæ²¡æœ‰äº†ä»»ä½•å½±å“ã€‚æ¯”å¦‚è¿™é‡Œçš„ç¬¬ä¸‰ä¸ªäº‹åŠ¡è¯·æ±‚ï¼Œå®ƒä¸å‰ä¸¤ä¸ªäº‹åŠ¡ä¹‹é—´æ²¡æœ‰è®¿é—®å…±åŒçš„çŠ¶æ€ï¼Œæ‰€ä»¥å®ƒçš„äº‹ä»¶æ—¶é—´æ’åºä¸å‰ä¸¤ä¸ªäº‹åŠ¡ä¹Ÿç›¸äº’ç‹¬ç«‹ã€‚è€Œå½“å‰ä¸¤ä¸ªäº‹åŠ¡ä¹‹é—´çš„æ“ä½œçš„åˆ°è¾¾é¡ºåºä¸äº‹ä»¶æ—¶é—´ä¸ç¬¦æ—¶ï¼ŒFlink åˆ™ä¼šä¾æ®å®ƒä»¬çš„äº‹ä»¶æ—¶é—´è¿›è¡Œæ’åºåå†å¤„ç†ã€‚ å¿…é¡»æ‰¿è®¤ï¼Œè¿™æ ·è¯´è¿˜æ˜¯è¿›è¡Œäº†ä¸€äº›ç®€åŒ–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åšä¸€äº›äº‹æƒ…æ¥ä¿è¯é«˜æ•ˆæ‰§è¡Œï¼Œä½†æ˜¯æ€»ä½“åŸåˆ™ä¸Šæ¥è¯´ï¼Œè¿™å°±æ˜¯å…¨éƒ¨çš„è®¾è®¡ã€‚é™¤æ­¤ä¹‹å¤–æˆ‘ä»¬å¹¶ä¸éœ€è¦æ›´å¤šå…¶ä»–ä¸œè¥¿ã€‚ ä¸ºäº†å®ç°è¿™ä¸ªè®¾è®¡ï¼Œæˆ‘ä»¬å¼•å…¥äº†ä¸€ç§èªæ˜çš„åˆ†å¸ƒå¼äº‹ä»¶æ—¶é—´åˆ†é…æœºåˆ¶ã€‚è¿™é‡Œçš„äº‹ä»¶æ—¶é—´æ˜¯é€»è¾‘æ—¶é—´ï¼Œå®ƒå¹¶ä¸éœ€è¦æœ‰ä»€ä¹ˆç°å®æ„ä¹‰ï¼Œæ¯”å¦‚å®ƒä¸éœ€è¦æ˜¯çœŸå®çš„æ—¶é’Ÿã€‚ä½¿ç”¨ Flink çš„ä¹±åºå¤„ç†èƒ½åŠ›ï¼Œå¹¶ä¸”ä½¿ç”¨ Flink è¿­ä»£è®¡ç®—çš„åŠŸèƒ½æ¥è¿›è¡ŒæŸäº›å‰ææ¡ä»¶çš„æ£€æŸ¥ã€‚è¿™äº›å°±æ˜¯æˆ‘ä»¬æ„å»ºä¸€ä¸ªæ”¯æŒäº‹åŠ¡çš„æµå¤„ç†å™¨çš„è¦ç´ ã€‚ æˆ‘ä»¬å®é™…ä¸Šå·²ç»å®Œæˆäº†è¿™ä¸ªå·¥ä½œï¼Œç§°ä¹‹ä¸ºæµå¼è´¦ç°¿ï¼ˆStreaming Ledgerï¼‰ï¼Œè¿™æ˜¯ä¸ªåœ¨ Apache Flink ä¸Šå¾ˆå°çš„åº“ã€‚å®ƒåŸºäºæµå¤„ç†å™¨åšåˆ°äº†æ»¡è¶³ ACID çš„å¤šé”®äº‹åŠ¡æ€§æ“ä½œã€‚æˆ‘ç›¸ä¿¡è¿™æ˜¯ä¸ªéå¸¸æœ‰è¶£çš„è¿›åŒ–ã€‚æµå¤„ç†å™¨ä¸€å¼€å§‹åŸºæœ¬ä¸Šæ²¡æœ‰ä»»ä½•ä¿éšœï¼Œç„¶åç±»ä¼¼ Storm çš„ç³»ç»Ÿå¢åŠ äº†è‡³å°‘ä¸€æ¬¡çš„ä¿è¯ã€‚ä½†æ˜¾ç„¶è‡³å°‘ä¸€æ¬¡ä¾ç„¶ä¸å¤Ÿå¥½ã€‚ç„¶åæˆ‘ä»¬çœ‹åˆ°äº†æ°å¥½ä¸€æ¬¡çš„è¯­ä¹‰ï¼Œè¿™æ˜¯ä¸€ä¸ªå¤§çš„è¿›æ­¥ï¼Œä½†è¿™åªæ˜¯å¯¹äºå•è¡Œæ“ä½œçš„æ°å¥½ä¸€æ¬¡è¯­ä¹‰ï¼Œè¿™ä¸é”®å€¼åº“å¾ˆç±»ä¼¼ã€‚è€Œæ”¯æŒå¤šè¡Œæ°å¥½ä¸€æ¬¡æˆ–è€…å¤šè¡Œäº‹åŠ¡æ“ä½œå°†æµå¤„ç†å™¨æå‡åˆ°äº†ä¸€ä¸ªå¯ä»¥è§£å†³ä¼ ç»Ÿæ„ä¹‰ä¸Šå…³ç³»å‹æ•°æ®åº“æ‰€åº”ç”¨åœºæ™¯çš„é˜¶æ®µã€‚ Streaming Ledger çš„å®ç°æ–¹å¼æ˜¯å…è®¸ç”¨æˆ·å®šä¹‰ä¸€äº›è¡¨å’Œå¯¹è¿™äº›è¡¨è¿›è¡Œä¿®æ”¹çš„å‡½æ•°ã€‚ Streaming Ledger ä¼šè¿è¡Œè¿™äº›å‡½æ•°å’Œè¡¨ï¼Œæ‰€æœ‰çš„è¿™äº›ä¸€èµ·ç¼–è¯‘æˆä¸€ä¸ª Apache Flink çš„æœ‰å‘æ— ç¯å›¾ï¼ˆDAGï¼‰ã€‚Streaming Ledger ä¼šæ³¨å…¥æ‰€æœ‰äº‹åŠ¡æ—¶é—´åˆ†é…çš„é€»è¾‘ï¼Œä»¥æ­¤æ¥ä¿è¯æ‰€æœ‰äº‹åŠ¡çš„ä¸€è‡´æ€§ã€‚ æ­å»ºè¿™æ ·ä¸€ä¸ªåº“å¹¶ä¸éš¾ï¼Œéš¾çš„æ˜¯è®©å®ƒé«˜æ€§èƒ½çš„è¿è¡Œã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒçš„æ€§èƒ½ã€‚è¿™äº›æ€§èƒ½æµ‹è¯•æ˜¯å‡ ä¸ªæœˆä¹‹å‰çš„ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰åšä»€ä¹ˆç‰¹åˆ«çš„ä¼˜åŒ–ï¼Œæˆ‘ä»¬åªæ˜¯æƒ³çœ‹çœ‹ä¸€äº›æœ€ç®€å•çš„æ–¹æ³•èƒ½å¤Ÿæœ‰ä»€ä¹ˆæ ·çš„æ€§èƒ½è¡¨ç°ã€‚è€Œå®é™…æ€§èƒ½è¡¨ç°çœ‹èµ·æ¥ç›¸å½“ä¸é”™ã€‚å¦‚æœä½ çœ‹è¿™äº›æ€§èƒ½æ¡å½¢æˆçš„é˜¶æ¢¯è·¨åº¦ï¼Œéšç€æµå¤„ç†å™¨æ•°é‡çš„å¢é•¿ï¼Œæ€§èƒ½çš„å¢é•¿ç›¸å½“çº¿æ€§ã€‚ åœ¨äº‹åŠ¡è®¾è®¡ä¸­ï¼Œæ²¡æœ‰ä»»ä½•ååŒæˆ–è€…é”å‚ä¸å…¶ä¸­ã€‚è¿™åªæ˜¯æµå¤„ç†ï¼Œå°†äº‹ä»¶æµæ¨å…¥ç³»ç»Ÿï¼Œç¼“å­˜ä¸€å°æ®µæ—¶é—´æ¥åšä¸€äº›ä¹±åºå¤„ç†ï¼Œç„¶ååšä¸€äº›æœ¬åœ°çŠ¶æ€æ›´æ–°ã€‚åœ¨è¿™ä¸ªæ–¹æ¡ˆä¸­ï¼Œæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«ä»£ä»·é«˜æ˜‚çš„æ“ä½œã€‚åœ¨å›¾ä¸­æ€§èƒ½å¢é•¿ä¼¼ä¹è¶…è¿‡äº†çº¿æ€§ï¼Œæˆ‘æƒ³è¿™ä¸»è¦æ˜¯å› ä¸º JAVA çš„ JVM å½“ä¸­ GC çš„å·¥ä½œåŸå› å¯¼è‡´çš„ã€‚åœ¨ 32 ä¸ªèŠ‚ç‚¹çš„æƒ…å†µä¸‹æˆ‘ä»¬æ¯ç§’å¯ä»¥å¤„ç†å¤§çº¦ä¸¤ç™¾ä¸‡ä¸ªäº‹åŠ¡ã€‚ä¸ºäº†ä¸æ•°æ®åº“æ€§èƒ½æµ‹è¯•è¿›è¡Œå¯¹æ¯”ï¼Œé€šå¸¸å½“ä½ çœ‹æ•°æ®åº“çš„æ€§èƒ½æµ‹è¯•æ—¶ï¼Œä½ ä¼šçœ‹åˆ°ç±»ä¼¼è¯»å†™æ“ä½œæ¯”çš„è¯´æ˜ï¼Œæ¯”å¦‚ 10% çš„æ›´æ–°æ“ä½œã€‚è€Œæˆ‘ä»¬çš„æµ‹è¯•ä½¿ç”¨çš„æ˜¯ 100% çš„æ›´æ–°æ“ä½œï¼Œè€Œæ¯ä¸ªå†™æ“ä½œè‡³å°‘æ›´æ–°åœ¨ä¸åŒåˆ†åŒºä¸Šçš„ 4 è¡Œæ•°æ®ï¼Œæˆ‘ä»¬çš„è¡¨çš„å¤§å°å¤§çº¦æ˜¯ä¸¤äº¿è¡Œã€‚å³ä¾¿æ²¡æœ‰ä»»ä½•ä¼˜åŒ–ï¼Œè¿™ä¸ªæ–¹æ¡ˆçš„æ€§èƒ½ä¹Ÿéå¸¸ä¸é”™ã€‚ å¦ä¸€ä¸ªåœ¨äº‹åŠ¡æ€§èƒ½ä¸­æœ‰è¶£çš„é—®é¢˜æ˜¯å½“æ›´æ–°çš„æ“ä½œå¯¹è±¡æ˜¯ä¸€ä¸ªæ¯”è¾ƒå°çš„é›†åˆæ—¶çš„æ€§èƒ½ã€‚å¦‚æœäº‹åŠ¡ä¹‹é—´æ²¡æœ‰å†²çªï¼Œå¹¶å‘çš„äº‹åŠ¡å¤„ç†æ˜¯ä¸€ä¸ªå®¹æ˜“çš„äº‹æƒ…ã€‚å¦‚æœæ‰€æœ‰çš„äº‹åŠ¡éƒ½ç‹¬ç«‹è¿›è¡Œè€Œäº’ä¸å¹²æ‰°ï¼Œé‚£è¿™ä¸ªä¸æ˜¯ä»€ä¹ˆéš¾é¢˜ï¼Œä»»ä½•ç³»ç»Ÿåº”è¯¥éƒ½èƒ½å¾ˆå¥½çš„è§£å†³è¿™æ ·çš„é—®é¢˜ã€‚ å½“æ‰€æœ‰çš„äº‹åŠ¡éƒ½å¼€å§‹æ“ä½œåŒä¸€äº›è¡Œæ—¶ï¼Œäº‹æƒ…å¼€å§‹å˜å¾—æ›´æœ‰è¶£äº†ï¼Œä½ éœ€è¦éš”ç¦»ä¸åŒçš„ä¿®æ”¹æ¥ä¿è¯ä¸€è‡´æ€§ã€‚æ‰€ä»¥æˆ‘ä»¬å¼€å§‹æ¯”è¾ƒä¸€ä¸ªåªè¯»çš„ç¨‹åºã€ä¸€ä¸ªåˆè¯»åˆå†™ä½†æ˜¯æ²¡æœ‰å†™å†²çªçš„ç¨‹åºå’Œä¸€ä¸ªåˆè¯»åˆå†™å¹¶æœ‰ä¸­ç­‰ç¨‹åº¦å†™å†²çªçš„ç¨‹åºè¿™ä¸‰è€…ä¹‹é—´çš„æ€§èƒ½ã€‚ä½ å¯ä»¥çœ‹åˆ°æ€§èƒ½è¡¨ç°ç›¸å½“ç¨³å®šã€‚è¿™å°±åƒæ˜¯ä¸€ä¸ªä¹è§‚çš„å¹¶å‘å†²çªæ§åˆ¶ï¼Œè¡¨ç°å¾ˆä¸é”™ã€‚é‚£å¦‚æœæˆ‘ä»¬çœŸçš„æƒ³è¦é’ˆå¯¹è¿™ç±»ç³»ç»Ÿçš„é˜¿å–€ç‰æ–¯ä¹‹è¸µè¿›è¡Œè€ƒéªŒï¼Œä¹Ÿå°±æ˜¯åå¤çš„æ›´æ–°åŒä¸€ä¸ªå°é›†åˆä¸­çš„é”®ã€‚ åœ¨ä¼ ç»Ÿæ•°æ®åº“ä¸­ï¼Œè¿™ç§æƒ…å†µä¸‹å¯èƒ½ä¼šå‡ºç°åå¤é‡è¯•ï¼Œåå¤å¤±è´¥å†é‡è¯•ï¼Œè¿™æ˜¯ä¸€ç§æˆ‘ä»¬æ€»æƒ³é¿å…çš„ç³Ÿç³•æƒ…å†µã€‚æ˜¯çš„ï¼Œæˆ‘ä»¬çš„ç¡®éœ€è¦ä»˜å‡ºæ€§èƒ½ä»£ä»·ï¼Œè¿™å¾ˆè‡ªç„¶ï¼Œå› ä¸ºå¦‚æœä½ çš„è¡¨ä¸­æœ‰å‡ è¡Œæ•°æ®æ¯ä¸ªäººéƒ½æƒ³æ›´æ–°ï¼Œé‚£ä¹ˆä½ çš„ç³»ç»Ÿå°±å¤±å»äº†å¹¶å‘æ€§ï¼Œè¿™æœ¬èº«å°±æ˜¯ä¸ªé—®é¢˜ã€‚ä½†æ˜¯è¿™ç§æƒ…å†µä¸‹ï¼Œç³»ç»Ÿå¹¶æ²¡å´©æºƒï¼Œå®ƒä»ç„¶åœ¨ç¨³å®šçš„å¤„ç†è¯·æ±‚ï¼Œè™½ç„¶å¤±å»äº†ä¸€äº›å¹¶å‘æ€§ï¼Œä½†æ˜¯è¯·æ±‚ä¾ç„¶èƒ½å¤Ÿè¢«å¤„ç†ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬æ²¡æœ‰å†²çªé‡è¯•çš„æœºåˆ¶ï¼Œä½ å¯ä»¥è®¤ä¸ºæˆ‘ä»¬æœ‰ä¸€ä¸ªåŸºäºä¹±åºå¤„ç†å¤©ç„¶çš„å†²çªé¿å…çš„æœºåˆ¶ï¼Œè¿™æ˜¯ä¸€ç§éå¸¸ç¨³å®šå’Œå¼ºå¤§çš„æŠ€æœ¯ã€‚ æˆ‘ä»¬è¿˜å°è¯•äº†åœ¨è·¨åœ°åŸŸåˆ†å¸ƒçš„æƒ…å†µä¸‹çš„æ€§èƒ½è¡¨ç°ã€‚æ¯”å¦‚æˆ‘ä»¬åœ¨ç¾å›½ã€å·´è¥¿ï¼Œæ¬§æ´²ï¼Œæ—¥æœ¬å’Œæ¾³å¤§åˆ©äºšå„è®¾ç½®äº†ä¸€ä¸ª Flink é›†ç¾¤ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬æœ‰ä¸ªå…¨çƒåˆ†å¸ƒçš„ç³»ç»Ÿã€‚å¦‚æœä½ åœ¨ä½¿ç”¨ä¸€ä¸ªå…³ç³»å‹æ•°æ®åº“ï¼Œé‚£ä¹ˆä½ ä¼šä»˜å‡ºç›¸å½“é«˜æ˜‚çš„æ€§èƒ½ä»£ä»·ï¼Œå› ä¸ºé€šä¿¡çš„å»¶è¿Ÿå˜å¾—ç›¸å½“é«˜ã€‚è·¨å¤§æ´²çš„ä¿¡æ¯äº¤äº’æ¯”åœ¨åŒä¸€ä¸ªæ•°æ®ä¸­å¿ƒç”šè‡³åŒä¸€ä¸ªæœºæ¶ä¸Šçš„ä¿¡æ¯äº¤äº’è¦äº§ç”Ÿå¤§å¾—å¤šçš„å»¶è¿Ÿã€‚ ä½†æ˜¯æœ‰è¶£çš„æ˜¯ï¼Œæµå¤„ç†çš„æ–¹å¼å¯¹å»¶è¿Ÿå¹¶ä¸æ˜¯ååˆ†æ•æ„Ÿï¼Œå»¶è¿Ÿå¯¹æ€§èƒ½æœ‰æ‰€å½±å“ï¼Œä½†æ˜¯ç›¸æ¯”å…¶å®ƒå¾ˆå¤šæ–¹æ¡ˆï¼Œå»¶è¿Ÿå¯¹æµå¤„ç†çš„å½±å“è¦å°å¾—å¤šã€‚æ‰€ä»¥ï¼Œåœ¨è¿™æ ·çš„å…¨çƒåˆ†å¸ƒå¼ç¯å¢ƒä¸­æ‰§è¡Œåˆ†å¸ƒå¼ç¨‹åºï¼Œçš„ç¡®ä¼šæœ‰æ›´å·®çš„æ€§èƒ½ï¼Œéƒ¨åˆ†åŸå› ä¹Ÿæ˜¯å› ä¸ºè·¨å¤§æ´²çš„é€šä¿¡å¸¦å®½ä¸å¦‚ç»Ÿä¸€æ•°æ®ä¸­å¿ƒé‡Œçš„å¸¦å®½ï¼Œä½†æ˜¯æ€§èƒ½è¡¨ç°ä¾ç„¶ä¸å·®ã€‚ å®é™…ä¸Šï¼Œä½ å¯ä»¥æ‹¿å®ƒå½“åšä¸€ä¸ªè·¨åœ°åŸŸçš„æ•°æ®åº“ï¼ŒåŒæ—¶ä»ç„¶èƒ½å¤Ÿåœ¨ä¸€ä¸ªå¤§æ¦‚ 10 ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤ä¸Šè·å¾—æ¯ç§’å‡ åä¸‡æ¡äº‹åŠ¡çš„å¤„ç†èƒ½åŠ›ã€‚åœ¨è¿™ä¸ªæµ‹è¯•ä¸­æˆ‘ä»¬åªç”¨äº† 10 ä¸ªèŠ‚ç‚¹ï¼Œæ¯ä¸ªå¤§æ´²ä¸¤ä¸ªèŠ‚ç‚¹ã€‚æ‰€ä»¥ 10 ä¸ªèŠ‚ç‚¹å¯ä»¥å¸¦æ¥å…¨çƒåˆ†å¸ƒçš„æ¯ç§’ 20 ä¸‡äº‹åŠ¡çš„å¤„ç†èƒ½åŠ›ã€‚æˆ‘è®¤ä¸ºè¿™æ˜¯å¾ˆæœ‰è¶£çš„ç»“æœï¼Œè¿™æ˜¯å› ä¸ºè¿™ä¸ªæ–¹æ¡ˆå¯¹å»¶è¿Ÿå¹¶ä¸æ•æ„Ÿã€‚ æˆ‘å·²ç»è¯´äº†å¾ˆå¤šåˆ©ç”¨æµå¤„ç†æ¥å®ç°äº‹åŠ¡æ€§çš„åº”ç”¨ã€‚å¯èƒ½å¬èµ·æ¥è¿™æ˜¯ä¸ªå¾ˆè‡ªç„¶çš„æƒ³æ³•ï¼Œä»æŸç§è§’åº¦ä¸Šæ¥è¯´çš„ç¡®æ˜¯è¿™æ ·ã€‚ä½†æ˜¯å®ƒçš„ç¡®éœ€è¦ä¸€äº›å¾ˆå¤æ‚çš„æœºåˆ¶æ¥ä½œä¸ºæ”¯æ’‘ã€‚å®ƒéœ€è¦ä¸€ä¸ªè¿ç»­å¤„ç†è€Œéå¾®æ‰¹å¤„ç†çš„èƒ½åŠ›ï¼Œéœ€è¦èƒ½å¤Ÿåšè¿­ä»£ï¼Œéœ€è¦å¤æ‚çš„åŸºäºäº‹ä»¶æ—¶é—´å¤„ç†ä¹±åºå¤„ç†ã€‚ä¸ºäº†æ›´å¥½åœ°æ€§èƒ½ï¼Œå®ƒéœ€è¦çµæ´»çš„çŠ¶æ€æŠ½è±¡å’Œå¼‚æ­¥ checkpoint æœºåˆ¶ã€‚è¿™äº›æ˜¯çœŸæ­£å›°éš¾çš„äº‹æƒ…ã€‚è¿™äº›ä¸æ˜¯ç”± Ledger Streaming åº“å®ç°çš„ï¼Œè€Œæ˜¯ Apache Flink å®ç°çš„ï¼Œæ‰€ä»¥å³ä½¿å¯¹è¿™ç±»äº‹åŠ¡æ€§çš„åº”ç”¨è€Œè¨€ï¼ŒApache Flink ä¹Ÿæ˜¯çœŸæ­£çš„ä¸­æµç ¥æŸ±ã€‚ è‡³æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è¯´æµå¤„ç†ä¸ä»…ä»…æ”¯æŒè¿ç»­å¤„ç†ã€æµå¼åˆ†æã€æ‰¹å¤„ç†æˆ–è€…äº‹ä»¶é©±åŠ¨çš„å¤„ç†ï¼Œä½ ä¹Ÿå¯ä»¥ç”¨å®ƒåšäº‹åŠ¡æ€§çš„å¤„ç†ã€‚å½“ç„¶ï¼Œå‰ææ˜¯ä½ æœ‰ä¸€ä¸ªè¶³å¤Ÿå¼ºå¤§çš„æµå¤„ç†å¼•æ“ã€‚è¿™å°±æ˜¯æˆ‘æ¼”è®²çš„å…¨éƒ¨å†…å®¹ã€‚ æœ€åGitHub Flink å­¦ä¹ ä»£ç åœ°å€ï¼šhttps://github.com/zhisheng17/flink-learning å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·äº†ã€‚ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šzhisheng_tianï¼Œç„¶åå›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ Flink å®æˆ˜1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç»Flinkä¸­çš„Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink å†™å…¥æ•°æ®åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink å†™å…¥æ•°æ®åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº†? 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯•","date":"2019-06-13T16:00:00.000Z","path":"2019/06/14/flink-architecture-deploy-test/","text":"Apache Flink æ˜¯ä¸€ä¸ªé¢å‘åˆ†å¸ƒå¼æ•°æ®æµå¤„ç†å’Œæ‰¹é‡æ•°æ®å¤„ç†çš„å¼€æºè®¡ç®—å¹³å°ï¼Œå®ƒèƒ½å¤ŸåŸºäºåŒä¸€ä¸ª Flink è¿è¡Œæ—¶ï¼Œæä¾›æ”¯æŒæµå¤„ç†å’Œæ‰¹å¤„ç†ä¸¤ç§ç±»å‹åº”ç”¨çš„åŠŸèƒ½ã€‚ æœ¬æ–‡è½¬è½½è‡ªåšå®¢å›­ï¼Œä½œè€…ï¼šFlorian åŸæ–‡åœ°å€ï¼šhttps://www.cnblogs.com/fanzhidongyzby/p/6297723.html ç°æœ‰çš„å¼€æºè®¡ç®—æ–¹æ¡ˆï¼Œä¼šæŠŠæµå¤„ç†å’Œæ‰¹å¤„ç†ä½œä¸ºä¸¤ç§ä¸åŒçš„åº”ç”¨ç±»å‹ï¼Œå› ä¸ºå®ƒä»¬æ‰€æä¾›çš„ SLAï¼ˆService-Level-Aggreementï¼‰æ˜¯å®Œå…¨ä¸ç›¸åŒçš„ï¼šæµå¤„ç†ä¸€èˆ¬éœ€è¦æ”¯æŒä½å»¶è¿Ÿã€Exactly-once ä¿è¯ï¼Œè€Œæ‰¹å¤„ç†éœ€è¦æ”¯æŒé«˜ååã€é«˜æ•ˆå¤„ç†ã€‚ Flink ä»å¦ä¸€ä¸ªè§†è§’çœ‹å¾…æµå¤„ç†å’Œæ‰¹å¤„ç†ï¼Œå°†äºŒè€…ç»Ÿä¸€èµ·æ¥ï¼šFlink æ˜¯å®Œå…¨æ”¯æŒæµå¤„ç†ï¼Œä¹Ÿå°±æ˜¯è¯´ä½œä¸ºæµå¤„ç†çœ‹å¾…æ—¶è¾“å…¥æ•°æ®æµæ˜¯æ— ç•Œçš„ï¼›æ‰¹å¤„ç†è¢«ä½œä¸ºä¸€ç§ç‰¹æ®Šçš„æµå¤„ç†ï¼Œåªæ˜¯å®ƒçš„è¾“å…¥æ•°æ®æµè¢«å®šä¹‰ä¸ºæœ‰ç•Œçš„ã€‚ Flink æµå¤„ç†ç‰¹æ€§ï¼š æ”¯æŒé«˜ååã€ä½å»¶è¿Ÿã€é«˜æ€§èƒ½çš„æµå¤„ç† æ”¯æŒå¸¦æœ‰äº‹ä»¶æ—¶é—´çš„çª—å£ï¼ˆWindowï¼‰æ“ä½œ æ”¯æŒæœ‰çŠ¶æ€è®¡ç®—çš„ Exactly-once è¯­ä¹‰ æ”¯æŒé«˜åº¦çµæ´»çš„çª—å£ï¼ˆWindowï¼‰æ“ä½œï¼Œæ”¯æŒåŸºäº timeã€countã€sessionï¼Œä»¥åŠ data-driven çš„çª—å£æ“ä½œ æ”¯æŒå…·æœ‰ Backpressure åŠŸèƒ½çš„æŒç»­æµæ¨¡å‹ æ”¯æŒåŸºäºè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ï¼ˆSnapshotï¼‰å®ç°çš„å®¹é”™ ä¸€ä¸ªè¿è¡Œæ—¶åŒæ—¶æ”¯æŒ Batch on Streaming å¤„ç†å’Œ Streaming å¤„ç† Flink åœ¨ JVM å†…éƒ¨å®ç°äº†è‡ªå·±çš„å†…å­˜ç®¡ç† æ”¯æŒè¿­ä»£è®¡ç®— æ”¯æŒç¨‹åºè‡ªåŠ¨ä¼˜åŒ–ï¼šé¿å…ç‰¹å®šæƒ…å†µä¸‹ Shuffleã€æ’åºç­‰æ˜‚è´µæ“ä½œï¼Œä¸­é—´ç»“æœæœ‰å¿…è¦è¿›è¡Œç¼“å­˜ ä¸€ã€æ¶æ„Flink ä»¥å±‚çº§å¼ç³»ç»Ÿå½¢å¼ç»„ä»¶å…¶è½¯ä»¶æ ˆï¼Œä¸åŒå±‚çš„æ ˆå»ºç«‹åœ¨å…¶ä¸‹å±‚åŸºç¡€ä¸Šï¼Œå¹¶ä¸”å„å±‚æ¥å—ç¨‹åºä¸åŒå±‚çš„æŠ½è±¡å½¢å¼ã€‚ 1ã€è¿è¡Œæ—¶å±‚ä»¥ JobGraph å½¢å¼æ¥æ”¶ç¨‹åºã€‚JobGraph å³ä¸ºä¸€ä¸ªä¸€èˆ¬åŒ–çš„å¹¶è¡Œæ•°æ®æµå›¾ï¼ˆdata flowï¼‰ï¼Œå®ƒæ‹¥æœ‰ä»»æ„æ•°é‡çš„ Task æ¥æ¥æ”¶å’Œäº§ç”Ÿ data streamã€‚ 2ã€DataStream API å’Œ DataSet API éƒ½ä¼šä½¿ç”¨å•ç‹¬ç¼–è¯‘çš„å¤„ç†æ–¹å¼ç”Ÿæˆ JobGraphã€‚DataSet API ä½¿ç”¨optimizer æ¥å†³å®šé’ˆå¯¹ç¨‹åºçš„ä¼˜åŒ–æ–¹æ³•ï¼Œè€Œ DataStream API åˆ™ä½¿ç”¨ stream builder æ¥å®Œæˆè¯¥ä»»åŠ¡ã€‚ 3ã€åœ¨æ‰§è¡Œ JobGraph æ—¶ï¼ŒFlink æä¾›äº†å¤šç§å€™é€‰éƒ¨ç½²æ–¹æ¡ˆï¼ˆå¦‚ localï¼Œremoteï¼ŒYARN ç­‰ï¼‰ã€‚ 4ã€Flink é™„éšäº†ä¸€äº›äº§ç”Ÿ DataSet æˆ– DataStream API ç¨‹åºçš„çš„ç±»åº“å’Œ APIï¼šå¤„ç†é€»è¾‘è¡¨æŸ¥è¯¢çš„ Tableï¼Œæœºå™¨å­¦ä¹ çš„ FlinkMLï¼Œå›¾åƒå¤„ç†çš„ Gellyï¼Œå¤æ‚äº‹ä»¶å¤„ç†çš„ CEPã€‚ äºŒã€åŸç†1. æµã€è½¬æ¢ã€æ“ä½œç¬¦Flink ç¨‹åºæ˜¯ç”± Stream å’Œ Transformation è¿™ä¸¤ä¸ªåŸºæœ¬æ„å»ºå—ç»„æˆï¼Œå…¶ä¸­ Stream æ˜¯ä¸€ä¸ªä¸­é—´ç»“æœæ•°æ®ï¼Œè€ŒTransformation æ˜¯ä¸€ä¸ªæ“ä½œï¼Œå®ƒå¯¹ä¸€ä¸ªæˆ–å¤šä¸ªè¾“å…¥ Stream è¿›è¡Œè®¡ç®—å¤„ç†ï¼Œè¾“å‡ºä¸€ä¸ªæˆ–å¤šä¸ªç»“æœ Streamã€‚ Flink ç¨‹åºè¢«æ‰§è¡Œçš„æ—¶å€™ï¼Œå®ƒä¼šè¢«æ˜ å°„ä¸º Streaming Dataflowã€‚ä¸€ä¸ª Streaming Dataflow æ˜¯ç”±ä¸€ç»„ Stream å’ŒTransformation Operator ç»„æˆï¼Œå®ƒç±»ä¼¼äºä¸€ä¸ª DAG å›¾ï¼Œåœ¨å¯åŠ¨çš„æ—¶å€™ä»ä¸€ä¸ªæˆ–å¤šä¸ª Source Operator å¼€å§‹ï¼Œç»“æŸäºä¸€ä¸ªæˆ–å¤šä¸ª Sink Operatorã€‚ 2. å¹¶è¡Œæ•°æ®æµä¸€ä¸ª Stream å¯ä»¥è¢«åˆ†æˆå¤šä¸ª Stream åˆ†åŒºï¼ˆStream Partitionsï¼‰ï¼Œä¸€ä¸ª Operator å¯ä»¥è¢«åˆ†æˆå¤šä¸ª Operator Subtaskï¼Œæ¯ä¸€ä¸ª Operator Subtask æ˜¯åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­ç‹¬ç«‹æ‰§è¡Œçš„ã€‚ä¸€ä¸ª Operator çš„å¹¶è¡Œåº¦ï¼Œç­‰äº Operator Subtask çš„ä¸ªæ•°ï¼Œä¸€ä¸ª Stream çš„å¹¶è¡Œåº¦æ€»æ˜¯ç­‰äºç”Ÿæˆå®ƒçš„ Operator çš„å¹¶è¡Œåº¦ã€‚ One-to-one æ¨¡å¼ æ¯”å¦‚ä» Source[1] åˆ° map()[1]ï¼Œå®ƒä¿æŒäº† Source çš„åˆ†åŒºç‰¹æ€§ï¼ˆPartitioningï¼‰å’Œåˆ†åŒºå†…å…ƒç´ å¤„ç†çš„æœ‰åºæ€§ï¼Œä¹Ÿå°±æ˜¯è¯´ map()[1] çš„ Subtask çœ‹åˆ°æ•°æ®æµä¸­è®°å½•çš„é¡ºåºï¼Œä¸ Source[1] ä¸­çœ‹åˆ°çš„è®°å½•é¡ºåºæ˜¯ä¸€è‡´çš„ã€‚ Redistributionæ¨¡å¼ è¿™ç§æ¨¡å¼æ”¹å˜äº†è¾“å…¥æ•°æ®æµçš„åˆ†åŒºï¼Œæ¯”å¦‚ä» map()[1]ã€map()[2] åˆ° keyBy()/window()/apply()[1]ã€keyBy()/window()/apply()[2]ï¼Œä¸Šæ¸¸çš„ Subtask å‘ä¸‹æ¸¸çš„å¤šä¸ªä¸åŒçš„ Subtask å‘é€æ•°æ®ï¼Œæ”¹å˜äº†æ•°æ®æµçš„åˆ†åŒºï¼Œè¿™ä¸å®é™…åº”ç”¨æ‰€é€‰æ‹©çš„ Operator æœ‰å…³ç³»ã€‚ 3. ä»»åŠ¡ã€æ“ä½œç¬¦é“¾Flink åˆ†å¸ƒå¼æ‰§è¡Œç¯å¢ƒä¸­ï¼Œä¼šå°†å¤šä¸ª Operator Subtask ä¸²èµ·æ¥ç»„æˆä¸€ä¸ª Operator Chainï¼Œå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªæ‰§è¡Œé“¾ï¼Œæ¯ä¸ªæ‰§è¡Œé“¾ä¼šåœ¨ TaskManager ä¸Šä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹ä¸­æ‰§è¡Œã€‚ 4. æ—¶é—´å¤„ç† Stream ä¸­çš„è®°å½•æ—¶ï¼Œè®°å½•ä¸­é€šå¸¸ä¼šåŒ…å«å„ç§å…¸å‹çš„æ—¶é—´å­—æ®µï¼š Event Timeï¼šè¡¨ç¤ºäº‹ä»¶åˆ›å»ºæ—¶é—´ Ingestion Timeï¼šè¡¨ç¤ºäº‹ä»¶è¿›å…¥åˆ° Flink Dataflow çš„æ—¶é—´ Processing Timeï¼šè¡¨ç¤ºæŸä¸ª Operator å¯¹äº‹ä»¶è¿›è¡Œå¤„ç†çš„æœ¬åœ°ç³»ç»Ÿæ—¶é—´ Flink ä½¿ç”¨ WaterMark è¡¡é‡æ—¶é—´çš„æ—¶é—´ï¼ŒWaterMark æºå¸¦æ—¶é—´æˆ³ tï¼Œå¹¶è¢«æ’å…¥åˆ° stream ä¸­ã€‚ WaterMark çš„å«ä¹‰æ˜¯æ‰€æœ‰æ—¶é—´ tâ€™&lt; t çš„äº‹ä»¶éƒ½å·²ç»å‘ç”Ÿã€‚ é’ˆå¯¹ä¹±åºçš„çš„æµï¼ŒWaterMark è‡³å…³é‡è¦ï¼Œè¿™æ ·å¯ä»¥å…è®¸ä¸€äº›äº‹ä»¶åˆ°è¾¾å»¶è¿Ÿï¼Œè€Œä¸è‡³äºè¿‡äºå½±å“ window çª—å£çš„è®¡ç®—ã€‚ å¹¶è¡Œæ•°æ®æµä¸­ï¼Œå½“ Operator æœ‰å¤šä¸ªè¾“å…¥æµæ—¶ï¼ŒOperator çš„ event time ä»¥æœ€å°æµ event time ä¸ºå‡†ã€‚ 5. çª—å£Flink æ”¯æŒåŸºäºæ—¶é—´çª—å£æ“ä½œï¼Œä¹Ÿæ”¯æŒåŸºäºæ•°æ®çš„çª—å£æ“ä½œï¼š çª—å£åˆ†ç±»ï¼š æŒ‰åˆ†å‰²æ ‡å‡†åˆ’åˆ†ï¼štimeWindowã€countWindow æŒ‰çª—å£è¡Œä¸ºåˆ’åˆ†ï¼šTumbling Windowã€Sliding Windowã€è‡ªå®šä¹‰çª—å£ Tumbling/Sliding Time Window 12345678910111213141516// Stream of (sensorId, carCnt)val vehicleCnts: DataStream[(Int, Int)] = ...val tumblingCnts: DataStream[(Int, Int)] = vehicleCnts // key stream by sensorId .keyBy(0) // tumbling time window of 1 minute length .timeWindow(Time.minutes(1)) // compute sum over carCnt .sum(1) val slidingCnts: DataStream[(Int, Int)] = vehicleCnts .keyBy(0) // sliding time window of 1 minute length and 30 secs trigger interval .timeWindow(Time.minutes(1), Time.seconds(30)) .sum(1) Tumbling/Sliding Count Window 12345678910111213141516// Stream of (sensorId, carCnt) val vehicleCnts: DataStream[(Int, Int)] = ... val tumblingCnts: DataStream[(Int, Int)] = vehicleCnts // key stream by sensorId .keyBy(0) // tumbling count window of 100 elements size .countWindow(100) // compute the carCnt sum .sum(1)val slidingCnts: DataStream[(Int, Int)] = vehicleCnts .keyBy(0) // sliding count window of 100 elements size and 10 elements trigger interval .countWindow(100, 10) .sum(1) è‡ªå®šä¹‰çª—å£ åŸºæœ¬æ“ä½œï¼š windowï¼šåˆ›å»ºè‡ªå®šä¹‰çª—å£ triggerï¼šè‡ªå®šä¹‰è§¦å‘å™¨ evictorï¼šè‡ªå®šä¹‰evictor applyï¼šè‡ªå®šä¹‰window function 6. å®¹é”™Barrier æœºåˆ¶ï¼š å‡ºç°ä¸€ä¸ª Barrierï¼Œåœ¨è¯¥ Barrier ä¹‹å‰å‡ºç°çš„è®°å½•éƒ½å±äºè¯¥ Barrier å¯¹åº”çš„ Snapshotï¼Œåœ¨è¯¥ Barrier ä¹‹åå‡ºç°çš„è®°å½•å±äºä¸‹ä¸€ä¸ª Snapshotã€‚ æ¥è‡ªä¸åŒSnapshotå¤šä¸ªBarrierå¯èƒ½åŒæ—¶å‡ºç°åœ¨æ•°æ®æµä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´åŒä¸€ä¸ªæ—¶åˆ»å¯èƒ½å¹¶å‘ç”Ÿæˆå¤šä¸ªSnapshotã€‚ å½“ä¸€ä¸ªä¸­é—´ï¼ˆIntermediateï¼‰Operatoræ¥æ”¶åˆ°ä¸€ä¸ªBarrieråï¼Œå®ƒä¼šå‘é€Barrieråˆ°å±äºè¯¥Barrierçš„Snapshotçš„æ•°æ®æµä¸­ï¼Œç­‰åˆ°Sink Operatoræ¥æ”¶åˆ°è¯¥Barrieråä¼šå‘Checkpoint Coordinatorç¡®è®¤è¯¥Snapshotï¼Œç›´åˆ°æ‰€æœ‰çš„Sink Operatoréƒ½ç¡®è®¤äº†è¯¥Snapshotï¼Œæ‰è¢«è®¤ä¸ºå®Œæˆäº†è¯¥Snapshotã€‚ å¯¹é½ï¼š å½“Operatoræ¥æ”¶åˆ°å¤šä¸ªè¾“å…¥çš„æ•°æ®æµæ—¶ï¼Œéœ€è¦åœ¨Snapshot Barrierä¸­å¯¹æ•°æ®æµè¿›è¡Œæ’åˆ—å¯¹é½ï¼š Operatorä»ä¸€ä¸ªincoming Streamæ¥æ”¶åˆ°Snapshot Barrier nï¼Œç„¶åæš‚åœå¤„ç†ï¼Œç›´åˆ°å…¶å®ƒçš„incoming Streamçš„Barrier nï¼ˆå¦åˆ™å±äº2ä¸ªSnapshotçš„è®°å½•å°±æ··åœ¨ä¸€èµ·äº†ï¼‰åˆ°è¾¾è¯¥Operator æ¥æ”¶åˆ°Barrier nçš„Streamè¢«ä¸´æ—¶æç½®ï¼Œæ¥è‡ªè¿™äº›Streamçš„è®°å½•ä¸ä¼šè¢«å¤„ç†ï¼Œè€Œæ˜¯è¢«æ”¾åœ¨ä¸€ä¸ªBufferä¸­ã€‚ ä¸€æ—¦æœ€åä¸€ä¸ªStreamæ¥æ”¶åˆ°Barrier nï¼ŒOperatorä¼šemitæ‰€æœ‰æš‚å­˜åœ¨Bufferä¸­çš„è®°å½•ï¼Œç„¶åå‘Checkpoint Coordinatorå‘é€Snapshot nã€‚ ç»§ç»­å¤„ç†æ¥è‡ªå¤šä¸ªStreamçš„è®°å½• åŸºäºStream Aligningæ“ä½œèƒ½å¤Ÿå®ç°Exactly Onceè¯­ä¹‰ï¼Œä½†æ˜¯ä¹Ÿä¼šç»™æµå¤„ç†åº”ç”¨å¸¦æ¥å»¶è¿Ÿï¼Œå› ä¸ºä¸ºäº†æ’åˆ—å¯¹é½Barrierï¼Œä¼šæš‚æ—¶ç¼“å­˜ä¸€éƒ¨åˆ†Streamçš„è®°å½•åˆ°Bufferä¸­ï¼Œå°¤å…¶æ˜¯åœ¨æ•°æ®æµå¹¶è¡Œåº¦å¾ˆé«˜çš„åœºæ™¯ä¸‹å¯èƒ½æ›´åŠ æ˜æ˜¾ï¼Œé€šå¸¸ä»¥æœ€è¿Ÿå¯¹é½Barrierçš„ä¸€ä¸ªStreamä¸ºå¤„ç†Bufferä¸­ç¼“å­˜è®°å½•çš„æ—¶åˆ»ç‚¹ã€‚åœ¨Flinkä¸­ï¼Œæä¾›äº†ä¸€ä¸ªå¼€å…³ï¼Œé€‰æ‹©æ˜¯å¦ä½¿ç”¨Stream Aligningï¼Œå¦‚æœå…³æ‰åˆ™Exactly Onceä¼šå˜æˆAt least onceã€‚ CheckPointï¼š Snapshotå¹¶ä¸ä»…ä»…æ˜¯å¯¹æ•°æ®æµåšäº†ä¸€ä¸ªçŠ¶æ€çš„Checkpointï¼Œå®ƒä¹ŸåŒ…å«äº†ä¸€ä¸ªOperatorå†…éƒ¨æ‰€æŒæœ‰çš„çŠ¶æ€ï¼Œè¿™æ ·æ‰èƒ½å¤Ÿåœ¨ä¿è¯åœ¨æµå¤„ç†ç³»ç»Ÿå¤±è´¥æ—¶èƒ½å¤Ÿæ­£ç¡®åœ°æ¢å¤æ•°æ®æµå¤„ç†ã€‚çŠ¶æ€åŒ…å«ä¸¤ç§ï¼š ç³»ç»ŸçŠ¶æ€ï¼šä¸€ä¸ªOperatorè¿›è¡Œè®¡ç®—å¤„ç†çš„æ—¶å€™éœ€è¦å¯¹æ•°æ®è¿›è¡Œç¼“å†²ï¼Œæ‰€ä»¥æ•°æ®ç¼“å†²åŒºçš„çŠ¶æ€æ˜¯ä¸Operatorç›¸å…³è”çš„ã€‚ä»¥çª—å£æ“ä½œçš„ç¼“å†²åŒºä¸ºä¾‹ï¼ŒFlinkç³»ç»Ÿä¼šæ”¶é›†æˆ–èšåˆè®°å½•æ•°æ®å¹¶æ”¾åˆ°ç¼“å†²åŒºä¸­ï¼Œç›´åˆ°è¯¥ç¼“å†²åŒºä¸­çš„æ•°æ®è¢«å¤„ç†å®Œæˆã€‚ ä¸€ç§æ˜¯ç”¨æˆ·è‡ªå®šä¹‰çŠ¶æ€ï¼ˆçŠ¶æ€å¯ä»¥é€šè¿‡è½¬æ¢å‡½æ•°è¿›è¡Œåˆ›å»ºå’Œä¿®æ”¹ï¼‰ï¼Œå®ƒå¯ä»¥æ˜¯å‡½æ•°ä¸­çš„Javaå¯¹è±¡è¿™æ ·çš„ç®€å•å˜é‡ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸å‡½æ•°ç›¸å…³çš„Key/ValueçŠ¶æ€ã€‚ 7. è°ƒåº¦åœ¨JobManagerç«¯ï¼Œä¼šæ¥æ”¶åˆ°Clientæäº¤çš„JobGraphå½¢å¼çš„Flink Jobï¼ŒJobManagerä¼šå°†ä¸€ä¸ªJobGraphè½¬æ¢æ˜ å°„ä¸ºä¸€ä¸ªExecutionGraphï¼ŒExecutionGraphæ˜¯JobGraphçš„å¹¶è¡Œè¡¨ç¤ºï¼Œä¹Ÿå°±æ˜¯å®é™…JobManagerè°ƒåº¦ä¸€ä¸ªJobåœ¨TaskManagerä¸Šè¿è¡Œçš„é€»è¾‘è§†å›¾ã€‚ ç‰©ç†ä¸Šè¿›è¡Œè°ƒåº¦ï¼ŒåŸºäºèµ„æºçš„åˆ†é…ä¸ä½¿ç”¨çš„ä¸€ä¸ªä¾‹å­ï¼š å·¦ä¸Šå­å›¾ï¼šæœ‰2ä¸ªTaskManagerï¼Œæ¯ä¸ªTaskManageræœ‰3ä¸ªTask Slot å·¦ä¸‹å­å›¾ï¼šä¸€ä¸ªFlink Jobï¼Œé€»è¾‘ä¸ŠåŒ…å«äº†1ä¸ªdata sourceã€1ä¸ªMapFunctionã€1ä¸ªReduceFunctionï¼Œå¯¹åº”ä¸€ä¸ªJobGraph å·¦ä¸‹å­å›¾ï¼šç”¨æˆ·æäº¤çš„Flink Jobå¯¹å„ä¸ªOperatorè¿›è¡Œçš„é…ç½®â€”â€”data sourceçš„å¹¶è¡Œåº¦è®¾ç½®ä¸º4ï¼ŒMapFunctionçš„å¹¶è¡Œåº¦ä¹Ÿä¸º4ï¼ŒReduceFunctionçš„å¹¶è¡Œåº¦ä¸º3ï¼Œåœ¨JobManagerç«¯å¯¹åº”äºExecutionGraph å³ä¸Šå­å›¾ï¼šTaskManager 1ä¸Šï¼Œæœ‰2ä¸ªå¹¶è¡Œçš„ExecutionVertexç»„æˆçš„DAGå›¾ï¼Œå®ƒä»¬å„å ç”¨ä¸€ä¸ªTask Slot å³ä¸‹å­å›¾ï¼šTaskManager 2ä¸Šï¼Œä¹Ÿæœ‰2ä¸ªå¹¶è¡Œçš„ExecutionVertexç»„æˆçš„DAGå›¾ï¼Œå®ƒä»¬ä¹Ÿå„å ç”¨ä¸€ä¸ªTask Slot åœ¨2ä¸ªTaskManagerä¸Šè¿è¡Œçš„4ä¸ªExecutionæ˜¯å¹¶è¡Œæ‰§è¡Œçš„ 8. è¿­ä»£æœºå™¨å­¦ä¹ å’Œå›¾è®¡ç®—åº”ç”¨ï¼Œéƒ½ä¼šä½¿ç”¨åˆ°è¿­ä»£è®¡ç®—ï¼ŒFlinké€šè¿‡åœ¨è¿­ä»£Operatorä¸­å®šä¹‰Stepå‡½æ•°æ¥å®ç°è¿­ä»£ç®—æ³•ï¼Œè¿™ç§è¿­ä»£ç®—æ³•åŒ…æ‹¬Iterateå’ŒDelta Iterateä¸¤ç§ç±»å‹ã€‚ Iterate Iterate Operatoræ˜¯ä¸€ç§ç®€å•çš„è¿­ä»£å½¢å¼ï¼šæ¯ä¸€è½®è¿­ä»£ï¼ŒStepå‡½æ•°çš„è¾“å…¥æˆ–è€…æ˜¯è¾“å…¥çš„æ•´ä¸ªæ•°æ®é›†ï¼Œæˆ–è€…æ˜¯ä¸Šä¸€è½®è¿­ä»£çš„ç»“æœï¼Œé€šè¿‡è¯¥è½®è¿­ä»£è®¡ç®—å‡ºä¸‹ä¸€è½®è®¡ç®—æ‰€éœ€è¦çš„è¾“å…¥ï¼ˆä¹Ÿç§°ä¸ºNext Partial Solutionï¼‰ï¼Œæ»¡è¶³è¿­ä»£çš„ç»ˆæ­¢æ¡ä»¶åï¼Œä¼šè¾“å‡ºæœ€ç»ˆè¿­ä»£ç»“æœã€‚ æµç¨‹ä¼ªä»£ç ï¼š 1234567IterationState state = getInitialState();while (!terminationCriterion()) &#123; state = step(state);&#125;setFinalState(state); Delta Iterate Delta Iterate Operatorå®ç°äº†å¢é‡è¿­ä»£ã€‚ æµç¨‹ä¼ªä»£ç ï¼š 12345678910IterationState workset = getInitialState();IterationState solution = getInitialSolution();while (!terminationCriterion()) &#123; (delta, workset) = step(workset, solution); solution.update(delta)&#125;setFinalState(solution); æœ€å°å€¼ä¼ æ’­ï¼š 9. Back Pressureç›‘æ§æµå¤„ç†ç³»ç»Ÿä¸­ï¼Œå½“ä¸‹æ¸¸Operatorå¤„ç†é€Ÿåº¦è·Ÿä¸ä¸Šçš„æƒ…å†µï¼Œå¦‚æœä¸‹æ¸¸Operatorèƒ½å¤Ÿå°†è‡ªå·±å¤„ç†çŠ¶æ€ä¼ æ’­ç»™ä¸Šæ¸¸Operatorï¼Œä½¿å¾—ä¸Šæ¸¸Operatorå¤„ç†é€Ÿåº¦æ…¢ä¸‹æ¥å°±ä¼šç¼“è§£ä¸Šè¿°é—®é¢˜ï¼Œæ¯”å¦‚é€šè¿‡å‘Šè­¦çš„æ–¹å¼é€šçŸ¥ç°æœ‰æµå¤„ç†ç³»ç»Ÿå­˜åœ¨çš„é—®é¢˜ã€‚ Flink Webç•Œé¢ä¸Šæä¾›äº†å¯¹è¿è¡ŒJobçš„Backpressureè¡Œä¸ºçš„ç›‘æ§ï¼Œå®ƒé€šè¿‡ä½¿ç”¨Samplingçº¿ç¨‹å¯¹æ­£åœ¨è¿è¡Œçš„Taskè¿›è¡Œå †æ ˆè·Ÿè¸ªé‡‡æ ·æ¥å®ç°ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒJobManagerä¼šæ¯é—´éš”50msè§¦å‘å¯¹ä¸€ä¸ªJobçš„æ¯ä¸ªTaskä¾æ¬¡è¿›è¡Œ100æ¬¡å †æ ˆè·Ÿè¸ªè°ƒç”¨ï¼Œè¿‡è®¡ç®—å¾—åˆ°ä¸€ä¸ªæ¯”å€¼ï¼Œä¾‹å¦‚ï¼Œradio=0.01ï¼Œè¡¨ç¤º100æ¬¡ä¸­ä»…æœ‰1æ¬¡æ–¹æ³•è°ƒç”¨é˜»å¡ã€‚Flinkç›®å‰å®šä¹‰äº†å¦‚ä¸‹BackpressureçŠ¶æ€ï¼šOK: 0 &lt;= Ratio &lt;= 0.10LOW: 0.10 &lt; Ratio &lt;= 0.5HIGH: 0.5 &lt; Ratio &lt;= 1 ä¸‰ã€åº“1. TableFlinkçš„Table APIå®ç°äº†ä½¿ç”¨ç±»SQLè¿›è¡Œæµå’Œæ‰¹å¤„ç†ã€‚ è¯¦æƒ…å‚è€ƒï¼šhttps://ci.apache.org/projects/flink/flink-docs-release-1.2/dev/table_api.html 2. CEPFlinkçš„CEPï¼ˆComplex Event Processingï¼‰æ”¯æŒåœ¨æµä¸­å‘ç°å¤æ‚çš„äº‹ä»¶æ¨¡å¼ï¼Œå¿«é€Ÿç­›é€‰ç”¨æˆ·æ„Ÿå…´è¶£çš„æ•°æ®ã€‚ è¯¦æƒ…å‚è€ƒï¼šhttps://ci.apache.org/projects/flink/flink-docs-release-1.2/concepts/programming-model.html#next-steps 3. GellyGellyæ˜¯Flinkæä¾›çš„å›¾è®¡ç®—APIï¼Œæä¾›äº†ç®€åŒ–å¼€å‘å’Œæ„å»ºå›¾è®¡ç®—åˆ†æåº”ç”¨çš„æ¥å£ã€‚ è¯¦æƒ…å‚è€ƒï¼šhttps://ci.apache.org/projects/flink/flink-docs-release-1.2/dev/libs/gelly/index.html 4. FlinkMLFlinkMLæ˜¯Flinkæä¾›çš„æœºå™¨å­¦ä¹ åº“ï¼Œæä¾›äº†å¯æ‰©å±•çš„æœºå™¨å­¦ä¹ ç®—æ³•ã€ç®€æ´çš„APIå’Œå·¥å…·ç®€åŒ–æœºå™¨å­¦ä¹ ç³»ç»Ÿçš„å¼€å‘ã€‚ è¯¦æƒ…å‚è€ƒï¼šhttps://ci.apache.org/projects/flink/flink-docs-release-1.2/dev/libs/ml/index.html å››ã€éƒ¨ç½²å½“Flinkç³»ç»Ÿå¯åŠ¨æ—¶ï¼Œé¦–å…ˆå¯åŠ¨JobManagerå’Œä¸€è‡³å¤šä¸ªTaskManagerã€‚JobManagerè´Ÿè´£åè°ƒFlinkç³»ç»Ÿï¼ŒTaskManageråˆ™æ˜¯æ‰§è¡Œå¹¶è¡Œç¨‹åºçš„workerã€‚å½“ç³»ç»Ÿä»¥æœ¬åœ°å½¢å¼å¯åŠ¨æ—¶ï¼Œä¸€ä¸ªJobManagerå’Œä¸€ä¸ªTaskManagerä¼šå¯åŠ¨åœ¨åŒä¸€ä¸ªJVMä¸­ã€‚å½“ä¸€ä¸ªç¨‹åºè¢«æäº¤åï¼Œç³»ç»Ÿä¼šåˆ›å»ºä¸€ä¸ªClientæ¥è¿›è¡Œé¢„å¤„ç†ï¼Œå°†ç¨‹åºè½¬å˜æˆä¸€ä¸ªå¹¶è¡Œæ•°æ®æµçš„å½¢å¼ï¼Œäº¤ç»™JobManagerå’ŒTaskManageræ‰§è¡Œã€‚ 1. å¯åŠ¨æµ‹è¯•ç¼–è¯‘flinkï¼Œæœ¬åœ°å¯åŠ¨ã€‚ 12345678$ java -versionjava version \"1.8.0_111\"$ git clone https://github.com/apache/flink.git$ git checkout release-1.1.4 -b release-1.1.4$ cd flink$ mvn clean package -DskipTests$ cd flink-dist/target/flink-1.1.4-bin/flink-1.1.4$ ./bin/start-local.sh ç¼–å†™æœ¬åœ°æµå¤„ç†demoã€‚ SocketWindowWordCount.java 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091public class SocketWindowWordCount &#123; public static void main(String[] args) throws Exception &#123; // the port to connect to final int port; try &#123; final ParameterTool params = ParameterTool.fromArgs(args); port = params.getInt(\"port\"); &#125; catch (Exception e) &#123; System.err.println(\"No port specified. Please run 'SocketWindowWordCount --port &lt;port&gt;'\"); return; &#125; // get the execution environment final StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment(); // get input data by connecting to the socket DataStream&lt;String&gt; text = env.socketTextStream(\"localhost\", port, \"\\n\"); // parse the data, group it, window it, and aggregate the counts DataStream&lt;WordWithCount&gt; windowCounts = text .flatMap(new FlatMapFunction&lt;String, WordWithCount&gt;() &#123; public void flatMap(String value, Collector&lt;WordWithCount&gt; out) &#123; for (String word : value.split(\"\\s\")) &#123; out.collect(new WordWithCount(word, 1L)); &#125; &#125; &#125;) .keyBy(\"word\") .timeWindow(Time.seconds(5), Time.seconds(1)) .reduce(new ReduceFunction&lt;WordWithCount&gt;() &#123; public WordWithCount reduce(WordWithCount a, WordWithCount b) &#123; return new WordWithCount(a.word, a.count + b.count); &#125; &#125;); // print the results with a single thread, rather than in parallel windowCounts.print().setParallelism(1); env.execute(\"Socket Window WordCount\"); &#125; // Data type for words with count public static class WordWithCount &#123; public String word; public long count; public WordWithCount() &#123;&#125; public WordWithCount(String word, long count) &#123; this.word = word; this.count = count; &#125; @Override public String toString() &#123; return word + \" : \" + count; &#125; &#125;&#125; pom.xml 1234567891011121314151617&lt;!-- Use this dependency if you are using the DataStream API --&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-streaming-java_2.10&lt;/artifactId&gt; &lt;version&gt;1.1.4&lt;/version&gt; &lt;/dependency&gt; &lt;!-- Use this dependency if you are using the DataSet API --&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-java&lt;/artifactId&gt; &lt;version&gt;1.1.4&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-clients_2.10&lt;/artifactId&gt; &lt;version&gt;1.1.4&lt;/version&gt;&lt;/dependency&gt; æ‰§è¡Œmvnæ„å»ºã€‚ 12mvn clean install$ ls target/flink-demo-1.0-SNAPSHOT.jar å¼€å¯9000ç«¯å£ï¼Œç”¨äºè¾“å…¥æ•°æ®: 1$ nc -l 9000 æäº¤flinkä»»åŠ¡ï¼š 1$ ./bin/flink run -c com.demo.florian.WordCount $DEMO_DIR/target/flink-demo-1.0-SNAPSHOT.jar --port 9000 åœ¨ncé‡Œè¾“å…¥æ•°æ®åï¼ŒæŸ¥çœ‹æ‰§è¡Œç»“æœï¼š 1$ tail -f log/flink-*-jobmanager-*.out æŸ¥çœ‹flink webé¡µé¢ï¼šlocalhost:8081 2. ä»£ç ç»“æ„Flinkç³»ç»Ÿæ ¸å¿ƒå¯åˆ†ä¸ºå¤šä¸ªå­é¡¹ç›®ã€‚åˆ†å‰²é¡¹ç›®æ—¨åœ¨å‡å°‘å¼€å‘Flinkç¨‹åºéœ€è¦çš„ä¾èµ–æ•°é‡ï¼Œå¹¶å¯¹æµ‹è¯•å’Œå¼€å‘å°ç»„ä»¶æä¾›ä¾¿æ·ã€‚ Flinkå½“å‰è¿˜åŒ…æ‹¬ä»¥ä¸‹å­é¡¹ç›®ï¼š Flink-distï¼šdistributioné¡¹ç›®ã€‚å®ƒå®šä¹‰äº†å¦‚ä½•å°†ç¼–è¯‘åçš„ä»£ç ã€è„šæœ¬å’Œå…¶ä»–èµ„æºæ•´åˆåˆ°æœ€ç»ˆå¯ç”¨çš„ç›®å½•ç»“æ„ä¸­ã€‚ Flink-quick-startï¼šæœ‰å…³quickstartå’Œæ•™ç¨‹çš„è„šæœ¬ã€mavenåŸå‹å’Œç¤ºä¾‹ç¨‹åº flink-contribï¼šä¸€ç³»åˆ—æœ‰ç”¨æˆ·å¼€å‘çš„æ—©èµ·ç‰ˆæœ¬å’Œæœ‰ç”¨çš„å·¥å…·çš„é¡¹ç›®ã€‚åæœŸçš„ä»£ç ä¸»è¦ç”±å¤–éƒ¨è´¡çŒ®è€…ç»§ç»­ç»´æŠ¤ï¼Œè¢«flink-contirbæ¥å—çš„ä»£ç çš„è¦æ±‚ä½äºå…¶ä»–é¡¹ç›®çš„è¦æ±‚ã€‚ 3. Flink On YARNFlinkåœ¨YARNé›†ç¾¤ä¸Šè¿è¡Œæ—¶ï¼šFlink YARN Clientè´Ÿè´£ä¸YARN RMé€šä¿¡åå•†èµ„æºè¯·æ±‚ï¼ŒFlink JobManagerå’ŒFlink TaskManageråˆ†åˆ«ç”³è¯·åˆ°Containerå»è¿è¡Œå„è‡ªçš„è¿›ç¨‹ã€‚ YARN AMä¸Flink JobManageråœ¨åŒä¸€ä¸ªContainerä¸­ï¼Œè¿™æ ·AMå¯ä»¥çŸ¥é“Flink JobManagerçš„åœ°å€ï¼Œä»è€ŒAMå¯ä»¥ç”³è¯·Containerå»å¯åŠ¨Flink TaskManagerã€‚å¾…FlinkæˆåŠŸè¿è¡Œåœ¨YARNé›†ç¾¤ä¸Šï¼ŒFlink YARN Clientå°±å¯ä»¥æäº¤Flink Jobåˆ°Flink JobManagerï¼Œå¹¶è¿›è¡Œåç»­çš„æ˜ å°„ã€è°ƒåº¦å’Œè®¡ç®—å¤„ç†ã€‚ 1ã€è®¾ç½®Hadoopç¯å¢ƒå˜é‡ 1$ export HADOOP_CONF_DIR=/etc/hadoop/conf 2ã€ä»¥é›†ç¾¤æ¨¡å¼æäº¤ä»»åŠ¡ï¼Œæ¯æ¬¡éƒ½ä¼šæ–°å»ºflinké›†ç¾¤ 1$ ./bin/flink run -m yarn-cluster -c com.demo.florian.WordCount $DEMO_DIR/target/flink-demo-1.0-SNAPSHOT.jar 3ã€å¯åŠ¨å…±äº«flinké›†ç¾¤ï¼Œæäº¤ä»»åŠ¡ 12$ ./bin/yarn-session.sh -n 4 -jm 1024 -tm 4096 -d$ ./bin/flink run -c com.demo.florian.WordCount $DEMO_DIR/target/flink-demo-1.0.SNAPSHOT.jar ###å‚è€ƒèµ„æ–™ http://shiyanjun.cn/archives/1508.htmlhttps://ci.apache.org/projects/flink/flink-docs-release-1.2/index.html æœ€åGitHub Flink å­¦ä¹ ä»£ç åœ°å€ï¼šhttps://github.com/zhisheng17/flink-learning å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ ä¸“æ ä»‹ç»é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€åŸç†ã€å®æˆ˜ã€æ€§èƒ½è°ƒä¼˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡","date":"2019-06-12T16:00:00.000Z","path":"2019/06/13/flink-book-paper/","text":"å‰è¨€ä¹‹å‰ä¹Ÿåˆ†äº«äº†ä¸å°‘è‡ªå·±çš„æ–‡ç« ï¼Œä½†æ˜¯å¯¹äº Flink æ¥è¯´ï¼Œè¿˜æ˜¯æœ‰ä¸å°‘æ–°å…¥é—¨çš„æœ‹å‹ï¼Œè¿™é‡Œç»™å¤§å®¶åˆ†äº«ç‚¹ Flink ç›¸å…³çš„èµ„æ–™ï¼ˆå›½å¤–æ•°æ® pdf å’Œæµå¤„ç†ç›¸å…³çš„ Paperï¼‰ï¼ŒæœŸæœ›å¯ä»¥å¸®ä½ æ›´å¥½çš„ç†è§£ Flinkã€‚ ä¸“æ æ¨èé¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f ä¹¦ç±1ã€ã€ŠIntroduction to Apache Flink bookã€‹ è¿™æœ¬ä¹¦æ¯”è¾ƒè–„ï¼Œç®€å•ä»‹ç»äº† Flinkï¼Œä¹Ÿæœ‰ä¸­æ–‡ç‰ˆï¼Œè¯»å®Œå¯ä»¥å¯¹ Flink æœ‰ä¸ªå¤§æ¦‚çš„äº†è§£ã€‚ 2ã€ã€ŠLearning Apache Flinkã€‹ è¿™æœ¬ä¹¦è¿˜æ˜¯è®²çš„æ¯”è¾ƒå¤šçš„ API ä½¿ç”¨ï¼Œä¸ä»…æœ‰ Java ç‰ˆæœ¬è¿˜æœ‰ Scala ç‰ˆæœ¬ï¼Œå…¥é—¨çœ‹è¿™æœ¬æˆ‘è§‰å¾—è¿˜æ˜¯ OK çš„ã€‚ 3ã€ã€ŠStream Processing with Apache Flinkã€‹ è¿™æœ¬ä¹¦æ˜¯ Flink PMC å†™çš„ï¼Œè´¨é‡è¿˜æ˜¯å¾ˆå¥½çš„ï¼Œå¯¹ Flink ä¸­çš„æ¦‚å¿µè®²çš„å¾ˆæ¸…æ¥šï¼Œè¿˜æœ‰ä¸å°‘å›¾ç‰‡å¸®å¿™ç†è§£ï¼Œç¾ä¸­ä¸è¶³çš„æ˜¯æ²¡æœ‰ Table å’Œ SQL API ç›¸å…³çš„ä»‹ç»ã€‚ 4ã€ã€ŠStreaming Systemã€‹ è¿™æœ¬ä¹¦æ˜¯è®²æµå¤„ç†å¼•æ“çš„ï¼Œå¯¹æµå¤„ç†å¼•æ“çš„å‘å±•å¸¦æ¥ä¸å°‘çš„æ¨åŠ¨ï¼Œä¹¦æœ¬çš„è´¨é‡éå¸¸é«˜ï¼Œé…äº†å¤§é‡çš„å›¾ï¼Œç›®çš„å°±æ˜¯è®©ä½ å¾ˆå®¹æ˜“çš„æ‡‚æµå¤„ç†å¼•æ“ä¸­çš„æ¦‚å¿µï¼ˆæ¯”å¦‚æ—¶é—´ã€çª—å£ã€æ°´å°ç­‰ï¼‰ï¼Œæˆ‘å¼ºçƒˆçš„æ¨èå¤§å®¶éƒ½çœ‹ä¸€ä¸‹ï¼Œè¿™æœ¬ä¹¦çš„å†…å®¹è¢«å¾ˆå¤šåšå®¢å’Œä¹¦ç±éƒ½å¼•ç”¨äº†ã€‚ Paperè¿™æ˜¯ä¸€ä»½ streaming systems é¢†åŸŸç›¸å…³çš„è®ºæ–‡åˆ—è¡¨ 20+ ç¯‡ï¼Œæ¶‰åŠ streaming systems çš„è®¾è®¡ï¼Œå®ç°ï¼Œæ•…éšœæ¢å¤ï¼Œå¼¹æ€§æ‰©å±•ç­‰å„æ–¹é¢ã€‚ä¹ŸåŒ…å«è‡ª 2014 å¹´ä»¥æ¥ streaming system å’Œ batch system çš„ç»Ÿä¸€æ¨¡å‹çš„è®ºæ–‡ã€‚ 2016 å¹´ Drizzle: Fast and Adaptable Stream Processing at Scale (Draft): Record-at-a-time çš„ç³»ç»Ÿï¼Œå¦‚ Naiad, Flinkï¼Œå¤„ç†å»¶è¿Ÿè¾ƒä½ã€ä½†æ¢å¤å»¶è¿Ÿè¾ƒé«˜ï¼›micro-batch ç³»ç»Ÿï¼Œå¦‚ Spark Streamingï¼Œæ¢å¤å»¶è¿Ÿä½ä½†å¤„ç†å»¶è¿Ÿç•¥é«˜ã€‚Drizzle åˆ™é‡‡ç”¨ group scheduling + pre-scheduling shuffles çš„æ–¹å¼å¯¹ Spark Streaming åšäº†æ”¹è¿›ï¼Œä¿ç•™ä½æ¢å¤å»¶è¿Ÿçš„åŒæ—¶ï¼Œé™ä½äº†å¤„ç†å»¶è¿Ÿè‡³ 100ms é‡çº§ã€‚ Realtime Data Processing at Facebook (SIGMOD): Facebook æ˜ç¡®è‡ªå·±å®æ—¶çš„ä½¿ç”¨åœºæ™¯æ˜¯ seconds of latency, not millisecondsï¼Œå¹¶åŸºäºè‡ªå·±çš„éœ€æ±‚æ„å»ºäº† 3 ä¸ªå®æ—¶å¤„ç†ç»„ä»¶ï¼šPuma, Swift, ä»¥åŠ Stylusã€‚Puma, Swift å’Œ Stylus éƒ½ä» Scribe è¯»æ•°æ®ï¼Œå¹¶å¯å‘ Scribe å†™å›æ•°æ®ï¼ˆScribe æ˜¯ Facebook å†…éƒ¨çš„åˆ†å¸ƒå¼æ¶ˆæ¯ç³»ç»Ÿï¼Œç±»ä¼¼ Kafkaï¼‰ã€‚ 2015 å¹´ The Dataflow Model: A Practical Approach to Balancing Correctness, Latency, and Cost in Massive-Scale, Unbounded, Out-of-Order Data Processing (VLDB): æ¥è‡ª Google çš„å°† stream processing æ¨¡å‹å’Œ batch processing æ¨¡å‹ç»Ÿä¸€çš„å°è¯•ã€‚åœ¨ Dataflow model ä¸‹ï¼Œåº•å±‚ä¾èµ– FlumeJava æ”¯æŒ batch processingï¼Œä¾èµ– MillWheel æ”¯æŒ stream processingã€‚Dataflow model çš„å¼€æºå®ç°æ˜¯ Apache Beam é¡¹ç›®ã€‚ Apache Flink: Stream and Batch Processing in a Single Engine Apache Flink æ˜¯ä¸€ä¸ªå¤„ç† streaming data å’Œ batch data çš„å¼€æºç³»ç»Ÿã€‚Flink çš„è®¾è®¡å“²å­¦æ˜¯ï¼ŒåŒ…æ‹¬å®æ—¶åˆ†æ (real-time analytics)ã€æŒç»­æ•°æ®å¤„ç† (continuous data pipelines)ã€å†å²æ•°æ®å¤„ç† (historic data processing / batch)ã€è¿­ä»£å¼ç®—æ³• (iterative algorithms - machine learning, graph analysis) ç­‰çš„å¾ˆå¤šç±»æ•°æ®å¤„ç†åº”ç”¨ï¼Œéƒ½èƒ½ç”¨ pipelined fault-tolerant çš„ dataflows æ‰§è¡Œæ¨¡å‹æ¥è¡¨è¾¾ã€‚ Lightweight asynchronous snapshots for distributed dataflows: Apache Flink æ‰€å®ç°çš„ä¸€ä¸ªè½»é‡çº§çš„ã€å¼‚æ­¥åšçŠ¶æ€å¿«ç…§çš„æ–¹æ³•ã€‚åŸºäºæ­¤ï¼ŒFlink å¾—ä»¥ä¿è¯åˆ†å¸ƒå¼çŠ¶æ€çš„ä¸€è‡´æ€§ï¼Œä»è€Œä¿è¯æ•´ä¸ªç³»ç»Ÿçš„ exactly-once è¯­ä¹‰ã€‚å…·ä½“çš„ï¼ŒFlink ä¼šæŒç»­æ€§çš„åœ¨ stream é‡Œæ’å…¥ barrier markersï¼Œåˆ¶é€ ä¸€ä¸ªåˆ†å¸ƒå¼çš„é¡ºåºå…³ç³»ï¼Œä½¿å¾—ä¸åŒçš„èŠ‚ç‚¹èƒ½å¤Ÿåœ¨åŒä¸€æ‰¹ barrier marker ä¸Šè¾¾æˆæ•´ä¸ªç³»ç»Ÿçš„ä¸€è‡´æ€§çŠ¶æ€ã€‚ Twitter Heron: Stream Processing at Scale (SIGMOD): Heron æ˜¯ Twitter å¼€å‘çš„ç”¨äºä»£æ›¿ Storm çš„å®æ—¶å¤„ç†ç³»ç»Ÿï¼Œè§£å†³äº† Storm åœ¨æ‰©å±•æ€§ã€è°ƒè¯•èƒ½åŠ›ã€æ€§èƒ½ã€ç®¡ç†æ–¹å¼ä¸Šçš„ä¸€äº›é—®é¢˜ã€‚Heron å®ç°äº† Storm çš„æ¥å£ï¼Œå› æ­¤å¯¹ Storm æœ‰å¾ˆå¥½çš„å…¼å®¹æ€§ï¼Œä¹Ÿæˆä¸ºäº† Twitter å†…éƒ¨å®æ—¶å¤„ç†ç³»ç»Ÿçš„äº‹å®ä¸Šçš„æ ‡å‡†ã€‚ 2014 å¹´ Trill: A High-Performance Incremental Query Processor for Diverse Analytics (VLDB): æ­¤ç¯‡ä»‹ç»äº† Microsoft çš„ Trill - ä¸€ä¸ªæ–°çš„åˆ†ææŸ¥è¯¢å¤„ç†å™¨ã€‚Trill å¾ˆå¥½çš„ç»“åˆä»¥ä¸‹ 3 æ–¹é¢éœ€æ±‚ï¼š(1) Query Model: Trill æ˜¯åŸºäºæ—¶é—´-å…³ç³» (tempo-relational) æ¨¡å‹ï¼Œæ‰€ä»¥å¾ˆå¥½çš„æ”¯æŒä»å®æ—¶åˆ°ç¦»çº¿è®¡ç®—çš„å»¶è¿Ÿéœ€æ±‚ï¼›(2) Fabric and Language Integration: Trill ä½œä¸ºä¸€ä¸ªç±»åº“ï¼Œå¯ä»¥å¾ˆå¥½çš„ä¸é«˜çº§è¯­è¨€ã€å·²æœ‰ç±»åº“ç»“åˆï¼›ä»¥åŠ (3) Performance: æ— è®ºå®æ—¶è¿˜æ˜¯ç¦»çº¿ï¼ŒTrill çš„ throughput éƒ½å¾ˆé«˜ â€”â€” å®æ—¶è®¡ç®—æ¯”æµå¤„ç†å¼•æ“é«˜ 2-4 ä¸ªæ•°é‡çº§ï¼Œç¦»çº¿è®¡ç®—ä¸å•†ä¸šçš„åˆ—å¼ DBMS åŒç­‰ã€‚ä»å®ç°è§’åº¦è®²ï¼ŒåŒ…æ‹¬ punctuation çš„ä½¿ç”¨æ¥åˆ† batch æ»¡è¶³ latency éœ€æ±‚ï¼Œbatch å†…ä½¿ç”¨åˆ—å¼å­˜å‚¨ã€code-gen ç­‰æŠ€æœ¯æ¥æé«˜ performanceï¼Œéƒ½å…·æœ‰å¾ˆå¥½çš„å€Ÿé‰´æ„ä¹‰ â€”â€” å°¤å…¶æ³¨æ„è¿™æ˜¯ 2014 å¹´å‘è¡¨çš„è®ºæ–‡ã€‚ Summingbird: A Framework for Integrating Batch and Online MapReduce Computations (VLDB): Twitter å¼€å‘çš„ç›®æ ‡æ˜¯å°† online Storm è®¡ç®—å’Œ batch MapReduce è®¡ç®—é€»è¾‘ç»Ÿä¸€æè¿°çš„ä¸€å¥— domain-specific languageã€‚Summingbird æŠ½è±¡äº† sources, sinks, ä»¥åŠ stores ç­‰ï¼ŒåŸºäºæ­¤æŠ½è±¡ï¼Œä¸Šå±‚åº”ç”¨å°±ä¸å¿…ä¸º streaming å’Œ batch ç»´æŠ¤ä¸¤å¥—è®¡ç®—é€»è¾‘ï¼Œè€Œå¯ä»¥ä½¿ç”¨åŒä¸€å¥—è®¡ç®—é€»è¾‘ï¼Œåªåœ¨è¿è¡Œæ—¶åˆ†åˆ«ç¼–è¯‘åè·‘åœ¨ streaming çš„ Storm ä¸Šå’Œ batch çš„ MapReduce ä¸Šã€‚ Storm@Twitter (SIGMOD): è¿™æ˜¯ä¸€ç¯‡æ¥è¿Ÿçš„è®ºæ–‡ã€‚Apache Storm æœ€åˆåœ¨ Backtype åŠ Twitterï¼Œè€Œååœ¨ä¸šç•ŒèŒƒå›´éƒ½æœ‰å¹¿æ³›çš„åº”ç”¨ï¼Œç”šè‡³æ›¾ç»ä¸€åº¦ä¹Ÿæ˜¯äº‹å®ä¸Šçš„æµå¤„ç†ç³»ç»Ÿæ ‡å‡†ã€‚æ­¤ç¯‡ä»‹ç»äº† Storm çš„è®¾è®¡ï¼ŒåŠåœ¨ Twitter å†…éƒ¨çš„åº”ç”¨æƒ…å†µã€‚å½“ç„¶åé¢æˆ‘ä»¬çŸ¥é“ Apache Storm ä¹Ÿæš´éœ²å‡ºä¸€äº›é—®é¢˜ï¼Œä¸šç•Œä¹Ÿå‡ºç°äº†ä¸€äº›æ›´ä¼˜ç§€çš„æµå¤„ç†ç³»ç»Ÿã€‚Twitter è™½æ²¡æœ‰åœ¨ 2012 å¹´ Storm æ—¶ä»£å¼€å¯æ—¶å‘å£°ï¼Œä½†åœ¨ 2014 å¹´ Storm è½å¹•æ—¶ä»¥æ­¤æ–‡å‘å£°å‘å…¶è‡´æ•¬ï¼Œä¹Ÿç®—æ˜¯å¼¥è¡¥äº†äº›è®¸é—æ†¾å§ã€‚ 2013 å¹´ Discretized Streams: Fault-Tolerant Streaming Computation at Scale (SOSP): Spark Streaming æ˜¯åŸºäº Spark æ‰§è¡Œå¼•æ“ã€micro-batch æ¨¡å¼çš„å‡†å®æ—¶å¤„ç†ç³»ç»Ÿã€‚å¯¹æ¯” RDD æ˜¯ Spark å¼•æ“çš„æ•°æ®æŠ½è±¡ï¼ŒDStream (Discretized Stream) åˆ™æ˜¯ Spark Streaming å¼•æ“çš„æ•°æ®æŠ½è±¡ã€‚DStream åƒ RDD ä¸€æ ·ï¼Œå…·æœ‰åˆ†å¸ƒå¼ã€å¯æ•…éšœæ¢å¤çš„ç‰¹ç‚¹ï¼Œå¹¶ä¸”èƒ½å¤Ÿå……åˆ†åˆ©ç”¨ Spark å¼•æ“çš„æ¨æµ‹æ‰§è¡Œï¼Œåº”å¯¹ straggler çš„å‡ºç°ã€‚ MillWheel: Fault-Tolerant Stream Processing at Internet Scale (VLDB): MillWheel æ˜¯ Google å†…éƒ¨ç ”å‘çš„å®æ—¶æµæ•°æ®å¤„ç†ç³»ç»Ÿï¼Œå…·æœ‰åˆ†å¸ƒå¼ã€ä½å»¶è¿Ÿã€é«˜å¯ç”¨ã€æ”¯æŒ exactly-once è¯­ä¹‰çš„ç‰¹ç‚¹ã€‚ä¸å‡ºæ„å¤–ï¼ŒMillWheel æ˜¯ Google å¼ºå¤§ infra structure å’Œå¼ºå¤§ engeering èƒ½åŠ›çš„ç»¼åˆä½“ç° â€”â€” åˆ©ç”¨ Bigtable/Spanner ä½œä¸ºåå¤‡çŠ¶æ€å­˜å‚¨ã€ä¿è¯ exactly-once ç‰¹æ€§ç­‰ç­‰ã€‚å¦å¤–ï¼ŒMillWheel å°† watermark æœºåˆ¶å‘æ‰¬å…‰å¤§ï¼Œå¯¹ event time æœ‰ç€éå¸¸å¥½çš„æ”¯æŒã€‚æ¨èå¯¹ streaming system æ„Ÿå…´è¶£çš„æœ‹å‹ä¸€å®šå¤šè¯»å‡ éæ­¤ç¯‡è®ºæ–‡ â€”â€” è™½ç„¶æ­¤ç¯‡å·²ç»å‘è¡¨äº†å‡ å¹´ï¼Œä½†å·¥ä¸šç•Œå¼€æºçš„ç³»ç»Ÿå°šæœªå®Œå…¨è¾¾åˆ° MillWheel çš„æ°´å¹³ã€‚ Integrating Scale Out and Fault Tolerance in Stream Processing using Operator State Management (SIGMOD): é’ˆå¯¹æœ‰çŠ¶æ€çš„ç®—å­çš„çŠ¶æ€ï¼Œæ­¤ç¯‡çš„åŸºæœ¬æ´å¯Ÿæ˜¯ï¼Œscale out å’Œ fault tolerance å…¶å®å¾ˆç›¸é€šï¼Œåº”è¯¥ç»“åˆåˆ°ä¸€èµ·è€ƒè™‘å’Œå®ç°ï¼Œè€Œä¸æ˜¯å°†å…¶å‰²è£‚å¼€æ¥ã€‚æ–‡ç« æå‡ºäº†ç®—å­çš„ 3 ç±»çŠ¶æ€ï¼š(a) processing state, (b) buffer state, å’Œ (c) routing stateï¼Œå¹¶æå‡ºäº†ç®—å­çŠ¶æ€çš„ 4 ä¸ªæ“ä½œåŸè¯­ï¼š(1) checkpoint state, (2) backup state, (3) restore state, (4) partition stateã€‚ 2010 å¹´ S4: Distributed Stream Computing Platform (ICDMW): 2010 å¹´ç®—æ˜¯ general stream processing engine å…ƒå¹´ â€”â€” Yahoo! ç ”å‘å¹¶å‘å¸ƒäº† S4, Backtype å¼€å§‹ç ”å‘äº† Storm å¹¶å°†åœ¨ 1 å¹´åï¼ˆç”± Twitterï¼‰å°†å…¶å¼€æºã€‚S4 å’Œ Storm éƒ½æ˜¯ general-purpose çš„ stream processing engineï¼Œå…è®¸ç”¨æˆ·é€šè¿‡ä»£ç è‡ªå®šä¹‰è®¡ç®—é€»è¾‘ï¼Œè€Œä¸æ˜¯ä»…ä»…æ˜¯ä½¿ç”¨å£°æ˜å¼çš„è¯­è¨€æˆ–ç®—å­ã€‚ 2008 å¹´ Out-of-Order Processing: A New Architecture for HighPerformance Stream System (VLDB): è¿™ç¯‡æ–‡ç« æå‡ºäº†ä¸€ç§æ–°çš„å¤„ç†æ¨¡å‹ï¼Œå³ out-of-order processing (OOP)ï¼Œå–æ¶ˆäº†ä»¥å¾€ streaming system é‡Œå¯¹äº‹ä»¶æœ‰åºçš„å‡è®¾ã€‚é‡è¦çš„æ˜¯ï¼Œè¿™ç¯‡æ–‡ç« æå‡ºäº†å¹¶å®ç°äº† low watermark: lwm(n, S, A) is the smallest value for A that occurs after prefix Sn of stream Sã€‚æˆ‘ä»¬çœ‹åˆ°ï¼Œåœ¨ 2 å¹´å Google å¼€å§‹ç ”å‘çš„ MillWheel é‡Œï¼Œwatermark å°†è¢«å‘æ‰¬å…‰å¤§ã€‚ Fast and Highly-Available Stream Processing over Wide Area Networks (ICDE): é’ˆå¯¹å¹¿åŸŸç½‘ (wide area networks) çš„ stream processing è®¾è®¡çš„å¿«é€Ÿã€é«˜å¯ç”¨æ–¹æ¡ˆã€‚ä¸»è¦æ€æƒ³æ˜¯ä¾é  replicationã€‚ 2007 å¹´ A Cooperative, Self-Configuring High-Availability Solution for Stream Processing (ICDE): ä¸ 2005 å¹´ ICDE çš„æ–‡ç« ä¸€æ ·ï¼Œæ­¤ç¯‡ä¹Ÿè®¨è®º stream processing çš„é«˜å¯ç”¨é—®é¢˜ã€‚ä¸ 2005 å¹´æ–‡ç« åšæ³•ä¸åŒçš„æ˜¯ï¼Œæ­¤ç¯‡çš„ checkpointing æ–¹æ³•æ›´ç»†ç²’åº¦ä¸€äº›ï¼Œæ‰€ä»¥ä¸€ä¸ªèŠ‚ç‚¹ä¸Šçš„ä¸åŒçŠ¶æ€èƒ½å¤Ÿå¤‡ä»½åˆ°ä¸åŒçš„èŠ‚ç‚¹ä¸Šå»ï¼Œå› è€Œåœ¨æ¢å¤çš„æ—¶å€™èƒ½å¤Ÿå¹¶è¡Œæ¢å¤ä»¥æé«˜é€Ÿåº¦ã€‚ 2005 å¹´ The 8 Requirements of Real-Time Stream Processing (SIGMOD): å›¾é¢†å¥–å¾—ä¸» Michael Stonebraker è€çˆ·å­ä¸ä»–åœ¨ StreamBase çš„å°ä¼™ä¼´ä»¬å‹¾ç”»çš„ stream processing applications åº”å½“æ»¡è¶³çš„ 8 æ¡è§„åˆ™ï¼Œå¦‚ Rule 1: Keep the Data Moving, Rule 2: Query using SQL on Streams (StreamSQL), Rule 3: Handle Stream Imperfections (Delayed, Missing and Out-of-Order Data) â€¦ ç­‰ç­‰ã€‚è™½ç„¶æ­¤ç¯‡æœ‰å¼•å¯¼èˆ†è®ºçš„å«Œç–‘ â€”â€” ä¸çŸ¥æ˜¯å…ˆæœ‰äº†è¿™æµ 8 æ¡ã€å†æœ‰äº† StreamBaseï¼Œè¿˜æ˜¯å…ˆæœ‰äº† StreamBaseã€å†æœ‰äº†è¿™æµ 8 æ¡ â€”â€” ä½†å…¶å†…å®¹è¿˜æ˜¯æœ‰ç›¸å½“çš„å€Ÿé‰´æ„ä¹‰ã€‚ The Design of the Borealis Stream Processing Engine (CIDR): Borealis æ˜¯ Aurora çš„åˆ†å¸ƒå¼ã€æ›´ä¼˜åŒ–ç‰ˆæœ¬çš„ç»­ä½œã€‚Borealis æå‡ºå¹¶è§£å†³äº† 3 ä¸ªæ–°ä¸€ä»£ç³»ç»Ÿçš„åŸºç¡€é—®é¢˜ï¼š(1) dynamic revision of query results, (2) dynamic query modification, ä»¥åŠ (3) flexible and highly-scalable optimization. æ­¤ç¯‡è®²è§£äº† Borealis çš„è®¾è®¡ä¸å®ç° â€”â€” p.s. ä¸‹ï¼ŒAurora åŠç»­ä½œ Borealis çš„å‘½åè¿˜çœŸæ˜¯éå¸¸è®²ç©¶ï¼Œæ˜¯å­¦é™¢æ´¾çš„é£æ ¼ :-D High-availability algorithms for distributed stream processing (ICDE): æ­¤ç¯‡ä¸»è¦èšç„¦åœ¨ streaming system çš„é«˜å¯ç”¨æ€§ï¼Œå³æ•…éšœæ¢å¤ã€‚æ–‡ç« æå‡ºäº† 3 ç§ recovery types: (a) precise, (b) gap, å’Œ (c) rollbackï¼Œå¹¶é€šè¿‡ (1) passive standby, (2) upstream backup, (3) active standby çš„æ–¹å¼è¿›è¡Œ recoverã€‚å¯ä¸ 2007 å¹´ ICDE çš„æ–‡ç« å¯¹æ¯”é˜…è¯»ã€‚ 2004 å¹´ STREAM: The Stanford Data Stream Management System (Technique Report): è¿™ç¯‡ technique report å®šä¹‰äº†ä¸€ç§ Continuous Query Language (CQL)ï¼Œè®²è§£äº† Query Plans å’Œ Executionï¼Œè®¨è®ºäº†ä¸€äº› Performance Issuesã€‚ç³»ç»Ÿä¹Ÿæ³¨æ„åˆ°å¹¶è®¨è®ºäº† Adaptivity å’Œ Approximation çš„é—®é¢˜ã€‚ä»è¿™ç¯‡ technique report å¯ä»¥çœ‹å‡ºï¼Œè¿™æ—¶çš„æµå¼è®¡ç®—ï¼Œæ›´å¤šæ˜¯ä¼ ç»Ÿ RDBMS çš„æ€è·¯ï¼Œæ‰©å±•åˆ°äº†å¤„ç†å®æ—¶æµå¼æ•°æ®ï¼›è¿™å¤§çº¦ä¹Ÿæ˜¯ 2010 ä»¥å‰çš„ stream processing ç›¸å…³ç ”ç©¶çš„ç¼©å½±ã€‚ 2002 å¹´ Monitoring Streams â€“ A New Class of Data Management Applications (VLDB): å¤§çº¦åœ¨ 2002 å¹´å‰åï¼Œä»å®æ—¶æ•°æ®ç›‘æ§ï¼ˆå¦‚ç›‘æ§ sensors æ•°æ®ç­‰ï¼‰åº”ç”¨å‡ºå‘ï¼Œå¤§å®¶å·²ç»å¼€å§‹åŒºåˆ†ä¼ ç»Ÿçš„æŸ¥è¯¢ä¸»åŠ¨ã€æ•°æ®è¢«åŠ¨ (Human-Active, DBMS-Passive) æ¨¡å¼å’Œæ–°å…´çš„æ•°æ®ä¸»åŠ¨ã€æŸ¥è¯¢è¢«åŠ¨ (DBMS-Active, Human-Passive) æ¨¡å¼çš„åŒºåˆ« â€”â€” æ­¤ç¯‡å³æ˜¯å…¶ä¸­çš„å…¸å‹ä»£è¡¨ã€‚æ­¤ç¯‡æå‡ºäº†æ–°å¼çš„ DBMS çš„ Auroraï¼Œæè¿°äº†å…¶åŸºæœ¬ç³»ç»Ÿæ¨¡å‹ã€é¢å‘æµå¼æ•°æ®çš„æ“ä½œç®—å­é›†ã€ ä¼˜åŒ–ç­–ç•¥ã€åŠå®æ—¶åº”ç”¨ã€‚ Exploiting Punctuation Semantics in Continuous Data Streams (TKDE): æ­¤ç¯‡å¾ˆæ—©çš„æ³¨æ„åˆ°äº†ä¸€äº›ä¼ ç»Ÿçš„æ“ä½œç®—å­ä¸èƒ½ç”¨äºæ— å°½çš„æ•°æ®æµå…¥çš„åœºæ™¯ï¼Œå› ä¸ºå°†å¯¼è‡´æ— å°½çš„çŠ¶æ€ï¼ˆè€ƒè™‘ outer joinï¼‰ï¼Œæˆ–è€…æ— å°½çš„é˜»å¡ï¼ˆè€ƒè™‘ count æˆ– maxï¼‰ç­‰ã€‚æ­¤ç¯‡æå‡ºï¼Œå¦‚æœåœ¨ stream é‡ŒåŠ å…¥ä¸€äº›ç‰¹æ®Šçš„ punctuationï¼Œæ¥æ ‡è¯†ä¸€æ®µä¸€æ®µçš„æ•°æ®ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æŠŠæ— é™çš„ stream åˆ’åˆ†ä¸ºå¤šä¸ªæœ‰é™çš„æ•°æ®é›†çš„é›†åˆï¼Œä»è€Œä½¿å¾—ä¹‹å‰æåˆ°çš„ç®—å­å˜å¾—å¯ç”¨ã€‚æ­¤ç¯‡çš„ä»·å€¼æ›´å¤šä½“ç°åœ¨ç»™äº† 2008 å¹´ watermark ç›¸å…³çš„æ–‡ç« ä»¥åŸºç¡€ï¼Œä¹ƒè‡³é›†å¤§æˆåœ¨äº† 2010 å¹´ Google MillWheel ä¸­ã€‚ æ€»ç»“æœ¬æ–‡åˆ†äº«äº†å››æœ¬ Flink ç›¸å…³çš„ä¹¦ç±å’Œä¸€ä»½ streaming systems é¢†åŸŸç›¸å…³çš„è®ºæ–‡åˆ—è¡¨ 20+ ç¯‡ï¼Œæ¶‰åŠ streaming systems çš„è®¾è®¡ï¼Œå®ç°ï¼Œæ•…éšœæ¢å¤ï¼Œå¼¹æ€§æ‰©å±•ç­‰å„æ–¹é¢ã€‚ å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ å¦å¤–ä½ å¦‚æœæ„Ÿå…´è¶£çš„è¯ï¼Œä¹Ÿå¯ä»¥å…³æ³¨æˆ‘çš„å…¬ä¼—å·ã€‚ æœ¬ç¯‡æ–‡ç« è¿æ¥æ˜¯ï¼šhttp://www.54tianzhisheng.cn/2019/06/13/flink-book-paper/ Github ä»£ç ä»“åº“https://github.com/zhisheng17/flink-learning/ ä»¥åè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç éƒ½å°†æ”¾åœ¨è¿™ä¸ªä»“åº“é‡Œï¼ŒåŒ…å«äº†è‡ªå·±å­¦ä¹  flink çš„ä¸€äº› demo å’Œåšå®¢ã€‚ åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€å®æˆ˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ","date":"2019-06-11T16:00:00.000Z","path":"2019/06/12/flink-split/","text":"å‰è¨€ä»Šå¤©ä¸Šåˆè¢« Flink çš„ä¸€ä¸ªç®—å­å›°æƒ‘äº†ä¸‹ï¼Œå…·ä½“é—®é¢˜æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ æˆ‘æœ‰è¿™ä¹ˆä¸ªéœ€æ±‚ï¼šæœ‰ä¸åŒç§ç±»å‹çš„å‘Šè­¦æ•°æ®æµ(åŒ…å«æ¢å¤æ•°æ®)ï¼Œç„¶åæˆ‘è¦å°†è¿™äº›æ•°æ®æµåšä¸€ä¸ªæ‹†åˆ†ï¼Œæ‹†åˆ†åçš„è¯ï¼Œæ¯ç§å‘Šè­¦é‡Œé¢çš„æ•°æ®åˆæƒ³å°†å‘Šè­¦æ•°æ®å’Œæ¢å¤æ•°æ®æ‹†åˆ†å‡ºæ¥ã€‚ ç»“æœï¼Œè¿™ä¸ªéœ€æ±‚ç”¨ Flink çš„ Split è¿ç®—ç¬¦å‡ºç°äº†é—®é¢˜ã€‚ åˆ†æéœ€æ±‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æˆ‘æ˜¯æœŸæœ›å¦‚ä¸Šè¿™æ ·å°†æ•°æ®æµè¿›è¡Œæ‹†åˆ†çš„ï¼Œæœ€åå°†æ¯ç§å‘Šè­¦å’Œæ¢å¤ç”¨ä¸åŒçš„æ¶ˆæ¯æ¨¡ç‰ˆåšä¸€ä¸ªæ¸²æŸ“ï¼Œæ¸²æŸ“åå†é€šè¿‡å„ç§å…¶ä»–çš„æ–¹å¼ï¼ˆé’‰é’‰ç¾¤é‚®ä»¶ã€çŸ­ä¿¡ï¼‰è¿›è¡Œå‘Šè­¦é€šçŸ¥ã€‚ äºæ˜¯æˆ‘çš„ä»£ç å¤§æ¦‚çš„ç»“æ„å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879//dataStream æ˜¯æ€»çš„æ•°æ®æµ//split æ˜¯æ‹†åˆ†åçš„æ•°æ®æµSplitStream&lt;AlertEvent&gt; split = dataStream.split(new OutputSelector&lt;AlertEvent&gt;() &#123; @Override public Iterable&lt;String&gt; select(AlertEvent value) &#123; List&lt;String&gt; tags = new ArrayList&lt;&gt;(); switch (value.getType()) &#123; case MIDDLEWARE: tags.add(MIDDLEWARE); break; case HEALTH_CHECK: tags.add(HEALTH_CHECK); break; case DOCKER: tags.add(DOCKER); break; //... //å½“ç„¶è¿™é‡Œè¿˜å¯ä»¥å¾ˆå¤šç§ç±»å‹ &#125; return tags; &#125;&#125;);//ç„¶åä½ æƒ³è·å–æ¯ç§ä¸åŒçš„æ•°æ®ç±»å‹ï¼Œä½ å¯ä»¥ä½¿ç”¨ selectDataStream&lt;AlertEvent&gt; middleware = split.select(MIDDLEWARE); //é€‰å‡ºä¸­é—´ä»¶çš„æ•°æ®æµ//ç„¶åä½ åˆè¦å°†ä¸­é—´ä»¶çš„æ•°æ®æµåˆ†æµæˆå‘Šè­¦å’Œæ¢å¤SplitStream&lt;AlertEvent&gt; middlewareSplit = middleware.split(new OutputSelector&lt;AlertEvent&gt;() &#123; @Override public Iterable&lt;String&gt; select(AlertEvent value) &#123; List&lt;String&gt; tags = new ArrayList&lt;&gt;(); if(value.isRecover()) &#123; tags.add(RECOVER) &#125; else &#123; tags.add(ALERT) &#125; return tags; &#125;&#125;);middlewareSplit.select(ALERT).print(); DataStream&lt;AlertEvent&gt; healthCheck = split.select(HEALTH_CHECK); //é€‰å‡ºå¥åº·æ£€æŸ¥çš„æ•°æ®æµ//ç„¶åä½ åˆè¦å°†å¥åº·æ£€æŸ¥çš„æ•°æ®æµåˆ†æµæˆå‘Šè­¦å’Œæ¢å¤SplitStream&lt;AlertEvent&gt; healthCheckSplit = healthCheck.split(new OutputSelector&lt;AlertEvent&gt;() &#123; @Override public Iterable&lt;String&gt; select(AlertEvent value) &#123; List&lt;String&gt; tags = new ArrayList&lt;&gt;(); if(value.isRecover()) &#123; tags.add(RECOVER) &#125; else &#123; tags.add(ALERT) &#125; return tags; &#125;&#125;);healthCheckSplit.select(ALERT).print();DataStream&lt;AlertEvent&gt; docekr = split.select(DOCKER); //é€‰å‡ºå®¹å™¨çš„æ•°æ®æµ//ç„¶åä½ åˆè¦å°†å®¹å™¨çš„æ•°æ®æµåˆ†æµæˆå‘Šè­¦å’Œæ¢å¤SplitStream&lt;AlertEvent&gt; dockerSplit = docekr.split(new OutputSelector&lt;AlertEvent&gt;() &#123; @Override public Iterable&lt;String&gt; select(AlertEvent value) &#123; List&lt;String&gt; tags = new ArrayList&lt;&gt;(); if(value.isRecover()) &#123; tags.add(RECOVER) &#125; else &#123; tags.add(ALERT) &#125; return tags; &#125;&#125;);dockerSplit.select(ALERT).print(); ç»“æ„æˆ‘æŠ½è±¡åå¤§æ¦‚å°±é•¿ä¸Šé¢è¿™æ ·ï¼Œç„¶åæˆ‘å…ˆæœ¬åœ°æµ‹è¯•çš„æ—¶å€™åªæŠŠå®¹å™¨çš„æ•°æ®é‚£å—ä»£ç æ‰“å¼€äº†ï¼Œå…¶ä»–ç§å‘Šè­¦çš„åˆ†æµä»£ç æ³¨é‡Šæ‰äº†ï¼Œä¸€è¿è¡Œï¼Œå‘ç°ç«Ÿç„¶å®¹å™¨å‘Šè­¦çš„æ•°æ®æ€ä¹ˆè¿˜æºæ‚ç€å¥åº·æ£€æŸ¥çš„æ•°æ®ä¹Ÿä¸€èµ·æ‰“å°å‡ºæ¥äº†ï¼Œä¸€å¼€å§‹æˆ‘ä»¥ä¸ºè‡ªå·±å‡ºäº†å•¥é—®é¢˜ï¼Œå°±å†èµ·ç è¿è¡Œäº†ä¸‰é IDEA æ‰å‘ç°ç»“æœä¸€ç›´éƒ½æ˜¯è¿™æ ·çš„ã€‚ äºæ˜¯ï¼Œæˆ‘åªå¥½åœ¨ç¬¬äºŒæ­¥åˆ†æµå‰å°† docekr æ•°æ®æµæ‰“å°å‡ºæ¥ï¼Œå‘ç°æ˜¯æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œæ‰“å°å‡ºæ¥çš„æ•°æ®éƒ½æ˜¯å®¹å™¨ç›¸å…³çš„ï¼Œæ²¡æœ‰æºæ‚ç€å…¶ä»–ç§çš„æ•°æ®å•Šã€‚è¿™ä¼šå„¿éé™·å…¥äº†æ²‰æ€ï¼Œæ‡µé€¼å‘å‘†äº†ä¸€ä¼šã€‚ è§£å†³é—®é¢˜äºæ˜¯è¿˜æ˜¯å¼€å§‹é¢å‘ Google ç¼–ç¨‹ï¼š å‘ç°ç¬¬ä¸€æ¡å°±æ‰¾åˆ°ç­”æ¡ˆäº†ï¼Œç®€ç›´ä¸è¦å¤ªå¿«ï¼Œç‚¹è¿›å»å¯ä»¥çœ‹åˆ°ä»–ä¹Ÿæœ‰è¿™æ ·çš„éœ€æ±‚ï¼š ç„¶åè¿™ä¸ªå°ä¼™ä¼´è¿˜æŒ£æ‰äº†ä¸‹ç”¨ä¸åŒçš„æ–¹æ³•ï¼ˆè™½ç„¶ç»“æœæ›´æƒ¨ï¼‰ï¼š æœ€åæ¢äº†ä¸ªå§¿åŠ¿å°±å¥½äº†ï¼ˆæœç„¶å°ä¼™å­ä¼šçš„å§¿åŠ¿æŒºå¤šçš„ï¼‰ï¼š ä½†ä»è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘æ‰¾åˆ°äº†å…³è”åˆ°çš„ä¸¤ä¸ª Flink Issueï¼Œåˆ†åˆ«æ˜¯ï¼š 1ã€https://issues.apache.org/jira/browse/FLINK-5031 2ã€https://issues.apache.org/jira/browse/FLINK-11084 ç„¶åå‘¢ï¼Œä»ç¬¬äºŒä¸ª Issue çš„è®¨è®ºä¸­æˆ‘å‘ç°äº†ä¸€äº›å¾ˆæœ‰è¶£çš„è®¨è®ºï¼š å¯¹è¯å¾ˆæœ‰è¶£ï¼Œä½†æ˜¯æˆ‘çªç„¶æƒ³åˆ°ä¹‹å‰æˆ‘çš„çŸ¥è¯†æ˜Ÿçƒé‡Œé¢ä¸€ä½å¾ˆç»†å¿ƒçš„å°ä¼™ä¼´é—®çš„ä¸€ä¸ªé—®é¢˜äº†ï¼š å¯ä»¥å‘ç°ä»£ç ä¸Šç¡®å®æ˜¯æ ‡æ˜äº†è¿‡æœŸäº†ï¼Œä½†æ˜¯æ³¨é‡Šé‡Œé¢æ²¡å†™æ¸…æ¥šæ¨èç”¨å•¥ï¼Œå¹¸å¥½æˆ‘çœ‹åˆ°äº†è¿™ä¸ª Issueï¼Œä¸ç„¶è„‘å­é‡Œé¢ä¼°è®¡è¿™ä¸ªé—®é¢˜ä¸€ç›´ä¼šå­˜ç€å‘¢ã€‚ é‚£ä¹ˆè¿™ä¸ªé—®é¢˜è§£å†³æ–¹æ³•æ˜¯ä¸æ˜¯æ„å‘³ç€å°±å¯ä»¥åˆ©ç”¨ Side Outputs æ¥è§£å†³å‘¢ï¼Ÿå½“ç„¶å¯ä»¥å•¦ï¼Œå®˜æ–¹éƒ½æ¨èäº†ï¼Œè¿˜ä¸èƒ½éƒ½è¯ï¼Œé‚£ä¹ˆä¸æ˜¯æ‰“è„¸å•ªå•ªå•ªçš„å“å—ï¼Ÿä¸è¿‡è¿™é‡Œè¿˜æ˜¯å–ä¸ªå…³å­å°† Side Outputs åé¢ä¸“é—¨ç”¨ä¸€ç¯‡æ–‡ç« æ¥è®²ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥å…ˆçœ‹çœ‹å®˜ç½‘ä»‹ç»ï¼šhttps://ci.apache.org/projects/flink/flink-docs-stable/dev/stream/side_output.html å¦å¤–å…¶å®ä¹Ÿå¯ä»¥é€šè¿‡ split + filter ç»„åˆæ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåæ­£å…³é”®å°±æ˜¯ä¸è¦è¿ç»­çš„ç”¨ split æ¥åˆ†æµã€‚ ç”¨ split + filter çš„æ–¹æ¡ˆä»£ç å¤§æ¦‚å¦‚ä¸‹ï¼š 12345678910111213141516171819DataStream&lt;AlertEvent&gt; docekr = split.select(DOCKER); //é€‰å‡ºå®¹å™¨çš„æ•°æ®æµ//å®¹å™¨å‘Šè­¦çš„æ•°æ®æµdocekr.filter(new FilterFunction&lt;AlertEvent&gt;() &#123; @Override public boolean filter(AlertEvent value) throws Exception &#123; return !value.isRecover(); &#125;&#125;).print(); //å®¹å™¨æ¢å¤çš„æ•°æ®æµ docekr.filter(new FilterFunction&lt;AlertEvent&gt;() &#123; @Override public boolean filter(AlertEvent value) throws Exception &#123; return value.isRecover(); &#125;&#125;).print(); ä¸Šé¢è¿™ç§å°±æ˜¯å¤šæ¬¡ filter ä¹Ÿå¯ä»¥æ»¡è¶³éœ€æ±‚ï¼Œä½†æ˜¯å°±æ˜¯ä»£ç æœ‰ç‚¹å•°å—¦ã€‚ æ€»ç»“Flink ä¸­ä¸æ”¯æŒè¿ç»­çš„ Split/Select åˆ†æµæ“ä½œï¼Œè¦å®ç°è¿ç»­åˆ†æµä¹Ÿå¯ä»¥é€šè¿‡å…¶ä»–çš„æ–¹å¼ï¼ˆsplit + filter æˆ–è€… side outputï¼‰æ¥å®ç° æœ¬ç¯‡æ–‡ç« è¿æ¥æ˜¯ï¼šhttp://www.54tianzhisheng.cn/2019/06/12/flink-split/ å…³æ³¨æˆ‘å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f Github ä»£ç ä»“åº“https://github.com/zhisheng17/flink-learning/ ä»¥åè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç éƒ½å°†æ”¾åœ¨è¿™ä¸ªä»“åº“é‡Œï¼ŒåŒ…å«äº†è‡ªå·±å­¦ä¹  flink çš„ä¸€äº› demo å’Œåšå®¢ã€‚ åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€å®æˆ˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹","date":"2019-03-27T16:00:00.000Z","path":"2019/03/28/Flink-code-TaskManager-submitJob/","text":"TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ https://t.zsxq.com/eu7mQZj åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€å®æˆ˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ","date":"2019-03-27T16:00:00.000Z","path":"2019/03/28/flink-additional-data/","text":"å‰è¨€å¦‚æœä½ äº†è§£ Apache Flink çš„è¯ï¼Œé‚£ä¹ˆä½ åº”è¯¥ç†Ÿæ‚‰è¯¥å¦‚ä½•åƒ Flink å‘é€æ•°æ®æˆ–è€…å¦‚ä½•ä» Flink è·å–æ•°æ®ã€‚ä½†æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦å°†é…ç½®æ•°æ®å‘é€åˆ° Flink é›†ç¾¤å¹¶ä»ä¸­æ¥æ”¶ä¸€äº›é¢å¤–çš„æ•°æ®ã€‚ åœ¨æœ¬æ–‡çš„ç¬¬ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘å°†æè¿°å¦‚ä½•å°†é…ç½®æ•°æ®å‘é€åˆ° Flink é›†ç¾¤ã€‚æˆ‘ä»¬éœ€è¦é…ç½®å¾ˆå¤šä¸œè¥¿:æ–¹æ³•å‚æ•°ã€é…ç½®æ–‡ä»¶ã€æœºå™¨å­¦ä¹ æ¨¡å‹ã€‚Flink æä¾›äº†å‡ ç§ä¸åŒçš„æ–¹æ³•ï¼Œæˆ‘ä»¬å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨å®ƒä»¬ä»¥åŠä½•æ—¶ä½¿ç”¨å®ƒä»¬ã€‚åœ¨æœ¬æ–‡çš„ç¬¬äºŒéƒ¨åˆ†ä¸­ï¼Œæˆ‘å°†æè¿°å¦‚ä½•ä» Flink é›†ç¾¤ä¸­è·å–æ•°æ®ã€‚ å¦‚ä½•å‘é€æ•°æ®ç»™ TaskManagerï¼Ÿåœ¨æˆ‘ä»¬æ·±å…¥ç ”ç©¶å¦‚ä½•åœ¨ Apache Flink ä¸­çš„ä¸åŒç»„ä»¶ä¹‹é—´å‘é€æ•°æ®ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆè°ˆè°ˆ Flink é›†ç¾¤ä¸­çš„ç»„ä»¶ï¼Œä¸‹å›¾å±•ç¤ºäº† Flink ä¸­çš„ä¸»è¦ç»„ä»¶ä»¥åŠå®ƒä»¬æ˜¯å¦‚ä½•ç›¸äº’ä½œç”¨çš„ï¼š å½“æˆ‘ä»¬è¿è¡Œ Flink åº”ç”¨ç¨‹åºæ—¶ï¼Œå®ƒä¼šä¸ Flink JobManager è¿›è¡Œäº¤äº’ï¼Œè¿™ä¸ª Flink JobManager å­˜å‚¨äº†é‚£äº›æ­£åœ¨è¿è¡Œçš„ Job çš„è¯¦ç»†ä¿¡æ¯ï¼Œä¾‹å¦‚æ‰§è¡Œå›¾ã€‚JobManager å®ƒæ§åˆ¶ç€ TaskManagerï¼Œæ¯ä¸ª TaskManager ä¸­åŒ…å«äº†ä¸€éƒ¨åˆ†æ•°æ®æ¥æ‰§è¡Œæˆ‘ä»¬å®šä¹‰çš„æ•°æ®å¤„ç†æ–¹æ³•ã€‚ åœ¨è®¸å¤šçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿå»é…ç½® Flink Job ä¸­æŸäº›è¿è¡Œçš„å‡½æ•°å‚æ•°ã€‚æ ¹æ®ç”¨ä¾‹ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦è®¾ç½®å•ä¸ªå˜é‡æˆ–è€…æäº¤å…·æœ‰é™æ€é…ç½®çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬ä¸‹é¢å°†è®¨è®ºåœ¨ Flink ä¸­è¯¥å¦‚ä½•å®ç°ï¼Ÿ é™¤äº†å‘ TaskManager å‘é€é…ç½®æ•°æ®å¤–ï¼Œæœ‰æ—¶æˆ‘ä»¬å¯èƒ½è¿˜å¸Œæœ›ä» Flink Job çš„å‡½æ•°æ–¹æ³•ä¸­è¿”å›æ•°æ®ã€‚ å¦‚ä½•é…ç½®ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼Ÿå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªä» CSV æ–‡ä»¶ä¸­è¯»å–ç”µå½±åˆ—è¡¨çš„åº”ç”¨ç¨‹åºï¼ˆå®ƒè¦è¿‡æ»¤ç‰¹å®šç±»å‹çš„æ‰€æœ‰ç”µå½±ï¼‰: 1234567891011121314//è¯»å–ç”µå½±åˆ—è¡¨æ•°æ®é›†åˆDataSet&lt;Tuple3&lt;Long, String, String&gt;&gt; lines = env.readCsvFile(\"movies.csv\") .ignoreFirstLine() .parseQuotedStrings('\"') .ignoreInvalidLines() .types(Long.class, String.class, String.class);lines.filter((FilterFunction&lt;Tuple3&lt;Long, String, String&gt;&gt;) movie -&gt; &#123; // ä»¥â€œ|â€ç¬¦å·åˆ†éš”ç”µå½±ç±»å‹ String[] genres = movie.f2.split(\"\\\\|\"); // æŸ¥æ‰¾æ‰€æœ‰ â€œåŠ¨ä½œâ€ ç±»å‹çš„ç”µå½± return Stream.of(genres).anyMatch(g -&gt; g.equals(\"Action\"));&#125;).print(); æˆ‘ä»¬å¾ˆå¯èƒ½æƒ³è¦æå–ä¸åŒç±»å‹çš„ç”µå½±ï¼Œä¸ºæ­¤æˆ‘ä»¬éœ€è¦èƒ½å¤Ÿé…ç½®æˆ‘ä»¬çš„è¿‡æ»¤åŠŸèƒ½ã€‚ å½“ä½ è¦å®ç°è¿™æ ·çš„å‡½æ•°æ—¶ï¼Œæœ€ç›´æ¥çš„é…ç½®æ–¹æ³•æ˜¯å®ç°æ„é€ å‡½æ•°ï¼š 123456789101112131415161718192021// ä¼ é€’ç±»å‹åç§°lines.filter(new FilterGenre(\"Action\")) .print();...class FilterGenre implements FilterFunction&lt;Tuple3&lt;Long, String, String&gt;&gt; &#123; //ç±»å‹ String genre; //åˆå§‹åŒ–æ„é€ æ–¹æ³• public FilterGenre(String genre) &#123; this.genre = genre; &#125; @Override public boolean filter(Tuple3&lt;Long, String, String&gt; movie) throws Exception &#123; String[] genres = movie.f2.split(\"\\\\|\"); return Stream.of(genres).anyMatch(g -&gt; g.equals(genre)); &#125;&#125; æˆ–è€…ï¼Œå¦‚æœä½ ä½¿ç”¨ lambda å‡½æ•°ï¼Œä½ å¯ä»¥ç®€å•åœ°ä½¿ç”¨å®ƒçš„é—­åŒ…ä¸­çš„ä¸€ä¸ªå˜é‡: 12345678final String genre = \"Action\";lines.filter((FilterFunction&lt;Tuple3&lt;Long, String, String&gt;&gt;) movie -&gt; &#123; String[] genres = movie.f2.split(\"\\\\|\"); //ä½¿ç”¨å˜é‡ return Stream.of(genres).anyMatch(g -&gt; g.equals(genre));&#125;).print(); Flink å°†åºåˆ—åŒ–æ­¤å˜é‡å¹¶å°†å…¶ä¸å‡½æ•°ä¸€èµ·å‘é€åˆ°é›†ç¾¤ã€‚ å¦‚æœä½ éœ€è¦å°†å¤§é‡å˜é‡ä¼ é€’ç»™å‡½æ•°ï¼Œé‚£ä¹ˆè¿™äº›æ–¹æ³•å°±ä¼šå˜å¾—éå¸¸çƒ¦äººäº†ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒFlink æä¾›äº† withParameters æ–¹æ³•ã€‚ è¦ä½¿ç”¨å®ƒï¼Œä½ éœ€è¦å®ç°é‚£äº› Rich å‡½æ•°ï¼Œæ¯”å¦‚ä½ ä¸å¿…å®ç° MapFunction æ¥å£ï¼Œè€Œæ˜¯å®ç° RichMapFunctionã€‚ Rich å‡½æ•°å…è®¸ä½ ä½¿ç”¨ withParameters æ–¹æ³•ä¼ é€’è®¸å¤šå‚æ•°ï¼š 12345678// Configuration ç±»æ¥å­˜å‚¨å‚æ•°Configuration configuration = new Configuration();configuration.setString(\"genre\", \"Action\");lines.filter(new FilterGenreWithParameters()) // å°†å‚æ•°ä¼ é€’ç»™å‡½æ•° .withParameters(configuration) .print(); è¦è¯»å–è¿™äº›å‚æ•°ï¼Œæˆ‘ä»¬éœ€è¦å®ç° â€œopenâ€ æ–¹æ³•å¹¶è¯»å–å…¶ä¸­çš„å‚æ•°: 1234567891011121314151617class FilterGenreWithParameters extends RichFilterFunction&lt;Tuple3&lt;Long, String, String&gt;&gt; &#123; String genre; @Override public void open(Configuration parameters) throws Exception &#123; //è¯»å–é…ç½® genre = parameters.getString(\"genre\", \"\"); &#125; @Override public boolean filter(Tuple3&lt;Long, String, String&gt; movie) throws Exception &#123; String[] genres = movie.f2.split(\"\\\\|\"); return Stream.of(genres).anyMatch(g -&gt; g.equals(genre)); &#125;&#125; æ‰€æœ‰è¿™äº›é€‰é¡¹éƒ½å¯ä»¥ä½¿ç”¨ï¼Œä½†å¦‚æœéœ€è¦ä¸ºå¤šä¸ªå‡½æ•°è®¾ç½®ç›¸åŒçš„å‚æ•°ï¼Œåˆ™å¯èƒ½ä¼šå¾ˆç¹çã€‚åœ¨ Flink ä¸­è¦å¤„ç†æ­¤ç§æƒ…å†µï¼Œ ä½ å¯ä»¥è®¾ç½®æ‰€æœ‰ TaskManager éƒ½å¯ä»¥è®¿é—®çš„å…¨å±€ç¯å¢ƒå˜é‡ã€‚ ä¸ºæ­¤ï¼Œé¦–å…ˆéœ€è¦ä½¿ç”¨ ParameterTool.fromArgs ä»å‘½ä»¤è¡Œè¯»å–å‚æ•°ï¼š 12345public static void main(String... args) &#123; //è¯»å–å‘½ä»¤è¡Œå‚æ•° ParameterTool parameterTool = ParameterTool.fromArgs(args); ...&#125; ç„¶åä½¿ç”¨ setGlobalJobParameters è®¾ç½®å…¨å±€ä½œä¸šå‚æ•°: 1234567final ExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment();env.getConfig().setGlobalJobParameters(parameterTool);...//è¯¥å‡½æ•°å°†èƒ½å¤Ÿè¯»å–è¿™äº›å…¨å±€å‚æ•°lines.filter(new FilterGenreWithGlobalEnv()) //è¿™ä¸ªå‡½æ•°æ˜¯è‡ªå·±å®šä¹‰çš„ .print(); ç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªè¯»å–è¿™äº›å‚æ•°çš„å‡½æ•°ï¼Œå’Œä¸Šé¢è¯´çš„ä¸€æ ·ï¼Œå®ƒæ˜¯ä¸€ä¸ª Rich å‡½æ•°ï¼š 12345678910111213class FilterGenreWithGlobalEnv extends RichFilterFunction&lt;Tuple3&lt;Long, String, String&gt;&gt; &#123; @Override public boolean filter(Tuple3&lt;Long, String, String&gt; movie) throws Exception &#123; String[] genres = movie.f2.split(\"\\\\|\"); //è·å–å…¨å±€çš„é…ç½® ParameterTool parameterTool = (ParameterTool) getRuntimeContext().getExecutionConfig().getGlobalJobParameters(); //è¯»å–é…ç½® String genre = parameterTool.get(\"genre\"); return Stream.of(genres).anyMatch(g -&gt; g.equals(genre)); &#125;&#125; è¦è¯»å–é…ç½®ï¼Œæˆ‘ä»¬éœ€è¦è°ƒç”¨ getGlobalJobParameter æ¥è·å–æ‰€æœ‰å…¨å±€å‚æ•°ï¼Œç„¶åä½¿ç”¨ get æ–¹æ³•è·å–æˆ‘ä»¬è¦çš„å‚æ•°ã€‚ å¹¿æ’­å˜é‡å¦‚æœä½ æƒ³å°†æ•°æ®ä»å®¢æˆ·ç«¯å‘é€åˆ° TaskManagerï¼Œä¸Šé¢æ–‡ç« ä¸­è®¨è®ºçš„æ–¹æ³•éƒ½é€‚åˆä½ ï¼Œä½†å¦‚æœæ•°æ®ä»¥æ•°æ®é›†çš„å½¢å¼å­˜åœ¨äº TaskManager ä¸­ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœ€å¥½ä½¿ç”¨ Flink ä¸­çš„å¦ä¸€ä¸ªåŠŸèƒ½ â€”â€” å¹¿æ’­å˜é‡ã€‚ å®ƒåªå…è®¸å°†æ•°æ®é›†å‘é€ç»™é‚£äº›æ‰§è¡Œä½  Job é‡Œé¢å‡½æ•°çš„ä»»åŠ¡ç®¡ç†å™¨ã€‚ å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæ•°æ®é›†ï¼Œå…¶ä¸­åŒ…å«æˆ‘ä»¬åœ¨è¿›è¡Œæ–‡æœ¬å¤„ç†æ—¶åº”å¿½ç•¥çš„å•è¯ï¼Œå¹¶ä¸”æˆ‘ä»¬å¸Œæœ›å°†å…¶è®¾ç½®ä¸ºæˆ‘ä»¬çš„å‡½æ•°ã€‚ è¦ä¸ºå•ä¸ªå‡½æ•°è®¾ç½®å¹¿æ’­å˜é‡ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ withBroadcastSet æ–¹æ³•å’Œæ•°æ®é›†ã€‚ 12345678910111213141516171819202122232425DataSet&lt;Integer&gt; toBroadcast = env.fromElements(1, 2, 3);// è·å–è¦å¿½ç•¥çš„å•è¯é›†åˆDataSet&lt;String&gt; wordsToIgnore = ...data.map(new RichFlatMapFunction&lt;String, String&gt;() &#123; // å­˜å‚¨è¦å¿½ç•¥çš„å•è¯é›†åˆ. è¿™å°†å­˜å‚¨åœ¨ TaskManager çš„å†…å­˜ä¸­ Collection&lt;String&gt; wordsToIgnore; @Override public void open(Configuration parameters) throws Exception &#123; //è¯»å–è¦å¿½ç•¥çš„å•è¯çš„é›†åˆ wordsToIgnore = getRuntimeContext().getBroadcastVariable(\"wordsToIgnore\"); &#125; @Override public String map(String line, Collector&lt;String&gt; out) throws Exception &#123; String[] words = line.split(\"\\\\W+\"); for (String word : words) //ä½¿ç”¨è¦å¿½ç•¥çš„å•è¯é›†åˆ if (wordsToIgnore.contains(word)) out.collect(new Tuple2&lt;&gt;(word, 1)); &#125; //é€šè¿‡å¹¿æ’­å˜é‡ä¼ é€’æ•°æ®é›†&#125;).withBroadcastSet(wordsToIgnore, \"wordsToIgnore\"); ä½ åº”è¯¥è®°ä½ï¼Œå¦‚æœè¦ä½¿ç”¨å¹¿æ’­å˜é‡ï¼Œé‚£ä¹ˆæ•°æ®é›†å°†ä¼šå­˜å‚¨åœ¨ TaskManager çš„å†…å­˜ä¸­ï¼Œå¦‚æœæ•°æ®é›†å’Œè¶Šå¤§ï¼Œé‚£ä¹ˆå ç”¨çš„å†…å­˜å°±ä¼šè¶Šå¤§ï¼Œå› æ­¤ä½¿ç”¨å¹¿æ’­å˜é‡é€‚ç”¨äºè¾ƒå°çš„æ•°æ®é›†ã€‚ å¦‚æœè¦å‘æ¯ä¸ª TaskManager å‘é€æ›´å¤šæ•°æ®å¹¶ä¸”ä¸å¸Œæœ›å°†è¿™äº›æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Flink çš„åˆ†å¸ƒå¼ç¼“å­˜å‘ TaskManager å‘é€é™æ€æ–‡ä»¶ã€‚ è¦ä½¿ç”¨ Flink çš„åˆ†å¸ƒå¼ç¼“å­˜ï¼Œä½ é¦–å…ˆéœ€è¦å°†æ–‡ä»¶å­˜å‚¨åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚ HDFSï¼‰ä¸­ï¼Œç„¶ååœ¨ç¼“å­˜ä¸­æ³¨å†Œè¯¥æ–‡ä»¶ï¼š 12345678ExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment();//ä» HDFS æ³¨å†Œæ–‡ä»¶env.registerCachedFile(\"hdfs:///path/to/file\", \"machineLearningModel\")...env.execute() ä¸ºäº†è®¿é—®åˆ†å¸ƒå¼ç¼“å­˜ï¼Œæˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ª Rich å‡½æ•°ï¼š 12345678910111213class MyClassifier extends RichMapFunction&lt;String, Integer&gt; &#123; @Override public void open(Configuration config) &#123; File machineLearningModel = getRuntimeContext().getDistributedCache().getFile(\"machineLearningModel\"); ... &#125; @Override public Integer map(String value) throws Exception &#123; ... &#125;&#125; è¯·æ³¨æ„ï¼Œè¦è®¿é—®åˆ†å¸ƒå¼ç¼“å­˜ä¸­çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨æˆ‘ä»¬ç”¨äºæ³¨å†Œæ–‡ä»¶çš„ keyï¼Œæ¯”å¦‚ä¸Šé¢ä»£ç ä¸­çš„ machineLearningModelã€‚ Accumulator(ç´¯åŠ å™¨)æˆ‘ä»¬å‰é¢å·²ç»ä»‹ç»äº†å¦‚ä½•å°†æ•°æ®å‘é€ç»™ TaskManagerï¼Œä½†ç°åœ¨æˆ‘ä»¬å°†è®¨è®ºå¦‚ä½•ä» TaskManager ä¸­è¿”å›æ•°æ®ã€‚ ä½ å¯èƒ½æƒ³çŸ¥é“ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦åšè¿™ç§äº‹æƒ…ã€‚ æ¯•ç«Ÿï¼ŒApache Flink å°±æ˜¯å»ºç«‹æ•°æ®å¤„ç†æµæ°´çº¿ï¼Œè¯»å–è¾“å…¥æ•°æ®ï¼Œå¤„ç†æ•°æ®å¹¶è¿”å›ç»“æœã€‚ ä¸ºäº†è¡¨è¾¾æ¸…æ¥šï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ã€‚å‡è®¾æˆ‘ä»¬éœ€è¦è®¡ç®—æ¯ä¸ªå•è¯åœ¨æ–‡æœ¬ä¸­å‡ºç°çš„æ¬¡æ•°ï¼ŒåŒæ—¶æˆ‘ä»¬è¦è®¡ç®—æ–‡æœ¬ä¸­æœ‰å¤šå°‘è¡Œï¼š 1234567891011121314151617181920//è¦å¤„ç†çš„æ•°æ®é›†åˆDataSet&lt;String&gt; lines = ...// Word count ç®—æ³•lines.flatMap(new FlatMapFunction&lt;String, Tuple2&lt;String, Integer&gt;&gt;() &#123; @Override public void flatMap(String line, Collector&lt;Tuple2&lt;String, Integer&gt;&gt; out) throws Exception &#123; String[] words = line.split(\"\\\\W+\"); for (String word : words) &#123; out.collect(new Tuple2&lt;&gt;(word, 1)); &#125; &#125;&#125;).groupBy(0).sum(1).print();// è®¡ç®—è¦å¤„ç†çš„æ–‡æœ¬ä¸­çš„è¡Œæ•°int linesCount = lines.count()System.out.println(linesCount); é—®é¢˜æ˜¯å¦‚æœæˆ‘ä»¬è¿è¡Œè¿™ä¸ªåº”ç”¨ç¨‹åºï¼Œå®ƒå°†è¿è¡Œä¸¤ä¸ª Flink ä½œä¸šï¼é¦–å…ˆå¾—åˆ°å•è¯ç»Ÿè®¡æ•°ï¼Œç„¶åè®¡ç®—è¡Œæ•°ã€‚ è¿™ç»å¯¹æ˜¯ä½æ•ˆçš„ï¼Œä½†æˆ‘ä»¬æ€æ ·æ‰èƒ½é¿å…è¿™ç§æƒ…å†µå‘¢ï¼Ÿä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨ç´¯åŠ å™¨ã€‚å®ƒä»¬å…è®¸ä½ ä» TaskManager å‘é€æ•°æ®ï¼Œå¹¶ä½¿ç”¨é¢„å®šä¹‰çš„åŠŸèƒ½èšåˆæ­¤æ•°æ®ã€‚ Flink æœ‰ä»¥ä¸‹å†…ç½®ç´¯åŠ å™¨ï¼š IntCounterï¼ŒLongCounterï¼ŒDoubleCounterï¼šå…è®¸å°† TaskManager å‘é€çš„ intï¼Œlongï¼Œdouble å€¼æ±‡æ€»åœ¨ä¸€èµ· AverageAccumulatorï¼šè®¡ç®—åŒç²¾åº¦å€¼çš„å¹³å‡å€¼ LongMaximumï¼ŒLongMinimumï¼ŒIntMaximumï¼ŒIntMinimumï¼ŒDoubleMaximumï¼ŒDoubleMinimumï¼šç´¯åŠ å™¨ï¼Œç”¨äºç¡®å®šä¸åŒç±»å‹çš„æœ€å¤§å€¼å’Œæœ€å°å€¼ ç›´æ–¹å›¾ - ç”¨äºè®¡ç®— TaskManager çš„å€¼åˆ†å¸ƒ è¦ä½¿ç”¨ç´¯åŠ å™¨ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºå¹¶æ³¨å†Œä¸€ä¸ªç”¨æˆ·å®šä¹‰çš„å‡½æ•°ï¼Œç„¶ååœ¨å®¢æˆ·ç«¯ä¸Šè¯»å–ç»“æœã€‚ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹è¯¥å¦‚ä½•ä½¿ç”¨å‘¢ï¼š 1234567891011121314151617181920212223242526272829lines.flatMap(new RichFlatMapFunction&lt;String, Tuple2&lt;String, Integer&gt;&gt;() &#123; //åˆ›å»ºä¸€ä¸ªç´¯åŠ å™¨ private IntCounter linesNum = new IntCounter(); @Override public void open(Configuration parameters) throws Exception &#123; //æ³¨å†Œä¸€ä¸ªç´¯åŠ å™¨ getRuntimeContext().addAccumulator(\"linesNum\", linesNum); &#125; @Override public void flatMap(String line, Collector&lt;Tuple2&lt;String, Integer&gt;&gt; out) throws Exception &#123; String[] words = line.split(\"\\\\W+\"); for (String word : words) &#123; out.collect(new Tuple2&lt;&gt;(word, 1)); &#125; // å¤„ç†æ¯ä¸€è¡Œæ•°æ®å linesNum é€’å¢ linesNum.add(1); &#125;&#125;).groupBy(0).sum(1).print();//è·å–ç´¯åŠ å™¨ç»“æœint linesNum = env.getLastJobExecutionResult().getAccumulatorResult(\"linesNum\");System.out.println(linesNum); è¿™æ ·è®¡ç®—å°±å¯ä»¥ç»Ÿè®¡è¾“å…¥æ–‡æœ¬ä¸­æ¯ä¸ªå•è¯å‡ºç°çš„æ¬¡æ•°ä»¥åŠå®ƒæœ‰å¤šå°‘è¡Œã€‚ å¦‚æœéœ€è¦è‡ªå®šä¹‰ç´¯åŠ å™¨ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ Accumulator æˆ– SimpleAccumulator æ¥å£å®ç°è‡ªå·±çš„ç´¯åŠ å™¨ã€‚ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f æœ€åæœ¬ç¯‡æ–‡ç« ç”± zhisheng ç¿»è¯‘ï¼Œç¦æ­¢ä»»ä½•æ— æˆæƒçš„è½¬è½½ã€‚ ç¿»è¯‘ååœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/03/28/flink-additional-data/ åŸæ–‡åœ°å€ï¼šhttps://brewing.codes/2017/10/24/flink-additional-data/ æœ¬æ–‡éƒ¨åˆ†ä»£ç åœ°å€ï¼šhttps://github.com/zhisheng17/flink-learning/tree/master/flink-learning-examples/src/main/java/com/zhisheng/examples/batch/accumulator å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€å®æˆ˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹","date":"2019-03-26T16:00:00.000Z","path":"2019/03/27/Flink-code-JobManager-submitJob/","text":"JobManager å¤„ç† SubmitJobhttps://t.zsxq.com/3JQJMzZ åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€å®æˆ˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ","date":"2019-03-25T16:00:00.000Z","path":"2019/03/26/Flink-code-ExecutionGraph/","text":"ExecutionGraph https://t.zsxq.com/UnA2jIi åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€å®æˆ˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ","date":"2019-03-24T16:00:00.000Z","path":"2019/03/25/Flink-code-jobmanager/","text":"JobManager çš„ä½œç”¨https://t.zsxq.com/2VRrbuf åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€å®æˆ˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ","date":"2019-03-24T16:00:00.000Z","path":"2019/03/25/Flink-code-taskmanager/","text":"TaskManager æœ‰ä»€ä¹ˆä½œç”¨ https://t.zsxq.com/RZbu7yN åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€å®æˆ˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ","date":"2019-03-23T16:00:00.000Z","path":"2019/03/24/Flink-code-memory-management/","text":"å‰è¨€å¦‚ä»Šï¼Œè®¸å¤šç”¨äºåˆ†æå¤§å‹æ•°æ®é›†çš„å¼€æºç³»ç»Ÿéƒ½æ˜¯ç”¨ Java æˆ–è€…æ˜¯åŸºäº JVM çš„ç¼–ç¨‹è¯­è¨€å®ç°çš„ã€‚æœ€ç€åçš„ä¾‹å­æ˜¯ Apache Hadoopï¼Œè¿˜æœ‰è¾ƒæ–°çš„æ¡†æ¶ï¼Œå¦‚ Apache Sparkã€Apache Drillã€Apache Flinkã€‚åŸºäº JVM çš„æ•°æ®åˆ†æå¼•æ“é¢ä¸´çš„ä¸€ä¸ªå¸¸è§æŒ‘æˆ˜å°±æ˜¯å¦‚ä½•åœ¨å†…å­˜ä¸­å­˜å‚¨å¤§é‡çš„æ•°æ®ï¼ˆåŒ…æ‹¬ç¼“å­˜å’Œé«˜æ•ˆå¤„ç†ï¼‰ã€‚åˆç†çš„ç®¡ç†å¥½ JVM å†…å­˜å¯ä»¥å°† éš¾ä»¥é…ç½®ä¸”ä¸å¯é¢„æµ‹çš„ç³»ç»Ÿ ä¸ å°‘é‡é…ç½®ä¸”ç¨³å®šè¿è¡Œçš„ç³»ç»ŸåŒºåˆ†å¼€æ¥ã€‚ åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®º Apache Flink å¦‚ä½•ç®¡ç†å†…å­˜ï¼Œè®¨è®ºå…¶è‡ªå®šä¹‰åºåˆ—åŒ–ä¸ååºåˆ—åŒ–æœºåˆ¶ï¼Œä»¥åŠå®ƒæ˜¯å¦‚ä½•æ“ä½œäºŒè¿›åˆ¶æ•°æ®çš„ã€‚ æ•°æ®å¯¹è±¡ç›´æ¥æ”¾åœ¨å †å†…å­˜ä¸­åœ¨ JVM ä¸­å¤„ç†å¤§é‡æ•°æ®æœ€ç›´æ¥çš„æ–¹å¼å°±æ˜¯å°†è¿™äº›æ•°æ®åšä¸ºå¯¹è±¡å­˜å‚¨åœ¨å †å†…å­˜ä¸­ï¼Œç„¶åç›´æ¥åœ¨å†…å­˜ä¸­æ“ä½œè¿™äº›æ•°æ®ï¼Œå¦‚æœæƒ³è¿›è¡Œæ’åºåˆ™å°±æ˜¯å¯¹å¯¹è±¡åˆ—è¡¨è¿›è¡Œæ’åºã€‚ç„¶è€Œè¿™ç§æ–¹æ³•æœ‰ä¸€äº›æ˜æ˜¾çš„ç¼ºç‚¹ï¼Œé¦–å…ˆï¼Œåœ¨é¢‘ç¹çš„åˆ›å»ºå’Œé”€æ¯å¤§é‡å¯¹è±¡çš„æ—¶å€™ï¼Œç›‘è§†å’Œæ§åˆ¶å †å†…å­˜çš„ä½¿ç”¨å¹¶ä¸æ˜¯ä¸€ä»¶å¾ˆç®€å•çš„äº‹æƒ…ã€‚å¦‚æœå¯¹è±¡åˆ†é…è¿‡å¤šçš„è¯ï¼Œé‚£ä¹ˆä¼šå¯¼è‡´å†…å­˜è¿‡åº¦ä½¿ç”¨ï¼Œä»è€Œè§¦å‘ OutOfMemoryErrorï¼Œå¯¼è‡´ JVM è¿›ç¨‹ç›´æ¥è¢«æ€æ­»ã€‚å¦ä¸€ä¸ªæ–¹é¢å°±æ˜¯å› ä¸ºè¿™äº›å¯¹è±¡å¤§éƒ½æ˜¯ç”Ÿå­˜åœ¨æ–°ç”Ÿä»£ï¼Œå½“ JVM è¿›è¡Œåƒåœ¾å›æ”¶æ—¶ï¼Œåƒåœ¾æ”¶é›†çš„å¼€é”€å¾ˆå®¹æ˜“è¾¾åˆ° 50% ç”šè‡³æ›´å¤šã€‚æœ€åå°±æ˜¯ Java å¯¹è±¡å…·æœ‰ä¸€å®šçš„ç©ºé—´å¼€é”€ï¼ˆå…·ä½“å–å†³äº JVM å’Œå¹³å°ï¼‰ã€‚å¯¹äºå…·æœ‰è®¸å¤šå°å¯¹è±¡çš„æ•°æ®é›†ï¼Œè¿™å¯ä»¥æ˜¾è‘—å‡å°‘æœ‰æ•ˆå¯ç”¨çš„å†…å­˜é‡ã€‚å¦‚æœä½ ç²¾é€šç³»ç»Ÿè®¾è®¡å’Œç³»ç»Ÿè°ƒä¼˜ï¼Œä½ å¯ä»¥æ ¹æ®ç³»ç»Ÿè¿›è¡Œç‰¹å®šçš„å‚æ•°è°ƒæ•´ï¼Œå¯ä»¥æˆ–å¤šæˆ–å°‘çš„æ§åˆ¶å‡ºç° OutOfMemoryError çš„æ¬¡æ•°å’Œé¿å…å †å†…å­˜çš„è¿‡å¤šä½¿ç”¨ï¼Œä½†æ˜¯è¿™ç§è®¾ç½®å’Œè°ƒä¼˜çš„ä½œç”¨æœ‰é™ï¼Œå°¤å…¶æ˜¯åœ¨æ•°æ®é‡è¾ƒå¤§å’Œæ‰§è¡Œç¯å¢ƒå‘ç”Ÿå˜åŒ–çš„æƒ…å†µä¸‹ã€‚ Flink æ˜¯æ€ä¹ˆåšçš„?Apache Flink èµ·æºäºä¸€ä¸ªç ”ç©¶é¡¹ç›®ï¼Œè¯¥é¡¹ç›®æ—¨åœ¨ç»“åˆåŸºäº MapReduce çš„ç³»ç»Ÿå’Œå¹¶è¡Œæ•°æ®åº“ç³»ç»Ÿçš„æœ€ä½³æŠ€æœ¯ã€‚åœ¨æ­¤èƒŒæ™¯ä¸‹ï¼ŒFlink ä¸€ç›´æœ‰è‡ªå·±çš„å†…å­˜æ•°æ®å¤„ç†æ–¹æ³•ã€‚Flink å°†å¯¹è±¡åºåˆ—åŒ–ä¸ºå›ºå®šæ•°é‡çš„é¢„å…ˆåˆ†é…çš„å†…å­˜æ®µï¼Œè€Œä¸æ˜¯ç›´æ¥æŠŠå¯¹è±¡æ”¾åœ¨å †å†…å­˜ä¸Šã€‚å®ƒçš„ DBMS é£æ ¼çš„æ’åºå’Œè¿æ¥ç®—æ³•å°½å¯èƒ½å¤šåœ°å¯¹è¿™ä¸ªäºŒè¿›åˆ¶æ•°æ®è¿›è¡Œæ“ä½œï¼Œä»¥æ­¤å°†åºåˆ—åŒ–å’Œååºåˆ—åŒ–å¼€é”€é™åˆ°æœ€ä½ã€‚å¦‚æœéœ€è¦å¤„ç†çš„æ•°æ®å¤šäºå¯ä»¥ä¿å­˜åœ¨å†…å­˜ä¸­çš„æ•°æ®ï¼ŒFlink çš„è¿ç®—ç¬¦ä¼šå°†éƒ¨åˆ†æ•°æ®æº¢å‡ºåˆ°ç£ç›˜ã€‚äº‹å®ä¸Šï¼Œå¾ˆå¤šFlink çš„å†…éƒ¨å®ç°çœ‹èµ·æ¥æ›´åƒæ˜¯ C / C ++ï¼Œè€Œä¸æ˜¯æ™®é€šçš„ Javaã€‚ä¸‹å›¾æ¦‚è¿°äº† Flink å¦‚ä½•åœ¨å†…å­˜æ®µä¸­å­˜å‚¨åºåˆ—åŒ–æ•°æ®å¹¶åœ¨å¿…è¦æ—¶æº¢å‡ºåˆ°ç£ç›˜ï¼š Flink çš„ä¸»åŠ¨å†…å­˜ç®¡ç†å’Œæ“ä½œäºŒè¿›åˆ¶æ•°æ®æœ‰å‡ ä¸ªå¥½å¤„ï¼š 1ã€å†…å­˜å®‰å…¨æ‰§è¡Œå’Œé«˜æ•ˆçš„æ ¸å¤–ç®—æ³• ç”±äºåˆ†é…çš„å†…å­˜æ®µçš„æ•°é‡æ˜¯å›ºå®šçš„ï¼Œå› æ­¤ç›‘æ§å‰©ä½™çš„å†…å­˜èµ„æºæ˜¯éå¸¸ç®€å•çš„ã€‚åœ¨å†…å­˜ä¸è¶³çš„æƒ…å†µä¸‹ï¼Œå¤„ç†æ“ä½œç¬¦å¯ä»¥æœ‰æ•ˆåœ°å°†æ›´å¤§æ‰¹çš„å†…å­˜æ®µå†™å…¥ç£ç›˜ï¼Œåé¢å†å°†å®ƒä»¬è¯»å›åˆ°å†…å­˜ã€‚å› æ­¤ï¼ŒOutOfMemoryError å°±æœ‰æ•ˆçš„é˜²æ­¢äº†ã€‚ 2ã€å‡å°‘åƒåœ¾æ”¶é›†å‹åŠ› å› ä¸ºæ‰€æœ‰é•¿ç”Ÿå‘½å‘¨æœŸçš„æ•°æ®éƒ½æ˜¯åœ¨ Flink çš„ç®¡ç†å†…å­˜ä¸­ä»¥äºŒè¿›åˆ¶è¡¨ç¤ºçš„ï¼Œæ‰€ä»¥æ‰€æœ‰æ•°æ®å¯¹è±¡éƒ½æ˜¯çŸ­æš‚çš„ï¼Œç”šè‡³æ˜¯å¯å˜çš„ï¼Œå¹¶ä¸”å¯ä»¥é‡ç”¨ã€‚çŸ­ç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡å¯ä»¥æ›´æœ‰æ•ˆåœ°è¿›è¡Œåƒåœ¾æ”¶é›†ï¼Œè¿™å¤§å¤§é™ä½äº†åƒåœ¾æ”¶é›†çš„å‹åŠ›ã€‚ç°åœ¨ï¼Œé¢„å…ˆåˆ†é…çš„å†…å­˜æ®µæ˜¯ JVM å †ä¸Šçš„é•¿æœŸå­˜åœ¨çš„å¯¹è±¡ï¼Œä¸ºäº†é™ä½åƒåœ¾æ”¶é›†çš„å‹åŠ›ï¼ŒFlink ç¤¾åŒºæ­£åœ¨ç§¯æåœ°å°†å…¶åˆ†é…åˆ°å †å¤–å†…å­˜ã€‚è¿™ç§åŠªåŠ›å°†ä½¿å¾— JVM å †å˜å¾—æ›´å°ï¼Œåƒåœ¾æ”¶é›†æ‰€æ¶ˆè€—çš„æ—¶é—´å°†æ›´å°‘ã€‚ 3ã€èŠ‚çœç©ºé—´çš„æ•°æ®å­˜å‚¨ Java å¯¹è±¡å…·æœ‰å­˜å‚¨å¼€é”€ï¼Œå¦‚æœæ•°æ®ä»¥äºŒè¿›åˆ¶çš„å½¢å¼å­˜å‚¨ï¼Œåˆ™å¯ä»¥é¿å…è¿™ç§å¼€é”€ã€‚ 4ã€é«˜æ•ˆçš„äºŒè¿›åˆ¶æ“ä½œå’Œç¼“å­˜æ•æ„Ÿæ€§ åœ¨ç»™å®šåˆé€‚çš„äºŒè¿›åˆ¶è¡¨ç¤ºçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥æœ‰æ•ˆåœ°æ¯”è¾ƒå’Œæ“ä½œäºŒè¿›åˆ¶æ•°æ®ã€‚æ­¤å¤–ï¼ŒäºŒè¿›åˆ¶è¡¨ç¤ºå¯ä»¥å°†ç›¸å…³å€¼ã€å“ˆå¸Œç ã€é”®å’ŒæŒ‡é’ˆç­‰ç›¸é‚»åœ°å­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚è¿™ä½¿å¾—æ•°æ®ç»“æ„é€šå¸¸å…·æœ‰æ›´é«˜æ•ˆçš„ç¼“å­˜è®¿é—®æ¨¡å¼ã€‚ ä¸»åŠ¨å†…å­˜ç®¡ç†çš„è¿™äº›ç‰¹æ€§åœ¨ç”¨äºå¤§è§„æ¨¡æ•°æ®åˆ†æçš„æ•°æ®å¤„ç†ç³»ç»Ÿä¸­æ˜¯éå¸¸å¯å–çš„ï¼Œä½†æ˜¯è¦å®ç°è¿™äº›åŠŸèƒ½çš„ä»£ä»·ä¹Ÿæ˜¯é«˜æ˜‚çš„ã€‚è¦å®ç°å¯¹äºŒè¿›åˆ¶æ•°æ®çš„è‡ªåŠ¨å†…å­˜ç®¡ç†å’Œæ“ä½œå¹¶éæ˜“äº‹ï¼Œä½¿ç”¨ java.util.HashMap æ¯”å®ç°ä¸€ä¸ªå¯æº¢å‡ºçš„ hash-table ï¼ˆç”±å­—èŠ‚æ•°ç»„å’Œè‡ªå®šä¹‰åºåˆ—åŒ–æ”¯æŒï¼‰ã€‚å½“ç„¶ï¼ŒApache Flink å¹¶ä¸æ˜¯å”¯ä¸€ä¸€ä¸ªåŸºäº JVM ä¸”å¯¹äºŒè¿›åˆ¶æ•°æ®è¿›è¡Œæ“ä½œçš„æ•°æ®å¤„ç†ç³»ç»Ÿã€‚ä¾‹å¦‚ Apache Drillã€Apache Igniteã€Apache Geode ä¹Ÿæœ‰åº”ç”¨ç±»ä¼¼æŠ€æœ¯ï¼Œæœ€è¿‘ Apache Spark ä¹Ÿå®£å¸ƒå°†å‘è¿™ä¸ªæ–¹å‘æ¼”è¿›ã€‚ ä¸‹é¢æˆ‘ä»¬å°†è¯¦ç»†è®¨è®º Flink å¦‚ä½•åˆ†é…å†…å­˜ã€å¦‚æœå¯¹å¯¹è±¡è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–ä»¥åŠå¦‚æœå¯¹äºŒè¿›åˆ¶æ•°æ®è¿›è¡Œæ“ä½œã€‚æˆ‘ä»¬è¿˜å°†é€šè¿‡ä¸€äº›æ€§èƒ½è¡¨ç°æ•°æ®æ¥æ¯”è¾ƒå¤„ç†å †å†…å­˜ä¸Šçš„å¯¹è±¡å’Œå¯¹äºŒè¿›åˆ¶æ•°æ®çš„æ“ä½œã€‚ Flink å¦‚ä½•åˆ†é…å†…å­˜?Flink TaskManager æ˜¯ç”±å‡ ä¸ªå†…éƒ¨ç»„ä»¶ç»„æˆçš„ï¼šactor ç³»ç»Ÿï¼ˆè´Ÿè´£ä¸ Flink master åè°ƒï¼‰ã€IOManagerï¼ˆè´Ÿè´£å°†æ•°æ®æº¢å‡ºåˆ°ç£ç›˜å¹¶å°†å…¶è¯»å–å›æ¥ï¼‰ã€MemoryManagerï¼ˆè´Ÿè´£åè°ƒå†…å­˜ä½¿ç”¨ï¼‰ã€‚åœ¨æœ¬ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦è®²è§£ MemoryManagerã€‚ MemoryManager è´Ÿè´£å°† MemorySegments åˆ†é…ã€è®¡ç®—å’Œåˆ†å‘ç»™æ•°æ®å¤„ç†æ“ä½œç¬¦ï¼Œä¾‹å¦‚ sort å’Œ join ç­‰æ“ä½œç¬¦ã€‚MemorySegment æ˜¯ Flink çš„å†…å­˜åˆ†é…å•å…ƒï¼Œç”±å¸¸è§„ Java å­—èŠ‚æ•°ç»„æ”¯æŒ(é»˜è®¤å¤§å°ä¸º 32 KB)ã€‚MemorySegment é€šè¿‡ä½¿ç”¨ Java çš„ unsafe æ–¹æ³•å¯¹å…¶æ”¯æŒçš„å­—èŠ‚æ•°ç»„æä¾›éå¸¸æœ‰æ•ˆçš„è¯»å†™è®¿é—®ã€‚ä½ å¯ä»¥å°† MemorySegment çœ‹ä½œæ˜¯ Java çš„ NIO ByteBuffer çš„å®šåˆ¶ç‰ˆæœ¬ã€‚ä¸ºäº†åœ¨æ›´å¤§çš„è¿ç»­å†…å­˜å—ä¸Šæ“ä½œå¤šä¸ª MemorySegmentï¼ŒFlink ä½¿ç”¨äº†å®ç° Java çš„ java.io.DataOutput å’Œ java.io.DataInput æ¥å£çš„é€»è¾‘è§†å›¾ã€‚ MemorySegments åœ¨ TaskManager å¯åŠ¨æ—¶åˆ†é…ä¸€æ¬¡ï¼Œå¹¶åœ¨ TaskManager å…³é—­æ—¶é”€æ¯ã€‚å› æ­¤ï¼Œåœ¨ TaskManager çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ï¼ŒMemorySegment æ˜¯é‡ç”¨çš„ï¼Œè€Œä¸ä¼šè¢«åƒåœ¾æ”¶é›†çš„ã€‚åœ¨åˆå§‹åŒ– TaskManager çš„æ‰€æœ‰å†…éƒ¨æ•°æ®ç»“æ„å¹¶ä¸”å·²å¯åŠ¨æ‰€æœ‰æ ¸å¿ƒæœåŠ¡ä¹‹åï¼ŒMemoryManager å¼€å§‹åˆ›å»º MemorySegmentsã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒæœåŠ¡åˆå§‹åŒ–åï¼Œ70ï¼… å¯ç”¨çš„ JVM å †å†…å­˜ç”± MemoryManager åˆ†é…ï¼ˆä¹Ÿå¯ä»¥é…ç½®å…¨éƒ¨ï¼‰ã€‚å‰©ä½™çš„ JVM å †å†…å­˜ç”¨äºåœ¨ä»»åŠ¡å¤„ç†æœŸé—´å®ä¾‹åŒ–çš„å¯¹è±¡ï¼ŒåŒ…æ‹¬ç”±ç”¨æˆ·å®šä¹‰çš„å‡½æ•°åˆ›å»ºçš„å¯¹è±¡ã€‚ä¸‹å›¾æ˜¾ç¤ºäº†å¯åŠ¨å TaskManager JVM ä¸­çš„å†…å­˜åˆ†å¸ƒï¼š Flink å¦‚ä½•åºåˆ—åŒ–å¯¹è±¡ï¼ŸJava ç”Ÿæ€ç³»ç»Ÿæä¾›äº†å‡ ä¸ªåº“ï¼Œå¯ä»¥å°†å¯¹è±¡è½¬æ¢ä¸ºäºŒè¿›åˆ¶è¡¨ç¤ºå½¢å¼å¹¶è¿”å›ã€‚å¸¸è§çš„æ›¿ä»£æ–¹æ¡ˆæ˜¯æ ‡å‡† Java åºåˆ—åŒ–ï¼ŒKryoï¼ŒApache Avroï¼ŒApache Thrift æˆ– Google çš„ Protobufã€‚Flink åŒ…å«è‡ªå·±çš„è‡ªå®šä¹‰åºåˆ—åŒ–æ¡†æ¶ï¼Œä»¥ä¾¿æ§åˆ¶æ•°æ®çš„äºŒè¿›åˆ¶è¡¨ç¤ºã€‚è¿™ä¸€ç‚¹å¾ˆé‡è¦ï¼Œå› ä¸ºå¯¹äºŒè¿›åˆ¶æ•°æ®è¿›è¡Œæ“ä½œéœ€è¦å¯¹åºåˆ—åŒ–å¸ƒå±€æœ‰å‡†ç¡®çš„äº†è§£ã€‚æ­¤å¤–ï¼Œæ ¹æ®åœ¨äºŒè¿›åˆ¶æ•°æ®ä¸Šæ‰§è¡Œçš„æ“ä½œé…ç½®åºåˆ—åŒ–å¸ƒå±€å¯ä»¥æ˜¾è‘—æå‡æ€§èƒ½ã€‚Flink çš„åºåˆ—åŒ–æœºåˆ¶åˆ©ç”¨äº†è¿™ä¸€ç‰¹æ€§ï¼Œå³åœ¨æ‰§è¡Œç¨‹åºä¹‹å‰ï¼Œè¦åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„å¯¹è±¡çš„ç±»å‹æ˜¯å®Œå…¨å·²çŸ¥çš„ã€‚ Flink ç¨‹åºå¯ä»¥å¤„ç†è¡¨ç¤ºä¸ºä»»æ„ Java æˆ– Scala å¯¹è±¡çš„æ•°æ®ã€‚åœ¨ä¼˜åŒ–ç¨‹åºä¹‹å‰ï¼Œéœ€è¦è¯†åˆ«ç¨‹åºæ•°æ®æµçš„æ¯ä¸ªå¤„ç†æ­¥éª¤ä¸­çš„æ•°æ®ç±»å‹ã€‚å¯¹äº Java ç¨‹åºï¼ŒFlink æä¾›äº†ä¸€ä¸ªåŸºäºåå°„çš„ç±»å‹æå–ç»„ä»¶ï¼Œç”¨äºåˆ†æç”¨æˆ·å®šä¹‰å‡½æ•°çš„è¿”å›ç±»å‹ã€‚Scala ç¨‹åºå¯ä»¥åœ¨ Scala ç¼–è¯‘å™¨çš„å¸®åŠ©ä¸‹è¿›è¡Œåˆ†æã€‚Flink ä½¿ç”¨ TypeInformation è¡¨ç¤ºæ¯ç§æ•°æ®ç±»å‹ã€‚ æ³¨ï¼šè¯¥å›¾é€‰è‡ªè‘£ä¼ŸæŸ¯çš„æ–‡ç« ã€ŠApache Flink ç±»å‹å’Œåºåˆ—åŒ–æœºåˆ¶ç®€ä»‹ã€‹ï¼Œä¾µåˆ  Flink æœ‰å¦‚ä¸‹å‡ ç§æ•°æ®ç±»å‹çš„ TypeInformationsï¼š BasicTypeInfoï¼šæ‰€æœ‰ Java çš„åŸºç¡€ç±»å‹æˆ– java.lang.String BasicArrayTypeInfoï¼šJava åŸºæœ¬ç±»å‹æ„æˆçš„æ•°ç»„æˆ– java.lang.String WritableTypeInfoï¼šHadoop çš„ Writable æ¥å£çš„ä»»ä½•å®ç° TupleTypeInfoï¼šä»»ä½• Flink tupleï¼ˆTuple1 åˆ° Tuple25ï¼‰ã€‚Flink tuples æ˜¯å…·æœ‰ç±»å‹åŒ–å­—æ®µçš„å›ºå®šé•¿åº¦å…ƒç»„çš„ Java è¡¨ç¤º CaseClassTypeInfoï¼šä»»ä½• Scala CaseClassï¼ˆåŒ…æ‹¬ Scala tuplesï¼‰ PojoTypeInfoï¼šä»»ä½• POJOï¼ˆJava æˆ– Scalaï¼‰ï¼Œå³æ‰€æœ‰å­—æ®µéƒ½æ˜¯ public çš„æˆ–é€šè¿‡ getter å’Œ setter è®¿é—®çš„å¯¹è±¡ï¼Œéµå¾ªé€šç”¨å‘½åçº¦å®š GenericTypeInfoï¼šä¸èƒ½æ ‡è¯†ä¸ºå…¶ä»–ç±»å‹çš„ä»»ä½•æ•°æ®ç±»å‹ æ³¨ï¼šè¯¥å›¾é€‰è‡ªè‘£ä¼ŸæŸ¯çš„æ–‡ç« ã€ŠApache Flink ç±»å‹å’Œåºåˆ—åŒ–æœºåˆ¶ç®€ä»‹ã€‹ï¼Œä¾µåˆ  æ¯ä¸ª TypeInformation éƒ½ä¸ºå®ƒæ‰€ä»£è¡¨çš„æ•°æ®ç±»å‹æä¾›äº†ä¸€ä¸ªåºåˆ—åŒ–å™¨ã€‚ä¾‹å¦‚ï¼ŒBasicTypeInfo è¿”å›ä¸€ä¸ªåºåˆ—åŒ–å™¨ï¼Œè¯¥åºåˆ—åŒ–å™¨å†™å…¥ç›¸åº”çš„åŸºæœ¬ç±»å‹ï¼›WritableTypeInfo çš„åºåˆ—åŒ–å™¨å°†åºåˆ—åŒ–å’Œååºåˆ—åŒ–å§”æ‰˜ç»™å®ç° Hadoop çš„ Writable æ¥å£çš„å¯¹è±¡çš„ write() å’Œ readFields() æ–¹æ³•ï¼›GenericTypeInfo è¿”å›ä¸€ä¸ªåºåˆ—åŒ–å™¨ï¼Œè¯¥åºåˆ—åŒ–å™¨å°†åºåˆ—åŒ–å§”æ‰˜ç»™ Kryoã€‚å¯¹è±¡å°†è‡ªåŠ¨é€šè¿‡ Java ä¸­é«˜æ•ˆçš„ Unsafe æ–¹æ³•æ¥åºåˆ—åŒ–åˆ° Flink MemorySegments æ”¯æŒçš„ DataOutputã€‚å¯¹äºå¯ç”¨ä½œé”®çš„æ•°æ®ç±»å‹ï¼Œä¾‹å¦‚å“ˆå¸Œå€¼ï¼ŒTypeInformation æä¾›äº† TypeComparatorsï¼ŒTypeComparators æ¯”è¾ƒå’Œå“ˆå¸Œå¯¹è±¡ï¼Œå¹¶ä¸”å¯ä»¥æ ¹æ®å…·ä½“çš„æ•°æ®ç±»å‹æœ‰æ•ˆçš„æ¯”è¾ƒäºŒè¿›åˆ¶å¹¶æå–å›ºå®šé•¿åº¦çš„äºŒè¿›åˆ¶ key å‰ç¼€ã€‚ Tupleï¼ŒPojo å’Œ CaseClass ç±»å‹æ˜¯å¤åˆç±»å‹ï¼Œå®ƒä»¬å¯èƒ½åµŒå¥—ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ•°æ®ç±»å‹ã€‚å› æ­¤ï¼Œå®ƒä»¬çš„åºåˆ—åŒ–å’Œæ¯”è¾ƒä¹Ÿéƒ½æ¯”è¾ƒå¤æ‚ï¼Œä¸€èˆ¬å°†å…¶æˆå‘˜æ•°æ®ç±»å‹çš„åºåˆ—åŒ–å’Œæ¯”è¾ƒéƒ½äº¤ç»™å„è‡ªçš„ Serializersï¼ˆåºåˆ—åŒ–å™¨ï¼‰ å’Œ Comparatorsï¼ˆæ¯”è¾ƒå™¨ï¼‰ã€‚ä¸‹å›¾è¯´æ˜äº† Tuple3&lt;Integer, Double, Person&gt;å¯¹è±¡çš„åºåˆ—åŒ–ï¼Œå…¶ä¸­Person æ˜¯ POJO å¹¶å®šä¹‰å¦‚ä¸‹ï¼š 1234public class Person &#123; public int id; public String name;&#125; é€šè¿‡æä¾›å®šåˆ¶çš„ TypeInformationsã€Serializersï¼ˆåºåˆ—åŒ–å™¨ï¼‰ å’Œ Comparatorsï¼ˆæ¯”è¾ƒå™¨ï¼‰ï¼Œå¯ä»¥æ–¹ä¾¿åœ°æ‰©å±• Flink çš„ç±»å‹ç³»ç»Ÿï¼Œä»è€Œæé«˜åºåˆ—åŒ–å’Œæ¯”è¾ƒè‡ªå®šä¹‰æ•°æ®ç±»å‹çš„æ€§èƒ½ã€‚ Flink å¦‚ä½•å¯¹äºŒè¿›åˆ¶æ•°æ®è¿›è¡Œæ“ä½œï¼Ÿä¸å…¶ä»–çš„æ•°æ®å¤„ç†æ¡†æ¶çš„ APIï¼ˆåŒ…æ‹¬ SQLï¼‰ç±»ä¼¼ï¼ŒFlink çš„ API ä¹Ÿæä¾›äº†å¯¹æ•°æ®é›†è¿›è¡Œåˆ†ç»„ã€æ’åºå’Œè¿æ¥ç­‰è½¬æ¢æ“ä½œã€‚è¿™äº›è½¬æ¢æ“ä½œçš„æ•°æ®é›†å¯èƒ½éå¸¸å¤§ã€‚å…³ç³»æ•°æ®åº“ç³»ç»Ÿå…·æœ‰éå¸¸é«˜æ•ˆçš„ç®—æ³•ï¼Œæ¯”å¦‚ merge-sortã€merge-join å’Œ hash-joinã€‚Flink å»ºç«‹åœ¨è¿™ç§æŠ€æœ¯çš„åŸºç¡€ä¸Šï¼Œä½†æ˜¯ä¸»è¦åˆ†ä¸ºä½¿ç”¨è‡ªå®šä¹‰åºåˆ—åŒ–å’Œè‡ªå®šä¹‰æ¯”è¾ƒå™¨æ¥å¤„ç†ä»»æ„å¯¹è±¡ã€‚åœ¨ä¸‹é¢æ–‡ç« ä¸­æˆ‘ä»¬å°†é€šè¿‡ Flink çš„å†…å­˜æ’åºç®—æ³•ç¤ºä¾‹æ¼”ç¤º Flink å¦‚ä½•ä½¿ç”¨äºŒè¿›åˆ¶æ•°æ®è¿›è¡Œæ“ä½œã€‚ Flink ä¸ºå…¶æ•°æ®å¤„ç†æ“ä½œç¬¦é¢„å…ˆåˆ†é…å†…å­˜ï¼Œåˆå§‹åŒ–æ—¶ï¼Œæ’åºç®—æ³•ä» MemoryManager è¯·æ±‚å†…å­˜é¢„ç®—ï¼Œå¹¶æ¥æ”¶ä¸€ç»„ç›¸åº”çš„ MemorySegmentsã€‚è¿™äº› MemorySegments å˜æˆäº†ç¼“å†²åŒºçš„å†…å­˜æ± ï¼Œç¼“å†²åŒºä¸­æ”¶é›†è¦æ’åºçš„æ•°æ®ã€‚ä¸‹å›¾è¯´æ˜äº†å¦‚ä½•å°†æ•°æ®å¯¹è±¡åºåˆ—åŒ–åˆ°æ’åºç¼“å†²åŒºä¸­ï¼š æ’åºç¼“å†²åŒºåœ¨å†…éƒ¨åˆ†ä¸ºä¸¤ä¸ªå†…å­˜åŒºåŸŸï¼šç¬¬ä¸€ä¸ªåŒºåŸŸä¿å­˜æ‰€æœ‰å¯¹è±¡çš„å®Œæ•´äºŒè¿›åˆ¶æ•°æ®ï¼Œç¬¬äºŒä¸ªåŒºåŸŸåŒ…å«æŒ‡å‘å®Œæ•´äºŒè¿›åˆ¶å¯¹è±¡æ•°æ®çš„æŒ‡é’ˆï¼ˆå–å†³äº key çš„æ•°æ®ç±»å‹ï¼‰ã€‚å°†å¯¹è±¡æ·»åŠ åˆ°æ’åºç¼“å†²åŒºæ—¶ï¼Œå®ƒçš„äºŒè¿›åˆ¶æ•°æ®ä¼šè¿½åŠ åˆ°ç¬¬ä¸€ä¸ªåŒºåŸŸï¼ŒæŒ‡é’ˆ(å¯èƒ½è¿˜æœ‰ä¸€ä¸ª key)è¢«è¿½åŠ åˆ°ç¬¬äºŒä¸ªåŒºåŸŸã€‚åˆ†ç¦»å®é™…æ•°æ®å’ŒæŒ‡é’ˆä»¥åŠå›ºå®šé•¿åº¦çš„ key æœ‰ä¸¤ä¸ªç›®çš„ï¼šå®ƒå¯ä»¥æœ‰æ•ˆçš„äº¤æ¢å›ºå®šé•¿åº¦çš„ entriesï¼ˆkey å’ŒæŒ‡é’ˆï¼‰ï¼Œè¿˜å¯ä»¥å‡å°‘æ’åºæ—¶éœ€è¦ç§»åŠ¨çš„æ•°æ®ã€‚å¦‚æœæ’åºçš„ key æ˜¯å¯å˜é•¿åº¦çš„æ•°æ®ç±»å‹ï¼ˆæ¯”å¦‚ Stringï¼‰ï¼Œåˆ™å›ºå®šé•¿åº¦çš„æ’åº key å¿…é¡»æ˜¯å‰ç¼€ keyï¼Œæ¯”å¦‚å­—ç¬¦ä¸²çš„å‰ n ä¸ªå­—ç¬¦ã€‚è¯·æ³¨æ„ï¼šå¹¶éæ‰€æœ‰æ•°æ®ç±»å‹éƒ½æä¾›å›ºå®šé•¿åº¦çš„å‰ç¼€æ’åº keyã€‚å°†å¯¹è±¡åºåˆ—åŒ–åˆ°æ’åºç¼“å†²åŒºæ—¶ï¼Œä¸¤ä¸ªå†…å­˜åŒºåŸŸéƒ½ä½¿ç”¨å†…å­˜æ± ä¸­çš„ MemorySegments è¿›è¡Œæ‰©å±•ã€‚ä¸€æ—¦å†…å­˜æ± ä¸ºç©ºä¸”ä¸èƒ½å†æ·»åŠ å¯¹è±¡æ—¶ï¼Œåˆ™æ’åºç¼“å†²åŒºå°†ä¼šè¢«å®Œå…¨å¡«å……å¹¶å¯ä»¥è¿›è¡Œæ’åºã€‚Flink çš„æ’åºç¼“å†²åŒºæä¾›äº†æ¯”è¾ƒå’Œäº¤æ¢å…ƒç´ çš„æ–¹æ³•ï¼Œè¿™ä½¿å¾—å®é™…çš„æ’åºç®—æ³•æ˜¯å¯æ’æ‹”çš„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ Flink ä½¿ç”¨äº† Quicksortï¼ˆå¿«é€Ÿæ’åºï¼‰å®ç°ï¼Œå¯ä»¥ä½¿ç”¨ HeapSortï¼ˆå †æ’åºï¼‰ã€‚ä¸‹å›¾æ˜¾ç¤ºäº†å¦‚ä½•æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡ï¼š æ’åºç¼“å†²åŒºé€šè¿‡æ¯”è¾ƒå®ƒä»¬çš„äºŒè¿›åˆ¶å›ºå®šé•¿åº¦æ’åº key æ¥æ¯”è¾ƒä¸¤ä¸ªå…ƒç´ ã€‚å¦‚æœå…ƒç´ çš„å®Œæ•´ keyï¼ˆä¸æ˜¯å‰ç¼€ keyï¼‰ æˆ–è€…äºŒè¿›åˆ¶å‰ç¼€ key ä¸ç›¸ç­‰ï¼Œåˆ™ä»£è¡¨æ¯”è¾ƒæˆåŠŸã€‚å¦‚æœå‰ç¼€ key ç›¸ç­‰(æˆ–è€…æ’åº key çš„æ•°æ®ç±»å‹ä¸æä¾›äºŒè¿›åˆ¶å‰ç¼€ key)ï¼Œåˆ™æ’åºç¼“å†²åŒºéµå¾ªæŒ‡å‘å®é™…å¯¹è±¡æ•°æ®çš„æŒ‡é’ˆï¼Œå¯¹ä¸¤ä¸ªå¯¹è±¡è¿›è¡Œååºåˆ—åŒ–å¹¶æ¯”è¾ƒå¯¹è±¡ã€‚æ ¹æ®æ¯”è¾ƒç»“æœï¼Œæ’åºç®—æ³•å†³å®šæ˜¯å¦äº¤æ¢æ¯”è¾ƒçš„å…ƒç´ ã€‚æ’åºç¼“å†²åŒºé€šè¿‡ç§»åŠ¨å…¶å›ºå®šé•¿åº¦ key å’ŒæŒ‡é’ˆæ¥äº¤æ¢ä¸¤ä¸ªå…ƒç´ ï¼Œå®é™…æ•°æ®ä¸ä¼šç§»åŠ¨ï¼Œæ’åºç®—æ³•å®Œæˆåï¼Œæ’åºç¼“å†²åŒºä¸­çš„æŒ‡é’ˆè¢«æ­£ç¡®æ’åºã€‚ä¸‹å›¾æ¼”ç¤ºäº†å¦‚ä½•ä»æ’åºç¼“å†²åŒºè¿”å›å·²æ’åºçš„æ•°æ®ï¼š é€šè¿‡é¡ºåºè¯»å–æ’åºç¼“å†²åŒºçš„æŒ‡é’ˆåŒºåŸŸï¼Œè·³è¿‡æ’åº key å¹¶æŒ‰ç…§å®é™…æ•°æ®çš„æ’åºæŒ‡é’ˆè¿”å›æ’åºæ•°æ®ã€‚æ­¤æ•°æ®è¦ä¹ˆååºåˆ—åŒ–å¹¶ä½œä¸ºå¯¹è±¡è¿”å›ï¼Œè¦ä¹ˆåœ¨å¤–éƒ¨åˆå¹¶æ’åºçš„æƒ…å†µä¸‹å¤åˆ¶äºŒè¿›åˆ¶æ•°æ®å¹¶å°†å…¶å†™å…¥ç£ç›˜ã€‚ åŸºå‡†æµ‹è¯•æ•°æ®é‚£ä¹ˆï¼Œå¯¹äºŒè¿›åˆ¶æ•°æ®è¿›è¡Œæ“ä½œå¯¹æ€§èƒ½æ„å‘³ç€ä»€ä¹ˆï¼Ÿæˆ‘ä»¬å°†è¿è¡Œä¸€ä¸ªåŸºå‡†æµ‹è¯•ï¼Œå¯¹ 1000 ä¸‡ä¸ªTuple2&lt;Integer, String&gt;å¯¹è±¡è¿›è¡Œæ’åºä»¥æ‰¾å‡ºç­”æ¡ˆã€‚æ•´æ•°å­—æ®µçš„å€¼ä»å‡åŒ€åˆ†å¸ƒä¸­é‡‡æ ·ã€‚String å­—æ®µå€¼çš„é•¿åº¦ä¸º 12 ä¸ªå­—ç¬¦ï¼Œå¹¶ä»é•¿å°¾åˆ†å¸ƒä¸­è¿›è¡Œé‡‡æ ·ã€‚è¾“å…¥æ•°æ®ç”±è¿”å›å¯å˜å¯¹è±¡çš„è¿­ä»£å™¨æä¾›ï¼Œå³è¿”å›å…·æœ‰ä¸åŒå­—æ®µå€¼çš„ç›¸åŒ Tuple å¯¹è±¡å®ä¾‹ã€‚Flink åœ¨ä»å†…å­˜ï¼Œç½‘ç»œæˆ–ç£ç›˜è¯»å–æ•°æ®æ—¶ä½¿ç”¨æ­¤æŠ€æœ¯ï¼Œä»¥é¿å…ä¸å¿…è¦çš„å¯¹è±¡å®ä¾‹åŒ–ã€‚åŸºå‡†æµ‹è¯•åœ¨å…·æœ‰ 900 MB å †å¤§å°çš„ JVM ä¸­è¿è¡Œï¼Œåœ¨å †ä¸Šå­˜å‚¨å’Œæ’åº 1000 ä¸‡ä¸ª Tuple å¯¹è±¡å¹¶ä¸”ä¸ä¼šå¯¼è‡´è§¦å‘ OutOfMemoryError å¤§çº¦éœ€è¦è¿™ä¹ˆå¤§çš„å†…å­˜ã€‚æˆ‘ä»¬ä½¿ç”¨ä¸‰ç§æ’åºæ–¹æ³•åœ¨Integer å­—æ®µå’Œ String å­—æ®µä¸Šå¯¹ Tuple å¯¹è±¡è¿›è¡Œæ’åºï¼š 1ã€å¯¹è±¡å­˜åœ¨å †ä¸­ï¼šTuple å¯¹è±¡å­˜å‚¨åœ¨å¸¸ç”¨çš„ java.util.ArrayList ä¸­ï¼Œåˆå§‹å®¹é‡è®¾ç½®ä¸º 1000 ä¸‡ï¼Œå¹¶ä½¿ç”¨ Java ä¸­å¸¸ç”¨çš„é›†åˆæ’åºè¿›è¡Œæ’åºã€‚ Flink åºåˆ—åŒ–ï¼šä½¿ç”¨ Flink çš„è‡ªå®šä¹‰åºåˆ—åŒ–ç¨‹åºå°† Tuple å­—æ®µåºåˆ—åŒ–ä¸º 600 MB å¤§å°çš„æ’åºç¼“å†²åŒºï¼Œå¦‚ä¸Šæ‰€è¿°æ’åºï¼Œæœ€åå†æ¬¡ååºåˆ—åŒ–ã€‚åœ¨ Integer å­—æ®µä¸Šè¿›è¡Œæ’åºæ—¶ï¼Œå®Œæ•´çš„ Integer ç”¨ä½œæ’åº keyï¼Œä»¥ä¾¿æ’åºå®Œå…¨å‘ç”Ÿåœ¨äºŒè¿›åˆ¶æ•°æ®ä¸Šï¼ˆä¸éœ€è¦å¯¹è±¡çš„ååºåˆ—åŒ–ï¼‰ã€‚å¯¹äº String å­—æ®µçš„æ’åºï¼Œä½¿ç”¨ 8 å­—èŠ‚å‰ç¼€ keyï¼Œå¦‚æœå‰ç¼€ key ç›¸ç­‰ï¼Œåˆ™å¯¹ Tuple å¯¹è±¡è¿›è¡Œååºåˆ—åŒ–ã€‚ 3ã€Kryo åºåˆ—åŒ–ï¼šä½¿ç”¨ Kryo åºåˆ—åŒ–å°† Tuple å­—æ®µåºåˆ—åŒ–ä¸º 600 MB å¤§å°çš„æ’åºç¼“å†²åŒºï¼Œå¹¶åœ¨æ²¡æœ‰äºŒè¿›åˆ¶æ’åº key çš„æƒ…å†µä¸‹è¿›è¡Œæ’åºã€‚è¿™æ„å‘³ç€æ¯æ¬¡æ¯”è¾ƒéœ€è¦å¯¹ä¸¤ä¸ªå¯¹è±¡è¿›è¡Œååºåˆ—åŒ–ã€‚ æ‰€æœ‰æ’åºæ–¹æ³•éƒ½ä½¿ç”¨å•çº¿ç¨‹å®ç°ã€‚ç»“æœçš„æ—¶é—´æ˜¯åæ¬¡è¿è¡Œç»“æœçš„å¹³å‡å€¼ã€‚åœ¨æ¯æ¬¡è¿è¡Œä¹‹åï¼Œæˆ‘ä»¬è°ƒç”¨System.gc()è¯·æ±‚åƒåœ¾æ”¶é›†è¿è¡Œï¼Œè¯¥è¿è¡Œä¸ä¼šè¿›å…¥æµ‹é‡çš„æ‰§è¡Œæ—¶é—´ã€‚ä¸‹å›¾æ˜¾ç¤ºäº†å°†è¾“å…¥æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå¯¹å…¶è¿›è¡Œæ’åºå¹¶å°†å…¶ä½œä¸ºå¯¹è±¡è¯»å›çš„æ—¶é—´ã€‚ æˆ‘ä»¬çœ‹åˆ° Flink ä½¿ç”¨è‡ªå·±çš„åºåˆ—åŒ–å™¨å¯¹äºŒè¿›åˆ¶æ•°æ®è¿›è¡Œæ’åºæ˜æ˜¾ä¼˜äºå…¶ä»–ä¸¤ç§æ–¹æ³•ã€‚ä¸å­˜å‚¨åœ¨å †å†…å­˜ä¸Šç›¸æ¯”ï¼Œæˆ‘ä»¬çœ‹åˆ°å°†æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­è¦å¿«å¾—å¤šã€‚å› ä¸ºæˆ‘ä»¬å®é™…ä¸Šæ˜¯åœ¨æ”¶é›†å¯¹è±¡ï¼Œæ²¡æœ‰æœºä¼šé‡ç”¨å¯¹è±¡å®ä¾‹ï¼Œä½†å¿…é¡»é‡æ–°åˆ›å»ºæ¯ä¸ª Tupleã€‚è¿™æ¯” Flink çš„åºåˆ—åŒ–å™¨ï¼ˆæˆ–Kryoåºåˆ—åŒ–ï¼‰æ•ˆç‡ä½ã€‚å¦ä¸€æ–¹é¢ï¼Œä¸ååºåˆ—åŒ–ç›¸æ¯”ï¼Œä»å †ä¸­è¯»å–å¯¹è±¡æ˜¯æ— æ€§èƒ½æ¶ˆè€—çš„ã€‚åœ¨æˆ‘ä»¬çš„åŸºå‡†æµ‹è¯•ä¸­ï¼Œå¯¹è±¡å…‹éš†æ¯”åºåˆ—åŒ–å’Œååºåˆ—åŒ–ç»„åˆæ›´è€—æ€§èƒ½ã€‚æŸ¥çœ‹æ’åºæ—¶é—´ï¼Œæˆ‘ä»¬çœ‹åˆ°å¯¹äºŒè¿›åˆ¶æ•°æ®çš„æ’åºä¹Ÿæ¯” Java çš„é›†åˆæ’åºæ›´å¿«ã€‚ä½¿ç”¨æ²¡æœ‰äºŒè¿›åˆ¶æ’åº key çš„ Kryo åºåˆ—åŒ–çš„æ•°æ®æ’åºæ¯”å…¶ä»–æ–¹æ³•æ…¢å¾—å¤šã€‚è¿™æ˜¯å› ä¸ºååºåˆ—åŒ–å¸¦æ¥å¾ˆå¤§çš„å¼€é”€ã€‚åœ¨String å­—æ®µä¸Šå¯¹ Tuple è¿›è¡Œæ’åºæ¯”åœ¨ Integer å­—æ®µä¸Šæ’åºæ›´å¿«ï¼Œå› ä¸ºé•¿å°¾å€¼åˆ†å¸ƒæ˜¾ç€å‡å°‘äº†æˆå¯¹æ¯”è¾ƒçš„æ•°é‡ã€‚ä¸ºäº†æ›´å¥½åœ°äº†è§£æ’åºè¿‡ç¨‹ä¸­å‘ç”Ÿçš„çŠ¶å†µï¼Œæˆ‘ä»¬ä½¿ç”¨ VisualVM ç›‘æ§æ‰§è¡Œçš„ JVMã€‚ä»¥ä¸‹æˆªå›¾æ˜¾ç¤ºäº†æ‰§è¡Œ 10æ¬¡ è¿è¡Œæ—¶çš„å †å†…å­˜ä½¿ç”¨æƒ…å†µã€åƒåœ¾æ”¶é›†æƒ…å†µå’Œ CPU ä½¿ç”¨æƒ…å†µã€‚ æµ‹è¯•æ˜¯åœ¨ 8 æ ¸æœºå™¨ä¸Šè¿è¡Œå•çº¿ç¨‹ï¼Œå› æ­¤ä¸€ä¸ªæ ¸å¿ƒçš„å®Œå…¨åˆ©ç”¨ä»…å¯¹åº” 12.5ï¼… çš„æ€»ä½“åˆ©ç”¨ç‡ã€‚æˆªå›¾æ˜¾ç¤ºï¼Œå¯¹äºŒè¿›åˆ¶æ•°æ®è¿›è¡Œæ“ä½œå¯æ˜¾è‘—å‡å°‘åƒåœ¾å›æ”¶æ´»åŠ¨ã€‚å¯¹äºå¯¹è±¡å­˜åœ¨å †ä¸­ï¼Œåƒåœ¾æ”¶é›†å™¨åœ¨æ’åºç¼“å†²åŒºè¢«å¡«æ»¡æ—¶ä»¥éå¸¸çŸ­çš„æ—¶é—´é—´éš”è¿è¡Œï¼Œå¹¶ä¸”å³ä½¿å¯¹äºå•ä¸ªå¤„ç†çº¿ç¨‹ä¹Ÿä¼šå¯¼è‡´å¤§é‡ CPU ä½¿ç”¨ï¼ˆæ’åºæœ¬èº«ä¸ä¼šè§¦å‘åƒåœ¾æ”¶é›†å™¨ï¼‰ã€‚JVM åƒåœ¾æ”¶é›†å¤šä¸ªå¹¶è¡Œçº¿ç¨‹ï¼Œè§£é‡Šäº†é«˜CPU æ€»ä½“åˆ©ç”¨ç‡ã€‚å¦ä¸€æ–¹é¢ï¼Œå¯¹åºåˆ—åŒ–æ•°æ®è¿›è¡Œæ“ä½œçš„æ–¹æ³•å¾ˆå°‘è§¦å‘åƒåœ¾æ”¶é›†å™¨å¹¶ä¸” CPU åˆ©ç”¨ç‡ä½å¾—å¤šã€‚å®é™…ä¸Šï¼Œå¦‚æœä½¿ç”¨ Flink åºåˆ—åŒ–çš„æ–¹å¼åœ¨ Integer å­—æ®µä¸Šå¯¹ Tuple è¿›è¡Œæ’åºï¼Œåˆ™åƒåœ¾æ”¶é›†å™¨æ ¹æœ¬ä¸è¿è¡Œï¼Œå› ä¸ºå¯¹äºæˆå¯¹æ¯”è¾ƒï¼Œä¸éœ€è¦ååºåˆ—åŒ–ä»»ä½•å¯¹è±¡ã€‚Kryo åºåˆ—åŒ–éœ€è¦æ¯”è¾ƒå¤šçš„åƒåœ¾æ”¶é›†ï¼Œå› ä¸ºå®ƒä¸ä½¿ç”¨äºŒè¿›åˆ¶æ’åº key å¹¶ä¸”æ¯æ¬¡æ’åºéƒ½è¦ååºåˆ—åŒ–ä¸¤ä¸ªå¯¹è±¡ã€‚ å†…å­˜ä½¿ç”¨æƒ…å†µä¸Šå›¾æ˜¾ç¤º Flink åºåˆ—åŒ–å’Œ Kryo åºåˆ—åŒ–ä¸æ–­çš„å ç”¨å¤§é‡å†…å­˜ å­˜ä½¿ç”¨æƒ…å†µå›¾è¡¨æ˜¾ç¤ºflink-serializedå’Œkryo-serializedä¸æ–­å ç”¨å¤§é‡å†…å­˜ã€‚è¿™æ˜¯ç”±äº MemorySegments çš„é¢„åˆ†é…ã€‚å®é™…å†…å­˜ä½¿ç”¨ç‡è¦ä½å¾—å¤šï¼Œå› ä¸ºæ’åºç¼“å†²åŒºå¹¶æœªå®Œå…¨å¡«å……ã€‚ä¸‹è¡¨æ˜¾ç¤ºäº†æ¯ç§æ–¹æ³•çš„å†…å­˜æ¶ˆè€—ã€‚1000 ä¸‡æ¡æ•°æ®äº§ç”Ÿå¤§çº¦ 280 MB çš„äºŒè¿›åˆ¶æ•°æ®ï¼ˆå¯¹è±¡æ•°æ®ã€æŒ‡é’ˆå’Œæ’åº keyï¼‰ï¼Œå…·ä½“å–å†³äºä½¿ç”¨çš„åºåˆ—åŒ–ç¨‹åºä»¥åŠäºŒè¿›åˆ¶æ’åº key çš„å­˜åœ¨å’Œå¤§å°ã€‚å°†å…¶ä¸æ•°æ®å­˜å‚¨åœ¨å †ä¸Šçš„æ–¹æ³•è¿›è¡Œæ¯”è¾ƒï¼Œæˆ‘ä»¬å‘ç°å¯¹äºŒè¿›åˆ¶æ•°æ®è¿›è¡Œæ“ä½œå¯ä»¥æ˜¾è‘—æé«˜å†…å­˜æ•ˆç‡ã€‚åœ¨æˆ‘ä»¬çš„åŸºå‡†æµ‹è¯•ä¸­ï¼Œå¦‚æœåºåˆ—åŒ–ä¸ºæ’åºç¼“å†²åŒºè€Œä¸æ˜¯å°†å…¶ä½œä¸ºå †ä¸Šçš„å¯¹è±¡ä¿å­˜ï¼Œåˆ™å¯ä»¥åœ¨å†…å­˜ä¸­å¯¹ä¸¤å€ä»¥ä¸Šçš„æ•°æ®è¿›è¡Œæ’åºã€‚ å ç”¨å†…å­˜ å¯¹è±¡å­˜åœ¨å †ä¸­ Flink åºåˆ—åŒ– Kryo åºåˆ—åŒ– å¯¹ Integer æ’åº çº¦ 700 MBï¼ˆå †å†…å­˜ï¼‰ 277 MBï¼ˆæ’åºç¼“å†²åŒºï¼‰ 266 MBï¼ˆæ’åºç¼“å†²åŒºï¼‰ å¯¹ String æ’åº çº¦ 700 MBï¼ˆå †å†…å­˜ï¼‰ 315 MBï¼ˆæ’åºç¼“å†²åŒºï¼‰ 266 MBï¼ˆæ’åºç¼“å†²åŒºï¼‰ æ€»è€Œè¨€ä¹‹ï¼Œæµ‹è¯•éªŒè¯äº†æ–‡ç« å‰é¢è¯´çš„å¯¹äºŒè¿›åˆ¶æ•°æ®è¿›è¡Œæ“ä½œçš„å¥½å¤„ã€‚ å±•æœ›æœªæ¥Apache Flink å…·æœ‰ç›¸å½“å¤šçš„é«˜çº§æŠ€æœ¯ï¼Œå¯ä»¥é€šè¿‡æœ‰é™çš„å†…å­˜èµ„æºå®‰å…¨æœ‰æ•ˆåœ°å¤„ç†å¤§é‡æ•°æ®ã€‚ä½†æ˜¯æœ‰å‡ ç‚¹å¯ä»¥ä½¿ Flink æ›´æœ‰æ•ˆç‡ã€‚Flink ç¤¾åŒºæ­£åœ¨åŠªåŠ›å°†ç®¡ç†å†…å­˜ç§»åŠ¨åˆ°å †å¤–å†…å­˜ã€‚è¿™å°†å…è®¸æ›´å°çš„ JVMï¼Œæ›´ä½çš„åƒåœ¾æ”¶é›†å¼€é”€ï¼Œä»¥åŠæ›´å®¹æ˜“çš„ç³»ç»Ÿé…ç½®ã€‚ä½¿ç”¨ Flink çš„ Table APIï¼Œæ‰€æœ‰æ“ä½œï¼ˆå¦‚ aggregation å’Œ projectionï¼‰çš„è¯­ä¹‰éƒ½æ˜¯å·²çŸ¥çš„ï¼ˆä¸é»‘ç›’ç”¨æˆ·å®šä¹‰çš„å‡½æ•°ç›¸åï¼‰ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºç›´æ¥å¯¹äºŒè¿›åˆ¶æ•°æ®è¿›è¡Œæ“ä½œçš„ Table API æ“ä½œç”Ÿæˆä»£ç ã€‚è¿›ä¸€æ­¥çš„æ”¹è¿›åŒ…æ‹¬åºåˆ—åŒ–è®¾è®¡ï¼Œè¿™äº›è®¾è®¡é’ˆå¯¹åº”ç”¨äºäºŒè¿›åˆ¶æ•°æ®çš„æ“ä½œå’Œé’ˆå¯¹åºåˆ—åŒ–å™¨å’Œæ¯”è¾ƒå™¨çš„ä»£ç ç”Ÿæˆè€Œå®šåˆ¶ã€‚ æ€»ç»“ Flink çš„ä¸»åŠ¨å†…å­˜ç®¡ç†å‡å°‘äº†å› è§¦å‘ OutOfMemoryErrors è€Œæ€æ­» JVM è¿›ç¨‹å’Œåƒåœ¾æ”¶é›†å¼€é”€çš„é—®é¢˜ã€‚ Flink å…·æœ‰é«˜æ•ˆçš„æ•°æ®åºåˆ—åŒ–å’Œååºåˆ—åŒ–æœºåˆ¶ï¼Œæœ‰åŠ©äºå¯¹äºŒè¿›åˆ¶æ•°æ®è¿›è¡Œæ“ä½œï¼Œå¹¶ä½¿æ›´å¤šæ•°æ®é€‚åˆå†…å­˜ã€‚ Flink çš„ DBMS é£æ ¼çš„è¿ç®—ç¬¦æœ¬èº«åœ¨äºŒè¿›åˆ¶æ•°æ®ä¸Šè¿è¡Œï¼Œåœ¨å¿…è¦æ—¶å¯ä»¥åœ¨å†…å­˜ä¸­é«˜æ€§èƒ½åœ°ä¼ è¾“åˆ°ç£ç›˜ã€‚ æœ¬æ–‡åœ°å€: http://www.54tianzhisheng.cn/2019/03/24/Flink-code-memory-management/ æœ¬æ–‡ç¿»è¯‘è‡ªï¼šhttps://flink.apache.org/news/2015/05/11/Juggling-with-Bits-and-Bytes.htmlç¿»è¯‘ï¼šzhishengï¼ŒäºŒæ¬¡è½¬è½½è¯·æ³¨æ˜åœ°å€ï¼Œå¦åˆ™ä¿ç•™è¿½ç©¶æ³•å¾‹è´£ä»»ã€‚ å…³æ³¨æˆ‘å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·äº†ã€‚ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šzhisheng_tianï¼Œç„¶åå›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ Github ä»£ç ä»“åº“https://github.com/zhisheng17/flink-learning/ ä»¥åè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç éƒ½å°†æ”¾åœ¨è¿™ä¸ªä»“åº“é‡Œï¼ŒåŒ…å«äº†è‡ªå·±å­¦ä¹  flink çš„ä¸€äº› demo å’Œåšå®¢ã€‚ åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€åŸç†ã€å®æˆ˜ã€æ€§èƒ½è°ƒä¼˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ ä¸“æ ä»‹ç»é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶","date":"2019-03-22T16:00:00.000Z","path":"2019/03/23/Flink-code-checkpoint/","text":"Flink Checkpoint æœºåˆ¶ https://t.zsxq.com/ynQNbeM åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€å®æˆ˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶","date":"2019-03-21T16:00:00.000Z","path":"2019/03/22/Flink-code-serialize/","text":"Flink åºåˆ—åŒ–æœºåˆ¶ https://t.zsxq.com/JaQfeMf åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€å®æˆ˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ","date":"2019-03-20T16:00:00.000Z","path":"2019/03/21/Flink-code-JobGraph/","text":"JobGraph https://t.zsxq.com/naaMf6y åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€åŸç†ã€å®æˆ˜ã€æ€§èƒ½è°ƒä¼˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ","date":"2019-03-19T16:00:00.000Z","path":"2019/03/20/Flink-code-StreamGraph/","text":"StreamGraph https://t.zsxq.com/qRFIm6I åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€å®æˆ˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ ä¸“æ ä»‹ç»é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹","date":"2019-03-18T16:00:00.000Z","path":"2019/03/19/Flink-code-streaming-wordcount-start/","text":"æµå¤„ç† WordCount ç¨‹åº https://t.zsxq.com/qnMFEUJ åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€åŸç†ã€å®æˆ˜ã€æ€§èƒ½è°ƒä¼˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹","date":"2019-03-17T16:00:00.000Z","path":"2019/03/18/Flink-code-batch-wordcount-start/","text":"æ‰¹å¤„ç†çš„ WordCount ç¨‹åºåˆ†æï¼š https://t.zsxq.com/YJ2Zrfi åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€å®æˆ˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨","date":"2019-03-16T16:00:00.000Z","path":"2019/03/17/Flink-code-Standalone-TaskManager-start/","text":"Task Manager å¯åŠ¨ https://t.zsxq.com/qjEUFau åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€å®æˆ˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨","date":"2019-03-15T16:00:00.000Z","path":"2019/03/16/Flink-code-Standalone-JobManager-start/","text":"Job Manager å¯åŠ¨ https://t.zsxq.com/AurR3rN åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€å®æˆ˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"Flink æºç è§£æ â€”â€” Standalone session æ¨¡å¼å¯åŠ¨æµç¨‹","date":"2019-03-14T16:00:00.000Z","path":"2019/03/15/Flink-code-Standalone-start/","text":"Standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ https://t.zsxq.com/EemAEIi åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€å®æˆ˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ","date":"2019-03-13T16:00:00.000Z","path":"2019/03/14/Flink-code-structure/","text":"Flink æºç é¡¹ç›®ç»“æ„ä¸€è§ˆ https://t.zsxq.com/MNfAYne åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€åŸç†ã€å®æˆ˜ã€æ€§èƒ½è°ƒä¼˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ ä¸“æ ä»‹ç»é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº†?","date":"2019-03-12T16:00:00.000Z","path":"2019/03/13/flink-job-jars/","text":"å‰è¨€å†™è¿™ç¯‡æ–‡ç« å…¶å®ä¹Ÿæ˜¯çŸ¥è¯†æ˜Ÿçƒé‡Œé¢çš„ä¸€ä¸ªå°ä¼™ä¼´é—®äº†è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼š é€šè¿‡ flink UI ä»ªè¡¨ç›˜æäº¤çš„ jar æ˜¯å­˜å‚¨åœ¨å“ªä¸ªç›®å½•ä¸‹ï¼Ÿ è¿™ä¸ªé—®é¢˜å…¶å®æˆ‘è‡ªå·±ä¹Ÿæœ‰é—®è¿‡ï¼Œä½†æ˜¯è‡ªå·±å› ä¸ºè‡ªå·±çš„é—®é¢˜æ²¡æœ‰å•¥å‹åŠ›ä¹Ÿå°±æ²¡æ·±å…¥å»æ€è€ƒï¼Œç°åœ¨å¯æ˜¯çŸ¥è¯†æ˜Ÿçƒçš„ä»˜è´¹å°ä¼™ä¼´é—®çš„ï¼Œæ‰€ä»¥è‡ªç„¶è¦é€¼ç€è‡ªå·±å»æ·±å…¥ç„¶åæ‰èƒ½ç»™å‡ºæ­£ç¡®çš„ç­”æ¡ˆã€‚ è·Ÿç€æˆ‘ä¸€èµ·æ¥çœ‹çœ‹æˆ‘çš„æ¢å¯»æ­¥éª¤å§ï¼å°å°çš„ jar ç«Ÿç„¶è¿˜æ•¢å’Œæˆ‘æ‰è¿·è—ï¼Ÿ æŸ¥çœ‹é…ç½®æ–‡ä»¶é¦–å…ˆæƒ³åˆ°çš„æ˜¯è¿™ä¸ªè‚¯å®šå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­æœ‰è®¾ç½®çš„åœ°æ–¹çš„ï¼š è°·æ­Œå¤§æ³•å¥½è™½ç„¶æœ‰ä¸ªæ˜¯ upload çš„ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç›®å½•ï¼äºæ˜¯ï¼Œåªå¥½åŠ¨ç”¨æˆ‘çš„â€œè°·æ­Œå¤§æ³•å¥½â€ã€‚ æ‰¾åˆ°äº†ä¸€æ¡ï¼Œç‚¹è¿›å»çœ‹ Issue å¦‚ä¸‹ï¼š å‘ç°è¿™ tm ä¸å°±æ˜¯æƒ³è¦çš„å—ï¼Ÿéƒ½æ”¯æŒé…ç½®æ–‡ä»¶æ¥å¡«å†™ä¸Šä¼ çš„ jar åå­˜å‚¨çš„ç›®å½•äº†ï¼èµ¶ç´§ç‚¹è¿›å»çœ‹ä¸€æ³¢æºç ï¼š æºç ç¡®è®¤è¿™ä¸ª jobmanager.web.upload.dir æ˜¯ä¸æ˜¯ï¼Ÿæˆ‘å»çœ‹ä¸‹ 1.8 çš„æºç ç¡®è®¤ä¸€ä¸‹ï¼š å‘ç°è¿™ä¸ª jobmanager.web.upload.dir è¿˜è¿‡æœŸäº†ï¼Œç”¨ WebOptions ç±»ä¸­çš„ UPLOAD_DIR æ›¿ä»£äº†ï¼ ç»§ç»­è·Ÿè¿›å»çœ‹çœ‹è¿™ä¸ª UPLOAD_DIR æ˜¯å•¥ç©æ„ï¼Ÿ çœ‹è¿™æ³¨é‡Šçš„æ„æ€æ˜¯è¯´ï¼Œå¦‚æœè¿™ä¸ªé…ç½® web.upload.dir æ²¡æœ‰é…ç½®å…·ä½“çš„è·¯å¾„çš„è¯å°±ä¼šä½¿ç”¨ JOB_MANAGER_WEB_TMPDIR_KEY ç›®å½•ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹çœ‹æ˜¯å¦é…ç½®äº†è¿™ä¸ªç›®å½•å‘¢ï¼Ÿ ç¡®å®æ²¡æœ‰é…ç½®è¿™ä¸ª jar æ–‡ä»¶ä¸Šä¼ çš„ç›®å½•ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªä¸´æ—¶ç›®å½• JOB_MANAGER_WEB_TMPDIR_KEY æ˜¯åœ¨å“ªé‡Œçš„ï¼Ÿ åˆæ˜¯ä¸€ä¸ªè¿‡æœŸçš„ç›®å½•ï¼Œmmpï¼Œç»§ç»­è·Ÿä¸‹å»çœ‹ä¸‹è¿™ä¸ªç›®å½• TMP_DIRã€‚ æˆ‘ä»¬æŸ¥çœ‹ä¸‹é…ç½®æ–‡ä»¶æ˜¯å¦æœ‰é…ç½®è¿™ä¸ª web.tmpdir çš„å€¼ï¼Œåˆæ˜¯æ²¡æœ‰ï¼š soï¼Œå®ƒè‚¯å®šä½¿ç”¨çš„æ˜¯ System.getProperty(&quot;java.io.tmpdir&quot;) è¿™ä¸ªç›®å½•äº†ï¼Œ æˆ‘æŸ¥çœ‹äº†ä¸‹æˆ‘æœ¬åœ°ç”µè„‘èµ·çš„ job å®ƒçš„é…ç½®ä¸­æœ‰è¿™ä¸ªé…ç½®å¦‚ä¸‹ï¼š 1java.io.tmpdir /var/folders/mb/3vpbvkkx13l2jmpt2kmmt0fr0000gn/T/ å†è§‚å¯Ÿäº†ä¸‹ jobï¼Œå‘ç° jobManager è¿™é‡Œæœ‰ä¸ª web.tmpdir çš„é…ç½®ï¼š 1web.tmpdir /var/folders/mb/3vpbvkkx13l2jmpt2kmmt0fr0000gn/T/flink-web-ea909e9e-4bac-452d-8450-b4ff082298c7 å‘ç°è¿™ä¸ª web.tmpdir çš„å°±æ˜¯ç”± java.io.tmpdir + â€œflink-web-â€ + UUID ç»„æˆçš„ï¼ æ°´è½çŸ³å‡ºè¿›å…¥è¿™ä¸ªç›®å½•å‘ç°æˆ‘ä»¬ä¸Šä¼ çš„ jar ç»ˆäºè¢«æ‰¾åˆ°äº†ï¼š é…ç½®ä¸Šä¼  jar ç›®å½•ç¡®è®¤ä¸Šé¢æˆ‘ä»¬è™½ç„¶å·²ç»çŸ¥é“æˆ‘ä»¬ä¸Šä¼ çš„ jar æ˜¯å­˜å‚¨åœ¨è¿™ä¸ªä¸´æ—¶ç›®å½•é‡Œï¼Œé‚£ä¹ˆæˆ‘ä»¬ç°åœ¨è¦éªŒè¯ä¸€ä¸‹ï¼Œæˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®ä¸€ä¸‹ä¸Šä¼  jar çš„å›ºå®šä½ç½®ï¼Œæˆ‘ä»¬å…ˆåœ¨ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª jars ç›®å½•ï¼Œç„¶ååœ¨é…ç½®æ–‡ä»¶ä¸­åŠ å…¥è¿™ä¸ªé…ç½®ï¼š 1web.tmpdir: /usr/local/blink-1.5.1/jars æ›´æ”¹ä¹‹åå†çœ‹ web.tmpdir æ˜¯è¿™æ ·çš„: ä» Flink UI ä¸Šä¸Šä¼ äº†ä¸‰ä¸ª jarï¼ŒæŸ¥çœ‹ /usr/local/blink-1.5.1/jars/flink-web-7a98165b-1d56-44be-be8c-d0cd9166b179 ç›®å½•ä¸‹å°±å‡ºç°äº†æˆ‘ä»¬çš„ jar äº†ã€‚ æˆ‘ä»¬é‡å¯ Flinkï¼Œå‘ç°è¿™ä¸‰ä¸ª jar åˆæ²¡æœ‰äº†ï¼Œè¿™ä¹Ÿèƒ½è§£é‡Šä¹‹å‰æˆ‘è‡ªå·±ä¹Ÿé‡åˆ°è¿‡çš„é—®é¢˜äº†ï¼ŒFlink é‡å¯åä¹‹å‰æ‰€æœ‰ä¸Šä¼ çš„ jar éƒ½è¢«åˆ é™¤äº†ï¼ä½œä¸ºç”Ÿäº§ç¯å¢ƒï¼Œè¿™æ ·ç©ï¼Œè‚¯å®šä¸è¡Œçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜æ˜¯å¾—å›ºå®šä¸€ä¸ªç›®å½•æ¥å­˜å‚¨æ‰€æœ‰çš„ä¸Šä¼  jar åŒ…ï¼Œå¹¶ä¸”ä¸èƒ½å¤Ÿè¢«åˆ é™¤ï¼Œè¦é…ç½®å›ºå®šçš„ç›®å½•ï¼ˆFlink é‡å¯ä¹Ÿä¸åˆ é™¤çš„è¯ï¼‰éœ€è¦é…ç½®å¦‚ä¸‹ï¼š 1web.upload.dir: /usr/local/blink-1.5.1/jars è¿™æ ·çš„è¯ï¼Œå°±å¯ä»¥ä¿è¯ä½ çš„ jar ä¸å†ä¼šè¢«åˆ é™¤äº†ï¼ å†æ¥çœ‹çœ‹æºç æ˜¯å’‹å†™çš„å“ˆï¼š 12345678//ä»é…ç½®æ–‡ä»¶ä¸­æ‰¾ UPLOAD_DIRfinal Path uploadDir = Paths.get( config.getString(WebOptions.UPLOAD_DIR, config.getString(WebOptions.TMP_DIR)), \"flink-web-upload\");return new RestServerEndpointConfiguration( restAddress,restBindAddress,port,sslEngineFactory, uploadDir,maxContentLength,responseHeaders); ä»–å°±æ˜¯ä»é…ç½®æ–‡ä»¶ä¸­æ‰¾ UPLOAD_DIRï¼Œå¦‚æœä¸º null å°±æ‰¾ TMP_DIR ç›®å½•æ¥å½“ä½œ jar ä¸Šä¼ çš„è·¯å¾„ï¼ æ€»ç»“æœ¬æ–‡ä»çŸ¥è¯†æ˜Ÿçƒä¸€ä¸ªæœ‹å‹çš„é—®é¢˜ï¼Œä»ç°è±¡åˆ°æœ¬è´¨å†åˆ°è§£å†³æ–¹æ¡ˆçš„è®²è§£äº†ä¸‹å¦‚ä½•æ‰¾åˆ° Flink UI ä¸Šä¸Šä¼ çš„ jar åŒ…è—èº«ä¹‹å¤„ï¼Œå¹¶æå‡ºäº†å¦‚ä½•è§£å†³ Flink ä¸Šä¼ çš„ jar åŒ…è¢«åˆ é™¤çš„é—®é¢˜ã€‚ æœ¬ç¯‡æ–‡ç« è¿æ¥æ˜¯ï¼šhttp://www.54tianzhisheng.cn/2019/03/13/flink-job-jars/ å…³æ³¨æˆ‘å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ ä¸“æ ä»‹ç»é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f Github ä»£ç ä»“åº“https://github.com/zhisheng17/flink-learning/ ä»¥åè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç éƒ½å°†æ”¾åœ¨è¿™ä¸ªä»“åº“é‡Œï¼ŒåŒ…å«äº†è‡ªå·±å­¦ä¹  flink çš„ä¸€äº› demo å’Œåšå®¢ã€‚ åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€åŸç†ã€å®æˆ˜ã€æ€§èƒ½è°ƒä¼˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™","date":"2019-02-27T16:00:00.000Z","path":"2019/02/28/blink/","text":"Blink å¼€æºäº†æœ‰ä¸€æ®µæ—¶é—´äº†ï¼Œç«Ÿç„¶æ²¡å‘ç°æœ‰äººå†™ç›¸å…³çš„åšå®¢ï¼Œå…¶å®æˆ‘å·²ç»åœ¨æˆ‘çš„çŸ¥è¯†æ˜Ÿçƒé‡Œå¼€å§‹å†™äº†ï¼Œä»Šå¤©æ¥çœ‹çœ‹ Blink ä¸ºä»€ä¹ˆé¦™ï¼Ÿ æˆ‘ä»¬å…ˆçœ‹çœ‹ Blink é»‘è‰²ç‰ˆæœ¬ï¼š å¯¹æ¯”ä¸‹ Flink ç‰ˆæœ¬ä½ å°±çŸ¥é“é»‘è‰²ç‰ˆæœ¬å¤šå¥½çœ‹äº†ã€‚ ä½ ä¸Šä¼  jar åŒ…çš„æ—¶å€™æ˜¯è¿™æ ·çš„ï¼š æˆ‘ä»¬æ¥çœ‹çœ‹ Blink è¿è¡Œçš„ job é•¿å•¥æ ·ï¼Ÿ å†æ¥å¯¹æ¯”ä¸€ä¸‹ Flink çš„æ ·å­ï¼š æŸ¥çœ‹ Job Task çš„è¯¦æƒ…ï¼Œå¯ä»¥çœ‹åˆ°å¼€å§‹æ—¶é—´ã€æ¥æ”¶è®°å½•ã€å¹¶è¡Œåº¦ã€durationã€Queue in/outã€TPS æŸ¥çœ‹ subTaskï¼Œè¿™é‡Œå¯ä»¥ç›´æ¥ç‚¹å‡»è¿™ä¸ªæ—¥å¿—å°±å¯ä»¥æŸ¥çœ‹ task æ—¥å¿—ï¼š æŸ¥çœ‹èƒŒå‹ï¼š æŸ¥çœ‹ task metricï¼Œå¯ä»¥æ‰‹åŠ¨æ·»åŠ ï¼Œæ”¯æŒçš„æœ‰å¾ˆå¤šï¼Œè¿™ç‚¹å¾ˆé‡è¦ï¼Œå¯ä»¥æ ¹æ®æ¯ä¸ªç®—å­çš„ç›‘æ§ä»¥åŠæ—¶å¯¹æ¯ä¸ªç®—å­è¿›è¡Œè°ƒä¼˜ï¼š æŸ¥çœ‹ job è¿è¡Œæ—¶é—´æ®µçš„æƒ…å†µï¼š æŸ¥çœ‹ running çš„ jobï¼š æŸ¥çœ‹å·²ç»å®Œæˆçš„ jobï¼š æŸ¥çœ‹ Task Managerï¼š Task Manager åˆ†é…çš„èµ„æºè¯¦æƒ…ï¼š Task Manager metric ç›‘æ§ä¿¡æ¯è¯¦æƒ…ï¼š Task Manager log æ–‡ä»¶è¯¦æƒ…ï¼ŒåŒ…å«è¿è¡Œäº§ç”Ÿçš„æ—¥å¿—å’Œ GC æ—¥å¿—ï¼š Task Manager æ—¥å¿—è¯¦æƒ…ï¼Œæ”¯æŒé«˜äº®å’Œåˆ†é¡µï¼Œç‰¹åˆ«å‹å¥½ï¼Œå¦ˆå¦ˆå†ä¹Ÿä¸æ‹…å¿ƒæˆ‘çœ‹ä¸è§ â€œåˆ·åˆ·åˆ·â€ çš„æ—¥å¿—äº†ã€‚ æ€»ç»“ä»‹ç»äº† Flink çš„ Blink åˆ†æ”¯ç¼–è¯‘åè¿è¡Œçš„ç•Œé¢æƒ…å†µï¼Œæ€»ä½“æ¥è¯´å¾ˆæ£’ï¼ŒæœŸå¾…åé¢ Blink åˆå¹¶åˆ° Flinkï¼ æœ¬æ–‡åŸåˆ›åœ°å€æ˜¯: http://www.54tianzhisheng.cn/2019/02/28/blink/ , æœªç»å…è®¸ç¦æ­¢è½¬è½½ã€‚ å…³æ³¨æˆ‘å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·äº†ã€‚ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šzhisheng_tianï¼Œç„¶åå›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ Github ä»£ç ä»“åº“https://github.com/zhisheng17/flink-learning/ ä»¥åè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç éƒ½å°†æ”¾åœ¨è¿™ä¸ªä»“åº“é‡Œï¼ŒåŒ…å«äº†è‡ªå·±å­¦ä¹  flink çš„ä¸€äº› demo å’Œåšå®¢ã€‚ ç›¸å…³æ–‡ç« 1ã€ã€Šä»0åˆ°1å­¦ä¹ Flinkã€‹â€”â€” Apache Flink ä»‹ç» 2ã€ã€Šä»0åˆ°1å­¦ä¹ Flinkã€‹â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€ã€Šä»0åˆ°1å­¦ä¹ Flinkã€‹â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€ã€Šä»0åˆ°1å­¦ä¹ Flinkã€‹â€”â€” Data Source ä»‹ç» 5ã€ã€Šä»0åˆ°1å­¦ä¹ Flinkã€‹â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€ã€Šä»0åˆ°1å­¦ä¹ Flinkã€‹â€”â€” Data Sink ä»‹ç» 7ã€ã€Šä»0åˆ°1å­¦ä¹ Flinkã€‹â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€ã€Šä»0åˆ°1å­¦ä¹ Flinkã€‹â€”â€” Flink Data transformation(è½¬æ¢) 9ã€ã€Šä»0åˆ°1å­¦ä¹ Flinkã€‹â€”â€” ä»‹ç»Flinkä¸­çš„Stream Windows 10ã€ã€Šä»0åˆ°1å­¦ä¹ Flinkã€‹â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€ã€Šä»0åˆ°1å­¦ä¹ Flinkã€‹â€”â€” Flink å†™å…¥æ•°æ®åˆ° ElasticSearch 12ã€ã€Šä»0åˆ°1å­¦ä¹ Flinkã€‹â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€ã€Šä»0åˆ°1å­¦ä¹ Flinkã€‹â€”â€” Flink å†™å…¥æ•°æ®åˆ° Kafka 14ã€ã€Šä»0åˆ°1å­¦ä¹ Flinkã€‹â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€ã€Šä»0åˆ°1å­¦ä¹ Flinkã€‹â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€ã€Šä»0åˆ°1å­¦ä¹ Flinkã€‹â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"},{"name":"Blink","slug":"Blink","permalink":"http://www.54tianzhisheng.cn/tags/Blink/"}]},{"title":"Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ","date":"2019-01-29T16:00:00.000Z","path":"2019/01/30/Flink-code-compile/","text":"æ›´æ–°ä¸€ç¯‡çŸ¥è¯†æ˜Ÿçƒé‡Œé¢çš„æºç åˆ†ææ–‡ç« ï¼Œå»å¹´å†™çš„ï¼Œå‘¨æœ«è‡ªå·±å½•äº†ä¸ªè§†é¢‘ï¼Œå¤§å®¶çœ‹ä¸‹æ•ˆæœå¥½å—ï¼Ÿå¦‚æœå¥½çš„è¯ï¼Œåé¢è¡¥å½•å‘åœ¨çŸ¥è¯†æ˜Ÿçƒé‡Œé¢çš„å…¶ä»–æºç è§£ææ–‡ç« ã€‚ å‰è¨€ä¹‹å‰è‡ªå·±æœ¬åœ° clone äº† Flink çš„æºç ï¼Œç¼–è¯‘è¿‡ï¼Œç„¶å share åˆ°äº† GitHub ä¸Šå»äº†ï¼Œè‡ªå·±ä¹Ÿå†™äº†ä¸€äº›æºç çš„ä¸­æ–‡æ³¨é‡Šï¼Œå¹¶ä¸” push åˆ°äº† GitHub ä¸Šå»äº†ã€‚è¿™å‡ å¤©é˜¿é‡Œå¼€æºäº†å®£ä¼ å·²ä¹…çš„ Blinkï¼Œç»“æœæˆ‘é‚£ä¸ªåˆ†æ”¯ä¸èƒ½å¤Ÿç»§ç»­ pull ä¸‹æ–°çš„ä»£ç ï¼Œå†åŠ ä¸Šè‡ªå·±å¯¹ Flink ç ”ç©¶äº†ä¹Ÿæœ‰ç‚¹æ—¶é—´äº†ï¼Œæ‰€ä»¥æ‰“ç®—å°†è¿™ä¸¤ä¸ªä¸œè¥¿å¯¹æ¯”ç€æ¥çœ‹ï¼Œè¿™æ ·å¯èƒ½ä¼šå­¦åˆ°ä¸å°‘æ›´å¤šä¸œè¥¿ï¼Œå› ä¸º Blink æ˜¯å¦å¤–ä¸€ä¸ªåˆ†æ”¯ï¼Œæ‰€ä»¥è‡ªå·±å¹²è„†å†é‡æ–° fork äº†ä¸€ä»½ï¼Œæ‹‰åˆ°æœ¬åœ°æ¥çœ‹æºç ã€‚ forkæ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼š 1git clone git@github.com:apache/flink.git æ‹‰å–çš„æ—¶å€™æ‰¾ä¸ªç½‘ç»œå¥½ç‚¹çš„åœ°æ–¹ï¼Œè¿™æ ·é€Ÿåº¦å¯èƒ½ä¼šæ›´å¿«ç‚¹ã€‚ ç¼–è¯‘å› ä¸ºè‡ªå·±æƒ³çœ‹ä¸‹ Blink åˆ†æ”¯çš„ä»£ç ï¼Œæ‰€ä»¥éœ€è¦åˆ‡æ¢åˆ° blink åˆ†æ”¯æ¥ï¼Œ 1git checkout blink è¿™æ ·ä½ å°±åˆ°äº† blink åˆ†æ”¯äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°† blink æºç ç¼–è¯‘ä¸€ä¸‹ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š 1mvn clean install -Dmaven.test.skip=true -Dhadoop.version=2.7.6 -Dmaven.javadoc.skip=true -Dcheckstyle.skip=true maven ç¼–è¯‘çš„æ—¶å€™è·³è¿‡æµ‹è¯•ä»£ç ã€javadoc å’Œä»£ç é£æ ¼æ£€æŸ¥ï¼Œè¿™æ ·å¯ä»¥å‡å°‘ä¸å°‘æ—¶é—´ã€‚ æ³¨æ„ï¼šä½ çš„ maven çš„ settings.xml æ–‡ä»¶çš„ mirror æ·»åŠ ä¸‹é¢è¿™ä¸ªï¼š(è¿™æ ·ä¸‹è½½ä¾èµ–æ‰èƒ½é£èµ·æ¥) 12345678910111213&lt;mirror&gt; &lt;id&gt;nexus-aliyun&lt;/id&gt; &lt;mirrorOf&gt;*,!jeecg,!jeecg-snapshots,!mapr-releases&lt;/mirrorOf&gt; &lt;name&gt;Nexus aliyun&lt;/name&gt; &lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public&lt;/url&gt;&lt;/mirror&gt;&lt;mirror&gt; &lt;id&gt;mapr-public&lt;/id&gt; &lt;mirrorOf&gt;mapr-releases&lt;/mirrorOf&gt; &lt;name&gt;mapr-releases&lt;/name&gt; &lt;url&gt;https://maven.aliyun.com/repository/mapr-public&lt;/url&gt;&lt;/mirror&gt; æ‰§è¡Œå®Œè¿™ä¸ªå‘½ä»¤åï¼Œç„¶åå‘¢ï¼Œä½ å¯ä»¥æå‡ºæ‰‹æœºï¼Œæ‰“å¼€å¾®ä¿¡ï¼Œæœç´¢ä¸‹å¾®ä¿¡å·ï¼šzhisheng_tian , ç„¶åç‚¹å‡»ä¸€æ³¢æ·»åŠ å¥½å‹ï¼Œæ¬¢è¿æ¥æ¢è®¨æŠ€æœ¯ã€‚ ç­‰äº†ä¸€æ³¢æ—¶é—´ä¹‹åï¼Œä½ å¯èƒ½ä¼šé‡åˆ°è¿™ä¸ªé—®é¢˜(çœ‹åˆ°ä¸å°‘ç«¥é‹éƒ½é‡åˆ°è¿™ä¸ªé—®é¢˜ï¼Œä¹‹å‰ç¼–è¯‘ Flink çš„æ—¶å€™ä¹Ÿé‡åˆ°è¿‡)ï¼š 1[ERROR] Failed to execute goal on project flink-mapr-fs: Could not resolve dependencies for project com.alibaba.blink:flink-mapr-fs:jar:1.5.1: Failure to find com.mapr.hadoop:maprfs:jar:5.2.1-mapr in http://maven.aliyun.com/nexus/content/groups/public was cached in the local repository, resolution will not be reattempted until the update interval of nexus-aliyun has elapsed or updates are forced -&gt; [Help 1] å¦‚æœä½ è¯•äº†ä¸¤ééƒ½æ²¡ç¼–è¯‘é€šè¿‡ï¼Œé‚£ä¹ˆæˆ‘è¿™é‡Œå°±æ•™å¤§å®¶ä¸€ç§æ–¹æ³•ï¼ˆæ‰§è¡Œå®Œç¼–è¯‘å‘½ä»¤åå•¥ä¹Ÿæ²¡åŠ¨å°± OK çš„è¯·è·³è¿‡ï¼Œè°å«ä½ è¿æ°”è¿™ä¹ˆå¥½å‘¢ï¼‰ï¼š åœ¨ flink-filesystems ä¸­æŠŠ flink-mapr-fs module ç»™æ³¨é‡Šæ‰ã€‚ ä¸Šå›¾è¿™æ˜¯æˆ‘ç»™å¤§å®¶çš„å¿ å‘Šï¼Œç‰¹åˆ«ç®¡ç”¨ã€‚ å†æ¬¡æ‰§è¡Œå‘½ä»¤ç¼–è¯‘èµ·æ¥å°±æ²¡æœ‰é”™è¯¯äº†ï¼Œå¦‚æœä½ è¿˜æœ‰å…¶ä»–çš„é”™è¯¯ï¼Œæˆ‘çŒœä¼°è®¡è¿˜æ˜¯ç½‘ç»œçš„é—®é¢˜ï¼Œå¯¼è‡´ä¸€äº›å›½å¤–çš„ maven ä¾èµ–ä¸‹è½½ä¸ä¸‹æ¥æˆ–è€…ä¸å®Œæ•´ï¼Œå¯¼è‡´çš„é”™è¯¯ï¼Œæš´åŠ›çš„æ–¹æ³•å°±æ˜¯å’Œæˆ‘ä¸€æ ·ï¼ŒæŠŠè¿™äº›ä¸‹è½½ä¸ä¸‹æ¥çš„ä¾èµ– module æ³¨é‡Šæ‰ï¼Œæˆ–è€…ä½ å¯ä»¥åƒå·²ç»ç¼–è¯‘å¥½çš„ç«¥é‹è¦ä¸‹ maven çš„ .m2 æ–‡ä»¶é‡Œé¢å·²ç»ä¸‹è½½å¥½äº†çš„ä¾èµ–ï¼Œç„¶åå¤åˆ¶ç²˜è´´åˆ°ä½ çš„æœ¬åœ°è·¯å¾„å»ï¼Œæ³¨æ„è·¯å¾„åŒ…åä¸è¦å¼„é”™äº†ï¼Œè¿™æ ·ä¸€èˆ¬å¯ä»¥è§£å†³æ‰€æœ‰çš„é—®é¢˜äº†ï¼Œå¦‚æœè¿˜æœ‰é—®é¢˜ï¼Œæˆ‘ä¹Ÿæ— èƒ½ä¸ºåŠ›äº†ã€‚ ç¼–è¯‘æˆåŠŸå°±é•¿ä¸‹å›¾è¿™æ ·ï¼š è¿è¡Œç„¶åæˆ‘ä»¬çš„ç›®å½•æ˜¯é•¿è¿™æ ·çš„ï¼š æ ‡è®°çš„é‚£ä¸ªå°±æ˜¯æˆ‘ä»¬çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå°±è·Ÿæˆ‘ä»¬åœ¨ Flink å®˜ç½‘ä¸‹è½½çš„ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒè¿è¡Œèµ·æ¥çœ‹ä¸‹æ•ˆæœã€‚ æˆ‘æŠŠå®ƒç§»åˆ°äº† /usr/local/blink-1.5.1 ä¸‹äº†ï¼Œä¸ªäººä¹ æƒ¯ï¼Œå–œæ¬¢æŠŠä¸€äº›å®‰è£…çš„è½¯ä»¶å®‰è£…åœ¨ /usr/local/ ç›®å½•ä¸‹é¢ã€‚ ç›®å½•ç»“æ„å’Œæˆ‘ä»¥å‰çš„å®‰è£…ä»‹ç»æ–‡ç« ç±»ä¼¼ï¼Œå°±æ˜¯å¤šäº† batch_conf ç›®å½•ï¼Œå’Œ conf ç›®å½•æ˜¯ä¸€æ ·çš„ä¸œè¥¿ï¼Œä¸çŸ¥é“ä¸ºå•¥è¦å¼„ä¸¤ä¸ªé…ç½®æ–‡ä»¶ç›®å½•ï¼Œé—®è¿‡è´Ÿè´£çš„äººï¼Œæ²¡ç†æˆ‘ï¼Œå“ˆå“ˆå“ˆã€‚ é‚£ä¹ˆæˆ‘ä»¬æ¥ä¸‹æ¥å°±æ˜¯è¿è¡Œä¸‹ Blinkï¼Œè¿›å…¥åˆ° bin ç›®å½•ï¼Œæ‰§è¡Œå¯æ‰§è¡Œæ–‡ä»¶ï¼š 1./start-cluster.sh windows å¯ä»¥ç‚¹å‡» start-cluster.bat å¯åŠ¨ï¼Œè¿™ç‚¹å¯¹ windows ç”¨æˆ·æ¯”è¾ƒå‹å¥½ã€‚ æ‰§è¡Œå®Œåå‘½ä»¤åï¼Œåœ¨æµè§ˆå™¨é‡Œè®¿é—®åœ°å€ï¼Œ, å‡ºç°ä¸‹å›¾è¿™æ ·å°±ä»£è¡¨ Blink æˆåŠŸå¯åŠ¨äº†ï¼š123456789101112131415161718192021222324![](https://zhisheng-blog.oss-cn-hangzhou.aliyuncs.com/images/XQLzMv.jpg)ä¸Šå›¾æ˜¯å¼€æºç‰ˆæœ¬çš„ç™½è‰²ä¸»é¢˜ï¼Œéªšæ°”çš„é»‘è‰²ä¸»é¢˜é€šè¿‡åœ¨ Flink ç¾¤é‡Œå¾—çŸ¥å¦‚ä½•æ”¹ä¹‹åï¼Œç¼–è¯‘è¿è¡Œåçš„æ•ˆæœå¦‚ä¸‹ï¼š![](https://zhisheng-blog.oss-cn-hangzhou.aliyuncs.com/images/JfcR5E.jpg)ä¸€æ¬¡å¥½å¥‡çš„æ‰§è¡Œäº†å¤šæ¬¡ä¸Šé¢å¯åŠ¨å‘½ä»¤ï¼Œå‘ç°ä¹Ÿèƒ½å¤Ÿæ­£å¸¸çš„è¿è¡Œã€‚ç„¶åå¯åŠ¨çš„æ—¥å¿—æ˜¯è¿™æ ·çš„ï¼š![](https://zhisheng-blog.oss-cn-hangzhou.aliyuncs.com/images/fcAhYL.jpg)è¯´æ˜å·²ç»å¯åŠ¨äº† 9 ä¸ª Task Managerï¼Œç„¶åçœ‹åˆ°æˆ‘ä»¬é¡µé¢çš„ç›‘æ§ä¿¡æ¯å¦‚ä¸‹ï¼š![](https://zhisheng-blog.oss-cn-hangzhou.aliyuncs.com/images/9Hxhsg.jpg)å¯ä»¥çœ‹åˆ°ç›‘æ§ä¿¡æ¯é‡Œé¢å·²ç»æœ‰ 40 ä¸ªå¯ç”¨çš„ slotï¼Œè¿™æ˜¯å› ä¸º Blink é»˜è®¤çš„æ˜¯ä¸€ä¸ª Task Manager 4 ä¸ª slotï¼Œæˆ‘ä»¬æ€»å…±å¯åŠ¨äº† 10 ä¸ª Task Managerï¼Œæ‰€ä»¥æ‰ä¼šæœ‰ 40 ä¸ªå¯ç”¨çš„ slotï¼Œæ³¨æ„ï¼šFlink é»˜è®¤çš„é…ç½®æ˜¯ 1 ä¸ª Task Manager åªå«æœ‰ 1 ä¸ª slotï¼Œä¸è¿‡è¿™ä¸ªæ˜¯å¯ä»¥è‡ªå·±åˆ†é…çš„ã€‚æ³¨æ„ï¼šå¼€å¯äº†å¤šä¸ª Task Manager åï¼Œè¦å…³é—­çš„è¯ï¼Œå¾—æ‰§è¡ŒåŒæ ·æ¬¡æ•°çš„å…³é—­å‘½ä»¤ï¼š```shell./stop-cluster.sh ä¸­æ–‡æºç åˆ†æhttps://github.com/zhisheng17/flink é…å¥—è§†é¢‘è§£æè§†é¢‘å½•åˆ¶è¿‡ç¨‹éš¾å…è¯´é”™ï¼Œè¿˜è¯·å¤§å®¶å¯ä»¥æŒ‡æ•™ ç›¸å…³æ›´å¤šæºç è§£æçš„æ–‡ç« å’Œ Flink èµ„æ–™è¯·åŠ çŸ¥è¯†æ˜Ÿçƒï¼ æœ¬æ–‡åœ°å€æ˜¯ï¼šhttp://www.54tianzhisheng.cn/2019/01/30/Flink-code-compile/ï¼Œæœªç»å…è®¸ï¼Œç¦æ­¢è½¬è½½ï¼ æ€»ç»“æœ¬ç¯‡æ–‡ç« æ˜¯ã€Šä»1åˆ°100æ·±å…¥å­¦ä¹ Flinkã€‹çš„ç¬¬ä¸€ç¯‡ï¼Œzhisheng æˆ‘å¸¦å¸¦å¤§å®¶ä¸€èµ·å¦‚ä½• clone é¡¹ç›®æºç ï¼Œè¿›è¡Œæºç ç¼–è¯‘ï¼Œç„¶åè¿è¡Œç¼–è¯‘åçš„å¯æ‰§è¡Œæ–‡ä»¶ blinkã€‚ä¸‹ç¯‡æ–‡ç« ä¼šåˆ†æé¡¹ç›®æºç çš„ç»“æ„ç»„æˆã€‚ åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€å®æˆ˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ","date":"2019-01-19T16:00:00.000Z","path":"2019/01/20/Flink-RabbitMQ-sink/","text":"å‰è¨€ä¹‹å‰æœ‰æ–‡ç«  ã€Šä»0åˆ°1å­¦ä¹ Flinkã€‹â€”â€” Flink å†™å…¥æ•°æ®åˆ° Kafka å†™è¿‡ Flink å°†å¤„ç†åçš„æ•°æ®åå‘åˆ° Kafka æ¶ˆæ¯é˜Ÿåˆ—ä¸­å»ï¼Œå½“ç„¶æˆ‘ä»¬å¸¸ç”¨çš„æ¶ˆæ¯é˜Ÿåˆ—å¯ä¸æ­¢è¿™ä¸€ç§ï¼Œè¿˜æœ‰ RocketMQã€RabbitMQ ç­‰ï¼Œåˆšå¥½ Flink ä¹Ÿæ”¯æŒå°†æ•°æ®å†™å…¥åˆ° RabbitMQï¼Œæ‰€ä»¥ä»Šå¤©æˆ‘ä»¬å°±æ¥å†™ç¯‡æ–‡ç« è®²è®²å¦‚ä½•å°† Flink å¤„ç†åçš„æ•°æ®å†™å…¥åˆ° RabbitMQã€‚ å‰æå‡†å¤‡å®‰è£… RabbitMQè¿™é‡Œæˆ‘ç›´æ¥ç”¨ docker å‘½ä»¤å®‰è£…å§ï¼Œå…ˆæŠŠ docker åœ¨ mac ä¸Šå¯åŠ¨èµ·æ¥ã€‚ åœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š 1docker run -d -p 15672:15672 -p 5672:5672 -e RABBITMQ_DEFAULT_USER=admin -e RABBITMQ_DEFAULT_PASS=admin --name rabbitmq rabbitmq:3-management å¯¹è¿™ä¸ªå‘½ä»¤ä¸æ‡‚çš„ç«¥é‹å¯ä»¥çœ‹çœ‹æˆ‘ä»¥å‰çš„æ–‡ç« ï¼šhttp://www.54tianzhisheng.cn/2018/01/26/SpringBoot-RabbitMQ/ ç™»å½•ç”¨æˆ·åå’Œå¯†ç åˆ†åˆ«æ˜¯ï¼šadmin / admin ï¼Œç™»å½•è¿›å»æ˜¯è¿™ä¸ªæ ·å­å°±ä»£è¡¨å®‰è£…æˆåŠŸäº†ï¼š ä¾èµ–pom.xml ä¸­æ·»åŠ  Flink connector rabbitmq çš„ä¾èµ–å¦‚ä¸‹ï¼š 12345&lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-connector-rabbitmq_$&#123;scala.binary.version&#125;&lt;/artifactId&gt; &lt;version&gt;$&#123;flink.version&#125;&lt;/version&gt;&lt;/dependency&gt; ç”Ÿäº§è€…è¿™é‡Œæˆ‘ä»¬ä¾æ—§è‡ªå·±å†™ä¸€ä¸ªå·¥å…·ç±»ä¸€ç›´çš„å¾€ RabbitMQ ä¸­çš„æŸä¸ª queue ä¸­å‘æ•°æ®ï¼Œç„¶åç”± Flink å»æ¶ˆè´¹è¿™äº›æ•°æ®ã€‚ æ³¨æ„æŒ‰ç…§æˆ‘çš„æ­¥éª¤æ¥ä¸€æ­¥æ­¥æ“ä½œï¼Œå¦åˆ™å¯èƒ½ä¼šå‡ºç°ä¸€äº›é”™è¯¯ï¼ RabbitMQProducerUtil.java 12345678910111213141516171819202122232425262728293031323334353637383940import com.rabbitmq.client.Channel;import com.rabbitmq.client.Connection;import com.rabbitmq.client.ConnectionFactory;public class RabbitMQProducerUtil &#123; public final static String QUEUE_NAME = \"zhisheng\"; public static void main(String[] args) throws Exception &#123; //åˆ›å»ºè¿æ¥å·¥å‚ ConnectionFactory factory = new ConnectionFactory(); //è®¾ç½®RabbitMQç›¸å…³ä¿¡æ¯ factory.setHost(\"localhost\"); factory.setUsername(\"admin\"); factory.setPassword(\"admin\"); factory.setPort(5672); //åˆ›å»ºä¸€ä¸ªæ–°çš„è¿æ¥ Connection connection = factory.newConnection(); //åˆ›å»ºä¸€ä¸ªé€šé“ Channel channel = connection.createChannel(); // å£°æ˜ä¸€ä¸ªé˜Ÿåˆ—// channel.queueDeclare(QUEUE_NAME, false, false, false, null); //å‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—ä¸­ String message = \"Hello zhisheng\"; //æˆ‘ä»¬è¿™é‡Œæ¼”ç¤ºå‘é€ä¸€åƒæ¡æ•°æ® for (int i = 0; i &lt; 1000; i++) &#123; channel.basicPublish(\"\", QUEUE_NAME, null, (message + i).getBytes(\"UTF-8\")); System.out.println(\"Producer Send +'\" + message + i); &#125; //å…³é—­é€šé“å’Œè¿æ¥ channel.close(); connection.close(); &#125;&#125; Flink ä¸»ç¨‹åº12345678910111213141516171819202122232425262728293031323334import com.zhisheng.common.utils.ExecutionEnvUtil;import org.apache.flink.api.common.serialization.SimpleStringSchema;import org.apache.flink.api.java.utils.ParameterTool;import org.apache.flink.streaming.api.datastream.DataStreamSource;import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;import org.apache.flink.streaming.connectors.rabbitmq.RMQSource;import org.apache.flink.streaming.connectors.rabbitmq.common.RMQConnectionConfig;/** * ä» rabbitmq è¯»å–æ•°æ® */public class Main &#123; public static void main(String[] args) throws Exception &#123; final StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment(); ParameterTool parameterTool = ExecutionEnvUtil.PARAMETER_TOOL; //è¿™äº›é…ç½®å»ºè®®å¯ä»¥æ”¾åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œç„¶åé€šè¿‡ parameterTool æ¥è·å–å¯¹åº”çš„å‚æ•°å€¼ final RMQConnectionConfig connectionConfig = new RMQConnectionConfig .Builder().setHost(\"localhost\").setVirtualHost(\"/\") .setPort(5672).setUserName(\"admin\").setPassword(\"admin\") .build(); DataStreamSource&lt;String&gt; zhisheng = env.addSource(new RMQSource&lt;&gt;(connectionConfig, \"zhisheng\", true, new SimpleStringSchema())) .setParallelism(1); zhisheng.print(); //å¦‚æœæƒ³ä¿è¯ exactly-once æˆ– at-least-once éœ€è¦æŠŠ checkpoint å¼€å¯// env.enableCheckpointing(10000); env.execute(\"flink learning connectors rabbitmq\"); &#125;&#125; è¿è¡Œ RabbitMQProducerUtil ç±»ï¼Œå†è¿è¡Œ Main ç±»ï¼ æ³¨æ„âš ï¸ï¼š 1ã€RMQConnectionConfig ä¸­è®¾ç½®çš„ç”¨æˆ·åå’Œå¯†ç è¦è®¾ç½®æˆ admin/adminï¼Œå¦‚æœä½ æ¢æˆæ˜¯ guest/guestï¼Œå…¶å®æ˜¯åœ¨ RabbitMQ é‡Œé¢æ˜¯æ²¡æœ‰è¿™ä¸ªç”¨æˆ·åå’Œå¯†ç çš„ï¼Œæ‰€ä»¥å°±ä¼šæŠ¥è¿™ä¸ªé”™è¯¯ï¼š 1nested exception is com.rabbitmq.client.AuthenticationFailureException: ACCESS_REFUSED - Login was refused using authentication mechanism PLAIN. For details see the broker logfile. ä¸å‡ºæ„å¤–çš„è¯åº”è¯¥ä½ è¿è¡Œ RabbitMQProducerUtil ç±»åï¼Œç«‹é©¬ä¸¤ä¸ªè¿è¡Œçš„ç»“æœéƒ½ä¼šå‡ºæ¥ï¼Œé€Ÿåº¦è¿˜æ˜¯å¾ˆå¿«çš„ã€‚ 2ã€å¦‚æœä½ åœ¨ RabbitMQProducerUtil å·¥å…·ç±»ä¸­æŠŠæ³¨é‡Šçš„é‚£è¡Œä»£ç æ‰“å¼€çš„è¯ï¼š 12 // å£°æ˜ä¸€ä¸ªé˜Ÿåˆ—// channel.queueDeclare(QUEUE_NAME, false, false, false, null); å°±ä¼šå‡ºç°è¿™ç§é”™è¯¯ï¼š 1Caused by: com.rabbitmq.client.ShutdownSignalException: channel error; protocol method: #method&lt;channel.close&gt;(reply-code=406, reply-text=PRECONDITION_FAILED - inequivalent arg &apos;durable&apos; for queue &apos;zhisheng&apos; in vhost &apos;/&apos;: received &apos;true&apos; but current is &apos;false&apos;, class-id=50, method-id=10) è¿™æ˜¯å› ä¸ºä½ æ‰“å¼€é‚£ä¸ªæ³¨é‡Šçš„è¯ï¼Œä¸€æ—¦ä½ è¿è¡Œäº†è¯¥ç±»å°±ä¼šåˆ›å»ºä¸€ä¸ªå«åš zhisheng çš„ Queueï¼Œå½“ä½ å†è¿è¡Œ Main ç±»ä¸­çš„æ—¶å€™ï¼Œå®ƒåˆä¼šåˆ›å»ºè¿™æ ·ä¸€ä¸ªå« zhisheng çš„ Queueï¼Œç„¶åå› ä¸ºå·²ç»æœ‰åŒåçš„ Queue äº†ï¼Œæ‰€ä»¥å°±æœ‰äº†å†²çªï¼Œè§£å†³æ–¹æ³•å°±æ˜¯æŠŠé‚£è¡Œä»£ç æ³¨é‡Šå°±å¥½äº†ã€‚ 3ã€è¯¥ connectorï¼ˆè¿æ¥å™¨ï¼‰ä¸­æä¾›äº† RMQSource ç±»å»æ¶ˆè´¹ RabbitMQ queue ä¸­çš„æ¶ˆæ¯å’Œç¡®è®¤ checkpoints ä¸Šçš„æ¶ˆæ¯ï¼Œå®ƒæä¾›äº†ä¸‰ç§ä¸ä¸€æ ·çš„ä¿è¯ï¼š Exactly-once(åªæ¶ˆè´¹ä¸€æ¬¡): å‰ææ¡ä»¶æœ‰ï¼Œ1 æ˜¯è¦å¼€å¯ checkpointï¼Œå› ä¸ºåªæœ‰åœ¨ checkpoint å®Œæˆåï¼Œæ‰ä¼šè¿”å›ç¡®è®¤æ¶ˆæ¯ç»™ RabbitMQï¼ˆè¿™æ—¶ï¼Œæ¶ˆæ¯æ‰ä¼šåœ¨ RabbitMQ é˜Ÿåˆ—ä¸­åˆ é™¤)ï¼›2 æ˜¯è¦ä½¿ç”¨ Correlation IDï¼Œåœ¨å°†æ¶ˆæ¯å‘å¾€ RabbitMQ æ—¶ï¼Œå¿…é¡»åœ¨æ¶ˆæ¯å±æ€§ä¸­è®¾ç½® Correlation IDã€‚æ•°æ®æºæ ¹æ® Correlation ID æŠŠä» checkpoint æ¢å¤çš„æ•°æ®è¿›è¡Œå»é‡ï¼›3 æ˜¯æ•°æ®æºä¸èƒ½å¹¶è¡Œï¼Œè¿™ç§é™åˆ¶ä¸»è¦æ˜¯ç”±äº RabbitMQ å°†æ¶ˆæ¯ä»å•ä¸ªé˜Ÿåˆ—åˆ†æ´¾ç»™å¤šä¸ªæ¶ˆè´¹è€…ã€‚ At-least-once(è‡³å°‘æ¶ˆè´¹ä¸€æ¬¡): å¼€å¯äº† checkpointï¼Œä½†æœªä½¿ç”¨ç›¸ Correlation ID æˆ– æ•°æ®æºæ˜¯å¹¶è¡Œçš„æ—¶å€™ï¼Œé‚£ä¹ˆå°±åªèƒ½ä¿è¯æ•°æ®è‡³å°‘æ¶ˆè´¹ä¸€æ¬¡äº† No guarantees(æ— æ³•ä¿è¯): Flink æ¥æ”¶åˆ°æ•°æ®å°±è¿”å›ç¡®è®¤æ¶ˆæ¯ç»™ RabbitMQ Sink æ•°æ®åˆ° RabbitMQRabbitMQ é™¤äº†å¯ä»¥ä½œä¸ºæ•°æ®æºï¼Œä¹Ÿå¯ä»¥å½“ä½œä¸‹æ¸¸ï¼ŒFlink æ¶ˆè´¹æ•°æ®åšäº†ä¸€äº›å¤„ç†ä¹‹åä¹Ÿèƒ½æŠŠæ•°æ®å‘å¾€ RabbitMQï¼Œä¸‹é¢æ¼”ç¤ºä¸‹ Flink æ¶ˆè´¹ Kafka æ•°æ®åå†™å…¥åˆ° RabbitMQã€‚ 12345678910111213141516public class Main1 &#123; public static void main(String[] args) throws Exception &#123; final ParameterTool parameterTool = ExecutionEnvUtil.createParameterTool(args); StreamExecutionEnvironment env = ExecutionEnvUtil.prepare(parameterTool); DataStreamSource&lt;Metrics&gt; data = KafkaConfigUtil.buildSource(env); final RMQConnectionConfig connectionConfig = new RMQConnectionConfig .Builder().setHost(\"localhost\").setVirtualHost(\"/\") .setPort(5672).setUserName(\"admin\").setPassword(\"admin\") .build(); //æ³¨æ„ï¼Œæ¢ä¸€ä¸ªæ–°çš„ queueï¼Œå¦åˆ™ä¹Ÿä¼šæŠ¥é”™ data.addSink(new RMQSink&lt;&gt;(connectionConfig, \"zhisheng001\", new MetricSchema())); env.execute(\"flink learning connectors rabbitmq\"); &#125;&#125; æ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Ÿä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¦æ¢ä¸€ä¸ªä¹‹å‰ä¸å­˜åœ¨çš„ queueï¼Œå¦åˆ™æ˜¯ä¼šæŠ¥é”™çš„ã€‚ ä¸å‡ºæ„å¤–çš„è¯ï¼Œä½ å¯ä»¥çœ‹åˆ° RabbitMQ çš„ç›‘æ§é¡µé¢ä¼šå‡ºç°æ–°çš„ä¸€ä¸ª queue å‡ºæ¥ï¼Œå¦‚ä¸‹å›¾ï¼š æ€»ç»“æœ¬æ–‡å…ˆæŠŠ RabbitMQ ä½œä¸ºæ•°æ®æºï¼Œå†™äº†ä¸ª Flink æ¶ˆè´¹ RabbitMQ é˜Ÿåˆ—é‡Œé¢çš„æ•°æ®è¿›è¡Œæ‰“å°å‡ºæ¥ï¼Œç„¶ååˆå†™äº†ä¸ª Flink æ¶ˆè´¹ Kafka æ•°æ®åå†™å…¥åˆ° RabbitMQ çš„ä¾‹å­ï¼ æœ¬æ–‡åŸåˆ›åœ°å€æ˜¯: http://www.54tianzhisheng.cn/2019/01/20/Flink-RabbitMQ-sink/ , æœªç»å…è®¸ç¦æ­¢è½¬è½½ã€‚ å…³æ³¨æˆ‘å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f Github ä»£ç ä»“åº“https://github.com/zhisheng17/flink-learning/ ä»¥åè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç éƒ½å°†æ”¾åœ¨è¿™ä¸ªä»“åº“é‡Œï¼ŒåŒ…å«äº†è‡ªå·±å­¦ä¹  flink çš„ä¸€äº› demo å’Œåšå®¢ã€‚ æœ¬æ–‡çš„é¡¹ç›®ä»£ç åœ¨ https://github.com/zhisheng17/flink-learning/tree/master/flink-learning-connectors/flink-learning-connectors-rabbitmq åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€å®æˆ˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"},{"name":"Kafka","slug":"Kafka","permalink":"http://www.54tianzhisheng.cn/tags/Kafka/"},{"name":"RabbitMQ","slug":"RabbitMQ","permalink":"http://www.54tianzhisheng.cn/tags/RabbitMQ/"}]},{"title":"Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL","date":"2019-01-14T16:00:00.000Z","path":"2019/01/15/Flink-MySQL-sink/","text":"å‰è¨€ä¹‹å‰å…¶å®åœ¨ ã€Šä»0åˆ°1å­¦ä¹ Flinkã€‹â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ æ–‡ç« ä¸­å…¶å®å·²ç»å†™äº†ç‚¹å°†æ•°æ®å†™å…¥åˆ° MySQLï¼Œä½†æ˜¯ä¸€äº›é…ç½®åŒ–çš„ä¸œè¥¿å½“æ—¶æ˜¯å†™æ­»çš„ï¼Œä¸èƒ½å¤Ÿé€šç”¨ï¼Œæœ€è¿‘çŸ¥è¯†æ˜Ÿçƒé‡Œæœ‰æœ‹å‹å«æˆ‘: å†™ä¸ªä» kafka ä¸­è¯»å–æ•°æ®ï¼Œç»è¿‡ Flink åšä¸ªé¢„èšåˆï¼Œç„¶ååˆ›å»ºæ•°æ®åº“è¿æ¥æ± å°†æ•°æ®æ‰¹é‡å†™å…¥åˆ° mysql çš„ä¾‹å­ã€‚ äºæ˜¯æ‰æœ‰äº†è¿™ç¯‡æ–‡ç« ï¼Œæ›´å¤šæé—®å’Œæƒ³è¦æˆ‘å†™çš„æ–‡ç« å¯ä»¥åœ¨çŸ¥è¯†æ˜Ÿçƒé‡Œåƒæˆ‘æé—®ï¼Œæˆ‘ä¼šæ ¹æ®æé—®åŠæ—¶å›ç­”å’Œå°½å¯èƒ½ä½œå‡ºæ–‡ç« çš„ä¿®æ”¹ã€‚ å‡†å¤‡ä½ éœ€è¦å°†è¿™ä¸¤ä¸ªä¾èµ–æ·»åŠ åˆ° pom.xml ä¸­ 12345&lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;5.1.34&lt;/version&gt;&lt;/dependency&gt; è¯»å– kafka æ•°æ®è¿™é‡Œæˆ‘ä¾æ—§ç”¨çš„ä»¥å‰çš„ student ç±»ï¼Œè‡ªå·±æœ¬åœ°èµ·äº† kafka ç„¶åé€ ä¸€äº›æµ‹è¯•æ•°æ®ï¼Œè¿™é‡Œæˆ‘ä»¬æµ‹è¯•å‘é€ä¸€æ¡æ•°æ®åˆ™ sleep 10sï¼Œæ„å‘³ç€å¾€ kafka ä¸­ä¸€åˆ†é’Ÿå‘ 6 æ¡æ•°æ®ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839package com.zhisheng.connectors.mysql.utils;import com.zhisheng.common.utils.GsonUtil;import com.zhisheng.connectors.mysql.model.Student;import org.apache.kafka.clients.producer.KafkaProducer;import org.apache.kafka.clients.producer.ProducerRecord;import java.util.Properties;/** * Desc: å¾€kafkaä¸­å†™æ•°æ®,å¯ä»¥ä½¿ç”¨è¿™ä¸ªmainå‡½æ•°è¿›è¡Œæµ‹è¯• * Created by zhisheng on 2019-02-17 * Blog: http://www.54tianzhisheng.cn/tags/Flink/ */public class KafkaUtil &#123; public static final String broker_list = \"localhost:9092\"; public static final String topic = \"student\"; //kafka topic éœ€è¦å’Œ flink ç¨‹åºç”¨åŒä¸€ä¸ª topic public static void writeToKafka() throws InterruptedException &#123; Properties props = new Properties(); props.put(\"bootstrap.servers\", broker_list); props.put(\"key.serializer\", \"org.apache.kafka.common.serialization.StringSerializer\"); props.put(\"value.serializer\", \"org.apache.kafka.common.serialization.StringSerializer\"); KafkaProducer producer = new KafkaProducer&lt;String, String&gt;(props); for (int i = 1; i &lt;= 100; i++) &#123; Student student = new Student(i, \"zhisheng\" + i, \"password\" + i, 18 + i); ProducerRecord record = new ProducerRecord&lt;String, String&gt;(topic, null, null, GsonUtil.toJson(student)); producer.send(record); System.out.println(\"å‘é€æ•°æ®: \" + GsonUtil.toJson(student)); Thread.sleep(10 * 1000); //å‘é€ä¸€æ¡æ•°æ® sleep 10sï¼Œç›¸å½“äº 1 åˆ†é’Ÿ 6 æ¡ &#125; producer.flush(); &#125; public static void main(String[] args) throws InterruptedException &#123; writeToKafka(); &#125;&#125; ä» kafka ä¸­è¯»å–æ•°æ®ï¼Œç„¶ååºåˆ—åŒ–æˆ student å¯¹è±¡ã€‚ 1234567891011121314final StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();Properties props = new Properties();props.put(\"bootstrap.servers\", \"localhost:9092\");props.put(\"zookeeper.connect\", \"localhost:2181\");props.put(\"group.id\", \"metric-group\");props.put(\"key.deserializer\", \"org.apache.kafka.common.serialization.StringDeserializer\");props.put(\"value.deserializer\", \"org.apache.kafka.common.serialization.StringDeserializer\");props.put(\"auto.offset.reset\", \"latest\");SingleOutputStreamOperator&lt;Student&gt; student = env.addSource(new FlinkKafkaConsumer011&lt;&gt;( \"student\", //è¿™ä¸ª kafka topic éœ€è¦å’Œä¸Šé¢çš„å·¥å…·ç±»çš„ topic ä¸€è‡´ new SimpleStringSchema(), props)).setParallelism(1) .map(string -&gt; GsonUtil.fromJson(string, Student.class)); //ï¼Œè§£æå­—ç¬¦ä¸²æˆ student å¯¹è±¡ å› ä¸º RichSinkFunction ä¸­å¦‚æœ sink ä¸€æ¡æ•°æ®åˆ° mysql ä¸­å°±ä¼šè°ƒç”¨ invoke æ–¹æ³•ä¸€æ¬¡ï¼Œæ‰€ä»¥å¦‚æœè¦å®ç°æ‰¹é‡å†™çš„è¯ï¼Œæˆ‘ä»¬æœ€å¥½åœ¨ sink ä¹‹å‰å°±æŠŠæ•°æ®èšåˆä¸€ä¸‹ã€‚é‚£è¿™é‡Œæˆ‘ä»¬å¼€ä¸ªä¸€åˆ†é’Ÿçš„çª—å£å»èšåˆ Student æ•°æ®ã€‚ 12345678910student.timeWindowAll(Time.minutes(1)).apply(new AllWindowFunction&lt;Student, List&lt;Student&gt;, TimeWindow&gt;() &#123; @Override public void apply(TimeWindow window, Iterable&lt;Student&gt; values, Collector&lt;List&lt;Student&gt;&gt; out) throws Exception &#123; ArrayList&lt;Student&gt; students = Lists.newArrayList(values); if (students.size() &gt; 0) &#123; System.out.println(\"1 åˆ†é’Ÿå†…æ”¶é›†åˆ° student çš„æ•°æ®æ¡æ•°æ˜¯ï¼š\" + students.size()); out.collect(students); &#125; &#125;&#125;); å†™å…¥æ•°æ®åº“è¿™é‡Œä½¿ç”¨ DBCP è¿æ¥æ± è¿æ¥æ•°æ®åº“ mysqlï¼Œpom.xml ä¸­æ·»åŠ ä¾èµ–ï¼š 12345&lt;dependency&gt; &lt;groupId&gt;org.apache.commons&lt;/groupId&gt; &lt;artifactId&gt;commons-dbcp2&lt;/artifactId&gt; &lt;version&gt;2.1.1&lt;/version&gt;&lt;/dependency&gt; å¦‚æœä½ æƒ³ä½¿ç”¨å…¶ä»–çš„æ•°æ®åº“è¿æ¥æ± è¯·åŠ å…¥å¯¹åº”çš„ä¾èµ–ã€‚ è¿™é‡Œå°†æ•°æ®å†™å…¥åˆ° MySQL ä¸­ï¼Œä¾æ—§æ˜¯å’Œä¹‹å‰æ–‡ç« ä¸€æ ·ç»§æ‰¿ RichSinkFunction ç±»ï¼Œé‡å†™é‡Œé¢çš„æ–¹æ³•ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293package com.zhisheng.connectors.mysql.sinks;import com.zhisheng.connectors.mysql.model.Student;import org.apache.commons.dbcp2.BasicDataSource;import org.apache.flink.configuration.Configuration;import org.apache.flink.streaming.api.functions.sink.RichSinkFunction;import javax.sql.DataSource;import java.sql.Connection;import java.sql.DriverManager;import java.sql.PreparedStatement;import java.util.List;/** * Desc: æ•°æ®æ‰¹é‡ sink æ•°æ®åˆ° mysql * Created by zhisheng_tian on 2019-02-17 * Blog: http://www.54tianzhisheng.cn/tags/Flink/ */public class SinkToMySQL extends RichSinkFunction&lt;List&lt;Student&gt;&gt; &#123; PreparedStatement ps; BasicDataSource dataSource; private Connection connection; /** * open() æ–¹æ³•ä¸­å»ºç«‹è¿æ¥ï¼Œè¿™æ ·ä¸ç”¨æ¯æ¬¡ invoke çš„æ—¶å€™éƒ½è¦å»ºç«‹è¿æ¥å’Œé‡Šæ”¾è¿æ¥ * * @param parameters * @throws Exception */ @Override public void open(Configuration parameters) throws Exception &#123; super.open(parameters); dataSource = new BasicDataSource(); connection = getConnection(dataSource); String sql = \"insert into Student(id, name, password, age) values(?, ?, ?, ?);\"; ps = this.connection.prepareStatement(sql); &#125; @Override public void close() throws Exception &#123; super.close(); //å…³é—­è¿æ¥å’Œé‡Šæ”¾èµ„æº if (connection != null) &#123; connection.close(); &#125; if (ps != null) &#123; ps.close(); &#125; &#125; /** * æ¯æ¡æ•°æ®çš„æ’å…¥éƒ½è¦è°ƒç”¨ä¸€æ¬¡ invoke() æ–¹æ³• * * @param value * @param context * @throws Exception */ @Override public void invoke(List&lt;Student&gt; value, Context context) throws Exception &#123; //éå†æ•°æ®é›†åˆ for (Student student : value) &#123; ps.setInt(1, student.getId()); ps.setString(2, student.getName()); ps.setString(3, student.getPassword()); ps.setInt(4, student.getAge()); ps.addBatch(); &#125; int[] count = ps.executeBatch();//æ‰¹é‡åæ‰§è¡Œ System.out.println(\"æˆåŠŸäº†æ’å…¥äº†\" + count.length + \"è¡Œæ•°æ®\"); &#125; private static Connection getConnection(BasicDataSource dataSource) &#123; dataSource.setDriverClassName(\"com.mysql.jdbc.Driver\"); //æ³¨æ„ï¼Œæ›¿æ¢æˆè‡ªå·±æœ¬åœ°çš„ mysql æ•°æ®åº“åœ°å€å’Œç”¨æˆ·åã€å¯†ç  dataSource.setUrl(\"jdbc:mysql://localhost:3306/test\"); dataSource.setUsername(\"root\"); dataSource.setPassword(\"root123456\"); //è®¾ç½®è¿æ¥æ± çš„ä¸€äº›å‚æ•° dataSource.setInitialSize(10); dataSource.setMaxTotal(50); dataSource.setMinIdle(2); Connection con = null; try &#123; con = dataSource.getConnection(); System.out.println(\"åˆ›å»ºè¿æ¥æ± ï¼š\" + con); &#125; catch (Exception e) &#123; System.out.println(\"-----------mysql get connection has exception , msg = \" + e.getMessage()); &#125; return con; &#125;&#125; æ ¸å¿ƒç±» Mainæ ¸å¿ƒç¨‹åºå¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930public class Main &#123; public static void main(String[] args) throws Exception&#123; final StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment(); Properties props = new Properties(); props.put(\"bootstrap.servers\", \"localhost:9092\"); props.put(\"zookeeper.connect\", \"localhost:2181\"); props.put(\"group.id\", \"metric-group\"); props.put(\"key.deserializer\", \"org.apache.kafka.common.serialization.StringDeserializer\"); props.put(\"value.deserializer\", \"org.apache.kafka.common.serialization.StringDeserializer\"); props.put(\"auto.offset.reset\", \"latest\"); SingleOutputStreamOperator&lt;Student&gt; student = env.addSource(new FlinkKafkaConsumer011&lt;&gt;( \"student\", //è¿™ä¸ª kafka topic éœ€è¦å’Œä¸Šé¢çš„å·¥å…·ç±»çš„ topic ä¸€è‡´ new SimpleStringSchema(), props)).setParallelism(1) .map(string -&gt; GsonUtil.fromJson(string, Student.class)); // student.timeWindowAll(Time.minutes(1)).apply(new AllWindowFunction&lt;Student, List&lt;Student&gt;, TimeWindow&gt;() &#123; @Override public void apply(TimeWindow window, Iterable&lt;Student&gt; values, Collector&lt;List&lt;Student&gt;&gt; out) throws Exception &#123; ArrayList&lt;Student&gt; students = Lists.newArrayList(values); if (students.size() &gt; 0) &#123; System.out.println(\"1 åˆ†é’Ÿå†…æ”¶é›†åˆ° student çš„æ•°æ®æ¡æ•°æ˜¯ï¼š\" + students.size()); out.collect(students); &#125; &#125; &#125;).addSink(new SinkToMySQL()); env.execute(\"flink learning connectors kafka\"); &#125;&#125; è¿è¡Œé¡¹ç›®è¿è¡Œ Main ç±»åå†è¿è¡Œ KafkaUtils.java ç±»ï¼ ä¸‹å›¾æ˜¯å¾€ Kafka ä¸­å‘é€çš„æ•°æ®ï¼š ä¸‹å›¾æ˜¯è¿è¡Œ Main ç±»çš„æ—¥å¿—ï¼Œä¼šåˆ›å»º 4 ä¸ªè¿æ¥æ± æ˜¯å› ä¸ºé»˜è®¤çš„ 4 ä¸ªå¹¶è¡Œåº¦ï¼Œä½ å¦‚æœåœ¨ addSink è¿™ä¸ªç®—å­è®¾ç½®å¹¶è¡Œåº¦ä¸º 1 çš„è¯å°±ä¼šåˆ›å»ºä¸€ä¸ªè¿æ¥æ± ï¼š ä¸‹å›¾æ˜¯æ‰¹é‡æ’å…¥æ•°æ®åº“çš„ç»“æœï¼š æ€»ç»“æœ¬æ–‡ä»çŸ¥è¯†æ˜Ÿçƒä¸€ä½æœ‹å‹çš„ç–‘é—®æ¥å†™çš„ï¼Œåº”è¯¥éƒ½æ»¡è¶³äº†ä»–çš„æ¡ä»¶ï¼ˆæ‰¹é‡/æ•°æ®åº“è¿æ¥æ± /å†™å…¥mysqlï¼‰ï¼Œçš„ç¡®ç½‘ä¸Šå¾ˆå¤šçš„ä¾‹å­éƒ½æ˜¯ç®€å•çš„ demo å½¢å¼ï¼Œéƒ½æ˜¯å•æ¡æ•°æ®å°±åˆ›å»ºæ•°æ®åº“è¿æ¥æ’å…¥ MySQLï¼Œå¦‚æœè¦å†™çš„æ•°æ®é‡å¾ˆå¤§çš„è¯ï¼Œä¼šå¯¹ MySQL çš„å†™æœ‰å¾ˆå¤§çš„å‹åŠ›ã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä¹‹å‰åœ¨ ã€Šä»0åˆ°1å­¦ä¹ Flinkã€‹â€”â€” Flink å†™å…¥æ•°æ®åˆ° ElasticSearch ä¸­ï¼Œæ•°æ®å†™ ES å¼ºè°ƒè¿‡çš„ï¼Œå¦‚æœè¦æé«˜æ€§èƒ½å¿…å®šè¦æ‰¹é‡çš„å†™ã€‚å°±æ‹¿æˆ‘ä»¬ç°åœ¨è¿™ç¯‡æ–‡ç« æ¥è¯´ï¼Œå¦‚æœæ•°æ®é‡å¤§çš„è¯ï¼Œèšåˆä¸€åˆ†é’Ÿæ•°æ®è¾¾ä¸‡æ¡ï¼Œé‚£ä¹ˆè¿™æ ·æ‰¹é‡å†™ä¼šæ¯”æ¥ä¸€æ¡å†™ä¸€æ¡æ€§èƒ½æé«˜ä¸çŸ¥é“æœ‰å¤šå°‘ã€‚ æœ¬æ–‡åŸåˆ›åœ°å€æ˜¯: http://www.54tianzhisheng.cn/2019/01/15/Flink-MySQL-sink/ , æœªç»å…è®¸ç¦æ­¢è½¬è½½ã€‚ å…³æ³¨æˆ‘å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f Github ä»£ç ä»“åº“https://github.com/zhisheng17/flink-learning/ ä»¥åè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç éƒ½å°†æ”¾åœ¨è¿™ä¸ªä»“åº“é‡Œï¼ŒåŒ…å«äº†è‡ªå·±å­¦ä¹  flink çš„ä¸€äº› demo å’Œåšå®¢ã€‚ æœ¬æ–‡çš„é¡¹ç›®ä»£ç åœ¨ https://github.com/zhisheng17/flink-learning/tree/master/flink-learning-connectors/flink-learning-connectors-mysql åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€å®æˆ˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"MySQL","slug":"MySQL","permalink":"http://www.54tianzhisheng.cn/tags/MySQL/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç»","date":"2019-01-13T16:00:00.000Z","path":"2019/01/14/Flink-parallelism-slot/","text":"å‰è¨€ä¹‹æ‰€ä»¥å†™è¿™ä¸ªæ˜¯å› ä¸ºå‰æ®µæ—¶é—´è‡ªå·±çš„é¡¹ç›®å‡ºç°è¿‡è¿™æ ·çš„ä¸€ä¸ªé—®é¢˜ï¼š 123Caused by: akka.pattern.AskTimeoutException: Ask timed out on [Actor[akka://flink/user/taskmanager_0#15608456]] after [10000 ms]. Sender[null] sent message of type &quot;org.apache.flink.runtime.rpc.messages.LocalRpcInvocation&quot;. è·Ÿç€è¿™é—®é¢˜åœ¨ Flink çš„ Issue åˆ—è¡¨é‡Œçœ‹åˆ°äº†ä¸€ä¸ªç±»ä¼¼çš„é—®é¢˜ï¼šhttps://issues.apache.org/jira/browse/FLINK-9056ï¼Œçœ‹ä¸‹é¢çš„è¯„è®ºå·®ä¸å¤šå°±æ˜¯ TaskManager çš„ slot æ•°é‡ä¸è¶³çš„åŸå› ï¼Œå¯¼è‡´ job æäº¤å¤±è´¥ã€‚åœ¨ Flink 1.63 ä¸­å·²ç»ä¿®å¤äº†å˜æˆæŠ›å‡ºå¼‚å¸¸äº†ã€‚ ç«Ÿç„¶çŸ¥é“äº†æ˜¯å› ä¸º slot ä¸è¶³çš„åŸå› äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¦å…ˆäº†è§£ä¸‹ slot æ˜¯ä»€ä¹ˆä¸œä¸œå‘¢ï¼Ÿä¸è¿‡æ–‡ç« è¿™é‡Œå…ˆä»‹ç»ä¸‹ parallelismã€‚ ä»€ä¹ˆæ˜¯ parallelismï¼Ÿ å¦‚ç¿»è¯‘è¿™æ ·ï¼Œparallelism æ˜¯å¹¶è¡Œçš„æ„æ€ï¼Œåœ¨ Flink é‡Œé¢ä»£è¡¨æ¯ä¸ªä»»åŠ¡çš„å¹¶è¡Œåº¦ï¼Œé€‚å½“çš„æé«˜å¹¶è¡Œåº¦å¯ä»¥å¤§å¤§æé«˜ job çš„æ‰§è¡Œæ•ˆç‡ï¼Œæ¯”å¦‚ä½ çš„ job æ¶ˆè´¹ kafka æ•°æ®è¿‡æ…¢ï¼Œé€‚å½“è°ƒå¤§å¯èƒ½å°±æ¶ˆè´¹æ­£å¸¸äº†ã€‚ é‚£ä¹ˆåœ¨ Flink ä¸­æ€ä¹ˆè®¾ç½®å¹¶è¡Œåº¦å‘¢ï¼Ÿ å¦‚ä½•è®¾ç½® parallelismï¼Ÿ å¦‚ä¸Šå›¾ï¼Œåœ¨ flink é…ç½®æ–‡ä»¶ä¸­å¯ä»¥æŸ¥çœ‹åˆ°é»˜è®¤å¹¶è¡Œåº¦æ˜¯ 1ï¼Œ 1234cat flink-conf.yaml | grep parallelism# The parallelism used for programs that did not specify and other parallelism.parallelism.default: 1 æ‰€ä»¥ä½ å¦‚æœåœ¨ä½ çš„ flink job é‡Œé¢ä¸è®¾ç½®ä»»ä½•çš„ parallelism çš„è¯ï¼Œé‚£ä¹ˆä»–ä¹Ÿä¼šæœ‰ä¸€ä¸ªé»˜è®¤çš„ parallelism = 1ã€‚é‚£ä¹Ÿæ„å‘³ç€ä½ å¯ä»¥ä¿®æ”¹è¿™ä¸ªé…ç½®æ–‡ä»¶çš„é»˜è®¤å¹¶è¡Œåº¦ã€‚ å¦‚æœä½ æ˜¯ç”¨å‘½ä»¤è¡Œå¯åŠ¨ä½ çš„ Flink jobï¼Œé‚£ä¹ˆä½ ä¹Ÿå¯ä»¥è¿™æ ·è®¾ç½®å¹¶è¡Œåº¦(ä½¿ç”¨ -p å¹¶è¡Œåº¦)ï¼š 1./bin/flink run -p 10 ../word-count.jar ä½ ä¹Ÿå¯ä»¥é€šè¿‡è¿™æ ·æ¥è®¾ç½®ä½ æ•´ä¸ªç¨‹åºçš„å¹¶è¡Œåº¦ï¼š 12StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();env.setParallelism(10); æ³¨æ„ï¼šè¿™æ ·è®¾ç½®çš„å¹¶è¡Œåº¦æ˜¯ä½ æ•´ä¸ªç¨‹åºçš„å¹¶è¡Œåº¦ï¼Œé‚£ä¹ˆåé¢å¦‚æœä½ çš„æ¯ä¸ªç®—å­ä¸å•ç‹¬è®¾ç½®å¹¶è¡Œåº¦è¦†ç›–çš„è¯ï¼Œé‚£ä¹ˆåé¢æ¯ä¸ªç®—å­çš„å¹¶è¡Œåº¦å°±éƒ½æ˜¯è¿™é‡Œè®¾ç½®çš„å¹¶è¡Œåº¦çš„å€¼äº†ã€‚ å¦‚ä½•ç»™æ¯ä¸ªç®—å­å•ç‹¬è®¾ç½®å¹¶è¡Œåº¦å‘¢ï¼Ÿ 1234data.keyBy(new xxxKey()) .flatMap(new XxxFlatMapFunction()).setParallelism(5) .map(new XxxMapFunction).setParallelism(5) .addSink(new XxxSink()).setParallelism(1) å¦‚ä¸Šï¼Œå°±æ˜¯åœ¨æ¯ä¸ªç®—å­åé¢å•ç‹¬çš„è®¾ç½®å¹¶è¡Œåº¦ï¼Œè¿™æ ·çš„è¯ï¼Œå°±ç®—ä½ å‰é¢è®¾ç½®äº† env.setParallelism(10) ä¹Ÿæ˜¯ä¼šè¢«è¦†ç›–çš„ã€‚ è¿™ä¹Ÿè¯´æ˜ä¼˜å…ˆçº§æ˜¯ï¼šç®—å­è®¾ç½®å¹¶è¡Œåº¦ &gt; env è®¾ç½®å¹¶è¡Œåº¦ &gt; é…ç½®æ–‡ä»¶é»˜è®¤å¹¶è¡Œåº¦ å¹¶è¡Œåº¦è®²åˆ°è¿™é‡Œåº”è¯¥éƒ½æ‡‚äº†ï¼Œä¸‹é¢ zhisheng å°±ç»§ç»­è·Ÿä½ è®²è®² ä»€ä¹ˆæ˜¯ slotï¼Ÿ ä»€ä¹ˆæ˜¯ slotï¼Ÿå…¶å®ä»€ä¹ˆæ˜¯ slot è¿™ä¸ªé—®é¢˜ä¹‹å‰åœ¨ç¬¬ä¸€ç¯‡æ–‡ç«  ã€Šä»0åˆ°1å­¦ä¹ Flinkã€‹â€”â€” Apache Flink ä»‹ç» ä¸­å°±ä»‹ç»è¿‡äº†ï¼Œè¿™é‡Œå†è®²ç»†ä¸€ç‚¹ã€‚ å›¾ä¸­ Task Manager æ˜¯ä» Job Manager å¤„æ¥æ”¶éœ€è¦éƒ¨ç½²çš„ Taskï¼Œä»»åŠ¡çš„å¹¶è¡Œæ€§ç”±æ¯ä¸ª Task Manager ä¸Šå¯ç”¨çš„ slot å†³å®šã€‚æ¯ä¸ªä»»åŠ¡ä»£è¡¨åˆ†é…ç»™ä»»åŠ¡æ§½çš„ä¸€ç»„èµ„æºï¼Œslot åœ¨ Flink é‡Œé¢å¯ä»¥è®¤ä¸ºæ˜¯èµ„æºç»„ï¼ŒFlink å°†æ¯ä¸ªä»»åŠ¡åˆ†æˆå­ä»»åŠ¡å¹¶ä¸”å°†è¿™äº›å­ä»»åŠ¡åˆ†é…åˆ° slot æ¥å¹¶è¡Œæ‰§è¡Œç¨‹åºã€‚ ä¾‹å¦‚ï¼Œå¦‚æœ Task Manager æœ‰å››ä¸ª slotï¼Œé‚£ä¹ˆå®ƒå°†ä¸ºæ¯ä¸ª slot åˆ†é… 25ï¼… çš„å†…å­˜ã€‚ å¯ä»¥åœ¨ä¸€ä¸ª slot ä¸­è¿è¡Œä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ã€‚ åŒä¸€ slot ä¸­çš„çº¿ç¨‹å…±äº«ç›¸åŒçš„ JVMã€‚ åŒä¸€ JVM ä¸­çš„ä»»åŠ¡å…±äº« TCP è¿æ¥å’Œå¿ƒè·³æ¶ˆæ¯ã€‚Task Manager çš„ä¸€ä¸ª Slot ä»£è¡¨ä¸€ä¸ªå¯ç”¨çº¿ç¨‹ï¼Œè¯¥çº¿ç¨‹å…·æœ‰å›ºå®šçš„å†…å­˜ï¼Œæ³¨æ„ Slot åªå¯¹å†…å­˜éš”ç¦»ï¼Œæ²¡æœ‰å¯¹ CPU éš”ç¦»ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒFlink å…è®¸å­ä»»åŠ¡å…±äº« Slotï¼Œå³ä½¿å®ƒä»¬æ˜¯ä¸åŒ task çš„ subtaskï¼Œåªè¦å®ƒä»¬æ¥è‡ªç›¸åŒçš„ jobã€‚è¿™ç§å…±äº«å¯ä»¥æœ‰æ›´å¥½çš„èµ„æºåˆ©ç”¨ç‡ã€‚ æ–‡å­—è¯´çš„æ¯”è¾ƒå¹²ï¼Œzhisheng è¿™é‡Œæˆ‘å°±æ‹¿ä¸‹é¢çš„å›¾ç‰‡æ¥è®²è§£ï¼š ä¸Šé¢å›¾ç‰‡ä¸­æœ‰ä¸¤ä¸ª Task Managerï¼Œæ¯ä¸ª Task Manager æœ‰ä¸‰ä¸ª slotï¼Œè¿™æ ·æˆ‘ä»¬çš„ç®—å­æœ€å¤§å¹¶è¡Œåº¦é‚£ä¹ˆå°±å¯ä»¥è¾¾åˆ° 6 ä¸ªï¼Œåœ¨åŒä¸€ä¸ª slot é‡Œé¢å¯ä»¥æ‰§è¡Œ 1 è‡³å¤šä¸ªå­ä»»åŠ¡ã€‚ é‚£ä¹ˆå†çœ‹ä¸Šé¢çš„å›¾ç‰‡ï¼Œsource/map/keyby/window/apply æœ€å¤§å¯ä»¥æœ‰ 6 ä¸ªå¹¶è¡Œåº¦ï¼Œsink åªç”¨äº† 1 ä¸ªå¹¶è¡Œã€‚ æ¯ä¸ª Flink TaskManager åœ¨é›†ç¾¤ä¸­æä¾› slotã€‚ slot çš„æ•°é‡é€šå¸¸ä¸æ¯ä¸ª TaskManager çš„å¯ç”¨ CPU å†…æ ¸æ•°æˆæ¯”ä¾‹ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ä½ çš„ slot æ•°æ˜¯ä½ æ¯ä¸ª TaskManager çš„ cpu çš„æ ¸æ•°ã€‚ ä½†æ˜¯ flink é…ç½®æ–‡ä»¶ä¸­è®¾ç½®çš„ task manager é»˜è®¤çš„ slot æ˜¯ 1ã€‚ slot å’Œ parallelismä¸‹é¢ç»™å‡ºå®˜æ–¹çš„å›¾ç‰‡æ¥æ›´åŠ æ·±åˆ»çš„ç†è§£ä¸‹ slotï¼š 1ã€slot æ˜¯æŒ‡ taskmanager çš„å¹¶å‘æ‰§è¡Œèƒ½åŠ› taskmanager.numberOfTaskSlots:3 æ¯ä¸€ä¸ª taskmanager ä¸­çš„åˆ†é… 3 ä¸ª TaskSlot, 3 ä¸ª taskmanager ä¸€å…±æœ‰ 9 ä¸ª TaskSlotã€‚ 2ã€parallelism æ˜¯æŒ‡ taskmanager å®é™…ä½¿ç”¨çš„å¹¶å‘èƒ½åŠ› parallelism.default:1 è¿è¡Œç¨‹åºé»˜è®¤çš„å¹¶è¡Œåº¦ä¸º 1ï¼Œ9 ä¸ª TaskSlot åªç”¨äº† 1 ä¸ªï¼Œæœ‰ 8 ä¸ªç©ºé—²ã€‚è®¾ç½®åˆé€‚çš„å¹¶è¡Œåº¦æ‰èƒ½æé«˜æ•ˆç‡ã€‚ 3ã€parallelism æ˜¯å¯é…ç½®ã€å¯æŒ‡å®šçš„ ä¸Šå›¾ä¸­ example2 æ¯ä¸ªç®—å­è®¾ç½®çš„å¹¶è¡Œåº¦æ˜¯ 2ï¼Œ example3 æ¯ä¸ªç®—å­è®¾ç½®çš„å¹¶è¡Œåº¦æ˜¯ 9ã€‚ example4 é™¤äº† sink æ˜¯è®¾ç½®çš„å¹¶è¡Œåº¦ä¸º 1ï¼Œå…¶ä»–ç®—å­è®¾ç½®çš„å¹¶è¡Œåº¦éƒ½æ˜¯ 9ã€‚ å¥½äº†ï¼Œæ—¢ç„¶å¹¶è¡Œåº¦å’Œ slot zhisheng éƒ½å¸¦å¤§å®¶è¿‡äº†ä¸€éäº†ï¼Œé‚£ä¹ˆå†æ¥çœ‹æ–‡ç« å¼€å¤´çš„é—®é¢˜ï¼šslot èµ„æºä¸å¤Ÿã€‚ é—®é¢˜åŸå› ç°åœ¨è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆå…¶å®å°±å·²ç»å¾ˆæ˜æ˜¾äº†ï¼Œå°±æ˜¯æˆ‘ä»¬è®¾ç½®çš„å¹¶è¡Œåº¦ parallelism è¶…è¿‡äº† Task Manager èƒ½æä¾›çš„æœ€å¤§ slot æ•°é‡ï¼Œæ‰€ä»¥æ‰ä¼šæŠ¥è¿™ä¸ªé”™è¯¯ã€‚ å†æ¥æ‹¿æˆ‘çš„ä»£ç æ¥çœ‹å§ï¼Œå½“æ—¶æˆ‘å°±æ˜¯åªè®¾ç½®äº†æ•´ä¸ªé¡¹ç›®çš„å¹¶è¡Œåº¦ï¼š 1env.setParallelism(15); ä¸ºä»€ä¹ˆè¦è®¾ç½® 15 å‘¢ï¼Œå› ä¸ºæˆ‘é¡¹ç›®æ¶ˆè´¹çš„ Kafka topic æœ‰ 15 ä¸ª parttionï¼Œå°±æƒ³ç€è®©ä¸€ä¸ªå¹¶è¡Œå»æ¶ˆè´¹ä¸€ä¸ª parttionï¼Œæ²¡æ›¾æƒ³åˆ° Flink èµ„æºçš„ä¸å¤Ÿï¼Œç¨å¾®é™ä½ä¸‹ å¹¶è¡Œåº¦ä¸º 10 åå°±æ²¡å‡ºç°è¿™ä¸ªé”™è¯¯äº†ã€‚ æ€»ç»“æœ¬æ–‡ç”±è‡ªå·±é¡¹ç›®ç”Ÿäº§ç¯å¢ƒçš„ä¸€ä¸ªé—®é¢˜æ¥è®²è§£äº†è‡ªå·±å¯¹ Flink parallelism å’Œ slot çš„ç†è§£ï¼Œå¹¶å‘Šè¯‰å¤§å®¶å¦‚ä½•å»è®¾ç½®è¿™ä¸¤ä¸ªå‚æ•°ï¼Œæœ€åä¹ŸæŒ‡å‡ºäº†é—®é¢˜çš„åŸå› æ‰€åœ¨ã€‚ å…³æ³¨æˆ‘è½¬è½½è¯·åŠ¡å¿…æ³¨æ˜åŸåˆ›åœ°å€ä¸ºï¼šhttp://www.54tianzhisheng.cn/2019/01/14/Flink-parallelism-slot/ , æœªç»å…è®¸ç¦æ­¢è½¬è½½ã€‚ å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ ä¸“æ ä»‹ç»é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f Github ä»£ç ä»“åº“https://github.com/zhisheng17/flink-learning/ ä»¥åè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç éƒ½å°†æ”¾åœ¨è¿™ä¸ªä»“åº“é‡Œï¼ŒåŒ…å«äº†è‡ªå·±å­¦ä¹  flink çš„ä¸€äº› demo å’Œåšå®¢ åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€å®æˆ˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½®","date":"2019-01-12T16:00:00.000Z","path":"2019/01/13/Flink-JobManager-High-availability/","text":"å‰è¨€ä¹‹å‰åœ¨ ã€Šä»0åˆ°1å­¦ä¹ Flinkã€‹â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ è®²è¿‡ Flink çš„é…ç½®ï¼Œä½†æ˜¯åé¢é™†ç»­æœ‰äººæ¥é—®æˆ‘ä¸€äº›é…ç½®ç›¸å…³çš„ä¸œè¥¿ï¼Œåœ¨åŠ ä¸Šæˆ‘ç°åœ¨å¯¹ Flink ä¹Ÿæ›´ç†Ÿæ‚‰äº†äº›ï¼Œè¿™é‡Œæˆ‘å°±å†å†™ä¸‹ Flink JobManager çš„é…ç½®ç›¸å…³ä¿¡æ¯ã€‚ åœ¨ ã€Šä»0åˆ°1å­¦ä¹ Flinkã€‹â€”â€” Apache Flink ä»‹ç» ä¸€æ–‡ä¸­ä»‹ç»è¿‡äº† Flink Job çš„è¿è¡Œæ¶æ„å›¾ï¼š JobManager åè°ƒæ¯ä¸ª Flink ä½œä¸šçš„éƒ¨ç½²ã€‚å®ƒè´Ÿè´£è°ƒåº¦å’Œèµ„æºç®¡ç†ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ª Flink é›†ç¾¤éƒ½æœ‰ä¸€ä¸ª JobManager å®ä¾‹ã€‚è¿™ä¼šäº§ç”Ÿå•ç‚¹æ•…éšœï¼ˆSPOFï¼‰ï¼šå¦‚æœ JobManager å´©æºƒï¼Œåˆ™æ— æ³•æäº¤æ–°ä½œä¸šä¸”è¿è¡Œä¸­çš„ä½œä¸šä¹Ÿä¼šå¤±è´¥ã€‚ å¦‚æœæˆ‘ä»¬ä½¿ç”¨ JobManager é«˜å¯ç”¨æ¨¡å¼ï¼Œå¯ä»¥é¿å…è¿™ä¸ªé—®é¢˜ã€‚æ‚¨å¯ä»¥ä¸º standalone é›†ç¾¤å’Œ YARN é›†ç¾¤é…ç½®é«˜å¯ç”¨æ¨¡å¼ã€‚ standalone é›†ç¾¤é«˜å¯ç”¨æ€§standalone é›†ç¾¤çš„ JobManager é«˜å¯ç”¨æ€§çš„æ¦‚å¿µæ˜¯ï¼Œä»»ä½•æ—¶å€™éƒ½æœ‰ä¸€ä¸ªä¸» JobManager å’Œ å¤šä¸ªå¤‡ JobManagersï¼Œä»¥ä¾¿åœ¨ä¸»èŠ‚ç‚¹å¤±è´¥æ—¶æœ‰æ–°çš„ JobNamager æ¥ç®¡é›†ç¾¤ã€‚è¿™æ ·å°±ä¿è¯äº†æ²¡æœ‰å•ç‚¹æ•…éšœï¼Œä¸€æ—¦å¤‡ JobManager æ¥ç®¡é›†ç¾¤ï¼Œä½œä¸šå°±å¯ä»¥ä¾æ—§æ­£å¸¸è¿è¡Œã€‚ä¸»å¤‡ JobManager å®ä¾‹ä¹‹é—´æ²¡æœ‰æ˜ç¡®çš„åŒºåˆ«ã€‚æ¯ä¸ª JobManager éƒ½å¯ä»¥å……å½“ä¸»å¤‡èŠ‚ç‚¹ã€‚ ä¾‹å¦‚ï¼Œè¯·è€ƒè™‘ä»¥ä¸‹ä¸‰ä¸ª JobManager å®ä¾‹çš„è®¾ç½®ï¼š å¦‚ä½•é…ç½®è¦å¯ç”¨ JobManager é«˜å¯ç”¨æ€§åŠŸèƒ½ï¼Œæ‚¨å¿…é¡»å°†é«˜å¯ç”¨æ€§æ¨¡å¼è®¾ç½®ä¸º zookeeperï¼Œé…ç½® ZooKeeper quorumï¼Œå°†æ‰€æœ‰ JobManagers ä¸»æœºåŠå…¶ Web UI ç«¯å£å†™å…¥é…ç½®æ–‡ä»¶ã€‚ Flink åˆ©ç”¨ ZooKeeper åœ¨æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„ JobManager å®ä¾‹ä¹‹é—´è¿›è¡Œåˆ†å¸ƒå¼åè°ƒã€‚ZooKeeper æ˜¯ç‹¬ç«‹äº Flink çš„æœåŠ¡ï¼Œé€šè¿‡ leader é€‰ä¸¾å’Œè½»é‡çº§ä¸€è‡´æ€§çŠ¶æ€å­˜å‚¨æä¾›é«˜å¯é çš„åˆ†å¸ƒå¼åè°ƒæœåŠ¡ã€‚Flink åŒ…å«ç”¨äº Bootstrap ZooKeeper å®‰è£…çš„è„šæœ¬ã€‚ä»–åœ¨æˆ‘ä»¬çš„ Flink å®‰è£…è·¯å¾„ä¸‹é¢ /conf/zoo.cfg ã€‚ Masters æ–‡ä»¶è¦å¯åŠ¨ HA é›†ç¾¤ï¼Œè¯·åœ¨ä»¥ä¸‹ä½ç½®é…ç½® Masters æ–‡ä»¶ conf/mastersï¼š 12localhost:8081xxx.xxx.xxx.xxx:8081 masters æ–‡ä»¶åŒ…å«å¯åŠ¨ JobManagers çš„æ‰€æœ‰ä¸»æœºä»¥åŠ Web ç”¨æˆ·ç•Œé¢ç»‘å®šçš„ç«¯å£ï¼Œä¸Šé¢ä¸€è¡Œå†™ä¸€ä¸ªã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œjob manager é€‰ä¸€ä¸ªéšæœºç«¯å£ä½œä¸ºè¿›ç¨‹é€šä¿¡ç«¯å£ã€‚æ‚¨å¯ä»¥é€šè¿‡ high-availability.jobmanager.port æ›´æ”¹æ­¤è®¾ç½®ã€‚æ­¤é…ç½®æ¥å—å•ä¸ªç«¯å£ï¼ˆä¾‹å¦‚ 50010ï¼‰ï¼ŒèŒƒå›´ï¼ˆ50000-50025ï¼‰æˆ–ä¸¤è€…çš„ç»„åˆï¼ˆ50010,50011,50020-50025,50050-50075ï¼‰ã€‚ é…ç½®æ–‡ä»¶ (flink-conf.yaml)è¦å¯åŠ¨ HA é›†ç¾¤ï¼Œè¯·å°†ä»¥ä¸‹é…ç½®é”®æ·»åŠ åˆ° conf/flink-conf.yamlï¼š é«˜å¯ç”¨æ€§æ¨¡å¼ï¼ˆå¿…éœ€ï¼‰ï¼šåœ¨ conf/flink-conf.yamlä¸­ï¼Œå¿…é¡»å°†é«˜å¯ç”¨æ€§æ¨¡å¼è®¾ç½®ä¸º zookeeperï¼Œä»¥æ‰“å¼€é«˜å¯ç”¨æ¨¡å¼ã€‚ 1high-availability: zookeeper ZooKeeper quorumï¼ˆå¿…éœ€ï¼‰ï¼šZooKeeper quorum æ˜¯ä¸€ç»„ ZooKeeper æœåŠ¡å™¨ï¼Œå®ƒæä¾›åˆ†å¸ƒå¼åè°ƒæœåŠ¡ã€‚ 1high-availability.zookeeper.quorum: ip1:2181 [,...],ip2:2181 æ¯ä¸ª ip:port éƒ½æ˜¯ä¸€ä¸ª ZooKeeper æœåŠ¡å™¨çš„ ip åŠå…¶ç«¯å£ï¼ŒFlink å¯ä»¥é€šè¿‡æŒ‡å®šçš„åœ°å€å’Œç«¯å£è®¿é—® zookeeperã€‚ å¦å¤–å°±æ˜¯é«˜å¯ç”¨å­˜å‚¨ç›®å½•ï¼ŒJobManager å…ƒæ•°æ®ä¿å­˜åœ¨æ–‡ä»¶ç³»ç»Ÿ storageDir ä¸­ï¼Œåœ¨ ZooKeeper ä¸­ä»…ä¿å­˜äº†æŒ‡å‘æ­¤çŠ¶æ€çš„æŒ‡é’ˆ, æ¨èè¿™ä¸ªç›®å½•æ˜¯ HDFS, S3, Ceph, nfs ç­‰ï¼Œè¯¥ storageDir ä¸­ä¿å­˜äº† JobManager æ¢å¤çŠ¶æ€éœ€è¦çš„æ‰€æœ‰å…ƒæ•°æ®ã€‚ 1high-availability.storageDir: hdfs:///flink/ha/ é…ç½® master æ–‡ä»¶å’Œ ZooKeeper é…ç½®åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æä¾›çš„é›†ç¾¤å¯åŠ¨è„šæœ¬ã€‚ä»–ä»¬å°†å¯åŠ¨ HA é›†ç¾¤ã€‚è¯·æ³¨æ„ï¼Œå¯åŠ¨ Flink HA é›†ç¾¤å‰ï¼Œå¿…é¡»å¯åŠ¨ Zookeeper é›†ç¾¤ï¼Œå¹¶ç¡®ä¿ä¸ºè¦å¯åŠ¨çš„æ¯ä¸ª HA é›†ç¾¤é…ç½®å•ç‹¬çš„ ZooKeeper æ ¹è·¯å¾„ã€‚ ç¤ºä¾‹å…·æœ‰ 2 ä¸ª JobManagers çš„ Standalone é›†ç¾¤ï¼š 1ã€åœ¨ conf/flink-conf.yaml ä¸­é…ç½®é«˜å¯ç”¨æ¨¡å¼å’Œ Zookeeper : 123high-availability: zookeeperhigh-availability.zookeeper.quorum: localhost:2181high-availability.storageDir: hdfs:///flink/recovery 2ã€åœ¨ conf/masters ä¸­ é…ç½® masters: 12localhost:8081localhost:8082 3ã€åœ¨ conf/zoo.cfg ä¸­é…ç½® Zookeeper æœåŠ¡: 1server.0=localhost:2888:3888 4ã€å¯åŠ¨ ZooKeeper é›†ç¾¤: 12$ bin/start-zookeeper-quorum.shStarting zookeeper daemon on host localhost. 5ã€å¯åŠ¨ä¸€ä¸ª Flink HA é›†ç¾¤: 12345$ bin/start-cluster.shStarting HA cluster with 2 masters and 1 peers in ZooKeeper quorum.Starting jobmanager daemon on host localhost.Starting jobmanager daemon on host localhost.Starting taskmanager daemon on host localhost. 6ã€åœæ­¢ ZooKeeper å’Œé›†ç¾¤: 1234567$ bin/stop-cluster.shStopping taskmanager daemon (pid: 7647) on localhost.Stopping jobmanager daemon (pid: 7495) on host localhost.Stopping jobmanager daemon (pid: 7349) on host localhost.$ bin/stop-zookeeper-quorum.shStopping zookeeper daemon (pid: 7101) on host localhost. ä¸Šé¢çš„æ‰§è¡Œè„šæœ¬å¦‚ä¸‹å›¾å¯è§ï¼š YARN é›†ç¾¤é«˜å¯ç”¨æ€§å½“è¿è¡Œé«˜å¯ç”¨çš„ YARN é›†ç¾¤æ—¶ï¼Œæˆ‘ä»¬ä¸ä¼šè¿è¡Œå¤šä¸ª JobManager å®ä¾‹ï¼Œè€Œåªä¼šè¿è¡Œä¸€ä¸ªï¼Œè¯¥ JobManager å®ä¾‹å¤±è´¥æ—¶ï¼ŒYARN ä¼šå°†å…¶é‡æ–°å¯åŠ¨ã€‚Yarn çš„å…·ä½“è¡Œä¸ºå–å†³äºæ‚¨ä½¿ç”¨çš„ YARN ç‰ˆæœ¬ã€‚ å¦‚ä½•é…ç½®ï¼ŸApplication Master æœ€å¤§é‡è¯•æ¬¡æ•° (yarn-site.xml)åœ¨ YARN é…ç½®æ–‡ä»¶ yarn-site.xml ä¸­ï¼Œéœ€è¦é…ç½® application master çš„æœ€å¤§é‡è¯•æ¬¡æ•°ï¼š 1234567&lt;property&gt; &lt;name&gt;yarn.resourcemanager.am.max-attempts&lt;/name&gt; &lt;value&gt;4&lt;/value&gt; &lt;description&gt; The maximum number of application master execution attempts. &lt;/description&gt;&lt;/property&gt; å½“å‰ YARN ç‰ˆæœ¬çš„é»˜è®¤å€¼ä¸º 2ï¼ˆè¡¨ç¤ºå…è®¸å•ä¸ª JobManager å¤±è´¥ä¸¤æ¬¡ï¼‰ã€‚ Application Attempts (flink-conf.yaml)é™¤äº†ä¸Šé¢å¯ä»¥é…ç½®æœ€å¤§é‡è¯•æ¬¡æ•°å¤–ï¼Œä½ è¿˜å¯ä»¥åœ¨ flink-conf.yaml é…ç½®å¦‚ä¸‹ï¼š 1yarn.application-attempts: 10 è¿™æ„å‘³ç€åœ¨å¦‚æœç¨‹åºå¯åŠ¨å¤±è´¥ï¼ŒYARN ä¼šå†é‡è¯• 9 æ¬¡ï¼ˆ9 æ¬¡é‡è¯• + 1 æ¬¡å¯åŠ¨ï¼‰ï¼Œå¦‚æœå¯åŠ¨ 10 æ¬¡ä½œä¸šè¿˜å¤±è´¥ï¼Œyarn æ‰ä¼šå°†è¯¥ä»»åŠ¡çš„çŠ¶æ€ç½®ä¸ºå¤±è´¥ã€‚å¦‚æœå› ä¸ºèŠ‚ç‚¹ç¡¬ä»¶æ•…éšœæˆ–é‡å¯ï¼ŒNodeManager é‡æ–°åŒæ­¥ç­‰æ“ä½œï¼Œéœ€è¦ YARN ç»§ç»­å°è¯•å¯åŠ¨åº”ç”¨ã€‚è¿™äº›é‡å¯å°è¯•ä¸è®¡å…¥ yarn.application-attempts ä¸ªæ•°ä¸­ã€‚ å®¹å™¨å…³é—­è¡Œä¸º YARN 2.3.0 &lt; ç‰ˆæœ¬ &lt; 2.4.0. å¦‚æœ application master è¿›ç¨‹å¤±è´¥ï¼Œåˆ™æ‰€æœ‰çš„ container éƒ½ä¼šé‡å¯ã€‚ YARN 2.4.0 &lt; ç‰ˆæœ¬ &lt; 2.6.0. TaskManager container åœ¨ application master æ•…éšœæœŸé—´ï¼Œä¼šç»§ç»­å·¥ä½œã€‚è¿™å…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼šä½œä¸šæ¢å¤æ—¶é—´æ›´å¿«ï¼Œä¸”ç¼©çŸ­æ‰€æœ‰ task manager å¯åŠ¨æ—¶ç”³è¯·èµ„æºçš„æ—¶é—´ã€‚ YARN 2.6.0 &lt;= version: å°†å°è¯•å¤±è´¥æœ‰æ•ˆæ€§é—´éš”è®¾ç½®ä¸º Flink çš„ Akka è¶…æ—¶å€¼ã€‚å°è¯•å¤±è´¥æœ‰æ•ˆæ€§é—´éš”è¡¨ç¤ºåªæœ‰åœ¨ç³»ç»Ÿåœ¨ä¸€ä¸ªé—´éš”æœŸé—´çœ‹åˆ°æœ€å¤§åº”ç”¨ç¨‹åºå°è¯•æ¬¡æ•°åæ‰ä¼šç»ˆæ­¢åº”ç”¨ç¨‹åºã€‚è¿™é¿å…äº†æŒä¹…çš„å·¥ä½œä¼šè€—å°½å®ƒçš„åº”ç”¨ç¨‹åºå°è¯•ã€‚ ç¤ºä¾‹ï¼šé«˜å¯ç”¨çš„ YARN Session1ã€é…ç½® HA æ¨¡å¼å’Œ Zookeeper é›†ç¾¤ åœ¨ conf/flink-conf.yaml:123high-availability: zookeeperhigh-availability.zookeeper.quorum: localhost:2181yarn.application-attempts: 10 2ã€é…ç½® ZooKeeper æœåŠ¡ åœ¨ conf/zoo.cfgï¼š1server.0=localhost:2888:3888 3ã€å¯åŠ¨ Zookeeper é›†ç¾¤:12$ bin/start-zookeeper-quorum.shStarting zookeeper daemon on host localhost. 4ã€å¯åŠ¨ HA é›†ç¾¤:1$ bin/yarn-session.sh -n 2 æ€»ç»“æœ¬ç¯‡æ–‡ç« å†æ¬¡å†™äº†ä¸‹ Flink JobManager çš„é«˜å¯ç”¨é…ç½®ï¼Œå¦‚ä½•åœ¨ standalone é›†ç¾¤å’Œ YARN é›†ç¾¤ä¸­é…ç½®é«˜å¯ç”¨ã€‚ å…³æ³¨æˆ‘è½¬è½½è¯·åŠ¡å¿…æ³¨æ˜åŸåˆ›åœ°å€ä¸ºï¼šhttp://www.54tianzhisheng.cn/2019/01/13/Flink-JobManager-High-availability/ , æœªç»å…è®¸ç¦æ­¢è½¬è½½ã€‚ å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f Github ä»£ç ä»“åº“https://github.com/zhisheng17/flink-learning/ ä»¥åè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç éƒ½å°†æ”¾åœ¨è¿™ä¸ªä»“åº“é‡Œï¼ŒåŒ…å«äº†è‡ªå·±å­¦ä¹  flink çš„ä¸€äº› demo å’Œåšå®¢ åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€å®æˆ˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Flink å†™å…¥æ•°æ®åˆ° Kafka","date":"2019-01-05T16:00:00.000Z","path":"2019/01/06/Flink-Kafka-sink/","text":"å‰è¨€ä¹‹å‰æ–‡ç«  ã€Šä»0åˆ°1å­¦ä¹ Flinkã€‹â€”â€” Flink å†™å…¥æ•°æ®åˆ° ElasticSearch å†™äº†å¦‚ä½•å°† Kafka ä¸­çš„æ•°æ®å­˜å‚¨åˆ° ElasticSearch ä¸­ï¼Œé‡Œé¢å…¶å®å°±å·²ç»ç”¨åˆ°äº† Flink è‡ªå¸¦çš„ Kafka source connectorï¼ˆFlinkKafkaConsumerï¼‰ã€‚å­˜å…¥åˆ° ES åªæ˜¯å…¶ä¸­ä¸€ç§æƒ…å†µï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬æœ‰å¤šä¸ªåœ°æ–¹éœ€è¦è¿™ä»½é€šè¿‡ Flink è½¬æ¢åçš„æ•°æ®ï¼Œæ˜¯ä¸æ˜¯åˆè¦æˆ‘ä»¬ç»§ç»­å†™ä¸ª sink çš„æ’ä»¶å‘¢ï¼Ÿç¡®å®ï¼Œæ‰€ä»¥ Flink é‡Œé¢å°±é»˜è®¤æ”¯æŒäº†ä¸å°‘ sinkï¼Œæ¯”å¦‚ä¹Ÿæ”¯æŒ Kafka sink connectorï¼ˆFlinkKafkaProducerï¼‰ï¼Œé‚£ä¹ˆè¿™ç¯‡æ–‡ç« æˆ‘ä»¬å°±è®²è®²å¦‚ä½•å°†æ•°æ®å†™å…¥åˆ° Kafkaã€‚ å‡†å¤‡æ·»åŠ ä¾èµ–Flink é‡Œé¢æ”¯æŒ Kafka 0.8ã€0.9ã€0.10ã€0.11 ï¼Œä»¥åæœ‰æ—¶é—´å¯ä»¥åˆ†æä¸‹æºç çš„å®ç°ã€‚ è¿™é‡Œæˆ‘ä»¬éœ€è¦å®‰è£…ä¸‹ Kafkaï¼Œè¯·å¯¹åº”æ·»åŠ å¯¹åº”çš„ Flink Kafka connector ä¾èµ–çš„ç‰ˆæœ¬ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ 0.11 ç‰ˆæœ¬ï¼š 12345&lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-connector-kafka-0.11_2.11&lt;/artifactId&gt; &lt;version&gt;$&#123;flink.version&#125;&lt;/version&gt;&lt;/dependency&gt; Kafka å®‰è£…è¿™é‡Œå°±ä¸å†™è¿™å—å†…å®¹äº†ï¼Œå¯ä»¥å‚è€ƒæˆ‘ä»¥å‰çš„æ–‡ç«  Kafka å®‰è£…åŠå¿«é€Ÿå…¥é—¨ã€‚ è¿™é‡Œæˆ‘ä»¬æ¼”ç¤ºæŠŠå…¶ä»– Kafka é›†ç¾¤ä¸­ topic æ•°æ®åŸæ ·å†™å…¥åˆ°è‡ªå·±æœ¬åœ°èµ·çš„ Kafka ä¸­å»ã€‚ é…ç½®æ–‡ä»¶12345678910kafka.brokers=xxx:9092,xxx:9092,xxx:9092kafka.group.id=metrics-group-testkafka.zookeeper.connect=xxx:2181metrics.topic=xxxstream.parallelism=5kafka.sink.brokers=localhost:9092kafka.sink.topic=metric-teststream.checkpoint.interval=1000stream.checkpoint.enable=falsestream.sink.parallelism=5 ç›®å‰æˆ‘ä»¬å…ˆçœ‹ä¸‹æœ¬åœ° Kafka æ˜¯å¦æœ‰è¿™ä¸ª metric-test topic å‘¢ï¼Ÿéœ€è¦æ‰§è¡Œä¸‹è¿™ä¸ªå‘½ä»¤ï¼š 1bin/kafka-topics.sh --list --zookeeper localhost:2181 å¯ä»¥çœ‹åˆ°æœ¬åœ°çš„ Kafka æ˜¯æ²¡æœ‰ä»»ä½• topic çš„ï¼Œå¦‚æœç­‰ä¸‹æˆ‘ä»¬çš„ç¨‹åºè¿è¡Œèµ·æ¥åï¼Œå†æ¬¡æ‰§è¡Œè¿™ä¸ªå‘½ä»¤å‡ºç° metric-test topicï¼Œé‚£ä¹ˆè¯æ˜æˆ‘çš„ç¨‹åºç¡®å®èµ·ä½œç”¨äº†ï¼Œå·²ç»å°†å…¶ä»–é›†ç¾¤çš„ Kafka æ•°æ®å†™å…¥åˆ°æœ¬åœ° Kafka äº†ã€‚ ç¨‹åºä»£ç Main.java 12345678910111213141516public class Main &#123; public static void main(String[] args) throws Exception&#123; final ParameterTool parameterTool = ExecutionEnvUtil.createParameterTool(args); StreamExecutionEnvironment env = ExecutionEnvUtil.prepare(parameterTool); DataStreamSource&lt;Metrics&gt; data = KafkaConfigUtil.buildSource(env); data.addSink(new FlinkKafkaProducer011&lt;Metrics&gt;( parameterTool.get(\"kafka.sink.brokers\"), parameterTool.get(\"kafka.sink.topic\"), new MetricSchema() )).name(\"flink-connectors-kafka\") .setParallelism(parameterTool.getInt(\"stream.sink.parallelism\")); env.execute(\"flink learning connectors kafka\"); &#125;&#125; è¿è¡Œç»“æœå¯åŠ¨ç¨‹åºï¼ŒæŸ¥çœ‹è¿è¡Œç»“æœï¼Œä¸æ®µæ‰§è¡Œä¸Šé¢å‘½ä»¤ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰æ–°çš„ topic å‡ºæ¥ï¼š æ‰§è¡Œå‘½ä»¤å¯ä»¥æŸ¥çœ‹è¯¥ topic çš„ä¿¡æ¯ï¼š 1bin/kafka-topics.sh --describe --zookeeper localhost:2181 --topic metric-test åˆ†æä¸Šé¢ä»£ç æˆ‘ä»¬ä½¿ç”¨ Flink Kafka Producer åªä¼ äº†ä¸‰ä¸ªå‚æ•°ï¼šbrokerListã€topicIdã€serializationSchemaï¼ˆåºåˆ—åŒ–ï¼‰ å…¶å®ä¹Ÿå¯ä»¥ä¼ å…¥å¤šä¸ªå‚æ•°è¿›å»ï¼Œç°åœ¨æœ‰çš„å‚æ•°ç”¨çš„æ˜¯é»˜è®¤å‚æ•°ï¼Œå› ä¸ºè¿™ä¸ªå†…å®¹æ¯”è¾ƒå¤šï¼Œåé¢å¯ä»¥æŠ½å‡ºä¸€ç¯‡æ–‡ç« å•ç‹¬æ¥è®²ã€‚ æ€»ç»“æœ¬ç¯‡æ–‡ç« å†™äº† Flink è¯»å–å…¶ä»– Kafka é›†ç¾¤çš„æ•°æ®ï¼Œç„¶åå†™å…¥åˆ°æœ¬åœ°çš„ Kafka ä¸Šã€‚æˆ‘åœ¨ Flink è¿™å±‚æ²¡åšä»€ä¹ˆæ•°æ®è½¬æ¢ï¼Œåªæ˜¯åŸæ ·çš„å°†æ•°æ®è½¬å‘äº†ä¸‹ï¼Œå¦‚æœä½ ä»¬æœ‰ä»€ä¹ˆå…¶ä»–çš„éœ€æ±‚ï¼Œæ˜¯å¯ä»¥åœ¨ Flink è¿™å±‚å°†æ•°æ®è¿›è¡Œå„ç§è½¬æ¢æ“ä½œï¼Œæ¯”å¦‚è¿™ç¯‡æ–‡ç« ä¸­çš„ä¸€äº›è½¬æ¢ï¼šã€Šä»0åˆ°1å­¦ä¹ Flinkã€‹â€”â€” Flink Data transformation(è½¬æ¢)ï¼Œç„¶åå°†è½¬æ¢åçš„æ•°æ®å‘åˆ° Kafka ä¸Šå»ã€‚ æœ¬æ–‡åŸåˆ›åœ°å€æ˜¯: http://www.54tianzhisheng.cn/2019/01/06/Flink-Kafka-sink/ , æœªç»å…è®¸ç¦æ­¢è½¬è½½ã€‚ å…³æ³¨æˆ‘å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f Github ä»£ç ä»“åº“https://github.com/zhisheng17/flink-learning/ ä»¥åè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç éƒ½å°†æ”¾åœ¨è¿™ä¸ªä»“åº“é‡Œï¼ŒåŒ…å«äº†è‡ªå·±å­¦ä¹  flink çš„ä¸€äº› demo å’Œåšå®¢ åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€å®æˆ˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"},{"name":"Kafka","slug":"Kafka","permalink":"http://www.54tianzhisheng.cn/tags/Kafka/"}]},{"title":"Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ","date":"2019-01-04T16:00:00.000Z","path":"2019/01/05/Flink-run/","text":"å‰è¨€ä¹‹å‰å†™äº†ä¸å°‘ Flink æ–‡ç« äº†ï¼Œä¹Ÿæœ‰ä¸å°‘ demoï¼Œä½†æ˜¯æ–‡ç« å†™çš„æ—¶å€™éƒ½æ˜¯åœ¨æœ¬åœ°ç›´æ¥è¿è¡Œ Main ç±»çš„ main æ–¹æ³•ï¼Œå…¶å® Flink æ˜¯æ”¯æŒåœ¨ UI ä¸Šä¸Šä¼  Flink Job çš„ jar åŒ…ï¼Œç„¶åè¿è¡Œå¾—ã€‚æœ€å¼€å§‹åœ¨ç¬¬ä¸€ç¯‡ ã€Šä»0åˆ°1å­¦ä¹ Flinkã€‹â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ ä¸­å…¶å®æåˆ°è¿‡äº† Flink è‡ªå¸¦çš„ UI ç•Œé¢ï¼Œä»Šå¤©æˆ‘ä»¬å°±æ¥çœ‹çœ‹å¦‚ä½•å°†æˆ‘ä»¬çš„é¡¹ç›®æ‰“åŒ…åœ¨è¿™é‡Œå‘å¸ƒè¿è¡Œã€‚ å‡†å¤‡ç¼–è¯‘æ‰“åŒ…é¡¹ç›®ä»£ç å°±æ‹¿æˆ‘ä¹‹å‰çš„æ–‡ç«  ã€Šä»0åˆ°1å­¦ä¹ Flinkã€‹â€”â€” Flink å†™å…¥æ•°æ®åˆ° ElasticSearch å§ï¼Œä»£ç åœ°å€æ˜¯åœ¨ GitHub ä»“åº“åœ°å€ï¼šhttps://github.com/zhisheng17/flink-learning/tree/master/flink-learning-connectors/flink-learning-connectors-es6 ï¼Œå¦‚æœæ„Ÿå…´è¶£çš„å¯ä»¥ç›´æ¥æ‹¿æ¥æ‰“åŒ…è¯•è¯•æ°´ã€‚ æˆ‘ä»¬åœ¨æ•´ä¸ªé¡¹ç›® ï¼ˆflink-learningï¼‰pom.xml æ‰€åœ¨æ–‡ä»¶å¤¹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ‰“åŒ…ï¼š 1mvn clean install ç„¶åä½ ä¼šå‘ç°åœ¨ flink-learning-connectors-es6 çš„ target ç›®å½•ä¸‹æœ‰ flink-learning-connectors-es6-1.0-SNAPSHOT.jar ã€‚ å¯åŠ¨ ESæ³¨æ„ä½ çš„ Kafka æ•°æ®æºå’Œ ES éƒ½å·²ç»å¯åŠ¨å¥½äº†, æ¸…ç©ºäº†ä¸‹ ES ç›®å½•ä¸‹çš„ data æ•°æ®ï¼Œä¸ºäº†å°±æ˜¯æŸ¥çœ‹æ˜¯ä¸æ˜¯çœŸçš„æœ‰æ•°æ®å­˜å…¥è¿›æ¥äº†ã€‚ æäº¤ jar åŒ…å°†æ­¤æ–‡ä»¶æäº¤åˆ° Flinkserver ä¸Šï¼Œå¦‚ä¸‹å›¾ï¼š ç‚¹å‡»ä¸‹å›¾çº¢æ¡†ä¸­çš„â€Uploadâ€æŒ‰é’®ï¼š å¦‚ä¸‹å›¾ï¼Œé€‰ä¸­åˆšåˆšä¸Šä¼ çš„æ–‡ä»¶ï¼Œå¡«å†™ç±»åï¼Œå†ç‚¹å‡»â€Submitâ€æŒ‰é’®å³å¯å¯åŠ¨ Jobï¼š æŸ¥çœ‹è¿è¡Œç»“æœå¦‚ä¸‹å›¾ï¼Œåœ¨ Overview é¡µé¢å¯è§æ­£åœ¨è¿è¡Œçš„ä»»åŠ¡ï¼š ä½ å¯ä»¥çœ‹åˆ° Task Manager ä¸­å…³äºä»»åŠ¡çš„ metric æ•°æ®ã€æ—¥å¿—ä¿¡æ¯ä»¥åŠ Stdout ä¿¡æ¯ã€‚ æŸ¥çœ‹ Kibana ï¼Œæ­¤æ—¶ ES ä¸­å·²ç»æœ‰æ•°æ®äº†ï¼š æˆ‘ä»¬å¯ä»¥åœ¨ flink ui ç•Œé¢ä¸Šçš„ overview cancel è¿™ä¸ª jobï¼Œé‚£ä¹ˆå¯ä»¥çœ‹åˆ° job çš„æ—¥å¿—ï¼š æ€»ç»“æœ¬ç¯‡æ–‡ç« å†™äº†ä¸‹å¦‚ä½•å°†æˆ‘ä»¬çš„ job ç¼–è¯‘æ‰“åŒ…å¹¶æäº¤åˆ° Flink è‡ªå¸¦åˆ° Server UI ä¸Šé¢å»è¿è¡Œï¼Œä¹Ÿç®—æ˜¯å¯¹å‰é¢æ–‡ç« çš„ä¸€ä¸ªè¡¥å……ï¼Œå½“ç„¶äº†ï¼ŒFlink job ä¸ä»…æ”¯æŒè¿™ç§æ¨¡å¼çš„è¿è¡Œï¼Œå®ƒè¿˜å¯ä»¥è¿è¡Œåœ¨ K8sï¼ŒMesosï¼Œç­‰ä¸Šé¢ï¼Œç­‰ä»¥åæˆ‘æ¥è§¦åˆ°å†å†™å†™ã€‚ æœ¬æ–‡åŸåˆ›åœ°å€æ˜¯: http://www.54tianzhisheng.cn/2019/01/05/Flink-run/ , æœªç»å…è®¸ç¦æ­¢è½¬è½½ã€‚ å…³æ³¨æˆ‘å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f Github ä»£ç ä»“åº“https://github.com/zhisheng17/flink-learning/ ä»¥åè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç éƒ½å°†æ”¾åœ¨è¿™ä¸ªä»“åº“é‡Œï¼ŒåŒ…å«äº†è‡ªå·±å­¦ä¹  flink çš„ä¸€äº› demo å’Œåšå®¢ åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€å®æˆ˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Flink å†™å…¥æ•°æ®åˆ° ElasticSearch","date":"2018-12-29T16:00:00.000Z","path":"2018/12/30/Flink-ElasticSearch-Sink/","text":"å‰è¨€å‰é¢ FLink çš„æ–‡ç« ä¸­æˆ‘ä»¬å·²ç»ä»‹ç»äº†è¯´ Flink å·²ç»æœ‰å¾ˆå¤šè‡ªå¸¦çš„ Connectorã€‚ 1ã€ã€Šä»0åˆ°1å­¦ä¹ Flinkã€‹â€”â€” Data Source ä»‹ç» 2ã€ã€Šä»0åˆ°1å­¦ä¹ Flinkã€‹â€”â€” Data Sink ä»‹ç» å…¶ä¸­åŒ…æ‹¬äº† Source å’Œ Sink çš„ï¼Œåé¢æˆ‘ä¹Ÿè®²äº†ä¸‹å¦‚ä½•è‡ªå®šä¹‰è‡ªå·±çš„ Source å’Œ Sinkã€‚ é‚£ä¹ˆä»Šå¤©è¦åšçš„äº‹æƒ…æ˜¯å•¥å‘¢ï¼Ÿå°±æ˜¯ä»‹ç»ä¸€ä¸‹ Flink è‡ªå¸¦çš„ ElasticSearch Connectorï¼Œæˆ‘ä»¬ä»Šå¤©å°±ç”¨ä»–æ¥åš Sinkï¼Œå°† Kafka ä¸­çš„æ•°æ®ç»è¿‡ Flink å¤„ç†åç„¶åå­˜å‚¨åˆ° ElasticSearchã€‚ å‡†å¤‡å®‰è£… ElasticSearchï¼Œè¿™é‡Œå°±å¿½ç•¥ï¼Œè‡ªå·±æ‰¾æˆ‘ä»¥å‰çš„æ–‡ç« ï¼Œå»ºè®®å®‰è£… ElasticSearch 6.0 ç‰ˆæœ¬ä»¥ä¸Šçš„ï¼Œæ¯•ç«Ÿè¦è·Ÿä¸Šæ—¶ä»£çš„èŠ‚å¥ã€‚ ä¸‹é¢å°±è®²è§£ä¸€ä¸‹ç”Ÿäº§ç¯å¢ƒä¸­å¦‚ä½•ä½¿ç”¨ Elasticsearch Sink ä»¥åŠä¸€äº›æ³¨æ„ç‚¹ï¼ŒåŠå…¶å†…éƒ¨å®ç°æœºåˆ¶ã€‚ Elasticsearch Sinkæ·»åŠ ä¾èµ–12345&lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-connector-elasticsearch6_$&#123;scala.binary.version&#125;&lt;/artifactId&gt; &lt;version&gt;$&#123;flink.version&#125;&lt;/version&gt;&lt;/dependency&gt; ä¸Šé¢è¿™ä¾èµ–ç‰ˆæœ¬å·è¯·è‡ªå·±æ ¹æ®ä½¿ç”¨çš„ç‰ˆæœ¬å¯¹åº”æ”¹å˜ä¸‹ã€‚ ä¸‹é¢æ‰€æœ‰çš„ä»£ç éƒ½æ²¡æœ‰æŠŠ import å¼•å…¥åˆ°è¿™é‡Œæ¥ï¼Œå¦‚æœéœ€è¦æŸ¥çœ‹æ›´è¯¦ç»†çš„ä»£ç ï¼Œè¯·æŸ¥çœ‹æˆ‘çš„ GitHub ä»“åº“åœ°å€ï¼š https://github.com/zhisheng17/flink-learning/tree/master/flink-learning-connectors/flink-learning-connectors-es6 è¿™ä¸ª module å«æœ‰æœ¬æ–‡çš„æ‰€æœ‰ä»£ç å®ç°ï¼Œå½“ç„¶è¶Šå†™åˆ°åé¢è‡ªå·±å¯èƒ½ä¼šåšä¸€äº›æŠ½è±¡ï¼Œæ‰€ä»¥å¦‚æœæœ‰ä»£ç æ”¹å˜å¾ˆæ­£å¸¸ï¼Œè¯·ç›´æ¥æŸ¥çœ‹å…¨éƒ¨é¡¹ç›®ä»£ç ã€‚ ElasticSearchSinkUtil å·¥å…·ç±»è¿™ä¸ªå·¥å…·ç±»æ˜¯è‡ªå·±å°è£…çš„ï¼ŒgetEsAddresses æ–¹æ³•å°†ä¼ å…¥çš„é…ç½®æ–‡ä»¶ es åœ°å€è§£æå‡ºæ¥ï¼Œå¯ä»¥æ˜¯åŸŸåæ–¹å¼ï¼Œä¹Ÿå¯ä»¥æ˜¯ ip + port å½¢å¼ã€‚addSink æ–¹æ³•æ˜¯åˆ©ç”¨äº† Flink è‡ªå¸¦çš„ ElasticsearchSink æ¥å°è£…äº†ä¸€å±‚ï¼Œä¼ å…¥äº†ä¸€äº›å¿…è¦çš„è°ƒä¼˜å‚æ•°å’Œ es é…ç½®å‚æ•°ï¼Œä¸‹é¢æ–‡ç« è¿˜ä¼šå†è®²äº›å…¶ä»–çš„é…ç½®ã€‚ ElasticSearchSinkUtil.java 123456789101112131415161718192021222324252627282930313233343536373839404142434445public class ElasticSearchSinkUtil &#123; /** * es sink * * @param hosts es hosts * @param bulkFlushMaxActions bulk flush size * @param parallelism å¹¶è¡Œæ•° * @param data æ•°æ® * @param func * @param &lt;T&gt; */ public static &lt;T&gt; void addSink(List&lt;HttpHost&gt; hosts, int bulkFlushMaxActions, int parallelism, SingleOutputStreamOperator&lt;T&gt; data, ElasticsearchSinkFunction&lt;T&gt; func) &#123; ElasticsearchSink.Builder&lt;T&gt; esSinkBuilder = new ElasticsearchSink.Builder&lt;&gt;(hosts, func); esSinkBuilder.setBulkFlushMaxActions(bulkFlushMaxActions); data.addSink(esSinkBuilder.build()).setParallelism(parallelism); &#125; /** * è§£æé…ç½®æ–‡ä»¶çš„ es hosts * * @param hosts * @return * @throws MalformedURLException */ public static List&lt;HttpHost&gt; getEsAddresses(String hosts) throws MalformedURLException &#123; String[] hostList = hosts.split(\",\"); List&lt;HttpHost&gt; addresses = new ArrayList&lt;&gt;(); for (String host : hostList) &#123; if (host.startsWith(\"http\")) &#123; URL url = new URL(host); addresses.add(new HttpHost(url.getHost(), url.getPort())); &#125; else &#123; String[] parts = host.split(\":\", 2); if (parts.length &gt; 1) &#123; addresses.add(new HttpHost(parts[0], Integer.parseInt(parts[1]))); &#125; else &#123; throw new MalformedURLException(\"invalid elasticsearch hosts format\"); &#125; &#125; &#125; return addresses; &#125;&#125; Main å¯åŠ¨ç±»Main.java 123456789101112131415161718192021222324252627public class Main &#123; public static void main(String[] args) throws Exception &#123; //è·å–æ‰€æœ‰å‚æ•° final ParameterTool parameterTool = ExecutionEnvUtil.createParameterTool(args); //å‡†å¤‡å¥½ç¯å¢ƒ StreamExecutionEnvironment env = ExecutionEnvUtil.prepare(parameterTool); //ä»kafkaè¯»å–æ•°æ® DataStreamSource&lt;Metrics&gt; data = KafkaConfigUtil.buildSource(env); //ä»é…ç½®æ–‡ä»¶ä¸­è¯»å– es çš„åœ°å€ List&lt;HttpHost&gt; esAddresses = ElasticSearchSinkUtil.getEsAddresses(parameterTool.get(ELASTICSEARCH_HOSTS)); //ä»é…ç½®æ–‡ä»¶ä¸­è¯»å– bulk flush sizeï¼Œä»£è¡¨ä¸€æ¬¡æ‰¹å¤„ç†çš„æ•°é‡ï¼Œè¿™ä¸ªå¯æ˜¯æ€§èƒ½è°ƒä¼˜å‚æ•°ï¼Œç‰¹åˆ«æé†’ int bulkSize = parameterTool.getInt(ELASTICSEARCH_BULK_FLUSH_MAX_ACTIONS, 40); //ä»é…ç½®æ–‡ä»¶ä¸­è¯»å–å¹¶è¡Œ sink æ•°ï¼Œè¿™ä¸ªä¹Ÿæ˜¯æ€§èƒ½è°ƒä¼˜å‚æ•°ï¼Œç‰¹åˆ«æé†’ï¼Œè¿™æ ·æ‰èƒ½å¤Ÿæ›´å¿«çš„æ¶ˆè´¹ï¼Œé˜²æ­¢ kafka æ•°æ®å †ç§¯ int sinkParallelism = parameterTool.getInt(STREAM_SINK_PARALLELISM, 5); //è‡ªå·±å†è‡ªå¸¦çš„ es sink ä¸Šä¸€å±‚å°è£…äº†ä¸‹ ElasticSearchSinkUtil.addSink(esAddresses, bulkSize, sinkParallelism, data, (Metrics metric, RuntimeContext runtimeContext, RequestIndexer requestIndexer) -&gt; &#123; requestIndexer.add(Requests.indexRequest() .index(ZHISHENG + \"_\" + metric.getName()) //es ç´¢å¼•å .type(ZHISHENG) //es type .source(GsonUtil.toJSONBytes(metric), XContentType.JSON)); &#125;); env.execute(\"flink learning connectors es6\"); &#125;&#125; é…ç½®æ–‡ä»¶é…ç½®éƒ½æ”¯æŒé›†ç¾¤æ¨¡å¼å¡«å†™ï¼Œæ³¨æ„ç”¨ , åˆ†éš”ï¼ 12345678910kafka.brokers=localhost:9092kafka.group.id=zhisheng-metrics-group-testkafka.zookeeper.connect=localhost:2181metrics.topic=zhisheng-metricsstream.parallelism=5stream.checkpoint.interval=1000stream.checkpoint.enable=falseelasticsearch.hosts=localhost:9200elasticsearch.bulk.flush.max.actions=40stream.sink.parallelism=5 è¿è¡Œç»“æœæ‰§è¡Œ Main ç±»çš„ main æ–¹æ³•ï¼Œæˆ‘ä»¬çš„ç¨‹åºæ˜¯åªæ‰“å° flink çš„æ—¥å¿—ï¼Œæ²¡æœ‰æ‰“å°å­˜å…¥çš„æ—¥å¿—ï¼ˆå› ä¸ºæˆ‘ä»¬è¿™é‡Œæ²¡æœ‰æ‰“æ—¥å¿—ï¼‰ï¼š æ‰€ä»¥çœ‹èµ·æ¥ä¸çŸ¥é“æˆ‘ä»¬çš„ sink æ˜¯å¦æœ‰ç”¨ï¼Œæ•°æ®æ˜¯å¦ä» kafka è¯»å–å‡ºæ¥åå­˜å…¥åˆ° es äº†ã€‚ ä½ å¯ä»¥æŸ¥çœ‹ä¸‹æœ¬åœ°èµ·çš„ es ç»ˆç«¯æˆ–è€…æœåŠ¡å™¨çš„ es æ—¥å¿—å°±å¯ä»¥çœ‹åˆ°æ•ˆæœäº†ã€‚ es æ—¥å¿—å¦‚ä¸‹ï¼š ä¸Šå›¾æ˜¯æˆ‘æœ¬åœ° Mac ç”µè„‘ç»ˆç«¯çš„ es æ—¥å¿—ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„ç´¢å¼•äº†ã€‚ å¦‚æœè¿˜ä¸æ”¾å¿ƒï¼Œä½ ä¹Ÿå¯ä»¥åœ¨ä½ çš„ç”µè„‘è£…ä¸ª kibanaï¼Œç„¶åæ›´åŠ çš„ç›´è§‚æŸ¥çœ‹ä¸‹ es çš„ç´¢å¼•æƒ…å†µï¼ˆæˆ–è€…ç›´æ¥æ•² es çš„å‘½ä»¤ï¼‰ æˆ‘ä»¬ç”¨ kibana æŸ¥çœ‹å­˜å…¥ es çš„ç´¢å¼•å¦‚ä¸‹ï¼š ç¨‹åºæ‰§è¡Œäº†ä¸€ä¼šï¼Œå­˜å…¥ es çš„æ•°æ®é‡å°±å¾ˆå¤§äº†ã€‚ æ‰©å±•é…ç½®ä¸Šé¢ä»£ç å·²ç»å¯ä»¥å®ç°ä½ çš„å¤§éƒ¨åˆ†åœºæ™¯äº†ï¼Œä½†æ˜¯å¦‚æœä½ çš„ä¸šåŠ¡åœºæ™¯éœ€è¦ä¿è¯æ•°æ®çš„å®Œæ•´æ€§ï¼ˆä¸èƒ½å‡ºç°ä¸¢æ•°æ®çš„æƒ…å†µï¼‰ï¼Œé‚£ä¹ˆå°±éœ€è¦æ·»åŠ ä¸€äº›é‡è¯•ç­–ç•¥ï¼Œå› ä¸ºåœ¨æˆ‘ä»¬çš„ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¾ˆæœ‰å¯èƒ½ä¼šå› ä¸ºæŸäº›ç»„ä»¶ä¸ç¨³å®šæ€§å¯¼è‡´å„ç§é—®é¢˜ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å°±è¦åœ¨æ•°æ®å­˜å…¥å¤±è´¥çš„æ—¶å€™åšé‡è¯•æ“ä½œï¼Œè¿™é‡Œ flink è‡ªå¸¦çš„ es sink å°±æ”¯æŒäº†ï¼Œå¸¸ç”¨çš„å¤±è´¥é‡è¯•é…ç½®æœ‰: 123456789101112131ã€bulk.flush.backoff.enable ç”¨æ¥è¡¨ç¤ºæ˜¯å¦å¼€å¯é‡è¯•æœºåˆ¶2ã€bulk.flush.backoff.type é‡è¯•ç­–ç•¥ï¼Œæœ‰ä¸¤ç§ï¼šEXPONENTIAL æŒ‡æ•°å‹ï¼ˆè¡¨ç¤ºå¤šæ¬¡é‡è¯•ä¹‹é—´çš„æ—¶é—´é—´éš”æŒ‰ç…§æŒ‡æ•°æ–¹å¼è¿›è¡Œå¢é•¿ï¼‰ã€CONSTANT å¸¸æ•°å‹ï¼ˆè¡¨ç¤ºå¤šæ¬¡é‡è¯•ä¹‹é—´çš„æ—¶é—´é—´éš”ä¸ºå›ºå®šå¸¸æ•°ï¼‰3ã€bulk.flush.backoff.delay è¿›è¡Œé‡è¯•çš„æ—¶é—´é—´éš”4ã€bulk.flush.backoff.retries å¤±è´¥é‡è¯•çš„æ¬¡æ•°5ã€bulk.flush.max.actions: æ‰¹é‡å†™å…¥æ—¶çš„æœ€å¤§å†™å…¥æ¡æ•°6ã€bulk.flush.max.size.mb: æ‰¹é‡å†™å…¥æ—¶çš„æœ€å¤§æ•°æ®é‡7ã€bulk.flush.interval.ms: æ‰¹é‡å†™å…¥çš„æ—¶é—´é—´éš”ï¼Œé…ç½®ååˆ™ä¼šæŒ‰ç…§è¯¥æ—¶é—´é—´éš”ä¸¥æ ¼æ‰§è¡Œï¼Œæ— è§†ä¸Šé¢çš„ä¸¤ä¸ªæ‰¹é‡å†™å…¥é…ç½® çœ‹ä¸‹å•¦ï¼Œå°±æ˜¯å¦‚ä¸‹è¿™äº›é…ç½®äº†ï¼Œå¦‚æœä½ éœ€è¦çš„è¯ï¼Œå¯ä»¥åœ¨è¿™ä¸ªåœ°æ–¹é…ç½®æ‰©å……äº†ã€‚ FailureHandler å¤±è´¥å¤„ç†å™¨å†™å…¥ ES çš„æ—¶å€™ä¼šæœ‰è¿™äº›æƒ…å†µä¼šå¯¼è‡´å†™å…¥ ES å¤±è´¥ï¼š 1ã€ES é›†ç¾¤é˜Ÿåˆ—æ»¡äº†ï¼ŒæŠ¥å¦‚ä¸‹é”™è¯¯ 112:08:07.326 [I/O dispatcher 13] ERROR o.a.f.s.c.e.ElasticsearchSinkBase - Failed Elasticsearch item request: ElasticsearchException[Elasticsearch exception [type=es_rejected_execution_exception, reason=rejected execution of org.elasticsearch.transport.TransportService$7@566c9379 on EsThreadPoolExecutor[name = node-1/write, queue capacity = 200, org.elasticsearch.common.util.concurrent.EsThreadPoolExecutor@f00b373[Running, pool size = 4, active threads = 4, queued tasks = 200, completed tasks = 6277]]]] æ˜¯è¿™æ ·çš„ï¼Œæˆ‘ç”µè„‘å®‰è£…çš„ es é˜Ÿåˆ—å®¹é‡é»˜è®¤åº”è¯¥æ˜¯ 200ï¼Œæˆ‘æ²¡æœ‰ä¿®æ”¹è¿‡ã€‚æˆ‘è¿™é‡Œå¦‚æœé…ç½®çš„ bulk flush size * å¹¶å‘ sink æ•°é‡ è¿™ä¸ªå€¼å¦‚æœå¤§äºè¿™ä¸ª queue capacity ï¼Œé‚£ä¹ˆå°±å¾ˆå®¹æ˜“å¯¼è‡´å‡ºç°è¿™ç§å› ä¸º es é˜Ÿåˆ—æ»¡äº†è€Œå†™å…¥å¤±è´¥ã€‚ å½“ç„¶è¿™é‡Œä½ ä¹Ÿå¯ä»¥é€šè¿‡è°ƒå¤§ç‚¹ es çš„é˜Ÿåˆ—ã€‚å‚è€ƒï¼šhttps://www.elastic.co/guide/en/elasticsearch/reference/current/modules-threadpool.html 2ã€ES é›†ç¾¤æŸä¸ªèŠ‚ç‚¹æŒ‚äº† è¿™ä¸ªå°±ä¸ç”¨è¯´äº†ï¼Œè‚¯å®šå†™å…¥å¤±è´¥çš„ã€‚è·Ÿè¿‡æºç å¯ä»¥å‘ç° RestClient ç±»é‡Œçš„ performRequestAsync æ–¹æ³•ä¸€å¼€å§‹ä¼šéšæœºçš„ä»é›†ç¾¤ä¸­çš„æŸä¸ªèŠ‚ç‚¹è¿›è¡Œå†™å…¥æ•°æ®ï¼Œå¦‚æœè¿™å°æœºå™¨æ‰çº¿ï¼Œä¼šè¿›è¡Œé‡è¯•åœ¨å…¶ä»–çš„æœºå™¨ä¸Šå†™å…¥ï¼Œé‚£ä¹ˆå½“æ—¶å†™å…¥çš„è¿™å°æœºå™¨çš„è¯·æ±‚å°±éœ€è¦è¿›è¡Œå¤±è´¥é‡è¯•ï¼Œå¦åˆ™å°±ä¼šæŠŠæ•°æ®ä¸¢å¤±ï¼ 3ã€ES é›†ç¾¤æŸä¸ªèŠ‚ç‚¹çš„ç£ç›˜æ»¡äº† è¿™é‡Œè¯´çš„ç£ç›˜æ»¡äº†ï¼Œå¹¶ä¸æ˜¯ç£ç›˜çœŸçš„å°±æ²¡æœ‰ä¸€ç‚¹å‰©ä½™ç©ºé—´çš„ï¼Œæ˜¯ es ä¼šåœ¨å†™å…¥çš„æ—¶å€™æ£€æŸ¥ç£ç›˜çš„ä½¿ç”¨æƒ…å†µï¼Œåœ¨ 85% çš„æ—¶å€™ä¼šæ‰“å°æ—¥å¿—è­¦å‘Šã€‚ è¿™é‡Œæˆ‘çœ‹äº†ä¸‹æºç å¦‚ä¸‹å›¾ï¼š å¦‚æœä½ æƒ³ç»§ç»­è®© es å†™å…¥çš„è¯å°±éœ€è¦å»é‡æ–°é…ä¸€ä¸‹ es è®©å®ƒç»§ç»­å†™å…¥ï¼Œæˆ–è€…ä½ ä¹Ÿå¯ä»¥æ¸…ç©ºäº›ä¸å¿…è¦çš„æ•°æ®è…¾å‡ºç£ç›˜ç©ºé—´æ¥ã€‚ è§£å†³æ–¹æ³•123456789101112131415161718192021222324DataStream&lt;String&gt; input = ...;input.addSink(new ElasticsearchSink&lt;&gt;( config, transportAddresses, new ElasticsearchSinkFunction&lt;String&gt;() &#123;...&#125;, new ActionRequestFailureHandler() &#123; @Override void onFailure(ActionRequest action, Throwable failure, int restStatusCode, RequestIndexer indexer) throw Throwable &#123; if (ExceptionUtils.containsThrowable(failure, EsRejectedExecutionException.class)) &#123; // full queue; re-add document for indexing indexer.add(action); &#125; else if (ExceptionUtils.containsThrowable(failure, ElasticsearchParseException.class)) &#123; // malformed document; simply drop request without failing sink &#125; else &#123; // for all other failures, fail the sink // here the failure is simply rethrown, but users can also choose to throw custom exceptions throw failure; &#125; &#125;&#125;)); å¦‚æœä»…ä»…åªæ˜¯æƒ³åšå¤±è´¥é‡è¯•ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨å®˜æ–¹æä¾›çš„é»˜è®¤çš„ RetryRejectedExecutionFailureHandler ï¼Œè¯¥å¤„ç†å™¨ä¼šå¯¹ EsRejectedExecutionException å¯¼è‡´åˆ°å¤±è´¥å†™å…¥åšé‡è¯•å¤„ç†ã€‚å¦‚æœä½ æ²¡æœ‰è®¾ç½®å¤±è´¥å¤„ç†å™¨(failure handler)ï¼Œé‚£ä¹ˆå°±ä¼šä½¿ç”¨é»˜è®¤çš„ NoOpFailureHandler æ¥ç®€å•å¤„ç†æ‰€æœ‰çš„å¼‚å¸¸ã€‚ æ€»ç»“æœ¬æ–‡å†™äº† Flink connector esï¼Œå°† Kafka ä¸­çš„æ•°æ®è¯»å–å¹¶å­˜å‚¨åˆ° ElasticSearch ä¸­ï¼Œæ–‡ä¸­è®²äº†å¦‚ä½•å°è£…è‡ªå¸¦çš„ sinkï¼Œç„¶åä¸€äº›æ‰©å±•é…ç½®ä»¥åŠ FailureHandler æƒ…å†µä¸‹è¦æ€ä¹ˆå¤„ç†ã€‚ï¼ˆè¿™ä¸ªé—®é¢˜å¯æ˜¯çº¿ä¸Šå¾ˆå®¹æ˜“é‡åˆ°çš„ï¼‰ å…³æ³¨æˆ‘è½¬è½½è¯·åŠ¡å¿…æ³¨æ˜åŸåˆ›åœ°å€ä¸ºï¼šhttp://www.54tianzhisheng.cn/2018/12/30/Flink-ElasticSearch-Sink/ å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ Github ä»£ç ä»“åº“https://github.com/zhisheng17/flink-learning/ ä»¥åè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç éƒ½å°†æ”¾åœ¨è¿™ä¸ªä»“åº“é‡Œï¼ŒåŒ…å«äº†è‡ªå·±å­¦ä¹  flink çš„ä¸€äº› demo å’Œåšå®¢ åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€åŸç†ã€å®æˆ˜ã€æ€§èƒ½è°ƒä¼˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ ä¸“æ ä»‹ç»é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f","tags":[{"name":"ElasticSearch","slug":"ElasticSearch","permalink":"http://www.54tianzhisheng.cn/tags/ElasticSearch/"},{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Flink ä¸­å‡ ç§ Time è¯¦è§£","date":"2018-12-10T16:00:00.000Z","path":"2018/12/11/Flink-time/","text":"å‰è¨€Flink åœ¨æµç¨‹åºä¸­æ”¯æŒä¸åŒçš„ Time æ¦‚å¿µï¼Œå°±æ¯”å¦‚æœ‰ Processing Timeã€Event Time å’Œ Ingestion Timeã€‚ ä¸‹é¢æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹è¿™å‡ ä¸ª Timeï¼š Processing TimeProcessing Time æ˜¯æŒ‡äº‹ä»¶è¢«å¤„ç†æ—¶æœºå™¨çš„ç³»ç»Ÿæ—¶é—´ã€‚ å½“æµç¨‹åºåœ¨ Processing Time ä¸Šè¿è¡Œæ—¶ï¼Œæ‰€æœ‰åŸºäºæ—¶é—´çš„æ“ä½œ(å¦‚æ—¶é—´çª—å£)å°†ä½¿ç”¨å½“æ—¶æœºå™¨çš„ç³»ç»Ÿæ—¶é—´ã€‚æ¯å°æ—¶ Processing Time çª—å£å°†åŒ…æ‹¬åœ¨ç³»ç»Ÿæ—¶é’ŸæŒ‡ç¤ºæ•´ä¸ªå°æ—¶ä¹‹é—´åˆ°è¾¾ç‰¹å®šæ“ä½œçš„æ‰€æœ‰äº‹ä»¶ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœåº”ç”¨ç¨‹åºåœ¨ä¸Šåˆ 9:15 å¼€å§‹è¿è¡Œï¼Œåˆ™ç¬¬ä¸€ä¸ªæ¯å°æ—¶ Processing Time çª—å£å°†åŒ…æ‹¬åœ¨ä¸Šåˆ 9:15 åˆ°ä¸Šåˆ 10:00 ä¹‹é—´å¤„ç†çš„äº‹ä»¶ï¼Œä¸‹ä¸€ä¸ªçª—å£å°†åŒ…æ‹¬åœ¨ä¸Šåˆ 10:00 åˆ° 11:00 ä¹‹é—´å¤„ç†çš„äº‹ä»¶ã€‚ Processing Time æ˜¯æœ€ç®€å•çš„ â€œTimeâ€ æ¦‚å¿µï¼Œä¸éœ€è¦æµå’Œæœºå™¨ä¹‹é—´çš„åè°ƒï¼Œå®ƒæä¾›äº†æœ€å¥½çš„æ€§èƒ½å’Œæœ€ä½çš„å»¶è¿Ÿã€‚ä½†æ˜¯ï¼Œåœ¨åˆ†å¸ƒå¼å’Œå¼‚æ­¥çš„ç¯å¢ƒä¸‹ï¼ŒProcessing Time ä¸èƒ½æä¾›ç¡®å®šæ€§ï¼Œå› ä¸ºå®ƒå®¹æ˜“å—åˆ°äº‹ä»¶åˆ°è¾¾ç³»ç»Ÿçš„é€Ÿåº¦ï¼ˆä¾‹å¦‚ä»æ¶ˆæ¯é˜Ÿåˆ—ï¼‰ã€äº‹ä»¶åœ¨ç³»ç»Ÿå†…æ“ä½œæµåŠ¨çš„é€Ÿåº¦ä»¥åŠä¸­æ–­çš„å½±å“ã€‚ Event TimeEvent Time æ˜¯äº‹ä»¶å‘ç”Ÿçš„æ—¶é—´ï¼Œä¸€èˆ¬å°±æ˜¯æ•°æ®æœ¬èº«æºå¸¦çš„æ—¶é—´ã€‚è¿™ä¸ªæ—¶é—´é€šå¸¸æ˜¯åœ¨äº‹ä»¶åˆ°è¾¾ Flink ä¹‹å‰å°±ç¡®å®šçš„ï¼Œå¹¶ä¸”å¯ä»¥ä»æ¯ä¸ªäº‹ä»¶ä¸­è·å–åˆ°äº‹ä»¶æ—¶é—´æˆ³ã€‚åœ¨ Event Time ä¸­ï¼Œæ—¶é—´å–å†³äºæ•°æ®ï¼Œè€Œè·Ÿå…¶ä»–æ²¡ä»€ä¹ˆå…³ç³»ã€‚Event Time ç¨‹åºå¿…é¡»æŒ‡å®šå¦‚ä½•ç”Ÿæˆ Event Time æ°´å°ï¼Œè¿™æ˜¯è¡¨ç¤º Event Time è¿›åº¦çš„æœºåˆ¶ã€‚ å®Œç¾çš„è¯´ï¼Œæ— è®ºäº‹ä»¶ä»€ä¹ˆæ—¶å€™åˆ°è¾¾æˆ–è€…å…¶æ€ä¹ˆæ’åºï¼Œæœ€åå¤„ç† Event Time å°†äº§ç”Ÿå®Œå…¨ä¸€è‡´å’Œç¡®å®šçš„ç»“æœã€‚ä½†æ˜¯ï¼Œé™¤éäº‹ä»¶æŒ‰ç…§å·²çŸ¥é¡ºåºï¼ˆæŒ‰ç…§äº‹ä»¶çš„æ—¶é—´ï¼‰åˆ°è¾¾ï¼Œå¦åˆ™å¤„ç† Event Time æ—¶å°†ä¼šå› ä¸ºè¦ç­‰å¾…ä¸€äº›æ— åºäº‹ä»¶è€Œäº§ç”Ÿä¸€äº›å»¶è¿Ÿã€‚ç”±äºåªèƒ½ç­‰å¾…ä¸€æ®µæœ‰é™çš„æ—¶é—´ï¼Œå› æ­¤å°±éš¾ä»¥ä¿è¯å¤„ç† Event Time å°†äº§ç”Ÿå®Œå…¨ä¸€è‡´å’Œç¡®å®šçš„ç»“æœã€‚ å‡è®¾æ‰€æœ‰æ•°æ®éƒ½å·²åˆ°è¾¾ï¼Œ Event Time æ“ä½œå°†æŒ‰ç…§é¢„æœŸè¿è¡Œï¼Œå³ä½¿åœ¨å¤„ç†æ— åºäº‹ä»¶ã€å»¶è¿Ÿäº‹ä»¶ã€é‡æ–°å¤„ç†å†å²æ•°æ®æ—¶ä¹Ÿä¼šäº§ç”Ÿæ­£ç¡®ä¸”ä¸€è‡´çš„ç»“æœã€‚ ä¾‹å¦‚ï¼Œæ¯å°æ—¶äº‹ä»¶æ—¶é—´çª—å£å°†åŒ…å«å¸¦æœ‰è½å…¥è¯¥å°æ—¶çš„äº‹ä»¶æ—¶é—´æˆ³çš„æ‰€æœ‰è®°å½•ï¼Œæ— è®ºå®ƒä»¬åˆ°è¾¾çš„é¡ºåºå¦‚ä½•ã€‚ è¯·æ³¨æ„ï¼Œæœ‰æ—¶å½“ Event Time ç¨‹åºå®æ—¶å¤„ç†å®æ—¶æ•°æ®æ—¶ï¼Œå®ƒä»¬å°†ä½¿ç”¨ä¸€äº› Processing Time æ“ä½œï¼Œä»¥ç¡®ä¿å®ƒä»¬åŠæ—¶è¿›è¡Œã€‚ Ingestion TimeIngestion Time æ˜¯äº‹ä»¶è¿›å…¥ Flink çš„æ—¶é—´ã€‚ åœ¨æºæ“ä½œå¤„ï¼Œæ¯ä¸ªäº‹ä»¶å°†æºçš„å½“å‰æ—¶é—´ä½œä¸ºæ—¶é—´æˆ³ï¼Œå¹¶ä¸”åŸºäºæ—¶é—´çš„æ“ä½œï¼ˆå¦‚æ—¶é—´çª—å£ï¼‰ä¼šåˆ©ç”¨è¿™ä¸ªæ—¶é—´æˆ³ã€‚ Ingestion Time åœ¨æ¦‚å¿µä¸Šä½äº Event Time å’Œ Processing Time ä¹‹é—´ã€‚ ä¸ Processing Time ç›¸æ¯”ï¼Œå®ƒç¨å¾®è´µä¸€äº›ï¼Œä½†ç»“æœæ›´å¯é¢„æµ‹ã€‚å› ä¸º Ingestion Time ä½¿ç”¨ç¨³å®šçš„æ—¶é—´æˆ³ï¼ˆåœ¨æºå¤„åˆ†é…ä¸€æ¬¡ï¼‰ï¼Œæ‰€ä»¥å¯¹äº‹ä»¶çš„ä¸åŒçª—å£æ“ä½œå°†å¼•ç”¨ç›¸åŒçš„æ—¶é—´æˆ³ï¼Œè€Œåœ¨ Processing Time ä¸­ï¼Œæ¯ä¸ªçª—å£æ“ä½œç¬¦å¯ä»¥å°†äº‹ä»¶åˆ†é…ç»™ä¸åŒçš„çª—å£ï¼ˆåŸºäºæœºå™¨ç³»ç»Ÿæ—¶é—´å’Œåˆ°è¾¾å»¶è¿Ÿï¼‰ã€‚ ä¸ Event Time ç›¸æ¯”ï¼ŒIngestion Time ç¨‹åºæ— æ³•å¤„ç†ä»»ä½•æ— åºäº‹ä»¶æˆ–å»¶è¿Ÿæ•°æ®ï¼Œä½†ç¨‹åºä¸å¿…æŒ‡å®šå¦‚ä½•ç”Ÿæˆæ°´å°ã€‚ åœ¨ Flink ä¸­ï¼Œï¼ŒIngestion Time ä¸ Event Time éå¸¸ç›¸ä¼¼ï¼Œä½† Ingestion Time å…·æœ‰è‡ªåŠ¨åˆ†é…æ—¶é—´æˆ³å’Œè‡ªåŠ¨ç”Ÿæˆæ°´å°åŠŸèƒ½ã€‚ è¯´äº†è¿™ä¹ˆå¤šæ¦‚å¿µæ¯”è¾ƒå¹²æ¶©ï¼Œä¸‹é¢ç›´æ¥çœ‹å›¾ï¼š è®¾å®šæ—¶é—´ç‰¹æ€§Flink DataStream ç¨‹åºçš„ç¬¬ä¸€éƒ¨åˆ†é€šå¸¸æ˜¯è®¾ç½®åŸºæœ¬æ—¶é—´ç‰¹æ€§ã€‚ è¯¥è®¾ç½®å®šä¹‰äº†æ•°æ®æµæºçš„è¡Œä¸ºæ–¹å¼ï¼ˆä¾‹å¦‚ï¼šå®ƒä»¬æ˜¯å¦å°†åˆ†é…æ—¶é—´æˆ³ï¼‰ï¼Œä»¥åŠåƒ KeyedStream.timeWindow(Time.seconds(30)) è¿™æ ·çš„çª—å£æ“ä½œåº”è¯¥ä½¿ç”¨ä¸Šé¢å“ªç§æ—¶é—´æ¦‚å¿µã€‚ ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†ä¸€ä¸ª Flink ç¨‹åºï¼Œè¯¥ç¨‹åºåœ¨æ¯å°æ—¶æ—¶é—´çª—å£ä¸­èšåˆäº‹ä»¶ã€‚ 123456789101112131415final StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();env.setStreamTimeCharacteristic(TimeCharacteristic.ProcessingTime);// å…¶ä»–// env.setStreamTimeCharacteristic(TimeCharacteristic.IngestionTime);// env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime);DataStream&lt;MyEvent&gt; stream = env.addSource(new FlinkKafkaConsumer09&lt;MyEvent&gt;(topic, schema, props));stream .keyBy( (event) -&gt; event.getUser() ) .timeWindow(Time.hours(1)) .reduce( (a, b) -&gt; a.add(b) ) .addSink(...); Event Time å’Œ Watermarksæ³¨æ„ï¼šFlink å®ç°äº†æ•°æ®æµæ¨¡å‹ä¸­çš„è®¸å¤šæŠ€æœ¯ã€‚æœ‰å…³ Event Time å’Œ Watermarks çš„è¯¦ç»†ä»‹ç»ï¼Œè¯·æŸ¥çœ‹ä»¥ä¸‹æ–‡ç« ï¼š https://www.oreilly.com/ideas/the-world-beyond-batch-streaming-101 https://research.google.com/pubs/archive/43864.pdf æ”¯æŒ Event Time çš„æµå¤„ç†å™¨éœ€è¦ä¸€ç§æ–¹æ³•æ¥è¡¡é‡ Event Time çš„è¿›åº¦ã€‚ ä¾‹å¦‚ï¼Œå½“ Event Time è¶…è¿‡ä¸€å°æ—¶ç»“æŸæ—¶ï¼Œéœ€è¦é€šçŸ¥æ„å»ºæ¯å°æ—¶çª—å£çš„çª—å£æ“ä½œç¬¦ï¼Œä»¥ä¾¿æ“ä½œå‘˜å¯ä»¥å…³é—­æ­£åœ¨è¿›è¡Œçš„çª—å£ã€‚ Event Time å¯ä»¥ç‹¬ç«‹äº Processing Time è¿›è¡Œã€‚ ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªç¨‹åºä¸­ï¼Œæ“ä½œå‘˜çš„å½“å‰ Event Time å¯èƒ½ç•¥å¾®è½åäº Processing Time ï¼ˆè€ƒè™‘åˆ°æ¥æ”¶äº‹ä»¶çš„å»¶è¿Ÿï¼‰ï¼Œè€Œä¸¤è€…éƒ½ä»¥ç›¸åŒçš„é€Ÿåº¦è¿›è¡Œã€‚å¦ä¸€æ–¹é¢ï¼Œå¦ä¸€ä¸ªæµç¨‹åºå¯èƒ½åªéœ€è¦å‡ ç§’é’Ÿçš„æ—¶é—´å°±å¯ä»¥å¤„ç†å®Œ Kafka Topic ä¸­æ•°å‘¨çš„ Event Time æ•°æ®ã€‚ Flink ä¸­ç”¨äºè¡¡é‡ Event Time è¿›åº¦çš„æœºåˆ¶æ˜¯ Watermarksã€‚ Watermarks ä½œä¸ºæ•°æ®æµçš„ä¸€éƒ¨åˆ†æµåŠ¨å¹¶å¸¦æœ‰æ—¶é—´æˆ³ tã€‚ Watermarkï¼ˆtï¼‰å£°æ˜ Event Time å·²åˆ°è¾¾è¯¥æµä¸­çš„æ—¶é—´ tï¼Œè¿™æ„å‘³ç€æµä¸­ä¸åº”å†æœ‰å…·æœ‰æ—¶é—´æˆ³ tâ€™&lt;= t çš„å…ƒç´ ï¼ˆå³æ—¶é—´æˆ³å¤§äºæˆ–ç­‰äºæ°´å°çš„äº‹ä»¶ï¼‰ ä¸‹å›¾æ˜¾ç¤ºäº†å¸¦æœ‰(é€»è¾‘)æ—¶é—´æˆ³å’Œå†…è”æ°´å°çš„äº‹ä»¶æµã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œäº‹ä»¶æ˜¯æŒ‰é¡ºåºæ’åˆ—çš„(ç›¸å¯¹äºå®ƒä»¬çš„æ—¶é—´æˆ³)ï¼Œè¿™æ„å‘³ç€æ°´å°åªæ˜¯æµä¸­çš„å‘¨æœŸæ€§æ ‡è®°ã€‚ Watermark å¯¹äºæ— åºæµæ˜¯è‡³å…³é‡è¦çš„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œå…¶ä¸­äº‹ä»¶ä¸æŒ‰æ—¶é—´æˆ³æ’åºã€‚é€šå¸¸ï¼ŒWatermark æ˜¯ä¸€ç§å£°æ˜ï¼Œé€šè¿‡æµä¸­çš„è¯¥ç‚¹ï¼Œåˆ°è¾¾æŸä¸ªæ—¶é—´æˆ³çš„æ‰€æœ‰äº‹ä»¶éƒ½åº”è¯¥åˆ°è¾¾ã€‚ä¸€æ—¦æ°´å°åˆ°è¾¾æ“ä½œå‘˜ï¼Œæ“ä½œå‘˜å°±å¯ä»¥å°†å…¶å†…éƒ¨äº‹ä»¶æ—¶é—´æå‰åˆ°æ°´å°çš„å€¼ã€‚ å¹³è¡Œæµä¸­çš„æ°´å°æ°´å°æ˜¯åœ¨æºå‡½æ•°å¤„ç”Ÿæˆçš„ï¼Œæˆ–ç›´æ¥åœ¨æºå‡½æ•°ä¹‹åç”Ÿæˆçš„ã€‚æºå‡½æ•°çš„æ¯ä¸ªå¹¶è¡Œå­ä»»åŠ¡é€šå¸¸ç‹¬ç«‹ç”Ÿæˆå…¶æ°´å°ã€‚è¿™äº›æ°´å°å®šä¹‰äº†ç‰¹å®šå¹¶è¡Œæºå¤„çš„äº‹ä»¶æ—¶é—´ã€‚ å½“æ°´å°é€šè¿‡æµç¨‹åºæ—¶ï¼Œå®ƒä»¬ä¼šæå‰åˆ°è¾¾æ“ä½œäººå‘˜å¤„çš„äº‹ä»¶æ—¶é—´ã€‚å½“ä¸€ä¸ªæ“ä½œç¬¦æå‰å®ƒçš„äº‹ä»¶æ—¶é—´æ—¶ï¼Œå®ƒä¸ºå®ƒçš„åç»­æ“ä½œç¬¦åœ¨ä¸‹æ¸¸ç”Ÿæˆä¸€ä¸ªæ–°çš„æ°´å°ã€‚ ä¸€äº›æ“ä½œå‘˜æ¶ˆè€—å¤šä¸ªè¾“å…¥æµ; ä¾‹å¦‚ï¼Œä¸€ä¸ª unionï¼Œæˆ–è€…è·Ÿéš keyByï¼ˆâ€¦ï¼‰æˆ– partitionï¼ˆâ€¦ï¼‰å‡½æ•°çš„è¿ç®—ç¬¦ã€‚ è¿™æ ·çš„æ“ä½œå‘˜å½“å‰äº‹ä»¶æ—¶é—´æ˜¯å…¶è¾“å…¥æµçš„äº‹ä»¶æ—¶é—´çš„æœ€å°å€¼ã€‚ ç”±äºå…¶è¾“å…¥æµæ›´æ–°å…¶äº‹ä»¶æ—¶é—´ï¼Œå› æ­¤æ“ä½œå‘˜ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ ä¸‹å›¾æ˜¾ç¤ºäº†æµç»å¹¶è¡Œæµçš„äº‹ä»¶å’Œæ°´å°çš„ç¤ºä¾‹ï¼Œä»¥åŠè·Ÿè¸ªäº‹ä»¶æ—¶é—´çš„è¿ç®—ç¬¦ã€‚ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f å‚è€ƒhttps://github.com/zhisheng17/flink/blob/feature%2Fzhisheng_release_1.6/docs/dev/event_time.md å…³æ³¨æˆ‘è½¬è½½è¯·åŠ¡å¿…æ³¨æ˜åŸåˆ›åœ°å€ä¸ºï¼šhttp://www.54tianzhisheng.cn/2018/12/11/Flink-time/ å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ Github ä»£ç ä»“åº“https://github.com/zhisheng17/flink-learning/ ä»¥åè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç éƒ½å°†æ”¾åœ¨è¿™ä¸ªä»“åº“é‡Œï¼ŒåŒ…å«äº†è‡ªå·±å­¦ä¹  flink çš„ä¸€äº› demo å’Œåšå®¢ åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€å®æˆ˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” ä»‹ç»Flinkä¸­çš„Stream Windows","date":"2018-12-07T16:00:00.000Z","path":"2018/12/08/Flink-Stream-Windows/","text":"å‰è¨€ç›®å‰æœ‰è®¸å¤šæ•°æ®åˆ†æçš„åœºæ™¯ä»æ‰¹å¤„ç†åˆ°æµå¤„ç†çš„æ¼”å˜ï¼Œ è™½ç„¶å¯ä»¥å°†æ‰¹å¤„ç†ä½œä¸ºæµå¤„ç†çš„ç‰¹æ®Šæƒ…å†µæ¥å¤„ç†ï¼Œä½†æ˜¯åˆ†ææ— ç©·é›†çš„æµæ•°æ®é€šå¸¸éœ€è¦æ€ç»´æ–¹å¼çš„è½¬å˜å¹¶ä¸”å…·æœ‰å…¶è‡ªå·±çš„æœ¯è¯­ï¼ˆä¾‹å¦‚ï¼Œâ€œwindowingï¼ˆçª—å£åŒ–ï¼‰â€ã€â€œat-least-onceï¼ˆè‡³å°‘ä¸€æ¬¡ï¼‰â€ã€â€œexactly-onceï¼ˆåªæœ‰ä¸€æ¬¡ï¼‰â€ ï¼‰ã€‚ å¯¹äºåˆšåˆšæ¥è§¦æµå¤„ç†çš„äººæ¥è¯´ï¼Œè¿™ç§è½¬å˜å’Œæ–°æœ¯è¯­å¯èƒ½ä¼šéå¸¸æ··ä¹±ã€‚ Apache Flink æ˜¯ä¸€ä¸ªä¸ºç”Ÿäº§ç¯å¢ƒè€Œç”Ÿçš„æµå¤„ç†å™¨ï¼Œå…·æœ‰æ˜“äºä½¿ç”¨çš„ APIï¼Œå¯ä»¥ç”¨äºå®šä¹‰é«˜çº§æµåˆ†æç¨‹åºã€‚ Flink çš„ API åœ¨æ•°æ®æµä¸Šå…·æœ‰éå¸¸çµæ´»çš„çª—å£å®šä¹‰ï¼Œä½¿å…¶åœ¨å…¶ä»–å¼€æºæµå¤„ç†æ¡†æ¶ä¸­è„±é¢–è€Œå‡ºã€‚ åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºç”¨äºæµå¤„ç†çš„çª—å£çš„æ¦‚å¿µï¼Œä»‹ç» Flink çš„å†…ç½®çª—å£ï¼Œå¹¶è§£é‡Šå®ƒå¯¹è‡ªå®šä¹‰çª—å£è¯­ä¹‰çš„æ”¯æŒã€‚ ä»€ä¹ˆæ˜¯ Windowsï¼Ÿä¸‹é¢æˆ‘ä»¬ç»“åˆä¸€ä¸ªç°å®çš„ä¾‹å­æ¥è¯´æ˜ã€‚ å°±æ‹¿äº¤é€šä¼ æ„Ÿå™¨çš„ç¤ºä¾‹ï¼šç»Ÿè®¡ç»è¿‡æŸçº¢ç»¿ç¯çš„æ±½è½¦æ•°é‡ä¹‹å’Œï¼Ÿ å‡è®¾åœ¨ä¸€ä¸ªçº¢ç»¿ç¯å¤„ï¼Œæˆ‘ä»¬æ¯éš” 15 ç§’ç»Ÿè®¡ä¸€æ¬¡é€šè¿‡æ­¤çº¢ç»¿ç¯çš„æ±½è½¦æ•°é‡ï¼Œå¦‚ä¸‹å›¾ï¼š å¯ä»¥æŠŠæ±½è½¦çš„ç»è¿‡çœ‹æˆä¸€ä¸ªæµï¼Œæ— ç©·çš„æµï¼Œä¸æ–­æœ‰æ±½è½¦ç»è¿‡æ­¤çº¢ç»¿ç¯ï¼Œå› æ­¤æ— æ³•ç»Ÿè®¡æ€»å…±çš„æ±½è½¦æ•°é‡ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥æ¢ä¸€ç§æ€è·¯ï¼Œæ¯éš” 15 ç§’ï¼Œæˆ‘ä»¬éƒ½å°†ä¸ä¸Šä¸€æ¬¡çš„ç»“æœè¿›è¡Œ sum æ“ä½œï¼ˆæ»‘åŠ¨èšåˆï¼‰ï¼Œå¦‚ä¸‹ï¼š è¿™ä¸ªç»“æœä¼¼ä¹è¿˜æ˜¯æ— æ³•å›ç­”æˆ‘ä»¬çš„é—®é¢˜ï¼Œæ ¹æœ¬åŸå› åœ¨äºæµæ˜¯æ— ç•Œçš„ï¼Œæˆ‘ä»¬ä¸èƒ½é™åˆ¶æµï¼Œä½†å¯ä»¥åœ¨æœ‰ä¸€ä¸ªæœ‰ç•Œçš„èŒƒå›´å†…å¤„ç†æ— ç•Œçš„æµæ•°æ®ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æ¢ä¸€ä¸ªé—®é¢˜çš„ææ³•ï¼šæ¯åˆ†é’Ÿç»è¿‡æŸçº¢ç»¿ç¯çš„æ±½è½¦æ•°é‡ä¹‹å’Œï¼Ÿè¿™ä¸ªé—®é¢˜ï¼Œå°±ç›¸å½“äºä¸€ä¸ªå®šä¹‰äº†ä¸€ä¸ª Windowï¼ˆçª—å£ï¼‰ï¼Œwindow çš„ç•Œé™æ˜¯1åˆ†é’Ÿï¼Œä¸”æ¯åˆ†é’Ÿå†…çš„æ•°æ®äº’ä¸å¹²æ‰°ï¼Œå› æ­¤ä¹Ÿå¯ä»¥ç§°ä¸ºç¿»æ»šï¼ˆä¸é‡åˆï¼‰çª—å£ï¼Œå¦‚ä¸‹å›¾ï¼š ç¬¬ä¸€åˆ†é’Ÿçš„æ•°é‡ä¸º8ï¼Œç¬¬äºŒåˆ†é’Ÿæ˜¯22ï¼Œç¬¬ä¸‰åˆ†é’Ÿæ˜¯27ã€‚ã€‚ã€‚è¿™æ ·ï¼Œ1ä¸ªå°æ—¶å†…ä¼šæœ‰60ä¸ªwindowã€‚ å†è€ƒè™‘ä¸€ç§æƒ…å†µï¼Œæ¯30ç§’ç»Ÿè®¡ä¸€æ¬¡è¿‡å»1åˆ†é’Ÿçš„æ±½è½¦æ•°é‡ä¹‹å’Œï¼š æ­¤æ—¶ï¼Œwindow å‡ºç°äº†é‡åˆã€‚è¿™æ ·ï¼Œ1ä¸ªå°æ—¶å†…ä¼šæœ‰120ä¸ª windowã€‚ æ‰©å±•ä¸€ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æŸä¸ªåœ°åŒºï¼Œæ”¶é›†æ¯ä¸€ä¸ªçº¢ç»¿ç¯å¤„æ±½è½¦ç»è¿‡çš„æ•°é‡ï¼Œç„¶åæ¯ä¸ªçº¢ç»¿ç¯å¤„éƒ½åšä¸€æ¬¡åŸºäº1åˆ†é’Ÿçš„windowç»Ÿè®¡ï¼Œå³å¹¶è¡Œå¤„ç†ï¼š å®ƒæœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿé€šå¸¸æ¥è®²ï¼ŒWindow å°±æ˜¯ç”¨æ¥å¯¹ä¸€ä¸ªæ— é™çš„æµè®¾ç½®ä¸€ä¸ªæœ‰é™çš„é›†åˆï¼Œåœ¨æœ‰ç•Œçš„æ•°æ®é›†ä¸Šè¿›è¡Œæ“ä½œçš„ä¸€ç§æœºåˆ¶ã€‚window åˆå¯ä»¥åˆ†ä¸ºåŸºäºæ—¶é—´ï¼ˆTime-basedï¼‰çš„ window ä»¥åŠåŸºäºæ•°é‡ï¼ˆCount-basedï¼‰çš„ windowã€‚ Flink è‡ªå¸¦çš„ windowFlink DataStream API æä¾›äº† Time å’Œ Count çš„ windowï¼ŒåŒæ—¶å¢åŠ äº†åŸºäº Session çš„ windowã€‚åŒæ—¶ï¼Œç”±äºæŸäº›ç‰¹æ®Šçš„éœ€è¦ï¼ŒDataStream API ä¹Ÿæä¾›äº†å®šåˆ¶åŒ–çš„ window æ“ä½œï¼Œä¾›ç”¨æˆ·è‡ªå®šä¹‰ windowã€‚ ä¸‹é¢ï¼Œä¸»è¦ä»‹ç» Time-Based window ä»¥åŠ Count-Based windowï¼Œä»¥åŠè‡ªå®šä¹‰çš„ window æ“ä½œï¼ŒSession-Based Window æ“ä½œå°†ä¼šåœ¨åç»­çš„æ–‡ç« ä¸­è®²åˆ°ã€‚ Time Windowsæ­£å¦‚å‘½åé‚£æ ·ï¼ŒTime Windows æ ¹æ®æ—¶é—´æ¥èšåˆæµæ•°æ®ã€‚ä¾‹å¦‚ï¼šä¸€åˆ†é’Ÿçš„ tumbling time window æ”¶é›†ä¸€åˆ†é’Ÿçš„å…ƒç´ ï¼Œå¹¶åœ¨ä¸€åˆ†é’Ÿè¿‡åå¯¹çª—å£ä¸­çš„æ‰€æœ‰å…ƒç´ åº”ç”¨äºä¸€ä¸ªå‡½æ•°ã€‚ åœ¨ Flink ä¸­å®šä¹‰ tumbling time windows(ç¿»æ»šæ—¶é—´çª—å£) å’Œ sliding time windows(æ»‘åŠ¨æ—¶é—´çª—å£) éå¸¸ç®€å•ï¼š tumbling time windows(ç¿»æ»šæ—¶é—´çª—å£) è¾“å…¥ä¸€ä¸ªæ—¶é—´å‚æ•° 123data.keyBy(1) .timeWindow(Time.minutes(1)) //tumbling time window æ¯åˆ†é’Ÿç»Ÿè®¡ä¸€æ¬¡æ•°é‡å’Œ .sum(1); sliding time windows(æ»‘åŠ¨æ—¶é—´çª—å£) è¾“å…¥ä¸¤ä¸ªæ—¶é—´å‚æ•° 123data.keyBy(1) .timeWindow(Time.minutes(1), Time.seconds(30)) //sliding time window æ¯éš” 30s ç»Ÿè®¡è¿‡å»ä¸€åˆ†é’Ÿçš„æ•°é‡å’Œ .sum(1); æœ‰ä¸€ç‚¹æˆ‘ä»¬è¿˜æ²¡æœ‰è®¨è®ºï¼Œå³â€œæ”¶é›†ä¸€åˆ†é’Ÿçš„å…ƒç´ â€çš„ç¡®åˆ‡å«ä¹‰ï¼Œå®ƒå¯ä»¥å½’ç»“ä¸ºä¸€ä¸ªé—®é¢˜ï¼Œâ€œæµå¤„ç†å™¨å¦‚ä½•è§£é‡Šæ—¶é—´?â€ Apache Flink å…·æœ‰ä¸‰ä¸ªä¸åŒçš„æ—¶é—´æ¦‚å¿µï¼Œå³ processing time, event time å’Œ ingestion timeã€‚ è¿™é‡Œå¯ä»¥å‚è€ƒæˆ‘ä¸‹ä¸€ç¯‡æ–‡ç« ï¼š ã€Šä»0åˆ°1å­¦ä¹ Flinkã€‹â€”â€” ä»‹ç»Flinkä¸­çš„Event Timeã€Processing Timeå’ŒIngestion Time Count WindowsApache Flink è¿˜æä¾›è®¡æ•°çª—å£åŠŸèƒ½ã€‚å¦‚æœè®¡æ•°çª—å£è®¾ç½®çš„ä¸º 100 ï¼Œé‚£ä¹ˆå°†ä¼šåœ¨çª—å£ä¸­æ”¶é›† 100 ä¸ªäº‹ä»¶ï¼Œå¹¶åœ¨æ·»åŠ ç¬¬ 100 ä¸ªå…ƒç´ æ—¶è®¡ç®—çª—å£çš„å€¼ã€‚ åœ¨ Flink çš„ DataStream API ä¸­ï¼Œtumbling count window å’Œ sliding count window çš„å®šä¹‰å¦‚ä¸‹: tumbling count window è¾“å…¥ä¸€ä¸ªæ—¶é—´å‚æ•° 123data.keyBy(1) .countWindow(100) //ç»Ÿè®¡æ¯ 100 ä¸ªå…ƒç´ çš„æ•°é‡ä¹‹å’Œ .sum(1); sliding count window è¾“å…¥ä¸¤ä¸ªæ—¶é—´å‚æ•° 123data.keyBy(1) .countWindow(100, 10) //æ¯ 10 ä¸ªå…ƒç´ ç»Ÿè®¡è¿‡å» 100 ä¸ªå…ƒç´ çš„æ•°é‡ä¹‹å’Œ .sum(1); è§£å‰– Flink çš„çª—å£æœºåˆ¶Flink çš„å†…ç½® time window å’Œ count window å·²ç»è¦†ç›–äº†å¤§å¤šæ•°åº”ç”¨åœºæ™¯ï¼Œä½†æ˜¯æœ‰æ—¶å€™ä¹Ÿéœ€è¦å®šåˆ¶çª—å£é€»è¾‘ï¼Œæ­¤æ—¶ Flink çš„å†…ç½®çš„ window æ— æ³•è§£å†³è¿™äº›é—®é¢˜ã€‚ä¸ºäº†è¿˜æ”¯æŒè‡ªå®šä¹‰ window å®ç°ä¸åŒçš„é€»è¾‘ï¼ŒDataStream API ä¸ºå…¶çª—å£æœºåˆ¶æä¾›äº†æ¥å£ã€‚ ä¸‹å›¾æè¿°äº† Flink çš„çª—å£æœºåˆ¶ï¼Œå¹¶ä»‹ç»äº†æ‰€æ¶‰åŠçš„ç»„ä»¶ï¼š åˆ°è¾¾çª—å£æ“ä½œç¬¦çš„å…ƒç´ è¢«ä¼ é€’ç»™ WindowAssignerã€‚WindowAssigner å°†å…ƒç´ åˆ†é…ç»™ä¸€ä¸ªæˆ–å¤šä¸ªçª—å£ï¼Œå¯èƒ½ä¼šåˆ›å»ºæ–°çš„çª—å£ã€‚çª—å£æœ¬èº«åªæ˜¯å…ƒç´ åˆ—è¡¨çš„æ ‡è¯†ç¬¦ï¼Œå®ƒå¯èƒ½æä¾›ä¸€äº›å¯é€‰çš„å…ƒä¿¡æ¯ï¼Œä¾‹å¦‚ TimeWindow ä¸­çš„å¼€å§‹å’Œç»“æŸæ—¶é—´ã€‚æ³¨æ„ï¼Œå…ƒç´ å¯ä»¥è¢«æ·»åŠ åˆ°å¤šä¸ªçª—å£ï¼Œè¿™ä¹Ÿæ„å‘³ç€ä¸€ä¸ªå…ƒç´ å¯ä»¥åŒæ—¶åœ¨å¤šä¸ªçª—å£å­˜åœ¨ã€‚ æ¯ä¸ªçª—å£éƒ½æ‹¥æœ‰ä¸€ä¸ª Trigger(è§¦å‘å™¨)ï¼Œè¯¥ Trigger(è§¦å‘å™¨) å†³å®šä½•æ—¶è®¡ç®—å’Œæ¸…é™¤çª—å£ã€‚å½“å…ˆå‰æ³¨å†Œçš„è®¡æ—¶å™¨è¶…æ—¶æ—¶ï¼Œå°†ä¸ºæ’å…¥çª—å£çš„æ¯ä¸ªå…ƒç´ è°ƒç”¨è§¦å‘å™¨ã€‚åœ¨æ¯ä¸ªäº‹ä»¶ä¸Šï¼Œè§¦å‘å™¨éƒ½å¯ä»¥å†³å®šè§¦å‘(å³ã€æ¸…é™¤(åˆ é™¤çª—å£å¹¶ä¸¢å¼ƒå…¶å†…å®¹)ï¼Œæˆ–è€…å¯åŠ¨å¹¶æ¸…é™¤çª—å£ã€‚ä¸€ä¸ªçª—å£å¯ä»¥è¢«æ±‚å€¼å¤šæ¬¡ï¼Œå¹¶ä¸”åœ¨è¢«æ¸…é™¤ä¹‹å‰ä¸€ç›´å­˜åœ¨ã€‚æ³¨æ„ï¼Œåœ¨æ¸…é™¤çª—å£ä¹‹å‰ï¼Œçª—å£å°†ä¸€ç›´æ¶ˆè€—å†…å­˜ã€‚ å½“ Trigger(è§¦å‘å™¨) è§¦å‘æ—¶ï¼Œå¯ä»¥å°†çª—å£å…ƒç´ åˆ—è¡¨æä¾›ç»™å¯é€‰çš„ Evictorï¼ŒEvictor å¯ä»¥éå†çª—å£å…ƒç´ åˆ—è¡¨ï¼Œå¹¶å¯ä»¥å†³å®šä»åˆ—è¡¨çš„å¼€å¤´åˆ é™¤é¦–å…ˆè¿›å…¥çª—å£çš„ä¸€äº›å…ƒç´ ã€‚ç„¶åå…¶ä½™çš„å…ƒç´ è¢«èµ‹ç»™ä¸€ä¸ªè®¡ç®—å‡½æ•°ï¼Œå¦‚æœæ²¡æœ‰å®šä¹‰ Evictorï¼Œè§¦å‘å™¨ç›´æ¥å°†æ‰€æœ‰çª—å£å…ƒç´ äº¤ç»™è®¡ç®—å‡½æ•°ã€‚ è®¡ç®—å‡½æ•°æ¥æ”¶ Evictor è¿‡æ»¤åçš„çª—å£å…ƒç´ ï¼Œå¹¶è®¡ç®—çª—å£çš„ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ çš„ç»“æœã€‚ DataStream API æ¥å—ä¸åŒç±»å‹çš„è®¡ç®—å‡½æ•°ï¼ŒåŒ…æ‹¬é¢„å®šä¹‰çš„èšåˆå‡½æ•°ï¼Œå¦‚ sumï¼ˆï¼‰ï¼Œminï¼ˆï¼‰ï¼Œmaxï¼ˆï¼‰ï¼Œä»¥åŠ ReduceFunctionï¼ŒFoldFunction æˆ– WindowFunctionã€‚ è¿™äº›æ˜¯æ„æˆ Flink çª—å£æœºåˆ¶çš„ç»„ä»¶ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬é€æ­¥æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ DataStream API å®ç°è‡ªå®šä¹‰çª—å£é€»è¾‘ã€‚ æˆ‘ä»¬ä» DataStream [IN] ç±»å‹çš„æµå¼€å§‹ï¼Œå¹¶ä½¿ç”¨ key é€‰æ‹©å™¨å‡½æ•°å¯¹å…¶åˆ†ç»„ï¼Œè¯¥å‡½æ•°å°† key ç›¸åŒç±»å‹çš„æ•°æ®åˆ†ç»„åœ¨ä¸€å—ã€‚ 12SingleOutputStreamOperator&lt;xxx&gt; data = env.addSource(...);data.keyBy() å¦‚ä½•è‡ªå®šä¹‰ Windowï¼Ÿ1ã€Window Assigner è´Ÿè´£å°†å…ƒç´ åˆ†é…åˆ°ä¸åŒçš„ windowã€‚ Window API æä¾›äº†è‡ªå®šä¹‰çš„ WindowAssigner æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥å®ç° WindowAssigner çš„ 1public abstract Collection&lt;W&gt; assignWindows(T element, long timestamp) æ–¹æ³•ã€‚åŒæ—¶ï¼Œå¯¹äºåŸºäº Count çš„ window è€Œè¨€ï¼Œé»˜è®¤é‡‡ç”¨äº† GlobalWindow çš„ window assignerï¼Œä¾‹å¦‚ï¼š 1keyBy.window(GlobalWindows.create()) 2ã€Trigger Trigger å³è§¦å‘å™¨ï¼Œå®šä¹‰ä½•æ—¶æˆ–ä»€ä¹ˆæƒ…å†µä¸‹ç§»é™¤ window æˆ‘ä»¬å¯ä»¥æŒ‡å®šè§¦å‘å™¨æ¥è¦†ç›– WindowAssigner æä¾›çš„é»˜è®¤è§¦å‘å™¨ã€‚ è¯·æ³¨æ„ï¼ŒæŒ‡å®šçš„è§¦å‘å™¨ä¸ä¼šæ·»åŠ å…¶ä»–è§¦å‘æ¡ä»¶ï¼Œä½†ä¼šæ›¿æ¢å½“å‰è§¦å‘å™¨ã€‚ 3ã€Evictorï¼ˆå¯é€‰ï¼‰ é©±é€è€…ï¼Œå³ä¿ç•™ä¸Šä¸€ window ç•™ä¸‹çš„æŸäº›å…ƒç´  4ã€é€šè¿‡ apply WindowFunction æ¥è¿”å› DataStream ç±»å‹æ•°æ®ã€‚ åˆ©ç”¨ Flink çš„å†…éƒ¨çª—å£æœºåˆ¶å’Œ DataStream API å¯ä»¥å®ç°è‡ªå®šä¹‰çš„çª—å£é€»è¾‘ï¼Œä¾‹å¦‚ session windowã€‚ ç»“è®ºå¯¹äºç°ä»£æµå¤„ç†å™¨æ¥è¯´ï¼Œæ”¯æŒè¿ç»­æ•°æ®æµä¸Šçš„å„ç§ç±»å‹çš„çª—å£æ˜¯å¿…ä¸å¯å°‘çš„ã€‚ Apache Flink æ˜¯ä¸€ä¸ªå…·æœ‰å¼ºå¤§åŠŸèƒ½é›†çš„æµå¤„ç†å™¨ï¼ŒåŒ…æ‹¬ä¸€ä¸ªéå¸¸çµæ´»çš„æœºåˆ¶ï¼Œå¯ä»¥åœ¨è¿ç»­æ•°æ®æµä¸Šæ„å»ºçª—å£ã€‚ Flink ä¸ºå¸¸è§åœºæ™¯æä¾›å†…ç½®çš„çª—å£è¿ç®—ç¬¦ï¼Œä»¥åŠå…è®¸ç”¨æˆ·è‡ªå®šä¹‰çª—å£é€»è¾‘ã€‚ å‚è€ƒ1ã€https://flink.apache.org/news/2015/12/04/Introducing-windows.html 2ã€https://blog.csdn.net/lmalds/article/details/51604501 å…³æ³¨æˆ‘è½¬è½½è¯·åŠ¡å¿…æ³¨æ˜åŸåˆ›åœ°å€ä¸ºï¼šhttp://www.54tianzhisheng.cn/2018/12/08/Flink-Stream-Windows/ å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ ä¸“æ ä»‹ç»é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f Github ä»£ç ä»“åº“https://github.com/zhisheng17/flink-learning/ ä»¥åè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç éƒ½å°†æ”¾åœ¨è¿™ä¸ªä»“åº“é‡Œï¼ŒåŒ…å«äº†è‡ªå·±å­¦ä¹  flink çš„ä¸€äº› demo å’Œåšå®¢ åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€å®æˆ˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢)","date":"2018-11-03T16:00:00.000Z","path":"2018/11/04/Flink-Data-transformation/","text":"å‰è¨€åœ¨ç¬¬ä¸€ç¯‡ä»‹ç» Flink çš„æ–‡ç«  ã€Šã€Šä»0åˆ°1å­¦ä¹ Flinkã€‹â€”â€” Apache Flink ä»‹ç»ã€‹ ä¸­å°±è¯´è¿‡ Flink ç¨‹åºçš„ç»“æ„ Flink åº”ç”¨ç¨‹åºç»“æ„å°±æ˜¯å¦‚ä¸Šå›¾æ‰€ç¤ºï¼š 1ã€Source: æ•°æ®æºï¼ŒFlink åœ¨æµå¤„ç†å’Œæ‰¹å¤„ç†ä¸Šçš„ source å¤§æ¦‚æœ‰ 4 ç±»ï¼šåŸºäºæœ¬åœ°é›†åˆçš„ sourceã€åŸºäºæ–‡ä»¶çš„ sourceã€åŸºäºç½‘ç»œå¥—æ¥å­—çš„ sourceã€è‡ªå®šä¹‰çš„ sourceã€‚è‡ªå®šä¹‰çš„ source å¸¸è§çš„æœ‰ Apache kafkaã€Amazon Kinesis Streamsã€RabbitMQã€Twitter Streaming APIã€Apache NiFi ç­‰ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥å®šä¹‰è‡ªå·±çš„ sourceã€‚ 2ã€Transformationï¼šæ•°æ®è½¬æ¢çš„å„ç§æ“ä½œï¼Œæœ‰ Map / FlatMap / Filter / KeyBy / Reduce / Fold / Aggregations / Window / WindowAll / Union / Window join / Split / Select / Project ç­‰ï¼Œæ“ä½œå¾ˆå¤šï¼Œå¯ä»¥å°†æ•°æ®è½¬æ¢è®¡ç®—æˆä½ æƒ³è¦çš„æ•°æ®ã€‚ 3ã€Sinkï¼šæ¥æ”¶å™¨ï¼ŒFlink å°†è½¬æ¢è®¡ç®—åçš„æ•°æ®å‘é€çš„åœ°ç‚¹ ï¼Œä½ å¯èƒ½éœ€è¦å­˜å‚¨ä¸‹æ¥ï¼ŒFlink å¸¸è§çš„ Sink å¤§æ¦‚æœ‰å¦‚ä¸‹å‡ ç±»ï¼šå†™å…¥æ–‡ä»¶ã€æ‰“å°å‡ºæ¥ã€å†™å…¥ socket ã€è‡ªå®šä¹‰çš„ sink ã€‚è‡ªå®šä¹‰çš„ sink å¸¸è§çš„æœ‰ Apache kafkaã€RabbitMQã€MySQLã€ElasticSearchã€Apache Cassandraã€Hadoop FileSystem ç­‰ï¼ŒåŒç†ä½ ä¹Ÿå¯ä»¥å®šä¹‰è‡ªå·±çš„ Sinkã€‚ åœ¨ä¸Šå››ç¯‡æ–‡ç« ä»‹ç»äº† Source å’Œ Sinkï¼š 1ã€ã€Šä»0åˆ°1å­¦ä¹ Flinkã€‹â€”â€” Data Source ä»‹ç» 2ã€ã€Šä»0åˆ°1å­¦ä¹ Flinkã€‹â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 3ã€ã€Šä»0åˆ°1å­¦ä¹ Flinkã€‹â€”â€” Data Sink ä»‹ç» 4ã€ã€Šä»0åˆ°1å­¦ä¹ Flinkã€‹â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ é‚£ä¹ˆè¿™ç¯‡æ–‡ç« æˆ‘ä»¬å°±æ¥çœ‹ä¸‹ Flink Data Transformation å§ï¼Œæ•°æ®è½¬æ¢æ“ä½œè¿˜æ˜¯è›®å¤šçš„ï¼Œéœ€è¦å¥½å¥½è®²è®²ï¼ TransformationMapè¿™æ˜¯æœ€ç®€å•çš„è½¬æ¢ä¹‹ä¸€ï¼Œå…¶ä¸­è¾“å…¥æ˜¯ä¸€ä¸ªæ•°æ®æµï¼Œè¾“å‡ºçš„ä¹Ÿæ˜¯ä¸€ä¸ªæ•°æ®æµï¼š è¿˜æ˜¯æ‹¿ä¸Šä¸€ç¯‡æ–‡ç« çš„æ¡ˆä¾‹æ¥å°†æ•°æ®è¿›è¡Œ map è½¬æ¢æ“ä½œï¼š 123456789101112SingleOutputStreamOperator&lt;Student&gt; map = student.map(new MapFunction&lt;Student, Student&gt;() &#123; @Override public Student map(Student value) throws Exception &#123; Student s1 = new Student(); s1.id = value.id; s1.name = value.name; s1.password = value.password; s1.age = value.age + 5; return s1; &#125;&#125;);map.print(); å°†æ¯ä¸ªäººçš„å¹´é¾„éƒ½å¢åŠ  5 å²ï¼Œå…¶ä»–ä¸å˜ã€‚ FlatMapFlatMap é‡‡ç”¨ä¸€æ¡è®°å½•å¹¶è¾“å‡ºé›¶ä¸ªï¼Œä¸€ä¸ªæˆ–å¤šä¸ªè®°å½•ã€‚ 123456789SingleOutputStreamOperator&lt;Student&gt; flatMap = student.flatMap(new FlatMapFunction&lt;Student, Student&gt;() &#123; @Override public void flatMap(Student value, Collector&lt;Student&gt; out) throws Exception &#123; if (value.id % 2 == 0) &#123; out.collect(value); &#125; &#125;&#125;);flatMap.print(); è¿™é‡Œå°† id ä¸ºå¶æ•°çš„èšé›†å‡ºæ¥ã€‚ FilterFilter å‡½æ•°æ ¹æ®æ¡ä»¶åˆ¤æ–­å‡ºç»“æœã€‚ 12345678910SingleOutputStreamOperator&lt;Student&gt; filter = student.filter(new FilterFunction&lt;Student&gt;() &#123; @Override public boolean filter(Student value) throws Exception &#123; if (value.id &gt; 95) &#123; return true; &#125; return false; &#125;&#125;);filter.print(); è¿™é‡Œå°† id å¤§äº 95 çš„è¿‡æ»¤å‡ºæ¥ï¼Œç„¶åæ‰“å°å‡ºæ¥ã€‚ KeyByKeyBy åœ¨é€»è¾‘ä¸Šæ˜¯åŸºäº key å¯¹æµè¿›è¡Œåˆ†åŒºã€‚åœ¨å†…éƒ¨ï¼Œå®ƒä½¿ç”¨ hash å‡½æ•°å¯¹æµè¿›è¡Œåˆ†åŒºã€‚å®ƒè¿”å› KeyedDataStream æ•°æ®æµã€‚ 1234567KeyedStream&lt;Student, Integer&gt; keyBy = student.keyBy(new KeySelector&lt;Student, Integer&gt;() &#123; @Override public Integer getKey(Student value) throws Exception &#123; return value.age; &#125;&#125;);keyBy.print(); ä¸Šé¢å¯¹ student çš„ age åš KeyBy æ“ä½œåˆ†åŒº ReduceReduce è¿”å›å•ä¸ªçš„ç»“æœå€¼ï¼Œå¹¶ä¸” reduce æ“ä½œæ¯å¤„ç†ä¸€ä¸ªå…ƒç´ æ€»æ˜¯åˆ›å»ºä¸€ä¸ªæ–°å€¼ã€‚å¸¸ç”¨çš„æ–¹æ³•æœ‰ average, sum, min, max, countï¼Œä½¿ç”¨ reduce æ–¹æ³•éƒ½å¯å®ç°ã€‚ 1234567891011121314151617SingleOutputStreamOperator&lt;Student&gt; reduce = student.keyBy(new KeySelector&lt;Student, Integer&gt;() &#123; @Override public Integer getKey(Student value) throws Exception &#123; return value.age; &#125;&#125;).reduce(new ReduceFunction&lt;Student&gt;() &#123; @Override public Student reduce(Student value1, Student value2) throws Exception &#123; Student student1 = new Student(); student1.name = value1.name + value2.name; student1.id = (value1.id + value2.id) / 2; student1.password = value1.password + value2.password; student1.age = (value1.age + value2.age) / 2; return student1; &#125;&#125;);reduce.print(); ä¸Šé¢å…ˆå°†æ•°æ®æµè¿›è¡Œ keyby æ“ä½œï¼Œå› ä¸ºæ‰§è¡Œ reduce æ“ä½œåªèƒ½æ˜¯ KeyedStreamï¼Œç„¶åå°† student å¯¹è±¡çš„ age åšäº†ä¸€ä¸ªæ±‚å¹³å‡å€¼çš„æ“ä½œã€‚ FoldFold é€šè¿‡å°†æœ€åä¸€ä¸ªæ–‡ä»¶å¤¹æµä¸å½“å‰è®°å½•ç»„åˆæ¥æ¨å‡º KeyedStreamã€‚ å®ƒä¼šå‘å›æ•°æ®æµã€‚ 123456KeyedStream.fold(\"1\", new FoldFunction&lt;Integer, String&gt;() &#123; @Override public String fold(String accumulator, Integer value) throws Exception &#123; return accumulator + \"=\" + value; &#125;&#125;) AggregationsDataStream API æ”¯æŒå„ç§èšåˆï¼Œä¾‹å¦‚ minï¼Œmaxï¼Œsum ç­‰ã€‚ è¿™äº›å‡½æ•°å¯ä»¥åº”ç”¨äº KeyedStream ä»¥è·å¾— Aggregations èšåˆã€‚ 12345678910KeyedStream.sum(0) KeyedStream.sum(\"key\") KeyedStream.min(0) KeyedStream.min(\"key\") KeyedStream.max(0) KeyedStream.max(\"key\") KeyedStream.minBy(0) KeyedStream.minBy(\"key\") KeyedStream.maxBy(0) KeyedStream.maxBy(\"key\") max å’Œ maxBy ä¹‹é—´çš„åŒºåˆ«åœ¨äº max è¿”å›æµä¸­çš„æœ€å¤§å€¼ï¼Œä½† maxBy è¿”å›å…·æœ‰æœ€å¤§å€¼çš„é”®ï¼Œ min å’Œ minBy åŒç†ã€‚ WindowWindow å‡½æ•°å…è®¸æŒ‰æ—¶é—´æˆ–å…¶ä»–æ¡ä»¶å¯¹ç°æœ‰ KeyedStream è¿›è¡Œåˆ†ç»„ã€‚ ä»¥ä¸‹æ˜¯ä»¥ 10 ç§’çš„æ—¶é—´çª—å£èšåˆï¼š 1inputStream.keyBy(0).window(Time.seconds(10)); Flink å®šä¹‰æ•°æ®ç‰‡æ®µä»¥ä¾¿ï¼ˆå¯èƒ½ï¼‰å¤„ç†æ— é™æ•°æ®æµã€‚ è¿™äº›åˆ‡ç‰‡ç§°ä¸ºçª—å£ã€‚ æ­¤åˆ‡ç‰‡æœ‰åŠ©äºé€šè¿‡åº”ç”¨è½¬æ¢å¤„ç†æ•°æ®å—ã€‚ è¦å¯¹æµè¿›è¡Œçª—å£åŒ–ï¼Œæˆ‘ä»¬éœ€è¦åˆ†é…ä¸€ä¸ªå¯ä»¥è¿›è¡Œåˆ†å‘çš„é”®å’Œä¸€ä¸ªæè¿°è¦å¯¹çª—å£åŒ–æµæ‰§è¡Œå“ªäº›è½¬æ¢çš„å‡½æ•° è¦å°†æµåˆ‡ç‰‡åˆ°çª—å£ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Flink è‡ªå¸¦çš„çª—å£åˆ†é…å™¨ã€‚ æˆ‘ä»¬æœ‰é€‰é¡¹ï¼Œå¦‚ tumbling windows, sliding windows, global å’Œ session windowsã€‚ Flink è¿˜å…è®¸æ‚¨é€šè¿‡æ‰©å±• WindowAssginer ç±»æ¥ç¼–å†™è‡ªå®šä¹‰çª—å£åˆ†é…å™¨ã€‚ è¿™é‡Œå…ˆé¢„ç•™ä¸‹ç¯‡æ–‡ç« æ¥è®²è§£è¿™äº›ä¸åŒçš„ windows æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚ WindowAllwindowAll å‡½æ•°å…è®¸å¯¹å¸¸è§„æ•°æ®æµè¿›è¡Œåˆ†ç»„ã€‚ é€šå¸¸ï¼Œè¿™æ˜¯éå¹¶è¡Œæ•°æ®è½¬æ¢ï¼Œå› ä¸ºå®ƒåœ¨éåˆ†åŒºæ•°æ®æµä¸Šè¿è¡Œã€‚ ä¸å¸¸è§„æ•°æ®æµåŠŸèƒ½ç±»ä¼¼ï¼Œæˆ‘ä»¬ä¹Ÿæœ‰çª—å£æ•°æ®æµåŠŸèƒ½ã€‚ å”¯ä¸€çš„åŒºåˆ«æ˜¯å®ƒä»¬å¤„ç†çª—å£æ•°æ®æµã€‚ æ‰€ä»¥çª—å£ç¼©å°å°±åƒ Reduce å‡½æ•°ä¸€æ ·ï¼ŒWindow fold å°±åƒ Fold å‡½æ•°ä¸€æ ·ï¼Œå¹¶ä¸”è¿˜æœ‰èšåˆã€‚ 1inputStream.keyBy(0).windowAll(Time.seconds(10)); UnionUnion å‡½æ•°å°†ä¸¤ä¸ªæˆ–å¤šä¸ªæ•°æ®æµç»“åˆåœ¨ä¸€èµ·ã€‚ è¿™æ ·å°±å¯ä»¥å¹¶è¡Œåœ°ç»„åˆæ•°æ®æµã€‚ å¦‚æœæˆ‘ä»¬å°†ä¸€ä¸ªæµä¸è‡ªèº«ç»„åˆï¼Œé‚£ä¹ˆå®ƒä¼šè¾“å‡ºæ¯ä¸ªè®°å½•ä¸¤æ¬¡ã€‚ 1inputStream.union(inputStream1, inputStream2, ...); Window joinæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€äº› key å°†åŒä¸€ä¸ª window çš„ä¸¤ä¸ªæ•°æ®æµ join èµ·æ¥ã€‚ 1234inputStream.join(inputStream1) .where(0).equalTo(1) .window(Time.seconds(5)) .apply (new JoinFunction () &#123;...&#125;); ä»¥ä¸Šç¤ºä¾‹æ˜¯åœ¨ 5 ç§’çš„çª—å£ä¸­è¿æ¥ä¸¤ä¸ªæµï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªæµçš„ç¬¬ä¸€ä¸ªå±æ€§çš„è¿æ¥æ¡ä»¶ç­‰äºå¦ä¸€ä¸ªæµçš„ç¬¬äºŒä¸ªå±æ€§ã€‚ Splitæ­¤åŠŸèƒ½æ ¹æ®æ¡ä»¶å°†æµæ‹†åˆ†ä¸ºä¸¤ä¸ªæˆ–å¤šä¸ªæµã€‚ å½“æ‚¨è·å¾—æ··åˆæµå¹¶ä¸”æ‚¨å¯èƒ½å¸Œæœ›å•ç‹¬å¤„ç†æ¯ä¸ªæ•°æ®æµæ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ­¤æ–¹æ³•ã€‚ 12345678910111213SplitStream&lt;Integer&gt; split = inputStream.split(new OutputSelector&lt;Integer&gt;() &#123; @Override public Iterable&lt;String&gt; select(Integer value) &#123; List&lt;String&gt; output = new ArrayList&lt;String&gt;(); if (value % 2 == 0) &#123; output.add(\"even\"); &#125; else &#123; output.add(\"odd\"); &#125; return output; &#125;&#125;); Selectæ­¤åŠŸèƒ½å…è®¸æ‚¨ä»æ‹†åˆ†æµä¸­é€‰æ‹©ç‰¹å®šæµã€‚ 1234SplitStream&lt;Integer&gt; split;DataStream&lt;Integer&gt; even = split.select(\"even\"); DataStream&lt;Integer&gt; odd = split.select(\"odd\"); DataStream&lt;Integer&gt; all = split.select(\"even\",\"odd\"); ProjectProject å‡½æ•°å…è®¸æ‚¨ä»äº‹ä»¶æµä¸­é€‰æ‹©å±æ€§å­é›†ï¼Œå¹¶ä»…å°†æ‰€é€‰å…ƒç´ å‘é€åˆ°ä¸‹ä¸€ä¸ªå¤„ç†æµã€‚ 12DataStream&lt;Tuple4&lt;Integer, Double, String, String&gt;&gt; in = // [...] DataStream&lt;Tuple2&lt;String, String&gt;&gt; out = in.project(3,2); ä¸Šè¿°å‡½æ•°ä»ç»™å®šè®°å½•ä¸­é€‰æ‹©å±æ€§å· 2 å’Œ 3ã€‚ ä»¥ä¸‹æ˜¯ç¤ºä¾‹è¾“å…¥å’Œè¾“å‡ºè®°å½•ï¼š 12(1,10.0,A,B)=&gt; (B,A)(2,20.0,C,D)=&gt; (D,C) æœ€åæœ¬æ–‡ä¸»è¦ä»‹ç»äº† Flink Data çš„å¸¸ç”¨è½¬æ¢æ–¹å¼ï¼šMapã€FlatMapã€Filterã€KeyByã€Reduceã€Foldã€Aggregationsã€Windowã€WindowAllã€Unionã€Window Joinã€Splitã€Selectã€Project ç­‰ã€‚å¹¶ç”¨äº†ç‚¹ç®€å•çš„ demo ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ï¼Œå…·ä½“åœ¨é¡¹ç›®ä¸­è¯¥å¦‚ä½•å°†æ•°æ®æµè½¬æ¢æˆæˆ‘ä»¬æƒ³è¦çš„æ ¼å¼ï¼Œè¿˜éœ€è¦æ ¹æ®å®é™…æƒ…å†µå¯¹å¾…ã€‚ å…³æ³¨æˆ‘è½¬è½½è¯·åŠ¡å¿…æ³¨æ˜åŸåˆ›åœ°å€ä¸ºï¼šhttp://www.54tianzhisheng.cn/2018/11/04/Flink-Data-transformation/ å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ Github ä»£ç ä»“åº“https://github.com/zhisheng17/flink-learning/ ä»¥åè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç éƒ½å°†æ”¾åœ¨è¿™ä¸ªä»“åº“é‡Œï¼ŒåŒ…å«äº†è‡ªå·±å­¦ä¹  flink çš„ä¸€äº› demo å’Œåšå®¢ åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€å®æˆ˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ","date":"2018-10-30T16:00:00.000Z","path":"2018/10/31/flink-create-sink/","text":"å‰è¨€å‰ç¯‡æ–‡ç«  ã€Šä»0åˆ°1å­¦ä¹ Flinkã€‹â€”â€” Data Sink ä»‹ç» ä»‹ç»äº† Flink Data Sinkï¼Œä¹Ÿä»‹ç»äº† Flink è‡ªå¸¦çš„ Sinkï¼Œé‚£ä¹ˆå¦‚ä½•è‡ªå®šä¹‰è‡ªå·±çš„ Sink å‘¢ï¼Ÿè¿™ç¯‡æ–‡ç« å°†å†™ä¸€ä¸ª demo æ•™å¤§å®¶å°†ä» Kafka Source çš„æ•°æ® Sink åˆ° MySQL ä¸­å»ã€‚ å‡†å¤‡å·¥ä½œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ Flink ä» Kafka topic ä¸­è·å–æ•°æ®çš„ demoï¼Œé¦–å…ˆä½ éœ€è¦å®‰è£…å¥½äº† FLink å’Œ Kafka ã€‚ è¿è¡Œå¯åŠ¨ Flinkã€Zookepeerã€Kafkaï¼Œ å¥½äº†ï¼Œéƒ½å¯åŠ¨äº†ï¼ æ•°æ®åº“å»ºè¡¨12345678DROP TABLE IF EXISTS `student`;CREATE TABLE `student` ( `id` int(11) unsigned NOT NULL AUTO_INCREMENT, `name` varchar(25) COLLATE utf8_bin DEFAULT NULL, `password` varchar(25) COLLATE utf8_bin DEFAULT NULL, `age` int(10) DEFAULT NULL, PRIMARY KEY (`id`)) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8 COLLATE=utf8_bin; å®ä½“ç±»Student.java 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465package com.zhisheng.flink.model;/** * Desc: * weixin: zhisheng_tian * blog: http://www.54tianzhisheng.cn/ */public class Student &#123; public int id; public String name; public String password; public int age; public Student() &#123; &#125; public Student(int id, String name, String password, int age) &#123; this.id = id; this.name = name; this.password = password; this.age = age; &#125; @Override public String toString() &#123; return \"Student&#123;\" + \"id=\" + id + \", name='\" + name + '\\'' + \", password='\" + password + '\\'' + \", age=\" + age + '&#125;'; &#125; public int getId() &#123; return id; &#125; public void setId(int id) &#123; this.id = id; &#125; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; public String getPassword() &#123; return password; &#125; public void setPassword(String password) &#123; this.password = password; &#125; public int getAge() &#123; return age; &#125; public void setAge(int age) &#123; this.age = age; &#125;&#125; å·¥å…·ç±»å·¥å…·ç±»å¾€ kafka topic student å‘é€æ•°æ® 12345678910111213141516171819202122232425262728293031323334353637383940import com.alibaba.fastjson.JSON;import com.zhisheng.flink.model.Metric;import com.zhisheng.flink.model.Student;import org.apache.kafka.clients.producer.KafkaProducer;import org.apache.kafka.clients.producer.ProducerRecord;import java.util.HashMap;import java.util.Map;import java.util.Properties;/** * å¾€kafkaä¸­å†™æ•°æ® * å¯ä»¥ä½¿ç”¨è¿™ä¸ªmainå‡½æ•°è¿›è¡Œæµ‹è¯•ä¸€ä¸‹ * weixin: zhisheng_tian * blog: http://www.54tianzhisheng.cn/ */public class KafkaUtils2 &#123; public static final String broker_list = \"localhost:9092\"; public static final String topic = \"student\"; //kafka topic éœ€è¦å’Œ flink ç¨‹åºç”¨åŒä¸€ä¸ª topic public static void writeToKafka() throws InterruptedException &#123; Properties props = new Properties(); props.put(\"bootstrap.servers\", broker_list); props.put(\"key.serializer\", \"org.apache.kafka.common.serialization.StringSerializer\"); props.put(\"value.serializer\", \"org.apache.kafka.common.serialization.StringSerializer\"); KafkaProducer producer = new KafkaProducer&lt;String, String&gt;(props); for (int i = 1; i &lt;= 100; i++) &#123; Student student = new Student(i, \"zhisheng\" + i, \"password\" + i, 18 + i); ProducerRecord record = new ProducerRecord&lt;String, String&gt;(topic, null, null, JSON.toJSONString(student)); producer.send(record); System.out.println(\"å‘é€æ•°æ®: \" + JSON.toJSONString(student)); &#125; producer.flush(); &#125; public static void main(String[] args) throws InterruptedException &#123; writeToKafka(); &#125;&#125; SinkToMySQLè¯¥ç±»å°±æ˜¯ Sink Functionï¼Œç»§æ‰¿äº† RichSinkFunction ï¼Œç„¶åé‡å†™äº†é‡Œé¢çš„æ–¹æ³•ã€‚åœ¨ invoke æ–¹æ³•ä¸­å°†æ•°æ®æ’å…¥åˆ° MySQL ä¸­ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273package com.zhisheng.flink.sink;import com.zhisheng.flink.model.Student;import org.apache.flink.configuration.Configuration;import org.apache.flink.streaming.api.functions.sink.RichSinkFunction;import java.sql.Connection;import java.sql.DriverManager;import java.sql.PreparedStatement;/** * Desc: * weixin: zhisheng_tian * blog: http://www.54tianzhisheng.cn/ */public class SinkToMySQL extends RichSinkFunction&lt;Student&gt; &#123; PreparedStatement ps; private Connection connection; /** * open() æ–¹æ³•ä¸­å»ºç«‹è¿æ¥ï¼Œè¿™æ ·ä¸ç”¨æ¯æ¬¡ invoke çš„æ—¶å€™éƒ½è¦å»ºç«‹è¿æ¥å’Œé‡Šæ”¾è¿æ¥ * * @param parameters * @throws Exception */ @Override public void open(Configuration parameters) throws Exception &#123; super.open(parameters); connection = getConnection(); String sql = \"insert into Student(id, name, password, age) values(?, ?, ?, ?);\"; ps = this.connection.prepareStatement(sql); &#125; @Override public void close() throws Exception &#123; super.close(); //å…³é—­è¿æ¥å’Œé‡Šæ”¾èµ„æº if (connection != null) &#123; connection.close(); &#125; if (ps != null) &#123; ps.close(); &#125; &#125; /** * æ¯æ¡æ•°æ®çš„æ’å…¥éƒ½è¦è°ƒç”¨ä¸€æ¬¡ invoke() æ–¹æ³• * * @param value * @param context * @throws Exception */ @Override public void invoke(Student value, Context context) throws Exception &#123; //ç»„è£…æ•°æ®ï¼Œæ‰§è¡Œæ’å…¥æ“ä½œ ps.setInt(1, value.getId()); ps.setString(2, value.getName()); ps.setString(3, value.getPassword()); ps.setInt(4, value.getAge()); ps.executeUpdate(); &#125; private static Connection getConnection() &#123; Connection con = null; try &#123; Class.forName(\"com.mysql.jdbc.Driver\"); con = DriverManager.getConnection(\"jdbc:mysql://localhost:3306/test?useUnicode=true&amp;characterEncoding=UTF-8\", \"root\", \"root123456\"); &#125; catch (Exception e) &#123; System.out.println(\"-----------mysql get connection has exception , msg = \"+ e.getMessage()); &#125; return con; &#125;&#125; Flink ç¨‹åºè¿™é‡Œçš„ source æ˜¯ä» kafka è¯»å–æ•°æ®çš„ï¼Œç„¶å Flink ä» Kafka è¯»å–åˆ°æ•°æ®ï¼ˆJSONï¼‰åç”¨é˜¿é‡Œ fastjson æ¥è§£ææˆ student å¯¹è±¡ï¼Œç„¶ååœ¨ addSink ä¸­ä½¿ç”¨æˆ‘ä»¬åˆ›å»ºçš„ SinkToMySQLï¼Œè¿™æ ·å°±å¯ä»¥æŠŠæ•°æ®å­˜å‚¨åˆ° MySQL äº†ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243package com.zhisheng.flink;import com.alibaba.fastjson.JSON;import com.zhisheng.flink.model.Student;import com.zhisheng.flink.sink.SinkToMySQL;import org.apache.flink.api.common.serialization.SimpleStringSchema;import org.apache.flink.streaming.api.datastream.DataStreamSource;import org.apache.flink.streaming.api.datastream.SingleOutputStreamOperator;import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;import org.apache.flink.streaming.api.functions.sink.PrintSinkFunction;import org.apache.flink.streaming.connectors.kafka.FlinkKafkaConsumer011;import org.apache.flink.streaming.connectors.kafka.FlinkKafkaProducer011;import java.util.Properties;/** * Desc: * weixin: zhisheng_tian * blog: http://www.54tianzhisheng.cn/ */public class Main3 &#123; public static void main(String[] args) throws Exception &#123; final StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment(); Properties props = new Properties(); props.put(\"bootstrap.servers\", \"localhost:9092\"); props.put(\"zookeeper.connect\", \"localhost:2181\"); props.put(\"group.id\", \"metric-group\"); props.put(\"key.deserializer\", \"org.apache.kafka.common.serialization.StringDeserializer\"); props.put(\"value.deserializer\", \"org.apache.kafka.common.serialization.StringDeserializer\"); props.put(\"auto.offset.reset\", \"latest\"); SingleOutputStreamOperator&lt;Student&gt; student = env.addSource(new FlinkKafkaConsumer011&lt;&gt;( \"student\", //è¿™ä¸ª kafka topic éœ€è¦å’Œä¸Šé¢çš„å·¥å…·ç±»çš„ topic ä¸€è‡´ new SimpleStringSchema(), props)).setParallelism(1) .map(string -&gt; JSON.parseObject(string, Student.class)); //Fastjson è§£æå­—ç¬¦ä¸²æˆ student å¯¹è±¡ student.addSink(new SinkToMySQL()); //æ•°æ® sink åˆ° mysql env.execute(\"Flink add sink\"); &#125;&#125; ç»“æœè¿è¡Œ Flink ç¨‹åºï¼Œç„¶åå†è¿è¡Œ KafkaUtils2.java å·¥å…·ç±»ï¼Œè¿™æ ·å°±å¯ä»¥äº†ã€‚ å¦‚æœæ•°æ®æ’å…¥æˆåŠŸäº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬æŸ¥çœ‹ä¸‹æˆ‘ä»¬çš„æ•°æ®åº“ï¼š æ•°æ®åº“ä¸­å·²ç»æ’å…¥äº† 100 æ¡æˆ‘ä»¬ä» Kafka å‘é€çš„æ•°æ®äº†ã€‚è¯æ˜æˆ‘ä»¬çš„ SinkToMySQL èµ·ä½œç”¨äº†ã€‚æ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Ÿ é¡¹ç›®ç»“æ„æ€•å¤§å®¶ä¸çŸ¥é“æˆ‘çš„é¡¹ç›®ç»“æ„ï¼Œè¿™é‡Œå‘ä¸ªæˆªå›¾çœ‹ä¸‹ï¼š æœ€åæœ¬æ–‡ä¸»è¦åˆ©ç”¨ä¸€ä¸ª demoï¼Œå‘Šè¯‰å¤§å®¶å¦‚ä½•è‡ªå®šä¹‰ Sink Functionï¼Œå°†ä» Kafka çš„æ•°æ® Sink åˆ° MySQL ä¸­ï¼Œå¦‚æœä½ é¡¹ç›®ä¸­æœ‰å…¶ä»–çš„æ•°æ®æ¥æºï¼Œä½ ä¹Ÿå¯ä»¥æ¢æˆå¯¹åº”çš„ Sourceï¼Œä¹Ÿæœ‰å¯èƒ½ä½ çš„ Sink æ˜¯åˆ°å…¶ä»–çš„åœ°æ–¹æˆ–è€…å…¶ä»–ä¸åŒçš„æ–¹å¼ï¼Œé‚£ä¹ˆä¾æ—§æ˜¯è¿™ä¸ªå¥—è·¯ï¼šç»§æ‰¿ RichSinkFunction æŠ½è±¡ç±»ï¼Œé‡å†™ invoke æ–¹æ³•ã€‚ å…³æ³¨æˆ‘è½¬è½½è¯·åŠ¡å¿…æ³¨æ˜åŸåˆ›åœ°å€ä¸ºï¼šhttp://www.54tianzhisheng.cn/2018/10/31/flink-create-sink/ å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ Github ä»£ç ä»“åº“https://github.com/zhisheng17/flink-learning/ ä»¥åè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç éƒ½å°†æ”¾åœ¨è¿™ä¸ªä»“åº“é‡Œï¼ŒåŒ…å«äº†è‡ªå·±å­¦ä¹  flink çš„ä¸€äº› demo å’Œåšå®¢ åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€å®æˆ˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ","date":"2018-10-29T16:00:00.000Z","path":"2018/10/30/flink-create-source/","text":"å‰è¨€åœ¨ ã€Šä»0åˆ°1å­¦ä¹ Flinkã€‹â€”â€” Data Source ä»‹ç» æ–‡ç« ä¸­ï¼Œæˆ‘ç»™å¤§å®¶ä»‹ç»äº† Flink Data Source ä»¥åŠç®€çŸ­çš„ä»‹ç»äº†ä¸€ä¸‹è‡ªå®šä¹‰ Data Sourceï¼Œè¿™ç¯‡æ–‡ç« æ›´è¯¦ç»†çš„ä»‹ç»ä¸‹ï¼Œå¹¶å†™ä¸€ä¸ª demo å‡ºæ¥è®©å¤§å®¶ç†è§£ã€‚ Flink Kafka sourceå‡†å¤‡å·¥ä½œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ Flink ä» Kafka topic ä¸­è·å–æ•°æ®çš„ demoï¼Œé¦–å…ˆä½ éœ€è¦å®‰è£…å¥½äº† FLink å’Œ Kafka ã€‚ è¿è¡Œå¯åŠ¨ Flinkã€Zookepeerã€Kafkaï¼Œ å¥½äº†ï¼Œéƒ½å¯åŠ¨äº†ï¼ maven ä¾èµ–1234567891011121314151617181920212223242526272829303132333435363738&lt;!--flink java--&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-java&lt;/artifactId&gt; &lt;version&gt;$&#123;flink.version&#125;&lt;/version&gt; &lt;scope&gt;provided&lt;/scope&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-streaming-java_$&#123;scala.binary.version&#125;&lt;/artifactId&gt; &lt;version&gt;$&#123;flink.version&#125;&lt;/version&gt; &lt;scope&gt;provided&lt;/scope&gt;&lt;/dependency&gt;&lt;!--æ—¥å¿—--&gt;&lt;dependency&gt; &lt;groupId&gt;org.slf4j&lt;/groupId&gt; &lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt; &lt;version&gt;1.7.7&lt;/version&gt; &lt;scope&gt;runtime&lt;/scope&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;log4j&lt;/groupId&gt; &lt;artifactId&gt;log4j&lt;/artifactId&gt; &lt;version&gt;1.2.17&lt;/version&gt; &lt;scope&gt;runtime&lt;/scope&gt;&lt;/dependency&gt;&lt;!--flink kafka connector--&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-connector-kafka-0.11_$&#123;scala.binary.version&#125;&lt;/artifactId&gt; &lt;version&gt;$&#123;flink.version&#125;&lt;/version&gt;&lt;/dependency&gt;&lt;!--alibaba fastjson--&gt;&lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;fastjson&lt;/artifactId&gt; &lt;version&gt;1.2.51&lt;/version&gt;&lt;/dependency&gt; æµ‹è¯•å‘é€æ•°æ®åˆ° kafka topicå®ä½“ç±»ï¼ŒMetric.java 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667package com.zhisheng.flink.model;import java.util.Map;/** * Desc: * weixi: zhisheng_tian * blog: http://www.54tianzhisheng.cn/ */public class Metric &#123; public String name; public long timestamp; public Map&lt;String, Object&gt; fields; public Map&lt;String, String&gt; tags; public Metric() &#123; &#125; public Metric(String name, long timestamp, Map&lt;String, Object&gt; fields, Map&lt;String, String&gt; tags) &#123; this.name = name; this.timestamp = timestamp; this.fields = fields; this.tags = tags; &#125; @Override public String toString() &#123; return \"Metric&#123;\" + \"name='\" + name + '\\'' + \", timestamp='\" + timestamp + '\\'' + \", fields=\" + fields + \", tags=\" + tags + '&#125;'; &#125; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; public long getTimestamp() &#123; return timestamp; &#125; public void setTimestamp(long timestamp) &#123; this.timestamp = timestamp; &#125; public Map&lt;String, Object&gt; getFields() &#123; return fields; &#125; public void setFields(Map&lt;String, Object&gt; fields) &#123; this.fields = fields; &#125; public Map&lt;String, String&gt; getTags() &#123; return tags; &#125; public void setTags(Map&lt;String, String&gt; tags) &#123; this.tags = tags; &#125;&#125; å¾€ kafka ä¸­å†™æ•°æ®å·¥å…·ç±»ï¼šKafkaUtils.java 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657import com.alibaba.fastjson.JSON;import com.zhisheng.flink.model.Metric;import org.apache.kafka.clients.producer.KafkaProducer;import org.apache.kafka.clients.producer.ProducerRecord;import java.util.HashMap;import java.util.Map;import java.util.Properties;/** * å¾€kafkaä¸­å†™æ•°æ® * å¯ä»¥ä½¿ç”¨è¿™ä¸ªmainå‡½æ•°è¿›è¡Œæµ‹è¯•ä¸€ä¸‹ * weixin: zhisheng_tian * blog: http://www.54tianzhisheng.cn/ */public class KafkaUtils &#123; public static final String broker_list = \"localhost:9092\"; public static final String topic = \"metric\"; // kafka topicï¼ŒFlink ç¨‹åºä¸­éœ€è¦å’Œè¿™ä¸ªç»Ÿä¸€ public static void writeToKafka() throws InterruptedException &#123; Properties props = new Properties(); props.put(\"bootstrap.servers\", broker_list); props.put(\"key.serializer\", \"org.apache.kafka.common.serialization.StringSerializer\"); //key åºåˆ—åŒ– props.put(\"value.serializer\", \"org.apache.kafka.common.serialization.StringSerializer\"); //value åºåˆ—åŒ– KafkaProducer producer = new KafkaProducer&lt;String, String&gt;(props); Metric metric = new Metric(); metric.setTimestamp(System.currentTimeMillis()); metric.setName(\"mem\"); Map&lt;String, String&gt; tags = new HashMap&lt;&gt;(); Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;(); tags.put(\"cluster\", \"zhisheng\"); tags.put(\"host_ip\", \"101.147.022.106\"); fields.put(\"used_percent\", 90d); fields.put(\"max\", 27244873d); fields.put(\"used\", 17244873d); fields.put(\"init\", 27244873d); metric.setTags(tags); metric.setFields(fields); ProducerRecord record = new ProducerRecord&lt;String, String&gt;(topic, null, null, JSON.toJSONString(metric)); producer.send(record); System.out.println(\"å‘é€æ•°æ®: \" + JSON.toJSONString(metric)); producer.flush(); &#125; public static void main(String[] args) throws InterruptedException &#123; while (true) &#123; Thread.sleep(300); writeToKafka(); &#125; &#125;&#125; è¿è¡Œï¼š å¦‚æœå‡ºç°å¦‚ä¸Šå›¾æ ‡è®°çš„ï¼Œå³ä»£è¡¨èƒ½å¤Ÿä¸æ–­çš„å¾€ kafka å‘é€æ•°æ®çš„ã€‚ Flink ç¨‹åºMain.java 123456789101112131415161718192021222324252627282930313233343536package com.zhisheng.flink;import org.apache.flink.api.common.serialization.SimpleStringSchema;import org.apache.flink.streaming.api.datastream.DataStreamSource;import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;import org.apache.flink.streaming.connectors.kafka.FlinkKafkaConsumer011;import java.util.Properties;/** * Desc: * weixi: zhisheng_tian * blog: http://www.54tianzhisheng.cn/ */public class Main &#123; public static void main(String[] args) throws Exception &#123; final StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment(); Properties props = new Properties(); props.put(\"bootstrap.servers\", \"localhost:9092\"); props.put(\"zookeeper.connect\", \"localhost:2181\"); props.put(\"group.id\", \"metric-group\"); props.put(\"key.deserializer\", \"org.apache.kafka.common.serialization.StringDeserializer\"); //key ååºåˆ—åŒ– props.put(\"value.deserializer\", \"org.apache.kafka.common.serialization.StringDeserializer\"); props.put(\"auto.offset.reset\", \"latest\"); //value ååºåˆ—åŒ– DataStreamSource&lt;String&gt; dataStreamSource = env.addSource(new FlinkKafkaConsumer011&lt;&gt;( \"metric\", //kafka topic new SimpleStringSchema(), // String åºåˆ—åŒ– props)).setParallelism(1); dataStreamSource.print(); //æŠŠä» kafka è¯»å–åˆ°çš„æ•°æ®æ‰“å°åœ¨æ§åˆ¶å° env.execute(\"Flink add data source\"); &#125;&#125; è¿è¡Œèµ·æ¥ï¼š çœ‹åˆ°æ²¡ç¨‹åºï¼ŒFlink ç¨‹åºæ§åˆ¶å°èƒ½å¤Ÿæºæºä¸æ–­çš„æ‰“å°æ•°æ®å‘¢ã€‚ è‡ªå®šä¹‰ Sourceä¸Šé¢å°±æ˜¯ Flink è‡ªå¸¦çš„ Kafka sourceï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±æ¨¡ä»¿ç€å†™ä¸€ä¸ªä» MySQL ä¸­è¯»å–æ•°æ®çš„ Sourceã€‚ é¦–å…ˆ pom.xml ä¸­æ·»åŠ  MySQL ä¾èµ–ï¼š 12345&lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;5.1.34&lt;/version&gt;&lt;/dependency&gt; æ•°æ®åº“å»ºè¡¨å¦‚ä¸‹ï¼š 12345678DROP TABLE IF EXISTS `student`;CREATE TABLE `student` ( `id` int(11) unsigned NOT NULL AUTO_INCREMENT, `name` varchar(25) COLLATE utf8_bin DEFAULT NULL, `password` varchar(25) COLLATE utf8_bin DEFAULT NULL, `age` int(10) DEFAULT NULL, PRIMARY KEY (`id`)) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8 COLLATE=utf8_bin; æ’å…¥æ•°æ®ï¼š 12INSERT INTO `student` VALUES ('1', 'zhisheng01', '123456', '18'), ('2', 'zhisheng02', '123', '17'), ('3', 'zhisheng03', '1234', '18'), ('4', 'zhisheng04', '12345', '16');COMMIT; æ–°å»ºå®ä½“ç±»ï¼šStudent.java 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465package com.zhisheng.flink.model;/** * Desc: * weixi: zhisheng_tian * blog: http://www.54tianzhisheng.cn/ */public class Student &#123; public int id; public String name; public String password; public int age; public Student() &#123; &#125; public Student(int id, String name, String password, int age) &#123; this.id = id; this.name = name; this.password = password; this.age = age; &#125; @Override public String toString() &#123; return \"Student&#123;\" + \"id=\" + id + \", name='\" + name + '\\'' + \", password='\" + password + '\\'' + \", age=\" + age + '&#125;'; &#125; public int getId() &#123; return id; &#125; public void setId(int id) &#123; this.id = id; &#125; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; public String getPassword() &#123; return password; &#125; public void setPassword(String password) &#123; this.password = password; &#125; public int getAge() &#123; return age; &#125; public void setAge(int age) &#123; this.age = age; &#125;&#125; æ–°å»º Source ç±» SourceFromMySQL.javaï¼Œè¯¥ç±»ç»§æ‰¿ RichSourceFunction ï¼Œå®ç°é‡Œé¢çš„ openã€closeã€runã€cancel æ–¹æ³•ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586 package com.zhisheng.flink.source;import com.zhisheng.flink.model.Student;import org.apache.flink.configuration.Configuration;import org.apache.flink.streaming.api.functions.source.RichSourceFunction;import java.sql.Connection;import java.sql.DriverManager;import java.sql.PreparedStatement;import java.sql.ResultSet;/** * Desc: * weixi: zhisheng_tian * blog: http://www.54tianzhisheng.cn/ */public class SourceFromMySQL extends RichSourceFunction&lt;Student&gt; &#123; PreparedStatement ps; private Connection connection; /** * open() æ–¹æ³•ä¸­å»ºç«‹è¿æ¥ï¼Œè¿™æ ·ä¸ç”¨æ¯æ¬¡ invoke çš„æ—¶å€™éƒ½è¦å»ºç«‹è¿æ¥å’Œé‡Šæ”¾è¿æ¥ã€‚ * * @param parameters * @throws Exception */ @Override public void open(Configuration parameters) throws Exception &#123; super.open(parameters); connection = getConnection(); String sql = \"select * from Student;\"; ps = this.connection.prepareStatement(sql); &#125; /** * ç¨‹åºæ‰§è¡Œå®Œæ¯•å°±å¯ä»¥è¿›è¡Œï¼Œå…³é—­è¿æ¥å’Œé‡Šæ”¾èµ„æºçš„åŠ¨ä½œäº† * * @throws Exception */ @Override public void close() throws Exception &#123; super.close(); if (connection != null) &#123; //å…³é—­è¿æ¥å’Œé‡Šæ”¾èµ„æº connection.close(); &#125; if (ps != null) &#123; ps.close(); &#125; &#125; /** * DataStream è°ƒç”¨ä¸€æ¬¡ run() æ–¹æ³•ç”¨æ¥è·å–æ•°æ® * * @param ctx * @throws Exception */ @Override public void run(SourceContext&lt;Student&gt; ctx) throws Exception &#123; ResultSet resultSet = ps.executeQuery(); while (resultSet.next()) &#123; Student student = new Student( resultSet.getInt(\"id\"), resultSet.getString(\"name\").trim(), resultSet.getString(\"password\").trim(), resultSet.getInt(\"age\")); ctx.collect(student); &#125; &#125; @Override public void cancel() &#123; &#125; private static Connection getConnection() &#123; Connection con = null; try &#123; Class.forName(\"com.mysql.jdbc.Driver\"); con = DriverManager.getConnection(\"jdbc:mysql://localhost:3306/test?useUnicode=true&amp;characterEncoding=UTF-8\", \"root\", \"root123456\"); &#125; catch (Exception e) &#123; System.out.println(\"-----------mysql get connection has exception , msg = \"+ e.getMessage()); &#125; return con; &#125;&#125; Flink ç¨‹åºï¼š 12345678910111213141516171819package com.zhisheng.flink;import com.zhisheng.flink.source.SourceFromMySQL;import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;/** * Desc: * weixi: zhisheng_tian * blog: http://www.54tianzhisheng.cn/ */public class Main2 &#123; public static void main(String[] args) throws Exception &#123; final StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment(); env.addSource(new SourceFromMySQL()).print(); env.execute(\"Flink add data sourc\"); &#125;&#125; è¿è¡Œ Flink ç¨‹åºï¼Œæ§åˆ¶å°æ—¥å¿—ä¸­å¯ä»¥çœ‹è§æ‰“å°çš„ student ä¿¡æ¯ã€‚ RichSourceFunctionä»ä¸Šé¢è‡ªå®šä¹‰çš„ Source å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ç»§æ‰¿çš„å°±æ˜¯è¿™ä¸ª RichSourceFunction ç±»ï¼Œé‚£ä¹ˆæ¥äº†è§£ä¸€ä¸‹ï¼š ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œç»§æ‰¿è‡ª AbstractRichFunctionã€‚ä¸ºå®ç°ä¸€ä¸ª Rich SourceFunction æä¾›åŸºç¡€èƒ½åŠ›ã€‚è¯¥ç±»çš„å­ç±»æœ‰ä¸‰ä¸ªï¼Œä¸¤ä¸ªæ˜¯æŠ½è±¡ç±»ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šæä¾›äº†æ›´å…·ä½“çš„å®ç°ï¼Œå¦ä¸€ä¸ªæ˜¯ ContinuousFileMonitoringFunctionã€‚ MessageAcknowledgingSourceBase ï¼šå®ƒé’ˆå¯¹çš„æ˜¯æ•°æ®æºæ˜¯æ¶ˆæ¯é˜Ÿåˆ—çš„åœºæ™¯å¹¶ä¸”æä¾›äº†åŸºäº ID çš„åº”ç­”æœºåˆ¶ã€‚ MultipleIdsMessageAcknowledgingSourceBase ï¼š åœ¨ MessageAcknowledgingSourceBase çš„åŸºç¡€ä¸Šé’ˆå¯¹ ID åº”ç­”æœºåˆ¶è¿›è¡Œäº†æ›´ä¸ºç»†åˆ†çš„å¤„ç†ï¼Œæ”¯æŒä¸¤ç§ ID åº”ç­”æ¨¡å‹ï¼šsession id å’Œ unique message idã€‚ ContinuousFileMonitoringFunctionï¼šè¿™æ˜¯å•ä¸ªï¼ˆéå¹¶è¡Œï¼‰ç›‘è§†ä»»åŠ¡ï¼Œå®ƒæ¥å— FileInputFormatï¼Œå¹¶ä¸”æ ¹æ® FileProcessingMode å’Œ FilePathFilterï¼Œå®ƒè´Ÿè´£ç›‘è§†ç”¨æˆ·æä¾›çš„è·¯å¾„ï¼›å†³å®šåº”è¯¥è¿›ä¸€æ­¥è¯»å–å’Œå¤„ç†å“ªäº›æ–‡ä»¶ï¼›åˆ›å»ºä¸è¿™äº›æ–‡ä»¶å¯¹åº”çš„ FileInputSplit æ‹†åˆ†ï¼Œå°†å®ƒä»¬åˆ†é…ç»™ä¸‹æ¸¸ä»»åŠ¡ä»¥è¿›è¡Œè¿›ä¸€æ­¥å¤„ç†ã€‚ æœ€åæœ¬æ–‡ä¸»è¦è®²äº†ä¸‹ Flink ä½¿ç”¨ Kafka Source çš„ä½¿ç”¨ï¼Œå¹¶æä¾›äº†ä¸€ä¸ª demo æ•™å¤§å®¶å¦‚ä½•è‡ªå®šä¹‰ Sourceï¼Œä» MySQL ä¸­è¯»å–æ•°æ®ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥ä»å…¶ä»–åœ°æ–¹è¯»å–ï¼Œå®ç°è‡ªå·±çš„æ•°æ®æº sourceã€‚å¯èƒ½å¹³æ—¶å·¥ä½œä¼šæ¯”è¿™ä¸ªæ›´å¤æ‚ï¼Œéœ€è¦å¤§å®¶çµæ´»åº”å¯¹ï¼ å…³æ³¨æˆ‘è½¬è½½è¯·åŠ¡å¿…æ³¨æ˜åŸåˆ›åœ°å€ä¸ºï¼šhttp://www.54tianzhisheng.cn/2018/10/30/flink-create-source/å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ Github ä»£ç ä»“åº“https://github.com/zhisheng17/flink-learning/ ä»¥åè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç éƒ½å°†æ”¾åœ¨è¿™ä¸ªä»“åº“é‡Œï¼ŒåŒ…å«äº†è‡ªå·±å­¦ä¹  flink çš„ä¸€äº› demo å’Œåšå®¢ åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€å®æˆ˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Data Sink ä»‹ç»","date":"2018-10-28T16:00:00.000Z","path":"2018/10/29/flink-sink/","text":"å‰è¨€å†ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ ã€Šä»0åˆ°1å­¦ä¹ Flinkã€‹â€”â€” Data Source ä»‹ç» è®²è§£äº† Flink Data Source ï¼Œé‚£ä¹ˆè¿™é‡Œå°±æ¥è®²è®² Flink Data Sink å§ã€‚ é¦–å…ˆ Sink çš„æ„æ€æ˜¯ï¼š å¤§æ¦‚å¯ä»¥çŒœåˆ°äº†å§ï¼Data sink æœ‰ç‚¹æŠŠæ•°æ®å­˜å‚¨ä¸‹æ¥ï¼ˆè½åº“ï¼‰çš„æ„æ€ã€‚ å¦‚ä¸Šå›¾ï¼ŒSource å°±æ˜¯æ•°æ®çš„æ¥æºï¼Œä¸­é—´çš„ Compute å…¶å®å°±æ˜¯ Flink å¹²çš„äº‹æƒ…ï¼Œå¯ä»¥åšä¸€ç³»åˆ—çš„æ“ä½œï¼Œæ“ä½œå®Œåå°±æŠŠè®¡ç®—åçš„æ•°æ®ç»“æœ Sink åˆ°æŸä¸ªåœ°æ–¹ã€‚ï¼ˆå¯ä»¥æ˜¯ MySQLã€ElasticSearchã€Kafkaã€Cassandra ç­‰ï¼‰ã€‚è¿™é‡Œæˆ‘è¯´ä¸‹è‡ªå·±ç›®å‰åšå‘Šè­¦è¿™å—å°±æ˜¯æŠŠ Compute è®¡ç®—åçš„ç»“æœ Sink ç›´æ¥å‘Šè­¦å‡ºæ¥äº†ï¼ˆå‘é€å‘Šè­¦æ¶ˆæ¯åˆ°é’‰é’‰ç¾¤ã€é‚®ä»¶ã€çŸ­ä¿¡ç­‰ï¼‰ï¼Œè¿™ä¸ª sink çš„æ„æ€ä¹Ÿä¸ä¸€å®šéå¾—è¯´æˆè¦æŠŠæ•°æ®å­˜å‚¨åˆ°æŸä¸ªåœ°æ–¹å»ã€‚å…¶å®å®˜ç½‘ç”¨çš„ Connector æ¥å½¢å®¹è¦å»çš„åœ°æ–¹æ›´åˆé€‚ï¼Œè¿™ä¸ª Connector å¯ä»¥æœ‰ MySQLã€ElasticSearchã€Kafkaã€Cassandra RabbitMQ ç­‰ã€‚ Flink Data Sinkå‰é¢æ–‡ç«  ã€Šä»0åˆ°1å­¦ä¹ Flinkã€‹â€”â€” Data Source ä»‹ç» ä»‹ç»äº† Flink Data Source æœ‰å“ªäº›ï¼Œè¿™é‡Œä¹Ÿçœ‹çœ‹ Flink Data Sink æ”¯æŒçš„æœ‰å“ªäº›ã€‚ çœ‹ä¸‹æºç æœ‰å“ªäº›å‘¢ï¼Ÿ å¯ä»¥çœ‹åˆ°æœ‰ Kafkaã€ElasticSearchã€Socketã€RabbitMQã€JDBCã€Cassandra POJOã€Fileã€Print ç­‰ Sink çš„æ–¹å¼ã€‚ SinkFunction ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ° SinkFunction æ¥å£æœ‰ invoke æ–¹æ³•ï¼Œå®ƒæœ‰ä¸€ä¸ª RichSinkFunction æŠ½è±¡ç±»ã€‚ ä¸Šé¢çš„é‚£äº›è‡ªå¸¦çš„ Sink å¯ä»¥çœ‹åˆ°éƒ½æ˜¯ç»§æ‰¿äº† RichSinkFunction æŠ½è±¡ç±»ï¼Œå®ç°äº†å…¶ä¸­çš„æ–¹æ³•ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¦æ˜¯è‡ªå·±å®šä¹‰è‡ªå·±çš„ Sink çš„è¯å…¶å®ä¹Ÿæ˜¯è¦æŒ‰ç…§è¿™ä¸ªå¥—è·¯æ¥åšçš„ã€‚ è¿™é‡Œå°±æ‹¿ä¸ªè¾ƒä¸ºç®€å•çš„ PrintSinkFunction æºç æ¥è®²ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566@PublicEvolvingpublic class PrintSinkFunction&lt;IN&gt; extends RichSinkFunction&lt;IN&gt; &#123; private static final long serialVersionUID = 1L; private static final boolean STD_OUT = false; private static final boolean STD_ERR = true; private boolean target; private transient PrintStream stream; private transient String prefix; /** * Instantiates a print sink function that prints to standard out. */ public PrintSinkFunction() &#123;&#125; /** * Instantiates a print sink function that prints to standard out. * * @param stdErr True, if the format should print to standard error instead of standard out. */ public PrintSinkFunction(boolean stdErr) &#123; target = stdErr; &#125; public void setTargetToStandardOut() &#123; target = STD_OUT; &#125; public void setTargetToStandardErr() &#123; target = STD_ERR; &#125; @Override public void open(Configuration parameters) throws Exception &#123; super.open(parameters); StreamingRuntimeContext context = (StreamingRuntimeContext) getRuntimeContext(); // get the target stream stream = target == STD_OUT ? System.out : System.err; // set the prefix if we have a &gt;1 parallelism prefix = (context.getNumberOfParallelSubtasks() &gt; 1) ? ((context.getIndexOfThisSubtask() + 1) + \"&gt; \") : null; &#125; @Override public void invoke(IN record) &#123; if (prefix != null) &#123; stream.println(prefix + record.toString()); &#125; else &#123; stream.println(record.toString()); &#125; &#125; @Override public void close() &#123; this.stream = null; this.prefix = null; &#125; @Override public String toString() &#123; return \"Print to \" + (target == STD_OUT ? \"System.out\" : \"System.err\"); &#125;&#125; å¯ä»¥çœ‹åˆ°å®ƒå°±æ˜¯å®ç°äº† RichSinkFunction æŠ½è±¡ç±»ï¼Œç„¶åå®ç°äº† invoke æ–¹æ³•ï¼Œè¿™é‡Œ invoke æ–¹æ³•å°±æ˜¯æŠŠè®°å½•æ‰“å°å‡ºæ¥äº†å°±æ˜¯ï¼Œæ²¡åšå…¶ä»–çš„é¢å¤–æ“ä½œã€‚ å¦‚ä½•ä½¿ç”¨ï¼Ÿ1SingleOutputStreamOperator.addSink(new PrintSinkFunction&lt;&gt;(); è¿™æ ·å°±å¯ä»¥äº†ï¼Œå¦‚æœæ˜¯å…¶ä»–çš„ Sink Function çš„è¯éœ€è¦æ¢æˆå¯¹åº”çš„ã€‚ ä½¿ç”¨è¿™ä¸ª Function å…¶æ•ˆæœå°±æ˜¯æ‰“å°ä» Source è¿‡æ¥çš„æ•°æ®ï¼Œå’Œç›´æ¥ Source.print() æ•ˆæœä¸€æ ·ã€‚ ä¸‹ç¯‡æ–‡ç« æˆ‘ä»¬å°†è®²è§£ä¸‹å¦‚ä½•è‡ªå®šä¹‰è‡ªå·±çš„ Sink Functionï¼Œå¹¶ä½¿ç”¨ä¸€ä¸ª demo æ¥æ•™å¤§å®¶ï¼Œè®©å¤§å®¶çŸ¥é“è¿™ä¸ªå¥—è·¯ï¼Œä¸”èƒ½å¤Ÿåœ¨è‡ªå·±å·¥ä½œä¸­è‡ªå®šä¹‰è‡ªå·±éœ€è¦çš„ Sink Functionï¼Œæ¥å®Œæˆè‡ªå·±çš„å·¥ä½œéœ€æ±‚ã€‚ æœ€åæœ¬æ–‡ä¸»è¦è®²äº†ä¸‹ Flink çš„ Data Sinkï¼Œå¹¶ä»‹ç»äº†å¸¸è§çš„ Data Sinkï¼Œä¹Ÿçœ‹äº†ä¸‹æºç çš„ SinkFunctionï¼Œä»‹ç»äº†ä¸€ä¸ªç®€å•çš„ Function ä½¿ç”¨, å‘Šè¯‰äº†å¤§å®¶è‡ªå®šä¹‰ Sink Function çš„å¥—è·¯ï¼Œä¸‹ç¯‡æ–‡ç« å¸¦å¤§å®¶å†™ä¸ªã€‚ å…³æ³¨æˆ‘è½¬è½½è¯·åŠ¡å¿…æ³¨æ˜åŸåˆ›åœ°å€ä¸ºï¼šhttp://www.54tianzhisheng.cn/2018/10/29/flink-sink/ å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ ä¸“æ ä»‹ç»é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f Github ä»£ç ä»“åº“https://github.com/zhisheng17/flink-learning/ ä»¥åè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç éƒ½å°†æ”¾åœ¨è¿™ä¸ªä»“åº“é‡Œï¼ŒåŒ…å«äº†è‡ªå·±å­¦ä¹  flink çš„ä¸€äº› demo å’Œåšå®¢ åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€å®æˆ˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Data Source ä»‹ç»","date":"2018-10-27T16:00:00.000Z","path":"2018/10/28/flink-sources/","text":"å‰è¨€Data Sources æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå°±å­—é¢æ„æ€å…¶å®å°±å¯ä»¥çŸ¥é“ï¼šæ•°æ®æ¥æºã€‚ Flink åšä¸ºä¸€æ¬¾æµå¼è®¡ç®—æ¡†æ¶ï¼Œå®ƒå¯ç”¨æ¥åšæ‰¹å¤„ç†ï¼Œå³å¤„ç†é™æ€çš„æ•°æ®é›†ã€å†å²çš„æ•°æ®é›†ï¼›ä¹Ÿå¯ä»¥ç”¨æ¥åšæµå¤„ç†ï¼Œå³å®æ—¶çš„å¤„ç†äº›å®æ—¶æ•°æ®æµï¼Œå®æ—¶çš„äº§ç”Ÿæ•°æ®æµç»“æœï¼Œåªè¦æ•°æ®æºæºä¸æ–­çš„è¿‡æ¥ï¼ŒFlink å°±èƒ½å¤Ÿä¸€ç›´è®¡ç®—ä¸‹å»ï¼Œè¿™ä¸ª Data Sources å°±æ˜¯æ•°æ®çš„æ¥æºåœ°ã€‚ Flink ä¸­ä½ å¯ä»¥ä½¿ç”¨ StreamExecutionEnvironment.addSource(sourceFunction) æ¥ä¸ºä½ çš„ç¨‹åºæ·»åŠ æ•°æ®æ¥æºã€‚ Flink å·²ç»æä¾›äº†è‹¥å¹²å®ç°å¥½äº†çš„ source functionsï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥é€šè¿‡å®ç° SourceFunction æ¥è‡ªå®šä¹‰éå¹¶è¡Œçš„ source æˆ–è€…å®ç° ParallelSourceFunction æ¥å£æˆ–è€…æ‰©å±• RichParallelSourceFunction æ¥è‡ªå®šä¹‰å¹¶è¡Œçš„ sourceï¼Œ FlinkStreamExecutionEnvironment ä¸­å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‡ ä¸ªå·²å®ç°çš„ stream sourcesï¼Œ æ€»çš„æ¥è¯´å¯ä»¥åˆ†ä¸ºä¸‹é¢å‡ å¤§ç±»ï¼š åŸºäºé›†åˆ1ã€fromCollection(Collection) - ä» Java çš„ Java.util.Collection åˆ›å»ºæ•°æ®æµã€‚é›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ ç±»å‹å¿…é¡»ç›¸åŒã€‚ 2ã€fromCollection(Iterator, Class) - ä»ä¸€ä¸ªè¿­ä»£å™¨ä¸­åˆ›å»ºæ•°æ®æµã€‚Class æŒ‡å®šäº†è¯¥è¿­ä»£å™¨è¿”å›å…ƒç´ çš„ç±»å‹ã€‚ 3ã€fromElements(T â€¦) - ä»ç»™å®šçš„å¯¹è±¡åºåˆ—ä¸­åˆ›å»ºæ•°æ®æµã€‚æ‰€æœ‰å¯¹è±¡ç±»å‹å¿…é¡»ç›¸åŒã€‚ 12345678StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();DataStream&lt;Event&gt; input = env.fromElements( new Event(1, \"barfoo\", 1.0), new Event(2, \"start\", 2.0), new Event(3, \"foobar\", 3.0), ...); 4ã€fromParallelCollection(SplittableIterator, Class) - ä»ä¸€ä¸ªè¿­ä»£å™¨ä¸­åˆ›å»ºå¹¶è¡Œæ•°æ®æµã€‚Class æŒ‡å®šäº†è¯¥è¿­ä»£å™¨è¿”å›å…ƒç´ çš„ç±»å‹ã€‚ 5ã€generateSequence(from, to) - åˆ›å»ºä¸€ä¸ªç”ŸæˆæŒ‡å®šåŒºé—´èŒƒå›´å†…çš„æ•°å­—åºåˆ—çš„å¹¶è¡Œæ•°æ®æµã€‚ åŸºäºæ–‡ä»¶1ã€readTextFile(path) - è¯»å–æ–‡æœ¬æ–‡ä»¶ï¼Œå³ç¬¦åˆ TextInputFormat è§„èŒƒçš„æ–‡ä»¶ï¼Œå¹¶å°†å…¶ä½œä¸ºå­—ç¬¦ä¸²è¿”å›ã€‚ 123final StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();DataStream&lt;String&gt; text = env.readTextFile(\"file:///path/to/file\"); 2ã€readFile(fileInputFormat, path) - æ ¹æ®æŒ‡å®šçš„æ–‡ä»¶è¾“å…¥æ ¼å¼è¯»å–æ–‡ä»¶ï¼ˆä¸€æ¬¡ï¼‰ã€‚ 3ã€readFile(fileInputFormat, path, watchType, interval, pathFilter, typeInfo) - è¿™æ˜¯ä¸Šé¢ä¸¤ä¸ªæ–¹æ³•å†…éƒ¨è°ƒç”¨çš„æ–¹æ³•ã€‚å®ƒæ ¹æ®ç»™å®šçš„ fileInputFormat å’Œè¯»å–è·¯å¾„è¯»å–æ–‡ä»¶ã€‚æ ¹æ®æä¾›çš„ watchTypeï¼Œè¿™ä¸ª source å¯ä»¥å®šæœŸï¼ˆæ¯éš” interval æ¯«ç§’ï¼‰ç›‘æµ‹ç»™å®šè·¯å¾„çš„æ–°æ•°æ®ï¼ˆFileProcessingMode.PROCESS_CONTINUOUSLYï¼‰ï¼Œæˆ–è€…å¤„ç†ä¸€æ¬¡è·¯å¾„å¯¹åº”æ–‡ä»¶çš„æ•°æ®å¹¶é€€å‡ºï¼ˆFileProcessingMode.PROCESS_ONCEï¼‰ã€‚ä½ å¯ä»¥é€šè¿‡ pathFilter è¿›ä¸€æ­¥æ’é™¤æ‰éœ€è¦å¤„ç†çš„æ–‡ä»¶ã€‚ 12345final StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();DataStream&lt;MyEvent&gt; stream = env.readFile( myFormat, myFilePath, FileProcessingMode.PROCESS_CONTINUOUSLY, 100, FilePathFilter.createDefaultFilter(), typeInfo); å®ç°: åœ¨å…·ä½“å®ç°ä¸Šï¼ŒFlink æŠŠæ–‡ä»¶è¯»å–è¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªå­ä»»åŠ¡ï¼Œå³ç›®å½•ç›‘æ§å’Œæ•°æ®è¯»å–ã€‚æ¯ä¸ªå­ä»»åŠ¡éƒ½ç”±å•ç‹¬çš„å®ä½“å®ç°ã€‚ç›®å½•ç›‘æ§ç”±å•ä¸ªéå¹¶è¡Œï¼ˆå¹¶è¡Œåº¦ä¸º1ï¼‰çš„ä»»åŠ¡æ‰§è¡Œï¼Œè€Œæ•°æ®è¯»å–ç”±å¹¶è¡Œè¿è¡Œçš„å¤šä¸ªä»»åŠ¡æ‰§è¡Œã€‚åè€…çš„å¹¶è¡Œæ€§ç­‰äºä½œä¸šçš„å¹¶è¡Œæ€§ã€‚å•ä¸ªç›®å½•ç›‘æ§ä»»åŠ¡çš„ä½œç”¨æ˜¯æ‰«æç›®å½•ï¼ˆæ ¹æ® watchType å®šæœŸæ‰«ææˆ–ä»…æ‰«æä¸€æ¬¡ï¼‰ï¼ŒæŸ¥æ‰¾è¦å¤„ç†çš„æ–‡ä»¶å¹¶æŠŠæ–‡ä»¶åˆ†å‰²æˆåˆ‡åˆ†ç‰‡ï¼ˆsplitsï¼‰ï¼Œç„¶åå°†è¿™äº›åˆ‡åˆ†ç‰‡åˆ†é…ç»™ä¸‹æ¸¸ readerã€‚reader è´Ÿè´£è¯»å–æ•°æ®ã€‚æ¯ä¸ªåˆ‡åˆ†ç‰‡åªèƒ½ç”±ä¸€ä¸ª reader è¯»å–ï¼Œä½†ä¸€ä¸ª reader å¯ä»¥é€ä¸ªè¯»å–å¤šä¸ªåˆ‡åˆ†ç‰‡ã€‚ é‡è¦æ³¨æ„ï¼š å¦‚æœ watchType è®¾ç½®ä¸º FileProcessingMode.PROCESS_CONTINUOUSLYï¼Œåˆ™å½“æ–‡ä»¶è¢«ä¿®æ”¹æ—¶ï¼Œå…¶å†…å®¹å°†è¢«é‡æ–°å¤„ç†ã€‚è¿™ä¼šæ‰“ç ´â€œexactly-onceâ€è¯­ä¹‰ï¼Œå› ä¸ºåœ¨æ–‡ä»¶æœ«å°¾é™„åŠ æ•°æ®å°†å¯¼è‡´å…¶æ‰€æœ‰å†…å®¹è¢«é‡æ–°å¤„ç†ã€‚ å¦‚æœ watchType è®¾ç½®ä¸º FileProcessingMode.PROCESS_ONCEï¼Œåˆ™ source ä»…æ‰«æè·¯å¾„ä¸€æ¬¡ç„¶åé€€å‡ºï¼Œè€Œä¸ç­‰å¾… reader å®Œæˆæ–‡ä»¶å†…å®¹çš„è¯»å–ã€‚å½“ç„¶ reader ä¼šç»§ç»­é˜…è¯»ï¼Œç›´åˆ°è¯»å–æ‰€æœ‰çš„æ–‡ä»¶å†…å®¹ã€‚å…³é—­ source åå°±ä¸ä¼šå†æœ‰æ£€æŸ¥ç‚¹ã€‚è¿™å¯èƒ½å¯¼è‡´èŠ‚ç‚¹æ•…éšœåçš„æ¢å¤é€Ÿåº¦è¾ƒæ…¢ï¼Œå› ä¸ºè¯¥ä½œä¸šå°†ä»æœ€åä¸€ä¸ªæ£€æŸ¥ç‚¹æ¢å¤è¯»å–ã€‚ åŸºäº Socketï¼šsocketTextStream(String hostname, int port) - ä» socket è¯»å–ã€‚å…ƒç´ å¯ä»¥ç”¨åˆ†éš”ç¬¦åˆ‡åˆ†ã€‚ 12345678StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();DataStream&lt;Tuple2&lt;String, Integer&gt;&gt; dataStream = env .socketTextStream(\"localhost\", 9999) // ç›‘å¬ localhost çš„ 9999 ç«¯å£è¿‡æ¥çš„æ•°æ® .flatMap(new Splitter()) .keyBy(0) .timeWindow(Time.seconds(5)) .sum(1); è¿™ä¸ªåœ¨ ã€Šä»0åˆ°1å­¦ä¹ Flinkã€‹â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ æ–‡ç« é‡Œç”¨çš„å°±æ˜¯åŸºäº Socket çš„ Word Count ç¨‹åºã€‚ è‡ªå®šä¹‰ï¼šaddSource - æ·»åŠ ä¸€ä¸ªæ–°çš„ source functionã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥ addSource(new FlinkKafkaConsumer011&lt;&gt;(â€¦)) ä»¥ä» Apache Kafka è¯»å–æ•°æ® è¯´ä¸‹ä¸Šé¢å‡ ç§çš„ç‰¹ç‚¹å§ï¼š 1ã€åŸºäºé›†åˆï¼šæœ‰ç•Œæ•°æ®é›†ï¼Œæ›´åå‘äºæœ¬åœ°æµ‹è¯•ç”¨ 2ã€åŸºäºæ–‡ä»¶ï¼šé€‚åˆç›‘å¬æ–‡ä»¶ä¿®æ”¹å¹¶è¯»å–å…¶å†…å®¹ 3ã€åŸºäº Socketï¼šç›‘å¬ä¸»æœºçš„ host portï¼Œä» Socket ä¸­è·å–æ•°æ® 4ã€è‡ªå®šä¹‰ addSourceï¼šå¤§å¤šæ•°çš„åœºæ™¯æ•°æ®éƒ½æ˜¯æ— ç•Œçš„ï¼Œä¼šæºæºä¸æ–­çš„è¿‡æ¥ã€‚æ¯”å¦‚å»æ¶ˆè´¹ Kafka æŸä¸ª topic ä¸Šçš„æ•°æ®ï¼Œè¿™æ—¶å€™å°±éœ€è¦ç”¨åˆ°è¿™ä¸ª addSourceï¼Œå¯èƒ½å› ä¸ºç”¨çš„æ¯”è¾ƒå¤šçš„åŸå› å§ï¼ŒFlink ç›´æ¥æä¾›äº† FlinkKafkaConsumer011 ç­‰ç±»å¯ä¾›ä½ ç›´æ¥ä½¿ç”¨ã€‚ä½ å¯ä»¥å»çœ‹çœ‹ FlinkKafkaConsumerBase è¿™ä¸ªåŸºç¡€ç±»ï¼Œå®ƒæ˜¯ Flink Kafka æ¶ˆè´¹çš„æœ€æ ¹æœ¬çš„ç±»ã€‚ 123456789StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();DataStream&lt;KafkaEvent&gt; input = env .addSource( new FlinkKafkaConsumer011&lt;&gt;( parameterTool.getRequired(\"input-topic\"), //ä»å‚æ•°ä¸­è·å–ä¼ è¿›æ¥çš„ topic new KafkaEventSchema(), parameterTool.getProperties()) .assignTimestampsAndWatermarks(new CustomWatermarkExtractor())); Flink ç›®å‰æ”¯æŒå¦‚ä¸‹å›¾é‡Œé¢å¸¸è§çš„ Sourceï¼š å¦‚æœä½ æƒ³è‡ªå·±è‡ªå®šä¹‰è‡ªå·±çš„ Source å‘¢ï¼Ÿ é‚£ä¹ˆä½ å°±éœ€è¦å»äº†è§£ä¸€ä¸‹ SourceFunction æ¥å£äº†ï¼Œå®ƒæ˜¯æ‰€æœ‰ stream source çš„æ ¹æ¥å£ï¼Œå®ƒç»§æ‰¿è‡ªä¸€ä¸ªæ ‡è®°æ¥å£ï¼ˆç©ºæ¥å£ï¼‰Functionã€‚ SourceFunction å®šä¹‰äº†ä¸¤ä¸ªæ¥å£æ–¹æ³•ï¼š 1ã€run ï¼š å¯åŠ¨ä¸€ä¸ª sourceï¼Œå³å¯¹æ¥ä¸€ä¸ªå¤–éƒ¨æ•°æ®æºç„¶å emit å…ƒç´ å½¢æˆ streamï¼ˆå¤§éƒ¨åˆ†æƒ…å†µä¸‹ä¼šé€šè¿‡åœ¨è¯¥æ–¹æ³•é‡Œè¿è¡Œä¸€ä¸ª while å¾ªç¯çš„å½¢å¼æ¥äº§ç”Ÿ streamï¼‰ã€‚ 2ã€cancel ï¼š å–æ¶ˆä¸€ä¸ª sourceï¼Œä¹Ÿå³å°† run ä¸­çš„å¾ªç¯ emit å…ƒç´ çš„è¡Œä¸ºç»ˆæ­¢ã€‚ æ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸€ä¸ª SourceFunction å®ç°è¿™ä¸¤ä¸ªæ¥å£æ–¹æ³•å°±å¯ä»¥äº†ã€‚å…¶å®è¿™ä¸¤ä¸ªæ¥å£æ–¹æ³•ä¹Ÿå›ºå®šäº†ä¸€ç§å®ç°æ¨¡æ¿ã€‚ æ¯”å¦‚ï¼Œå®ç°ä¸€ä¸ª XXXSourceFunctionï¼Œé‚£ä¹ˆå¤§è‡´çš„æ¨¡æ¿æ˜¯è¿™æ ·çš„ï¼š(ç›´æ¥æ‹¿ FLink æºç çš„å®ä¾‹ç»™ä½ çœ‹çœ‹) æœ€åæœ¬æ–‡ä¸»è¦è®²äº†ä¸‹ Flink çš„å¸¸è§ Source æœ‰å“ªäº›å¹¶ä¸”ç®€å•çš„æäº†ä¸‹å¦‚ä½•è‡ªå®šä¹‰ Sourceã€‚ å…³æ³¨æˆ‘è½¬è½½è¯·åŠ¡å¿…æ³¨æ˜åŸåˆ›åœ°å€ä¸ºï¼šhttp://www.54tianzhisheng.cn/2018/10/28/flink-sources/ å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f Github ä»£ç ä»“åº“https://github.com/zhisheng17/flink-learning/ ä»¥åè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç éƒ½å°†æ”¾åœ¨è¿™ä¸ªä»“åº“é‡Œï¼ŒåŒ…å«äº†è‡ªå·±å­¦ä¹  flink çš„ä¸€äº› demo å’Œåšå®¢ åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€å®æˆ˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£","date":"2018-10-26T16:00:00.000Z","path":"2018/10/27/flink-config/","text":"å‰é¢æ–‡ç« æˆ‘ä»¬å·²ç»çŸ¥é“ Flink æ˜¯ä»€ä¹ˆä¸œè¥¿äº†ï¼Œå®‰è£…å¥½ Flink åï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸‹å®‰è£…è·¯å¾„ä¸‹çš„é…ç½®æ–‡ä»¶å§ã€‚ å®‰è£…ç›®å½•ä¸‹ä¸»è¦æœ‰ flink-conf.yaml é…ç½®ã€æ—¥å¿—çš„é…ç½®æ–‡ä»¶ã€zk é…ç½®ã€Flink SQL Client é…ç½®ã€‚ flink-conf.yamlåŸºç¡€é…ç½®123456789101112131415161718192021# jobManager çš„IPåœ°å€jobmanager.rpc.address: localhost# JobManager çš„ç«¯å£å·jobmanager.rpc.port: 6123# JobManager JVM heap å†…å­˜å¤§å°jobmanager.heap.size: 1024m# TaskManager JVM heap å†…å­˜å¤§å°taskmanager.heap.size: 1024m# æ¯ä¸ª TaskManager æä¾›çš„ä»»åŠ¡ slots æ•°é‡å¤§å°taskmanager.numberOfTaskSlots: 1# ç¨‹åºé»˜è®¤å¹¶è¡Œè®¡ç®—çš„ä¸ªæ•°parallelism.default: 1# æ–‡ä»¶ç³»ç»Ÿæ¥æº# fs.default-scheme é«˜å¯ç”¨æ€§é…ç½®1234567891011# å¯ä»¥é€‰æ‹© &apos;NONE&apos; æˆ–è€… &apos;zookeeper&apos;.# high-availability: zookeeper# æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ï¼Œè®© Flink åœ¨é«˜å¯ç”¨æ€§è®¾ç½®ä¸­æŒä¹…ä¿å­˜å…ƒæ•°æ®# high-availability.storageDir: hdfs:///flink/ha/# zookeeper é›†ç¾¤ä¸­ä»²è£è€…çš„æœºå™¨ ip å’Œ port ç«¯å£å·# high-availability.zookeeper.quorum: localhost:2181# é»˜è®¤æ˜¯ openï¼Œå¦‚æœ zookeeper security å¯ç”¨äº†è¯¥å€¼ä¼šæ›´æ”¹æˆ creator# high-availability.zookeeper.client.acl: open å®¹é”™å’Œæ£€æŸ¥ç‚¹ é…ç½®1234567891011# ç”¨äºå­˜å‚¨å’Œæ£€æŸ¥ç‚¹çŠ¶æ€# state.backend: filesystem# å­˜å‚¨æ£€æŸ¥ç‚¹çš„æ•°æ®æ–‡ä»¶å’Œå…ƒæ•°æ®çš„é»˜è®¤ç›®å½•# state.checkpoints.dir: hdfs://namenode-host:port/flink-checkpoints# savepoints çš„é»˜è®¤ç›®æ ‡ç›®å½•(å¯é€‰)# state.savepoints.dir: hdfs://namenode-host:port/flink-checkpoints# ç”¨äºå¯ç”¨/ç¦ç”¨å¢é‡ checkpoints çš„æ ‡å¿—# state.backend.incremental: false web å‰ç«¯é…ç½®12345678# åŸºäº Web çš„è¿è¡Œæ—¶ç›‘è§†å™¨ä¾¦å¬çš„åœ°å€.#jobmanager.web.address: 0.0.0.0# Web çš„è¿è¡Œæ—¶ç›‘è§†å™¨ç«¯å£rest.port: 8081# æ˜¯å¦ä»åŸºäº Web çš„ jobmanager å¯ç”¨ä½œä¸šæäº¤# jobmanager.web.submit.enable: false é«˜çº§é…ç½®123456789101112131415# io.tmp.dirs: /tmp# æ˜¯å¦åº”åœ¨ TaskManager å¯åŠ¨æ—¶é¢„å…ˆåˆ†é… TaskManager ç®¡ç†çš„å†…å­˜# taskmanager.memory.preallocate: false# ç±»åŠ è½½è§£æé¡ºåºï¼Œæ˜¯å…ˆæ£€æŸ¥ç”¨æˆ·ä»£ç  jarï¼ˆâ€œchild-firstâ€ï¼‰è¿˜æ˜¯åº”ç”¨ç¨‹åºç±»è·¯å¾„ï¼ˆâ€œparent-firstâ€ï¼‰ã€‚ é»˜è®¤è®¾ç½®æŒ‡ç¤ºé¦–å…ˆä»ç”¨æˆ·ä»£ç  jar åŠ è½½ç±»# classloader.resolve-order: child-first# ç”¨äºç½‘ç»œç¼“å†²åŒºçš„ JVM å†…å­˜çš„åˆ†æ•°ã€‚ è¿™å†³å®šäº† TaskManager å¯ä»¥åŒæ—¶æ‹¥æœ‰å¤šå°‘æµæ•°æ®äº¤æ¢é€šé“ä»¥åŠé€šé“ç¼“å†²çš„ç¨‹åº¦ã€‚ å¦‚æœä½œä¸šè¢«æ‹’ç»æˆ–è€…æ‚¨æ”¶åˆ°ç³»ç»Ÿæ²¡æœ‰è¶³å¤Ÿç¼“å†²åŒºçš„è­¦å‘Šï¼Œè¯·å¢åŠ æ­¤å€¼æˆ–ä¸‹é¢çš„æœ€å°/æœ€å¤§å€¼ã€‚ å¦è¯·æ³¨æ„ï¼Œâ€œtaskmanager.network.memory.minâ€å’Œâ€œtaskmanager.network.memory.maxâ€å¯èƒ½ä¼šè¦†ç›–æ­¤åˆ†æ•°# taskmanager.network.memory.fraction: 0.1# taskmanager.network.memory.min: 67108864# taskmanager.network.memory.max: 1073741824 Flink é›†ç¾¤å®‰å…¨é…ç½®1234567891011# æŒ‡ç¤ºæ˜¯å¦ä» Kerberos ticket ç¼“å­˜ä¸­è¯»å–# security.kerberos.login.use-ticket-cache: true# åŒ…å«ç”¨æˆ·å‡­æ®çš„ Kerberos å¯†é’¥è¡¨æ–‡ä»¶çš„ç»å¯¹è·¯å¾„# security.kerberos.login.keytab: /path/to/kerberos/keytab# ä¸ keytab å…³è”çš„ Kerberos ä¸»ä½“åç§°# security.kerberos.login.principal: flink-user# ä»¥é€—å·åˆ†éš”çš„ç™»å½•ä¸Šä¸‹æ–‡åˆ—è¡¨ï¼Œç”¨äºæä¾› Kerberos å‡­æ®ï¼ˆä¾‹å¦‚ï¼Œ`Clientï¼ŒKafkaClient`ä½¿ç”¨å‡­è¯è¿›è¡Œ ZooKeeper èº«ä»½éªŒè¯å’Œ Kafka èº«ä»½éªŒè¯ï¼‰# security.kerberos.login.contexts: Client,KafkaClient Zookeeper å®‰å…¨é…ç½®12345# è¦†ç›–ä»¥ä¸‹é…ç½®ä»¥æä¾›è‡ªå®šä¹‰ ZK æœåŠ¡åç§°# zookeeper.sasl.service-name: zookeeper# è¯¥é…ç½®å¿…é¡»åŒ¹é… &quot;security.kerberos.login.contexts&quot; ä¸­çš„åˆ—è¡¨ï¼ˆå«æœ‰ä¸€ä¸ªï¼‰# zookeeper.sasl.login-context-name: Client HistoryServer12345678910111213141516# ä½ å¯ä»¥é€šè¿‡ bin/historyserver.sh (start|stop) å‘½ä»¤å¯åŠ¨å’Œå…³é—­ HistoryServer# å°†å·²å®Œæˆçš„ä½œä¸šä¸Šä¼ åˆ°çš„ç›®å½•# jobmanager.archive.fs.dir: hdfs:///completed-jobs/# åŸºäº Web çš„ HistoryServer çš„åœ°å€# historyserver.web.address: 0.0.0.0# åŸºäº Web çš„ HistoryServer çš„ç«¯å£å·# historyserver.web.port: 8082# ä»¥é€—å·åˆ†éš”çš„ç›®å½•åˆ—è¡¨ï¼Œç”¨äºç›‘è§†å·²å®Œæˆçš„ä½œä¸š# historyserver.archive.fs.dir: hdfs:///completed-jobs/# åˆ·æ–°å—ç›‘æ§ç›®å½•çš„æ—¶é—´é—´éš”ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰# historyserver.archive.fs.refresh-interval: 10000 æŸ¥çœ‹ä¸‹å¦å¤–ä¸¤ä¸ªé…ç½® slaves / master 2ã€slavesé‡Œé¢æ˜¯æ¯ä¸ª worker èŠ‚ç‚¹çš„ IP/Hostnameï¼Œæ¯ä¸€ä¸ª worker ç»“ç‚¹ä¹‹åéƒ½ä¼šè¿è¡Œä¸€ä¸ª TaskManagerï¼Œä¸€ä¸ªä¸€è¡Œã€‚ 1localhost 3ã€mastershost:port 1localhost:8081 4ã€zoo.cfg123456789101112131415161718# æ¯ä¸ª tick çš„æ¯«ç§’æ•°tickTime=2000# åˆå§‹åŒæ­¥é˜¶æ®µå¯ä»¥é‡‡ç”¨çš„ tick æ•°initLimit=10# åœ¨å‘é€è¯·æ±‚å’Œè·å–ç¡®è®¤ä¹‹é—´å¯ä»¥ä¼ é€’çš„ tick æ•°syncLimit=5# å­˜å‚¨å¿«ç…§çš„ç›®å½•# dataDir=/tmp/zookeeper# å®¢æˆ·ç«¯å°†è¿æ¥çš„ç«¯å£clientPort=2181# ZooKeeper quorum peersserver.1=localhost:2888:3888# server.2=host:peer-port:leader-port 5ã€æ—¥å¿—é…ç½®Flink åœ¨ä¸åŒå¹³å°ä¸‹è¿è¡Œçš„æ—¥å¿—æ–‡ä»¶ 1234567log4j-cli.propertieslog4j-console.propertieslog4j-yarn-session.propertieslog4j.propertieslogback-console.xmllogback-yarn.xmllogback.xml sql-client-defaults.yaml12345678910111213141516171819202122232425execution: # 'batch' or 'streaming' execution type: streaming # allow 'event-time' or only 'processing-time' in sources time-characteristic: event-time # interval in ms for emitting periodic watermarks periodic-watermarks-interval: 200 # 'changelog' or 'table' presentation of results result-mode: changelog # parallelism of the program parallelism: 1 # maximum parallelism max-parallelism: 128 # minimum idle state retention in ms min-idle-state-retention: 0 # maximum idle state retention in ms max-idle-state-retention: 0 deployment: # general cluster communication timeout in ms response-timeout: 5000 # (optional) address from cluster to gateway gateway-address: \"\" # (optional) port from cluster to gateway gateway-port: 0 Flink sql client ï¼šä½ å¯ä»¥ä»å®˜ç½‘è¿™é‡Œäº†è§£ https://ci.apache.org/projects/flink/flink-docs-stable/dev/table/sqlClient.html æ€»ç»“æœ¬æ–‡æ‹¿å®‰è£…ç›®å½•æ–‡ä»¶ä¸‹çš„é…ç½®æ–‡ä»¶è®²è§£äº†ä¸‹ Flink ç›®å½•ä¸‹çš„æ‰€æœ‰é…ç½®ã€‚ ä½ ä¹Ÿå¯ä»¥é€šè¿‡å®˜ç½‘è¿™é‡Œå­¦ä¹ æ›´å¤šï¼šhttps://ci.apache.org/projects/flink/flink-docs-stable/ops/config.html å…³æ³¨æˆ‘æœ¬ç¯‡æ–‡ç« åœ°å€æ˜¯ï¼šhttp://www.54tianzhisheng.cn/2018/10/27/flink-config/ å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ Github ä»£ç ä»“åº“https://github.com/zhisheng17/flink-learning/ ä»¥åè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç éƒ½å°†æ”¾åœ¨è¿™ä¸ªä»“åº“é‡Œï¼ŒåŒ…å«äº†è‡ªå·±å­¦ä¹  flink çš„ä¸€äº› demo å’Œåšå®¢ åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€å®æˆ˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Apache Flink ä»‹ç»","date":"2018-10-12T16:00:00.000Z","path":"2018/10/13/flink-introduction/","text":"å‰è¨€Flink æ˜¯ä¸€ç§æµå¼è®¡ç®—æ¡†æ¶ï¼Œä¸ºä»€ä¹ˆæˆ‘ä¼šæ¥è§¦åˆ° Flink å‘¢ï¼Ÿ å› ä¸ºæˆ‘ç›®å‰åœ¨è´Ÿè´£çš„æ˜¯ç›‘æ§å¹³å°çš„å‘Šè­¦éƒ¨åˆ†ï¼Œè´Ÿè´£é‡‡é›†åˆ°çš„ç›‘æ§æ•°æ®ä¼šç›´æ¥å¾€ kafka é‡Œå¡ï¼Œç„¶åå‘Šè­¦è¿™è¾¹éœ€è¦ä» kafka topic é‡Œé¢å®æ—¶è¯»å–åˆ°ç›‘æ§æ•°æ®ï¼Œå¹¶å°†è¯»å–åˆ°çš„ç›‘æ§æ•°æ®åšä¸€äº› èšåˆ/è½¬æ¢/è®¡ç®— ç­‰æ“ä½œï¼Œç„¶åå°†è®¡ç®—åçš„ç»“æœä¸å‘Šè­¦è§„åˆ™çš„é˜ˆå€¼è¿›è¡Œæ¯”è¾ƒï¼Œç„¶ååšå‡ºç›¸åº”çš„å‘Šè­¦æªæ–½ï¼ˆé’‰é’‰ç¾¤ã€é‚®ä»¶ã€çŸ­ä¿¡ã€ç”µè¯ç­‰ï¼‰ã€‚ç”»äº†ä¸ªç®€å•çš„å›¾å¦‚ä¸‹ï¼š ç›®å‰å‘Šè­¦è¿™å—çš„æ¶æ„æ˜¯è¿™æ ·çš„ç»“æ„ï¼Œåˆšè¿›å…¬å¸é‚£ä¼šçš„æ—¶å€™ï¼Œæ¶æ„æ˜¯æ‰€æœ‰çš„ç›‘æ§æ•°æ®ç›´æ¥å­˜åœ¨ ElasticSearch ä¸­ï¼Œç„¶åæˆ‘ä»¬å‘Šè­¦æ˜¯å» ElasticSearch ä¸­æœç´¢æˆ‘ä»¬ç›‘æ§æŒ‡æ ‡éœ€è¦çš„æ•°æ®ï¼Œå¹¸å¥½ ElasticSearch çš„æœç´¢èƒ½åŠ›å¤Ÿå¼ºå¤§ã€‚ä½†æ˜¯ä½ æœ‰æ²¡æœ‰å‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æ‰€æœ‰çš„ç›‘æ§æ•°æ®ä»é‡‡é›†ã€é‡‡é›†åçš„æ•°æ®åšä¸€äº› è®¡ç®—/è½¬æ¢/èšåˆã€å†é€šè¿‡ Kafka æ¶ˆæ¯é˜Ÿåˆ—ã€å†å­˜è¿› ElasticSearch ä¸­ï¼Œå†è€Œå» ElasticSearch ä¸­æŸ¥æ‰¾æˆ‘ä»¬çš„ç›‘æ§æ•°æ®ï¼Œç„¶ååšå‡ºå‘Šè­¦ç­–ç•¥ã€‚æ•´ä¸ªæµç¨‹å¯¹ç›‘æ§æ¥è¯´çœ‹èµ·æ¥å¾ˆæŒ‰ç…§å¸¸ç†ï¼Œä½†æ˜¯å¯¹äºå‘Šè­¦æ¥è¯´ï¼Œå¦‚æœä¸­é—´æŸä¸ªç¯èŠ‚å‡ºäº†é—®é¢˜ï¼Œæ¯”å¦‚ Kafka æ¶ˆæ¯é˜Ÿåˆ—å»¶è¿Ÿã€ç›‘æ§æ•°æ®å­˜åˆ° ElasticSearch ä¸­å†™å…¥æ—¶é—´è¾ƒé•¿ã€ä½ çš„æŸ¥è¯¢å§¿åŠ¿å†™çš„ä¸å¯¹ç­‰åŸå› ï¼Œè¿™éƒ½å°†å¯¼è‡´å‘Šè­¦ä» ElasticSearch æŸ¥åˆ°çš„æ•°æ®æ˜¯æœ‰å»¶è¿Ÿçš„ã€‚ä¹Ÿè®¸æ˜¯ 30 ç§’ã€ä¸€åˆ†é’Ÿã€æˆ–è€…æ›´é•¿ï¼Œè¿™æ ·å¯¹äºå‘Šè­¦æ¥è¯´è¿™æ— ç–‘å°†å¯¼è‡´å‘Šè­¦çš„æ¶ˆæ¯æ²¡æœ‰ä»»ä½•çš„æ„ä¹‰ã€‚ ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿä¸ºä»€ä¹ˆéœ€è¦ç›‘æ§å‘Šè­¦å¹³å°å‘¢ï¼Ÿæ— éå°±æ˜¯å¸Œæœ›æˆ‘ä»¬èƒ½å¤Ÿå°½æ—©çš„å‘ç°é—®é¢˜ï¼ŒæŠŠé—®é¢˜ç»™å‘Šè­¦å‡ºæ¥ï¼Œè¿™æ ·å¼€å‘å’Œè¿ç»´äººå‘˜æ‰èƒ½å¤ŸåŠæ—¶çš„å¤„ç†è§£å†³å¥½çº¿ä¸Šçš„é—®é¢˜ï¼Œä»¥å…ç»™å…¬å¸é€ æˆå·¨å¤§çš„æŸå¤±ã€‚ æ›´ä½•å†µç°åœ¨è¿˜æœ‰æ›´å¤šçš„å…¬å¸åœ¨åšé‚£ç§æå‰é¢„è­¦å‘¢ï¼è¿™ç§åˆè¯¥å¦‚ä½•åšå‘¢ï¼Ÿéœ€è¦ç”¨å¤§æ•°æ®å’Œæœºå™¨å­¦ä¹ çš„æŠ€æœ¯å»åˆ†æå‘¨æœŸæ€§çš„å†å²æ•°æ®ï¼Œç„¶åæ ¹æ®è¿™äº›æ•°æ®å¯ä»¥æ•´ç†å‡ºæ¥æŸäº›ç›‘æ§æŒ‡æ ‡çš„ä¸€äº›å‘¨æœŸæ€§ï¼ˆä¸€å¤©/ä¸ƒå¤©/ä¸€æœˆ/ä¸€å­£åº¦/ä¸€å¹´ï¼‰èµ°åŠ¿å›¾ï¼Œè¿™æ ·å°±å¤§æ¦‚å¯ä»¥ç»˜å›¾å‡ºæ¥ã€‚ç„¶åæ ¹æ®è¿™ä¸ªèµ°åŠ¿å›¾ï¼Œå¯ä»¥å°†å½“å‰æ—¶é—´ç‚¹çš„ç›‘æ§æŒ‡æ ‡çš„æ•°æ®ä½¿ç”¨é‡å’Œèµ°åŠ¿å›¾è¿›è¡Œå¯¹æ¯”ï¼Œåœ¨å¿«è¦è¾¾åˆ°æˆ‘ä»¬å‘Šè­¦è§„åˆ™çš„é˜ˆå€¼æ—¶ï¼Œè¿™æ—¶å°±å¯ä»¥æå‰å‘Šä¸€ä¸ªé¢„è­¦å‡ºæ¥ï¼Œè®©è¿ç»´æå‰çŸ¥é“é¢„è­¦ï¼Œç„¶åæå‰æŸ¥æ‰¾é—®é¢˜ï¼Œè¿™æ ·å°±èƒ½å¤Ÿææ—©å‘ç°é—®é¢˜æ‰€åœ¨ï¼Œé¿å…æŸå¤±ï¼Œå°†æŸå¤±é™åˆ°æœ€å°ï¼å½“ç„¶ï¼Œè¿™ç§ä¹Ÿæ˜¯æˆ‘æ‰“ç®—åšçš„ï¼Œåº”è¯¥å¯ä»¥å­¦åˆ°ä¸å°‘ä¸œè¥¿çš„ã€‚ äºæ˜¯ä¹ï¼Œæˆ‘ç°åœ¨å°±åœ¨æ¥è§¦æµå¼è®¡ç®—æ¡†æ¶ Flinkï¼Œç±»ä¼¼çš„è¿˜æœ‰å¸¸ç”¨çš„ Spark ç­‰ã€‚ è‡ªå·±ä¹Ÿæ¥è§¦äº† Flink ä¸€æ®µæ—¶é—´äº†ï¼Œè¿™å—ä¸­æ–‡èµ„æ–™ç›®å‰ä¹¦ç±æ˜¯åªæœ‰ä¸€æœ¬å¾ˆè–„çš„ï¼Œè‹±æ–‡ä¹¦ç±ä¹Ÿæ˜¯ä¸‰æœ¬ä¸è¶…è¿‡ã€‚ æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·äº†ã€‚ä½ å¯ä»¥å…³æ³¨æˆ‘çš„å…¬ä¼—å·ï¼šzhishengï¼Œç„¶åå›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚ å¦å¤–è¿™é‡Œä¹Ÿæ¨èä¸€äº›åšå®¢å¯ä»¥çœ‹çœ‹ï¼š 1ã€å®˜ç½‘ï¼šhttps://flink.apache.org/ 2ã€GitHub: https://github.com/apache/flink 3ã€https://blog.csdn.net/column/details/apacheflink.html 4ã€https://blog.csdn.net/lmalds/article/category/6263085 5ã€http://wuchong.me/ 6ã€https://blog.csdn.net/liguohuabigdata/article/category/7279020 ä¸‹é¢çš„ä»‹ç»å¯èƒ½ä¹Ÿæœ‰ä¸å°‘å‚è€ƒä»¥ä¸Šæ‰€æœ‰çš„èµ„æ–™ï¼Œæ„Ÿè°¢ä»–ä»¬ï¼åœ¨ä»‹ç» Flink å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹ æ•°æ®é›†ç±»å‹ å’Œ æ•°æ®è¿ç®—æ¨¡å‹ çš„ç§ç±»ã€‚ æ•°æ®é›†ç±»å‹æœ‰å“ªäº›å‘¢ï¼š æ— ç©·æ•°æ®é›†ï¼šæ— ç©·çš„æŒç»­é›†æˆçš„æ•°æ®é›†åˆ æœ‰ç•Œæ•°æ®é›†ï¼šæœ‰é™ä¸ä¼šæ”¹å˜çš„æ•°æ®é›†åˆ é‚£ä¹ˆé‚£äº›å¸¸è§çš„æ— ç©·æ•°æ®é›†æœ‰å“ªäº›å‘¢ï¼Ÿ ç”¨æˆ·ä¸å®¢æˆ·ç«¯çš„å®æ—¶äº¤äº’æ•°æ® åº”ç”¨å®æ—¶äº§ç”Ÿçš„æ—¥å¿— é‡‘èå¸‚åœºçš„å®æ—¶äº¤æ˜“è®°å½• â€¦ æ•°æ®è¿ç®—æ¨¡å‹æœ‰å“ªäº›å‘¢ï¼š æµå¼ï¼šåªè¦æ•°æ®ä¸€ç›´åœ¨äº§ç”Ÿï¼Œè®¡ç®—å°±æŒç»­åœ°è¿›è¡Œ æ‰¹å¤„ç†ï¼šåœ¨é¢„å…ˆå®šä¹‰çš„æ—¶é—´å†…è¿è¡Œè®¡ç®—ï¼Œå½“å®Œæˆæ—¶é‡Šæ”¾è®¡ç®—æœºèµ„æº Flink å®ƒå¯ä»¥å¤„ç†æœ‰ç•Œçš„æ•°æ®é›†ã€ä¹Ÿå¯ä»¥å¤„ç†æ— ç•Œçš„æ•°æ®é›†ã€å®ƒå¯ä»¥æµå¼çš„å¤„ç†æ•°æ®ã€ä¹Ÿå¯ä»¥æ‰¹é‡çš„å¤„ç†æ•°æ®ã€‚ Flink æ˜¯ä»€ä¹ˆ ï¼Ÿ ä¸Šé¢ä¸‰å¼ å›¾è½¬è‡ª äº‘é‚ª æˆéƒ½ç«™ ã€ŠFlink æŠ€æœ¯ä»‹ç»ä¸æœªæ¥å±•æœ›ã€‹ï¼Œä¾µåˆ ã€‚ ä»ä¸‹è‡³ä¸Šï¼ŒFlink æ•´ä½“ç»“æ„ ä»ä¸‹è‡³ä¸Šï¼š 1ã€éƒ¨ç½²ï¼šFlink æ”¯æŒæœ¬åœ°è¿è¡Œã€èƒ½åœ¨ç‹¬ç«‹é›†ç¾¤æˆ–è€…åœ¨è¢« YARN æˆ– Mesos ç®¡ç†çš„é›†ç¾¤ä¸Šè¿è¡Œï¼Œ ä¹Ÿèƒ½éƒ¨ç½²åœ¨äº‘ä¸Šã€‚ 2ã€è¿è¡Œï¼šFlink çš„æ ¸å¿ƒæ˜¯åˆ†å¸ƒå¼æµå¼æ•°æ®å¼•æ“ï¼Œæ„å‘³ç€æ•°æ®ä»¥ä¸€æ¬¡ä¸€ä¸ªäº‹ä»¶çš„å½¢å¼è¢«å¤„ç†ã€‚ 3ã€APIï¼šDataStreamã€DataSetã€Tableã€SQL APIã€‚ 4ã€æ‰©å±•åº“ï¼šFlink è¿˜åŒ…æ‹¬ç”¨äºå¤æ‚äº‹ä»¶å¤„ç†ï¼Œæœºå™¨å­¦ä¹ ï¼Œå›¾å½¢å¤„ç†å’Œ Apache Storm å…¼å®¹æ€§çš„ä¸“ç”¨ä»£ç åº“ã€‚ Flink æ•°æ®æµç¼–ç¨‹æ¨¡å‹æŠ½è±¡çº§åˆ«Flink æä¾›äº†ä¸åŒçš„æŠ½è±¡çº§åˆ«ä»¥å¼€å‘æµå¼æˆ–æ‰¹å¤„ç†åº”ç”¨ã€‚ æœ€åº•å±‚æä¾›äº†æœ‰çŠ¶æ€æµã€‚å®ƒå°†é€šè¿‡ è¿‡ç¨‹å‡½æ•°ï¼ˆProcess Functionï¼‰åµŒå…¥åˆ° DataStream API ä¸­ã€‚å®ƒå…è®¸ç”¨æˆ·å¯ä»¥è‡ªç”±åœ°å¤„ç†æ¥è‡ªä¸€ä¸ªæˆ–å¤šä¸ªæµæ•°æ®çš„äº‹ä»¶ï¼Œå¹¶ä½¿ç”¨ä¸€è‡´ã€å®¹é”™çš„çŠ¶æ€ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œç”¨æˆ·å¯ä»¥æ³¨å†Œäº‹ä»¶æ—¶é—´å’Œå¤„ç†äº‹ä»¶å›è°ƒï¼Œä»è€Œä½¿ç¨‹åºå¯ä»¥å®ç°å¤æ‚çš„è®¡ç®—ã€‚ DataStream / DataSet API æ˜¯ Flink æä¾›çš„æ ¸å¿ƒ API ï¼ŒDataSet å¤„ç†æœ‰ç•Œçš„æ•°æ®é›†ï¼ŒDataStream å¤„ç†æœ‰ç•Œæˆ–è€…æ— ç•Œçš„æ•°æ®æµã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡å„ç§æ–¹æ³•ï¼ˆmap / flatmap / window / keyby / sum / max / min / avg / join ç­‰ï¼‰å°†æ•°æ®è¿›è¡Œè½¬æ¢ / è®¡ç®—ã€‚ Table API æ˜¯ä»¥ è¡¨ ä¸ºä¸­å¿ƒçš„å£°æ˜å¼ DSLï¼Œå…¶ä¸­è¡¨å¯èƒ½ä¼šåŠ¨æ€å˜åŒ–ï¼ˆåœ¨è¡¨è¾¾æµæ•°æ®æ—¶ï¼‰ã€‚Table API æä¾›äº†ä¾‹å¦‚ selectã€projectã€joinã€group-byã€aggregate ç­‰æ“ä½œï¼Œä½¿ç”¨èµ·æ¥å´æ›´åŠ ç®€æ´ï¼ˆä»£ç é‡æ›´å°‘ï¼‰ã€‚ ä½ å¯ä»¥åœ¨è¡¨ä¸ DataStream/DataSet ä¹‹é—´æ— ç¼åˆ‡æ¢ï¼Œä¹Ÿå…è®¸ç¨‹åºå°† Table API ä¸ DataStream ä»¥åŠ DataSet æ··åˆä½¿ç”¨ã€‚ Flink æä¾›çš„æœ€é«˜å±‚çº§çš„æŠ½è±¡æ˜¯ SQL ã€‚è¿™ä¸€å±‚æŠ½è±¡åœ¨è¯­æ³•ä¸è¡¨è¾¾èƒ½åŠ›ä¸Šä¸ Table API ç±»ä¼¼ï¼Œä½†æ˜¯æ˜¯ä»¥ SQLæŸ¥è¯¢è¡¨è¾¾å¼çš„å½¢å¼è¡¨ç°ç¨‹åºã€‚SQL æŠ½è±¡ä¸ Table API äº¤äº’å¯†åˆ‡ï¼ŒåŒæ—¶ SQL æŸ¥è¯¢å¯ä»¥ç›´æ¥åœ¨ Table API å®šä¹‰çš„è¡¨ä¸Šæ‰§è¡Œã€‚ Flink ç¨‹åºä¸æ•°æ®æµç»“æ„ Flink åº”ç”¨ç¨‹åºç»“æ„å°±æ˜¯å¦‚ä¸Šå›¾æ‰€ç¤ºï¼š 1ã€Source: æ•°æ®æºï¼ŒFlink åœ¨æµå¤„ç†å’Œæ‰¹å¤„ç†ä¸Šçš„ source å¤§æ¦‚æœ‰ 4 ç±»ï¼šåŸºäºæœ¬åœ°é›†åˆçš„ sourceã€åŸºäºæ–‡ä»¶çš„ sourceã€åŸºäºç½‘ç»œå¥—æ¥å­—çš„ sourceã€è‡ªå®šä¹‰çš„ sourceã€‚è‡ªå®šä¹‰çš„ source å¸¸è§çš„æœ‰ Apache kafkaã€Amazon Kinesis Streamsã€RabbitMQã€Twitter Streaming APIã€Apache NiFi ç­‰ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥å®šä¹‰è‡ªå·±çš„ sourceã€‚ 2ã€Transformationï¼šæ•°æ®è½¬æ¢çš„å„ç§æ“ä½œï¼Œæœ‰ Map / FlatMap / Filter / KeyBy / Reduce / Fold / Aggregations / Window / WindowAll / Union / Window join / Split / Select / Project ç­‰ï¼Œæ“ä½œå¾ˆå¤šï¼Œå¯ä»¥å°†æ•°æ®è½¬æ¢è®¡ç®—æˆä½ æƒ³è¦çš„æ•°æ®ã€‚ 3ã€Sinkï¼šæ¥æ”¶å™¨ï¼ŒFlink å°†è½¬æ¢è®¡ç®—åçš„æ•°æ®å‘é€çš„åœ°ç‚¹ ï¼Œä½ å¯èƒ½éœ€è¦å­˜å‚¨ä¸‹æ¥ï¼ŒFlink å¸¸è§çš„ Sink å¤§æ¦‚æœ‰å¦‚ä¸‹å‡ ç±»ï¼šå†™å…¥æ–‡ä»¶ã€æ‰“å°å‡ºæ¥ã€å†™å…¥ socket ã€è‡ªå®šä¹‰çš„ sink ã€‚è‡ªå®šä¹‰çš„ sink å¸¸è§çš„æœ‰ Apache kafkaã€RabbitMQã€MySQLã€ElasticSearchã€Apache Cassandraã€Hadoop FileSystem ç­‰ï¼ŒåŒç†ä½ ä¹Ÿå¯ä»¥å®šä¹‰è‡ªå·±çš„ sinkã€‚ ä¸ºä»€ä¹ˆé€‰æ‹© Flinkï¼ŸFlink æ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼æµå¼å¤„ç†æ¡†æ¶ï¼š â‘ æä¾›å‡†ç¡®çš„ç»“æœï¼Œç”šè‡³åœ¨å‡ºç°æ— åºæˆ–è€…å»¶è¿ŸåŠ è½½çš„æ•°æ®çš„æƒ…å†µä¸‹ã€‚ â‘¡å®ƒæ˜¯çŠ¶æ€åŒ–çš„å®¹é”™çš„ï¼ŒåŒæ—¶åœ¨ç»´æŠ¤ä¸€æ¬¡å®Œæ•´çš„çš„åº”ç”¨çŠ¶æ€æ—¶ï¼Œèƒ½æ— ç¼ä¿®å¤é”™è¯¯ã€‚ â‘¢å¤§è§„æ¨¡è¿è¡Œï¼Œåœ¨ä¸Šåƒä¸ªèŠ‚ç‚¹è¿è¡Œæ—¶æœ‰å¾ˆå¥½çš„ååé‡å’Œä½å»¶è¿Ÿã€‚ æ›´æ—©çš„æ—¶å€™ï¼Œæˆ‘ä»¬è®¨è®ºäº†æ•°æ®é›†ç±»å‹ï¼ˆæœ‰ç•Œ vs æ— ç©·ï¼‰å’Œè¿ç®—æ¨¡å‹ï¼ˆæ‰¹å¤„ç† vs æµå¼ï¼‰çš„åŒ¹é…ã€‚Flink çš„æµå¼è®¡ç®—æ¨¡å‹å¯ç”¨äº†å¾ˆå¤šåŠŸèƒ½ç‰¹æ€§ï¼Œå¦‚çŠ¶æ€ç®¡ç†ï¼Œå¤„ç†æ— åºæ•°æ®ï¼Œçµæ´»çš„è§†çª—ï¼Œè¿™äº›åŠŸèƒ½å¯¹äºå¾—å‡ºæ— ç©·æ•°æ®é›†çš„ç²¾ç¡®ç»“æœæ˜¯å¾ˆé‡è¦çš„ã€‚ Flink ä¿è¯çŠ¶æ€åŒ–è®¡ç®—å¼ºä¸€è‡´æ€§ã€‚â€çŠ¶æ€åŒ–â€œæ„å‘³ç€åº”ç”¨å¯ä»¥ç»´æŠ¤éšç€æ—¶é—´æ¨ç§»å·²ç»äº§ç”Ÿçš„æ•°æ®èšåˆæˆ–è€…ï¼Œå¹¶ä¸” Filnk çš„æ£€æŸ¥ç‚¹æœºåˆ¶åœ¨ä¸€æ¬¡å¤±è´¥çš„äº‹ä»¶ä¸­ä¸€ä¸ªåº”ç”¨çŠ¶æ€çš„å¼ºä¸€è‡´æ€§ã€‚ Flink æ”¯æŒæµå¼è®¡ç®—å’Œå¸¦æœ‰äº‹ä»¶æ—¶é—´è¯­ä¹‰çš„è§†çª—ã€‚äº‹ä»¶æ—¶é—´æœºåˆ¶ä½¿å¾—é‚£äº›äº‹ä»¶æ— åºåˆ°è¾¾ç”šè‡³å»¶è¿Ÿåˆ°è¾¾çš„æ•°æ®æµèƒ½å¤Ÿè®¡ç®—å‡ºç²¾ç¡®çš„ç»“æœã€‚ é™¤äº†æä¾›æ•°æ®é©±åŠ¨çš„è§†çª—å¤–ï¼ŒFlink è¿˜æ”¯æŒåŸºäºæ—¶é—´ï¼Œè®¡æ•°ï¼Œsession ç­‰çš„çµæ´»è§†çª—ã€‚è§†çª—èƒ½å¤Ÿç”¨çµæ´»çš„è§¦å‘æ¡ä»¶å®šåˆ¶åŒ–ä»è€Œè¾¾åˆ°å¯¹å¤æ‚çš„æµä¼ è¾“æ¨¡å¼çš„æ”¯æŒã€‚Flink çš„è§†çª—ä½¿å¾—æ¨¡æ‹ŸçœŸå®çš„åˆ›å»ºæ•°æ®çš„ç¯å¢ƒæˆä¸ºå¯èƒ½ã€‚ Flink çš„å®¹é”™èƒ½åŠ›æ˜¯è½»é‡çº§çš„ï¼Œå…è®¸ç³»ç»Ÿä¿æŒé«˜å¹¶å‘ï¼ŒåŒæ—¶åœ¨ç›¸åŒæ—¶é—´å†…æä¾›å¼ºä¸€è‡´æ€§ä¿è¯ã€‚Flink ä»¥é›¶æ•°æ®ä¸¢å¤±çš„æ–¹å¼ä»æ•…éšœä¸­æ¢å¤ï¼Œä½†æ²¡æœ‰è€ƒè™‘å¯é æ€§å’Œå»¶è¿Ÿä¹‹é—´çš„æŠ˜è¡·ã€‚ Flink èƒ½æ»¡è¶³é«˜å¹¶å‘å’Œä½å»¶è¿Ÿï¼ˆè®¡ç®—å¤§é‡æ•°æ®å¾ˆå¿«ï¼‰ã€‚ä¸‹å›¾æ˜¾ç¤ºäº† Apache Flink ä¸ Apache Storm åœ¨å®Œæˆæµæ•°æ®æ¸…æ´—çš„åˆ†å¸ƒå¼ä»»åŠ¡çš„æ€§èƒ½å¯¹æ¯”ã€‚ Flink ä¿å­˜ç‚¹æä¾›äº†ä¸€ä¸ªçŠ¶æ€åŒ–çš„ç‰ˆæœ¬æœºåˆ¶ï¼Œä½¿å¾—èƒ½ä»¥æ— ä¸¢å¤±çŠ¶æ€å’Œæœ€çŸ­åœæœºæ—¶é—´çš„æ–¹å¼æ›´æ–°åº”ç”¨æˆ–è€…å›é€€å†å²æ•°æ®ã€‚ Flink è¢«è®¾è®¡æˆèƒ½ç”¨ä¸Šåƒä¸ªç‚¹åœ¨å¤§è§„æ¨¡é›†ç¾¤ä¸Šè¿è¡Œã€‚é™¤äº†æ”¯æŒç‹¬ç«‹é›†ç¾¤éƒ¨ç½²å¤–ï¼ŒFlink è¿˜æ”¯æŒ YARN å’ŒMesos æ–¹å¼éƒ¨ç½²ã€‚ Flink çš„ç¨‹åºå†…åœ¨æ˜¯å¹¶è¡Œå’Œåˆ†å¸ƒå¼çš„ï¼Œæ•°æ®æµå¯ä»¥è¢«åˆ†åŒºæˆ stream partitionsï¼Œoperators è¢«åˆ’åˆ†ä¸ºoperator subtasks; è¿™äº› subtasks åœ¨ä¸åŒçš„æœºå™¨æˆ–å®¹å™¨ä¸­åˆ†ä¸åŒçš„çº¿ç¨‹ç‹¬ç«‹è¿è¡Œï¼›operator subtasks çš„æ•°é‡åœ¨å…·ä½“çš„ operator å°±æ˜¯å¹¶è¡Œè®¡ç®—æ•°ï¼Œç¨‹åºä¸åŒçš„ operator é˜¶æ®µå¯èƒ½æœ‰ä¸åŒçš„å¹¶è¡Œæ•°ï¼›å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œsource operator çš„å¹¶è¡Œæ•°ä¸º 2ï¼Œä½†æœ€åçš„ sink operator ä¸º1ï¼› è‡ªå·±çš„å†…å­˜ç®¡ç† Flink åœ¨ JVM ä¸­æä¾›äº†è‡ªå·±çš„å†…å­˜ç®¡ç†ï¼Œä½¿å…¶ç‹¬ç«‹äº Java çš„é»˜è®¤åƒåœ¾æ”¶é›†å™¨ã€‚ å®ƒé€šè¿‡ä½¿ç”¨æ•£åˆ—ï¼Œç´¢å¼•ï¼Œç¼“å­˜å’Œæ’åºæœ‰æ•ˆåœ°è¿›è¡Œå†…å­˜ç®¡ç†ã€‚ ä¸°å¯Œçš„åº“ Flink æ‹¥æœ‰ä¸°å¯Œçš„åº“æ¥è¿›è¡Œæœºå™¨å­¦ä¹ ï¼Œå›¾å½¢å¤„ç†ï¼Œå…³ç³»æ•°æ®å¤„ç†ç­‰ã€‚ ç”±äºå…¶æ¶æ„ï¼Œå¾ˆå®¹æ˜“æ‰§è¡Œå¤æ‚çš„äº‹ä»¶å¤„ç†å’Œè­¦æŠ¥ã€‚ åˆ†å¸ƒå¼è¿è¡Œflink ä½œä¸šæäº¤æ¶æ„æµç¨‹å¯è§ä¸‹å›¾ï¼š 1ã€Program Codeï¼šæˆ‘ä»¬ç¼–å†™çš„ Flink åº”ç”¨ç¨‹åºä»£ç  2ã€Job Clientï¼šJob Client ä¸æ˜¯ Flink ç¨‹åºæ‰§è¡Œçš„å†…éƒ¨éƒ¨åˆ†ï¼Œä½†å®ƒæ˜¯ä»»åŠ¡æ‰§è¡Œçš„èµ·ç‚¹ã€‚ Job Client è´Ÿè´£æ¥å—ç”¨æˆ·çš„ç¨‹åºä»£ç ï¼Œç„¶ååˆ›å»ºæ•°æ®æµï¼Œå°†æ•°æ®æµæäº¤ç»™ Job Manager ä»¥ä¾¿è¿›ä¸€æ­¥æ‰§è¡Œã€‚ æ‰§è¡Œå®Œæˆåï¼ŒJob Client å°†ç»“æœè¿”å›ç»™ç”¨æˆ· 3ã€Job Managerï¼šä¸»è¿›ç¨‹ï¼ˆä¹Ÿç§°ä¸ºä½œä¸šç®¡ç†å™¨ï¼‰åè°ƒå’Œç®¡ç†ç¨‹åºçš„æ‰§è¡Œã€‚ å®ƒçš„ä¸»è¦èŒè´£åŒ…æ‹¬å®‰æ’ä»»åŠ¡ï¼Œç®¡ç†checkpoint ï¼Œæ•…éšœæ¢å¤ç­‰ã€‚æœºå™¨é›†ç¾¤ä¸­è‡³å°‘è¦æœ‰ä¸€ä¸ª masterï¼Œmaster è´Ÿè´£è°ƒåº¦ taskï¼Œåè°ƒ checkpoints å’Œå®¹ç¾ï¼Œé«˜å¯ç”¨è®¾ç½®çš„è¯å¯ä»¥æœ‰å¤šä¸ª masterï¼Œä½†è¦ä¿è¯ä¸€ä¸ªæ˜¯ leader, å…¶ä»–æ˜¯ standby; Job Manager åŒ…å« Actor systemã€Schedulerã€Check pointing ä¸‰ä¸ªé‡è¦çš„ç»„ä»¶ 4ã€Task Managerï¼šä» Job Manager å¤„æ¥æ”¶éœ€è¦éƒ¨ç½²çš„ Taskã€‚Task Manager æ˜¯åœ¨ JVM ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œä»»åŠ¡çš„å·¥ä½œèŠ‚ç‚¹ã€‚ ä»»åŠ¡æ‰§è¡Œçš„å¹¶è¡Œæ€§ç”±æ¯ä¸ª Task Manager ä¸Šå¯ç”¨çš„ä»»åŠ¡æ§½å†³å®šã€‚ æ¯ä¸ªä»»åŠ¡ä»£è¡¨åˆ†é…ç»™ä»»åŠ¡æ§½çš„ä¸€ç»„èµ„æºã€‚ ä¾‹å¦‚ï¼Œå¦‚æœ Task Manager æœ‰å››ä¸ªæ’æ§½ï¼Œé‚£ä¹ˆå®ƒå°†ä¸ºæ¯ä¸ªæ’æ§½åˆ†é… 25ï¼… çš„å†…å­˜ã€‚ å¯ä»¥åœ¨ä»»åŠ¡æ§½ä¸­è¿è¡Œä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ã€‚ åŒä¸€æ’æ§½ä¸­çš„çº¿ç¨‹å…±äº«ç›¸åŒçš„ JVMã€‚ åŒä¸€ JVM ä¸­çš„ä»»åŠ¡å…±äº« TCP è¿æ¥å’Œå¿ƒè·³æ¶ˆæ¯ã€‚Task Manager çš„ä¸€ä¸ª Slot ä»£è¡¨ä¸€ä¸ªå¯ç”¨çº¿ç¨‹ï¼Œè¯¥çº¿ç¨‹å…·æœ‰å›ºå®šçš„å†…å­˜ï¼Œæ³¨æ„ Slot åªå¯¹å†…å­˜éš”ç¦»ï¼Œæ²¡æœ‰å¯¹ CPU éš”ç¦»ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒFlink å…è®¸å­ä»»åŠ¡å…±äº« Slotï¼Œå³ä½¿å®ƒä»¬æ˜¯ä¸åŒ task çš„ subtaskï¼Œåªè¦å®ƒä»¬æ¥è‡ªç›¸åŒçš„ jobã€‚è¿™ç§å…±äº«å¯ä»¥æœ‰æ›´å¥½çš„èµ„æºåˆ©ç”¨ç‡ã€‚ æœ€åæœ¬æ–‡ä¸»è¦è®²äº†æˆ‘æ¥è§¦åˆ° Flink çš„ç¼˜ç”±ï¼Œç„¶åä»æ•°æ®é›†ç±»å‹å’Œæ•°æ®è¿ç®—æ¨¡å‹å¼€å§‹è®²èµ·ï¼Œæ¥ç€ä»‹ç»äº†ä¸‹ Flink æ˜¯ä»€ä¹ˆã€Flink çš„æ•´ä½“æ¶æ„ã€æä¾›çš„ APIã€Flink çš„ä¼˜ç‚¹æ‰€åœ¨ä»¥åŠ Flink çš„åˆ†å¸ƒå¼ä½œä¸šè¿è¡Œçš„æ–¹å¼ã€‚æ°´æ–‡ä¸€ç¯‡ï¼Œå¸Œæœ›ä½ èƒ½å¤Ÿå¯¹ Flink ç¨å¾®æœ‰ä¸€ç‚¹æ¦‚å¿µäº†ã€‚ å…³æ³¨æˆ‘è½¬è½½è¯·åŠ¡å¿…æ³¨æ˜åŸåˆ›åœ°å€ä¸ºï¼šhttp://www.54tianzhisheng.cn/2018/10/13/flink-introduction/ å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f Github ä»£ç ä»“åº“https://github.com/zhisheng17/flink-learning/ ä»¥åè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç éƒ½å°†æ”¾åœ¨è¿™ä¸ªä»“åº“é‡Œï¼ŒåŒ…å«äº†è‡ªå·±å­¦ä¹  flink çš„ä¸€äº› demo å’Œåšå®¢ åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€å®æˆ˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"Flink ä» 0 åˆ° 1 å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨","date":"2018-09-17T16:00:00.000Z","path":"2018/09/18/flink-install/","text":"å‡†å¤‡å·¥ä½œ1ã€å®‰è£…æŸ¥çœ‹ Java çš„ç‰ˆæœ¬å·ï¼Œæ¨èä½¿ç”¨ Java 8ã€‚ å®‰è£… Flink2ã€åœ¨ Mac OS X ä¸Šå®‰è£… Flink æ˜¯éå¸¸æ–¹ä¾¿çš„ã€‚æ¨èé€šè¿‡ homebrew æ¥å®‰è£…ã€‚ 1brew install apache-flink 3ã€æ£€æŸ¥å®‰è£…ï¼š 1flink --version ç»“æœï¼š 1Version: 1.6.0, Commit ID: ff472b4 4ã€å¯åŠ¨ flink 1234zhisheng@zhisheng î‚° /usr/local/Cellar/apache-flink/1.6.0/libexec/bin î‚° ./start-cluster.shStarting cluster.Starting standalonesession daemon on host zhisheng.Starting taskexecutor daemon on host zhisheng. æ¥ç€å°±å¯ä»¥è¿›å…¥ web é¡µé¢(http://localhost:8081/) æŸ¥çœ‹ demo1ã€æ–°å»ºä¸€ä¸ª maven é¡¹ç›® åˆ›å»ºä¸€ä¸ª SocketTextStreamWordCount æ–‡ä»¶ï¼ŒåŠ å…¥ä»¥ä¸‹ä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253package com.zhisheng.flink;import org.apache.flink.api.common.functions.FlatMapFunction;import org.apache.flink.api.java.tuple.Tuple2;import org.apache.flink.streaming.api.datastream.DataStreamSource;import org.apache.flink.streaming.api.datastream.SingleOutputStreamOperator;import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;import org.apache.flink.util.Collector;/** * Created by zhisheng_tian on 2018/9/18 */public class SocketTextStreamWordCount &#123; public static void main(String[] args) throws Exception &#123; //å‚æ•°æ£€æŸ¥ if (args.length != 2) &#123; System.err.println(\"USAGE:\\nSocketTextStreamWordCount &lt;hostname&gt; &lt;port&gt;\"); return; &#125; String hostname = args[0]; Integer port = Integer.parseInt(args[1]); // set up the streaming execution environment final StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment(); //è·å–æ•°æ® DataStreamSource&lt;String&gt; stream = env.socketTextStream(hostname, port); //è®¡æ•° SingleOutputStreamOperator&lt;Tuple2&lt;String, Integer&gt;&gt; sum = stream.flatMap(new LineSplitter()) .keyBy(0) .sum(1); sum.print(); env.execute(\"Java WordCount from SocketTextStream Example\"); &#125; public static final class LineSplitter implements FlatMapFunction&lt;String, Tuple2&lt;String, Integer&gt;&gt; &#123; @Override public void flatMap(String s, Collector&lt;Tuple2&lt;String, Integer&gt;&gt; collector) &#123; String[] tokens = s.toLowerCase().split(\"\\\\W+\"); for (String token: tokens) &#123; if (token.length() &gt; 0) &#123; collector.collect(new Tuple2&lt;String, Integer&gt;(token, 1)); &#125; &#125; &#125; &#125;&#125; æ¥ç€è¿›å…¥å·¥ç¨‹ç›®å½•ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ‰“åŒ…ã€‚ 1mvn clean package -Dmaven.test.skip=true ç„¶åæˆ‘ä»¬å¼€å¯ç›‘å¬ 9000 ç«¯å£: 1nc -l 9000 æœ€åè¿›å…¥ flink å®‰è£…ç›®å½• bin ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤è·‘ç¨‹åºï¼š 1flink run -c com.zhisheng.flink.SocketTextStreamWordCount /Users/zhisheng/IdeaProjects/flink/word-count/target/original-word-count-1.0-SNAPSHOT.jar 127.0.0.1 9000 æ³¨æ„æ¢æˆä½ è‡ªå·±é¡¹ç›®çš„è·¯å¾„ã€‚ æ‰§è¡Œå®Œä¸Šè¿°å‘½ä»¤åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ webUI ä¸­çœ‹åˆ°æ­£åœ¨è¿è¡Œçš„ç¨‹åºï¼š æˆ‘ä»¬å¯ä»¥åœ¨ nc ç›‘å¬ç«¯å£ä¸­è¾“å…¥ textï¼Œæ¯”å¦‚ï¼š ç„¶åæˆ‘ä»¬é€šè¿‡ tail å‘½ä»¤çœ‹ä¸€ä¸‹è¾“å‡ºçš„ log æ–‡ä»¶ï¼Œæ¥è§‚å¯Ÿç»Ÿè®¡ç»“æœã€‚è¿›å…¥ç›®å½• apache-flink/1.6.0/libexec/logï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤: 1tail -f flink-zhisheng-taskexecutor-0-zhisheng.out æ³¨æ„ï¼šåˆ‡æ¢æˆä½ è‡ªå·±çš„è·¯å¾„å’ŒæŸ¥çœ‹è‡ªå·±çš„ç›®å½•ã€‚ æ€»ç»“æœ¬æ–‡æè¿°äº†å¦‚ä½•åœ¨ Mac ç”µè„‘ä¸Šå®‰è£… Flinkï¼ŒåŠè¿è¡Œå®ƒã€‚æ¥ç€é€šè¿‡ä¸€ä¸ªç®€å•çš„ Flink ç¨‹åºæ¥ä»‹ç»å¦‚ä½•æ„å»ºåŠè¿è¡ŒFlink ç¨‹åºã€‚ å…³æ³¨æˆ‘è½¬è½½è¯·æ³¨æ˜åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2018/09/18/flink-install å¾®ä¿¡å…¬ä¼—å·ï¼šzhisheng å¦å¤–æˆ‘è‡ªå·±æ•´ç†äº†äº› Flink çš„å­¦ä¹ èµ„æ–™ï¼Œç›®å‰å·²ç»å…¨éƒ¨æ”¾åˆ°å¾®ä¿¡å…¬ä¼—å·ï¼ˆzhishengï¼‰äº†ï¼Œä½ å¯ä»¥å›å¤å…³é”®å­—ï¼šFlink å³å¯æ— æ¡ä»¶è·å–åˆ°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ ä½ å¯ä»¥åŠ æˆ‘çš„å¾®ä¿¡ï¼šyuanblog_tzsï¼Œæ¢è®¨æŠ€æœ¯ï¼ æ›´å¤šç§å¯†èµ„æ–™è¯·åŠ å…¥çŸ¥è¯†æ˜Ÿçƒï¼ ä¸“æ ä»‹ç»æ‰«ç ä¸‹é¢ä¸“æ äºŒç»´ç å¯ä»¥è®¢é˜…è¯¥ä¸“æ  é¦–å‘åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2019/11/15/flink-in-action/ ä¸“æ åœ°å€ï¼šhttps://gitbook.cn/gitchat/column/5dad4a20669f843a1a37cb4f Github ä»£ç ä»“åº“https://github.com/zhisheng17/flink-learning/ ä»¥åè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç éƒ½å°†æ”¾åœ¨è¿™ä¸ªä»“åº“é‡Œï¼ŒåŒ…å«äº†è‡ªå·±å­¦ä¹  flink çš„ä¸€äº› demo å’Œåšå®¢ åšå®¢1ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Apache Flink ä»‹ç» 2ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Mac ä¸Šæ­å»º Flink 1.6.0 ç¯å¢ƒå¹¶æ„å»ºè¿è¡Œç®€å•ç¨‹åºå…¥é—¨ 3ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é…ç½®æ–‡ä»¶è¯¦è§£ 4ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Source ä»‹ç» 5ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Source ï¼Ÿ 6ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Data Sink ä»‹ç» 7ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•è‡ªå®šä¹‰ Data Sink ï¼Ÿ 8ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink Data transformation(è½¬æ¢) 9ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä»‹ç» Flink ä¸­çš„ Stream Windows 10ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­çš„å‡ ç§ Time è¯¦è§£ 11ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° ElasticSearch 12ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Ÿ 13ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Kafka 14ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink JobManager é«˜å¯ç”¨æ€§é…ç½® 15ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink parallelism å’Œ Slot ä»‹ç» 16ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®æ‰¹é‡å†™å…¥åˆ° MySQL 17ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RabbitMQ 18ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HBase 19ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° HDFS 20ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Redis 21ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Cassandra 22ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° Flume 23ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° InfluxDB 24ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink è¯»å– Kafka æ•°æ®å†™å…¥åˆ° RocketMQ 25ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ ä¸Šä¼ çš„ jar åŒ…è—åˆ°å“ªé‡Œå»äº† 26ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” ä½ çš„ Flink job æ—¥å¿—è·‘åˆ°å“ªé‡Œå»äº† 27ã€é˜¿é‡Œå·´å·´å¼€æºçš„ Blink å®æ—¶è®¡ç®—æ¡†æ¶çœŸé¦™ 28ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” Flink ä¸­å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ 29ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” Flink ä¸å¯ä»¥è¿ç»­ Split(åˆ†æµ)ï¼Ÿ 30ã€Flink ä»0åˆ°1å­¦ä¹ â€”â€” åˆ†äº«å››æœ¬ Flink å›½å¤–çš„ä¹¦å’ŒäºŒåå¤šç¯‡ Paper è®ºæ–‡ 31ã€Flink æ¶æ„ã€åŸç†ä¸éƒ¨ç½²æµ‹è¯• 32ã€ä¸ºä»€ä¹ˆè¯´æµå¤„ç†å³æœªæ¥ï¼Ÿ 33ã€OPPO æ•°æ®ä¸­å°ä¹‹åŸºçŸ³ï¼šåŸºäº Flink SQL æ„å»ºå®æ—¶æ•°æ®ä»“åº“ 34ã€æµè®¡ç®—æ¡†æ¶ Flink ä¸ Storm çš„æ€§èƒ½å¯¹æ¯” 35ã€FlinkçŠ¶æ€ç®¡ç†å’Œå®¹é”™æœºåˆ¶ä»‹ç» 36ã€Apache Flink ç»“åˆ Kafka æ„å»ºç«¯åˆ°ç«¯çš„ Exactly-Once å¤„ç† 37ã€360æ·±åº¦å®è·µï¼šFlinkä¸Stormåè®®çº§å¯¹æ¯” 38ã€å¦‚ä½•åŸºäºFlink+TensorFlowæ‰“é€ å®æ—¶æ™ºèƒ½å¼‚å¸¸æ£€æµ‹å¹³å°ï¼Ÿåªçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† 39ã€Apache Flink 1.9 é‡å¤§ç‰¹æ€§æå‰è§£è¯» 40ã€Flink å…¨ç½‘æœ€å…¨èµ„æºï¼ˆè§†é¢‘ã€åšå®¢ã€PPTã€å…¥é—¨ã€å®æˆ˜ã€æºç è§£æã€é—®ç­”ç­‰æŒç»­æ›´æ–°ï¼‰ 41ã€Flink çµé­‚ä¸¤ç™¾é—®ï¼Œè¿™è°é¡¶å¾—ä½ï¼Ÿ 42ã€Flink ä»0åˆ°1å­¦ä¹  â€”â€” å¦‚ä½•ä½¿ç”¨ Side Output æ¥åˆ†æµï¼Ÿ 43ã€ä½ å…¬å¸åˆ°åº•éœ€ä¸éœ€è¦å¼•å…¥å®æ—¶è®¡ç®—å¼•æ“ï¼Ÿ 44ã€ä¸€æ–‡è®©ä½ å½»åº•äº†è§£å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ Flink æºç è§£æ1ã€Flink æºç è§£æ â€”â€” æºç ç¼–è¯‘è¿è¡Œ 2ã€Flink æºç è§£æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆ 3ã€Flink æºç è§£æâ€”â€” local æ¨¡å¼å¯åŠ¨æµç¨‹ 4ã€Flink æºç è§£æ â€”â€” standalone session æ¨¡å¼å¯åŠ¨æµç¨‹ 5ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Job Manager å¯åŠ¨ 6ã€Flink æºç è§£æ â€”â€” Standalone Session Cluster å¯åŠ¨æµç¨‹æ·±åº¦åˆ†æä¹‹ Task Manager å¯åŠ¨ 7ã€Flink æºç è§£æ â€”â€” åˆ†æ Batch WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 8ã€Flink æºç è§£æ â€”â€” åˆ†æ Streaming WordCount ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ 9ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– JobGraphï¼Ÿ 10ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– StreamGraphï¼Ÿ 11ã€Flink æºç è§£æ â€”â€” Flink JobManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 12ã€Flink æºç è§£æ â€”â€” Flink TaskManager æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ 13ã€Flink æºç è§£æ â€”â€” JobManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 14ã€Flink æºç è§£æ â€”â€” TaskManager å¤„ç† SubmitJob çš„è¿‡ç¨‹ 15ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink Checkpoint æœºåˆ¶ 16ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink åºåˆ—åŒ–æœºåˆ¶ 17ã€Flink æºç è§£æ â€”â€” æ·±åº¦è§£æ Flink æ˜¯å¦‚ä½•ç®¡ç†å¥½å†…å­˜çš„ï¼Ÿ 18ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-core 19ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-datadog 20ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-dropwizard 21ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-graphite 22ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-influxdb 23ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-jmx 24ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-slf4j 25ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-statsd 26ã€Flink Metrics æºç è§£æ â€”â€” Flink-metrics-prometheus 26ã€Flink Annotations æºç è§£æ 27ã€Flink æºç è§£æ â€”â€” å¦‚ä½•è·å– ExecutionGraph ï¼Ÿ 28ã€å¤§æ•°æ®é‡ç£…ç‚¸å¼¹â€”â€”å®æ—¶è®¡ç®—æ¡†æ¶ Flink 29ã€Flink Checkpoint-\u0007\bè½»é‡çº§åˆ†å¸ƒå¼å¿«ç…§ 30ã€Flink Clients æºç è§£æ","tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://www.54tianzhisheng.cn/tags/å¤§æ•°æ®/"},{"name":"Flink","slug":"Flink","permalink":"http://www.54tianzhisheng.cn/tags/Flink/"},{"name":"æµå¼è®¡ç®—","slug":"æµå¼è®¡ç®—","permalink":"http://www.54tianzhisheng.cn/tags/æµå¼è®¡ç®—/"}]},{"title":"Go å¹¶å‘â€”â€”å®ç°åç¨‹åŒæ­¥çš„å‡ ç§æ–¹å¼","date":"2018-08-29T16:00:00.000Z","path":"2018/08/30/go-sync/","text":"å‰è¨€Java ä¸­æœ‰ä¸€ç³»åˆ—çš„çº¿ç¨‹åŒæ­¥çš„æ–¹æ³•ï¼Œgo é‡Œé¢æœ‰ goroutineï¼ˆåç¨‹ï¼‰ï¼Œå…ˆçœ‹ä¸‹ä¸‹é¢çš„ä»£ç æ‰§è¡Œçš„ç»“æœæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ 123456789101112131415package mainimport ( \"fmt\")func main() &#123; go func() &#123; fmt.Println(\"Goroutine 1\") &#125;() go func() &#123; fmt.Println(\"Goroutine 2\") &#125;()&#125; æ‰§è¡Œä»¥ä¸Šä»£ç å¾ˆå¯èƒ½çœ‹ä¸åˆ°è¾“å‡ºã€‚ å› ä¸ºæœ‰å¯èƒ½è¿™ä¸¤ä¸ªåç¨‹è¿˜æ²¡å¾—åˆ°æ‰§è¡Œï¼Œä¸»åç¨‹å°±å·²ç»ç»“æŸäº†ï¼Œè€Œä¸»åç¨‹ç»“æŸæ—¶ä¼šç»“æŸæ‰€æœ‰å…¶ä»–åç¨‹ï¼Œæ‰€ä»¥å¯¼è‡´ä»£ç è¿è¡Œçš„ç»“æœä»€ä¹ˆéƒ½æ²¡æœ‰ã€‚ ä¼°è®¡ä¸å°‘æ–°æ¥è§¦ go çš„ç«¥é‹éƒ½ä¼šå¯¹æ­¤éƒé—·ğŸ˜’ï¼Œå¯èƒ½ä¼šé—®é‚£ä¹ˆè¯¥å¦‚ä½•ç­‰å¾…ä¸»åç¨‹ä¸­åˆ›å»ºçš„åç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹åå†ç»“æŸä¸»åç¨‹å‘¢ï¼Ÿ ä¸‹é¢è¯´å‡ ç§å¯ä»¥è§£å†³çš„æ–¹æ³•ï¼š Sleep ä¸€æ®µæ—¶é—´åœ¨ main æ–¹æ³•é€€å‡ºä¹‹å‰ sleep ä¸€æ®µæ—¶é—´å°±å¯èƒ½ä¼šå‡ºç°ç»“æœäº†ï¼Œå¦‚ä¸‹ä»£ç ï¼š 123456789101112131415161718package mainimport ( \"fmt\" \"time\")func main() &#123; go func() &#123; fmt.Println(\"Goroutine 1\") &#125;() go func() &#123; fmt.Println(\"Goroutine 2\") &#125;() time.Sleep(time.Second * 1) // ç¡çœ 1ç§’ï¼Œç­‰å¾…ä¸Šé¢ä¸¤ä¸ªåç¨‹ç»“æŸ&#125; è¿™ä¸¤ä¸ªç®€å•çš„åç¨‹æ‰§è¡Œæ¶ˆè€—çš„æ—¶é—´å¾ˆçŸ­çš„ï¼Œæ‰€ä»¥ä½ ä¼šå‘ç°ç°åœ¨å°±æœ‰ç»“æœå‡ºç°äº†ã€‚ 12Goroutine 1Goroutine 2 ä¸ºä»€ä¹ˆä¸Šé¢æˆ‘è¦è¯´ â€œå¯èƒ½ä¼šå‡ºç°â€ ï¼Ÿ å› ä¸º sleep è¿™ä¸ªæ—¶é—´ç›®å‰æ˜¯è®¾ç½®çš„ 1sï¼Œå¦‚æœæˆ‘è¿™ä¸¤ä¸ªåç¨‹é‡Œé¢æ‰§è¡Œäº†å¾ˆå¤æ‚çš„é€»è¾‘æ“ä½œï¼ˆæ—¶é—´å¤§äº 1sï¼‰ï¼Œé‚£ä¹ˆå°±ä¼šå‘ç°ä¾æ—§ä¹Ÿæ˜¯æ— ç»“æœæ‰“å°å‡ºæ¥çš„ã€‚ é‚£ä¹ˆå°±å¯ä»¥å‘ç°è¿™ç§æ–¹å¼å¾—åˆ°é—®é¢˜æ‰€åœ¨äº†ï¼šæˆ‘ä»¬æ— æ³•ç¡®å®šéœ€è¦ç¡çœ å¤šä¹… ä¸Šé¢é‚£ç§æ–¹å¼æœ‰é—®é¢˜ï¼Œgo é‡Œé¢å…¶å®ä¹Ÿå¯ä»¥ç”¨ç®¡é“æ¥å®ç°åŒæ­¥çš„ã€‚ ç®¡é“å®ç°åŒæ­¥é‚£ä¹ˆç”¨ç®¡é“æ€ä¹ˆå®ç°åŒæ­¥å‘¢ï¼Ÿshow codeï¼š 123456789101112131415161718192021222324252627282930package mainimport ( \"fmt\")func main() &#123; ch := make(chan struct&#123;&#125;) count := 2 // count è¡¨ç¤ºæ´»åŠ¨çš„åç¨‹ä¸ªæ•° go func() &#123; fmt.Println(\"Goroutine 1\") ch &lt;- struct&#123;&#125;&#123;&#125; // åç¨‹ç»“æŸï¼Œå‘å‡ºä¿¡å· &#125;() go func() &#123; fmt.Println(\"Goroutine 2\") ch &lt;- struct&#123;&#125;&#123;&#125; // åç¨‹ç»“æŸï¼Œå‘å‡ºä¿¡å· &#125;() for range ch &#123; // æ¯æ¬¡ä»chä¸­æ¥æ”¶æ•°æ®ï¼Œè¡¨æ˜ä¸€ä¸ªæ´»åŠ¨çš„åç¨‹ç»“æŸ count-- // å½“æ‰€æœ‰æ´»åŠ¨çš„åç¨‹éƒ½ç»“æŸæ—¶ï¼Œå…³é—­ç®¡é“ if count == 0 &#123; close(ch) &#125; &#125;&#125; è¿™ç§æ–¹å¼æ˜¯ä¸€ç§æ¯”è¾ƒå®Œç¾çš„è§£å†³æ–¹æ¡ˆï¼Œ goroutine / channel å®ƒä»¬ä¹Ÿæ˜¯åœ¨ go é‡Œé¢ç»å¸¸æ­é…åœ¨ä¸€èµ·çš„ä¸€å¯¹ã€‚ sync.WaitGroupå…¶å® go é‡Œé¢ä¹Ÿæä¾›äº†æ›´ç®€å•çš„æ–¹å¼ â€”â€” ä½¿ç”¨ sync.WaitGroupã€‚ WaitGroup é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ç”¨æ¥ç­‰å¾…ä¸€ç»„æ“ä½œå®Œæˆçš„ã€‚WaitGroup å†…éƒ¨å®ç°äº†ä¸€ä¸ªè®¡æ•°å™¨ï¼Œç”¨æ¥è®°å½•æœªå®Œæˆçš„æ“ä½œä¸ªæ•°ï¼Œå®ƒæä¾›äº†ä¸‰ä¸ªæ–¹æ³•ï¼š Add() ç”¨æ¥æ·»åŠ è®¡æ•° Done() ç”¨æ¥åœ¨æ“ä½œç»“æŸæ—¶è°ƒç”¨ï¼Œä½¿è®¡æ•°å‡ä¸€ Wait() ç”¨æ¥ç­‰å¾…æ‰€æœ‰çš„æ“ä½œç»“æŸï¼Œå³è®¡æ•°å˜ä¸º 0ï¼Œè¯¥å‡½æ•°ä¼šåœ¨è®¡æ•°ä¸ä¸º 0 æ—¶ç­‰å¾…ï¼Œåœ¨è®¡æ•°ä¸º 0 æ—¶ç«‹å³è¿”å› ç»§ç»­ show codeï¼š 123456789101112131415161718192021222324package mainimport ( \"fmt\" \"sync\")func main() &#123; var wg sync.WaitGroup wg.Add(2) // å› ä¸ºæœ‰ä¸¤ä¸ªåŠ¨ä½œï¼Œæ‰€ä»¥å¢åŠ 2ä¸ªè®¡æ•° go func() &#123; fmt.Println(\"Goroutine 1\") wg.Done() // æ“ä½œå®Œæˆï¼Œå‡å°‘ä¸€ä¸ªè®¡æ•° &#125;() go func() &#123; fmt.Println(\"Goroutine 2\") wg.Done() // æ“ä½œå®Œæˆï¼Œå‡å°‘ä¸€ä¸ªè®¡æ•° &#125;() wg.Wait() // ç­‰å¾…ï¼Œç›´åˆ°è®¡æ•°ä¸º0&#125; ä½ ä¼šå‘ç°ä¹Ÿæ˜¯å¯ä»¥çœ‹åˆ°è¿è¡Œç»“æœçš„ï¼Œæ˜¯ä¸æ˜¯å‘ç°è¿™ç§æ–¹å¼æ˜¯å¾ˆç®€å•çš„ã€‚ æ€»ç»“å¤šçœ‹åˆ«äººå†™çš„ä»£ç ï¼›å¤šæƒ³æƒ³ä¸ºå•¥è¦è¿™æ ·å†™ï¼›å¤šæŸ¥è‡ªå·±ä¸ç†è§£çš„åœ°æ–¹ï¼›å¤šå†™ demo æµ‹è¯•ï¼›å¤šå†™æ–‡ç« æ€»ç»“ã€‚ å…³æ³¨æˆ‘ æœ¬æ–‡åœ°å€ä¸ºï¼šhttp://www.54tianzhisheng.cn/2018/08/30/go-sync/ ï¼Œè½¬è½½è¯·æ³¨æ˜åŸæ–‡å‡ºå¤„ï¼","tags":[{"name":"GO","slug":"GO","permalink":"http://www.54tianzhisheng.cn/tags/GO/"}]},{"title":"æ•™ä½ å¦‚ä½•åœ¨ IDEA è¿œç¨‹ Debug ElasticSearch","date":"2018-08-13T16:00:00.000Z","path":"2018/08/14/idea-remote-debug-elasticsearch/","text":"å‰æä¹‹å‰åœ¨æºç é˜…è¯»ç¯å¢ƒæ­å»ºæ–‡ç« ä¸­å†™è¿‡æˆ‘é‡åˆ°çš„ä¸€ä¸ªé—®é¢˜è¿Ÿè¿Ÿæ²¡æœ‰è§£å†³ï¼Œä¹Ÿä¸€ç›´å›°æ‰°ç€æˆ‘ã€‚é—®é¢˜å¦‚ä¸‹ï¼Œåœ¨å¯åŠ¨çš„æ—¶å€™è§£å†³æ‰å…¶ä»–å¼‚å¸¸å’ŒæŠ¥é”™åï¼Œæœ€åå‰©ä¸‹è¿™ä¸ªé”™è¯¯ä¸€ç›´è§£å†³ä¸äº†ï¼š 12345678910111213141516171819202122[2018-08-01T09:44:27,370][ERROR][o.e.b.ElasticsearchUncaughtExceptionHandler] [] fatal error in thread [main], exitingjava.lang.NoClassDefFoundError: org/elasticsearch/plugins/ExtendedPluginsClassLoader at org.elasticsearch.plugins.PluginsService.loadBundle(PluginsService.java:632) ~[main/:?] at org.elasticsearch.plugins.PluginsService.loadBundles(PluginsService.java:557) ~[main/:?] at org.elasticsearch.plugins.PluginsService.&lt;init&gt;(PluginsService.java:162) ~[main/:?] at org.elasticsearch.node.Node.&lt;init&gt;(Node.java:311) ~[main/:?] at org.elasticsearch.node.Node.&lt;init&gt;(Node.java:252) ~[main/:?] at org.elasticsearch.bootstrap.Bootstrap$5.&lt;init&gt;(Bootstrap.java:213) ~[main/:?] at org.elasticsearch.bootstrap.Bootstrap.setup(Bootstrap.java:213) ~[main/:?] at org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:326) ~[main/:?] at org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:136) ~[main/:?] at org.elasticsearch.bootstrap.Elasticsearch.execute(Elasticsearch.java:127) ~[main/:?] at org.elasticsearch.cli.EnvironmentAwareCommand.execute(EnvironmentAwareCommand.java:86) ~[main/:?] at org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:124) ~[main/:?] at org.elasticsearch.cli.Command.main(Command.java:90) ~[main/:?] at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:93) ~[main/:?] at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:86) ~[main/:?]Caused by: java.lang.ClassNotFoundException: org.elasticsearch.plugins.ExtendedPluginsClassLoader at jdk.internal.loader.BuiltinClassLoader.loadClass(BuiltinClassLoader.java:582) ~[?:?] at jdk.internal.loader.ClassLoaders$AppClassLoader.loadClass(ClassLoaders.java:190) ~[?:?] at java.lang.ClassLoader.loadClass(ClassLoader.java:499) ~[?:?] ... 15 more ç½‘ä¸Šçš„è§£å†³åŠæ³•ä¹Ÿè¯•äº†å¾ˆå¤šéï¼ŒåŒ…æ‹¬è‡ªå·±ä¹Ÿåœ¨ GitHub issue æé—®äº†ï¼Œä¹Ÿæ²¡èƒ½è§£å†³ã€‚ç„¶ååé¢è‡ªå·±åˆ†äº«æ–‡ç« åœ¨æ˜é‡‘ä¹Ÿå‘ç°æœ‰äººå’Œæˆ‘æœ‰åŒæ ·çš„é—®é¢˜ã€‚ ä¸‹é¢è®²è®²å¦ä¸€ç§å¯ä»¥è®©ä½ ç»§ç»­çœ‹æºç çš„æ–¹æ³•ã€‚ è¿œç¨‹ Debugå‰ææ¡ä»¶æ˜¯ä½ ä¹‹å‰å·²ç»æŠŠé¡¹ç›®å¯¼å…¥è¿› IDEA äº†ï¼Œå¦‚æœä½ è¿˜æ²¡äº†è§£ï¼Œè¯·çœ‹ä¹‹å‰çš„æ–‡ç« ï¼Œè¿™é‡Œä¸é‡å¤äº†ã€‚ å¯åŠ¨ä¸€ä¸ªå®ä¾‹åœ¨ä½  git æ‹‰å–ä¸‹çš„ä»£ç ï¼Œåˆ‡æ¢ä½ è¦é˜…è¯»çš„åˆ†æ”¯ä»£ç åï¼Œæ‰§è¡Œä¸‹é¢è¿™æ¡å‘½ä»¤å¯åŠ¨ä¸€ä¸ª debug çš„å®ä¾‹ï¼š 1./gradlew run --debug-jvm å¯åŠ¨ç­‰ä¼šåï¼Œå°±å¯ä»¥çœ‹åˆ°å¯åŠ¨å¥½åçš„ç«¯å£å·ä¸º 8000 äº†ã€‚ é…ç½® IDEAæ–°å»ºä¸€ä¸ªè¿œç¨‹çš„ debugï¼š é…ç½®å¦‚ä¸‹å›¾ï¼š æ¥ä¸‹æ¥ç‚¹å‡» OK å°±å¥½äº†ã€‚ ç„¶åç‚¹å‡»ä¸‹é¢çš„ debug å›¾æ ‡ï¼š å¯åŠ¨åå¦‚ä¸‹ï¼š è¿™æ—¶å°±å¯ä»¥å‘ç°æ˜¯å¯ä»¥æŠŠæ•´ä¸ªæµç¨‹å…¨å¯åŠ¨äº†ï¼Œä¹Ÿä¸ä¼šæŠ¥ä»€ä¹ˆé”™è¯¯ï¼ æµç¨‹å…¨å¯åŠ¨åï¼Œä½ ä¼šå‘ç°ç»ˆç«¯çš„æ—¥å¿—éƒ½æ‰“å°å‡ºæ¥äº†ï¼ˆæ³¨æ„ï¼šè¿™æ—¶ä¸æ˜¯æ‰“å°åœ¨ä½ çš„ IDEA æ§åˆ¶å°ï¼‰ æ€»ç»“é‡åˆ°é—®é¢˜ï¼Œå¤šæ€è€ƒï¼Œå¤šæœç´¢ï¼Œå¤šæƒ³åŠæ³•è§£å†³ï¼è¿™æ ·æ‰èƒ½å¤Ÿä¸æ–­çš„æå‡ä½ è§£å†³é—®é¢˜çš„èƒ½åŠ›ï¼ å…³æ³¨æˆ‘æœ€åè½¬è½½è¯·åŠ¡å¿…æ³¨æ˜æ–‡ç« å‡ºå¤„ä¸ºï¼š http://www.54tianzhisheng.cn/2018/08/14/idea-remote-debug-elasticsearch/ ç›¸å…³æ–‡ç« 1ã€æ¸£æ¸£èœé¸¡ä¸ºä»€ä¹ˆè¦çœ‹ ElasticSearch æºç ï¼Ÿ 2ã€æ¸£æ¸£èœé¸¡çš„ ElasticSearch æºç è§£æ â€”â€” ç¯å¢ƒæ­å»º 3ã€æ¸£æ¸£èœé¸¡çš„ ElasticSearch æºç è§£æ â€”â€” å¯åŠ¨æµç¨‹(ä¸Š) 4ã€æ¸£æ¸£èœé¸¡çš„ ElasticSearch æºç è§£æ â€”â€” å¯åŠ¨æµç¨‹(ä¸‹) 5ã€Elasticsearch ç³»åˆ—æ–‡ç« ï¼ˆä¸€ï¼‰ï¼šElasticsearch é»˜è®¤åˆ†è¯å™¨å’Œä¸­åˆ†åˆ†è¯å™¨ä¹‹é—´çš„æ¯”è¾ƒåŠä½¿ç”¨æ–¹æ³• 6ã€Elasticsearch ç³»åˆ—æ–‡ç« ï¼ˆäºŒï¼‰ï¼šå…¨æ–‡æœç´¢å¼•æ“ Elasticsearch é›†ç¾¤æ­å»ºå…¥é—¨æ•™ç¨‹ 7ã€Elasticsearch ç³»åˆ—æ–‡ç« ï¼ˆä¸‰ï¼‰ï¼šElasticSearch é›†ç¾¤ç›‘æ§ 8ã€Elasticsearch ç³»åˆ—æ–‡ç« ï¼ˆå››ï¼‰ï¼šElasticSearch å•ä¸ªèŠ‚ç‚¹ç›‘æ§ 9ã€Elasticsearch ç³»åˆ—æ–‡ç« ï¼ˆäº”ï¼‰ï¼šELK å®æ—¶æ—¥å¿—åˆ†æå¹³å°ç¯å¢ƒæ­å»º 10ã€æ•™ä½ å¦‚ä½•åœ¨ IDEA è¿œç¨‹ Debug ElasticSearch","tags":[{"name":"ElasticSearch","slug":"ElasticSearch","permalink":"http://www.54tianzhisheng.cn/tags/ElasticSearch/"}]},{"title":"æ¸£æ¸£èœé¸¡çš„ ElasticSearch æºç è§£æ â€”â€” å¯åŠ¨æµç¨‹ï¼ˆä¸‹ï¼‰","date":"2018-08-11T16:00:00.000Z","path":"2018/08/12/es-code03/","text":"å…³æ³¨æˆ‘ è½¬è½½è¯·åŠ¡å¿…æ³¨æ˜åŸåˆ›åœ°å€ä¸ºï¼šhttp://www.54tianzhisheng.cn/2018/08/12/es-code03/ å‰æä¸Šç¯‡æ–‡ç« å†™å®Œäº† ES æµç¨‹å¯åŠ¨çš„ä¸€éƒ¨åˆ†ï¼Œmain æ–¹æ³•éƒ½å…¥å£ï¼Œä»¥åŠåˆ›å»º Elasticsearch è¿è¡Œçš„å¿…é¡»ç¯å¢ƒä»¥åŠç›¸å…³é…ç½®ï¼Œæ¥ç€å°±æ˜¯åˆ›å»ºè¯¥ç¯å¢ƒçš„èŠ‚ç‚¹äº†ã€‚ Node çš„åˆ›å»ºçœ‹ä¸‹æ–°å»ºèŠ‚ç‚¹çš„ä»£ç ï¼š(ä»£ç æ¯”è¾ƒå¤šï¼Œè¿™é‡Œæ˜¯æ¯”è¾ƒå…³é”®çš„åœ°æ–¹ï¼Œæˆ‘å°±æŠŠæ³¨é‡Šç›´æ¥å†™åœ¨ä»£ç ä¸Šé¢äº†ï¼Œå®åœ¨ä¸å¥½æ‹†å¼€è¿™æ®µä»£ç ï¼Œ300 å¤šè¡Œä»£ç ) 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278public Node(Environment environment) &#123; this(environment, Collections.emptyList()); //æ‰§è¡Œä¸‹é¢çš„ä»£ç  &#125;protected Node(final Environment environment, Collection&lt;Class&lt;? extends Plugin&gt;&gt; classpathPlugins) &#123; final List&lt;Closeable&gt; resourcesToClose = new ArrayList&lt;&gt;(); // register everything we need to release in the case of an error boolean success = false; &#123;// use temp logger just to say we are starting. we can't use it later on because the node name might not be set Logger logger = Loggers.getLogger(Node.class, NODE_NAME_SETTING.get(environment.settings())); logger.info(\"initializing ...\"); &#125; try &#123; originalSettings = environment.settings(); Settings tmpSettings = Settings.builder().put(environment.settings()) .put(Client.CLIENT_TYPE_SETTING_S.getKey(), CLIENT_TYPE).build();// create the node environment as soon as possible, to recover the node id and enable logging try &#123; nodeEnvironment = new NodeEnvironment(tmpSettings, environment); //1ã€åˆ›å»ºèŠ‚ç‚¹ç¯å¢ƒ,æ¯”å¦‚èŠ‚ç‚¹åç§°,èŠ‚ç‚¹ID,åˆ†ç‰‡ä¿¡æ¯,å­˜å‚¨å…ƒ,ä»¥åŠåˆ†é…å†…å­˜å‡†å¤‡ç»™èŠ‚ç‚¹ä½¿ç”¨ resourcesToClose.add(nodeEnvironment); &#125; catch (IOException ex) &#123; throw new IllegalStateException(\"Failed to create node environment\", ex); &#125; final boolean hadPredefinedNodeName = NODE_NAME_SETTING.exists(tmpSettings); final String nodeId = nodeEnvironment.nodeId(); tmpSettings = addNodeNameIfNeeded(tmpSettings, nodeId); final Logger logger = Loggers.getLogger(Node.class, tmpSettings);// this must be captured after the node name is possibly added to the settings final String nodeName = NODE_NAME_SETTING.get(tmpSettings); if (hadPredefinedNodeName == false) &#123; logger.info(\"node name derived from node ID [&#123;&#125;]; set [&#123;&#125;] to override\", nodeId, NODE_NAME_SETTING.getKey()); &#125; else &#123; logger.info(\"node name [&#123;&#125;], node ID [&#123;&#125;]\", nodeName, nodeId); &#125; //2ã€æ‰“å°å‡ºJVMç›¸å…³ä¿¡æ¯ final JvmInfo jvmInfo = JvmInfo.jvmInfo(); logger.info(\"version[&#123;&#125;], pid[&#123;&#125;], build[&#123;&#125;/&#123;&#125;/&#123;&#125;/&#123;&#125;], OS[&#123;&#125;/&#123;&#125;/&#123;&#125;], JVM[&#123;&#125;/&#123;&#125;/&#123;&#125;/&#123;&#125;]\", Version.displayVersion(Version.CURRENT, Build.CURRENT.isSnapshot()), jvmInfo.pid(), Build.CURRENT.flavor().displayName(), Build.CURRENT.type().displayName(), Build.CURRENT.shortHash(), Build.CURRENT.date(), Constants.OS_NAME, Constants.OS_VERSION, Constants.OS_ARCH,Constants.JVM_VENDOR,Constants.JVM_NAME, Constants.JAVA_VERSION,Constants.JVM_VERSION); logger.info(\"JVM arguments &#123;&#125;\", Arrays.toString(jvmInfo.getInputArguments())); //æ£€æŸ¥å½“å‰ç‰ˆæœ¬æ˜¯ä¸æ˜¯ pre-release ç‰ˆæœ¬ï¼ˆSnapshotï¼‰ï¼Œ warnIfPreRelease(Version.CURRENT, Build.CURRENT.isSnapshot(), logger); ã€‚ã€‚ã€‚ this.pluginsService = new PluginsService(tmpSettings, environment.configFile(), environment.modulesFile(), environment.pluginsFile(), classpathPlugins); //3ã€åˆ©ç”¨PluginsServiceåŠ è½½ç›¸åº”çš„æ¨¡å—å’Œæ’ä»¶ this.settings = pluginsService.updatedSettings(); localNodeFactory = new LocalNodeFactory(settings, nodeEnvironment.nodeId());// create the environment based on the finalized (processed) view of the settings// this is just to makes sure that people get the same settings, no matter where they ask them from this.environment = new Environment(this.settings, environment.configFile()); Environment.assertEquivalent(environment, this.environment); final List&lt;ExecutorBuilder&lt;?&gt;&gt; executorBuilders = pluginsService.getExecutorBuilders(settings); //çº¿ç¨‹æ±  final ThreadPool threadPool = new ThreadPool(settings, executorBuilders.toArray(new ExecutorBuilder[0])); resourcesToClose.add(() -&gt; ThreadPool.terminate(threadPool, 10, TimeUnit.SECONDS)); // adds the context to the DeprecationLogger so that it does not need to be injected everywhere DeprecationLogger.setThreadContext(threadPool.getThreadContext()); resourcesToClose.add(() -&gt; DeprecationLogger.removeThreadContext(threadPool.getThreadContext())); final List&lt;Setting&lt;?&gt;&gt; additionalSettings = new ArrayList&lt;&gt;(pluginsService.getPluginSettings()); //é¢å¤–é…ç½® final List&lt;String&gt; additionalSettingsFilter = new ArrayList&lt;&gt;(pluginsService.getPluginSettingsFilter()); for (final ExecutorBuilder&lt;?&gt; builder : threadPool.builders()) &#123; //4ã€åŠ è½½ä¸€äº›é¢å¤–é…ç½® additionalSettings.addAll(builder.getRegisteredSettings()); &#125; client = new NodeClient(settings, threadPool);//5ã€åˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹å®¢æˆ·ç«¯ //6ã€ç¼“å­˜ä¸€ç³»åˆ—æ¨¡å—,å¦‚NodeModule,ClusterModule,IndicesModule,ActionModule,GatewayModule,SettingsModule,RepositioriesModuleï¼ŒscriptModuleï¼ŒanalysisModule final ResourceWatcherService resourceWatcherService = new ResourceWatcherService(settings, threadPool); final ScriptModule scriptModule = new ScriptModule(settings, pluginsService.filterPlugins(ScriptPlugin.class)); AnalysisModule analysisModule = new AnalysisModule(this.environment, pluginsService.filterPlugins(AnalysisPlugin.class)); // this is as early as we can validate settings at this point. we already pass them to ScriptModule as well as ThreadPool so we might be late here already final SettingsModule settingsModule = new SettingsModule(this.settings, additionalSettings, additionalSettingsFilter);scriptModule.registerClusterSettingsListeners(settingsModule.getClusterSettings()); resourcesToClose.add(resourceWatcherService); final NetworkService networkService = new NetworkService( getCustomNameResolvers(pluginsService.filterPlugins(DiscoveryPlugin.class))); List&lt;ClusterPlugin&gt; clusterPlugins = pluginsService.filterPlugins(ClusterPlugin.class); final ClusterService clusterService = new ClusterService(settings, settingsModule.getClusterSettings(), threadPool, ClusterModule.getClusterStateCustomSuppliers(clusterPlugins)); clusterService.addStateApplier(scriptModule.getScriptService()); resourcesToClose.add(clusterService); final IngestService ingestService = new IngestService(settings, threadPool, this.environment, scriptModule.getScriptService(), analysisModule.getAnalysisRegistry(), pluginsService.filterPlugins(IngestPlugin.class)); final DiskThresholdMonitor listener = new DiskThresholdMonitor(settings, clusterService::state, clusterService.getClusterSettings(), client); final ClusterInfoService clusterInfoService = newClusterInfoService(settings, clusterService, threadPool, client,listener::onNewInfo); final UsageService usageService = new UsageService(settings); ModulesBuilder modules = new ModulesBuilder();// plugin modules must be added here, before others or we can get crazy injection errors... for (Module pluginModule : pluginsService.createGuiceModules()) &#123; modules.add(pluginModule); &#125; final MonitorService monitorService = new MonitorService(settings, nodeEnvironment, threadPool, clusterInfoService); ClusterModule clusterModule = new ClusterModule(settings, clusterService, clusterPlugins, clusterInfoService); modules.add(clusterModule); IndicesModule indicesModule = new IndicesModule(pluginsService.filterPlugins(MapperPlugin.class)); modules.add(indicesModule); SearchModule searchModule = new SearchModule(settings, false, pluginsService.filterPlugins(SearchPlugin.class)); CircuitBreakerService circuitBreakerService = createCircuitBreakerService(settingsModule.getSettings(), settingsModule.getClusterSettings()); resourcesToClose.add(circuitBreakerService); modules.add(new GatewayModule()); PageCacheRecycler pageCacheRecycler = createPageCacheRecycler(settings); BigArrays bigArrays = createBigArrays(pageCacheRecycler, circuitBreakerService); resourcesToClose.add(bigArrays); modules.add(settingsModule); List&lt;NamedWriteableRegistry.Entry&gt; namedWriteables = Stream.of( NetworkModule.getNamedWriteables().stream(), indicesModule.getNamedWriteables().stream(), searchModule.getNamedWriteables().stream(), pluginsService.filterPlugins(Plugin.class).stream() .flatMap(p -&gt; p.getNamedWriteables().stream()), ClusterModule.getNamedWriteables().stream()) .flatMap(Function.identity()).collect(Collectors.toList()); final NamedWriteableRegistry namedWriteableRegistry = new NamedWriteableRegistry(namedWriteables); NamedXContentRegistry xContentRegistry = new NamedXContentRegistry(Stream.of( NetworkModule.getNamedXContents().stream(), searchModule.getNamedXContents().stream(), pluginsService.filterPlugins(Plugin.class).stream() .flatMap(p -&gt; p.getNamedXContent().stream()), ClusterModule.getNamedXWriteables().stream()).flatMap(Function.identity()).collect(toList())); modules.add(new RepositoriesModule(this.environment, pluginsService.filterPlugins(RepositoryPlugin.class), xContentRegistry)); final MetaStateService metaStateService = new MetaStateService(settings, nodeEnvironment, xContentRegistry); final IndicesService indicesService = new IndicesService(settings, pluginsService, nodeEnvironment, xContentRegistry,analysisModule.getAnalysisRegistry(), clusterModule.getIndexNameExpressionResolver(), indicesModule.getMapperRegistry(), namedWriteableRegistry,threadPool, settingsModule.getIndexScopedSettings(), circuitBreakerService, bigArrays, scriptModule.getScriptService(),client, metaStateService); Collection&lt;Object&gt; pluginComponents = pluginsService.filterPlugins(Plugin.class).stream() .flatMap(p -&gt; p.createComponents(client, clusterService, threadPool, resourceWatcherService,scriptModule.getScriptService(), xContentRegistry, environment, nodeEnvironment,namedWriteableRegistry).stream()).collect(Collectors.toList()); ActionModule actionModule = new ActionModule(false, settings, clusterModule.getIndexNameExpressionResolver(), settingsModule.getIndexScopedSettings(), settingsModule.getClusterSettings(), settingsModule.getSettingsFilter(),threadPool, pluginsService.filterPlugins(ActionPlugin.class), client, circuitBreakerService, usageService); modules.add(actionModule); //7ã€è·å–RestController,ç”¨äºå¤„ç†å„ç§Elasticsearchçš„restå‘½ä»¤,å¦‚_cat,_all,_cat/health,_clustersç­‰restå‘½ä»¤(Elasticsearchç§°ä¹‹ä¸ºaction) final RestController restController = actionModule.getRestController(); final NetworkModule networkModule = new NetworkModule(settings, false, pluginsService.filterPlugins(NetworkPlugin.class),threadPool, bigArrays, pageCacheRecycler, circuitBreakerService, namedWriteableRegistry, xContentRegistry,networkService, restController); Collection&lt;UnaryOperator&lt;Map&lt;String, MetaData.Custom&gt;&gt;&gt; customMetaDataUpgraders = pluginsService.filterPlugins(Plugin.class).stream() .map(Plugin::getCustomMetaDataUpgrader) .collect(Collectors.toList()); Collection&lt;UnaryOperator&lt;Map&lt;String, IndexTemplateMetaData&gt;&gt;&gt; indexTemplateMetaDataUpgraders = pluginsService.filterPlugins(Plugin.class).stream() .map(Plugin::getIndexTemplateMetaDataUpgrader) .collect(Collectors.toList()); Collection&lt;UnaryOperator&lt;IndexMetaData&gt;&gt; indexMetaDataUpgraders = pluginsService.filterPlugins(Plugin.class).stream() .map(Plugin::getIndexMetaDataUpgrader).collect(Collectors.toList()); final MetaDataUpgrader metaDataUpgrader = new MetaDataUpgrader(customMetaDataUpgraders, indexTemplateMetaDataUpgraders); final MetaDataIndexUpgradeService metaDataIndexUpgradeService = new MetaDataIndexUpgradeService(settings, xContentRegistry, indicesModule.getMapperRegistry(), settingsModule.getIndexScopedSettings(), indexMetaDataUpgraders); final GatewayMetaState gatewayMetaState = new GatewayMetaState(settings, nodeEnvironment, metaStateService, metaDataIndexUpgradeService, metaDataUpgrader); new TemplateUpgradeService(settings, client, clusterService, threadPool, indexTemplateMetaDataUpgraders); final Transport transport = networkModule.getTransportSupplier().get(); Set&lt;String&gt; taskHeaders = Stream.concat( pluginsService.filterPlugins(ActionPlugin.class).stream().flatMap(p -&gt; p.getTaskHeaders().stream()), Stream.of(\"X-Opaque-Id\") ).collect(Collectors.toSet()); final TransportService transportService = newTransportService(settings, transport, threadPool, networkModule.getTransportInterceptor(), localNodeFactory, settingsModule.getClusterSettings(), taskHeaders); final ResponseCollectorService responseCollectorService = new ResponseCollectorService(this.settings, clusterService); final SearchTransportService searchTransportService = new SearchTransportService(settings, transportService, SearchExecutionStatsCollector.makeWrapper(responseCollectorService)); final Consumer&lt;Binder&gt; httpBind; final HttpServerTransport httpServerTransport; if (networkModule.isHttpEnabled()) &#123; httpServerTransport = networkModule.getHttpServerTransportSupplier().get(); httpBind = b -&gt; &#123;b.bind(HttpServerTransport.class).toInstance(httpServerTransport); &#125;; &#125; else &#123; httpBind = b -&gt; &#123; b.bind(HttpServerTransport.class).toProvider(Providers.of(null)); &#125;; httpServerTransport = null; &#125; final DiscoveryModule discoveryModule = new DiscoveryModule(this.settings, threadPool, transportService, namedWriteableRegistry,networkService, clusterService.getMasterService(), clusterService.getClusterApplierService(),clusterService.getClusterSettings(), pluginsService.filterPlugins(DiscoveryPlugin.class),clusterModule.getAllocationService()); this.nodeService = new NodeService(settings, threadPool, monitorService, discoveryModule.getDiscovery(),transportService, indicesService, pluginsService, circuitBreakerService, scriptModule.getScriptService(),httpServerTransport, ingestService, clusterService, settingsModule.getSettingsFilter(), responseCollectorService,searchTransportService); final SearchService searchService = newSearchService(clusterService, indicesService, threadPool, scriptModule.getScriptService(), bigArrays, searchModule.getFetchPhase(),responseCollectorService); final List&lt;PersistentTasksExecutor&lt;?&gt;&gt; tasksExecutors = pluginsService .filterPlugins(PersistentTaskPlugin.class).stream() .map(p -&gt; p.getPersistentTasksExecutor(clusterService, threadPool, client)) .flatMap(List::stream) .collect(toList()); final PersistentTasksExecutorRegistry registry = new PersistentTasksExecutorRegistry(settings, tasksExecutors); final PersistentTasksClusterService persistentTasksClusterService = new PersistentTasksClusterService(settings, registry, clusterService); final PersistentTasksService persistentTasksService = new PersistentTasksService(settings, clusterService, threadPool, client);//8ã€ç»‘å®šå¤„ç†å„ç§æœåŠ¡çš„å®ä¾‹,è¿™é‡Œæ˜¯æœ€æ ¸å¿ƒçš„åœ°æ–¹,ä¹Ÿæ˜¯Elasticsearchèƒ½å¤„ç†å„ç§æœåŠ¡çš„æ ¸å¿ƒ. modules.add(b -&gt; &#123; b.bind(Node.class).toInstance(this); b.bind(NodeService.class).toInstance(nodeService); b.bind(NamedXContentRegistry.class).toInstance(xContentRegistry); b.bind(PluginsService.class).toInstance(pluginsService); b.bind(Client.class).toInstance(client); b.bind(NodeClient.class).toInstance(client); b.bind(Environment.class).toInstance(this.environment); b.bind(ThreadPool.class).toInstance(threadPool); b.bind(NodeEnvironment.class).toInstance(nodeEnvironment); b.bind(ResourceWatcherService.class).toInstance(resourceWatcherService);b.bind(CircuitBreakerService.class).toInstance(circuitBreakerService); b.bind(BigArrays.class).toInstance(bigArrays); b.bind(ScriptService.class).toInstance(scriptModule.getScriptService()); b.bind(AnalysisRegistry.class).toInstance(analysisModule.getAnalysisRegistry()); b.bind(IngestService.class).toInstance(ingestService); b.bind(UsageService.class).toInstance(usageService); b.bind(NamedWriteableRegistry.class).toInstance(namedWriteableRegistry); b.bind(MetaDataUpgrader.class).toInstance(metaDataUpgrader); b.bind(MetaStateService.class).toInstance(metaStateService); b.bind(IndicesService.class).toInstance(indicesService); b.bind(SearchService.class).toInstance(searchService); b.bind(SearchTransportService.class).toInstance(searchTransportService);b.bind(SearchPhaseController.class).toInstance(new SearchPhaseController(settings, searchService::createReduceContext)); b.bind(Transport.class).toInstance(transport); b.bind(TransportService.class).toInstance(transportService); b.bind(NetworkService.class).toInstance(networkService); b.bind(UpdateHelper.class).toInstance(new UpdateHelper(settings, scriptModule.getScriptService()));b.bind(MetaDataIndexUpgradeService.class).toInstance(metaDataIndexUpgradeService); b.bind(ClusterInfoService.class).toInstance(clusterInfoService); b.bind(GatewayMetaState.class).toInstance(gatewayMetaState); b.bind(Discovery.class).toInstance(discoveryModule.getDiscovery()); &#123; RecoverySettings recoverySettings = new RecoverySettings(settings, settingsModule.getClusterSettings()); processRecoverySettings(settingsModule.getClusterSettings(), recoverySettings); b.bind(PeerRecoverySourceService.class).toInstance(new PeerRecoverySourceService(settings, transportService,indicesService, recoverySettings)); b.bind(PeerRecoveryTargetService.class).toInstance(new PeerRecoveryTargetService(settings, threadPool,transportService, recoverySettings, clusterService)); &#125; httpBind.accept(b); pluginComponents.stream().forEach(p -&gt; b.bind((Class) p.getClass()).toInstance(p));b.bind(PersistentTasksService.class).toInstance(persistentTasksService); b.bind(PersistentTasksClusterService.class).toInstance(persistentTasksClusterService);b.bind(PersistentTasksExecutorRegistry.class).toInstance(registry); &#125;); injector = modules.createInjector(); // TODO hack around circular dependencies problems in AllocationServiceclusterModule.getAllocationService().setGatewayAllocator(injector.getInstance(GatewayAllocator.class)); List&lt;LifecycleComponent&gt; pluginLifecycleComponents = pluginComponents.stream() .filter(p -&gt; p instanceof LifecycleComponent) .map(p -&gt; (LifecycleComponent) p).collect(Collectors.toList()); //9ã€åˆ©ç”¨Guiceå°†å„ç§æ¨¡å—ä»¥åŠæœåŠ¡(xxxService)æ³¨å…¥åˆ°Elasticsearchç¯å¢ƒä¸­pluginLifecycleComponents.addAll(pluginsService.getGuiceServiceClasses().stream() .map(injector::getInstance).collect(Collectors.toList())); resourcesToClose.addAll(pluginLifecycleComponents); this.pluginLifecycleComponents = Collections.unmodifiableList(pluginLifecycleComponents); client.initialize(injector.getInstance(new Key&lt;Map&lt;GenericAction, TransportAction&gt;&gt;() &#123;&#125;), () -&gt; clusterService.localNode().getId(), transportService.getRemoteClusterService()); if (NetworkModule.HTTP_ENABLED.get(settings)) &#123; //å¦‚æœelasticsearch.ymlæ–‡ä»¶ä¸­é…ç½®äº†http.enabledå‚æ•°(é»˜è®¤ä¸ºtrue),åˆ™ä¼šåˆå§‹åŒ–RestHandlers logger.debug(\"initializing HTTP handlers ...\"); actionModule.initRestHandlers(() -&gt; clusterService.state().nodes()); //åˆå§‹åŒ–RestHandlers, è§£æé›†ç¾¤å‘½ä»¤,å¦‚_cat/,_cat/health &#125; //10ã€åˆå§‹åŒ–å·¥ä½œå®Œæˆ logger.info(\"initialized\"); success = true; &#125; catch (IOException ex) &#123; throw new ElasticsearchException(\"failed to bind service\", ex); &#125; finally &#123; if (!success) &#123; IOUtils.closeWhileHandlingException(resourcesToClose); &#125; &#125;&#125; ä¸Šé¢ä»£ç çœŸçš„å¾ˆå¤šï¼Œè¿™é‡Œå†è¯´ä¸‹ä¸Šé¢è¿™ä¹ˆå¤šä»£ç ä¸»è¦å¹²äº†ä»€ä¹ˆå§ï¼šï¼ˆå…·ä½“æ˜¯å“ªè¡Œä»£ç æ‰§è¡Œçš„å¦‚ä¸‹æµç¨‹ï¼Œä¸Šé¢ä»£ç ä¸­ä¹Ÿæ ‡è®°äº†ï¼‰ 1ã€åˆ›å»ºèŠ‚ç‚¹ç¯å¢ƒ,æ¯”å¦‚èŠ‚ç‚¹åç§°,èŠ‚ç‚¹ ID,åˆ†ç‰‡ä¿¡æ¯,å­˜å‚¨å…ƒ,ä»¥åŠåˆ†é…å†…å­˜å‡†å¤‡ç»™èŠ‚ç‚¹ä½¿ç”¨ 2ã€æ‰“å°å‡º JVM ç›¸å…³ä¿¡æ¯ 3ã€åˆ©ç”¨ PluginsService åŠ è½½ç›¸åº”çš„æ¨¡å—å’Œæ’ä»¶ï¼Œå…·ä½“å“ªäº›æ¨¡å—å¯ä»¥å» modules ç›®å½•ä¸‹æŸ¥çœ‹ 4ã€åŠ è½½ä¸€äº›é¢å¤–çš„é…ç½®å‚æ•° 5ã€åˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹å®¢æˆ·ç«¯ 6ã€ç¼“å­˜ä¸€ç³»åˆ—æ¨¡å—,å¦‚NodeModule,ClusterModule,IndicesModule,ActionModule,GatewayModule,SettingsModule,RepositioriesModuleï¼ŒscriptModuleï¼ŒanalysisModule 7ã€è·å– RestControllerï¼Œç”¨äºå¤„ç†å„ç§ Elasticsearch çš„ rest å‘½ä»¤,å¦‚ _cat, _all, _cat/health, _clusters ç­‰ restå‘½ä»¤ 8ã€ç»‘å®šå¤„ç†å„ç§æœåŠ¡çš„å®ä¾‹ 9ã€åˆ©ç”¨ Guice å°†å„ç§æ¨¡å—ä»¥åŠæœåŠ¡(xxxService)æ³¨å…¥åˆ° Elasticsearch ç¯å¢ƒä¸­ 10ã€åˆå§‹åŒ–å·¥ä½œå®Œæˆï¼ˆæ‰“å°æ—¥å¿—ï¼‰ JarHell æŠ¥é”™è§£é‡Šå‰ä¸€ç¯‡é˜…è¯»æºç ç¯å¢ƒæ­å»ºçš„æ–‡ç« å†™è¿‡ç”¨ JDK 1.8 ç¼–è¯‘ ES æºç æ˜¯ä¼šé‡åˆ°å¦‚ä¸‹å¼‚å¸¸ï¼š 1org.elasticsearch.bootstrap.StartupException: java.lang.IllegalStateException: jar hell! è¿™é‡Œè¯´ä¸‹å°±æ˜¯ setup æ–¹æ³•ä¸­çš„å¦‚ä¸‹ä»£ç å¯¼è‡´çš„ 1234567try &#123; // look for jar hell final Logger logger = ESLoggerFactory.getLogger(JarHell.class); JarHell.checkJarHell(logger::debug);&#125; catch (IOException | URISyntaxException e) &#123; throw new BootstrapException(e);&#125; æ‰€ä»¥ä½ å¦‚æœæ˜¯ç”¨ JDK 1.8 ç¼–è¯‘çš„ï¼Œé‚£ä¹ˆå°±éœ€è¦æŠŠæ‰€æœ‰çš„æœ‰è¿™å—çš„ä»£ç ç»™æ³¨é‡Šæ‰å°±å¯ä»¥ç¼–è¯‘æˆåŠŸçš„ã€‚ æˆ‘è‡ªå·±è¯•è¿‡ç”¨ JDK 10 ç¼–è¯‘æ˜¯æ²¡æœ‰å‡ºç°è¿™é‡ŒæŠ¥é”™çš„ã€‚ æ­£å¼å¯åŠ¨ ES èŠ‚ç‚¹å›åˆ°ä¸Šé¢ Bootstrap ä¸­çš„é™æ€ init æ–¹æ³•ä¸­ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æ­£å¼å¯åŠ¨ elasticsearch èŠ‚ç‚¹äº†ï¼š 123456INSTANCE.start(); //è°ƒç”¨ä¸‹é¢çš„ start æ–¹æ³•private void start() throws NodeValidationException &#123; node.start(); //æ­£å¼å¯åŠ¨ Elasticsearch èŠ‚ç‚¹ keepAliveThread.start();&#125; æ¥ä¸‹æ¥çœ‹çœ‹è¿™ä¸ª start æ–¹æ³•é‡Œé¢çš„ node.start() æ–¹æ³•æºç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120public Node start() throws NodeValidationException &#123; if (!lifecycle.moveToStarted()) &#123; return this; &#125; Logger logger = Loggers.getLogger(Node.class, NODE_NAME_SETTING.get(settings)); logger.info(\"starting ...\"); pluginLifecycleComponents.forEach(LifecycleComponent::start); //1ã€åˆ©ç”¨Guiceè·å–ä¸Šè¿°æ³¨å†Œçš„å„ç§æ¨¡å—ä»¥åŠæœåŠ¡ //Node çš„å¯åŠ¨å…¶å®å°±æ˜¯ node é‡Œæ¯ä¸ªç»„ä»¶çš„å¯åŠ¨ï¼ŒåŒæ ·çš„ï¼Œåˆ†åˆ«è°ƒç”¨ä¸åŒçš„å®ä¾‹çš„ start æ–¹æ³•æ¥å¯åŠ¨è¿™ä¸ªç»„ä»¶, å¦‚ä¸‹ï¼š injector.getInstance(MappingUpdatedAction.class).setClient(client); injector.getInstance(IndicesService.class).start(); injector.getInstance(IndicesClusterStateService.class).start(); injector.getInstance(SnapshotsService.class).start(); injector.getInstance(SnapshotShardsService.class).start(); injector.getInstance(RoutingService.class).start(); injector.getInstance(SearchService.class).start(); nodeService.getMonitorService().start(); final ClusterService clusterService = injector.getInstance(ClusterService.class); final NodeConnectionsService nodeConnectionsService = injector.getInstance(NodeConnectionsService.class); nodeConnectionsService.start(); clusterService.setNodeConnectionsService(nodeConnectionsService); injector.getInstance(ResourceWatcherService.class).start(); injector.getInstance(GatewayService.class).start(); Discovery discovery = injector.getInstance(Discovery.class); clusterService.getMasterService().setClusterStatePublisher(discovery::publish); // Start the transport service now so the publish address will be added to the local disco node in ClusterService TransportService transportService = injector.getInstance(TransportService.class); transportService.getTaskManager().setTaskResultsService(injector.getInstance(TaskResultsService.class)); transportService.start(); assert localNodeFactory.getNode() != null; assert transportService.getLocalNode().equals(localNodeFactory.getNode()) : \"transportService has a different local node than the factory provided\"; final MetaData onDiskMetadata; try &#123; // we load the global state here (the persistent part of the cluster state stored on disk) to // pass it to the bootstrap checks to allow plugins to enforce certain preconditions based on the recovered state. if (DiscoveryNode.isMasterNode(settings) || DiscoveryNode.isDataNode(settings)) &#123;//æ ¹æ®é…ç½®æ–‡ä»¶çœ‹å½“å‰èŠ‚ç‚¹æ˜¯masterè¿˜æ˜¯dataèŠ‚ç‚¹ onDiskMetadata = injector.getInstance(GatewayMetaState.class).loadMetaState(); &#125; else &#123; onDiskMetadata = MetaData.EMPTY_META_DATA; &#125; assert onDiskMetadata != null : \"metadata is null but shouldn't\"; // this is never null &#125; catch (IOException e) &#123; throw new UncheckedIOException(e); &#125; validateNodeBeforeAcceptingRequests(new BootstrapContext(settings, onDiskMetadata), transportService.boundAddress(), pluginsService .filterPlugins(Plugin .class) .stream() .flatMap(p -&gt; p.getBootstrapChecks().stream()).collect(Collectors.toList())); //2ã€å°†å½“å‰èŠ‚ç‚¹åŠ å…¥åˆ°ä¸€ä¸ªé›†ç¾¤ç°‡ä¸­å»,å¹¶å¯åŠ¨å½“å‰èŠ‚ç‚¹ clusterService.addStateApplier(transportService.getTaskManager()); // start after transport service so the local disco is known discovery.start(); // start before cluster service so that it can set initial state on ClusterApplierService clusterService.start(); assert clusterService.localNode().equals(localNodeFactory.getNode()) : \"clusterService has a different local node than the factory provided\"; transportService.acceptIncomingRequests(); discovery.startInitialJoin(); // tribe nodes don't have a master so we shouldn't register an observer s final TimeValue initialStateTimeout = DiscoverySettings.INITIAL_STATE_TIMEOUT_SETTING.get(settings); if (initialStateTimeout.millis() &gt; 0) &#123; final ThreadPool thread = injector.getInstance(ThreadPool.class); ClusterState clusterState = clusterService.state(); ClusterStateObserver observer = new ClusterStateObserver(clusterState, clusterService, null, logger, thread.getThreadContext()); if (clusterState.nodes().getMasterNodeId() == null) &#123; logger.debug(\"waiting to join the cluster. timeout [&#123;&#125;]\", initialStateTimeout); final CountDownLatch latch = new CountDownLatch(1); observer.waitForNextChange(new ClusterStateObserver.Listener() &#123; @Override public void onNewClusterState(ClusterState state) &#123; latch.countDown(); &#125; @Override public void onClusterServiceClose() &#123; latch.countDown(); &#125; @Override public void onTimeout(TimeValue timeout) &#123; logger.warn(\"timed out while waiting for initial discovery state - timeout: &#123;&#125;\", initialStateTimeout); latch.countDown(); &#125; &#125;, state -&gt; state.nodes().getMasterNodeId() != null, initialStateTimeout); try &#123; latch.await(); &#125; catch (InterruptedException e) &#123; throw new ElasticsearchTimeoutException(\"Interrupted while waiting for initial discovery state\"); &#125; &#125; &#125; if (NetworkModule.HTTP_ENABLED.get(settings)) &#123; injector.getInstance(HttpServerTransport.class).start(); &#125; if (WRITE_PORTS_FILE_SETTING.get(settings)) &#123; if (NetworkModule.HTTP_ENABLED.get(settings)) &#123; HttpServerTransport http = injector.getInstance(HttpServerTransport.class); writePortsFile(\"http\", http.boundAddress()); &#125; TransportService transport = injector.getInstance(TransportService.class); writePortsFile(\"transport\", transport.boundAddress()); &#125; logger.info(\"started\"); pluginsService.filterPlugins(ClusterPlugin.class).forEach(ClusterPlugin::onNodeStarted); return this;&#125; ä¸Šé¢ä»£ç ä¸»è¦æ˜¯ï¼š 1ã€åˆ©ç”¨ Guice è·å–ä¸Šè¿°æ³¨å†Œçš„å„ç§æ¨¡å—ä»¥åŠæœåŠ¡ï¼Œç„¶åå¯åŠ¨ node é‡Œæ¯ä¸ªç»„ä»¶ï¼ˆåˆ†åˆ«è°ƒç”¨ä¸åŒçš„å®ä¾‹çš„ start æ–¹æ³•æ¥å¯åŠ¨ï¼‰ 2ã€æ‰“å°æ—¥å¿—ï¼ˆå¯åŠ¨èŠ‚ç‚¹å®Œæˆï¼‰ æ€»ç»“è¿™ç¯‡æ–‡ç« ä¸»è¦æŠŠå¤§æ¦‚å¯åŠ¨æµç¨‹ä¸²é€šäº†ï¼Œè®²äº†ä¸‹ node èŠ‚ç‚¹çš„åˆ›å»ºå’Œæ­£å¼å¯åŠ¨ ES èŠ‚ç‚¹äº†ã€‚å› ä¸ºç¯‡å¹…è¾ƒå¤šæ‰€ä»¥æ‹†å¼€æˆä¸¤ç¯‡ï¼Œå…ˆä¸æ‰£ç»†èŠ‚äº†ï¼Œåé¢æµç¨‹å¯åŠ¨æ–‡ç« å†™å®Œåæˆ‘ä»¬å†å•ä¸€çš„æ‰£ç»†èŠ‚ã€‚ ç›¸å…³æ–‡ç« 1ã€æ¸£æ¸£èœé¸¡ä¸ºä»€ä¹ˆè¦çœ‹ ElasticSearch æºç ï¼Ÿ 2ã€æ¸£æ¸£èœé¸¡çš„ ElasticSearch æºç è§£æ â€”â€” ç¯å¢ƒæ­å»º 3ã€æ¸£æ¸£èœé¸¡çš„ ElasticSearch æºç è§£æ â€”â€” å¯åŠ¨æµç¨‹(ä¸Š) 4ã€æ¸£æ¸£èœé¸¡çš„ ElasticSearch æºç è§£æ â€”â€” å¯åŠ¨æµç¨‹(ä¸‹) 5ã€Elasticsearch ç³»åˆ—æ–‡ç« ï¼ˆä¸€ï¼‰ï¼šElasticsearch é»˜è®¤åˆ†è¯å™¨å’Œä¸­åˆ†åˆ†è¯å™¨ä¹‹é—´çš„æ¯”è¾ƒåŠä½¿ç”¨æ–¹æ³• 6ã€Elasticsearch ç³»åˆ—æ–‡ç« ï¼ˆäºŒï¼‰ï¼šå…¨æ–‡æœç´¢å¼•æ“ Elasticsearch é›†ç¾¤æ­å»ºå…¥é—¨æ•™ç¨‹ 7ã€Elasticsearch ç³»åˆ—æ–‡ç« ï¼ˆä¸‰ï¼‰ï¼šElasticSearch é›†ç¾¤ç›‘æ§ 8ã€Elasticsearch ç³»åˆ—æ–‡ç« ï¼ˆå››ï¼‰ï¼šElasticSearch å•ä¸ªèŠ‚ç‚¹ç›‘æ§ 9ã€Elasticsearch ç³»åˆ—æ–‡ç« ï¼ˆäº”ï¼‰ï¼šELK å®æ—¶æ—¥å¿—åˆ†æå¹³å°ç¯å¢ƒæ­å»º 10ã€æ•™ä½ å¦‚ä½•åœ¨ IDEA è¿œç¨‹ Debug ElasticSearch","tags":[{"name":"ElasticSearch","slug":"ElasticSearch","permalink":"http://www.54tianzhisheng.cn/tags/ElasticSearch/"}]},{"title":"æ¸£æ¸£èœé¸¡çš„ ElasticSearch æºç è§£æ â€”â€” å¯åŠ¨æµç¨‹ï¼ˆä¸Šï¼‰","date":"2018-08-10T16:00:00.000Z","path":"2018/08/11/es-code02/","text":"å…³æ³¨æˆ‘ è½¬è½½è¯·åŠ¡å¿…æ³¨æ˜åŸåˆ›åœ°å€ä¸ºï¼šhttp://www.54tianzhisheng.cn/2018/08/11/es-code02/ å‰æä¸Šç¯‡æ–‡ç« å†™äº† ElasticSearch æºç è§£æ â€”â€” ç¯å¢ƒæ­å»º ï¼Œå…¶ä¸­é‡Œé¢è¯´äº†å¯åŠ¨ æ‰“å¼€ server æ¨¡å—ä¸‹çš„ Elasticsearch ç±»ï¼šorg.elasticsearch.bootstrap.Elasticsearchï¼Œè¿è¡Œé‡Œé¢çš„ main å‡½æ•°å°±å¯ä»¥å¯åŠ¨ ElasticSearch äº†ï¼Œè¿™ç¯‡æ–‡ç« è®²è®²å¯åŠ¨æµç¨‹ï¼Œå› ä¸ºç¯‡å¹…ä¼šå¾ˆå¤šï¼Œæ‰€ä»¥åˆ†äº†ä¸¤ç¯‡æ¥å†™ã€‚ å¯åŠ¨æµç¨‹main æ–¹æ³•å…¥å£å¯ä»¥çœ‹åˆ°å…¥å£å…¶å®æ˜¯ä¸€ä¸ª main æ–¹æ³•ï¼Œæ–¹æ³•é‡Œé¢å…ˆæ˜¯æ£€æŸ¥æƒé™ï¼Œç„¶åæ˜¯ä¸€ä¸ªé”™è¯¯æ—¥å¿—ç›‘å¬å™¨ï¼ˆç¡®ä¿åœ¨æ—¥å¿—é…ç½®ä¹‹å‰çŠ¶æ€æ—¥å¿—æ²¡æœ‰å‡ºç° errorï¼‰ï¼Œç„¶åæ˜¯ Elasticsearch å¯¹è±¡çš„åˆ›å»ºï¼Œç„¶åè°ƒç”¨äº†é™æ€æ–¹æ³• main æ–¹æ³•ï¼ˆ18 è¡Œï¼‰ï¼Œå¹¶æŠŠåˆ›å»ºçš„å¯¹è±¡å’Œå‚æ•°ä»¥åŠ Terminal é»˜è®¤å€¼ä¼ è¿›å»ã€‚é™æ€çš„ main æ–¹æ³•é‡Œé¢è°ƒç”¨ elasticsearch.main æ–¹æ³•ã€‚ 1234567891011121314151617181920public static void main(final String[] args) throws Exception &#123; //1ã€å…¥å£ // we want the JVM to think there is a security manager installed so that if internal policy decisions that would be based on the // presence of a security manager or lack thereof act as if there is a security manager present (e.g., DNS cache policy) System.setSecurityManager(new SecurityManager() &#123; @Override public void checkPermission(Permission perm) &#123; // grant all permissions so that we can later set the security manager to the one that we want &#125; &#125;); LogConfigurator.registerErrorListener(); // final Elasticsearch elasticsearch = new Elasticsearch(); int status = main(args, elasticsearch, Terminal.DEFAULT); //2ã€è°ƒç”¨Elasticsearch.mainæ–¹æ³• if (status != ExitCodes.OK) &#123; exit(status); &#125;&#125;static int main(final String[] args, final Elasticsearch elasticsearch, final Terminal terminal) throws Exception &#123; return elasticsearch.main(args, terminal); //3ã€command main&#125; å› ä¸º Elasticsearch ç±»æ˜¯ç»§æ‰¿äº† EnvironmentAwareCommand ç±»ï¼ŒEnvironmentAwareCommand ç±»ç»§æ‰¿äº† Command ç±»ï¼Œä½†æ˜¯ Elasticsearch ç±»å¹¶æ²¡æœ‰é‡å†™ main æ–¹æ³•ï¼Œæ‰€ä»¥ä¸Šé¢è°ƒç”¨çš„ elasticsearch.main å…¶å®æ˜¯è°ƒç”¨äº† Command çš„ main æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839/** Parses options for this command from args and executes it. */public final int main(String[] args, Terminal terminal) throws Exception &#123; if (addShutdownHook()) &#123; //åˆ©ç”¨Runtime.getRuntime().addShutdownHookæ–¹æ³•åŠ å…¥ä¸€ä¸ªHookï¼Œåœ¨ç¨‹åºé€€å‡ºæ—¶è§¦å‘è¯¥Hook shutdownHookThread = new Thread(() -&gt; &#123; try &#123; this.close(); &#125; catch (final IOException e) &#123; try ( StringWriter sw = new StringWriter(); PrintWriter pw = new PrintWriter(sw)) &#123; e.printStackTrace(pw); terminal.println(sw.toString()); &#125; catch (final IOException impossible) &#123; // StringWriter#close declares a checked IOException from the Closeable interface but the Javadocs for StringWriter // say that an exception here is impossible throw new AssertionError(impossible); &#125; &#125; &#125;); Runtime.getRuntime().addShutdownHook(shutdownHookThread); &#125; beforeMain.run(); try &#123; mainWithoutErrorHandling(args, terminal);//4ã€mainWithoutErrorHandling &#125; catch (OptionException e) &#123; printHelp(terminal); terminal.println(Terminal.Verbosity.SILENT, \"ERROR: \" + e.getMessage()); return ExitCodes.USAGE; &#125; catch (UserException e) &#123; if (e.exitCode == ExitCodes.USAGE) &#123; printHelp(terminal); &#125; terminal.println(Terminal.Verbosity.SILENT, \"ERROR: \" + e.getMessage()); return e.exitCode; &#125; return ExitCodes.OK;&#125; ä¸Šé¢ä»£ç ä¸€å¼€å§‹åˆ©ç”¨ä¸€ä¸ªå‹¾å­å‡½æ•°ï¼Œåœ¨ç¨‹åºé€€å‡ºæ—¶è§¦å‘è¯¥ Hookï¼Œè¯¥æ–¹æ³•ä¸»è¦ä»£ç æ˜¯ mainWithoutErrorHandling() æ–¹æ³•ï¼Œç„¶åä¸‹é¢çš„æ˜¯ catch ä½æ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸ï¼Œæ–¹æ³•ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516/*** Executes the command, but all errors are thrown. */void mainWithoutErrorHandling(String[] args, Terminal terminal) throws Exception &#123; final OptionSet options = parser.parse(args); if (options.has(helpOption)) &#123; printHelp(terminal); return; &#125; if (options.has(silentOption)) &#123; terminal.setVerbosity(Terminal.Verbosity.SILENT); &#125; else if (options.has(verboseOption)) &#123; terminal.setVerbosity(Terminal.Verbosity.VERBOSE); &#125; else &#123; terminal.setVerbosity(Terminal.Verbosity.NORMAL); &#125; execute(terminal, options);//5ã€æ‰§è¡Œ EnvironmentAwareCommand ä¸­çš„ execute()ï¼Œï¼ˆé‡å†™äº†commandé‡Œé¢æŠ½è±¡çš„executeæ–¹æ³•ï¼‰&#125; ä¸Šé¢çš„ä»£ç ä» 3 ï½ 14 è¡Œæ˜¯è§£æä¼ è¿›æ¥çš„å‚æ•°å¹¶é…ç½® terminalï¼Œé‡è¦çš„ execute() æ–¹æ³•ï¼Œæ‰§è¡Œçš„æ˜¯ EnvironmentAwareCommand ä¸­çš„ execute() ï¼ˆé‡å†™äº† Command ç±»é‡Œé¢çš„æŠ½è±¡ execute æ–¹æ³•ï¼‰ï¼Œä»ä¸Šé¢é‚£ä¸ªç»§æ‰¿å›¾å¯ä»¥çœ‹åˆ° EnvironmentAwareCommand ç»§æ‰¿äº† Commandï¼Œé‡å†™çš„ execute æ–¹æ³•ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223@Overrideprotected void execute(Terminal terminal, OptionSet options) throws Exception &#123; final Map&lt;String, String&gt; settings = new HashMap&lt;&gt;(); for (final KeyValuePair kvp : settingOption.values(options)) &#123; if (kvp.value.isEmpty()) &#123; throw new UserException(ExitCodes.USAGE, \"setting [\" + kvp.key + \"] must not be empty\"); &#125; if (settings.containsKey(kvp.key)) &#123; final String message = String.format( Locale.ROOT, \"setting [%s] already set, saw [%s] and [%s]\", kvp.key, settings.get(kvp.key), kvp.value); throw new UserException(ExitCodes.USAGE, message); &#125; settings.put(kvp.key, kvp.value); &#125; //6ã€æ ¹æ®æˆ‘ä»¬ideé…ç½®çš„ vm options è¿›è¡Œè®¾ç½®path.dataã€path.homeã€path.logs putSystemPropertyIfSettingIsMissing(settings, \"path.data\", \"es.path.data\"); putSystemPropertyIfSettingIsMissing(settings, \"path.home\", \"es.path.home\"); putSystemPropertyIfSettingIsMissing(settings, \"path.logs\", \"es.path.logs\"); execute(terminal, options, createEnv(terminal, settings));//7ã€å…ˆè°ƒç”¨ createEnv åˆ›å»ºç¯å¢ƒ //9ã€æ‰§è¡Œelasticsearchçš„executeæ–¹æ³•ï¼Œelasticsearchä¸­é‡å†™äº†EnvironmentAwareCommandä¸­çš„æŠ½è±¡executeæ–¹æ³•&#125; æ–¹æ³•å‰é¢æ˜¯æ ¹æ®ä¼ å‚å»åˆ¤æ–­é…ç½®çš„ï¼Œå¦‚æœé…ç½®ä¸ºç©ºï¼Œå°±ä¼šç›´æ¥è·³åˆ°æ‰§è¡Œ putSystemPropertyIfSettingIsMissing æ–¹æ³•ï¼Œè¿™é‡Œä¼šé…ç½®ä¸‰ä¸ªå±æ€§ï¼špath.dataã€path.homeã€path.logs è®¾ç½® es çš„ dataã€homeã€logs ç›®å½•ï¼Œå®ƒè¿™é‡Œæ˜¯æ ¹æ®æˆ‘ä»¬ ide é…ç½®çš„ vm options è¿›è¡Œè®¾ç½®çš„ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸Šç¯‡æ–‡ç« è¯´çš„é…ç½®ä¿¡æ¯ï¼Œå¦‚æœä¸é…ç½®çš„è¯å°±ä¼šç›´æ¥æŠ¥é”™ã€‚ä¸‹é¢çœ‹çœ‹ putSystemPropertyIfSettingIsMissing æ–¹æ³•ä»£ç é‡Œé¢æ€ä¹ˆåšåˆ°çš„ï¼š 12345678910111213141516/** Ensure the given setting exists, reading it from system properties if not already set. */private static void putSystemPropertyIfSettingIsMissing(final Map&lt;String, String&gt; settings, final String setting, final String key) &#123; final String value = System.getProperty(key);//è·å–keyï¼ˆes.path.dataï¼‰æ‰¾ç³»ç»Ÿè®¾ç½® if (value != null) &#123; if (settings.containsKey(setting)) &#123; final String message = String.format( Locale.ROOT, \"duplicate setting [%s] found via command-line [%s] and system property [%s]\", setting, settings.get(setting), value); throw new IllegalArgumentException(message); &#125; else &#123; settings.put(setting, value); &#125; &#125;&#125; æ‰§è¡Œè¿™ä¸‰ä¸ªæ–¹æ³•åï¼š è·³å‡ºæ­¤æ–¹æ³•ï¼Œç»§ç»­çœ‹ä¼šå‘ç° execute æ–¹æ³•è°ƒç”¨äº†æ–¹æ³•ï¼Œ 1execute(terminal, options, createEnv(terminal, settings)); è¿™é‡Œæˆ‘ä»¬å…ˆçœ‹çœ‹ createEnv(terminal, settings) æ–¹æ³•ï¼š 1234567protected Environment createEnv(final Terminal terminal, final Map&lt;String, String&gt; settings) throws UserException &#123; final String esPathConf = System.getProperty(\"es.path.conf\");//8ã€è¯»å–æˆ‘ä»¬ vm options ä¸­é…ç½®çš„ es.path.conf if (esPathConf == null) &#123; throw new UserException(ExitCodes.CONFIG, \"the system property [es.path.conf] must be set\"); &#125; return InternalSettingsPreparer.prepareEnvironment(Settings.EMPTY, terminal, settings, getConfigPath(esPathConf)); //8ã€å‡†å¤‡ç¯å¢ƒ prepareEnvironment&#125; è¯»å–æˆ‘ä»¬ ide vm options ä¸­é…ç½®çš„ es.path.confï¼ŒåŒä¸Šç¯‡æ–‡ç« ä¹Ÿè®²äº†è¿™ä¸ªä¸€å®šè¦é…ç½®çš„ï¼Œå› ä¸º es å¯åŠ¨çš„æ—¶å€™ä¼šåŠ è½½æˆ‘ä»¬çš„é…ç½®å’Œä¸€äº›æ’ä»¶ã€‚è¿™é‡Œç»§ç»­çœ‹ä¸‹ä¸Šé¢ä»£ç ç¬¬ 6 è¡Œçš„ prepareEnvironment æ–¹æ³•ï¼š 1234567891011121314151617181920212223242526272829303132333435public static Environment prepareEnvironment(Settings input, Terminal terminal, Map&lt;String, String&gt; properties, Path configPath) &#123; // just create enough settings to build the environment, to get the config dir Settings.Builder output = Settings.builder(); initializeSettings(output, input, properties); Environment environment = new Environment(output.build(), configPath); //æŸ¥çœ‹ es.path.conf ç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶æ˜¯ä¸æ˜¯ yml æ ¼å¼çš„ï¼Œå¦‚æœä¸æ˜¯åˆ™æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ if (Files.exists(environment.configFile().resolve(\"elasticsearch.yaml\"))) &#123; throw new SettingsException(\"elasticsearch.yaml was deprecated in 5.5.0 and must be renamed to elasticsearch.yml\"); &#125; if (Files.exists(environment.configFile().resolve(\"elasticsearch.json\"))) &#123; throw new SettingsException(\"elasticsearch.json was deprecated in 5.5.0 and must be converted to elasticsearch.yml\"); &#125; output = Settings.builder(); // start with a fresh output Path path = environment.configFile().resolve(\"elasticsearch.yml\"); if (Files.exists(path)) &#123; try &#123; output.loadFromPath(path); //åŠ è½½æ–‡ä»¶å¹¶è¯»å–é…ç½®æ–‡ä»¶å†…å®¹ &#125; catch (IOException e) &#123; throw new SettingsException(\"Failed to load settings from \" + path.toString(), e); &#125; &#125; // re-initialize settings now that the config file has been loaded initializeSettings(output, input, properties); //å†ä¸€æ¬¡åˆå§‹åŒ–è®¾ç½® finalizeSettings(output, terminal); environment = new Environment(output.build(), configPath); // we put back the path.logs so we can use it in the logging configuration file output.put(Environment.PATH_LOGS_SETTING.getKey(), environment.logsFile().toAbsolutePath().normalize().toString()); return new Environment(output.build(), configPath);&#125; å‡†å¤‡çš„ç¯å¢ƒå¦‚ä¸Šå›¾ï¼Œé€šè¿‡æ„å»ºçš„ç¯å¢ƒæŸ¥çœ‹é…ç½®æ–‡ä»¶ elasticsearch.yml æ˜¯ä¸æ˜¯ä»¥ yml ç»“å°¾ï¼Œå¦‚æœæ˜¯ yaml æˆ–è€… json ç»“å°¾çš„åˆ™æŠ›å‡ºå¼‚å¸¸ï¼ˆåœ¨ 5.5.0 ç‰ˆæœ¬å…¶ä»–ä¸¤ç§æ ¼å¼è¿‡æœŸäº†ï¼Œåªèƒ½ä½¿ç”¨ yml æ ¼å¼ï¼‰ï¼Œç„¶ååŠ è½½è¯¥é…ç½®æ–‡ä»¶å¹¶è¯»å–é‡Œé¢çš„å†…å®¹ï¼ˆKVç»“æ„ï¼‰ã€‚ è·³å‡º createEnv æ–¹æ³•ï¼Œæˆ‘ä»¬ç»§ç»­çœ‹ execute æ–¹æ³•å§ã€‚ EnvironmentAwareCommand ç±»çš„ execute æ–¹æ³•ä»£ç å¦‚ä¸‹ï¼š 1protected abstract void execute(Terminal terminal, OptionSet options, Environment env) throws Exception; è¿™æ˜¯ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒçš„å®ç°æ–¹æ³•åœ¨ Elasticsearch ç±»ä¸­ï¼Œä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435@Overrideprotected void execute(Terminal terminal, OptionSet options, Environment env) throws UserException &#123; if (options.nonOptionArguments().isEmpty() == false) &#123; throw new UserException(ExitCodes.USAGE, \"Positional arguments not allowed, found \" + options.nonOptionArguments()); &#125; if (options.has(versionOption)) &#123; final String versionOutput = String.format( Locale.ROOT, \"Version: %s, Build: %s/%s/%s/%s, JVM: %s\", Version.displayVersion(Version.CURRENT, Build.CURRENT.isSnapshot()), Build.CURRENT.flavor().displayName(), Build.CURRENT.type().displayName(), Build.CURRENT.shortHash(), Build.CURRENT.date(), JvmInfo.jvmInfo().version()); terminal.println(versionOutput); return; &#125; final boolean daemonize = options.has(daemonizeOption); final Path pidFile = pidfileOption.value(options); final boolean quiet = options.has(quietOption); // a misconfigured java.io.tmpdir can cause hard-to-diagnose problems later, so reject it immediately try &#123; env.validateTmpFile(); &#125; catch (IOException e) &#123; throw new UserException(ExitCodes.CONFIG, e.getMessage()); &#125; try &#123; init(daemonize, pidFile, quiet, env); //10ã€åˆå§‹åŒ– &#125; catch (NodeValidationException e) &#123; throw new UserException(ExitCodes.CONFIG, e.getMessage()); &#125;&#125; ä¸Šé¢ä»£ç é‡Œä¸»è¦è¿˜æ˜¯çœ‹çœ‹ init(daemonize, pidFile, quiet, env); åˆå§‹åŒ–æ–¹æ³•å§ã€‚ 12345678910void init(final boolean daemonize, final Path pidFile, final boolean quiet, Environment initialEnv) throws NodeValidationException, UserException &#123; try &#123; Bootstrap.init(!daemonize, pidFile, quiet, initialEnv); //11ã€æ‰§è¡Œ Bootstrap ä¸­çš„ init æ–¹æ³• &#125; catch (BootstrapException | RuntimeException e) &#123; // format exceptions to the console in a special way // to avoid 2MB stacktraces from guice, etc. throw new StartupException(e); &#125;&#125; init æ–¹æ³•Bootstrap ä¸­çš„é™æ€ init æ–¹æ³•å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101static void init( final boolean foreground, final Path pidFile, final boolean quiet, final Environment initialEnv) throws BootstrapException, NodeValidationException, UserException &#123; // force the class initializer for BootstrapInfo to run before // the security manager is installed BootstrapInfo.init(); INSTANCE = new Bootstrap(); //12ã€åˆ›å»ºä¸€ä¸ª Bootstrap å®ä¾‹ final SecureSettings keystore = loadSecureSettings(initialEnv);//å¦‚æœæ³¨å†Œäº†å®‰å…¨æ¨¡å—åˆ™å°†ç›¸å…³é…ç½®åŠ è½½è¿›æ¥ final Environment environment = createEnvironment(foreground, pidFile, keystore, initialEnv.settings(), initialEnv.configFile()); //å¹²ä¹‹å‰å¹²è¿‡çš„äº‹æƒ… try &#123; LogConfigurator.configure(environment); //13ã€log é…ç½®ç¯å¢ƒ &#125; catch (IOException e) &#123; throw new BootstrapException(e); &#125; if (environment.pidFile() != null) &#123; try &#123; PidFile.create(environment.pidFile(), true); &#125; catch (IOException e) &#123; throw new BootstrapException(e); &#125; &#125; final boolean closeStandardStreams = (foreground == false) || quiet; try &#123; if (closeStandardStreams) &#123; final Logger rootLogger = ESLoggerFactory.getRootLogger(); final Appender maybeConsoleAppender = Loggers.findAppender(rootLogger, ConsoleAppender.class); if (maybeConsoleAppender != null) &#123; Loggers.removeAppender(rootLogger, maybeConsoleAppender); &#125; closeSystOut(); &#125; // fail if somebody replaced the lucene jars checkLucene(); //14ã€æ£€æŸ¥Luceneç‰ˆæœ¬// install the default uncaught exception handler; must be done before security is initialized as we do not want to grant the runtime permission setDefaultUncaughtExceptionHandler Thread.setDefaultUncaughtExceptionHandler( new ElasticsearchUncaughtExceptionHandler(() -&gt; Node.NODE_NAME_SETTING.get(environment.settings()))); INSTANCE.setup(true, environment); //15ã€è°ƒç”¨ setup æ–¹æ³• try &#123; // any secure settings must be read during node construction IOUtils.close(keystore); &#125; catch (IOException e) &#123; throw new BootstrapException(e); &#125; INSTANCE.start(); //26ã€è°ƒç”¨ start æ–¹æ³• if (closeStandardStreams) &#123; closeSysError(); &#125; &#125; catch (NodeValidationException | RuntimeException e) &#123; // disable console logging, so user does not see the exception twice (jvm will show it already) final Logger rootLogger = ESLoggerFactory.getRootLogger(); final Appender maybeConsoleAppender = Loggers.findAppender(rootLogger, ConsoleAppender.class); if (foreground &amp;&amp; maybeConsoleAppender != null) &#123; Loggers.removeAppender(rootLogger, maybeConsoleAppender); &#125; Logger logger = Loggers.getLogger(Bootstrap.class); if (INSTANCE.node != null) &#123; logger = Loggers.getLogger(Bootstrap.class, Node.NODE_NAME_SETTING.get(INSTANCE.node.settings())); &#125; // HACK, it sucks to do this, but we will run users out of disk space otherwise if (e instanceof CreationException) &#123; // guice: log the shortened exc to the log file ByteArrayOutputStream os = new ByteArrayOutputStream(); PrintStream ps = null; try &#123; ps = new PrintStream(os, false, \"UTF-8\"); &#125; catch (UnsupportedEncodingException uee) &#123; assert false; e.addSuppressed(uee); &#125; new StartupException(e).printStackTrace(ps); ps.flush(); try &#123; logger.error(\"Guice Exception: &#123;&#125;\", os.toString(\"UTF-8\")); &#125; catch (UnsupportedEncodingException uee) &#123; assert false; e.addSuppressed(uee); &#125; &#125; else if (e instanceof NodeValidationException) &#123; logger.error(\"node validation exception\\n&#123;&#125;\", e.getMessage()); &#125; else &#123; // full exception logger.error(\"Exception\", e); &#125; // re-enable it if appropriate, so they can see any logging during the shutdown process if (foreground &amp;&amp; maybeConsoleAppender != null) &#123; Loggers.addAppender(rootLogger, maybeConsoleAppender); &#125; throw e; &#125;&#125; è¯¥æ–¹æ³•ä¸»è¦æœ‰ï¼š 1ã€åˆ›å»º Bootstrap å®ä¾‹ 2ã€å¦‚æœæ³¨å†Œäº†å®‰å…¨æ¨¡å—åˆ™å°†ç›¸å…³é…ç½®åŠ è½½è¿›æ¥ 3ã€åˆ›å»º Elasticsearch è¿è¡Œçš„å¿…é¡»ç¯å¢ƒä»¥åŠç›¸å…³é…ç½®, å¦‚å°† configã€scriptsã€pluginsã€modulesã€logsã€libã€bin ç­‰é…ç½®ç›®å½•åŠ è½½åˆ°è¿è¡Œç¯å¢ƒä¸­ 4ã€log é…ç½®ç¯å¢ƒï¼Œåˆ›å»ºæ—¥å¿—ä¸Šä¸‹æ–‡ 5ã€æ£€æŸ¥æ˜¯å¦å­˜åœ¨ PID æ–‡ä»¶ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ›å»º PID æ–‡ä»¶ 6ã€æ£€æŸ¥ Lucene ç‰ˆæœ¬ 7ã€è°ƒç”¨ setup æ–¹æ³•ï¼ˆç”¨å½“å‰ç¯å¢ƒæ¥åˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹ï¼‰ setup æ–¹æ³•12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152private void setup(boolean addShutdownHook, Environment environment) throws BootstrapException &#123; Settings settings = environment.settings();//æ ¹æ®ç¯å¢ƒå¾—åˆ°é…ç½® try &#123; spawner.spawnNativeControllers(environment); &#125; catch (IOException e) &#123; throw new BootstrapException(e); &#125; initializeNatives( environment.tmpFile(), BootstrapSettings.MEMORY_LOCK_SETTING.get(settings), BootstrapSettings.SYSTEM_CALL_FILTER_SETTING.get(settings), BootstrapSettings.CTRLHANDLER_SETTING.get(settings)); // initialize probes before the security manager is installed initializeProbes(); if (addShutdownHook) &#123; Runtime.getRuntime().addShutdownHook(new Thread() &#123; @Override public void run() &#123; try &#123; IOUtils.close(node, spawner); LoggerContext context = (LoggerContext) LogManager.getContext(false); Configurator.shutdown(context); &#125; catch (IOException ex) &#123; throw new ElasticsearchException(\"failed to stop node\", ex); &#125; &#125; &#125;); &#125; try &#123; // look for jar hell final Logger logger = ESLoggerFactory.getLogger(JarHell.class); JarHell.checkJarHell(logger::debug); &#125; catch (IOException | URISyntaxException e) &#123; throw new BootstrapException(e); &#125; // Log ifconfig output before SecurityManager is installed IfConfig.logIfNecessary(); // install SM after natives, shutdown hooks, etc. try &#123; Security.configure(environment, BootstrapSettings.SECURITY_FILTER_BAD_DEFAULTS_SETTING.get(settings)); &#125; catch (IOException | NoSuchAlgorithmException e) &#123; throw new BootstrapException(e); &#125; node = new Node(environment) &#123; //16ã€æ–°å»ºèŠ‚ç‚¹ @Override protected void validateNodeBeforeAcceptingRequests( final BootstrapContext context, final BoundTransportAddress boundTransportAddress, List&lt;BootstrapCheck&gt; checks) throws NodeValidationException &#123; BootstrapChecks.check(context, boundTransportAddress, checks); &#125; &#125;;&#125; ä¸Šé¢ä»£ç æœ€åå°±æ˜¯ Node èŠ‚ç‚¹çš„åˆ›å»ºï¼Œè¿™ç¯‡æ–‡ç« å°±ä¸è®² Node çš„åˆ›å»ºäº†ï¼Œä¸‹ç¯‡æ–‡ç« ä¼šå¥½å¥½è®²ä¸€ä¸‹ Node èŠ‚ç‚¹çš„åˆ›å»ºå’Œæ­£å¼å¯åŠ¨ ES èŠ‚ç‚¹çš„ã€‚ æ€»ç»“è¿™ç¯‡æ–‡ç« ä¸»è¦å…ˆæŠŠå¤§æ¦‚å¯åŠ¨æµç¨‹ä¸²é€šï¼Œå› ä¸ºç¯‡å¹…è¾ƒå¤šæ‰€ä»¥æ‹†å¼€æˆä¸¤ç¯‡ï¼Œå…ˆä¸æ‰£ç»†èŠ‚äº†ï¼Œåé¢æµç¨‹å¯åŠ¨æ–‡ç« å†™å®Œåæˆ‘ä»¬å†å•ä¸€çš„æ‰£ç»†èŠ‚ã€‚ ç›¸å…³æ–‡ç« 1ã€æ¸£æ¸£èœé¸¡ä¸ºä»€ä¹ˆè¦çœ‹ ElasticSearch æºç ï¼Ÿ 2ã€æ¸£æ¸£èœé¸¡çš„ ElasticSearch æºç è§£æ â€”â€” ç¯å¢ƒæ­å»º 3ã€æ¸£æ¸£èœé¸¡çš„ ElasticSearch æºç è§£æ â€”â€” å¯åŠ¨æµç¨‹(ä¸Š) 4ã€æ¸£æ¸£èœé¸¡çš„ ElasticSearch æºç è§£æ â€”â€” å¯åŠ¨æµç¨‹(ä¸‹) 5ã€Elasticsearch ç³»åˆ—æ–‡ç« ï¼ˆä¸€ï¼‰ï¼šElasticsearch é»˜è®¤åˆ†è¯å™¨å’Œä¸­åˆ†åˆ†è¯å™¨ä¹‹é—´çš„æ¯”è¾ƒåŠä½¿ç”¨æ–¹æ³• 6ã€Elasticsearch ç³»åˆ—æ–‡ç« ï¼ˆäºŒï¼‰ï¼šå…¨æ–‡æœç´¢å¼•æ“ Elasticsearch é›†ç¾¤æ­å»ºå…¥é—¨æ•™ç¨‹ 7ã€Elasticsearch ç³»åˆ—æ–‡ç« ï¼ˆä¸‰ï¼‰ï¼šElasticSearch é›†ç¾¤ç›‘æ§ 8ã€Elasticsearch ç³»åˆ—æ–‡ç« ï¼ˆå››ï¼‰ï¼šElasticSearch å•ä¸ªèŠ‚ç‚¹ç›‘æ§ 9ã€Elasticsearch ç³»åˆ—æ–‡ç« ï¼ˆäº”ï¼‰ï¼šELK å®æ—¶æ—¥å¿—åˆ†æå¹³å°ç¯å¢ƒæ­å»º 10ã€æ•™ä½ å¦‚ä½•åœ¨ IDEA è¿œç¨‹ Debug ElasticSearch","tags":[{"name":"ElasticSearch","slug":"ElasticSearch","permalink":"http://www.54tianzhisheng.cn/tags/ElasticSearch/"}]},{"title":"æ¸£æ¸£èœé¸¡çš„ ElasticSearch æºç è§£æ â€”â€” ç¯å¢ƒæ­å»º","date":"2018-08-04T16:00:00.000Z","path":"2018/08/05/es-code01/","text":"å…³æ³¨æˆ‘ è½¬è½½è¯·åŠ¡å¿…æ³¨æ˜åŸåˆ›åœ°å€ä¸ºï¼šhttp://www.54tianzhisheng.cn/2018/08/05/es-code01/ è½¯ä»¶ç¯å¢ƒ1ã€Intellij Idea:2018.2ç‰ˆæœ¬ 2ã€Elasticsearch æºç ç‰ˆæœ¬: 6.3.2 3ã€JDK:10.0.2 4ã€Gradle : å»ºè®® 4.5 åŠä»¥ä¸Šç‰ˆæœ¬ 5ã€Macbook Pro 2017 å®‰è£… ElasticSearch å» https://www.elastic.co/downloads/past-releases è¿™é‡Œæ‰¾åˆ° ElasticSearch 6.3.2 ç‰ˆæœ¬ï¼Œä¸‹è½½åç„¶åè§£å‹å°±å¥½äº†ã€‚ï¼ˆæ³¨æ„ï¼šè¿™ä¸ªç‰ˆæœ¬éœ€è¦å’Œä¸‹é¢çš„æºç ç‰ˆæœ¬ä¸€è‡´ï¼‰ ä¸‹è½½æºç ä» https://github.com/elastic/elasticsearch ä¸Šä¸‹è½½ç›¸åº”ç‰ˆæœ¬çš„æºä»£ç ï¼Œè¿™é‡Œå»ºè®®ç”¨ git clone ï¼Œè¿™æ ·çš„è¯åé¢ä½ å¯ä»¥éšæ„åˆ‡æ¢åˆ° ElasticSearch çš„å…¶ä»–ç‰ˆæœ¬å»ã€‚ 1git clone git@github.com:elastic/elasticsearch.git æˆ‘ä»¬çœ‹ä¸‹æœ‰å“ªäº›ç‰ˆæœ¬çš„ï¼š 1git tag æ‰¾åˆ°äº†ç›®å‰æºç ç‰ˆæœ¬æœ€æ–°çš„ç‰ˆæœ¬çš„ç¨³å®šç‰ˆä¸ºï¼šv6.3.2 åˆ‡æ¢åˆ°è¯¥ç‰ˆæœ¬ï¼š 1git checkout v6.3.2 äºæ˜¯å°±å¯ä»¥åˆ‡æ¢åˆ°è¯¥ç¨³å®šç‰ˆæœ¬äº†ã€‚æ¥ä¸‹æ¥ä¸è¦ç›´æ¥å¯¼å…¥åˆ° IDEA/Eclipse ä¸­ã€‚ ç¼–è¯‘GitHub è¿™é‡Œå·²ç»æœ‰æè¿°å¦‚ä½•å¯¼å…¥ IDEA/Eclipse ä¸­ï¼š 1234567891011121314151617181920JDK 10 is required to build Elasticsearch. You must have a JDK 10 installation with the environment variable JAVA_HOME referencing the path to Java home for your JDK 10 installation. By default, tests use the same runtime as JAVA_HOME. However, since Elasticsearch, supports JDK 8 the build supports compiling with JDK 10 and testing on a JDK 8 runtime; to do this, set RUNTIME_JAVA_HOME pointing to the Java home of a JDK 8 installation. Note that this mechanism can be used to test against other JDKs as well, this is not only limited to JDK 8.Note: It is also required to have JAVA7_HOME, JAVA8_HOME and JAVA10_HOME available so that the tests can pass.Warning: do not use sdkman for Java installations which do not have proper jrunscript for jdk distributions.Elasticsearch uses the Gradle wrapper for its build. You can execute Gradle using the wrapper via the gradlew script in the root of the repository.Configuring IDEs And Running TestsEclipse users can automatically configure their IDE: ./gradlew eclipse then File: Import: Existing Projects into Workspace. Select the option Search for nested projects. Additionally you will want to ensure that Eclipse is using 2048m of heap by modifying eclipse.ini accordingly to avoid GC overhead errors.IntelliJ users can automatically configure their IDE: ./gradlew idea then File-&gt;New Project From Existing Sources. Point to the root of the source directory, select Import project from external model-&gt;Gradle, enable Use auto-import. In order to run tests directly from IDEA 2017.2 and above, it is required to disable the IDEA run launcher in order to avoid idea_rt.jar causing &quot;jar hell&quot;. This can be achieved by adding the -Didea.no.launcher=true JVM option. Alternatively, idea.no.launcher=true can be set in the idea.properties file which can be accessed under Help &gt; Edit Custom Properties (this will require a restart of IDEA). For IDEA 2017.3 and above, in addition to the JVM option, you will need to go to Run-&gt;Edit Configurations-&gt;...-&gt;Defaults-&gt;JUnit and verify that the Shorten command line setting is set to user-local default: none. You may also need to remove ant-javafx.jar from your classpath if that is reported as a source of jar hell.To run an instance of elasticsearch from the source code run ./gradlew runThe Elasticsearch codebase makes heavy use of Java asserts and the test runner requires that assertions be enabled within the JVM. This can be accomplished by passing the flag -ea to the JVM on startup.For IntelliJ, go to Run-&gt;Edit Configurations...-&gt;Defaults-&gt;JUnit-&gt;VM options and input -ea.For Eclipse, go to Preferences-&gt;Java-&gt;Installed JREs and add -ea to VM Arguments. ä¸Šé¢è¯´äº†ä¸‹å¦‚ä½•ç¼–è¯‘ Elasticsearch å’Œå¦‚ä½•åœ¨ ide ä¸­é…ç½®å¥½ç¯å¢ƒã€‚ä¸‹é¢è¯´ä¸‹æ­¥éª¤å§ï¼šï¼ˆè¿™é‡Œæˆ‘åªæ˜¯æ¼”ç¤ºåœ¨ IDEA ä¸­å¦‚ä½•å¯¼å…¥ï¼‰ 1ã€åœ¨æˆ‘ä»¬ä¸‹è½½çš„ Elasticsearch æ ¹ç›®å½•ä¸‹æ‰§è¡Œå‘½ä»¤ï¼š(æ‰§è¡Œå·²ç»å†™å¥½çš„è„šæœ¬ gradlew) 1./gradlew idea è¯·æ³¨æ„ç‰ˆæœ¬å’Œæˆ‘çš„ä¸€è‡´ï¼Œæ—©çš„ç‰ˆæœ¬å¯èƒ½æ²¡æœ‰è¯¥æ‰§è¡Œè„šæœ¬ï¼Œéœ€è¦æ‰§è¡Œ gradle idea å‘½ä»¤ æœ€åç»“æœå¦‚ä¸‹ï¼š 2ã€å¯¼å…¥ IDEA idea ä¸­ File -&gt; New Project From Existing Sources é€‰æ‹©ä½ ä¸‹è½½çš„ Elasticsearch æ ¹ç›®å½•ï¼Œç„¶åç‚¹ open ï¼Œä¹‹å Import project from external model -&gt; Gradle , é€‰ä¸­ Use auto-import, ç„¶åå°±å¯ä»¥äº†ã€‚ å¯¼å…¥è¿›å»åï¼Œgradle åˆä¼šç¼–è¯‘ä¸€éï¼Œéœ€è¦ç­‰ä¸€ä¼šï¼Œå¥½äº†ä¹‹åå¦‚ä¸‹ï¼š è¿è¡Œæ‰“å¼€ server æ¨¡å—ä¸‹çš„ Elasticsearch ç±»ï¼šorg.elasticsearch.bootstrap.Elasticsearchï¼Œè¿è¡Œé‡Œé¢çš„ main å‡½æ•°ã€‚ 1ã€æŠ¥é”™å¦‚ä¸‹ï¼š 1ERROR: the system property [es.path.conf] must be set æˆ‘ä»¬åœ¨è¿è¡Œçš„é…ç½® vm options å¦‚ä¸‹ï¼šï¼ˆåé¢å¯åŠ¨æµç¨‹ä¼šå†™ä¸ºä»€ä¹ˆä¼šæŠ¥è¿™ä¸ªé”™è¯¯ï¼‰ 1-Des.path.conf=&quot;/usr/local/elasticsearch-6.3.2/config&quot; 2ã€å†æ¬¡è¿è¡Œï¼ŒæŠ¥é”™å¦‚ä¸‹ï¼š 12345678910Exception in thread &quot;main&quot; java.lang.IllegalStateException: path.home is not configured at org.elasticsearch.env.Environment.&lt;init&gt;(Environment.java:103) at org.elasticsearch.env.Environment.&lt;init&gt;(Environment.java:94) at org.elasticsearch.node.InternalSettingsPreparer.prepareEnvironment(InternalSettingsPreparer.java:86) at org.elasticsearch.cli.EnvironmentAwareCommand.createEnv(EnvironmentAwareCommand.java:95) at org.elasticsearch.cli.EnvironmentAwareCommand.execute(EnvironmentAwareCommand.java:86) at org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:124) at org.elasticsearch.cli.Command.main(Command.java:90) at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:93) at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:86) æˆ‘ä»¬åœ¨è¿è¡Œçš„é…ç½® vm options å¦‚ä¸‹ï¼šï¼ˆåé¢å¯åŠ¨æµç¨‹ä¼šå†™ä¸ºä»€ä¹ˆä¼šæŠ¥è¿™ä¸ªé”™è¯¯ï¼‰ 1-Des.path.home=&quot;/usr/local/elasticsearch-6.3.2&quot; 3ã€å†æ¬¡è¿è¡Œï¼ŒæŠ¥é”™å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252018-08-01 09:38:03,974 main ERROR Could not register mbeans java.security.AccessControlException: access denied (&quot;javax.management.MBeanTrustPermission&quot; &quot;register&quot;) at java.base/java.security.AccessControlContext.checkPermission(AccessControlContext.java:472) at java.base/java.lang.SecurityManager.checkPermission(SecurityManager.java:371) at java.management/com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.checkMBeanTrustPermission(DefaultMBeanServerInterceptor.java:1805) at java.management/com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.registerMBean(DefaultMBeanServerInterceptor.java:318) at java.management/com.sun.jmx.mbeanserver.JmxMBeanServer.registerMBean(JmxMBeanServer.java:522) at org.apache.logging.log4j.core.jmx.Server.register(Server.java:389) at org.apache.logging.log4j.core.jmx.Server.reregisterMBeansAfterReconfigure(Server.java:167) at org.apache.logging.log4j.core.jmx.Server.reregisterMBeansAfterReconfigure(Server.java:140) at org.apache.logging.log4j.core.LoggerContext.setConfiguration(LoggerContext.java:556) at org.apache.logging.log4j.core.LoggerContext.start(LoggerContext.java:261) at org.apache.logging.log4j.core.impl.Log4jContextFactory.getContext(Log4jContextFactory.java:206) at org.apache.logging.log4j.core.config.Configurator.initialize(Configurator.java:220) at org.apache.logging.log4j.core.config.Configurator.initialize(Configurator.java:197) at org.elasticsearch.common.logging.LogConfigurator.configureStatusLogger(LogConfigurator.java:171) at org.elasticsearch.common.logging.LogConfigurator.configure(LogConfigurator.java:140) at org.elasticsearch.common.logging.LogConfigurator.configure(LogConfigurator.java:119) at org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:294) at org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:136) at org.elasticsearch.bootstrap.Elasticsearch.execute(Elasticsearch.java:127) at org.elasticsearch.cli.EnvironmentAwareCommand.execute(EnvironmentAwareCommand.java:86) at org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:124) at org.elasticsearch.cli.Command.main(Command.java:90) at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:93) at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:86) æˆ‘ä»¬åœ¨è¿è¡Œçš„é…ç½® vm options å¦‚ä¸‹ï¼š 1-Dlog4j2.disable.jmx=true 4ã€å¦‚æœä½ ç”¨çš„æ˜¯ JDK 1.8 ç¼–è¯‘çš„åº”è¯¥è¿˜ä¼šæŠ¥è¿™ä¸ªé”™è¯¯ 123456789101112131415161718192021222324[2018-08-01T11:02:24,663][WARN ][o.e.b.ElasticsearchUncaughtExceptionHandler] [] uncaught exception in thread [main]org.elasticsearch.bootstrap.StartupException: java.lang.IllegalStateException: jar hell!class: jdk.packager.services.UserJvmOptionsServicejar1: /Library/Java/JavaVirtualMachines/jdk1.8.0_152.jdk/Contents/Home/lib/ant-javafx.jarjar2: /Library/Java/JavaVirtualMachines/jdk1.8.0_152.jdk/Contents/Home/lib/packager.jar at org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:140) ~[main/:?] at org.elasticsearch.bootstrap.Elasticsearch.execute(Elasticsearch.java:127) ~[main/:?] at org.elasticsearch.cli.EnvironmentAwareCommand.execute(EnvironmentAwareCommand.java:86) ~[main/:?] at org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:124) ~[main/:?] at org.elasticsearch.cli.Command.main(Command.java:90) ~[main/:?] at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:93) ~[main/:?] at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:86) ~[main/:?]Caused by: java.lang.IllegalStateException: jar hell!class: jdk.packager.services.UserJvmOptionsServicejar1: /Library/Java/JavaVirtualMachines/jdk1.8.0_152.jdk/Contents/Home/lib/ant-javafx.jarjar2: /Library/Java/JavaVirtualMachines/jdk1.8.0_152.jdk/Contents/Home/lib/packager.jar at org.elasticsearch.bootstrap.JarHell.checkClass(JarHell.java:273) ~[main/:?] at org.elasticsearch.bootstrap.JarHell.checkJarHell(JarHell.java:190) ~[main/:?] at org.elasticsearch.bootstrap.JarHell.checkJarHell(JarHell.java:86) ~[main/:?] at org.elasticsearch.bootstrap.Bootstrap.setup(Bootstrap.java:198) ~[main/:?] at org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:326) ~[main/:?] at org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:136) ~[main/:?] ... 6 more2018-08-01 11:02:24,713 Thread-2 ERROR No log4j2 configuration file found. Using default configuration: logging only errors to the console. Set system property &apos;log4j2.debug&apos; to show Log4j2 internal initialization logging. æœ‰ä¸¤ä¸ªè§£å†³æ–¹æ³•å°±æ˜¯ï¼Œ ï¼ˆ1ï¼‰ã€æŠŠæºç ä¸­æœ‰å…³ä½¿ç”¨äº† JarHell.checkJarHell ä»£ç çš„åœ°æ–¹å…¨éƒ¨æ³¨é‡Šæ‰å°±å¥½äº† ï¼ˆ2ï¼‰ã€æ¢æˆ JDK 10 ç¼–è¯‘ ä¸¤ç§æ–¹æ³•æˆ‘éƒ½è¯•äº†æ˜¯å¯è¡Œçš„ï¼Œå»ºè®®ç›´æ¥æ¢ç¬¬äºŒç§æ–¹æ¡ˆå§ï¼ 5ã€ç„¶åå†å¯åŠ¨çš„è¯ï¼Œåº”è¯¥æ²¡é—®é¢˜äº†,å‡ºç°ä¸‹é¢æ—¥å¿—ï¼šï¼ˆç½‘ä¸Šå¾ˆå¤šäººåœ¨è¿™æ­¥å°±å¥½äº†ï¼‰ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556[elasticsearch] Java HotSpot(TM) 64-Bit Server VM warning: Option UseConcMarkSweepGC was deprecated in version 9.0 and will likely be removed in a future release.[elasticsearch] [2018-08-04T16:42:26,073][INFO ][o.e.n.Node ] [node-0] initializing ...[elasticsearch] [2018-08-04T16:42:26,185][INFO ][o.e.e.NodeEnvironment ] [node-0] using [1] data paths, mounts [[/ (/dev/disk1s1)]], net usable_space [109.3gb], net total_space [233.4gb], types [apfs][elasticsearch] [2018-08-04T16:42:26,187][INFO ][o.e.e.NodeEnvironment ] [node-0] heap size [494.9mb], compressed ordinary object pointers [true][elasticsearch] [2018-08-04T16:42:26,190][INFO ][o.e.n.Node ] [node-0] node name [node-0], node ID [o9SuMXP-R7uvJLtE3h37Rw][elasticsearch] [2018-08-04T16:42:26,191][INFO ][o.e.n.Node ] [node-0] version[6.3.2-SNAPSHOT], pid[61499], build[default/zip/053779d/2018-08-04T08:39:59.714654Z], OS[Mac OS X/10.13.5/x86_64], JVM[&quot;Oracle Corporation&quot;/Java HotSpot(TM) 64-Bit Server VM/10.0.2/10.0.2+13][elasticsearch] [2018-08-04T16:42:26,191][INFO ][o.e.n.Node ] [node-0] JVM arguments [-Xms1g, -Xmx1g, -XX:+UseConcMarkSweepGC, -XX:CMSInitiatingOccupancyFraction=75, -XX:+UseCMSInitiatingOccupancyOnly, -XX:+AlwaysPreTouch, -Xss1m, -Djava.awt.headless=true, -Dfile.encoding=UTF-8, -Djna.nosys=true, -XX:-OmitStackTraceInFastThrow, -Dio.netty.noUnsafe=true, -Dio.netty.noKeySetOptimization=true, -Dio.netty.recycler.maxCapacityPerThread=0, -Dlog4j.shutdownHookEnabled=false, -Dlog4j2.disable.jmx=true, -Djava.io.tmpdir=/var/folders/mb/3vpbvkkx13l2jmpt2kmmt0fr0000gn/T/elasticsearch.URRKTybG, -XX:+HeapDumpOnOutOfMemoryError, -XX:HeapDumpPath=data, -XX:ErrorFile=logs/hs_err_pid%p.log, -Xlog:gc*,gc+age=trace,safepoint:file=logs/gc.log:utctime,pid,tags:filecount=32,filesize=64m, -Djava.locale.providers=COMPAT, -XX:UseAVX=2, -ea, -esa, -Xms512m, -Xmx512m, -Des.path.home=/Users/zhisheng/IdeaProjects/github/elasticsearch/distribution/build/cluster/run node0/elasticsearch-6.3.2-SNAPSHOT, -Des.path.conf=/Users/zhisheng/IdeaProjects/github/elasticsearch/distribution/build/cluster/run node0/elasticsearch-6.3.2-SNAPSHOT/config, -Des.distribution.flavor=default, -Des.distribution.type=zip][elasticsearch] [2018-08-04T16:42:26,191][WARN ][o.e.n.Node ] [node-0] version [6.3.2-SNAPSHOT] is a pre-release version of Elasticsearch and is not suitable for production[elasticsearch] [2018-08-04T16:42:28,808][INFO ][o.e.p.PluginsService ] [node-0] loaded module [aggs-matrix-stats][elasticsearch] [2018-08-04T16:42:28,809][INFO ][o.e.p.PluginsService ] [node-0] loaded module [analysis-common][elasticsearch] [2018-08-04T16:42:28,809][INFO ][o.e.p.PluginsService ] [node-0] loaded module [ingest-common][elasticsearch] [2018-08-04T16:42:28,809][INFO ][o.e.p.PluginsService ] [node-0] loaded module [lang-expression][elasticsearch] [2018-08-04T16:42:28,809][INFO ][o.e.p.PluginsService ] [node-0] loaded module [lang-mustache][elasticsearch] [2018-08-04T16:42:28,809][INFO ][o.e.p.PluginsService ] [node-0] loaded module [lang-painless][elasticsearch] [2018-08-04T16:42:28,809][INFO ][o.e.p.PluginsService ] [node-0] loaded module [mapper-extras][elasticsearch] [2018-08-04T16:42:28,809][INFO ][o.e.p.PluginsService ] [node-0] loaded module [parent-join][elasticsearch] [2018-08-04T16:42:28,809][INFO ][o.e.p.PluginsService ] [node-0] loaded module [percolator][elasticsearch] [2018-08-04T16:42:28,809][INFO ][o.e.p.PluginsService ] [node-0] loaded module [rank-eval][elasticsearch] [2018-08-04T16:42:28,809][INFO ][o.e.p.PluginsService ] [node-0] loaded module [reindex][elasticsearch] [2018-08-04T16:42:28,810][INFO ][o.e.p.PluginsService ] [node-0] loaded module [repository-url][elasticsearch] [2018-08-04T16:42:28,810][INFO ][o.e.p.PluginsService ] [node-0] loaded module [transport-netty4][elasticsearch] [2018-08-04T16:42:28,810][INFO ][o.e.p.PluginsService ] [node-0] loaded module [tribe][elasticsearch] [2018-08-04T16:42:28,810][INFO ][o.e.p.PluginsService ] [node-0] loaded module [x-pack-core][elasticsearch] [2018-08-04T16:42:28,810][INFO ][o.e.p.PluginsService ] [node-0] loaded module [x-pack-deprecation][elasticsearch] [2018-08-04T16:42:28,810][INFO ][o.e.p.PluginsService ] [node-0] loaded module [x-pack-graph][elasticsearch] [2018-08-04T16:42:28,810][INFO ][o.e.p.PluginsService ] [node-0] loaded module [x-pack-logstash][elasticsearch] [2018-08-04T16:42:28,810][INFO ][o.e.p.PluginsService ] [node-0] loaded module [x-pack-ml][elasticsearch] [2018-08-04T16:42:28,810][INFO ][o.e.p.PluginsService ] [node-0] loaded module [x-pack-monitoring][elasticsearch] [2018-08-04T16:42:28,810][INFO ][o.e.p.PluginsService ] [node-0] loaded module [x-pack-rollup][elasticsearch] [2018-08-04T16:42:28,810][INFO ][o.e.p.PluginsService ] [node-0] loaded module [x-pack-security][elasticsearch] [2018-08-04T16:42:28,811][INFO ][o.e.p.PluginsService ] [node-0] loaded module [x-pack-sql][elasticsearch] [2018-08-04T16:42:28,811][INFO ][o.e.p.PluginsService ] [node-0] loaded module [x-pack-upgrade][elasticsearch] [2018-08-04T16:42:28,811][INFO ][o.e.p.PluginsService ] [node-0] loaded module [x-pack-watcher][elasticsearch] [2018-08-04T16:42:28,811][INFO ][o.e.p.PluginsService ] [node-0] no plugins loaded[elasticsearch] [2018-08-04T16:42:32,722][INFO ][o.e.x.s.a.s.FileRolesStore] [node-0] parsed [0] roles from file [/Users/zhisheng/IdeaProjects/github/elasticsearch/distribution/build/cluster/run node0/elasticsearch-6.3.2-SNAPSHOT/config/roles.yml][elasticsearch] [2018-08-04T16:42:33,358][INFO ][o.e.x.m.j.p.l.CppLogMessageHandler] [controller/61517] [Main.cc@109] controller (64 bit): Version 6.3.2-SNAPSHOT (Build 903094f295d249) Copyright (c) 2018 Elasticsearch BV[elasticsearch] [2018-08-04T16:42:33,783][DEBUG][o.e.a.ActionModule ] Using REST wrapper from plugin org.elasticsearch.xpack.security.Security[elasticsearch] [2018-08-04T16:42:34,110][INFO ][o.e.d.DiscoveryModule ] [node-0] using discovery type [zen][elasticsearch] [2018-08-04T16:42:34,971][INFO ][o.e.n.Node ] [node-0] initialized[elasticsearch] [2018-08-04T16:42:34,971][INFO ][o.e.n.Node ] [node-0] starting ...[elasticsearch] [2018-08-04T16:42:35,217][INFO ][o.e.t.TransportService ] [node-0] publish_address &#123;127.0.0.1:9300&#125;, bound_addresses &#123;[::1]:9300&#125;, &#123;127.0.0.1:9300&#125;[elasticsearch] [2018-08-04T16:42:38,291][INFO ][o.e.c.s.MasterService ] [node-0] zen-disco-elected-as-master ([0] nodes joined)[, ], reason: new_master &#123;node-0&#125;&#123;o9SuMXP-R7uvJLtE3h37Rw&#125;&#123;xjoT1zvpRsm1ZDGLCab1sA&#125;&#123;127.0.0.1&#125;&#123;127.0.0.1:9300&#125;&#123;ml.machine_memory=17179869184, xpack.installed=true, testattr=test, ml.max_open_jobs=20, ml.enabled=true&#125;[elasticsearch] [2018-08-04T16:42:38,295][INFO ][o.e.c.s.ClusterApplierService] [node-0] new_master &#123;node-0&#125;&#123;o9SuMXP-R7uvJLtE3h37Rw&#125;&#123;xjoT1zvpRsm1ZDGLCab1sA&#125;&#123;127.0.0.1&#125;&#123;127.0.0.1:9300&#125;&#123;ml.machine_memory=17179869184, xpack.installed=true, testattr=test, ml.max_open_jobs=20, ml.enabled=true&#125;, reason: apply cluster state (from master [master &#123;node-0&#125;&#123;o9SuMXP-R7uvJLtE3h37Rw&#125;&#123;xjoT1zvpRsm1ZDGLCab1sA&#125;&#123;127.0.0.1&#125;&#123;127.0.0.1:9300&#125;&#123;ml.machine_memory=17179869184, xpack.installed=true, testattr=test, ml.max_open_jobs=20, ml.enabled=true&#125; committed version [1] source [zen-disco-elected-as-master ([0] nodes joined)[, ]]])[elasticsearch] [2018-08-04T16:42:38,317][INFO ][o.e.x.s.t.n.SecurityNetty4HttpServerTransport] [node-0] publish_address &#123;127.0.0.1:9200&#125;, bound_addresses &#123;[::1]:9200&#125;, &#123;127.0.0.1:9200&#125;[elasticsearch] [2018-08-04T16:42:38,319][INFO ][o.e.n.Node ] [node-0] started[elasticsearch] [2018-08-04T16:42:38,358][WARN ][o.e.x.s.a.s.m.NativeRoleMappingStore] [node-0] Failed to clear cache for realms [[]][elasticsearch] [2018-08-04T16:42:38,413][INFO ][o.e.g.GatewayService ] [node-0] recovered [0] indices into cluster_state[elasticsearch] [2018-08-04T16:42:38,597][INFO ][o.e.c.m.MetaDataIndexTemplateService] [node-0] adding template [.watch-history-7] for index patterns [.watcher-history-7*][elasticsearch] [2018-08-04T16:42:38,660][INFO ][o.e.c.m.MetaDataIndexTemplateService] [node-0] adding template [.watches] for index patterns [.watches*][elasticsearch] [2018-08-04T16:42:38,707][INFO ][o.e.c.m.MetaDataIndexTemplateService] [node-0] adding template [.triggered_watches] for index patterns [.triggered_watches*][elasticsearch] [2018-08-04T16:42:38,771][INFO ][o.e.c.m.MetaDataIndexTemplateService] [node-0] adding template [.monitoring-logstash] for index patterns [.monitoring-logstash-6-*][elasticsearch] [2018-08-04T16:42:38,836][INFO ][o.e.c.m.MetaDataIndexTemplateService] [node-0] adding template [.monitoring-es] for index patterns [.monitoring-es-6-*][elasticsearch] [2018-08-04T16:42:38,878][INFO ][o.e.c.m.MetaDataIndexTemplateService] [node-0] adding template [.monitoring-alerts] for index patterns [.monitoring-alerts-6][elasticsearch] [2018-08-04T16:42:38,926][INFO ][o.e.c.m.MetaDataIndexTemplateService] [node-0] adding template [.monitoring-beats] for index patterns [.monitoring-beats-6-*][elasticsearch] [2018-08-04T16:42:38,970][INFO ][o.e.c.m.MetaDataIndexTemplateService] [node-0] adding template [.monitoring-kibana] for index patterns [.monitoring-kibana-6-*][elasticsearch] [2018-08-04T16:42:39,055][INFO ][o.e.l.LicenseService ] [node-0] license [79704513-d3c4-4535-8276-beeb146765de] mode [basic] - valid 6ã€ä½†æ˜¯æˆ‘å‡ºç°äº†ä¸‹é¢è¿™ä¸ªé—®é¢˜ï¼Œä¸€ç›´å›°æ‰°ç€æˆ‘å‘¢ï¼Œæˆ‘æ˜¯ç›´æ¥è·³è¿‡å»çš„ã€‚ 12345678910111213141516171819202122[2018-08-01T09:44:27,370][ERROR][o.e.b.ElasticsearchUncaughtExceptionHandler] [] fatal error in thread [main], exitingjava.lang.NoClassDefFoundError: org/elasticsearch/plugins/ExtendedPluginsClassLoader at org.elasticsearch.plugins.PluginsService.loadBundle(PluginsService.java:632) ~[main/:?] at org.elasticsearch.plugins.PluginsService.loadBundles(PluginsService.java:557) ~[main/:?] at org.elasticsearch.plugins.PluginsService.&lt;init&gt;(PluginsService.java:162) ~[main/:?] at org.elasticsearch.node.Node.&lt;init&gt;(Node.java:311) ~[main/:?] at org.elasticsearch.node.Node.&lt;init&gt;(Node.java:252) ~[main/:?] at org.elasticsearch.bootstrap.Bootstrap$5.&lt;init&gt;(Bootstrap.java:213) ~[main/:?] at org.elasticsearch.bootstrap.Bootstrap.setup(Bootstrap.java:213) ~[main/:?] at org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:326) ~[main/:?] at org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:136) ~[main/:?] at org.elasticsearch.bootstrap.Elasticsearch.execute(Elasticsearch.java:127) ~[main/:?] at org.elasticsearch.cli.EnvironmentAwareCommand.execute(EnvironmentAwareCommand.java:86) ~[main/:?] at org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:124) ~[main/:?] at org.elasticsearch.cli.Command.main(Command.java:90) ~[main/:?] at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:93) ~[main/:?] at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:86) ~[main/:?]Caused by: java.lang.ClassNotFoundException: org.elasticsearch.plugins.ExtendedPluginsClassLoader at jdk.internal.loader.BuiltinClassLoader.loadClass(BuiltinClassLoader.java:582) ~[?:?] at jdk.internal.loader.ClassLoaders$AppClassLoader.loadClass(ClassLoaders.java:190) ~[?:?] at java.lang.ClassLoader.loadClass(ClassLoader.java:499) ~[?:?] ... 15 more é‡åˆ°çš„è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘åœ¨ GitHub æ±‚åŠ©ä¿¡æ¯å¦‚ä¸‹ï¼š https://github.com/elastic/elasticsearch/issues/30774 ä½†æ˜¯å¹¶æ²¡æœ‰è§£å†³æˆ‘çš„é—®é¢˜ï¼Œè¿™é‡Œæš‚æ—¶å…ˆè®°å½•ä¸‹æ¥ï¼æˆ‘è‡ªå·±ä¹Ÿè·Ÿäº†ä¸‹æºç ï¼Œå®šä½åˆ°é”™è¯¯ä¿¡æ¯æ˜¯æ€ä¹ˆäº§ç”Ÿçš„ï¼Œä½†æ˜¯æ²¡æœ‰è§£å†³æ–¹æ¡ˆï¼ åé¢å†™äº†ç¯‡æ–‡ç« ï¼šæ•™ä½ å¦‚ä½•åœ¨ IDEA è¿œç¨‹ Debug ElasticSearch æˆ–è®¸å¯ä»¥å¸®ä½ è§£å†³ä¸Šé¢é—®é¢˜å¸¦ç»™ä½ çš„å›°æ‰°ï¼ æ›´æ–°åé¢æœ‰ä¸€ä¸ªè¯»è€…æé†’äº†æˆ‘ä¸€ä¸‹ï¼Œä»–è‡ªå·±ä¹Ÿé‡åˆ°è¿™ä¸ªé—®é¢˜ï¼Œç„¶åä»–çš„è§£å†³æ–¹æ¡ˆæŒºå¥½çš„ï¼Œå®Œç¾è§£å†³æˆ‘çš„é—®é¢˜ã€‚è¿™é‡Œåšä¸ªè®°å½•ï¼š è§£å†³æ–¹æ³•ï¼š æ‰“å¼€ IDEA Edit Configurations ï¼Œç»™ Include dependencies with Provided scope æ‰“ä¸Šå‹¾å³å¯è§£å†³ï¼Œå¾ˆç®€å•å§ï¼ï¼ ç»§ç»­RUNï¼Œåˆæ¥ä¸€ä¸ª EXceptinï¼š 1234567891011121314151617[2018-08-23T01:13:38,551][WARN ][o.e.b.ElasticsearchUncaughtExceptionHandler] [] uncaught exception in thread [main]org.elasticsearch.bootstrap.StartupException: java.security.AccessControlException: access denied (&quot;java.lang.RuntimePermission&quot; &quot;createClassLoader&quot;) at org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:140) ~[main/:?] at org.elasticsearch.bootstrap.Elasticsearch.execute(Elasticsearch.java:127) ~[main/:?] at org.elasticsearch.cli.EnvironmentAwareCommand.execute(EnvironmentAwareCommand.java:86) ~[main/:?] at org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:124) ~[main/:?] at org.elasticsearch.cli.Command.main(Command.java:90) ~[main/:?] at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:93) ~[main/:?] at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:86) ~[main/:?]Caused by: java.security.AccessControlException: access denied (&quot;java.lang.RuntimePermission&quot; &quot;createClassLoader&quot;) at java.security.AccessControlContext.checkPermission(AccessControlContext.java:472) ~[?:?] at java.security.AccessController.checkPermission(AccessController.java:895) ~[?:?] at java.lang.SecurityManager.checkPermission(SecurityManager.java:335) ~[?:?] at java.lang.SecurityManager.checkCreateClassLoader(SecurityManager.java:397) ~[?:?]...Exception: java.security.AccessControlException thrown from the UncaughtExceptionHandler in thread &quot;Thread-2&quot; ç¬¬ä¸€ç§ï¼š åœ¨ config ç›®å½•ä¸‹æ–°å»º java.policy æ–‡ä»¶ï¼Œå¡«å…¥ä¸‹é¢å†…å®¹: 123grant &#123; permission java.lang.RuntimePermission &quot;createClassLoader&quot;;&#125;; ç„¶ååœ¨ VM options åŠ å…¥ java.security.policy çš„è®¾ç½®ï¼ŒæŒ‡å‘è¯¥æ–‡ä»¶å³å¯ 1-Djava.security.policy=/usr/local/elasticsearch-6.3.2/config/java.policy ç¬¬äºŒç§ï¼š å°±æ˜¯åœ¨ %JAVA_HOME%/conf/security ç›®å½•ä¸‹ï¼ˆJDK10æ˜¯è¿™ä¸ªè·¯å¾„ï¼Œä¹‹å‰çš„ç‰ˆæœ¬ä¸ç¡®å®šï¼‰ï¼Œæˆ‘çš„ç›®å½•æ˜¯ /Library/Java/JavaVirtualMachines/jdk-10.0.2.jdk/Contents/Home/conf/securityï¼Œæ‰“å¼€ java.policy æ–‡ä»¶ï¼Œåœ¨ grant ä¸­åŠ å…¥ä¸‹é¢è¿™å¥ï¼Œèµ‹äºˆæƒé™ã€‚ 12//for es 6.3.2permission java.lang.RuntimePermission &quot;createClassLoader&quot;; å† RUNï¼Œè¿™æ¬¡å¯ç»ˆäºè¿è¡Œèµ·æ¥äº†ï¼ï¼ï¼ å†æ¬¡æ„Ÿè°¢ä¸‹è¯»è€…ï¼Œä»–çš„æ–‡ç« åœ°å€æ˜¯ï¼šhttp://laijianfeng.org/2018/08/%E6%95%99%E4%BD%A0%E7%BC%96%E8%AF%91%E8%B0%83%E8%AF%95Elasticsearch-6-3-2%E6%BA%90%E7%A0%81/ æ€»ç»“æŠ˜è…¾çš„è·¯ä¸Šå°‘ä¸äº†å„ç§é”™è¯¯çƒ¦æ‰°ä½ ï¼Œå­¦ä¼šè§£å†³é—®é¢˜ï¼ ç›¸å…³æ–‡ç« 1ã€æ¸£æ¸£èœé¸¡ä¸ºä»€ä¹ˆè¦çœ‹ ElasticSearch æºç ï¼Ÿ 2ã€æ¸£æ¸£èœé¸¡çš„ ElasticSearch æºç è§£æ â€”â€” ç¯å¢ƒæ­å»º 3ã€æ¸£æ¸£èœé¸¡çš„ ElasticSearch æºç è§£æ â€”â€” å¯åŠ¨æµç¨‹(ä¸Š) 4ã€æ¸£æ¸£èœé¸¡çš„ ElasticSearch æºç è§£æ â€”â€” å¯åŠ¨æµç¨‹(ä¸‹) 5ã€Elasticsearch ç³»åˆ—æ–‡ç« ï¼ˆä¸€ï¼‰ï¼šElasticsearch é»˜è®¤åˆ†è¯å™¨å’Œä¸­åˆ†åˆ†è¯å™¨ä¹‹é—´çš„æ¯”è¾ƒåŠä½¿ç”¨æ–¹æ³• 6ã€Elasticsearch ç³»åˆ—æ–‡ç« ï¼ˆäºŒï¼‰ï¼šå…¨æ–‡æœç´¢å¼•æ“ Elasticsearch é›†ç¾¤æ­å»ºå…¥é—¨æ•™ç¨‹ 7ã€Elasticsearch ç³»åˆ—æ–‡ç« ï¼ˆä¸‰ï¼‰ï¼šElasticSearch é›†ç¾¤ç›‘æ§ 8ã€Elasticsearch ç³»åˆ—æ–‡ç« ï¼ˆå››ï¼‰ï¼šElasticSearch å•ä¸ªèŠ‚ç‚¹ç›‘æ§ 9ã€Elasticsearch ç³»åˆ—æ–‡ç« ï¼ˆäº”ï¼‰ï¼šELK å®æ—¶æ—¥å¿—åˆ†æå¹³å°ç¯å¢ƒæ­å»º 10ã€æ•™ä½ å¦‚ä½•åœ¨ IDEA è¿œç¨‹ Debug ElasticSearch","tags":[{"name":"ElasticSearch","slug":"ElasticSearch","permalink":"http://www.54tianzhisheng.cn/tags/ElasticSearch/"}]},{"title":"æ¸£æ¸£èœé¸¡ä¸ºä»€ä¹ˆè¦çœ‹ ElasticSearch æºç ï¼Ÿ","date":"2018-08-03T16:00:00.000Z","path":"2018/08/04/why-see-es-code/","text":"å‰æäººå·¥æ™ºèƒ½ã€å¤§æ•°æ®å¿«é€Ÿå‘å±•çš„ä»Šå¤©ï¼Œå¯¹äº TB ç”šè‡³ PB çº§å¤§æ•°æ®çš„å¿«é€Ÿæ£€ç´¢å·²ç„¶æˆä¸ºåˆšéœ€ï¼Œå¤§å‹ä¼ä¸šæ—©å·²æ·¹æ²¡åœ¨ç³»ç»Ÿç”Ÿæˆçš„æµ©ç€šæ•°æ®æµå½“ä¸­ã€‚å¤§æ•°æ®æŠ€æœ¯ä¸šå·²é›†ä¸­åœ¨å¦‚ä½•å­˜å‚¨å’Œå¤„ç†è¿™äº›æµ·é‡çš„æ•°æ®ä¸Šã€‚Elasticsearch ä½œä¸ºå¼€æºé¢†åŸŸçš„åèµ·ä¹‹ç§€ï¼Œä»2010å¹´è‡³ä»Šå¾—åˆ°é£è·ƒå¼çš„å‘å±•ã€‚ Elasticsearch ä»¥å…¶å¼€æºã€åˆ†å¸ƒå¼ã€RESTFul API ä¸‰å¤§ä¼˜åŠ¿ï¼Œå·²ç»æˆä¸ºå½“ä¸‹é£å£ä¸­â€œä¼šé£çš„çŒªâ€ã€‚ åœ¨æˆ‘çš„ç”µè„‘æœ¬åœ°å†™äº†å‡ ç¯‡ ElasticSearch çš„æºç è§£æäº†ï¼Œå›è¿‡å¤´æ¥æƒ³æƒ³åº”è¯¥ä¹Ÿå†™ä¸€ç¯‡ä¸ºä½•æˆ‘ä¼šå»çœ‹å®ƒçš„æºç ï¼Ÿ ä¸ºä»€ä¹ˆå‘¢ï¼Ÿä¸‹é¢æˆ‘è®²è®²è‡ªå·±ä»æ¥è§¦æœç´¢åˆ°ç°åœ¨çœ‹æºç çš„è¿‡ç¨‹ï¼ å…³æ³¨æˆ‘ è½¬è½½è¯·åŠ¡å¿…æ³¨æ˜åŸåˆ›åœ°å€ä¸ºï¼šhttp://www.54tianzhisheng.cn/2018/08/24/why-see-es-code/ ç¬¬ä¸€æ¬¡æ¥è§¦æœç´¢æœç´¢ï¼Œæˆ‘ä»¬é¦–å…ˆæƒ³åˆ°çš„æ˜¯æœç´¢å¼•æ“ï¼šGoogleã€ç™¾åº¦ï¼Œè¿™ä¸ªå°±ç®—æ˜¯æ¥è§¦çš„æœ€æ—©çš„äº†ã€‚ æˆ‘è‡ªå·±é¡¹ç›®é‡Œé¢æ¥è§¦æœç´¢æ˜¯å¤§äºŒæš‘å‡é‚£æ—¶ç»ƒä¹ çš„ä¸€ä¸ªé¡¹ç›®ï¼Œé‡Œé¢ç”¨äº† Solrï¼Œç„¶åå½“æ—¶è‡ªå·±ä¹Ÿç¨å¾®äº†è§£äº†ä¸‹ï¼Œå¹¶ç”¨åœ¨äº†é¡¹ç›®é‡Œé¢ã€‚ ç¬¬äºŒæ¬¡æ¥è§¦æœç´¢ä»ç¬¬ä¸€æ¬¡é¡¹ç›®é‡Œé¢ç”¨åˆ°äº†æœç´¢ï¼Œåé¢è‡ªå·±å¯¹è¿™æ–¹é¢å°±æ¯”è¾ƒæ„Ÿå…´è¶£ã€‚å†ä¸€æ¬¡æ¥è§¦æœç´¢æ˜¯å®ä¹ çš„æ—¶å€™è¿›å…¬å¸ã€‚ç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯è¢«è€å¤§å«çš„å»å­¦ä¹ æ­å»º Elasticsearch é›†ç¾¤ï¼Œäºæ˜¯ä¹ï¼Œç”µè„‘å°±è£…äº†ä¸‰ä¸ªè™šæ‹Ÿæœºï¼ŒElasticsearch å°±ä¸€ä¸ªä¸ªçš„è£…äº†èµ·æ¥äº†ã€‚ä¹Ÿè®°å½•äº†åšå®¢ä¸‹æ¥ï¼šElasticsearch ç³»åˆ—æ–‡ç« ï¼ˆäºŒï¼‰ï¼šå…¨æ–‡æœç´¢å¼•æ“ Elasticsearch é›†ç¾¤æ­å»ºå…¥é—¨æ•™ç¨‹ï¼Œå½“æ—¶æ­å»ºçš„æ—¶å€™ ES çš„ç‰ˆæœ¬æ‰åˆšä» 2.x å‡çº§åˆ° 5.x å‘¢ï¼Œæˆªæ­¢æœ¬æ–‡æ—¶é—´ 2018.08.04ï¼Œç°åœ¨ ES ç‰ˆæœ¬å·²ç»æ˜¯åˆ° 7.0 äº†ï¼Œè¿™ç‰ˆæœ¬å‡çº§æ˜¯çœŸçš„çš„å¿«ï¼Œè¿™ä¹Ÿè¯´æ˜äº† ES çš„æ´»è·ƒåº¦å¾ˆé«˜ï¼ŒèƒŒåçš„å¼€å‘å·¥ç¨‹å¸ˆç»´æŠ¤ä¹Ÿå¿«ï¼Œä¾§é¢çªå‡ºè¦å»çœ‹å®ƒæºç çš„é‡è¦æ€§ã€‚ å½“æ—¶è‡ªå·±åœ¨æœ¬åœ°æµ‹è¯•æ­å»ºé›†ç¾¤åï¼Œç»™åˆ†é…äº†å¦å¤–ä¸€ä¸ªä»»åŠ¡å°±æ˜¯å»äº†è§£ ES ä¸­çš„è‡ªå¸¦åˆ†è¯ã€è‹±æ–‡åˆ†è¯ã€ä¸­æ–‡åˆ†è¯çš„ç›¸åŒä¸å·®å¼‚ã€ä»¥åŠè‡ªå·±å»ºç«‹åˆ†è¯éœ€è¦æ³¨æ„çš„ç‚¹ã€‚äºæ˜¯ä¹ï¼šå½“æ—¶åœ¨å…¬å¸ wiki è´¡çŒ®äº†è¿™ç¯‡æ–‡ç« ï¼šElasticsearch ç³»åˆ—æ–‡ç« ï¼ˆä¸€ï¼‰ï¼šElasticsearch é»˜è®¤åˆ†è¯å™¨å’Œä¸­åˆ†åˆ†è¯å™¨ä¹‹é—´çš„æ¯”è¾ƒåŠä½¿ç”¨æ–¹æ³•ã€‚è¿™ç¯‡æ–‡ç« å‡ ä¹å·²ç»æŠŠå¸‚é¢ä¸Šæ‰€æœ‰çš„åˆ†è¯éƒ½å†™è¿›å»äº†ï¼ŒåŒ…æ‹¬ä»–ä»¬çš„ç›¸åŒç‚¹ã€ä¸åŒç‚¹ã€å¦‚ä½•ä½¿ç”¨ã€å¦‚ä½•è‡ªå®šä¹‰åˆ†è¯å™¨ã€‚ ç„¶åè¿˜æœ‰å°±æ˜¯æˆ‘åŒç»„çš„ä¸€ä¸ªåŒå­¦ï¼Œå¥¹çš„ä»»åŠ¡å°±æ˜¯ 2.x å‡çº§åˆ° 5.x ä¸­ mapping çš„å¤§æ”¹å˜æœ‰å“ªäº›ï¼Ÿåé¢æˆ‘ä¹Ÿçœ‹äº†å¥¹æ€»ç»“çš„æ–‡æ¡£ï¼Œå¾ˆè¯¦ç»†ï¼ åœ¨è¿™æ¬¡æ¥è§¦äº† ES åï¼Œå› ä¸ºæˆ‘è‡ªå·±æœ¬åœ°å·²ç»æœ‰ç¯å¢ƒäº†ï¼Œæ‰€ä»¥è‡ªå·±æµ‹è¯•äº†ä¸€äº›åŠŸèƒ½ï¼Œç»™ ES å®‰è£…æ’ä»¶ï¼ˆIKã€x-packã€æ”¯æŒ sql çš„ã€ï¼‰ï¼Œåé¢è‡ªå·±ä¹Ÿå»æµ‹è¯• ES çš„ç´¢å¼•ã€æ–‡æ¡£ã€REST APIã€‚ ç¬¬ä¸‰æ¬¡æ¥è§¦æœç´¢ç”±äºæ˜¯è‡ªå·±å¯¹å…¶æ„Ÿå…´è¶£ï¼Œæ‰€ä»¥åé¢å°±å»æ‰¾äº†äº›ç›¸å…³çš„è§†é¢‘ï¼Œæ¯”å¦‚ï¼šä¸­åçŸ³è¡«çš„ã€ŠElasticsearch é¡¶å°–é«˜æ‰‹ç³»åˆ—-é«˜æ‰‹è¿›é˜¶ç¯‡ã€‹å‡ ä¸ªç³»åˆ—è§†é¢‘æ•™ç¨‹ä¸ªäººæ„Ÿè§‰è¿˜æ˜¯ä¸é”™çš„ï¼Œçœ‹å®Œè¿™å‡ ä¸ªç³»åˆ—ä¼°è®¡å…¥é—¨è‚¯å®šæ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚ç‰ˆæƒåŸå› ï¼Œä¸æä¾›ä¸‹è½½é“¾æ¥ã€‚ å¦å¤–å°±æ˜¯ã€ŠElasticsearch æƒå¨æŒ‡å—ã€‹ç¿»è¯‘çš„ç‰ˆæœ¬ï¼Œç¿»è¯‘è¿˜æ²¡æœ‰å…¨ï¼Œå¯ä»¥å»çœ‹çœ‹ï¼Œè®²å¾—å¾ˆè¯¦ç»†çš„ï¼Œå¸‚é¢ä¸Šåº”è¯¥è¿˜æ²¡æœ‰å“ªæœ¬ä¹¦è®²çš„æœ‰è¿™ä¹ˆæ¸…æ¥šï¼Œå¦‚æœè‹±æ–‡ä¸é”™çš„å¯ä»¥ç›´æ¥å•ƒè‹±æ–‡å§ã€‚ è¿˜æœ‰å°±æ˜¯å®˜ç½‘çš„æ–‡æ¡£äº†ï¼Œéå¸¸éå¸¸è¯¦ç»†ï¼Œè¿˜æœ‰ demoï¼Œ2.x ç‰ˆæœ¬çš„æ˜¯æœ‰ä¸­æ–‡çš„å®˜æ–¹æ–‡æ¡£ï¼Œå¯ä»¥å‡‘åˆç€çœ‹ã€‚ å­¦ä¹ æ–°ä¸œè¥¿ï¼Œè¦å­¦ä¼šå…ˆçœ‹å®˜æ–¹æ–‡æ¡£ï¼Œä½•å†µ Elasticsearch çš„å®˜æ–¹æ–‡æ¡£è¿™ä¹ˆè¯¦ç»†å‘¢ï¼ ç¬¬å››æ¬¡æ¥è§¦æœç´¢åé¢å®ä¹ çš„æ—¶å€™ï¼Œåˆåˆ†é…äº†å…¬å¸ä¸­é—´ä»¶ç›‘æ§çš„ä¸¤ä¸ªæ¨¡å—ï¼šElasticsearch å’Œ HBase ç»„ä»¶çš„ç›‘æ§ã€‚äºæ˜¯ä¹ï¼Œå†æ¬¡æœ‰æœºä¼šæ¥è§¦ Elasticsearch äº†ï¼Œè¿™æ¬¡ä¸»è¦è¿˜æ˜¯åˆ©ç”¨ Elasticsearch è‡ªå¸¦çš„ REST API ï¼š_cluster/health ã€_cluster/statsã€_nodesã€_nodes/stats å»è·å–åˆ°é›†ç¾¤çš„å¥åº·ä¿¡æ¯ã€èŠ‚ç‚¹ä¿¡æ¯ï¼ˆå†…å­˜ã€CPUã€ç½‘ç»œã€JVMç­‰ä¿¡æ¯ï¼‰ã€‚ä¸ºäº†åšè¿™ä¸ªé¡¹ç›®è‡ªå·±å½“æ—¶ä¹Ÿå»æ‰¾äº†ç½‘ä¸Šå¾ˆå¤šç±»ä¼¼çš„æ–‡ç« å‚è€ƒå¸¸ç”¨çš„ç›‘æ§æŒ‡æ ‡å’Œä»–ä»¬æ˜¯æ€ä¹ˆåšç›‘æ§çš„ã€‚æˆ‘å½“æ—¶çš„ä»»åŠ¡ä¸»è¦è¿˜æ˜¯é‡‡é›†ä¿¡æ¯ï¼Œç„¶åå­˜åˆ°å…¬å¸å¤§é¡¹ç›®çš„ influxdb ä¸­ï¼Œæœ€åç”¨ grafana å±•ç¤ºå‡ºæ¥ï¼Œåé¢æˆ‘ç»„çš„è¿ç»´å¤§ä½¬ç»™æˆ‘çœ‹äº†ç›‘æ§å¤§ç›˜ï¼Œç•Œé¢æŒºé…·ç‚«çš„ï¼Œå“ˆå“ˆå“ˆï¼Œç‰›é€¼ï¼ å½“æ—¶å†™çš„ä¸¤ç¯‡åšå®¢ï¼š 1ã€Elasticsearch ç³»åˆ—æ–‡ç« ï¼ˆä¸‰ï¼‰ï¼šElasticSearch é›†ç¾¤ç›‘æ§ 2ã€Elasticsearch ç³»åˆ—æ–‡ç« ï¼ˆå››ï¼‰ï¼šElasticSearch å•ä¸ªèŠ‚ç‚¹ç›‘æ§ å–ä¹‹ç½‘ç»œï¼Œè¿˜ä¹‹ç½‘ç»œï¼Œå¸Œæœ›ç»™åé¢åšç±»ä¼¼ä»»åŠ¡çš„å°ä¼™ä¼´ç»™ç‚¹å‚è€ƒæ„è§ï¼ å†å°±æ˜¯è‡ªå·±æ­å»º ELKï¼ˆElasticSearch, Logstash, Kibanaï¼‰æ—¥å¿—åˆ†æå¹³å°ï¼Œç„¶åç©äº†ä¸‹ï¼ æ­å»ºç¯å¢ƒåšå®¢ï¼šElasticsearch ç³»åˆ—æ–‡ç« ï¼ˆäº”ï¼‰ï¼šELK å®æ—¶æ—¥å¿—åˆ†æå¹³å°ç¯å¢ƒæ­å»º ç¬¬äº”æ¬¡æ¥è§¦æœç´¢åé¢å°±æ²¡æ€ä¹ˆæ¥è§¦ ElasticSearch äº†ï¼Œä¸€ç›´å¿™ç€å…¶ä»–çš„ä¸œè¥¿ã€‚ å®ä¹ è¾èŒåï¼Œæ¯•ä¸šå‡ºæ¥æ‰¾å·¥ä½œçš„é‚£æ®µæ—¥å­ï¼Œè‡ªå·±åˆèŠ±äº†ä¸€æ˜ŸæœŸç¨å¾®è¿‡äº†ä¸€é ã€ŠElasticsearch æƒå¨æŒ‡å—ã€‹ è¿™æœ¬ä¹¦ï¼Œè¯è¯´è¿˜å¸®æˆ‘é¢è¯•æŒºè¿‡ä¸å°‘å…³å‘¢ï¼Œå“ˆå“ˆå“ˆï¼å› ä¸ºæˆ‘é¡¹ç›®é‡Œå†™äº† Elasticsearch çš„ç›‘æ§ï¼Œå¦‚æœä½ å¯¹ Elasticsearch å…¶ä»–çš„ä¸ç†Ÿæ‚‰ï¼Œé¢è¯•å®˜ç¨å¾®é—®äº›å…¶ä»–å…³äºè¿™æ–¹é¢çš„ï¼Œé‚£å°±ä¸çŸ¥é“å°±æœ‰ç‚¹å°´å°¬ğŸ˜…äº†ï¼Œæ‰€ä»¥è¿˜æ˜¯å‡†å¤‡äº†ä¸‹ã€‚çœ‹å®Œä¹‹ååº”ä»˜é¢è¯•æ²¡å¤šå¤§çš„é—®é¢˜ã€‚ ç¬¬å…­æ¬¡æ¥è§¦çœ‹èµ·æ¥æˆ‘æ¥è§¦äº† Elasticsearch å¾ˆä¹…äº†ï¼Œå…¶å®çœŸæ­£é¡¹ç›®é‡Œé¢æ˜¯æ²¡æœ‰ç”¨åˆ° Elasticsearch åšè¿‡é¡¹ç›®çš„ï¼Œæ²¡æœ‰ç”¨åˆ° Elasticsearch çš„æœç´¢åšä»€ä¹ˆé¡¹ç›®ï¼Œäºæ˜¯è‡ªå·±å½“æ—¶æ‰¾å·¥ä½œå…¶å®ä¹Ÿæ‰“ç®—æ‰¾åˆ°å·¥ä½œåçœ‹èƒ½ä¸èƒ½è‡ªå·±åšä¸ªé¡¹ç›®æˆ–è€…å…¬å¸é¡¹ç›®é‡Œé¢ç”¨ç”¨ Elasticsearch å‘¢ï¼Ÿ ç»“æœåœ¨æ–°å…¬å¸æ–°é¡¹ç›®é‡Œï¼Œå¾ˆå¿«å°±ç”¨åˆ°äº†ã€‚åªä¸è¿‡è¿™æ¬¡ä¸æ˜¯ Java é¡¹ç›®é‡Œé¢ç”¨äº†ï¼Œè€Œæ˜¯å’Œ GoLang æ•´åˆã€‚ä¸è¿‡ API éƒ½å·®ä¸å¤šï¼Œå¤šç†Ÿæ‚‰å‡ æ¬¡å°±å¾ˆå¿«ä¸Šæ‰‹äº†ï¼Œå…³é”®è¿˜æ˜¯è¦æ‡‚ Elasticsearch å¦‚ä½•æ„é€  DSL æŸ¥è¯¢è¯­å¥ï¼Œè¿™æ ·å†è½¬æ¢æˆ GO é‡Œé¢çš„ API å°±å¿«äº†ã€‚ è¿˜æœ‰å°±æ˜¯å…¬å¸é‡Œåˆšå¥½æœ‰ä¸ªä¸­ç§‘é™¢ç ”ç©¶ç”Ÿå¤§ä½¬ï¼Œä»–å°±å†™è¿‡ Elasticsearch è¿™å—çš„ä¹¦ç±ã€Šä» lucene åˆ° Elasticsearch å…¨æ–‡æ£€ç´¢å®æˆ˜ã€‹ï¼Œå¦å¤–ä»–çš„ CSDN åšå®¢ä¹Ÿå¾ˆç«ï¼Œé˜…è¯»é‡å¾ˆé«˜ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥ä¹°æœ¬ä¹¦æ”¯æŒä¸‹ã€‚ ä¸­é€”è‡ªå·±é‡åˆ° Elasticsearch å®åœ¨ä¸ä¼šçš„é—®é¢˜ä¹Ÿä¼šä¸»åŠ¨å»æ‰¾å¤§ä½¬å’¨è¯¢ï¼Œç„¶åå¤§ä½¬è€å¿ƒæ•™æ•™æˆ‘è¿™ä¸ªæ¸£æ¸£èœé¸¡ï¼Œåœ¨æ–‡ç« è¿™é‡Œæ„Ÿè°¢ä¸‹å¤§ä½¬è¿™æ®µæ—¶é—´çš„å…³ç…§ã€‚ èŒç”Ÿé˜…è¯»æºç çš„æƒ³æ³•æ—¢ç„¶æ¥è§¦äº†è¿™ä¹ˆä¹…çš„ Elasticsearch ï¼Œé¡¹ç›®é‡Œç”¨è¿‡ï¼Œä¹¦ç±ä¹Ÿçœ‹è¿‡ï¼Œè™½ç„¶è¿˜ä¸æ˜¯å¾ˆç†Ÿï¼Œä½†æ˜¯å¦‚æœçœ‹çœ‹å®ƒçš„æºç æ˜¯ä¸æ˜¯ä¼šè®©æˆ‘å¯¹å®ƒçš„å°è±¡æ›´æ·±å‘¢ï¼Ÿ è¯´å¹²å°±å¹²ï¼Œæ™šä¸Šå›å®¶å°±ä» GitHub clone äº†æºç åœ¨æœ¬åœ°ï¼Œé‚£æ—¶åˆšå¥½å›å®¶ï¼Œå°±åœ¨ç«è½¦ä¸Šç›´æ¥ç”¨ VS code çœ‹äº†ä¼šæºç ï¼Œä¹Ÿæ²¡æœ‰åœ¨ ide é‡Œ debug èµ·æ¥ã€‚ å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™å·²ç»æŠŠ Elasticsearch çš„æ•´ä¸ªå¯åŠ¨æµç¨‹ï¼ˆåŠ è½½è¯»å–é…ç½®ã€åŠ è½½æ’ä»¶ç­‰ï¼‰ã€å¦‚ä½•æ”¯æŒ REST API çœ‹äº†ä¸‹ï¼Œåé¢ä¼šåœ¨ä¸‹ç­åå›å®¶ç»§ç»­é˜…è¯»æºç ï¼Œç»§ç»­åˆ†äº«æˆ‘çš„æºç è§£æçš„ã€‚ æœ‰æƒ³æ³•å°±å»å¹²ï¼Œä¸å°è¯•ä¸‹ï¼Œæ€ä¹ˆçŸ¥é“é€‚ä¸é€‚åˆä½ ï¼Ÿ æ€»ç»“å…¶å®é˜…è¯»æºç çš„ä¸»è¦åŸå› è¿˜æ˜¯è‡ªå·±æ„Ÿå…´è¶£ï¼›å¦å¤–å°±æ˜¯è¿™ä¸œè¥¿ç°åœ¨é¡¹ç›®é‡Œç¡®å®ä¹Ÿç”¨åˆ°äº†ï¼Œå¦‚æœæˆ‘å¯¹æºç ç†Ÿæ‚‰çš„è¯å¯èƒ½ä¼šå¯¹æˆ‘çš„ç†è§£ä¼šæ›´åŠ é€å½»ç‚¹ï¼›è¿˜æœ‰å°±æ˜¯ Elasticsearch ç¡®å®ç«ï¼Œå…¬å¸å‡ ä¹éƒ½ç”¨çš„ï¼Œæ‰€ä»¥å­¦ä¹ ä¸‹è¿˜æ˜¯æœ‰å¿…è¦çš„ã€‚","tags":[{"name":"ElasticSearch","slug":"ElasticSearch","permalink":"http://www.54tianzhisheng.cn/tags/ElasticSearch/"}]},{"title":"æ¸£æ¸£èœé¸¡çš„èš‚èšé‡‘æœé¢è¯•ç»å†(äºŒ)","date":"2018-07-30T16:00:00.000Z","path":"2018/07/31/alipay02/","text":"èš‚èšé‡‘æœç”µè¯äºŒé¢ï¼ˆ85 åˆ†é’Ÿï¼‰1ã€è‡ªæˆ‘ä»‹ç»ã€å·¥ä½œç»å†ã€æŠ€æœ¯æ ˆ 2ã€é¡¹ç›®ä¸­ä½ å­¦åˆ°äº†ä»€ä¹ˆæŠ€æœ¯ï¼Ÿï¼ˆæŠŠä¸‰é¡¹ç›®å…·ä½“æè¿°äº†å¾ˆä¹…ï¼‰ 3ã€å¾®æœåŠ¡åˆ’åˆ†çš„ç²’åº¦ 4ã€å¾®æœåŠ¡çš„é«˜å¯ç”¨æ€ä¹ˆä¿è¯çš„ï¼Ÿ 5ã€å¸¸ç”¨çš„è´Ÿè½½å‡è¡¡ï¼Œè¯¥æ€ä¹ˆç”¨ï¼Œä½ èƒ½è¯´ä¸‹å—ï¼Ÿ 6ã€ç½‘å…³èƒ½å¤Ÿä¸ºåç«¯æœåŠ¡å¸¦æ¥å“ªäº›å¥½å¤„ï¼Ÿ 7ã€Spring Bean çš„ç”Ÿå‘½å‘¨æœŸ 8ã€xml ä¸­é…ç½®çš„ initã€destroy æ–¹æ³•æ€ä¹ˆå¯ä»¥åšåˆ°è°ƒç”¨å…·ä½“çš„æ–¹æ³•ï¼Ÿ 9ã€åå°„çš„æœºåˆ¶ 10ã€Object ç±»ä¸­çš„æ–¹æ³• 11ã€hashcode å’Œ equals æ–¹æ³•å¸¸ç”¨åœ°æ–¹ 12ã€å¯¹è±¡æ¯”è¾ƒæ˜¯å¦ç›¸åŒ 13ã€hashmap put æ–¹æ³•å­˜æ”¾çš„æ—¶å€™æ€ä¹ˆåˆ¤æ–­æ˜¯å¦æ˜¯é‡å¤çš„ 14ã€Object toString æ–¹æ³•å¸¸ç”¨çš„åœ°æ–¹ï¼Œä¸ºä»€ä¹ˆè¦é‡å†™è¯¥æ–¹æ³• 15ã€Set å’Œ List åŒºåˆ«ï¼Ÿ 16ã€ArrayList å’Œ LinkedList åŒºåˆ« 17ã€å¦‚æœå­˜å–ç›¸åŒçš„æ•°æ®ï¼ŒArrayList å’Œ LinkedList è°å ç”¨ç©ºé—´æ›´å¤§ï¼Ÿ 18ã€Set å­˜çš„é¡ºåºæ˜¯æœ‰åºçš„å—ï¼Ÿ 19ã€å¸¸è§ Set çš„å®ç°æœ‰å“ªäº›ï¼Ÿ 20ã€TreeSet å¯¹å­˜å…¥å¯¹æ•°æ®æœ‰ä»€ä¹ˆè¦æ±‚å‘¢ï¼Ÿ 21ã€HashSet çš„åº•å±‚å®ç°å‘¢ 22ã€TreeSet åº•å±‚æºç æœ‰çœ‹è¿‡å—ï¼Ÿ 23ã€HashSet æ˜¯ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿä¸ºä»€ä¹ˆä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ 24ã€Java ä¸­æœ‰å“ªäº›çº¿ç¨‹å®‰å…¨çš„ Mapï¼Ÿ 25ã€Concurrenthashmap æ˜¯æ€ä¹ˆåšåˆ°çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ 26ã€HashTable ä½ äº†è§£è¿‡å—ï¼Ÿ 27ã€å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Ÿ 28ã€synchronizedã€lock 29ã€volatile çš„åŸå­æ€§é—®é¢˜ï¼Ÿä¸ºä»€ä¹ˆ i++ è¿™ç§ä¸æ”¯æŒåŸå­æ€§ï¼Ÿä»è®¡ç®—æœºåŸç†çš„è®¾è®¡æ¥è®²ä¸‹ä¸èƒ½ä¿è¯åŸå­æ€§çš„åŸå›  30ã€happens before åŸç† 31ã€cas æ“ä½œ 32ã€lock å’Œ synchronized çš„åŒºåˆ«ï¼Ÿ 33ã€å…¬å¹³é”å’Œéå…¬å¹³é” 34ã€Java è¯»å†™é” 35ã€è¯»å†™é”è®¾è®¡ä¸»è¦è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ 36ã€ä½ é¡¹ç›®é™¤äº†å†™ Java ä»£ç ï¼Œè¿˜æœ‰å‰ç«¯ä»£ç ï¼Œé‚£ä½ çŸ¥é“å‰ç«¯æœ‰å“ªäº›æ¡†æ¶å—ï¼Ÿ 37ã€MySQL åˆ†é¡µæŸ¥è¯¢è¯­å¥ 38ã€MySQL äº‹åŠ¡ç‰¹æ€§å’Œéš”ç¦»çº§åˆ« 39ã€ä¸å¯é‡å¤è¯»ä¼šå‡ºç°åœ¨ä»€ä¹ˆåœºæ™¯ï¼Ÿ 40ã€sql having çš„ä½¿ç”¨åœºæ™¯ 41ã€å‰ç«¯æµè§ˆå™¨åœ°å€çš„ä¸€ä¸ª http è¯·æ±‚åˆ°åç«¯æ•´ä¸ªæµç¨‹æ˜¯æ€ä¹ˆæ ·ï¼Ÿèƒ½å¤Ÿè¯´ä¸‹å—ï¼Ÿ 42ã€http é»˜è®¤ç«¯å£ï¼Œhttps é»˜è®¤ç«¯å£ 43ã€DNS ä½ çŸ¥é“æ˜¯å¹²å˜›çš„å—ï¼Ÿ 44ã€ä½ ä»¬å¼€å‘ç”¨çš„ ide æ˜¯å•¥ï¼Ÿä½ èƒ½è¯´ä¸‹ idea çš„å¸¸ç”¨å‡ ä¸ªå¿«æ·é”®å§ï¼Ÿ 45ã€ä»£ç ç‰ˆæœ¬ç®¡ç†ä½ ä»¬ç”¨çš„æ˜¯å•¥ï¼Ÿ 46ã€git rebase å’Œ merge æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ 47ã€ä½ ä»¬å…¬å¸åŠ ç­å¤šå—ï¼Ÿ 48ã€åé¢ä¸€èµ·èŠ high äº†ï¼Œä¹‹é—´æ‰¯äº†äº›è›‹ï¼Œå“ˆå“ˆå“ˆ ç›¸å…³æ–‡ç« ï¼š1ã€ç§‹æ‹›ç¬¬ä¸€ç«™ â€”â€” äºšä¿¡ç§‘æŠ€ 2ã€ç§‹æ‹›ç¬¬äºŒç«™ â€”â€” å†…æ¨çˆ±å¥‡è‰º 3ã€ç§‹æ‹›ç¬¬ä¸‰ç«™ â€”â€” å†…æ¨é˜¿é‡Œï¼ˆä¸€é¢ï¼‰ 4ã€é‚£äº›å¹´æˆ‘çœ‹è¿‡çš„ä¹¦ â€”â€” è‡´æ•¬æˆ‘çš„å¤§å­¦ç”Ÿæ´» â€”â€” Say Good Bye ï¼ 5ã€é¢è¯•è¿‡é˜¿é‡Œç­‰äº’è”ç½‘å¤§å…¬å¸ï¼Œæˆ‘çŸ¥é“äº†è¿™äº›å¥—è·¯ 6ã€æ¸£æ¸£èœé¸¡çš„æœ‰èµé¢è¯•ç»å†ï¼ˆä¸€ï¼‰ 7ã€æ¸£æ¸£èœé¸¡çš„èš‚èšé‡‘æœé¢è¯•ç»å†ï¼ˆä¸€ï¼‰ æœ€åæœ¬åœ°åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2018/07/31/alipay02 ï¼Œè½¬è½½è¯·æˆæƒï¼Œå¦åˆ™ç¦æ­¢è½¬è½½ï¼ æœ¬æ–‡é¦–å‘åœ¨æˆ‘çš„çŸ¥è¯†æ˜Ÿçƒï¼Œæœ€è¿‘è‡ªå·±ä¸€ç›´åœ¨å†™å‰æ®µæ—¶é—´çš„æ‰€æœ‰é¢è¯•æƒ…å†µï¼Œå·²ç»åˆ†äº«åœ¨æˆ‘çš„çŸ¥è¯†æ˜Ÿçƒï¼Œå¦‚æœæ„Ÿå…´è¶£ï¼Œå¯ä»¥åŠ å…¥æˆ‘çš„çŸ¥è¯†æ˜Ÿçƒï¼","tags":[{"name":"é¢ç»","slug":"é¢ç»","permalink":"http://www.54tianzhisheng.cn/tags/é¢ç»/"}]},{"title":"æ¸£æ¸£èœé¸¡çš„èš‚èšé‡‘æœé¢è¯•ç»å†(ä¸€)","date":"2018-07-29T16:00:00.000Z","path":"2018/07/30/alipay01/","text":"èš‚èšé‡‘æœç”µè¯ä¸€é¢1ã€è‡ªæˆ‘ä»‹ç»ã€è‡ªå·±åšçš„é¡¹ç›®å’ŒæŠ€æœ¯é¢†åŸŸ 2ã€é¡¹ç›®ä¸­çš„ç›‘æ§ï¼šé‚£ä¸ªç›‘æ§æŒ‡æ ‡å¸¸è§çš„å“ªäº›ï¼Ÿ 3ã€å¾®æœåŠ¡æ¶‰åŠåˆ°çš„æŠ€æœ¯ä»¥åŠéœ€è¦æ³¨æ„çš„é—®é¢˜æœ‰å“ªäº›ï¼Ÿ 4ã€æ³¨å†Œä¸­å¿ƒä½ äº†è§£äº†å“ªäº›ï¼Ÿ 5ã€consul çš„å¯é æ€§ä½ äº†è§£å—ï¼Ÿ 6ã€consul çš„æœºåˆ¶ä½ æœ‰æ²¡æœ‰å…·ä½“æ·±å…¥è¿‡ï¼Ÿæœ‰æ²¡æœ‰å’Œå…¶ä»–çš„æ³¨å†Œä¸­å¿ƒå¯¹æ¯”è¿‡ï¼Ÿ 7ã€é¡¹ç›®ç”¨ Spring æ¯”è¾ƒå¤šï¼Œæœ‰æ²¡æœ‰äº†è§£ Spring çš„åŸç†ï¼ŸAOP å’Œ IOC çš„åŸç† 8ã€Spring Booté™¤äº†è‡ªåŠ¨é…ç½®ï¼Œç›¸æ¯”ä¼ ç»Ÿçš„ Spring æœ‰ä»€ä¹ˆå…¶ä»–çš„åŒºåˆ«ï¼Ÿ 9ã€Spring Cloud æœ‰äº†è§£å¤šå°‘ï¼Ÿ 10ã€Spring Bean çš„ç”Ÿå‘½å‘¨æœŸ 11ã€HashMap å’Œ hashTable åŒºåˆ«ï¼Ÿ 12ã€Object çš„ hashcode æ–¹æ³•é‡å†™äº†ï¼Œequals æ–¹æ³•è¦ä¸è¦æ”¹ï¼Ÿ 13ã€Hashmap çº¿ç¨‹ä¸å®‰å…¨çš„å‡ºç°åœºæ™¯ 14ã€çº¿ä¸ŠæœåŠ¡ CPU å¾ˆé«˜è¯¥æ€ä¹ˆåšï¼Ÿæœ‰å“ªäº›æªæ–½å¯ä»¥æ‰¾åˆ°é—®é¢˜ 15ã€JDK ä¸­æœ‰å“ªå‡ ä¸ªçº¿ç¨‹æ± ï¼Ÿé¡ºå¸¦æŠŠçº¿ç¨‹æ± è®²äº†ä¸ªé 16ã€SQL ä¼˜åŒ–çš„å¸¸è§æ–¹æ³•æœ‰å“ªäº› 17ã€SQL ç´¢å¼•çš„é¡ºåºï¼Œå­—æ®µçš„é¡ºåº 18ã€æŸ¥çœ‹ SQL æ˜¯ä¸æ˜¯ä½¿ç”¨äº†ç´¢å¼•ï¼Ÿï¼ˆæœ‰ä»€ä¹ˆå·¥å…·ï¼‰ 19ã€TCP å’Œ UDP çš„åŒºåˆ«ï¼ŸTCP æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­æ€ä¹ˆåšåˆ°å¯é çš„ï¼Ÿ 20ã€è¯´ä¸‹ä½ çŸ¥é“çš„æ’åºç®—æ³•å§ 21ã€æŸ¥æ‰¾ä¸€ä¸ªæ•°ç»„çš„ä¸­ä½æ•°ï¼Ÿ 22ã€ä½ æœ‰ä»€ä¹ˆé—®é¢˜æƒ³é—®æˆ‘çš„å—ï¼Ÿ ç›¸å…³æ–‡ç« ï¼š1ã€ç§‹æ‹›ç¬¬ä¸€ç«™ â€”â€” äºšä¿¡ç§‘æŠ€ 2ã€ç§‹æ‹›ç¬¬äºŒç«™ â€”â€” å†…æ¨çˆ±å¥‡è‰º 3ã€ç§‹æ‹›ç¬¬ä¸‰ç«™ â€”â€” å†…æ¨é˜¿é‡Œï¼ˆä¸€é¢ï¼‰ 4ã€é‚£äº›å¹´æˆ‘çœ‹è¿‡çš„ä¹¦ â€”â€” è‡´æ•¬æˆ‘çš„å¤§å­¦ç”Ÿæ´» â€”â€” Say Good Bye ï¼ 5ã€é¢è¯•è¿‡é˜¿é‡Œç­‰äº’è”ç½‘å¤§å…¬å¸ï¼Œæˆ‘çŸ¥é“äº†è¿™äº›å¥—è·¯ 6ã€æ¸£æ¸£èœé¸¡çš„æœ‰èµé¢è¯•ç»å†ï¼ˆä¸€ï¼‰ æœ€åæœ¬åœ°åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2018/07/30/alipay01 ï¼Œè½¬è½½è¯·æˆæƒï¼Œå¦åˆ™ç¦æ­¢è½¬è½½ï¼ æœ¬æ–‡é¦–å‘åœ¨æˆ‘çš„çŸ¥è¯†æ˜Ÿçƒï¼Œæœ€è¿‘è‡ªå·±ä¸€ç›´åœ¨å†™å‰æ®µæ—¶é—´çš„æ‰€æœ‰é¢è¯•æƒ…å†µï¼Œå·²ç»åˆ†äº«åœ¨æˆ‘çš„çŸ¥è¯†æ˜Ÿçƒï¼Œå¦‚æœæ„Ÿå…´è¶£ï¼Œå¯ä»¥åŠ å…¥æˆ‘çš„çŸ¥è¯†æ˜Ÿçƒï¼","tags":[{"name":"é¢ç»","slug":"é¢ç»","permalink":"http://www.54tianzhisheng.cn/tags/é¢ç»/"}]},{"title":"æ¸£æ¸£èœé¸¡çš„æœ‰èµé¢è¯•ç»å†ï¼ˆä¸€ï¼‰","date":"2018-07-11T16:00:00.000Z","path":"2018/07/12/youzan/","text":"å‡ºå»é¢è¯•çš„è¯è¿˜æ˜¯å¾—å¥½å¥½å‡†å¤‡ï¼Œä¸ç„¶ä¼šè¢«è™çš„æœ‰ç‚¹æƒ¨ï¼ æœ‰èµï¼ˆæ¡†æ¶ç»„ï¼‰å››æœˆä»½é¢è¯•æœ‰èµçš„æ—¶å€™ï¼Œè‡ªå·±è¿˜åœ¨å®ä¹ ï¼Œæ‰€ä»¥ä¹Ÿæ²¡æœ‰å¤ä¹ ï¼Œæ˜¯åœ¨ Boss ç›´è˜ä¸ŠæŠ•çš„ï¼Œå½“æ—¶çœ‹åˆ°äº†æœ‰èµçš„ 2018 å±Šæ˜¥æ‹›ï¼Œå°±æŠ•äº†ä¸‹ï¼Œç„¶åä¸çŸ¥é“æ€ä¹ˆå°±è¢«æ¨åˆ°äº†æ¡†æ¶ç»„ï¼Œç»“æœåé¢å°±æ„Ÿè§‰è‡ªå·±è¢«è™çš„å¯æƒ¨äº†ã€‚ å…³æ³¨æˆ‘ è½¬è½½è¯·åŠ¡å¿…æ³¨æ˜åŸåˆ›åœ°å€ä¸ºï¼šhttp://www.54tianzhisheng.cn/2018/07/12/youzan/ ç”µè¯ä¸€é¢å¥½åƒæ˜¯æ¸…æ˜èŠ‚è¿˜æ˜¯äº”ä¸€åŠ³åŠ¨èŠ‚æ¥ç€ï¼Œæˆ‘è¿˜åœ¨ç¡è§‰ï¼Œå°±æ¥åˆ°ä¸€é¢é¢è¯•å®˜çš„ç”µè¯ï¼Œè¯´ç°åœ¨æœ‰æ—¶é—´å—ï¼Œèƒ½å¤Ÿæ¥å—ä¸‹ç”µè¯é¢è¯•å—ï¼Ÿæˆ‘å‹’ä¸ªå»ï¼Œä»Šå¤©è¿‡èŠ‚ã€æˆ‘è¢«ç”µè¯åµé†’çš„ï¼Œç°åœ¨äººéƒ½æ²¡æ¸…é†’ã€è¿™é¢è¯•é‚£è‚¯å®šå¾—ä¸€é¢å°±æŒ‚äº†ï¼Œæ‰€ä»¥å°±è€å®å¾—è¯´ç°åœ¨è¿˜æ˜¯ä¸æ–¹ä¾¿å‘¢ï¼Œçº¦äº†å‘¨ä¸€ä¸Šåˆ 10 ç‚¹é¢è¯•ã€‚ å‘¨ä¸€ 10 ç‚¹é¢è¯•å®˜å‡†æ—¶æ‰“ç”µè¯è¿‡æ¥äº†ï¼ ä»¥ä¸‹æ˜¯é¢è¯•çš„é—®é¢˜ï¼š 1ã€è‡ªæˆ‘ä»‹ç» 2ã€Map çš„åº•å±‚ç»“æ„ï¼Ÿï¼ˆHashMapï¼‰ 3ã€çº¿ç¨‹å®‰å…¨çš„ Map ï¼ˆconcurrentHashMapï¼‰ç®€å•çš„è¯´äº†ä¸‹è¿™ä¸¤ 1ã€‚7 å’Œ 1.8 çš„åŒºåˆ«ï¼Œæœ¬æƒ³é—®ä¸‹è¦ä¸è¦æ·±å…¥çš„è®²ä¸‹ï¼ˆæºç çº§åˆ«ï¼‰ï¼Œç»“æœé¢è¯•å®˜è¯´ä¸ç”¨äº†ã€‚ 4ã€é¡¹ç›® MySQL çš„æ•°æ®é‡å’Œå¹¶å‘é‡æœ‰å¤šå¤§ï¼Ÿ 5ã€ä½ å¯¹æ•°æ®åº“äº†è§£å¤šå°‘ï¼Ÿ 6ã€ä½ è¯´ä¸‹æ•°æ®åº“çš„ç´¢å¼•å®ç°å’Œéä¸»é”®çš„äºŒçº§ç´¢å¼• 7ã€é¡¹ç›®ç”¨çš„æ˜¯ SpringBoot ï¼Œä½ èƒ½è¯´ä¸‹ Spring Boot ä¸ Spring çš„åŒºåˆ«å—ï¼Ÿ 8ã€SpringBoot çš„è‡ªåŠ¨é…ç½®æ˜¯æ€ä¹ˆåšçš„ï¼Ÿ 9ã€MyBatis å®šä¹‰çš„æ¥å£ï¼Œæ€ä¹ˆæ‰¾åˆ°å®ç°çš„ï¼Ÿ 10ã€Java å†…å­˜ç»“æ„ 11ã€å¯¹è±¡æ˜¯å¦å¯ GCï¼Ÿ 12ã€Minor GC å’Œ Full GC 13ã€åƒåœ¾å›æ”¶ç®—æ³• 14ã€åƒåœ¾å›æ”¶å™¨ G1 15ã€é¡¹ç›®é‡Œç”¨è¿‡ ElasticSearch å’Œ Hbaseï¼Œæœ‰æ·±å…¥äº†è§£ä»–ä»¬çš„è°ƒä¼˜æŠ€å·§å—ï¼Ÿ 16ã€Spring RestTemplate çš„å…·ä½“å®ç° 17ã€æè¿°ä¸‹ç½‘é¡µä¸€ä¸ª Http è¯·æ±‚ï¼Œåˆ°åç«¯çš„æ•´ä¸ªè¯·æ±‚è¿‡ç¨‹ 18ã€å¤šçº¿ç¨‹çš„å¸¸ç”¨æ–¹æ³•å’Œæ¥å£ç±»åŠçº¿ç¨‹æ± çš„æœºåˆ¶ 19ã€æ€»ç»“æˆ‘çš„ Java åŸºç¡€è¿˜æ˜¯ä¸é”™ï¼Œä½†æ˜¯ä¸€äº›ä¸»æµçš„æ¡†æ¶æºç è¿˜æ˜¯å¤„åœ¨ä½¿ç”¨çš„çŠ¶æ€ï¼Œéœ€è¦ç»§ç»­å»çœ‹æºç  20ã€æ­»é” 21ã€è‡ªå·±ç ”ç©¶æ¯”è¾ƒæ–°çš„æŠ€æœ¯ï¼Œè¯´ä¸‹æˆæœï¼ 22ã€ä½ æœ‰ä»€ä¹ˆæƒ³é—®çš„ï¼Ÿæˆ‘å°±é—®äº†ä¸‹å…¬å¸é‚£è¾¹çš„æƒ…å†µï¼Œè¿™ä¸ªè‡ªç”±å‘æŒ¥ï¼ æœ€åæˆ‘çŸ¥é“æœ‰äºŒé¢çš„é¢è¯•æœºä¼šäº†ã€‚ 10 æ¥åˆ†é’Ÿä¸åˆ°ï¼Œå°±å†æ¬¡æ‰“ç”µè¯è¿‡æ¥çº¦äº†æ˜æ—©ä¸Šåˆ 10 ç‚¹çš„è§†é¢‘é¢è¯•ã€‚ è§†é¢‘äºŒé¢äºŒé¢é¢è¯•å®˜å…ˆæ‰“ç”µè¯è¿‡æ¥ï¼Œç„¶ååŠ äº†ä¸ªå¾®ä¿¡ï¼Œå¼€å§‹å¾®ä¿¡è§†é¢‘é¢è¯• è¿™ä¸ªé¢è¯•æˆ‘ä¹Ÿä¸å¤ªè®°å¾—å…·ä½“é¢è¯•é¢˜ç›®äº†ï¼Œä¸‹é¢å†™çš„æ˜¯å¤§æ¦‚æ–¹å‘çš„ï¼š 1ã€HashMapï¼Œæºç çº§åˆ«çš„é—®äº†ï¼ŒåŒ…æ‹¬ä¸ºä»€ä¹ˆçº¿ç¨‹ä¸å®‰å…¨ 2ã€æ­»é” 3ã€Synchronized å’Œ ReentrantLock é”æœºåˆ¶ï¼Œæ€ä¹ˆåˆ¤æ–­é‡å…¥é”çš„ï¼Œä¼šä¸ä¼šæ˜¯æ­»é”ï¼Ÿ 4ã€è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«ï¼Ÿ 5ã€è¿›ç¨‹ä¹‹é—´å¦‚ä½•ä¿è¯åŒæ­¥ï¼Ÿ 6ã€åˆ†å¸ƒå¼é” 7ã€å¯¹è±¡ GC 8ã€åƒåœ¾å›æ”¶ç®—æ³• 9ã€JVM å‚æ•° 10ã€OOM å‡ºç°çš„æœ‰å“ªäº›åœºæ™¯ï¼Ÿä¸ºä»€ä¹ˆä¼šå‘ç”Ÿï¼Ÿ 11ã€JVM å†…å­˜ç»“æ„è¯´ä¸‹å§ 12ã€å †å’Œæ ˆçš„å…±äº«é—®é¢˜ï¼Ÿ 13ã€æœ‰æ¯”è¾ƒè¿‡ Http å’Œ RPC å—ï¼Ÿ 14ã€HttpClient ä½ è¯´è¯´é‡Œé¢çš„å…·ä½“å®ç°å§ï¼Ÿï¼ˆæ¶‰åŠäº†å“ªäº›ä¸œè¥¿ï¼‰ 15ã€é‚£è¦ä½ è®¾è®¡ä¸€ä¸ªé«˜æ€§èƒ½çš„ Http ï¼Œä½ ä¼šæ€ä¹ˆè®¾è®¡ï¼Ÿ äºŒé¢å¾®ä¿¡è§†é¢‘é¢è¯•åªè®°å¾—è¿™ä¹ˆå¤šäº†ã€‚ æœ¬æ–‡é¦–å‘åœ¨æˆ‘çš„çŸ¥è¯†æ˜Ÿçƒï¼Œæœ€è¿‘è‡ªå·±ä¸€ç›´åœ¨å†™å‰æ®µæ—¶é—´çš„æ‰€æœ‰é¢è¯•æƒ…å†µï¼Œåé¢ä¼šä¸€ç¯‡ä¸€ç¯‡åˆ†äº«åœ¨æˆ‘çš„çŸ¥è¯†æ˜Ÿçƒçš„ï¼Œå¦‚æœæ„Ÿå…´è¶£ï¼Œå¯ä»¥åŠ å…¥æˆ‘çš„çŸ¥è¯†æ˜Ÿçƒï¼ çŸ¥è¯†æ˜Ÿçƒæ›´å¤šé¢ç»æ–‡ç« ï¼š 1ã€èš‚èšé‡‘æœç”µè¯ä¸€é¢ 2ã€èš‚èšé‡‘æœç”µè¯äºŒé¢â€”â€”åé¢èŠçš„æœ‰ç‚¹high 3ã€club factory é¢ç»åˆ†äº« 4ã€ä½œä¸ºé¢è¯•å®˜å¾—åˆ°çš„ç»éªŒ 5ã€å²ä¸Šæœ€å¼ºæœ€å…¨é¢ç»åˆé›† 6ã€å…¬å¸éœ€è¦ä»€ä¹ˆæ ·çš„äºº 7ã€å¦‚ä½•ä»‹ç»é¡¹ç›®","tags":[{"name":"é¢ç»","slug":"é¢ç»","permalink":"http://www.54tianzhisheng.cn/tags/é¢ç»/"}]},{"title":"20 ä¸ªæ¡ˆä¾‹æ•™ä½ åœ¨ Java 8 ä¸­å¦‚ä½•å¤„ç†æ—¥æœŸå’Œæ—¶é—´?","date":"2018-06-19T16:00:00.000Z","path":"2018/06/20/java-8-date/","text":"å‰è¨€å‰é¢ä¸€ç¯‡æ–‡ç« å†™äº†ã€ŠSimpleDateFormat å¦‚ä½•å®‰å…¨çš„ä½¿ç”¨ï¼Ÿã€‹, é‡Œé¢ä»‹ç»äº† SimpleDateFormat å¦‚ä½•å¤„ç†æ—¥æœŸï¼æ—¶é—´ï¼Œä»¥åŠå¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼ŒåŠå…¶ä»‹ç»äº†åœ¨ Java 8 ä¸­çš„å¤„ç†æ—¶é—´ï¼æ—¥æœŸé»˜è®¤å°±çº¿ç¨‹å®‰å…¨çš„ DateTimeFormatter ç±»ã€‚é‚£ä¹ˆ Java 8 ä¸­è¯¥æ€ä¹ˆæ ·å¤„ç†ç”Ÿæ´»ä¸­å¸¸è§çš„ä¸€äº›æ—¥æœŸï¼æ—¶é—´å‘¢ï¼Ÿæ¯”å¦‚ï¼šè®¡ç®—ä¸€å‘¨åçš„æ—¥æœŸï¼›è®¡ç®—ä¸€å¹´å‰æˆ–ä¸€å¹´åçš„æ—¥æœŸï¼›æ£€æŸ¥é—°å¹´ç­‰ã€‚ æ¥ä¸‹æ¥åˆ›å»ºäº† 20 ä¸ªåŸºäºä»»åŠ¡çš„å®ä¾‹æ¥å­¦ä¹  Java 8 çš„æ–°ç‰¹æ€§ã€‚ä»æœ€ç®€å•åˆ›å»ºå½“å¤©çš„æ—¥æœŸå¼€å§‹ï¼Œç„¶ååˆ›å»ºæ—¶é—´åŠæ—¶åŒºï¼Œæ¥ç€æ¨¡æ‹Ÿä¸€ä¸ªæ—¥æœŸæé†’åº”ç”¨ä¸­çš„ä»»åŠ¡â€”â€”è®¡ç®—é‡è¦æ—¥æœŸçš„åˆ°æœŸå¤©æ•°ï¼Œä¾‹å¦‚ç”Ÿæ—¥ã€çºªå¿µæ—¥ã€è´¦å•æ—¥ã€ä¿è´¹åˆ°æœŸæ—¥ã€ä¿¡ç”¨å¡è¿‡æœŸæ—¥ç­‰ã€‚ å…³æ³¨æˆ‘ è½¬è½½è¯·åŠ¡å¿…æ³¨æ˜åŸåˆ›åœ°å€ä¸ºï¼šhttp://www.54tianzhisheng.cn/2018/06/20/java-8-date/ ç¤ºä¾‹ 1ã€åœ¨ Java 8 ä¸­è·å–ä»Šå¤©çš„æ—¥æœŸJava 8 ä¸­çš„ LocalDate ç”¨äºè¡¨ç¤ºå½“å¤©æ—¥æœŸã€‚å’Œ java.util.Date ä¸åŒï¼Œå®ƒåªæœ‰æ—¥æœŸï¼Œä¸åŒ…å«æ—¶é—´ã€‚å½“ä½ ä»…éœ€è¦è¡¨ç¤ºæ—¥æœŸæ—¶å°±ç”¨è¿™ä¸ªç±»ã€‚ 12LocalDate now = LocalDate.now();System.out.println(now); ç»“æœæ˜¯ï¼š 12018-06-20 ä¸Šé¢çš„ä»£ç åˆ›å»ºäº†å½“å¤©çš„æ—¥æœŸï¼Œä¸å«æ—¶é—´ä¿¡æ¯ã€‚æ‰“å°å‡ºçš„æ—¥æœŸæ ¼å¼éå¸¸å‹å¥½ï¼Œä¸åƒè€çš„ Date ç±»æ‰“å°å‡ºä¸€å †æ²¡æœ‰æ ¼å¼åŒ–çš„ä¿¡æ¯ã€‚ ç¤ºä¾‹ 2ã€åœ¨ Java 8 ä¸­è·å–å¹´ã€æœˆã€æ—¥ä¿¡æ¯LocalDate ç±»æä¾›äº†è·å–å¹´ã€æœˆã€æ—¥çš„å¿«æ·æ–¹æ³•ï¼Œå…¶å®ä¾‹è¿˜åŒ…å«å¾ˆå¤šå…¶å®ƒçš„æ—¥æœŸå±æ€§ã€‚é€šè¿‡è°ƒç”¨è¿™äº›æ–¹æ³•å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„å¾—åˆ°éœ€è¦çš„æ—¥æœŸä¿¡æ¯ï¼Œä¸ç”¨åƒä»¥å‰ä¸€æ ·éœ€è¦ä¾èµ– java.util.Calendar ç±»äº† 12345LocalDate now = LocalDate.now();int year = now.getYear();int monthValue = now.getMonthValue();int dayOfMonth = now.getDayOfMonth();System.out.printf(\"year = %d, month = %d, day = %d\", year, monthValue, dayOfMonth); ç»“æœæ˜¯ï¼š 1year = 2018, month = 6, day = 20 ç¤ºä¾‹ 3ã€åœ¨ Java 8 ä¸­å¤„ç†ç‰¹å®šæ—¥æœŸåœ¨ç¬¬ä¸€ä¸ªä¾‹å­é‡Œï¼Œæˆ‘ä»¬é€šè¿‡é™æ€å·¥å‚æ–¹æ³• now() éå¸¸å®¹æ˜“åœ°åˆ›å»ºäº†å½“å¤©æ—¥æœŸï¼Œä½ è¿˜å¯ä»¥è°ƒç”¨å¦ä¸€ä¸ªæœ‰ç”¨çš„å·¥å‚æ–¹æ³•LocalDate.of() åˆ›å»ºä»»æ„æ—¥æœŸï¼Œ è¯¥æ–¹æ³•éœ€è¦ä¼ å…¥å¹´ã€æœˆã€æ—¥åšå‚æ•°ï¼Œè¿”å›å¯¹åº”çš„ LocalDate å®ä¾‹ã€‚è¿™ä¸ªæ–¹æ³•çš„å¥½å¤„æ˜¯æ²¡å†çŠ¯è€ API çš„è®¾è®¡é”™è¯¯ï¼Œæ¯”å¦‚å¹´åº¦èµ·å§‹äº 1900ï¼Œæœˆä»½æ˜¯ä» 0 å¼€å§‹ç­‰ç­‰ã€‚æ—¥æœŸæ‰€è§å³æ‰€å¾—ï¼Œå°±åƒä¸‹é¢è¿™ä¸ªä¾‹å­è¡¨ç¤ºäº† 6 æœˆ 20 æ—¥ï¼Œæ²¡æœ‰ä»»ä½•éšè—æœºå…³ã€‚ 12LocalDate date = LocalDate.of(2018, 06, 20);System.out.println(date); å¯ä»¥çœ‹åˆ°åˆ›å»ºçš„æ—¥æœŸå®Œå…¨ç¬¦åˆé¢„æœŸï¼Œä¸å†™å…¥çš„ 2018 å¹´ 6 æœˆ 20 æ—¥å®Œå…¨ä¸€è‡´ã€‚ ç¤ºä¾‹ 4ã€åœ¨ Java 8 ä¸­åˆ¤æ–­ä¸¤ä¸ªæ—¥æœŸæ˜¯å¦ç›¸ç­‰ç°å®ç”Ÿæ´»ä¸­æœ‰ä¸€ç±»æ—¶é—´å¤„ç†å°±æ˜¯åˆ¤æ–­ä¸¤ä¸ªæ—¥æœŸæ˜¯å¦ç›¸ç­‰ã€‚ä½ å¸¸å¸¸ä¼šæ£€æŸ¥ä»Šå¤©æ˜¯ä¸æ˜¯ä¸ªç‰¹æ®Šçš„æ—¥å­ï¼Œæ¯”å¦‚ç”Ÿæ—¥ã€çºªå¿µæ—¥æˆ–éäº¤æ˜“æ—¥ã€‚è¿™æ—¶å°±éœ€è¦æŠŠæŒ‡å®šçš„æ—¥æœŸä¸æŸä¸ªç‰¹å®šæ—¥æœŸåšæ¯”è¾ƒï¼Œä¾‹å¦‚åˆ¤æ–­è¿™ä¸€å¤©æ˜¯å¦æ˜¯å‡æœŸã€‚ä¸‹é¢è¿™ä¸ªä¾‹å­ä¼šå¸®åŠ©ä½ ç”¨ Java 8 çš„æ–¹å¼å»è§£å†³ï¼Œä½ è‚¯å®šå·²ç»æƒ³åˆ°äº†ï¼ŒLocalDate é‡è½½äº† equal æ–¹æ³•ï¼Œè¯·çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š 12345LocalDate now = LocalDate.now();LocalDate date = LocalDate.of(2018, 06, 20);if (date.equals(now)) &#123; System.out.println(\"åŒä¸€å¤©\");&#125; è¿™ä¸ªä¾‹å­ä¸­æˆ‘ä»¬æ¯”è¾ƒçš„ä¸¤ä¸ªæ—¥æœŸç›¸åŒã€‚æ³¨æ„ï¼Œå¦‚æœæ¯”è¾ƒçš„æ—¥æœŸæ˜¯å­—ç¬¦å‹çš„ï¼Œéœ€è¦å…ˆè§£ææˆæ—¥æœŸå¯¹è±¡å†ä½œåˆ¤æ–­ã€‚ ç¤ºä¾‹ 5ã€åœ¨ Java 8 ä¸­æ£€æŸ¥åƒç”Ÿæ—¥è¿™ç§å‘¨æœŸæ€§äº‹ä»¶Java ä¸­å¦ä¸€ä¸ªæ—¥æœŸæ—¶é—´çš„å¤„ç†å°±æ˜¯æ£€æŸ¥ç±»ä¼¼æ¯æœˆè´¦å•ã€ç»“å©šçºªå¿µæ—¥ã€EMIæ—¥æˆ–ä¿é™©ç¼´è´¹æ—¥è¿™äº›å‘¨æœŸæ€§äº‹ä»¶ã€‚å¦‚æœä½ åœ¨ç”µå­å•†åŠ¡ç½‘ç«™å·¥ä½œï¼Œé‚£ä¹ˆä¸€å®šä¼šæœ‰ä¸€ä¸ªæ¨¡å—ç”¨æ¥åœ¨åœ£è¯èŠ‚ã€æ„Ÿæ©èŠ‚è¿™ç§èŠ‚æ—¥æ—¶å‘å®¢æˆ·å‘é€é—®å€™é‚®ä»¶ã€‚Java ä¸­å¦‚ä½•æ£€æŸ¥è¿™äº›èŠ‚æ—¥æˆ–å…¶å®ƒå‘¨æœŸæ€§äº‹ä»¶å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯ MonthDay ç±»ã€‚è¿™ä¸ªç±»ç»„åˆäº†æœˆä»½å’Œæ—¥ï¼Œå»æ‰äº†å¹´ï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥ç”¨å®ƒåˆ¤æ–­æ¯å¹´éƒ½ä¼šå‘ç”Ÿäº‹ä»¶ã€‚å’Œè¿™ä¸ªç±»ç›¸ä¼¼çš„è¿˜æœ‰ä¸€ä¸ª YearMonth ç±»ã€‚è¿™äº›ç±»ä¹Ÿéƒ½æ˜¯ä¸å¯å˜å¹¶ä¸”çº¿ç¨‹å®‰å…¨çš„å€¼ç±»å‹ã€‚ä¸‹é¢æˆ‘ä»¬é€šè¿‡ MonthDay æ¥æ£€æŸ¥å‘¨æœŸæ€§äº‹ä»¶ï¼š 123456789LocalDate now = LocalDate.now();LocalDate dateOfBirth = LocalDate.of(2018, 06, 20);MonthDay birthday = MonthDay.of(dateOfBirth.getMonth(), dateOfBirth.getDayOfMonth());MonthDay currentMonthDay = MonthDay.from(now);if (currentMonthDay.equals(birthday)) &#123; System.out.println(\"Happy Birthday\");&#125; else &#123; System.out.println(\"Sorry, today is not your birthday\");&#125; ç»“æœï¼šï¼ˆæ³¨æ„ï¼šè·å–å½“å‰æ—¶é—´å¯èƒ½ä¸ä½ çœ‹çš„æ—¶å€™ä¸å¯¹ï¼Œæ‰€ä»¥è¿™ä¸ªç»“æœå¯èƒ½å’Œä½ çœ‹çš„æ—¶å€™è¿è¡Œç»“æœä¸ä¸€æ ·ï¼‰ 1Happy Birthday åªè¦å½“å¤©çš„æ—¥æœŸå’Œç”Ÿæ—¥åŒ¹é…ï¼Œæ— è®ºæ˜¯å“ªä¸€å¹´éƒ½ä¼šæ‰“å°å‡ºç¥è´ºä¿¡æ¯ã€‚ä½ å¯ä»¥æŠŠç¨‹åºæ•´åˆè¿›ç³»ç»Ÿæ—¶é’Ÿï¼Œçœ‹çœ‹ç”Ÿæ—¥æ—¶æ˜¯å¦ä¼šå—åˆ°æé†’ï¼Œæˆ–è€…å†™ä¸€ä¸ªå•å…ƒæµ‹è¯•æ¥æ£€æµ‹ä»£ç æ˜¯å¦è¿è¡Œæ­£ç¡®ã€‚ ç¤ºä¾‹ 6ã€åœ¨ Java 8 ä¸­è·å–å½“å‰æ—¶é—´ä¸ Java 8 è·å–æ—¥æœŸçš„ä¾‹å­å¾ˆåƒï¼Œè·å–æ—¶é—´ä½¿ç”¨çš„æ˜¯ LocalTime ç±»ï¼Œä¸€ä¸ªåªæœ‰æ—¶é—´æ²¡æœ‰æ—¥æœŸçš„ LocalDate è¿‘äº²ã€‚å¯ä»¥è°ƒç”¨é™æ€å·¥å‚æ–¹æ³• now() æ¥è·å–å½“å‰æ—¶é—´ã€‚é»˜è®¤çš„æ ¼å¼æ˜¯ hh:mm:ss:nnnã€‚ 12LocalTime localTime = LocalTime.now();System.out.println(localTime); ç»“æœï¼š 113:35:56.155 å¯ä»¥çœ‹åˆ°å½“å‰æ—¶é—´å°±åªåŒ…å«æ—¶é—´ä¿¡æ¯ï¼Œæ²¡æœ‰æ—¥æœŸã€‚ ç¤ºä¾‹ 7ã€å¦‚ä½•åœ¨ç°æœ‰çš„æ—¶é—´ä¸Šå¢åŠ å°æ—¶é€šè¿‡å¢åŠ å°æ—¶ã€åˆ†ã€ç§’æ¥è®¡ç®—å°†æ¥çš„æ—¶é—´å¾ˆå¸¸è§ã€‚Java 8 é™¤äº†ä¸å˜ç±»å‹å’Œçº¿ç¨‹å®‰å…¨çš„å¥½å¤„ä¹‹å¤–ï¼Œè¿˜æä¾›äº†æ›´å¥½çš„plusHours() æ–¹æ³•æ›¿æ¢ add()ï¼Œå¹¶ä¸”æ˜¯å…¼å®¹çš„ã€‚æ³¨æ„ï¼Œè¿™äº›æ–¹æ³•è¿”å›ä¸€ä¸ªå…¨æ–°çš„ LocalTime å®ä¾‹ï¼Œç”±äºå…¶ä¸å¯å˜æ€§ï¼Œè¿”å›åä¸€å®šè¦ç”¨å˜é‡èµ‹å€¼ã€‚ 1234LocalTime localTime = LocalTime.now();System.out.println(localTime);LocalTime localTime1 = localTime.plusHours(2);//å¢åŠ 2å°æ—¶System.out.println(localTime1); ç»“æœï¼š 1213:41:20.72115:41:20.721 å¯ä»¥çœ‹åˆ°ï¼Œæ–°çš„æ—¶é—´åœ¨å½“å‰æ—¶é—´ 13:41:20.721 çš„åŸºç¡€ä¸Šå¢åŠ äº† 2 ä¸ªå°æ—¶ã€‚ ç¤ºä¾‹ 8ã€å¦‚ä½•è®¡ç®—ä¸€å‘¨åçš„æ—¥æœŸå’Œä¸Šä¸ªä¾‹å­è®¡ç®—ä¸¤å°æ—¶ä»¥åçš„æ—¶é—´ç±»ä¼¼ï¼Œè¿™ä¸ªä¾‹å­ä¼šè®¡ç®—ä¸€å‘¨åçš„æ—¥æœŸã€‚LocalDate æ—¥æœŸä¸åŒ…å«æ—¶é—´ä¿¡æ¯ï¼Œå®ƒçš„ plus()æ–¹æ³•ç”¨æ¥å¢åŠ å¤©ã€å‘¨ã€æœˆï¼ŒChronoUnit ç±»å£°æ˜äº†è¿™äº›æ—¶é—´å•ä½ã€‚ç”±äº LocalDate ä¹Ÿæ˜¯ä¸å˜ç±»å‹ï¼Œè¿”å›åä¸€å®šè¦ç”¨å˜é‡èµ‹å€¼ã€‚ 1234LocalDate now = LocalDate.now();LocalDate plusDate = now.plus(1, ChronoUnit.WEEKS);System.out.println(now);System.out.println(plusDate); ç»“æœï¼š 122018-06-202018-06-27 å¯ä»¥çœ‹åˆ°æ–°æ—¥æœŸç¦»å½“å¤©æ—¥æœŸæ˜¯ 7 å¤©ï¼Œä¹Ÿå°±æ˜¯ä¸€å‘¨ã€‚ä½ å¯ä»¥ç”¨åŒæ ·çš„æ–¹æ³•å¢åŠ  1 ä¸ªæœˆã€1 å¹´ã€1 å°æ—¶ã€1 åˆ†é’Ÿç”šè‡³ä¸€ä¸ªä¸–çºªï¼Œæ›´å¤šé€‰é¡¹å¯ä»¥æŸ¥çœ‹ Java 8 API ä¸­çš„ ChronoUnit ç±»ã€‚ ç¤ºä¾‹ 9ã€è®¡ç®—ä¸€å¹´å‰æˆ–ä¸€å¹´åçš„æ—¥æœŸç»§ç»­ä¸Šé¢çš„ä¾‹å­ï¼Œä¸Šä¸ªä¾‹å­ä¸­æˆ‘ä»¬é€šè¿‡ LocalDate çš„ plus() æ–¹æ³•å¢åŠ å¤©æ•°ã€å‘¨æ•°æˆ–æœˆæ•°ï¼Œè¿™ä¸ªä¾‹å­æˆ‘ä»¬åˆ©ç”¨ minus() æ–¹æ³•è®¡ç®—ä¸€å¹´å‰çš„æ—¥æœŸã€‚ 12345LocalDate now = LocalDate.now();LocalDate minusDate = now.minus(1, ChronoUnit.YEARS);LocalDate plusDate1 = now.plus(1, ChronoUnit.YEARS);System.out.println(minusDate);System.out.println(plusDate1); ç»“æœï¼š 122017-06-202019-06-20 ç¤ºä¾‹ 10ã€ä½¿ç”¨ Java 8 çš„ Clock æ—¶é’Ÿç±»Java 8 å¢åŠ äº†ä¸€ä¸ª Clock æ—¶é’Ÿç±»ç”¨äºè·å–å½“æ—¶çš„æ—¶é—´æˆ³ï¼Œæˆ–å½“å‰æ—¶åŒºä¸‹çš„æ—¥æœŸæ—¶é—´ä¿¡æ¯ã€‚ä»¥å‰ç”¨åˆ°System.currentTimeInMillis() å’Œ TimeZone.getDefault() çš„åœ°æ–¹éƒ½å¯ç”¨ Clock æ›¿æ¢ã€‚ 1234Clock clock = Clock.systemUTC();Clock clock1 = Clock.systemDefaultZone();System.out.println(clock);System.out.println(clock1); ç»“æœï¼š 12SystemClock[Z]SystemClock[Asia/Shanghai] ç¤ºä¾‹ 11ã€å¦‚ä½•ç”¨ Java åˆ¤æ–­æ—¥æœŸæ˜¯æ—©äºè¿˜æ˜¯æ™šäºå¦ä¸€ä¸ªæ—¥æœŸå¦ä¸€ä¸ªå·¥ä½œä¸­å¸¸è§çš„æ“ä½œå°±æ˜¯å¦‚ä½•åˆ¤æ–­ç»™å®šçš„ä¸€ä¸ªæ—¥æœŸæ˜¯å¤§äºæŸå¤©è¿˜æ˜¯å°äºæŸå¤©ï¼Ÿåœ¨ Java 8 ä¸­ï¼ŒLocalDate ç±»æœ‰ä¸¤ç±»æ–¹æ³• isBefore() å’Œ isAfter() ç”¨äºæ¯”è¾ƒæ—¥æœŸã€‚è°ƒç”¨ isBefore() æ–¹æ³•æ—¶ï¼Œå¦‚æœç»™å®šæ—¥æœŸå°äºå½“å‰æ—¥æœŸåˆ™è¿”å› trueã€‚ 12345678LocalDate tomorrow = LocalDate.of(2018,6,20);if(tomorrow.isAfter(now))&#123; System.out.println(\"Tomorrow comes after today\");&#125;LocalDate yesterday = now.minus(1, ChronoUnit.DAYS);if(yesterday.isBefore(now))&#123; System.out.println(\"Yesterday is day before today\");&#125; åœ¨ Java 8 ä¸­æ¯”è¾ƒæ—¥æœŸéå¸¸æ–¹ä¾¿ï¼Œä¸éœ€è¦ä½¿ç”¨é¢å¤–çš„ Calendar ç±»æ¥åšè¿™äº›åŸºç¡€å·¥ä½œäº†ã€‚ ç¤ºä¾‹ 12ã€åœ¨ Java 8 ä¸­å¤„ç†æ—¶åŒºJava 8 ä¸ä»…åˆ†ç¦»äº†æ—¥æœŸå’Œæ—¶é—´ï¼Œä¹ŸæŠŠæ—¶åŒºåˆ†ç¦»å‡ºæ¥äº†ã€‚ç°åœ¨æœ‰ä¸€ç³»åˆ—å•ç‹¬çš„ç±»å¦‚ ZoneId æ¥å¤„ç†ç‰¹å®šæ—¶åŒºï¼ŒZoneDateTime ç±»æ¥è¡¨ç¤ºæŸæ—¶åŒºä¸‹çš„æ—¶é—´ã€‚è¿™åœ¨ Java 8 ä»¥å‰éƒ½æ˜¯ GregorianCalendar ç±»æ¥åšçš„ã€‚ 1234ZoneId america = ZoneId.of(\"America/New_York\");LocalDateTime localtDateAndTime = LocalDateTime.now();ZonedDateTime dateAndTimeInNewYork = ZonedDateTime.of(localtDateAndTime, america );System.out.println(dateAndTimeInNewYork); ç¤ºä¾‹ 13ã€å¦‚ä½•è¡¨ç¤ºä¿¡ç”¨å¡åˆ°æœŸè¿™ç±»å›ºå®šæ—¥æœŸï¼Œç­”æ¡ˆå°±åœ¨ YearMonthä¸ MonthDay æ£€æŸ¥é‡å¤äº‹ä»¶çš„ä¾‹å­ç›¸ä¼¼ï¼ŒYearMonth æ˜¯å¦ä¸€ä¸ªç»„åˆç±»ï¼Œç”¨äºè¡¨ç¤ºä¿¡ç”¨å¡åˆ°æœŸæ—¥ã€FD åˆ°æœŸæ—¥ã€æœŸè´§æœŸæƒåˆ°æœŸæ—¥ç­‰ã€‚è¿˜å¯ä»¥ç”¨è¿™ä¸ªç±»å¾—åˆ° å½“æœˆå…±æœ‰å¤šå°‘å¤©ï¼ŒYearMonth å®ä¾‹çš„ lengthOfMonth() æ–¹æ³•å¯ä»¥è¿”å›å½“æœˆçš„å¤©æ•°ï¼Œåœ¨åˆ¤æ–­ 2 æœˆæœ‰ 28 å¤©è¿˜æ˜¯ 29 å¤©æ—¶éå¸¸æœ‰ç”¨ã€‚ 1234YearMonth currentYearMonth = YearMonth.now();System.out.printf(\"Days in month year %s: %d%n\", currentYearMonth, currentYearMonth.lengthOfMonth());YearMonth creditCardExpiry = YearMonth.of(2018, Month.FEBRUARY);System.out.printf(\"Your credit card expires on %s %n\", creditCardExpiry); ç»“æœï¼š 12Days in month year 2018-06: 30Your credit card expires on 2018-02 ç¤ºä¾‹ 14ã€å¦‚ä½•åœ¨ Java 8 ä¸­æ£€æŸ¥é—°å¹´LocalDate ç±»æœ‰ä¸€ä¸ªå¾ˆå®ç”¨çš„æ–¹æ³• isLeapYear() åˆ¤æ–­è¯¥å®ä¾‹æ˜¯å¦æ˜¯ä¸€ä¸ªé—°å¹´ã€‚ ç¤ºä¾‹ 15ã€è®¡ç®—ä¸¤ä¸ªæ—¥æœŸä¹‹é—´çš„å¤©æ•°å’Œæœˆæ•°æœ‰ä¸€ä¸ªå¸¸è§æ—¥æœŸæ“ä½œæ˜¯è®¡ç®—ä¸¤ä¸ªæ—¥æœŸä¹‹é—´çš„å¤©æ•°ã€å‘¨æ•°æˆ–æœˆæ•°ã€‚åœ¨ Java 8 ä¸­å¯ä»¥ç”¨ java.time.Period ç±»æ¥åšè®¡ç®—ã€‚ä¸‹é¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è®¡ç®—äº†å½“å¤©å’Œå°†æ¥æŸä¸€å¤©ä¹‹é—´çš„æœˆæ•°ã€‚ 123LocalDate date = LocalDate.of(2019, Month.MARCH, 20);Period period = Period.between(now, date);System.out.println(&quot;ç¦»ä¸‹ä¸ªæ—¶é—´è¿˜æœ‰&quot; + period.getMonths() + &quot; ä¸ªæœˆ&quot;); ç¤ºä¾‹ 16ã€åŒ…å«æ—¶å·®ä¿¡æ¯çš„æ—¥æœŸå’Œæ—¶é—´åœ¨ Java 8 ä¸­ï¼ŒZoneOffset ç±»ç”¨æ¥è¡¨ç¤ºæ—¶åŒºï¼Œä¸¾ä¾‹æ¥è¯´å°åº¦ä¸ GMT æˆ– UTC æ ‡å‡†æ—¶åŒºç›¸å·® +05:30ï¼Œå¯ä»¥é€šè¿‡ZoneOffset.of() é™æ€æ–¹æ³•æ¥è·å–å¯¹åº”çš„æ—¶åŒºã€‚ä¸€æ—¦å¾—åˆ°äº†æ—¶å·®å°±å¯ä»¥é€šè¿‡ä¼ å…¥ LocalDateTime å’Œ ZoneOffset æ¥åˆ›å»ºä¸€ä¸ª OffSetDateTime å¯¹è±¡ã€‚ 1234LocalDateTime datetime = LocalDateTime.of(2014, Month.JANUARY, 14,19,30);ZoneOffset offset = ZoneOffset.of(\"+05:30\");OffsetDateTime date = OffsetDateTime.of(datetime, offset); System.out.println(\"Date and Time with timezone offset in Java : \" + date); ç¤ºä¾‹ 17ã€åœ¨ Java 8 ä¸­è·å–å½“å‰çš„æ—¶é—´æˆ³å¦‚æœä½ è¿˜è®°å¾— Java 8 ä»¥å‰æ˜¯å¦‚ä½•è·å¾—å½“å‰æ—¶é—´æˆ³ï¼Œé‚£ä¹ˆç°åœ¨ä½ ç»ˆäºè§£è„±äº†ã€‚Instant ç±»æœ‰ä¸€ä¸ªé™æ€å·¥å‚æ–¹æ³• now() ä¼šè¿”å›å½“å‰çš„æ—¶é—´æˆ³ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 12Instant timestamp = Instant.now();System.out.println(timestamp); ç»“æœï¼š 12018-06-20T06:35:24.881Z æ—¶é—´æˆ³ä¿¡æ¯é‡ŒåŒæ—¶åŒ…å«äº†æ—¥æœŸå’Œæ—¶é—´ï¼Œè¿™å’Œ java.util.Date å¾ˆåƒã€‚å®é™…ä¸Š Instant ç±»ç¡®å®ç­‰åŒäº Java 8 ä¹‹å‰çš„ Dateç±»ï¼Œä½ å¯ä»¥ä½¿ç”¨ Date ç±»å’Œ Instant ç±»å„è‡ªçš„è½¬æ¢æ–¹æ³•äº’ç›¸è½¬æ¢ï¼Œä¾‹å¦‚ï¼šDate.from(Instant) å°† Instant è½¬æ¢æˆjava.util.Dateï¼ŒDate.toInstant() åˆ™æ˜¯å°† Date ç±»è½¬æ¢æˆ Instant ç±»ã€‚ ç¤ºä¾‹ 18ã€åœ¨ Java 8 ä¸­å¦‚ä½•ä½¿ç”¨é¢„å®šä¹‰çš„æ ¼å¼åŒ–å·¥å…·å»è§£ææˆ–æ ¼å¼åŒ–æ—¥æœŸåœ¨ Java 8 ä»¥å‰çš„ä¸–ç•Œé‡Œï¼Œæ—¥æœŸå’Œæ—¶é—´çš„æ ¼å¼åŒ–éå¸¸è¯¡å¼‚ï¼Œå”¯ä¸€çš„å¸®åŠ©ç±» SimpleDateFormat ä¹Ÿæ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œè€Œä¸”ç”¨ä½œå±€éƒ¨å˜é‡è§£æå’Œæ ¼å¼åŒ–æ—¥æœŸæ—¶æ˜¾å¾—å¾ˆç¬¨é‡ã€‚å¹¸å¥½çº¿ç¨‹å±€éƒ¨å˜é‡èƒ½ä½¿å®ƒåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­å˜å¾—å¯ç”¨ï¼Œä¸è¿‡è¿™éƒ½æ˜¯è¿‡å»æ—¶äº†ã€‚Java 8 å¼•å…¥äº†å…¨æ–°çš„æ—¥æœŸæ—¶é—´æ ¼å¼å·¥å…·ï¼Œçº¿ç¨‹å®‰å…¨è€Œä¸”ä½¿ç”¨æ–¹ä¾¿ã€‚å®ƒè‡ªå¸¦äº†ä¸€äº›å¸¸ç”¨çš„å†…ç½®æ ¼å¼åŒ–å·¥å…·ã€‚ å‚è§æˆ‘ä¸Šä¸€ç¯‡æ–‡ç« ï¼š ã€ŠSimpleDateFormat å¦‚ä½•å®‰å…¨çš„ä½¿ç”¨ï¼Ÿã€‹ ç¤ºä¾‹ 19ã€å¦‚ä½•åœ¨ Java ä¸­ä½¿ç”¨è‡ªå®šä¹‰æ ¼å¼åŒ–å·¥å…·è§£ææ—¥æœŸå°½ç®¡å†…ç½®æ ¼å¼åŒ–å·¥å…·å¾ˆå¥½ç”¨ï¼Œæœ‰æ—¶è¿˜æ˜¯éœ€è¦å®šä¹‰ç‰¹å®šçš„æ—¥æœŸæ ¼å¼ã€‚å¯ä»¥è°ƒç”¨ DateTimeFormatter çš„ ofPattern() é™æ€æ–¹æ³•å¹¶ä¼ å…¥ä»»æ„æ ¼å¼è¿”å›å…¶å®ä¾‹ï¼Œæ ¼å¼ä¸­çš„å­—ç¬¦å’Œä»¥å‰ä»£è¡¨çš„ä¸€æ ·ï¼ŒM ä»£è¡¨æœˆï¼Œm ä»£è¡¨åˆ†ã€‚å¦‚æœæ ¼å¼ä¸è§„èŒƒä¼šæŠ›å‡º DateTimeParseException å¼‚å¸¸ï¼Œä¸è¿‡å¦‚æœåªæ˜¯æŠŠ M å†™æˆ m è¿™ç§é€»è¾‘é”™è¯¯æ˜¯ä¸ä¼šæŠ›å¼‚å¸¸çš„ã€‚ å‚è§æˆ‘ä¸Šä¸€ç¯‡æ–‡ç« ï¼š ã€ŠSimpleDateFormat å¦‚ä½•å®‰å…¨çš„ä½¿ç”¨ï¼Ÿã€‹ ç¤ºä¾‹ 20ã€åœ¨ Java 8 ä¸­å¦‚ä½•æŠŠæ—¥æœŸè½¬æ¢æˆå­—ç¬¦ä¸²ä¸Šä¸¤ä¸ªä¸»è¦æ˜¯ä»å­—ç¬¦ä¸²è§£ææ—¥æœŸã€‚ç°åœ¨æˆ‘ä»¬åè¿‡æ¥ï¼ŒæŠŠ LocalDateTime æ—¥æœŸå®ä¾‹è½¬æ¢æˆç‰¹å®šæ ¼å¼çš„å­—ç¬¦ä¸²ã€‚è¿™æ˜¯è¿„ä»Šä¸ºæ­¢ Java æ—¥æœŸè½¬å­—ç¬¦ä¸²æœ€ä¸ºç®€å•çš„æ–¹å¼äº†ã€‚ä¸‹é¢çš„ä¾‹å­å°†è¿”å›ä¸€ä¸ªä»£è¡¨æ—¥æœŸçš„æ ¼å¼åŒ–å­—ç¬¦ä¸²ã€‚å’Œå‰é¢ç±»ä¼¼ï¼Œè¿˜æ˜¯éœ€è¦åˆ›å»º DateTimeFormatter å®ä¾‹å¹¶ä¼ å…¥æ ¼å¼ï¼Œä½†è¿™å›è°ƒç”¨çš„æ˜¯ format() æ–¹æ³•ï¼Œè€Œé parse() æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•ä¼šæŠŠä¼ å…¥çš„æ—¥æœŸè½¬åŒ–æˆæŒ‡å®šæ ¼å¼çš„å­—ç¬¦ä¸²ã€‚ 123456789LocalDateTime arrivalDate = LocalDateTime.now();try &#123; DateTimeFormatter format = DateTimeFormatter.ofPattern(\"MMMdd yyyy hh:mm a\"); String landing = arrivalDate.format(format); System.out.printf(\"Arriving at : %s %n\", landing);&#125;catch (DateTimeException ex) &#123; System.out.printf(\"%s can't be formatted!%n\", arrivalDate); ex.printStackTrace();&#125; Java 8 æ—¥æœŸæ—¶é—´ API çš„é‡ç‚¹é€šè¿‡è¿™äº›ä¾‹å­ï¼Œä½ è‚¯å®šå·²ç»æŒæ¡äº† Java 8 æ—¥æœŸæ—¶é—´ API çš„æ–°çŸ¥è¯†ç‚¹ã€‚ç°åœ¨æ¥å›é¡¾ä¸€ä¸‹è¿™ä¸ªä¼˜é›… API çš„ä½¿ç”¨è¦ç‚¹ï¼š 1ï¼‰æä¾›äº† javax.time.ZoneId è·å–æ—¶åŒºã€‚ 2ï¼‰æä¾›äº† LocalDate å’Œ LocalTime ç±»ã€‚ 3ï¼‰Java 8 çš„æ‰€æœ‰æ—¥æœŸå’Œæ—¶é—´ API éƒ½æ˜¯ä¸å¯å˜ç±»å¹¶ä¸”çº¿ç¨‹å®‰å…¨ï¼Œè€Œç°æœ‰çš„ Date å’Œ Calendar API ä¸­çš„ java.util.Date å’ŒSimpleDateFormat æ˜¯éçº¿ç¨‹å®‰å…¨çš„ã€‚ 4ï¼‰ä¸»åŒ…æ˜¯ java.time, åŒ…å«äº†è¡¨ç¤ºæ—¥æœŸã€æ—¶é—´ã€æ—¶é—´é—´éš”çš„ä¸€äº›ç±»ã€‚é‡Œé¢æœ‰ä¸¤ä¸ªå­åŒ… java.time.format ç”¨äºæ ¼å¼åŒ–ï¼Œ java.time.temporal ç”¨äºæ›´åº•å±‚çš„æ“ä½œã€‚ 5ï¼‰æ—¶åŒºä»£è¡¨äº†åœ°çƒä¸ŠæŸä¸ªåŒºåŸŸå†…æ™®éä½¿ç”¨çš„æ ‡å‡†æ—¶é—´ã€‚æ¯ä¸ªæ—¶åŒºéƒ½æœ‰ä¸€ä¸ªä»£å·ï¼Œæ ¼å¼é€šå¸¸ç”±åŒºåŸŸ/åŸå¸‚æ„æˆï¼ˆAsia/Tokyoï¼‰ï¼Œåœ¨åŠ ä¸Šä¸æ ¼æ—å¨æ²»æˆ– UTC çš„æ—¶å·®ã€‚ä¾‹å¦‚ï¼šä¸œäº¬çš„æ—¶å·®æ˜¯ +09:00ã€‚ 6ï¼‰OffsetDateTime ç±»å®é™…ä¸Šç»„åˆäº† LocalDateTime ç±»å’Œ ZoneOffset ç±»ã€‚ç”¨æ¥è¡¨ç¤ºåŒ…å«å’Œæ ¼æ—å¨æ²»æˆ– UTC æ—¶å·®çš„å®Œæ•´æ—¥æœŸï¼ˆå¹´ã€æœˆã€æ—¥ï¼‰å’Œæ—¶é—´ï¼ˆæ—¶ã€åˆ†ã€ç§’ã€çº³ç§’ï¼‰ä¿¡æ¯ã€‚ 7ï¼‰DateTimeFormatter ç±»ç”¨æ¥æ ¼å¼åŒ–å’Œè§£ææ—¶é—´ã€‚ä¸ SimpleDateFormat ä¸åŒï¼Œè¿™ä¸ªç±»ä¸å¯å˜å¹¶ä¸”çº¿ç¨‹å®‰å…¨ï¼Œéœ€è¦æ—¶å¯ä»¥ç»™é™æ€å¸¸é‡èµ‹å€¼ã€‚ DateTimeFormatter ç±»æä¾›äº†å¤§é‡çš„å†…ç½®æ ¼å¼åŒ–å·¥å…·ï¼ŒåŒæ—¶ä¹Ÿå…è®¸ä½ è‡ªå®šä¹‰ã€‚åœ¨è½¬æ¢æ–¹é¢ä¹Ÿæä¾›äº† parse() å°†å­—ç¬¦ä¸²è§£ææˆæ—¥æœŸï¼Œå¦‚æœè§£æå‡ºé”™ä¼šæŠ›å‡º DateTimeParseExceptionã€‚DateTimeFormatter ç±»åŒæ—¶è¿˜æœ‰format() ç”¨æ¥æ ¼å¼åŒ–æ—¥æœŸï¼Œå¦‚æœå‡ºé”™ä¼šæŠ›å‡º DateTimeExceptionå¼‚å¸¸ã€‚ 8ï¼‰å†è¡¥å……ä¸€ç‚¹ï¼Œæ—¥æœŸæ ¼å¼â€œMMM d yyyyâ€å’Œâ€œMMM dd yyyyâ€æœ‰ä¸€äº›å¾®å¦™çš„ä¸åŒï¼Œç¬¬ä¸€ä¸ªæ ¼å¼å¯ä»¥è§£æâ€œJan 2 2014â€å’Œâ€œJan 14 2014â€ï¼Œè€Œç¬¬äºŒä¸ªåœ¨è§£æâ€œJan 2 2014â€å°±ä¼šæŠ›å¼‚å¸¸ï¼Œå› ä¸ºç¬¬äºŒä¸ªæ ¼å¼é‡Œè¦æ±‚æ—¥å¿…é¡»æ˜¯ä¸¤ä½çš„ã€‚å¦‚æœæƒ³ä¿®æ­£ï¼Œä½ å¿…é¡»åœ¨æ—¥æœŸåªæœ‰ä¸ªä½æ•°æ—¶åœ¨å‰é¢è¡¥é›¶ï¼Œå°±æ˜¯è¯´â€œJan 2 2014â€åº”è¯¥å†™æˆ â€œJan 02 2014â€ã€‚ ç›¸å…³æ–‡ç« SimpleDateFormat å¦‚ä½•å®‰å…¨çš„ä½¿ç”¨ï¼Ÿ","tags":[{"name":"Java","slug":"Java","permalink":"http://www.54tianzhisheng.cn/tags/Java/"}]},{"title":"SimpleDateFormat å¦‚ä½•å®‰å…¨çš„ä½¿ç”¨ï¼Ÿ","date":"2018-06-18T16:00:00.000Z","path":"2018/06/19/SimpleDateFormat/","text":"å‰è¨€ä¸ºä»€ä¹ˆä¼šå†™è¿™ç¯‡æ–‡ç« ï¼Ÿå› ä¸ºè¿™äº›å¤©åœ¨çœ‹ã€Šé˜¿é‡Œå·´å·´å¼€å‘æ‰‹å†Œè¯¦å°½ç‰ˆã€‹ï¼Œæ²¡çœ‹è¿‡çš„å¯ä»¥å…³æ³¨å¾®ä¿¡å…¬ä¼—å·ï¼šzhishengï¼Œå›å¤å…³é”®å­—ï¼šé˜¿é‡Œå·´å·´å¼€å‘æ‰‹å†Œè¯¦å°½ç‰ˆ å°±å¯ä»¥è·å¾—ã€‚ å…³æ³¨æˆ‘ è½¬è½½è¯·åŠ¡å¿…æ³¨æ˜åŸåˆ›åœ°å€ä¸ºï¼šhttp://www.54tianzhisheng.cn/2018/06/19/SimpleDateFormat/ åœ¨çœ‹çš„è¿‡ç¨‹ä¸­æœ‰è¿™ä¹ˆä¸€æ¡ï¼š ã€å¼ºåˆ¶ã€‘SimpleDateFormat æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ç±»ï¼Œä¸€èˆ¬ä¸è¦å®šä¹‰ä¸º static å˜é‡ï¼Œå¦‚æœå®šä¹‰ä¸º staticï¼Œå¿…é¡»åŠ é”ï¼Œæˆ–è€…ä½¿ç”¨ DateUtils å·¥å…·ç±»ã€‚ çœ‹åˆ°è¿™æ¡æˆ‘ç«‹é©¬å°±æƒ³èµ·äº†æˆ‘å®ä¹ çš„æ—¶å€™æœ‰ä¸ªé¡¹ç›®é‡Œé¢å°±çŠ¯äº†è¿™ä¸ªé”™è¯¯ï¼Œè®°å¾—å½“æ—¶æ˜¯è¿™æ ·å†™çš„ï¼š 1private static final SimpleDateFormat df = new SimpleDateFormat(\"yyyyMMddHHmmss\"); æ‰€ä»¥æ‰è®¤çœŸçš„å»ç ”ç©¶ä¸‹è¿™ä¸ª SimpleDateFormatï¼Œæ‰€ä»¥æ‰æœ‰äº†è¿™ç¯‡æ–‡ç« ã€‚ å®ƒæ˜¯è°ï¼Ÿæƒ³å¿…å¤§å®¶å¯¹ SimpleDateFormat å¹¶ä¸é™Œç”Ÿã€‚SimpleDateFormat æ˜¯ Java ä¸­ä¸€ä¸ªéå¸¸å¸¸ç”¨çš„ç±»ï¼Œä»–æ˜¯ä»¥åŒºåŸŸæ•æ„Ÿçš„æ–¹å¼æ ¼å¼åŒ–å’Œè§£ææ—¥æœŸçš„å…·ä½“ç±»ã€‚ å®ƒå…è®¸æ ¼å¼åŒ– (date -&gt; text)ã€è¯­æ³•åˆ†æ (text -&gt; date)å’Œæ ‡å‡†åŒ–ã€‚ SimpleDateFormat å…è®¸ä»¥ä»»ä½•ç”¨æˆ·æŒ‡å®šçš„æ—¥æœŸ-æ—¶é—´æ ¼å¼æ–¹å¼å¯åŠ¨ã€‚ ä½†æ˜¯ï¼Œå»ºè®®ä½¿ç”¨ DateFormat ä¸­çš„ getTimeInstanceã€ getDateInstance æˆ– getDateTimeInstance æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªæ—¥æœŸ-æ—¶é—´æ ¼å¼ã€‚ è¿™å‡ ä¸ªæ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªé»˜è®¤çš„æ—¥æœŸï¼æ—¶é—´æ ¼å¼ã€‚ ä½ å¯ä»¥æ ¹æ®éœ€è¦ç”¨ applyPattern æ–¹æ³•ä¿®æ”¹æ ¼å¼æ–¹å¼ã€‚ æ—¥æœŸæ—¶é—´æ ¼å¼æ—¥æœŸå’Œæ—¶é—´æ ¼å¼ç”± æ—¥æœŸå’Œæ—¶é—´æ¨¡å¼å­—ç¬¦ä¸² æŒ‡å®šã€‚åœ¨ æ—¥æœŸå’Œæ—¶é—´æ¨¡å¼å­—ç¬¦ä¸² ä¸­ï¼ŒæœªåŠ å¼•å·çš„å­—æ¯ â€˜Aâ€™ åˆ° â€˜Zâ€™ å’Œ â€˜aâ€™ åˆ° â€˜zâ€™ è¢«è§£é‡Šä¸ºæ¨¡å¼å­—æ¯ï¼Œç”¨æ¥è¡¨ç¤ºæ—¥æœŸæˆ–æ—¶é—´å­—ç¬¦ä¸²å…ƒç´ ã€‚æ–‡æœ¬å¯ä»¥ä½¿ç”¨å•å¼•å· (â€˜) å¼•èµ·æ¥ï¼Œä»¥å…è¿›è¡Œè§£é‡Šã€‚æ‰€æœ‰å…¶ä»–å­—ç¬¦å‡ä¸è§£é‡Šï¼Œåªæ˜¯åœ¨æ ¼å¼åŒ–æ—¶å°†å®ƒä»¬ç®€å•å¤åˆ¶åˆ°è¾“å‡ºå­—ç¬¦ä¸²ã€‚ ç®€å•çš„è®²ï¼šè¿™äº› A â€”â€”Zï¼Œa â€”â€” z è¿™äº›å­—æ¯(ä¸è¢«å•å¼•å·åŒ…å›´çš„)ä¼šè¢«ç‰¹æ®Šå¤„ç†æ›¿æ¢ä¸ºå¯¹åº”çš„æ—¥æœŸæ—¶é—´ï¼Œå…¶ä»–çš„å­—ç¬¦ä¸²è¿˜æ˜¯åŸæ ·è¾“å‡ºã€‚ æ—¥æœŸå’Œæ—¶é—´æ¨¡å¼(æ³¨æ„å¤§å°å†™ï¼Œä»£è¡¨çš„å«ä¹‰æ˜¯ä¸åŒçš„)å¦‚ä¸‹ï¼š æ€ä¹ˆä½¿ç”¨ï¼Ÿæ—¥æœŸï¼æ—¶é—´æ ¼å¼æ¨¡ç‰ˆæ ·ä¾‹ï¼šï¼ˆç»™çš„æ—¶é—´æ˜¯ï¼š2001-07-04 12:08:56 U.S. Pacific Time time zoneï¼‰ ä½¿ç”¨æ–¹æ³•ï¼š 1234567891011121314151617181920212223import java.text.SimpleDateFormat;import java.util.Date;/** * Created by zhisheng_tian on 2018/6/19 */public class FormatDateTime &#123; public static void main(String[] args) &#123; SimpleDateFormat myFmt = new SimpleDateFormat(\"yyyyå¹´MMæœˆddæ—¥ HHæ—¶mmåˆ†ssç§’\"); SimpleDateFormat myFmt1 = new SimpleDateFormat(\"yy/MM/dd HH:mm\"); SimpleDateFormat myFmt2 = new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\");//ç­‰ä»·äºnow.toLocaleString() SimpleDateFormat myFmt3 = new SimpleDateFormat(\"yyyyå¹´MMæœˆddæ—¥ HHæ—¶mmåˆ†ssç§’ E \"); SimpleDateFormat myFmt4 = new SimpleDateFormat(\"ä¸€å¹´ä¸­çš„ç¬¬ D å¤© ä¸€å¹´ä¸­ç¬¬wä¸ªæ˜ŸæœŸ ä¸€æœˆä¸­ç¬¬Wä¸ªæ˜ŸæœŸ åœ¨ä¸€å¤©ä¸­kæ—¶ zæ—¶åŒº\"); Date now = new Date(); System.out.println(myFmt.format(now)); System.out.println(myFmt1.format(now)); System.out.println(myFmt2.format(now)); System.out.println(myFmt3.format(now)); System.out.println(myFmt4.format(now)); System.out.println(now.toGMTString()); System.out.println(now.toLocaleString()); System.out.println(now.toString()); &#125;&#125; ç»“æœæ˜¯ï¼š 123456782018å¹´06æœˆ19æ—¥ 23æ—¶10åˆ†05ç§’18/06/19 23:102018-06-19 23:10:052018å¹´06æœˆ19æ—¥ 23æ—¶10åˆ†05ç§’ æ˜ŸæœŸäºŒä¸€å¹´ä¸­çš„ç¬¬ 170 å¤© ä¸€å¹´ä¸­ç¬¬25ä¸ªæ˜ŸæœŸ ä¸€æœˆä¸­ç¬¬4ä¸ªæ˜ŸæœŸ åœ¨ä¸€å¤©ä¸­23æ—¶ CSTæ—¶åŒº19 Jun 2018 15:10:05 GMT2018-6-19 23:10:05Tue Jun 19 23:10:05 CST 2018 ä½¿ç”¨æ–¹æ³•å¾ˆç®€å•ï¼Œå°±æ˜¯å…ˆè‡ªå·±å®šä¹‰å¥½æ—¶é—´ï¼æ—¥æœŸæ¨¡ç‰ˆï¼Œç„¶åè°ƒç”¨ format æ–¹æ³•ï¼ˆä¼ å…¥ä¸€ä¸ªæ—¶é—´ Date å‚æ•°ï¼‰ã€‚ ä¸Šé¢çš„æ˜¯æ—¥æœŸè½¬æ¢æˆè‡ªå·±æƒ³è¦çš„å­—ç¬¦ä¸²æ ¼å¼ã€‚ä¸‹é¢åè¿‡æ¥ï¼Œå°†å­—ç¬¦ä¸²ç±»å‹è£…æ¢æˆæ—¥æœŸç±»å‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152import java.text.ParseException;import java.text.SimpleDateFormat;import java.util.Date;/** * Created by zhisheng_tian on 2018/6/19 */public class StringFormatDate &#123; public static void main(String[] args) &#123; String time1 = \"2018å¹´06æœˆ19æ—¥ 23æ—¶10åˆ†05ç§’\"; String time2 = \"18/06/19 23:10\"; String time3 = \"2018-06-19 23:10:05\"; String time4 = \"2018å¹´06æœˆ19æ—¥ 23æ—¶10åˆ†05ç§’ æ˜ŸæœŸäºŒ\"; SimpleDateFormat myFmt = new SimpleDateFormat(\"yyyyå¹´MMæœˆddæ—¥ HHæ—¶mmåˆ†ssç§’\"); SimpleDateFormat myFmt1 = new SimpleDateFormat(\"yy/MM/dd HH:mm\"); SimpleDateFormat myFmt2 = new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\");//ç­‰ä»·äºnow.toLocaleString() SimpleDateFormat myFmt3 = new SimpleDateFormat(\"yyyyå¹´MMæœˆddæ—¥ HHæ—¶mmåˆ†ssç§’ E\"); Date date1 = null; try &#123; date1 = myFmt.parse(time1); &#125; catch (ParseException e) &#123; e.printStackTrace(); &#125; System.out.println(date1); Date date2 = null; try &#123; date2 = myFmt1.parse(time2); &#125; catch (ParseException e) &#123; e.printStackTrace(); &#125; System.out.println(date2); Date date3 = null; try &#123; date3 = myFmt2.parse(time3); &#125; catch (ParseException e) &#123; e.printStackTrace(); &#125; System.out.println(date3); Date date4 = null; try &#123; date4 = myFmt3.parse(time4); &#125; catch (ParseException e) &#123; e.printStackTrace(); &#125; System.out.println(date4); &#125;&#125; ç»“æœæ˜¯ï¼š 1234Tue Jun 19 23:10:05 CST 2018Tue Jun 19 23:10:00 CST 2018Tue Jun 19 23:10:05 CST 2018Tue Jun 19 23:10:05 CST 2018 è¿™ä¸ªè½¬æ¢æ–¹æ³•ä¹Ÿå¾ˆç®€å•ã€‚ä½†æ˜¯ä¸è¦é«˜å…´çš„å¤ªæ—©ï¼Œä¸»è§’ä¸åœ¨è¿™ã€‚ çº¿ç¨‹ä¸å®‰å…¨ åœ¨ SimpleDateFormat ç±»çš„ JavaDoc ä¸­ï¼Œæè¿°äº†è¯¥ç±»ä¸èƒ½å¤Ÿä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå»ºè®®ä¸ºæ¯ä¸ªçº¿ç¨‹åˆ›å»ºå•ç‹¬çš„æ—¥æœŸï¼æ—¶é—´æ ¼å¼å®ä¾‹ï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ä¸€ä¸ªæ—¥æœŸï¼æ—¶é—´æ ¼å¼ï¼Œå®ƒå¿…é¡»åœ¨å¤–éƒ¨è¿›è¡ŒåŒæ­¥ã€‚é‚£ä¹ˆåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹è°ƒç”¨ format() å’Œ parse() æ–¹æ³•åº”è¯¥ä½¿ç”¨åŒæ­¥ä»£ç æ¥é¿å…é—®é¢˜ã€‚ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå…·ä½“çš„åœºæ™¯æ¥ä¸€æ­¥æ­¥çš„æ·±å…¥å­¦ä¹ å’Œç†è§£SimpleDateFormat ç±»ã€‚ 1ã€æ¯ä¸ªçº¿ç¨‹åˆ›å»ºå•ç‹¬çš„æ—¥æœŸï¼æ—¶é—´æ ¼å¼å®ä¾‹ å¤§é‡çš„åˆ›å»º SimpleDateFormat å®ä¾‹å¯¹è±¡ï¼Œç„¶åå†ä¸¢å¼ƒè¿™ä¸ªå¯¹è±¡ï¼Œå ç”¨å¤§é‡çš„å†…å­˜å’Œ JVM ç©ºé—´ã€‚ 2ã€åˆ›å»ºä¸€ä¸ªé™æ€çš„ SimpleDateFormat å®ä¾‹ï¼Œåœ¨ä½¿ç”¨æ—¶ç›´æ¥ä½¿ç”¨è¿™ä¸ªå®ä¾‹è¿›è¡Œæ“ä½œï¼ˆæˆ‘å½“æ—¶å°±æ˜¯è¿™ä¹ˆå¹²çš„ğŸ˜„ï¼‰ 123private static final SimpleDateFormat df = new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\");Date date = new Date();df.format(date); å½“ç„¶ï¼Œè¿™ä¸ªæ–¹æ³•çš„ç¡®å¾ˆä¸é”™ï¼Œåœ¨å¤§éƒ¨åˆ†çš„æ—¶é—´é‡Œé¢éƒ½ä¼šå·¥ä½œå¾—å¾ˆå¥½ï¼Œä½†ä¸€æ—¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä¸€å®šè´Ÿè½½æƒ…å†µä¸‹æ—¶ï¼Œè¿™ä¸ªé—®é¢˜å°±å‡ºæ¥äº†ã€‚ä»–ä¼šå‡ºç°å„ç§ä¸åŒçš„æƒ…å†µï¼Œæ¯”å¦‚è½¬åŒ–çš„æ—¶é—´ä¸æ­£ç¡®ï¼Œæ¯”å¦‚æŠ¥é”™ï¼Œæ¯”å¦‚çº¿ç¨‹è¢«æŒ‚æ­»ç­‰ç­‰ã€‚æˆ‘ä»¬çœ‹ä¸‹é¢çš„æµ‹è¯•ç”¨ä¾‹ï¼Œæ‹¿äº‹å®è¯´è¯ï¼š 1234567891011121314151617import java.text.ParseException;import java.text.SimpleDateFormat;import java.util.Date;/** * Created by zhisheng_tian on 2018/6/20 */public class DateUtils &#123; private static final SimpleDateFormat sdf = new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\"); public static String formatDate(Date date) throws ParseException &#123; return sdf.format(date); &#125; public static Date parse(String strDate) throws ParseException &#123; return sdf.parse(strDate); &#125;&#125; 12345678910111213141516171819202122232425262728import java.text.ParseException;/** * Created by zhisheng_tian on 2018/6/20 */public class DateUtilsTest &#123; public static class TestSimpleDateFormatThreadSafe extends Thread &#123; @Override public void run() &#123; while (true) &#123; try &#123; this.join(2000); &#125; catch (InterruptedException e1) &#123; e1.printStackTrace(); &#125; try &#123; System.out.println(this.getName() + \":\" + DateUtils.parse(\"2018-06-20 01:18:20\")); &#125; catch (ParseException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125; public static void main(String[] args) &#123; for (int i = 0; i &lt; 3; i++) &#123; new TestSimpleDateFormatThreadSafe().start(); &#125; &#125;&#125; è¿è¡Œç»“æœå¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526Exception in thread \"Thread-0\" Exception in thread \"Thread-1\" java.lang.NumberFormatException: For input string: \"\" at java.lang.NumberFormatException.forInputString(NumberFormatException.java:65) at java.lang.Long.parseLong(Long.java:601) at java.lang.Long.parseLong(Long.java:631) at java.text.DigitList.getLong(DigitList.java:195) at java.text.DecimalFormat.parse(DecimalFormat.java:2051) at java.text.SimpleDateFormat.subParse(SimpleDateFormat.java:1869) at java.text.SimpleDateFormat.parse(SimpleDateFormat.java:1514) at java.text.DateFormat.parse(DateFormat.java:364) at com.zhisheng.demo.date.DateUtils.parse(DateUtils.java:19) at com.zhisheng.demo.date.DateUtilsTest$TestSimpleDateFormatThreadSafe.run(DateUtilsTest.java:19)java.lang.NumberFormatException: For input string: \".1818\" at java.lang.NumberFormatException.forInputString(NumberFormatException.java:65) at java.lang.Long.parseLong(Long.java:578) at java.lang.Long.parseLong(Long.java:631) at java.text.DigitList.getLong(DigitList.java:195) at java.text.DecimalFormat.parse(DecimalFormat.java:2051) at java.text.SimpleDateFormat.subParse(SimpleDateFormat.java:2162) at java.text.SimpleDateFormat.parse(SimpleDateFormat.java:1514) at java.text.DateFormat.parse(DateFormat.java:364) at com.zhisheng.demo.date.DateUtils.parse(DateUtils.java:19) at com.zhisheng.demo.date.DateUtilsTest$TestSimpleDateFormatThreadSafe.run(DateUtilsTest.java:19)Thread-2:Sat Jun 20 01:18:20 CST 2201Thread-2:Wed Jun 20 01:18:20 CST 2018Thread-2:Wed Jun 20 01:18:20 CST 2018Thread-2:Wed Jun 20 01:18:20 CST 2018 è¯´æ˜ï¼šThread-1å’ŒThread-0æŠ¥java.lang.NumberFormatException: multiple pointsé”™è¯¯ï¼Œç›´æ¥æŒ‚æ­»ï¼Œæ²¡èµ·æ¥ï¼›Thread-2 è™½ç„¶æ²¡æœ‰æŒ‚æ­»ï¼Œä½†è¾“å‡ºçš„æ—¶é—´æ˜¯æœ‰é”™è¯¯çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬è¾“å…¥çš„æ—¶é—´æ˜¯ï¼š2018-06-20 01:18:20 ï¼Œå½“ä¼šè¾“å‡ºï¼šSat Jun 20 01:18:20 CST 2201 è¿™æ ·çš„çµå¼‚äº‹ä»¶ã€‚ Why?ä¸ºä»€ä¹ˆä¼šå‡ºç°çº¿ç¨‹ä¸å®‰å…¨çš„é—®é¢˜å‘¢ï¼Ÿ ä¸‹é¢æˆ‘ä»¬é€šè¿‡çœ‹ JDK æºç æ¥çœ‹çœ‹ä¸ºä»€ä¹ˆ SimpleDateFormat å’Œ DateFormat ç±»ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„çœŸæ­£åŸå› ï¼š SimpleDateFormat ç»§æ‰¿äº† DateFormatï¼Œåœ¨ DateFormat ä¸­å®šä¹‰äº†ä¸€ä¸ª protected å±æ€§çš„ Calendar ç±»çš„å¯¹è±¡ï¼šcalendarã€‚åªæ˜¯å› ä¸º Calendar ç±»çš„æ¦‚å¿µå¤æ‚ï¼Œç‰µæ‰¯åˆ°æ—¶åŒºä¸æœ¬åœ°åŒ–ç­‰ç­‰ï¼ŒJDK çš„å®ç°ä¸­ä½¿ç”¨äº†æˆå‘˜å˜é‡æ¥ä¼ é€’å‚æ•°ï¼Œè¿™å°±é€ æˆåœ¨å¤šçº¿ç¨‹çš„æ—¶å€™ä¼šå‡ºç°é”™è¯¯ã€‚ åœ¨ SimpleDateFormat ä¸­çš„ format æ–¹æ³•æºç ä¸­ï¼š 123456789101112131415161718192021222324252627282930313233@Overridepublic StringBuffer format(Date date, StringBuffer toAppendTo,FieldPosition pos) &#123; pos.beginIndex = pos.endIndex = 0; return format(date, toAppendTo, pos.getFieldDelegate());&#125;// Called from Format after creating a FieldDelegateprivate StringBuffer format(Date date, StringBuffer toAppendTo,FieldDelegate delegate) &#123; // Convert input date to time field list calendar.setTime(date); boolean useDateFormatSymbols = useDateFormatSymbols(); for (int i = 0; i &lt; compiledPattern.length; ) &#123; int tag = compiledPattern[i] &gt;&gt;&gt; 8; int count = compiledPattern[i++] &amp; 0xff; if (count == 255) &#123; count = compiledPattern[i++] &lt;&lt; 16; count |= compiledPattern[i++]; &#125; switch (tag) &#123; case TAG_QUOTE_ASCII_CHAR: toAppendTo.append((char)count); break; case TAG_QUOTE_CHARS: toAppendTo.append(compiledPattern, i, count); i += count; break; default: subFormat(tag, count, delegate, toAppendTo, useDateFormatSymbols); break; &#125; &#125; return toAppendTo;&#125; calendar.setTime(date) è¿™æ¡è¯­å¥æ”¹å˜äº† calendarï¼Œç¨åï¼Œcalendar è¿˜ä¼šç”¨åˆ°ï¼ˆåœ¨ subFormat æ–¹æ³•é‡Œï¼‰ï¼Œè€Œè¿™å°±æ˜¯å¼•å‘é—®é¢˜çš„æ ¹æºã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œåœ¨ä¸€ä¸ªå¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œæœ‰ä¸¤ä¸ªçº¿ç¨‹æŒæœ‰äº†åŒä¸€ä¸ª SimpleDateFormat çš„å®ä¾‹ï¼Œåˆ†åˆ«è°ƒç”¨format æ–¹æ³•ï¼š 12345çº¿ç¨‹ 1 è°ƒç”¨ format æ–¹æ³•ï¼Œæ”¹å˜äº† calendar è¿™ä¸ªå­—æ®µã€‚çº¿ç¨‹ 1 ä¸­æ–­äº†ã€‚çº¿ç¨‹ 2 å¼€å§‹æ‰§è¡Œï¼Œå®ƒä¹Ÿæ”¹å˜äº† calendarã€‚çº¿ç¨‹ 2 ä¸­æ–­äº†ã€‚çº¿ç¨‹ 1 å›æ¥äº† æ­¤æ—¶ï¼Œcalendar å·²ç„¶ä¸æ˜¯å®ƒæ‰€è®¾çš„å€¼ï¼Œè€Œæ˜¯èµ°ä¸Šäº†çº¿ç¨‹ 2 è®¾è®¡çš„é“è·¯ã€‚å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶äº‰æŠ¢ calendar å¯¹è±¡ï¼Œåˆ™ä¼šå‡ºç°å„ç§é—®é¢˜ï¼Œæ—¶é—´ä¸å¯¹ï¼Œçº¿ç¨‹æŒ‚æ­»ç­‰ç­‰ã€‚ åˆ†æä¸€ä¸‹ format çš„å®ç°ï¼Œæˆ‘ä»¬ä¸éš¾å‘ç°ï¼Œç”¨åˆ°æˆå‘˜å˜é‡ calendarï¼Œå”¯ä¸€çš„å¥½å¤„ï¼Œå°±æ˜¯åœ¨è°ƒç”¨ subFormat æ—¶ï¼Œå°‘äº†ä¸€ä¸ªå‚æ•°ï¼Œå´å¸¦æ¥äº†è®¸å¤šçš„é—®é¢˜ã€‚å…¶å®ï¼Œåªè¦åœ¨è¿™é‡Œç”¨ä¸€ä¸ªå±€éƒ¨å˜é‡ï¼Œä¸€è·¯ä¼ é€’ä¸‹å»ï¼Œæ‰€æœ‰é—®é¢˜éƒ½å°†è¿åˆƒè€Œè§£ã€‚ è¿™ä¸ªé—®é¢˜èƒŒåéšè—ç€ä¸€ä¸ªæ›´ä¸ºé‡è¦çš„é—®é¢˜â€“æ— çŠ¶æ€ï¼šæ— çŠ¶æ€æ–¹æ³•çš„å¥½å¤„ä¹‹ä¸€ï¼Œå°±æ˜¯å®ƒåœ¨å„ç§ç¯å¢ƒä¸‹ï¼Œéƒ½å¯ä»¥å®‰å…¨çš„è°ƒç”¨ã€‚è¡¡é‡ä¸€ä¸ªæ–¹æ³•æ˜¯å¦æ˜¯æœ‰çŠ¶æ€çš„ï¼Œå°±çœ‹å®ƒæ˜¯å¦æ”¹åŠ¨äº†å…¶å®ƒçš„ä¸œè¥¿ï¼Œæ¯”å¦‚å…¨å±€å˜é‡ï¼Œæ¯”å¦‚å®ä¾‹çš„å­—æ®µã€‚format æ–¹æ³•åœ¨è¿è¡Œè¿‡ç¨‹ä¸­æ”¹åŠ¨äº† SimpleDateFormat çš„ calendar å­—æ®µï¼Œæ‰€ä»¥ï¼Œå®ƒæ˜¯æœ‰çŠ¶æ€çš„ã€‚ è¿™ä¹ŸåŒæ—¶æé†’æˆ‘ä»¬åœ¨å¼€å‘å’Œè®¾è®¡ç³»ç»Ÿçš„æ—¶å€™æ³¨æ„ä¸‹ä¸€ä¸‹ä¸‰ç‚¹: 1.è‡ªå·±å†™å…¬ç”¨ç±»çš„æ—¶å€™ï¼Œè¦å¯¹å¤šçº¿ç¨‹è°ƒç”¨æƒ…å†µä¸‹çš„åæœåœ¨æ³¨é‡Šé‡Œè¿›è¡Œæ˜ç¡®è¯´æ˜ 2.å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå¯¹æ¯ä¸€ä¸ªå…±äº«çš„å¯å˜å˜é‡éƒ½è¦æ³¨æ„å…¶çº¿ç¨‹å®‰å…¨æ€§ 3.æˆ‘ä»¬çš„ç±»å’Œæ–¹æ³•åœ¨åšè®¾è®¡çš„æ—¶å€™ï¼Œè¦å°½é‡è®¾è®¡æˆæ— çŠ¶æ€çš„ è§£å†³æ–¹æ³•1ã€éœ€è¦çš„æ—¶å€™åˆ›å»ºæ–°å®ä¾‹ è¯´æ˜ï¼šåœ¨éœ€è¦ç”¨åˆ° SimpleDateFormat çš„åœ°æ–¹æ–°å»ºä¸€ä¸ªå®ä¾‹ï¼Œä¸ç®¡ä»€ä¹ˆæ—¶å€™ï¼Œå°†æœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜çš„å¯¹è±¡ç”±å…±äº«å˜ä¸ºå±€éƒ¨ç§æœ‰éƒ½èƒ½é¿å…å¤šçº¿ç¨‹é—®é¢˜ï¼Œä¸è¿‡ä¹ŸåŠ é‡äº†åˆ›å»ºå¯¹è±¡çš„è´Ÿæ‹…ã€‚åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¿™æ ·å…¶å®å¯¹æ€§èƒ½å½±å“æ¯”ä¸æ˜¯å¾ˆæ˜æ˜¾çš„ã€‚ 2ã€ä½¿ç”¨åŒæ­¥ï¼šåŒæ­¥ SimpleDateFormat å¯¹è±¡ 1234567891011121314151617181920import java.text.ParseException;import java.text.SimpleDateFormat;import java.util.Date;public class DateSyncUtil &#123; private static SimpleDateFormat sdf = new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\"); public static String formatDate(Date date) throws ParseException &#123; synchronized(sdf) &#123; return sdf.format(date); &#125; &#125; public static Date parse(String strDate) throws ParseException &#123; synchronized(sdf) &#123; return sdf.parse(strDate); &#125; &#125;&#125; è¯´æ˜ï¼šå½“çº¿ç¨‹è¾ƒå¤šæ—¶ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨è¯¥æ–¹æ³•æ—¶ï¼Œå…¶ä»–æƒ³è¦è°ƒç”¨æ­¤æ–¹æ³•çš„çº¿ç¨‹å°±è¦ block ç­‰å¾…ï¼Œå¤šçº¿ç¨‹å¹¶å‘é‡å¤§çš„æ—¶å€™ä¼šå¯¹æ€§èƒ½æœ‰ä¸€å®šçš„å½±å“ã€‚ 3ã€ä½¿ç”¨ ThreadLocal 12345678910111213141516171819202122import java.text.DateFormat;import java.text.ParseException;import java.text.SimpleDateFormat;import java.util.Date;public class ConcurrentDateUtil &#123; private static ThreadLocal&lt;DateFormat&gt; threadLocal = new ThreadLocal&lt;DateFormat&gt;() &#123; @Override protected DateFormat initialValue() &#123; return new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;); &#125; &#125;; public static Date parse(String dateStr) throws ParseException &#123; return threadLocal.get().parse(dateStr); &#125; public static String format(Date date) &#123; return threadLocal.get().format(date); &#125;&#125; è¯´æ˜ï¼šä½¿ç”¨ ThreadLocal, ä¹Ÿæ˜¯å°†å…±äº«å˜é‡å˜ä¸ºç‹¬äº«ï¼Œçº¿ç¨‹ç‹¬äº«è‚¯å®šèƒ½æ¯”æ–¹æ³•ç‹¬äº«åœ¨å¹¶å‘ç¯å¢ƒä¸­èƒ½å‡å°‘ä¸å°‘åˆ›å»ºå¯¹è±¡çš„å¼€é”€ã€‚å¦‚æœå¯¹æ€§èƒ½è¦æ±‚æ¯”è¾ƒé«˜çš„æƒ…å†µä¸‹ï¼Œä¸€èˆ¬æ¨èä½¿ç”¨è¿™ç§æ–¹æ³•ã€‚ Java 8 ä¸­çš„è§£å†³åŠæ³•Java 8 æä¾›äº†æ–°çš„æ—¥æœŸæ—¶é—´ APIï¼Œå…¶ä¸­åŒ…æ‹¬ç”¨äºæ—¥æœŸæ—¶é—´æ ¼å¼åŒ–çš„ DateTimeFormatterï¼Œå®ƒä¸ SimpleDateFormat æœ€å¤§çš„åŒºåˆ«åœ¨äºï¼šDateTimeFormatter æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè€Œ SimpleDateFormat å¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨ã€‚ DateTimeFormatter å¦‚ä½•ä½¿ç”¨ï¼š è§£ææ—¥æœŸ 123String dateStr= \"2018å¹´06æœˆ20æ—¥\";DateTimeFormatter formatter = DateTimeFormatter.ofPattern(\"yyyyå¹´MMæœˆddæ—¥\"); LocalDate date= LocalDate.parse(dateStr, formatter); æ—¥æœŸè½¬æ¢ä¸ºå­—ç¬¦ä¸² 123LocalDateTime now = LocalDateTime.now(); DateTimeFormatter format = DateTimeFormatter.ofPattern(\"yyyyå¹´MMæœˆddæ—¥ hh:mm a\");String nowStr = now .format(format); ç”± DateTimeFormatter çš„é™æ€æ–¹æ³• ofPattern() æ„å»ºæ—¥æœŸæ ¼å¼ï¼ŒLocalDateTime å’Œ LocalDate ç­‰ä¸€äº›è¡¨ç¤ºæ—¥æœŸæˆ–æ—¶é—´çš„ç±»ä½¿ç”¨ parse å’Œ format æ–¹æ³•æŠŠæ—¥æœŸå’Œå­—ç¬¦ä¸²åšè½¬æ¢ã€‚ ä½¿ç”¨æ–°çš„ APIï¼Œæ•´ä¸ªè½¬æ¢è¿‡ç¨‹éƒ½ä¸éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ã€‚ æ€»ç»“SimpleDateFormat æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ç±»ï¼Œå¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ³¨æ„çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå¦‚æœæ˜¯ Java 8 ï¼Œå»ºè®®ä½¿ç”¨ DateTimeFormatter ä»£æ›¿ SimpleDateFormatã€‚ å‚è€ƒèµ„æ–™http://www.cnblogs.com/peida/archive/2013/05/31/3070790.html ç›¸å…³æ–‡ç« 20 ä¸ªæ¡ˆä¾‹æ•™ä½ åœ¨ Java 8 ä¸­å¦‚ä½•å¤„ç†æ—¥æœŸå’Œæ—¶é—´?","tags":[{"name":"Java","slug":"Java","permalink":"http://www.54tianzhisheng.cn/tags/Java/"}]},{"title":"è‹¦é€¼çš„æ¯•ä¸šè®ºæ–‡ç»å†","date":"2018-05-25T16:00:00.000Z","path":"2018/05/26/paper/","text":"èƒŒæ™¯æœ€è¿‘ä¸€ç›´åœ¨å­¦æ ¡å¿™æ¯•ä¸šè®ºæ–‡çš„äº‹ï¼ŒæŠ±æ­‰äº†ï¼Œå¾ˆé•¿ä¸€æ®µæ—¶é—´æ²¡æ›´æ–°æ–‡ç« äº†ï¼Œä»Šå¤©æ˜ŸæœŸå…­ï¼Œæ˜¨å¤©æ˜ŸæœŸäº”ï¼Œå¹¸å¥½æ‰€æœ‰èµ„æ–™éƒ½åœ¨å‘¨æœ«å‰äº¤é½äº†ï¼Œæ˜¨æ™šè¿˜åˆ°å‚åŠ ç­ä¸Šçš„èšä¼šï¼Œä¹Ÿå–äº†ä¸å°‘é…’ï¼Œä½†å¹¸å¥½æ²¡é†‰ï¼Œä¸ç„¶ä»Šå¤©è‚¯å®šä¸ä¼šå†™ä¸‹è¿™ç¯‡æ–‡ç« çš„ã€‚è¿™ç¯‡æ–‡ç« å°±æŠŠä»æ¥è§¦åˆ°æ¯•ä¸šè®ºæ–‡æŒ‡å¯¼è€å¸ˆåˆ°ç°åœ¨çš„è¿™åŠå¹´æ—¶é—´æœ‰å…³æ¯•ä¸šè®ºæ–‡çš„äº‹éƒ½è®²è®²ï¼Œå¸Œæœ›èƒ½å¤Ÿç•™ä¸‹ç‚¹å›å¿†ï¼ æ¯•è®¾å°åˆ†é˜Ÿæˆç«‹å­¦æ ¡ä¼šç»™æ¯ä¸ªæ¯•ä¸šå¯¼å¸ˆå®‰æ’å¸¦å‡ ä¸ªå­¦ç”Ÿï¼ˆ7ï½8 äººå·¦å³ï¼‰ï¼Œä½†æ˜¯åœ¨å­¦æ ¡å‘å‡ºè¡¨æ ¼ä¹‹å‰ï¼Œè°ä¹Ÿä¸çŸ¥é“è‡ªå·±å°†ä¼šç”±å“ªä¸ªå¯¼å¸ˆå¸¦ï¼Œç”šè‡³ä½ ä¼šå‘ç°å°±ç®—å­¦æ ¡å‘å‡ºè¡¨æ ¼åçœ‹åˆ°è‡ªå·±å¯¼å¸ˆåå­—åï¼Œè‡ªå·±éƒ½ä¸çŸ¥é“è¿™å¯¼å¸ˆæ˜¯è°ï¼Ÿæ˜¯ç”·æ˜¯å¥³ï¼Ÿï¼ˆå½“æŸä¸ªå¯¼å¸ˆçš„åå­—æ¯”è¾ƒä¸­æ€§çš„æ—¶å€™ï¼‰åˆ°åº•å¥½ä¸å¥½ç›¸å¤„ï¼Ÿæ€§æ ¼å’‹æ ·ï¼Ÿä»–çš„è”ç³»æ–¹å¼ï¼ˆæ‰‹æœº æˆ–è€… QQï¼‰ï¼ŒWTFï¼Œä¸€ä¸ªéƒ½ä¸çŸ¥é“ï¼Ÿè‹¦é€¼äº†ï¼Œåé¢ä¹Ÿæ˜¯é€šè¿‡é—®è¾…å¯¼å‘˜æ‰çŸ¥é“è¿™äº›æƒ…å†µã€‚åé¢æˆ‘ä»¬å‡ ä¸ªäººä¸­å°±æœ‰ä¸€ä¸ªå¸¦å¤´å»ºäº†ä¸ª QQ ç¾¤ï¼ˆæ¯•è®¾å°åˆ†é˜Ÿï¼‰ï¼Œå¹¶æŠŠæŒ‡å¯¼è€å¸ˆæ‹‰è¿›ç¾¤äº†ã€‚ å°±è¿™æ ·ï¼Œæˆ‘ä»¬ç»ˆäºå¼€å§‹äº†æ¯•è®¾å°åˆ†é˜Ÿä¹‹æ—…ï¼ å®ä¹ æ—¶çš„æ¯•è®¾çŠ¶æ€2017.12æœˆé‚£æ—¶æ˜¯è¿˜åœ¨å…¬å¸å®ä¹ çš„ï¼Œåˆ°äº†æ¯•ä¸šè®¾è®¡é€‰é¢˜çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯¼å¸ˆè¿˜å¥½ï¼Œç»™æˆ‘ä»¬æ¯ä¸ªäººå¾ˆè‡ªç”±çš„é€‰æ‹©ï¼Œä½ å¯ä»¥è‡ªæ‹Ÿé¢˜ç›®ï¼Œä¹Ÿå¯ä»¥ä»å¯¼å¸ˆé‚£é‡ŒæŒ‘é€‰é¢˜ç›®ã€‚ä¸è¿‡æˆ‘çœ‹äº†ä¸‹è€å¸ˆç»™çš„é¢˜ç›®ï¼Œå¤§éƒ½æ˜¯æ·±åº¦å­¦ä¹ ã€æœºå™¨å­¦ä¹ åšçš„ç›¸å…³å›¾åƒè¯†åˆ«ã€æ¨èç³»ç»Ÿã€æœç´¢ç³»ç»Ÿã€äººè„¸è¯†åˆ«ã€ç½‘ç»œæµé‡ç›‘æ§ã€æ–‡æœ¬æƒ…æ„Ÿåˆ†æç­‰é«˜å¤§ä¸Šçš„è¯¾é¢˜ã€‚è‡£å¦¾åšä¸åˆ°ï¼Œæ¯•ç«Ÿè¿™éƒ½æ˜¯ç ”ç©¶ç”Ÿæ‰ä¼šç ”ç©¶ç‚¹æ–¹å‘ï¼Œè€å¸ˆä¼šå‘å‡ºæ¥è¿™äº›é¢˜ç›®å¯èƒ½ä¹Ÿæ˜¯å’Œå¥¹è‡ªå·±åœ¨ç ”ç©¶å­¦ä¹ çš„ç›¸å…³çŸ¥è¯†æœ‰å…³ï¼ˆå› ä¸ºæˆ‘åæ¥ç»™å¯¼å¸ˆæ£€æŸ¥æˆ‘çš„ç³»ç»Ÿçš„æ—¶å€™å°±æ˜¯å¯¼å¸ˆå¸¦çš„ä¸€ä¸ªç ”ç©¶ç”Ÿæ£€æŸ¥çš„ï¼ŒæœŸé—´é‚£ä¸ªå­¦é•¿å’Œæˆ‘è¯´ä»–æœ€è¿‘å°±åœ¨åšæ–‡æœ¬æƒ…æ„Ÿåˆ†æç›¸å…³çš„ä¸€ä¸ªé¡¹ç›®ï¼Œå› ä¸ºçœ‹åˆ°æˆ‘é¡¹ç›®ä¸­çš„ä¸­æ–‡åˆ†è¯å™¨ï¼Œæ‰€ä»¥è¿˜å‘æˆ‘è¯·æ•™äº†ä¸‹ï¼Œæˆ‘äºæ˜¯æŠŠæˆ‘åŸæ¥å†™è¿‡çš„ä¸€ç¯‡ä¸­è‹±æ–‡åˆ†è¯å™¨æ‰¾å‡ºæ¥ç»™ä»–ä¸€ä¸ªä¸ªè§£é‡Šï¼‰ï¼Œæ‰€ä»¥å¯¼å¸ˆå¸Œæœ›åœ¨æˆ‘ä»¬è¿™é‡Œä¹Ÿèƒ½å¤Ÿæœ‰äººå»ç ”ç©¶ä¸‹è¿™æ–¹é¢çš„çŸ¥è¯†ï¼Œæ‹“å±•ä¸‹è§†é‡ã€‚ä½†æ˜¯ç”±äºåœ¨å…¬å¸å®ä¹ ï¼Œå·¥ä½œä¹‹å¤–è…¾å‡ºçš„æ—¶é—´ç¡®å®æœ‰é™ï¼Œæ²¡è¿™ä¹ˆå¤šæ—¶é—´å»å­¦ä¹ è¿™äº›ç‰¹åˆ«æ–°çš„ä¸œè¥¿ï¼Œè€Œä¸”è¿˜è¦åšå‡ºä¸€å®šçš„æˆæœå‡ºæ¥ï¼Œè¿™è¿˜æ˜¯æœ‰ç‚¹æŒ‘æˆ˜æ€§çš„ã€‚å¯¼å¸ˆè¯´ä½ å¯ä»¥è‡ªæ‹Ÿé¢˜ç›®ï¼Œæˆ–è€…æŠŠè‡ªå·±åœ¨å…¬å¸åšçš„é¡¹ç›®ä¼˜åŒ–åæ‹¿æ¥åšæ¯•è®¾é¡¹ç›®ã€‚äºæ˜¯ï¼Œæˆ‘é€‰æ‹©çš„æ˜¯æ‹¿è‡ªå·±ä»¥å‰å†™çš„é¡¹ç›®æ¥å½“æ¯•ä¸šè®ºæ–‡é¡¹ç›®äº†ï¼Œå› ä¸ºæ„Ÿè§‰é¡¹ç›®ä¹Ÿè¿˜è¡Œï¼Œæ‹¿æ¥åšæ¯•è®¾å®Œå…¨å¯ä»¥äº†ï¼Œæ‰€ä»¥åé¢è‡ªå·±ä¹Ÿå°±æ¯”è¾ƒè½»æ¾äº†ã€‚ æ¯•è®¾æµç¨‹æŠŠè‡ªå·±çš„æ¯•è®¾é¢˜ç›®æŠ¥ç»™è€å¸ˆåï¼Œè€å¸ˆä¼šæ ¹æ®ä½ çš„é¢˜ç›®å®¡æ ¸æ˜¯å¦å¯ä»¥æ‹¿æ¥å½“æ¯•è®¾ã€‚ç„¶åå†è¦æ±‚ä½ æŠŠæ¯•ä¸šè®¾è®¡çš„å¼€é¢˜æŠ¥å‘Šä¹¦ï¼ˆè®ºæ–‡é¢˜ç›®ã€ç›®çš„ã€æ„ä¹‰ã€æ€ä¹ˆåšã€åšå‡ºä»€ä¹ˆæ•ˆæœã€ç›®æ ‡ä¹‹ç±»çš„ï¼‰å†™è¯¦ç»†ä¸Šäº¤ä¸Šå»ã€‚è¦ç»è¿‡å¯¼å¸ˆå’Œå­¦æ ¡çš„å®¡æ‰¹åæ‰èƒ½å¤Ÿæ­£å¼å¼€é¢˜ã€‚å¼€é¢˜åç¡®å®šåå‡ ä¹å°±å¯ä»¥å¼€å§‹å†™è‡ªå·±çš„é¡¹ç›®äº†ã€‚æœºæ™ºçš„æˆ‘ï¼Œé‚£æ—¶æ¯”è¾ƒè½»æ¾ï¼Œå“ˆå“ˆå“ˆï¼Œå·¥ä½œä¹‹å¤–éƒ½æ’¸ä»£ç å’Œåšå®¢å‘¢ã€‚å·®ä¸å¤šè¿‡äº†ä¸€ä¸ªæœˆåï¼Œå¯¼å¸ˆå°±å¼€å§‹åœ¨ç¾¤é‡Œé—®æˆ‘ä»¬ç³»ç»Ÿå®Œæˆçš„æ€ä¹ˆæ ·äº†ï¼Ÿç„¶åè¦æˆ‘ä»¬ä¸Šäº¤è®ºæ–‡ä»»åŠ¡ä¹¦ï¼Œå­¦æ ¡çš„è¿™ç§ææ–™æœ‰æ—¶å€™è¦çš„å¾ˆæ€¥ï¼Œä¸å¾—ä¸åæ§½ä¸‹ï¼Œå¾ˆå¤´ç–¼ï¼Œè‡ªå·±æœ‰æ—¶å€™éƒ½ä¸€ä¸‹å­äº¤ä¸äº†ã€‚åˆè¿‡äº†ä¸€æ®µæ—¶é—´å°±éœ€è¦æŠŠè®ºæ–‡åˆç¨¿äº¤ä¸Šå»ï¼ŒçœŸæ˜¯è‹¦é€¼ï¼Œé‚£æ—¶è¿˜ä¸çŸ¥é“è®ºæ–‡çš„æ¨¡ç‰ˆåˆ°åº•æ˜¯å’‹æ ·ï¼Ÿè¯¥æ€ä¹ˆå†™æœ¬ç§‘è®ºæ–‡å‘¢ï¼Ÿæå¾—æˆ‘è‡ªå·±é‚£æ®µæ—¶é—´èŠ±äº†å‘¨æœ«ä¸¤å¤©å’Œä¸€å¤©çš„ä¸Šç­çš„æ—¶é—´æ‰å‹‰å¼ºäº¤äº†ä¸ªä¸€èˆ¬çš„åˆç¨¿ï¼Œåˆç¨¿ä¸­çš„å„ç§å›¾ç”»çš„æˆ‘æ˜¯æƒ³å“­ã€‚çœŸå¤šï¼Œè¿˜éº»çƒ¦ã€‚å¹¸å¥½åœ¨é‚£æ®µæ—¶é—´å…¬å¸çš„ä»»åŠ¡è¿˜ä¸å¿™ï¼Œæ‰€ä»¥åœ¨æœ‰æ—¶é—´åœ¨å®ä¹ ä¸Šç­çš„æ—¶å€™ä¹Ÿç¨å¾®å®Œæˆä¸‹è‡ªå·±çš„åˆç¨¿ã€‚ ä»Šå¹´ 3 ï½ 4 æœˆçš„æ—¶å€™ï¼Œå¯¼å¸ˆä¹Ÿåœ¨ä¸æ–­çš„å«æˆ‘ä»¬æŠŠå­¦æ ¡è¯¥äº¤çš„å®ä¹ æ¯å‘¨æŠ¥å‘Šäº¤ç»™å¥¹ã€‚è¿™ä¸ªå®ä¹ è¿˜æœ‰å®ä¹ ç”³è¯·è¡¨ã€å®ä¹ é‰´å®šè¡¨ææ–™ï¼ˆè¦æ±‚ç›–ç« ï¼‰ï¼Œè¿™ä¸¤ä¸ªèµ„æ–™ä¹Ÿæ˜¯å¾ˆé‡è¦çš„ï¼Œå¦‚æœåé¢æ²¡æœ‰è¿™ä¸ªææ–™éƒ½ä¸èƒ½å‚åŠ ç­”è¾©çš„ã€‚ åœ¨å¿«äº”æœˆçš„æ—¶å€™ï¼Œå¯¼å¸ˆé‚£æ—¶å°±å¤©å¤©æ™šä¸Šæ·±å¤œåœ¨æ¯•è®¾å°åˆ†é˜Ÿç¾¤é‡Œå‚¬åŒå­¦ä»¬ï¼Œä½ ä»¬çš„è®ºæ–‡å’Œç³»ç»Ÿéƒ½å®Œæˆçš„å’‹æ ·äº†ï¼Ÿç„¶ååˆå‚¬äº†è¦äº¤è®ºæ–‡ä¸­æœŸæŠ¥å‘Šï¼ˆè¿™ä¸ªåº”è¯¥ä¹Ÿè›®é‡è¦çš„ï¼Œæˆ‘ä»¬ç­ä¸¤ä¸ªåŒå­¦å¥½åƒå°±å› ä¸ºè¿™ä¸ªå¯¼è‡´æœ‰ä¸ªè®ºæ–‡ä¸­æœŸæŠ¥å‘Šè­¦å‘Šï¼Œå“å¾—ä»–ä»¬åæ¥ç­”è¾©çš„æ—¶å€™éƒ½æ€•è‡ªå·±æŒ‚äº†ï¼‰ã€‚ è¿‡å®ŒåŠ³åŠ¨èŠ‚åï¼Œå†è¿‡äº†å‡ å¤©åï¼Œæˆ‘å°±è¾èŒäº†ã€‚è¾èŒååœ¨è‹å·ç©äº†å‡ å¤©ï¼ŒæœŸé—´ä¹Ÿæ˜¯åœ¨ä¸æ–­çš„ä¿®æ”¹è‡ªå·±çš„è®ºæ–‡å’Œä¼˜åŒ–äº›æ ¼å¼é—®é¢˜ã€‚ åæ¥åˆæµªå›å®¶äº†ï¼Œåœ¨å®¶å‘†äº†å‡ å¤©ï¼Œä¹Ÿæ˜¯æ”¹è®ºæ–‡æ”¹åˆ°æ·±å¤œï¼Œé‚£æ®µæ—¶é—´è‡ªå·±å·²ç»å¼€å§‹åœ¨æŠŠè‡ªå·±çš„è®ºæ–‡åˆç¨¿æ‹¿åˆ°äº›ç¬¬ä¸‰æ–¹å…è´¹çš„æŸ¥é‡å»æŸ¥é‡ç½‘ç«™å»æŸ¥é‡ï¼Œç„¶åæ ¹æ®æŸ¥é‡åçš„ç»“æœï¼Œå°†ä¸€äº›é‡å¤çš„åœ°æ–¹ä¸œæ”¹æ”¹ï¼Œè¥¿å‡‘å‡‘ï¼Œæˆ–è€…ç”¨è‡ªå·±çš„è¯å†™ä¸€éã€‚è¿™æ ·å°±å¯ä»¥å‡å°‘ç‚¹é‡å¤è¯­å¥ã€‚ å†ç„¶åå°±æ˜¯ 18 å·èµ¶å›æ¥å­¦æ ¡äº†ï¼Œ19ï¼Œ20å·åˆšå¥½å‘¨æœ«ï¼Œåˆæ˜¯ä¸çœ ä¹‹å¤œï¼Œé‚£ä¸¤å¤©ä¸æ–­æŸ¥é‡ï¼Œå‘åˆ«äººè¯·æ•™ï¼Œæ€ä¹ˆåŠ å­—æ•°ï¼Œè‡ªå·±ä¸€å¼€å§‹çš„å­—æ•°å¥½åƒè¿˜æ˜¯ä¸å¤Ÿçš„ï¼Œå­¦æ ¡è¦æ±‚çš„å­—æ•°æœ‰ç‚¹é«˜ï¼Œå…¶ä»–å­¦æ ¡éƒ½æ˜¯ 8000 å­—ï¼Œæˆ‘ä»¬å´è¦æ±‚ 1.5 wï¼ŒçœŸæ˜¯èƒ½æ‰¯å•Šï¼Œæ€ä¹ˆå¯ä»¥æ‰¯å‡ºè¿™ä¹ˆå¤šå­—æ¥ã€‚é€šè¿‡æŸäººçš„ç»éªŒä¹‹è°ˆï¼Œæˆ‘æˆåŠŸçš„æ‰¯äº†ä¸å°‘å­—ï¼Œè¿˜ä¸å¸¦é‡å¤çš„ï¼ŒğŸ˜„ã€‚ ç„¶å 21 å·å‘¨ä¸€æ‹¿ç»™è€å¸ˆæ£€æŸ¥çš„æ—¶å€™å°±æ˜¯çœ‹äº†ä¸‹æ ¼å¼ï¼ˆè€å¸ˆä¸åœ¨åŠå…¬å®¤ï¼Œå¥¹å¸¦çš„ç ”ç©¶ç”Ÿç»™æ£€æŸ¥çš„ï¼‰ï¼Œè¯´ä½ å…¨æ–‡é¦–è¡Œå’‹éƒ½æ²¡ç¼©è¿›å‘¢ï¼ˆå†™åšå®¢å†™ä¹ æƒ¯äº†ï¼Œè°è¿˜ç¼©è¿›å•Šï¼‰ï¼Œè¡Œé—´è·æ¯”è¾ƒå¤§ï¼Œå›¾çš„æ ‡å·é”™è¯¯ï¼Œä¸»è¦è¿˜æ˜¯æ£€æŸ¥æ ¼å¼ã€‚å½“æ™šï¼Œåˆå¥½å¥½æ”¹äº†ä¸‹ï¼Œå¹¶å’Œæˆ‘åŒå­¦è®¨è®ºäº†ä¸‹ä»–çš„æŒ‡å¯¼å¯¼å¸ˆçš„è¦æ±‚æœ‰å“ªäº›ï¼Œå¹¶ä¹Ÿåšäº†ç›¸åº”çš„ä¿®æ”¹ã€‚ï¼ˆå› ä¸ºæˆ‘çš„ç­”è¾©å¯¼å¸ˆå°±æœ‰æˆ‘é‚£åŒå­¦çš„æŒ‡å¯¼è€å¸ˆï¼‰è®°å¾—å½“æ™šå¥½åƒæ”¹è®ºæ–‡æ”¹åˆ°ä¸‰ç‚¹ï¼Œå¹¸å¥½æœ‰äººé™ªç€æˆ‘ä¸€è¾¹èŠå¤©ä¸€è¾¹æ”¹ï¼Œä¸ç„¶æ—©å›°äº†ï¼Œç¡äº†ã€‚ 22 å·ä¸€æ—©å°±é†’æ¥äº†ï¼Œç„¶åå°±å»æ‰“å°åº—æ‰“å°è®ºæ–‡ã€‚è¿™é‡Œæƒ³ç»™çš„å¤§å®¶ä¸€ä¸ªå»ºè®®å°±æ˜¯ï¼šå¦‚æœä½ ä¹Ÿè¦æ‰“å°è®ºæ–‡ï¼Œæœ€å¥½æ—©ç‚¹å»ï¼Œå› ä¸ºæ¯•ä¸šå­£ï¼Œå­¦æ ¡æ‰“å°åº—å‡ ä¹éƒ½æ˜¯çˆ†æ»¡ï¼Œæ‰“å°è®ºæ–‡çš„éå¸¸å¤šï¼Œè¿˜æœ‰å­¦å¼Ÿå­¦å¦¹æ‰“å°å„ç§è€ƒè¯•å·å­ã€èµ„æ–™å•¥çš„ï¼Œåæ­£äººå¾ˆå¤šï¼Œä¼°è®¡è¦æ’é˜Ÿã€‚æŒ‡å¯¼è€å¸ˆä¹Ÿä¸æ˜¯ä¸€ç›´åœ¨åŠå…¬å®¤çš„ï¼Œä»–ä»¬ä¹Ÿæ˜¯è¦ä¸Šè¯¾çš„ã€‚æ‰€ä»¥æœ€å¥½åœ¨å¯¼å¸ˆåœ¨åŠå…¬å®¤çš„æ—¶å€™èƒ½èµ¶åˆ°ï¼Œè¿™æ ·å°±ä¸ä¼šé”™è¿‡äº†ã€‚è¿™æ¬¡è€å¸ˆæ£€æŸ¥è®ºæ–‡å°±æ¯”è¾ƒä»”ç»†äº†ï¼Œè®ºæ–‡ä¸€è¡Œè¡Œçš„æ‰¾å†…å®¹ï¼Œçœ‹æ˜¯å¦é€šé¡ºï¼Ÿæ˜¯å¦æœ‰ä¸åˆé€‚çš„åœ°æ–¹ï¼Ÿæ ‡ç‚¹ç¬¦å·æ˜¯ä¸æ˜¯å¤šäº†æˆ–è€…å°‘äº†ï¼Ÿæ ¼å¼æ˜¯ä¸æ˜¯è¿˜æœ‰é—®é¢˜ï¼Ÿæ‰€ä»¥å‘¢ï¼Œè¿™æ¬¡åˆå¾ˆæƒ¨ï¼Œè¦æ”¹çš„åœ°æ–¹å¾ˆå¤šï¼Œè¿˜åŒ…æ‹¬æµç¨‹å›¾å’Œ E-R å›¾è¦æ”¹çš„ã€‚è‹¦é€¼äº†ï¼Œä¸‹åˆå›å»ç§Ÿæˆ¿å®¾é¦†çš„æ—¶å€™å°±å¼€å§‹æ‹¼å‘½çš„æ”¹ã€‚æ”¹çš„å·®ä¸å¤šäº†ï¼Œå› ä¸ºç¬¬äºŒå¤©è¦ç­”è¾©äº†ï¼Œæ‰€ä»¥å°±åœ¨çœ‹çœ‹è‡ªå·±çš„ç³»ç»Ÿæ˜¯å¦èƒ½å¤Ÿè·‘èµ·æ¥ï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆbugï¼Œç»“æœè¿˜çœŸå‘ç°å‡ ä¸ªå°é”™è¯¯å’Œä¸€ä¸ªå¤§é”™è¯¯ï¼Œå°é”™è¯¯å¾ˆå¿«ä¿®å¤å®Œå–„äº†ï¼Œæœ‰ä¸€ä¸ª Redis å­˜æ•°æ®å†å–å‡ºæ¥çš„æ—¶å€™æ•°æ®å˜åŒ–é—®é¢˜å½“ç„¶debugäº†å¾ˆä¹…æ²¡æ‰¾åˆ°åŸå› ã€‚æ‰¾åˆ°æ·±å¤œä¸€ç‚¹å¤šï¼Œæ²¡è§£å†³ï¼Œæ”¾å¼ƒäº†ï¼Œç¬¬äºŒå¤©ä¸æ¼”ç¤ºè¿™å—ã€‚å½“æ™šæ€•è‡ªå·±æ˜å¤©é¡¹ç›®å¯åŠ¨çš„æ—¶å€™å…¶ä»–ç¯å¢ƒè¦ä¸€ä¸ªä¸ªèµ·ï¼Œéœ€è¦è€—è´¹ä¸å°‘æ—¶é—´ï¼Œäºæ˜¯è‡ªå·±ç®€å•çš„å†™äº†ä¸ªè„šæœ¬ï¼Œä¸€é”®å°†è‡ªå·±é¡¹ç›®çš„ç¯å¢ƒå¯åŠ¨èµ·æ¥ï¼Œè¿™æ ·å°±å¯ä»¥ç›´æ¥è¿è¡Œé¡¹ç›®å±•ç¤ºç»™ç­”è¾©è€å¸ˆï¼ŒèŠ‚çœæ—¶é—´ï¼Œå°¤å…¶æ˜¯å…³é”®åœºåˆï¼Œæ€•æ‰é“¾å­ã€‚ 23 å·æ—©ä¸Šå¾ˆæ—©å°±å»æŠŠè‡ªå·±çš„å®ä¹ ç”³è¯·è¡¨ã€å®ä¹ é‰´å®šè¡¨ã€å®ä¹  20 å‘¨æ—¥å¿—ã€å®ä¹ ç»ˆç»“ã€è®ºæ–‡åˆç¨¿è¿™äº›èµ„æ–™æ‰“å°ï¼Œç„¶åæ‹¿ç»™å¯¼å¸ˆæŸ¥çœ‹å’Œæ‰“åˆ†ã€‚ï¼ˆåˆæ‰¾å‡ºé—®é¢˜æ¥äº†ï¼Œè‹¦é€¼ï¼Œè®°å¾—é‚£ä¸ªæ—©ä¸Šç°åœºåœ¨å¯¼å¸ˆåŠå…¬å®¤ç”¨ç”µè„‘æ”¹å¥½åï¼Œæ£€æŸ¥å®Œæ‰æ‹¿å»æ‰“å°å†æ‹¿å›æ¥ç»™å¯¼å¸ˆæ£€æŸ¥çš„ï¼Œæ¥å›è·‘æ¥è·‘å»çš„çœŸçš„å¾ˆæ€¥ï¼Œå‡ºäº†ä¸å°‘æ±—ï¼‰æ³¨æ„ï¼šè¶Šæ˜¯å…³é”®æ—¶åˆ»ï¼Œåƒä¸‡è¦é¡ºç€å¯¼å¸ˆæ¥ï¼Œä»–è¯´æ”¹å“ªé‡Œå°±æ”¹å“ªé‡Œï¼Œåƒä¸‡åˆ«åˆšï¼Œæˆ‘ä¸€ä¸ªåŒå­¦çš„è®ºæ–‡æ”¹çš„å¯¼å¸ˆéƒ½å‘ç«äº†ï¼Œå·®ç‚¹æ²¡è®©æˆ‘é‚£åŒå­¦å‚åŠ ç­”è¾©ï¼Œç›´æ¥è¿›å…¥äºŒè¾©çš„ã€‚ ç­”è¾©çš„æ—¶å€™å…ˆæ¯ä¸ªäººä»‹ç»ä¸‹è‡ªå·±çš„å®ä¹ ç»å†ï¼Œå¬åˆ°ä¸å°‘ç‰›é€¼çš„åŒå­¦ï¼Œè¿›äº†ä¸å°‘å‰å®³çš„å…¬å¸ï¼Œæœ‰çš„åŒå­¦è¿˜å½“ä¸Šäº†å…¬å¸çš„é¡¹ç›®ç»„ç»„é•¿äº†ï¼ŒçœŸå‰å®³ï¼Œä¸€å¹´çš„å®ä¹ æ—¶é—´å°±æ··çš„è¿™ä¹ˆå¥½äº†ã€‚ç¬é—´å‘ç°å·®è·å¾ˆå¤§ã€‚ ç„¶åå°±æ˜¯æ¯ä¸ªäººçš„ç­”è¾©äº†ï¼Œæˆ‘ç¬¬ä¸‰ä¸ªï¼Œè¿˜å¥½ï¼Œç­”è¾©çš„è¿‡ç¨‹é—®äº†æˆ‘çš„é—®é¢˜å’Œæ¼”ç¤ºç³»ç»Ÿçš„æ—¶å€™éƒ½è¡¨ç°çš„è›®å¥½çš„ã€‚å°±ç°åœºè¿˜é—®äº†æˆ‘æœ‰ä¸ªåŠŸèƒ½çš„ä»£ç æ˜¯å“ªï¼Ÿï¼ˆä¼°è®¡æ˜¯æƒ³çœ‹ä¸‹æ˜¯ä¸æ˜¯è‡ªå·±å†™çš„é¡¹ç›®ï¼‰åé¢ä¹Ÿçœ‹åˆ°æœ‰çš„åŒå­¦é¡¹ç›®ç«Ÿç„¶èµ·ä¸æ¥çš„ï¼Œæˆ–è€…å›ç­”ä¸å‡ºè€å¸ˆçš„é—®é¢˜çš„ã€‚ç­”è¾©è¿‡ç¨‹ä¸­ï¼Œç­”è¾©è€å¸ˆåˆç»™è®ºæ–‡æ‰¾äº†ä¸å°‘é—®é¢˜ï¼Œåˆè¦è‹¦é€¼çš„ä¿®æ”¹äº†ã€‚ å½“å¤©å°±å‡ºäº†å¾…å®šåå•å’Œè¦äºŒè¾©çš„åå•ï¼Œé€Ÿåº¦è¿˜æ˜¯å¾ˆå¿«ã€‚è¿˜å¥½æˆ‘æ²¡æœ‰ï¼Œå¼€æ£®ã€‚æœ¬ä»¥ä¸ºç­”è¾©å¥½äº†ï¼Œå°±å¯ä»¥æ¾ä¸‹ä¸€å£æ°”äº†ï¼Œåé¢æ”¹å¥½äº†è®ºæ–‡åæ‹¿å»ç»™å¯¼å¸ˆæ£€æŸ¥ï¼Œå¥¹éƒ½è¯´ OK äº†ï¼Œç»“æœæˆ‘å°±å»æŠŠè®ºæ–‡æ‹¿å»èƒ¶è£…äº†ï¼Œæ³¨æ„èƒ¶è£…é¡ºåºåˆ«æé”™äº†ã€‚ç¬¬äºŒå¤©æŠŠèƒ¶è£…å¥½çš„è®ºæ–‡å’Œå„ç§èµ„æ–™ä¸€èµ·äº¤ç»™è€å¸ˆçš„æ—¶å€™ï¼Œç»“æœåˆæŒ‘å‡ºä¸€ä¸ªç›®å½•çš„é—®é¢˜ï¼ŒWTFï¼Œæå¾—æˆ‘åé¢æ”¹å¥½åå»æ‰“å°åº—é‡æ–°èƒ¶è£…äº†éï¼ˆå°çš®ä»åŸæ¥çš„ä¸Šé¢æ‰¯ä¸‹æ¥èƒ¶è£…ï¼‰ã€‚æ˜¨å¤©ç­¾å®Œå­—äº†ï¼ŒæŠŠè®ºæ–‡çš„åˆç¨¿ã€ç»ˆç¨¿ã€ç­”è¾©è®°å½•ã€å®ä¹ ææ–™ç­‰ææ–™ä¸€èµ·è£…è¿›æ¡£æ¡ˆè¢‹äº†ï¼Œè¿™æ‰å®‰å¿ƒäº†ã€‚ äºæ˜¯å½“æ™šå°±å»å‚åŠ äº†ç­ä¸Šçš„æ¯•ä¸šèšä¼šã€‚ æ„Ÿå—è¿™æ®µæ—¶é—´çœŸçš„æ˜¯å¾ˆç´¯ï¼Œæ¯å¤©ç†¬å¤œåˆ°å¾ˆæ™šï¼Œç¬¬äºŒå¤©æ—©ä¸Šå¾ˆæ—©å°±è‡ªç„¶é†’äº†ã€‚ç˜¦äº†ä¸å°‘ï¼Œç‰›ä»”è£¤çš„çš®å¸¦æˆ‘æ„Ÿè§‰éƒ½ç¼©äº†ä¸€åœˆï¼Œå³æ‰‹çš„å‡ ä¸ªæ‰‹æŒ‡å¤©å¤©åœ¨ç”µè„‘çš„è§¦æ‘¸æ¿ä¸Šæ»‘æ¥æ»‘å»çš„ï¼Œéƒ½è„±äº†ä¸€å±‚çš®äº†ï¼Œç°åœ¨æ”¾ä¸Šå»éƒ½æœ‰ç‚¹ç—›ï¼Œæ‰“å°è®ºæ–‡å¥½åƒæ‰“å°äº†7ä»½ï¼Œçƒ§é’±å•Šã€‚å‘ç°æˆ‘çš„è®°å¿†è¿˜æ˜¯å¯ä»¥çš„ï¼Œè¿™ä¹ˆå¤šäº‹ç«Ÿç„¶è¿˜èƒ½è®°å¾—ï¼Œæå¾—æ•´ç¯‡æ–‡ç« æœ‰ç‚¹åƒåœ¨è®°æµæ°´è´¦ï¼Œå“ˆå“ˆå“ˆã€‚åæ­£ä¹Ÿæ˜¯è®°å½•ä¸‹è‡ªå·±çš„è®ºæ–‡ç­”è¾©è¿™æ®µæ—¶é—´çš„ç»å†ã€‚è®ºæ–‡çš„æ ¼å¼å¾ˆé‡è¦ï¼Œä¸å†åƒå†™åšå®¢é‚£æ ·éšæ„ï¼Œè®ºæ–‡æ˜¯éœ€è¦ä»¥ä¸€ç§ä¸¥è°¨çš„æ€åº¦å»å¯¹å¾…çš„ã€‚ å†™ç€å†™ç€å¿˜äº†è¯´è®ºæ–‡çš„æŸ¥é‡äº†ã€‚ä¸€èˆ¬ä½ ä¸€å¼€å§‹æœ€å¥½å…ˆç”¨ç¬¬ä¸‰æ–¹çš„å…è´¹æŸ¥é‡ä¸‹ï¼Œç„¶åä¿®æ”¹ã€‚ æˆ‘å½“æ—¶ç”¨çš„æ˜¯ï¼šhttp://xueshu.baidu.com/usercenter/papercheck/ è¿™ä¸ªåœ°æ–¹æœ‰å‡ ä¸ªæ˜¯å¯ä»¥ç¬¬ä¸€æ¬¡å…è´¹æŸ¥é‡çš„ï¼Œå¦‚æœæ¬¡æ•°ç”¨å®Œäº†ï¼Œè®°å¾—æ¢ä¸ªç™¾åº¦è´¦å·å°±åˆæœ‰å¥½äº›æ¬¡æŸ¥é‡çš„æœºä¼šã€‚å¦‚æœä½ å®åœ¨æ˜¯ä¸æ”¾å¿ƒï¼Œå¯ä»¥å»å­¦æ ¡çš„æ‰“å°åº—é—®ä¸‹æ˜¯å¦æœ‰è®ºæ–‡æŸ¥é‡çš„ï¼Œä¹Ÿæ˜¯æŸ¥çš„çŸ¥ç½‘çš„åº“ï¼Œå’Œå­¦æ ¡çŸ¥ç½‘æŸ¥é‡çš„åŒºåˆ«ä¸å¤§ï¼Œæˆ‘æ¯”è¾ƒè‡ªä¿¡ï¼Œæ²¡èŠ±è¿™ä¸ªé’±ï¼Œæ¯•ç«Ÿå¥½è´µï¼ŒğŸ˜¯æˆ‘ç©·ï¼Œå“ˆå“ˆå“ˆã€‚å­¦æ ¡è§„å®šçš„æ˜¯ä¸èƒ½é«˜äº 30% çš„æŸ¥é‡ç‡ï¼Œå»ºè®®è¿˜æ˜¯è‡ªå·±æŠŠæŸ¥é‡é™ä½åˆ° 20% ä»¥ä¸‹ç„¶åå†æäº¤åˆ°å­¦æ ¡çŸ¥ç½‘å»ï¼Œä¸ç„¶è¶…è¿‡çš„è¯æ˜¯éœ€è¦äºŒæ¬¡æŸ¥é‡çš„ã€‚ è¿˜æœ‰ä¸€ä¸ªæ„Ÿå—å°±æ˜¯ï¼šå¤šå’Œä½ çš„å¯¼å¸ˆäº¤æµï¼Œé‡åˆ°ä¸ä¼šæˆ–è€…æ‹¿ä¸å‡†çš„æœ€å¥½åœ¨ç¾¤é‡Œé—®ä»–ï¼Œç„¶åä»–è¯´çš„é”™è¯¯ï¼Œä½ è¦åŠæ—¶æ›´æ”¹å¥½è¿‡æ¥ï¼Œè¯´ä½ é—®é¢˜çš„æ—¶å€™è¦å­¦ä¼šè„¸ä¸ŠæŒ‚ç€ç¬‘å®¹ï¼Œå˜»å˜»å˜»å°±è¿‡å»äº†ï¼Œç„¶åè®°ä½è¯¥é—®é¢˜çš„é”™è¯¯ï¼Œå›å»ç«‹é©¬æ”¹å¥½ï¼ŒåŠæ—¶æ‹¿ææ–™ç»™è€å¸ˆæŸ¥é˜…ä¿®æ”¹å¥½çš„è®ºæ–‡ã€‚","tags":[{"name":"éšç¬”","slug":"éšç¬”","permalink":"http://www.54tianzhisheng.cn/tags/éšç¬”/"}]},{"title":"Spring Boot 2.0ç³»åˆ—æ–‡ç« (ä¸ƒ)ï¼šSpringApplication æ·±å…¥æ¢ç´¢","date":"2018-04-29T16:00:00.000Z","path":"2018/04/30/springboot_SpringApplication/","text":"SpringBoot ç³»åˆ—æ–‡ç«  å…³æ³¨æˆ‘ è½¬è½½è¯·åŠ¡å¿…æ³¨æ˜åŸåˆ›åœ°å€ä¸ºï¼šhttp://www.54tianzhisheng.cn/2018/04/30/springboot_SpringApplication/ å‰è¨€åœ¨ Spring Boot é¡¹ç›®çš„å¯åŠ¨ç±»ä¸­å¸¸è§ä»£ç å¦‚ä¸‹ï¼š 123456@SpringBootApplicationpublic class SpringbotApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(SpringbotApplication.class, args); &#125;&#125; å…¶ä¸­ä¹Ÿå°±ä¸¤ä¸ªæ¯”è¾ƒå¼•äººæ³¨æ„çš„åœ°æ–¹ï¼š @SpringBootApplication SpringApplication.run() å¯¹äºç¬¬ä¸€ä¸ªæ³¨è§£ @SpringBootApplicationï¼Œæˆ‘å·²ç»åœ¨åšå®¢ Spring Boot 2.0ç³»åˆ—æ–‡ç« (å…­)ï¼šSpring Boot 2.0ä¸­SpringBootApplicationæ³¨è§£è¯¦è§£ ä¸­è¯¦ç»†çš„è®²è§£äº†ã€‚æ¥ä¸‹æ¥å°±æ˜¯æ·±å…¥æ¢ç©¶ç¬¬äºŒä¸ªäº† SpringApplication.run() ã€‚ æ¢ä¸ªå§¿åŠ¿ä¸Šé¢çš„å§¿åŠ¿å¤ªç®€å•äº†ï¼Œåªä¸€è¡Œä»£ç å°±å®Œäº‹äº†ã€‚ 1SpringApplication.run(SpringbotApplication.class, args); å…¶å®æ˜¯æ”¯æŒåšä¸€äº›ä¸ªæ€§åŒ–çš„è®¾ç½®ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¢ä¸ªå§¿åŠ¿ç§ç§ï¼š 123456789@SpringBootApplicationpublic class SpringbotApplication &#123; public static void main(String[] args) &#123; SpringApplication app = new SpringApplication(SpringbotApplication.class); // è‡ªå®šä¹‰åº”ç”¨ç¨‹åºçš„é…ç½® //app.setXxx() app.run(args) &#125;&#125; æ²¡é”™ï¼Œå°±æ˜¯é€šè¿‡ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œç„¶åè®¾ç½®ç›¸å…³çš„å±æ€§ï¼Œä»è€Œè¾¾åˆ°å®šåˆ¶åŒ–æœåŠ¡ã€‚æœ‰å“ªäº›å±æ€§å‘¢ï¼Ÿ å±æ€§å¯¹åº”çš„ getï¼set æ–¹æ³• çœ‹åˆ°æ²¡ï¼Œè¿˜å¾ˆå¤šå‘¢ï¼ ä¸¾ä¸ªä¾‹å­ï¼šä½ æƒ³æŠŠ Spring Boot é¡¹ç›®çš„é»˜è®¤ Banner æ¢æˆä½ è‡ªå·±çš„ï¼Œå°±éœ€è¦åœ¨è¿™é‡Œå¦‚ä¸‹ï¼š 123456789101112131415161718public static void main(String[] args) &#123;// SpringApplication.run(Springboot2Application.class, args); SpringApplication application = new SpringApplication(Springboot2Application.class); application.setBanner((environment, sourceClass, out) -&gt; &#123; //è¿™é‡Œæ‰“å°ä¸€ä¸ªlogo System.out.println(\" _ _ _\\n\" + \" | | (_) | |\\n\" + \" ____| |__ _ ___ | |__ ___ _ __ __ _\\n\" + \"|_ /| '_ \\\\ | |/ __|| '_ \\\\ / _ \\\\| '_ \\\\ / _` |\\n\" + \" / / | | | || |\\\\__ \\\\| | | || __/| | | || (_| |\\n\" + \"/___||_| |_||_||___/|_| |_| \\\\___||_| |_| \\\\__, |\\n\" + \" __/ |\\n\" + \" |___/\\n\"); &#125;); application.setBannerMode(Banner.Mode.CONSOLE); //ä½ è¿˜å¯ä»¥å¹²å…¶ä»–çš„å®šåˆ¶åŒ–åˆå§‹è®¾ç½® application.run(args);&#125; ç°åœ¨é‡å¯é¡¹ç›®ï¼Œä½ å°±ä¼šå‘ç°ï¼Œæ§åˆ¶å°çš„ logo å·²ç»æ¢æˆä½ è‡ªå·±çš„äº†ã€‚ å½“ç„¶äº†ï¼Œä½ å¯èƒ½ä¼šè§‰å¾—è¿™æ ·å†™æœ‰ç‚¹å¤æ‚ï¼Œå—¯å—¯ï¼Œç¡®å®ï¼Œè¿™æ ·ç¡¬ç¼–ç åœ¨ä»£ç é‡Œç¡®å®ä¸å¤ªå‹å¥½ã€‚ä½ è¿˜å¯ä»¥åœ¨src/main/resourcesè·¯å¾„ä¸‹æ–°å»ºä¸€ä¸ªbanner.txtæ–‡ä»¶ï¼Œbanner.txtä¸­å¡«å†™å¥½éœ€è¦æ‰“å°çš„å­—ç¬¦ä¸²å†…å®¹å³å¯ã€‚ ä»è¯¥ç±»ä¸­å¯ä»¥çœ‹åˆ°åœ¨ Spring Boot 2 ä¸­å¼•å…¥äº†ä¸ªæ–°çš„ WebApplicationType å’Œ WebEnvironmentã€‚ ç¡®å®ï¼Œè¿™ä¹Ÿæ˜¯ Spring Boot 2 ä¸­æ¯”è¾ƒå¤§çš„ç‰¹æ€§ï¼Œå®ƒæ˜¯æ”¯æŒå“åº”å¼ç¼–ç¨‹çš„ã€‚æˆ‘ä¹‹å‰åœ¨æ–‡ç«  Spring Boot 2.0ç³»åˆ—æ–‡ç« (äºŒ)ï¼šSpring Boot 2.0 æ–°ç‰¹æ€§è¯¦è§£ ä¸­ä¹Ÿä»‹ç»è¿‡ï¼Œä»¥åæœ‰æœºä¼šä¼šä»‹ç»å®ƒçš„ï¼Œè¿™é‡Œæˆ‘å…ˆå–ä¸ªå…³å­ã€‚ SpringApplication åˆå§‹åŒ–SpringApplication.run() çš„å®ç°æ‰æ˜¯æˆ‘ä»¬è¦æ·±å…¥æ¢ç©¶çš„ä¸»è§’ï¼Œè¯¥æ–¹æ³•ä»£ç å¦‚ä¸‹ï¼š 123456789//é™æ€æ–¹æ³•ï¼Œå¯ç”¨äºä½¿ç”¨é»˜è®¤é…ç½®è¿è¡Œ SpringApplicationpublic static ConfigurableApplicationContext run(Class&lt;?&gt; primarySource, String... args) &#123; return run(new Class&lt;?&gt;[] &#123; primarySource &#125;, args);&#125;public static ConfigurableApplicationContext run(Class&lt;?&gt;[] primarySources, String[] args) &#123; return new SpringApplication(primarySources).run(args);&#125; åœ¨è¿™ä¸ªé™æ€æ–¹æ³•ä¸­ï¼Œåˆ›å»º SpringApplication å¯¹è±¡ï¼Œå¹¶è°ƒç”¨è¯¥å¯¹è±¡çš„ run æ–¹æ³•ã€‚ 123456789101112131415public SpringApplication(Class&lt;?&gt;... primarySources) &#123; this(null, primarySources);&#125;//åˆ›å»ºä¸€ä¸ª SpringApplication å®ä¾‹ï¼Œåº”ç”¨ä¸Šä¸‹æ–‡ä¼šæ ¹æ®æŒ‡å®šçš„ä¸»è¦èµ„æºåŠ è½½ beans ï¼Œå®ä¾‹åœ¨è°ƒç”¨ run æ–¹æ³•ä¹‹å‰å¯ä»¥å®šåˆ¶åŒ–@SuppressWarnings(&#123; \"unchecked\", \"rawtypes\" &#125;)public SpringApplication(ResourceLoader resourceLoader, Class&lt;?&gt;... primarySources) &#123; this.resourceLoader = resourceLoader; Assert.notNull(primarySources, \"PrimarySources must not be null\"); this.primarySources = new LinkedHashSet&lt;&gt;(Arrays.asList(primarySources)); this.webApplicationType = deduceWebApplicationType(); setInitializers((Collection) getSpringFactoriesInstances( ApplicationContextInitializer.class)); setListeners((Collection) getSpringFactoriesInstances(ApplicationListener.class)); this.mainApplicationClass = deduceMainApplicationClass();&#125; é¦–å…ˆæ˜¯è¿›å…¥å•ä¸ªå‚æ•°çš„æ„é€ æ–¹æ³•ï¼Œç„¶åè¿›å…¥ä¸¤å‚æ•°çš„æ„é€ æ–¹æ³•ï¼ˆResourceLoader ä¸º nullï¼‰ï¼Œç„¶åè¿›è¡Œåˆå§‹åŒ–ã€‚ 1ã€deduceWebApplicationType() : æ¨æ–­åº”ç”¨çš„ç±»å‹ ï¼Œåˆ›å»ºçš„æ˜¯ä¸€ä¸ª SERVLET åº”ç”¨è¿˜æ˜¯ REACTIVEåº”ç”¨æˆ–è€…æ˜¯ NONE 1234567891011121314151617private static final String REACTIVE_WEB_ENVIRONMENT_CLASS = \"org.springframework.web.reactive.DispatcherHandler\";private static final String MVC_WEB_ENVIRONMENT_CLASS = \"org.springframework.web.servlet.DispatcherServlet\";private static final String[] WEB_ENVIRONMENT_CLASSES = &#123; \"javax.servlet.Servlet\", \"org.springframework.web.context.ConfigurableWebApplicationContext\" &#125;;private WebApplicationType deduceWebApplicationType() &#123; if (ClassUtils.isPresent(REACTIVE_WEB_ENVIRONMENT_CLASS, null) &amp;&amp; !ClassUtils.isPresent(MVC_WEB_ENVIRONMENT_CLASS, null)) &#123; return WebApplicationType.REACTIVE; //è¯¥ç¨‹åºæ˜¯ REACTIVE ç¨‹åº &#125; for (String className : WEB_ENVIRONMENT_CLASSES) &#123; if (!ClassUtils.isPresent(className, null)) &#123; return WebApplicationType.NONE; //è¯¥ç¨‹åºä¸º NONE &#125; &#125; return WebApplicationType.SERVLET; //é»˜è®¤è¿”å›æ˜¯ SERVLET ç¨‹åº&#125; 2ã€setInitializers((Collection) getSpringFactoriesInstances(ApplicationContextInitializer.class))ï¼šåˆå§‹åŒ– classpath ä¸‹çš„æ‰€æœ‰çš„å¯ç”¨çš„ ApplicationContextInitializerã€‚ 1ï¼‰ã€getSpringFactoriesInstances() 123456789101112131415161718192021222324252627282930313233private &lt;T&gt; Collection&lt;T&gt; getSpringFactoriesInstances(Class&lt;T&gt; type) &#123; return getSpringFactoriesInstances(type, new Class&lt;?&gt;[] &#123;&#125;);&#125;//è·å–æ‰€æœ‰çš„ Spring å·¥å‚å®ä¾‹private &lt;T&gt; Collection&lt;T&gt; getSpringFactoriesInstances(Class&lt;T&gt; type,Class&lt;?&gt;[] parameterTypes, Object... args) &#123; ClassLoader classLoader = Thread.currentThread().getContextClassLoader(); // Use names and ensure unique to protect against duplicates Set&lt;String&gt; names = new LinkedHashSet&lt;&gt;(SpringFactoriesLoader.loadFactoryNames(type, classLoader)); //è·å–æ‰€æœ‰ Spring Factories çš„åå­— List&lt;T&gt; instances = createSpringFactoriesInstances(type, parameterTypes, classLoader, args, names); AnnotationAwareOrderComparator.sort(instances); //Spring å·¥å‚å®ä¾‹æ’åº return instances;&#125;//æ ¹æ®è¯»å–åˆ°çš„åå­—åˆ›å»ºå¯¹è±¡ï¼ˆSpring å·¥å‚å®ä¾‹ï¼‰private &lt;T&gt; List&lt;T&gt; createSpringFactoriesInstances(Class&lt;T&gt; type, Class&lt;?&gt;[] parameterTypes, ClassLoader classLoader, Object[] args, Set&lt;String&gt; names) &#123; List&lt;T&gt; instances = new ArrayList&lt;&gt;(names.size()); for (String name : names) &#123; try &#123; Class&lt;?&gt; instanceClass = ClassUtils.forName(name, classLoader); Assert.isAssignable(type, instanceClass); Constructor&lt;?&gt; constructor = instanceClass.getDeclaredConstructor(parameterTypes); T instance = (T) BeanUtils.instantiateClass(constructor, args); instances.add(instance); &#125; catch (Throwable ex) &#123; throw new IllegalArgumentException( \"Cannot instantiate \" + type + \" : \" + name, ex); &#125; &#125; return instances;&#125; ä¸Šé¢çš„ SpringFactoriesLoader.loadFactoryNames() ï¼Œæ˜¯ä» META-INF/spring.factories çš„èµ„æºæ–‡ä»¶ä¸­ï¼Œè¯»å– key ä¸ºorg.springframework.context.ApplicationContextInitializer çš„ valueã€‚ è€Œ spring.factories çš„éƒ¨åˆ†å†…å®¹å¦‚ä¸‹ï¼š å¯ä»¥çœ‹åˆ°ï¼Œæœ€è¿‘çš„å¾—åˆ°çš„ï¼Œæ˜¯ ConfigurationWarningsApplicationContextInitializerï¼ŒContextIdApplicationContextInitializerï¼ŒDelegatingApplicationContextInitializerï¼ŒServerPortInfoApplicationContextInitializer è¿™å››ä¸ªç±»çš„åå­—ã€‚ 2ï¼‰ã€setInitializers()ï¼š 12345public void setInitializers( Collection&lt;? extends ApplicationContextInitializer&lt;?&gt;&gt; initializers) &#123; this.initializers = new ArrayList&lt;&gt;(); this.initializers.addAll(initializers);&#125; æ‰€ä»¥ï¼Œè¿™é‡Œ setInitializers() æ‰€å¾—åˆ°çš„æˆå‘˜å˜é‡ initializers å°±è¢«åˆå§‹åŒ–ä¸ºConfigurationWarningsApplicationContextInitializerï¼ŒContextIdApplicationContextInitializerï¼ŒDelegatingApplicationContextInitializerï¼ŒServerPortInfoApplicationContextInitializer è¿™å››ä¸ªç±»çš„å¯¹è±¡ç»„æˆçš„ listã€‚ 3ã€setListeners((Collection) getSpringFactoriesInstances(ApplicationListener.class))ï¼šåˆå§‹åŒ– classpath ä¸‹çš„æ‰€æœ‰çš„å¯ç”¨çš„ ApplicationListenerã€‚ 1ï¼‰ã€getSpringFactoriesInstances() å’Œä¸Šé¢çš„ç±»ä¼¼ï¼Œä½†æ˜¯å®ƒæ˜¯ä» META-INF/spring.factories çš„èµ„æºæ–‡ä»¶ä¸­ï¼Œè·å–åˆ° key ä¸º org.springframework.context.ApplicationListener çš„ valueã€‚ 2ï¼‰ã€setListeners()ï¼š 1234public void setListeners(Collection&lt;? extends ApplicationListener&lt;?&gt;&gt; listeners) &#123; this.listeners = new ArrayList&lt;&gt;(); this.listeners.addAll(listeners);&#125; æ‰€ä»¥ï¼Œè¿™é‡Œ setListeners() æ‰€å¾—åˆ°çš„æˆå‘˜å˜é‡ listeners å°±è¢«åˆå§‹åŒ–ä¸º ClearCachesApplicationListenerï¼ŒParentContextCloserApplicationListenerï¼ŒFileEncodingApplicationListenerï¼ŒAnsiOutputApplicationListener ï¼ŒConfigFileApplicationListenerï¼ŒDelegatingApplicationListenerï¼ŒClasspathLoggingApplicationListenerï¼ŒLoggingApplicationListenerï¼ŒLiquibaseServiceLocatorApplicationListener è¿™ä¹ä¸ªç±»çš„å¯¹è±¡ç»„æˆçš„ listã€‚ 4ã€deduceMainApplicationClass() ï¼šæ ¹æ®è°ƒç”¨æ ˆï¼Œæ¨æ–­å‡º main æ–¹æ³•çš„ç±»å 1234567891011121314private Class&lt;?&gt; deduceMainApplicationClass() &#123; try &#123; StackTraceElement[] stackTrace = new RuntimeException().getStackTrace(); for (StackTraceElement stackTraceElement : stackTrace) &#123; if (\"main\".equals(stackTraceElement.getMethodName())) &#123; return Class.forName(stackTraceElement.getClassName()); &#125; &#125; &#125; catch (ClassNotFoundException ex) &#123; // Swallow and continue &#125; return null;&#125; run æ–¹æ³•èƒŒåçš„ç§˜å¯†ä¸Šé¢çœ‹å®Œäº†æ„é€ æ–¹æ³•åï¼Œå·²ç»åˆå§‹åŒ–äº†ä¸€ä¸ª SpringApplication å¯¹è±¡ï¼Œæ¥ä¸‹æ¥è°ƒç”¨å…¶ run æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445//è¿è¡Œ Spring åº”ç”¨ç¨‹åºï¼Œåˆ›å»ºå¹¶åˆ·æ–°ä¸€ä¸ªæ–°çš„ ApplicationContextpublic ConfigurableApplicationContext run(String... args) &#123; StopWatch stopWatch = new StopWatch(); stopWatch.start(); ConfigurableApplicationContext context = null; Collection&lt;SpringBootExceptionReporter&gt; exceptionReporters = new ArrayList&lt;&gt;(); configureHeadlessProperty(); SpringApplicationRunListeners listeners = getRunListeners(args); listeners.starting(); try &#123; ApplicationArguments applicationArguments = new DefaultApplicationArguments( args); ConfigurableEnvironment environment = prepareEnvironment(listeners, applicationArguments); configureIgnoreBeanInfo(environment); Banner printedBanner = printBanner(environment); context = createApplicationContext(); exceptionReporters = getSpringFactoriesInstances( SpringBootExceptionReporter.class, new Class[] &#123; ConfigurableApplicationContext.class &#125;, context); prepareContext(context, environment, listeners, applicationArguments, printedBanner); refreshContext(context); afterRefresh(context, applicationArguments); stopWatch.stop(); if (this.logStartupInfo) &#123; new StartupInfoLogger(this.mainApplicationClass) .logStarted(getApplicationLog(), stopWatch); &#125; listeners.started(context); callRunners(context, applicationArguments); &#125; catch (Throwable ex) &#123; handleRunFailure(context, ex, exceptionReporters, listeners); throw new IllegalStateException(ex); &#125; try &#123; listeners.running(context); &#125; catch (Throwable ex) &#123; handleRunFailure(context, ex, exceptionReporters, null); throw new IllegalStateException(ex); &#125; return context; &#125; å¯å˜ä¸ªæ•°å‚æ•° args å³æ˜¯æˆ‘ä»¬æ•´ä¸ªåº”ç”¨ç¨‹åºçš„å…¥å£ main æ–¹æ³•çš„å‚æ•°ã€‚StopWatch æ˜¯æ¥è‡ª org.springframework.util çš„å·¥å…·ç±»ï¼Œå¯ä»¥ç”¨æ¥æ–¹ä¾¿çš„è®°å½•ç¨‹åºçš„è¿è¡Œæ—¶é—´ã€‚ å†æ¥çœ‹çœ‹ 1.5.12 ä¸ 2.0.1 ç‰ˆæœ¬çš„ run æ–¹æ³• æœ‰ä»€ä¹ˆä¸ä¸€æ ·çš„åœ°æ–¹ï¼Ÿ æ¥ä¸‹æ¥å¥½å¥½åˆ†æä¸Šé¢æ–°ç‰ˆæœ¬ï¼ˆ2.0.1ï¼‰çš„ run æ–¹æ³•çš„ä»£ç å¹¶é…åˆæ¯”è¾ƒæ—§ç‰ˆæœ¬ï¼ˆ1.5.12ï¼‰ã€‚ 1ã€configureHeadlessProperty()ï¼šè®¾ç½® headless æ¨¡å¼ 1234567private static final String SYSTEM_PROPERTY_JAVA_AWT_HEADLESS = \"java.awt.headless\";private boolean headless = true;private void configureHeadlessProperty() &#123; System.setProperty(SYSTEM_PROPERTY_JAVA_AWT_HEADLESS, System.getProperty( SYSTEM_PROPERTY_JAVA_AWT_HEADLESS, Boolean.toString(this.headless)));&#125; å®é™…ä¸Šæ˜¯å°±æ˜¯è®¾ç½®ç³»ç»Ÿå±æ€§ java.awt.headlessï¼Œè¯¥å±æ€§ä¼šè¢«è®¾ç½®ä¸º trueã€‚ 2ã€getRunListeners()ï¼šåŠ è½½ SpringApplicationRunListener å¯¹è±¡ 12345678910111213141516171819 //TODO: xxxSpringApplicationRunListeners listeners = getRunListeners(args);//åˆå§‹åŒ–ç›‘å¬å™¨listeners.starting();try &#123; prepareContext(context, environment, listeners, applicationArguments, printedBanner); refreshContext(context); afterRefresh(context, applicationArguments); listeners.started(context); callRunners(context, applicationArguments);&#125;try &#123; listeners.running(context);&#125;private SpringApplicationRunListeners getRunListeners(String[] args) &#123; Class&lt;?&gt;[] types = new Class&lt;?&gt;[] &#123; SpringApplication.class, String[].class &#125;; return new SpringApplicationRunListeners(logger, getSpringFactoriesInstances( SpringApplicationRunListener.class, types, this, args));&#125; ä¸Šé¢çš„ getRunListeners() ä¸­ä¹Ÿåˆ©ç”¨ SpringFactoriesLoader åŠ è½½ META-INF/spring.factories ä¸­ key ä¸º SpringApplicationRunListener çš„å€¼ï¼Œç„¶åå†å°†è·å–åˆ°çš„å€¼ä½œä¸ºå‚æ•°ä¼ é€’åˆ° SpringApplicationRunListeners çš„æ„é€ æ–¹æ³•ä¸­å»åˆ›å»ºå¯¹è±¡ã€‚ 3ã€new DefaultApplicationArguments(args) ï¼šè·å–å¯åŠ¨æ—¶ä¼ å…¥å‚æ•° argsï¼ˆmain æ–¹æ³•ä¼ è¿›æ¥çš„å‚æ•°ï¼‰ å¹¶åˆå§‹åŒ–ä¸º ApplicationArguments å¯¹è±¡ã€‚ 12345public DefaultApplicationArguments(String[] args) &#123; Assert.notNull(args, \"Args must not be null\"); this.source = new Source(args); this.args = args;&#125; 4ã€prepareEnvironment(listeners, applicationArguments)ï¼šæ ¹æ® listeners å’Œ applicationArguments é…ç½®SpringBoot åº”ç”¨çš„ç¯å¢ƒã€‚ 1234567891011121314151617181920212223242526272829303132333435363738private ConfigurableEnvironment prepareEnvironment( SpringApplicationRunListeners listeners, ApplicationArguments applicationArguments) &#123; // Create and configure the environment ConfigurableEnvironment environment = getOrCreateEnvironment(); configureEnvironment(environment, applicationArguments.getSourceArgs()); listeners.environmentPrepared(environment); bindToSpringApplication(environment); if (this.webApplicationType == WebApplicationType.NONE) &#123; environment = new EnvironmentConverter(getClassLoader()) .convertToStandardEnvironmentIfNecessary(environment); &#125; ConfigurationPropertySources.attach(environment); return environment;&#125;//å¦‚æœ environment ä¸ä¸ºç©ºï¼Œç›´æ¥ get åˆ°ï¼Œå¦åˆ™åˆ›å»ºprivate ConfigurableEnvironment getOrCreateEnvironment() &#123; if (this.environment != null) &#123; return this.environment; &#125; if (this.webApplicationType == WebApplicationType.SERVLET) &#123; return new StandardServletEnvironment(); &#125; return new StandardEnvironment();&#125;//é…ç½®ç¯å¢ƒprotected void configureEnvironment(ConfigurableEnvironment environment,String[] args) &#123; configurePropertySources(environment, args);//é…ç½®è¦ä½¿ç”¨çš„PropertySources configureProfiles(environment, args);//é…ç½®è¦ä½¿ç”¨çš„Profiles&#125;//å°†ç¯å¢ƒç»‘å®šåˆ° SpringApplicationprotected void bindToSpringApplication(ConfigurableEnvironment environment) &#123; try &#123; Binder.get(environment).bind(\"spring.main\", Bindable.ofInstance(this)); &#125; catch (Exception ex) &#123; throw new IllegalStateException(\"Cannot bind to SpringApplication\", ex); &#125;&#125; 5ã€configureIgnoreBeanInfo(environment)ï¼šæ ¹æ®ç¯å¢ƒä¿¡æ¯é…ç½®è¦å¿½ç•¥çš„ bean ä¿¡æ¯ 1234567891011public static final String IGNORE_BEANINFO_PROPERTY_NAME = \"spring.beaninfo.ignore\";private void configureIgnoreBeanInfo(ConfigurableEnvironment environment) &#123; if (System.getProperty( CachedIntrospectionResults.IGNORE_BEANINFO_PROPERTY_NAME) == null) &#123; Boolean ignore = environment.getProperty(\"spring.beaninfo.ignore\", Boolean.class, Boolean.TRUE); System.setProperty(CachedIntrospectionResults.IGNORE_BEANINFO_PROPERTY_NAME, ignore.toString()); &#125;&#125; 6ã€printBanner(environment)ï¼šæ‰“å°æ ‡å¿—ï¼Œä¸Šé¢æˆ‘å·²ç»è¯´è¿‡äº†ã€‚ 12345678910111213private Banner printBanner(ConfigurableEnvironment environment) &#123; if (this.bannerMode == Banner.Mode.OFF) &#123; //å¦‚æœè®¾ç½®ä¸º offï¼Œä¸æ‰“å° Banner return null; &#125; ResourceLoader resourceLoader = this.resourceLoader != null ? this.resourceLoader : new DefaultResourceLoader(getClassLoader()); SpringApplicationBannerPrinter bannerPrinter = new SpringApplicationBannerPrinter( resourceLoader, this.banner); if (this.bannerMode == Mode.LOG) &#123; return bannerPrinter.print(environment, this.mainApplicationClass, logger); &#125; return bannerPrinter.print(environment, this.mainApplicationClass, System.out);&#125; 7ã€createApplicationContext()ï¼šæ ¹æ®åº”ç”¨ç±»å‹æ¥ç¡®å®šè¯¥ Spring Boot é¡¹ç›®åº”è¯¥åˆ›å»ºä»€ä¹ˆç±»å‹çš„ ApplicationContext ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœæ²¡æœ‰æ˜ç¡®è®¾ç½®çš„åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡æˆ–åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ç±»ï¼Œè¯¥æ–¹æ³•ä¼šåœ¨è¿”å›åˆé€‚çš„é»˜è®¤å€¼ã€‚ 1234567891011121314151617181920212223242526public static final String DEFAULT_WEB_CONTEXT_CLASS = \"org.springframework.boot.web.servlet.context.AnnotationConfigServletWebServerApplicationContext\";public static final String DEFAULT_REACTIVE_WEB_CONTEXT_CLASS = \"org.springframework.boot.web.reactive.context.AnnotationConfigReactiveWebServerApplicationContext\";public static final String DEFAULT_CONTEXT_CLASS = \"org.springframework.context.annotation.AnnotationConfigApplicationContext\";protected ConfigurableApplicationContext createApplicationContext() &#123; Class&lt;?&gt; contextClass = this.applicationContextClass; if (contextClass == null) &#123; try &#123; switch (this.webApplicationType) &#123; //æ ¹æ®åº”ç”¨ç¨‹åºçš„ç±»å‹æ¥åˆå§‹åŒ–å®¹å™¨ case SERVLET: //servlet åº”ç”¨ç¨‹åº contextClass = Class.forName(DEFAULT_WEB_CONTEXT_CLASS); break; case REACTIVE: //reactive åº”ç”¨ç¨‹åº contextClass = Class.forName(DEFAULT_REACTIVE_WEB_CONTEXT_CLASS); break; default: //é»˜è®¤ contextClass = Class.forName(DEFAULT_CONTEXT_CLASS); &#125; &#125; catch (ClassNotFoundException ex) &#123; throw new IllegalStateException( \"Unable create a default ApplicationContext,please specify an ApplicationContextClass\",ex); &#125; &#125; //æœ€åé€šè¿‡Springçš„å·¥å…·ç±» BeanUtils åˆå§‹åŒ–å®¹å™¨ç±» bean return (ConfigurableApplicationContext) BeanUtils.instantiateClass(contextClass);&#125; æ¥çœ‹çœ‹åœ¨ 1.5.12 ä¸­æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ 8ã€exceptionReporters = getSpringFactoriesInstances( SpringBootExceptionReporter.class, new Class[] { ConfigurableApplicationContext.class }, context) 1234567891011private &lt;T&gt; Collection&lt;T&gt; getSpringFactoriesInstances(Class&lt;T&gt; type, Class&lt;?&gt;[] parameterTypes, Object... args) &#123; ClassLoader classLoader = Thread.currentThread().getContextClassLoader(); // Use names and ensure unique to protect against duplicates Set&lt;String&gt; names = new LinkedHashSet&lt;&gt;( SpringFactoriesLoader.loadFactoryNames(type, classLoader)); List&lt;T&gt; instances = createSpringFactoriesInstances(type, parameterTypes, classLoader, args, names);//æ ¹æ®ç±»å‹ key ä¸º SpringBootExceptionReporter å»åŠ è½½ AnnotationAwareOrderComparator.sort(instances);//å¯¹å®ä¾‹æ’åº return instances;&#125; è¿™é‡Œä¹Ÿæ˜¯é€šè¿‡ SpringFactoriesLoader åŠ è½½ META-INF/spring.factories ä¸­ key ä¸º SpringBootExceptionReporter çš„å…¨ç±»åçš„ value å€¼ã€‚ 9ã€prepareContext(context, environment, listeners, applicationArguments, printedBanner)ï¼šå®Œæˆæ•´ä¸ªå®¹å™¨çš„åˆ›å»ºä¸å¯åŠ¨ä»¥åŠ bean çš„æ³¨å…¥åŠŸèƒ½ã€‚ 12345678910111213141516171819202122232425262728//è£…é… Contextprivate void prepareContext(ConfigurableApplicationContext context, ConfigurableEnvironment environment, SpringApplicationRunListeners listeners, ApplicationArguments applicationArguments, Banner printedBanner) &#123; //å°†ä¹‹å‰å‡†å¤‡å¥½çš„ environment è®¾ç½®ç»™åˆ›å»ºå¥½çš„ ApplicationContext ä½¿ç”¨ context.setEnvironment(environment); //1ã€ postProcessApplicationContext(context); //2ã€ applyInitializers(context); listeners.contextPrepared(context); if (this.logStartupInfo) &#123;//å¯åŠ¨æ—¥å¿— logStartupInfo(context.getParent() == null); logStartupProfileInfo(context); &#125; // Add boot specific singleton beans context.getBeanFactory().registerSingleton(\"springApplicationArguments\", applicationArguments); if (printedBanner != null) &#123; context.getBeanFactory().registerSingleton(\"springBootBanner\", printedBanner); &#125; // Load the sources Set&lt;Object&gt; sources = getAllSources(); Assert.notEmpty(sources, \"Sources must not be empty\"); //3ã€ load(context, sources.toArray(new Object[0])); listeners.contextLoaded(context);&#125; 1ï¼‰ã€postProcessApplicationContext(context) 12345678910111213141516171819public static final String CONFIGURATION_BEAN_NAME_GENERATOR = \"org.springframework.context.annotation.internalConfigurationBeanNameGenerator\";protected void postProcessApplicationContext(ConfigurableApplicationContext context) &#123; if (this.beanNameGenerator != null) &#123; context.getBeanFactory().registerSingleton( AnnotationConfigUtils.CONFIGURATION_BEAN_NAME_GENERATOR, this.beanNameGenerator); &#125; if (this.resourceLoader != null) &#123; if (context instanceof GenericApplicationContext) &#123; ((GenericApplicationContext) context) .setResourceLoader(this.resourceLoader); &#125; if (context instanceof DefaultResourceLoader) &#123; ((DefaultResourceLoader) context) .setClassLoader(this.resourceLoader.getClassLoader()); &#125; &#125;&#125; è¯¥æ–¹æ³•å¯¹ context è¿›è¡Œäº†é¢„è®¾ç½®ï¼Œè®¾ç½®äº† ResourceLoader å’Œ ClassLoaderï¼Œå¹¶å‘ bean å·¥å‚ä¸­æ·»åŠ äº†ä¸€ä¸ªbeanNameGenerator ã€‚ 2ï¼‰ã€applyInitializers(context) 12345678protected void applyInitializers(ConfigurableApplicationContext context) &#123; for (ApplicationContextInitializer initializer : getInitializers()) &#123; Class&lt;?&gt; requiredType = GenericTypeResolver.resolveTypeArgument( initializer.getClass(), ApplicationContextInitializer.class); Assert.isInstanceOf(requiredType, context, \"Unable to call initializer.\"); initializer.initialize(context); &#125;&#125; åœ¨åˆ·æ–°ä¹‹å‰å°†ä»»ä½• ApplicationContextInitializer åº”ç”¨äºä¸Šä¸‹æ–‡ 3)ã€load(context, sources.toArray(new Object[0])) ä¸»è¦æ˜¯åŠ è½½å„ç§ beans åˆ° ApplicationContext å¯¹è±¡ä¸­ã€‚ 1234567891011121314protected void load(ApplicationContext context, Object[] sources) &#123; BeanDefinitionLoader loader = createBeanDefinitionLoader( //2 getBeanDefinitionRegistry(context), sources);// 1 if (this.beanNameGenerator != null) &#123; loader.setBeanNameGenerator(this.beanNameGenerator); &#125; if (this.resourceLoader != null) &#123; loader.setResourceLoader(this.resourceLoader); &#125; if (this.environment != null) &#123; loader.setEnvironment(this.environment); &#125; loader.load();//3&#125; (1)ã€getBeanDefinitionRegistry(context) è·å– bean å®šä¹‰æ³¨å†Œè¡¨ 12345678910private BeanDefinitionRegistry getBeanDefinitionRegistry(ApplicationContext context) &#123; if (context instanceof BeanDefinitionRegistry) &#123; return (BeanDefinitionRegistry) context; &#125; if (context instanceof AbstractApplicationContext) &#123; return (BeanDefinitionRegistry) ((AbstractApplicationContext) context) .getBeanFactory(); &#125; throw new IllegalStateException(\"Could not locate BeanDefinitionRegistry\");&#125; (2)ã€createBeanDefinitionLoader() é€šè¿‡ BeanDefinitionLoader çš„æ„é€ æ–¹æ³•æŠŠå‚æ•°ï¼ˆæ³¨å†Œè¡¨ã€èµ„æºï¼‰ä¼ è¿›å»ï¼Œç„¶ååˆ›å»º BeanDefinitionLoaderã€‚ (3)ã€load() æŠŠèµ„æºå…¨éƒ¨åŠ è½½ã€‚ 10ã€refreshContext(context) 12345678910111213141516private void refreshContext(ConfigurableApplicationContext context) &#123; refresh(context);//1 if (this.registerShutdownHook) &#123; try &#123; context.registerShutdownHook(); &#125; catch (AccessControlException ex) &#123; // Not allowed in some environments. &#125; &#125;&#125;//åˆ·æ–°åº•å±‚çš„ ApplicationContextprotected void refresh(ApplicationContext applicationContext) &#123; Assert.isInstanceOf(AbstractApplicationContext.class, applicationContext); ((AbstractApplicationContext) applicationContext).refresh();&#125; refreshContext(context) æ–¹æ³•åˆè°ƒç”¨äº† refresh(context)ã€‚åœ¨è°ƒç”¨äº† refresh(context) æ–¹æ³•ä¹‹åï¼Œè°ƒç”¨äº† registerShutdownHook æ–¹æ³•ã€‚ç»§ç»­çœ‹å®ƒçš„ refresh æ–¹æ³•ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142public void refresh() throws BeansException, IllegalStateException &#123; synchronized (this.startupShutdownMonitor) &#123; // Prepare this context for refreshing. prepareRefresh(); // Tell the subclass to refresh the internal bean factory. ConfigurableListableBeanFactory beanFactory = obtainFreshBeanFactory(); // Prepare the bean factory for use in this context. prepareBeanFactory(beanFactory); try &#123; // Allows post-processing of the bean factory in context subclasses. postProcessBeanFactory(beanFactory); // Invoke factory processors registered as beans in the context. invokeBeanFactoryPostProcessors(beanFactory); // Register bean processors that intercept bean creation. registerBeanPostProcessors(beanFactory); // Initialize message source for this context. initMessageSource(); // Initialize event multicaster for this context. initApplicationEventMulticaster(); // Initialize other special beans in specific context subclasses. onRefresh(); // Check for listener beans and register them. registerListeners(); // Instantiate all remaining (non-lazy-init) singletons. finishBeanFactoryInitialization(beanFactory); //1 // Last step: publish corresponding event. finishRefresh(); &#125; catch (BeansException ex) &#123; ã€‚ã€‚ã€‚ // Destroy already created singletons to avoid dangling resources. destroyBeans(); // Reset 'active' flag. cancelRefresh(ex); // Propagate exception to caller. throw ex; &#125; finally &#123; // Reset common introspection caches in Spring's core, since we // might not ever need metadata for singleton beans anymore... resetCommonCaches(); &#125; &#125;&#125; åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±çœ‹è§é‡ç‚¹äº†ï¼Œä»”ç»†çœ‹ä¸Šçš„æ³¨é‡Šï¼Œæ­£åœ¨åšå„ç§åˆå§‹åŒ–å·¥ä½œï¼Œè€Œä»Šå¤©æˆ‘ä»¬å…³æ³¨çš„é‡ç‚¹å°±æ˜¯æ–¹æ³• finishBeanFactoryInitialization(beanFactory)ã€‚è¯¥æ–¹æ³•è¿›è¡Œäº†éæ‡’åŠ è½½ beans çš„åˆå§‹åŒ–å·¥ä½œã€‚ç°åœ¨æˆ‘ä»¬è¿›å…¥è¯¥æ–¹æ³•å†…éƒ¨ï¼Œä¸€æ¢ç©¶ç«Ÿã€‚ çœ‹ä¸Šå›¾æ–¹æ³•ä¸­çš„æœ€åä¸€æ­¥ï¼Œè°ƒç”¨äº† beanFactory çš„ preInstantiateSingletons() æ–¹æ³•ã€‚æ­¤å¤„çš„ beanFactory æ˜¯å“ªä¸ªç±»çš„å®ä¾‹å¯¹è±¡å‘¢ï¼Ÿ å¯ä»¥çœ‹åˆ° ConfigurableListableBeanFactory æ¥å£çš„å®ç°ç±»åªæœ‰ DefaultListableBeanFactoryï¼Œæˆ‘ä»¬çœ‹ä¸‹å®ç°ç±»ä¸­çš„ preInstantiateSingletons æ–¹æ³•æ˜¯æ€ä¹ˆåšçš„ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647public void preInstantiateSingletons() throws BeansException &#123; // Iterate over a copy to allow for init methods which in turn register new bean definitions. // While this may not be part of the regular factory bootstrap, it does otherwise work fine. List&lt;String&gt; beanNames = new ArrayList&lt;&gt;(this.beanDefinitionNames); // Trigger initialization of all non-lazy singleton beans... for (String beanName : beanNames) &#123; RootBeanDefinition bd = getMergedLocalBeanDefinition(beanName); if (!bd.isAbstract() &amp;&amp; bd.isSingleton() &amp;&amp; !bd.isLazyInit()) &#123; if (isFactoryBean(beanName)) &#123; Object bean = getBean(FACTORY_BEAN_PREFIX + beanName); if (bean instanceof FactoryBean) &#123; final FactoryBean&lt;?&gt; factory = (FactoryBean&lt;?&gt;) bean; boolean isEagerInit; if (System.getSecurityManager() != null &amp;&amp; factory instanceof SmartFactoryBean)&#123; isEagerInit = AccessController.doPrivileged((PrivilegedAction&lt;Boolean&gt;) ((SmartFactoryBean&lt;?&gt;) factory)::isEagerInit, getAccessControlContext()); &#125; else &#123; isEagerInit = (factory instanceof SmartFactoryBean &amp;&amp; ((SmartFactoryBean&lt;?&gt;) factory).isEagerInit()); &#125; if (isEagerInit) &#123; getBean(beanName); &#125; &#125; &#125; else &#123; getBean(beanName); &#125; &#125; &#125; // Trigger post-initialization callback for all applicable beans... for (String beanName : beanNames) &#123; Object singletonInstance = getSingleton(beanName); if (singletonInstance instanceof SmartInitializingSingleton) &#123; final SmartInitializingSingleton smartSingleton = (SmartInitializingSingleton) singletonInstance; if (System.getSecurityManager() != null) &#123; AccessController.doPrivileged((PrivilegedAction&lt;Object&gt;) () -&gt; &#123; smartSingleton.afterSingletonsInstantiated(); return null; &#125;, getAccessControlContext()); &#125; else &#123; smartSingleton.afterSingletonsInstantiated(); &#125; &#125; &#125;&#125; ä»ä¸Šé¢çš„ä»£ç ä¸­å¯ä»¥çœ‹åˆ°å¾ˆå¤šè°ƒç”¨äº† getBean(beanName) æ–¹æ³•ï¼Œè·Ÿè¸ªæ­¤æ–¹æ³•è¿›å»åï¼Œæœ€ç»ˆå‘ç° getBean è°ƒç”¨äº†AbstractBeanFactory ç±»çš„ doGetBean(xxx) æ–¹æ³•ï¼ŒdoGetBean(xxx) æ–¹æ³•ä¸­æœ‰è¿™ä¹ˆä¸€æ®µä»£ç ï¼š ä½†æ˜¯ createBean() æ–¹æ³•å¹¶æ²¡æœ‰å¾—åˆ°å®ç°ï¼Œå®ç°ç±»åœ¨ AbstractAutowireCapableBeanFactory ä¸­ã€‚è¿™æ‰æ˜¯åˆ›å»º bean çš„æ ¸å¿ƒæ–¹æ³•ã€‚ ä¸çŸ¥ä¸è§‰ï¼Œä»£ç çœ‹çš„è¶Šæ¥è¶Šæ·±ï¼Œæ„Ÿè§‰æ€ç»´éƒ½å·®ç‚¹å›ä¸å» run æ–¹æ³•äº†ï¼Œåˆ‡å›å¤§è„‘çš„ä¸Šä¸‹æ–‡çº¿ç¨‹åˆ° run æ–¹æ³•å»ã€‚ 11ã€afterRefresh(context, applicationArguments)ï¼šåœ¨ä¸Šä¸‹æ–‡åˆ·æ–°åè°ƒç”¨è¯¥æ–¹æ³•ï¼Œå…¶å†…éƒ¨æ²¡æœ‰åšä»»ä½•æ“ä½œã€‚ å‘ç°æ²¡åšä»»ä½•æ“ä½œäº†ä¹‹åï¼Œå°±è§‰å¾—æœ‰ç‚¹å¥‡æ€ªï¼Œæ‰€ä»¥æŠŠå½“å‰ç‰ˆæœ¬å’Œ 1.5.12 å¯¹æ¯”äº†ä¸‹ï¼Œå‘ç°ï¼š åœ¨ 1.5.12 ä¸­çš„ afterRefresh() æ–¹æ³•ä¸­è°ƒç”¨äº† callRunners() æ–¹æ³•ï¼Œä½†æ˜¯åœ¨ 2.0.1 ç‰ˆæœ¬ä¸­çš„ run æ–¹æ³•ä¸­è°ƒç”¨äº† callRunners () æ–¹æ³•: è¿™é‡Œä¸å¾—ä¸è¯´ SpringApplicationRunListeners åœ¨ 2.0.1 ä¸­çš„æ”¹å˜ï¼š å¯ä»¥å‘ç°åœ¨ run æ–¹æ³•ä¸­ï¼ŒSpringApplicationRunListeners ç›‘å¬å™¨çš„çŠ¶æ€èŠ±ç”Ÿäº†å˜åŒ–ï¼Œè¿™ä¹Ÿæ˜¯é€šè¿‡å¯¹æ¯”ä¸åŒç‰ˆæœ¬çš„ä»£ç æ‰çŸ¥é“çš„åŒºåˆ«ï¼Œæ‰€ä»¥è¯´æˆ‘ä»¬çœ‹æºç éœ€è¦å¤šå¯¹æ¯”ç€çœ‹ã€‚ soï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹è¿™ä¸ª SpringApplicationRunListener è¿™ä¸ªæ¥å£ï¼š started çŠ¶æ€ï¼šThe context has been refreshed and the application has started but CommandLineRunner and ApplicationRunner have not been called running çŠ¶æ€ï¼šCalled immediately before the run method finishes, when the application context has been refreshed and all CommandLineRunner and ApplicationRunners have been called. ç›¸å…³æ–‡ç« 1ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (ä¸€)ï¼šSpring Boot 2.0 è¿ç§»æŒ‡å— 2ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (äºŒ)ï¼šSpring Boot 2.0 æ–°ç‰¹æ€§è¯¦è§£ 3ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (ä¸‰)ï¼šSpring Boot 2.0 é…ç½®æ”¹å˜ 4ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (å››)ï¼šSpring Boot 2.0 æºç é˜…è¯»ç¯å¢ƒæ­å»º 5ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (äº”)ï¼šSpring Boot 2.0 é¡¹ç›®æºç ç»“æ„é¢„è§ˆ 6ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (å…­)ï¼šSpring boot 2.0 ä¸­ SpringBootApplication æ³¨è§£è¯¦è§£ 7ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (ä¸ƒ)ï¼šSpringApplication æ·±å…¥æ¢ç´¢ æ€»ç»“æœ¬æ–‡ä»æºç çº§åˆ«åˆ†æäº† Spring Boot åº”ç”¨ç¨‹åºçš„å¯åŠ¨è¿‡ç¨‹ï¼Œç€é‡çœ‹äº† SpringApplication ç±»ä¸­çš„æ„é€ å‡½æ•°çš„åˆå§‹åŒ–å’Œå…¶ run æ–¹æ³•å†…éƒ¨å®ç°ï¼Œå¹¶æŠŠæ¶‰åŠåˆ°çš„æµç¨‹ä»£ç éƒ½è¿‡äº†ä¸€éã€‚ æ„Ÿæ‚Ÿï¼šæœ‰æ—¶å€™è·Ÿä»£ç è·Ÿç€è·Ÿç€ï¼Œå‘ç°è¶Šé™·è¶Šæ·±ï¼Œå¥½éš¾è·³å‡ºæ¥ï¼åé¢è¿˜éœ€å¤šå‘åˆ«äººè¯·æ•™é˜…è¯»æºç çš„æŠ€å·§ï¼ æœ€åè™½ç„¶æºç å¾ˆéš¾ï¼Œä½†éšç€ä¸æ–­çš„æ¢ç´¢ï¼Œæºç åœ¨ä½ é¢å‰å°†ä¼šä¸€è§ˆæ— é—ï¼Œäº«å—è¿™ç§æ¢ç´¢åçš„æˆå°±æ„Ÿï¼åŠ æ²¹ï¼éªšå¹´ï¼ è‡ªå·±æœ¬äººèƒ½åŠ›æœ‰é™ï¼Œæºç çœ‹çš„ä¸å¤šï¼Œä¸Šé¢å¦‚æœ‰ä¸å¯¹çš„è¿˜è¯·ç•™è¨€äº¤æµã€‚","tags":[{"name":"Java","slug":"Java","permalink":"http://www.54tianzhisheng.cn/tags/Java/"},{"name":"SpringBoot","slug":"SpringBoot","permalink":"http://www.54tianzhisheng.cn/tags/SpringBoot/"}]},{"title":"åˆ†å¸ƒå¼é”çœ‹è¿™ç¯‡å°±å¤Ÿäº†","date":"2018-04-23T16:00:00.000Z","path":"2018/04/24/Distributed_lock/","text":"å…³æ³¨æˆ‘ è½¬è½½è¯·åŠ¡å¿…æ³¨æ˜åŸåˆ›åœ°å€ä¸ºï¼šhttp://www.54tianzhisheng.cn/2018/04/24/Distributed_lock/ ä»€ä¹ˆæ˜¯é”ï¼Ÿ åœ¨å•è¿›ç¨‹çš„ç³»ç»Ÿä¸­ï¼Œå½“å­˜åœ¨å¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶æ”¹å˜æŸä¸ªå˜é‡ï¼ˆå¯å˜å…±äº«å˜é‡ï¼‰æ—¶ï¼Œå°±éœ€è¦å¯¹å˜é‡æˆ–ä»£ç å—åšåŒæ­¥ï¼Œä½¿å…¶åœ¨ä¿®æ”¹è¿™ç§å˜é‡æ—¶èƒ½å¤Ÿçº¿æ€§æ‰§è¡Œæ¶ˆé™¤å¹¶å‘ä¿®æ”¹å˜é‡ã€‚ è€ŒåŒæ­¥çš„æœ¬è´¨æ˜¯é€šè¿‡é”æ¥å®ç°çš„ã€‚ä¸ºäº†å®ç°å¤šä¸ªçº¿ç¨‹åœ¨ä¸€ä¸ªæ—¶åˆ»åŒä¸€ä¸ªä»£ç å—åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å¯æ‰§è¡Œï¼Œé‚£ä¹ˆéœ€è¦åœ¨æŸä¸ªåœ°æ–¹åšä¸ªæ ‡è®°ï¼Œè¿™ä¸ªæ ‡è®°å¿…é¡»æ¯ä¸ªçº¿ç¨‹éƒ½èƒ½çœ‹åˆ°ï¼Œå½“æ ‡è®°ä¸å­˜åœ¨æ—¶å¯ä»¥è®¾ç½®è¯¥æ ‡è®°ï¼Œå…¶ä½™åç»­çº¿ç¨‹å‘ç°å·²ç»æœ‰æ ‡è®°äº†åˆ™ç­‰å¾…æ‹¥æœ‰æ ‡è®°çš„çº¿ç¨‹ç»“æŸåŒæ­¥ä»£ç å—å–æ¶ˆæ ‡è®°åå†å»å°è¯•è®¾ç½®æ ‡è®°ã€‚è¿™ä¸ªæ ‡è®°å¯ä»¥ç†è§£ä¸ºé”ã€‚ ä¸åŒåœ°æ–¹å®ç°é”çš„æ–¹å¼ä¹Ÿä¸ä¸€æ ·ï¼Œåªè¦èƒ½æ»¡è¶³æ‰€æœ‰çº¿ç¨‹éƒ½èƒ½çœ‹å¾—åˆ°æ ‡è®°å³å¯ã€‚å¦‚ Java ä¸­ synchronize æ˜¯åœ¨å¯¹è±¡å¤´è®¾ç½®æ ‡è®°ï¼ŒLock æ¥å£çš„å®ç°ç±»åŸºæœ¬ä¸Šéƒ½åªæ˜¯æŸä¸€ä¸ª volitile ä¿®é¥°çš„ int å‹å˜é‡å…¶ä¿è¯æ¯ä¸ªçº¿ç¨‹éƒ½èƒ½æ‹¥æœ‰å¯¹è¯¥ int çš„å¯è§æ€§å’ŒåŸå­ä¿®æ”¹ï¼Œlinux å†…æ ¸ä¸­ä¹Ÿæ˜¯åˆ©ç”¨äº’æ–¥é‡æˆ–ä¿¡å·é‡ç­‰å†…å­˜æ•°æ®åšæ ‡è®°ã€‚ é™¤äº†åˆ©ç”¨å†…å­˜æ•°æ®åšé”å…¶å®ä»»ä½•äº’æ–¥çš„éƒ½èƒ½åšé”ï¼ˆåªè€ƒè™‘äº’æ–¥æƒ…å†µï¼‰ï¼Œå¦‚æµæ°´è¡¨ä¸­æµæ°´å·ä¸æ—¶é—´ç»“åˆåšå¹‚ç­‰æ ¡éªŒå¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªä¸ä¼šé‡Šæ”¾çš„é”ï¼Œæˆ–è€…ä½¿ç”¨æŸä¸ªæ–‡ä»¶æ˜¯å¦å­˜åœ¨ä½œä¸ºé”ç­‰ã€‚åªéœ€è¦æ»¡è¶³åœ¨å¯¹æ ‡è®°è¿›è¡Œä¿®æ”¹èƒ½ä¿è¯åŸå­æ€§å’Œå†…å­˜å¯è§æ€§å³å¯ã€‚ ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ï¼Ÿåˆ†å¸ƒå¼çš„ CAP ç†è®ºå‘Šè¯‰æˆ‘ä»¬: ä»»ä½•ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿéƒ½æ— æ³•åŒæ—¶æ»¡è¶³ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ã€å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰å’Œåˆ†åŒºå®¹é”™æ€§ï¼ˆPartition toleranceï¼‰ï¼Œæœ€å¤šåªèƒ½åŒæ—¶æ»¡è¶³ä¸¤é¡¹ã€‚ ç›®å‰å¾ˆå¤šå¤§å‹ç½‘ç«™åŠåº”ç”¨éƒ½æ˜¯åˆ†å¸ƒå¼éƒ¨ç½²çš„ï¼Œåˆ†å¸ƒå¼åœºæ™¯ä¸­çš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜ä¸€ç›´æ˜¯ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„è¯é¢˜ã€‚åŸºäº CAPç†è®ºï¼Œå¾ˆå¤šç³»ç»Ÿåœ¨è®¾è®¡ä¹‹åˆå°±è¦å¯¹è¿™ä¸‰è€…åšå‡ºå–èˆã€‚åœ¨äº’è”ç½‘é¢†åŸŸçš„ç»å¤§å¤šæ•°çš„åœºæ™¯ä¸­ï¼Œéƒ½éœ€è¦ç‰ºç‰²å¼ºä¸€è‡´æ€§æ¥æ¢å–ç³»ç»Ÿçš„é«˜å¯ç”¨æ€§ï¼Œç³»ç»Ÿå¾€å¾€åªéœ€è¦ä¿è¯æœ€ç»ˆä¸€è‡´æ€§ã€‚ åˆ†å¸ƒå¼åœºæ™¯ æ­¤å¤„ä¸»è¦æŒ‡é›†ç¾¤æ¨¡å¼ä¸‹ï¼Œå¤šä¸ªç›¸åŒæœåŠ¡åŒæ—¶å¼€å¯. åœ¨è®¸å¤šçš„åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬ä¸ºäº†ä¿è¯æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§ï¼Œéœ€è¦å¾ˆå¤šçš„æŠ€æœ¯æ–¹æ¡ˆæ¥æ”¯æŒï¼Œæ¯”å¦‚åˆ†å¸ƒå¼äº‹åŠ¡ã€åˆ†å¸ƒå¼é”ç­‰ã€‚å¾ˆå¤šæ—¶å€™æˆ‘ä»¬éœ€è¦ä¿è¯ä¸€ä¸ªæ–¹æ³•åœ¨åŒä¸€æ—¶é—´å†…åªèƒ½è¢«åŒä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚åœ¨å•æœºç¯å¢ƒä¸­ï¼Œé€šè¿‡ Java æä¾›çš„å¹¶å‘ API æˆ‘ä»¬å¯ä»¥è§£å†³ï¼Œä½†æ˜¯åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œå°±æ²¡æœ‰é‚£ä¹ˆç®€å•å•¦ã€‚ åˆ†å¸ƒå¼ä¸å•æœºæƒ…å†µä¸‹æœ€å¤§çš„ä¸åŒåœ¨äºå…¶ä¸æ˜¯å¤šçº¿ç¨‹è€Œæ˜¯å¤šè¿›ç¨‹ã€‚ å¤šçº¿ç¨‹ç”±äºå¯ä»¥å…±äº«å †å†…å­˜ï¼Œå› æ­¤å¯ä»¥ç®€å•çš„é‡‡å–å†…å­˜ä½œä¸ºæ ‡è®°å­˜å‚¨ä½ç½®ã€‚è€Œè¿›ç¨‹ä¹‹é—´ç”šè‡³å¯èƒ½éƒ½ä¸åœ¨åŒä¸€å°ç‰©ç†æœºä¸Šï¼Œå› æ­¤éœ€è¦å°†æ ‡è®°å­˜å‚¨åœ¨ä¸€ä¸ªæ‰€æœ‰è¿›ç¨‹éƒ½èƒ½çœ‹åˆ°çš„åœ°æ–¹ã€‚ ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼é”ï¼Ÿ å½“åœ¨åˆ†å¸ƒå¼æ¨¡å‹ä¸‹ï¼Œæ•°æ®åªæœ‰ä¸€ä»½ï¼ˆæˆ–æœ‰é™åˆ¶ï¼‰ï¼Œæ­¤æ—¶éœ€è¦åˆ©ç”¨é”çš„æŠ€æœ¯æ§åˆ¶æŸä¸€æ—¶åˆ»ä¿®æ”¹æ•°æ®çš„è¿›ç¨‹æ•°ã€‚ ä¸å•æœºæ¨¡å¼ä¸‹çš„é”ä¸ä»…éœ€è¦ä¿è¯è¿›ç¨‹å¯è§ï¼Œè¿˜éœ€è¦è€ƒè™‘è¿›ç¨‹ä¸é”ä¹‹é—´çš„ç½‘ç»œé—®é¢˜ã€‚ï¼ˆæˆ‘è§‰å¾—åˆ†å¸ƒå¼æƒ…å†µä¸‹ä¹‹æ‰€ä»¥é—®é¢˜å˜å¾—å¤æ‚ï¼Œä¸»è¦å°±æ˜¯éœ€è¦è€ƒè™‘åˆ°ç½‘ç»œçš„å»¶æ—¶å’Œä¸å¯é ã€‚ã€‚ã€‚ä¸€ä¸ªå¤§å‘ï¼‰ åˆ†å¸ƒå¼é”è¿˜æ˜¯å¯ä»¥å°†æ ‡è®°å­˜åœ¨å†…å­˜ï¼Œåªæ˜¯è¯¥å†…å­˜ä¸æ˜¯æŸä¸ªè¿›ç¨‹åˆ†é…çš„å†…å­˜è€Œæ˜¯å…¬å…±å†…å­˜å¦‚ Redisã€Memcacheã€‚è‡³äºåˆ©ç”¨æ•°æ®åº“ã€æ–‡ä»¶ç­‰åšé”ä¸å•æœºçš„å®ç°æ˜¯ä¸€æ ·çš„ï¼Œåªè¦ä¿è¯æ ‡è®°èƒ½äº’æ–¥å°±è¡Œã€‚ æˆ‘ä»¬éœ€è¦æ€æ ·çš„åˆ†å¸ƒå¼é”ï¼Ÿ å¯ä»¥ä¿è¯åœ¨åˆ†å¸ƒå¼éƒ¨ç½²çš„åº”ç”¨é›†ç¾¤ä¸­ï¼ŒåŒä¸€ä¸ªæ–¹æ³•åœ¨åŒä¸€æ—¶é—´åªèƒ½è¢«ä¸€å°æœºå™¨ä¸Šçš„ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚ è¿™æŠŠé”è¦æ˜¯ä¸€æŠŠå¯é‡å…¥é”ï¼ˆé¿å…æ­»é”ï¼‰ è¿™æŠŠé”æœ€å¥½æ˜¯ä¸€æŠŠé˜»å¡é”ï¼ˆæ ¹æ®ä¸šåŠ¡éœ€æ±‚è€ƒè™‘è¦ä¸è¦è¿™æ¡ï¼‰ è¿™æŠŠé”æœ€å¥½æ˜¯ä¸€æŠŠå…¬å¹³é”ï¼ˆæ ¹æ®ä¸šåŠ¡éœ€æ±‚è€ƒè™‘è¦ä¸è¦è¿™æ¡ï¼‰ æœ‰é«˜å¯ç”¨çš„è·å–é”å’Œé‡Šæ”¾é”åŠŸèƒ½ è·å–é”å’Œé‡Šæ”¾é”çš„æ€§èƒ½è¦å¥½ åŸºäºæ•°æ®åº“åšåˆ†å¸ƒå¼é” åŸºäºä¹è§‚é” åŸºäºè¡¨ä¸»é”®å”¯ä¸€åšåˆ†å¸ƒå¼é”åˆ©ç”¨ä¸»é”®å”¯ä¸€çš„ç‰¹æ€§ï¼Œå¦‚æœæœ‰å¤šä¸ªè¯·æ±‚åŒæ—¶æäº¤åˆ°æ•°æ®åº“çš„è¯ï¼Œæ•°æ®åº“ä¼šä¿è¯åªæœ‰ä¸€ä¸ªæ“ä½œå¯ä»¥æˆåŠŸï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è®¤ä¸ºæ“ä½œæˆåŠŸçš„é‚£ä¸ªçº¿ç¨‹è·å¾—äº†è¯¥æ–¹æ³•çš„é”ï¼Œå½“æ–¹æ³•æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œæƒ³è¦é‡Šæ”¾é”çš„è¯ï¼Œåˆ é™¤è¿™æ¡æ•°æ®åº“è®°å½•å³å¯ã€‚ ä¸Šé¢è¿™ç§ç®€å•çš„å®ç°æœ‰ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š è¿™æŠŠé”å¼ºä¾èµ–æ•°æ®åº“çš„å¯ç”¨æ€§ï¼Œæ•°æ®åº“æ˜¯ä¸€ä¸ªå•ç‚¹ï¼Œä¸€æ—¦æ•°æ®åº“æŒ‚æ‰ï¼Œä¼šå¯¼è‡´ä¸šåŠ¡ç³»ç»Ÿä¸å¯ç”¨ã€‚ è¿™æŠŠé”æ²¡æœ‰å¤±æ•ˆæ—¶é—´ï¼Œä¸€æ—¦è§£é”æ“ä½œå¤±è´¥ï¼Œå°±ä¼šå¯¼è‡´é”è®°å½•ä¸€ç›´åœ¨æ•°æ®åº“ä¸­ï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•å†è·å¾—åˆ°é”ã€‚ è¿™æŠŠé”åªèƒ½æ˜¯éé˜»å¡çš„ï¼Œå› ä¸ºæ•°æ®çš„ insert æ“ä½œï¼Œä¸€æ—¦æ’å…¥å¤±è´¥å°±ä¼šç›´æ¥æŠ¥é”™ã€‚æ²¡æœ‰è·å¾—é”çš„çº¿ç¨‹å¹¶ä¸ä¼šè¿›å…¥æ’é˜Ÿé˜Ÿåˆ—ï¼Œè¦æƒ³å†æ¬¡è·å¾—é”å°±è¦å†æ¬¡è§¦å‘è·å¾—é”æ“ä½œã€‚ è¿™æŠŠé”æ˜¯éé‡å…¥çš„ï¼ŒåŒä¸€ä¸ªçº¿ç¨‹åœ¨æ²¡æœ‰é‡Šæ”¾é”ä¹‹å‰æ— æ³•å†æ¬¡è·å¾—è¯¥é”ã€‚å› ä¸ºæ•°æ®ä¸­æ•°æ®å·²ç»å­˜åœ¨äº†ã€‚ è¿™æŠŠé”æ˜¯éå…¬å¹³é”ï¼Œæ‰€æœ‰ç­‰å¾…é”çš„çº¿ç¨‹å‡­è¿æ°”å»äº‰å¤ºé”ã€‚ åœ¨ MySQL æ•°æ®åº“ä¸­é‡‡ç”¨ä¸»é”®å†²çªé˜²é‡ï¼Œåœ¨å¤§å¹¶å‘æƒ…å†µä¸‹æœ‰å¯èƒ½ä¼šé€ æˆé”è¡¨ç°è±¡ã€‚ å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æœ‰å…¶ä»–æ–¹å¼è§£å†³ä¸Šé¢çš„é—®é¢˜ã€‚ æ•°æ®åº“æ˜¯å•ç‚¹ï¼Ÿæä¸¤ä¸ªæ•°æ®åº“ï¼Œæ•°æ®ä¹‹å‰åŒå‘åŒæ­¥ï¼Œä¸€æ—¦æŒ‚æ‰å¿«é€Ÿåˆ‡æ¢åˆ°å¤‡åº“ä¸Šã€‚ æ²¡æœ‰å¤±æ•ˆæ—¶é—´ï¼Ÿåªè¦åšä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œæ¯éš”ä¸€å®šæ—¶é—´æŠŠæ•°æ®åº“ä¸­çš„è¶…æ—¶æ•°æ®æ¸…ç†ä¸€éã€‚ éé˜»å¡çš„ï¼Ÿæä¸€ä¸ª while å¾ªç¯ï¼Œç›´åˆ° insert æˆåŠŸå†è¿”å›æˆåŠŸã€‚ éé‡å…¥çš„ï¼Ÿåœ¨æ•°æ®åº“è¡¨ä¸­åŠ ä¸ªå­—æ®µï¼Œè®°å½•å½“å‰è·å¾—é”çš„æœºå™¨çš„ä¸»æœºä¿¡æ¯å’Œçº¿ç¨‹ä¿¡æ¯ï¼Œé‚£ä¹ˆä¸‹æ¬¡å†è·å–é”çš„æ—¶å€™å…ˆæŸ¥è¯¢æ•°æ®åº“ï¼Œå¦‚æœå½“å‰æœºå™¨çš„ä¸»æœºä¿¡æ¯å’Œçº¿ç¨‹ä¿¡æ¯åœ¨æ•°æ®åº“å¯ä»¥æŸ¥åˆ°çš„è¯ï¼Œç›´æ¥æŠŠé”åˆ†é…ç»™ä»–å°±å¯ä»¥äº†ã€‚ éå…¬å¹³çš„ï¼Ÿå†å»ºä¸€å¼ ä¸­é—´è¡¨ï¼Œå°†ç­‰å¾…é”çš„çº¿ç¨‹å…¨è®°å½•ä¸‹æ¥ï¼Œå¹¶æ ¹æ®åˆ›å»ºæ—¶é—´æ’åºï¼Œåªæœ‰æœ€å…ˆåˆ›å»ºçš„å…è®¸è·å–é”ã€‚ æ¯”è¾ƒå¥½çš„åŠæ³•æ˜¯åœ¨ç¨‹åºä¸­ç”Ÿäº§ä¸»é”®è¿›è¡Œé˜²é‡ã€‚ åŸºäºè¡¨å­—æ®µç‰ˆæœ¬å·åšåˆ†å¸ƒå¼é”è¿™ä¸ªç­–ç•¥æºäº mysql çš„ mvcc æœºåˆ¶ï¼Œä½¿ç”¨è¿™ä¸ªç­–ç•¥å…¶å®æœ¬èº«æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œå”¯ä¸€çš„é—®é¢˜å°±æ˜¯å¯¹æ•°æ®è¡¨ä¾µå…¥è¾ƒå¤§ï¼Œæˆ‘ä»¬è¦ä¸ºæ¯ä¸ªè¡¨è®¾è®¡ä¸€ä¸ªç‰ˆæœ¬å·å­—æ®µï¼Œç„¶åå†™ä¸€æ¡åˆ¤æ–­ sql æ¯æ¬¡è¿›è¡Œåˆ¤æ–­ï¼Œå¢åŠ äº†æ•°æ®åº“æ“ä½œçš„æ¬¡æ•°ï¼Œåœ¨é«˜å¹¶å‘çš„è¦æ±‚ä¸‹ï¼Œå¯¹æ•°æ®åº“è¿æ¥çš„å¼€é”€ä¹Ÿæ˜¯æ— æ³•å¿å—çš„ã€‚ åŸºäºæ‚²è§‚é” åŸºäºæ•°æ®åº“æ’ä»–é”åšåˆ†å¸ƒå¼é”åœ¨æŸ¥è¯¢è¯­å¥åé¢å¢åŠ for updateï¼Œæ•°æ®åº“ä¼šåœ¨æŸ¥è¯¢è¿‡ç¨‹ä¸­ç»™æ•°æ®åº“è¡¨å¢åŠ æ’ä»–é” (æ³¨æ„ï¼š InnoDB å¼•æ“åœ¨åŠ é”çš„æ—¶å€™ï¼Œåªæœ‰é€šè¿‡ç´¢å¼•è¿›è¡Œæ£€ç´¢çš„æ—¶å€™æ‰ä¼šä½¿ç”¨è¡Œçº§é”ï¼Œå¦åˆ™ä¼šä½¿ç”¨è¡¨çº§é”ã€‚è¿™é‡Œæˆ‘ä»¬å¸Œæœ›ä½¿ç”¨è¡Œçº§é”ï¼Œå°±è¦ç»™è¦æ‰§è¡Œçš„æ–¹æ³•å­—æ®µåæ·»åŠ ç´¢å¼•ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªç´¢å¼•ä¸€å®šè¦åˆ›å»ºæˆå”¯ä¸€ç´¢å¼•ï¼Œå¦åˆ™ä¼šå‡ºç°å¤šä¸ªé‡è½½æ–¹æ³•ä¹‹é—´æ— æ³•åŒæ—¶è¢«è®¿é—®çš„é—®é¢˜ã€‚é‡è½½æ–¹æ³•çš„è¯å»ºè®®æŠŠå‚æ•°ç±»å‹ä¹ŸåŠ ä¸Šã€‚)ã€‚å½“æŸæ¡è®°å½•è¢«åŠ ä¸Šæ’ä»–é”ä¹‹åï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•å†åœ¨è¯¥è¡Œè®°å½•ä¸Šå¢åŠ æ’ä»–é”ã€‚ æˆ‘ä»¬å¯ä»¥è®¤ä¸ºè·å¾—æ’ä»–é”çš„çº¿ç¨‹å³å¯è·å¾—åˆ†å¸ƒå¼é”ï¼Œå½“è·å–åˆ°é”ä¹‹åï¼Œå¯ä»¥æ‰§è¡Œæ–¹æ³•çš„ä¸šåŠ¡é€»è¾‘ï¼Œæ‰§è¡Œå®Œæ–¹æ³•ä¹‹åï¼Œé€šè¿‡connection.commit()æ“ä½œæ¥é‡Šæ”¾é”ã€‚ è¿™ç§æ–¹æ³•å¯ä»¥æœ‰æ•ˆçš„è§£å†³ä¸Šé¢æåˆ°çš„æ— æ³•é‡Šæ”¾é”å’Œé˜»å¡é”çš„é—®é¢˜ã€‚ é˜»å¡é”ï¼Ÿ for updateè¯­å¥ä¼šåœ¨æ‰§è¡ŒæˆåŠŸåç«‹å³è¿”å›ï¼Œåœ¨æ‰§è¡Œå¤±è´¥æ—¶ä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€ï¼Œç›´åˆ°æˆåŠŸã€‚ é”å®šä¹‹åæœåŠ¡å®•æœºï¼Œæ— æ³•é‡Šæ”¾ï¼Ÿä½¿ç”¨è¿™ç§æ–¹å¼ï¼ŒæœåŠ¡å®•æœºä¹‹åæ•°æ®åº“ä¼šè‡ªå·±æŠŠé”é‡Šæ”¾æ‰ã€‚ ä½†æ˜¯è¿˜æ˜¯æ— æ³•ç›´æ¥è§£å†³æ•°æ®åº“å•ç‚¹å’Œå¯é‡å…¥é—®é¢˜ã€‚ è¿™é‡Œè¿˜å¯èƒ½å­˜åœ¨å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼Œè™½ç„¶æˆ‘ä»¬å¯¹æ–¹æ³•å­—æ®µåä½¿ç”¨äº†å”¯ä¸€ç´¢å¼•ï¼Œå¹¶ä¸”æ˜¾ç¤ºä½¿ç”¨ for update æ¥ä½¿ç”¨è¡Œçº§é”ã€‚ä½†æ˜¯ï¼ŒMySQL ä¼šå¯¹æŸ¥è¯¢è¿›è¡Œä¼˜åŒ–ï¼Œå³ä¾¿åœ¨æ¡ä»¶ä¸­ä½¿ç”¨äº†ç´¢å¼•å­—æ®µï¼Œä½†æ˜¯å¦ä½¿ç”¨ç´¢å¼•æ¥æ£€ç´¢æ•°æ®æ˜¯ç”± MySQL é€šè¿‡åˆ¤æ–­ä¸åŒæ‰§è¡Œè®¡åˆ’çš„ä»£ä»·æ¥å†³å®šçš„ï¼Œå¦‚æœ MySQL è®¤ä¸ºå…¨è¡¨æ‰«æ•ˆç‡æ›´é«˜ï¼Œæ¯”å¦‚å¯¹ä¸€äº›å¾ˆå°çš„è¡¨ï¼Œå®ƒå°±ä¸ä¼šä½¿ç”¨ç´¢å¼•ï¼Œè¿™ç§æƒ…å†µä¸‹ InnoDB å°†ä½¿ç”¨è¡¨é”ï¼Œè€Œä¸æ˜¯è¡Œé”ã€‚å¦‚æœå‘ç”Ÿè¿™ç§æƒ…å†µå°±æ‚²å‰§äº†ã€‚ã€‚ã€‚ è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æˆ‘ä»¬è¦ä½¿ç”¨æ’ä»–é”æ¥è¿›è¡Œåˆ†å¸ƒå¼é”çš„ lockï¼Œé‚£ä¹ˆä¸€ä¸ªæ’ä»–é”é•¿æ—¶é—´ä¸æäº¤ï¼Œå°±ä¼šå ç”¨æ•°æ®åº“è¿æ¥ã€‚ä¸€æ—¦ç±»ä¼¼çš„è¿æ¥å˜å¾—å¤šäº†ï¼Œå°±å¯èƒ½æŠŠæ•°æ®åº“è¿æ¥æ± æ’‘çˆ†ã€‚ ä¼˜ç¼ºç‚¹ä¼˜ç‚¹ï¼šç®€å•ï¼Œæ˜“äºç†è§£ ç¼ºç‚¹ï¼šä¼šæœ‰å„ç§å„æ ·çš„é—®é¢˜ï¼ˆæ“ä½œæ•°æ®åº“éœ€è¦ä¸€å®šçš„å¼€é”€ï¼Œä½¿ç”¨æ•°æ®åº“çš„è¡Œçº§é”å¹¶ä¸ä¸€å®šé è°±ï¼Œæ€§èƒ½ä¸é è°±ï¼‰ åŸºäº Redis åšåˆ†å¸ƒå¼é”åŸºäº redis çš„ setnx()ã€expire() æ–¹æ³•åšåˆ†å¸ƒå¼é”setnx()setnx çš„å«ä¹‰å°±æ˜¯ SET if Not Existsï¼Œå…¶ä¸»è¦æœ‰ä¸¤ä¸ªå‚æ•° setnx(key, value)ã€‚è¯¥æ–¹æ³•æ˜¯åŸå­çš„ï¼Œå¦‚æœ key ä¸å­˜åœ¨ï¼Œåˆ™è®¾ç½®å½“å‰ key æˆåŠŸï¼Œè¿”å› 1ï¼›å¦‚æœå½“å‰ key å·²ç»å­˜åœ¨ï¼Œåˆ™è®¾ç½®å½“å‰ key å¤±è´¥ï¼Œè¿”å› 0ã€‚ expire()expire è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œè¦æ³¨æ„çš„æ˜¯ setnx å‘½ä»¤ä¸èƒ½è®¾ç½® key çš„è¶…æ—¶æ—¶é—´ï¼Œåªèƒ½é€šè¿‡ expire() æ¥å¯¹ key è®¾ç½®ã€‚ ä½¿ç”¨æ­¥éª¤1ã€setnx(lockkey, 1) å¦‚æœè¿”å› 0ï¼Œåˆ™è¯´æ˜å ä½å¤±è´¥ï¼›å¦‚æœè¿”å› 1ï¼Œåˆ™è¯´æ˜å ä½æˆåŠŸ 2ã€expire() å‘½ä»¤å¯¹ lockkey è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œä¸ºçš„æ˜¯é¿å…æ­»é”é—®é¢˜ã€‚ 3ã€æ‰§è¡Œå®Œä¸šåŠ¡ä»£ç åï¼Œå¯ä»¥é€šè¿‡ delete å‘½ä»¤åˆ é™¤ keyã€‚ è¿™ä¸ªæ–¹æ¡ˆå…¶å®æ˜¯å¯ä»¥è§£å†³æ—¥å¸¸å·¥ä½œä¸­çš„éœ€æ±‚çš„ï¼Œä½†ä»æŠ€æœ¯æ–¹æ¡ˆçš„æ¢è®¨ä¸Šæ¥è¯´ï¼Œå¯èƒ½è¿˜æœ‰ä¸€äº›å¯ä»¥å®Œå–„çš„åœ°æ–¹ã€‚æ¯”å¦‚ï¼Œå¦‚æœåœ¨ç¬¬ä¸€æ­¥ setnx æ‰§è¡ŒæˆåŠŸåï¼Œåœ¨ expire() å‘½ä»¤æ‰§è¡ŒæˆåŠŸå‰ï¼Œå‘ç”Ÿäº†å®•æœºçš„ç°è±¡ï¼Œé‚£ä¹ˆå°±ä¾ç„¶ä¼šå‡ºç°æ­»é”çš„é—®é¢˜ï¼Œæ‰€ä»¥å¦‚æœè¦å¯¹å…¶è¿›è¡Œå®Œå–„çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ redis çš„ setnx()ã€get() å’Œ getset() æ–¹æ³•æ¥å®ç°åˆ†å¸ƒå¼é”ã€‚ åŸºäº redis çš„ setnx()ã€get()ã€getset()æ–¹æ³•åšåˆ†å¸ƒå¼é”è¿™ä¸ªæ–¹æ¡ˆçš„èƒŒæ™¯ä¸»è¦æ˜¯åœ¨ setnx() å’Œ expire() çš„æ–¹æ¡ˆä¸Šé’ˆå¯¹å¯èƒ½å­˜åœ¨çš„æ­»é”é—®é¢˜ï¼Œåšäº†ä¸€äº›ä¼˜åŒ–ã€‚ getset()è¿™ä¸ªå‘½ä»¤ä¸»è¦æœ‰ä¸¤ä¸ªå‚æ•° getset(keyï¼ŒnewValue)ã€‚è¯¥æ–¹æ³•æ˜¯åŸå­çš„ï¼Œå¯¹ key è®¾ç½® newValue è¿™ä¸ªå€¼ï¼Œå¹¶ä¸”è¿”å› key åŸæ¥çš„æ—§å€¼ã€‚å‡è®¾ key åŸæ¥æ˜¯ä¸å­˜åœ¨çš„ï¼Œé‚£ä¹ˆå¤šæ¬¡æ‰§è¡Œè¿™ä¸ªå‘½ä»¤ï¼Œä¼šå‡ºç°ä¸‹è¾¹çš„æ•ˆæœï¼š getset(key, â€œvalue1â€) è¿”å› null æ­¤æ—¶ key çš„å€¼ä¼šè¢«è®¾ç½®ä¸º value1 getset(key, â€œvalue2â€) è¿”å› value1 æ­¤æ—¶ key çš„å€¼ä¼šè¢«è®¾ç½®ä¸º value2 ä¾æ¬¡ç±»æ¨ï¼ ä½¿ç”¨æ­¥éª¤ setnx(lockkey, å½“å‰æ—¶é—´+è¿‡æœŸè¶…æ—¶æ—¶é—´)ï¼Œå¦‚æœè¿”å› 1ï¼Œåˆ™è·å–é”æˆåŠŸï¼›å¦‚æœè¿”å› 0 åˆ™æ²¡æœ‰è·å–åˆ°é”ï¼Œè½¬å‘ 2ã€‚ get(lockkey) è·å–å€¼ oldExpireTime ï¼Œå¹¶å°†è¿™ä¸ª value å€¼ä¸å½“å‰çš„ç³»ç»Ÿæ—¶é—´è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœå°äºå½“å‰ç³»ç»Ÿæ—¶é—´ï¼Œåˆ™è®¤ä¸ºè¿™ä¸ªé”å·²ç»è¶…æ—¶ï¼Œå¯ä»¥å…è®¸åˆ«çš„è¯·æ±‚é‡æ–°è·å–ï¼Œè½¬å‘ 3ã€‚ è®¡ç®— newExpireTime = å½“å‰æ—¶é—´+è¿‡æœŸè¶…æ—¶æ—¶é—´ï¼Œç„¶å getset(lockkey, newExpireTime) ä¼šè¿”å›å½“å‰ lockkey çš„å€¼currentExpireTimeã€‚ åˆ¤æ–­ currentExpireTime ä¸ oldExpireTime æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœç›¸ç­‰ï¼Œè¯´æ˜å½“å‰ getset è®¾ç½®æˆåŠŸï¼Œè·å–åˆ°äº†é”ã€‚å¦‚æœä¸ç›¸ç­‰ï¼Œè¯´æ˜è¿™ä¸ªé”åˆè¢«åˆ«çš„è¯·æ±‚è·å–èµ°äº†ï¼Œé‚£ä¹ˆå½“å‰è¯·æ±‚å¯ä»¥ç›´æ¥è¿”å›å¤±è´¥ï¼Œæˆ–è€…ç»§ç»­é‡è¯•ã€‚ åœ¨è·å–åˆ°é”ä¹‹åï¼Œå½“å‰çº¿ç¨‹å¯ä»¥å¼€å§‹è‡ªå·±çš„ä¸šåŠ¡å¤„ç†ï¼Œå½“å¤„ç†å®Œæ¯•åï¼Œæ¯”è¾ƒè‡ªå·±çš„å¤„ç†æ—¶é—´å’Œå¯¹äºé”è®¾ç½®çš„è¶…æ—¶æ—¶é—´ï¼Œå¦‚æœå°äºé”è®¾ç½®çš„è¶…æ—¶æ—¶é—´ï¼Œåˆ™ç›´æ¥æ‰§è¡Œ delete é‡Šæ”¾é”ï¼›å¦‚æœå¤§äºé”è®¾ç½®çš„è¶…æ—¶æ—¶é—´ï¼Œåˆ™ä¸éœ€è¦å†é”è¿›è¡Œå¤„ç†ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576import cn.com.tpig.cache.redis.RedisService;import cn.com.tpig.utils.SpringUtils;//redisåˆ†å¸ƒå¼é”public final class RedisLockUtil &#123; private static final int defaultExpire = 60; private RedisLockUtil() &#123; // &#125; /** * åŠ é” * @param key redis key * @param expire è¿‡æœŸæ—¶é—´ï¼Œå•ä½ç§’ * @return true:åŠ é”æˆåŠŸï¼Œfalseï¼ŒåŠ é”å¤±è´¥ */ public static boolean lock(String key, int expire) &#123; RedisService redisService = SpringUtils.getBean(RedisService.class); long status = redisService.setnx(key, \"1\"); if(status == 1) &#123; redisService.expire(key, expire); return true; &#125; return false; &#125; public static boolean lock(String key) &#123; return lock2(key, defaultExpire); &#125; /** * åŠ é” * @param key redis key * @param expire è¿‡æœŸæ—¶é—´ï¼Œå•ä½ç§’ * @return true:åŠ é”æˆåŠŸï¼Œfalseï¼ŒåŠ é”å¤±è´¥ */ public static boolean lock2(String key, int expire) &#123; RedisService redisService = SpringUtils.getBean(RedisService.class); long value = System.currentTimeMillis() + expire; long status = redisService.setnx(key, String.valueOf(value)); if(status == 1) &#123; return true; &#125; long oldExpireTime = Long.parseLong(redisService.get(key, \"0\")); if(oldExpireTime &lt; System.currentTimeMillis()) &#123; //è¶…æ—¶ long newExpireTime = System.currentTimeMillis() + expire; long currentExpireTime = Long.parseLong(redisService.getSet(key, String.valueOf(newExpireTime))); if(currentExpireTime == oldExpireTime) &#123; return true; &#125; &#125; return false; &#125; public static void unLock1(String key) &#123; RedisService redisService = SpringUtils.getBean(RedisService.class); redisService.del(key); &#125; public static void unLock2(String key) &#123; RedisService redisService = SpringUtils.getBean(RedisService.class); long oldExpireTime = Long.parseLong(redisService.get(key, \"0\")); if(oldExpireTime &gt; System.currentTimeMillis()) &#123; redisService.del(key); &#125; &#125;&#125; 123456789101112131415public void drawRedPacket(long userId) &#123; String key = \"draw.redpacket.userid:\" + userId; boolean lock = RedisLockUtil.lock2(key, 60); if(lock) &#123; try &#123; //é¢†å–æ“ä½œ &#125; finally &#123; //é‡Šæ”¾é” RedisLockUtil.unLock(key); &#125; &#125; else &#123; new RuntimeException(\"é‡å¤é¢†å–å¥–åŠ±\"); &#125;&#125; åŸºäº Redlock åšåˆ†å¸ƒå¼é”Redlock æ˜¯ Redis çš„ä½œè€… antirez ç»™å‡ºçš„é›†ç¾¤æ¨¡å¼çš„ Redis åˆ†å¸ƒå¼é”ï¼Œå®ƒåŸºäº N ä¸ªå®Œå…¨ç‹¬ç«‹çš„ Redis èŠ‚ç‚¹ï¼ˆé€šå¸¸æƒ…å†µä¸‹ N å¯ä»¥è®¾ç½®æˆ 5ï¼‰ã€‚ ç®—æ³•çš„æ­¥éª¤å¦‚ä¸‹ï¼š 1ã€å®¢æˆ·ç«¯è·å–å½“å‰æ—¶é—´ï¼Œä»¥æ¯«ç§’ä¸ºå•ä½ã€‚ 2ã€å®¢æˆ·ç«¯å°è¯•è·å– N ä¸ªèŠ‚ç‚¹çš„é”ï¼Œï¼ˆæ¯ä¸ªèŠ‚ç‚¹è·å–é”çš„æ–¹å¼å’Œå‰é¢è¯´çš„ç¼“å­˜é”ä¸€æ ·ï¼‰ï¼ŒN ä¸ªèŠ‚ç‚¹ä»¥ç›¸åŒçš„ key å’Œ value è·å–é”ã€‚å®¢æˆ·ç«¯éœ€è¦è®¾ç½®æ¥å£è®¿é—®è¶…æ—¶ï¼Œæ¥å£è¶…æ—¶æ—¶é—´éœ€è¦è¿œè¿œå°äºé”è¶…æ—¶æ—¶é—´ï¼Œæ¯”å¦‚é”è‡ªåŠ¨é‡Šæ”¾çš„æ—¶é—´æ˜¯ 10sï¼Œé‚£ä¹ˆæ¥å£è¶…æ—¶å¤§æ¦‚è®¾ç½® 5-50msã€‚è¿™æ ·å¯ä»¥åœ¨æœ‰ redis èŠ‚ç‚¹å®•æœºåï¼Œè®¿é—®è¯¥èŠ‚ç‚¹æ—¶èƒ½å°½å¿«è¶…æ—¶ï¼Œè€Œå‡å°é”çš„æ­£å¸¸ä½¿ç”¨ã€‚ 3ã€å®¢æˆ·ç«¯è®¡ç®—åœ¨è·å¾—é”çš„æ—¶å€™èŠ±è´¹äº†å¤šå°‘æ—¶é—´ï¼Œæ–¹æ³•æ˜¯ç”¨å½“å‰æ—¶é—´å‡å»åœ¨æ­¥éª¤ä¸€è·å–çš„æ—¶é—´ï¼Œåªæœ‰å®¢æˆ·ç«¯è·å¾—äº†è¶…è¿‡ 3 ä¸ªèŠ‚ç‚¹çš„é”ï¼Œè€Œä¸”è·å–é”çš„æ—¶é—´å°äºé”çš„è¶…æ—¶æ—¶é—´ï¼Œå®¢æˆ·ç«¯æ‰è·å¾—äº†åˆ†å¸ƒå¼é”ã€‚ 4ã€å®¢æˆ·ç«¯è·å–çš„é”çš„æ—¶é—´ä¸ºè®¾ç½®çš„é”è¶…æ—¶æ—¶é—´å‡å»æ­¥éª¤ä¸‰è®¡ç®—å‡ºçš„è·å–é”èŠ±è´¹æ—¶é—´ã€‚ 5ã€å¦‚æœå®¢æˆ·ç«¯è·å–é”å¤±è´¥äº†ï¼Œå®¢æˆ·ç«¯ä¼šä¾æ¬¡åˆ é™¤æ‰€æœ‰çš„é”ã€‚ä½¿ç”¨ Redlock ç®—æ³•ï¼Œå¯ä»¥ä¿è¯åœ¨æŒ‚æ‰æœ€å¤š 2 ä¸ªèŠ‚ç‚¹çš„æ—¶å€™ï¼Œåˆ†å¸ƒå¼é”æœåŠ¡ä»ç„¶èƒ½å·¥ä½œï¼Œè¿™ç›¸æ¯”ä¹‹å‰çš„æ•°æ®åº“é”å’Œç¼“å­˜é”å¤§å¤§æé«˜äº†å¯ç”¨æ€§ï¼Œç”±äº redis çš„é«˜æ•ˆæ€§èƒ½ï¼Œåˆ†å¸ƒå¼ç¼“å­˜é”æ€§èƒ½å¹¶ä¸æ¯”æ•°æ®åº“é”å·®ã€‚ ä½†æ˜¯ï¼Œæœ‰ä¸€ä½åˆ†å¸ƒå¼çš„ä¸“å®¶å†™äº†ä¸€ç¯‡æ–‡ç« ã€ŠHow to do distributed lockingã€‹ï¼Œè´¨ç–‘ Redlock çš„æ­£ç¡®æ€§ã€‚ https://mp.weixin.qq.com/s/1bPLk_VZhZ0QYNZS8LkviA https://blog.csdn.net/jek123456/article/details/72954106 ä¼˜ç¼ºç‚¹ä¼˜ç‚¹ï¼š æ€§èƒ½é«˜ ç¼ºç‚¹ï¼š å¤±æ•ˆæ—¶é—´è®¾ç½®å¤šé•¿æ—¶é—´ä¸ºå¥½ï¼Ÿå¦‚ä½•è®¾ç½®çš„å¤±æ•ˆæ—¶é—´å¤ªçŸ­ï¼Œæ–¹æ³•æ²¡ç­‰æ‰§è¡Œå®Œï¼Œé”å°±è‡ªåŠ¨é‡Šæ”¾äº†ï¼Œé‚£ä¹ˆå°±ä¼šäº§ç”Ÿå¹¶å‘é—®é¢˜ã€‚å¦‚æœè®¾ç½®çš„æ—¶é—´å¤ªé•¿ï¼Œå…¶ä»–è·å–é”çš„çº¿ç¨‹å°±å¯èƒ½è¦å¹³ç™½çš„å¤šç­‰ä¸€æ®µæ—¶é—´ã€‚ åŸºäº redisson åšåˆ†å¸ƒå¼é”redisson æ˜¯ redis å®˜æ–¹çš„åˆ†å¸ƒå¼é”ç»„ä»¶ã€‚GitHub åœ°å€ï¼šhttps://github.com/redisson/redisson ä¸Šé¢çš„è¿™ä¸ªé—®é¢˜ â€”â€”&gt; å¤±æ•ˆæ—¶é—´è®¾ç½®å¤šé•¿æ—¶é—´ä¸ºå¥½ï¼Ÿè¿™ä¸ªé—®é¢˜åœ¨ redisson çš„åšæ³•æ˜¯ï¼šæ¯è·å¾—ä¸€ä¸ªé”æ—¶ï¼Œåªè®¾ç½®ä¸€ä¸ªå¾ˆçŸ­çš„è¶…æ—¶æ—¶é—´ï¼ŒåŒæ—¶èµ·ä¸€ä¸ªçº¿ç¨‹åœ¨æ¯æ¬¡å¿«è¦åˆ°è¶…æ—¶æ—¶é—´æ—¶å»åˆ·æ–°é”çš„è¶…æ—¶æ—¶é—´ã€‚åœ¨é‡Šæ”¾é”çš„åŒæ—¶ç»“æŸè¿™ä¸ªçº¿ç¨‹ã€‚ åŸºäº ZooKeeper åšåˆ†å¸ƒå¼é”zookeeper é”ç›¸å…³åŸºç¡€çŸ¥è¯† zk ä¸€èˆ¬ç”±å¤šä¸ªèŠ‚ç‚¹æ„æˆï¼ˆå•æ•°ï¼‰ï¼Œé‡‡ç”¨ zab ä¸€è‡´æ€§åè®®ã€‚å› æ­¤å¯ä»¥å°† zk çœ‹æˆä¸€ä¸ªå•ç‚¹ç»“æ„ï¼Œå¯¹å…¶ä¿®æ”¹æ•°æ®å…¶å†…éƒ¨è‡ªåŠ¨å°†æ‰€æœ‰èŠ‚ç‚¹æ•°æ®è¿›è¡Œä¿®æ”¹è€Œåæ‰æä¾›æŸ¥è¯¢æœåŠ¡ã€‚ zk çš„æ•°æ®ä»¥ç›®å½•æ ‘çš„å½¢å¼ï¼Œæ¯ä¸ªç›®å½•ç§°ä¸º znodeï¼Œ znode ä¸­å¯å­˜å‚¨æ•°æ®ï¼ˆä¸€èˆ¬ä¸è¶…è¿‡ 1Mï¼‰ï¼Œè¿˜å¯ä»¥åœ¨å…¶ä¸­å¢åŠ å­èŠ‚ç‚¹ã€‚ å­èŠ‚ç‚¹æœ‰ä¸‰ç§ç±»å‹ã€‚åºåˆ—åŒ–èŠ‚ç‚¹ï¼Œæ¯åœ¨è¯¥èŠ‚ç‚¹ä¸‹å¢åŠ ä¸€ä¸ªèŠ‚ç‚¹è‡ªåŠ¨ç»™è¯¥èŠ‚ç‚¹çš„åç§°ä¸Šè‡ªå¢ã€‚ä¸´æ—¶èŠ‚ç‚¹ï¼Œä¸€æ—¦åˆ›å»ºè¿™ä¸ª znode çš„å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨å¤±å»è”ç³»ï¼Œè¿™ä¸ª znode ä¹Ÿå°†è‡ªåŠ¨åˆ é™¤ã€‚æœ€åå°±æ˜¯æ™®é€šèŠ‚ç‚¹ã€‚ Watch æœºåˆ¶ï¼Œclient å¯ä»¥ç›‘æ§æ¯ä¸ªèŠ‚ç‚¹çš„å˜åŒ–ï¼Œå½“äº§ç”Ÿå˜åŒ–ä¼šç»™ client äº§ç”Ÿä¸€ä¸ªäº‹ä»¶ã€‚ zk åŸºæœ¬é” åŸç†ï¼šåˆ©ç”¨ä¸´æ—¶èŠ‚ç‚¹ä¸ watch æœºåˆ¶ã€‚æ¯ä¸ªé”å ç”¨ä¸€ä¸ªæ™®é€šèŠ‚ç‚¹ /lockï¼Œå½“éœ€è¦è·å–é”æ—¶åœ¨ /lock ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªä¸´æ—¶èŠ‚ç‚¹ï¼Œåˆ›å»ºæˆåŠŸåˆ™è¡¨ç¤ºè·å–é”æˆåŠŸï¼Œå¤±è´¥åˆ™ watch/lock èŠ‚ç‚¹ï¼Œæœ‰åˆ é™¤æ“ä½œåå†å»äº‰é”ã€‚ä¸´æ—¶èŠ‚ç‚¹å¥½å¤„åœ¨äºå½“è¿›ç¨‹æŒ‚æ‰åèƒ½è‡ªåŠ¨ä¸Šé”çš„èŠ‚ç‚¹è‡ªåŠ¨åˆ é™¤å³å–æ¶ˆé”ã€‚ ç¼ºç‚¹ï¼šæ‰€æœ‰å–é”å¤±è´¥çš„è¿›ç¨‹éƒ½ç›‘å¬çˆ¶èŠ‚ç‚¹ï¼Œå¾ˆå®¹æ˜“å‘ç”Ÿç¾Šç¾¤æ•ˆåº”ï¼Œå³å½“é‡Šæ”¾é”åæ‰€æœ‰ç­‰å¾…è¿›ç¨‹ä¸€èµ·æ¥åˆ›å»ºèŠ‚ç‚¹ï¼Œå¹¶å‘é‡å¾ˆå¤§ã€‚ zk é”ä¼˜åŒ– åŸç†ï¼šä¸Šé”æ”¹ä¸ºåˆ›å»ºä¸´æ—¶æœ‰åºèŠ‚ç‚¹ï¼Œæ¯ä¸ªä¸Šé”çš„èŠ‚ç‚¹å‡èƒ½åˆ›å»ºèŠ‚ç‚¹æˆåŠŸï¼Œåªæ˜¯å…¶åºå·ä¸åŒã€‚åªæœ‰åºå·æœ€å°çš„å¯ä»¥æ‹¥æœ‰é”ï¼Œå¦‚æœè¿™ä¸ªèŠ‚ç‚¹åºå·ä¸æ˜¯æœ€å°çš„åˆ™ watch åºå·æ¯”æœ¬èº«å°çš„å‰ä¸€ä¸ªèŠ‚ç‚¹ (å…¬å¹³é”)ã€‚ æ­¥éª¤ï¼š åœ¨ /lock èŠ‚ç‚¹ä¸‹åˆ›å»ºä¸€ä¸ªæœ‰åºä¸´æ—¶èŠ‚ç‚¹ (EPHEMERAL_SEQUENTIAL)ã€‚ åˆ¤æ–­åˆ›å»ºçš„èŠ‚ç‚¹åºå·æ˜¯å¦æœ€å°ï¼Œå¦‚æœæ˜¯æœ€å°åˆ™è·å–é”æˆåŠŸã€‚ä¸æ˜¯åˆ™å–é”å¤±è´¥ï¼Œç„¶å watch åºå·æ¯”æœ¬èº«å°çš„å‰ä¸€ä¸ªèŠ‚ç‚¹ã€‚ å½“å–é”å¤±è´¥ï¼Œè®¾ç½® watch ååˆ™ç­‰å¾… watch äº‹ä»¶åˆ°æ¥åï¼Œå†æ¬¡åˆ¤æ–­æ˜¯å¦åºå·æœ€å°ã€‚ å–é”æˆåŠŸåˆ™æ‰§è¡Œä»£ç ï¼Œæœ€åé‡Šæ”¾é”ï¼ˆåˆ é™¤è¯¥èŠ‚ç‚¹ï¼‰ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169import java.io.IOException;import java.util.ArrayList;import java.util.Collections;import java.util.List;import java.util.concurrent.CountDownLatch;import java.util.concurrent.TimeUnit;import java.util.concurrent.locks.Condition;import java.util.concurrent.locks.Lock;import org.apache.zookeeper.CreateMode;import org.apache.zookeeper.KeeperException;import org.apache.zookeeper.WatchedEvent;import org.apache.zookeeper.Watcher;import org.apache.zookeeper.ZooDefs;import org.apache.zookeeper.ZooKeeper;import org.apache.zookeeper.data.Stat;public class DistributedLock implements Lock, Watcher&#123; private ZooKeeper zk; private String root = \"/locks\";//æ ¹ private String lockName;//ç«äº‰èµ„æºçš„æ ‡å¿— private String waitNode;//ç­‰å¾…å‰ä¸€ä¸ªé” private String myZnode;//å½“å‰é” private CountDownLatch latch;//è®¡æ•°å™¨ private int sessionTimeout = 30000; private List&lt;Exception&gt; exception = new ArrayList&lt;Exception&gt;(); /** * åˆ›å»ºåˆ†å¸ƒå¼é”,ä½¿ç”¨å‰è¯·ç¡®è®¤configé…ç½®çš„zookeeperæœåŠ¡å¯ç”¨ * @param config 127.0.0.1:2181 * @param lockName ç«äº‰èµ„æºæ ‡å¿—,lockNameä¸­ä¸èƒ½åŒ…å«å•è¯lock */ public DistributedLock(String config, String lockName)&#123; this.lockName = lockName; // åˆ›å»ºä¸€ä¸ªä¸æœåŠ¡å™¨çš„è¿æ¥ try &#123; zk = new ZooKeeper(config, sessionTimeout, this); Stat stat = zk.exists(root, false); if(stat == null)&#123; // åˆ›å»ºæ ¹èŠ‚ç‚¹ zk.create(root, new byte[0], ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT); &#125; &#125; catch (IOException e) &#123; exception.add(e); &#125; catch (KeeperException e) &#123; exception.add(e); &#125; catch (InterruptedException e) &#123; exception.add(e); &#125; &#125; /** * zookeeperèŠ‚ç‚¹çš„ç›‘è§†å™¨ */ public void process(WatchedEvent event) &#123; if(this.latch != null) &#123; this.latch.countDown(); &#125; &#125; public void lock() &#123; if(exception.size() &gt; 0)&#123; throw new LockException(exception.get(0)); &#125; try &#123; if(this.tryLock())&#123; System.out.println(\"Thread \" + Thread.currentThread().getId() + \" \" +myZnode + \" get lock true\"); return; &#125; else&#123; waitForLock(waitNode, sessionTimeout);//ç­‰å¾…é” &#125; &#125; catch (KeeperException e) &#123; throw new LockException(e); &#125; catch (InterruptedException e) &#123; throw new LockException(e); &#125; &#125; public boolean tryLock() &#123; try &#123; String splitStr = \"_lock_\"; if(lockName.contains(splitStr)) throw new LockException(\"lockName can not contains \\\\u000B\"); //åˆ›å»ºä¸´æ—¶å­èŠ‚ç‚¹ myZnode = zk.create(root + \"/\" + lockName + splitStr, new byte[0], ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL_SEQUENTIAL); System.out.println(myZnode + \" is created \"); //å–å‡ºæ‰€æœ‰å­èŠ‚ç‚¹ List&lt;String&gt; subNodes = zk.getChildren(root, false); //å–å‡ºæ‰€æœ‰lockNameçš„é” List&lt;String&gt; lockObjNodes = new ArrayList&lt;String&gt;(); for (String node : subNodes) &#123; String _node = node.split(splitStr)[0]; if(_node.equals(lockName))&#123; lockObjNodes.add(node); &#125; &#125; Collections.sort(lockObjNodes); System.out.println(myZnode + \"==\" + lockObjNodes.get(0)); if(myZnode.equals(root+\"/\"+lockObjNodes.get(0)))&#123; //å¦‚æœæ˜¯æœ€å°çš„èŠ‚ç‚¹,åˆ™è¡¨ç¤ºå–å¾—é” return true; &#125; //å¦‚æœä¸æ˜¯æœ€å°çš„èŠ‚ç‚¹ï¼Œæ‰¾åˆ°æ¯”è‡ªå·±å°1çš„èŠ‚ç‚¹ String subMyZnode = myZnode.substring(myZnode.lastIndexOf(\"/\") + 1); waitNode = lockObjNodes.get(Collections.binarySearch(lockObjNodes, subMyZnode) - 1); &#125; catch (KeeperException e) &#123; throw new LockException(e); &#125; catch (InterruptedException e) &#123; throw new LockException(e); &#125; return false; &#125; public boolean tryLock(long time, TimeUnit unit) &#123; try &#123; if(this.tryLock())&#123; return true; &#125; return waitForLock(waitNode,time); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; return false; &#125; private boolean waitForLock(String lower, long waitTime) throws InterruptedException, KeeperException &#123; Stat stat = zk.exists(root + \"/\" + lower,true); //åˆ¤æ–­æ¯”è‡ªå·±å°ä¸€ä¸ªæ•°çš„èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨,å¦‚æœä¸å­˜åœ¨åˆ™æ— éœ€ç­‰å¾…é”,åŒæ—¶æ³¨å†Œç›‘å¬ if(stat != null)&#123; System.out.println(\"Thread \" + Thread.currentThread().getId() + \" waiting for \" + root + \"/\" + lower); this.latch = new CountDownLatch(1); this.latch.await(waitTime, TimeUnit.MILLISECONDS); this.latch = null; &#125; return true; &#125; public void unlock() &#123; try &#123; System.out.println(\"unlock \" + myZnode); zk.delete(myZnode,-1); myZnode = null; zk.close(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; catch (KeeperException e) &#123; e.printStackTrace(); &#125; &#125; public void lockInterruptibly() throws InterruptedException &#123; this.lock(); &#125; public Condition newCondition() &#123; return null; &#125; public class LockException extends RuntimeException &#123; private static final long serialVersionUID = 1L; public LockException(String e)&#123; super(e); &#125; public LockException(Exception e)&#123; super(e); &#125; &#125;&#125; ä¼˜ç¼ºç‚¹ä¼˜ç‚¹ï¼š æœ‰æ•ˆçš„è§£å†³å•ç‚¹é—®é¢˜ï¼Œä¸å¯é‡å…¥é—®é¢˜ï¼Œéé˜»å¡é—®é¢˜ä»¥åŠé”æ— æ³•é‡Šæ”¾çš„é—®é¢˜ã€‚å®ç°èµ·æ¥è¾ƒä¸ºç®€å•ã€‚ ç¼ºç‚¹ï¼š æ€§èƒ½ä¸Šå¯èƒ½å¹¶æ²¡æœ‰ç¼“å­˜æœåŠ¡é‚£ä¹ˆé«˜ï¼Œå› ä¸ºæ¯æ¬¡åœ¨åˆ›å»ºé”å’Œé‡Šæ”¾é”çš„è¿‡ç¨‹ä¸­ï¼Œéƒ½è¦åŠ¨æ€åˆ›å»ºã€é”€æ¯ä¸´æ—¶èŠ‚ç‚¹æ¥å®ç°é”åŠŸèƒ½ã€‚ZK ä¸­åˆ›å»ºå’Œåˆ é™¤èŠ‚ç‚¹åªèƒ½é€šè¿‡ Leader æœåŠ¡å™¨æ¥æ‰§è¡Œï¼Œç„¶åå°†æ•°æ®åŒæ­¥åˆ°æ‰€æœ‰çš„ Follower æœºå™¨ä¸Šã€‚è¿˜éœ€è¦å¯¹ ZKçš„åŸç†æœ‰æ‰€äº†è§£ã€‚ åŸºäº Consul åšåˆ†å¸ƒå¼é”DD å†™è¿‡ç±»ä¼¼æ–‡ç« ï¼Œå…¶å®ä¸»è¦åˆ©ç”¨ Consul çš„ Key / Value å­˜å‚¨ API ä¸­çš„ acquire å’Œ release æ“ä½œæ¥å®ç°ã€‚ æ–‡ç« åœ°å€ï¼šhttp://blog.didispace.com/spring-cloud-consul-lock-and-semphore/ ä½¿ç”¨åˆ†å¸ƒå¼é”çš„æ³¨æ„äº‹é¡¹1ã€æ³¨æ„åˆ†å¸ƒå¼é”çš„å¼€é”€ 2ã€æ³¨æ„åŠ é”çš„ç²’åº¦ 3ã€åŠ é”çš„æ–¹å¼ æ€»ç»“æ— è®ºä½ èº«å¤„ä¸€ä¸ªä»€ä¹ˆæ ·çš„å…¬å¸ï¼Œæœ€å¼€å§‹çš„å·¥ä½œå¯èƒ½éƒ½éœ€è¦ä»æœ€ç®€å•çš„åšèµ·ã€‚ä¸è¦æé˜¿é‡Œå’Œè…¾è®¯çš„ä¸šåŠ¡åœºæ™¯ qps å¦‚ä½•å¤§ï¼Œå› ä¸ºåœ¨è¿™æ ·çš„å¤§åœºæ™¯ä¸­ä½ æœªå¿…èƒ½äº²è‡ªå‚ä¸é¡¹ç›®ï¼Œäº²è‡ªå‚ä¸é¡¹ç›®æœªå¿…èƒ½æ˜¯æ ¸å¿ƒçš„è®¾è®¡è€…ï¼Œæ˜¯æ ¸å¿ƒçš„è®¾è®¡è€…æœªå¿…èƒ½ç‹¬è‡ªè®¾è®¡ã€‚å¸Œæœ›å¤§å®¶èƒ½æ ¹æ®è‡ªå·±å…¬å¸ä¸šåŠ¡åœºæ™¯ï¼Œé€‰æ‹©é€‚åˆè‡ªå·±é¡¹ç›®çš„æ–¹æ¡ˆã€‚ å‚è€ƒèµ„æ–™http://www.hollischuang.com/archives/1716 http://www.spring4all.com/question/158 https://www.cnblogs.com/PurpleDream/p/5559352.html http://www.cnblogs.com/PurpleDream/p/5573040.html https://www.cnblogs.com/suolu/p/6588902.html","tags":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"http://www.54tianzhisheng.cn/tags/æ•°æ®åº“/"},{"name":"Redis","slug":"Redis","permalink":"http://www.54tianzhisheng.cn/tags/Redis/"},{"name":"åˆ†å¸ƒå¼é”","slug":"åˆ†å¸ƒå¼é”","permalink":"http://www.54tianzhisheng.cn/tags/åˆ†å¸ƒå¼é”/"},{"name":"Zookeeper","slug":"Zookeeper","permalink":"http://www.54tianzhisheng.cn/tags/Zookeeper/"}]},{"title":"Spring Boot 2.0ç³»åˆ—æ–‡ç« (å…­)ï¼šSpring Boot 2.0ä¸­SpringBootApplicationæ³¨è§£è¯¦è§£","date":"2018-04-18T16:00:00.000Z","path":"2018/04/19/SpringBootApplication-annotation/","text":"SpringBoot ç³»åˆ—æ–‡ç«  å…³æ³¨æˆ‘ è½¬è½½è¯·åŠ¡å¿…æ³¨æ˜åŸåˆ›åœ°å€ä¸ºï¼šhttp://www.54tianzhisheng.cn/2018/04/19/SpringBootApplication-annotation/ æ¦‚è¿°è®¸å¤š Spring Boot å¼€å‘è€…å–œæ¬¢ä»–ä»¬çš„åº”ç”¨ç¨‹åºä½¿ç”¨è‡ªåŠ¨é…ç½®ã€ç»„ä»¶æ‰«æã€å¹¶èƒ½å¤Ÿåœ¨ä»–ä»¬çš„ â€œApplicationâ€ ç±»ä¸Šå®šä¹‰é¢å¤–çš„é…ç½®ã€‚ å¯ä»¥ä½¿ç”¨ä¸€ä¸ª @SpringBootApplication æ³¨è§£æ¥å¯ç”¨è¿™äº›åŠŸèƒ½ã€‚ 123456789import org.springframework.boot.SpringApplication;import org.springframework.boot.autoconfigure.SpringBootApplication;@SpringBootApplicationpublic class Application &#123; public static void main(String[] args) &#123; SpringApplication.run(Application.class, args); &#125;&#125; @SpringBootApplicationè·Ÿè¿›å» @SpringBootApplication æ³¨è§£å¯ä»¥å‘ç°ä¸‹å›¾ï¼š å…¶ä¸­æ ‡æ³¨çš„ä¸‰ä¸ªæ³¨è§£æ­£èƒ½è§£å†³æˆ‘ä»¬ä¸Šé¢æ‰€è¯´çš„ä¸‰ç§åŠŸèƒ½ï¼Œå®ƒä»¬æ˜¯ï¼š @SpringBootConfiguration @EnableAutoConfiguration @ComponentScan è¯¥æ¥å£é™¤äº†ä¸Šé¢ä¸‰ä¸ªæ³¨è§£å¤–ï¼Œè¿˜æœ‰å››ä¸ªæ–¹æ³•å¦‚ä¸‹ï¼š Class&lt;?&gt;[] exclude() default {}:æ ¹æ® class æ¥æ’é™¤ï¼Œæ’é™¤ç‰¹å®šçš„ç±»åŠ å…¥ spring å®¹å™¨ï¼Œä¼ å…¥å‚æ•° value ç±»å‹æ˜¯ class ç±»å‹ã€‚ String[] excludeName() default {}:æ ¹æ® class name æ¥æ’é™¤ï¼Œæ’é™¤ç‰¹å®šçš„ç±»åŠ å…¥ spring å®¹å™¨ï¼Œä¼ å…¥å‚æ•° value ç±»å‹æ˜¯ class çš„å…¨ç±»åå­—ç¬¦ä¸²æ•°ç»„ã€‚ String[] scanBasePackages() default {}:æŒ‡å®šæ‰«æåŒ…ï¼Œå‚æ•°æ˜¯åŒ…åçš„å­—ç¬¦ä¸²æ•°ç»„ã€‚ Class&lt;?&gt;[] scanBasePackageClasses() default {}:æ‰«æç‰¹å®šçš„åŒ…ï¼Œå‚æ•°ç±»ä¼¼æ˜¯ Class ç±»å‹æ•°ç»„ã€‚ å°±æ‹¿ scanBasePackages æ¥ä¸¾ä¸ªä¾‹å­ï¼š 1@SpringBootApplication(scanBasePackages = &#123;\"com.zhisheng.controller\",\"com.zhisheng.model\"&#125;) å°†ä¸éœ€è¦çš„ bean æ’é™¤åœ¨ spring å®¹å™¨ä¸­ï¼Œå¦‚ä½•æ“ä½œï¼Ÿçœ‹çœ‹å®˜æ–¹çš„ä»£ç æ€ä¹ˆç”¨çš„ï¼š @SpringBootConfiguration @SpringBootConfigurationç»§æ‰¿è‡ª@Configurationï¼ŒäºŒè€…åŠŸèƒ½ä¹Ÿä¸€è‡´ï¼Œæ ‡æ³¨å½“å‰ç±»æ˜¯é…ç½®ç±»ï¼Œå¹¶ä¼šå°†å½“å‰ç±»å†…å£°æ˜çš„ä¸€ä¸ªæˆ–å¤šä¸ªä»¥@Beanæ³¨è§£æ ‡è®°çš„æ–¹æ³•çš„å®ä¾‹çº³å…¥åˆ°srpingå®¹å™¨ä¸­ï¼Œå¹¶ä¸”å®ä¾‹åå°±æ˜¯æ–¹æ³•åã€‚ è™½è¯´ç°åœ¨å·²ç»æ¨èä½¿ç”¨ Spring Boot é‡Œé¢çš„ @SpringBootConfiguration æ³¨è§£ï¼Œä¸ºäº†æ¢ä¸ªç©¶ç«Ÿï¼Œæˆ‘ä»¬è¿˜æ˜¯ç»§ç»­ç ”ç©¶ä¸‹ @Configuration æ³¨è§£ã€‚ @Configuration@Configuration æ ‡æ³¨åœ¨ç±»ä¸Šï¼Œç›¸å½“äºæŠŠè¯¥ç±»ä½œä¸º spring çš„ xml é…ç½®æ–‡ä»¶ä¸­çš„ &lt;beans&gt;ï¼Œä½œç”¨ä¸ºï¼šé…ç½® spring å®¹å™¨(åº”ç”¨ä¸Šä¸‹æ–‡) 123&lt;beans&gt;&lt;/beans&gt; @Bean@Bean æ ‡æ³¨åœ¨æ–¹æ³•ä¸Š(è¿”å›æŸä¸ªå®ä¾‹çš„æ–¹æ³•)ï¼Œç­‰ä»·äº spring çš„ xml é…ç½®æ–‡ä»¶ä¸­çš„&lt;bean&gt;ï¼Œä½œç”¨ä¸ºï¼šæ³¨å†Œ bean å¯¹è±¡ å¯ä»¥çœ‹çœ‹è¿™ç¯‡æ–‡ç« ï¼šhttps://www.ibm.com/developerworks/cn/webservices/ws-springjava/index.html @ComponentScanå¯ä»¥é€šè¿‡è¯¥æ³¨è§£æŒ‡å®šæ‰«ææŸäº›åŒ…ä¸‹åŒ…å«å¦‚ä¸‹æ³¨è§£çš„å‡è‡ªåŠ¨æ³¨å†Œä¸º spring beansï¼š @Componentã€@Serviceã€ @Repositoryã€ @Controllerã€@Entity ç­‰ç­‰ ä¾‹å¦‚ï¼š 1@ComponentScan(basePackages = &#123;\"com.zhisheng.controller\",\"com.zhisheng.model\"&#125;) ä»¥å‰æ˜¯åœ¨ xml é…ç½®æ–‡ä»¶ä¸­è®¾ç½®å¦‚ä¸‹æ ‡ç­¾ï¼š&lt;context:component-scan&gt;ï¼ˆç”¨æ¥æ‰«æåŒ…é…ç½®ï¼‰ é™¤äº†å¯ä»¥ä½¿ç”¨ @ComponentScan æ³¨è§£æ¥åŠ è½½æˆ‘ä»¬çš„ beanï¼Œè¿˜å¯ä»¥åœ¨ Application ç±»ä¸­ä½¿ç”¨ @Import æŒ‡å®šè¯¥ç±»ã€‚ ä¾‹å¦‚ï¼š 1@Import(&#123;ConsulConfig.class, Log4jEndPointConfiguration.class&#125;) //ç›´æ¥ imoport è¦å¼•å…¥çš„ç±» @EnableAutoConfiguration@EnableAutoConfigurationçš„ä½œç”¨å¯åŠ¨è‡ªåŠ¨çš„é…ç½®ï¼Œ@EnableAutoConfigurationæ³¨è§£çš„æ„æ€å°±æ˜¯Springbootæ ¹æ®ä½ æ·»åŠ çš„ jar åŒ…æ¥é…ç½®ä½ é¡¹ç›®çš„é»˜è®¤é…ç½®ï¼Œæ¯”å¦‚æ ¹æ®spring-boot-starter-web ï¼Œæ¥åˆ¤æ–­ä½ çš„é¡¹ç›®æ˜¯å¦éœ€è¦æ·»åŠ äº†webmvcå’Œtomcatï¼Œå°±ä¼šè‡ªåŠ¨çš„å¸®ä½ é…ç½® web é¡¹ç›®ä¸­æ‰€éœ€è¦çš„é»˜è®¤é…ç½®ã€‚ç®€å•ç‚¹è¯´å°±æ˜¯å®ƒä¼šæ ¹æ®å®šä¹‰åœ¨ classpath ä¸‹çš„ç±»ï¼Œè‡ªåŠ¨çš„ç»™ä½ ç”Ÿæˆä¸€äº› Beanï¼Œå¹¶åŠ è½½åˆ° Spring çš„ Context ä¸­ã€‚ å¯ä»¥çœ‹åˆ° import å¼•å…¥äº† AutoConfigurationImportSelector ç±»ã€‚è¯¥ç±»ä½¿ç”¨äº† Spring Core åŒ…çš„ SpringFactoriesLoader ç±»çš„ loadFactoryNamesof() æ–¹æ³•ã€‚ AutoConfigurationImportSelector ç±»å®ç°äº† DeferredImportSelector æ¥å£ï¼Œå¹¶å®ç°äº† selectImports æ–¹æ³•ï¼Œç”¨æ¥å¯¼å‡ºConfiguration ç±»ã€‚ 1List&lt;String&gt; configurations = getCandidateConfigurations(annotationMetadata, attributes); å¯¼å‡ºçš„ç±»æ˜¯é€šè¿‡ SpringFactoriesLoader.loadFactoryNames() è¯»å–äº† ClassPath ä¸‹é¢çš„ META-INF/spring.factories æ–‡ä»¶ã€‚ è¿™ä¸ªæ–‡ä»¶å†…å®¹å¤§è‡´å¦‚ä¸‹ã€‚ åé¢ç»§ç»­ä¼šå†™è‡ªåŠ¨é…ç½®æ–¹é¢çš„åšå®¢ï¼Œè¯·ç»§ç»­å…³æ³¨ï¼ å¦‚æœä½ å‘ç°è‡ªåŠ¨è£…é…çš„ Bean ä¸æ˜¯ä½ æƒ³è¦çš„ï¼Œä½ ä¹Ÿå¯ä»¥ disable å®ƒã€‚æ¯”å¦‚è¯´ï¼Œæˆ‘ä¸æƒ³è¦è‡ªåŠ¨è£…é… Database çš„é‚£äº›Beanï¼š 1@EnableAutoConfiguration(exclude = &#123;DataSourceAutoConfiguration.class&#125;) ç›¸å…³æ–‡ç« 1ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (ä¸€)ï¼šSpring Boot 2.0 è¿ç§»æŒ‡å— 2ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (äºŒ)ï¼šSpring Boot 2.0 æ–°ç‰¹æ€§è¯¦è§£ 3ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (ä¸‰)ï¼šSpring Boot 2.0 é…ç½®æ”¹å˜ 4ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (å››)ï¼šSpring Boot 2.0 æºç é˜…è¯»ç¯å¢ƒæ­å»º 5ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (äº”)ï¼šSpring Boot 2.0 é¡¹ç›®æºç ç»“æ„é¢„è§ˆ 6ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (å…­)ï¼šSpring boot 2.0 ä¸­ SpringBootApplication æ³¨è§£è¯¦è§£ 7ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (ä¸ƒ)ï¼šSpringApplication æ·±å…¥æ¢ç´¢ æ€»ç»“æœ¬æ–‡ä¸»è¦è®²äº† SpringBootApplication æ³¨è§£ï¼Œç„¶åå±•å¼€å†™äº†å…¶åŒ…å«çš„ä¸‰ä¸ªæ³¨è§£ SpringBootConfigurationã€ComponentScanã€EnableAutoConfiguration æœ€åè™½ç„¶æºç å¾ˆéš¾ï¼Œä½†éšç€ä¸æ–­çš„æ¢ç´¢ï¼Œæºç åœ¨ä½ é¢å‰å°†ä¼šä¸€è§ˆæ— é—ï¼Œäº«å—è¿™ç§æ¢ç´¢åçš„æˆå°±æ„Ÿï¼åŠ æ²¹ï¼éªšå¹´ï¼ è‡ªå·±æœ¬äººèƒ½åŠ›æœ‰é™ï¼Œæºç çœ‹çš„ä¸å¤šï¼Œä¸Šé¢å¦‚æœ‰ä¸å¯¹çš„è¿˜è¯·ç•™è¨€äº¤æµã€‚","tags":[{"name":"Java","slug":"Java","permalink":"http://www.54tianzhisheng.cn/tags/Java/"},{"name":"SpringBoot","slug":"SpringBoot","permalink":"http://www.54tianzhisheng.cn/tags/SpringBoot/"}]},{"title":"Spring Boot 2.0ç³»åˆ—æ–‡ç« (äº”)ï¼šSpring Boot 2.0 é¡¹ç›®æºç ç»“æ„é¢„è§ˆ","date":"2018-04-17T16:00:00.000Z","path":"2018/04/18/spring_boot2_project/","text":"SpringBoot ç³»åˆ—æ–‡ç«  å…³æ³¨æˆ‘ è½¬è½½è¯·åŠ¡å¿…æ³¨æ˜åŸåˆ›åœ°å€ä¸ºï¼šhttp://www.54tianzhisheng.cn/2018/04/15/springboot2_code/ é¡¹ç›®ç»“æ„ ç»“æ„åˆ†æï¼š Spring-boot-project æ ¸å¿ƒä»£ç ï¼Œä»£ç é‡å¾ˆå¤šï¼ˆ197508 è¡Œï¼‰ Spring-boot-samples ä¸€äº›æ ·ä¾‹ demoï¼Œä»£ç é‡ä¸å¤šï¼ˆ9685 è¡Œï¼‰ï¼Œè›®æœ‰ç”¨çš„ Spring-boot-samples-invoker é‡Œé¢æ— ä»£ç  Spring-boot-tests æµ‹è¯•ä»£ç ï¼ˆ1640 è¡Œï¼‰ spring-boot-projectSpring-boot-project ä¸‹é¢æœ‰å¾ˆå¤šæ¨¡å—ï¼Œå¦‚ä¸‹ï¼š Spirng-boot è¯¥æ¨¡å— 47760 è¡Œä»£ç ï¼ˆå«æµ‹è¯•ä»£ç ï¼‰ï¼ŒSpring boot ä¸»è¦çš„åº“ï¼Œæä¾›äº†æ”¯æŒ Spring Boot å…¶ä»–éƒ¨åˆ†çš„åŠŸèƒ½ï¼Œå…¶ä¸­åŒ…æ‹¬äº†ï¼š åœ¨SpringApplicationç±»ï¼Œæä¾›é™æ€ä¾¿æ·æ–¹æ³•ï¼Œå¯ä»¥å¾ˆå®¹æ˜“å†™ä¸€ä¸ªç‹¬ç«‹çš„ Spring åº”ç”¨ç¨‹åºã€‚å®ƒå”¯ä¸€çš„å·¥ä½œå°±æ˜¯åˆ›é€ å¹¶æ›´æ–°ä¸€ä¸ªåˆé€‚çš„ SpringApplicationContext å¸¦æœ‰å¯é€‰å®¹å™¨çš„åµŒå…¥å¼ Web åº”ç”¨ç¨‹åºï¼ˆTomcatï¼ŒJetty æˆ– Undertowï¼‰ ä¸€æµçš„å¤–éƒ¨é…ç½®æ”¯æŒ ä¾¿æ·ApplicationContextåˆå§‹åŒ–ç¨‹åºï¼ŒåŒ…æ‹¬å¯¹æ•æ„Ÿæ—¥å¿—è®°å½•é»˜è®¤å€¼çš„æ”¯æŒ spring-boot-actuator è¯¥æ¨¡å— 18398 è¡Œä»£ç ï¼ˆå«æµ‹è¯•ä»£ç ï¼‰ï¼Œspring-boot-actuator æ¨¡å—å®ƒå®Œå…¨æ˜¯ä¸€ä¸ªç”¨äºæš´éœ²è‡ªèº«ä¿¡æ¯çš„æ¨¡å—ï¼Œæä¾›äº†ä¸€ä¸ªç›‘æ§å’Œç®¡ç†ç”Ÿäº§ç¯å¢ƒçš„æ¨¡å—ï¼Œå¯ä»¥ä½¿ç”¨ httpã€jmxã€sshã€telnet ç­‰ç®¡ç†å’Œç›‘æ§åº”ç”¨ã€‚å®¡è®¡ï¼ˆAuditingï¼‰ã€ å¥åº·ï¼ˆhealthï¼‰ã€æ•°æ®é‡‡é›†ï¼ˆmetrics gatheringï¼‰ä¼šè‡ªåŠ¨åŠ å…¥åˆ°åº”ç”¨é‡Œé¢ã€‚ spring-boot-actuator-autoconfigure è¯¥æ¨¡å— 16721 è¡Œä»£ç ï¼ˆå«æµ‹è¯•ä»£ç ï¼‰ï¼ŒSpring Boot Actuator æä¾›äº†é¢å¤–çš„è‡ªåŠ¨é…ç½®åŠŸèƒ½ï¼Œå¯ä»¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å®ç°å¯å³æ—¶éƒ¨ç½²å’Œæ”¯æŒçš„åŠŸèƒ½ï¼Œä»è€Œè£…é¥°ä½ çš„åº”ç”¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æ­£åœ¨ç¼–å†™ JSON Web æœåŠ¡ï¼Œé‚£ä¹ˆå®ƒå°†æä¾›æœåŠ¡å™¨ï¼Œå®‰å…¨æ€§ï¼Œæ—¥å¿—è®°å½•ï¼Œå¤–éƒ¨é…ç½®ï¼Œç®¡ç†ç«¯ç‚¹ï¼Œå®¡è®¡æŠ½è±¡ç­‰ç­‰åŠŸèƒ½ã€‚å¦‚æœæ‚¨æƒ³å…³é—­å†…ç½®åŠŸèƒ½ï¼Œæˆ–è€…æ‰©å±•æˆ–æ›¿æ¢å®ƒä»¬ï¼Œå®ƒä¹Ÿä¼šå˜å¾—éå¸¸ç®€å•ã€‚ spring-boot-autoconfigure è¯¥æ¨¡å— 51100 è¡Œä»£ç ï¼ˆå«æµ‹è¯•ä»£ç ï¼‰ï¼Œ Spring Boot å¯ä»¥æ ¹æ®ç±»è·¯å¾„çš„å†…å®¹é…ç½®å¤§éƒ¨åˆ†å¸¸ç”¨åº”ç”¨ç¨‹åºã€‚å•ä¸ª@EnableAutoConfigurationæ³¨é‡Šä¼šè§¦å‘ Springä¸Šä¸‹æ–‡çš„è‡ªåŠ¨é…ç½®ã€‚ è‡ªåŠ¨é…ç½®å°è¯•æ¨æ–­ç”¨æˆ·å¯èƒ½éœ€è¦å“ªäº› beanã€‚ä¾‹å¦‚ï¼Œå¦‚æœ HSQLDBåœ¨ç±»è·¯å¾„ä¸­ï¼Œå¹¶ä¸”ç”¨æˆ·å°šæœªé…ç½®ä»»ä½•æ•°æ®åº“è¿æ¥ï¼Œåˆ™ä»–ä»¬å¯èƒ½éœ€è¦å®šä¹‰å†…å­˜æ•°æ®åº“ã€‚å½“ç”¨æˆ·å¼€å§‹å®šä¹‰ä»–ä»¬è‡ªå·±çš„ bean æ—¶ï¼Œè‡ªåŠ¨é…ç½®å°†æ°¸è¿œè¿œç¦»ã€‚ spring-boot-cli è¯¥æ¨¡å— 9346 è¡Œä»£ç ï¼ˆå«æµ‹è¯•ä»£ç ï¼‰ï¼ŒSpring å‘½ä»¤è¡Œåº”ç”¨ç¨‹åºç¼–è¯‘å¹¶è¿è¡Œ Groovy æºä»£ç ï¼Œä½¿å¾—å¯ä»¥ç¼–å†™å°‘é‡ä»£ç å°±èƒ½è¿è¡Œåº”ç”¨ç¨‹åºã€‚Spring CLI ä¹Ÿå¯ä»¥ç›‘è§†æ–‡ä»¶ï¼Œå½“å®ƒä»¬æ”¹å˜æ—¶è‡ªåŠ¨é‡æ–°ç¼–è¯‘å¹¶é‡æ–°å¯åŠ¨ã€‚ spring-boot-dependencies è¯¥æ¨¡å—é‡Œé¢æ²¡æœ‰æºç ï¼Œåªæœ‰æ‰€æœ‰ä¾èµ–å’Œæ’ä»¶çš„ç‰ˆæœ¬å·ä¿¡æ¯ã€‚ spring-boot-devtools è¯¥æ¨¡å— 9418 è¡Œä»£ç ï¼ˆå«æµ‹è¯•ä»£ç ï¼‰ï¼Œspring-boot-devtools æ¨¡å—æ¥ä½¿ Spring Boot åº”ç”¨æ”¯æŒçƒ­éƒ¨ç½²ï¼Œæé«˜å¼€å‘è€…çš„å¼€å‘æ•ˆç‡ï¼Œæ— éœ€æ‰‹åŠ¨é‡å¯ Spring Boot åº”ç”¨ã€‚ spring-boot-docs è¯¥æ¨¡å— 671 è¡Œä»£ç ï¼Œspringboot å‚è€ƒæ–‡ä»¶ã€‚ spring-boot-parent è¯¥æ¨¡å—æ˜¯å…¶ä»–é¡¹ç›®çš„ parentï¼Œè¯¥æ¨¡å—çš„çˆ¶æ¨¡å—æ˜¯ spring-boot-dependenciesã€‚ spring-boot-properties-migrator è¯¥æ¨¡å—æœ‰ 495 è¡Œä»£ç ï¼Œåœ¨ Spring Boot 2.0 ä¸­ï¼Œè®¸å¤šé…ç½®å±æ€§è¢«é‡æ–°å‘½å/åˆ é™¤ï¼Œå¼€å‘äººå‘˜éœ€è¦æ›´æ–°application.properties/ application.ymlç›¸åº”çš„é…ç½®ã€‚ä¸ºäº†å¸®åŠ©ä½ è§£å†³è¿™ä¸€é—®é¢˜ï¼ŒSpring Boot å‘å¸ƒäº†ä¸€ä¸ªæ–°spring-boot-properties-migratoræ¨¡å—ã€‚ä¸€æ—¦ä½œä¸ºè¯¥æ¨¡å—ä½œä¸ºä¾èµ–è¢«æ·»åŠ åˆ°ä½ çš„é¡¹ç›®ä¸­ï¼Œå®ƒä¸ä»…ä¼šåˆ†æåº”ç”¨ç¨‹åºçš„ç¯å¢ƒï¼Œè€Œä¸”è¿˜ä¼šåœ¨å¯åŠ¨æ—¶æ‰“å°è¯Šæ–­ä¿¡æ¯ï¼Œè€Œä¸”è¿˜ä¼šåœ¨è¿è¡Œæ—¶ä¸ºæ‚¨æš‚æ—¶è¿ç§»å±æ€§ã€‚åœ¨æ‚¨çš„åº”ç”¨ç¨‹åºè¿ç§»æœŸé—´ï¼Œè¿™ä¸ªæ¨¡å—æ˜¯å¿…å¤‡çš„ï¼Œå®Œæˆè¿ç§»åï¼Œè¯·ç¡®ä¿ä»é¡¹ç›®çš„ä¾èµ–å…³ç³»ä¸­åˆ é™¤æ­¤æ¨¡å—ã€‚ spring-boot-starters Starter POMs æ˜¯ç”±å¾ˆå¤šæ–¹ä¾¿çš„ä¾èµ–é›†åˆç»„æˆï¼Œå¦‚æœä½ éœ€è¦ä½¿ç”¨æŸç§æŠ€æœ¯ï¼Œé€šè¿‡æ·»åŠ å°‘é‡çš„jarå°±å¯ä»¥æŠŠç›¸å…³çš„ä¾èµ–åŠ å…¥åˆ°é¡¹ç›®ä¸­å»ã€‚ è™½ç„¶ä½ çœ‹å¾—åˆ°æœ‰è¿™ä¹ˆå¤š starterï¼Œä½†æ˜¯å´æ²¡æœ‰ä¸€è¡Œ Java ä»£ç ï¼Œæ„ä¸æ„å¤–ï¼Ÿ è¿™ç¡®å®æ˜¯ Spring Boot è‡ªåŠ¨é…ç½®çš„å…³é”®ä¹‹å¤„ï¼Œåé¢æˆ‘å¯ä»¥è®²è®²ã€‚ spring-boot-testæµ‹è¯•ä»£ç ï¼æœ‰ 10980 è¡Œä»£ç ã€‚ spring-boot-test-autoconfigureè‡ªåŠ¨é…ç½®çš„æµ‹è¯•ä»£ç ï¼Œæœ‰ 6063 è¡Œä»£ç ã€‚ spring-boot-tools spring-boot-antlib Spring Boot AntLib æ¨¡å—ä¸º Apache Ant æä¾›äº†åŸºæœ¬çš„ Spring Boot æ”¯æŒã€‚ æ‚¨å¯ä»¥ä½¿ç”¨è¯¥æ¨¡å—åˆ›å»ºå¯æ‰§è¡Œæ–‡ä»¶å¤¹ã€‚ è¦ä½¿ç”¨è¯¥æ¨¡å—ï¼Œæ‚¨éœ€è¦åœ¨ build.xml ä¸­å£°æ˜ä¸€ä¸ªé¢å¤–çš„ spring-boot å‘½åç©ºé—´ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š 12345&lt;project xmlns:ivy=\"antlib:org.apache.ivy.ant\" xmlns:spring-boot=\"antlib:org.springframework.boot.ant\" name=\"myapp\" default=\"build\"&gt; ...&lt;/project&gt; æ‚¨éœ€è¦è®°ä½ä½¿ç”¨ -lib é€‰é¡¹å¯åŠ¨ Antï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š 1ant -lib &lt;folder containing spring-boot-antlib-2.1.0.BUILD-SNAPSHOT.jar&gt; Spring-boot-autoconfigure-processor spring boot è‡ªåŠ¨é…ç½®çš„æ ¸å¿ƒç±» Spring-boot-configuration-metadata Spring boot é…ç½®å…ƒæ•°æ® Spring-boot-configuration-processor spring boot é…ç½®çš„æ ¸å¿ƒ Spring-boot-gradle-plugin Spring Boot Gradle æ’ä»¶åœ¨ Gradle ä¸­æä¾›äº† Spring Boot æ”¯æŒï¼Œå¯ä»¥æ‰“åŒ…æˆå¯æ‰§è¡Œ jar æˆ– war ï¼Œè¿è¡Œ Spring Boot åº”ç”¨ç¨‹åºï¼Œå¹¶ä½¿ç”¨ spring-boot-dependencies æä¾›çš„ä¾èµ–å…³ç³»ç®¡ç†ã€‚ å®ƒéœ€è¦ Gradle 4.0 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚ Spring-boot-maven-plugin Spring Boot Maven Plugin åœ¨ Maven ä¸­æä¾›äº† Spring Boot æ”¯æŒï¼Œè®©æ‚¨å¯ä»¥æ‰“åŒ…æˆå¯æ‰§è¡Œ jar æˆ– war åº”ç”¨ï¼Œå¹¶â€œå°±åœ°â€è¿è¡Œåº”ç”¨ç¨‹åºã€‚ è¦ä½¿ç”¨å®ƒï¼Œä½ å¿…é¡»ä½¿ç”¨ Maven 3.2ï¼ˆæˆ–æ›´é«˜ç‰ˆæœ¬ï¼‰ã€‚ Spring-boot-loader spring-boot-load æ¨¡å—é€šè¿‡è‡ªå®šä¹‰ jar åŒ…ç»“æ„ï¼Œè‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Œä¼˜é›…çš„å®ç°äº†åµŒå¥— jar èµ„æºçš„åŠ è½½ï¼Œé€šè¿‡æ‰“åŒ…æ—¶å€™é‡æ–°è®¾ç½®å¯åŠ¨ç±»å’Œç»„ç»‡ jar ç»“æ„ï¼Œé€šè¿‡è¿è¡Œæ—¶è®¾ç½®è‡ªå®šä¹‰åŠ è½½å™¨æ¥å®ç°åµŒå¥— jar èµ„æºåŠ è½½ã€‚ Spring-boot-loader-tools spring-boot-load æ¨¡å—çš„å·¥å…·æ¨¡å— Spring-boot-test-support æµ‹è¯• spring-boot-samples æ ·ä¾‹ demo æ¯”è¾ƒå¤šï¼Œå¤§å®¶çœ‹æºç çš„æ—¶å€™å¯ä»¥æ‹¿è¿™äº›ç°æˆ demo æµ‹è¯•ã€‚ spring-boot-tests ç›¸å…³æ–‡ç« 1ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (ä¸€)ï¼šSpring Boot 2.0 è¿ç§»æŒ‡å— 2ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (äºŒ)ï¼šSpring Boot 2.0 æ–°ç‰¹æ€§è¯¦è§£ 3ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (ä¸‰)ï¼šSpring Boot 2.0 é…ç½®æ”¹å˜ 4ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (å››)ï¼šSpring Boot 2.0 æºç é˜…è¯»ç¯å¢ƒæ­å»º 5ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (äº”)ï¼šSpring Boot 2.0 é¡¹ç›®æºç ç»“æ„é¢„è§ˆ 6ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (å…­)ï¼šSpring boot 2.0 ä¸­ SpringBootApplication æ³¨è§£è¯¦è§£ 7ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (ä¸ƒ)ï¼šSpringApplication æ·±å…¥æ¢ç´¢ æ€»ç»“æœ¬æ–‡ä¸»è¦åˆ†æäº†ä¸‹ Spring boot é¡¹ç›®æºç ç»“æ„ã€‚åŒ…å« Spring boot æ ¸å¿ƒæºç ã€æ ·ä¾‹ demoã€æµ‹è¯•ã€‚åˆ†æäº†é¡¹ç›®çš„æ•´ä½“ç»“æ„åï¼Œåé¢æ‰èƒ½å¤Ÿæœ‰çš„æ”¾çŸ¢çš„å»è¯»æºç ã€‚ æœ€åè™½ç„¶æºç å¾ˆéš¾ï¼Œä½†éšç€ä¸æ–­çš„æ¢ç´¢ï¼Œæºç åœ¨ä½ é¢å‰å°†ä¼šä¸€è§ˆæ— é—ï¼Œäº«å—è¿™ç§æ¢ç´¢åçš„æˆå°±æ„Ÿï¼åŠ æ²¹ï¼éªšå¹´ï¼","tags":[{"name":"Java","slug":"Java","permalink":"http://www.54tianzhisheng.cn/tags/Java/"},{"name":"SpringBoot","slug":"SpringBoot","permalink":"http://www.54tianzhisheng.cn/tags/SpringBoot/"}]},{"title":"Spring Boot 2.0ç³»åˆ—æ–‡ç« (å››)ï¼šSpring Boot 2.0 æºç é˜…è¯»ç¯å¢ƒæ­å»º","date":"2018-04-14T16:00:00.000Z","path":"2018/04/15/springboot2_code/","text":"SpringBoot ç³»åˆ—æ–‡ç«  å‰æå‰å‡ å¤©é¢è¯•çš„æ—¶å€™ï¼Œè¢«é—®è¿‡ Spring Boot çš„è‡ªåŠ¨é…ç½®æºç æ€ä¹ˆå®ç°çš„ï¼Œæ²¡çœ‹è¿‡æºç çš„æˆ‘åªèƒ½æŠ•é™ğŸ‘¦äº†ã€‚ è¿™ä¸ï¼Œèµ¶ç´§æ¥è¡¥è¡¥äº†ï¼Œæ‰€ä»¥æ‰æœ‰äº†è¿™ç¯‡æ–‡ç« çš„å‡ºç°ï¼ŒSpring Boot 2. 0 æºç é˜…è¯»ç¯å¢ƒçš„æ­å»ºä¸­è¿˜é‡åˆ°ç‚¹é—®é¢˜ï¼Œè¢«å‘æ­»äº†ï¼Œè¿˜å¥½è§£å†³äº†ï¼Œæ„Ÿè°¢ç¾¤é‡Œçš„å°ä¼™ä¼´ï¼ å…³æ³¨æˆ‘ è½¬è½½è¯·åŠ¡å¿…æ³¨æ˜åŸåˆ›åœ°å€ä¸ºï¼šhttp://www.54tianzhisheng.cn/2018/04/15/springboot2_code/ é¡¹ç›®ä¸‹è½½ä» https://github.com/spring-projects/spring-boot/releases å¯ä»¥çœ‹åˆ°æ‰€æœ‰ç‰ˆæœ¬çš„ä¸‹è½½åœ°å€ï¼Œæˆ‘è¿™é‡Œé€‰æ‹©çš„æ˜¯ Spring Boot 2 ä¸­æœ€æ–°çš„ v2.0.1.RELEASE ç‰ˆæœ¬ï¼Œä¸‹è½½åï¼Œç„¶åè§£å‹ã€‚è·å–ä»£ç ä¹‹å‰ï¼Œè¯·å…ˆç¡®ä¿ä½ çš„ JDK ç‰ˆæœ¬æ˜¯ 1.8 ä»¥ä¸Šå“¦ã€‚ é¡¹ç›®ç¼–è¯‘è¿›å…¥ spring-boot-2.0.1.RELEASE çš„ç›®å½•ä¸‹ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ã€‚ è·³è¿‡æµ‹è¯•ç”¨ä¾‹ç¼–è¯‘1sudo mvn clean install -DskipTests -Pfast //è·³è¿‡æµ‹è¯•ç”¨ä¾‹ è·³è¿‡æµ‹è¯•ç”¨ä¾‹å¯ä»¥åŠ å¿«ç¼–è¯‘çš„é€Ÿåº¦ã€‚ å…ˆçœ‹ä¸‹è¿è¡ŒæˆåŠŸçš„æ•ˆæœï¼š åªèŠ±äº† 6 åˆ†å¤šé’Ÿå°±å¥½äº†ã€‚ å…¨é‡ç¼–è¯‘1sudo mvn -f spring-boot-project -Pfull clean install å…¨é‡ç¼–è¯‘ç«Ÿç„¶æŠ¥é”™ï¼Œä¸€æ³¢æœªå¹³ï¼Œä¸€æ³¢åˆèµ·ï¼ çœ‹ç½‘ä¸Šçš„è§£å†³æ–¹æ³•æ˜¯ï¼šåœ¨é¡¹ç›®çš„ pom.xml æ–‡ä»¶ä¸­çš„ &lt;properties&gt; æ·»åŠ  &lt;javadocExecutable&gt; 123&lt;properties&gt; &lt;javadocExecutable&gt;$&#123;java.home&#125;/../bin/javadoc&lt;/javadocExecutable&gt;&lt;/properties&gt; æ­¤æ–¹æ³•è™½ç„¶ç®¡ç”¨ï¼Œä½†æ˜¯åªæ˜¯ä¸´æ—¶çš„ï¼Œéœ€è¦å¯¹æ¯ä¸ªé¡¹ç›®éƒ½è¿›è¡Œæ·»åŠ ã€‚ é—®é¢˜äº§ç”Ÿçš„åŸå› åº”è¯¥æ˜¯ï¼Œmvn æ‹¿åˆ°çš„ JAVA_HOME ä½ç½®åº”è¯¥æ˜¯ ${JAVA_HOME}/jre è€Œä¸æ˜¯ jdk ä½ç½®ã€‚ åé¢åˆçœ‹å®˜æ–¹çš„ README ä¸Šé¢å†™çš„æ‰§è¡Œå‘½ä»¤ï¼š 1sudo mvn clean install æ‰§è¡Œåä¹Ÿæ˜¯æœ‰å„ç§æŠ¥é”™ï¼Œå°è¯•äº†å¾ˆä¹…è§£å†³ï¼Œæœ€åèŠ±äº†å¥½å‡ ä¸ªå°æ—¶æ‰åˆ°ä¸‹é¢è¿™å›¾ï¼š å¤ªæŠ˜è…¾äººäº†ï¼Œå¤ªéº»çƒ¦äº†ï¼ æš‚æ—¶å°±ä¸å…¨é‡ç¼–è¯‘äº†ï¼Œæˆ‘ä»¬å°±ç›´æ¥æŠŠç°åœ¨ è·³è¿‡æµ‹è¯•ç”¨ä¾‹ç¼–è¯‘ åçš„é¡¹ç›®å¯¼å…¥åˆ° IDEA ä¸­å»ã€‚ å¯¼å…¥é¡¹ç›®å·¥ç¨‹ å¯¼å…¥åå°†é‚£äº›æµ‹è¯•çš„ module æ ‡è®°ä¸º maven é¡¹ç›®ï¼Œç„¶ååé¢è‡ªå·±å†æ ¹æ®æµ‹è¯•ç”¨ä¾‹å»è·Ÿæºç å§ã€‚ å¯¼å…¥åé¡¹ç›®æ²¡å‡ºç°æŠ¥é”™ï¼Œç¾æ»‹æ»‹ï¼Œåé¢æºç å¯ä»¥çœ‹èµ·æ¥ã€‚ é‡åˆ°çš„å‘åœ¨è¿™ä¹‹å‰ï¼Œæˆ‘è‡ªå·±åˆ›å»ºé¡¹ç›® Spring Boot 2 é¡¹ç›®éƒ½æ˜¯å¤±è´¥çš„ï¼Œmaven è¿è¡Œé¡¹ç›®ï¼ˆmvn clean installï¼‰æŠ¥é”™å¦‚ä¸‹ï¼š é€šè¿‡ä¸Šå›¾å¯ä»¥å‘ç°æŠ¥é”™çš„ç½ªé­ç¥¸é¦–æ˜¯ç”±äºæ‰¾ä¸åˆ° org.yaml.snakeyaml 1.19 çš„åŒ…ï¼Œè¿™ä¸ªä¾èµ–æ­»æ´»ä¸‹ä¸ä¸‹æ¥ï¼Œè‹¦é€¼äº†ğŸ˜¢ã€‚ ä¸€å¼€å§‹ä»¥ä¸ºæ˜¯å…¬å¸é…çš„ maven setting.xml æ–‡ä»¶æœ‰é—®é¢˜ï¼ˆå…¬å¸ç§æœæœ‰é—®é¢˜ï¼‰ï¼Œå¯¼è‡´æˆ‘è¿™ä¸ª org.yaml.snakeyaml 1.19 çš„åŒ…ä¸€ç›´ä¸‹è½½ä¸æ¥ã€‚åæ¥æˆ‘å«ç¾¤é‡Œçš„å¥½å‹å¸®å¿™æµ‹è¯•ä¸‹èƒ½ä¸èƒ½åˆ›å»º Spring Boot 2 é¡¹ç›®ï¼Œç»“æœä»–ä»¬éƒ½è¡Œçš„ã€‚æˆ‘å°±æ¢æˆäº†ä»–ä»¬é˜¿é‡Œäº‘é•œåƒçš„ setting æ–‡ä»¶ï¼Œç»“æœåœ¨æˆ‘è¿™è¿˜æ˜¯ä¸è¡Œçš„ã€‚çœŸæ˜¯é†‰äº†ï¼Œæˆ‘å¹²è„†ç›´æ¥å«ä»–æŠŠ maven æœ¬åœ°ä»“åº“ä¸­çš„ org.yaml.snakeyaml 1.19 æ•´ä¸ªåŒ…éƒ½å‘ç»™æˆ‘ï¼Œç»“æœå†æ¬¡åˆ›å»º Spring Boot 2 é¡¹ç›®å°±èƒ½æˆåŠŸäº†ã€‚ç¾æ»‹æ»‹ğŸ˜„ï¼ ç„¶åå°±è¹­ç€ç°åœ¨ç¯å¢ƒ OKï¼Œå¼€å§‹æ­å»ºæˆ‘çš„ Spring Boot 2 æºç é˜…è¯»ç¯å¢ƒï¼ ç›¸å…³æ–‡ç« 1ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (ä¸€)ï¼šSpring Boot 2.0 è¿ç§»æŒ‡å— 2ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (äºŒ)ï¼šSpring Boot 2.0 æ–°ç‰¹æ€§è¯¦è§£ 3ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (ä¸‰)ï¼šSpring Boot 2.0 é…ç½®æ”¹å˜ 4ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (å››)ï¼šSpring Boot 2.0 æºç é˜…è¯»ç¯å¢ƒæ­å»º 5ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (äº”)ï¼šSpring Boot 2.0 é¡¹ç›®æºç ç»“æ„é¢„è§ˆ 6ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (å…­)ï¼šSpring boot 2.0 ä¸­ SpringBootApplication æ³¨è§£è¯¦è§£ 7ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (ä¸ƒ)ï¼šSpringApplication æ·±å…¥æ¢ç´¢ æœ€åæºç ä¸éª—äººï¼Œå¤šçœ‹çœ‹ï¼","tags":[{"name":"Java","slug":"Java","permalink":"http://www.54tianzhisheng.cn/tags/Java/"},{"name":"SpringBoot","slug":"SpringBoot","permalink":"http://www.54tianzhisheng.cn/tags/SpringBoot/"}]},{"title":"Spring Boot 2.0ç³»åˆ—æ–‡ç« (ä¸‰)ï¼šSpring Boot 2.0 é…ç½®æ”¹å˜","date":"2018-04-12T16:00:00.000Z","path":"2018/04/13/Spring_Boot_2.0_Configuration_Changelog/","text":"SpringBoot ç³»åˆ—æ–‡ç«  å‰æå¥½ä¹…æ²¡æ›´æ–°æ–‡ç« äº†ï¼Œæœ¬æ¥æ‰“ç®—åœ¨æ¯•ä¸šä¹‹å‰ä¸æ›´æ–°äº†ï¼Œè¿™é‡Œï¼Œå¯¹ä¸ä½äº†ï¼Œæˆ‘åˆæ›´æ–°äº†ã€‚ğŸ˜ğŸ˜ ä¹‹å‰ç¿»è¯‘äº†ä¸¤ç¯‡ Spring Boot 2.0 çš„æ–‡ç« ï¼ŒSpring Boot 2.0ç³»åˆ—æ–‡ç« (ä¸€)ï¼šSpring Boot 2.0 è¿ç§»æŒ‡å— å’Œ Spring Boot 2.0ç³»åˆ—æ–‡ç« (äºŒ)ï¼šSpring Boot 2.0 æ–°ç‰¹æ€§è¯¦è§£ ä»Šå¤©å°±ç»§ç»­è¯¦ç»†æ¢ç©¶ Spring Boot 2.0 é‡Œé¢çš„æ”¹å˜ã€‚ å…³æ³¨æˆ‘ è½¬è½½è¯·åŠ¡å¿…æ³¨æ˜åŸåˆ›åœ°å€ä¸ºï¼šhttp://www.54tianzhisheng.cn/2018/04/13/Spring_Boot_2.0_Configuration_Changelog/ é…ç½®æ”¹å˜é…ç½®å±æ€§åœ¨ 1.5.10.RELEASE å’Œ 2.0.0.RELEASE ä¸¤ä¸ªç‰ˆæœ¬ä¹‹é—´çš„æ”¹å˜ï¼š å¯ç”¨é”®ä¸‹é¢çš„è¡¨æ˜¯ 2.0.0.RELEASE ç‰ˆæœ¬ä¸­çš„å¼ƒç”¨é”®ï¼š Key Replacementï¼ˆæ›¿ä»£ï¼‰ åŸå›  spring.datasource.hikari.initialization-fail-fast spring.main.web-environment spring.main.web-application-type æ–°é”®ä¸‹é¢çš„è¡¨æ˜¯ 2.0.0.RELEASE ç‰ˆæœ¬ä¸­æ–°çš„é”®ï¼š Key Default valueï¼ˆé»˜è®¤å€¼ï¼‰ æè¿° logging.file.max-history 0 è¦ä¿å­˜çš„å½’æ¡£æ—¥å¿—æ–‡ä»¶çš„æœ€å¤§å€¼ logging.file.max-size 10MB æ—¥å¿—æ–‡ä»¶æœ€å¤§å®¹é‡ logging.pattern.dateformat yyyy-MM-dd HH:mm:ss.SSS æ—¥å¿—çš„æ—¥æœŸæ ¼å¼ management.endpoint.auditevents.cache.time-to-live 0ms å¯ä»¥ç¼“å­˜å“åº”çš„æœ€é•¿æ—¶é—´ management.endpoint.auditevents.enabled true æ˜¯å¦å¯ç”¨ auditevents ç«¯ç‚¹ management.endpoint.beans.cache.time-to-live 0ms å¯ä»¥ç¼“å­˜å“åº”çš„æœ€é•¿æ—¶é—´ management.endpoint.beans.enabled true æ˜¯å¦å¯ç”¨ bean ç«¯ç‚¹ management.endpoint.conditions.cache.time-to-live 0ms å¯ä»¥ç¼“å­˜å“åº”çš„æœ€é•¿æ—¶é—´ management.endpoint.conditions.enabled true æ˜¯å¦å¯ç”¨ conditions ç«¯ç‚¹ management.endpoint.configprops.cache.time-to-live 0ms å¯ä»¥ç¼“å­˜å“åº”çš„æœ€é•¿æ—¶é—´ management.endpoint.configprops.enabled true æ˜¯å¦å¯ç”¨ configprops ç«¯ç‚¹ management.endpoint.configprops.keys-to-sanitize password,secret,key,token, .credentials.,vcap_services Keys that should be sanitized management.endpoint.env.cache.time-to-live 0ms å¯ä»¥ç¼“å­˜å“åº”çš„æœ€é•¿æ—¶é—´ management.endpoint.env.enabled true æ˜¯å¦å¯ç”¨ env ç«¯ç‚¹ management.endpoint.env.keys-to-sanitize password,secret,key,token, .credentials.,vcap_services Keys that should be sanitized. management.endpoint.flyway.cache.time-to-live 0ms å¯ä»¥ç¼“å­˜å“åº”çš„æœ€é•¿æ—¶é—´ management.endpoint.flyway.enabled true æ˜¯å¦å¯ç”¨ flyway ç«¯ç‚¹ management.endpoint.health.cache.time-to-live 0ms å¯ä»¥ç¼“å­˜å“åº”çš„æœ€é•¿æ—¶é—´ management.endpoint.health.enabled true æ˜¯å¦å¯ç”¨ health ç«¯ç‚¹ management.endpoint.health.roles è§’è‰²ç”¨äºç¡®å®šç”¨æˆ·æ˜¯å¦æœ‰æƒæ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ management.endpoint.health.show-details never ä½•æ—¶æ˜¾ç¤ºå®Œæ•´çš„å¥åº·è¯¦æƒ… management.endpoint.heapdump.cache.time-to-live 0ms å¯ä»¥ç¼“å­˜å“åº”çš„æœ€é•¿æ—¶é—´ management.endpoint.heapdump.enabled true æ˜¯å¦å¯ç”¨ heapdump ç«¯ç‚¹ management.endpoint.httptrace.cache.time-to-live 0ms å¯ä»¥ç¼“å­˜å“åº”çš„æœ€é•¿æ—¶é—´ management.endpoint.httptrace.enabled true æ˜¯å¦å¯ç”¨ httptrace ç«¯ç‚¹ management.endpoint.info.cache.time-to-live 0ms å¯ä»¥ç¼“å­˜å“åº”çš„æœ€é•¿æ—¶é—´ management.endpoint.info.enabled true æ˜¯å¦å¯ç”¨ info ç«¯ç‚¹ management.endpoint.jolokia.config Jolokia è®¾ç½® management.endpoint.jolokia.enabled true æ˜¯å¦å¯ç”¨ jolokia ç«¯ç‚¹ management.endpoint.liquibase.cache.time-to-live 0ms å¯ä»¥ç¼“å­˜å“åº”çš„æœ€é•¿æ—¶é—´ management.endpoint.liquibase.enabled true æ˜¯å¦å¯ç”¨ liquibase ç«¯ç‚¹ management.endpoint.logfile.cache.time-to-live 0ms å¯ä»¥ç¼“å­˜å“åº”çš„æœ€é•¿æ—¶é—´ management.endpoint.logfile.enabled true æ˜¯å¦å¯ç”¨ logfile ç«¯ç‚¹ management.endpoint.logfile.external-file è¦è®¿é—®çš„å¤–éƒ¨æ—¥å¿—æ–‡ä»¶ management.endpoint.loggers.cache.time-to-live 0ms å¯ä»¥ç¼“å­˜å“åº”çš„æœ€é•¿æ—¶é—´ management.endpoint.loggers.enabled true æ˜¯å¦å¯ç”¨ loggers ç«¯ç‚¹ management.endpoint.mappings.cache.time-to-live 0ms å¯ä»¥ç¼“å­˜å“åº”çš„æœ€é•¿æ—¶é—´ management.endpoint.mappings.enabled true æ˜¯å¦å¯ç”¨ mappings ç«¯ç‚¹ management.endpoint.metrics.cache.time-to-live 0ms å¯ä»¥ç¼“å­˜å“åº”çš„æœ€é•¿æ—¶é—´ management.endpoint.metrics.enabled true æ˜¯å¦å¯ç”¨ metrics ç«¯ç‚¹ management.endpoint.prometheus.cache.time-to-live 0ms å¯ä»¥ç¼“å­˜å“åº”çš„æœ€é•¿æ—¶é—´ management.endpoint.prometheus.enabled true æ˜¯å¦å¯ç”¨ prometheus ç«¯ç‚¹ management.endpoint.scheduledtasks.cache.time-to-live 0ms å¯ä»¥ç¼“å­˜å“åº”çš„æœ€é•¿æ—¶é—´ management.endpoint.scheduledtasks.enabled true æ˜¯å¦å¯ç”¨ scheduledtasks ç«¯ç‚¹ management.endpoint.sessions.enabled true æ˜¯å¦å¯ç”¨ sessions ç«¯ç‚¹ management.endpoint.shutdown.enabled false æ˜¯å¦å¯ç”¨ shutdown ç«¯ç‚¹ management.endpoint.threaddump.cache.time-to-live 0ms å¯ä»¥ç¼“å­˜å“åº”çš„æœ€é•¿æ—¶é—´ management.endpoint.threaddump.enabled true æ˜¯å¦å¯ç”¨ threaddump ç«¯ç‚¹ management.endpoints.enabled-by-default æ˜¯å¦å¯ç”¨æˆ–è€…å…³é—­æ‰€æœ‰çš„ç«¯ç‚¹ management.endpoints.jmx.domain org.springframework.boot ç«¯ç‚¹ JMX åŸŸå management.endpoints.jmx.exposure.exclude åº”æ’é™¤çš„ç«¯ç‚¹ ID management.endpoints.jmx.exposure.include * åº”åŒ…å«çš„ç«¯ç‚¹ ID æˆ–å…¨éƒ¨ * management.endpoints.jmx.static-names è¿½åŠ åˆ°æ‰€æœ‰è¡¨ç¤ºç«¯ç‚¹çš„ MBean çš„ObjectName çš„é™æ€å±æ€§. management.endpoints.jmx.unique-names false æ˜¯å¦ç¡®ä¿ ObjectNames åœ¨å‘ç”Ÿå†²çªæ—¶è¢«ä¿®æ”¹ management.endpoints.web.base-path /actuator Web ç«¯ç‚¹çš„åŸºæœ¬è·¯å¾„ management.endpoints.web.cors.allow-credentials æ˜¯å¦æ”¯æŒå‡­è¯ management.endpoints.web.cors.allowed-headers Comma-separated list of headers to allow in a request. â€˜*â€™ allows all headers. management.endpoints.web.cors.allowed-methods Comma-separated list of methods to allow. â€˜*â€™ allows all methods. management.endpoints.web.cors.allowed-origins Comma-separated list of origins to allow. â€˜*â€™ allows all origins. management.endpoints.web.cors.exposed-headers Comma-separated list of headers to include in a response. management.endpoints.web.cors.max-age 1800s How long the response from a pre-flight request can be cached by clients. management.endpoints.web.exposure.exclude Endpoint IDs that should be excluded. management.endpoints.web.exposure.include health,info Endpoint IDs that should be included or â€˜*â€™ for all. management.endpoints.web.path-mapping Mapping between endpoint IDs and the path that should expose them. management.health.influxdb.enabled true Whether to enable InfluxDB health check. management.health.neo4j.enabled true Whether to enable Neo4j health check. management.health.status.http-mapping Mapping of health statuses to HTTP status codes. management.metrics.binders.files.enabled true Whether to enable files metrics. management.metrics.binders.integration.enabled true Whether to enable Spring Integration metrics. management.metrics.binders.jvm.enabled true Whether to enable JVM metrics. management.metrics.binders.logback.enabled true Whether to enable Logback metrics. management.metrics.binders.processor.enabled true Whether to enable processor metrics. management.metrics.binders.uptime.enabled true Whether to enable uptime metrics. management.metrics.distribution.percentiles Specific computed non-aggregable percentiles to ship to the backend for meter IDs starting-with the specified name. management.metrics.distribution.percentiles-histogram Whether meter IDs starting-with the specified name should be publish percentile histograms. management.metrics.distribution.sla Specific SLA boundaries for meter IDs starting-with the specified name. management.metrics.enable Whether meter IDs starting-with the specified name should be enabled. management.metrics.export.atlas.batch-size 10000 Number of measurements per request to use for this backend. management.metrics.export.atlas.config-refresh-frequency 10s Frequency for refreshing config settings from the LWC service. management.metrics.export.atlas.config-time-to-live 150s Time to live for subscriptions from the LWC service. management.metrics.export.atlas.config-uri http://localhost:7101/ lwc/api/v1/expressions/local-dev URI for the Atlas LWC endpoint to retrieve current subscriptions. management.metrics.export.atlas.connect-timeout 1s Connection timeout for requests to this backend. management.metrics.export.atlas.enabled true Whether exporting of metrics to this backend is enabled. management.metrics.export.atlas.eval-uri http://localhost:7101/ lwc/api/v1/evaluate URI for the Atlas LWC endpoint to evaluate the data for a subscription. management.metrics.export.atlas.lwc-enabled false Whether to enable streaming to Atlas LWC. management.metrics.export.atlas.meter-time-to-live 15m Time to live for meters that do not have any activity. management.metrics.export.atlas.num-threads 2 Number of threads to use with the metrics publishing scheduler. management.metrics.export.atlas.read-timeout 10s Read timeout for requests to this backend. management.metrics.export.atlas.step 1m Step size (i.e. reporting frequency) to use. management.metrics.export.atlas.uri http://localhost:7101/ api/v1/publish URI of the Atlas server. management.metrics.export.datadog.api-key Datadog API key. management.metrics.export.datadog.application-key Datadog application key. management.metrics.export.datadog.batch-size 10000 Number of measurements per request to use for this backend. management.metrics.export.datadog.connect-timeout 1s Connection timeout for requests to this backend. management.metrics.export.datadog.descriptions true Whether to publish descriptions metadata to Datadog. management.metrics.export.datadog.enabled true Whether exporting of metrics to this backend is enabled. management.metrics.export.datadog.host-tag instance Tag that will be mapped to â€œhostâ€ when shipping metrics to Datadog. management.metrics.export.datadog.num-threads 2 Number of threads to use with the metrics publishing scheduler. management.metrics.export.datadog.read-timeout 10s Read timeout for requests to this backend. management.metrics.export.datadog.step 1m Step size (i.e. reporting frequency) to use. management.metrics.export.datadog.uri https://app.datadoghq.com URI to ship metrics to. management.metrics.export.ganglia.addressing-mode multicast UDP addressing mode, either unicast or multicast. management.metrics.export.ganglia.duration-units milliseconds Base time unit used to report durations. management.metrics.export.ganglia.enabled true Whether exporting of metrics to Ganglia is enabled. management.metrics.export.ganglia.host localhost Host of the Ganglia server to receive exported metrics. management.metrics.export.ganglia.port 8649 Port of the Ganglia server to receive exported metrics. management.metrics.export.ganglia.protocol-version 3.1 Ganglia protocol version. management.metrics.export.ganglia.rate-units seconds Base time unit used to report rates. management.metrics.export.ganglia.step 1m Step size (i.e. reporting frequency) to use. management.metrics.export.ganglia.time-to-live 1 Time to live for metrics on Ganglia. management.metrics.export.graphite.duration-units milliseconds Base time unit used to report durations. management.metrics.export.graphite.enabled true Whether exporting of metrics to Graphite is enabled. management.metrics.export.graphite.host localhost Host of the Graphite server to receive exported metrics. management.metrics.export.graphite.port 2004 Port of the Graphite server to receive exported metrics. management.metrics.export.graphite.protocol pickled Protocol to use while shipping data to Graphite. management.metrics.export.graphite.rate-units seconds Base time unit used to report rates. management.metrics.export.graphite.step 1m Step size (i.e. reporting frequency) to use. management.metrics.export.graphite.tags-as-prefix `` For the default naming convention, turn the specified tag keys into part of the metric prefix. management.metrics.export.influx.auto-create-db true Whether to create the Influx database if it does not exist before attempting to publish metrics to it. management.metrics.export.influx.batch-size 10000 Number of measurements per request to use for this backend. management.metrics.export.influx.compressed true Whether to enable GZIP compression of metrics batches published to Influx. management.metrics.export.influx.connect-timeout 1s Connection timeout for requests to this backend. management.metrics.export.influx.consistency one Write consistency for each point. management.metrics.export.influx.db mydb Tag that will be mapped to â€œhostâ€ when shipping metrics to Influx. management.metrics.export.influx.enabled true Whether exporting of metrics to this backend is enabled. management.metrics.export.influx.num-threads 2 Number of threads to use with the metrics publishing scheduler. management.metrics.export.influx.password Login password of the Influx server. management.metrics.export.influx.read-timeout 10s Read timeout for requests to this backend. management.metrics.export.influx.retention-policy Retention policy to use (Influx writes to the DEFAULT retention policy if one is not specified). management.metrics.export.influx.step 1m Step size (i.e. reporting frequency) to use. management.metrics.export.influx.uri http://localhost:8086 URI of the Influx server. management.metrics.export.influx.user-name Login user of the Influx server. management.metrics.export.jmx.enabled true Whether exporting of metrics to JMX is enabled. management.metrics.export.jmx.step 1m Step size (i.e. reporting frequency) to use. management.metrics.export.newrelic.account-id New Relic account ID. management.metrics.export.newrelic.api-key New Relic API key. management.metrics.export.newrelic.batch-size 10000 Number of measurements per request to use for this backend. management.metrics.export.newrelic.connect-timeout 1s Connection timeout for requests to this backend. management.metrics.export.newrelic.enabled true Whether exporting of metrics to this backend is enabled. management.metrics.export.newrelic.num-threads 2 Number of threads to use with the metrics publishing scheduler. management.metrics.export.newrelic.read-timeout 10s Read timeout for requests to this backend. management.metrics.export.newrelic.step 1m Step size (i.e. reporting frequency) to use. management.metrics.export.newrelic.uri https://insights-collector .newrelic.com URI to ship metrics to. management.metrics.export.prometheus.descriptions true Whether to enable publishing descriptions as part of the scrape payload to Prometheus. management.metrics.export.prometheus.enabled true Whether exporting of metrics to Prometheus is enabled. management.metrics.export.prometheus.step 1m Step size (i.e. reporting frequency) to use. management.metrics.export.signalfx.access-token SignalFX access token. management.metrics.export.signalfx.batch-size 10000 Number of measurements per request to use for this backend. management.metrics.export.signalfx.connect-timeout 1s Connection timeout for requests to this backend. management.metrics.export.signalfx.enabled true Whether exporting of metrics to this backend is enabled. management.metrics.export.signalfx.num-threads 2 Number of threads to use with the metrics publishing scheduler. management.metrics.export.signalfx.read-timeout 10s Read timeout for requests to this backend. management.metrics.export.signalfx.source Uniquely identifies the app instance that is publishing metrics to SignalFx. management.metrics.export.signalfx.step 10s Step size (i.e. reporting frequency) to use. management.metrics.export.signalfx.uri https://ingest.signalfx.com URI to ship metrics to. management.metrics.export.simple.enabled true Whether, in the absence of any other exporter, exporting of metrics to an in-memory backend is enabled. management.metrics.export.simple.mode cumulative Counting mode. management.metrics.export.simple.step 1m Step size (i.e. reporting frequency) to use. management.metrics.export.statsd.enabled true Whether exporting of metrics to StatsD is enabled. management.metrics.export.statsd.flavor datadog StatsD line protocol to use. management.metrics.export.statsd.host localhost Host of the StatsD server to receive exported metrics. management.metrics.export.statsd.max-packet-length 1400 Total length of a single payload should be kept within your networkâ€™s MTU. management.metrics.export.statsd.polling-frequency 10s How often gauges will be polled. management.metrics.export.statsd.port 8125 Port of the StatsD server to receive exported metrics. management.metrics.export.statsd.publish-unchanged-meters true Whether to send unchanged meters to the StatsD server. management.metrics.export.statsd.queue-size 2147483647 Maximum size of the queue of items waiting to be sent to the StatsD server. management.metrics.export.wavefront.api-token API token used when publishing metrics directly to the Wavefront API host. management.metrics.export.wavefront.batch-size 10000 Number of measurements per request to use for this backend. management.metrics.export.wavefront.connect-timeout 1s Connection timeout for requests to this backend. management.metrics.export.wavefront.enabled true Whether exporting of metrics to this backend is enabled. management.metrics.export.wavefront.global-prefix Global prefix to separate metrics originating from this appâ€™s white box instrumentation from those originating from other Wavefront integrations when viewed in the Wavefront UI. management.metrics.export.wavefront.num-threads 2 Number of threads to use with the metrics publishing scheduler. management.metrics.export.wavefront.read-timeout 10s Read timeout for requests to this backend. management.metrics.export.wavefront.source Unique identifier for the app instance that is the source of metrics being published to Wavefront. management.metrics.export.wavefront.step 10s Step size (i.e. reporting frequency) to use. management.metrics.export.wavefront.uri https://longboard.wavefront.com URI to ship metrics to. management.metrics.use-global-registry true Whether auto-configured MeterRegistry implementations should be bound to the global static registry on Metrics. management.metrics.web.client.max-uri-tags 100 Maximum number of unique URI tag values allowed. management.metrics.web.client.requests-metric-name http.client.requests Name of the metric for sent requests. management.metrics.web.server.auto-time-requests true Whether requests handled by Spring MVC or WebFlux should be automatically timed. management.metrics.web.server.requests-metric-name http.server.requests Name of the metric for received requests. management.server.add-application-context-header false Add the â€œX-Application-Contextâ€ HTTP header in each response. management.server.address Network address to which the management endpoints should bind. management.server.port Management endpoint HTTP port (uses the same port as the application by default). management.server.servlet.context-path Management endpoint context-path (for instance,/management). management.server.ssl.ciphers management.server.ssl.client-auth management.server.ssl.enabled management.server.ssl.enabled-protocols management.server.ssl.key-alias management.server.ssl.key-password management.server.ssl.key-store management.server.ssl.key-store-password management.server.ssl.key-store-provider management.server.ssl.key-store-type management.server.ssl.protocol management.server.ssl.trust-store management.server.ssl.trust-store-password management.server.ssl.trust-store-provider management.server.ssl.trust-store-type management.trace.http.enabled true Whether to enable HTTP request-response tracing. management.trace.http.include request-headers,response-headers, cookies,errors Items to be included in the trace. server.error.include-exception false Include the â€œexceptionâ€ attribute. server.http2.enabled server.jetty.accesslog.append false Append to log. server.jetty.accesslog.date-format dd/MMM/yyyy:HH:mm:ss Z Timestamp format of the request log. server.jetty.accesslog.enabled false Enable access log. server.jetty.accesslog.extended-format false Enable extended NCSA format. server.jetty.accesslog.file-date-format Date format to place in log file name. server.jetty.accesslog.filename Log filename. server.jetty.accesslog.locale Locale of the request log. server.jetty.accesslog.log-cookies false Enable logging of the request cookies. server.jetty.accesslog.log-latency false Enable logging of request processing time. server.jetty.accesslog.log-server false Enable logging of the request hostname. server.jetty.accesslog.retention-period 31 Number of days before rotated log files are deleted. server.jetty.accesslog.time-zone GMT Timezone of the request log. server.servlet.application-display-name application Display name of the application. server.servlet.context-parameters Servlet context init parameters. server.servlet.context-path Context path of the application. server.servlet.jsp.class-name server.servlet.jsp.init-parameters server.servlet.jsp.registered server.servlet.path / Path of the main dispatcher servlet. server.servlet.session.cookie.comment server.servlet.session.cookie.domain server.servlet.session.cookie.http-only server.servlet.session.cookie.max-age server.servlet.session.cookie.name server.servlet.session.cookie.path server.servlet.session.cookie.secure server.servlet.session.persistent server.servlet.session.store-dir server.servlet.session.timeout server.servlet.session.tracking-modes server.tomcat.max-http-header-size 0 Maximum size, in bytes, of the HTTP message header. server.tomcat.resource.cache-ttl Time-to-live of the static resource cache. server.tomcat.use-relative-redirects Whether HTTP 1.1 and later location headers generated by a call to sendRedirect will use relative or absolute redirects. server.undertow.eager-filter-init true Whether servlet filters should be initialized on startup. spring.banner.charset UTF-8 Banner file encoding. spring.banner.image.height Height of the banner image in chars (default based on image height). spring.banner.image.invert false Whether images should be inverted for dark terminal themes. spring.banner.image.location classpath:banner.gif Banner image file location (jpg or png can also be used). spring.banner.image.margin 2 Left hand image margin in chars. spring.banner.image.width 76 Width of the banner image in chars. spring.banner.location classpath:banner.txt Banner text resource location. spring.batch.initialize-schema embedded Database schema initialization mode. spring.cache.redis.cache-null-values true Allow caching null values. spring.cache.redis.key-prefix Key prefix. spring.cache.redis.time-to-live Entry expiration. spring.cache.redis.use-key-prefix true Whether to use the key prefix when writing to Redis. spring.config.additional-location Config file locations used in addition to the defaults. spring.data.cassandra.connect-timeout Socket option: connection time out. spring.data.cassandra.pool.heartbeat-interval 30s Heartbeat interval after which a message is sent on an idle connection to make sure itâ€™s still alive. spring.data.cassandra.pool.idle-timeout 120s Idle timeout before an idle connection is removed. spring.data.cassandra.pool.max-queue-size 256 Maximum number of requests that get queued if no connection is available. spring.data.cassandra.pool.pool-timeout 5000ms Pool timeout when trying to acquire a connection from a hostâ€™s pool. spring.data.cassandra.read-timeout Socket option: read time out. spring.data.cassandra.repositories.type auto Type of Cassandra repositories to enable. spring.data.couchbase.repositories.type auto Type of Couchbase repositories to enable. spring.data.mongodb.repositories.type auto Type of Mongo repositories to enable. spring.data.neo4j.auto-index none Auto index mode. spring.data.web.pageable.default-page-size 20 Default page size. spring.data.web.pageable.max-page-size 2000 Maximum page size to be accepted. spring.data.web.pageable.one-indexed-parameters false Whether to expose and assume 1-based page number indexes. spring.data.web.pageable.page-parameter page Page index parameter name. spring.data.web.pageable.prefix `` General prefix to be prepended to the page number and page size parameters. spring.data.web.pageable.qualifier-delimiter _ Delimiter to be used between the qualifier and the actual page number and size properties. spring.data.web.pageable.size-parameter size Page size parameter name. spring.data.web.sort.sort-parameter sort Sort parameter name. spring.datasource.hikari.initialization-fail-timeout spring.datasource.hikari.metrics-tracker-factory spring.datasource.hikari.scheduled-executor spring.datasource.hikari.scheduled-executor-service spring.datasource.hikari.schema spring.datasource.initialization-mode embedded Initialize the datasource with available DDL and DML scripts. spring.devtools.restart.log-condition-evaluation-delta true Whether to log the condition evaluation delta upon restart. spring.flyway.baseline-description spring.flyway.baseline-on-migrate spring.flyway.baseline-version spring.flyway.check-location true Whether to check that migration scripts location exists. spring.flyway.clean-disabled spring.flyway.clean-on-validation-error spring.flyway.dry-run-output spring.flyway.enabled true æ˜¯å¦å¯ç”¨ flyway. spring.flyway.encoding spring.flyway.error-handlers spring.flyway.group spring.flyway.ignore-future-migrations spring.flyway.ignore-missing-migrations spring.flyway.init-sqls SQL statements to execute to initialize a connection immediately after obtaining it. spring.flyway.installed-by spring.flyway.locations spring.flyway.mixed spring.flyway.out-of-order spring.flyway.password å¦‚æœæ‚¨æƒ³è®© Flyway åˆ›å»ºè‡ªå·±çš„DataSourceï¼Œå¯ä»¥ä½¿ç”¨ JDBC å¯†ç  spring.flyway.placeholder-prefix spring.flyway.placeholder-replacement spring.flyway.placeholder-suffix spring.flyway.placeholders spring.flyway.repeatable-sql-migration-prefix spring.flyway.schemas spring.flyway.skip-default-callbacks spring.flyway.skip-default-resolvers spring.flyway.sql-migration-prefix spring.flyway.sql-migration-separator spring.flyway.sql-migration-suffix spring.flyway.sql-migration-suffixes spring.flyway.table spring.flyway.target spring.flyway.undo-sql-migration-prefix spring.flyway.url è¦è¿ç§»çš„æ•°æ®åº“çš„ JDBC URL spring.flyway.user ç™»å½•è¦è¿ç§»æ•°æ®åº“çš„ç”¨æˆ·å spring.flyway.validate-on-migrate spring.gson.date-format åºåˆ—åŒ– Date å¯¹è±¡æ—¶ä½¿ç”¨çš„æ ¼å¼ spring.gson.disable-html-escaping Whether to disable the escaping of HTML characters such as â€˜&lt;â€™, â€˜&gt;â€™, etc. spring.gson.disable-inner-class-serialization Whether to exclude inner classes during serialization. spring.gson.enable-complex-map-key-serialization Whether to enable serialization of complex map keys (i.e. non-primitives). spring.gson.exclude-fields-without-expose-annotation Whether to exclude all fields from consideration for serialization or deserialization that do not have the â€œExposeâ€ annotation. spring.gson.field-naming-policy Naming policy that should be applied to an objectâ€™s field during serialization and deserialization. spring.gson.generate-non-executable-json Whether to generate non executable JSON by prefixing the output with some special text. spring.gson.lenient Whether to be lenient about parsing JSON that doesnâ€™t conform to RFC 4627. spring.gson.long-serialization-policy Serialization policy for Long and long types. spring.gson.pretty-printing Whether to output serialized JSON that fits in a page for pretty printing. spring.gson.serialize-nulls Whether to serialize null fields. spring.influx.password Influx ç™»å½•ç”¨æˆ·åå¯†ç  spring.influx.url InfluxDB æ•°æ®åº“ URL spring.influx.user Influx ç™»å½•ç”¨æˆ·å spring.integration.jdbc.initialize-schema embedded Database schema initialization mode. spring.integration.jdbc.schema classpath:org/springframework/ integration/jdbc/schema-@@platform@@.sql Path to the SQL file to use to initialize the database schema. spring.jdbc.template.fetch-size -1 Number of rows that should be fetched from the database when more rows are needed. spring.jdbc.template.max-rows -1 Maximum number of rows. spring.jdbc.template.query-timeout Query timeout. spring.jpa.mapping-resources Mapping resources (equivalent to â€œmapping-fileâ€ entries in persistence.xml). spring.jta.atomikos.datasource.concurrent-connection-validation spring.jta.atomikos.properties.allow-sub-transactions true Specify whether sub-transactions are allowed. spring.jta.atomikos.properties.default-max-wait-time-on-shutdown How long should normal shutdown (no-force) wait for transactions to complete. spring.jta.atomikos.properties.recovery.delay 10000ms Delay between two recovery scans. spring.jta.atomikos.properties.recovery.forget-orphaned-log-entries-delay 86400000ms Delay after which recovery can cleanup pending (â€˜orphanedâ€™) log entries. spring.jta.atomikos.properties.recovery.max-retries 5 Number of retry attempts to commit the transaction before throwing an exception. spring.jta.atomikos.properties.recovery.retry-interval 10000ms Delay between retry attempts. spring.kafka.admin.client-id ID to pass to the server when making requests. spring.kafka.admin.fail-fast false Whether to fail fast if the broker is not available on startup. spring.kafka.admin.properties Additional admin-specific properties used to configure the client. spring.kafka.admin.ssl.key-password Password of the private key in the key store file. spring.kafka.admin.ssl.keystore-location Location of the key store file. spring.kafka.admin.ssl.keystore-password Store password for the key store file. spring.kafka.admin.ssl.truststore-location Location of the trust store file. spring.kafka.admin.ssl.truststore-password Store password for the trust store file. spring.kafka.consumer.properties Additional consumer-specific properties used to configure the client. spring.kafka.consumer.ssl.key-password Password of the private key in the key store file. spring.kafka.consumer.ssl.keystore-location Location of the key store file. spring.kafka.consumer.ssl.keystore-password Store password for the key store file. spring.kafka.consumer.ssl.truststore-location Location of the trust store file. spring.kafka.consumer.ssl.truststore-password Store password for the trust store file. spring.kafka.jaas.control-flag required Control flag for login configuration. spring.kafka.jaas.enabled false Whether to enable JAAS configuration. spring.kafka.jaas.login-module com.sun.security.auth .module.Krb5LoginModule Login module. spring.kafka.jaas.options Additional JAAS options. spring.kafka.listener.client-id Prefix for the listenerâ€™s consumer client.id property. spring.kafka.listener.idle-event-interval Time between publishing idle consumer events (no data received). spring.kafka.listener.log-container-config Whether to log the container configuration during initialization (INFO level). spring.kafka.listener.monitor-interval Time between checks for non-responsive consumers. spring.kafka.listener.no-poll-threshold Multiplier applied to â€œpollTimeoutâ€ to determine if a consumer is non-responsive. spring.kafka.listener.type single Listener type. spring.kafka.producer.properties Additional producer-specific properties used to configure the client. spring.kafka.producer.ssl.key-password Password of the private key in the key store file. spring.kafka.producer.ssl.keystore-location Location of the key store file. spring.kafka.producer.ssl.keystore-password Store password for the key store file. spring.kafka.producer.ssl.truststore-location Location of the trust store file. spring.kafka.producer.ssl.truststore-password Store password for the trust store file. spring.kafka.producer.transaction-id-prefix When non empty, enables transaction support for producer. spring.ldap.anonymous-read-only false Whether read-only operations should use an anonymous environment. spring.liquibase.change-log classpath:/db/changelog/ db.changelog-master.yaml Change log configuration path. spring.liquibase.check-change-log-location true Whether to check that the change log location exists. spring.liquibase.contexts Comma-separated list of runtime contexts to use. spring.liquibase.default-schema Default database schema. spring.liquibase.drop-first false Whether to first drop the database schema. spring.liquibase.enabled true Whether to enable Liquibase support. spring.liquibase.labels Comma-separated list of runtime labels to use. spring.liquibase.parameters Change log parameters. spring.liquibase.password Login password of the database to migrate. spring.liquibase.rollback-file File to which rollback SQL is written when an update is performed. spring.liquibase.url JDBC URL of the database to migrate. spring.liquibase.user Login user of the database to migrate. spring.main.web-application-type Flag to explicitly request a specific type of web application. spring.messages.cache-duration Loaded resource bundle files cache duration. spring.messages.use-code-as-default-message false Whether to use the message code as the default message instead of throwing a â€œNoSuchMessageExceptionâ€. spring.mvc.contentnegotiation.favor-parameter false Whether a request parameter (â€œformatâ€ by default) should be used to determine the requested media type. spring.mvc.contentnegotiation.favor-path-extension false Whether the path extension in the URL path should be used to determine the requested media type. spring.mvc.contentnegotiation.media-types Map file extensions to media types for content negotiation. spring.mvc.contentnegotiation.parameter-name Query parameter name to use when â€œfavor-parameterâ€ is enabled. spring.mvc.pathmatch.use-registered-suffix-pattern false Whether suffix pattern matching should work only against extensions registered with â€œspring.mvc.contentnegotiation.media-types.*â€. spring.mvc.pathmatch.use-suffix-pattern false Whether to use suffix pattern match (â€œ.*â€) when matching patterns to requests. spring.quartz.jdbc.initialize-schema embedded Database schema initialization mode. spring.quartz.jdbc.schema classpath:org/quartz/impl/ jdbcjobstore/ tables_@@platform@@.sql Path to the SQL file to use to initialize the database schema. spring.quartz.job-store-type memory Quartz job store type. spring.quartz.properties Additional Quartz Scheduler properties. spring.rabbitmq.listener.direct.acknowledge-mode Acknowledge mode of container. spring.rabbitmq.listener.direct.auto-startup true Whether to start the container automatically on startup. spring.rabbitmq.listener.direct.consumers-per-queue Number of consumers per queue. spring.rabbitmq.listener.direct.default-requeue-rejected Whether rejected deliveries are re-queued by default. spring.rabbitmq.listener.direct.idle-event-interval How often idle container events should be published. spring.rabbitmq.listener.direct.prefetch Number of messages to be handled in a single request. spring.rabbitmq.listener.direct.retry.enabled false Whether publishing retries are enabled. spring.rabbitmq.listener.direct.retry.initial-interval 1000ms Duration between the first and second attempt to deliver a message. spring.rabbitmq.listener.direct.retry.max-attempts 3 Maximum number of attempts to deliver a message. spring.rabbitmq.listener.direct.retry.max-interval 10000ms Maximum duration between attempts. spring.rabbitmq.listener.direct.retry.multiplier 1 Multiplier to apply to the previous retry interval. spring.rabbitmq.listener.direct.retry.stateless true Whether retries are stateless or stateful. spring.rabbitmq.listener.type simple Listener container type. spring.rabbitmq.ssl.key-store-type PKCS12 Key store type. spring.rabbitmq.ssl.trust-store-type JKS Trust store type. spring.rabbitmq.template.exchange `` Name of the default exchange to use for send operations. spring.rabbitmq.template.routing-key `` Value of a default routing key to use for send operations. spring.reactor.stacktrace-mode.enabled false Whether Reactor should collect stacktrace information at runtime. spring.redis.jedis.pool.max-active 8 Maximum number of connections that can be allocated by the pool at a given time. spring.redis.jedis.pool.max-idle 8 Maximum number of â€œidleâ€ connections in the pool. spring.redis.jedis.pool.max-wait -1ms Maximum amount of time a connection allocation should block before throwing an exception when the pool is exhausted. spring.redis.jedis.pool.min-idle 0 Target for the minimum number of idle connections to maintain in the pool. spring.redis.lettuce.pool.max-active 8 Maximum number of connections that can be allocated by the pool at a given time. spring.redis.lettuce.pool.max-idle 8 Maximum number of â€œidleâ€ connections in the pool. spring.redis.lettuce.pool.max-wait -1ms Maximum amount of time a connection allocation should block before throwing an exception when the pool is exhausted. spring.redis.lettuce.pool.min-idle 0 Target for the minimum number of idle connections to maintain in the pool. spring.redis.lettuce.shutdown-timeout 100ms Shutdown timeout. spring.resources.cache.cachecontrol.cache-private Indicate that the response message is intended for a single user and must not be stored by a shared cache. spring.resources.cache.cachecontrol.cache-public Indicate that any cache may store the response. spring.resources.cache.cachecontrol.max-age Maximum time the response should be cached, in seconds if no duration suffix is not specified. spring.resources.cache.cachecontrol.must-revalidate Indicate that once it has become stale, a cache must not use the response without re-validating it with the server. spring.resources.cache.cachecontrol.no-cache Indicate that the cached response can be reused only if re-validated with the server. spring.resources.cache.cachecontrol.no-store Indicate to not cache the response in any case. spring.resources.cache.cachecontrol.no-transform Indicate intermediaries (caches and others) that they should not transform the response content. spring.resources.cache.cachecontrol.proxy-revalidate Same meaning as the â€œmust-revalidateâ€ directive, except that it does not apply to private caches. spring.resources.cache.cachecontrol.s-max-age Maximum time the response should be cached by shared caches, in seconds if no duration suffix is not specified. spring.resources.cache.cachecontrol.stale-if-error Maximum time the response may be used when errors are encountered, in seconds if no duration suffix is not specified. spring.resources.cache.cachecontrol.stale-while-revalidate Maximum time the response can be served after it becomes stale, in seconds if no duration suffix is not specified. spring.resources.cache.period Cache period for the resources served by the resource handler. spring.security.filter.dispatcher-types async,error,request Security filter chain dispatcher types. spring.security.filter.order -100 Security filter chain order. spring.security.oauth2.client.provider OAuth provider details. spring.security.oauth2.client.registration OAuth client registrations. spring.security.user.name user Default user name. spring.security.user.password Password for the default user name. spring.security.user.roles Granted roles for the default user name. spring.servlet.multipart.enabled true Whether to enable support of multipart uploads. spring.servlet.multipart.file-size-threshold 0 Threshold after which files are written to disk. spring.servlet.multipart.location Intermediate location of uploaded files. spring.servlet.multipart.max-file-size 1MB Max file size. spring.servlet.multipart.max-request-size 10MB Max request size. spring.servlet.multipart.resolve-lazily false Whether to resolve the multipart request lazily at the time of file or parameter access. spring.session.jdbc.cleanup-cron 0 * * * * * Cron expression for expired session cleanup job. spring.session.jdbc.initialize-schema embedded Database schema initialization mode. spring.session.mongodb.collection-name sessions Collection name used to store sessions. spring.session.redis.cleanup-cron 0 * * * * * Cron expression for expired session cleanup job. spring.session.servlet.filter-dispatcher-types async,error,request Session repository filter dispatcher types. spring.session.servlet.filter-order Session repository filter order. spring.thymeleaf.enable-spring-el-compiler false Enable the SpringEL compiler in SpringEL expressions. spring.thymeleaf.reactive.chunked-mode-view-names Comma-separated list of view names (patterns allowed) that should be the only ones executed in CHUNKED mode when a max chunk size is set. spring.thymeleaf.reactive.full-mode-view-names Comma-separated list of view names (patterns allowed) that should be executed in FULL mode even if a max chunk size is set. spring.thymeleaf.reactive.max-chunk-size 0 Maximum size of data buffers used for writing to the response, in bytes. spring.thymeleaf.reactive.media-types Media types supported by the view technology. spring.thymeleaf.servlet.content-type text/html Content-Type value written to HTTP responses. spring.webflux.date-format Date format to use. spring.webflux.static-path-pattern /** Path pattern used for static resources. spring.webservices.wsdl-locations Comma-separated list of locations of WSDLs and accompanying XSDs to be exposed as beans. Key Replacementï¼ˆæ›¿ä»£ï¼‰ åŸå›  banner.charset spring.banner.charset banner.image.height spring.banner.image.height banner.image.invert spring.banner.image.invert banner.image.location spring.banner.image.location banner.image.margin spring.banner.image.margin banner.image.width spring.banner.image.width banner.location spring.banner.location endpoints.actuator.enabled actuator ç«¯ç‚¹ä¸å†å¯ç”¨ endpoints.actuator.path actuator ç«¯ç‚¹ä¸å†å¯ç”¨ endpoints.actuator.sensitive actuator ç«¯ç‚¹ä¸å†å¯ç”¨ endpoints.auditevents.enabled management.endpoint. auditevents.enabled endpoints.auditevents.path management.endpoints.web.path-mapping.auditevents endpoints.auditevents.sensitive ç»ˆç«¯æ•æ„Ÿæ ‡å¿—ä¸å†å¯å®šåˆ¶ï¼Œå› ä¸ºSpring Boot ä¸å†æä¾›å¯è‡ªå®šä¹‰çš„å®‰å…¨è‡ªåŠ¨é…ç½® endpoints.autoconfig.enabled management.endpoint. conditions.enabled endpoints.autoconfig.id ç«¯ç‚¹æ ‡è¯†ç¬¦ä¸å†å¯å®šåˆ¶ endpoints.autoconfig.path management.endpoints.web.path-mapping.conditions endpoints.autoconfig.sensitive ç»ˆç«¯æ•æ„Ÿæ ‡å¿—ä¸å†å¯å®šåˆ¶ï¼Œå› ä¸ºSpring Boot ä¸å†æä¾›å¯è‡ªå®šä¹‰çš„å®‰å…¨è‡ªåŠ¨é…ç½® endpoints.beans.enabled management.endpoint.beans.enabled endpoints.beans.id ç«¯ç‚¹æ ‡è¯†ç¬¦ä¸å†å¯å®šåˆ¶ endpoints.beans.path management.endpoints.web.path-mapping.beans endpoints.beans.sensitive ç»ˆç«¯æ•æ„Ÿæ ‡å¿—ä¸å†å¯å®šåˆ¶ï¼Œå› ä¸ºSpring Boot ä¸å†æä¾›å¯è‡ªå®šä¹‰çš„å®‰å…¨è‡ªåŠ¨é…ç½® endpoints.configprops.enabled management.endpoint. configprops.enabled endpoints.configprops.id ç«¯ç‚¹æ ‡è¯†ç¬¦ä¸å†å¯å®šåˆ¶ endpoints.configprops.keys-to-sanitize management.endpoint. configprops.keys-to-sanitize endpoints.configprops.path management.endpoints.web.path-mapping.configprops endpoints.configprops.sensitive ç»ˆç«¯æ•æ„Ÿæ ‡å¿—ä¸å†å¯å®šåˆ¶ï¼Œå› ä¸ºSpring Boot ä¸å†æä¾›å¯è‡ªå®šä¹‰çš„å®‰å…¨è‡ªåŠ¨é…ç½® endpoints.cors.allow-credentials management.endpoints. web.cors.allow-credentials endpoints.cors.allowed-headers management.endpoints. web.cors.allowed-headers endpoints.cors.allowed-methods management.endpoints. web.cors.allowed-methods endpoints.cors.allowed-origins management.endpoints. web.cors.allowed-origins endpoints.cors.exposed-headers management.endpoints. web.cors.exposed-headers endpoints.cors.max-age management.endpoints. web.cors.max-age endpoints.docs.curies.enabled docs ç«¯ç‚¹ä¸å†å¯ç”¨ endpoints.docs.enabled docs ç«¯ç‚¹ä¸å†å¯ç”¨ endpoints.docs.path docs ç«¯ç‚¹ä¸å†å¯ç”¨ endpoints.docs.sensitive docs ç«¯ç‚¹ä¸å†å¯ç”¨ endpoints.dump.enabled management.endpoint. threaddump.enabled endpoints.dump.id ç«¯ç‚¹æ ‡è¯†ç¬¦ä¸å†å¯å®šåˆ¶ endpoints.dump.path management.endpoints.web.path-mapping.dump endpoints.dump.sensitive ç»ˆç«¯æ•æ„Ÿæ ‡å¿—ä¸å†å¯å®šåˆ¶ï¼Œå› ä¸ºSpring Boot ä¸å†æä¾›å¯è‡ªå®šä¹‰çš„å®‰å…¨è‡ªåŠ¨é…ç½® endpoints.enabled management.endpoints. enabled-by-default endpoints.env.enabled management.endpoint.env.enabled endpoints.env.id ç«¯ç‚¹æ ‡è¯†ç¬¦ä¸å†å¯å®šåˆ¶ endpoints.env.keys-to-sanitize management.endpoint. env.keys-to-sanitize endpoints.env.path management.endpoints. web.path-mapping.env endpoints.env.sensitive ç»ˆç«¯æ•æ„Ÿæ ‡å¿—ä¸å†å¯å®šåˆ¶ï¼Œå› ä¸ºSpring Boot ä¸å†æä¾›å¯è‡ªå®šä¹‰çš„å®‰å…¨è‡ªåŠ¨é…ç½® endpoints.flyway.enabled management.endpoint.flyway.enabled endpoints.flyway.id ç«¯ç‚¹æ ‡è¯†ç¬¦ä¸å†å¯å®šåˆ¶ endpoints.flyway.sensitive ç»ˆç«¯æ•æ„Ÿæ ‡å¿—ä¸å†å¯å®šåˆ¶ï¼Œå› ä¸ºSpring Boot ä¸å†æä¾›å¯è‡ªå®šä¹‰çš„å®‰å…¨è‡ªåŠ¨é…ç½® endpoints.health.enabled management.endpoint.health.enabled endpoints.health.id ç«¯ç‚¹æ ‡è¯†ç¬¦ä¸å†å¯å®šåˆ¶ endpoints.health.mapping management.health.status.http-mapping endpoints.health.path management.endpoints.web.path-mapping.health endpoints.health.sensitive ç»ˆç«¯æ•æ„Ÿæ ‡å¿—ä¸å†å¯å®šåˆ¶ï¼Œå› ä¸ºSpring Boot ä¸å†æä¾›å¯è‡ªå®šä¹‰çš„å®‰å…¨è‡ªåŠ¨é…ç½® endpoints.health.time-to-live management.endpoint. health.cache.time-to-live endpoints.heapdump.enabled management.endpoint.heapdump.enabled endpoints.heapdump.path management.endpoints.web.path-mapping.heapdump endpoints.heapdump.sensitive ç»ˆç«¯æ•æ„Ÿæ ‡å¿—ä¸å†å¯å®šåˆ¶ï¼Œå› ä¸ºSpring Boot ä¸å†æä¾›å¯è‡ªå®šä¹‰çš„å®‰å…¨è‡ªåŠ¨é…ç½® endpoints.hypermedia.enabled Actuator ä¸­çš„ Hypermedia ä¸å†å¯ç”¨ endpoints.info.enabled management.endpoint.info.enabled endpoints.info.id ç«¯ç‚¹æ ‡è¯†ç¬¦ä¸å†å¯å®šåˆ¶ endpoints.info.path management.endpoints.web.path-mapping.info endpoints.info.sensitive ç»ˆç«¯æ•æ„Ÿæ ‡å¿—ä¸å†å¯å®šåˆ¶ï¼Œå› ä¸ºSpring Boot ä¸å†æä¾›å¯è‡ªå®šä¹‰çš„å®‰å…¨è‡ªåŠ¨é…ç½® endpoints.jmx.domain management.endpoints.jmx.domain endpoints.jmx.enabled management.endpoints. jmx.exposure.exclude endpoints.jmx.static-names management.endpoints. jmx.static-names endpoints.jmx.unique-names management.endpoints. jmx.unique-names endpoints.jolokia.enabled management.endpoint. jolokia.enabled endpoints.jolokia.path management.endpoints.web.path-mapping.jolokia endpoints.jolokia.sensitive ç»ˆç«¯æ•æ„Ÿæ ‡å¿—ä¸å†å¯å®šåˆ¶ï¼Œå› ä¸ºSpring Boot ä¸å†æä¾›å¯è‡ªå®šä¹‰çš„å®‰å…¨è‡ªåŠ¨é…ç½® endpoints.liquibase.enabled management.endpoint. liquibase.enabled endpoints.liquibase.id ç«¯ç‚¹æ ‡è¯†ç¬¦ä¸å†å¯å®šåˆ¶ endpoints.liquibase.sensitive ç»ˆç«¯æ•æ„Ÿæ ‡å¿—ä¸å†å¯å®šåˆ¶ï¼Œå› ä¸ºSpring Boot ä¸å†æä¾›å¯è‡ªå®šä¹‰çš„å®‰å…¨è‡ªåŠ¨é…ç½® endpoints.logfile.enabled management.endpoint. logfile.enabled endpoints.logfile.external-file management.endpoint. logfile.external-file endpoints.logfile.path management.endpoints.web.path-mapping.logfile endpoints.logfile.sensitive ç»ˆç«¯æ•æ„Ÿæ ‡å¿—ä¸å†å¯å®šåˆ¶ï¼Œå› ä¸ºSpring Boot ä¸å†æä¾›å¯è‡ªå®šä¹‰çš„å®‰å…¨è‡ªåŠ¨é…ç½® endpoints.loggers.enabled management.endpoint. loggers.enabled endpoints.loggers.id ç«¯ç‚¹æ ‡è¯†ç¬¦ä¸å†å¯å®šåˆ¶ endpoints.loggers.path management.endpoints.web.path-mapping.loggers endpoints.loggers.sensitive ç»ˆç«¯æ•æ„Ÿæ ‡å¿—ä¸å†å¯å®šåˆ¶ï¼Œå› ä¸ºSpring Boot ä¸å†æä¾›å¯è‡ªå®šä¹‰çš„å®‰å…¨è‡ªåŠ¨é…ç½® endpoints.mappings.enabled management.endpoint. mappings.enabled endpoints.mappings.id ç«¯ç‚¹æ ‡è¯†ç¬¦ä¸å†å¯å®šåˆ¶ endpoints.mappings.path management.endpoints.web.path-mapping.mappings endpoints.mappings.sensitive ç»ˆç«¯æ•æ„Ÿæ ‡å¿—ä¸å†å¯å®šåˆ¶ï¼Œå› ä¸ºSpring Boot ä¸å†æä¾›å¯è‡ªå®šä¹‰çš„å®‰å…¨è‡ªåŠ¨é…ç½® endpoints.metrics.enabled management.endpoint.metrics.enabled endpoints.metrics.filter.counter-submissions Metrics support ç°åœ¨ä½¿ç”¨åƒåˆ†å°º endpoints.metrics.filter.enabled Metrics support ç°åœ¨ä½¿ç”¨åƒåˆ†å°º endpoints.metrics.filter.gauge-submissions Metrics support ç°åœ¨ä½¿ç”¨åƒåˆ†å°º endpoints.metrics.id ç«¯ç‚¹æ ‡è¯†ç¬¦ä¸å†å¯å®šåˆ¶ endpoints.metrics.path management.endpoints.web.path-mapping.metrics endpoints.metrics.sensitive ç»ˆç«¯æ•æ„Ÿæ ‡å¿—ä¸å†å¯å®šåˆ¶ï¼Œå› ä¸ºSpring Boot ä¸å†æä¾›å¯è‡ªå®šä¹‰çš„å®‰å…¨è‡ªåŠ¨é…ç½® endpoints.sensitive ç»ˆç«¯æ•æ„Ÿæ ‡å¿—ä¸å†å¯å®šåˆ¶ï¼Œå› ä¸ºSpring Boot ä¸å†æä¾›å¯è‡ªå®šä¹‰çš„å®‰å…¨è‡ªåŠ¨é…ç½® endpoints.shutdown.enabled management.endpoint. shutdown.enabled endpoints.shutdown.id ç«¯ç‚¹æ ‡è¯†ç¬¦ä¸å†å¯å®šåˆ¶ endpoints.shutdown.path management.endpoints.web.path-mapping.shutdown endpoints.shutdown.sensitive ç»ˆç«¯æ•æ„Ÿæ ‡å¿—ä¸å†å¯å®šåˆ¶ï¼Œå› ä¸ºSpring Boot ä¸å†æä¾›å¯è‡ªå®šä¹‰çš„å®‰å…¨è‡ªåŠ¨é…ç½® endpoints.trace.enabled management.endpoint. httptrace.enabled endpoints.trace.filter.enabled management.trace.http.enabled endpoints.trace.id ç«¯ç‚¹æ ‡è¯†ç¬¦ä¸å†å¯å®šåˆ¶ endpoints.trace.path management.endpoints.web.path-mapping.httptrace endpoints.trace.sensitive ç»ˆç«¯æ•æ„Ÿæ ‡å¿—ä¸å†å¯å®šåˆ¶ï¼Œå› ä¸ºSpring Boot ä¸å†æä¾›å¯è‡ªå®šä¹‰çš„å®‰å…¨è‡ªåŠ¨é…ç½® error.path Path of the error controller. flyway.baseline-description spring.flyway.baseline-description flyway.baseline-on-migrate spring.flyway.baseline-on-migrate flyway.baseline-version spring.flyway.baseline-version flyway.check-location spring.flyway.check-location flyway.clean-on-validation-error spring.flyway. clean-on-validation-error flyway.enabled spring.flyway.enabled flyway.encoding spring.flyway.encoding flyway.ignore-failed-future-migration flyway.init-sqls spring.flyway.init-sqls flyway.locations spring.flyway.locations flyway.out-of-order spring.flyway.out-of-order flyway.password spring.flyway.password flyway.placeholder-prefix spring.flyway.placeholder-prefix flyway.placeholder-replacement spring.flyway.placeholder-replacement flyway.placeholder-suffix spring.flyway.placeholder-suffix flyway.placeholders spring.flyway.placeholders flyway.schemas spring.flyway.schemas flyway.sql-migration-prefix spring.flyway.sql-migration-prefix flyway.sql-migration-separator spring.flyway.sql-migration-separator flyway.sql-migration-suffix spring.flyway.sql-migration-suffixes flyway.table spring.flyway.table flyway.target spring.flyway.target flyway.url spring.flyway.url flyway.user spring.flyway.user flyway.validate-on-migrate spring.flyway.validate-on-migrate jolokia.config management.endpoint.jolokia.config liquibase.change-log spring.liquibase.change-log liquibase.check-change-log-location spring.liquibase.check-change-log-location liquibase.contexts spring.liquibase.contexts liquibase.default-schema spring.liquibase.default-schema liquibase.drop-first spring.liquibase.drop-first liquibase.enabled spring.liquibase.enabled liquibase.labels spring.liquibase.labels liquibase.parameters spring.liquibase.parameters liquibase.password spring.liquibase.password liquibase.rollback-file spring.liquibase.rollback-file liquibase.url spring.liquibase.url liquibase.user spring.liquibase.user management.add-application-context-header management.server.add-application-context-header management.address management.server.address management.context-path management.server. servlet.context-path management.port management.server.port management.security.enabled ç°åœ¨æä¾›å…¨å±€ security è‡ªåŠ¨é…ç½®ã€‚ management.security.roles security è‡ªåŠ¨é…ç½®ä¸å†å¯å®šåˆ¶ management.security.sessions security è‡ªåŠ¨é…ç½®ä¸å†å¯å®šåˆ¶ management.shell.auth.jaas.domain CRaSH æ”¯æŒä¸å†å¯ç”¨ management.shell.auth.key.path CRaSH æ”¯æŒä¸å†å¯ç”¨ management.shell.auth.simple.user.name CRaSH æ”¯æŒä¸å†å¯ç”¨ management.shell.auth.simple.user.password CRaSH æ”¯æŒä¸å†å¯ç”¨ management.shell.auth.spring.roles CRaSH æ”¯æŒä¸å†å¯ç”¨ management.shell.auth.type CRaSH æ”¯æŒä¸å†å¯ç”¨ management.shell.ssh.auth-timeout CRaSH æ”¯æŒä¸å†å¯ç”¨ management.shell.ssh.enabled CRaSH æ”¯æŒä¸å†å¯ç”¨ management.shell.ssh.idle-timeout CRaSH æ”¯æŒä¸å†å¯ç”¨ management.shell.ssh.key-path CRaSH æ”¯æŒä¸å†å¯ç”¨ management.shell.ssh.port CRaSH æ”¯æŒä¸å†å¯ç”¨ management.shell.telnet.enabled CRaSH æ”¯æŒä¸å†å¯ç”¨ management.shell.telnet.port CRaSH æ”¯æŒä¸å†å¯ç”¨ management.ssl.ciphers management.server.ssl.ciphers management.ssl.client-auth management.server.ssl.client-auth management.ssl.enabled management.server.ssl.enabled management.ssl.enabled-protocols management.server.ssl.enabled-protocols management.ssl.key-alias management.server.ssl.key-alias management.ssl.key-password management.server.ssl.key-password management.ssl.key-store management.server.ssl.key-store management.ssl.key-store-password management.server.ssl.key-store-password management.ssl.key-store-provider management.server.ssl.key-store-provider management.ssl.key-store-type management.server.ssl.key-store-type management.ssl.protocol management.server.ssl.protocol management.ssl.trust-store management.server.ssl.trust-store management.ssl.trust-store-password management.server.ssl.trust-store-password management.ssl.trust-store-provider management.server.ssl.trust-store-provider management.ssl.trust-store-type management.server.ssl.trust-store-type management.trace.include management.trace.http.include security.basic.authorize-mode security è‡ªåŠ¨é…ç½®ä¸å†å¯å®šåˆ¶ security.basic.enabled security è‡ªåŠ¨é…ç½®ä¸å†å¯å®šåˆ¶ security.basic.path security è‡ªåŠ¨é…ç½®ä¸å†å¯å®šåˆ¶ security.basic.realm security è‡ªåŠ¨é…ç½®ä¸å†å¯å®šåˆ¶ security.enable-csrf security è‡ªåŠ¨é…ç½®ä¸å†å¯å®šåˆ¶ security.filter-dispatcher-types spring.security. filter.dispatcher-types security.filter-order spring.security.filter.order security.headers.cache security è‡ªåŠ¨é…ç½®ä¸å†å¯å®šåˆ¶ security.headers.content-security-policy security è‡ªåŠ¨é…ç½®ä¸å†å¯å®šåˆ¶ security.headers.content-security-policy-mode security è‡ªåŠ¨é…ç½®ä¸å†å¯å®šåˆ¶ security.headers.content-type security è‡ªåŠ¨é…ç½®ä¸å†å¯å®šåˆ¶ security.headers.frame security è‡ªåŠ¨é…ç½®ä¸å†å¯å®šåˆ¶ security.headers.hsts security è‡ªåŠ¨é…ç½®ä¸å†å¯å®šåˆ¶ security.headers.xss security è‡ªåŠ¨é…ç½®ä¸å†å¯å®šåˆ¶ security.ignored security è‡ªåŠ¨é…ç½®ä¸å†å¯å®šåˆ¶ security.oauth2. authorization.check-token-access Spring Security è®¿é—®è§„åˆ™ç”¨äºæ£€æŸ¥ä»¤ç‰Œç«¯ç‚¹ï¼ˆä¾‹å¦‚ï¼ŒSpELè¡¨è¾¾å¼ï¼Œå¦‚â€œisAuthenticatedï¼ˆï¼‰â€ï¼‰ security.oauth2.authorization.realm å®¢æˆ·ç«¯èº«ä»½éªŒè¯çš„é¢†åŸŸåç§° security.oauth2.authorization.token-key-access Spring Securityè®¿é—®è§„åˆ™ç”¨äºæ£€æŸ¥ä»¤ç‰Œç«¯ç‚¹ï¼ˆä¾‹å¦‚ï¼ŒSpELè¡¨è¾¾å¼ï¼Œå¦‚â€œisAuthenticatedï¼ˆï¼‰â€ï¼‰ security.oauth2.client.access-token-uri security.oauth2.client.access-token-validity-seconds security.oauth2.client.additional-information security.oauth2.client.authentication-scheme security.oauth2.client.authorities security.oauth2.client.authorized-grant-types security.oauth2.client.auto-approve-scopes security.oauth2.client.client-authentication-scheme security.oauth2.client.client-id security.oauth2.client.client-secret security.oauth2.client.grant-type security.oauth2.client.id security.oauth2.client.pre- established-redirect-uri security.oauth2.client.refresh-token-validity-seconds security.oauth2.client.registered-redirect-uri security.oauth2.client.resource-ids security.oauth2.client.scope security.oauth2.client.token-name security.oauth2.client.use-current-uri security.oauth2.client.user-authorization-uri security.oauth2.resource.filter-order 0 ç”¨äºéªŒè¯ä»¤ç‰Œçš„è¿‡æ»¤å™¨é“¾çš„é¡ºåºã€‚ security.oauth2.resource.id èµ„æºçš„æ ‡è¯†ç¬¦ security.oauth2.resource.jwk.key-set-uri è·å–éªŒè¯å¯†é’¥ä»¥éªŒè¯ JWT ä»¤ç‰Œçš„ URI security.oauth2.resource.jwt.key-uri JWT ä»¤ç‰Œçš„ URI security.oauth2.resource.jwt.key-value JWT ä»¤ç‰Œçš„éªŒè¯å¯†é’¥ security.oauth2.resource.prefer-token-info true ä½¿ç”¨ä»¤ç‰Œä¿¡æ¯ï¼Œå¯ä»¥è®¾ç½®ä¸º falseä»¥ä½¿ç”¨ç”¨æˆ·ä¿¡æ¯ security.oauth2.resource.service-id resource security.oauth2.resource.token-info-uri token decoding ç«¯ç‚¹çš„ URI security.oauth2.resource.token-type ä½¿ç”¨ userInfoUri æ—¶è¦å‘é€çš„ä»¤ç‰Œç±»å‹ã€‚ security.oauth2.resource.user-info-uri ç”¨æˆ·ç«¯ç‚¹çš„ URI security.oauth2.sso.filter-order å¦‚æœä¸æä¾›æ˜¾å¼çš„WebSecurityConfigurerAdapterï¼Œåˆ™åº”ç”¨è¿‡æ»¤å™¨é¡ºåºï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥æ”¹ä¸ºæä¾›é¡ºåºï¼‰ã€‚ security.oauth2.sso.login-path /login ç™»å½•é¡µé¢çš„è·¯å¾„ï¼Œå³è§¦å‘é‡å®šå‘åˆ° OAuth2 æˆæƒæœåŠ¡å™¨çš„é¡µé¢ã€‚ security.require-ssl security è‡ªåŠ¨é…ç½®å·²ä¸å†å¯å®šåˆ¶ security.sessions security è‡ªåŠ¨é…ç½®å·²ä¸å†å¯å®šåˆ¶ security.user.name spring.security.user.name security.user.password spring.security.user.password security.user.role spring.security.user.roles server.context-parameters server.servlet.context-parameters server.context-path server.servlet.context-path server.display-name server.servlet. application-display-name server.jsp-servlet.class-name server.servlet.jsp.class-name server.jsp-servlet.init-parameters server.servlet.jsp.init-parameters server.jsp-servlet.registered server.servlet.jsp.registered server.servlet-path server.servlet.path server.session.cookie.comment server.servlet.session.cookie.comment server.session.cookie.domain server.servlet.session.cookie.domain server.session.cookie.http-only server.servlet. session.cookie.http-only server.session.cookie.max-age server.servlet.session.cookie.max-age server.session.cookie.name server.servlet.session.cookie.name server.session.cookie.path server.servlet.session.cookie.path server.session.cookie.secure server.servlet.session.cookie.secure server.session.persistent server.servlet.session.persistent server.session.store-dir server.servlet.session.store-dir server.session.timeout server.servlet.session.timeout server.session.tracking-modes server.servlet.session.tracking-modes spring.activemq.pool.configuration.block-if-session-pool-is-full spring.activemq.pool.configuration.block-if-session-pool-is-full-timeout spring.activemq.pool.configuration.connection-factory spring.activemq.pool.configuration.create-connection-on-startup spring.activemq.pool.configuration.expiry-timeout spring.activemq.pool.configuration.idle-timeout spring.activemq.pool.configuration.max-connections spring.activemq.pool.configuration.maximum-active-session-per-connection spring.activemq.pool.configuration.properties spring.activemq.pool.configuration.reconnect-on-exception spring.activemq.pool.configuration.time-between-expiration-check-millis spring.activemq.pool.configuration.use-anonymous-producers spring.application.index åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ ID é»˜è®¤æƒ…å†µä¸‹æ˜¯å”¯ä¸€çš„ spring.batch.initializer.enabled spring.batch.initialize-schema spring.cache.guava.spec ç”¨äºåˆ›å»ºç¼“å­˜çš„è§„èŒƒ spring.cache.hazelcast.config ç”¨äºåˆå§‹åŒ– Hazelcast çš„é…ç½®æ–‡ä»¶çš„ä½ç½® spring.data.cassandra.connect-timeout-millis spring.data. cassandra.connect-timeout spring.data.cassandra.read-timeout-millis spring.data.cassandra.read-timeout spring.data.cassandra.repositories.enabled spring.data.cassandra. repositories.type spring.data.couchbase.repositories.enabled spring.data.couchbase. repositories.type spring.data.mongodb.repositories.enabled spring.data.mongodb. repositories.type spring.data.neo4j.compiler ä» Neo4j 3 å¼€å§‹ä¸å†æ”¯æŒ spring.datasource.dbcp.access-to-underlying-connection-allowed spring.datasource.dbcp.connection-init-sqls spring.datasource.dbcp.default-auto-commit spring.datasource.dbcp.default-catalog spring.datasource.dbcp.default-read-only spring.datasource.dbcp.default-transaction-isolation spring.datasource.dbcp.driver-class-name spring.datasource.dbcp.initial-size spring.datasource.dbcp.log-abandoned spring.datasource.dbcp.login-timeout spring.datasource.dbcp.max-active spring.datasource.dbcp.max-idle spring.datasource.dbcp.max-open-prepared-statements spring.datasource.dbcp.max-wait spring.datasource.dbcp.min-evictable-idle-time-millis spring.datasource.dbcp.min-idle spring.datasource.dbcp.num-tests-per-eviction-run spring.datasource.dbcp.password spring.datasource.dbcp.pool-prepared-statements spring.datasource.dbcp.remove-abandoned spring.datasource.dbcp.remove-abandoned-timeout spring.datasource.dbcp.test-on-borrow spring.datasource.dbcp.test-on-return spring.datasource.dbcp.test-while-idle spring.datasource.dbcp.time-between-eviction-runs-millis spring.datasource.dbcp.url spring.datasource.dbcp.username spring.datasource.dbcp.validation-query spring.datasource.dbcp.validation-query-timeout spring.datasource.hikari.connection-customizer-class-name spring.datasource.initialize spring.datasource. initialization-mode spring.devtools.remote.debug.enabled è¿œç¨‹ debug å·²ä¸å†æ”¯æŒ spring.devtools.remote.debug.local-port è¿œç¨‹ debug å·²ä¸å†æ”¯æŒ spring.http.multipart.enabled spring.servlet.multipart.enabled spring.http.multipart.file-size-threshold spring.servlet.multipart.file-size-threshold spring.http.multipart.location spring.servlet.multipart.location spring.http.multipart.max-file-size spring.servlet.multipart.max-file-size spring.http.multipart.max-request-size spring.servlet. multipart.max-request-size spring.http.multipart.resolve-lazily spring.servlet.multipart.resolve-lazily spring.jpa.hibernate.naming.strategy Hibernate 4 çš„è‡ªåŠ¨é…ç½®å·²ä¸å†æä¾› spring.jta.atomikos.properties.console-log-level warn spring.messages.cache-seconds spring.messages.cache-duration spring.metrics.export.aggregate.key-pattern Metrics support ç°åœ¨ä½¿ç”¨åƒåˆ†å°º spring.metrics.export.aggregate.prefix Metrics support ç°åœ¨ä½¿ç”¨åƒåˆ†å°º spring.metrics.export.delay-millis Metrics support ç°åœ¨ä½¿ç”¨åƒåˆ†å°º spring.metrics.export.enabled Metrics support ç°åœ¨ä½¿ç”¨åƒåˆ†å°º spring.metrics.export.excludes Metrics support ç°åœ¨ä½¿ç”¨åƒåˆ†å°º spring.metrics.export.includes Metrics support ç°åœ¨ä½¿ç”¨åƒåˆ†å°º spring.metrics.export.redis.key Metrics support ç°åœ¨ä½¿ç”¨åƒåˆ†å°º spring.metrics.export.redis.prefix Metrics support ç°åœ¨ä½¿ç”¨åƒåˆ†å°º spring.metrics.export.send-latest Metrics support ç°åœ¨ä½¿ç”¨åƒåˆ†å°º spring.metrics.export.statsd.host management.metrics. export.statsd.host spring.metrics.export.statsd.port management.metrics. export.statsd.port spring.metrics.export.statsd.prefix Metrics support ç°åœ¨ä½¿ç”¨åƒåˆ†å°º spring.metrics.export.triggers Metrics support ç°åœ¨ä½¿ç”¨åƒåˆ†å°º spring.mobile.devicedelegatingviewresolver.enable-fallback false å¯ç”¨å¯¹å›é€€è§£å†³æ–¹æ¡ˆçš„æ”¯æŒ spring.mobile.devicedelegatingviewresolver.enabled false å¯ç”¨ device è§†å›¾è§£æå™¨ spring.mobile.devicedelegatingviewresolver.mobile-prefix mobile/ ç”¨äºæŸ¥çœ‹ç§»åŠ¨è®¾å¤‡åç§°çš„å‰ç¼€ spring.mobile.devicedelegatingviewresolver.mobile-suffix `` é™„åŠ åç¼€ä»¥æŸ¥çœ‹ç§»åŠ¨è®¾å¤‡çš„åç§° spring.mobile.devicedelegatingviewresolver.normal-prefix `` ç”¨äºæŸ¥çœ‹æ™®é€šè®¾å¤‡åç§°çš„å‰ç¼€. spring.mobile.devicedelegatingviewresolver.normal-suffix `` é™„åŠ åç¼€ä»¥æŸ¥çœ‹æ™®é€šè®¾å¤‡çš„åç§° spring.mobile.devicedelegatingviewresolver.tablet-prefix tablet/ å‰ç¼€é¢„è®¾ä¸ºæŸ¥çœ‹å¹³æ¿ç”µè„‘è®¾å¤‡çš„åç§° spring.mobile.devicedelegatingviewresolver.tablet-suffix `` é™„åŠ åç¼€ä»¥æŸ¥çœ‹å¹³æ¿ç”µè„‘è®¾å¤‡çš„åç§° spring.mobile.sitepreference.enabled true å¯ç”¨ SitePreferenceHandler. spring.mvc.media-types spring.mvc. contentnegotiation.media-types spring.rabbitmq.listener.acknowledge-mode spring.rabbitmq.listener.auto-startup spring.rabbitmq.listener.concurrency spring.rabbitmq.listener.default-requeue-rejected spring.rabbitmq.listener.idle-event-interval spring.rabbitmq.listener.max-concurrency spring.rabbitmq.listener.prefetch spring.rabbitmq.listener.retry.enabled false æ˜¯å¦å¯ç”¨å‘å¸ƒé‡è¯• spring.rabbitmq.listener.retry.initial-interval 1000 ç¬¬ä¸€æ¬¡å’Œç¬¬äºŒæ¬¡å°è¯•å‘å¸ƒæˆ–ä¼ é€’è®¯æ¯çš„æ—¶é—´é—´éš” spring.rabbitmq.listener.retry.max-attempts 3 å°è¯•å‘å¸ƒæˆ–ä¼ é€’é‚®ä»¶çš„æœ€å¤§æ¬¡æ•° spring.rabbitmq.listener.retry.max-interval 10000 å°è¯•ä¹‹é—´çš„æœ€å¤§é—´éš” spring.rabbitmq.listener.retry.multiplier 1 äºå…ˆå‰é‡è¯•é—´éš”çš„å€æ•° spring.rabbitmq.listener.retry.stateless true æ— è®ºé‡è¯•æ˜¯æ— çŠ¶æ€è¿˜æ˜¯æœ‰çŠ¶æ€ spring.rabbitmq.listener.transaction-size spring.redis.pool.max-active spring.redis.jedis.pool.max-idle spring.redis.pool.max-idle spring.redis.jedis.pool.max-idle spring.redis.pool.max-wait spring.redis.jedis.pool.max-wait spring.redis.pool.min-idle spring.redis.jedis.pool.min-idle spring.resources.cache-period spring.resources.cache.period spring.sendgrid.password ä¸å†æ”¯æŒä½¿ç”¨ç”¨æˆ·åå’Œå¯†ç  ( ä½¿ç”¨ spring.sendgrid.api-key ä»£æ›¿ ) spring.sendgrid.username ä¸å†æ”¯æŒä½¿ç”¨ç”¨æˆ·åå’Œå¯†ç  ( ä½¿ç”¨ spring.sendgrid.api-key ä»£æ›¿ ) spring.session.jdbc.initializer.enabled spring.session. jdbc.initialize-schema spring.session.mongo.collection-name spring.session.mongodb.collection-name spring.social.auto-connection-views false ä¸ºæ”¯æŒçš„ç”Ÿäº§è€…å¯ç”¨è¿æ¥çŠ¶æ€è§†å›¾ spring.social.facebook.app-id Application id. spring.social.facebook.app-secret Application secret. spring.social.linkedin.app-id Application id. spring.social.linkedin.app-secret Application secret. spring.social.twitter.app-id Application id. spring.social.twitter.app-secret Application secret. spring.thymeleaf.content-type spring.thymeleaf. servlet.content-type ç›¸å…³æ–‡ç« ç›¸å…³æ–‡ç« 1ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (ä¸€)ï¼šSpring Boot 2.0 è¿ç§»æŒ‡å— 2ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (äºŒ)ï¼šSpring Boot 2.0 æ–°ç‰¹æ€§è¯¦è§£ 3ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (ä¸‰)ï¼šSpring Boot 2.0 é…ç½®æ”¹å˜ 4ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (å››)ï¼šSpring Boot 2.0 æºç é˜…è¯»ç¯å¢ƒæ­å»º 5ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (äº”)ï¼šSpring Boot 2.0 é¡¹ç›®æºç ç»“æ„é¢„è§ˆ 6ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (å…­)ï¼šSpring boot 2.0 ä¸­ SpringBootApplication æ³¨è§£è¯¦è§£ æœ€åè‹±æ–‡å‚è€ƒï¼šhttps://github.com/spring-projects/spring-boot/wiki/Spring-Boot-2.0-Configuration-Changelog","tags":[{"name":"Java","slug":"Java","permalink":"http://www.54tianzhisheng.cn/tags/Java/"},{"name":"SpringBoot","slug":"SpringBoot","permalink":"http://www.54tianzhisheng.cn/tags/SpringBoot/"}]},{"title":"å†™è¿™ä¹ˆå¤šç³»åˆ—åšå®¢ï¼Œæ€ªä¸å¾—æ‰¾ä¸åˆ°å¥³æœ‹å‹","date":"2018-03-26T16:00:00.000Z","path":"2018/03/27/blogs/","text":"å‰æå¥½å‡ å‘¨æ²¡æ›´æ–°åšå®¢äº†ï¼Œå¯¹ä¸æ–­æ”¯æŒæˆ‘åšå®¢çš„ç«¥é‹ä»¬è¯´å£°ï¼šâ€œæŠ±æ­‰äº†ï¼â€ã€‚è‡ªå·±è¿™æ®µæ—¶é—´ç¡®å®æ¯”è¾ƒå¿™ï¼Œè€Œä¸”è¿˜åœ¨æŠ½ç©ºå®Œæˆå­¦æ ¡çš„æ¯•ä¸šè®¾è®¡ã€‚ä»Šå¤©æ™šä¸ŠæŠ½ç©ºæŠŠå¤§å­¦æœŸé—´å†™è¿‡çš„åšå®¢å¼„ä¸€ä¸ªç³»åˆ—æ–‡ç« åˆé›†ï¼Œç®—æ˜¯å¯¹å¤§å­¦è¿™å››å¹´çš„ä¸€ä¸ªæ€»ç»“ï¼Œè¯æ˜è‡ªå·±æ²¡ç™½è¿‡ã€‚ ç†Ÿæ‚‰æˆ‘çš„äººéƒ½çŸ¥é“æˆ‘å†™åšå®¢çš„æ—¶é—´æ¯”è¾ƒæ—©ï¼Œè€Œä¸”åšæŒçš„æ—¶é—´ä¹Ÿæ¯”è¾ƒä¹…ï¼Œä¸€ç›´åˆ°ç°åœ¨ä¹Ÿæ˜¯ä¸€ç›´ä¿æŒç€æ›´æ–°çŠ¶æ€ã€‚æœ€æ—©æœ€æ—©å¼€å§‹å†™åšå®¢æ˜¯åœ¨ CSDN ä¸Šå†™çš„ï¼Œç„¶ååœ¨ç®€ä¹¦ä¹Ÿå†™è¿‡ä¸€æ®µæ—¶é—´ï¼Œåæ¥æ”¾å¼ƒäº†ç®€ä¹¦è½¬æˆ˜äº†æ˜é‡‘ï¼Œä»¥ä¸‹å›¾ç‰‡æ˜¯è‡ªå·±åœ¨æ˜é‡‘è¿™ä¸€å¹´çš„æˆæœï¼Œå¿« 1.5 ä¸‡å…³æ³¨äº†ï¼Œå“ˆå“ˆå“ˆã€‚ å»å¹´è¿‡å¹´å‰è¿˜æ”¶åˆ°æ˜é‡‘é€æ¥çš„ä¸“å±ç¤¼ç‰©ï¼ŒçœŸæ˜¯æ¿€åŠ¨ï¼Œæ„Ÿè°¢æ˜é‡‘ï¼Œå¸Œæœ›è¶ŠåŠè¶Šå¥½ï¼ ç»†æ•°æ–‡ç« åï¼Œå‘ç°è‡ªå·±åœ¨å®ä¹ çš„è¿™æ®µæ—¶é—´å†™çš„åšå®¢ä¹ŸæŒºå¤šçš„ï¼Œè€Œä¸”è´¨é‡è¿˜æ¯”è¾ƒé«˜ï¼Œç»å¸¸ä¸Šå¼€å‘è€…å¤´æ¡ã€æ˜é‡‘ç­‰å¹³å°çš„é¦–é¡µæ¨èã€‚åœ¨æ­¤ï¼Œæ„Ÿè°¢å®ä¹ æœŸé—´ç»„å†…å¤§ä½¬ä»¬çš„å„ç§å¸®åŠ©ï¼ è¿™é‡Œå†æ¬¡è¯´ä¸‹å†™åšå®¢çš„å¥½å¤„ï¼š å¾ˆå¥½çš„ç”¨æ¥æ€»ç»“è‡ªå·±æ‰€å­¦çš„çŸ¥è¯† é‡åˆ°é‚£ä¹ˆä¸€ç¾¤ä¹Ÿå†™åšå®¢çš„å¤§ä½¬ï¼Œæœ‰å…±åŒè¯é¢˜èŠäº† é¢è¯•åŠ åˆ†ï¼ˆåœ¨ç®€å†ä¸Šæ”¾ä¸Šè‡ªå·±çš„ä¸ªäººç½‘ç«™é“¾æ¥ï¼Œé¢è¯•å®˜å°±å¯ä»¥æ›´å¥½çš„äº†è§£ä½ ï¼ŒçŸ¥é“ä½ æ‰€å­¦çŸ¥è¯†çš„æ·±åº¦å’Œå¹¿åº¦ï¼‰ ä¸è¦å°çœ‹ä½ çš„æ¯ä¸€ç¯‡ä¸èµ·çœ¼åšå®¢ï¼Œç”¨ä¸€ä¸ªèš‚èšé‡‘æœå¤§ä½¬è·Ÿæˆ‘è¯´çš„è¯å«åšï¼šåšç§¯è–„å‘ï¼ ä¸å¤šè¯´äº†ï¼Œå¦‚æœæƒ³å’Œæˆ‘äº¤æµçš„å¯ä»¥åŠ æˆ‘ qq ç¾¤ï¼š528776268 å’Œæˆ‘çš„å¾®ä¿¡ï¼šzhisheng_tian å…³æ³¨æˆ‘ è½¬è½½è¯·åŠ¡å¿…æ³¨æ˜åŸåˆ›åœ°å€ä¸ºï¼šhttp://www.54tianzhisheng.cn/2018/03/27/blogs/ ç³»åˆ—æ–‡ç« åˆé›†Spring Boot ç³»åˆ—æ–‡ç« 1ã€Spring Bootç³»åˆ—æ–‡ç« ï¼ˆä¸€ï¼‰ï¼šSpringBoot Kafka æ•´åˆä½¿ç”¨ 2ã€Spring Bootç³»åˆ—æ–‡ç« ï¼ˆäºŒï¼‰ï¼šSpringBoot Admin ä½¿ç”¨æŒ‡å— 3ã€Spring Bootç³»åˆ—æ–‡ç« ï¼ˆä¸‰ï¼‰ï¼šSpringBoot RabbitMQ æ•´åˆä½¿ç”¨ 4ã€Spring Bootç³»åˆ—æ–‡ç« ï¼ˆå››ï¼‰ï¼šSpringBoot ActiveMQ æ•´åˆä½¿ç”¨ 5ã€Spring Bootç³»åˆ—æ–‡ç« ï¼ˆäº”ï¼‰ï¼šSpringBoot RabbitMQ æ•´åˆè¿›é˜¶ç‰ˆ 6ã€Spring Bootç³»åˆ—æ–‡ç« ï¼ˆå…­ï¼‰ï¼šSpringBoot RocketMQ æ•´åˆä½¿ç”¨å’Œç›‘æ§ 7ã€æ›´å¤šè¯·æœŸå¾… Spring Boot 2.0 ç³»åˆ—æ–‡ç« 1ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (ä¸€)ï¼šSpring Boot 2.0 è¿ç§»æŒ‡å— 2ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (äºŒ)ï¼šSpring Boot 2.0 æ–°ç‰¹æ€§è¯¦è§£ 3ã€åé¢ç»å¯¹æœ‰æ›´å¤šæ–‡ç« å‡ºç°çš„ Docker ç³»åˆ—æ–‡ç« 1ã€Dockerç³»åˆ—æ–‡ç« ï¼ˆä¸€ï¼‰ï¼šåŸºäº Harbor æ­å»º Docker ç§æœ‰é•œåƒä»“åº“ 2ã€Dockerç³»åˆ—æ–‡ç« ï¼ˆäºŒï¼‰ï¼šMac å®‰è£… Docker åŠå¸¸ç”¨å‘½ä»¤ 3ã€åŒæ ·ï¼Œåé¢ä¹Ÿä¼šæŒç»­æ›´æ–° ElasticSearch ç³»åˆ—æ–‡ç« 1ã€Elasticsearch ç³»åˆ—æ–‡ç« ï¼ˆä¸€ï¼‰ï¼šElasticsearch é»˜è®¤åˆ†è¯å™¨å’Œä¸­åˆ†åˆ†è¯å™¨ä¹‹é—´çš„æ¯”è¾ƒåŠä½¿ç”¨æ–¹æ³• 2ã€ Elasticsearch ç³»åˆ—æ–‡ç« ï¼ˆäºŒï¼‰ï¼šå…¨æ–‡æœç´¢å¼•æ“ Elasticsearch é›†ç¾¤æ­å»ºå…¥é—¨æ•™ç¨‹ 3ã€Elasticsearch ç³»åˆ—æ–‡ç« ï¼ˆä¸‰ï¼‰ï¼šElasticSearch é›†ç¾¤ç›‘æ§ 4ã€Elasticsearch ç³»åˆ—æ–‡ç« ï¼ˆå››ï¼‰ï¼šElasticSearch å•ä¸ªèŠ‚ç‚¹ç›‘æ§ 5ã€Elasticsearch ç³»åˆ—æ–‡ç« ï¼ˆäº”ï¼‰ï¼šELK å®æ—¶æ—¥å¿—åˆ†æå¹³å°ç¯å¢ƒæ­å»º 6ã€ä¹Ÿæœ‰æ›´å¤šæ·±å…¥çš„æ–‡ç«  æ­å»ºåšå®¢ç³»åˆ—æ–‡ç« 1ã€åˆ©ç”¨Github Page æ­å»ºä¸ªäººåšå®¢ç½‘ç«™ 2ã€Github pages + Hexo åšå®¢ yilia ä¸»é¢˜ä½¿ç”¨ç•…è¨€è¯„è®ºç³»ç»Ÿ 3ã€Hexo + yilia æ­å»ºåšå®¢å¯èƒ½ä¼šé‡åˆ°çš„æ‰€æœ‰ç–‘é—® 4ã€Hexo + yilia ä¸»é¢˜å®ç°æ–‡ç« ç›®å½• 5ã€è¿™ä¸ªç³»åˆ—çœ‹æƒ…å†µï¼Œå¯èƒ½è¿˜ä¼šæœ‰ Java ç³»åˆ—æ–‡ç« 1ã€å…³äºString s = new String(â€œxyzâ€); åˆ›å»ºå‡ ä¸ªå¯¹è±¡çš„é—®é¢˜ 2ã€ã€ŠJava å¤šçº¿ç¨‹ç¼–ç¨‹æ ¸å¿ƒæŠ€æœ¯ã€‹å­¦ä¹ ç¬”è®°åŠæ€»ç»“ 3ã€ä»å¯¹è±¡æ·±å…¥åˆ†æ Java ä¸­å®ä¾‹å˜é‡å’Œç±»å˜é‡çš„åŒºåˆ« 4ã€æ·±åº¦æ¢ç©¶Java ä¸­ finally è¯­å¥å— 5ã€è§£å†³jdk1.8ä¸­å‘é€é‚®ä»¶å¤±è´¥ï¼ˆhandshake_failureï¼‰é—®é¢˜ 6ã€æ·±å…¥åˆ†æ Java Web ä¸­çš„ä¸­æ–‡ç¼–ç é—®é¢˜ 7ã€å¥‡æ€ªçš„Javaé¢˜ï¼šä¸ºä»€ä¹ˆ128 == 128è¿”å›ä¸ºFalseï¼Œè€Œ127 == 127ä¼šè¿”å›ä¸ºTrue? 8ã€Javaè¯»å–æ–‡ä»¶ 9ã€HashMapã€Hashtableã€HashSet å’Œ ConcurrentHashMap çš„æ¯”è¾ƒ 10ã€Javaè¿æ¥Oracleæ•°æ®åº“çš„ä¸‰ç§è¿æ¥æ–¹å¼ 11ã€Java NIO ç³»åˆ—æ•™ç¨‹ 12ã€ã€Šç–¯ç‹‚ Java çªç ´ç¨‹åºå‘˜åŸºæœ¬åŠŸçš„ 16 è¯¾ã€‹è¯»ä¹¦ç¬”è®° 13ã€è¯¦ç»†æ·±å…¥åˆ†æ Java ClassLoader å·¥ä½œæœºåˆ¶ 14ã€è¯¦è§£ Filter è¿‡æ»¤å™¨ 15ã€Java IOæµå­¦ä¹ è¶…è¯¦ç»†æ€»ç»“ï¼ˆå›¾æ–‡å¹¶èŒ‚ï¼‰ 16ã€é€šè¿‡æºç è¯¦è§£ Servlet 17ã€Java æ€§èƒ½è°ƒä¼˜éœ€è¦æ ¼å¤–æ³¨æ„çš„ç»†èŠ‚ 18ã€Java çº¿ç¨‹æ± è‰ºæœ¯æ¢ç´¢ 19ã€JVMæ€§èƒ½è°ƒä¼˜ç›‘æ§å·¥å…·jpsã€jstackã€jmapã€jhatã€jstatç­‰ä½¿ç”¨è¯¦è§£ 20ã€è¿™ä¸ªå¿…é¡»çš„æŒç»­æ›´æ–°ä¸‹å» Maven ç³»åˆ—æ–‡ç« 1ã€Centos7 æ­å»ºæœ€æ–° Nexus3 Maven ç§æœ 2ã€Maven ä¸­ dependencies ä¸ dependencyManagement çš„åŒºåˆ« Kafka ç³»åˆ—æ–‡ç« 1ã€Kafka å®‰è£…åŠå¿«é€Ÿå…¥é—¨ 2ã€Spring Bootç³»åˆ—æ–‡ç« ï¼ˆä¸€ï¼‰ï¼šSpringBoot Kafka æ•´åˆä½¿ç”¨ Mybatis ç³»åˆ—æ–‡ç« 1ã€é€šè¿‡é¡¹ç›®é€æ­¥æ·±å…¥äº†è§£Mybatis&lt;ä¸€&gt; 2ã€é€šè¿‡é¡¹ç›®é€æ­¥æ·±å…¥äº†è§£Mybatis&lt;äºŒ&gt; 3ã€é€šè¿‡é¡¹ç›®é€æ­¥æ·±å…¥äº†è§£Mybatis&lt;ä¸‰&gt; 4ã€é€šè¿‡é¡¹ç›®é€æ­¥æ·±å…¥äº†è§£Mybatisï¼ˆå››)/) 5ã€MyBatisçš„foreachè¯­å¥è¯¦è§£ 6ã€æœŸå¾…å®ƒçš„æºç è§£ææ–‡ç« å—ï¼Ÿ Nginx ç³»åˆ—æ–‡ç« 1ã€Ubuntu16.10 å®‰è£… Nginx 2ã€Nginx åŸºæœ¬çŸ¥è¯†å¿«é€Ÿå…¥é—¨ Python çˆ¬è™«ç³»åˆ—æ–‡ç« 1ã€Pythonçˆ¬è™«å®æˆ˜ä¹‹çˆ¬å–ç™¾åº¦è´´å§å¸–å­ 2ã€Pyspideræ¡†æ¶ â€”â€” Pythonçˆ¬è™«å®æˆ˜ä¹‹çˆ¬å– V2EX ç½‘ç«™å¸–å­ 3ã€Pythonçˆ¬è™«å®æˆ˜ä¹‹çˆ¬å–ç³—äº‹ç™¾ç§‘æ®µå­ 4ã€è¿™ä¸ªä¼°è®¡å¾—ç­‰æœ‰æœºä¼šå†æ¬¡å­¦ Python æ—¶å†å†™ RocketMQ ç³»åˆ—æ–‡ç« 1ã€RocketMQç³»åˆ—æ–‡ç« ï¼ˆä¸€ï¼‰ï¼šRocketMQ åˆæ¢ 2ã€RocketMQç³»åˆ—æ–‡ç« ï¼ˆäºŒï¼‰ï¼šRocketMQ å®‰è£…åŠå¿«é€Ÿå…¥é—¨ 3ã€RocketMQç³»åˆ—æ–‡ç« ï¼ˆä¸‰ï¼‰ï¼šRocketMQ ç®€å•çš„æ¶ˆæ¯ç¤ºä¾‹ 4ã€Spring Bootç³»åˆ—æ–‡ç« ï¼ˆå…­ï¼‰ï¼šSpringBoot RocketMQ æ•´åˆä½¿ç”¨å’Œç›‘æ§ Spring MVC ç³»åˆ—æ–‡ç« 1ã€Spring MVCç³»åˆ—æ–‡ç« ï¼ˆä¸€ï¼‰ï¼šSpring MVC + Hibernate JPA + Bootstrap æ­å»ºçš„åšå®¢ç³»ç»Ÿ Demo 2ã€Spring MVCç³»åˆ—æ–‡ç« ï¼ˆäºŒï¼‰ï¼šSpring MVC+Hibernate JPAæ­å»ºçš„åšå®¢ç³»ç»Ÿé¡¹ç›®ä¸­æ‰€é‡åˆ°çš„å‘ 3ã€Spring MVCç³»åˆ—æ–‡ç« ï¼ˆä¸‰ï¼‰ï¼šçœ‹é€ Spring MVC æºä»£ç åˆ†æä¸å®è·µ â€”â€” ç½‘ç«™åŸºç¡€çŸ¥è¯† 4ã€Spring MVCç³»åˆ—æ–‡ç« ï¼ˆå››ï¼‰ï¼šçœ‹é€ Spring MVC æºä»£ç åˆ†æä¸å®è·µ â€”â€” ä¿¯è§† Spring MVC 5ã€Spring MVCç³»åˆ—æ–‡ç« ï¼ˆäº”ï¼‰ï¼šçœ‹é€ Spring MVC æºä»£ç åˆ†æä¸å®è·µ â€”â€” Spring MVC ç»„ä»¶åˆ†æ 6ã€é€šè¿‡é¡¹ç›®é€æ­¥æ·±å…¥äº†è§£Spring MVCï¼ˆä¸€ï¼‰ Netty ç³»åˆ—æ–‡ç« 1ã€Nettyç³»åˆ—æ–‡ç« ï¼ˆä¸€ï¼‰ï¼šNetty æºç é˜…è¯»ä¹‹åˆå§‹ç¯å¢ƒæ­å»º 2ã€è¿™ä¸ªç³»åˆ—è¿Ÿæ—©ä¼šæ›´æ–°çš„ã€‚ å‰ç«¯ç³»åˆ—æ–‡ç« 1ã€Bootstrapå…¥é—¨éœ€æŒæ¡çš„çŸ¥è¯†ç‚¹ï¼ˆä¸€ï¼‰ 2ã€Bootstrapå…¥é—¨éœ€æŒæ¡çš„çŸ¥è¯†ç‚¹ï¼ˆäºŒï¼‰ 3ã€ä½¿ç”¨ CodeMirror æ‰“é€ å±äºè‡ªå·±çš„åœ¨çº¿ä»£ç ç¼–è¾‘å™¨ 4ã€AJAX å­¦ä¹  5ã€å‰ç«¯æ¸£æ¸£è¿™ä¸ªä¹Ÿè¦æ…¢æ…¢å­¦ä¹ è¿™å— é¢è¯•ç»éªŒç³»åˆ—1ã€ç§‹æ‹›ç¬¬ä¸€ç«™ â€”â€” äºšä¿¡ç§‘æŠ€ 2ã€ç§‹æ‹›ç¬¬äºŒç«™ â€”â€” å†…æ¨çˆ±å¥‡è‰ºï¼ˆä¸€é¢äºŒé¢ï¼‰ 3ã€ç§‹æ‹›ç¬¬ä¸‰ç«™ â€”â€” å†…æ¨é˜¿é‡Œï¼ˆä¸€é¢ï¼‰ 4ã€ é¢è¯•è¿‡é˜¿é‡Œç­‰äº’è”ç½‘å¤§å…¬å¸ï¼Œæˆ‘çŸ¥é“äº†è¿™äº›å¥—è·¯ 5ã€é‚£äº›å¹´æˆ‘çœ‹è¿‡çš„ä¹¦ â€”â€” è‡´æ•¬æˆ‘çš„å¤§å­¦ç”Ÿæ´» â€”â€” Say Good Bye ï¼ å…¶ä»–è¿˜æœ‰ä¸€äº›å…¶ä»–æ–¹é¢çš„æŠ€æœ¯æ–‡ç« ï¼Œç®—ä¸æ˜¯ç³»åˆ—æ–‡ç« ï¼Œæ¯”è¾ƒé›¶æ•£ï¼Œè¿˜æœ‰å°±æ˜¯ä¸€äº›éšç¬”æ–‡ç« ï¼Œå°±ä¸æŠŠå®ƒä»¬æ”¾åœ¨åˆé›†é‡Œäº†ã€‚ æ€»ç»“ç”¨è‡ªå·±çš„ä¸€å¥è¯ï¼šå‘è¦ä¸€ä¸ªä¸ªå¡«ï¼Œè·¯è¦ä¸€æ­¥æ­¥èµ°ï¼å‰äººæ ½æ ‘ï¼Œåäººä¹˜å‡‰ï¼Œå­¦ä¼šæ„Ÿæ©ï¼ å»ºäº†ä¸ªä¸é”™çš„å¾®ä¿¡ç¾¤ï¼Œå¦‚æœæœ‰æ„Ÿå…´è¶£çš„å¯ä»¥åŠ æˆ‘å¾®ä¿¡ï¼Œå¯¹æˆ‘å›å¤ åŠ ç¾¤ ï¼Œç„¶åä¼šæ‹‰ä½ è¿›ç¾¤äº¤æµã€‚","tags":[{"name":"åšå®¢åˆé›†","slug":"åšå®¢åˆé›†","permalink":"http://www.54tianzhisheng.cn/tags/åšå®¢åˆé›†/"}]},{"title":"Spring Boot 2.0ç³»åˆ—æ–‡ç« (äºŒ)ï¼šSpring Boot 2.0 æ–°ç‰¹æ€§è¯¦è§£","date":"2018-03-05T16:00:00.000Z","path":"2018/03/06/SpringBoot2-new-features/","text":"èƒŒæ™¯åœ¨ 3 æœˆ 1 å·ï¼ŒSpring Boot2.0.0.RELEASEæ­£å¼å‘å¸ƒï¼Œè¿™æ˜¯ Spring Boot1.0 å‘å¸ƒ 4 å¹´ä¹‹åç¬¬ä¸€æ¬¡é‡å¤§ä¿®è®¢ï¼Œå› æ­¤æœ‰å¤šçš„æ–°åŠŸèƒ½å’Œç‰¹æ€§å€¼å¾—å¤§å®¶æœŸå¾…ï¼ä¸‹é¢å¸¦å¤§å®¶äº†è§£ä¸‹ Spring Boot 2.0 ä¸­çš„æ–°ç‰¹æ€§ã€‚ SpringBoot ç³»åˆ—æ–‡ç«  å…³æ³¨æˆ‘ è½¬è½½è¯·åŠ¡å¿…æ³¨æ˜åŸåˆ›åœ°å€ä¸ºï¼šhttp://www.54tianzhisheng.cn/2018/03/06/SpringBoot2-new-features/ ä» Spring Boot 1.5 å‡çº§ç”±äº Spring Boot 2.0 çš„æ”¹å˜å¹…åº¦æœ‰ç‚¹å¤§ï¼Œæ‰€ä»¥å‡çº§ç°æœ‰çš„ç¨‹åºå¯èƒ½ä¼šæ¯”å¹³å¸¸æ›´å¤§ä¸€äº›ã€‚ å¦‚æœä½ è¿˜åœ¨è€ƒè™‘æ˜¯å¦è¦å‡çº§ï¼Œè¿™é‡Œæ¨è DD çš„åšå®¢æ–‡ç« ï¼šSpring Boot 2.0 æ­£å¼å‘å¸ƒï¼Œå‡è¿˜æ˜¯ä¸å‡å‘¢ï¼Ÿ å¦‚æœè¦å‡çº§å¯ä»¥å‚è€ƒæˆ‘çš„å¦å¤–ä¸€ç¯‡æ–‡ç« ï¼šSpring Boot 2.0 è¿ç§»æŒ‡å— å¦‚æœæ‚¨ç›®å‰æ­£åœ¨è¿è¡Œè¾ƒæ—©ç‰ˆæœ¬çš„ Spring Bootï¼Œæˆ‘ä»¬å¼ºçƒˆå»ºè®®æ‚¨åœ¨è¿ç§»åˆ° Spring Boot 2.0 ä¹‹å‰å…ˆå‡çº§åˆ° Spring Boot 1.5ã€‚ æ–°çš„å’Œå€¼å¾—æ³¨æ„çš„ç‰¹æ€§å°æŠ€å·§ï¼šæ£€æŸ¥ é…ç½®æ›´æ”¹æ—¥å¿— æ¥è·å–é…ç½®æ›´æ”¹çš„å®Œæ•´æè¿°ã€‚ èµ·ç  JDK 8 å’Œæ”¯æŒ JDK 9Spring Boot 2.0 è¦æ±‚ Java 8 ä½œä¸ºæœ€ä½ç‰ˆæœ¬ã€‚è®¸å¤šç°æœ‰çš„ API å·²æ›´æ–°ï¼Œä»¥åˆ©ç”¨ Java 8 çš„ç‰¹æ€§ï¼Œä¾‹å¦‚ï¼šæ¥å£ä¸Šçš„é»˜è®¤æ–¹æ³•ï¼Œå‡½æ•°å›è°ƒä»¥åŠæ–°çš„ APIï¼Œå¦‚javax.timeã€‚å¦‚æœæ‚¨å½“å‰æ­£åœ¨ä½¿ç”¨ Java 7 æˆ–æ›´æ—©ç‰ˆæœ¬ï¼Œåˆ™åœ¨å¼€å‘ Spring Boot 2.0 åº”ç”¨ç¨‹åºä¹‹å‰ï¼Œæ‚¨éœ€è¦å‡çº§æ‚¨çš„ JDKã€‚ Spring Boot 2.0 é€šè¿‡äº†åœ¨ JDK 9 ä¸‹çš„æµ‹è¯•ï¼Œå¯ä»¥åœ¨ JDK 9 ä¸‹æ­£å¸¸è¿è¡Œï¼Œã€‚æˆ‘ä»¬æ‰€æœ‰çš„ jar åŒ…éƒ½åœ¨æ¨¡å—ç³»ç»Ÿå…¼å®¹æ€§çš„æ¸…å•ä¸­é™„å¸¦äº†è‡ªåŠ¨æ¨¡å—åç§°æ¡ç›®ã€‚ ç¬¬ä¸‰æ–¹åº“çš„å‡çº§Spring Boot 2.0 å»ºç«‹åœ¨ Spring Framework 5 ä¹‹ä¸Šï¼Œå¹¶ä¸”éœ€è¦ Spring Framework 5 ã€‚ä½ å¯ä»¥é€šè¿‡ Whatâ€™s New in Spring Framework 5.x äº†è§£ Spring 5 çš„æ–°ç‰¹æ€§ã€‚å¹¶åœ¨ç»§ç»­ä¹‹å‰æŸ¥çœ‹å…¶å‡çº§æŒ‡å— Upgrading to Spring Framework 5.x ã€‚ æˆ‘ä»¬å·²å°½å¯èƒ½å‡çº§åˆ°å…¶ä»–ç¬¬ä¸‰æ–¹åº“çš„æœ€æ–°ç¨³å®šç‰ˆæœ¬ã€‚ æœ¬ç‰ˆæœ¬ä¸­ä¸€äº›æ˜¾ç€çš„ä¾èµ–æ€§å‡çº§åŒ…æ‹¬ï¼š Tomcat 8.5 Flyway 5 Hibernate 5.2 Thymeleaf 3 Reactive SpringSpring äº§å“ç»„åˆä¸­çš„è®¸å¤šé¡¹ç›®ç°åœ¨éƒ½ä¸ºå¼€å‘ååº”å¼åº”ç”¨ç¨‹åºæä¾›ä¸€æµçš„æ”¯æŒã€‚ååº”æ€§åº”ç”¨ç¨‹åºæ˜¯å®Œå…¨å¼‚æ­¥å’Œéé˜»å¡çš„ã€‚å®ƒä»¬æ—¨åœ¨ç”¨äºäº‹ä»¶å¾ªç¯æ‰§è¡Œæ¨¡å‹ï¼ˆè€Œä¸æ˜¯æ›´ä¼ ç»Ÿçš„æ¯ä¸ªè¯·æ±‚çº¿ç¨‹æ‰§è¡Œæ¨¡å‹ï¼‰ã€‚Spring æ¡†æ¶å‚è€ƒæ–‡æ¡£ä¸­çš„â€œWeb ååº”å †æ ˆâ€éƒ¨åˆ†ä¸ºè¿™ä¸ªä¸»é¢˜æä¾›äº†ä¸€ä¸ªå¾ˆå¥½çš„å…¥é—¨ã€‚ Spring Boot 2.0 é€šè¿‡è‡ªåŠ¨é…ç½®å’Œå¯åŠ¨å™¨ POM å®Œå…¨æ”¯æŒååº”å¼åº”ç”¨ã€‚Spring Boot çš„å†…éƒ¨æœ¬èº«ä¹Ÿåœ¨å¿…è¦æ—¶è¿›è¡Œäº†æ›´æ–°ï¼Œä»¥æä¾›ååº”æ€§çš„ååº”ï¼ˆæœ€æ˜æ˜¾çš„æ˜¯æˆ‘ä»¬çš„åµŒå…¥å¼æœåŠ¡å™¨æ”¯æŒï¼‰ã€‚ Spring WebFluxï¼†WebFlux.fnSpring WebFlux æ˜¯ Spring MVC çš„å®Œå…¨éé˜»å¡ååº”å¼æ›¿ä»£æ–¹æ¡ˆã€‚Spring Boot ä¸ºåŸºäºæ³¨é‡Šçš„ Spring WebFlux åº”ç”¨ç¨‹åºä»¥åŠ WebFlux.fn æä¾›äº†è‡ªåŠ¨é…ç½®ï¼ŒWebFlux.fn æä¾›äº†æ›´å®ç”¨çš„æ ·å¼ APIã€‚ è¦å¼€å§‹ï¼Œè¯·æ·»åŠ  spring-boot-starter-webflux åˆ° POMï¼Œå®ƒå°†æä¾›ç”±åµŒå…¥å¼ Netty æœåŠ¡å™¨æ”¯æŒçš„ Spring WebFluxã€‚ Reactive Spring Dataåœ¨åº•å±‚æŠ€æœ¯æ”¯æŒçš„æƒ…å†µä¸‹ï¼ŒSpring Data è¿˜ä¸ºååº”å¼åº”ç”¨ç¨‹åºæä¾›æ”¯æŒã€‚ç›®å‰ Cassandraï¼ŒMongoDBï¼ŒCouchbase å’Œ Redis éƒ½æœ‰ååº”å¼ API æ”¯æŒã€‚ Spring Boot åŒ…å«é’ˆå¯¹è¿™äº›æŠ€æœ¯çš„ç‰¹æ®Š starter-POMsï¼Œå¯ä¸ºæ‚¨æä¾›å¯åŠ¨æ‰€éœ€çš„ä¸€åˆ‡ã€‚ä¾‹å¦‚ï¼Œspring-boot-starter-data-mongodb-reactiveåŒ…æ‹¬å¯¹ååº”æ€§ mongo é©±åŠ¨ç¨‹åºå’Œé¡¹ç›®ååº”å †çš„ä¾èµ–æ€§ã€‚ Reactive Spring SecuritySpring Boot 2.0 å¯ä»¥å……åˆ†åˆ©ç”¨ Spring Security 5.0 æ¥ä¿æŠ¤æ‚¨çš„ååº”å¼åº”ç”¨ç¨‹åºã€‚å½“ Spring Security ä½äºç±»è·¯å¾„ä¸­æ—¶ï¼Œä¼šä¸º WebFlux åº”ç”¨ç¨‹åºæä¾›è‡ªåŠ¨é…ç½®ã€‚ ä½¿ç”¨ WebFlux çš„ Spring Security è®¿é—®è§„åˆ™å¯ä»¥é€šè¿‡SecurityWebFilterChainã€‚å¦‚æœä½ ä¹‹å‰æ•´åˆè¿‡ Spring MVC å’Œ Spring Securityï¼Œåº”è¯¥ä¼šæ„Ÿåˆ°éå¸¸ç†Ÿæ‚‰ã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… Spring Boot å‚è€ƒæ–‡æ¡£å’Œ Spring Security æ–‡æ¡£ã€‚ åµŒå…¥å¼ Netty æœåŠ¡å™¨ç”±äº WebFlux ä¸ä¾èµ–äº Servlet APIï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥é¦–æ¬¡ä¸º Netty ä½œä¸ºåµŒå…¥å¼æœåŠ¡å™¨æä¾›æ”¯æŒã€‚è¯¥spring-boot-starter-webflux å¯åŠ¨ POM å°†æ‹‰å– Netty 4.1 å’Œ Ractor Netty ã€‚ æ³¨æ„ï¼šæ‚¨åªèƒ½å°† Netty ç”¨ä½œååº”å¼æœåŠ¡å™¨ã€‚ä¸æä¾›é˜»æ­¢ servlet API æ”¯æŒã€‚ HTTP/2 æ”¯æŒä¸º Tomcatï¼ŒUndertow å’Œ Jetty æä¾› HTTP / 2 æ”¯æŒã€‚æ”¯æŒå–å†³äºæ‰€é€‰çš„ Web æœåŠ¡å™¨å’Œåº”ç”¨ç¨‹åºç¯å¢ƒï¼ˆå› ä¸º JDK 8 ä¸æ”¯æŒè¯¥åè®®ï¼‰ã€‚ å¦‚ä½•é…ç½® HTTPï¼2ï¼Œè¯·å‚è€ƒ å®˜æ–¹æ–‡æ¡£ ã€‚ é…ç½®å±æ€§çš„ç»‘å®šåœ¨ Spring Boot 2.0 ä¸­ï¼Œç”¨äºç»‘å®šEnvironmentå±æ€§çš„æœºåˆ¶@ConfigurationPropertieså·²ç»å®Œå…¨å½»åº•ä¿®æ”¹ã€‚æˆ‘ä»¬å€Ÿæ­¤æœºä¼šæ”¶ç´§äº†æ¾æ•£ç»‘å®šçš„è§„åˆ™ï¼Œå¹¶ä¿®å¤äº† Spring Boot 1.x ä¸­çš„è®¸å¤šä¸ä¸€è‡´ä¹‹å¤„ã€‚ æ–°çš„BinderAPI ä¹Ÿå¯ä»¥@ConfigurationPropertiesç›´æ¥åœ¨ä½ è‡ªå·±çš„ä»£ç ä¹‹å¤–ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢å°†ç»“åˆåˆ°Listçš„PersonNameå¯¹è±¡ï¼š 123List&lt;PersonName&gt; people = Binder.get(environment) .bind(\"my.property\", Bindable.listOf(PersonName.class)) .orElseThrow(IllegalStateException::new); é…ç½®æºå¯ä»¥åƒè¿™æ ·åœ¨ YAML ä¸­è¡¨ç¤ºï¼š 123456my: property: - first-name: zhisheng last-name: tian - first-name: zhisheng last-name: tian æœ‰å…³æ›´æ–°ç»‘å®šè§„åˆ™çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…æ­¤Wikié¡µé¢ã€‚ é…ç½®èµ·æºYAML æ–‡ä»¶å’Œè¢« Spring Boot åŠ è½½çš„ Properties æ–‡ä»¶ç°åœ¨åŒ…å«Originä¿¡æ¯ï¼Œå¯å¸®åŠ©æ‚¨è·Ÿè¸ªé¡¹ç›®ä»ä½•å¤„åŠ è½½çš„ä¿¡æ¯ã€‚æœ‰äº› Spring Boot ç‰¹æ€§åˆ©ç”¨äº†è¿™ä¸ªä¿¡æ¯å¯ä»¥åœ¨é€‚å½“çš„æ—¶å€™å±•ç¤ºå‡ºæ¥ã€‚ ä¾‹å¦‚ï¼ŒBindExceptionç»‘å®šå¤±è´¥æ—¶æŠ›å‡ºçš„ç±»æ˜¯ä¸€ä¸ªOriginProviderã€‚è¿™æ„å‘³ç€åŸå§‹ä¿¡æ¯å¯ä»¥å¾ˆå¥½åœ°ä»æ•…éšœåˆ†æå™¨ä¸­æ˜¾ç¤ºå‡ºæ¥ã€‚ å¦ä¸€ä¸ªä¾‹å­æ˜¯envæ‰§è¡Œå™¨ç«¯ç‚¹ï¼Œå½“å®ƒæœ‰å¯ç”¨æ—¶åŒ…å«äº†åŸå§‹ä¿¡æ¯ã€‚ä¸‹é¢çš„ä»£ç ç‰‡æ–­æ˜¾ç¤ºè¯¥spring.security.user.nameå±æ€§æ¥è‡ª jar åŒ…ä¸­çš„ application.properties æ–‡ä»¶çš„ç¬¬ 1è¡Œï¼Œç¬¬ 27 åˆ—ã€‚ 123456789&#123; \"name\": \"applicationConfig: [classpath:/application.properties]\", \"properties\": &#123; \"spring.security.user.name\": &#123; \"value\": \"user\", \"origin\": \"class path resource [application.properties]:1:27\" &#125; &#125;&#125; è½¬æ¢å™¨æ”¯æŒBinding åˆ©ç”¨äº†ä¸€ä¸ªæ–°çš„ ApplicationConversionService ç±»ï¼Œå®ƒæä¾›äº†ä¸€äº›å¯¹å±æ€§ç»‘å®šç‰¹åˆ«æœ‰ç”¨çš„é¢å¤–è½¬æ¢å™¨ã€‚æœ€å¼•äººæ³¨ç›®çš„æ˜¯è½¬æ¢å™¨çš„Durationç±»å‹å’Œåˆ†éš”å­—ç¬¦ä¸²ã€‚ è¯¥Durationè½¬æ¢å™¨å…è®¸åœ¨ä»»ä¸€ ISO-8601 æ ¼å¼ä¸­æŒ‡å®šçš„æŒç»­æ—¶é—´ï¼Œæˆ–ä½œä¸ºä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²ï¼ˆä¾‹å¦‚10mï¼Œ10 åˆ†é’Ÿï¼‰ã€‚ç°æœ‰çš„å±æ€§å·²æ›´æ”¹ä¸ºå§‹ç»ˆä½¿ç”¨Durationã€‚è¯¥@DurationUnitæ³¨é‡Šé€šè¿‡è®¾ç½®å¦‚æœæ²¡æœ‰æŒ‡å®šæ‰€ä½¿ç”¨çš„å•å…ƒç¡®ä¿å‘åå…¼å®¹æ€§ã€‚ä¾‹å¦‚ï¼ŒSpring Boot 1.5 ä¸­éœ€è¦ç§’æ•°çš„å±æ€§ç°åœ¨å¿…é¡»@DurationUnit(ChronoUnit.SECONDS)ç¡®ä¿ä¸€ä¸ªç®€å•çš„å€¼ï¼Œä¾‹å¦‚10å®é™…ä½¿ç”¨çš„å€¼10sã€‚ åˆ†éš”å­—ç¬¦ä¸²è½¬æ¢å…è®¸æ‚¨å°†ç®€å•ç»‘å®šStringåˆ°Collectionæˆ–Arrayä¸å¿…åˆ†å‰²é€—å·ã€‚ä¾‹å¦‚ï¼ŒLDAP base-dn å±æ€§ç”¨ @Delimiter(Delimiter.NONE)ï¼Œæ‰€ä»¥ LDAP DNï¼ˆé€šå¸¸åŒ…å«é€—å·ï¼‰ä¸ä¼šè¢«é”™è¯¯è§£é‡Šã€‚ Gradle æ’ä»¶Spring Boot çš„ Gradle æ’ä»¶å·²åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šè¿›è¡Œäº†é‡æ–°ç¼–å†™ï¼Œä»¥å®ç°è®¸å¤šé‡å¤§æ”¹è¿›ã€‚æ‚¨å¯ä»¥åœ¨å…¶å‚è€ƒæ–‡çŒ®å’Œ API æ–‡æ¡£ä¸­é˜…è¯»å…³äºæ’ä»¶åŠŸèƒ½çš„æ›´å¤šä¿¡æ¯ã€‚ Spring Boot ç°åœ¨éœ€è¦ Gradle 4.x. å¦‚æœæ‚¨è¦å‡çº§ä½¿ç”¨ Gradle çš„é¡¹ç›®ï¼Œè¯·æŸ¥çœ‹è¿ç§»æŒ‡å—ã€‚ KotlinSpring Boot 2.0 ç°åœ¨åŒ…å«å¯¹ Kotlin 1.2.x çš„æ”¯æŒï¼Œå¹¶æä¾›äº†runApplication ï¼Œä¸€ä¸ªä½¿ç”¨ Kotlin è¿è¡Œ Spring Boot åº”ç”¨ç¨‹åºçš„æ–¹æ³•ã€‚æˆ‘ä»¬è¿˜å…¬å¼€å’Œåˆ©ç”¨äº† Kotlin å¯¹å…¶ä»– Spring é¡¹ç›®ï¼ˆå¦‚Spring Frameworkï¼ŒSpring Data å’Œ Reactorï¼‰å·²æ·»åŠ åˆ°å…¶æœ€è¿‘ç‰ˆæœ¬ä¸­çš„æ”¯æŒã€‚ æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…å‚è€ƒæ–‡æ¡£çš„Kotlinæ”¯æŒéƒ¨åˆ†ã€‚ Actuator æ”¹è¿›åœ¨ Spring Boot 2.0 ä¸­ Actuator endpoints æœ‰å¾ˆå¤§çš„æ”¹è¿›ã€‚æ‰€æœ‰ HTTP Actuator endpoints ç°åœ¨éƒ½åœ¨è¯¥/actuatorè·¯å¾„ä¸‹å…¬å¼€ï¼Œå¹¶ä¸”ç”Ÿæˆçš„ JSON æœ‰æ•ˆè´Ÿè½½å¾—åˆ°äº†æ”¹è¿›ã€‚ æˆ‘ä»¬ç°åœ¨ä¹Ÿä¸ä¼šåœ¨é»˜è®¤æƒ…å†µä¸‹æš´éœ²å¾ˆå¤šç«¯ç‚¹ã€‚å¦‚æœæ‚¨è¦å‡çº§ç°æœ‰çš„ Spring Boot 1.5 åº”ç”¨ç¨‹åºï¼Œè¯·åŠ¡å¿…æŸ¥çœ‹è¿ç§»æŒ‡å—å¹¶ç‰¹åˆ«æ³¨æ„è¯¥management.endpoints.web.exposure.includeå±æ€§ã€‚ Actuator JSONSpring Boot 2.0 æ”¹è¿›äº†ä»è®¸å¤šç«¯ç‚¹è¿”å›çš„ JSON æœ‰æ•ˆè´Ÿè½½ã€‚ ç°åœ¨è®¸å¤šç«¯ç‚¹éƒ½å…·æœ‰æ›´ç²¾ç¡®åœ°åæ˜ åº•å±‚æ•°æ®çš„ JSONã€‚ä¾‹å¦‚ï¼Œ/actuator/conditionsç»ˆç«¯ï¼ˆ/autoconfigåœ¨Spring Boot 1.5ä¸­ï¼‰ç°åœ¨æœ‰ä¸€ä¸ªé¡¶çº§contextså¯†é’¥æ¥å°†ç»“æœåˆ†ç»„ApplicationContextã€‚ ç°åœ¨è¿˜ä½¿ç”¨ Spring REST Docs ç”Ÿæˆäº†å¹¿æ³›çš„ REST API æ–‡æ¡£ï¼Œå¹¶éšæ¯ä¸ªç‰ˆæœ¬å‘å¸ƒã€‚ Jersey and WebFlux æ”¯æŒé™¤äº†æ”¯æŒ Spring MVC å’Œ JMXï¼Œæ‚¨ç°åœ¨å¯ä»¥åœ¨å¼€å‘ Jersey æˆ– WebFlux åº”ç”¨ç¨‹åºæ—¶è®¿é—®æ‰§è¡Œå™¨ç«¯ç‚¹ã€‚Jersey æ”¯æŒé€šè¿‡è‡ªå®šä¹‰ Jersey æä¾›Resourceï¼ŒWebFlux ä½¿ç”¨è‡ªå®šä¹‰HandlerMappingã€‚ Hypermedia linksè¯¥/actuatorç«¯ç‚¹ç°åœ¨æä¾›äº†ä¸€ä¸ª HAL æ ¼å¼çš„å“åº”æä¾›é“¾æ¥åˆ°æ‰€æœ‰æ´»åŠ¨ç«¯ç‚¹ï¼ˆå³ä½¿ä½ æ²¡æœ‰ Spring HATEOAS åœ¨classpathï¼‰ã€‚ Actuator @Endpointsä¸ºäº†æ”¯æŒ Spring MVCï¼ŒJMXï¼ŒWebFlux å’Œ Jerseyï¼Œæˆ‘ä»¬ä¸º Actuator @Endpoints å¼€å‘äº†ä¸€ç§æ–°çš„ç¼–ç¨‹æ¨¡å‹ã€‚è¯¥@Endpointæ³¨è§£å¯ä»¥ä¸@ReadOperationï¼Œ@WriteOperation å’Œ @DeleteOperation ç»„åˆä½¿ç”¨å¼€å‘ endpointsã€‚ æ‚¨è¿˜å¯ä»¥ä½¿ç”¨@EndpointWebExtensionæˆ–@EndpointJmxExtensionç¼–å†™æŠ€æœ¯ç‰¹å®šçš„å¢å¼ºåŠŸèƒ½åˆ° endpointsã€‚è¯¦ç»†ä¿¡æ¯è¯·å‚é˜…æ›´æ–°çš„å‚è€ƒæ–‡æ¡£ã€‚ MicrometerSpring Boot 2.0 ä¸å†æä¾›è‡ªå·±çš„æŒ‡æ ‡ APIã€‚ç›¸åï¼Œæˆ‘ä»¬ä¾é  micrometer.io æ¥æ»¡è¶³æ‰€æœ‰åº”ç”¨ç¨‹åºç›‘è§†éœ€æ±‚ã€‚ Micrometer åŒ…æ‹¬å°ºå¯¸æŒ‡æ ‡çš„æ”¯æŒï¼Œå½“ä¸å°ºå¯¸ç›‘æµ‹ç³»ç»Ÿé…å¯¹æ—¶ï¼Œå°ºå¯¸æŒ‡æ ‡å¯ä»¥æœ‰æ•ˆè®¿é—®ç‰¹å®šçš„æŒ‡å®šåº¦é‡æ ‡å‡†ï¼Œå¹¶ä¸”å¯ä»¥åœ¨å…¶å°ºå¯¸èŒƒå›´å†…å‘ä¸‹é’»å–ã€‚ æŒ‡æ ‡å¯ä»¥è¾“å‡ºåˆ°å„ç§ç³»ç»Ÿå’Œå¼€ç®±å³ç”¨çš„ Spring Boot 2.0ï¼Œä¸º Atlasï¼ŒDatadogï¼ŒGangliaï¼ŒGraphiteï¼ŒInfluxï¼ŒJMXï¼ŒNew Relicï¼ŒPrometheusï¼ŒSignalFxï¼ŒStatsD å’Œ Wavefront æä¾›æ”¯æŒã€‚å¦å¤–è¿˜å¯ä»¥ä½¿ç”¨ç®€å•çš„å†…å­˜ä¸­åº¦é‡æ ‡å‡†ã€‚ é›†æˆéš JVM æŒ‡æ ‡ï¼ˆåŒ…æ‹¬ CPUï¼Œå†…å­˜ï¼Œçº¿ç¨‹å’Œ GCï¼‰ï¼ŒLogbackï¼ŒTomcatï¼ŒSpring MVCï¼†æä¾›RestTemplateã€‚ æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…å‚è€ƒæ–‡æ¡£çš„æ›´æ–°â€œæŒ‡æ ‡â€éƒ¨åˆ†ã€‚ æ•°æ®æ”¯æŒé™¤äº†ä¸Šé¢æåˆ°çš„ Reactive Spring Data æ”¯æŒå¤–ï¼Œåœ¨æ•°æ®é¢†åŸŸè¿˜è¿›è¡Œäº†å…¶ä»–ä¸€äº›æ›´æ–°å’Œæ”¹è¿›ã€‚ HikariCPSpring Boot 2.0 ä¸­çš„é»˜è®¤æ•°æ®åº“æ± æŠ€æœ¯å·²ä» Tomcat Pool åˆ‡æ¢åˆ° HikariCPã€‚æˆ‘ä»¬å‘ç° Hakari æä¾›äº†å“è¶Šçš„æ€§èƒ½ï¼Œæˆ‘ä»¬çš„è®¸å¤šç”¨æˆ·æ›´å–œæ¬¢ Tomcat Poolã€‚ åˆå§‹åŒ–æ•°æ®åº“åˆå§‹åŒ–é€»è¾‘åœ¨ Spring Boot 2.0 ä¸­å·²ç»åˆç†åŒ–ã€‚Spring Batchï¼ŒSpring Integrationï¼ŒSpring Session å’Œ Quartzçš„åˆå§‹åŒ–ç°åœ¨ä»…åœ¨ä½¿ç”¨åµŒå…¥å¼æ•°æ®åº“æ—¶æ‰ä¼šé»˜è®¤å‘ç”Ÿã€‚è¯¥enabledå±æ€§å·²è¢«æ›¿æ¢ä¸ºæ›´å…·è¡¨ç°åŠ›æšä¸¾ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³ä¸€ç›´æ‰§è¡Œ Spring Batch çš„åˆå§‹åŒ–ï¼Œæ‚¨å¯ä»¥è®¾ç½®spring.batch.initialize-schema=alwaysã€‚ å¦‚æœ Flyway æˆ– Liquibase æ­£åœ¨ç®¡ç†æ‚¨çš„ DataSource çš„æ¨¡å¼ï¼Œå¹¶ä¸”æ‚¨æ­£åœ¨ä½¿ç”¨åµŒå…¥å¼æ•°æ®åº“ï¼ŒSpring Boot ç°åœ¨ä¼šè‡ªåŠ¨å…³é—­ Hibernate çš„è‡ªåŠ¨ DDL åŠŸèƒ½ã€‚ JOOQSpring Boot 2.0 ç°åœ¨åŸºäº DataSource è‡ªåŠ¨æ£€æµ‹ JOOQ æ–¹è¨€ï¼ˆç±»ä¼¼äºä¸º JPA æ–¹è¨€æ‰€åšçš„ï¼‰ã€‚@JooqTestæ˜¯æ–°å¼•å…¥çš„æ³¨è§£ç”¨æ¥ç®€åŒ–é‚£äº›åªæœ‰ JOOQ å¿…é¡»è¢«ä½¿ç”¨çš„æµ‹è¯•ã€‚ JdbcTemplateSpring Boot è‡ªåŠ¨é…ç½®çš„ JdbcTemplate ç°åœ¨å¯ä»¥é€šè¿‡ spring.jdbc.template å±æ€§è¿›è¡Œè‡ªå®šä¹‰ã€‚æ­¤å¤–ï¼ŒNamedParameterJdbcTemplateè‡ªåŠ¨é…ç½®çš„å†…å®¹ä¼šé‡ç”¨JdbcTemplateã€‚ Spring Data Web é…ç½®Spring Boot å…¬å¼€äº†ä¸€ä¸ªæ–°çš„spring.data.webé…ç½®åç§°ç©ºé—´ï¼Œå¯ä»¥è½»æ¾é…ç½®åˆ†é¡µå’Œæ’åºã€‚ InfluxDBSpring Boot ç°åœ¨è‡ªåŠ¨é…ç½®å¼€æºæ—¶é—´åºåˆ—æ•°æ®åº“ InfluxDBã€‚è¦å¯ç”¨ InfluxDB æ”¯æŒï¼Œæ‚¨éœ€è¦è®¾ç½®ä¸€ä¸ªspring.influx.urlå±æ€§ï¼Œå¹¶å°†å…¶åŒ…å«influxdb-javaåœ¨æ‚¨çš„ç±»è·¯å¾„ä¸­ã€‚ Flyway/Liquibase çµæ´»é…ç½®å¦‚æœä»…æä¾›è‡ªå®šä¹‰urlæˆ–userå±æ€§ï¼Œåˆ™ Flyway å’Œ Liquibase çš„è‡ªåŠ¨é…ç½®ç°åœ¨å°†é‡ç”¨æ ‡å‡†æ•°æ®æºå±æ€§ï¼Œè€Œä¸æ˜¯å¿½ç•¥å®ƒä»¬ã€‚è¿™ä½¿æ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„æ•°æ®æºï¼Œä»…ç”¨äºæ‰€éœ€ä¿¡æ¯çš„è¿ç§»ã€‚ Hibernateç°åœ¨æ”¯æŒè‡ªå®šä¹‰ Hibernate å‘½åç­–ç•¥ã€‚å¯¹äºé«˜çº§åœºæ™¯ï¼Œç°åœ¨å¯ä»¥åœ¨ä¸Šä¸‹æ–‡ä¸­å®šä¹‰ImplicitNamingStrategyæˆ–PhysicalNamingStrategyä½¿ç”¨å¸¸è§„ beanã€‚ ç°åœ¨ä¹Ÿå¯ä»¥é€šè¿‡å…¬å¼€HibernatePropertiesCustomizerbean æ¥æ›´åŠ ç»†è‡´åœ°å®šåˆ¶ Hibernate ä½¿ç”¨çš„å±æ€§ã€‚ MongoDB å®¢æˆ·ç«¯è‡ªå®šä¹‰ç°åœ¨å¯ä»¥é€šè¿‡å®šä¹‰ä¸€ä¸ªç±»å‹çš„ bean æ¥ä¸º Spring Boot è‡ªåŠ¨é…ç½®çš„ Mongo å®¢æˆ·ç«¯åº”ç”¨é«˜çº§å®šåˆ¶MongoClientSettingsBuilderCustomizerã€‚ Redisç°åœ¨å¯ä»¥ä½¿ç”¨spring.cache.redis.*å±æ€§é…ç½® Redis çš„ç¼“å­˜é»˜è®¤å€¼ã€‚ Webé™¤äº†ä¸Šé¢æåˆ°çš„ WebFlux å’Œ WebFlux.fn æ”¯æŒä¹‹å¤–ï¼Œè¿˜åœ¨å¼€å‘ Web åº”ç”¨ç¨‹åºæ—¶è¿›è¡Œäº†ä»¥ä¸‹æ”¹è¿›ã€‚ ä¸Šä¸‹æ–‡è·¯å¾„è®°å½•å½“ä½¿ç”¨åµŒå…¥å¼å®¹å™¨æ—¶ï¼Œå½“æ‚¨çš„åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ï¼Œä¸Šä¸‹æ–‡è·¯å¾„å°†ä¸ HTTP ç«¯å£ä¸€èµ·è®°å½•ã€‚ä¾‹å¦‚ï¼ŒåµŒå…¥å¼ Tomcat ç°åœ¨çœ‹èµ·æ¥åƒè¿™æ ·ï¼š 1Tomcat åœ¨ç«¯å£ä¸Šå¯åŠ¨ï¼š8080ï¼ˆhttpï¼‰ï¼Œå…¶ä¸Šä¸‹æ–‡è·¯å¾„ä¸º &apos;/foo&apos; Webè¿‡æ»¤å™¨åˆå§‹åŒ–Web è¿‡æ»¤å™¨ç°åœ¨åœ¨æ‰€æœ‰æ”¯æŒçš„å®¹å™¨ä¸Šæ€¥åˆ‡åœ°åˆå§‹åŒ–ã€‚ ThymeleafThymeleaf åˆå§‹åŒ–ç°åœ¨åŒ…æ‹¬thymeleaf-extras-java8timeï¼Œæä¾›javax.timeç±»å‹æ”¯æŒã€‚ JSON æ”¯æŒæ–°çš„spring-boot-starter-jsonèµ·å§‹è€…æ”¶é›†å¿…è¦çš„ä½ä»¥è¯»å–å’Œå†™å…¥ JSONã€‚å®ƒä¸ä»…æä¾›äº†jackson-databindä¸Java8 å·¥ä½œæ—¶ï¼Œä¹Ÿæ˜¯æœ‰ç”¨çš„æ¨¡å—ï¼šjackson-datatype-jdk8ï¼Œjackson-datatype-jsr310å’Œjackson-module-parameter-namesã€‚è¿™ä¸ªæ–°çš„èµ·åŠ¨å™¨ç°åœ¨è¢«ç”¨äºjackson-databindä¹‹å‰å®šä¹‰çš„åœ°æ–¹ã€‚ å¦‚æœæ‚¨æ›´å–œæ¬¢ Jackson ä¹‹å¤–çš„å…¶ä»–äº§å“ï¼Œæˆ‘ä»¬å¯¹ GSON çš„æ”¯æŒåœ¨ Spring Boot 2.0 å·²ç»å¤§å¤§æé«˜ã€‚æˆ‘ä»¬è¿˜å¼•å…¥äº†å¯¹ JSON-B çš„æ”¯æŒï¼ˆåŒ…æ‹¬ JSON-B æµ‹è¯•æ”¯æŒï¼‰ã€‚ Quartzè‡ªåŠ¨é…ç½®æ”¯æŒç›®å‰åŒ…å«äº† Quartz Schedulerã€‚æˆ‘ä»¬è¿˜æ·»åŠ äº†æ–°çš„spring-boot-starter-quartz åˆå§‹åŒ– POMã€‚ æ‚¨å¯ä»¥ä½¿ç”¨å†…å­˜JobStoresä¸­æˆ–å®Œæ•´çš„åŸºäº JDBC çš„å­˜å‚¨ã€‚æ‰€æœ‰JobDetailï¼ŒCalendarå¹¶Triggerä»ä½ çš„ Springåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡è±†å°†è‡ªåŠ¨æ³¨å†ŒSchedulerã€‚ æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·é˜…è¯»å‚è€ƒæ–‡æ¡£çš„æ–°â€œQuartz Schedulerâ€éƒ¨åˆ†ã€‚ æµ‹è¯•å¯¹ Spring Boot 2.0 ä¸­æä¾›çš„æµ‹è¯•æ”¯æŒè¿›è¡Œäº†ä¸€äº›è¡¥å……å’Œè°ƒæ•´ï¼š @WebFluxTestå·²æ·»åŠ æ–°æ³¨é‡Šä»¥æ”¯æŒ WebFlux åº”ç”¨ç¨‹åºçš„â€œåˆ‡ç‰‡â€æµ‹è¯•ã€‚ Converterå’ŒGenericConverterè±†ç±»ç°åœ¨è‡ªåŠ¨æ‰«æ@WebMvcTestå’Œ@WebFluxTestã€‚ @AutoConfigureWebTestClientå·²ç»æ·»åŠ äº†ä¸€ä¸ªæ³¨é‡Šæ¥æä¾›ä¸€ä¸ªWebTestClientbean ä¾›æµ‹è¯•ä½¿ç”¨ã€‚æ³¨é‡Šä¼šè‡ªåŠ¨åº”ç”¨äº@WebFluxTestæµ‹è¯•ã€‚ å¢åŠ äº†ä¸€ä¸ªæ–°çš„ApplicationContextRunneræµ‹è¯•å®ç”¨ç¨‹åºï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°æµ‹è¯•æ‚¨çš„è‡ªåŠ¨é…ç½®ã€‚æˆ‘ä»¬å·²å°†å¤§éƒ¨åˆ†å†…éƒ¨æµ‹è¯•å¥—ä»¶ç§»è‡³æ­¤æ–°æ¨¡å‹ã€‚è¯¦ç»†ä¿¡æ¯è¯·å‚é˜…æ›´æ–°çš„æ–‡æ¡£ã€‚ å…¶å®ƒé™¤äº†ä¸Šé¢åˆ—å‡ºçš„å˜åŒ–å¤–ï¼Œè¿˜æœ‰å¾ˆå¤šå°çš„è°ƒæ•´å’Œæ”¹è¿›ï¼ŒåŒ…æ‹¬ï¼š @ConditionalOnBeanç°åœ¨åœ¨ç¡®å®šæ˜¯å¦æ»¡è¶³æ¡ä»¶æ—¶ä½¿ç”¨é€»è¾‘ANDè€Œä¸æ˜¯é€»è¾‘ORã€‚ æ— æ¡ä»¶ç±»ç°åœ¨åŒ…å«åœ¨è‡ªåŠ¨é…ç½®æŠ¥å‘Šä¸­ã€‚ è¯¥springCLI åº”ç”¨ç¨‹åºç°åœ¨åŒ…æ‹¬encodepasswordå¯ç”¨äºåˆ›å»º Spring Security çš„å…¼å®¹æ•£åˆ—å¯†ç å‘½ä»¤ã€‚ è®¡åˆ’ä»»åŠ¡ï¼ˆå³ @EnableSchedulingï¼‰å¯ä»¥ä½¿ç”¨scheduledtasksæ‰§è¡Œå™¨ç«¯ç‚¹è¿›è¡Œå®¡æŸ¥ã€‚ è¯¥loggersé©±åŠ¨å™¨ç»ˆç«¯ç°åœ¨å…è®¸ä½ é‡æ–°è®¾ç½®ä¸€ä¸ªè®°å½•å™¨çº§åˆ«ä¸ºå®ƒçš„é»˜è®¤ã€‚ Spring Session ç”¨æˆ·ç°åœ¨å¯ä»¥é€šè¿‡sessionsæ‰§è¡Œå™¨ç«¯ç‚¹æŸ¥æ‰¾å’Œåˆ é™¤ä¼šè¯ã€‚ ä½¿ç”¨spring-boot-starter-parentç°åœ¨åŸºäº Maven çš„åº”ç”¨ç¨‹åº-parametersé»˜è®¤ä½¿ç”¨æ ‡å¿—ã€‚ æˆ‘ä»¬çš„æ„å»ºç°åœ¨ä½¿ç”¨ concourse çš„ CI å’Œæˆ‘ä»¬çš„é¡¹ç›® POM æ–‡ä»¶å·²è¢«é‡æ„ï¼Œä½¿å®ƒä»¬æ›´ç®€å•çš„ã€‚ åŠ¨ç”» ASCII è‰ºæœ¯æœ€åï¼Œä¸ºäº†å¥½ç©ï¼ŒSpring Boot 2.0 ç°åœ¨æ”¯æŒåŠ¨ç”» GIF æ¨ªå¹…ã€‚ å‚è€ƒèµ„æ–™https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-2.0-Release-Notes ç›¸å…³æ–‡ç« 1ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (ä¸€)ï¼šSpring Boot 2.0 è¿ç§»æŒ‡å— 2ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (äºŒ)ï¼šSpring Boot 2.0 æ–°ç‰¹æ€§è¯¦è§£ 3ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (ä¸‰)ï¼šSpring Boot 2.0 é…ç½®æ”¹å˜ 4ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (å››)ï¼šSpring Boot 2.0 æºç é˜…è¯»ç¯å¢ƒæ­å»º 5ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (äº”)ï¼šSpring Boot 2.0 é¡¹ç›®æºç ç»“æ„é¢„è§ˆ 6ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (å…­)ï¼šSpring boot 2.0 ä¸­ SpringBootApplication æ³¨è§£è¯¦è§£ 7ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (ä¸ƒ)ï¼šSpringApplication æ·±å…¥æ¢ç´¢","tags":[{"name":"Java","slug":"Java","permalink":"http://www.54tianzhisheng.cn/tags/Java/"},{"name":"SpringBoot","slug":"SpringBoot","permalink":"http://www.54tianzhisheng.cn/tags/SpringBoot/"}]},{"title":"Spring Boot 2.0ç³»åˆ—æ–‡ç« (ä¸€)ï¼šSpring Boot 2.0 è¿ç§»æŒ‡å—","date":"2018-03-05T16:00:00.000Z","path":"2018/03/06/SpringBoot2-Migration-Guide/","text":"å‰æå¸Œæœ›æœ¬æ–‡æ¡£å°†å¸®åŠ©æ‚¨æŠŠåº”ç”¨ç¨‹åºè¿ç§»åˆ° Spring Boot 2.0ã€‚ SpringBoot ç³»åˆ—æ–‡ç«  å…³æ³¨æˆ‘ è½¬è½½è¯·åŠ¡å¿…æ³¨æ˜åŸåˆ›åœ°å€ä¸ºï¼šhttp://www.54tianzhisheng.cn/2018/03/06/SpringBoot2-Migration-Guide/ åœ¨ä½ å¼€å§‹ä¹‹å‰é¦–å…ˆï¼ŒSpring Boot 2.0 éœ€è¦ Java 8 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚ä¸å†æ”¯æŒ Java 6 å’Œ 7 äº†ã€‚ åœ¨ Spring Boot 2.0 ä¸­ï¼Œè®¸å¤šé…ç½®å±æ€§è¢«é‡æ–°å‘½å/åˆ é™¤ï¼Œå¼€å‘äººå‘˜éœ€è¦æ›´æ–°application.properties/ application.ymlç›¸åº”çš„é…ç½®ã€‚ä¸ºäº†å¸®åŠ©ä½ è§£å†³è¿™ä¸€é—®é¢˜ï¼ŒSpring Boot å‘å¸ƒäº†ä¸€ä¸ªæ–°spring-boot-properties-migratoræ¨¡å—ã€‚ä¸€æ—¦ä½œä¸ºè¯¥æ¨¡å—ä½œä¸ºä¾èµ–è¢«æ·»åŠ åˆ°ä½ çš„é¡¹ç›®ä¸­ï¼Œå®ƒä¸ä»…ä¼šåˆ†æåº”ç”¨ç¨‹åºçš„ç¯å¢ƒï¼Œè€Œä¸”è¿˜ä¼šåœ¨å¯åŠ¨æ—¶æ‰“å°è¯Šæ–­ä¿¡æ¯ï¼Œè€Œä¸”è¿˜ä¼šåœ¨è¿è¡Œæ—¶ä¸ºæ‚¨æš‚æ—¶è¿ç§»å±æ€§ã€‚åœ¨æ‚¨çš„åº”ç”¨ç¨‹åºè¿ç§»æœŸé—´ï¼Œè¿™ä¸ªæ¨¡å—æ˜¯å¿…å¤‡çš„ï¼š 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-properties-migrator&lt;/artifactId&gt;&lt;/dependency&gt; æ³¨æ„ï¼šå®Œæˆè¿ç§»åï¼Œè¯·ç¡®ä¿ä»é¡¹ç›®çš„ä¾èµ–å…³ç³»ä¸­åˆ é™¤æ­¤æ¨¡å—ã€‚ æ„å»ºæ‚¨çš„ Spring Boot åº”ç”¨ç¨‹åºSpring Boot Maven æ’ä»¶ä¸ºäº†ä¿æŒäº†ä¸€è‡´æ€§ï¼Œå¹¶ä¸”é¿å…ä¸å…¶ä»–æ’ä»¶å‘ç”Ÿå†²çªï¼Œç°åœ¨æš´éœ²çš„æ’ä»¶é…ç½®å±æ€§éƒ½ä»¥ä¸€ä¸ªspring-bootå‰ç¼€å¼€å§‹ã€‚ ä¾‹å¦‚ï¼Œä»¥ä¸‹å‘½ä»¤prodä½¿ç”¨å‘½ä»¤è¡Œå¯ç”¨é…ç½®æ–‡ä»¶ 1mvn spring-boot:run -Dspring-boot.run.profiles=prod Surefire é»˜è®¤å€¼ä»¥å‰çš„ include/exclude æ¨¡å¼å·²ä¸æœ€æ–°çš„ Surefire é»˜è®¤è®¾ç½®ä¿æŒä¸€è‡´ã€‚å¦‚æœä¾èµ–äºæ­¤æ’ä»¶ï¼Œéœ€è¦ç›¸åº”åœ°æ›´æ–°æ’ä»¶é…ç½®ã€‚ä¹‹å‰å¯¹åº”çš„é…ç½®å¦‚ä¸‹ï¼š 12345678910111213&lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt; &lt;configuration&gt; &lt;includes&gt; &lt;include&gt;**/*Tests.java&lt;/include&gt; &lt;include&gt;**/*Test.java&lt;/include&gt; &lt;/includes&gt; &lt;excludes&gt; &lt;exclude&gt;**/Abstract*.java&lt;/exclude&gt; &lt;/excludes&gt; &lt;/configuration&gt;&lt;/plugin&gt; PS: å¦‚æœæ‚¨ä½¿ç”¨ JUnit 5ï¼Œåˆ™åº”å°† Surefire é™çº§åˆ° 2.19.1ã€‚è¯¥**/*Tests.javaç‰ˆæœ¬ä¸åŒ…å«æ­¤æ¨¡å¼ï¼Œå› æ­¤å¦‚æœæ‚¨ä¾èµ–è¯¥æ¨¡å¼ï¼Œè¯·ç¡®ä¿å°†å…¶æ·»åŠ åˆ°æ‚¨çš„é…ç½®ä¸­ã€‚ Spring Boot Gradle æ’ä»¶Spring Boot çš„ Gradle æ’ä»¶åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå·²è¢«é‡å†™ï¼Œæœ‰äº†é‡å¤§çš„æ”¹è¿›ã€‚æ‚¨å¯ä»¥åœ¨å…¶å‚è€ƒæ–‡çŒ®å’ŒAPIæ–‡æ¡£ä¸­é˜…è¯»å…³äºæ’ä»¶åŠŸèƒ½çš„æ›´å¤šä¿¡æ¯ã€‚ ä¾èµ–ç®¡ç†Spring Boot çš„ Gradle æ’ä»¶ä¸å†è‡ªåŠ¨åº”ç”¨ä¾èµ–ç®¡ç†æ’ä»¶ã€‚ç›¸åï¼ŒSpring Boot çš„æ’ä»¶ç°åœ¨å¯ä»¥é€šè¿‡å¯¼å…¥æ­£ç¡®ç‰ˆæœ¬çš„spring-boot-dependencies BOM æ¥åº”ç”¨ä¾èµ–ç®¡ç†æ’ä»¶ã€‚å½“ä¾èµ–ç®¡ç†è¢«é…ç½®çš„æ—¶å€™ï¼Œè¿™ä¸€ç‚¹ä¼šè®©ä½ æœ‰æ›´å¤šçš„æ§åˆ¶æƒã€‚ å¯¹äºå¤§å¤šæ•°åº”ç”¨ç¨‹åºï¼Œä½¿ç”¨åº”ç”¨ä¾èµ–ç®¡ç†æ’ä»¶å°±è¶³å¤Ÿäº†ï¼š 12apply plugin: &apos;org.springframework.boot&apos;apply plugin: &apos;io.spring.dependency-management&apos; // &lt;-- add this to your build.gradle æ³¨æ„ï¼šä¾èµ–ç®¡ç†æ’ä»¶ä»ç„¶æ˜¯ spring-boot-gradle-plugin çš„ä¼ é€’ä¾èµ–é¡¹ï¼Œæ‰€ä»¥ä¸éœ€è¦åœ¨ buildscript é…ç½®ä¸­å°†å…¶åˆ—ä¸ºç±»è·¯å¾„ä¾èµ–é¡¹ã€‚ å»ºç«‹å¯æ‰§è¡Œçš„ Jars å’Œ Wars bootRepackage ä»»åŠ¡å·²ç»è¢«æ›¿æ¢æˆ bootJar å’Œ bootWar ä»»åŠ¡ï¼Œåˆ†åˆ«ç”¨äºæ„å»ºå¯æ‰§è¡Œçš„ jar åŒ…å’Œ waråŒ…ã€‚ é…ç½®æ›´æ–°BootRunï¼ŒBootJarå’ŒBootWarä»»åŠ¡ç°åœ¨éƒ½ä½¿ç”¨mainClassNameçš„å±æ€§æ¥é…ç½®ä¸»ç±»çš„åç§°ã€‚è¿™ä½¿å¾—ä¸‰ä¸ªç‰¹å®šäºå¼•å¯¼çš„ä»»åŠ¡ç›¸äº’ä¸€è‡´ï¼Œå¹¶å°†å…¶ä¸ Gradle è‡ªå·±çš„åº”ç”¨ç¨‹åºæ’ä»¶è¿›è¡Œå¯¹é½ã€‚ Spring Boot ç‰¹æ€§é»˜è®¤åŠ¨æ€ä»£ç†ç­–ç•¥Spring Boot é»˜è®¤ä½¿ç”¨ CGLIB åšåŠ¨æ€ä»£ç†ä»£ç†(åŸºäºç±»çš„åŠ¨æ€ä»£ç†)ï¼ŒåŒ…æ‹¬å¯¹ AOP çš„æ”¯æŒã€‚å¦‚æœä½ éœ€è¦åŸºäºæ¥å£çš„åŠ¨æ€ä»£ç†ï¼Œä½ éœ€è¦å°†spring.aop.proxy-target-class è®¾ç½®ä¸ºfalseã€‚ SpringApplicationWeb ç¯å¢ƒSpring Boot åº”ç”¨ç¨‹åºç°åœ¨å¯ä»¥åœ¨æ›´å¤šæ¨¡å¼ä¸‹è¿è¡Œï¼Œå› æ­¤spring.main.web-environmentç°åœ¨ä¸æ¨èä½¿ç”¨ï¼Œspring.main.web-application-typeå±æ€§å¯ä»¥æä¾›æ›´å¤šçš„æ”¯æŒã€‚ å¦‚æœæ‚¨æƒ³ç¡®ä¿åº”ç”¨ç¨‹åºä¸å¯åŠ¨ Web æœåŠ¡å™¨ï¼Œåˆ™å¿…é¡»å°†è¯¥å±æ€§æ›´æ”¹ä¸ºï¼š 1spring.main.web-application-type=none æ³¨æ„ï¼šå¯ä»¥é€šè¿‡ SpringApplication çš„ setWebApplicationType æ–¹æ³•å®ç°ã€‚ Spring Boot åº”ç”¨ç¨‹åºäº‹ä»¶æ›´æ”¹æˆ‘ä»¬å·²ç»æ·»åŠ äº†ä¸€ä¸ªæ–°äº‹ä»¶ApplicationStartedEventã€‚ ApplicationStartedEventåœ¨ä¸Šä¸‹æ–‡åˆ·æ–°ä¹‹åä½†åœ¨ä»»ä½•åº”ç”¨ç¨‹åºå’Œå‘½ä»¤è¡Œå‚æ•°è¢«è°ƒç”¨ä¹‹å‰å‘é€ã€‚ ApplicationReadyEventåœ¨ä»»ä½•åº”ç”¨ç¨‹åºå’Œå‘½ä»¤è¡Œå‚æ•°è¢«è°ƒç”¨åå‘é€ã€‚å®ƒè¡¨ç¤ºåº”ç”¨ç¨‹åºå·²å‡†å¤‡å¥½ä¸ºè¯·æ±‚æä¾›æœåŠ¡ã€‚ è¯·å‚é˜…æ›´æ–°çš„å‚è€ƒæ–‡æ¡£ã€‚ Banneråœ¨æˆ‘ä»¬é™åˆ¶ Spring Boot ä½¿ç”¨çš„æ ¹åç§°ç©ºé—´çš„æ•°é‡çš„è¿‡ç¨‹ä¸­ï¼Œä¸æ ‡å¿—ç›¸å…³çš„å±æ€§å·²è¢«é‡å®šä½åˆ°spring.bannerã€‚ å¤–éƒ¨åŒ–é…ç½®è½»æ¾çš„ç»‘å®šæœ‰å…³å®½æ¾ç»‘å®šçš„è§„åˆ™å·²ç»æ”¶ç´§ã€‚æˆ‘ä»¬å‡è®¾ä¸€ä¸ªç°æœ‰çš„acme.my-project.my-nameå±æ€§ï¼š æ‰€æœ‰å‰ç¼€å¿…é¡»æ˜¯ kebabæ ¼å¼ï¼ˆå°å†™ï¼Œè¿å­—ç¬¦åˆ†éš”ï¼‰acme.myProjectæˆ–acme.my_projectæ— æ•ˆ - æ‚¨å¿…é¡»acme.my-projectåœ¨æ­¤å¤„ä½¿ç”¨ã€‚ å±æ€§åç§°å¯ä»¥ä½¿ç”¨ kebab-caseï¼ˆmy-nameï¼‰ï¼Œcamel-caseï¼ˆmyNameï¼‰æˆ– snake-caseï¼ˆmy_nameï¼‰ã€‚ ç¯å¢ƒå±æ€§ï¼ˆæ¥è‡ªæ“ä½œç³»ç»Ÿç¯å¢ƒå˜é‡ï¼‰å¿…é¡»ä½¿ç”¨é€šå¸¸çš„å¤§å†™ä¸‹åˆ’çº¿æ ¼å¼ï¼Œä¸‹åˆ’çº¿åªèƒ½ç”¨äºåˆ†éš”é”®çš„å„ä¸ªéƒ¨åˆ†ACME_MYPROJECT_MYNAMEã€‚ è¿™ç§æ–°çš„æ”¾æ¾ç»‘å®šå…·æœ‰ä»¥ä¸‹å‡ ä¸ªä¼˜ç‚¹ï¼š æ— éœ€æ‹…å¿ƒå¯†é’¥çš„ç»“æ„@ConditionalOnPropertyï¼šåªè¦å¯†é’¥æ˜¯ä»¥è§„èŒƒæ ¼å¼å®šä¹‰çš„ï¼Œæ”¯æŒçš„æ¾æ•£å˜ä½“å°±å¯ä»¥é€æ˜åœ°å·¥ä½œã€‚å¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨è¯¥prefixå±æ€§ï¼Œåˆ™ç°åœ¨åªéœ€ä½¿ç”¨nameæˆ–valueå±æ€§å³å¯æ”¾ç½®å®Œæ•´å¯†é’¥ã€‚ RelaxedPropertyResolverä¸å†å¯ä»¥Environmentè‡ªåŠ¨å¤„ç†ï¼šenv.getProperty(&quot;com.foo.my-bar&quot;)å°†æ‰¾åˆ°ä¸€ä¸ªcom.foo.myBarå±æ€§ã€‚ è¯¥org.springframework.boot.bindè½¯ä»¶åŒ…ä¸å†å¯ç”¨ï¼Œå¹¶è¢«æ–°çš„å®½æ¾ç»‘å®šè§„åˆ™æ‰€å–ä»£ã€‚ç‰¹åˆ«æ˜¯ï¼ŒRelaxedDataBinderæœ‹å‹å·²è¢«æ–°çš„BinderAPI å–ä»£ã€‚ä»¥ä¸‹æ ·å“MyPropertiesä»app.acmeå‰ç¼€ä¸­è¿›è¡Œç»‘å®šã€‚ 123MyProperties target = Binder.get(environment) .bind(\"app.acme\", MyProperties.class) .orElse(null); ç”±äºç°åœ¨å†…ç½®äº†è½»æ¾ç»‘å®šï¼Œå› æ­¤åªè¦ä½¿ç”¨å…¶ä¸­ä¸€ç§æ”¯æŒçš„æ ¼å¼ï¼Œå°±å¯ä»¥è¯·æ±‚ä»»ä½•å±æ€§è€Œä¸å¿…å…³å¿ƒæ¡ˆä¾‹ï¼š 123FlagType flagType = Binder.get(environment) .bind(\"acme.app.my-flag\", FlagType.class) .orElse(FlagType.DEFAULT); @ConfigurationProperties éªŒè¯å¦‚æœæ‚¨æƒ³æ‰“å¼€éªŒè¯ï¼Œç°åœ¨å¿…é¡»ä¸ºæ‚¨çš„@ConfigurationPropertieså¯¹è±¡æ·»åŠ æ³¨é‡Š@Validatedã€‚ é…ç½®ä½ç½®spring.config.locationé…ç½®çš„æ–¹å¼å·²è¢«ä¿®å¤; å®ƒæå‰å°†ä¸€ä¸ªä½ç½®æ·»åŠ åˆ°é»˜è®¤ä½ç½®åˆ—è¡¨ä¸­ï¼Œç°åœ¨å®ƒå°†æ›¿æ¢é»˜è®¤ä½ç½®ã€‚å¦‚æœä½ æ˜¯æŒ‰ç…§ä»¥å‰çš„æ–¹å¼è¿›è¡Œå¤„ç†ï¼Œç°åœ¨åº”è¯¥ä½¿ç”¨å®ƒspring.config.additional-locationè¿›è¡Œæ›¿æ¢ã€‚ å¼€å‘ Web åº”ç”¨ç¨‹åºåµŒå…¥å¼å®¹å™¨åŒ…è£…ç»“æ„ä¸ºäº†æ”¯æŒå“åº”å¼ç”¨ä¾‹ï¼ŒåµŒå…¥å¼å®¹å™¨åŒ…ç»“æ„å·²ç»è¢«å¤§å¹…åº¦çš„é‡æ„ã€‚ EmbeddedServletContainerå·²è¢«é‡æ–°å‘½åä¸ºï¼ŒWebServerå¹¶ä¸”è¯¥org.springframework.boot.context.embeddedåŒ…å·²è¢«é‡æ–°å®šä½åˆ°org.springframework.boot.web.embeddedã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨ä½¿ç”¨TomcatEmbeddedServletContainerFactoryå›è°ƒæ¥å£å®šåˆ¶åµŒå…¥å¼ Tomcat å®¹å™¨ï¼Œåˆ™åº”è¯¥ä½¿ç”¨TomcatServletWebServerFactoryã€‚ ç‰¹å®šäº Servlet çš„æœåŠ¡å™¨å±æ€§è®¸å¤šserver.* å±æ€§ ( Servlet ç‰¹æœ‰çš„) å·²ç»è½¬ç§»åˆ°server.servletï¼š æ—§çš„å±æ€§ æ–°çš„å±æ€§ server.context-parameters.* server.servlet.context-parameters.* server.context-path server.servlet.context-path server.jsp.class-name server.servlet.jsp.class-name server.jsp.init-parameters.* server.servlet.jsp.init-parameters.* server.jsp.registered server.servlet.jsp.registered server.servlet-path server.servlet.path Web Starter ä½œä¸ºä¼ é€’ä¾èµ–ä»¥å‰æœ‰å‡ ä¸ª Spring Boot starter æ˜¯ä¾èµ–äº Spring MVC è€Œä¼ é€’çš„spring-boot-starter-webã€‚åœ¨ Spring WebFlux æ–°çš„æ”¯æŒä¸‹ï¼Œspring-boot-starter-mustacheï¼Œspring-boot-starter-freemarkerå¹¶spring-boot-starter-thymeleafä¸å†ä¾èµ–å®ƒã€‚å¼€å‘è€…æœ‰è´£ä»»é€‰æ‹©å’Œæ·»åŠ spring-boot-starter-webæˆ–spring-boot-starter-webfluxã€‚ æ¨¡æ¿å¼•æ“Mustache æ¨¡æ¿æ›¾ç»çš„æ–‡ä»¶æ‰©å±•åæ˜¯.htmlï¼Œç°åœ¨çš„æ‰©å±•åä¸º .mustache ï¼Œä¸å®˜æ–¹è§„èŒƒå’Œå¤§å¤šæ•° IDE æ’ä»¶ä¸€è‡´ã€‚æ‚¨å¯ä»¥é€šè¿‡æ›´æ”¹spring.mustache.suffixé…ç½®é”®æ¥è¦†ç›–æ­¤æ–°çš„é»˜è®¤å€¼ã€‚ Jackson / JSON æ”¯æŒåœ¨ 2.0 ä¸­ï¼Œæˆ‘ä»¬æ”¹å˜äº† Jackson é…ç½®çš„é»˜è®¤å€¼ï¼Œå°† ISO-8601 å­—ç¬¦ä¸² å†™ä¸º JSR-310 æ—¥æœŸ ã€‚å¦‚æœä½ æƒ³å›åˆ°ä»¥å‰çš„è¡Œä¸ºï¼Œä½ å¯ä»¥æ·»åŠ spring.jackson.serialization.write-dates-as-timestamps=trueåˆ°ä½ çš„é…ç½®ã€‚ æ–°çš„spring-boot-starter-json starter æ”¶é›†äº†å¿…è¦çš„ä½å»è¯»å†™ JSONã€‚å®ƒä¸ä»…æä¾›äº†jackson-databindï¼Œè€Œä¸”æä¾›äº†å’Œ Java8 ä¸€èµ·è¿ä½œçš„æ—¶å€™ç›¸å½“æœ‰ç”¨çš„ç»„ä»¶ï¼šjackson-datatype-jdk8, jackson-datatype-jsr310 å’Œ jackson-module-parameter-namesã€‚å¦‚æœä½ æ›¾ç»æ‰‹åŠ¨åœ°ä¾èµ–è¿™äº›ç»„ä»¶ï¼Œç°åœ¨å¯ä»¥ä¾èµ–è¿™ä¸ªæ–°çš„ starter å–ä»£ã€‚ Spring MVC è·¯å¾„åŒ¹é…é»˜è®¤è¡Œä¸ºæ›´æ”¹æˆ‘ä»¬å·²å†³å®šåœ¨ Spring MVC åº”ç”¨ç¨‹åºä¸­æ›´æ”¹åç¼€è·¯å¾„åŒ¹é…çš„é»˜è®¤å€¼ï¼ˆè¯·å‚é˜…ï¼ƒ11105ï¼‰ã€‚æŒ‰ç…§ Spring Framework ä¸­è®°å½•çš„æœ€ä½³å®è·µï¼Œæ­¤åŠŸèƒ½ä¸å†é»˜è®¤å¯ç”¨ã€‚ å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºå¸Œæœ›å°†è¯·æ±‚&quot;GET /projects/spring-boot.json&quot;æ˜ å°„åˆ°@GetMapping(&quot;/projects/spring-boot&quot;)æ˜ å°„ï¼Œåˆ™æ­¤æ›´æ”¹ä¼šå½±å“æ‚¨ã€‚ æœ‰å…³æ­¤æ›´å¤šä¿¡æ¯ä»¥åŠå¦‚ä½•å‡è½»æ­¤æ›´æ”¹ï¼Œè¯·æŸ¥é˜…Spring Bootä¸­æœ‰å…³è·¯å¾„åŒ¹é…å’Œå†…å®¹åå•†çš„å‚è€ƒæ–‡æ¡£ã€‚ Servlet è¿‡æ»¤å™¨Servlet è¿‡æ»¤å™¨çš„é»˜è®¤è°ƒåº¦ç¨‹åºç±»å‹ç°åœ¨æ˜¯DipatcherType.REQUEST; è¿™ä½¿ Spring Boot çš„é»˜è®¤å€¼ä¸ Servlet è§„èŒƒçš„é»˜è®¤å€¼ä¸€è‡´ã€‚å¦‚æœæ‚¨å¸Œæœ›å°†è¿‡æ»¤å™¨æ˜ å°„åˆ°å…¶ä»–è°ƒåº¦ç¨‹åºç±»å‹ï¼Œè¯·ä½¿ç”¨FilterRegistrationBeanæ³¨å†Œæ‚¨çš„è¿‡æ»¤å™¨ã€‚ æ³¨æ„ï¼šSpring Security å’Œ Spring Session è¿‡æ»¤å™¨é…ç½® ASYNC, ERRORä»¥åŠ REQUEST è°ƒåº¦ç±»å‹ã€‚ RestTemplateBuilderè¯¥requestFactory(ClientHttpRequestFactory)æ–¹æ³•å·²è¢«æ–°requestFactory(Supplier&lt;ClientHttpRequestFactory&gt; requestFactorySupplier)æ–¹æ³•æ‰€å–ä»£ã€‚Supplierå…è®¸æ„å»ºå™¨ç”Ÿæˆçš„æ¯ä¸ªæ¨¡æ¿ä½¿ç”¨å®ƒè‡ªå·±çš„è¯·æ±‚å·¥å‚ï¼Œä»è€Œé¿å…å…±äº«å·¥å‚å¯èƒ½å¯¼è‡´çš„å‰¯ä½œç”¨ã€‚è§ï¼ƒ11255ã€‚ WebJars å®šä½å™¨Spring Boot 1.x ä½¿ç”¨å¹¶æä¾›ä¾èµ–å…³ç³»ç®¡ç†org.webjars:webjars-locatorã€‚webjars-locatoræ˜¯ä¸€ä¸ªâ€œå‘½åä¸ä½³çš„åº“â€¦â€¦åŒ…è£…webjars-locator-coreé¡¹ç›®â€ã€‚org.webjars:webjars-locatoråº”è¯¥æ›´æ–°ä¾èµ–é¡¹æ¥org.webjars:webjars-locator-coreä»£æ›¿ä½¿ç”¨ã€‚ SecuritySpring Boot 2 æå¤§åœ°ç®€åŒ–äº†é»˜è®¤çš„å®‰å…¨é…ç½®ï¼Œå¹¶ä½¿æ·»åŠ å®šåˆ¶å®‰å…¨å˜å¾—ç®€å•ã€‚Spring Boot ç°åœ¨å…·æœ‰ä¸€ç§è¡Œä¸ºï¼Œåªè¦æ‚¨æ·»åŠ è‡ªå·±çš„ WebSecurityConfigurerAdapter å°±ä¼šé€€å‡ºï¼Œè€Œä¸æ˜¯è¿›è¡Œå¤šç§ä¸å®‰å…¨æ€§ç›¸å…³çš„è‡ªåŠ¨é…ç½®ã€‚ å¦‚æœæ‚¨ä½¿ç”¨ä»¥ä¸‹ä»»ä½•å±æ€§ï¼Œåˆ™ä¼šå—åˆ°å½±å“ï¼š 123456789101112131415security.basic.authorize-modesecurity.basic.enabledsecurity.basic.pathsecurity.basic.realmsecurity.enable-csrfsecurity.headers.cachesecurity.headers.content-security-policysecurity.headers.content-security-policy-modesecurity.headers.content-typesecurity.headers.framesecurity.headers.hstssecurity.headers.xsssecurity.ignoredsecurity.require-sslsecurity.sessions é»˜è®¤å®‰å…¨å®‰å…¨è‡ªåŠ¨é…ç½®ä¸å†å…¬å¼€é€‰é¡¹ï¼Œå¹¶å°½å¯èƒ½ä½¿ç”¨ Spring Security é»˜è®¤å€¼ã€‚ä¸€ä¸ªæ˜æ˜¾çš„å‰¯ä½œç”¨æ˜¯ä½¿ç”¨ Spring Security çš„å†…å®¹åå•†è¿›è¡Œæˆæƒï¼ˆè¡¨å•ç™»å½•ï¼‰ã€‚ é»˜è®¤ç”¨æˆ·é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring Boot ä½¿ç”¨ç”Ÿæˆçš„å¯†ç é…ç½®å•ä¸ªç”¨æˆ·ã€‚ç”¨æˆ·å¯ä»¥ä½¿ç”¨ spring.security.user.* å±æ€§è¿›è¡Œé…ç½®ã€‚è¦è¿›ä¸€æ­¥å®šåˆ¶ç”¨æˆ·æˆ–æ·»åŠ å…¶ä»–ç”¨æˆ·ï¼Œæ‚¨å°†ä¸å¾—ä¸å…¬å¼€ä¸€ä¸ªUserDetailsServicebeanã€‚ AuthenticationManager Beanå¦‚æœæ‚¨æƒ³å°† Spring Security AuthenticationManagerä½œä¸º bean å…¬å¼€ï¼Œè¯·è¦†ç›–authenticationManagerBeanæ‚¨çš„æ–¹æ³•WebSecurityConfigurerAdapterå¹¶ä¸ºå…¶æ·»åŠ æ³¨é‡Š@Beanã€‚ OAuth2ä»åŠŸèƒ½çš„ Spring Security OAuth é¡¹ç›® è¿ç§»åˆ°æ ¸å¿ƒ Spring Securityã€‚ä¸å†ä¸ºä¾èµ–å…³ç³»æä¾›ä¾èµ–ç®¡ç†ï¼ŒSpring Boot 2 é€šè¿‡ Spring Security 5 æä¾› OAuth 2.0 å®¢æˆ·ç«¯æ”¯æŒã€‚ å¦‚æœæ‚¨ä¾èµ–å°šæœªè¿ç§»çš„ Spring Security OAuth åŠŸèƒ½ï¼Œåˆ™éœ€è¦åœ¨å…¶ä»– jar ä¸Šæ·»åŠ ä¾èµ–é¡¹ï¼Œè¯·æŸ¥çœ‹æ–‡æ¡£ä»¥è·å–æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚æˆ‘ä»¬è¿˜ç»§ç»­æ”¯æŒ Spring Boot 1.5ï¼Œä»¥ä¾¿æ—§ç‰ˆåº”ç”¨ç¨‹åºå¯ä»¥ç»§ç»­ä½¿ç”¨å®ƒï¼Œç›´åˆ°æä¾›å‡çº§è·¯å¾„ã€‚ æ‰§è¡Œå™¨å®‰å…¨æ‰§è¡Œå™¨ä¸å†æœ‰å•ç‹¬çš„å®‰å…¨è‡ªåŠ¨é…ç½®ï¼ˆmanagement.security.*å±æ€§æ¶ˆå¤±ï¼‰ã€‚sensitiveæ¯ä¸ªç«¯ç‚¹çš„æ ‡å¿—ä¹Ÿæ²¡æœ‰åœ¨å®‰å…¨é…ç½®ä¸­å˜å¾—æ›´åŠ æ˜ç¡®ã€‚å¦‚æœæ‚¨ä¾èµ–äºæ­¤è¡Œä¸ºï¼Œåˆ™éœ€è¦åˆ›å»ºæˆ–è°ƒæ•´æ‚¨çš„å®‰å…¨é…ç½®ï¼Œä»¥ä¿æŠ¤æ‚¨é€‰æ‹©è§’è‰²çš„ç«¯ç‚¹ã€‚ ä¾‹å¦‚ï¼Œå‡è®¾ä»¥ä¸‹é…ç½®ï¼š 123endpoints.flyway.sensitive=falseendpoints.info.sensitive=truemanagement.security.roles=MY_ADMIN 12345http .authorizeRequests() .requestMatchers(EndpointRequest.to(\"health\", \"flyway\")).permitAll() .requestMatchers(EndpointRequest.toAnyEndpoint()).hasRole(\"MY_ADMIN\") ... éœ€è¦æ³¨æ„çš„æ˜¯åœ¨2.xï¼Œhealthå’Œinfoåœ¨é»˜è®¤æƒ…å†µä¸‹å¯ç”¨ï¼ˆä¸healthé»˜è®¤æƒ…å†µä¸‹ä¸æ˜¾ç¤ºå…¶ç»†èŠ‚ï¼‰ã€‚ä¸ºäº†ä¸è¿™äº›æ–°çš„é»˜è®¤å€¼ä¸€è‡´ï¼Œhealthå·²è¢«æ·»åŠ åˆ°ç¬¬ä¸€ä¸ªåŒ¹é…å™¨ã€‚ ä½¿ç”¨ SQL æ•°æ®åº“é…ç½®æ•°æ®æºé»˜è®¤è¿æ¥æ± å·²ä» Tomcat åˆ‡æ¢åˆ° HikariCPã€‚å¦‚æœæ‚¨è¿‡å»spring.datasource.typeåœ¨åŸºäº Tomcat çš„åº”ç”¨ç¨‹åºä¸­å¼ºåˆ¶ä½¿ç”¨ Hikariï¼Œç°åœ¨å¯ä»¥åˆ é™¤é‡å†™ã€‚ ç‰¹åˆ«æ˜¯ï¼Œå¦‚æœä½ æœ‰è¿™æ ·çš„è®¾ç½®ï¼š 123456789101112131415&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt; &lt;artifactId&gt;tomcat-jdbc&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;com.zaxxer&lt;/groupId&gt; &lt;artifactId&gt;HikariCP&lt;/artifactId&gt;&lt;/dependency&gt; ç°åœ¨å¯ä»¥è¿™æ ·ä¿®æ”¹ï¼š 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;&lt;/dependency&gt; WARN æ¶ˆæ¯éšå«çš„â€™æ‰“å¼€åœ¨è§†å›¾â€™ä»ç°åœ¨èµ·ï¼Œæœªæ˜ç¡®å¯ç”¨çš„åº”ç”¨ç¨‹åºspring.jpa.open-in-viewå°†åœ¨å¯åŠ¨è¿‡ç¨‹ä¸­æ”¶åˆ°è­¦å‘Šæ¶ˆæ¯ã€‚è™½ç„¶è¿™ç§è¡Œä¸ºæ˜¯ä¸€ç§å‹å¥½çš„é»˜è®¤è¡Œä¸ºï¼Œä½†å¦‚æœæ‚¨æ²¡æœ‰å®Œå…¨æ„è¯†åˆ°ä¸ºæ‚¨åšäº†ä»€ä¹ˆï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´é—®é¢˜ã€‚æ­¤æ¶ˆæ¯å¯ç¡®ä¿æ‚¨äº†è§£å¯åœ¨æŸ¥çœ‹å‘ˆç°æœŸé—´æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢ã€‚å¦‚æœä½ æ²¡æœ‰é—®é¢˜ï¼Œä½ å¯ä»¥æ˜ç¡®åœ°é…ç½®è¿™ä¸ªå±æ€§æ¥æ¶ˆé™¤è­¦å‘Šä¿¡æ¯ã€‚ JPA å’Œ Spring Dataåœ¨ Spring Boot 1.x ä¸­ï¼Œä¸€äº›ç”¨æˆ·æ­£åœ¨æ‰©å±•HibernateJpaAutoConfigurationä»¥å°†é«˜çº§è‡ªå®šä¹‰åº”ç”¨äºè‡ªåŠ¨é…ç½®EntityManagerFactoryã€‚ä¸ºäº†é˜²æ­¢å‘ç”Ÿè¿™ç§é”™è¯¯çš„ç”¨ä¾‹ï¼ŒSpring Boot 2 ä¸­ä¸å†å¯èƒ½æ‰©å±•å®ƒã€‚ ä¸ºäº†æ”¯æŒè¿™äº›ç”¨ä¾‹ï¼Œç°åœ¨å¯ä»¥å®šä¹‰ä¸€ä¸ªHibernatePropertiesCustomizerbeanï¼Œå®ƒå¯ä»¥å®Œå…¨æ§åˆ¶ Hibernate å±æ€§ï¼ŒåŒ…æ‹¬æ³¨å†Œåœ¨ä¸Šä¸‹æ–‡ä¸­å£°æ˜ä¸º bean çš„ Hibernate æ‹¦æˆªå™¨çš„èƒ½åŠ›ã€‚ FlywayFlyway é…ç½®é”®è¢«ç§»åŠ¨åˆ°springå‘½åç©ºé—´ï¼ˆå³spring.flywayï¼‰ å‡çº§åˆ° Spring Boot 2 å°†ä¼šå°† Flyway å‡çº§3.xåˆ°5.xã€‚ä¸ºç¡®ä¿æ¨¡å¼å‡çº§é¡ºåˆ©è¿›è¡Œï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹è¯´æ˜æ“ä½œï¼š é¦–å…ˆå°†æ‚¨çš„1.5.xSpring Boot åº”ç”¨ç¨‹åºå‡çº§åˆ° Flyway 4ï¼Œè¯·å‚é˜…Mavenå’ŒGradleçš„è¯´æ˜ã€‚ ä¸€æ—¦æ‚¨çš„æ¶æ„å‡çº§åˆ°äº† Flyway 4ï¼Œå‡çº§åˆ° Spring Boot 2 å¹¶å†æ¬¡è¿è¡Œè¿ç§»ä»¥å°†æ‚¨çš„åº”ç”¨ç¨‹åºç§»æ¤åˆ° Flyway 5ã€‚ LiquibaseLiquibase é…ç½®é”®è¢«ç§»åŠ¨åˆ°springå‘½åç©ºé—´ï¼ˆå³spring.liquibaseï¼‰ æ•°æ®åº“åˆå§‹åŒ–åŸºæœ¬DataSourceåˆå§‹åŒ–ç°åœ¨ä»…é’ˆå¯¹åµŒå…¥å¼æ•°æ®æºå¯ç”¨ï¼Œå¹¶å°†åœ¨æ‚¨ä½¿ç”¨ç”Ÿäº§æ•°æ®åº“æ—¶ç«‹å³å…³é—­ã€‚æ–°çš„spring.datasource.initialization-modeï¼ˆæ›¿æ¢spring.datasource.initializeï¼‰æä¾›æ›´å¤šçš„æ§åˆ¶ã€‚ æ›´æ–°é»˜è®¤çš„â€™åˆ›å»º - åˆ é™¤â€™å¤„ç†spring.jpa.hibernate.ddl-auto å±æ€§é»˜è®¤ä¸ºåªæœ‰åœ¨æ²¡æœ‰ä½¿ç”¨ Liquibase æˆ– Flyway ç­‰æ¨¡å¼ç®¡ç†å™¨æ—¶æ‰ä½¿ç”¨åµŒå…¥å¼æ•°æ®åº“è¿›è¡Œåˆ›å»ºã€‚ä¸€æ—¦æ£€æµ‹åˆ°æ¨¡å¼ç®¡ç†å™¨ï¼Œé»˜è®¤æ›´æ”¹ä¸º noneã€‚ æ•´åˆ NoSQLRedisç°åœ¨ä½¿ç”¨çš„æ˜¯ Lettuce è€Œä¸æ˜¯ Jedis ä½œä¸º Redis é©±åŠ¨ç¨‹åºspring-boot-starter-redisã€‚å¦‚æœæ‚¨ä½¿ç”¨æ›´é«˜çº§åˆ«çš„Spring Data æ„é€ ï¼Œåˆ™åº”è¯¥å‘ç°å˜åŒ–æ˜¯é€æ˜çš„ã€‚æˆ‘ä»¬ä»ç„¶æ”¯æŒ Jedisï¼Œå¦‚æœæ‚¨æ„¿æ„ï¼Œé€šè¿‡æ’é™¤ io.lettuceï¼šlettuce-coreå¹¶æ·»åŠ  redis.clientsï¼šjedisï¼Œåˆ™å¯ä»¥è‡ªç”±åˆ‡æ¢ä¾èµ–é¡¹ã€‚ ElasticsearchElasticsearch å·²ç»å‡çº§åˆ° 6.0+ã€‚ä¸ Elastic å®£å¸ƒåµŒå…¥å¼ Elasticsearch ä¸å†å—æ”¯æŒä¸€è‡´ï¼Œè‡ªåŠ¨é…ç½®NodeClientå·²è¢«åˆ é™¤ã€‚TransportClientå¯ä»¥é€šè¿‡ä½¿ç”¨spring.data.elasticsearch.cluster-nodesæä¾›è¦è¿æ¥çš„ä¸€ä¸ªæˆ–å¤šä¸ªèŠ‚ç‚¹çš„åœ°å€æ¥è‡ªåŠ¨é…ç½®ã€‚ é«˜é€Ÿç¼“å­˜ç”¨äºç¼“å­˜çš„ä¸“ç”¨ Hazelcast è‡ªåŠ¨é…ç½®ã€‚ æ— æ³•è‡ªåŠ¨é…ç½®å¸¸è§„HazelcastInstanceå’Œä¸“ç”¨HazelcastInstanceç¼“å­˜ã€‚å› æ­¤ï¼Œè¯¥spring.cache.hazelcast.configå±æ€§å·²ä¸å†å¯ç”¨ã€‚ æ‰¹é‡åœ¨å¯åŠ¨æ—¶æ‰§è¡Œæ‰¹å¤„ç†ä½œä¸šçš„ CommandLineRunner çš„é¡ºåºä¸º 0ã€‚ æµ‹è¯•Mockito 1.xMockito 1.x ä¸å†æ”¯æŒ@MockBeanå’Œ@SpyBeanã€‚å¦‚æœä½ ä¸ç”¨spring-boot-starter-testæ¥ç®¡ç†ä½ çš„ä¾èµ–å…³ç³»ï¼Œä½ åº”è¯¥å‡çº§åˆ° Mockito 2.x. Spring Boot ActuatorSpring Boot 2 ä¸º Actuator å¸¦æ¥äº†é‡è¦å˜åŒ–ï¼Œæ— è®ºæ˜¯å†…éƒ¨è¿˜æ˜¯é¢å‘ç”¨æˆ·ï¼Œè¯·æŸ¥é˜…å‚è€ƒæŒ‡å—ä¸­çš„æ›´æ–°éƒ¨åˆ†å’Œæ–°çš„Actuator APIæ–‡æ¡£ã€‚ æ‚¨åº”è¯¥æœŸæœ›ç¼–ç¨‹æ¨¡å‹ï¼Œé…ç½®å¯†é’¥å’ŒæŸäº›ç«¯ç‚¹çš„å“åº”æ ¼å¼å‘ç”Ÿå˜åŒ–ã€‚Actuator ç°åœ¨åœ¨ Spring MVCï¼ŒSpring WebFlux å’ŒJersey ä¸Šå¾—åˆ°æœ¬åœ°æ”¯æŒã€‚ æ„å»ºActuator çš„ä»£ç åˆ†ä¸ºä¸¤ä¸ªæ¨¡å—ï¼šç°æœ‰çš„spring-boot-actuatorå’Œæ–°çš„spring-boot-actuator-autoconfigureã€‚å¦‚æœæ‚¨ä½¿ç”¨åŸå§‹æ¨¡å—ï¼ˆspring-boot-actuatorï¼‰å¯¼å…¥ actuatorï¼Œè¯·è€ƒè™‘ä½¿ç”¨spring-boot-starter-actuatorå¯åŠ¨å™¨æ›¿ä»£å®ƒã€‚ Keys çš„é…ç½®ç»“æ„Endpoints åŸºç¡€é…ç½® key å·²ç»ç»Ÿä¸€ï¼š æ—§çš„å±æ€§ æ–°çš„å±æ€§ endpoints.&lt;id&gt;.* management.endpoint.&lt;id&gt;.* endpoints.cors.* management.endpoints.web.cors.* endpoints.jmx.* management.endpoints.jmx.* management.address management.server.address management.context-path management.server.servlet.context-path management.ssl.* management.server.ssl.* management.port management.server.port åŸºæœ¬è·¯å¾„æ‰€æœ‰ endpoints é»˜è®¤æƒ…å†µä¸‹éƒ½å·²ç§»è‡³ /actuatorã€‚ æˆ‘ä»¬ä¿®æ”¹äº† management.server.servlet.context-path çš„å«ä¹‰ï¼šå®ƒç°åœ¨æ˜¯ server.servlet.context-path çš„ç«¯ç‚¹ç®¡ç†çš„ç­‰ä»·æ›¿ä»£ï¼ˆåªæœ‰åœ¨è®¾ç½®äº† management.server.port æ—¶æ‰æœ‰æ•ˆï¼‰ã€‚å¦å¤–ï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨æ–°çš„å•ç‹¬å±æ€§ management.endpoints.web.base-path ä¸ºç®¡ç†ç«¯ç‚¹è®¾ç½®åŸºæœ¬è·¯å¾„ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœä½ è®¾ç½®management.server.servlet.context-path=/managementå’Œmanagement.endpoints.web.base-path=/applicationï¼Œä½ å°±å¯ä»¥åœ¨ä¸‹é¢çš„è·¯å¾„åˆ°è¾¾ç»ˆç‚¹å¥åº·ï¼š/management/application/healthã€‚ å¦‚æœä½ æƒ³æ¢å¤ 1.x çš„è¡Œä¸ºï¼ˆå³å…·æœ‰/healthä»£æ›¿/actuator/healthï¼‰ï¼Œè®¾ç½®ä»¥ä¸‹å±æ€§ï¼š 1management.endpoints.web.base-path=/ å®¡è®¡äº‹ä»¶ API æ›´æ”¹AuditEventRepository ç°åœ¨æœ‰ä¸€ä¸ªåŒ…å«æ‰€æœ‰å¯é€‰å‚æ•°çš„å•ä¸€æ–¹æ³•ã€‚ Endpointsè¦é€šè¿‡ HTTP ä½¿æ‰§è¡Œå™¨ç«¯ç‚¹å¯ç”¨ï¼Œå®ƒéœ€è¦åŒæ—¶å¯ç”¨å’Œå…¬å¼€ã€‚é»˜è®¤ï¼š æ— è®ºæ‚¨çš„åº”ç”¨ç¨‹åºä¸­æ˜¯å¦å­˜åœ¨å’Œé…ç½® Spring Securityï¼Œåªæœ‰ç«¯ç‚¹/healthå’Œ/infoç«¯ç‚¹éƒ½æ˜¯æš´éœ²çš„ã€‚ æ‰€æœ‰ç«¯ç‚¹ï¼Œä½†/shutdownå·²å¯ç”¨ã€‚ æ‚¨å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼å…¬å¼€æ‰€æœ‰ç«¯ç‚¹ï¼š 1management.endpoints.web.exposure.include=* æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æ˜¾å¼å¯ç”¨/shutdownç«¯ç‚¹ï¼š 1management.endpoint.shutdown.enabled=true è¦å…¬å¼€æ‰€æœ‰ï¼ˆå·²å¯ç”¨ï¼‰ç½‘ç»œç«¯ç‚¹é™¤envç«¯ç‚¹ä¹‹å¤–ï¼š 12management.endpoints.web.exposure.include=*management.endpoints.web.exposure.exclude=env Endpoint changes 1.x ç«¯ç‚¹ 2.0 ç«¯ç‚¹ï¼ˆæ”¹å˜ï¼‰ /actuator ä¸å†å¯ç”¨ã€‚ ä½†æ˜¯ï¼Œåœ¨ management.endpoints.web.base-path çš„æ ¹ç›®å½•ä¸­æœ‰ä¸€ä¸ªæ˜ å°„ï¼Œå®ƒæä¾›äº†åˆ°æ‰€æœ‰æš´éœ²ç«¯ç‚¹çš„é“¾æ¥ã€‚ /auditevents è¯¥afterå‚æ•°ä¸å†éœ€è¦ /autoconfig é‡å‘½åä¸º /conditions /docs ä¸å†å¯ç”¨ /health ç°åœ¨æœ‰ä¸€ä¸ª management.endpoint.health.show-details é€‰é¡¹ never, always, when-authenticatedï¼Œè€Œä¸æ˜¯ä¾é  sensitive æ ‡å¿—æ¥ç¡®å®š health ç«¯ç‚¹æ˜¯å¦å¿…é¡»æ˜¾ç¤ºå…¨éƒ¨ç»†èŠ‚ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œ/actuator/healthå…¬å¼€å¹¶ä¸”ä¸æ˜¾ç¤ºç»†èŠ‚ã€‚ /trace é‡å‘½åä¸º /httptrace ç«¯ç‚¹å±æ€§å·²æ›´æ”¹å¦‚ä¸‹ï¼š endpoints.&lt;id&gt;.enabled å·²ç»è½¬ç§»åˆ°äº† management.endpoint.&lt;id&gt;.enabled endpoints.&lt;id&gt;.id æ²¡æœ‰æ›¿æ¢ï¼ˆç«¯ç‚¹çš„ ID ä¸å†å¯é…ç½®ï¼‰ endpoints.&lt;id&gt;.sensitiveæ²¡æœ‰æ›¿ä»£å“ï¼ˆè¯·å‚è§æ‰§è¡Œå™¨å®‰å…¨ï¼‰ endpoints.&lt;id&gt;.path å·²ç»è½¬ç§»åˆ°äº† management.endpoints.web.path-mapping.&lt;id&gt; ç«¯ç‚¹æ ¼å¼/actuator/mappings ç«¯ç‚¹å¤§æ”¹å˜JSON æ ¼å¼å·²ç»æ›´æ”¹ä¸ºç°åœ¨æ­£ç¡®åœ°åŒ…å«æœ‰å…³ä¸Šä¸‹æ–‡å±‚æ¬¡ç»“æ„ï¼Œå¤šä¸ªDispatcherServletsï¼Œéƒ¨ç½²çš„ Servlet å’Œ Servlet è¿‡æ»¤å™¨çš„ä¿¡æ¯ã€‚è¯¦æƒ…è¯·å‚é˜…ï¼ƒ9979ã€‚ Actuator API æ–‡æ¡£çš„ç›¸å…³éƒ¨åˆ†æä¾›äº†ä¸€ä¸ªç¤ºä¾‹æ–‡æ¡£ã€‚ /actuator/httptrace ç«¯ç‚¹å¤§æ”¹å˜å“åº”çš„ç»“æ„å·²ç»è¿‡æ”¹è¿›ï¼Œä»¥åæ˜ ç«¯ç‚¹å…³æ³¨è·Ÿè¸ª HTTP è¯·æ±‚ - å“åº”äº¤æ¢çš„æƒ…å†µã€‚ è¿ç§»è‡ªå®šä¹‰ç«¯ç‚¹å¦‚æœæ‚¨æœ‰è‡ªå®šä¹‰æ‰§è¡Œå™¨ç«¯ç‚¹ï¼Œè¯·æŸ¥çœ‹ä¸“ç”¨åšå®¢æ–‡ç« ã€‚è¯¥å›¢é˜Ÿè¿˜æ’°å†™äº†ä¸€ä¸ª wiki é¡µé¢ï¼Œä»‹ç»å¦‚ä½•å°†ç°æœ‰çš„æ‰§è¡Œå™¨ç«¯ç‚¹è¿ç§»åˆ°æ–°çš„åŸºç¡€æ¶æ„ã€‚ MetricsSpring Boot è‡ªå·±çš„æŒ‡æ ‡å·²è¢«æ”¯æŒå–ä»£ï¼ŒåŒ…æ‹¬è‡ªåŠ¨é…ç½®ï¼Œç”¨äº icrometer å’Œ dimensional æŒ‡æ ‡ã€‚ è®¾ç½® icrometerå¦‚æœæ‚¨çš„ Spring Boot 2.0 åº”ç”¨ç¨‹åºå·²ä¾èµ–äº Actuatorï¼Œåˆ™ icrometer å·²åœ¨æ­¤å¤„å¹¶è‡ªåŠ¨é…ç½®ã€‚å¦‚æœæ‚¨å¸Œæœ›å°†åº¦é‡æ ‡å‡†å¯¼å‡ºåˆ° Prometheusï¼ŒAtlas æˆ– Datadog ç­‰å¤–éƒ¨æ³¨å†Œè¡¨ï¼ŒMicrometer å°†ä¸ºè®¸å¤šæ³¨å†Œè¡¨æä¾›ä¾èµ–å…³ç³»; æ‚¨å¯ä»¥ä½¿ç”¨spring.metrics.*å±æ€§é…ç½®æ‚¨çš„åº”ç”¨ç¨‹åºä»¥å¯¼å‡ºåˆ°ç‰¹å®šçš„æ³¨å†Œè¡¨ã€‚ è¿ç§»å®šåˆ¶è®¡æ•°å™¨/é‡è¡¨æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼åˆ›å»ºå„ç§æŒ‡æ ‡ï¼Œè€Œä¸æ˜¯åœ¨åº”ç”¨ç¨‹åºä»£ç ä¸­æ³¨å…¥CounterServiceæˆ–GaugeServiceçš„å®ä¾‹ï¼š æ³¨å…¥MeterRegistryå’Œè°ƒç”¨æ–¹æ³•ã€‚ ç›´æ¥è°ƒç”¨é™æ€æ–¹æ³•Counter featureCounter = Metrics.counter(&quot;feature&quot;);ã€‚ å¼€å‘è€…å·¥å…·çƒ­æ‹”æ’ç”±äº Spring Loaded é¡¹ç›®è¢«æç½®ï¼Œå®ƒåœ¨ Spring Boot çš„æ”¯æŒå·²è¢«åˆ é™¤ã€‚æˆ‘ä»¬å»ºè®®ä½¿ç”¨ Devtoolsã€‚ Devtools è¿œç¨‹è°ƒè¯•éš§é“å·²ç»ä» Devtools ä¸­åˆ é™¤äº†å¯¹é€šè¿‡ HTTP è¿›è¡Œéš§é“è¿œç¨‹è°ƒè¯•çš„æ”¯æŒã€‚ å·²åˆ é™¤çš„åŠŸèƒ½ä»¥ä¸‹åŠŸèƒ½ä¸å†å¯ç”¨ï¼š CRaSH æ”¯æŒ Spring Mobile çš„è‡ªåŠ¨é…ç½®å’Œä¾èµ–å…³ç³»ç®¡ç†ã€‚ Spring Social çš„è‡ªåŠ¨é…ç½®å’Œä¾èµ–å…³ç³»ç®¡ç†ã€‚ ä¾èµ–å…³ç³»ç®¡ç†commons-digesterã€‚ ä¾èµ–ç‰ˆæœ¬ä»¥ä¸‹åº“çš„æœ€ä½æ”¯æŒç‰ˆæœ¬å·²æ›´æ”¹ï¼š Elasticsearch 5.6 Gradle 4 Hibernate 5.2 Jetty 9.4 Spring Framework 5 Spring Security 5 Tomcat 8.5 å‚è€ƒèµ„æ–™https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-2.0-Migration-Guide ç›¸å…³æ–‡ç« 1ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (ä¸€)ï¼šSpring Boot 2.0 è¿ç§»æŒ‡å— 2ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (äºŒ)ï¼šSpring Boot 2.0 æ–°ç‰¹æ€§è¯¦è§£ 3ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (ä¸‰)ï¼šSpring Boot 2.0 é…ç½®æ”¹å˜ 4ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (å››)ï¼šSpring Boot 2.0 æºç é˜…è¯»ç¯å¢ƒæ­å»º 5ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (äº”)ï¼šSpring Boot 2.0 é¡¹ç›®æºç ç»“æ„é¢„è§ˆ 6ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (å…­)ï¼šSpring boot 2.0 ä¸­ SpringBootApplication æ³¨è§£è¯¦è§£ 7ã€Spring Boot 2.0ç³»åˆ—æ–‡ç« (ä¸ƒ)ï¼šSpringApplication æ·±å…¥æ¢ç´¢","tags":[{"name":"Java","slug":"Java","permalink":"http://www.54tianzhisheng.cn/tags/Java/"},{"name":"SpringBoot","slug":"SpringBoot","permalink":"http://www.54tianzhisheng.cn/tags/SpringBoot/"}]},{"title":"ã€Šæ·±å…¥ç†è§£ Java å†…å­˜æ¨¡å‹ã€‹è¯»ä¹¦ç¬”è®°","date":"2018-02-27T16:00:00.000Z","path":"2018/02/28/Java-Memory-Model/","text":"å‰æã€Šæ·±å…¥ç†è§£ Java å†…å­˜æ¨¡å‹ã€‹ç¨‹æ™“æ˜è‘—ï¼Œè¯¥ä¹¦åœ¨ä»¥å‰çœ‹è¿‡ä¸€éï¼Œç°åœ¨å­¦çš„ä¸œè¥¿è¶Šå¤šï¼Œæ„Ÿè§‰é‚£å—è¶Šé‡è¦ï¼Œäºæ˜¯åˆå†ç»†çœ‹ä¸€éï¼Œäºæ˜¯ä¾¿æœ‰äº†ä¸‹é¢çš„è¯»ä¹¦ç¬”è®°æ€»ç»“ã€‚å…¨ä¹¦é¡µæ•°è™½ä¸å¤šï¼Œå†…å®¹è®²å¾—æŒºæ·±çš„ã€‚ç»†çœ‹çš„è¯ï¼Œä¹Ÿæ˜¯æŒºèŠ±æ—¶é—´çš„ï¼Œçœ‹å®Œæ”¶è·ç»å¯¹æŒºå¤§çš„ã€‚ä¹Ÿå»ºè®® Java å¼€å‘è€…éƒ½å»çœ‹çœ‹ã€‚é‡Œé¢ä¸»è¦æœ‰ Java å†…å­˜æ¨¡å‹çš„åŸºç¡€ã€é‡æ’åºã€é¡ºåºä¸€è‡´æ€§ã€Volatile å…³é”®å­—ã€é”ã€finalã€‚æœ¬æ–‡å‚è€ƒä¹¦ä¸­å†…å®¹ã€‚ å…³æ³¨æˆ‘å¦‚æœä½ æƒ³æŸ¥çœ‹è¿™æœ¬ä¹¦å¯ä»¥å…³æ³¨æˆ‘çš„å…¬ä¼—å·: zhisheng ï¼Œç„¶åé‡Œé¢å›å¤å…³é”®å­— JMM å¯ä»¥æŸ¥çœ‹æˆ‘åˆ†äº«çš„ç™¾åº¦äº‘é“¾æ¥ã€‚ è½¬è½½è¯·åŠ¡å¿…æ³¨æ˜åŸåˆ›åœ°å€ä¸ºï¼šhttp://www.54tianzhisheng.cn/2018/02/28/Java-Memory-Model/ åŸºç¡€å¹¶å‘ç¼–ç¨‹çš„æ¨¡å‹åˆ†ç±»åœ¨å¹¶å‘ç¼–ç¨‹éœ€è¦å¤„ç†çš„ä¸¤ä¸ªå…³é”®é—®é¢˜æ˜¯ï¼šçº¿ç¨‹ä¹‹é—´å¦‚ä½•é€šä¿¡ å’Œ çº¿ç¨‹ä¹‹é—´å¦‚ä½•åŒæ­¥ã€‚ é€šä¿¡é€šä¿¡ æ˜¯æŒ‡çº¿ç¨‹ä¹‹é—´ä»¥ä½•ç§æœºåˆ¶æ¥äº¤æ¢ä¿¡æ¯ã€‚åœ¨å‘½ä»¤å¼ç¼–ç¨‹ä¸­ï¼Œçº¿ç¨‹ä¹‹é—´çš„é€šä¿¡æœºåˆ¶æœ‰ä¸¤ç§ï¼šå…±äº«å†…å­˜ å’Œ æ¶ˆæ¯ä¼ é€’ã€‚ åœ¨å…±äº«å†…å­˜çš„å¹¶å‘æ¨¡å‹é‡Œï¼Œçº¿ç¨‹ä¹‹é—´å…±äº«ç¨‹åºçš„å…¬å…±çŠ¶æ€ï¼Œçº¿ç¨‹ä¹‹é—´é€šè¿‡å†™-è¯»å†…å­˜ä¸­çš„å…¬å…±çŠ¶æ€æ¥éšå¼è¿›è¡Œé€šä¿¡ã€‚ åœ¨æ¶ˆæ¯ä¼ é€’çš„å¹¶å‘æ¨¡å‹é‡Œï¼Œçº¿ç¨‹ä¹‹é—´æ²¡æœ‰å…¬å…±çŠ¶æ€ï¼Œçº¿ç¨‹ä¹‹é—´å¿…é¡»é€šè¿‡æ˜ç¡®çš„å‘é€æ¶ˆæ¯æ¥æ˜¾å¼è¿›è¡Œé€šä¿¡ã€‚ åŒæ­¥åŒæ­¥ æ˜¯æŒ‡ç¨‹åºç”¨äºæ§åˆ¶ä¸åŒçº¿ç¨‹ä¹‹é—´æ“ä½œå‘ç”Ÿç›¸å¯¹é¡ºåºçš„æœºåˆ¶ã€‚ åœ¨å…±äº«å†…å­˜çš„å¹¶å‘æ¨¡å‹é‡Œï¼ŒåŒæ­¥æ˜¯æ˜¾å¼è¿›è¡Œçš„ã€‚ç¨‹åºå‘˜å¿…é¡»æ˜¾å¼æŒ‡å®šæŸä¸ªæ–¹æ³•æˆ–æŸæ®µä»£ç éœ€è¦åœ¨çº¿ç¨‹ä¹‹é—´äº’æ–¥æ‰§è¡Œã€‚ åœ¨æ¶ˆæ¯ä¼ é€’çš„å¹¶å‘æ¨¡å‹é‡Œï¼Œç”±äºæ¶ˆæ¯çš„å‘é€å¿…é¡»åœ¨æ¶ˆæ¯çš„æ¥æ”¶ä¹‹å‰ï¼Œå› æ­¤åŒæ­¥æ˜¯éšå¼è¿›è¡Œçš„ã€‚ Java çš„å¹¶å‘é‡‡ç”¨çš„æ˜¯å…±äº«å†…å­˜æ¨¡å‹ï¼ŒJava çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡æ€»æ˜¯éšå¼è¿›è¡Œï¼Œæ•´ä¸ªé€šä¿¡è¿‡ç¨‹å¯¹ç¨‹åºå‘˜å®Œå…¨é€æ˜ã€‚ Java å†…å­˜æ¨¡å‹çš„æŠ½è±¡åœ¨ Java ä¸­ï¼Œæ‰€æœ‰å®ä¾‹åŸŸã€é™æ€åŸŸ å’Œ æ•°ç»„å…ƒç´ å­˜å‚¨åœ¨å †å†…å­˜ä¸­ï¼Œå †å†…å­˜åœ¨çº¿ç¨‹ä¹‹é—´å…±äº«ã€‚å±€éƒ¨å˜é‡ã€æ–¹æ³•å®šä¹‰å‚æ•° å’Œ å¼‚å¸¸å¤„ç†å™¨å‚æ•° ä¸ä¼šåœ¨çº¿ç¨‹ä¹‹é—´å…±äº«ï¼Œå®ƒä»¬ä¸ä¼šæœ‰å†…å­˜å¯è§æ€§é—®é¢˜ï¼Œä¹Ÿä¸å—å†…å­˜æ¨¡å‹çš„å½±å“ã€‚ Java çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡ç”± Java å†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰æ§åˆ¶ã€‚JMM å†³å®šäº†ä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„å†™å…¥ä½•æ—¶å¯¹å¦ä¸€ä¸ªçº¿ç¨‹å¯è§ã€‚ä»æŠ½è±¡çš„è§’åº¦æ¥çœ‹ï¼ŒJMM å®šä¹‰äº†çº¿ç¨‹ä¸ä¸»å†…å­˜ä¹‹é—´çš„æŠ½è±¡å…³ç³»ï¼šçº¿ç¨‹ä¹‹é—´çš„å…±äº«å˜é‡å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªè‡ªå·±ç§æœ‰çš„æœ¬åœ°å†…å­˜ï¼Œæœ¬åœ°å†…å­˜ä¸­å­˜å‚¨äº†è¯¥å˜é‡ä»¥è¯»ï¼å†™å…±äº«å˜é‡çš„å‰¯æœ¬ã€‚æœ¬åœ°å†…å­˜æ˜¯ JMM çš„ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼Œå¹¶ä¸çœŸå®å­˜åœ¨ã€‚ JMM æŠ½è±¡ç¤ºæ„å›¾ï¼š ä»ä¸Šå›¾æ¥çœ‹ï¼Œå¦‚æœçº¿ç¨‹ A å’Œçº¿ç¨‹ B è¦é€šä¿¡çš„è¯ï¼Œè¦å¦‚ä¸‹ä¸¤ä¸ªæ­¥éª¤ï¼š 1ã€çº¿ç¨‹ A éœ€è¦å°†æœ¬åœ°å†…å­˜ A ä¸­çš„å…±äº«å˜é‡å‰¯æœ¬åˆ·æ–°åˆ°ä¸»å†…å­˜å» 2ã€çº¿ç¨‹ B å»ä¸»å†…å­˜è¯»å–çº¿ç¨‹ A ä¹‹å‰å·²æ›´æ–°è¿‡çš„å…±äº«å˜é‡ æ­¥éª¤ç¤ºæ„å›¾ï¼š ä¸¾ä¸ªä¾‹å­ï¼š æœ¬åœ°å†…å­˜ A å’Œ B æœ‰ä¸»å†…å­˜å…±äº«å˜é‡ X çš„å‰¯æœ¬ã€‚å‡è®¾ä¸€å¼€å§‹æ—¶ï¼Œè¿™ä¸‰ä¸ªå†…å­˜ä¸­ X çš„å€¼éƒ½æ˜¯ 0ã€‚çº¿ç¨‹ A æ­£æ‰§è¡Œæ—¶ï¼ŒæŠŠæ›´æ–°åçš„ X å€¼ï¼ˆå‡è®¾ä¸º 1ï¼‰ä¸´æ—¶å­˜æ”¾åœ¨è‡ªå·±çš„æœ¬åœ°å†…å­˜ A ä¸­ã€‚å½“çº¿ç¨‹ A å’Œ B éœ€è¦é€šä¿¡æ—¶ï¼Œçº¿ç¨‹ A é¦–å…ˆä¼šæŠŠè‡ªå·±æœ¬åœ°å†…å­˜ A ä¸­ä¿®æ”¹åçš„ X å€¼åˆ·æ–°åˆ°ä¸»å†…å­˜å»ï¼Œæ­¤æ—¶ä¸»å†…å­˜ä¸­çš„ X å€¼å˜ä¸ºäº† 1ã€‚éšåï¼Œçº¿ç¨‹ B åˆ°ä¸»å†…å­˜ä¸­è¯»å–çº¿ç¨‹ A æ›´æ–°åçš„å…±äº«å˜é‡ X çš„å€¼ï¼Œæ­¤æ—¶çº¿ç¨‹ B çš„æœ¬åœ°å†…å­˜çš„ X å€¼ä¹Ÿå˜æˆäº† 1ã€‚ æ•´ä½“æ¥çœ‹ï¼Œè¿™ä¸¤ä¸ªæ­¥éª¤å®è´¨ä¸Šæ˜¯çº¿ç¨‹ A å†å‘çº¿ç¨‹ B å‘é€æ¶ˆæ¯ï¼Œè€Œè¿™ä¸ªé€šä¿¡è¿‡ç¨‹å¿…é¡»ç»è¿‡ä¸»å†…å­˜ã€‚JMM é€šè¿‡æ§åˆ¶ä¸»å†…å­˜ä¸æ¯ä¸ªçº¿ç¨‹çš„æœ¬åœ°å†…å­˜ä¹‹é—´çš„äº¤äº’ï¼Œæ¥ä¸º Java ç¨‹åºå‘˜æä¾›å†…å­˜å¯è§æ€§ä¿è¯ã€‚ é‡æ’åºåœ¨æ‰§è¡Œç¨‹åºæ—¶ä¸ºäº†æé«˜æ€§èƒ½ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¸¸å¸¸ä¼šå¯¹æŒ‡ä»¤åšé‡æ’åºã€‚é‡æ’åºåˆ†ä¸‰ç±»ï¼š 1ã€ç¼–è¯‘å™¨ä¼˜åŒ–çš„é‡æ’åºã€‚ç¼–è¯‘å™¨åœ¨ä¸æ”¹å˜å•çº¿ç¨‹ç¨‹åºè¯­ä¹‰çš„å‰æä¸‹ï¼Œå¯ä»¥é‡æ–°å®‰æ’è¯­å¥çš„æ‰§è¡Œé¡ºåºã€‚ 2ã€æŒ‡ä»¤çº§å¹¶è¡Œçš„é‡æ’åºã€‚ç°ä»£å¤„ç†å™¨é‡‡ç”¨äº†æŒ‡ä»¤çº§å¹¶è¡ŒæŠ€æœ¯æ¥å°†å¤šæ¡æŒ‡ä»¤é‡å æ‰§è¡Œã€‚å¦‚æœä¸å­˜åœ¨æ•°æ®ä¾èµ–æ€§ï¼Œå¤„ç†å™¨å¯ä»¥æ”¹å˜è¯­å¥å¯¹åº”æœºå™¨æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåºã€‚ 3ã€å†…å­˜ç³»ç»Ÿçš„é‡æ’åºã€‚ç”±äºå¤„ç†å™¨ä½¿ç”¨ç¼“å­˜å’Œè¯»ï¼å†™ç¼“å†²åŒºï¼Œè¿™ä½¿å¾—åŠ è½½å’Œå­˜å‚¨æ“ä½œçœ‹ä¸Šå»å¯èƒ½æ˜¯åœ¨ä¹±åºæ‰§è¡Œã€‚ ä» Java æºä»£ç åˆ°æœ€ç»ˆå®é™…æ‰§è¡Œçš„æŒ‡ä»¤åºåˆ—ï¼Œä¼šåˆ†åˆ«ç»å†ä¸‹é¢ä¸‰ç§é‡æ’åºï¼š ä¸Šé¢çš„è¿™äº›é‡æ’åºéƒ½å¯èƒ½å¯¼è‡´å¤šçº¿ç¨‹ç¨‹åºå‡ºç°å†…å­˜å¯è§æ€§é—®é¢˜ã€‚å¯¹äºç¼–è¯‘å™¨ï¼ŒJMM çš„ç¼–è¯‘å™¨é‡æ’åºè§„åˆ™ä¼šç¦æ­¢ç‰¹å®šç±»å‹çš„ç¼–è¯‘å™¨é‡æ’åºï¼ˆä¸æ˜¯æ‰€æœ‰çš„ç¼–è¯‘å™¨é‡æ’åºéƒ½è¦ç¦æ­¢ï¼‰ã€‚å¯¹äºå¤„ç†å™¨é‡æ’åºï¼ŒJMM çš„å¤„ç†å™¨é‡æ’åºè§„åˆ™ä¼šè¦æ±‚ Java ç¼–è¯‘å™¨åœ¨ç”ŸæˆæŒ‡ä»¤åºåˆ—æ—¶ï¼Œæ’å…¥ç‰¹å®šç±»å‹çš„å†…å­˜å±éšœæŒ‡ä»¤ï¼Œé€šè¿‡å†…å­˜å±éšœæŒ‡ä»¤æ¥ç¦æ­¢ç‰¹å®šç±»å‹çš„å¤„ç†å™¨é‡æ’åºï¼ˆä¸æ˜¯æ‰€æœ‰çš„å¤„ç†å™¨é‡æ’åºéƒ½è¦ç¦æ­¢ï¼‰ã€‚ JMM å±äºè¯­è¨€çº§çš„å†…å­˜æ¨¡å‹ï¼Œå®ƒç¡®ä¿åœ¨ä¸åŒçš„ç¼–è¯‘å™¨å’Œä¸åŒçš„å¤„ç†å™¨å¹³å°ä¹‹ä¸Šï¼Œé€šè¿‡ç¦æ­¢ç‰¹å®šç±»å‹çš„ç¼–è¯‘å™¨é‡æ’åºå’Œå¤„ç†å™¨é‡æ’åºï¼Œä¸ºç¨‹åºå‘˜æä¾›ä¸€è‡´çš„å†…å­˜å¯è§æ€§ä¿è¯ã€‚ å¤„ç†å™¨é‡æ’åºç°ä»£çš„å¤„ç†å™¨ä½¿ç”¨å†™ç¼“å†²åŒºæ¥ä¸´æ—¶ä¿å­˜å‘å†…å­˜å†™å…¥çš„æ•°æ®ã€‚å†™ç¼“å†²åŒºå¯ä»¥ä¿è¯æŒ‡ä»¤æµæ°´çº¿æŒç»­è¿è¡Œï¼Œå®ƒå¯ä»¥é¿å…ç”±äºå¤„ç†å™¨åœé¡¿ä¸‹æ¥ç­‰å¾…å‘å†…å­˜å†™å…¥æ•°æ®è€Œäº§ç”Ÿçš„å»¶è¿Ÿã€‚åŒæ—¶ï¼Œé€šè¿‡ä»¥æ‰¹å¤„ç†çš„æ–¹å¼åˆ·æ–°å†™ç¼“å†²åŒºï¼Œä»¥åŠåˆå¹¶å†™ç¼“å†²åŒºä¸­å¯¹åŒä¸€å†…å­˜åœ°å€çš„å¤šæ¬¡å†™ï¼Œå¯ä»¥å‡å°‘å¯¹å†…å­˜æ€»çº¿çš„å ç”¨ã€‚è™½ç„¶å†™ç¼“å†²åŒºæœ‰è¿™ä¹ˆå¤šå¥½å¤„ï¼Œä½†æ¯ä¸ªå¤„ç†å™¨ä¸Šçš„å†™ç¼“å†²åŒºï¼Œä»…ä»…å¯¹å®ƒæ‰€åœ¨çš„å¤„ç†å™¨å¯è§ã€‚è¿™ä¸ªç‰¹æ€§ä¼šå¯¹å†…å­˜æ“ä½œçš„æ‰§è¡Œé¡ºåºäº§ç”Ÿé‡è¦çš„å½±å“ï¼šå¤„ç†å™¨å¯¹å†…å­˜çš„è¯»/å†™æ“ä½œçš„æ‰§è¡Œé¡ºåºï¼Œä¸ä¸€å®šä¸å†…å­˜å®é™…å‘ç”Ÿçš„è¯»/å†™æ“ä½œé¡ºåºä¸€è‡´ï¼ ä¸¾ä¸ªä¾‹å­ï¼š å‡è®¾å¤„ç†å™¨Aå’Œå¤„ç†å™¨BæŒ‰ç¨‹åºçš„é¡ºåºå¹¶è¡Œæ‰§è¡Œå†…å­˜è®¿é—®ï¼Œæœ€ç»ˆå´å¯èƒ½å¾—åˆ° x = y = 0ã€‚å…·ä½“çš„åŸå› å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å¤„ç†å™¨ A å’Œ B åŒæ—¶æŠŠå…±äº«å˜é‡å†™å…¥åœ¨å†™ç¼“å†²åŒºä¸­ï¼ˆA1ã€B1ï¼‰ï¼Œç„¶åå†ä»å†…å­˜ä¸­è¯»å–å¦ä¸€ä¸ªå…±äº«å˜é‡ï¼ˆA2ã€B2ï¼‰ï¼Œæœ€åæ‰æŠŠè‡ªå·±å†™ç¼“å†²åŒºä¸­ä¿å­˜çš„è„æ•°æ®åˆ·æ–°åˆ°å†…å­˜ä¸­ï¼ˆA3ã€B3ï¼‰ã€‚å½“ä»¥è¿™ç§æ—¶åºæ‰§è¡Œæ—¶ï¼Œç¨‹åºå°±å¯ä»¥å¾—åˆ° x = y = 0 çš„ç»“æœã€‚ ä»å†…å­˜æ“ä½œå®é™…å‘ç”Ÿçš„é¡ºåºæ¥çœ‹ï¼Œç›´åˆ°å¤„ç†å™¨ A æ‰§è¡Œ A3 æ¥åˆ·æ–°è‡ªå·±çš„å†™ç¼“å­˜åŒºï¼Œå†™æ“ä½œ A1 æ‰ç®—çœŸæ­£æ‰§è¡Œäº†ã€‚è™½ç„¶å¤„ç†å™¨ A æ‰§è¡Œå†…å­˜æ“ä½œçš„é¡ºåºä¸ºï¼šA1 -&gt; A2ï¼Œä½†å†…å­˜æ“ä½œå®é™…å‘ç”Ÿçš„é¡ºåºå´æ˜¯ï¼šA2 -&gt; A1ã€‚æ­¤æ—¶ï¼Œå¤„ç†å™¨ A çš„å†…å­˜æ“ä½œé¡ºåºè¢«é‡æ’åºäº†ã€‚ è¿™é‡Œçš„å…³é”®æ˜¯ï¼Œç”±äºå†™ç¼“å†²åŒºä»…å¯¹è‡ªå·±çš„å¤„ç†å™¨å¯è§ï¼Œå®ƒä¼šå¯¼è‡´å¤„ç†å™¨æ‰§è¡Œå†…å­˜æ“ä½œçš„é¡ºåºå¯èƒ½ä¼šä¸å†…å­˜å®é™…çš„æ“ä½œæ‰§è¡Œé¡ºåºä¸ä¸€è‡´ã€‚ç”±äºç°ä»£çš„å¤„ç†å™¨éƒ½ä¼šä½¿ç”¨å†™ç¼“å†²åŒºï¼Œå› æ­¤ç°ä»£çš„å¤„ç†å™¨éƒ½ä¼šå…è®¸å¯¹å†™-è¯»æ“ä½œé‡æ’åºã€‚ å†…å­˜å±éšœæŒ‡ä»¤ä¸ºäº†ä¿è¯å†…å­˜å¯è§æ€§ï¼ŒJava ç¼–è¯‘å™¨åœ¨ç”ŸæˆæŒ‡ä»¤åºåˆ—çš„é€‚å½“ä½ç½®ä¼šæ’å…¥å†…å­˜å±éšœæŒ‡ä»¤æ¥ç¦æ­¢ç‰¹å®šç±»å‹çš„å¤„ç†å™¨é‡æ’åºã€‚JMM æŠŠå†…å­˜å±éšœæŒ‡ä»¤åˆ†ä¸ºä¸‹åˆ—å››ç±»ï¼š å±éšœç±»å‹ æŒ‡ä»¤ç¤ºä¾‹ è¯´æ˜ LoadLoad Barriers Load1; LoadLoad; Load2 ç¡®ä¿ Load1 æ•°æ®çš„è£…è½½ï¼Œä¹‹å‰äº Load2 åŠæ‰€æœ‰åç»­è£…è½½æŒ‡ä»¤çš„è£…è½½ã€‚ StoreStore Barriers Store1; StoreStore; Store2 ç¡®ä¿ Store1 æ•°æ®å¯¹å…¶ä»–å¤„ç†å™¨å¯è§ï¼ˆåˆ·æ–°åˆ°å†…å­˜ï¼‰ï¼Œä¹‹å‰äº Store2 åŠæ‰€æœ‰åç»­å­˜å‚¨æŒ‡ä»¤çš„å­˜å‚¨ã€‚ LoadStore Barriers Load1; LoadStore; Store2 ç¡®ä¿ Load1 æ•°æ®è£…è½½ï¼Œä¹‹å‰äº Store2 åŠæ‰€æœ‰åç»­çš„å­˜å‚¨æŒ‡ä»¤åˆ·æ–°åˆ°å†…å­˜ã€‚ StoreLoad Barriers Store1; StoreLoad; Load2 ç¡®ä¿ Store1 æ•°æ®å¯¹å…¶ä»–å¤„ç†å™¨å˜å¾—å¯è§ï¼ˆæŒ‡åˆ·æ–°åˆ°å†…å­˜ï¼‰ï¼Œä¹‹å‰äº Load2 åŠæ‰€æœ‰åç»­è£…è½½æŒ‡ä»¤çš„è£…è½½ã€‚StoreLoadBarriers ä¼šä½¿è¯¥å±éšœä¹‹å‰çš„æ‰€æœ‰å†…å­˜è®¿é—®æŒ‡ä»¤ï¼ˆå­˜å‚¨å’Œè£…è½½æŒ‡ä»¤ï¼‰å®Œæˆä¹‹åï¼Œæ‰æ‰§è¡Œè¯¥å±éšœä¹‹åçš„å†…å­˜è®¿é—®æŒ‡ä»¤ã€‚ happens-beforeJSR-133 å†…å­˜æ¨¡å‹ä½¿ç”¨ happens-before çš„æ¦‚å¿µæ¥é˜è¿°æ“ä½œä¹‹é—´çš„å†…å­˜å¯è§æ€§ã€‚åœ¨ JMM ä¸­ï¼Œå¦‚æœä¸€ä¸ªæ“ä½œæ‰§è¡Œçš„ç»“æœéœ€è¦å¯¹å¦ä¸€ä¸ªæ“ä½œå¯è§ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´å¿…é¡»è¦å­˜åœ¨ happens-before å…³ç³»ã€‚è¿™é‡Œæåˆ°çš„ä¸¤ä¸ªæ“ä½œæ—¢å¯ä»¥æ˜¯åœ¨ä¸€ä¸ªçº¿ç¨‹ä¹‹å†…ï¼Œä¹Ÿå¯ä»¥æ˜¯åœ¨ä¸åŒçº¿ç¨‹ä¹‹é—´ã€‚ ä¸ç¨‹åºå‘˜å¯†åˆ‡ç›¸å…³çš„ happens-before è§„åˆ™å¦‚ä¸‹ï¼š ç¨‹åºé¡ºåºè§„åˆ™ï¼šä¸€ä¸ªçº¿ç¨‹ä¸­çš„æ¯ä¸ªæ“ä½œï¼Œhappens-before äºè¯¥çº¿ç¨‹ä¸­çš„ä»»æ„åç»­æ“ä½œã€‚ ç›‘è§†å™¨é”è§„åˆ™ï¼šå¯¹ä¸€ä¸ªç›‘è§†å™¨çš„è§£é”ï¼Œhappens-before äºéšåå¯¹è¿™ä¸ªç›‘è§†å™¨çš„åŠ é”ã€‚ volatile å˜é‡è§„åˆ™ï¼šå¯¹ä¸€ä¸ª volatile åŸŸçš„å†™ï¼Œhappens-before äºä»»æ„åç»­å¯¹è¿™ä¸ª volatile åŸŸçš„è¯»ã€‚ ä¼ é€’æ€§ï¼šå¦‚æœ A happens-before Bï¼Œä¸” B happens-before Cï¼Œé‚£ä¹ˆ A happens-before Cã€‚ æ³¨æ„ï¼Œä¸¤ä¸ªæ“ä½œä¹‹é—´å…·æœ‰ happens-before å…³ç³»ï¼Œå¹¶ä¸æ„å‘³ç€å‰ä¸€ä¸ªæ“ä½œå¿…é¡»è¦åœ¨åä¸€ä¸ªæ“ä½œä¹‹å‰æ‰§è¡Œï¼happens-before ä»…ä»…è¦æ±‚å‰ä¸€ä¸ªæ“ä½œï¼ˆæ‰§è¡Œçš„ç»“æœï¼‰å¯¹åä¸€ä¸ªæ“ä½œå¯è§ï¼Œä¸”å‰ä¸€ä¸ªæ“ä½œæŒ‰é¡ºåºæ’åœ¨ç¬¬äºŒä¸ªæ“ä½œä¹‹å‰ï¼ˆthe first is visible to and ordered before the secondï¼‰ã€‚ happens-before ä¸ JMM çš„å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä¸€ä¸ª happens-before è§„åˆ™å¯¹åº”äºä¸€ä¸ªæˆ–å¤šä¸ªç¼–è¯‘å™¨å’Œå¤„ç†å™¨é‡æ’åºè§„åˆ™ã€‚ æ•°æ®ä¾èµ–æ€§å¦‚æœä¸¤ä¸ªæ“ä½œè®¿é—®åŒä¸€ä¸ªå˜é‡ï¼Œä¸”è¿™ä¸¤ä¸ªæ“ä½œä¸­æœ‰ä¸€ä¸ªä¸ºå†™æ“ä½œï¼Œæ­¤æ—¶è¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´å°±å­˜åœ¨æ•°æ®ä¾èµ–æ€§ã€‚æ•°æ®ä¾èµ–åˆ†ä¸‹åˆ—ä¸‰ç§ç±»å‹ï¼š åç§° ä»£ç ç¤ºä¾‹ è¯´æ˜ å†™åè¯» a = 1; b = a; å†™ä¸€ä¸ªå˜é‡ä¹‹åï¼Œå†è¯»è¿™ä¸ªä½ç½®ã€‚ å†™åå†™ a = 1; a = 2; å†™ä¸€ä¸ªå˜é‡ä¹‹åï¼Œå†å†™è¿™ä¸ªå˜é‡ã€‚ è¯»åå†™ a = b; b = 1; è¯»ä¸€ä¸ªå˜é‡ä¹‹åï¼Œå†å†™è¿™ä¸ªå˜é‡ã€‚ ä¸Šé¢ä¸‰ç§æƒ…å†µï¼Œåªè¦é‡æ’åºä¸¤ä¸ªæ“ä½œçš„æ‰§è¡Œé¡ºåºï¼Œç¨‹åºçš„æ‰§è¡Œç»“æœå°†ä¼šè¢«æ”¹å˜ã€‚ å‰é¢æåˆ°è¿‡ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¯èƒ½ä¼šå¯¹æ“ä½œåšé‡æ’åºã€‚ç¼–è¯‘å™¨å’Œå¤„ç†å™¨åœ¨é‡æ’åºæ—¶ï¼Œä¼šéµå®ˆæ•°æ®ä¾èµ–æ€§ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¸ä¼šæ”¹å˜å­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»çš„ä¸¤ä¸ªæ“ä½œçš„æ‰§è¡Œé¡ºåºã€‚ æ³¨æ„ï¼Œè¿™é‡Œæ‰€è¯´çš„æ•°æ®ä¾èµ–æ€§ä»…é’ˆå¯¹å•ä¸ªå¤„ç†å™¨ä¸­æ‰§è¡Œçš„æŒ‡ä»¤åºåˆ—å’Œå•ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œçš„æ“ä½œï¼Œä¸åŒå¤„ç†å™¨ä¹‹é—´å’Œä¸åŒçº¿ç¨‹ä¹‹é—´çš„æ•°æ®ä¾èµ–æ€§ä¸è¢«ç¼–è¯‘å™¨å’Œå¤„ç†å™¨è€ƒè™‘ã€‚ as-if-serial è¯­ä¹‰as-if-serial è¯­ä¹‰çš„æ„æ€æŒ‡ï¼šä¸ç®¡æ€ä¹ˆé‡æ’åºï¼ˆç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¸ºäº†æé«˜å¹¶è¡Œåº¦ï¼‰ï¼Œï¼ˆå•çº¿ç¨‹ï¼‰ç¨‹åºçš„æ‰§è¡Œç»“æœä¸èƒ½è¢«æ”¹å˜ã€‚ç¼–è¯‘å™¨ï¼Œruntime å’Œå¤„ç†å™¨éƒ½å¿…é¡»éµå®ˆ as-if-serial è¯­ä¹‰ã€‚ ä¸ºäº†éµå®ˆ as-if-serial ç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¸ä¼šå¯¹å­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»çš„æ“ä½œåšé‡æ’åºï¼Œå› ä¸ºè¿™ç§é‡æ’åºä¼šæ”¹å˜æ‰§è¡Œç»“æœã€‚ä½†æ˜¯å¦‚æœæ“ä½œä¹‹é—´æ²¡æœ‰æ•°æ®ä¾èµ–å…³ç³»ï¼Œè¿™äº›æ“ä½œå°±å¯èƒ½è¢«ç¼–è¯‘å™¨å’Œå¤„ç†å™¨é‡æ’åºã€‚ ä¸¾ä¸ªä¾‹å­ï¼š 123double pi = 3.14; //Adouble r = 1.0; //Bdouble area = pi * r * r; //C ä¸Šé¢ä¸‰ä¸ªæ“ä½œçš„æ•°æ®ä¾èµ–å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒA å’Œ C ä¹‹é—´å­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»ï¼ŒåŒæ—¶ B å’Œ C ä¹‹é—´ä¹Ÿå­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»ã€‚å› æ­¤åœ¨æœ€ç»ˆæ‰§è¡Œçš„æŒ‡ä»¤åºåˆ—ä¸­ï¼ŒC ä¸èƒ½è¢«é‡æ’åºåˆ° A å’Œ B çš„å‰é¢ï¼ˆC æ’åˆ° A å’Œ B çš„å‰é¢ï¼Œç¨‹åºçš„ç»“æœå°†ä¼šè¢«æ”¹å˜ï¼‰ã€‚ä½† A å’Œ B ä¹‹é—´æ²¡æœ‰æ•°æ®ä¾èµ–å…³ç³»ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¯ä»¥é‡æ’åº A å’Œ B ä¹‹é—´çš„æ‰§è¡Œé¡ºåºã€‚ä¸‹å›¾æ˜¯è¯¥ç¨‹åºçš„ä¸¤ç§æ‰§è¡Œé¡ºåºï¼š åœ¨è®¡ç®—æœºä¸­ï¼Œè½¯ä»¶æŠ€æœ¯å’Œç¡¬ä»¶æŠ€æœ¯æœ‰ä¸€ä¸ªå…±åŒçš„ç›®æ ‡ï¼šåœ¨ä¸æ”¹å˜ç¨‹åºæ‰§è¡Œç»“æœçš„å‰æä¸‹ï¼Œå°½å¯èƒ½çš„å¼€å‘å¹¶è¡Œåº¦ã€‚ç¼–è¯‘å™¨å’Œå¤„ç†å™¨éµä»è¿™ä¸€ç›®æ ‡ï¼Œä» happens-before çš„å®šä¹‰æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒJMM åŒæ ·éµä»è¿™ä¸€ç›®æ ‡ã€‚ é‡æ’åºå¯¹å¤šçº¿ç¨‹çš„å½±å“ä¸¾ä¾‹ï¼š 123456789101112131415class Demo &#123; int a = 0; boolean flag = false; public void write() &#123; a = 1; //1 flag = true; //2 &#125; public void read() &#123; if(flag) &#123; //3 int i = a * a; //4 &#125; &#125;&#125; ç”±äºæ“ä½œ 1 å’Œ 2 æ²¡æœ‰æ•°æ®ä¾èµ–å…³ç³»ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¯ä»¥å¯¹è¿™ä¸¤ä¸ªæ“ä½œé‡æ’åºï¼›æ“ä½œ 3 å’Œæ“ä½œ 4 æ²¡æœ‰æ•°æ®ä¾èµ–å…³ç³»ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¹Ÿå¯ä»¥å¯¹è¿™ä¸¤ä¸ªæ“ä½œé‡æ’åºã€‚ 1ã€å½“æ“ä½œ 1 å’Œæ“ä½œ 2 é‡æ’åºæ—¶ï¼Œå¯èƒ½ä¼šäº§ç”Ÿä»€ä¹ˆæ•ˆæœï¼Ÿ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ“ä½œ 1 å’Œæ“ä½œ 2 åšäº†é‡æ’åºã€‚ç¨‹åºæ‰§è¡Œæ—¶ï¼Œçº¿ç¨‹ A é¦–å…ˆå†™æ ‡è®°å˜é‡ flagï¼Œéšåçº¿ç¨‹ B è¯»è¿™ä¸ªå˜é‡ã€‚ç”±äºæ¡ä»¶åˆ¤æ–­ä¸ºçœŸï¼Œçº¿ç¨‹ B å°†è¯»å–å˜é‡ aã€‚æ­¤æ—¶ï¼Œå˜é‡ a è¿˜æ ¹æœ¬æ²¡æœ‰è¢«çº¿ç¨‹ A å†™å…¥ï¼Œåœ¨è¿™é‡Œå¤šçº¿ç¨‹ç¨‹åºçš„è¯­ä¹‰è¢«é‡æ’åºç ´åäº†ï¼ 2ã€å½“æ“ä½œ 3 å’Œæ“ä½œ 4 é‡æ’åºæ—¶ä¼šäº§ç”Ÿä»€ä¹ˆæ•ˆæœï¼ˆå€ŸåŠ©è¿™ä¸ªé‡æ’åºï¼Œå¯ä»¥é¡ºä¾¿è¯´æ˜æ§åˆ¶ä¾èµ–æ€§ï¼‰ã€‚ åœ¨ç¨‹åºä¸­ï¼Œæ“ä½œ 3 å’Œæ“ä½œ 4 å­˜åœ¨æ§åˆ¶ä¾èµ–å…³ç³»ã€‚å½“ä»£ç ä¸­å­˜åœ¨æ§åˆ¶ä¾èµ–æ€§æ—¶ï¼Œä¼šå½±å“æŒ‡ä»¤åºåˆ—æ‰§è¡Œçš„å¹¶è¡Œåº¦ã€‚ä¸ºæ­¤ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¼šé‡‡ç”¨çŒœæµ‹ï¼ˆSpeculationï¼‰æ‰§è¡Œæ¥å…‹æœæ§åˆ¶ç›¸å…³æ€§å¯¹å¹¶è¡Œåº¦çš„å½±å“ã€‚ä»¥å¤„ç†å™¨çš„çŒœæµ‹æ‰§è¡Œä¸ºä¾‹ï¼Œæ‰§è¡Œçº¿ç¨‹ B çš„å¤„ç†å™¨å¯ä»¥æå‰è¯»å–å¹¶è®¡ç®— a * aï¼Œç„¶åæŠŠè®¡ç®—ç»“æœä¸´æ—¶ä¿å­˜åˆ°ä¸€ä¸ªåä¸ºé‡æ’åºç¼“å†²ï¼ˆreorder buffer ROBï¼‰çš„ç¡¬ä»¶ç¼“å­˜ä¸­ã€‚å½“æ¥ä¸‹æ¥æ“ä½œ 3 çš„æ¡ä»¶åˆ¤æ–­ä¸ºçœŸæ—¶ï¼Œå°±æŠŠè¯¥è®¡ç®—ç»“æœå†™å…¥å˜é‡ i ä¸­ã€‚ ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒçŒœæµ‹æ‰§è¡Œå®è´¨ä¸Šå¯¹æ“ä½œ3å’Œ4åšäº†é‡æ’åºã€‚é‡æ’åºåœ¨è¿™é‡Œç ´åäº†å¤šçº¿ç¨‹ç¨‹åºçš„è¯­ä¹‰ï¼ åœ¨å•çº¿ç¨‹ç¨‹åºä¸­ï¼Œå¯¹å­˜åœ¨æ§åˆ¶ä¾èµ–çš„æ“ä½œé‡æ’åºï¼Œä¸ä¼šæ”¹å˜æ‰§è¡Œç»“æœï¼ˆè¿™ä¹Ÿæ˜¯ as-if-serial è¯­ä¹‰å…è®¸å¯¹å­˜åœ¨æ§åˆ¶ä¾èµ–çš„æ“ä½œåšé‡æ’åºçš„åŸå› ï¼‰ï¼›ä½†åœ¨å¤šçº¿ç¨‹ç¨‹åºä¸­ï¼Œå¯¹å­˜åœ¨æ§åˆ¶ä¾èµ–çš„æ“ä½œé‡æ’åºï¼Œå¯èƒ½ä¼šæ”¹å˜ç¨‹åºçš„æ‰§è¡Œç»“æœã€‚ é¡ºåºä¸€è‡´æ€§é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹æœ‰ä¸¤å¤§ç‰¹æ€§ï¼š ä¸€ä¸ªçº¿ç¨‹ä¸­çš„æ‰€æœ‰æ“ä½œå¿…é¡»æŒ‰ç…§ç¨‹åºçš„é¡ºåºæ¥æ‰§è¡Œã€‚ ï¼ˆä¸ç®¡ç¨‹åºæ˜¯å¦åŒæ­¥ï¼‰æ‰€æœ‰çº¿ç¨‹éƒ½åªèƒ½çœ‹åˆ°ä¸€ä¸ªå•ä¸€çš„æ“ä½œæ‰§è¡Œé¡ºåºã€‚åœ¨é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹ä¸­ï¼Œæ¯ä¸ªæ“ä½œéƒ½å¿…é¡»åŸå­æ‰§è¡Œä¸”ç«‹åˆ»å¯¹æ‰€æœ‰çº¿ç¨‹å¯è§ã€‚ é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹ä¸ºç¨‹åºå‘˜æä¾›çš„è§†å›¾å¦‚ä¸‹ï¼š åœ¨æ¦‚å¿µä¸Šï¼Œé¡ºåºä¸€è‡´æ€§æ¨¡å‹æœ‰ä¸€ä¸ªå•ä¸€çš„å…¨å±€å†…å­˜ï¼Œè¿™ä¸ªå†…å­˜é€šè¿‡ä¸€ä¸ªå·¦å³æ‘†åŠ¨çš„å¼€å…³å¯ä»¥è¿æ¥åˆ°ä»»æ„ä¸€ä¸ªçº¿ç¨‹ï¼ŒåŒæ—¶æ¯ä¸€ä¸ªçº¿ç¨‹å¿…é¡»æŒ‰ç…§ç¨‹åºçš„é¡ºåºæ¥æ‰§è¡Œå†…å­˜è¯»/å†™æ“ä½œã€‚ä»ä¸Šé¢çš„ç¤ºæ„å›¾æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œåœ¨ä»»æ„æ—¶é—´ç‚¹æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è¿æ¥åˆ°å†…å­˜ã€‚å½“å¤šä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œæ—¶ï¼Œå›¾ä¸­çš„å¼€å…³è£…ç½®èƒ½æŠŠæ‰€æœ‰çº¿ç¨‹çš„æ‰€æœ‰å†…å­˜è¯»/å†™æ“ä½œä¸²è¡ŒåŒ–ã€‚ ä¸¾ä¸ªä¾‹å­ï¼š å‡è®¾æœ‰ä¸¤ä¸ªçº¿ç¨‹ A å’Œ B å¹¶å‘æ‰§è¡Œã€‚å…¶ä¸­ A çº¿ç¨‹æœ‰ä¸‰ä¸ªæ“ä½œï¼Œå®ƒä»¬åœ¨ç¨‹åºä¸­çš„é¡ºåºæ˜¯ï¼šA1 -&gt; A2 -&gt; A3ã€‚B çº¿ç¨‹ä¹Ÿæœ‰ä¸‰ä¸ªæ“ä½œï¼Œå®ƒä»¬åœ¨ç¨‹åºä¸­çš„é¡ºåºæ˜¯ï¼šB1 -&gt; B2 -&gt; B3ã€‚ å‡è®¾è¿™ä¸¤ä¸ªçº¿ç¨‹ä½¿ç”¨ç›‘è§†å™¨é”æ¥æ­£ç¡®åŒæ­¥ï¼šA çº¿ç¨‹çš„ä¸‰ä¸ªæ“ä½œæ‰§è¡Œåé‡Šæ”¾ç›‘è§†å™¨é”ï¼Œéšå B çº¿ç¨‹è·å–åŒä¸€ä¸ªç›‘è§†å™¨é”ã€‚é‚£ä¹ˆç¨‹åºåœ¨é¡ºåºä¸€è‡´æ€§æ¨¡å‹ä¸­çš„æ‰§è¡Œæ•ˆæœå°†å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ç°åœ¨æˆ‘ä»¬å†å‡è®¾è¿™ä¸¤ä¸ªçº¿ç¨‹æ²¡æœ‰åšåŒæ­¥ï¼Œä¸‹é¢æ˜¯è¿™ä¸ªæœªåŒæ­¥ç¨‹åºåœ¨é¡ºåºä¸€è‡´æ€§æ¨¡å‹ä¸­çš„æ‰§è¡Œç¤ºæ„å›¾ï¼š æœªåŒæ­¥ç¨‹åºåœ¨é¡ºåºä¸€è‡´æ€§æ¨¡å‹ä¸­è™½ç„¶æ•´ä½“æ‰§è¡Œé¡ºåºæ˜¯æ— åºçš„ï¼Œä½†æ‰€æœ‰çº¿ç¨‹éƒ½åªèƒ½çœ‹åˆ°ä¸€ä¸ªä¸€è‡´çš„æ•´ä½“æ‰§è¡Œé¡ºåºã€‚ä»¥ä¸Šå›¾ä¸ºä¾‹ï¼Œçº¿ç¨‹ A å’Œ B çœ‹åˆ°çš„æ‰§è¡Œé¡ºåºéƒ½æ˜¯ï¼šB1 -&gt; A1 -&gt; A2 -&gt; B2 -&gt; A3 -&gt; B3ã€‚ä¹‹æ‰€ä»¥èƒ½å¾—åˆ°è¿™ä¸ªä¿è¯æ˜¯å› ä¸ºé¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹ä¸­çš„æ¯ä¸ªæ“ä½œå¿…é¡»ç«‹å³å¯¹ä»»æ„çº¿ç¨‹å¯è§ã€‚ ä½†æ˜¯ï¼Œåœ¨ JMM ä¸­å°±æ²¡æœ‰è¿™ä¸ªä¿è¯ã€‚æœªåŒæ­¥ç¨‹åºåœ¨ JMM ä¸­ä¸ä½†æ•´ä½“çš„æ‰§è¡Œé¡ºåºæ˜¯æ— åºçš„ï¼Œè€Œä¸”æ‰€æœ‰çº¿ç¨‹çœ‹åˆ°çš„æ“ä½œæ‰§è¡Œé¡ºåºä¹Ÿå¯èƒ½ä¸ä¸€è‡´ã€‚æ¯”å¦‚ï¼Œåœ¨å½“å‰çº¿ç¨‹æŠŠå†™è¿‡çš„æ•°æ®ç¼“å­˜åœ¨æœ¬åœ°å†…å­˜ä¸­ï¼Œåœ¨è¿˜æ²¡æœ‰åˆ·æ–°åˆ°ä¸»å†…å­˜ä¹‹å‰ï¼Œè¿™ä¸ªå†™æ“ä½œä»…å¯¹å½“å‰çº¿ç¨‹å¯è§ï¼›ä»å…¶ä»–çº¿ç¨‹çš„è§’åº¦æ¥è§‚å¯Ÿï¼Œä¼šè®¤ä¸ºè¿™ä¸ªå†™æ“ä½œæ ¹æœ¬è¿˜æ²¡æœ‰è¢«å½“å‰çº¿ç¨‹æ‰§è¡Œã€‚åªæœ‰å½“å‰çº¿ç¨‹æŠŠæœ¬åœ°å†…å­˜ä¸­å†™è¿‡çš„æ•°æ®åˆ·æ–°åˆ°ä¸»å†…å­˜ä¹‹åï¼Œè¿™ä¸ªå†™æ“ä½œæ‰èƒ½å¯¹å…¶ä»–çº¿ç¨‹å¯è§ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå½“å‰çº¿ç¨‹å’Œå…¶å®ƒçº¿ç¨‹çœ‹åˆ°çš„æ“ä½œæ‰§è¡Œé¡ºåºå°†ä¸ä¸€è‡´ã€‚ åŒæ­¥ç¨‹åºçš„é¡ºåºä¸€è‡´æ€§æ•ˆæœä¸‹é¢æˆ‘ä»¬å¯¹å‰é¢çš„ç¤ºä¾‹ç¨‹åºç”¨é”æ¥åŒæ­¥ï¼Œçœ‹çœ‹æ­£ç¡®åŒæ­¥çš„ç¨‹åºå¦‚ä½•å…·æœ‰é¡ºåºä¸€è‡´æ€§ã€‚ è¯·çœ‹ä¸‹é¢çš„ç¤ºä¾‹ä»£ç ï¼š 123456789101112131415class demo &#123; int a = 0; boolean flag = false; public synchronized void write() &#123; //è·å–é” a = 1; flag = true; &#125; //é‡Šæ”¾é” public synchronized void read() &#123; //è·å–é” if(flag) &#123; int i = a; &#125; &#125; //é‡Šæ”¾é”&#125; ä¸Šé¢ç¤ºä¾‹ä»£ç ä¸­ï¼Œå‡è®¾ A çº¿ç¨‹æ‰§è¡Œ write() æ–¹æ³•åï¼ŒB çº¿ç¨‹æ‰§è¡Œ reade() æ–¹æ³•ã€‚è¿™æ˜¯ä¸€ä¸ªæ­£ç¡®åŒæ­¥çš„å¤šçº¿ç¨‹ç¨‹åºã€‚æ ¹æ®JMMè§„èŒƒï¼Œè¯¥ç¨‹åºçš„æ‰§è¡Œç»“æœå°†ä¸è¯¥ç¨‹åºåœ¨é¡ºåºä¸€è‡´æ€§æ¨¡å‹ä¸­çš„æ‰§è¡Œç»“æœç›¸åŒã€‚ä¸‹é¢æ˜¯è¯¥ç¨‹åºåœ¨ä¸¤ä¸ªå†…å­˜æ¨¡å‹ä¸­çš„æ‰§è¡Œæ—¶åºå¯¹æ¯”å›¾ï¼š åœ¨é¡ºåºä¸€è‡´æ€§æ¨¡å‹ä¸­ï¼Œæ‰€æœ‰æ“ä½œå®Œå…¨æŒ‰ç¨‹åºçš„é¡ºåºæ‰§è¡Œã€‚è€Œåœ¨ JMM ä¸­ï¼Œä¸´ç•ŒåŒºå†…çš„ä»£ç å¯ä»¥é‡æ’åºï¼ˆä½† JMM ä¸å…è®¸ä¸´ç•ŒåŒºå†…çš„ä»£ç â€œé€¸å‡ºâ€åˆ°ä¸´ç•ŒåŒºä¹‹å¤–ï¼Œé‚£æ ·ä¼šç ´åç›‘è§†å™¨çš„è¯­ä¹‰ï¼‰ã€‚JMM ä¼šåœ¨é€€å‡ºä¸´ç•ŒåŒºå’Œè¿›å…¥ä¸´ç•ŒåŒºè¿™ä¸¤ä¸ªå…³é”®æ—¶é—´ç‚¹åšä¸€äº›ç‰¹åˆ«å¤„ç†ï¼Œä½¿å¾—çº¿ç¨‹åœ¨è¿™ä¸¤ä¸ªæ—¶é—´ç‚¹å…·æœ‰ä¸é¡ºåºä¸€è‡´æ€§æ¨¡å‹ç›¸åŒçš„å†…å­˜è§†å›¾ã€‚è™½ç„¶çº¿ç¨‹ A åœ¨ä¸´ç•ŒåŒºå†…åšäº†é‡æ’åºï¼Œä½†ç”±äºç›‘è§†å™¨çš„äº’æ–¥æ‰§è¡Œçš„ç‰¹æ€§ï¼Œè¿™é‡Œçš„çº¿ç¨‹ B æ ¹æœ¬æ— æ³•â€œè§‚å¯Ÿâ€åˆ°çº¿ç¨‹ A åœ¨ä¸´ç•ŒåŒºå†…çš„é‡æ’åºã€‚è¿™ç§é‡æ’åºæ—¢æé«˜äº†æ‰§è¡Œæ•ˆç‡ï¼Œåˆæ²¡æœ‰æ”¹å˜ç¨‹åºçš„æ‰§è¡Œç»“æœã€‚ ä»è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° JMM åœ¨å…·ä½“å®ç°ä¸Šçš„åŸºæœ¬æ–¹é’ˆï¼šåœ¨ä¸æ”¹å˜ï¼ˆæ­£ç¡®åŒæ­¥çš„ï¼‰ç¨‹åºæ‰§è¡Œç»“æœçš„å‰æä¸‹ï¼Œå°½å¯èƒ½çš„ä¸ºç¼–è¯‘å™¨å’Œå¤„ç†å™¨çš„ä¼˜åŒ–æ‰“å¼€æ–¹ä¾¿ä¹‹é—¨ã€‚ æœªåŒæ­¥ç¨‹åºçš„æ‰§è¡Œç‰¹æ€§æœªåŒæ­¥ç¨‹åºåœ¨ JMM ä¸­çš„æ‰§è¡Œæ—¶ï¼Œæ•´ä½“ä¸Šæ˜¯æ— åºçš„ï¼Œå…¶æ‰§è¡Œç»“æœæ— æ³•é¢„çŸ¥ã€‚æœªåŒæ­¥ç¨‹åºåœ¨ä¸¤ä¸ªæ¨¡å‹ä¸­çš„æ‰§è¡Œç‰¹æ€§æœ‰ä¸‹é¢å‡ ä¸ªå·®å¼‚ï¼š é¡ºåºä¸€è‡´æ€§æ¨¡å‹ä¿è¯å•çº¿ç¨‹å†…çš„æ“ä½œä¼šæŒ‰ç¨‹åºçš„é¡ºåºæ‰§è¡Œï¼Œè€Œ JMM ä¸ä¿è¯å•çº¿ç¨‹å†…çš„æ“ä½œä¼šæŒ‰ç¨‹åºçš„é¡ºåºæ‰§è¡Œï¼ˆæ¯”å¦‚ä¸Šé¢æ­£ç¡®åŒæ­¥çš„å¤šçº¿ç¨‹ç¨‹åºåœ¨ä¸´ç•ŒåŒºå†…çš„é‡æ’åºï¼‰ã€‚ é¡ºåºä¸€è‡´æ€§æ¨¡å‹ä¿è¯æ‰€æœ‰çº¿ç¨‹åªèƒ½çœ‹åˆ°ä¸€è‡´çš„æ“ä½œæ‰§è¡Œé¡ºåºï¼Œè€Œ JMM ä¸ä¿è¯æ‰€æœ‰çº¿ç¨‹èƒ½çœ‹åˆ°ä¸€è‡´çš„æ“ä½œæ‰§è¡Œé¡ºåºã€‚ JMM ä¸ä¿è¯å¯¹ 64 ä½çš„ long å‹å’Œ double å‹å˜é‡çš„è¯»/å†™æ“ä½œå…·æœ‰åŸå­æ€§ï¼Œè€Œé¡ºåºä¸€è‡´æ€§æ¨¡å‹ä¿è¯å¯¹æ‰€æœ‰çš„å†…å­˜è¯»/å†™æ“ä½œéƒ½å…·æœ‰åŸå­ ã€‚ ç¬¬ä¸‰ä¸ªå·®å¼‚ä¸å¤„ç†å™¨æ€»çº¿çš„å·¥ä½œæœºåˆ¶å¯†åˆ‡ç›¸å…³ã€‚åœ¨è®¡ç®—æœºä¸­ï¼Œæ•°æ®é€šè¿‡æ€»çº¿åœ¨å¤„ç†å™¨å’Œå†…å­˜ä¹‹é—´ä¼ é€’ã€‚æ¯æ¬¡å¤„ç†å™¨å’Œå†…å­˜ä¹‹é—´çš„æ•°æ®ä¼ é€’éƒ½æ˜¯é€šè¿‡æ€»çº¿äº‹åŠ¡æ¥å®Œæˆçš„ã€‚æ€»çº¿äº‹åŠ¡åŒ…æ‹¬è¯»äº‹åŠ¡å’Œå†™äº‹åŠ¡ã€‚è¯»äº‹åŠ¡ä»å†…å­˜ä¼ é€æ•°æ®åˆ°å¤„ç†å™¨ï¼Œå†™äº‹åŠ¡ä»å¤„ç†å™¨ä¼ é€’æ•°æ®åˆ°å†…å­˜ï¼Œæ¯ä¸ªäº‹åŠ¡ä¼šè¯»ï¼å†™å†…å­˜ä¸­ä¸€ä¸ªæˆ–å¤šä¸ªç‰©ç†ä¸Šè¿ç»­çš„å­—ã€‚æ€»çº¿ä¼šåŒæ­¥è¯•å›¾å¹¶å‘ä½¿ç”¨æ€»çº¿çš„äº‹åŠ¡ã€‚åœ¨ä¸€ä¸ªå¤„ç†å™¨æ‰§è¡Œæ€»çº¿äº‹åŠ¡æœŸé—´ï¼Œæ€»çº¿ä¼šç¦æ­¢å…¶å®ƒæ‰€æœ‰çš„å¤„ç†å™¨å’Œ Iï¼O è®¾å¤‡æ‰§è¡Œå†…å­˜çš„è¯»ï¼å†™ã€‚ æ€»çº¿çš„å·¥ä½œæœºåˆ¶ï¼š å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå‡è®¾å¤„ç†å™¨ Aã€Bã€å’Œ C åŒæ—¶å‘æ€»çº¿å‘èµ·æ€»çº¿äº‹åŠ¡ï¼Œè¿™æ—¶æ€»çº¿ä»²è£ä¼šå¯¹ç«äº‰ä½œå‡ºè£å†³ï¼Œå‡è®¾æ€»çº¿åœ¨ä»²è£ååˆ¤å®šå¤„ç†å™¨ A åœ¨ç«äº‰ä¸­è·èƒœï¼ˆæ€»çº¿ä»²è£ä¼šç¡®ä¿æ‰€æœ‰å¤„ç†å™¨éƒ½èƒ½å…¬å¹³çš„è®¿é—®å†…å­˜ï¼‰ã€‚æ­¤æ—¶å¤„ç†å™¨ A ç»§ç»­å®ƒçš„æ€»çº¿äº‹åŠ¡ï¼Œè€Œå…¶å®ƒä¸¤ä¸ªå¤„ç†å™¨åˆ™è¦ç­‰å¾…å¤„ç†å™¨ A çš„æ€»çº¿äº‹åŠ¡å®Œæˆåæ‰èƒ½å¼€å§‹å†æ¬¡æ‰§è¡Œå†…å­˜è®¿é—®ã€‚å‡è®¾åœ¨å¤„ç†å™¨ A æ‰§è¡Œæ€»çº¿äº‹åŠ¡æœŸé—´ï¼ˆä¸ç®¡è¿™ä¸ªæ€»çº¿äº‹åŠ¡æ˜¯è¯»äº‹åŠ¡è¿˜æ˜¯å†™äº‹åŠ¡ï¼‰ï¼Œå¤„ç†å™¨ D å‘æ€»çº¿å‘èµ·äº†æ€»çº¿äº‹åŠ¡ï¼Œæ­¤æ—¶å¤„ç†å™¨ D çš„è¿™ä¸ªè¯·æ±‚ä¼šè¢«æ€»çº¿ç¦æ­¢ã€‚ æ€»çº¿çš„è¿™äº›å·¥ä½œæœºåˆ¶å¯ä»¥æŠŠæ‰€æœ‰å¤„ç†å™¨å¯¹å†…å­˜çš„è®¿é—®ä»¥ä¸²è¡ŒåŒ–çš„æ–¹å¼æ¥æ‰§è¡Œï¼›åœ¨ä»»æ„æ—¶é—´ç‚¹ï¼Œæœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªå¤„ç†å™¨èƒ½è®¿é—®å†…å­˜ã€‚è¿™ä¸ªç‰¹æ€§ç¡®ä¿äº†å•ä¸ªæ€»çº¿äº‹åŠ¡ä¹‹ä¸­çš„å†…å­˜è¯»/å†™æ“ä½œå…·æœ‰åŸå­æ€§ã€‚ åœ¨ä¸€äº› 32 ä½çš„å¤„ç†å™¨ä¸Šï¼Œå¦‚æœè¦æ±‚å¯¹ 64 ä½æ•°æ®çš„å†™æ“ä½œå…·æœ‰åŸå­æ€§ï¼Œä¼šæœ‰æ¯”è¾ƒå¤§çš„å¼€é”€ã€‚ä¸ºäº†ç…§é¡¾è¿™ç§å¤„ç†å™¨ï¼ŒJava è¯­è¨€è§„èŒƒé¼“åŠ±ä½†ä¸å¼ºæ±‚ JVM å¯¹ 64 ä½çš„ long å‹å˜é‡å’Œ double å‹å˜é‡çš„å†™å…·æœ‰åŸå­æ€§ã€‚å½“ JVM åœ¨è¿™ç§å¤„ç†å™¨ä¸Šè¿è¡Œæ—¶ï¼Œä¼šæŠŠä¸€ä¸ª 64 ä½ long/ double å‹å˜é‡çš„å†™æ“ä½œæ‹†åˆ†ä¸ºä¸¤ä¸ª 32 ä½çš„å†™æ“ä½œæ¥æ‰§è¡Œã€‚è¿™ä¸¤ä¸ª 32 ä½çš„å†™æ“ä½œå¯èƒ½ä¼šè¢«åˆ†é…åˆ°ä¸åŒçš„æ€»çº¿äº‹åŠ¡ä¸­æ‰§è¡Œï¼Œæ­¤æ—¶å¯¹è¿™ä¸ª 64 ä½å˜é‡çš„å†™å°†ä¸å…·æœ‰åŸå­æ€§ã€‚ å½“å•ä¸ªå†…å­˜æ“ä½œä¸å…·æœ‰åŸå­æ€§ï¼Œå°†å¯èƒ½ä¼šäº§ç”Ÿæ„æƒ³ä¸åˆ°åæœã€‚è¯·çœ‹ä¸‹é¢ç¤ºæ„å›¾ï¼š å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå‡è®¾å¤„ç†å™¨ A å†™ä¸€ä¸ª long å‹å˜é‡ï¼ŒåŒæ—¶å¤„ç†å™¨ B è¦è¯»è¿™ä¸ª long å‹å˜é‡ã€‚å¤„ç†å™¨ A ä¸­ 64 ä½çš„å†™æ“ä½œè¢«æ‹†åˆ†ä¸ºä¸¤ä¸ª 32 ä½çš„å†™æ“ä½œï¼Œä¸”è¿™ä¸¤ä¸ª 32 ä½çš„å†™æ“ä½œè¢«åˆ†é…åˆ°ä¸åŒçš„å†™äº‹åŠ¡ä¸­æ‰§è¡Œã€‚åŒæ—¶å¤„ç†å™¨ B ä¸­ 64 ä½çš„è¯»æ“ä½œè¢«åˆ†é…åˆ°å•ä¸ªçš„è¯»äº‹åŠ¡ä¸­æ‰§è¡Œã€‚å½“å¤„ç†å™¨ A å’Œ B æŒ‰ä¸Šå›¾çš„æ—¶åºæ¥æ‰§è¡Œæ—¶ï¼Œå¤„ç†å™¨ B å°†çœ‹åˆ°ä»…ä»…è¢«å¤„ç†å™¨ A â€œå†™äº†ä¸€åŠâ€œçš„æ— æ•ˆå€¼ã€‚ æ³¨æ„ï¼Œåœ¨ JSR -133 ä¹‹å‰çš„æ—§å†…å­˜æ¨¡å‹ä¸­ï¼Œä¸€ä¸ª 64 ä½ long/ double å‹å˜é‡çš„è¯»/å†™æ“ä½œå¯ä»¥è¢«æ‹†åˆ†ä¸ºä¸¤ä¸ª 32 ä½çš„è¯»/å†™æ“ä½œæ¥æ‰§è¡Œã€‚ä» JSR -133 å†…å­˜æ¨¡å‹å¼€å§‹ï¼ˆå³ä»JDK5å¼€å§‹ï¼‰ï¼Œä»…ä»…åªå…è®¸æŠŠä¸€ä¸ª 64 ä½ long/ double å‹å˜é‡çš„å†™æ“ä½œæ‹†åˆ†ä¸ºä¸¤ä¸ª 32 ä½çš„å†™æ“ä½œæ¥æ‰§è¡Œï¼Œä»»æ„çš„è¯»æ“ä½œåœ¨JSR -133ä¸­éƒ½å¿…é¡»å…·æœ‰åŸå­æ€§ï¼ˆå³ä»»æ„è¯»æ“ä½œå¿…é¡»è¦åœ¨å•ä¸ªè¯»äº‹åŠ¡ä¸­æ‰§è¡Œï¼‰ã€‚ VolatileVolatile ç‰¹æ€§ä¸¾ä¸ªä¾‹å­ï¼š 123456789101112131415public class VolatileTest &#123; volatile long a = 1L; // ä½¿ç”¨ volatile å£°æ˜ 64 ä½çš„ long å‹ public void set(long l) &#123; a = l; //å•ä¸ª volatile å˜é‡çš„å†™ &#125; public long get() &#123; return a; //å•ä¸ª volatile å˜é‡çš„è¯» &#125; public void getAndIncreament() &#123; a++; // å¤åˆï¼ˆå¤šä¸ªï¼‰ volatile å˜é‡çš„è¯» /å†™ &#125;&#125; å‡è®¾æœ‰å¤šä¸ªçº¿ç¨‹åˆ†åˆ«è°ƒç”¨ä¸Šé¢ç¨‹åºçš„ä¸‰ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªç¨‹åºåœ¨è¯­ä¹‰ä¸Šå’Œä¸‹é¢ç¨‹åºç­‰ä»·ï¼š 1234567891011121314151617public class VolatileTest &#123; long a = 1L; // 64 ä½çš„ long å‹æ™®é€šå˜é‡ public synchronized void set(long l) &#123; //å¯¹å•ä¸ªæ™®é€šå˜é‡çš„å†™ç”¨åŒä¸€ä¸ªé”åŒæ­¥ a = l; &#125; public synchronized long get() &#123; //å¯¹å•ä¸ªæ™®é€šå˜é‡çš„è¯»ç”¨åŒä¸€ä¸ªé”åŒæ­¥ return a; &#125; public void getAndIncreament() &#123; //æ™®é€šæ–¹æ³•è°ƒç”¨ long temp = get(); //è°ƒç”¨å·²åŒæ­¥çš„è¯»æ–¹æ³• temp += 1L; //æ™®é€šå†™æ“ä½œ set(temp); //è°ƒç”¨å·²åŒæ­¥çš„å†™æ–¹æ³• &#125;&#125; å¦‚ä¸Šé¢ç¤ºä¾‹ç¨‹åºæ‰€ç¤ºï¼Œå¯¹ä¸€ä¸ª volatile å˜é‡çš„å•ä¸ªè¯»/å†™æ“ä½œï¼Œä¸å¯¹ä¸€ä¸ªæ™®é€šå˜é‡çš„è¯»/å†™æ“ä½œä½¿ç”¨åŒä¸€ä¸ªé”æ¥åŒæ­¥ï¼Œå®ƒä»¬ä¹‹é—´çš„æ‰§è¡Œæ•ˆæœç›¸åŒã€‚ é”çš„ happens-before è§„åˆ™ä¿è¯é‡Šæ”¾é”å’Œè·å–é”çš„ä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´çš„å†…å­˜å¯è§æ€§ï¼Œè¿™æ„å‘³ç€å¯¹ä¸€ä¸ª volatile å˜é‡çš„è¯»ï¼Œæ€»æ˜¯èƒ½çœ‹åˆ°ï¼ˆä»»æ„çº¿ç¨‹ï¼‰å¯¹è¿™ä¸ª volatile å˜é‡æœ€åçš„å†™å…¥ã€‚ é”çš„è¯­ä¹‰å†³å®šäº†ä¸´ç•ŒåŒºä»£ç çš„æ‰§è¡Œå…·æœ‰åŸå­æ€§ã€‚è¿™æ„å‘³ç€å³ä½¿æ˜¯ 64 ä½çš„ long å‹å’Œ double å‹å˜é‡ï¼Œåªè¦å®ƒæ˜¯ volatileå˜é‡ï¼Œå¯¹è¯¥å˜é‡çš„è¯»å†™å°±å°†å…·æœ‰åŸå­æ€§ã€‚å¦‚æœæ˜¯å¤šä¸ª volatile æ“ä½œæˆ–ç±»ä¼¼äº volatile++ è¿™ç§å¤åˆæ“ä½œï¼Œè¿™äº›æ“ä½œæ•´ä½“ä¸Šä¸å…·æœ‰åŸå­æ€§ã€‚ ç®€è€Œè¨€ä¹‹ï¼Œvolatile å˜é‡è‡ªèº«å…·æœ‰ä¸‹åˆ—ç‰¹æ€§ï¼š å¯è§æ€§ã€‚å¯¹ä¸€ä¸ª volatile å˜é‡çš„è¯»ï¼Œæ€»æ˜¯èƒ½çœ‹åˆ°ï¼ˆä»»æ„çº¿ç¨‹ï¼‰å¯¹è¿™ä¸ª volatile å˜é‡æœ€åçš„å†™å…¥ã€‚ åŸå­æ€§ï¼šå¯¹ä»»æ„å•ä¸ª volatile å˜é‡çš„è¯»/å†™å…·æœ‰åŸå­æ€§ï¼Œä½†ç±»ä¼¼äº volatile++ è¿™ç§å¤åˆæ“ä½œä¸å…·æœ‰åŸå­æ€§ã€‚ volatile å†™-è¯»çš„å†…å­˜å®šä¹‰ å½“å†™ä¸€ä¸ª volatile å˜é‡æ—¶ï¼ŒJMM ä¼šæŠŠè¯¥çº¿ç¨‹å¯¹åº”çš„æœ¬åœ°å†…å­˜ä¸­çš„å…±äº«å˜é‡å€¼åˆ·æ–°åˆ°ä¸»å†…å­˜ã€‚ å½“è¯»ä¸€ä¸ª volatile å˜é‡æ—¶ï¼ŒJMM ä¼šæŠŠè¯¥çº¿ç¨‹å¯¹åº”çš„æœ¬åœ°å†…å­˜ç½®ä¸ºæ— æ•ˆã€‚çº¿ç¨‹æ¥ä¸‹æ¥å°†ä»ä¸»å†…å­˜ä¸­è¯»å–å…±äº«å˜é‡ã€‚ å‡è®¾ä¸Šé¢çš„ç¨‹åº flag å˜é‡ç”¨ volatile ä¿®é¥° volatile å†…å­˜è¯­ä¹‰çš„å®ç°ä¸‹é¢æ˜¯ JMM é’ˆå¯¹ç¼–è¯‘å™¨åˆ¶å®šçš„ volatile é‡æ’åºè§„åˆ™è¡¨ï¼š ä¸ºäº†å®ç° volatile çš„å†…å­˜è¯­ä¹‰ï¼Œç¼–è¯‘å™¨åœ¨ç”Ÿæˆå­—èŠ‚ç æ—¶ï¼Œä¼šåœ¨æŒ‡ä»¤åºåˆ—ä¸­æ’å…¥å†…å­˜å±éšœæ¥ç¦æ­¢ç‰¹å®šç±»å‹çš„å¤„ç†å™¨é‡æ’åºã€‚ ä¸‹é¢æ˜¯åŸºäºä¿å®ˆç­–ç•¥çš„ JMM å†…å­˜å±éšœæ’å…¥ç­–ç•¥ï¼š åœ¨æ¯ä¸ª volatile å†™æ“ä½œçš„å‰é¢æ’å…¥ä¸€ä¸ª StoreStore å±éšœã€‚ åœ¨æ¯ä¸ª volatile å†™æ“ä½œçš„åé¢æ’å…¥ä¸€ä¸ª StoreLoad å±éšœã€‚ åœ¨æ¯ä¸ª volatile è¯»æ“ä½œçš„åé¢æ’å…¥ä¸€ä¸ª LoadLoad å±éšœã€‚ åœ¨æ¯ä¸ª volatile è¯»æ“ä½œçš„åé¢æ’å…¥ä¸€ä¸ª LoadStore å±éšœã€‚ ä¸‹é¢æ˜¯ä¿å®ˆç­–ç•¥ä¸‹ï¼Œvolatile å†™æ“ä½œ æ’å…¥å†…å­˜å±éšœåç”Ÿæˆçš„æŒ‡ä»¤åºåˆ—ç¤ºæ„å›¾ï¼š ä¸‹é¢æ˜¯åœ¨ä¿å®ˆç­–ç•¥ä¸‹ï¼Œvolatile è¯»æ“ä½œ æ’å…¥å†…å­˜å±éšœåç”Ÿæˆçš„æŒ‡ä»¤åºåˆ—ç¤ºæ„å›¾ï¼š ä¸Šè¿° volatile å†™æ“ä½œå’Œ volatile è¯»æ“ä½œçš„å†…å­˜å±éšœæ’å…¥ç­–ç•¥éå¸¸ä¿å®ˆã€‚åœ¨å®é™…æ‰§è¡Œæ—¶ï¼Œåªè¦ä¸æ”¹å˜ volatile å†™-è¯»çš„å†…å­˜è¯­ä¹‰ï¼Œç¼–è¯‘å™¨å¯ä»¥æ ¹æ®å…·ä½“æƒ…å†µçœç•¥ä¸å¿…è¦çš„å±éšœã€‚ é”é”é‡Šæ”¾å’Œè·å–çš„å†…å­˜è¯­ä¹‰å½“çº¿ç¨‹é‡Šæ”¾é”æ—¶ï¼ŒJMM ä¼šæŠŠè¯¥çº¿ç¨‹å¯¹åº”çš„æœ¬åœ°å†…å­˜ä¸­çš„å…±äº«å˜é‡åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ã€‚ å½“çº¿ç¨‹è·å–é”æ—¶ï¼ŒJMM ä¼šæŠŠè¯¥çº¿ç¨‹å¯¹åº”çš„æœ¬åœ°å†…å­˜ç½®ä¸ºæ— æ•ˆã€‚ä»è€Œä½¿å¾—è¢«ç›‘è§†å™¨ä¿æŠ¤çš„ä¸´ç•ŒåŒºä»£ç å¿…é¡»è¦ä»ä¸»å†…å­˜ä¸­å»è¯»å–å…±äº«å˜é‡ã€‚ é”å†…å­˜è¯­ä¹‰çš„å®ç°å€ŸåŠ© ReentrantLock æ¥è®²è§£ï¼ŒPSï¼š åé¢ä¸“é—¨è®²ä¸‹è¿™å—ï¼ˆReentrantLockã€Synchronizedã€å…¬å¹³é”ã€éå…¬å¹³é”ã€AQSç­‰ï¼‰ï¼Œå¯ä»¥çœ‹çœ‹å¤§æ˜å“¥çš„åšå®¢ï¼šhttp://cmsblogs.com/?p=2210 concurrent åŒ…çš„å®ç°å¦‚æœæˆ‘ä»¬ä»”ç»†åˆ†æ concurrent åŒ…çš„æºä»£ç å®ç°ï¼Œä¼šå‘ç°ä¸€ä¸ªé€šç”¨åŒ–çš„å®ç°æ¨¡å¼ï¼š é¦–å…ˆï¼Œå£°æ˜å…±äº«å˜é‡ä¸º volatileï¼› ç„¶åï¼Œä½¿ç”¨ CAS çš„åŸå­æ¡ä»¶æ›´æ–°æ¥å®ç°çº¿ç¨‹ä¹‹é—´çš„åŒæ­¥ï¼› åŒæ—¶ï¼Œé…åˆä»¥ volatile çš„è¯»/å†™å’Œ CAS æ‰€å…·æœ‰çš„ volatile è¯»å’Œå†™çš„å†…å­˜è¯­ä¹‰æ¥å®ç°çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚ AQSï¼Œéé˜»å¡æ•°æ®ç»“æ„å’ŒåŸå­å˜é‡ç±»ï¼ˆjava.util.concurrent.atomic åŒ…ä¸­çš„ç±»ï¼‰ï¼Œè¿™äº› concurrent åŒ…ä¸­çš„åŸºç¡€ç±»éƒ½æ˜¯ä½¿ç”¨è¿™ç§æ¨¡å¼æ¥å®ç°çš„ï¼Œè€Œ concurrent åŒ…ä¸­çš„é«˜å±‚ç±»åˆæ˜¯ä¾èµ–äºè¿™äº›åŸºç¡€ç±»æ¥å®ç°çš„ã€‚ä»æ•´ä½“æ¥çœ‹ï¼Œconcurrent åŒ…çš„å®ç°ç¤ºæ„å›¾å¦‚ä¸‹ï¼š finalå¯¹äº final åŸŸï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨è¦éµå®ˆä¸¤ä¸ªé‡æ’åºè§„åˆ™ï¼š åœ¨æ„é€ å‡½æ•°å†…å¯¹ä¸€ä¸ª final åŸŸçš„å†™å…¥ï¼Œä¸éšåæŠŠè¿™ä¸ªè¢«æ„é€ å¯¹è±¡çš„å¼•ç”¨èµ‹å€¼ç»™ä¸€ä¸ªå¼•ç”¨å˜é‡ï¼Œè¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´ä¸èƒ½é‡æ’åºã€‚ åˆæ¬¡è¯»ä¸€ä¸ªåŒ…å« final åŸŸçš„å¯¹è±¡çš„å¼•ç”¨ï¼Œä¸éšååˆæ¬¡è¯»è¿™ä¸ª final åŸŸï¼Œè¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´ä¸èƒ½é‡æ’åºã€‚ å†™ final åŸŸçš„é‡æ’åºè§„åˆ™å†™ final åŸŸçš„é‡æ’åºè§„åˆ™ç¦æ­¢æŠŠ final åŸŸçš„å†™é‡æ’åºåˆ°æ„é€ å‡½æ•°ä¹‹å¤–ã€‚è¿™ä¸ªè§„åˆ™çš„å®ç°åŒ…å«ä¸‹é¢2ä¸ªæ–¹é¢ï¼š JMM ç¦æ­¢ç¼–è¯‘å™¨æŠŠ final åŸŸçš„å†™é‡æ’åºåˆ°æ„é€ å‡½æ•°ä¹‹å¤–ã€‚ ç¼–è¯‘å™¨ä¼šåœ¨ final åŸŸçš„å†™ä¹‹åï¼Œæ„é€ å‡½æ•° return ä¹‹å‰ï¼Œæ’å…¥ä¸€ä¸ª StoreStore å±éšœã€‚è¿™ä¸ªå±éšœç¦æ­¢å¤„ç†å™¨æŠŠ final åŸŸçš„å†™é‡æ’åºåˆ°æ„é€ å‡½æ•°ä¹‹å¤–ã€‚ è¯» final åŸŸçš„é‡æ’åºè§„åˆ™åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œåˆæ¬¡è¯»å¯¹è±¡å¼•ç”¨ä¸åˆæ¬¡è¯»è¯¥å¯¹è±¡åŒ…å«çš„ final åŸŸï¼ŒJMM ç¦æ­¢å¤„ç†å™¨é‡æ’åºè¿™ä¸¤ä¸ªæ“ä½œï¼ˆæ³¨æ„ï¼Œè¿™ä¸ªè§„åˆ™ä»…ä»…é’ˆå¯¹å¤„ç†å™¨ï¼‰ã€‚ç¼–è¯‘å™¨ä¼šåœ¨è¯» final åŸŸæ“ä½œçš„å‰é¢æ’å…¥ä¸€ä¸ª LoadLoad å±éšœã€‚ final åŸŸæ˜¯å¼•ç”¨ç±»å‹å¯¹äºå¼•ç”¨ç±»å‹ï¼Œå†™ final åŸŸçš„é‡æ’åºè§„åˆ™å¯¹ç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¢åŠ äº†å¦‚ä¸‹çº¦æŸï¼š åœ¨æ„é€ å‡½æ•°å†…å¯¹ä¸€ä¸ª final å¼•ç”¨çš„å¯¹è±¡çš„æˆå‘˜åŸŸçš„å†™å…¥ï¼Œä¸éšååœ¨æ„é€ å‡½æ•°å¤–æŠŠè¿™ä¸ªè¢«æ„é€ å¯¹è±¡çš„å¼•ç”¨èµ‹å€¼ç»™ä¸€ä¸ªå¼•ç”¨å˜é‡ï¼Œè¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´ä¸èƒ½é‡æ’åºã€‚ æ€»ç»“JMMï¼Œå¤„ç†å™¨å†…å­˜æ¨¡å‹ä¸é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹ä¹‹é—´çš„å…³ç³»JMM æ˜¯ä¸€ä¸ªè¯­è¨€çº§çš„å†…å­˜æ¨¡å‹ï¼Œå¤„ç†å™¨å†…å­˜æ¨¡å‹æ˜¯ç¡¬ä»¶çº§çš„å†…å­˜æ¨¡å‹ï¼Œé¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹æ˜¯ä¸€ä¸ªç†è®ºå‚è€ƒæ¨¡å‹ã€‚ä¸‹é¢æ˜¯è¯­è¨€å†…å­˜æ¨¡å‹ï¼Œå¤„ç†å™¨å†…å­˜æ¨¡å‹å’Œé¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹çš„å¼ºå¼±å¯¹æ¯”ç¤ºæ„å›¾ï¼š JMM çš„è®¾è®¡ç¤ºæ„å›¾ JMM çš„å†…å­˜å¯è§æ€§ä¿è¯Java ç¨‹åºçš„å†…å­˜å¯è§æ€§ä¿è¯æŒ‰ç¨‹åºç±»å‹å¯ä»¥åˆ†ä¸ºä¸‹åˆ—ä¸‰ç±»ï¼š 1.å•çº¿ç¨‹ç¨‹åºã€‚å•çº¿ç¨‹ç¨‹åºä¸ä¼šå‡ºç°å†…å­˜å¯è§æ€§é—®é¢˜ã€‚ç¼–è¯‘å™¨ï¼Œruntime å’Œå¤„ç†å™¨ä¼šå…±åŒç¡®ä¿å•çº¿ç¨‹ç¨‹åºçš„æ‰§è¡Œç»“æœä¸è¯¥ç¨‹åºåœ¨é¡ºåºä¸€è‡´æ€§æ¨¡å‹ä¸­çš„æ‰§è¡Œç»“æœç›¸åŒã€‚ 2.æ­£ç¡®åŒæ­¥çš„å¤šçº¿ç¨‹ç¨‹åºã€‚æ­£ç¡®åŒæ­¥çš„å¤šçº¿ç¨‹ç¨‹åºçš„æ‰§è¡Œå°†å…·æœ‰é¡ºåºä¸€è‡´æ€§ï¼ˆç¨‹åºçš„æ‰§è¡Œç»“æœä¸è¯¥ç¨‹åºåœ¨é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹ä¸­çš„æ‰§è¡Œç»“æœç›¸åŒï¼‰ã€‚è¿™æ˜¯ JMM å…³æ³¨çš„é‡ç‚¹ï¼ŒJMMé€šè¿‡é™åˆ¶ç¼–è¯‘å™¨å’Œå¤„ç†å™¨çš„é‡æ’åºæ¥ä¸ºç¨‹åºå‘˜æä¾›å†…å­˜å¯è§æ€§ä¿è¯ã€‚ 3.æœªåŒæ­¥/æœªæ­£ç¡®åŒæ­¥çš„å¤šçº¿ç¨‹ç¨‹åºã€‚JMM ä¸ºå®ƒä»¬æä¾›äº†æœ€å°å®‰å…¨æ€§ä¿éšœï¼šçº¿ç¨‹æ‰§è¡Œæ—¶è¯»å–åˆ°çš„å€¼ï¼Œè¦ä¹ˆæ˜¯ä¹‹å‰æŸä¸ªçº¿ç¨‹å†™å…¥çš„å€¼ï¼Œè¦ä¹ˆæ˜¯é»˜è®¤å€¼ï¼ˆ0ï¼Œnullï¼Œfalseï¼‰ã€‚ ä¸‹å›¾å±•ç¤ºäº†è¿™ä¸‰ç±»ç¨‹åºåœ¨ JMM ä¸­ä¸åœ¨é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹ä¸­çš„æ‰§è¡Œç»“æœçš„å¼‚åŒï¼š","tags":[{"name":"Java","slug":"Java","permalink":"http://www.54tianzhisheng.cn/tags/Java/"},{"name":"JMM","slug":"JMM","permalink":"http://www.54tianzhisheng.cn/tags/JMM/"}]},{"title":"RocketMQç³»åˆ—æ–‡ç« ï¼ˆä¸‰ï¼‰ï¼šRocketMQ ç®€å•çš„æ¶ˆæ¯ç¤ºä¾‹","date":"2018-02-06T16:00:00.000Z","path":"2018/02/07/rocketmq-example/","text":"ä½¿ç”¨ RocketMQ ä»¥ä¸‰ç§æ–¹å¼å‘é€æ¶ˆæ¯ï¼šå¯é çš„åŒæ­¥ï¼Œå¯é çš„å¼‚æ­¥å’Œå•å‘ä¼ è¾“ã€‚ SpringBoot ç³»åˆ—æ–‡ç«  å¯é çš„åŒæ­¥ä¼ è¾“åº”ç”¨ï¼šå¯é çš„åŒæ­¥ä¼ è¾“å¹¿æ³›åº”ç”¨äºé‡è¦é€šçŸ¥æ¶ˆæ¯ï¼ŒçŸ­ä¿¡é€šçŸ¥ï¼ŒçŸ­ä¿¡è¥é”€ç³»ç»Ÿç­‰ã€‚ 12345678910111213141516171819202122public class SyncProducer &#123; public static void main(String[] args) throws Exception &#123; //Instantiate with a producer group name. DefaultMQProducer producer = new DefaultMQProducer(\"please_rename_unique_group_name\"); //Launch the instance. producer.start(); for (int i = 0; i &lt; 100; i++) &#123; //Create a message instance, specifying topic, tag and message body. Message msg = new Message(\"TopicTest\" /* Topic */, \"TagA\" /* Tag */, (\"Hello RocketMQ \" + i).getBytes(RemotingHelper.DEFAULT_CHARSET) /* Message body */ ); //Call send message to deliver message to one of brokers. SendResult sendResult = producer.send(msg); System.out.printf(\"%s%n\", sendResult); &#125; //Shut down once the producer instance is not longer in use. producer.shutdown(); &#125;&#125; å¯é çš„å¼‚æ­¥ä¼ è¾“åº”ç”¨ï¼šå¼‚æ­¥ä¼ è¾“ä¸€èˆ¬ç”¨äºå“åº”æ—¶é—´æ•æ„Ÿçš„ä¸šåŠ¡åœºæ™¯ã€‚ 12345678910111213141516171819202122232425262728293031public class AsyncProducer &#123; public static void main(String[] args) throws Exception &#123; //Instantiate with a producer group name. DefaultMQProducer producer = new DefaultMQProducer(\"ExampleProducerGroup\"); //Launch the instance. producer.start(); producer.setRetryTimesWhenSendAsyncFailed(0); for (int i = 0; i &lt; 100; i++) &#123; final int index = i; //Create a message instance, specifying topic, tag and message body. Message msg = new Message(\"TopicTest\", \"TagA\", \"OrderID188\", \"Hello world\".getBytes(RemotingHelper.DEFAULT_CHARSET)); producer.send(msg, new SendCallback() &#123; @Override public void onSuccess(SendResult sendResult) &#123; System.out.printf(\"%-10d OK %s %n\", index, sendResult.getMsgId()); &#125; @Override public void onException(Throwable e) &#123; System.out.printf(\"%-10d Exception %s %n\", index, e); e.printStackTrace(); &#125; &#125;); &#125; //Shut down once the producer instance is not longer in use. producer.shutdown(); &#125;&#125; å•å‘ä¼ è¾“åº”ç”¨ï¼šå•å‘ä¼ è¾“ç”¨äºéœ€è¦ä¸­ç­‰å¯é æ€§çš„æƒ…å†µï¼Œä¾‹å¦‚æ—¥å¿—æ”¶é›†ã€‚ 123456789101112131415161718192021public class OnewayProducer &#123; public static void main(String[] args) throws Exception&#123; //Instantiate with a producer group name. DefaultMQProducer producer = new DefaultMQProducer(\"ExampleProducerGroup\"); //Launch the instance. producer.start(); for (int i = 0; i &lt; 100; i++) &#123; //Create a message instance, specifying topic, tag and message body. Message msg = new Message(\"TopicTest\" /* Topic */, \"TagA\" /* Tag */, (\"Hello RocketMQ \" + i).getBytes(RemotingHelper.DEFAULT_CHARSET) /* Message body */ ); //Call send message to deliver message to one of brokers. producer.sendOneway(msg); &#125; //Shut down once the producer instance is not longer in use. producer.shutdown(); &#125;&#125; å…³æ³¨æˆ‘ æ€»ç»“æœ¬æ–‡æ˜¯ RocketMQ çš„ä¸‰ç§å‘é€æ¶ˆæ¯çš„æ–¹å¼ã€‚ è½¬å‘è¯·æ³¨æ˜åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2018/02/07/rocketmq-example/","tags":[{"name":"RocketMQ","slug":"RocketMQ","permalink":"http://www.54tianzhisheng.cn/tags/RocketMQ/"}]},{"title":"Spring Bootç³»åˆ—æ–‡ç« ï¼ˆå…­ï¼‰ï¼šSpringBoot RocketMQ æ•´åˆä½¿ç”¨å’Œç›‘æ§","date":"2018-02-06T16:00:00.000Z","path":"2018/02/07/SpringBoot-RocketMQ/","text":"å‰æé€šè¿‡å‰é¢ä¸¤ç¯‡æ–‡ç« å¯ä»¥ç®€å•çš„äº†è§£ RocketMQ å’Œ å®‰è£… RocketMQ ï¼Œä»Šå¤©å°±å°† SpringBoot å’Œ RocketMQ æ•´åˆèµ·æ¥ä½¿ç”¨ã€‚ SpringBoot ç³»åˆ—æ–‡ç«  ç›¸å…³æ–‡ç« 1ã€SpringBoot Kafka æ•´åˆä½¿ç”¨ 2ã€SpringBoot RabbitMQ æ•´åˆä½¿ç”¨ 3ã€SpringBoot ActiveMQ æ•´åˆä½¿ç”¨ 4ã€Kafka å®‰è£…åŠå¿«é€Ÿå…¥é—¨ 5ã€SpringBoot RabbitMQ æ•´åˆè¿›é˜¶ç‰ˆ 6ã€RocketMQ åˆæ¢ 7ã€RocketMQ å®‰è£…åŠå¿«é€Ÿå…¥é—¨ å…³æ³¨æˆ‘ è½¬è½½è¯·åŠ¡å¿…æ³¨æ˜åŸåˆ›åœ°å€ä¸ºï¼šhttp://www.54tianzhisheng.cn/2018/02/07/SpringBoot-RocketMQ/ åˆ›å»ºé¡¹ç›®åœ¨ IDEA åˆ›å»ºä¸€ä¸ª SpringBoot é¡¹ç›®ï¼Œé¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š pom æ–‡ä»¶å¼•å…¥ RocketMQ çš„ä¸€äº›ç›¸å…³ä¾èµ–ï¼Œæœ€åçš„ pom æ–‡ä»¶å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;com.zhisheng&lt;/groupId&gt; &lt;artifactId&gt;rocketmq&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;packaging&gt;jar&lt;/packaging&gt; &lt;name&gt;rocketmq&lt;/name&gt; &lt;description&gt;Demo project for Spring Boot RocketMQ&lt;/description&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;1.5.9.RELEASE&lt;/version&gt; &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt; &lt;/parent&gt; &lt;properties&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.rocketmq&lt;/groupId&gt; &lt;artifactId&gt;rocketmq-common&lt;/artifactId&gt; &lt;version&gt;4.2.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.rocketmq&lt;/groupId&gt; &lt;artifactId&gt;rocketmq-client&lt;/artifactId&gt; &lt;version&gt;4.2.0&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt;&lt;/project&gt; é…ç½®æ–‡ä»¶application.properties ä¸­å¦‚ä¸‹ï¼š 123456# æ¶ˆè´¹è€…çš„ç»„åapache.rocketmq.consumer.PushConsumer=PushConsumer# ç”Ÿäº§è€…çš„ç»„åapache.rocketmq.producer.producerGroup=Producer# NameServeråœ°å€apache.rocketmq.namesrvAddr=localhost:9876 ç”Ÿäº§è€…1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162package com.zhisheng.rocketmq.client;import org.apache.rocketmq.client.producer.DefaultMQProducer;import org.apache.rocketmq.common.message.Message;import org.apache.rocketmq.remoting.common.RemotingHelper;import org.springframework.beans.factory.annotation.Value;import org.springframework.stereotype.Component;import org.springframework.util.StopWatch;import javax.annotation.PostConstruct;/** * Created by zhisheng_tian on 2018/2/6 */@Componentpublic class RocketMQClient &#123; /** * ç”Ÿäº§è€…çš„ç»„å */ @Value(\"$&#123;apache.rocketmq.producer.producerGroup&#125;\") private String producerGroup; /** * NameServer åœ°å€ */ @Value(\"$&#123;apache.rocketmq.namesrvAddr&#125;\") private String namesrvAddr; @PostConstruct public void defaultMQProducer() &#123; //ç”Ÿäº§è€…çš„ç»„å DefaultMQProducer producer = new DefaultMQProducer(producerGroup); //æŒ‡å®šNameServeråœ°å€ï¼Œå¤šä¸ªåœ°å€ä»¥ ; éš”å¼€ producer.setNamesrvAddr(namesrvAddr); try &#123; /** * Producerå¯¹è±¡åœ¨ä½¿ç”¨ä¹‹å‰å¿…é¡»è¦è°ƒç”¨startåˆå§‹åŒ–ï¼Œåˆå§‹åŒ–ä¸€æ¬¡å³å¯ * æ³¨æ„ï¼šåˆ‡è®°ä¸å¯ä»¥åœ¨æ¯æ¬¡å‘é€æ¶ˆæ¯æ—¶ï¼Œéƒ½è°ƒç”¨startæ–¹æ³• */ producer.start(); //åˆ›å»ºä¸€ä¸ªæ¶ˆæ¯å®ä¾‹ï¼ŒåŒ…å« topicã€tag å’Œ æ¶ˆæ¯ä½“ //å¦‚ä¸‹ï¼štopic ä¸º \"TopicTest\"ï¼Œtag ä¸º \"push\" Message message = new Message(\"TopicTest\", \"push\", \"å‘é€æ¶ˆæ¯----zhisheng-----\".getBytes(RemotingHelper.DEFAULT_CHARSET)); StopWatch stop = new StopWatch(); stop.start(); for (int i = 0; i &lt; 10000; i++) &#123; SendResult result = producer.send(message); System.out.println(\"å‘é€å“åº”ï¼šMsgId:\" + result.getMsgId() + \"ï¼Œå‘é€çŠ¶æ€:\" + result.getSendStatus()); &#125; stop.stop(); System.out.println(\"----------------å‘é€ä¸€ä¸‡æ¡æ¶ˆæ¯è€—æ—¶ï¼š\" + stop.getTotalTimeMillis()); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; finally &#123; producer.shutdown(); &#125; &#125;&#125; æ¶ˆè´¹è€…123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566package com.zhisheng.rocketmq.server;import org.apache.rocketmq.client.consumer.DefaultMQPushConsumer;import org.apache.rocketmq.client.consumer.listener.ConsumeConcurrentlyStatus;import org.apache.rocketmq.client.consumer.listener.MessageListenerConcurrently;import org.apache.rocketmq.common.consumer.ConsumeFromWhere;import org.apache.rocketmq.common.message.MessageExt;import org.apache.rocketmq.remoting.common.RemotingHelper;import org.springframework.beans.factory.annotation.Value;import org.springframework.stereotype.Component;import javax.annotation.PostConstruct;/** * Created by zhisheng_tian on 2018/2/6 */@Componentpublic class RocketMQServer &#123; /** * æ¶ˆè´¹è€…çš„ç»„å */ @Value(\"$&#123;apache.rocketmq.consumer.PushConsumer&#125;\") private String consumerGroup; /** * NameServer åœ°å€ */ @Value(\"$&#123;apache.rocketmq.namesrvAddr&#125;\") private String namesrvAddr; @PostConstruct public void defaultMQPushConsumer() &#123; //æ¶ˆè´¹è€…çš„ç»„å DefaultMQPushConsumer consumer = new DefaultMQPushConsumer(consumerGroup); //æŒ‡å®šNameServeråœ°å€ï¼Œå¤šä¸ªåœ°å€ä»¥ ; éš”å¼€ consumer.setNamesrvAddr(namesrvAddr); try &#123; //è®¢é˜…PushTopicä¸‹Tagä¸ºpushçš„æ¶ˆæ¯ consumer.subscribe(\"TopicTest\", \"push\"); //è®¾ç½®Consumerç¬¬ä¸€æ¬¡å¯åŠ¨æ˜¯ä»é˜Ÿåˆ—å¤´éƒ¨å¼€å§‹æ¶ˆè´¹è¿˜æ˜¯é˜Ÿåˆ—å°¾éƒ¨å¼€å§‹æ¶ˆè´¹ //å¦‚æœéç¬¬ä¸€æ¬¡å¯åŠ¨ï¼Œé‚£ä¹ˆæŒ‰ç…§ä¸Šæ¬¡æ¶ˆè´¹çš„ä½ç½®ç»§ç»­æ¶ˆè´¹ consumer.setConsumeFromWhere(ConsumeFromWhere.CONSUME_FROM_FIRST_OFFSET); consumer.registerMessageListener((MessageListenerConcurrently) (list, context) -&gt; &#123; try &#123; for (MessageExt messageExt : list) &#123; System.out.println(\"messageExt: \" + messageExt);//è¾“å‡ºæ¶ˆæ¯å†…å®¹ String messageBody = new String(messageExt.getBody(), RemotingHelper.DEFAULT_CHARSET); System.out.println(\"æ¶ˆè´¹å“åº”ï¼šmsgId : \" + messageExt.getMsgId() + \", msgBody : \" + messageBody);//è¾“å‡ºæ¶ˆæ¯å†…å®¹ &#125; &#125; catch (Exception e) &#123; e.printStackTrace(); return ConsumeConcurrentlyStatus.RECONSUME_LATER; //ç¨åå†è¯• &#125; return ConsumeConcurrentlyStatus.CONSUME_SUCCESS; //æ¶ˆè´¹æˆåŠŸ &#125;); consumer.start(); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125;&#125; å¯åŠ¨ç±»123456789101112package com.zhisheng.rocketmq;import org.springframework.boot.SpringApplication;import org.springframework.boot.autoconfigure.SpringBootApplication;@SpringBootApplicationpublic class RocketmqApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(RocketmqApplication.class, args); &#125;&#125; RocketMQä»£ç å·²ç»éƒ½å†™å¥½äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦å°†ä¸ RocketMQ æœ‰å…³çš„å¯åŠ¨èµ·æ¥ã€‚ å¯åŠ¨ Name Serveråœ¨å‰é¢æ–‡ç« ä¸­å·²ç»å†™è¿‡æ€ä¹ˆå¯åŠ¨ï¼Œhttp://www.54tianzhisheng.cn/2018/02/06/RocketMQ-install/#%E5%90%AF%E5%8A%A8-NameServer è¿›å…¥åˆ°ç›®å½• ï¼š 1cd distribution/target/apache-rocketmq å¯åŠ¨ï¼š 123nohup sh bin/mqnamesrv &amp;tail -f ~/logs/rocketmqlogs/namesrv.log //é€šè¿‡æ—¥å¿—æŸ¥çœ‹æ˜¯å¦å¯åŠ¨æˆåŠŸ å¯åŠ¨ Broker123nohup sh bin/mqbroker -n localhost:9876 &amp;tail -f ~/logs/rocketmqlogs/broker.log //é€šè¿‡æ—¥å¿—æŸ¥çœ‹æ˜¯å¦å¯åŠ¨æˆåŠŸ ç„¶åè¿è¡Œå¯åŠ¨ç±»ï¼Œè¿è¡Œæ•ˆæœå¦‚ä¸‹ï¼š ç›‘æ§RocketMQæœ‰ä¸€ä¸ªå¯¹å…¶æ‰©å±•çš„å¼€æºé¡¹ç›® ocketmq-console ï¼Œå¦‚ä»Šä¹Ÿæäº¤ç»™äº† Apache ï¼Œåœ°å€åœ¨ï¼šhttps://github.com/apache/rocketmq-externals/tree/master/rocketmq-console ï¼Œå®˜æ–¹ä¹Ÿç»™å‡ºäº†å…¶æ”¯æŒçš„åŠŸèƒ½çš„ä¸­æ–‡æ–‡æ¡£ï¼šhttps://github.com/apache/rocketmq-externals/blob/master/rocketmq-console/doc/1_0_0/UserGuide_CN.md ï¼Œ é‚£ä¹ˆè¯¥å¦‚ä½•å®‰è£…ï¼Ÿ Docker å®‰è£…1ã€è·å– Docker é•œåƒ 1docker pull styletang/rocketmq-console-ng 2ã€è¿è¡Œï¼Œæ³¨æ„å°†ä½ è‡ªå·±çš„ NameServer åœ°å€æ›¿æ¢ä¸‹é¢çš„ 127.0.0.1 1docker run -e &quot;JAVA_OPTS=-Drocketmq.namesrv.addr=127.0.0.1:9876 -Dcom.rocketmq.sendMessageWithVIPChannel=false&quot; -p 8080:8080 -t styletang/rocketmq-console-ng é Docker å®‰è£…æˆ‘ä»¬ git clone ä¸€ä»½ä»£ç åˆ°æœ¬åœ°ï¼š 123git clone https://github.com/apache/rocketmq-externals.gitcd rocketmq-externals/rocketmq-console/ éœ€è¦ jdk 1.7 ä»¥ä¸Šã€‚ æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š 1mvn spring-boot:run æˆ–è€… 123mvn clean package -Dmaven.test.skip=truejava -jar target/rocketmq-console-ng-1.0.0.jar æ³¨æ„ï¼š 1ã€å¦‚æœä½ ä¸‹è½½ä¾èµ–ç¼“æ…¢ï¼Œä½ å¯ä»¥é‡æ–°è®¾ç½® maven çš„ mirror ä¸ºé˜¿é‡Œäº‘çš„é•œåƒ 12345678&lt;mirrors&gt; &lt;mirror&gt; &lt;id&gt;alimaven&lt;/id&gt; &lt;name&gt;aliyun maven&lt;/name&gt; &lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public/&lt;/url&gt; &lt;mirrorOf&gt;central&lt;/mirrorOf&gt; &lt;/mirror&gt;&lt;/mirrors&gt; 2ã€å¦‚æœä½ ä½¿ç”¨çš„ RocketMQ ç‰ˆæœ¬å°äº 3.5.8ï¼Œå¦‚æœæ‚¨ä½¿ç”¨ rocketmq &lt; 3.5.8ï¼Œè¯·åœ¨å¯åŠ¨ rocketmq-console-ng æ—¶æ·»åŠ  -Dcom.rocketmq.sendMessageWithVIPChannel = falseï¼ˆæˆ–è€…æ‚¨å¯ä»¥åœ¨ ops é¡µé¢ä¸­æ›´æ”¹å®ƒï¼‰ 3ã€æ›´æ”¹ resource / application.properties ä¸­çš„ rocketmq.config.namesrvAddrï¼ˆæˆ–è€…å¯ä»¥åœ¨opsé¡µé¢ä¸­æ›´æ”¹å®ƒï¼‰ é”™è¯¯è§£å†³æ–¹æ³•1ã€Docker å¯åŠ¨é¡¹ç›®æŠ¥é”™ org.apache.rocketmq.remoting.exception.RemotingConnectException: connect to &lt;null&gt; failed å°† Docker å¯åŠ¨å‘½ä»¤æ”¹æˆå¦‚ä¸‹ä»¥åï¼š 1docker run -e &quot;JAVA_OPTS=-Drocketmq.config.namesrvAddr=127.0.0.1:9876 -Drocketmq.config.isVIPChannel=false&quot; -p 8080:8080 -t styletang/rocketmq-console-ng æŠ¥é”™ä¿¡æ¯æ”¹å˜äº†ï¼Œæ–°çš„æŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼š 123ERROR op=global_exception_handler_print_errororg.apache.rocketmq.console.exception.ServiceException: This date have&apos;t data! çœ‹åˆ°ç½‘ä¸Šæœ‰äººä¹Ÿé‡åˆ°è¿™ä¸ªé—®é¢˜ï¼Œä»–ä»¬éƒ½é€šè¿‡è‡ªå·±çš„æ–¹å¼è§£å†³äº†ï¼Œä½†æ˜¯æ–¹æ³•æˆ‘éƒ½è¯•äº†ï¼Œä¸é€‚åˆæˆ‘ã€‚ä¸å¾—ä¸è¯´ï¼Œé˜¿é‡Œï¼Œä½ èƒ½å†ç”¨å¿ƒç‚¹å—ï¼Ÿæ—¢ç„¶æŠŠ RocketMQ æç»™ Apache äº†ï¼Œè¿™äº›æ–‡æ¡£å•¥çš„éƒ½å¿…é¡»æ›´æ–°å•Šï¼Œä¸è¦è¿˜æ»åç€å‘¢ï¼Œä¸ç„¶å°‘ä¸äº†è¢«åæ§½ï¼ æäº†å¾ˆä¹…è¿™ç§æ–¹æ³•æ²¡æˆåŠŸï¼Œæš‚æ—¶æ”¾å¼ƒï¼mmp 2ã€é Docker å®‰è£…ï¼Œåªå¥½æŠŠæºç ç¼–è¯‘æ‰“åŒ…äº†ã€‚ 1) æ³¨æ„éœ€è¦ä¿®æ”¹å¦‚ä¸‹å›¾ä¸­çš„é…ç½®ï¼š 1234rocketmq.config.namesrvAddr=localhost:9876 //æ³¨æ„æ›¿æ¢ä½ è‡ªå·±çš„ip#å¦‚æœä½  rocketmq ç‰ˆæœ¬å°äº 3.5.8 æ‰éœ€è®¾ç½® `rocketmq.config.isVIPChannel` ä¸º falseï¼Œé»˜è®¤æ˜¯ true, è¿™ä¸ªå¯ä»¥åœ¨æºç ä¸­å¯ä»¥çœ‹åˆ°çš„rocketmq.config.isVIPChannel= 2) æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š 1mvn clean package -Dmaven.test.skip=true ç¼–è¯‘æˆåŠŸï¼š å¯ä»¥çœ‹åˆ°å·²ç»æ‰“å¥½äº† jar åŒ…ï¼š è¿è¡Œï¼š 1java -jar rocketmq-console-ng-1.0.0.jar æˆåŠŸï¼Œä¸æŠ¥é”™äº†ï¼Œå¼€å¿ƒğŸ˜„ï¼Œè®¿é—® http://localhost:8080/ æ•´ä¸ªç›‘æ§å¤§æ¦‚å°±æ˜¯è¿™äº›äº†ã€‚ ç„¶åæˆ‘è¿è¡Œä¹‹å‰çš„ SpringBoot æ•´åˆé¡¹ç›®ï¼ŒæŸ¥çœ‹ç›‘æ§ä¿¡æ¯å¦‚ä¸‹ï¼š æ€»ç»“æ•´ç¯‡æ–‡ç« è®²è¿°äº† SpringBoot ä¸ RocketMQ æ•´åˆå’Œ RocketMQ ç›‘æ§å¹³å°çš„æ­å»ºã€‚ å‚è€ƒæ–‡ç« 1ã€http://www.ymq.io/2018/02/02/spring-boot-rocketmq-example/#%E6%96%B0%E5%8A%A0%E9%A1%B9%E7%9B%AE 2ã€GitHub å®˜æ–¹ README","tags":[{"name":"RocketMQ","slug":"RocketMQ","permalink":"http://www.54tianzhisheng.cn/tags/RocketMQ/"},{"name":"SpringBoot","slug":"SpringBoot","permalink":"http://www.54tianzhisheng.cn/tags/SpringBoot/"}]},{"title":"RocketMQç³»åˆ—æ–‡ç« ï¼ˆäºŒï¼‰ï¼šRocketMQ å®‰è£…åŠå¿«é€Ÿå…¥é—¨","date":"2018-02-05T16:00:00.000Z","path":"2018/02/06/RocketMQ-install/","text":"å¦‚æœä½ å¯¹ RocketMQ è¿˜æ²¡äº†è§£ï¼Œå»ºè®®å…ˆçœ‹ä¸‹ä¸Šä¸€ç¯‡æ–‡ç« ï¼šRocketMQ åˆæ¢ SpringBoot ç³»åˆ—æ–‡ç«  å®‰è£…æ¡ä»¶ 64ä½æ“ä½œç³»ç»Ÿï¼Œå»ºè®®ä½¿ç”¨ Linux / Unix / Mac; 64ä½JDK 1.8+; Maven 3.2.x ä¸‹è½½å’Œæ„å»ºä» https://www.apache.org/dyn/closer.cgi?path=rocketmq/4.2.0/rocketmq-all-4.2.0-source-release.zip ä¸‹è½½ 4.2.0 çš„æºç ç‰ˆæœ¬ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥è§£å‹4.2.0æºç ç‰ˆæœ¬å¹¶æ„å»ºäºŒè¿›åˆ¶æ–‡ä»¶ã€‚ 12345unzip rocketmq-all-4.2.0-source-release.zipcd rocketmq-all-4.2.0/mvn -Prelease-all -DskipTests clean install -U æ„å»ºæˆåŠŸå¦‚ä¸‹ï¼š è¿›å…¥åˆ°ç›®å½• ï¼š 1cd distribution/target/apache-rocketmq å¯åŠ¨ NameServer123nohup sh bin/mqnamesrv &amp;tail -f ~/logs/rocketmqlogs/namesrv.log ç»“æœå¦‚ä¸‹å°±ä»£è¡¨å¯åŠ¨æˆåŠŸäº†ï¼š å¯åŠ¨ Broker123nohup sh bin/mqbroker -n localhost:9876 &amp;tail -f ~/logs/rocketmqlogs/broker.log ç»“æœå¦‚ä¸‹å°±ä»£è¡¨å¯åŠ¨æˆåŠŸäº†ï¼šä»æ—¥å¿—ä¸­å¯ä»¥çœ‹åˆ° broker æ³¨å†Œåˆ°äº† nameserver ä¸Šäº†ï¼ˆlocalhost:9876ï¼‰ å‘é€å’Œæ¥æ”¶æ¶ˆæ¯åœ¨å‘é€/æ¥æ”¶æ¶ˆæ¯ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å‘Šè¯‰å®¢æˆ·åç§°æœåŠ¡å™¨çš„ä½ç½®ã€‚RocketMQ æä¾›äº†å¤šç§æ–¹æ³•æ¥å®ç°è¿™ä¸€ç‚¹ã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬ä½¿ç”¨ç¯å¢ƒå˜é‡NAMESRV_ADDR å‘é€æ¶ˆæ¯123export NAMESRV_ADDR=localhost:9876sh bin/tools.sh org.apache.rocketmq.example.quickstart.Producer æ¥æ”¶æ¶ˆæ¯1sh bin/tools.sh org.apache.rocketmq.example.quickstart.Consumer å…³é—­æœåŠ¡å™¨123sh bin/mqshutdown broker //åœæ­¢ brokersh bin/mqshutdown namesrv //åœæ­¢ nameserver å…³é—­æˆåŠŸåå¦‚ä¸‹ï¼š å¸¸ç”¨å‘½ä»¤ä¸Šé¢å‡ ä¸ªå¯åŠ¨å’Œå…³é—­ name server å’Œ broker çš„å°±ä¸å†è¯´äº†ï¼Œ æŸ¥çœ‹é›†ç¾¤æƒ…å†µ ./mqadmin clusterList -n 127.0.0.1:9876 æŸ¥çœ‹ broker çŠ¶æ€ ./mqadmin brokerStatus -n 127.0.0.1:9876 -b 172.20.1.138:10911 (æ³¨æ„æ¢æˆä½ çš„ broker åœ°å€) æŸ¥çœ‹ topic åˆ—è¡¨ ./mqadmin topicList -n 127.0.0.1:9876 æŸ¥çœ‹ topic çŠ¶æ€ ./mqadmin topicStatus -n 127.0.0.1:9876 -t MyTopic (æ¢æˆä½ æƒ³æŸ¥è¯¢çš„ topic) æŸ¥çœ‹ topic è·¯ç”± ./mqadmin topicRoute -n 127.0.0.1:9876 -t MyTopic å…³æ³¨æˆ‘ æ€»ç»“æœ¬æ–‡æ˜¯ RocketMQ çš„å®‰è£…åŠå¿«é€Ÿå…¥é—¨æ¡ˆä¾‹ã€‚ è½¬å‘è¯·æ³¨æ˜åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2018/02/06/RocketMQ-install/","tags":[{"name":"RocketMQ","slug":"RocketMQ","permalink":"http://www.54tianzhisheng.cn/tags/RocketMQ/"}]},{"title":"RocketMQç³»åˆ—æ–‡ç« ï¼ˆä¸€ï¼‰ï¼šRocketMQ åˆæ¢","date":"2018-02-04T16:00:00.000Z","path":"2018/02/05/RocketMQ/","text":"ä»‹ç»RocketMQ æ˜¯é˜¿é‡Œå¼€æºçš„æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå‰ä¸ä¹…æçŒ®ç»™äº† Apache ã€‚æ­£å¦‚å®˜ç½‘ä»‹ç»å¦‚ä¸‹ï¼šå®ƒæ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼æ¶ˆæ¯ä¼ é€’å’Œæµå¼æ•°æ®å¹³å°ã€‚ SpringBoot ç³»åˆ—æ–‡ç«  ç‰¹ç‚¹å¦‚ä¸‹ï¼š äº§å“å‘å±•å†å²å¤§çº¦ç»å†äº†ä¸‰ä¸ªä¸»è¦ç‰ˆæœ¬è¿­ä»£ ä¸€ã€Metaqï¼ˆMetamorphosisï¼‰1.x ç”±å¼€æºç¤¾åŒºkillme2008ç»´æŠ¤ï¼Œå¼€æºç¤¾åŒºéå¸¸æ´»è·ƒã€‚ äºŒã€Metaq 2.x äº2012å¹´10æœˆä»½ä¸Šçº¿ï¼Œåœ¨æ·˜å®å†…éƒ¨è¢«å¹¿æ³›ä½¿ç”¨ã€‚ ä¸‰ã€RocketMQ 3.x åŸºäºå…¬å¸å†…éƒ¨å¼€æºå…±å»ºåŸåˆ™ï¼ŒRocketMQ é¡¹ç›®åªç»´æŠ¤æ ¸å¿ƒåŠŸèƒ½ï¼Œä¸”å»é™¤äº†æ‰€æœ‰å…¶ä»–è¿è¡Œæ—¶ä¾èµ–ï¼Œæ ¸å¿ƒåŠŸèƒ½æœ€ç®€åŒ–ã€‚æ¯ä¸ª BU çš„ä¸ªæ€§åŒ–éœ€æ±‚éƒ½åœ¨ RocketMQ é¡¹ç›®ä¹‹ä¸Šè¿›è¡Œæ·±åº¦å®šåˆ¶ã€‚RocketMQ å‘å…¶ä»– BU æä¾›çš„ä»…ä»…æ˜¯ Jar åŒ…ï¼Œä¾‹å¦‚è¦å®šåˆ¶ä¸€ä¸ª Brokerï¼Œé‚£ä¹ˆåªéœ€è¦ä¾èµ– rocketmq-broker è¿™ä¸ª jar åŒ…å³å¯ï¼Œå¯é€šè¿‡ API è¿›è¡Œäº¤äº’ï¼Œå¦‚æœå®šåˆ¶ clientï¼Œåˆ™ä¾èµ– rocketmq-client è¿™ä¸ª jar åŒ…ï¼Œå¯¹å…¶æä¾›çš„ api è¿›è¡Œå†å°è£…ã€‚ åœ¨ RocketMQ é¡¹ç›®åŸºç¡€ä¸Šè¡ç”Ÿçš„é¡¹ç›®å¦‚ä¸‹ com.taobao.metaq v3.0 = RocketMQ + æ·˜å®ä¸ªæ€§åŒ–éœ€æ±‚ ä¸ºæ·˜å®åº”ç”¨æä¾›æ¶ˆæ¯æœåŠ¡ com.alipay.zpullmsg v1.0 =RocketMQ + æ”¯ä»˜å®ä¸ªæ€§åŒ–éœ€æ±‚ ä¸ºæ”¯ä»˜å®åº”ç”¨æä¾›æ¶ˆæ¯æœåŠ¡ com.alibaba.commonmq v1.0 = Notify + RocketMQ + B2Bä¸ªæ€§åŒ–éœ€æ±‚ ä¸º B2B åº”ç”¨æä¾›æ¶ˆæ¯æœåŠ¡ å››ã€RocketMQ 3.x ç›®å‰å®ƒçš„æœ€æ–°ç‰ˆæœ¬æ˜¯ 4.2 ç‰ˆæœ¬ã€‚ æ¦‚å¿µä¸“ä¸šæœ¯è¯­Producer æ¶ˆæ¯ç”Ÿäº§è€…ï¼Œè´Ÿè´£äº§ç”Ÿæ¶ˆæ¯ï¼Œä¸€èˆ¬ç”±ä¸šåŠ¡ç³»ç»Ÿè´Ÿè´£äº§ç”Ÿæ¶ˆæ¯ã€‚ Consumer æ¶ˆæ¯æ¶ˆè´¹è€…ï¼Œè´Ÿè´£æ¶ˆè´¹æ¶ˆæ¯ï¼Œä¸€èˆ¬æ˜¯åå°ç³»ç»Ÿè´Ÿè´£å¼‚æ­¥æ¶ˆè´¹ã€‚ Push Consumer Consumer çš„ä¸€ç§ï¼Œåº”ç”¨é€šå¸¸å‘ Consumer å¯¹è±¡æ³¨å†Œä¸€ä¸ª Listener æ¥å£ï¼Œä¸€æ—¦æ”¶åˆ°æ¶ˆæ¯ï¼ŒConsumer å¯¹è±¡ç«‹åˆ»å›è°ƒ Listener æ¥å£æ–¹æ³•ã€‚ Pull Consumer Consumer çš„ä¸€ç§ï¼Œåº”ç”¨é€šå¸¸ä¸»åŠ¨è°ƒç”¨ Consumer çš„æ‹‰æ¶ˆæ¯æ–¹æ³•ä» Broker æ‹‰æ¶ˆæ¯ï¼Œä¸»åŠ¨æƒç”±åº”ç”¨æ§åˆ¶ã€‚ Producer Group ä¸€ç±» Producer çš„é›†åˆåç§°ï¼Œè¿™ç±» Producer é€šå¸¸å‘é€ä¸€ç±»æ¶ˆæ¯ï¼Œä¸”å‘é€é€»è¾‘ä¸€è‡´ã€‚ Consumer Group ä¸€ç±» Consumer çš„é›†åˆåç§°ï¼Œè¿™ç±» Consumer é€šå¸¸æ¶ˆè´¹ä¸€ç±»æ¶ˆæ¯ï¼Œä¸”æ¶ˆè´¹é€»è¾‘ä¸€è‡´ã€‚ Broker æ¶ˆæ¯ä¸­è½¬è§’è‰²ï¼Œè´Ÿè´£å­˜å‚¨æ¶ˆæ¯ï¼Œè½¬å‘æ¶ˆæ¯ï¼Œä¸€èˆ¬ä¹Ÿç§°ä¸º Serverã€‚åœ¨ JMS è§„èŒƒä¸­ç§°ä¸º Providerã€‚ æ¶æ„ ä»è¿™æ¶æ„å›¾ä¸­å¯ä»¥çœ‹åˆ°å®ƒä¸»è¦ç”±å››éƒ¨åˆ†ç»„æˆï¼šProducerï¼ˆç”Ÿäº§è€…ï¼‰ã€NameServerã€Brokerã€Consumerï¼ˆæ¶ˆè´¹è€…ï¼‰ã€‚ Producerç”Ÿäº§è€…æ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½²ã€‚åˆ†å¸ƒå¼ç”Ÿäº§è€…é€šè¿‡å¤šç§è´Ÿè½½å‡è¡¡æ¨¡å¼å‘ Broker é›†ç¾¤å‘é€æ¶ˆæ¯ã€‚å‘é€è¿‡ç¨‹æ”¯æŒå¿«é€Ÿå¤±è´¥å¹¶å…·æœ‰ä½å»¶è¿Ÿã€‚ NameServerå®ƒæä¾›è½»é‡çº§æœåŠ¡å‘ç°å’Œè·¯ç”±ï¼Œæ¯ä¸ª Name Server è®°å½•å®Œæ•´çš„è·¯ç”±ä¿¡æ¯ï¼Œæä¾›ç›¸åº”çš„è¯»å†™æœåŠ¡ï¼Œæ”¯æŒå¿«é€Ÿå­˜å‚¨æ‰©å±•ã€‚ä¸»è¦åŒ…æ‹¬ä¸¤ä¸ªåŠŸèƒ½ï¼š ä»£ç†ç®¡ç†ï¼Œ NameServer æ¥å—æ¥è‡ª Broker é›†ç¾¤çš„æ³¨å†Œï¼Œå¹¶æä¾›æ£€æµ‹ä»£ç†æ˜¯å¦å­˜åœ¨çš„å¿ƒè·³æœºåˆ¶ã€‚ è·¯ç”±ç®¡ç†ï¼Œæ¯ä¸ª NameServer å°†ä¿å­˜æœ‰å…³ä»£ç†ç¾¤é›†çš„å…¨éƒ¨è·¯ç”±ä¿¡æ¯ä»¥åŠå®¢æˆ·ç«¯æŸ¥è¯¢çš„é˜Ÿåˆ—ä¿¡æ¯ã€‚ æˆ‘ä»¬çŸ¥é“ï¼ŒRocketMQå®¢æˆ·ç«¯ï¼ˆç”Ÿäº§è€…/æ¶ˆè´¹è€…ï¼‰å°†ä»NameServeræŸ¥è¯¢é˜Ÿåˆ—è·¯ç”±ä¿¡æ¯ï¼Œä½†å®¢æˆ·ç«¯å¦‚ä½•æ‰¾åˆ°NameServeråœ°å€ï¼Ÿ å°†NameServeråœ°å€åˆ—è¡¨æä¾›ç»™å®¢æˆ·ç«¯æœ‰å››ç§æ–¹æ³•ï¼š ç¼–ç¨‹æ–¹å¼ï¼Œå°±åƒproducer.setNamesrvAddr(&quot;ip:port&quot;)ã€‚ Javaé€‰é¡¹ï¼Œä½¿ç”¨rocketmq.namesrv.addrã€‚ ç¯å¢ƒå˜é‡ï¼Œä½¿ç”¨NAMESRV_ADDRã€‚ HTTP ç«¯ç‚¹ã€‚ BrokerBroker é€šè¿‡æä¾›è½»é‡çº§çš„ Topic å’Œ Queue æœºåˆ¶æ¥ç…§é¡¾æ¶ˆæ¯å­˜å‚¨ã€‚å®ƒä»¬æ”¯æŒ Push å’Œ Pull æ¨¡å¼ï¼ŒåŒ…å«å®¹é”™æœºåˆ¶ï¼ˆ2ä¸ªæ‹·è´æˆ–è€…3ä¸ªæ‹·è´ï¼‰ï¼Œå¹¶ä¸”æä¾›äº†å¼ºå¤§çš„å³°å€¼å¡«å……å’Œä»¥åŸå§‹æ—¶é—´é¡ºåºç´¯è®¡æ•°åƒäº¿æ¡æ¶ˆæ¯çš„èƒ½åŠ›ã€‚æ­¤å¤–ï¼Œbroker è¿˜æä¾›ç¾éš¾æ¢å¤ï¼Œä¸°å¯Œçš„æŒ‡æ ‡ç»Ÿè®¡æ•°æ®å’Œè­¦æŠ¥æœºåˆ¶ï¼Œè€Œä¼ ç»Ÿçš„æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿéƒ½ç¼ºä¹è¿™äº›æœºåˆ¶ã€‚ å¦‚ä¸Šå›¾ï¼šBroker æœåŠ¡å™¨é‡è¦çš„å­æ¨¡å—ï¼š è¿œç¨‹å¤„ç†æ¨¡å—æ˜¯ broker çš„å…¥å£ï¼Œå¤„ç†æ¥è‡ªå®¢æˆ·çš„è¯·æ±‚ã€‚ Client managerï¼Œç®¡ç†å®¢æˆ·ï¼ˆç”Ÿäº§è€…/æ¶ˆè´¹è€…ï¼‰å¹¶ç»´æŠ¤æ¶ˆè´¹è€…çš„ä¸»é¢˜è®¢é˜…ã€‚ Store Serviceï¼Œæä¾›ç®€å•çš„ API æ¥å­˜å‚¨æˆ–æŸ¥è¯¢ç‰©ç†ç£ç›˜ä¸­çš„æ¶ˆæ¯ã€‚ HA æœåŠ¡ï¼Œæä¾›ä¸»ä»£ç†å’Œä»ä»£ç†ä¹‹é—´çš„æ•°æ®åŒæ­¥åŠŸèƒ½ã€‚ ç´¢å¼•æœåŠ¡ï¼Œé€šè¿‡æŒ‡å®šé”®ä¸ºæ¶ˆæ¯å»ºç«‹ç´¢å¼•ï¼Œå¹¶æä¾›å¿«é€Ÿçš„æ¶ˆæ¯æŸ¥è¯¢ã€‚ Consumeræ¶ˆè´¹è€…ä¹Ÿæ”¯æŒ Push å’Œ Pull æ¨¡å‹ä¸­çš„åˆ†å¸ƒå¼éƒ¨ç½²ã€‚å®ƒè¿˜æ”¯æŒç¾¤é›†æ¶ˆè´¹å’Œæ¶ˆæ¯å¹¿æ’­ã€‚å®ƒæä¾›äº†å®æ—¶çš„æ¶ˆæ¯è®¢é˜…æœºåˆ¶ï¼Œå¯ä»¥æ»¡è¶³å¤§å¤šæ•°æ¶ˆè´¹è€…çš„éœ€æ±‚ã€‚ å…³æ³¨æˆ‘ æ€»ç»“æœ¬æ–‡æ˜¯å¯¹ RocketMQ çš„ç®€å•ç‚¹äº†è§£ï¼Œå‚è€ƒäº†å®˜ç½‘ä»‹ç»ã€‚ è½¬è½½è¯·æ³¨æ˜åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2018/02/05/RocketMQ/","tags":[{"name":"RocketMQ","slug":"RocketMQ","permalink":"http://www.54tianzhisheng.cn/tags/RocketMQ/"}]},{"title":"Spring Bootç³»åˆ—æ–‡ç« ï¼ˆäº”ï¼‰ï¼šSpringBoot RabbitMQ æ•´åˆè¿›é˜¶ç‰ˆ","date":"2018-01-27T16:00:00.000Z","path":"2018/01/28/RabbitMQ/","text":"æ¶ˆæ¯ä¸­é—´ä»¶RabbitMQ æ˜¯æ¶ˆæ¯ä¸­é—´ä»¶çš„ä¸€ç§, æ¶ˆæ¯ä¸­é—´ä»¶å³åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å®Œæˆæ¶ˆæ¯çš„å‘é€å’Œæ¥æ”¶çš„åŸºç¡€è½¯ä»¶. è¿™äº›è½¯ä»¶æœ‰å¾ˆå¤š, åŒ…æ‹¬ ActiveMQ ( apache å…¬å¸çš„), RocketMQ (é˜¿é‡Œå·´å·´å…¬å¸çš„, ç°å·²ç»è½¬è®©ç»™ apache), è¿˜æœ‰æ€§èƒ½æé«˜çš„ Kafkaã€‚ SpringBoot ç³»åˆ—æ–‡ç«  æ¶ˆæ¯ä¸­é—´ä»¶çš„å·¥ä½œè¿‡ç¨‹å¯ä»¥ç”¨ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹æ¥è¡¨ç¤º. å³ç”Ÿäº§è€…ä¸æ–­çš„å‘æ¶ˆæ¯é˜Ÿåˆ—å‘é€ä¿¡æ¯, è€Œæ¶ˆè´¹è€…ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ¶ˆè´¹ä¿¡æ¯. å…·ä½“è¿‡ç¨‹å¦‚ä¸‹: ä»ä¸Šå›¾å¯çœ‹å‡º, å¯¹äºæ¶ˆæ¯é˜Ÿåˆ—æ¥è¯´, ç”Ÿäº§è€…,æ¶ˆæ¯é˜Ÿåˆ—,æ¶ˆè´¹è€… æ˜¯æœ€é‡è¦çš„ä¸‰ä¸ªæ¦‚å¿µã€‚ç”Ÿäº§è€…å‘æ¶ˆæ¯åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­å», æ¶ˆè´¹è€…ç›‘å¬æŒ‡å®šçš„æ¶ˆæ¯é˜Ÿåˆ—, å¹¶ä¸”å½“æ¶ˆæ¯é˜Ÿåˆ—æ”¶åˆ°æ¶ˆæ¯ä¹‹å, æ¥æ”¶æ¶ˆæ¯é˜Ÿåˆ—ä¼ æ¥çš„æ¶ˆæ¯, å¹¶ä¸”ç»™äºˆç›¸åº”çš„å¤„ç†. æ¶ˆæ¯é˜Ÿåˆ—å¸¸ç”¨äºåˆ†å¸ƒå¼ç³»ç»Ÿä¹‹é—´äº’ç›¸ä¿¡æ¯çš„ä¼ é€’. RabbitMQ å·¥ä½œåŸç†å¯¹äº RabbitMQ æ¥è¯´, é™¤äº†è¿™ä¸‰ä¸ªåŸºæœ¬æ¨¡å—ä»¥å¤–, è¿˜æ·»åŠ äº†ä¸€ä¸ªæ¨¡å—, å³äº¤æ¢æœº(Exchange). å®ƒä½¿å¾—ç”Ÿäº§è€…å’Œæ¶ˆæ¯é˜Ÿåˆ—ä¹‹é—´äº§ç”Ÿäº†éš”ç¦», ç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€ç»™äº¤æ¢æœº,è€Œäº¤æ¢æœºåˆ™æ ¹æ®è°ƒåº¦ç­–ç•¥æŠŠç›¸åº”çš„æ¶ˆæ¯è½¬å‘ç»™å¯¹åº”çš„æ¶ˆæ¯é˜Ÿåˆ—. é‚£ä¹ˆ RabitMQ çš„å·¥ä½œæµç¨‹å¦‚ä¸‹æ‰€ç¤º: è¯´ä¸€ä¸‹äº¤æ¢æœº: äº¤æ¢æœºçš„ä¸»è¦ä½œç”¨æ˜¯æ¥æ”¶ç›¸åº”çš„æ¶ˆæ¯å¹¶ä¸”ç»‘å®šåˆ°æŒ‡å®šçš„é˜Ÿåˆ—. äº¤æ¢æœºæœ‰å››ç§ç±»å‹, åˆ†åˆ«ä¸ºDirect, topic, headers, Fanout. Direct æ˜¯ RabbitMQ é»˜è®¤çš„äº¤æ¢æœºæ¨¡å¼,ä¹Ÿæ˜¯æœ€ç®€å•çš„æ¨¡å¼.å³åˆ›å»ºæ¶ˆæ¯é˜Ÿåˆ—çš„æ—¶å€™,æŒ‡å®šä¸€ä¸ª BindingKey. å½“å‘é€è€…å‘é€æ¶ˆæ¯çš„æ—¶å€™, æŒ‡å®šå¯¹åº”çš„ Key. å½“ Key å’Œæ¶ˆæ¯é˜Ÿåˆ—çš„ BindingKey ä¸€è‡´çš„æ—¶å€™,æ¶ˆæ¯å°†ä¼šè¢«å‘é€åˆ°è¯¥æ¶ˆæ¯é˜Ÿåˆ—ä¸­. topic è½¬å‘ä¿¡æ¯ä¸»è¦æ˜¯ä¾æ®é€šé…ç¬¦, é˜Ÿåˆ—å’Œäº¤æ¢æœºçš„ç»‘å®šä¸»è¦æ˜¯ä¾æ®ä¸€ç§æ¨¡å¼(é€šé…ç¬¦+å­—ç¬¦ä¸²), è€Œå½“å‘é€æ¶ˆæ¯çš„æ—¶å€™, åªæœ‰æŒ‡å®šçš„ Key å’Œè¯¥æ¨¡å¼ç›¸åŒ¹é…çš„æ—¶å€™, æ¶ˆæ¯æ‰ä¼šè¢«å‘é€åˆ°è¯¥æ¶ˆæ¯é˜Ÿåˆ—ä¸­. headers ä¹Ÿæ˜¯æ ¹æ®ä¸€ä¸ªè§„åˆ™è¿›è¡ŒåŒ¹é…, åœ¨æ¶ˆæ¯é˜Ÿåˆ—å’Œäº¤æ¢æœºç»‘å®šçš„æ—¶å€™ä¼šæŒ‡å®šä¸€ç»„é”®å€¼å¯¹è§„åˆ™, è€Œå‘é€æ¶ˆæ¯çš„æ—¶å€™ä¹Ÿä¼šæŒ‡å®šä¸€ç»„é”®å€¼å¯¹è§„åˆ™, å½“ä¸¤ç»„é”®å€¼å¯¹è§„åˆ™ç›¸åŒ¹é…çš„æ—¶å€™, æ¶ˆæ¯ä¼šè¢«å‘é€åˆ°åŒ¹é…çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­. Fanout æ˜¯è·¯ç”±å¹¿æ’­çš„å½¢å¼, å°†ä¼šæŠŠæ¶ˆæ¯å‘ç»™ç»‘å®šå®ƒçš„å…¨éƒ¨é˜Ÿåˆ—, å³ä¾¿è®¾ç½®äº† key, ä¹Ÿä¼šè¢«å¿½ç•¥. å…³æ³¨æˆ‘ è½¬è½½è¯·åŠ¡å¿…æ³¨æ˜åŸåˆ›åœ°å€ä¸ºï¼šhttp://www.54tianzhisheng.cn/2018/01/28/RabbitMQ/ SpringBoot æ•´åˆ RabbitMQï¼ˆTopic è½¬å‘æ¨¡å¼ï¼‰åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå°† SpringBoot å’Œ RabbitMQ æ•´åˆè¿‡ï¼Œä¸è¿‡é‚£æ˜¯ä½¿ç”¨ Direct æ¨¡å¼ï¼Œæ–‡ç« åœ°å€æ˜¯ï¼šSpringBoot RabbitMQ æ•´åˆä½¿ç”¨ ç›¸å…³æ–‡ç« 1ã€SpringBoot Kafka æ•´åˆä½¿ç”¨ 2ã€SpringBoot RabbitMQ æ•´åˆä½¿ç”¨ 3ã€SpringBoot ActiveMQ æ•´åˆä½¿ç”¨ 4ã€Kafka å®‰è£…åŠå¿«é€Ÿå…¥é—¨ æ•´åˆæ¥ä¸‹æ¥ï¼Œæˆ‘è¦å¸¦å¤§å®¶ç»§ç»­æ•´åˆï¼ˆTopic è½¬å‘æ¨¡å¼ï¼‰ï¼š 1ã€é…ç½®æ–‡ä»¶å’Œ pom.xml è¿™äº›è¿˜éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬ä¸ç”¨å†ä¿®æ”¹ 2ã€å¯åŠ¨ç±»ä¸­åˆ›å»º Queue å’Œ Exchangeï¼Œå¹¶æŠŠ Queue æŒ‰ç…§ç›¸åº”çš„è§„åˆ™ç»‘å®šåˆ°äº¤æ¢æœºQueue ä¸Šã€‚ä»£ç å¦‚ä¸‹å›¾ï¼š 1234567891011121314@Beanpublic Queue queue() &#123; return new Queue(\"rpc-queue-zhisheng\");&#125;@Beanpublic TopicExchange exchange() &#123; return new TopicExchange(\"rpc-exchange-zhisheng\");&#125;@Beanpublic Binding binding(Queue queue, TopicExchange exchange) &#123; return BindingBuilder.bind(queue).to(exchange).with(\"rpc-zhisheng\");&#125; è¿™é‡Œåˆ›å»ºä¸€ä¸ª Queue å’Œ Exchange ï¼Œç„¶åç»‘å®šã€‚ æ³¨æ„ï¼šä¸Šé¢ä»£ç ä¸­çš„ with(â€œrpc-zhishengâ€) è¿™ä¸ª â€œzhishengâ€ æ˜¯ routingkeyï¼ŒRabbitMQ å°†ä¼šæ ¹æ®è¿™ä¸ªå‚æ•°å»å¯»æ‰¾æœ‰æ²¡æœ‰åŒ¹é…æ­¤è§„åˆ™çš„é˜Ÿåˆ—ï¼Œå¦‚æœæœ‰ï¼Œåˆ™ä¼šæŠŠæ¶ˆæ¯å‘é€ç»™å®ƒï¼Œå¦‚æœä¸æ­¢æœ‰ä¸€ä¸ªï¼Œåˆ™ä¼šæŠŠæ¶ˆæ¯åˆ†å‘ç»™æ‰€æœ‰åŒ¹é…çš„é˜Ÿåˆ—ã€‚ 3ã€æ¶ˆæ¯å‘é€ç±» 1234567891011121314151617181920212223package com.zhisheng.rabbitmq.rpc.client;import org.springframework.amqp.core.TopicExchange;import org.springframework.amqp.rabbit.core.RabbitTemplate;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Component;/** * Created by zhisheng_tian on 2018/1/25 */@Componentpublic class RabbitMQClient &#123; @Autowired private RabbitTemplate rabbitTemplate; @Autowired private TopicExchange exchange; public void send(String message) &#123; rabbitTemplate.convertAndSend(exchange.getName(), \"rpc-zhisheng\", message); &#125;&#125; è¿™é‡Œæ˜¯å‘é€æ¶ˆæ¯çš„ä»£ç ï¼Œâ€œrpc-zhishengâ€ å°±æ˜¯ä¸Šé¢æˆ‘ä»¬è®¾ç½®çš„ routingkeyã€‚ 4ã€æ¶ˆæ¯æ¥æ”¶ç«¯ 12345678910111213141516package com.zhisheng.rabbitmq.rpc.server;import org.springframework.amqp.rabbit.annotation.RabbitListener;import org.springframework.stereotype.Component;/** * Created by zhisheng_tian on 2018/1/25 */@Componentpublic class RabbitMQServer &#123; @RabbitListener(queues = \"rpc-queue-zhisheng\") public void receive(String message) &#123; System.out.println(\"--------receive ------- \" + message); &#125;&#125; 5ã€å¯åŠ¨ç±»ä¸­æ³¨å…¥ å‘é€æ¶ˆæ¯ç±»ï¼Œç„¶åè°ƒç”¨ send æ–¹æ³• 12345678910111213@Autowiredprivate RabbitMQClient client;@PostConstructpublic void init() &#123; StopWatch stopWatch = new StopWatch(); stopWatch.start(); for (int i = 0; i &lt; 1000; i++) &#123; client.send(\" zhisheng, --------- send \" + i); &#125; stopWatch.stop(); System.out.println(\"æ€»å…±è€—æ—¶ï¼š\" + stopWatch.getTotalTimeMillis());&#125; è¿è¡Œæ­¤ SpringBoot é¡¹ç›®ï¼Œåˆ™å¯ä»¥å‘ç°ç»“æœå¦‚ä¸‹ï¼š è¿™é‡Œæµ‹è¯•çš„æ˜¯åŒ¹é…ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—çš„æƒ…å†µï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥æµ‹è¯•ä¸‹åŒ¹é…å¤šä¸ªæ¶ˆæ¯é˜Ÿåˆ—çš„ã€‚ SpringBoot æ•´åˆ RabbitMQ( Fanout Exchange å½¢å¼)Fanout Exchange å½¢å¼åˆå«å¹¿æ’­å½¢å¼ã€‚ ä»»ä½•å‘é€åˆ° Fanout Exchange çš„æ¶ˆæ¯éƒ½ä¼šè¢«è½¬å‘åˆ°ä¸è¯¥ Exchange ç»‘å®š(Binding)çš„æ‰€æœ‰ Queue ä¸Šã€‚ è¿™ç§æ¨¡å¼éœ€è¦æå‰å°† Exchange ä¸ Queue è¿›è¡Œç»‘å®šï¼Œä¸€ä¸ª Exchange å¯ä»¥ç»‘å®šå¤šä¸ª Queueï¼Œä¸€ä¸ª Queue å¯ä»¥åŒå¤šä¸ª Exchange è¿›è¡Œç»‘å®š è¿™ç§æ¨¡å¼ä¸éœ€è¦ RoutingKey å¦‚æœæ¥å—åˆ°æ¶ˆæ¯çš„ Exchange æ²¡æœ‰ä¸ä»»ä½• Queue ç»‘å®šï¼Œåˆ™æ¶ˆæ¯ä¼šè¢«æŠ›å¼ƒã€‚ 1ã€æ¶ˆæ¯å‘é€ç±» 12345678910111213141516171819package com.zhisheng.rabbitmq.rpc.client;import org.springframework.amqp.rabbit.core.RabbitTemplate;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Component;/** * Created by zhisheng_tian on 2018/1/25 */@Componentpublic class RabbitMQClient &#123; @Autowired private RabbitTemplate rabbitTemplate; public void send2(String message) &#123; rabbitTemplate.convertAndSend(\"fanout-exchange\", \"\", message); &#125;&#125; è¿™é‡Œå¯ä»¥ä¸è®¾ç½® routingkey äº†ã€‚ 2ã€å¯åŠ¨ç±» 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071package com.zhisheng.rabbitmq.rpc;import com.zhisheng.rabbitmq.rpc.client.RabbitMQClient;import org.springframework.amqp.core.Binding;import org.springframework.amqp.core.BindingBuilder;import org.springframework.amqp.core.FanoutExchange;import org.springframework.amqp.core.Queue;import org.springframework.amqp.support.converter.Jackson2JsonMessageConverter;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.beans.factory.annotation.Qualifier;import org.springframework.boot.SpringApplication;import org.springframework.boot.autoconfigure.SpringBootApplication;import org.springframework.context.annotation.Bean;import javax.annotation.PostConstruct;@SpringBootApplicationpublic class RabbitmqRpcApplication &#123; @Autowired private RabbitMQClient client; @PostConstruct public void init() &#123; client.send2(\"zhisheng ++++++++++ send2 \"); &#125; public static void main(String[] args) &#123; SpringApplication.run(RabbitmqRpcApplication.class, args); &#125; @Bean(name = \"queue\") public Queue queue() &#123; return new Queue(\"rpc.queue\"); &#125; @Bean(name = \"queue2\") public Queue queue2() &#123; return new Queue(\"rpc.queue2\"); &#125; @Bean(name = \"queue3\") public Queue queue3() &#123; return new Queue(\"rpc.queue3\"); &#125; @Bean public FanoutExchange exchange() &#123; return new FanoutExchange(\"fanout-exchange\"); &#125; @Bean public Binding binding(@Qualifier(\"queue\") Queue queue, FanoutExchange exchange) &#123; return BindingBuilder.bind(queue).to(exchange); &#125; @Bean public Binding binding2(@Qualifier(\"queue2\") Queue queue, FanoutExchange exchange) &#123; return BindingBuilder.bind(queue).to(exchange); &#125; @Bean public Binding binding3(@Qualifier(\"queue3\") Queue queue, FanoutExchange exchange) &#123; return BindingBuilder.bind(queue).to(exchange); &#125; @Bean public Jackson2JsonMessageConverter messageConverter() &#123; return new Jackson2JsonMessageConverter(); &#125;&#125; åœ¨å¯åŠ¨ç±»ä¸­æˆ‘åˆ›å»ºä¸‰ä¸ª Queueï¼š rpc.queue, rpc.queue2 , rpc.queue3 ä¹Ÿåˆ›å»ºä¸€ä¸ª FanoutExchangeï¼Œå¹¶æŠŠè¿™ä¸‰ä¸ª Queue ç»‘å®šåœ¨åŒä¸€ä¸ªäº¤æ¢æœº fanout-exchange ä¸Šé¢ æ³¨æ„ï¼šè¿™ä¸ª fanout-exchange äº¤æ¢æœºä¸çŸ¥ä¸ºå•¥ï¼Œæˆ‘è‡ªå·±åœ¨åº”ç”¨ç¨‹åºé‡Œåˆ›å»ºï¼Œè¿è¡Œç¨‹åºä¼šå‡ºé”™ï¼Œä¸‹é¢è®²è®²æˆ‘æ˜¯æ€ä¹ˆè§£å†³çš„ã€‚ æˆ‘æ˜¯ä» RabbitMQ ç®¡ç†ç•Œé¢ç›´æ¥æ·»åŠ ä¸ª exchange çš„ã€‚ 3ã€æ¶ˆæ¯æ¥æ”¶ç±» 123456789101112131415161718192021222324252627package com.zhisheng.rabbitmq.rpc.server;import org.springframework.amqp.rabbit.annotation.RabbitListener;import org.springframework.stereotype.Component;/** * Created by zhisheng_tian on 2018/1/25 */@Componentpublic class RabbitMQServer &#123; @RabbitListener(queues = \"rpc.queue\") public void receive(String message) &#123; System.out.println(\"--------receive ------- \" + message); &#125; @RabbitListener(queues = \"rpc.queue2\") public void receive2(String message) &#123; System.out.println(\"--------receive2 ------- \" + message); &#125; @RabbitListener(queues = \"rpc.queue3\") public void receive3(String message) &#123; System.out.println(\"--------receive3 ------- \" + message); &#125;&#125; ç›‘å¬æ¯ä¸ª Queueï¼Œå¹¶æœ‰ä¸€ä¸ªæ–¹æ³•è¾“å‡ºå¯¹åº”æ¥æ”¶åˆ°çš„æ¶ˆæ¯ã€‚ 4ã€è¿è¡Œé¡¹ç›® ç»“æœå¦‚ä¸Šï¼Œæ¯ä¸ªé˜Ÿåˆ—éƒ½æ‰“å°å‡ºè‡ªå·±æ”¶åˆ°çš„ç»“æœï¼ŒåŒæ—¶æˆ‘ä»¬çœ‹çœ‹è¿™ä¸‰ä¸ª Queue æ˜¯ä¸æ˜¯ç»‘å®šåˆ° Exchange ä¸Šå‘¢ï¼Ÿ å¯ä»¥çœ‹åˆ°ä¸‰ä¸ª Queue éƒ½ç»‘å®šåœ¨ Exchange ä¸Šäº†ã€‚ æ€»ç»“RabbitMQ ä¸ SpringBoot æ•´åˆå°±åˆ°è¿™é‡Œä¸ºæ­¢äº†ï¼Œåé¢å¦‚æœæœ‰æ—¶é—´ä¼šæ·±åº¦ç ”ç©¶ RabbitMQ çš„ã€‚ è¿˜è¯·ç»§ç»­å…³æ³¨æˆ‘çš„åšå®¢ï¼šhttp://www.54tianzhisheng.cn/","tags":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"http://www.54tianzhisheng.cn/tags/SpringBoot/"},{"name":"RabbitMQ","slug":"RabbitMQ","permalink":"http://www.54tianzhisheng.cn/tags/RabbitMQ/"}]},{"title":"Spring Bootç³»åˆ—æ–‡ç« ï¼ˆå››ï¼‰ï¼šSpringBoot ActiveMQ æ•´åˆä½¿ç”¨","date":"2018-01-26T16:00:00.000Z","path":"2018/01/27/SpringBoot-ActiveMQ/","text":"ä»‹ç» ActiveMQå®ƒæ˜¯ Apache å‡ºå“ï¼Œæœ€æµè¡Œçš„ï¼Œèƒ½åŠ›å¼ºåŠ²çš„å¼€æºæ¶ˆæ¯æ€»çº¿ã€‚ActiveMQ æ˜¯ä¸€ä¸ªå®Œå…¨æ”¯æŒ JMS1.1 å’Œ J2EE 1.4 è§„èŒƒçš„ JMS Provider å®ç°ï¼Œå°½ç®¡ JMS è§„èŒƒå‡ºå°å·²ç»æ˜¯å¾ˆä¹…çš„äº‹æƒ…äº†ï¼Œä½†æ˜¯ JMS åœ¨å½“ä»Šçš„J2EEåº”ç”¨ä¸­é—´ä»ç„¶æ‰®æ¼”ç€ç‰¹æ®Šçš„åœ°ä½ã€‚â€”â€” æ‘˜è‡ªç™¾åº¦ç™¾ç§‘ï¼Œå·äº†ä¸ªæ‡’ã€‚ SpringBoot ç³»åˆ—æ–‡ç«  ç›¸å…³æ–‡ç« 1ã€SpringBoot Kafka æ•´åˆä½¿ç”¨ 2ã€SpringBoot RabbitMQ æ•´åˆä½¿ç”¨ å®‰è£… ActiveMQåŒä¹‹å‰ä¸€æ ·ï¼Œç›´æ¥åœ¨ Docker é‡Œé¢ç©å§ã€‚å‘½ä»¤ä¹Ÿæ˜¯ä¸€è¡Œè§£å†³ï¼š 1docker run -d -p 8161:8161 -p 61616:61616 -e ACTIVEMQ_ADMIN_LOGIN=admin -e ACTIVEMQ_ADMIN_PASSWORD=admin --name activemq webcenter/activemq ç®€å•è§£é‡Šä¸‹ï¼š 8186: è¡¨ç¤º ActiveMQ æ§åˆ¶å°ç«¯å£å·ï¼Œå®ƒå’Œ RabbitMQ ä¸€æ ·éƒ½æ˜¯æœ‰æ§åˆ¶å°çš„ï¼Œå¯ä»¥ç™»é™†æ§åˆ¶å°è¿›è¡Œæ“ä½œçš„ 61616 ï¼š è¡¨ç¤º ActiveMQ æ‰€ç›‘å¬çš„ TCP ç«¯å£å·ï¼Œåº”ç”¨ç¨‹åºå¯é€šè¿‡è¯¥ç«¯å£å·ä¸ ActiveMQ å»ºç«‹ TCP è¿æ¥ CTIVEMQ_ADMIN_LOGIN ï¼šç™»é™†æ§åˆ¶å°çš„ç”¨æˆ·å ACTIVEMQ_ADMIN_PASSWORD ï¼šç™»é™†æ§åˆ¶å°çš„å¯†ç  æ‰§è¡Œåï¼Œå¯åœ¨æµè§ˆå™¨è¾“å…¥ http://localhost:8161/ æŸ¥çœ‹æ§åˆ¶å°ï¼Œ è§£é‡Šä¸‹ä¸Šé¢å›¾ç‰‡ä¸­æ§åˆ¶å°è¿™äº›æŒ‰é’®çš„åŸºæœ¬ä¿¡æ¯ï¼š Homeï¼šæŸ¥çœ‹ ActiveMQ çš„å¸¸è§ä¿¡æ¯ Queuesï¼šæŸ¥çœ‹ ActiveMQ çš„é˜Ÿåˆ—ä¿¡æ¯ Topicsï¼šæŸ¥çœ‹ ActiveMQ çš„ä¸»é¢˜ä¿¡æ¯ Subscribersï¼šæŸ¥çœ‹ä¸»é¢˜çš„è®¢é˜…è€…ä¿¡æ¯ Connectionsï¼šæŸ¥çœ‹ ActiveMQ å®¢æˆ·ç«¯çš„è¿æ¥ä¿¡æ¯ Networkï¼šæŸ¥çœ‹ ActiveMQ çš„ç½‘ç»œä¿¡æ¯ Scheduledï¼šæŸ¥çœ‹ ActiveMQ çš„å®šæ—¶ä»»åŠ¡ Sendï¼šç”¨äºé€šè¿‡è¡¨å•æ–¹å¼å‘é˜Ÿåˆ—æˆ–è€…ä¸»é¢˜å‘é€å…·ä½“çš„æ¶ˆæ¯ æ•´åˆIDEA åˆ›å»º SpringBoot é¡¹ç›®ï¼Œå› ä¸º SpringBoot å·²ç»å†…ç½®äº†å¯¹ ActiveMQ çš„æ”¯æŒï¼Œæ‰€ä»¥ç›´æ¥å¼•å…¥ä¾èµ– spring-boot-starter-activemq å°±è¡Œã€‚æ•´ä½“é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š 1ã€pom.xml æ–‡ä»¶ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;com.zhisheng&lt;/groupId&gt; &lt;artifactId&gt;activemq&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;packaging&gt;jar&lt;/packaging&gt; &lt;name&gt;activemq&lt;/name&gt; &lt;description&gt;Demo project for Spring Boot ActiveMQ&lt;/description&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;1.5.9.RELEASE&lt;/version&gt; &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt; &lt;/parent&gt; &lt;properties&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-activemq&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt;&lt;/project&gt; 2ã€é…ç½®æ–‡ä»¶ application.properties 123spring.activemq.broker-url=tcp://localhost:61616spring.activemq.user=adminspring.activemq.password=admin 3ã€å‘é€æ¶ˆæ¯ç±» 12345678910111213141516package com.zhisheng.activemq.client;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.jms.core.JmsTemplate;import org.springframework.stereotype.Component;@Componentpublic class ActiveMQClient &#123; @Autowired private JmsTemplate jmsTemplate; public void send(String message) &#123; jmsTemplate.convertAndSend(\"zhisheng\", message); &#125;&#125; åŒæ ·ï¼Œå’Œ RabbitMQ ç±»ä¼¼ï¼Œä¸å¤šè¯´äº†ã€‚ 4ã€æ¶ˆæ¯æ¥æ”¶ç±» 123456789101112package com.zhisheng.activemq.server;import org.springframework.jms.annotation.JmsListener;import org.springframework.stereotype.Component;@Componentpublic class ActiveMQServer &#123; @JmsListener(destination = \"zhisheng\") public void receive(String message) &#123; System.out.println(\"æ”¶åˆ°çš„ message æ˜¯ï¼š\" + message); &#125;&#125; 5ã€æ³¨æ„ è¿™ä¸ªé˜Ÿåˆ—æ˜¯ä¸éœ€è¦æˆ‘ä»¬æå‰å®šä¹‰å¥½çš„ï¼Œå®ƒå’Œ RabbitMQ ä¸ä¸€æ ·ï¼Œå®ƒä¼šåœ¨æˆ‘ä»¬éœ€è¦çš„æ—¶å€™åŠ¨æ€çš„åˆ›å»ºã€‚ è¿è¡Œ12345678910111213141516171819202122232425262728293031package com.zhisheng.activemq;import com.zhisheng.activemq.client.ActiveMQClient;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.boot.SpringApplication;import org.springframework.boot.autoconfigure.SpringBootApplication;import org.springframework.util.StopWatch;import javax.annotation.PostConstruct;@SpringBootApplicationpublic class ActivemqApplication &#123; @Autowired ActiveMQClient client; @PostConstruct public void init() &#123; StopWatch stopWatch = new StopWatch(); stopWatch.start(); for (int i = 0; i &lt; 10000; i++) &#123; client.send(\"å‘é€æ¶ˆæ¯----zhisheng-----\"); &#125; stopWatch.stop(); System.out.println(\"å‘é€æ¶ˆæ¯è€—æ—¶: \" + stopWatch.getTotalTimeMillis()); &#125; public static void main(String[] args) &#123; SpringApplication.run(ActivemqApplication.class, args); &#125;&#125; å‘é€ä¸€ä¸‡æ¡æ¶ˆæ¯è¿è¡Œåéœ€è¦çš„æ—¶é—´æŒºä¹…çš„ï¼š73180 ms æ¯” RabbitMQ å‘é€ 10000 æ¡æ¶ˆæ¯è€—æ—¶ 215 ms ä¸çŸ¥é“é«˜å‡ºå¤šå°‘å€äº†ï¼Œå¯è§å…¶æ€§èƒ½å¹¶ä¸é«˜çš„ã€‚ å…³æ³¨æˆ‘ æœ€åè½¬è½½è¯·åŠ¡å¿…æ³¨æ˜åŸåˆ›åœ°å€ä¸ºï¼šhttp://www.54tianzhisheng.cn/2018/01/27/SpringBoot-ActiveMQ/","tags":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"http://www.54tianzhisheng.cn/tags/SpringBoot/"},{"name":"ActiveMQ","slug":"ActiveMQ","permalink":"http://www.54tianzhisheng.cn/tags/ActiveMQ/"}]},{"title":"Spring Bootç³»åˆ—æ–‡ç« ï¼ˆä¸‰ï¼‰ï¼šSpringBoot  RabbitMQ æ•´åˆä½¿ç”¨","date":"2018-01-25T16:00:00.000Z","path":"2018/01/26/SpringBoot-RabbitMQ/","text":"SpringBoot ç³»åˆ—æ–‡ç«  å‰æä¸Šæ¬¡å†™äº†ç¯‡æ–‡ç« ï¼Œã€ŠSpringBoot Kafka æ•´åˆä½¿ç”¨ã€‹ï¼Œé˜…è¯»é‡è¿˜æŒºé«˜çš„ï¼Œäºæ˜¯æƒ³æƒ³è¿˜æ˜¯æŠŠå…¶ä»–å‡ ç§ MQ ä¹Ÿå’Œ SpringBoot æ•´åˆä½¿ç”¨ä¸‹ã€‚ ä¸‹é¢æ˜¯å››ç§æ¯”è¾ƒæµè¡Œçš„ MQ ï¼š åé¢éƒ½å†™å†™å’Œ SpringBoot æ•´åˆçš„æ–‡ç« ã€‚ å®‰è£… RabbitMQç”±äºæ¢ Mac äº†ï¼Œæ‰€ä»¥ä¸€äº›ç¯å¢ƒå°±ç›´æ¥åœ¨ Mac æï¼Œä½†æ˜¯åƒå®‰è£… RabbitMQ è¿™äº›åˆä¼šæŠŠè‡ªå·±ç”µè„‘ç³»ç»Ÿç»™æçš„å¤ªä¹±ï¼Œæ‰€ä»¥èƒ½åœ¨ Docker é‡Œé¢å®‰è£…å°±å®‰è£…åœ¨ Dockerï¼Œè¿™æ¬¡ RabbitMQ æˆ‘ä¹Ÿç›´æ¥åœ¨ Docker é‡Œå®‰è£…ã€‚ å¯åŠ¨ Docker for Macï¼Œå¦‚æœæ²¡å®‰è£…è¿‡çš„è¯·çœ‹æˆ‘ä¸Šä¸€ç¯‡æ–‡ç« ï¼šhttp://www.54tianzhisheng.cn/2018/01/25/Docker-install/ å½“ç„¶ä½ ä¹Ÿå¯ä»¥åœ¨è‡ªå·±çš„ Linux æœåŠ¡å™¨æˆ–è€…è™šæ‹Ÿæœºé‡Œå¯åŠ¨å®‰è£… RabbitMQ ã€‚ Docker å®‰è£…çš„è¯å¾ˆç®€å•ï¼Œå› ä¸º RabbitMQ å®˜æ–¹å·²ç»æä¾›äº†è‡ªå·±çš„ Docker å®¹å™¨ï¼Œåªéœ€è¦ä¸€è¡Œå‘½ä»¤ï¼š 1docker run -d -p 15672:15672 -p 5672:5672 -e RABBITMQ_DEFAULT_USER=admin -e RABBITMQ_DEFAULT_PASS=admin --name rabbitmq rabbitmq:3-management è¯¥é•œåƒæ‹¥æœ‰ä¸€ä¸ªåŸºäº web çš„æ§åˆ¶å°å’Œ Http APIã€‚Http API å¯ä»¥åœ¨åœ°å€çœ‹åˆ°å¦‚ä½•ä½¿ç”¨ï¼šhttp://localhost:15672/api/ è®²è§£ä¸‹ä¸Šé¢å‘½ä»¤è¡Œï¼š 15672 ï¼šè¡¨ç¤º RabbitMQ æ§åˆ¶å°ç«¯å£å·ï¼Œå¯ä»¥åœ¨æµè§ˆå™¨ä¸­é€šè¿‡æ§åˆ¶å°æ¥æ‰§è¡Œ RabbitMQ çš„ç›¸å…³æ“ä½œã€‚ 5672 : è¡¨ç¤º RabbitMQ æ‰€ç›‘å¬çš„ TCP ç«¯å£å·ï¼Œåº”ç”¨ç¨‹åºå¯é€šè¿‡è¯¥ç«¯å£ä¸ RabbitMQ å»ºç«‹ TCP è¿æ¥ï¼Œå¹¶å®Œæˆåç»­çš„å¼‚æ­¥æ¶ˆæ¯é€šä¿¡ RABBITMQ_DEFAULT_USERï¼šç”¨äºè®¾ç½®ç™»é™†æ§åˆ¶å°çš„ç”¨æˆ·åï¼Œè¿™é‡Œæˆ‘è®¾ç½® admin RABBITMQ_DEFAULT_PASSï¼šç”¨äºè®¾ç½®ç™»é™†æ§åˆ¶å°çš„å¯†ç ï¼Œè¿™é‡Œæˆ‘è®¾ç½® admin å®¹å™¨å¯åŠ¨æˆåŠŸåï¼Œå¯ä»¥åœ¨æµè§ˆå™¨è¾“å…¥åœ°å€ï¼šhttp://localhost:15672/ è®¿é—®æ§åˆ¶å° ç™»é™†åï¼š ç®€å•æè¿°ä¸‹ä¸Šå›¾ä¸­ä¸­æ§åˆ¶å°çš„åˆ—è¡¨çš„ä½œç”¨ï¼š Overview ï¼šç”¨äºæŸ¥çœ‹ RabbitMQ çš„ä¸€äº›åŸºæœ¬ä¿¡æ¯ï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ã€æ¶ˆæ¯å‘é€é€Ÿç‡ã€èŠ‚ç‚¹ã€ç«¯å£å’Œä¸Šä¸‹æ–‡ä¿¡æ¯ç­‰ï¼‰ Connectionsï¼šç”¨äºæŸ¥çœ‹ RabbitMQ å®¢æˆ·ç«¯çš„è¿æ¥ä¿¡æ¯ Channelsï¼šç”¨æˆ·æŸ¥çœ‹ RabbitMQ çš„é€šé“ä¿¡æ¯ Exchangeï¼šç”¨äºæŸ¥çœ‹ RabbitMQ äº¤æ¢æœº Queuesï¼šç”¨äºæŸ¥çœ‹ RabbitMQ çš„é˜Ÿåˆ— Adminï¼šç”¨äºç®¡ç†ç”¨æˆ·ï¼Œå¯å¢åŠ ç”¨æˆ· åˆ›å»ºé¡¹ç›®åœ¨ IDEA ä¸­åˆ›å»ºä¸€ä¸ª SpringBoot é¡¹ç›®ç»“æ„ï¼š SpringBoot æ¡†æ¶ä¸­å·²ç»å†…ç½®äº†å¯¹ RabbitMQ çš„æ”¯æŒï¼Œå¦‚æœä½ çœ‹è¿‡å®˜æ–¹æ–‡æ¡£çš„è¯ï¼Œå°±å¯ä»¥çœ‹åˆ°çš„ï¼Œæˆ‘ä»¬éœ€è¦æŠŠä¾èµ– spring-boot-starter-amqp å¼•å…¥å°±è¡Œã€‚ 1ã€ pom.xml å¼•å…¥ä¾èµ–åå¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;com.zhisheng&lt;/groupId&gt; &lt;artifactId&gt;rabbitmq&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;packaging&gt;jar&lt;/packaging&gt; &lt;name&gt;rabbitmq&lt;/name&gt; &lt;description&gt;Demo project for Spring Boot RabbitMQ&lt;/description&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;1.5.9.RELEASE&lt;/version&gt; &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt; &lt;/parent&gt; &lt;properties&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-amqp&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt;&lt;/project&gt; 2ã€application.properties é…ç½®ä¿®æ”¹å¦‚ä¸‹ï¼š 123spring.rabbitmq.addresses=localhost:5672spring.rabbitmq.username=adminspring.rabbitmq.password=admin 3ã€æ¶ˆæ¯å‘é€ç±» RabbitMQClient.java 12345678910111213141516171819package com.zhisheng.rabbitmq.client;import org.springframework.amqp.rabbit.core.RabbitTemplate;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Component;/** * Created by zhisheng_tian on 2018/1/23 */@Componentpublic class RabbitMQClient &#123; @Autowired private RabbitTemplate rabbitTemplate; public void send(String message) &#123; rabbitTemplate.convertAndSend(\"zhisheng\", message); &#125;&#125; å°±è¿™æ ·ï¼Œå‘é€æ¶ˆæ¯ä»£ç å°±å®ç°äº†ã€‚ è¿™é‡Œå…³é”®çš„ä»£ç ä¸º rabbitTemplate.convertAndSend() æ–¹æ³•ï¼Œzhisheng è¿™ä¸ªæ˜¯è·¯ç”±è§„åˆ™ï¼ˆroutingKeyï¼‰ï¼Œå®ƒçš„å€¼è¡¨æ˜å°†æ¶ˆæ¯å‘é€åˆ°æŒ‡å®šçš„é˜Ÿåˆ— zhisheng ä¸­å»ï¼Œè¿™é‡Œè·Ÿäº†ä¸‹æºç ï¼Œå‘ç° convertAndSend() æ–¹æ³•æœ€åè°ƒç”¨çš„æ–¹æ³•å…¶å®æ˜¯ä¸€ä¸ª doSend() æ–¹æ³•ã€‚ 4ã€æ¶ˆæ¯æ¥æ”¶ç±» 12345678910111213141516package com.zhisheng.rabbitmq.server;import org.springframework.amqp.rabbit.annotation.RabbitListener;import org.springframework.stereotype.Component;/** * Created by zhisheng_tian on 2018/1/23 */@Componentpublic class RabbitMQServer &#123; @RabbitListener(queues = \"zhisheng\") public void receive(String message) &#123; System.out.println(\"æ”¶åˆ°çš„ message æ˜¯ï¼š\" + message); &#125;&#125; ä½ çœ‹ï¼Œè¿™é‡Œå°±æœ‰ä¸ª RabbitListener ä¸€ç›´åœ¨ç›‘å¬ç€é˜Ÿåˆ— zhisheng ã€‚ å½“ç„¶è¿™ä¸ªé˜Ÿåˆ—æ˜¯å¿…é¡»è¦æˆ‘ä»¬è‡ªå·±åœ¨åº”ç”¨ç¨‹åºä¸­åˆ›å»ºå¥½ï¼Œå®ƒä¸ä¼šåƒæˆ‘ä¹‹å‰å†™çš„æ–‡ç«  ã€ŠSpringBoot Kafka æ•´åˆä½¿ç”¨ã€‹ ä¸­çš„ Kafka ä¸€æ ·ï¼ŒKafka å®ƒä¼šåœ¨ç”¨åˆ°é˜Ÿåˆ—çš„æ—¶å€™åŠ¨æ€çš„åˆ›å»ºï¼Œä¸éœ€è¦æˆ‘ä»¬æå‰åˆ›å»ºå¥½ã€‚ é‚£ä¹ˆåœ¨ RabbitMQ ä¸­è¯¥å¦‚ä½•åˆ›å»ºé˜Ÿåˆ—å‘¢ï¼Ÿ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼šè¿™æ ·æˆ‘ä»¬å°±åˆ›å»ºå¥½äº†ä¸€ä¸ª zhisheng çš„é˜Ÿåˆ—ï¼Œå½“ç¨‹åºå¼€å§‹è¿è¡Œæ—¶ï¼Œæ¶ˆæ¯æ¥æ”¶ç±»ä¼šæŒç»­ç›‘å¬é˜Ÿåˆ— zhisheng ä¸­å³å°†åˆ°æ¥çš„æ¶ˆæ¯ã€‚ 5ã€è¿è¡Œé¡¹ç›® éœ€è¦åœ¨å¯åŠ¨ç±»ä¸­æ³¨å…¥å‘é€æ¶ˆæ¯çš„ç±»ï¼Œå¹¶ä¸”æä¾› init æ–¹æ³•ï¼Œåœ¨ init æ–¹æ³•ä¸­è°ƒç”¨å‘é€æ¶ˆæ¯ç±»çš„ send() æ–¹æ³• 1234@PostConstructpublic void init() &#123; rabbitMQClient.send(\"å‘é€æ¶ˆæ¯----zhisheng-----\");&#125; éœ€è¦æ³¨æ„çš„æ˜¯ï¼šinit() æ–¹æ³•å¸¦æœ‰ @PostConstruct æ³¨è§£ï¼Œè¢« @PostConstruct ä¿®é¥°çš„æ–¹æ³•ä¼šåœ¨æ„é€ å‡½æ•°ä¹‹åæ‰§è¡Œã€‚ å¯åŠ¨é¡¹ç›®å°±å¯ä»¥å‘ç°æ§åˆ¶å°å·²ç»æ¥æ”¶åˆ°æ¶ˆæ¯äº†ã€‚ 6ã€å•çº¿ç¨‹æµ‹è¯•æ€§èƒ½ çœ‹åˆ°ä¸Šé¢å›¾ç‰‡ä¸­æ³¨é‡Šæ‰çš„ä»£ç æ²¡ï¼Ÿé‚£å°±æ˜¯ç”¨æ¥æµ‹è¯•æ¶ˆæ¯å‘é€çš„æ€§èƒ½çš„ï¼Œæˆ‘å‘é€ 10000 æ¡æ¶ˆæ¯çœ‹çœ‹æ€»å…±è€—æ—¶å¤šå°‘ã€‚ 10000 æ¡æ¶ˆæ¯å‘é€è€—æ—¶ï¼š215msã€‚ è¿™æ˜¯åœ¨å•çº¿ç¨‹ä¸‹ï¼Œä¸‹æ¬¡å¯ä»¥å’Œå…¶ä»–çš„ MQ æµ‹è¯•å¯¹æ¯”ä¸‹ï¼Œå¹¶ä¸”ä¹Ÿå¯ä»¥åœ¨å¤šçº¿ç¨‹çš„ç¯å¢ƒä¸‹æµ‹è¯•æ€§èƒ½ã€‚ åŒæ—¶ä»æ§åˆ¶å°å¯ä»¥çœ‹åˆ°å‘é€çš„é€Ÿç‡ï¼š 7ã€å¤šçº¿ç¨‹æµ‹è¯•æ€§èƒ½ å¼€äº†10 ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹å‘é€ 10000 æ¡æ¶ˆæ¯ã€‚ init æ–¹æ³•ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738@PostConstruct public void init() &#123; StopWatch stopWatch = new StopWatch(); stopWatch.start(); int threads = 10; ExecutorService executorService = Executors.newFixedThreadPool(threads); final CountDownLatch start = new CountDownLatch(1); final CountDownLatch end = new CountDownLatch(threads); for (int i = 0; i &lt; threads; i++) &#123; executorService.execute(() -&gt; &#123; try &#123; start.await(); for (int i1 = 0; i1 &lt; 10000; i1++) &#123; rabbitMQClient.send(\"å‘é€æ¶ˆæ¯----zhisheng-----\"); &#125; &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; finally &#123; end.countDown(); &#125; &#125;); &#125; start.countDown(); try &#123; end.await(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; finally &#123; executorService.shutdown(); &#125; stopWatch.stop(); System.out.println(\"å‘é€æ¶ˆæ¯è€—æ—¶ï¼š\" + stopWatch.getTotalTimeMillis()); &#125; è€—æ—¶ï¼š4063ms æ§åˆ¶å°æ˜¾ç¤ºå¦‚ä¸‹å›¾ï¼š 8ã€æ³¨æ„ è¿™é‡Œæµ‹è¯•å‘é€çš„æ¶ˆæ¯ç›´æ¥æ˜¯ String ç±»å‹çš„ï¼Œä½ ä¹Ÿå¯ä»¥æµ‹è¯•ä¸‹ Bean ç±»ï¼Œè¿™éœ€è¦æ³¨æ„éœ€è¦åºåˆ—åŒ–ã€‚ å…³æ³¨æˆ‘ æœ€åè½¬è½½è¯·åŠ¡å¿…æ³¨æ˜åŸåˆ›åœ°å€ä¸ºï¼šhttp://www.54tianzhisheng.cn/2018/01/26/SpringBoot-RabbitMQ/","tags":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"http://www.54tianzhisheng.cn/tags/SpringBoot/"},{"name":"RabbitMQ","slug":"RabbitMQ","permalink":"http://www.54tianzhisheng.cn/tags/RabbitMQ/"}]},{"title":"Dockerç³»åˆ—æ–‡ç« ï¼ˆäºŒï¼‰ï¼šMac å®‰è£… Docker åŠå¸¸ç”¨å‘½ä»¤","date":"2018-01-24T16:00:00.000Z","path":"2018/01/25/Docker-install/","text":"èƒŒæ™¯å¾®æœåŠ¡ + å®¹å™¨ï¼Œå®Œç¾çš„ä¸€å¯¹ï¼å¿…é¡»å¾—å¥½å¥½å­¦ä¹ å­¦ä¹ ã€‚ å®‰è£…æ­¥éª¤Mac ä¸‹ Docker çš„å®‰è£…çœŸå¿ƒå»ºè®®è·Ÿç€å®˜æ–¹çš„æ–‡æ¡£èµ°ä¸€éï¼Œå®˜ç½‘å·²ç»è®²çš„å¾ˆè¯¦ç»†äº†ã€‚ https://docs.docker.com/docker-for-mac/install/#what-to-know-before-you-install ä½¿ç”¨ Docker for Machttps://docs.docker.com/docker-for-mac/#check-versions-of-docker-engine-compose-and-machine é…ç½® Docker åŠ é€Ÿå™¨Docker åŠ é€Ÿå™¨æ˜¯ä»€ä¹ˆï¼Œæˆ‘éœ€è¦ä½¿ç”¨å—ï¼Ÿ ä½¿ç”¨ Docker çš„æ—¶å€™ï¼Œéœ€è¦ç»å¸¸ä»å®˜æ–¹è·å–é•œåƒï¼Œä½†æ˜¯ç”±äºæ˜¾è€Œæ˜“è§çš„ç½‘ç»œåŸå› ï¼Œæ‹‰å–é•œåƒçš„è¿‡ç¨‹éå¸¸è€—æ—¶ï¼Œä¸¥é‡å½±å“ä½¿ç”¨ Docker çš„ä½“éªŒã€‚å› æ­¤ DaoCloud æ¨å‡ºäº†åŠ é€Ÿå™¨å·¥å…·è§£å†³è¿™ä¸ªéš¾é¢˜ï¼Œé€šè¿‡æ™ºèƒ½è·¯ç”±å’Œç¼“å­˜æœºåˆ¶ï¼Œæå¤§æå‡äº†å›½å†…ç½‘ç»œè®¿é—® Docker Hub çš„é€Ÿåº¦ï¼Œç›®å‰å·²ç»æ‹¥æœ‰äº†å¹¿æ³›çš„ç”¨æˆ·ç¾¤ä½“ï¼Œå¹¶å¾—åˆ°äº† Docker å®˜æ–¹çš„å¤§åŠ›æ¨èã€‚å¦‚æœæ‚¨æ˜¯åœ¨å›½å†…çš„ç½‘ç»œç¯å¢ƒä½¿ç”¨ Dockerï¼Œé‚£ä¹ˆ Docker åŠ é€Ÿå™¨ä¸€å®šèƒ½å¸®åŠ©åˆ°æ‚¨ã€‚ æ³¨å†Œ daocloudï¼Œç„¶ååœ¨ mac æ ‡ç­¾é¡µå¤åˆ¶åŠ é€Ÿå™¨ urlã€‚ å…¥é—¨æ¡ˆä¾‹è·Ÿç€ä¸‹é¢çš„æ–‡ç« è¿›è¡Œæ•²ä¸€éï¼Œç†Ÿæ‚‰ä¸‹ Docker æ•´ä¸ªçš„ä½¿ç”¨ã€‚ https://www.jianshu.com/p/cf6e7248b6c7 Docker å¸¸ç”¨å‘½ä»¤ä¸‹é¢åˆ—å‡ºäº›è‡ªå·±å¸¸ç”¨çš„å‘½ä»¤ï¼Œç›®çš„å°±æ˜¯è®°å½•ä¸‹æ¥ï¼Œä»¥åå¿˜è®°äº†ï¼Œå†æ‹¿æ¥è·Ÿç€æ•²å°±è¡Œï¼ 12345678910111213141516171819202122232425262728293031323334353637383940414243docker run -i -t &lt;image_name/continar_id&gt; /bin/bash å¯åŠ¨å®¹å™¨å¹¶å¯åŠ¨bashï¼ˆäº¤äº’æ–¹å¼ï¼‰docker run -d -it image_name å¯åŠ¨å®¹å™¨ä»¥åå°æ–¹å¼è¿è¡Œ(æ›´é€šç”¨çš„æ–¹å¼ï¼‰docker ps åˆ—å‡ºå½“å‰æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„containerdocker ps -a åˆ—å‡ºæ‰€æœ‰çš„containerdocker ps -l åˆ—å‡ºæœ€è¿‘ä¸€æ¬¡å¯åŠ¨çš„containerdocker images åˆ—å‡ºæœ¬åœ°æ‰€æœ‰çš„é•œåƒdocker rmi imagesID åˆ é™¤æŒ‡å®šçš„é•œåƒiddocker rm CONTAINER ID åˆ é™¤æŒ‡å®šçš„CONTAINER iddocker diff é•œåƒå æŸ¥çœ‹å®¹å™¨çš„ä¿®æ”¹éƒ¨åˆ†docker kill CONTAINER ID æ€æ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨docker logs å®¹å™¨ID/name å¯ä»¥æŸ¥çœ‹åˆ°å®¹å™¨ä¸»ç¨‹åºçš„è¾“å‡ºdocker pull image_name ä¸‹è½½imagedocker push image_name å‘å¸ƒdockeré•œåƒdocker version æŸ¥çœ‹dockerç‰ˆæœ¬docker info æŸ¥çœ‹dockerç³»ç»Ÿçš„ä¿¡æ¯docker inspect å®¹å™¨çš„id å¯ä»¥æŸ¥çœ‹æ›´è¯¦ç»†çš„å…³äºæŸä¸€ä¸ªå®¹å™¨çš„ä¿¡æ¯docker run -d image-name åå°è¿è¡Œé•œåƒdocker search é•œåƒå æŸ¥æ‰¾å…¬å…±çš„å¯ç”¨é•œåƒdocker stop å®¹å™¨å/å®¹å™¨ ID ç»ˆæ­¢è¿è¡Œçš„å®¹å™¨docker restart å®¹å™¨å/å®¹å™¨ ID é‡å¯å®¹å™¨docker commit æäº¤ï¼Œåˆ›å»ºä¸ªæ–°é•œåƒdocker build [OPTIONS] PATH | URL | - åˆ©ç”¨ Dockerfile åˆ›å»ºæ–°é•œåƒ å…³æ³¨æˆ‘ æœ€åè½¬è½½è¯·æ³¨æ˜åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2018/01/25/Docker-install/","tags":[{"name":"Docker","slug":"Docker","permalink":"http://www.54tianzhisheng.cn/tags/Docker/"}]},{"title":"MacBook Pro åˆä½“éªŒ","date":"2018-01-23T16:00:00.000Z","path":"2018/01/24/mac/","text":"èƒŒæ™¯ åœ¨ Mac åˆ°æ‰‹ä¹‹å‰å°±åœ¨å„ç§ç¾¤é‡Œçœ‹åˆ°äººè¯´ Mac å¤šå¥½ç”¨ï¼Œä¹Ÿæœ‰å¾ˆå¤šäººé¼“å¹è¿‡ Mac çš„å¥½å¤„ï¼Œæœ€åä¹Ÿåšå®šæˆ‘çš„å¹´å‰ç›®æ ‡äº† â€”â€” å°±æ˜¯ä¹°å° Macï¼Œä¹‹å‰è¯·åŸè°…æˆ‘è¿™ä¸ªç©·é¬¼ï¼Œä¹°ä¸èµ·ï¼Œç°åœ¨ä¹°äº† Mac åæ›´åŠ å¾—ä½“è°…æˆ‘è¿™ä¸ªç©·é¬¼äº†ï¼Œæ¯•ç«Ÿåœ¨ä¸Šæµ·è¿™ä¸ªåŸå¸‚ï¼Œé ç€å®ä¹ å·¥èµ„ä¹°è¿™ç§å¥¢ä¾ˆå“ï¼Œä¸å®¹æ˜“å•ŠğŸ˜„ ã€‚åºŸè¯ä¸å¤šè¯´ï¼Œå¦‚æœæ„¿æ„æ”¯æŒæˆ‘çš„ï¼Œè¯·åœ¨æ–‡ç« åº•éƒ¨æ‰«æäºŒç»´ç ï¼Œåœ¨æ­¤å…ˆè°¢è°¢äº†ã€‚ å¦‚ä½•æŒ‘é€‰ï¼ŸMacBook ä¸»è¦åˆ†ä¸¤ç³»åˆ—ï¼šMacBook Air å’Œ MacBook Proã€‚ Air çš„è¯ä¸ªäººæ„Ÿè§‰é…ç½®ä¸é«˜ï¼Œå¦‚æœæ˜¯å¼€å‘è¿˜æ˜¯å»ºè®®ä¹° Pro ç³»åˆ—çš„ã€‚å¦‚ä»Šä¹°çš„è¯ï¼Œå¯èƒ½è¿˜ä¼šåˆ† 2015 æ¬¾ã€2016 æ¬¾ã€2017 æ¬¾ã€‚æ¯æ¬¾ä¸­åˆåˆ† å†…å­˜å¤§å°ï¼ˆ8/16gï¼‰ã€ç¡¬ç›˜å¤§å°ï¼ˆ128/256/512gï¼‰ã€CPUã€å¤„ç†å™¨ï¼ˆi5/i7ï¼‰ã€æ˜¯å¦æœ‰TouchBarã€æ˜¾å¡ç­‰ã€‚ä¸åŒé…ç½®å¯¹åº”ç”µè„‘çš„å‹å·ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ã€‚ä¸‹é¢ç›´æ¥ä¸Šä¸€å¼ åœ¨æˆ‘çš„ç‰¹æ®Šæ¸ é“é‡Œçš„æŠ¥ä»·è¡¨æˆªå›¾å§ã€‚ï¼ˆæƒ³äº†è§£çš„å¯ä»¥æ‰¾æˆ‘ï¼‰ å…‰è¿™å‹å·ï¼Œä¸æ‡‚çš„äººè¿˜çœŸä¸ä¼šæŒ‘ã€‚ ä¸å¾—ä¸è¯´ï¼Œè‹¹æœç”µè„‘çœŸå°¼ç›éš¾æŒ‘å•Šï¼Œå¦‚æœä½ æ˜¯åœŸè±ªï¼Œé‚£ä¸ç”¨æŒ‘äº†ï¼Œç›´æ¥ä¸Šæœ€é«˜ä»·é’±çš„å§ã€‚ ç„¶åå¯ä»¥ä»é…ç½®ä¸­å‘ç° 2016 æ¬¾å’Œ 2017 æ¬¾å˜åŒ–çœŸå¿ƒä¸å¤§ï¼Œåœ¨åŒç­‰é…ç½®ä¸‹ï¼Œ2017 æ¬¾å‡ ä¹æ¯” 2016 æ¬¾ä»·æ ¼é«˜ä¸ª 3000 æ¥å—ã€‚ ç„¶åå°±æ˜¯ 512 G ç¡¬ç›˜æ¯” 256 G ä¹Ÿå‡ ä¹è´µä¸ª 2000 å¤šã€‚ 16G é‚£æ˜¯å¿…é¡»çš„ä¸Šå•Šï¼Œæ ‡é…äº†ï¼Œ8G å°±ä¸è¯´äº†ï¼Œå¤ªå°äº†ã€‚ å« TouchBarï¼Œè™½ç„¶ç¡®å®ç”¨å¤„ä¸å¤§ï¼Œä¸è¿‡è°ƒéŸ³ä¸¤è¿˜æ˜¯ä¸é”™çš„ã€‚é«˜é…éƒ½æœ‰ TouchBar çš„ã€‚ å‡ºäº qiong ï¼Œæˆ‘ä¹°äº† 2016 æ¬¾ï¼Œé…ç½®æ˜¯ï¼š ä¸è¿‡ç°åœ¨ 2016 æ¬¾å¥½åƒåœäº§äº†ã€‚ åˆ°æ‰‹2018.01.11 ä¸‹åˆå…­ç‚¹å¿«é€’é€åˆ°çš„ï¼Œå¾ˆå¼€å¿ƒã€‚æ™šä¸Šæ‹¿å›å®¶æ‹†ç®±ï¼Œç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯æ£€æŸ¥åºåˆ—å·å•Šï¼Œä¸Šé¢çš„å›¾ç‰‡æ‰“ç æ‰çš„å°±æ˜¯åºåˆ—å·ï¼Œè¿™ä¸ªåºåˆ—å·åœ¨ç”µè„‘æœºèº«ã€ç³»ç»Ÿã€å¤–ç‰›çš®ç™£ç›’éƒ½æœ‰çš„ï¼Œå¯ä»¥åœ¨å®˜ç½‘æŸ¥è¯¢è¿™ä¸ªåºåˆ—å·ï¼Œè·å¾—ç”µè„‘çš„æ¿€æ´»æ—¥æœŸå’Œå‰©ä½™ä¿ä¿®æ—¶é—´çš„ã€‚å†å°±æ˜¯æŸ¥è¯¢ç”µè„‘çš„ç”µæ± å¾ªç¯æ¬¡æ•°äº†ï¼Œæˆ‘çš„æ˜¯ä¸€æ¬¡ï¼Œä¸€èˆ¬å¥½åƒæ˜¯å‡ æ¬¡ä¹‹å†…éƒ½æ˜¯ç¬¦åˆçš„ã€‚è¯æ˜ä¹‹å‰æ²¡è¢«åˆ«äººç”¨è¿‡ï¼Œè¿™ä¸ªæ•°å­—æˆ‘ä¹Ÿå¿˜è®°äº†ã€‚ ç†Ÿæ‚‰ç³»ç»ŸMac ç³»ç»Ÿæ˜¯ç±» Unix ç³»ç»Ÿï¼Œå…¶å®æˆ‘è§‰å¾—åˆ°å’Œ Ubuntu ç³»ç»ŸæŒºåƒçš„ï¼Œæ—¢æœ‰å›¾å½¢åŒ–ç•Œé¢ï¼Œä¹Ÿå¯ä»¥å‘½ä»¤è¡Œæ“ä½œã€‚ç†Ÿæ‚‰è¿‡ Linux çš„åº”è¯¥ä¸Šæ‰‹å¾ˆå¿«çš„ã€‚ å®‰è£…è½¯ä»¶å¯ä»¥åœ¨ Appstore é‡Œé¢ä¸‹è½½ï¼Œä¹Ÿå¯ä»¥åœ¨ä¸€äº›è½¯ä»¶çš„å®˜ç½‘ç›´æ¥ä¸‹è½½ mac ç‰ˆçš„ã€‚å®‰è£…ä¹ŸæŒºç®€å•çš„ã€‚å¦‚æœä½ ä¸çŸ¥é“æœ‰ä»€ä¹ˆè½¯ä»¶å¯ä»¥å®‰è£…ï¼Œé‚£ä¹ˆæˆ‘è¿™é‡Œç»™ä½ ä»½ Mac è½¯ä»¶å‚è€ƒåˆ—è¡¨ï¼šhttps://github.com/jaywcjlove/awesome-mac/blob/master/README-zh.md å½“ç„¶äº†ï¼Œä¸Šé¢çš„ä¸ä¸€å®šå…¨ï¼Œå…·ä½“ç”¨åˆ°å…¶ä»–çš„è¿˜æ˜¯çš„è‡ªå·±å»æ‰¾å¯¹åº”çš„è½¯ä»¶ã€‚ è¿˜æœ‰å°±æ˜¯å¥½å¤šè½¯ä»¶æ˜¯æ”¶è´¹çš„ï¼Œåœ¨ Mac ä¸Šå¦‚æœè¦ä¸‹è½½çš„è¯ï¼Œè¿˜çš„è´¹ç‚¹å¿ƒæ€å»ç ´è§£ï¼Œæ¯”å¦‚ Officeã€IDEAã€Adobe ç³»åˆ—ç­‰ï¼Œå½“ç„¶ä¹Ÿä¸æ˜¯é¼“å¹å¤§å®¶å»ç ´è§£ï¼Œæˆ‘ä»¬è‡ªå·±ç”¨ç”¨å°±è¡Œï¼Œè™½è¯´ç°åœ¨æ²¡é’±æ”¯æŒï¼Œä½†æ˜¯æœ‰é’±çš„è¯è¿˜æ˜¯æ”¯æŒä¸‹ã€‚æˆ‘ä¸€ä¸ªå†™åšå®¢çš„çŸ¥é“å†™åšå®¢çš„ä¸å®¹æ˜“ï¼Œé‚£å†™è½¯ä»¶çš„æ›´ä¸å®¹æ˜“äº†ï¼Œèƒ½æ”¯æŒä¸€ä¸¤å—ä¹ŸæŒºå¥½çš„ã€‚ ç„¶åå°±æ˜¯ç¾åŒ–ä¸‹æˆ‘ä»¬çš„ä¸€äº›è½¯ä»¶ï¼Œæ¯”å¦‚æˆ‘ä»¬çš„ç»ˆç«¯ä¹‹ç±»çš„ã€å°½é‡ä½¿ç”¨ Homebrew å®‰è£…è½¯ä»¶ã€‚å½“ç„¶è¿™ç¯‡æ–‡ç« ä¸ä¼šå†™è¿™äº›çš„ï¼Œæ”¹å¤©ä¸“é—¨å†™ç¯‡æ–‡ç« å†™è¿™ä¸ªè¯é¢˜ã€‚ è¿˜æœ‰å°±æ˜¯åœ¨ Mac ä¸Šä»æ–°æ‰“é€ ä¸€ä¸ªé€‚åˆè‡ªå·±çš„æ–°å†™ä½œç¯å¢ƒï¼ˆè½¯ä»¶ã€Hexo å†™åšå®¢ç¯å¢ƒï¼‰ã€‚ æœ€åä½“éªŒäº† Mac ä¹Ÿæœ‰ä¸€ä¸ªå¤šç¤¼æ‹œäº†ï¼Œæ•´ä½“æ•ˆæœè¿˜æ˜¯ä¸é”™çš„ï¼Œæ¯•ç«ŸèŠ±äº†å·¨èµ„å‘¢ï¼Œä¹Ÿç®—æ˜¯å®Œæˆäº†è‡ªå·±å¹´å‰çš„å°ç›®æ ‡ã€‚å…ˆ bb åˆ°è¿™é‡Œå§ã€‚æœ‰æ—¶é—´å†å†™ç‚¹å…³äº Mac ä¸Šçš„ä¸œè¥¿ï¼Œè¿™æ¬¡å†™çš„æ¯”è¾ƒç®€å•ï¼Œè¿™ç¯‡æ–‡ç« ä¹Ÿæ˜¯åœ¨ Mac ä¸Šå†™çš„ç¬¬ä¸€ç¯‡æ–‡ç« ã€‚","tags":[{"name":"Mac","slug":"Mac","permalink":"http://www.54tianzhisheng.cn/tags/Mac/"}]},{"title":"Spring Bootç³»åˆ—æ–‡ç« ï¼ˆäºŒï¼‰ï¼šSpringBoot Admin ä½¿ç”¨æŒ‡å—","date":"2018-01-16T16:00:00.000Z","path":"2018/01/17/SpringBoot-Admin/","text":"ä»€ä¹ˆæ˜¯ SpringBoot Adminï¼ŸSpring Boot Admin æ˜¯ä¸€ä¸ªç®¡ç†å’Œç›‘æ§ä½ çš„ Spring Boot åº”ç”¨ç¨‹åºçš„åº”ç”¨ç¨‹åºã€‚ è¿™äº›åº”ç”¨ç¨‹åºé€šè¿‡ Spring Boot Admin Clientï¼ˆé€šè¿‡ HTTPï¼‰æ³¨å†Œæˆ–è€…ä½¿ç”¨ Spring Cloudï¼ˆä¾‹å¦‚ Eurekaï¼‰å‘ç°ã€‚ UIåªæ˜¯ Spring Boot Actuator ç«¯ç‚¹ä¸Šçš„ä¸€ä¸ª AngularJs åº”ç”¨ç¨‹åºã€‚ SpringBoot ç³»åˆ—æ–‡ç«  å¿«é€Ÿå¼€å§‹é¦–å…ˆåœ¨ IDEA åˆ›å»ºä¸€ä¸ª SpringBoot é¡¹ç›®ï¼ŒæŠŠå®ƒå½“ä½œ server ç«¯ï¼Œå·¥ç¨‹å¦‚ä¸‹ï¼š ç„¶ååœ¨ pom.xml ä¸­å¼•å…¥ä¾èµ–ï¼š 12345678910&lt;dependency&gt; &lt;groupId&gt;de.codecentric&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-admin-server&lt;/artifactId&gt; &lt;version&gt;1.5.6&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;de.codecentric&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-admin-server-ui&lt;/artifactId&gt; &lt;version&gt;1.5.6&lt;/version&gt;&lt;/dependency&gt; ç»§ç»­åœ¨å¯åŠ¨ç±» SpringbootAdminApplication.java ä¸­å¼•å…¥æ³¨è§£ @EnableAdminServer ï¼Œç„¶åè¿è¡Œé¡¹ç›®ï¼š è®¿é—® http://localhost:8084/ å³å¯ï¼š æ­¤æ—¶ä¼šå‘ç°æ²¡æœ‰ä»»ä½•åº”ç”¨ç¨‹åºçš„ä¿¡æ¯ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬æ–°å»ºä¸€ä¸ª SpringBoot é¡¹ç›®ï¼ŒæŠŠå®ƒå½“ä½œå®¢æˆ·ç«¯ç¨‹åºï¼Œå·¥ç¨‹å¦‚ä¸‹ï¼š åœ¨ pom.xml ä¸­æ·»åŠ ä¾èµ–ï¼š 12345&lt;dependency&gt; &lt;groupId&gt;de.codecentric&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-admin-starter-client&lt;/artifactId&gt; &lt;version&gt;1.5.6&lt;/version&gt;&lt;/dependency&gt; ç„¶ååœ¨ application.yml ä¸­è®¾ç½®ï¼š spring.boot.admin.url=http:localhost:8094 ç”¨äºå°†å½“å‰åº”ç”¨æ³¨å†Œåˆ° Spring Boot Adminã€‚ è¿˜å¯ä»¥è®¾ç½®ï¼Œspring.boot.admin.client.name: ï¼ˆåº”ç”¨ç¨‹åºçš„åå­—ï¼‰ä¸è®¾ç½®çš„è¯ä¼šæœ‰é»˜è®¤çš„åå­— æ­¤æ—¶æŠŠä¸¤ä¸ªé¡¹ç›®è¿è¡Œèµ·æ¥ï¼š ç‚¹å‡»å›¾ä¸­çš„ detail æŒ‰é’®ï¼šå¯ä»¥çœ‹åˆ°åº”ç”¨ç¨‹åºçš„å¥åº·å€¼ã€å†…å­˜ã€JVMã€GC ç­‰ä¿¡æ¯ã€‚ metrics ä¿¡æ¯ï¼š ç¯å¢ƒ ä¿¡æ¯ï¼š log ä¿¡æ¯ï¼š JMX ä¿¡æ¯ï¼š çº¿ç¨‹ ä¿¡æ¯ï¼š Trace è¿½è¸ªä¿¡æ¯ï¼š è¿˜å¯ä»¥ä¸‹è½½ Heapdump æ–‡ä»¶ã€‚ åˆšæ‰é¦–é¡µçš„åº”ç”¨åˆ—è¡¨åé¢æœ‰ä¸ªçº¢è‰²çš„ Ã—ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ³¨å†Œä¸Šå»çš„åº”ç”¨ç§»é™¤ï¼Œä½†æ˜¯åªè¦ä½ ä¸æŠŠç¨‹åºåœæ‰ï¼Œå®ƒç«‹é©¬åˆä¼šæ³¨å†Œä¸Šå»ã€‚ è¿˜æœ‰å°±æ˜¯åº”ç”¨åˆ—è¡¨çš„ version å’Œ info ä¸Šé¢çš„å›¾ä¸­ä¸ºç©ºï¼Œä¸‹é¢çœ‹çœ‹æ€ä¹ˆæŠŠå®ƒå˜å‡ºæ¥ï¼š 123info.groupId: @project.groupId@info.artifactId: @project.artifactId@info.version: @project.version@ é‡æ–°è¿è¡Œå®¢æˆ·ç«¯ç¨‹åºï¼Œåˆ·æ–°é¡µé¢å¯ä»¥å‘ç°ï¼š è¿˜å¯ä»¥æŸ¥è¯¢åº”ç”¨ç¨‹åºçš„äº‹ä»¶å˜åŒ–ï¼š å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºJMX beanç®¡ç†è¦åœ¨ç®¡ç†ç•Œé¢ä¸­ä¸JMX-beansè¿›è¡Œäº¤äº’ï¼Œæ‚¨å¿…é¡»åœ¨å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºä¸­åŒ…å« Jolokia, pom.xml åŠ å…¥ä¾èµ–ï¼š 1234&lt;dependency&gt; &lt;groupId&gt;org.jolokia&lt;/groupId&gt; &lt;artifactId&gt;jolokia-core&lt;/artifactId&gt;&lt;/dependency&gt; é‡å¯å®¢æˆ·ç«¯ç¨‹åºåï¼Œå°±å¯ä»¥åœ¨è¿™é‡Œä¸ JMX åšäº¤äº’äº†ï¼š è¿˜æœ‰å¾ˆå¤š SpringBoot Admin å®¢æˆ·ç«¯é…ç½®é€‰é¡¹ï¼š http://codecentric.github.io/spring-boot-admin/1.5.6/#spring-boot-admin-client æœåŠ¡ç«¯ç¨‹åºä¹Ÿæœ‰äº› SpringBoot Admin æœåŠ¡ç«¯ç¨‹åºé…ç½®é€‰é¡¹ï¼š http://codecentric.github.io/spring-boot-admin/1.5.6/#spring-boot-admin-server å®˜æ–¹æ–‡æ¡£é‡Œé¢è¿˜æœ‰äº›å…³äºæœåŠ¡ä¸‹çº¿æ¶ˆæ¯é€šçŸ¥çš„çŸ¥è¯†ï¼Œæƒ³äº†è§£çš„å¯ä»¥æŸ¥çœ‹ï¼š http://codecentric.github.io/spring-boot-admin/1.5.6/#_notifications å…³æ³¨æˆ‘ å‚è€ƒæ–‡ç« http://codecentric.github.io/spring-boot-admin/1.5.6/ æœ€åè½¬è½½è¯·æ³¨æ˜æ–‡ç« åŸå§‹åœ°å€ä¸ºï¼šhttp://www.54tianzhisheng.cn/2018/01/17/SpringBoot-Admin/","tags":[{"name":"Java","slug":"Java","permalink":"http://www.54tianzhisheng.cn/tags/Java/"},{"name":"SpringBoot","slug":"SpringBoot","permalink":"http://www.54tianzhisheng.cn/tags/SpringBoot/"}]},{"title":"Lombok çœ‹è¿™ç¯‡å°±å¤Ÿäº†","date":"2018-01-08T16:00:00.000Z","path":"2018/01/09/lombok/","text":"å‰æè‡ªä»è¿›å…¬å¸å®ä¹ åï¼Œé¡¹ç›®ä»£ç ä¸­èƒ½ç”¨ Lombok çš„éƒ½ç”¨äº†ï¼Œæ¯•ç«Ÿè¿™ä¹ˆå¥½çš„è½®å­è¦å……åˆ†åˆ©ç”¨å¥½ã€‚ä¹Ÿå¯ä»¥å‡å°‘ä¸€äº› get/set/toString æ–¹æ³•çš„ç¼–å†™ï¼Œè™½è¯´ IDEA çš„æ’ä»¶å¯ä»¥è‡ªåŠ¨ç”Ÿæˆ get/set/toString æ–¹æ³•ï¼Œä½†æ˜¯ä½¿ç”¨ Lombok å¯ä»¥è®©ä»£ç æ›´ç®€æ´ã€‚ä¸‹é¢çœ‹çœ‹å¦‚ä½•åœ¨ IDEA ä¸­å¦‚ä½•å®‰è£… Lombokï¼š å®‰è£…æ‰“å¼€ IDEA çš„ Settings é¢æ¿ï¼Œå¹¶é€‰æ‹© Plugins é€‰é¡¹ï¼Œç„¶åç‚¹å‡» â€œBrowse repositoriesâ€ åœ¨è¾“å…¥æ¡†è¾“å…¥â€lombokâ€ï¼Œå¾—åˆ°æœç´¢ç»“æœï¼Œç‚¹å‡»å®‰è£…ï¼Œç„¶åå®‰è£…æç¤ºé‡å¯ IDEAï¼Œå®‰è£…æˆåŠŸ; å¼•å…¥ä¾èµ–åœ¨è‡ªå·±çš„é¡¹ç›®é‡Œæ·»åŠ  lombok çš„ç¼–è¯‘æ”¯æŒï¼Œåœ¨ pom æ–‡ä»¶é‡Œé¢æ·»åŠ  dependency 123456&lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;version&gt;1.16.18&lt;/version&gt; &lt;scope&gt;provided&lt;/scope&gt;&lt;/dependency&gt; æ€ä¹ˆä½¿ç”¨ï¼Ÿåœ¨å®ä½“ç±»ä¸Šå¼•å…¥ç›¸å…³çš„æ³¨è§£å°±è¡Œï¼š æœ‰å“ªäº›æ³¨è§£ï¼Ÿ @Data @Setter @Getter @Slf4j @AllArgsConstructor @NoArgsConstructor @EqualsAndHashCode @NonNull @Cleanup @ToString @RequiredArgsConstructor @Value @SneakyThrows @Synchronized æ³¨è§£è¯¦è§£@Data æ³¨è§£åœ¨ ç±» ä¸Šï¼›æä¾›ç±»æ‰€æœ‰å±æ€§çš„ get å’Œ set æ–¹æ³•ï¼Œæ­¤å¤–è¿˜æä¾›äº†equalsã€canEqualã€hashCodeã€toString æ–¹æ³•ã€‚ @Setter æ³¨è§£åœ¨ å±æ€§ ä¸Šï¼›ä¸ºå•ä¸ªå±æ€§æä¾› set æ–¹æ³•; æ³¨è§£åœ¨ ç±» ä¸Šï¼Œä¸ºè¯¥ç±»æ‰€æœ‰çš„å±æ€§æä¾› set æ–¹æ³•ï¼Œ éƒ½æä¾›é»˜è®¤æ„é€ æ–¹æ³•ã€‚ @Getter æ³¨è§£åœ¨ å±æ€§ ä¸Šï¼›ä¸ºå•ä¸ªå±æ€§æä¾› get æ–¹æ³•; æ³¨è§£åœ¨ ç±» ä¸Šï¼Œä¸ºè¯¥ç±»æ‰€æœ‰çš„å±æ€§æä¾› get æ–¹æ³•ï¼Œéƒ½æä¾›é»˜è®¤æ„é€ æ–¹æ³•ã€‚ @Slf4j æ³¨è§£åœ¨ ç±» ä¸Šï¼›ä¸ºç±»æä¾›ä¸€ä¸ª å±æ€§åä¸º log çš„æ—¥å¿—å¯¹è±¡ï¼Œæä¾›é»˜è®¤æ„é€ æ–¹æ³•ã€‚ @AllArgsConstructor æ³¨è§£åœ¨ ç±» ä¸Šï¼›ä¸ºç±»æä¾›ä¸€ä¸ªå…¨å‚çš„æ„é€ æ–¹æ³•ï¼ŒåŠ äº†è¿™ä¸ªæ³¨è§£åï¼Œç±»ä¸­ä¸æä¾›é»˜è®¤æ„é€ æ–¹æ³•äº†ã€‚ @NoArgsConstructor æ³¨è§£åœ¨ ç±» ä¸Šï¼›ä¸ºç±»æä¾›ä¸€ä¸ªæ— å‚çš„æ„é€ æ–¹æ³•ã€‚ @EqualsAndHashCode æ³¨è§£åœ¨ ç±» ä¸Š, å¯ä»¥ç”Ÿæˆ equalsã€canEqualã€hashCode æ–¹æ³•ã€‚ @NonNull æ³¨è§£åœ¨ å±æ€§ ä¸Šï¼Œä¼šè‡ªåŠ¨äº§ç”Ÿä¸€ä¸ªå…³äºæ­¤å‚æ•°çš„éç©ºæ£€æŸ¥ï¼Œå¦‚æœå‚æ•°ä¸ºç©ºï¼Œåˆ™æŠ›å‡ºä¸€ä¸ªç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œä¹Ÿä¼šæœ‰ä¸€ä¸ªé»˜è®¤çš„æ— å‚æ„é€ æ–¹æ³•ã€‚ @Cleanup è¿™ä¸ªæ³¨è§£ç”¨åœ¨ å˜é‡ å‰é¢ï¼Œå¯ä»¥ä¿è¯æ­¤å˜é‡ä»£è¡¨çš„èµ„æºä¼šè¢«è‡ªåŠ¨å…³é—­ï¼Œé»˜è®¤æ˜¯è°ƒç”¨èµ„æºçš„ close() æ–¹æ³•ï¼Œå¦‚æœè¯¥èµ„æºæœ‰å…¶å®ƒå…³é—­æ–¹æ³•ï¼Œå¯ä½¿ç”¨ @Cleanup(â€œmethodNameâ€) æ¥æŒ‡å®šè¦è°ƒç”¨çš„æ–¹æ³•ï¼Œä¹Ÿä¼šç”Ÿæˆé»˜è®¤çš„æ„é€ æ–¹æ³• @ToString è¿™ä¸ªæ³¨è§£ç”¨åœ¨ ç±» ä¸Šï¼Œå¯ä»¥ç”Ÿæˆæ‰€æœ‰å‚æ•°çš„ toString æ–¹æ³•ï¼Œè¿˜ä¼šç”Ÿæˆé»˜è®¤çš„æ„é€ æ–¹æ³•ã€‚ @RequiredArgsConstructor è¿™ä¸ªæ³¨è§£ç”¨åœ¨ ç±» ä¸Šï¼Œä½¿ç”¨ç±»ä¸­æ‰€æœ‰å¸¦æœ‰ @NonNull æ³¨è§£çš„æˆ–è€…å¸¦æœ‰ final ä¿®é¥°çš„æˆå‘˜å˜é‡ç”Ÿæˆå¯¹åº”çš„æ„é€ æ–¹æ³•ã€‚ @Value è¿™ä¸ªæ³¨è§£ç”¨åœ¨ ç±» ä¸Šï¼Œä¼šç”Ÿæˆå«æ‰€æœ‰å‚æ•°çš„æ„é€ æ–¹æ³•ï¼Œget æ–¹æ³•ï¼Œæ­¤å¤–è¿˜æä¾›äº†equalsã€hashCodeã€toString æ–¹æ³•ã€‚ @SneakyThrows è¿™ä¸ªæ³¨è§£ç”¨åœ¨ æ–¹æ³• ä¸Šï¼Œå¯ä»¥å°†æ–¹æ³•ä¸­çš„ä»£ç ç”¨ try-catch è¯­å¥åŒ…è£¹èµ·æ¥ï¼Œæ•è·å¼‚å¸¸å¹¶åœ¨ catch ä¸­ç”¨ Lombok.sneakyThrow(e) æŠŠå¼‚å¸¸æŠ›å‡ºï¼Œå¯ä»¥ä½¿ç”¨ @SneakyThrows(Exception.class) çš„å½¢å¼æŒ‡å®šæŠ›å‡ºå“ªç§å¼‚å¸¸ï¼Œä¹Ÿä¼šç”Ÿæˆé»˜è®¤çš„æ„é€ æ–¹æ³•ã€‚ @Synchronized è¿™ä¸ªæ³¨è§£ç”¨åœ¨ ç±»æ–¹æ³• æˆ–è€… å®ä¾‹æ–¹æ³• ä¸Šï¼Œæ•ˆæœå’Œ synchronized å…³é”®å­—ç›¸åŒï¼ŒåŒºåˆ«åœ¨äºé”å¯¹è±¡ä¸åŒï¼Œå¯¹äºç±»æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•ï¼Œsynchronized å…³é”®å­—çš„é”å¯¹è±¡åˆ†åˆ«æ˜¯ç±»çš„ class å¯¹è±¡å’Œ this å¯¹è±¡ï¼Œè€Œ @Synchronized çš„é”å¯¹è±¡åˆ†åˆ«æ˜¯ ç§æœ‰é™æ€ final å¯¹è±¡ lock å’Œ ç§æœ‰ final å¯¹è±¡ lockï¼Œå½“ç„¶ï¼Œä¹Ÿå¯ä»¥è‡ªå·±æŒ‡å®šé”å¯¹è±¡ï¼Œæ­¤å¤–ä¹Ÿæä¾›é»˜è®¤çš„æ„é€ æ–¹æ³•ã€‚ æ€»ç»“ä»¥ä¸Šæ³¨è§£å¯æ ¹æ®éœ€è¦ä¸€èµ·æ­é…ä½¿ç”¨ï¼ è™½è¯´è½®å­å¥½ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸ä»…è¦çŸ¥å…¶ç„¶ï¼Œä¹Ÿè¦çŸ¥å…¶æ‰€ä»¥ç„¶ï¼ å…³æ³¨æˆ‘ æœ€åè½¬è½½è¯·æ³¨æ˜åŸåˆ›åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2018/01/07/lombok/","tags":[{"name":"lombok","slug":"lombok","permalink":"http://www.54tianzhisheng.cn/tags/lombok/"}]},{"title":"Spring Bootç³»åˆ—æ–‡ç« ï¼ˆä¸€ï¼‰ï¼šSpringBoot Kafka æ•´åˆä½¿ç”¨","date":"2018-01-04T16:00:00.000Z","path":"2018/01/05/SpringBoot-Kafka/","text":"å‰æå‡è®¾ä½ äº†è§£è¿‡ SpringBoot å’Œ Kafkaã€‚ SpringBoot ç³»åˆ—æ–‡ç«  1ã€SpringBoot å¦‚æœå¯¹ SpringBoot ä¸äº†è§£çš„è¯ï¼Œå»ºè®®å»çœ‹çœ‹ DD å¤§ä½¬ çš„ç³»åˆ—åšå®¢ã€‚ 2ã€Kafka Kafka çš„è¯å¯ä»¥çœ‹çœ‹æˆ‘å‰ä¸¤å¤©å†™çš„åšå®¢ ï¼š Kafka å®‰è£…åŠå¿«é€Ÿå…¥é—¨ å­¦ä¹ çš„è¯è‡ªå·±å¼€å°è™šæ‹Ÿæœºè‡ªå·±æ‰‹åŠ¨æ­å»ºç¯å¢ƒå§ï¼Œæœ‰æ¡ä»¶çš„ä¹°æœåŠ¡å™¨ã€‚ æ³¨æ„ï¼šä¸€å®šè¦äº²è‡ªè‡ªå·±å®‰è£…å®è·µï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†è¿™ä¸¤ä¸ªè¿›è¡Œæ•´åˆã€‚ åˆ›å»ºé¡¹ç›®é¡¹ç›®æ•´ä½“æ¶æ„ï¼š ä½¿ç”¨ IDEA åˆ›å»º SpringBoot é¡¹ç›®ï¼Œè¿™ä¸ªå¾ˆç®€å•äº†ï¼Œè¿™é‡Œä¸åšè¿‡å¤šçš„è®²è§£ã€‚ 1ã€pom æ–‡ä»¶ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;com.zhisheng&lt;/groupId&gt; &lt;artifactId&gt;kafka-learning&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;packaging&gt;jar&lt;/packaging&gt; &lt;name&gt;kafka-learning&lt;/name&gt; &lt;description&gt;Demo project for Spring Boot + kafka&lt;/description&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;1.5.9.RELEASE&lt;/version&gt; &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt; &lt;/parent&gt; &lt;properties&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.kafka&lt;/groupId&gt; &lt;artifactId&gt;spring-kafka&lt;/artifactId&gt; &lt;version&gt;1.1.1.RELEASE&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.google.code.gson&lt;/groupId&gt; &lt;artifactId&gt;gson&lt;/artifactId&gt; &lt;version&gt;2.8.2&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt;&lt;/project&gt; ä¸»è¦å¼•å…¥äº† spring-kafka ã€lombok ã€ gson ä¾èµ–ã€‚ 2ã€æ¶ˆæ¯å®ä½“ç±» Message.java å¦‚ä¸‹ï¼š 123456789@Datapublic class Message &#123; private Long id; //id private String msg; //æ¶ˆæ¯ private Date sendTime; //æ—¶é—´æˆ³&#125; 3ã€æ¶ˆæ¯å‘é€ç±» KafkaSender.java 12345678910111213141516171819@Component@Slf4jpublic class KafkaSender &#123; @Autowired private KafkaTemplate&lt;String, String&gt; kafkaTemplate; private Gson gson = new GsonBuilder().create(); //å‘é€æ¶ˆæ¯æ–¹æ³• public void send() &#123; Message message = new Message(); message.setId(System.currentTimeMillis()); message.setMsg(UUID.randomUUID().toString()); message.setSendTime(new Date()); log.info(\"+++++++++++++++++++++ message = &#123;&#125;\", gson.toJson(message)); kafkaTemplate.send(\"zhisheng\", gson.toJson(message)); &#125;&#125; å°±è¿™æ ·ï¼Œå‘é€æ¶ˆæ¯ä»£ç å°±å®ç°äº†ã€‚ è¿™é‡Œå…³é”®çš„ä»£ç ä¸º kafkaTemplate.send() æ–¹æ³•ï¼Œzhisheng æ˜¯ Kafka é‡Œçš„ topic ï¼Œè¿™ä¸ª topic åœ¨ Java ç¨‹åºä¸­æ˜¯ä¸éœ€è¦æå‰åœ¨ Kafka ä¸­è®¾ç½®çš„ï¼Œå› ä¸ºå®ƒä¼šåœ¨å‘é€çš„æ—¶å€™è‡ªåŠ¨åˆ›å»ºä½ è®¾ç½®çš„ topicï¼Œ gson.toJson(message) æ˜¯æ¶ˆæ¯å†…å®¹ï¼Œè¿™é‡Œæš‚æ—¶å…ˆè¯´è¿™ä¹ˆå¤šäº†ï¼Œä¸è¯¦è§£äº†ï¼Œåé¢æœ‰æœºä¼šç»§ç»­æŠŠé‡Œé¢æºç è§£è¯»å†™ç¯‡åšå®¢å‡ºæ¥ï¼ˆå› ä¸ºä¸­é€”ç¢°åˆ°å‘ï¼Œè€å­è·Ÿäº†å‡ éæºç ï¼‰ã€‚ 4ã€æ¶ˆæ¯æ¥æ”¶ç±» KafkaReceiver.java 12345678910111213141516171819@Component@Slf4jpublic class KafkaReceiver &#123; @KafkaListener(topics = &#123;\"zhisheng\"&#125;) public void listen(ConsumerRecord&lt;?, ?&gt; record) &#123; Optional&lt;?&gt; kafkaMessage = Optional.ofNullable(record.value()); if (kafkaMessage.isPresent()) &#123; Object message = kafkaMessage.get(); log.info(\"----------------- record =\" + record); log.info(\"------------------ message =\" + message); &#125; &#125;&#125; å®¢æˆ·ç«¯ consumer æ¥æ”¶æ¶ˆæ¯ç‰¹åˆ«ç®€å•ï¼Œç›´æ¥ç”¨ @KafkaListener æ³¨è§£å³å¯ï¼Œå¹¶åœ¨ç›‘å¬ä¸­è®¾ç½®ç›‘å¬çš„ topic ï¼Œtopics æ˜¯ä¸€ä¸ªæ•°ç»„æ‰€ä»¥æ˜¯å¯ä»¥ç»‘å®šå¤šä¸ªä¸»é¢˜çš„ï¼Œä¸Šé¢çš„ä»£ç ä¸­ä¿®æ”¹ä¸º @KafkaListener(topics = {&quot;zhisheng&quot;,&quot;tian&quot;}) å°±å¯ä»¥åŒæ—¶ç›‘å¬ä¸¤ä¸ª topic çš„æ¶ˆæ¯äº†ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼šè¿™é‡Œçš„ topic éœ€è¦å’Œæ¶ˆæ¯å‘é€ç±» KafkaSender.java ä¸­è®¾ç½®çš„ topic ä¸€è‡´ã€‚ 5ã€å¯åŠ¨ç±» KafkaApplication.java 123456789101112131415161718192021@SpringBootApplicationpublic class KafkaApplication &#123; public static void main(String[] args) &#123; ConfigurableApplicationContext context = SpringApplication.run(KafkaApplication.class, args); KafkaSender sender = context.getBean(KafkaSender.class); for (int i = 0; i &lt; 3; i++) &#123; //è°ƒç”¨æ¶ˆæ¯å‘é€ç±»ä¸­çš„æ¶ˆæ¯å‘é€æ–¹æ³• sender.send(); try &#123; Thread.sleep(3000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125;&#125; 6ã€é…ç½®æ–‡ä»¶ application.properties 1234567891011121314151617181920212223242526#============== kafka ===================# æŒ‡å®škafka ä»£ç†åœ°å€ï¼Œå¯ä»¥å¤šä¸ªspring.kafka.bootstrap-servers=192.168.153.135:9092#=============== provider =======================spring.kafka.producer.retries=0# æ¯æ¬¡æ‰¹é‡å‘é€æ¶ˆæ¯çš„æ•°é‡spring.kafka.producer.batch-size=16384spring.kafka.producer.buffer-memory=33554432# æŒ‡å®šæ¶ˆæ¯keyå’Œæ¶ˆæ¯ä½“çš„ç¼–è§£ç æ–¹å¼spring.kafka.producer.key-serializer=org.apache.kafka.common.serialization.StringSerializerspring.kafka.producer.value-serializer=org.apache.kafka.common.serialization.StringSerializer#=============== consumer =======================# æŒ‡å®šé»˜è®¤æ¶ˆè´¹è€…group idspring.kafka.consumer.group-id=test-consumer-groupspring.kafka.consumer.auto-offset-reset=earliestspring.kafka.consumer.enable-auto-commit=truespring.kafka.consumer.auto-commit-interval=100# æŒ‡å®šæ¶ˆæ¯keyå’Œæ¶ˆæ¯ä½“çš„ç¼–è§£ç æ–¹å¼spring.kafka.consumer.key-deserializer=org.apache.kafka.common.serialization.StringDeserializerspring.kafka.consumer.value-deserializer=org.apache.kafka.common.serialization.StringDeserializer spring.kafka.bootstrap-servers åé¢è®¾ç½®ä½ å®‰è£…çš„ Kafka çš„æœºå™¨ IP åœ°å€å’Œç«¯å£å· 9092ã€‚ å¦‚æœä½ åªæ˜¯ç®€å•æ•´åˆä¸‹ï¼Œå…¶ä»–çš„å‡ ä¸ªé»˜è®¤å°±å¥½äº†ã€‚ Kafka è®¾ç½®åœ¨ä½ å®‰è£…çš„ Kafka ç›®å½•æ–‡ä»¶ä¸‹ï¼š å¯åŠ¨ zkä½¿ç”¨å®‰è£…åŒ…ä¸­çš„è„šæœ¬å¯åŠ¨å•èŠ‚ç‚¹ Zookeeper å®ä¾‹ï¼š 1bin/zookeeper-server-start.sh -daemon config/zookeeper.properties å¯åŠ¨ Kafka æœåŠ¡ä½¿ç”¨ kafka-server-start.sh å¯åŠ¨ kafka æœåŠ¡ï¼š 1bin/kafka-server-start.sh config/server.properties å¯åŠ¨æˆåŠŸåï¼ åƒä¸‡æ³¨æ„ï¼š è®°å¾—å°†ä½ çš„è™šæ‹Ÿæœºæˆ–è€…æœåŠ¡å™¨å…³é—­é˜²ç«å¢™æˆ–è€…å¼€å¯ Kafka çš„ç«¯å£ 9092ã€‚ è¿è¡Œ å‡ºç°è¿™å°±ä»£è¡¨æ•´åˆæˆåŠŸäº†ï¼ æˆ‘ä»¬çœ‹ä¸‹ Kafka ä¸­çš„ topic åˆ—è¡¨å°± 1bin/kafka-topics.sh --list --zookeeper localhost:2181 å°±ä¼šå‘ç°åˆšæ‰æˆ‘ä»¬ç¨‹åºä¸­çš„ zhisheng å·²ç»è‡ªå·±åˆ›å»ºäº†ã€‚ å…³æ³¨æˆ‘ æœ€åè½¬è½½è¯·åŠ¡å¿…æ³¨æ˜åŸåˆ›åœ°å€ä¸ºï¼šhttp://www.54tianzhisheng.cn/2018/01/05/SpringBoot-Kafka/","tags":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"http://www.54tianzhisheng.cn/tags/SpringBoot/"},{"name":"Kafka","slug":"Kafka","permalink":"http://www.54tianzhisheng.cn/tags/Kafka/"}]},{"title":"ä¸ºä»€ä¹ˆè¦é‡æ–°è¿è¥ä»¥å‰çš„å…¬ä¼—å·å‘¢ï¼Ÿ","date":"2018-01-03T16:00:00.000Z","path":"2018/01/04/weixin/","text":"å‰æè€è¯»è€…å¯èƒ½ä¼šå‘ç°ç°åœ¨æˆ‘çš„å…¬ä¼—å·å·²ç»æ”¹åäº†ã€‚ï¼ˆç”± â€œçŒ¿blogâ€ å˜æˆ â€œzhishengâ€ äº†ï¼Œç»†å¿ƒçš„ç«¥é‹ä¼šå‘ç°ä¸ä»…åå­—å˜äº†ï¼Œ ID ä¹Ÿå˜äº†ï¼Œä½†æ˜¯å›¾ç‰‡è¿˜æ²¡æ”¹ï¼Œæš‚æ—¶è¿˜æ²¡æƒ³åˆ°å¥½çš„ logo å›¾ç‰‡ï¼‰ï¼Œä¸‹é¢è¯´è¯´ä¸ºå•¥å§ï¼ å¬æˆ‘ç BB ä¸Šå›¾æ˜¯ä¸¤å¹´å‰å…¬ä¼—å·ç¾¤å‘çš„ç¬¬ä¸€æ¡ä¿¡æ¯ï¼Œé‚£æ—¶è‡ªå·±è¿˜æ˜¯åœ¨å­¦æ ¡ï¼Œå¦‚ä»Šå·²ç»è¿›å…¥äº†ç¤¾ä¼šï¼Œåœ¨å…¬å¸å®ä¹ äº†ã€‚è®°å¾—å½“åˆå¼€è¿™ä¸ªå…¬ä¼—å·çš„åŸå› æ˜¯å› ä¸ºå‡ ä¸ªå¹´è½»äººæœ‰ç€æ¢¦æƒ³ï¼Œæ‰“ç®—ä¸€èµ·åšç‚¹ä¸œè¥¿ï¼Œå½“æ—¶ä¸€è…”çƒ­è¡€çš„è‡ªå·±ç«‹é©¬å°±å…ˆç”³è¯·äº†ä¸ªå…¬ä¼—å·ï¼Œåæ¥ â€œä¸œè¥¿â€ å€’æ˜¯æ²¡åšï¼Œåå€’æ˜¯æˆ‘è‡ªå·±æ…¢æ…¢çš„åœ¨å¾®ä¿¡å…¬ä¼—å·åˆ†äº«ä¸€äº›æ–‡ç« ï¼Œç„¶åé‚£æ—¶è‡ªå·±ä¹Ÿå†™åšå®¢ï¼ˆç®—ç®—è‡ªå·±å†™åšå®¢åº”è¯¥å¿«ä¸‰å¹´äº†ï¼ŒåšæŒçœŸä¸æ˜“å•Šï¼‰ï¼Œæ‰€ä»¥å¶å°”ä¹ŸæŠŠè‡ªå·±çš„åšå®¢åˆ†äº«åœ¨å¾®ä¿¡å…¬ä¼—å·ä¸Šã€‚ ä½†æ˜¯å¥½æ™¯ä¸é•¿ï¼Œé‚£æ—¶çš„å¾®ä¿¡å…¬ä¼—å·æ’ç‰ˆçœŸå°¼ç›éš¾ç”¨çš„ä¸€æ‰¹ï¼Œä½œä¸ºä¸€ä¸ªç†å·¥ç§‘çš„ç”·ç”Ÿï¼Œæœ¬æ¥è‡ªå·±åšäº‹ä¸€èˆ¬ç»†å¿ƒå’Œè€å¿ƒï¼Œæ— å¥ˆï¼ŒæŠŠè¿™ä¹ˆå¥½çš„ä¸€ä¸ªç«¥é‹éƒ½ç»™é€¼åäº†ã€‚æˆ‘ç°åœ¨è¿˜æ˜¯å¾—åæ§½ä¸‹ï¼Œå¦‚ä»Šçš„å¾®ä¿¡å…¬ä¼—å·åå°æ’ç‰ˆè¿˜æ˜¯é‚£ä¹ˆå·®ã€‚ä½†æ˜¯å¯èƒ½å› ä¸ºéœ€æ±‚æ¯”è¾ƒå¤šäº†ï¼Œæ‰€ä»¥å°±æœ‰äººåšå‡ºäº†å·¥å…·ï¼ˆå°† markdown æ’ç‰ˆååœ¨å°†æ•´ä¸ªæ ·å¼å¤åˆ¶ç²˜è´´åˆ°å¾®ä¿¡å…¬ä¼—å·åå°ï¼‰ï¼Œè¿™æ ·ä¸€ç¯‡æ’ç‰ˆè¿˜ç®—ä¸é”™çš„åšå®¢å°±å‡ºæ¥äº†ã€‚ è‡ªå·±æ—©å°±çŸ¥é“äº†è¿™ä¹ˆä¸ªå·¥å…·ï¼Œä»¥å‰çœ‹ DD çš„åšå®¢çš„æ—¶å€™å°±å‘ç°äº†è¿™ä¸ªå·¥å…·ï¼Œä½†æ˜¯å¾ˆä¹…æ²¡æ›´æ–°çš„å¾®ä¿¡å…¬ä¼—å·ï¼Œè‡ªå·±ä¹Ÿä¸æ€ä¹ˆæƒ³å†ç®¡ç†ã€‚ æœ‰äººå°±è¦é—®äº†ï¼Ÿé‚£ä¸ºå•¥ç°åœ¨åˆè¦å¼€å§‹è·Ÿæ–°äº†å‘¢ï¼Ÿ æˆ‘åªæƒ³è¯´ï¼šâ€œè´±äººå°±æ˜¯çŸ«æƒ…ï¼ï¼ï¼åˆæƒ³çæŠ˜è…¾ä¸‹ã€‚â€ï¼Œåæ­£è‡ªå·±çš„åšå®¢ä¹Ÿåœ¨ä¸æ–­çš„æ›´æ–°ï¼Œå¶å°”é¡ºå¸¦æŠŠæ–‡ç« åŒæ­¥åˆ°å¾®ä¿¡å…¬ä¼—å·å…¶å®ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚åœ¨å­¦æ ¡çš„æ—¶å€™æ—¶é—´æ¯”è¾ƒå¤šï¼Œé‚£æ—¶çœŸçš„æ˜¯æ—¶é—´æ¯”è¾ƒå¤šï¼Œåæ‚”æ²¡å¥½å¥½åšæŒè¿è¥ä¸‹æ¥ã€‚ç°åœ¨å·¥ä½œäº†ï¼Œè‡ªå·±å·¥ä½œä¹‹å¤–çš„æ—¶é—´è¾ƒå°‘ï¼Œé™¤äº†å­¦ä¹ ï¼Œå¶å°”å†™å†™åšå®¢ï¼Œå¨±ä¹æ—¶é—´æ¯”è¾ƒå°‘ï¼Œéƒ½æ˜¯å¤§å­¦æ—¶å®…çš„ã€‚ å‰æ®µæ—¶é—´è¢«äºº â€œå¿½æ‚ â€ è¯´ç»§ç»­æ›´æ–°å…¬ä¼—å·ï¼Œé‚£æ—¶åˆšå¥½ä¹Ÿå¿« 2018 å¹´äº†ï¼Œè‡ªå·±ä¹Ÿæƒ³ç»™è‡ªå·±å®šå‡ ä¸ªç›®æ ‡ï¼Œåœ¨å…ƒæ—¦çš„é‚£å¤©ï¼Œæƒ³æƒ³è¿˜æ˜¯ç»§ç»­æ›´æ–°å¾®ä¿¡å…¬ä¼—å·å§ï¼Œæ‰€ä»¥ä½ ä¹Ÿçœ‹å¾—åˆ°æœ€è¿‘æˆ‘çš„æ›´æ–°äº†ï¼Œå¯èƒ½æœ€è¿‘çš„æ›´æ–°æ¯”è¾ƒæœ‰è§„å¾‹ï¼Œå› ä¸ºè¿™äº›æ–‡ç« å¤§éƒ¨åˆ†æ˜¯ä¹‹å‰å°±å·²ç»å†™å¥½äº†çš„ï¼Œå·²ç»å‘è¿‡åœ¨æˆ‘çš„åšå®¢é‡Œäº†ã€‚ä¼°è®¡æŠŠè¿™äº›æ–‡ç« æ›´æ–°å®Œåï¼Œå°±ä¸ä¼šæ¯å¤©éƒ½æ›´æ–°æˆ‘è‡ªå·±çš„æ–‡ç« äº†ã€‚ å®šä½è¯´ä¸‹å¾®ä¿¡å…¬ä¼—å·çš„å®šä½å§ï¼š 1ã€æˆ‘çš„æŠ€æœ¯åšå®¢åº”è¯¥éƒ½ä¼šåŒæ­¥åœ¨è¿™é‡Œçš„ã€‚ 2ã€åˆ†äº«è‡ªå·±å¹³æ—¶çš„éšç¬”æ–‡ç« ã€‚ï¼ˆæ¯”å¦‚è¿™ç¯‡ã€‚ã€‚ã€‚ï¼‰ 3ã€é™¤äº†æŠ€æœ¯æ–‡ç« ï¼Œå½“ç„¶è¿˜æœ‰å¹³æ—¶è‡ªå·±çš„ å¥‡æ·«æŠ€å·§ ï¼ˆåŒ…æ‹¬ä½†ä¸é™äºå†™ä½œæ–¹å¼ã€æ¨èå¥½ç”¨çš„è½¯ä»¶ç­‰ï¼‰ 4ã€åˆ†äº«è‡ªå·±è§‰å¾—ä¸é”™çš„æ–‡ç« ï¼ˆåˆ«äººçš„ï¼Œå°½é‡å¾å¾—åŒæ„ï¼Œä¸€å®šä¼šå¤‡æ³¨åŸåˆ›åœ°å€çš„ï¼‰ 5ã€å¦‚æœä½ ä¹Ÿå†™åšå®¢ï¼Œä½†æ˜¯é˜…è¯»é‡å¾ˆå°çš„è¯ï¼Œå¯ä»¥è€ƒè™‘è‡ªèã€‚ï¼ˆæ³¨ï¼šæ–‡ç« æˆ‘å¯èƒ½ä¼šå®¡æ‰¹ï¼Œå¿…é¡»è¦è§‰å¾—ä¸é”™çš„æ–‡ç« ï¼‰ 6ã€åˆ†äº«ä¸€äº›å­¦ä¹ è§†é¢‘å’Œä¹¦ç± 7ã€åæœŸå¯èƒ½ä¼šæå·¥ä½œå†…æ¨ ã€‚ã€‚ã€‚ æš‚æ—¶åªæƒ³åˆ°è¿™äº›äº† é—®é¢˜æ¥äº†å› ä¸ºå·¥ä½œäº†ï¼Œæ‰€ä»¥æ—¶é—´å°‘ï¼Œè¿è¥è¿™å¾®ä¿¡å…¬ä¼—å·å¯èƒ½éœ€è¦èŠ±è´¹æˆ‘ä¸å°‘å·¥ä½œä¹‹å¤–çš„æ—¶é—´ã€‚ å¦‚æœå¯ä»¥çš„è¯ï¼Œæˆ‘å¸Œæœ›èƒ½æ‰¾åˆ°ä¸€ä¸ªèƒ½å¸®æˆ‘åˆ†æ‹…ç‚¹çš„æœ‹å‹ã€‚ æ³¨ï¼šæ— å¿çš„ï¼Œå¦‚æœä»‹æ„çš„è¯ï¼Œä¸‹é¢å°±ä¸ç”¨å†çœ‹äº†ã€‚ è¯´ç‚¹ç®€å•çš„è¦æ±‚å§ï¼š 1ã€ç»†å¿ƒã€è€å¿ƒçš„ boy or girl éƒ½è¡Œ 2ã€èµ·ç è¦çŸ¥é“ç‚¹ç¼–ç¨‹æ–¹é¢çš„çŸ¥è¯† 3ã€èƒ½åšæŒä¸‹æ¥ 4ã€å¯¹æ–°æŠ€æœ¯æœ‰æ•æ„Ÿçš„å—…è§‰ 5ã€æœ€åä¸€ç‚¹å°±æ˜¯ä½ è¦æœ‰ç‚¹æ—¶é—´äº†ï¼Œå¸Œæœ›ä¸è€½è¯¯ä½ å­¦ä¹  å†è¯´ä¸‹èƒ½ç»™ä½ å¸¦æ¥çš„ å¥½å¤„ å§ï¼š 1ã€è‚¯å®šèƒ½å¢åŠ ä½ çš„è¿è¥èƒ½åŠ›ï¼ˆå†å»äº’è”ç½‘å…¬å¸æŠ•è¿è¥å²—ä½ä¼šæœ‰ä¼˜åŠ¿çš„ï¼‰ 2ã€æœ¬äººä¸€å¼€å§‹ä¼šäº²è‡ªæ•™æˆè¯¥æ€ä¹ˆåšï¼Œæ‰€ä»¥æ²¡ç»éªŒçš„æœ‹å‹ä¸ç”¨æ‹…å¿ƒ 3ã€å¯ä»¥å¢åŠ å’Œå¤§ç‰›å‹¾æ­çš„æœºä¼šï¼Œä½ ä»¬æ‡‚çš„ã€‚ã€‚ 4ã€æœ¬äººå¯ä»¥äº²è‡ªä¼ æˆç»éªŒï¼ˆç¼–ç¨‹å’Œç”Ÿæ´»ç‚¹æ»´ç»éªŒï¼‰ å¦‚æœä½ æœ‰æ„æ„¿çš„è¯ï¼Œè¯·åŠ æˆ‘ QQ ï¼š 1041218129 èŠèŠå§ å…³æ³¨æˆ‘","tags":[{"name":"éšç¬”","slug":"éšç¬”","permalink":"http://www.54tianzhisheng.cn/tags/éšç¬”/"}]},{"title":"Kafka å®‰è£…åŠå¿«é€Ÿå…¥é—¨","date":"2018-01-03T16:00:00.000Z","path":"2018/01/04/Kafka/","text":"ä»‹ç»å®˜ç½‘ï¼šhttp://kafka.apache.org/ Apache Kafkaæ˜¯åˆ†å¸ƒå¼å‘å¸ƒ-è®¢é˜…æ¶ˆæ¯ç³»ç»Ÿã€‚å®ƒæœ€åˆç”±LinkedInå…¬å¸å¼€å‘ï¼Œä¹‹åæˆä¸ºApacheé¡¹ç›®çš„ä¸€éƒ¨åˆ†ã€‚Kafkaæ˜¯ä¸€ç§å¿«é€Ÿã€å¯æ‰©å±•çš„ã€è®¾è®¡å†…åœ¨å°±æ˜¯åˆ†å¸ƒå¼çš„ï¼Œåˆ†åŒºçš„å’Œå¯å¤åˆ¶çš„æäº¤æ—¥å¿—æœåŠ¡ã€‚Apache Kafkaä¸ä¼ ç»Ÿæ¶ˆæ¯ç³»ç»Ÿç›¸æ¯”ï¼Œæœ‰ä»¥ä¸‹ä¸åŒï¼š å®ƒè¢«è®¾è®¡ä¸ºä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œæ˜“äºå‘å¤–æ‰©å±•ï¼› å®ƒåŒæ—¶ä¸ºå‘å¸ƒå’Œè®¢é˜…æä¾›é«˜ååé‡ï¼› å®ƒæ”¯æŒå¤šè®¢é˜…è€…ï¼Œå½“å¤±è´¥æ—¶èƒ½è‡ªåŠ¨å¹³è¡¡æ¶ˆè´¹è€…ï¼› å®ƒå°†æ¶ˆæ¯æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œå› æ­¤å¯ç”¨äºæ‰¹é‡æ¶ˆè´¹ï¼Œä¾‹å¦‚ETLï¼Œä»¥åŠå®æ—¶åº”ç”¨ç¨‹åºã€‚ å®‰è£… kafkaä¸‹è½½åœ°å€ï¼šhttps://kafka.apache.org/downloads 1wget http://mirrors.shuosc.org/apache/kafka/1.0.0/kafka_2.11-1.0.0.tgz è§£å‹ï¼š123tar -zxvf kafka_2.11-1.0.0.tgzcd /usr/local/kafka_2.11-1.0.0/ ä¿®æ”¹ kafka-server çš„é…ç½®æ–‡ä»¶ 1vim /usr/local/kafka/config/server.properties ä¿®æ”¹å…¶ä¸­çš„ï¼š 12broker.id=1log.dir=/data/kafka/logs-1 åŠŸèƒ½éªŒè¯ï¼š1ã€å¯åŠ¨ zkä½¿ç”¨å®‰è£…åŒ…ä¸­çš„è„šæœ¬å¯åŠ¨å•èŠ‚ç‚¹ Zookeeper å®ä¾‹ï¼š 1bin/zookeeper-server-start.sh -daemon config/zookeeper.properties 2ã€å¯åŠ¨Kafka æœåŠ¡ä½¿ç”¨ kafka-server-start.sh å¯åŠ¨ kafka æœåŠ¡ï¼š 1bin/kafka-server-start.sh config/server.properties 3ã€åˆ›å»º topicä½¿ç”¨ kafka-topics.sh åˆ›å»ºå•åˆ†åŒºå•å‰¯æœ¬çš„ topic testï¼š 1bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic test æŸ¥çœ‹ topic åˆ—è¡¨ï¼š 1bin/kafka-topics.sh --list --zookeeper localhost:2181 æŸ¥è¯¢åˆ›å»ºçš„ topic åˆ—è¡¨æŠ¥é”™ï¼š è§£å†³æ–¹æ³•: 1vim /etc/hosts å°† host é‡Œçš„ 12127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4::1 localhost localhost.localdomain localhost6 localhost6.localdomain6 ä¿®æ”¹ä¸ºï¼š 12127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4::1 ip6-localhost ip6-localhost.localdomain localhost6 localhost6.localdomain6 æ–¹æ³•å‚è€ƒï¼šzookeeper unable to open socket to localhost/0:0:0:0:0:0:0:1:2181 å†æ¬¡æŸ¥è¯¢å°±ä¸æŠ¥é”™äº†ã€‚ 4ã€äº§ç”Ÿæ¶ˆæ¯ä½¿ç”¨ kafka-console-producer.sh å‘é€æ¶ˆæ¯ï¼š 1bin/kafka-console-producer.sh --broker-list localhost:9092 --topic test 5ã€æ¶ˆè´¹æ¶ˆæ¯ä½¿ç”¨ kafka-console-consumer.sh æ¥æ”¶æ¶ˆæ¯å¹¶åœ¨ç»ˆç«¯æ‰“å°ï¼š 1bin/kafka-console-consumer.sh --zookeeper localhost:2181 --topic test --from-beginning æ‰“å¼€ä¸ªæ–°çš„å‘½ä»¤çª—å£æ‰§è¡Œä¸Šé¢å‘½ä»¤å³å¯æŸ¥çœ‹ä¿¡æ¯ï¼š 6ã€æŸ¥çœ‹æè¿° topics ä¿¡æ¯1bin/kafka-topics.sh --describe --zookeeper localhost:2181 --topic test ç»“æœï¼š 12Topic:test PartitionCount:1 ReplicationFactor:1 Configs: Topic: test Partition: 0 Leader: 1 Replicas: 1 Isr: 1 ç¬¬ä¸€è¡Œç»™å‡ºäº†æ‰€æœ‰åˆ†åŒºçš„æ‘˜è¦ï¼Œæ¯ä¸ªé™„åŠ è¡Œç»™å‡ºäº†å…³äºä¸€ä¸ªåˆ†åŒºçš„ä¿¡æ¯ã€‚ ç”±äºæˆ‘ä»¬åªæœ‰ä¸€ä¸ªåˆ†åŒºï¼Œæ‰€ä»¥åªæœ‰ä¸€è¡Œã€‚ â€œLeaderâ€: æ˜¯è´Ÿè´£ç»™å®šåˆ†åŒºçš„æ‰€æœ‰è¯»å–å’Œå†™å…¥çš„èŠ‚ç‚¹ã€‚ æ¯ä¸ªèŠ‚ç‚¹å°†æˆä¸ºåˆ†åŒºéšæœºé€‰æ‹©éƒ¨åˆ†çš„é¢†å¯¼è€…ã€‚ â€œReplicasâ€: æ˜¯å¤åˆ¶æ­¤åˆ†åŒºæ—¥å¿—çš„èŠ‚ç‚¹åˆ—è¡¨ï¼Œæ— è®ºå®ƒä»¬æ˜¯å¦æ˜¯é¢†å¯¼è€…ï¼Œæˆ–è€…å³ä½¿ä»–ä»¬å½“å‰å¤„äºæ´»åŠ¨çŠ¶æ€ã€‚ â€œIsrâ€: æ˜¯ä¸€ç»„â€œåŒæ­¥â€å‰¯æœ¬ã€‚è¿™æ˜¯å¤åˆ¶å“åˆ—è¡¨çš„å­é›†ï¼Œå½“å‰æ´»ç€å¹¶è¢«å¼•å¯¼åˆ°é¢†å¯¼è€…ã€‚ é›†ç¾¤é…ç½®Kafka æ”¯æŒä¸¤ç§æ¨¡å¼çš„é›†ç¾¤æ­å»ºï¼šå¯ä»¥åœ¨å•æœºä¸Šè¿è¡Œå¤šä¸ª broker å®ä¾‹æ¥å®ç°é›†ç¾¤ï¼Œä¹Ÿå¯åœ¨å¤šå°æœºå™¨ä¸Šæ­å»ºé›†ç¾¤ï¼Œä¸‹é¢ä»‹ç»ä¸‹å¦‚ä½•å®ç°å•æœºå¤š broker å®ä¾‹é›†ç¾¤ï¼Œå…¶å®å¾ˆç®€å•ï¼Œåªéœ€è¦å¦‚ä¸‹é…ç½®å³å¯ã€‚ å•æœºå¤šbroker é›†ç¾¤é…ç½®åˆ©ç”¨å•èŠ‚ç‚¹éƒ¨ç½²å¤šä¸ª brokerã€‚ ä¸åŒçš„ broker è®¾ç½®ä¸åŒçš„ idï¼Œç›‘å¬ç«¯å£åŠæ—¥å¿—ç›®å½•ã€‚ ä¾‹å¦‚ï¼š 1234567cp config/server.properties config/server-2.propertiescp config/server.properties config/server-3.propertiesvim config/server-2.propertiesvim config/server-3.properties ä¿®æ”¹ ï¼š 12345broker.id=2listeners = PLAINTEXT://your.host.name:9093log.dir=/data/kafka/logs-2 å’Œ 12345broker.id=3listeners = PLAINTEXT://your.host.name:9094log.dir=/data/kafka/logs-3 å¯åŠ¨KafkaæœåŠ¡ï¼š 123bin/kafka-server-start.sh config/server-2.properties &amp;bin/kafka-server-start.sh config/server-3.properties &amp; è‡³æ­¤ï¼Œå•æœºå¤šbrokerå®ä¾‹çš„é›†ç¾¤é…ç½®å®Œæ¯•ã€‚ å¤šæœºå¤š broker é›†ç¾¤é…ç½®åˆ†åˆ«åœ¨å¤šä¸ªèŠ‚ç‚¹æŒ‰ä¸Šè¿°æ–¹å¼å®‰è£… Kafkaï¼Œé…ç½®å¯åŠ¨å¤šä¸ª Zookeeper å®ä¾‹ã€‚ å‡è®¾ä¸‰å°æœºå™¨ IP åœ°å€æ˜¯ ï¼š 192.168.153.135ï¼Œ 192.168.153.136ï¼Œ 192.168.153.137 åˆ†åˆ«é…ç½®å¤šä¸ªæœºå™¨ä¸Šçš„ Kafka æœåŠ¡ï¼Œè®¾ç½®ä¸åŒçš„ broker idï¼Œzookeeper.connect è®¾ç½®å¦‚ä¸‹: 1vim config/server.properties é‡Œé¢çš„ zookeeper.connect ä¿®æ”¹ä¸ºï¼š 1zookeeper.connect=192.168.153.135:2181,192.168.153.136:2181,192.168.153.137:2181 ä½¿ç”¨ Kafka Connect æ¥å¯¼å…¥/å¯¼å‡ºæ•°æ®ä»æ§åˆ¶å°å†™å…¥æ•°æ®å¹¶å°†å…¶å†™å›æ§åˆ¶å°æ˜¯ä¸€ä¸ªæ–¹ä¾¿çš„èµ·ç‚¹ï¼Œä½†æ‚¨å¯èƒ½æƒ³è¦ä½¿ç”¨å…¶ä»–æ¥æºçš„æ•°æ®æˆ–å°†æ•°æ®ä» Kafka å¯¼å‡ºåˆ°å…¶ä»–ç³»ç»Ÿã€‚å¯¹äºè®¸å¤šç³»ç»Ÿï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ Kafka Connect æ¥å¯¼å…¥æˆ–å¯¼å‡ºæ•°æ®ï¼Œè€Œä¸å¿…ç¼–å†™è‡ªå®šä¹‰é›†æˆä»£ç ã€‚ Kafka Connect æ˜¯ Kafka åŒ…å«çš„ä¸€ä¸ªå·¥å…·ï¼Œå¯ä»¥å°†æ•°æ®å¯¼å…¥å’Œå¯¼å‡ºåˆ° Kafkaã€‚å®ƒæ˜¯ä¸€ä¸ªå¯æ‰©å±•çš„å·¥å…·ï¼Œè¿è¡Œ è¿æ¥å™¨ï¼Œå®ç°ä¸å¤–éƒ¨ç³»ç»Ÿäº¤äº’çš„è‡ªå®šä¹‰é€»è¾‘ã€‚åœ¨è¿™ä¸ªå¿«é€Ÿå…¥é—¨ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä½•ä½¿ç”¨ç®€å•çš„è¿æ¥å™¨è¿è¡Œ Kafka Connectï¼Œè¿™äº›è¿æ¥å™¨å°†æ•°æ®ä»æ–‡ä»¶å¯¼å…¥åˆ° Kafka topicï¼Œå¹¶å°†æ•°æ®ä» Kafka topic å¯¼å‡ºåˆ°æ–‡ä»¶ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬å°†é€šè¿‡åˆ›å»ºä¸€äº›ç§å­æ•°æ®å¼€å§‹æµ‹è¯•ï¼š 1echo -e &quot;zhisheng\\ntian&quot; &gt; test.txt æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†å¯åŠ¨ä¸¤ä¸ªä»¥ç‹¬ç«‹æ¨¡å¼è¿è¡Œçš„è¿æ¥å™¨ï¼Œè¿™æ„å‘³ç€å®ƒä»¬å°†åœ¨å•ä¸ªæœ¬åœ°ä¸“ç”¨è¿›ç¨‹ä¸­è¿è¡Œã€‚æˆ‘ä»¬æä¾›ä¸‰ä¸ªé…ç½®æ–‡ä»¶ä½œä¸ºå‚æ•°ã€‚é¦–å…ˆæ˜¯ Kafka Connect è¿‡ç¨‹çš„é…ç½®ï¼ŒåŒ…å«å¸¸è§çš„é…ç½®ï¼Œä¾‹å¦‚è¦è¿æ¥çš„ Kafka ä»£ç†ä»¥åŠæ•°æ®çš„åºåˆ—åŒ–æ ¼å¼ã€‚å…¶ä½™çš„é…ç½®æ–‡ä»¶éƒ½æŒ‡å®šä¸€ä¸ªè¦åˆ›å»ºçš„è¿æ¥å™¨ã€‚è¿™äº›æ–‡ä»¶åŒ…æ‹¬å”¯ä¸€çš„è¿æ¥å™¨åç§°ï¼Œè¦å®ä¾‹åŒ–çš„è¿æ¥å™¨ç±»ä»¥åŠè¿æ¥å™¨æ‰€éœ€çš„ä»»ä½•å…¶ä»–é…ç½®ã€‚ 1bin/connect-standalone.sh config/connect-standalone.properties config/connect-file-source.properties config/connect-file-sink.properties Kafka é™„å¸¦çš„è¿™äº›ç¤ºä¾‹é…ç½®æ–‡ä»¶ä½¿ç”¨æ‚¨ä¹‹å‰å¯åŠ¨çš„é»˜è®¤æœ¬åœ°ç¾¤é›†é…ç½®ï¼Œå¹¶åˆ›å»ºä¸¤ä¸ªè¿æ¥å™¨ï¼šç¬¬ä¸€ä¸ªæ˜¯æºè¿æ¥å™¨ï¼Œç”¨äºè¯»å–è¾“å…¥æ–‡ä»¶ä¸­çš„è¡Œï¼Œå¹¶å°†æ¯ä¸ªè¿æ¥ç”Ÿæˆä¸º Kafka topicï¼Œç¬¬äºŒä¸ªä¸ºè¿æ¥å™¨å®ƒä» Kafka topic è¯»å–æ¶ˆæ¯ï¼Œå¹¶åœ¨è¾“å‡ºæ–‡ä»¶ä¸­äº§ç”Ÿæ¯è¡Œæ¶ˆæ¯ã€‚ åœ¨å¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œæ‚¨ä¼šçœ‹åˆ°ä¸€äº›æ—¥å¿—æ¶ˆæ¯ï¼Œå…¶ä¸­ä¸€äº›æŒ‡ç¤ºè¿æ¥å™¨æ­£åœ¨å®ä¾‹åŒ–ã€‚Kafka Connect è¿›ç¨‹å¯åŠ¨åï¼Œæºè¿æ¥å™¨åº”è¯¥å¼€å§‹è¯»å– test.txt topic connect-testï¼Œå¹¶å°†å…¶ç”Ÿæˆ topic ï¼Œå¹¶ä¸”æ¥æ”¶å™¨è¿æ¥å™¨åº”è¯¥å¼€å§‹è¯»å– topic ä¸­çš„æ¶ˆæ¯ connect-test å¹¶å°†å…¶å†™å…¥æ–‡ä»¶ test.sink.txtã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æ£€æŸ¥è¾“å‡ºæ–‡ä»¶çš„å†…å®¹æ¥éªŒè¯é€šè¿‡æ•´ä¸ªç®¡é“ä¼ è¾“çš„æ•°æ®ï¼š æ•°æ®å­˜å‚¨åœ¨ Kafka topic ä¸­ connect-testï¼Œå› æ­¤æˆ‘ä»¬ä¹Ÿå¯ä»¥è¿è¡Œæ§åˆ¶å°ä½¿ç”¨è€…æ¥æŸ¥çœ‹ topic ä¸­çš„æ•°æ® 1bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic connect-test --from-beginning è¿æ¥å™¨ç»§ç»­å¤„ç†æ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†æ•°æ®æ·»åŠ åˆ°æ–‡ä»¶ä¸­ï¼Œå¹¶çœ‹åˆ°å®ƒåœ¨ç®¡é“ä¸­ç§»åŠ¨ï¼š 1234echo zhishengtian&gt;&gt; test.txtecho zhishengtian2&gt;&gt; test.txtecho zhishengtian3&gt;&gt; test.txtecho zhishengtian4&gt;&gt; test.txt ä½¿ç”¨ Kafka æµæ¥å¤„ç†æ•°æ®Kafka Streams æ˜¯ç”¨äºæ„å»ºå…³é”®ä»»åŠ¡å®æ—¶åº”ç”¨ç¨‹åºå’Œå¾®æœåŠ¡çš„å®¢æˆ·ç«¯åº“ï¼Œè¾“å…¥å’Œ/æˆ–è¾“å‡ºæ•°æ®å­˜å‚¨åœ¨ Kafka é›†ç¾¤ä¸­ã€‚Kafka Streams ç»“åˆäº†åœ¨å®¢æˆ·ç«¯ç¼–å†™å’Œéƒ¨ç½²æ ‡å‡† Java å’Œ Scala åº”ç”¨ç¨‹åºçš„ç®€å•æ€§ä»¥åŠ Kafka æœåŠ¡å™¨ç«¯é›†ç¾¤æŠ€æœ¯çš„ä¼˜åŠ¿ï¼Œä½¿è¿™äº›åº”ç”¨ç¨‹åºå…·æœ‰é«˜åº¦å¯ä¼¸ç¼©æ€§ï¼Œå¼¹æ€§ï¼Œå®¹é”™æ€§ï¼Œåˆ†å¸ƒå¼ç­‰ç‰¹æ€§ã€‚ å¯å‚è€ƒå®˜ç½‘å…¥é—¨æ¡ˆä¾‹ï¼šhttp://kafka.apache.org/10/documentation/streams/quickstart å‚è€ƒ1ã€åœ¨CentOS 7ä¸Šå®‰è£…Kafka 2ã€http://kafka.apache.org/10/documentation/streams/quickstart å…³æ³¨æˆ‘ æœ€åè½¬è½½è¯·æ³¨æ˜åŸåˆ›åœ°å€ä¸ºï¼šhttp://www.54tianzhisheng.cn/2018/01/04/Kafka/","tags":[{"name":"Kafka","slug":"Kafka","permalink":"http://www.54tianzhisheng.cn/tags/Kafka/"}]},{"title":"Windows ä¸‹å®‰è£… Consul","date":"2017-12-26T16:00:00.000Z","path":"2017/12/27/consul-install/","text":"å‰æä»åˆšå·¥ä½œå°±å¼€å§‹æ¥è§¦ Consulï¼Œä¸­é€”è‡ªå·±ä¹Ÿæœ‰ä¸¤ä¸ªé¡¹ç›®å’Œ Consul æœ‰å…³ï¼Œåé¢æœ‰æœºä¼šå†è®²è®²ï¼Œç½‘ä¸Šå…³äºè¿™ä¸ªçš„èµ„æ–™è¿˜æ¯”è¾ƒå°‘ã€‚å› ä¸ºæ˜å¤©æœ‰ Consul çš„æŠ€æœ¯åˆ†äº«ï¼Œæ‰€ä»¥è‡ªå·±ä»Šå¤©ä¸‹åˆåœ¨å®˜ç½‘çœ‹äº†ä¸‹ç›¸å…³çš„ä»‹ç»ã€‚ ä»‹ç»Consul æ˜¯ä¸€ä¸ªæ”¯æŒå¤šæ•°æ®ä¸­å¿ƒåˆ†å¸ƒå¼é«˜å¯ç”¨çš„æœåŠ¡å‘ç°å’Œé…ç½®å…±äº«çš„æœåŠ¡è½¯ä»¶, ç”± HashiCorp å…¬å¸ç”¨ Go è¯­è¨€å¼€å‘, åŸºäº Mozilla Public License 2.0 çš„åè®®è¿›è¡Œå¼€æºã€‚Consul æ”¯æŒå¥åº·æ£€æŸ¥, å¹¶å…è®¸ HTTP å’Œ DNS åè®®è°ƒç”¨ API å­˜å‚¨é”®å€¼å¯¹ã€‚å‘½ä»¤è¡Œè¶…çº§å¥½ç”¨çš„è™šæ‹Ÿæœºç®¡ç†è½¯ä»¶ vgrant ä¹Ÿæ˜¯ HashiCorp å…¬å¸å¼€å‘çš„äº§å“ã€‚ä¸€è‡´æ€§åè®®é‡‡ç”¨ Raft ç®—æ³•, ç”¨æ¥ä¿è¯æœåŠ¡çš„é«˜å¯ç”¨ï¼Œ ä½¿ç”¨ GOSSIP åè®®ç®¡ç†æˆå‘˜å’Œå¹¿æ’­æ¶ˆæ¯, å¹¶ä¸”æ”¯æŒ ACL è®¿é—®æ§åˆ¶ã€‚ ä¸‹è½½å®‰è£…å»å®˜ç½‘ä¸‹è½½ï¼šhttps://www.consul.io/downloads.html å¾—åˆ°ä¸€ä¸ª zip å‹ç¼©åŒ… åœ¨ä½ æƒ³è¦å®‰è£…çš„ä½ç½®è§£å‹å°±è¡Œï¼Œåªæœ‰ä¸€ä¸ª consul.exe æ–‡ä»¶ï¼ˆæˆ‘çš„è§£å‹ä½ç½®æ˜¯ï¼šD:\\softwareï¼‰ è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆåœ¨ path ä¸­æ–°å¢ä¸€æ¡ï¼‰ï¼š D:\\software cmd å‘½ä»¤çª—å£å¯åŠ¨ï¼š 1consul agent -dev consul è‡ªå¸¦ UI ç•Œé¢ï¼Œæ‰“å¼€ç½‘å€ï¼šhttp://localhost:8500 ï¼Œå¯ä»¥çœ‹åˆ°å½“å‰æ³¨å†Œçš„æœåŠ¡ç•Œé¢ã€‚ Consul ä¼˜åŠ¿ ä½¿ç”¨ Raft ç®—æ³•æ¥ä¿è¯ä¸€è‡´æ€§, æ¯”å¤æ‚çš„ Paxos ç®—æ³•æ›´ç›´æ¥. ç›¸æ¯”è¾ƒè€Œè¨€, zookeeper é‡‡ç”¨çš„æ˜¯ Paxos, è€Œ etcd ä½¿ç”¨çš„åˆ™æ˜¯ Raft. æ”¯æŒå¤šæ•°æ®ä¸­å¿ƒï¼Œå†…å¤–ç½‘çš„æœåŠ¡é‡‡ç”¨ä¸åŒçš„ç«¯å£è¿›è¡Œç›‘å¬ã€‚ å¤šæ•°æ®ä¸­å¿ƒé›†ç¾¤å¯ä»¥é¿å…å•æ•°æ®ä¸­å¿ƒçš„å•ç‚¹æ•…éšœ,è€Œå…¶éƒ¨ç½²åˆ™éœ€è¦è€ƒè™‘ç½‘ç»œå»¶è¿Ÿ, åˆ†ç‰‡ç­‰æƒ…å†µç­‰. zookeeper å’Œ etcd å‡ä¸æä¾›å¤šæ•°æ®ä¸­å¿ƒåŠŸèƒ½çš„æ”¯æŒ. æ”¯æŒå¥åº·æ£€æŸ¥. etcd ä¸æä¾›æ­¤åŠŸèƒ½. æ”¯æŒ http å’Œ dns åè®®æ¥å£. zookeeper çš„é›†æˆè¾ƒä¸ºå¤æ‚, etcd åªæ”¯æŒ http åè®®. å®˜æ–¹æä¾›webç®¡ç†ç•Œé¢, etcd æ— æ­¤åŠŸèƒ½. ç»¼åˆæ¯”è¾ƒ, Consul ä½œä¸ºæœåŠ¡æ³¨å†Œå’Œé…ç½®ç®¡ç†çš„æ–°æ˜Ÿ, æ¯”è¾ƒå€¼å¾—å…³æ³¨å’Œç ”ç©¶. æœ€å æœ¬æ–‡é¦–å‘äºï¼šzhishengçš„åšå®¢ åœ°å€ä¸ºï¼šhttp://www.54tianzhisheng.cn/2017/12/27/consul-install/ è½¬è½½è¯·æ³¨æ˜åœ°å€ï¼","tags":[{"name":"Consul","slug":"Consul","permalink":"http://www.54tianzhisheng.cn/tags/Consul/"}]},{"title":"Elasticsearch ç³»åˆ—æ–‡ç« ï¼ˆäº”ï¼‰ï¼šELK å®æ—¶æ—¥å¿—åˆ†æå¹³å°ç¯å¢ƒæ­å»º","date":"2017-12-24T16:00:00.000Z","path":"2017/12/25/ELK/","text":"ç®€å•ä»‹ç»ELKï¼ˆElasticSearch, Logstash, Kibanaï¼‰ï¼Œä¸‰è€…ç»„åˆåœ¨ä¸€èµ·æ­å»ºå®æ—¶çš„æ—¥å¿—åˆ†æå¹³å°ï¼Œç›®å‰å¥½å¤šå…¬å¸éƒ½æ˜¯è¿™å¥—ï¼ Elasticsearch æ˜¯ä¸ªå¼€æºåˆ†å¸ƒå¼æœç´¢å¼•æ“ï¼Œå®ƒçš„ç‰¹ç‚¹æœ‰ï¼šåˆ†å¸ƒå¼ï¼Œé›¶é…ç½®ï¼Œè‡ªåŠ¨å‘ç°ï¼Œç´¢å¼•è‡ªåŠ¨åˆ†ç‰‡ï¼Œç´¢å¼•å‰¯æœ¬æœºåˆ¶ï¼Œrestful é£æ ¼æ¥å£ï¼Œå¤šæ•°æ®æºï¼Œè‡ªåŠ¨æœç´¢è´Ÿè½½ç­‰ã€‚ Logstash æ˜¯ä¸€ä¸ªå®Œå…¨å¼€æºçš„å·¥å…·ï¼Œä»–å¯ä»¥å¯¹ä½ çš„æ—¥å¿—è¿›è¡Œæ”¶é›†ã€è¿‡æ»¤ï¼Œå¹¶å°†å…¶å­˜å‚¨ä¾›ä»¥åä½¿ç”¨ï¼ˆå¦‚ï¼Œæœç´¢ï¼‰ã€‚ Kibana ä¹Ÿæ˜¯ä¸€ä¸ªå¼€æºå’Œå…è´¹çš„å·¥å…·ï¼Œå®ƒ Kibana å¯ä»¥ä¸º Logstash å’Œ ElasticSearch æä¾›çš„æ—¥å¿—åˆ†æå‹å¥½çš„ Web ç•Œé¢ï¼Œå¯ä»¥å¸®åŠ©æ‚¨æ±‡æ€»ã€åˆ†æå’Œæœç´¢é‡è¦æ•°æ®æ—¥å¿—ã€‚ å®‰è£… ESã€‚ã€‚ã€‚è¿™ä¸ªçœç•¥ï¼Œä¸ bb äº†ï¼Œä»¥å‰å†™è¿‡ã€‚ã€‚ã€‚ä¼ é€é—¨ï¼šhttp://www.54tianzhisheng.cn/2017/09/09/Elasticsearch-install/ å®‰è£… LogstashELK æ•´å¥—ç¯å¢ƒæ­å»ºç‰ˆæœ¬å¾ˆå…³é”®ï¼Œæœ€å¥½å…¨ç»Ÿä¸€ä¸€ä¸ªç‰ˆæœ¬ï¼Œå¦åˆ™å‡ºå•¥é—®é¢˜å°±ä¸å¤ªå¥½æ‰¾äº†ã€‚è¿™æ˜¯æˆ‘è§è¿‡ç‰ˆæœ¬ç»Ÿä¸€æœ€ä¸¥æ ¼çš„äº†ã€‚è€Œå·² ES ç‰ˆæœ¬å‡äº†åï¼Œå…¶ä»–çš„éƒ½è¦éƒ½è¦å‡çº§ï¼ŒåŒ…æ‹¬å…¶æ’ä»¶ã€‚å‡çº§ä»£ä»·æŒºå¤§çš„ï¼Œæœ€å¥½ä¸€å¼€å§‹å°±å®šä½å¥½è¦å®‰è£…å“ªä¸ªç‰ˆæœ¬ï¼ åœ¨å®˜ç½‘ä¸‹å¥½å®‰è£…åŒ…åä¼ åˆ° Linux ä¸Šï¼Œè¿™æ˜¯é€Ÿåº¦æœ€å¿«çš„ã€‚ 1234567891011121314151617181920212223242526åœ¨ /usr/local ç›®å½•ä¸‹è§£å‹ï¼štar -zxvf logstash-5.5.2.tar.gzè¿›å…¥è§£å‹åçš„ç›®å½•ï¼šcd /usr/local/logstash-5.5.2/binæ–°å¢é…ç½®æ–‡ä»¶ï¼švim logstash.confå¢åŠ ï¼šinput&#123; file&#123; path =&gt; [&quot;/var/log/*.log&quot;] &#125;&#125;output&#123; elasticsearch&#123; hosts =&gt; [&quot;192.168.153.135:9200&quot;] index =&gt; &quot;logstash__log&quot; &#125;&#125; Logstash çš„å¯åŠ¨æ–¹å¼æ˜¯ï¼š 123åœ¨ /usr/local/logstash-5.5.2/bin ç›®å½•ä¸‹è¿è¡Œï¼š./logstash -f logstash.conf å®‰è£… KibanaåŒæ ·ï¼Œå®˜ç½‘ä¸‹å¥½å®‰è£…åŒ…ï¼Œä¸Šä¼ åˆ° Linuxã€‚ 1234567891011è§£å‹ï¼štar -zxvf kibana-5.5.2-linux-x86_64.tar.gzä¿®æ”¹é…ç½®æ–‡ä»¶ kibana-5.5.2/config/kibana.yml å¦‚ä¸‹ï¼šServer.host //é…ç½®æœºå™¨ip/hostnameServer.name //æ­¤kibanaæœåŠ¡çš„åç§°elasticsearch.url //es masterèŠ‚ç‚¹url Kibana å¯åŠ¨æ–¹å¼ï¼š 123åœ¨ /usr/local/kibana-5.5.2/bin ç›®å½•ä¸‹è¿è¡Œï¼š./kibana Webç•Œé¢è®¿é—®: http://ip:5601 æ­¤æ—¶éœ€è¦è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ç™»å½•,é»˜è®¤åˆ†åˆ«æ˜¯ elastic å’Œ changeme X-PackX-Pack æ˜¯ä¸€ä¸ª Elastic Stack çš„æ‰©å±•ï¼Œå°†å®‰å…¨ï¼Œè­¦æŠ¥ï¼Œç›‘æ§ï¼ŒæŠ¥å‘Šå’Œå›¾å½¢åŠŸèƒ½åŒ…å«åœ¨ä¸€ä¸ªæ˜“äºå®‰è£…çš„è½¯ä»¶åŒ…ä¸­ã€‚ ES å’Œ Kibana éƒ½å¯å®‰è£…ã€‚ æ’ä»¶ x-pack-5.5.2.zip ä¾æ—§å®˜ç½‘ä¸‹ã€‚ ES å®‰è£… X-Pack123cd /usr/local/elasticsearch/bin./elasticsearch-plugin install file:///opt/es/x-pack-5.5.2.zip å¦‚æœæˆåŠŸï¼šæ˜¾ç¤ºå¦‚ä¸‹ 123456789101112131415161718192021222324252627282930[root@node1 bin]# ./elasticsearch-plugin install file:///opt/es/x-pack-5.5.2.zip-&gt; Downloading file:///opt/es/x-pack-5.5.2.zip[=================================================] 100%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ WARNING: plugin requires additional permissions @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@* java.io.FilePermission \\\\.\\pipe\\* read,write* java.lang.RuntimePermission accessClassInPackage.com.sun.activation.registries* java.lang.RuntimePermission getClassLoader* java.lang.RuntimePermission setContextClassLoader* java.lang.RuntimePermission setFactory* java.security.SecurityPermission createPolicy.JavaPolicy* java.security.SecurityPermission getPolicy* java.security.SecurityPermission putProviderProperty.BC* java.security.SecurityPermission setPolicy* java.util.PropertyPermission * read,write* java.util.PropertyPermission sun.nio.ch.bugLevel write* javax.net.ssl.SSLPermission setHostnameVerifierSee http://docs.oracle.com/javase/8/docs/technotes/guides/security/permissions.htmlfor descriptions of what these permissions allow and the associated risks.Continue with installation? [y/N]y@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ WARNING: plugin forks a native controller @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@This plugin launches a native controller that is not subject to the Javasecurity manager nor to system call filters.Continue with installation? [y/N]y-&gt; Installed x-pack Kibana å®‰è£… X-Pack123cd /usr/local/kibana-5.5.2/bin./kibana-plugin install file:///opt/es/x-pack-5.5.2.zip å®‰è£…æˆåŠŸå¦‚ä¸‹ï¼š 123456789[root@node1 bin]# ./kibana-plugin install file:///opt/es/x-pack-5.5.2.zipAttempting to transfer from file:///opt/es/x-pack-5.5.2.zipTransferring 159867054 bytes....................Transfer completeRetrieving metadata from plugin archiveExtracting plugin archiveExtraction completeOptimizing and caching browser bundles...Plugin installation complete å¯ç”¨ x-pack å®‰å…¨æœºåˆ¶åˆ†åˆ«åœ¨ kibana.yml å’Œ elasticsearch.yml ä¸­åŠ å…¥ä¸‹è¡Œ 1xpack.security.enabled: true è¿™æ ·åï¼Œä½ å†æ‰“å¼€ ES çš„ head ç•Œé¢å’Œ Kibana ç®¡ç†ç•Œé¢å°±éœ€è¦è¾“å…¥è´¦å·å¯†ç äº†ã€‚ ä¸Šå›¾å³è¾¹æ˜¯å®‰è£… X-Pack åçš„ï¼ŒåŠŸèƒ½å¤šäº†å‡ ä¸ªã€‚ æœ€åç¯å¢ƒæ­å»ºå¾ˆç®€å•ï¼Œåé¢å¦‚æœæœ‰æ—¶é—´çš„è¯å¯ä»¥å†è®²è®²åœ¨ Kibana çš„ Dev Tools ä¸Šæ„å»º ES çš„ JSON ä¸²æ¥å¯¹ ES è¿›è¡Œæ“ä½œã€‚ æˆ‘è¿˜å†™è¿‡ ES ç›¸å…³çš„æ–‡ç« ï¼š 1ã€Elasticsearch é»˜è®¤åˆ†è¯å™¨å’Œä¸­åˆ†åˆ†è¯å™¨ä¹‹é—´çš„æ¯”è¾ƒåŠä½¿ç”¨æ–¹æ³• 2ã€å…¨æ–‡æœç´¢å¼•æ“ Elasticsearch é›†ç¾¤æ­å»ºå…¥é—¨æ•™ç¨‹ 3ã€ElasticSearch é›†ç¾¤ç›‘æ§ 4ã€ElasticSearch å•ä¸ªèŠ‚ç‚¹ç›‘æ§ ç»“å°¾ æœ¬æ–‡é¦–å‘äºï¼šzhisheng çš„åšå®¢ è½¬è½½è¯·æ³¨æ˜åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2017/12/25/ELK/","tags":[{"name":"ElasticSearch","slug":"ElasticSearch","permalink":"http://www.54tianzhisheng.cn/tags/ElasticSearch/"},{"name":"LogStash","slug":"LogStash","permalink":"http://www.54tianzhisheng.cn/tags/LogStash/"},{"name":"Kibana","slug":"Kibana","permalink":"http://www.54tianzhisheng.cn/tags/Kibana/"}]},{"title":"Hexo + yilia æ­å»ºåšå®¢å¯èƒ½ä¼šé‡åˆ°çš„æ‰€æœ‰ç–‘é—®","date":"2017-12-17T16:00:00.000Z","path":"2017/12/18/hexo-yilia/","text":"å‰æä¸ºä»€ä¹ˆä¼šå†æ¬¡å†™è¿™ç¯‡åšå®¢ï¼Ÿè¯·çœ‹ä¸‹å›¾ï¼š è¿™æ˜¯æˆ‘åšå®¢æœç´¢å¼•æ“çš„ä¸»è¦å…³é”®å­—ã€‚ä¸ºä»€ä¹ˆä¼šæœ‰è¿™äº›å…³é”®å­—å‘¢ï¼Ÿ æˆ‘çŒœä¼°è®¡æ˜¯æ›¾ç»å†™äº†å‡ ç¯‡å…³äºæ­å»ºåšå®¢çš„æ–‡ç« ï¼Œè¢«æœç´¢å¼•æ“æ”¶å…¥äº†ï¼Œæ‰€ä»¥æœç´¢å¼•æ“æ‰ä¼šå°†è¿™äº›æµé‡å¼•å¯¼è‡³æˆ‘çš„åšå®¢ï¼Œæ–‡ç« å¦‚ä¸‹ï¼š 1ã€åˆ©ç”¨Github Page æ­å»ºä¸ªäººåšå®¢ç½‘ç«™ 2ã€Hexo + yilia ä¸»é¢˜å®ç°æ–‡ç« ç›®å½• 3ã€Github pages + Hexo åšå®¢ yilia ä¸»é¢˜ä½¿ç”¨ç•…è¨€è¯„è®ºç³»ç»Ÿ é‚£è¿˜æœ‰è¿™ä¹ˆå¤šäººæœç´¢è¿™äº›å…³é”®å­—ï¼Ÿè¯´æ˜ç¢°åˆ°é—®é¢˜çš„è¿˜æœ‰ä¸å°‘ï¼Œæ‰€ä»¥æ‰æœ‰äº†è¿™ç¯‡æ–‡ç« çš„è¯ç”Ÿï¼ é—®é¢˜è§£ç­”1ã€hexo yilia æ–‡ç« ç›®å½• è¿™ä¸ªæˆ‘ä»¥å‰å†™è¿‡ä¸€ç¯‡æ–‡ç« ï¼šHexo + yilia ä¸»é¢˜å®ç°æ–‡ç« ç›®å½• é‚£ç¯‡æ–‡ç« å†™äº†æˆ‘é‚£ä¸ªç‰ˆæœ¬çš„ yilia æ€ä¹ˆæ·»åŠ æ–‡ç« ç›®å½•çš„ï¼Œä½†æ˜¯å¥½åƒæ–°ç‰ˆæœ¬çš„ yilia å·²ç»è‡ªå¸¦äº†è¿™ä¸ªæ–‡ç« ç›®å½•åŠŸèƒ½ã€‚æ‰€ä»¥å¦‚æœä½ æ˜¯ä½¿ç”¨çš„æ–°ç‰ˆæœ¬çš„ yilia ï¼Œè¯·ä¸è¦åšä»»ä½•ä¿®æ”¹ï¼ä½†æ˜¯å‰å‡ å¤©æœ‰äººç»™æˆ‘å‘äº†ä¸ªå›¾ç‰‡ï¼Œåˆå¥½åƒæœ‰ç‚¹åŒºåˆ«ï¼Œå¦‚æœå®åœ¨æœ‰ä¸åŒçš„è¯ï¼Œè¯·åŠ ç¾¤ 528776268 æ‰¾æˆ‘è¦æˆ‘é‚£ä¸ªä¸»é¢˜ç‰ˆæœ¬çš„æ‰€æœ‰é…ç½®æ–‡ä»¶ã€‚å†æ¬¡è¯´æ˜ï¼Œæˆ‘å‰ç«¯ä¹Ÿä¸æ˜¯å¾ˆæ“…é•¿ï¼Œæˆ‘å†™é‚£ç¯‡æ–‡ç« ä¹Ÿæ˜¯å‚è€ƒå…¶ä»–åšå®¢çš„ä¿®æ”¹ï¼Œæ‰€ä»¥æ— èƒ½ä¸ºåŠ›äº†ã€‚æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œå»ºè®®ç›´æ¥åœ¨ yilia ä¸»é¢˜çš„ GitHub å»æ‰¾ä½œè€…èŠï¼ 2ã€Hexo yilia éšç¬” éšç¬”å¦‚ä¸‹ï¼š å¯¹æ­¤æƒ³è¯´çš„å°±æ˜¯ï¼Œâ€œéšç¬”â€ å…¶å®å°±æ˜¯æ–‡ç« çš„ä¸€ä¸ª tags(æ ‡ç­¾)ï¼Œå¦‚æœä½ æƒ³æŠŠæ–‡ç« ä½œä¸ºéšç¬”çš„è¯ï¼Œè¯·åœ¨æ–‡ç« çš„é¦–éƒ¨å†™ä¸ª tags ä¸º â€œéšç¬”â€ çš„æ ‡ç­¾ã€‚å¦‚ä¸‹å›¾ï¼š æ³¨æ„ï¼š- åé¢æœ‰ä¸ªç©ºæ ¼ã€‚ 3ã€yilia ä¸»é¢˜åˆ†ç±»å®ç° å¦‚æœè¦æœ‰å¤šä¸ªæ ‡ç­¾ï¼Œå¯ä»¥å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 4ã€hexo yilia è®¾ç½®æ–‡ç« æ˜¾ç¤ºé•¿åº¦ï¼Œä¸å±•å¼€å…¨æ–‡ yilia ä¸»é¢˜ä¸­å¯ä»¥ç”¨ &lt;!-- more --&gt; æˆªå–æ–‡ç« çš„æ˜¾ç¤ºé•¿åº¦ï¼Œå¦‚æœä½ æƒ³åœ¨å“ªæˆªå–æ–‡ç« ï¼Œå°±åœ¨é‚£è¡Œä½¿ç”¨è¯¥å­—ç¬¦ã€‚ 5ã€yilia æ·»åŠ é˜…è¯»é‡ æˆ‘æ·»åŠ çš„æ˜¯ â€œä¸è’œå­â€ è®¡æ•°ï¼Œå®ƒå¯ä»¥åŒºåˆ† pv/uv çš„ç»Ÿè®¡æ–¹å¼ï¼Œç»Ÿè®¡æ›´ç²¾å‡†ï¼Œæ»¡è¶³æ›´å¤šéœ€æ±‚ã€‚æœ‰è¿™ä¸ªéœ€æ±‚çš„å¯ä»¥å»æŸ¥æ‰¾ä¸‹åšå®¢æ€ä¹ˆæ·»åŠ ã€‚ï¼ˆç½‘ä¸Šæœ‰å¾ˆå¤šè¿™æ–¹é¢çš„åšå®¢ï¼‰ 6ã€yilia ä¸»é¢˜ä½¿ç”¨ â€œç•…è¨€â€ è¯„è®ºç³»ç»Ÿ å‚è§æˆ‘ä»¥å‰çš„æ–‡ç« ï¼š Github pages + Hexo åšå®¢ yilia ä¸»é¢˜ä½¿ç”¨ç•…è¨€è¯„è®ºç³»ç»Ÿ 7ã€hexo yilia å¼•å…¥éŸ³ä¹ 1&lt;iframe frameborder=\"no\" border=\"0\" marginwidth=\"0\" marginheight=\"0\" width=330 height=86 src=\"å¡«å†™éŸ³ä¹é“¾æ¥åœ°å€\"&gt;&lt;/iframe&gt; å¦‚ä¸‹å›¾ï¼Œå¯ä»¥åœ¨ç½‘æ˜“äº‘éŸ³ä¹é‡Œæœåˆ°ä½ æƒ³è¦å¼•å…¥çš„éŸ³ä¹ï¼Œç„¶åç‚¹å‡»å¦‚ä¸‹çš„ â€œç”Ÿæˆå¤–é“¾æ’­æ”¾å™¨â€ å³å¯ï¼š 8ã€hexo yilia å¼•å…¥è§†é¢‘ hexo æ”¯æŒ html è¯­æ³•çš„ï¼Œæ‰€ä»¥å¯ä»¥å¦‚ä¸Šå›¾è¿™æ ·å¼•å…¥è§†é¢‘ï¼ 9ã€hexo yilia ç›¸å†Œ è¿™ä¸ªæŠ±æ­‰ï¼Œæˆ‘è‡ªå·±ä¹Ÿæ²¡åšè¿™æ–¹é¢çš„åŠŸèƒ½ï¼Œæš‚æ—¶ä¸å¤ªæ¸…æ¥šæ€ä¹ˆå®ç°ã€‚ä¸è¿‡æœ‰æ–‡ç« å†™æ€ä¹ˆå®ç°ï¼Œå¤§å®¶å¯ä»¥æœç´¢ä¸‹ï¼ 10ã€hexo yilia æ€ä¹ˆå†™æ–‡ç«  æˆ‘ä¸€èˆ¬å†™æ–‡ç« å°±æ˜¯å…ˆç”¨æœ¬åœ° markdown ç¼–è¾‘å™¨å†™å¥½åï¼Œç„¶åæ”¾åœ¨ hexo çš„ source/_posts ç›®å½•ä¸‹ã€‚ ç»“å°¾å¥½äº†ï¼Œå¤§æ¦‚å°±è¿™äº›é—®é¢˜ï¼Œæˆ‘ä¹Ÿä¸€ä¸€è§£ç­”äº†ï¼Œå¸Œæœ›æ­å»ºåšå®¢çš„ä½ å¯ä»¥çœ‹åˆ°è¿™ç¯‡æ–‡ç« ï¼Œè®©ä½ å°‘èµ°ç‚¹å¼¯è·¯ï¼Œå¦‚æœä½ ä¹Ÿé‡åˆ°è¿‡è¿™äº›é—®é¢˜ï¼Œè¿˜è¯·ä½ èƒ½åˆ†äº«ä¸‹æ–‡ç« ï¼Œè®©æ›´å¤šäººé¿å…å…¥å‘ï¼ æœ¬æ–‡åœ°å€æ˜¯ï¼šHexo + yilia æ­å»ºåšå®¢å¯èƒ½ä¼šé‡åˆ°çš„æ‰€æœ‰ç–‘é—® æœ¬æ–‡åŸåˆ›ï¼Œè½¬è½½è¯·æ³¨æ˜åŸåˆ›åœ°å€ã€‚ æœ€åhttp://www.54tianzhisheng.cn/2017/12/18/hexo-yilia è¿™ä¸ªé“¾æ¥æ˜¯è®©æ¨é…·çˆ¬è™«åæ‰çš„ï¼Œå“ˆå“ˆï¼","tags":[{"name":"hexo","slug":"hexo","permalink":"http://www.54tianzhisheng.cn/tags/hexo/"},{"name":"yilia","slug":"yilia","permalink":"http://www.54tianzhisheng.cn/tags/yilia/"}]},{"title":"è°·æ­Œå¼€å‘è€…å¤§ä¼šæ”¶è·æ»¡æ»¡ï¼Œä¸å»çœŸ â€œå¯æƒœâ€ äº†","date":"2017-12-12T16:00:00.000Z","path":"2017/12/13/Google-Developer-Days/","text":"å…¨æ–‡å›¾ç‰‡è¾ƒå¤šï¼Œè¯·åœ¨ WiFi ä¸‹é˜…è¯»ï¼ŒåœŸè±ªè¯·éšæ„ï¼ å‰æä»Šå¹´ Google å¼€å‘è€…å¤§ä¼šå†åº¦æ¥è¢­ï¼Œå¤§ä¼šå°†äº 12 æœˆ 13 æ—¥å’Œ 14 æ—¥åœ¨ä¸Šæµ·ä¸¾åŠï¼Œä¸»é¢˜æ¶µç›–æœºå™¨å­¦ä¹ (Machine Learning)ã€Androidã€ç§»åŠ¨ç½‘ç»œ(Mobile Web)ã€TensorFlowã€Firebaseã€äº‘æœåŠ¡(Cloud)ã€AR/VRã€è®¾è®¡(Design)ä»¥åŠæ›´å¤šå¼€å‘è€…ç›¸å…³å†…å®¹ã€‚ ä»Šå¤©æˆ‘å°±åˆ°èµ°ä¸€é­ï¼Œæ”¶è·æ»¡æ»¡ï¼Œéƒ½æ˜¯ç”¨è¢‹å­æå›æ¥çš„ï¼Œå“ˆå“ˆã€‚ä¸‹å›¾ä¸ºè¢‹å­ï¼š å†ç§€å¼ å›¾ä»£è¡¨æˆ‘å»äº†ï¼š å…¥åœº è¯´ä¸‹ä»Šå¤©æˆ‘å‚åŠ çš„ä¼šåœºå§ï¼ ä¼šåœºä¸»ä¼šåœºå¼€å¹• å½“ç„¶æ˜¯ç”¨æ¥ç”¨æ¥åšå¼€å‘è€…å¼€å¹•å¤§ä¼šä¸»é¢˜æ¼”è®²çš„ã€‚ç›¸ä¿¡ä¸å°‘æ²¡åˆ°ç°åœºçš„ä¹Ÿçœ‹äº†ç›´æ’­ã€‚ æ‹äº†ä¸¤å¼ æé£é£æ¼”è®²æ—¶çš„ç…§ç‰‡ï¼š è¿˜æœ‰ä¸ªå¦¹å­æ˜¯è®² TensorFlow çš„ï¼Œå…¨ç¨‹ä¸­æ–‡ï¼Œè¿˜è´¼ 6ï¼Œä½©æœï¼ï¼ï¼ ä¸­é€”æ¼”è®²è¿˜å¥½å‡ ä¸ªï¼Œæ²¡æ‹ç…§äº†ã€‚ã€‚ã€‚ ä¸­é€”èŒ¶æ­‡ï¼šå»å¤–é¢çœ‹äº†ä¸‹ã€‚ ä¸»ä¼šåœºæ¼”è®²ä¸»é¢˜æ˜¯ï¼šã€Šæ¸è¿›å¼ç½‘é¡µåº”ç”¨ï¼šå¿«é€Ÿã€é›†æˆã€å¯é å¹¶ä¸”å…·æœ‰å¸å¼•åŠ›ã€‹ è¿™æ¬¡åçš„æ˜¯å‰æ’ï¼Œè¿˜æ‹äº†ç…§ï¼Œæ¼”è®²äººæŠ€å·§å¾ˆå¥½ï¼Œè¾¹æ¼”è®²è¾¹å¸¦æœ‰èº«ä½“åŠ¨ä½œçš„ï¼Œè€Œä¸”è¿˜æ¯”è¾ƒè¯™è°ã€‚ åˆé¤èƒ¸ç‰Œä¸Šæœ‰13ã€14 å·çš„åˆé¤åˆ¸ï¼Œå¯ä»¥å…è´¹åƒã€å…è´¹æ‹¿ï¼Œç¦åˆ©è¶…å¥½ã€‚ ä¸‹åˆä¼šåœºä¸‹åˆä¼šåœºæœ‰ç‚¹å¤šï¼Œç•¥ç•¥ç•¥ã€‚ã€‚ã€‚ éƒ½æ‹äº†ç‚¹ç…§ï¼Œå¦‚æœæƒ³è¦ï¼Œå¯ä»¥åŠ ç¾¤ï¼š528776268 æ‰¾æˆ‘è¦ã€ æ™šé¤è¯±æƒ‘é¢‡å¤§ã€‚ã€‚ æˆ‘è¿˜å–äº†æ¯è‘¡è„é…’ã€‚ã€‚å“ˆå“ˆ å¦å¤–é™¤äº†ç…§ç‰‡ï¼Œè¿˜æ‹äº†ä¸‰ä¸ªè§†é¢‘ å›å®¶åƒé¥±å–è¶³ï¼Œå›å®¶æ‹äº†å¼ ç…§ ç¤¼ç‰©åˆ°å®¶äº†ï¼Œæ•´ç†äº†ä¸‹ä»Šå¤©çš„ç¤¼ç‰©ï¼š è´´çº¸ä¸€å¼  å°ç¤¼å“ä¸€ä¸ª ä¸€ä¸ªå¯ DIY çš„éŸ³ç®± ä¸€ä¸ªå®šåˆ¶çš„æ‰‹æç”µè„‘åŒ…ï¼Œè´¨é‡å¾ˆå¥½ã€‚ AndroidThings æœ€åå…¨æ–‡å›¾ç‰‡è¾ƒå¤šï¼Œè°¢è°¢é˜…è¯»ï¼è‡ªå·±æ”¶è·ä¹ŸæŒºå¤šçš„ï¼Œæ˜å¤©è¿˜æœ‰ä¸€å¤©ï¼Œå¯æƒœä¸æ‰“ç®—å»äº†ï¼Œè½¬è½½è¯·æ³¨æ˜åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2017/12/13/Google-Developer-Days/ ç»“å°¾è¿™ä¸ªæ˜¯ä¸ºäº†é˜²çˆ¬è™«å†™çš„ï¼Œå“ˆå“ˆ","tags":[{"name":"éšç¬”","slug":"éšç¬”","permalink":"http://www.54tianzhisheng.cn/tags/éšç¬”/"}]},{"title":"ä½¿ç”¨ CodeMirror æ‰“é€ å±äºè‡ªå·±çš„åœ¨çº¿ä»£ç ç¼–è¾‘å™¨","date":"2017-12-08T16:00:00.000Z","path":"2017/12/09/CodeMirror/","text":"å‰æå†™è¿™ä¸ªçš„ç›®çš„æ˜¯å› ä¸ºä¹‹å‰é¡¹ç›®é‡Œç”¨åˆ°è¿‡ CodeMirrorï¼Œè§‰å¾—ä½œä¸ºä¸€æ¬¾åœ¨çº¿ä»£ç ç¼–è¾‘å™¨è¿˜æ˜¯ä¸é”™ï¼Œä¹Ÿçœ‹åˆ°è¿‡æœ‰äº›ç½‘ç«™ç”¨åˆ°è¿‡åœ¨çº¿ä»£ç ç¼–è¾‘ï¼Œå½“ç„¶æˆ‘ä¸çŸ¥é“ä»–ä»¬æ˜¯ç”¨ä»€ä¹ˆåšçš„ï¼Œè¿™é‡Œæˆ‘æŠŠå…¬å¸é¡¹ç›®é‡Œç”¨åˆ°çš„é‚£éƒ¨åˆ†æŠ½å‡ºæ¥ï¼Œå•ç‹¬å†™ç¯‡åšå®¢ï¼Œå¹¶æŠŠæŠ½å‡ºæ¥çš„é‚£éƒ¨åˆ†ä»£ç æäº¤åˆ° GitHub å»ï¼ˆåœ°å€ï¼‰ï¼Œä»¥é˜²æ—¥åå¯èƒ½ä¼šå†æ¬¡ç”¨åˆ°ï¼ˆæ²¡å‡†æ¯•ä¸šè®¾è®¡é‡Œå¯èƒ½ç”¨çš„åˆ°ï¼‰ã€‚ ç®€å•ä»‹ç»CodeMirror æ˜¯ä¸€æ¬¾åœ¨çº¿çš„æ”¯æŒè¯­æ³•é«˜äº®çš„ä»£ç ç¼–è¾‘å™¨ã€‚å®˜ç½‘ï¼š http://codemirror.net/ å¯èƒ½å…‰çœ‹å®˜ç½‘ï¼Œç¬¬ä¸€çœ¼è§‰å¾—é‚£äº›åœ¨çº¿ç¼–è¾‘å™¨æœ‰ç‚¹ä¸‘ï¼Œåæ­£ç¬¬ä¸€çœ¼ç»™æˆ‘çš„æ„Ÿè§‰å°±æ˜¯è¿™æ ·å­ï¼Œä½†æ˜¯ç»è¿‡è‡ªå·±çš„ç»†è°ƒï¼Œä¹Ÿèƒ½æ‰“é€ å‡ºä¸€æ¬¾ç²¾ç¾çš„åœ¨çº¿ä»£ç ç¼–è¾‘å™¨ã€‚ å®˜ç½‘å¯ä»¥æŠŠå®ƒä¸‹è½½ä¸‹æ¥ã€‚ ä¸‹è½½åï¼Œè§£å‹å¼€å¾—åˆ°çš„æ–‡ä»¶å¤¹ä¸­ï¼Œlib ä¸‹æ˜¯æ”¾çš„æ˜¯æ ¸å¿ƒåº“å’Œæ ¸å¿ƒ cssï¼Œmode ä¸‹æ”¾çš„æ˜¯å„ç§æ”¯æŒè¯­è¨€çš„è¯­æ³•å®šä¹‰ï¼Œtheme ç›®å½•ä¸‹æ˜¯æ”¯æŒçš„ä¸»é¢˜æ ·å¼ã€‚ä¸€èˆ¬åœ¨å¼€å‘ä¸­ï¼Œæ·»åŠ  lib ä¸‹çš„å¼•ç”¨å’Œ mode ä¸‹çš„å¼•ç”¨å°±å¤Ÿäº†ã€‚ å¦‚ä½•ä½¿ç”¨ä¸‹é¢ä¸¤ä¸ªæ˜¯ä½¿ç”¨ Code Mirror å¿…é¡»å¼•å…¥çš„ï¼š 12&lt;link rel=\"stylesheet\" href=\"codemirror-5.31.0/lib/codemirror.css\"/&gt;&lt;script src=\"codemirror-5.31.0/lib/codemirror.js\"&gt;&lt;/script&gt; æ¥ä¸‹æ¥è¦å¼•ç”¨çš„å°±æ˜¯åœ¨ mode ç›®å½•ä¸‹ç¼–è¾‘å™¨ä¸­è¦ç¼–è¾‘çš„è¯­è¨€å¯¹åº”çš„ js æ–‡ä»¶ï¼Œè¿™é‡Œä»¥ Groovy ä¸ºä¾‹ï¼š 12&lt;!--groovyä»£ç é«˜äº®--&gt;&lt;script src=\"codemirror-5.31.0/mode/groovy/groovy.js\"&gt;&lt;/script&gt; å¦‚æœä½ æƒ³è®© Java ä»£ç ä¹Ÿæ”¯æŒä»£ç é«˜äº®ï¼Œåˆ™éœ€è¦å¼•å…¥æˆ‘ä»ç½‘ä¸Šä¸‹è½½ä¸‹æ¥çš„ clike.jsï¼ˆæˆ‘å·²ç»æ”¾åˆ°æˆ‘çš„ GitHub å»äº†ï¼‰ 12&lt;!--Javaä»£ç é«˜äº®å¿…é¡»å¼•å…¥--&gt;&lt;script src=\"codemirror-5.31.0/clike.js\"&gt;&lt;/script&gt; å¼•ç”¨çš„æ–‡ä»¶ç”¨äºæ”¯æŒå¯¹åº”è¯­è¨€çš„è¯­æ³•é«˜äº®ã€‚ ç„¶åå‰é¢è¯´äº†ç¬¬ä¸€æ¬¡è¿›å…¥ Code Mirror å®˜ç½‘ï¼Œè§‰å¾—é‚£äº›ç¼–è¾‘å™¨æ¯”è¾ƒä¸‘ï¼Œé‚£å¯èƒ½æ˜¯ä¸»é¢˜æ¯”è¾ƒä¸‘ï¼Œæˆ‘è¿™é‡Œæ¨èä¸€æ¬¾è¿˜ä¸é”™çš„ä¸»é¢˜ï¼Œåªéœ€æŒ‰ç…§å¦‚ä¸‹å¼•å…¥å³å¯ï¼š 12&lt;!--å¼•å…¥cssæ–‡ä»¶ï¼Œç”¨ä»¥æ”¯æŒä¸»é¢˜--&gt;&lt;link rel=\"stylesheet\" href=\"codemirror-5.31.0/theme/dracula.css\"/&gt; å¦‚æœä½ è¿˜æƒ³è®©ä½ çš„ç¼–è¾‘å™¨æ”¯æŒä»£ç è¡ŒæŠ˜å ï¼Œè¯·æŒ‰ç…§å¦‚ä¸‹è¿›è¡Œæ“ä½œï¼š 123456&lt;!--æ”¯æŒä»£ç æŠ˜å --&gt;&lt;link rel=\"stylesheet\" href=\"codemirror-5.31.0/addon/fold/foldgutter.css\"/&gt;&lt;script src=\"codemirror-5.31.0/addon/fold/foldcode.js\"&gt;&lt;/script&gt;&lt;script src=\"codemirror-5.31.0/addon/fold/foldgutter.js\"&gt;&lt;/script&gt;&lt;script src=\"codemirror-5.31.0/addon/fold/brace-fold.js\"&gt;&lt;/script&gt;&lt;script src=\"codemirror-5.31.0/addon/fold/comment-fold.js\"&gt;&lt;/script&gt; æ˜¯ä¸æ˜¯è¿™æ ·å¼•å…¥å°±å¥½äº†å‘¢ï¼Œå½“ç„¶ä¸æ˜¯å•¦ åˆ›å»ºç¼–è¾‘å™¨åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œä¸€èˆ¬éƒ½ä¸ä¼šç›´æ¥æŠŠ body æ•´ä¸ªå†…å®¹ä½œä¸ºç¼–è¾‘å™¨çš„å®¹å™¨ã€‚è€Œæœ€å¸¸ç”¨çš„ï¼Œæ˜¯ä½¿ç”¨ textareaã€‚è¿™é‡Œæˆ‘åœ¨ é‡Œä½¿ç”¨ä¸ª textareaï¼Œ 123&lt;!-- begin code --&gt;&lt;textarea class=\"form-control\" id=\"code\" name=\"code\"&gt;&lt;/textarea&gt;&lt;!-- end code--&gt; æ¥ä¸‹æ¥å°±æ˜¯åˆ›å»ºç¼–è¾‘å™¨äº†ã€‚ 123//æ ¹æ®DOMå…ƒç´ çš„idæ„é€ å‡ºä¸€ä¸ªç¼–è¾‘å™¨var editor = CodeMirror.fromTextArea(document.getElementById(\"code\"), &#123;&#125;); æ˜¯ä¸æ˜¯æœ‰ç‚¹å•è°ƒï¼Ÿ æ²¡é”™ï¼Œæˆ‘è¿˜å¯ä»¥åœ¨é‡Œé¢ç»™ä»–è®¾ç½®äº›å±æ€§ï¼šï¼ˆå……åˆ†åˆ©ç”¨æˆ‘ä¸€å¼€å§‹å¼•å…¥çš„é‚£äº›æ–‡ä»¶ï¼‰ 123456789mode: \"text/groovy\", //å®ç°groovyä»£ç é«˜äº®mode: \"text/x-java\", //å®ç°Javaä»£ç é«˜äº®lineNumbers: true, //æ˜¾ç¤ºè¡Œå·theme: \"dracula\", //è®¾ç½®ä¸»é¢˜lineWrapping: true, //ä»£ç æŠ˜å foldGutter: true,gutters: [\"CodeMirror-linenumbers\", \"CodeMirror-foldgutter\"],matchBrackets: true, //æ‹¬å·åŒ¹é…//readOnly: true, //åªè¯» å¦‚æœéœ€è¦æŸ¥çœ‹æ›´å¤šå±æ€§ï¼Œå¯ä»¥å»å®˜ç½‘æŸ¥æ‰¾ï¼Œç›®å‰æˆ‘åªç”¨åˆ°è¿™äº›å±æ€§ï¼ ä¸‹é¢ä¹Ÿåˆ—ä¸¾äº›å§ï¼š indentUnit: integerç¼©è¿›å•ä½ï¼Œå€¼ä¸ºç©ºæ ¼æ•°ï¼Œé»˜è®¤ä¸º2 ã€‚ smartIndent: booleanè‡ªåŠ¨ç¼©è¿›ï¼Œè®¾ç½®æ˜¯å¦æ ¹æ®ä¸Šä¸‹æ–‡è‡ªåŠ¨ç¼©è¿›ï¼ˆå’Œä¸Šä¸€è¡Œç›¸åŒçš„ç¼©è¿›é‡ï¼‰ã€‚é»˜è®¤ä¸ºtrueã€‚ tabSize: integertabå­—ç¬¦çš„å®½åº¦ï¼Œé»˜è®¤ä¸º4 ã€‚ indentWithTabs: booleanåœ¨ç¼©è¿›æ—¶ï¼Œæ˜¯å¦éœ€è¦æŠŠ n*tabå®½åº¦ä¸ªç©ºæ ¼æ›¿æ¢æˆnä¸ªtabå­—ç¬¦ï¼Œé»˜è®¤ä¸ºfalse ã€‚ electricChars: booleanåœ¨è¾“å…¥å¯èƒ½æ”¹å˜å½“å‰çš„ç¼©è¿›æ—¶ï¼Œæ˜¯å¦é‡æ–°ç¼©è¿›ï¼Œé»˜è®¤ä¸ºtrue ï¼ˆä»…åœ¨modeæ”¯æŒç¼©è¿›æ—¶æœ‰æ•ˆï¼‰ã€‚ specialChars: RegExpéœ€è¦è¢«å ä½ç¬¦(placeholder)æ›¿æ¢çš„ç‰¹æ®Šå­—ç¬¦çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚æœ€å¸¸ç”¨çš„æ˜¯éæ‰“å°å­—ç¬¦ã€‚é»˜è®¤ä¸ºï¼š/[\\u0000-\\u0019\\u00ad\\u200b-\\u200f\\u2028\\u2029\\ufeff]/ã€‚ specialCharPlaceholder: function(char) â†’ Elementè¿™æ˜¯ä¸€ä¸ªæ¥æ”¶ç”±specialCharsé€‰é¡¹æŒ‡å®šçš„å­—ç¬¦ä½œä¸ºå‚æ•°çš„å‡½æ•°ï¼Œæ­¤å‡½æ•°ä¼šäº§ç”Ÿä¸€ä¸ªç”¨æ¥æ˜¾ç¤ºæŒ‡å®šå­—ç¬¦çš„DOMèŠ‚ç‚¹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ˜¾ç¤ºä¸€ä¸ªçº¢ç‚¹ï¼ˆâ€¢ï¼‰ï¼Œè¿™ä¸ªçº¢ç‚¹æœ‰ä¸€ä¸ªå¸¦æœ‰å‰é¢ç‰¹æ®Šå­—ç¬¦ç¼–ç çš„æç¤ºæ¡†ã€‚ rtlMoveVisually: booleanDetermines whether horizontal cursor movement through right-to-left (Arabic, Hebrew) text is visual (pressing the left arrow moves the cursor left) or logical (pressing the left arrow moves to the next lower index in the string, which is visually right in right-to-left text). The default is false on Windows, and true on other platforms.ï¼ˆè¿™æ®µå®Œå…¨ä¸æ™“å¾—æå•¥å­é¬¼ï¼‰ keyMap: stringé…ç½®å¿«æ·é”®ã€‚é»˜è®¤å€¼ä¸ºdefaultï¼Œå³ codemorrir.js å†…éƒ¨å®šä¹‰ã€‚å…¶å®ƒåœ¨key mapç›®å½•ä¸‹ã€‚ extraKeys: objectç»™ç¼–è¾‘å™¨ç»‘å®šä¸å‰é¢keyMapé…ç½®ä¸åŒçš„å¿«æ·é”®ã€‚ lineWrapping: booleanåœ¨é•¿è¡Œæ—¶æ–‡å­—æ˜¯æ¢è¡Œ(wrap)è¿˜æ˜¯æ»šåŠ¨(scroll)ï¼Œé»˜è®¤ä¸ºæ»šåŠ¨(scroll)ã€‚ lineNumbers: booleanæ˜¯å¦åœ¨ç¼–è¾‘å™¨å·¦ä¾§æ˜¾ç¤ºè¡Œå·ã€‚ firstLineNumber: integerè¡Œå·ä»å“ªä¸ªæ•°å¼€å§‹è®¡æ•°ï¼Œé»˜è®¤ä¸º1 ã€‚ lineNumberFormatter: function(line: integer) â†’ stringä½¿ç”¨ä¸€ä¸ªå‡½æ•°è®¾ç½®è¡Œå·ã€‚ gutters: arrayç”¨æ¥æ·»åŠ é¢å¤–çš„gutterï¼ˆåœ¨è¡Œå·gutterå‰æˆ–ä»£æ›¿è¡Œå·gutterï¼‰ã€‚å€¼åº”è¯¥æ˜¯CSSåç§°æ•°ç»„ï¼Œæ¯ä¸€é¡¹å®šä¹‰äº†ç”¨äºç»˜åˆ¶gutterèƒŒæ™¯çš„å®½åº¦ï¼ˆè¿˜æœ‰å¯é€‰çš„èƒŒæ™¯ï¼‰ã€‚ä¸ºäº†èƒ½æ˜ç¡®è®¾ç½®è¡Œå·gutterçš„ä½ç½®ï¼ˆé»˜è®¤åœ¨æ‰€æœ‰å…¶å®ƒgutterçš„å³è¾¹ï¼‰ï¼Œä¹Ÿå¯ä»¥åŒ…å«CodeMirror-linenumbersç±»ã€‚ç±»åæ˜¯ç”¨äºä¼ ç»™setGutterMarkerçš„é”®å(keys)ã€‚ fixedGutter: booleanè®¾ç½®gutterè·Ÿéšç¼–è¾‘å™¨å†…å®¹æ°´å¹³æ»šåŠ¨ï¼ˆfalseï¼‰è¿˜æ˜¯å›ºå®šåœ¨å·¦ä¾§ï¼ˆtrueæˆ–é»˜è®¤ï¼‰ã€‚ scrollbarStyle: stringè®¾ç½®æ»šåŠ¨æ¡ã€‚é»˜è®¤ä¸ºâ€nativeâ€ï¼Œæ˜¾ç¤ºåŸç”Ÿçš„æ»šåŠ¨æ¡ã€‚æ ¸å¿ƒåº“è¿˜æä¾›äº†â€nullâ€æ ·å¼ï¼Œæ­¤æ ·å¼ä¼šå®Œå…¨éšè—æ»šåŠ¨æ¡ã€‚Addonså¯ä»¥è®¾ç½®æ›´å¤šçš„æ»šåŠ¨æ¡æ¨¡å¼ã€‚ coverGutterNextToScrollbar: booleanå½“fixedGutterå¯ç”¨ï¼Œå¹¶ä¸”å­˜åœ¨æ°´å¹³æ»šåŠ¨æ¡æ—¶ï¼Œåœ¨æ»šåŠ¨æ¡æœ€å·¦ä¾§é»˜è®¤ä¼šæ˜¾ç¤ºgutterï¼Œå½“æ­¤é¡¹è®¾ç½®ä¸ºtrueæ—¶ï¼Œgutterä¼šè¢«å¸¦æœ‰CodeMirror-gutter-fillerç±»çš„å…ƒç´ é®æŒ¡ã€‚inputStyle: stringé€‰æ‹©CodeMirrorå¤„ç†è¾“å…¥å’Œç„¦ç‚¹çš„æ–¹å¼ã€‚æ ¸å¿ƒåº“å®šä¹‰äº†textareaå’Œcontenteditableè¾“å…¥æ¨¡å¼ã€‚åœ¨ç§»åŠ¨æµè§ˆå™¨ä¸Šï¼Œé»˜è®¤æ˜¯contenteditableï¼Œåœ¨æ¡Œé¢æµè§ˆå™¨ä¸Šï¼Œé»˜è®¤æ˜¯textareaã€‚åœ¨contenteditableæ¨¡å¼ä¸‹å¯¹IMEå’Œå±å¹•é˜…è¯»å™¨æ”¯æŒæ›´å¥½ã€‚ readOnly: boolean|stringç¼–è¾‘å™¨æ˜¯å¦åªè¯»ã€‚å¦‚æœè®¾ç½®ä¸ºé¢„è®¾çš„å€¼ â€œnocursorâ€ï¼Œé‚£ä¹ˆé™¤äº†è®¾ç½®åªè¯»å¤–ï¼Œç¼–è¾‘åŒºåŸŸè¿˜ä¸èƒ½è·å¾—ç„¦ç‚¹ã€‚ showCursorWhenSelecting: booleanåœ¨é€‰æ‹©æ—¶æ˜¯å¦æ˜¾ç¤ºå…‰æ ‡ï¼Œé»˜è®¤ä¸ºfalseã€‚ lineWiseCopyCut: booleanå¯ç”¨æ—¶ï¼Œå¦‚æœåœ¨å¤åˆ¶æˆ–å‰ªåˆ‡æ—¶æ²¡æœ‰é€‰æ‹©æ–‡æœ¬ï¼Œé‚£ä¹ˆå°±ä¼šè‡ªåŠ¨æ“ä½œå…‰æ ‡æ‰€åœ¨çš„æ•´è¡Œã€‚ undoDepth: integeræœ€å¤§æ’¤æ¶ˆæ¬¡æ•°ï¼Œé»˜è®¤ä¸º200ï¼ˆåŒ…æ‹¬é€‰ä¸­å†…å®¹æ”¹å˜äº‹ä»¶ï¼‰ ã€‚ historyEventDelay: integeråœ¨è¾“å…¥æˆ–åˆ é™¤æ—¶å¼•å‘å†å²äº‹ä»¶å‰çš„æ¯«ç§’æ•°ã€‚ tabindex: integerç¼–è¾‘å™¨çš„tabindexã€‚ autofocus: booleanæ˜¯å¦åœ¨åˆå§‹åŒ–æ—¶è‡ªåŠ¨è·å–ç„¦ç‚¹ã€‚é»˜è®¤æƒ…å†µæ˜¯å…³é—­çš„ã€‚ä½†æ˜¯ï¼Œåœ¨ä½¿ç”¨textareaå¹¶ä¸”æ²¡æœ‰æ˜ç¡®æŒ‡å®šå€¼çš„æ—¶å€™ä¼šè¢«è‡ªåŠ¨è®¾ç½®ä¸ºtrueã€‚ dragDrop: booleanæ˜¯å¦å…è®¸æ‹–æ”¾ï¼Œé»˜è®¤ä¸ºtrueã€‚ allowDropFileTypes: arrayé»˜è®¤ä¸ºnullã€‚å½“è®¾ç½®æ­¤é¡¹æ—¶ï¼Œåªæ¥æ”¶åŒ…å«åœ¨æ­¤æ•°ç»„å†…çš„æ–‡ä»¶ç±»å‹æ‹–å…¥ç¼–è¾‘å™¨ã€‚æ–‡ä»¶ç±»å‹ä¸ºMIMEåç§°ã€‚ cursorBlinkRate: numberå…‰æ ‡é—ªåŠ¨çš„é—´éš”ï¼Œå•ä½ä¸ºæ¯«ç§’ã€‚é»˜è®¤ä¸º530ã€‚å½“è®¾ç½®ä¸º0æ—¶ï¼Œä¼šç¦ç”¨å…‰æ ‡é—ªåŠ¨ã€‚è´Ÿæ•°ä¼šéšè—å…‰æ ‡ã€‚ cursorScrollMargin: numberå½“å…‰æ ‡é è¿‘å¯è§†åŒºåŸŸè¾¹ç•Œæ—¶ï¼Œå…‰æ ‡è·ç¦»ä¸Šæ–¹å’Œä¸‹æ–¹çš„è·ç¦»ã€‚é»˜è®¤ä¸º0 ã€‚ cursorHeight: numberå…‰æ ‡é«˜åº¦ã€‚é»˜è®¤ä¸º1ï¼Œä¹Ÿå°±æ˜¯æ’‘æ»¡è¡Œé«˜ã€‚å¯¹ä¸€äº›å­—ä½“ï¼Œè®¾ç½®0.85çœ‹èµ·æ¥ä¼šæ›´å¥½ã€‚ resetSelectionOnContextMenu: booleanè®¾ç½®åœ¨é€‰æ‹©æ–‡æœ¬å¤–ç‚¹å‡»æ‰“å¼€ä¸Šä¸‹æ–‡èœå•æ—¶ï¼Œæ˜¯å¦å°†å…‰æ ‡ç§»åŠ¨åˆ°ç‚¹å‡»å¤„ã€‚é»˜è®¤ä¸ºtrueã€‚ workTime, workDelay: numberé€šè¿‡ä¸€ä¸ªå‡çš„åå°çº¿ç¨‹é«˜äº® workTime æ—¶é•¿ï¼Œç„¶åä½¿ç”¨ timeout ä¼‘æ¯ workDelay æ—¶é•¿ã€‚é»˜è®¤ä¸º200å’Œ300 ã€‚ï¼ˆå®Œå…¨ä¸æ‡‚è¿™ä¸ªåŠŸèƒ½æ˜¯åœ¨è¯´å•¥ï¼‰ pollInterval: numberæŒ‡æ˜CodeMirrorå‘å¯¹åº”çš„textareaæ»šåŠ¨ï¼ˆå†™æ•°æ®ï¼‰çš„é€Ÿåº¦ï¼ˆè·å¾—ç„¦ç‚¹æ—¶ï¼‰ã€‚å¤§å¤šæ•°çš„è¾“å…¥éƒ½æ˜¯é€šè¿‡äº‹ä»¶æ•è·ï¼Œä½†æ˜¯æœ‰çš„è¾“å…¥æ³•ï¼ˆå¦‚IMEï¼‰åœ¨æŸäº›æµè§ˆå™¨ä¸Šå¹¶ä¸ä¼šç”Ÿæˆäº‹ä»¶ï¼Œæ‰€ä»¥ä½¿ç”¨æ•°æ®æ»šåŠ¨ã€‚é»˜è®¤ä¸º100æ¯«ç§’ã€‚ flattenSpans: booleané»˜è®¤æƒ…å†µä¸‹ï¼ŒCodeMirrorä¼šå°†ä½¿ç”¨ç›¸åŒclassçš„ä¸¤ä¸ªspanåˆå¹¶æˆä¸€ä¸ªã€‚é€šè¿‡è®¾ç½®æ­¤é¡¹ä¸ºfalseç¦ç”¨æ­¤åŠŸèƒ½ã€‚ addModeClass: booleanå½“å¯ç”¨æ—¶ï¼ˆé»˜è®¤ç¦ç”¨ï¼‰ï¼Œä¼šç»™æ¯ä¸ªæ ‡è®°æ·»åŠ é¢å¤–çš„è¡¨ç¤ºç”Ÿæˆæ ‡è®°çš„modeçš„ä»¥cm-må¼€å¤´çš„CSSæ ·å¼ç±»ã€‚ä¾‹å¦‚ï¼ŒXML modeäº§ç”Ÿçš„æ ‡è®°ï¼Œä¼šæ·»åŠ cm-m-xmlç±»ã€‚ maxHighlightLength: numberå½“éœ€è¦é«˜äº®å¾ˆé•¿çš„è¡Œæ—¶ï¼Œä¸ºäº†ä¿æŒå“åº”æ€§èƒ½ï¼Œå½“åˆ°è¾¾æŸäº›ä½ç½®æ—¶ï¼Œç¼–è¾‘å™¨ä¼šç›´æ¥å°†å…¶ä»–è¡Œè®¾ç½®ä¸ºçº¯æ–‡æœ¬(plain text)ã€‚é»˜è®¤ä¸º10000ï¼Œå¯ä»¥è®¾ç½®ä¸ºInfinityæ¥å…³é—­æ­¤åŠŸèƒ½ã€‚ viewportMargin: integeræŒ‡å®šå½“å‰æ»šåŠ¨åˆ°è§†å›¾ä¸­å†…å®¹ä¸Šæ–¹å’Œä¸‹æ–¹è¦æ¸²æŸ“çš„è¡Œæ•°ã€‚è¿™ä¼šå½±å“åˆ°æ»šåŠ¨æ—¶è¦æ›´æ–°çš„è¡Œæ•°ã€‚é€šå¸¸æƒ…å†µä¸‹åº”è¯¥ä½¿ç”¨é»˜è®¤å€¼10ã€‚å¯ä»¥è®¾ç½®å€¼ä¸ºInfinityå§‹ç»ˆæ¸²æŸ“æ•´ä¸ªæ–‡æ¡£ã€‚æ³¨æ„ï¼šè¿™æ ·è®¾ç½®åœ¨å¤„ç†å¤§æ–‡æ¡£æ—¶ä¼šå½±å“æ€§èƒ½ã€‚ å¦‚æœä½ è¦è®¾ç½®ä»£ç æ¡†çš„å¤§å°è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ 1editor.setSize('800px', '950px'); //è®¾ç½®ä»£ç æ¡†çš„é•¿å®½ å¦å¤–ï¼Œå¦‚æœä½ æƒ³ç»™ä»£ç æ¡†èµ‹å€¼ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ 12editor.setValue(\"\"); //ç»™ä»£ç æ¡†èµ‹å€¼editor.getValue(); //è·å–ä»£ç æ¡†çš„å€¼ å¦‚æœä½ å†æƒ³åœ¨å…¶ä»–åœ°æ–¹è®¾ç½®æ–°çš„å±æ€§ï¼Œå¯ä»¥åƒä¸‹é¢è¿™æ ·å†™ï¼š 1editor.setOption(\"readOnly\", true); //ç±»ä¼¼è¿™ç§ æ€»ç»“ä¸Šé¢å°±å¤§æ¦‚è®²äº†ä¸‹ Code Mirror æ€ä¹ˆä½¿ç”¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹çœ‹æ•ˆæœå§ æˆ‘è‡ªæˆ‘æ„Ÿè§‰è¿˜æ˜¯å¯ä»¥çš„å“ˆï¼ é‡Œé¢æ‰€æœ‰æ¶‰åŠçš„ä»£ç åœ¨ GitHub é‡Œå¯ä»¥ä¸‹è½½ï¼šhttps://github.com/zhisheng17/CoderBlog/tree/master/CodeMirror æ–‡ç« åŸåˆ›ï¼Œè½¬è½½åŠ¡å¿…è¯·æ³¨æ˜åŸåˆ›åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2017/12/09/CodeMirror/ æœ€åfuck æ— è„‘çš„æ¨é…·çˆ¬è™«ï¼Œç«Ÿç„¶æŠŠæˆ‘æ‰€æœ‰æ–‡ç« æœ€åçš„åŸåˆ›é“¾æ¥éƒ½ç»™å»æ‰äº†ï¼Œè¿™æ˜¯æˆ‘ç°åœ¨æƒ³åˆ°çš„ä¸€ç§å¯¹ç­–æ–¹æ³•ã€‚ä»»ä½•å…¶ä»–å½¢å¼çš„è½¬è½½ï¼Œä¹Ÿå¿…é¡»æŠŠæˆ‘æ–‡ç« æ‰€æœ‰å†…å®¹åŠ ä¸Šï¼Œä¸å¾—åšä»»ä½•ä¿®æ”¹ï¼Œå¦åˆ™è¯·åˆ«è½¬è½½äº†ï¼","tags":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"http://www.54tianzhisheng.cn/tags/å‰ç«¯/"}]},{"title":"Nettyç³»åˆ—æ–‡ç« ï¼ˆä¸€ï¼‰ï¼šNetty æºç é˜…è¯»ä¹‹åˆå§‹ç¯å¢ƒæ­å»º","date":"2017-12-07T16:00:00.000Z","path":"2017/12/08/netty-01-env/","text":"Netty ç®€ä»‹Netty æ˜¯ç”± JBOSS æä¾›çš„ä¸€ä¸ªå¼€æºçš„ java ç½‘ç»œç¼–ç¨‹æ¡†æ¶ï¼Œä¸»è¦æ˜¯å¯¹ java çš„ nio åŒ…è¿›è¡Œäº†å†æ¬¡å°è£…ã€‚Netty æ¯” java åŸç”Ÿçš„nio åŒ…æä¾›äº†æ›´åŠ å¼ºå¤§ã€ç¨³å®šçš„åŠŸèƒ½å’Œæ˜“äºä½¿ç”¨çš„ apiã€‚ netty çš„ä½œè€…æ˜¯ Trustin Leeï¼Œè¿™æ˜¯ä¸€ä¸ªéŸ©å›½äººï¼Œä»–è¿˜å¼€å‘äº†å¦å¤–ä¸€ä¸ªè‘—åçš„ç½‘ç»œç¼–ç¨‹æ¡†æ¶ï¼Œminaã€‚äºŒè€…åœ¨å¾ˆå¤šæ–¹é¢éƒ½ååˆ†ç›¸ä¼¼ï¼Œå®ƒä»¬çš„çº¿ç¨‹æ¨¡å‹ä¹Ÿæ˜¯åŸºæœ¬ä¸€è‡´ ã€‚ä¸è¿‡ netty ç¤¾åŒºçš„æ´»è·ƒç¨‹åº¦è¦ mina é«˜å¾—å¤šã€‚ç‰ˆæœ¬é€‰æ‹©ï¼š 3.x ç›®å‰ä¼ä¸šä½¿ç”¨æœ€å¤šçš„ç‰ˆæœ¬ï¼Œæœ€ä¸ºç¨³å®šã€‚ä¾‹å¦‚dubboä½¿ç”¨çš„å°±æ˜¯3.xç‰ˆæœ¬ 4.x å¼•å…¥äº†å†…å­˜æ± ç­‰é‡å¤§ç‰¹æ€§ï¼Œå¯ä»¥æœ‰æ•ˆçš„é™ä½GCè´Ÿè½½ï¼Œrocketmqä½¿ç”¨çš„å°±æ˜¯4.x 5.x å·²ç»è¢«åºŸå¼ƒäº†ï¼Œå…·ä½“å¯å‚è§ https://github.com/netty/netty/issues/4466 æ‰€ä»¥è¿™é‡Œæˆ‘æ­å»ºçš„æºç é˜…è¯»ç¯å¢ƒæ˜¯å­˜åœ¨çš„ 4.1 ç‰ˆæœ¬ã€‚ å‡†å¤‡å·¥å…· IDEA 2017 ç¯å¢ƒæ­å»ºåœ¨ IDEA ä¸­å¯¼å…¥é¡¹ç›®åœ°å€ï¼šhttps://github.com/netty/netty.git ï¼Œç„¶åå°±ä¼šè‡ªåŠ¨ä¸‹è½½é¡¹ç›®æ‰€æœ‰çš„ä¾èµ–ï¼Œä½†æ˜¯è¯·æ³¨æ„ï¼š å¿…é¡»åœ¨ IDEA ä¸­å°† Profiles ä¸­çš„æ‰€æœ‰éƒ½å‹¾é€‰ä¸Šï¼Œå¦åˆ™ä¼šå¯¼è‡´å¾ˆå¤š jar åŒ…æ‹‰ä¸ä¸‹æ¥ï¼Œå¦‚ä¸‹å›¾ï¼š ç„¶åå°±æ˜¯è€å¿ƒç­‰å¾…äº†ï¼Œä¸€ç›´åˆ°æ‰€æœ‰çš„ jar åŒ…æ‹‰å–ä¸‹æ¥ã€‚ ä¸­é€”ä½ å¯èƒ½ä¼šé‡åˆ°å¦‚ä¸‹é—®é¢˜ï¼š è¿™é‡Œçš„æ˜¯ 1.5 ç‰ˆæœ¬ï¼Œå¯¼è‡´æˆ‘ä»¬å¦‚æœæƒ³ç”¨äº›é«˜çº§çš„è¯­æ³•ä¼šå®Œå…¨æŠ¥é”™ã€‚ å¦‚æœä½ æŠŠè¿™ä¸ªç‰ˆæœ¬è®¾ç½®ä¸º 8 çš„ç‰ˆæœ¬åï¼Œ ä¸‹é¢ä¼šæç¤ºä½ ï¼Œé¡¹ç›®æ˜¯ä» maven å¯¼è¿‡æ¥çš„ï¼Œå¦‚æœ maven é…ç½®æ”¹å˜é‡æ–° reimport åï¼Œä»»ä½•åœ¨è¿™é‡Œçš„æ”¹å˜éƒ½ä¼šä¸¢å¤±ã€‚ åŒæ—¶ä½ ä¼šçœ‹åˆ°é¡¹ç›®çš„ Java Compile ç‰ˆæœ¬æ˜¯ 1.5 çš„ï¼Œå¦‚ä¸‹å›¾ï¼š åŒæ ·ï¼Œä½ åœ¨è¿™é‡Œä¿®æ”¹ï¼Œå¦‚æœ maven é…ç½®æ”¹å˜é‡æ–° reimport åï¼Œä»»ä½•åœ¨è¿™é‡Œçš„æ”¹å˜ä¹Ÿéƒ½ä¼šä¸¢å¤±ã€‚æˆ‘ä¼°è®¡ç¢°åˆ°è¿™ç§é—®é¢˜çš„ä¸å°‘ã€‚ æ€»ç»“èµ·æ¥åŸå› å°±æ˜¯ maven ä¸­çš„ç¼–è¯‘ç‰ˆæœ¬å°±æ˜¯ 1.5 çš„ï¼Œæ‰€ä»¥æ‰ä¼šå¯¼è‡´è¿™é‡Œçš„é—®é¢˜å‘ç”Ÿï¼Œå¦‚æœæƒ³å®Œå…¨ä¿®æ”¹å¥½ï¼ˆä¸€åŠ³æ°¸é€¸ï¼‰ã€‚è¯·ç›´æ¥å¯¹ pom æ–‡ä»¶åŠ¨åˆ€ï¼Œå°±æ˜¯å¹²ï¼ åªéœ€æŠŠå¤§é¡¹ç›®ï¼ˆnetty-parentï¼‰çš„é‚£ä¸ª pom.xml ä¿®æ”¹ä¸ªå±æ€§ï¼ŒæŠŠç‰ˆæœ¬ä¿¡æ¯æé«˜åˆ° 1.8ã€‚ åœ¨ç­‰å¾…å®ƒæ‹‰å– jar åŒ…å§ æå®Œäº†ä¹‹åå‘ç°è¿˜æœ‰ä¸¤ä¸ªæ¨¡å—ï¼ˆnetty-bomã€netty-dev-toolsï¼‰ä¸èƒ½è®¾ç½®åˆ° ç‰ˆæœ¬ï¼Œåªèƒ½æ‰‹åŠ¨çš„å’Œä¸Šé¢é‚£ç§è®¾ç½® language level å’Œ Java compile ä¸º 1.8 äº†ã€‚ æœ€åä½ ä¼šå‘ç°è¿™é‡Œçš„å®Œå…¨æ²¡æœ‰æŠ¥é”™äº†ï¼Œå¼€å¿ƒä¸ï¼Ÿ ä»£ç è¡Œæ•°ç»Ÿè®¡é¢ï¼Œçœ‹åˆ°é¡¹ç›®è¿™ä¹ˆå¤šå­æ¨¡å—ï¼Œä½ éƒ½ä¸çŸ¥é“è¯¥ä»å“ªé‡Œä¸‹æ‰‹å¼€å§‹çœ‹ï¼Œé‚£ä¹ˆæˆ‘å°±å†™äº†ä¸ªç®€å•çš„ Java è„šæœ¬å»å¤§æ¦‚çš„ç»Ÿè®¡æ¯ä¸ªå­é¡¹ç›®ä»£ç çš„è¡Œæ•°ã€‚å…ˆçœ‹çœ‹ç»Ÿè®¡ç»“æœï¼š æ•´ä¸ªé¡¹ç›®å·®ä¸å¤š 23 ä¸‡ã€‚ï¼ˆè¿‡æ»¤äº†ç©ºè¡Œã€å„ç§æ³¨é‡Šå’Œ @Override ä¹‹åçš„ Java ä»£ç è¡Œæ•°ï¼‰ï¼Œé è¿™ä¸ªæ•°å­—å¾ˆå“äººï¼ æ¥çœ‹çœ‹æˆ‘çš„è„šæœ¬ä»£ç å§ï¼š 123456789101112131415public static void main(String[] args) throws Exception &#123; long count = Files.walk(Paths.get(\"C:\\\\JetBrains\\\\IDEAProject\\\\netty\\\\transport-udt\")) // é€’å½’è·å¾—é¡¹ç›®ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ .filter(file -&gt; !Files.isDirectory(file)) // ç­›é€‰å‡ºæ–‡ä»¶ .filter(file -&gt; file.toString().endsWith(\".java\")) // ç­›é€‰å‡º java æ–‡ä»¶ .flatMap(Try.of(file -&gt; Files.lines(file), Stream.empty())) // å°†ä¼šæŠ›å‡ºå—æ£€å¼‚å¸¸çš„ Lambda åŒ…è£…ä¸º æŠ›å‡ºéå—æ£€å¼‚å¸¸çš„ Lambda .filter(line -&gt; !line.trim().isEmpty()) // è¿‡æ»¤æ‰ç©ºè¡Œ .filter(line -&gt; !line.trim().startsWith(\"//\")) //è¿‡æ»¤æ‰ //ä¹‹ç±»çš„æ³¨é‡Š .filter(line -&gt; !(line.trim().startsWith(\"/*\") &amp;&amp; line.trim().endsWith(\"*/\"))) //è¿‡æ»¤æ‰/* */ä¹‹ç±»çš„æ³¨é‡Š .filter(line -&gt; !(line.trim().startsWith(\"/*\") &amp;&amp; !line.trim().endsWith(\"*/\"))) //è¿‡æ»¤æ‰ä»¥ /* å¼€å¤´çš„æ³¨é‡Šï¼ˆå»é™¤ç©ºæ ¼åçš„å¼€å¤´ï¼‰ .filter(line -&gt; !(!line.trim().startsWith(\"/*\") &amp;&amp; line.trim().endsWith(\"*/\"))) //è¿‡æ»¤æ‰å·² */ ç»“å°¾çš„æ³¨é‡Š .filter(line -&gt; !line.trim().startsWith(\"*\")) //è¿‡æ»¤æ‰ javadoc ä¸­çš„æ–‡å­—æ³¨é‡Š .filter(line -&gt; !line.trim().startsWith(\"@Override\")) //è¿‡æ»¤æ‰æ–¹æ³•ä¸Šå« @Override çš„ .count(); System.out.println(\"ä»£ç è¡Œæ•°ï¼š\" + count);&#125; åé¢æˆ‘ä¼šæŠŠæˆ‘é˜…è¯»æºç çš„ä¸­æ–‡æ³¨é‡ŠåŠè§£æä¹‹ç±»çš„æ›´æ–°åˆ°æˆ‘çš„ GitHub å»ï¼ˆæ¬¢è¿å…³æ³¨ã€æˆ‘æ˜¯æ¥éª— star çš„ï¼‰ï¼Œhttps://github.com/zhisheng17/netty ï¼Œå¦‚æœä½ ä¸æƒ³å»è‡ªå·±è®¾ç½®ä¸Šé¢æ‰€è¯´çš„è¿™äº›ï¼ˆå·æ‡’ï¼‰ï¼Œé‚£å°±ç›´æ¥ fork æˆ‘çš„è¿™ä»½å§ï¼ æœ€åç¯å¢ƒæ­å»ºå°±å†™åˆ°è¿™é‡Œäº†ï¼Œè½¬è½½è¯·æ³¨æ˜åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2017/12/08/netty-01-env/","tags":[{"name":"Java","slug":"Java","permalink":"http://www.54tianzhisheng.cn/tags/Java/"},{"name":"Netty","slug":"Netty","permalink":"http://www.54tianzhisheng.cn/tags/Netty/"}]},{"title":"RestTemplate è¯¦è§£","date":"2017-12-02T16:00:00.000Z","path":"2017/12/03/RestTemplate/","text":"èƒŒæ™¯è¿™æ®µæ—¶é—´è‡ªå·±åšçš„é¡¹ç›®ä¸­éœ€è¦è°ƒç”¨æœåŠ¡æä¾›è€…çš„æœåŠ¡ï¼ˆæ¥å£ï¼‰ï¼Œå…·ä½“å°±æ˜¯ï¼šæˆ‘è¿™è¾¹éœ€è¦å°†é¡µé¢æ‰€è¾“å…¥çš„ Groovy è„šæœ¬ä»£ç ä¼ ç»™åˆ«äººæä¾›çš„æœåŠ¡æ¥å£ï¼Œç„¶åé‚£è¾¹è¿”å›è„šæœ¬ç¼–è¯‘çš„ç»“æœç»™æˆ‘ï¼Œæˆ‘éœ€è¦å°†ç¼–è¯‘ç»“æœå±•ç¤ºåœ¨é¡µé¢ï¼Œç”¨çš„å°±æ˜¯ RestTemplate äº†ï¼Œé‚£ RestTemplate æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿç®€å•è¯´å°±æ˜¯ï¼šç®€åŒ–äº†å‘èµ· HTTP è¯·æ±‚ä»¥åŠå¤„ç†å“åº”çš„è¿‡ç¨‹ï¼Œå¹¶ä¸”æ”¯æŒ REST ã€‚ä¸‹æ–‡å°±ç¨å¾®æ€»ç»“ä¸‹ã€‚ å¦‚ä½•ä½¿ç”¨å…ˆè®²è®²å¦‚ä½•ä½¿ç”¨å§ï¼Œæˆ‘é¡¹ç›®æ˜¯ SpringBoot é¡¹ç›®ï¼Œå¯ä»¥åœ¨å¯åŠ¨ç±»ä¸­åŠ å…¥ï¼š 1234@Beanpublic RestTemplate restTemplate() &#123; return new RestTemplate();&#125; ç„¶ååœ¨ Controller å±‚ä¸­å¼•å…¥ï¼š 12@Autowiredprivate RestTemplate restTemplate; æ¥ä¸‹æ¥å°±å¯ä»¥åœ¨ Controller ä¸­å„ä¸ªæ–¹æ³•ä¸­ä½¿ç”¨ restTemplate äº†ï¼Œä½†æ˜¯ restTemplate é‡Œé¢æœ‰ä»€ä¹ˆæ–¹æ³•å‘¢ï¼Ÿ RestTemplate å†…éƒ¨æ–¹æ³• ä»å›¾ä¸­ RestTemplate å¯ä»¥çœ‹åˆ°æœ‰å¾ˆå¤šæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æå–å‡ºä¸»è¦çš„å‡ ç§æ–¹æ³•æ˜¯ï¼š GET POST PUT DELETE HEAD OPTIONS EXCHANGE EXECUTE å›¾ç‰‡ä¸­ä¾ç„¶å¯ä»¥çŸ¥é“ RestTemplate ç±»ä¸­çš„æ–¹æ³•ä¸»è¦æ˜¯æ¥è‡ªæ¥å£ RestOperationsï¼Œä¸‹é¢æˆ‘ä»¬å…·ä½“çœ‹çœ‹è¿™äº›æ–¹æ³•é‡Œé¢çš„å…·ä½“å®ç°ä¸è¯¥å¦‚ä½•ä½¿ç”¨ã€‚ Get æ–¹æ³•åœ¨ RestTemplate ä¸­ï¼Œå‘é€ä¸€ä¸ª GET è¯·æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹ä¸¤ç§æ–¹å¼ï¼š getForEntity getForEntity æ–¹æ³•çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªResponseEntity&lt;T&gt;ï¼ŒResponseEntity&lt;T&gt;æ˜¯ Spring å¯¹ HTTP è¯·æ±‚å“åº”çš„å°è£…ï¼ŒåŒ…æ‹¬äº†å‡ ä¸ªé‡è¦çš„å…ƒç´ ï¼Œå¦‚å“åº”ç ã€contentTypeã€contentLengthã€å“åº”æ¶ˆæ¯ä½“ç­‰ã€‚æ¯”å¦‚ä¸‹é¢ä¸€ä¸ªä¾‹å­ï¼š 1234567891011121314@RequestMapping(\"/gethello\")public String getHello() &#123; ResponseEntity&lt;String&gt; responseEntity = restTemplate.getForEntity(\"http://HELLO-SERVICE/hello\", String.class); String body = responseEntity.getBody(); HttpStatus statusCode = responseEntity.getStatusCode(); int statusCodeValue = responseEntity.getStatusCodeValue(); HttpHeaders headers = responseEntity.getHeaders(); StringBuffer result = new StringBuffer(); result.append(\"responseEntity.getBody()ï¼š\").append(body).append(\"&lt;hr&gt;\") .append(\"responseEntity.getStatusCode()ï¼š\").append(statusCode).append(\"&lt;hr&gt;\") .append(\"responseEntity.getStatusCodeValue()ï¼š\").append(statusCodeValue).append(\"&lt;hr&gt;\") .append(\"responseEntity.getHeaders()ï¼š\").append(headers).append(\"&lt;hr&gt;\"); return result.toString();&#125; å…³äºè¿™æ®µä»£ç ï¼Œè¯´å¦‚ä¸‹å‡ ç‚¹ï¼š getForEntity çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæˆ‘è¦è°ƒç”¨çš„æœåŠ¡çš„åœ°å€ï¼Œè¿™é‡Œæˆ‘è°ƒç”¨äº†æœåŠ¡æä¾›è€…æä¾›çš„ /hello æ¥å£ï¼Œæ³¨æ„è¿™é‡Œæ˜¯é€šè¿‡æœåŠ¡åè°ƒç”¨è€Œä¸æ˜¯æœåŠ¡åœ°å€ï¼Œå¦‚æœå†™æˆæœåŠ¡åœ°å€å°±æ²¡æ³•å®ç°å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡äº†ã€‚ï¼ˆå¤‡æ³¨ï¼šæˆ‘é¡¹ç›®ä¸­éœ€è¦é€šè¿‡ ConsulClient å»è·å–æœåŠ¡åï¼Œç„¶ååœ¨å»è·å–æœåŠ¡çš„ IP å’Œ Portï¼Œå¹¶æŠŠå®ƒæ‹¼æ¥èµ·æ¥ç»„åˆæˆæˆ‘çš„æœåŠ¡åœ°å€ï¼Œæ‰€ä»¥å°±æ²¡æ³•å®ç°å®¢æˆ·ç«¯çš„è´Ÿè½½å‡è¡¡äº†ï¼Œå¦‚æœè¦æ˜¯å®ç°è´Ÿè½½å‡è¡¡ï¼Œå¯ä»¥åœ¨ SpringBoot å¯åŠ¨ç±»çš„ä¸­åŠ å…¥æ³¨è§£ @LoadBalanced, å¦‚ä¸‹: 12345@Bean@LoadBalancedpublic RestTemplate restTemplate() &#123; return new RestTemplate();&#125; ï¼‰ getForEntity ç¬¬äºŒä¸ªå‚æ•° String.class è¡¨ç¤ºæˆ‘å¸Œæœ›è¿”å›çš„ body ç±»å‹æ˜¯ String æ‹¿åˆ°è¿”å›ç»“æœä¹‹åï¼Œå°†è¿”å›ç»“æœéå†æ‰“å°å‡ºæ¥ æœ‰æ—¶å€™æˆ‘åœ¨è°ƒç”¨æœåŠ¡æä¾›è€…æä¾›çš„æ¥å£æ—¶ï¼Œå¯èƒ½éœ€è¦ä¼ é€’å‚æ•°ï¼Œæœ‰ä¸¤ç§ä¸åŒçš„æ–¹å¼: 123456789101112@RequestMapping(\"/sayhello\")public String sayHello() &#123; ResponseEntity&lt;String&gt; responseEntity = restTemplate.getForEntity(\"http://HELLO-SERVICE/sayhello?name=&#123;1&#125;\", String.class, \"å¼ ä¸‰\"); return responseEntity.getBody();&#125;@RequestMapping(\"/sayhello2\")public String sayHello2() &#123; Map&lt;String, String&gt; map = new HashMap&lt;&gt;(); map.put(\"name\", \"æå››\"); ResponseEntity&lt;String&gt; responseEntity = restTemplate.getForEntity(\"http://HELLO-SERVICE/sayhello?name=&#123;name&#125;\", String.class, map); return responseEntity.getBody();&#125; å¯ä»¥ç”¨ä¸€ä¸ªæ•°å­—åšå ä½ç¬¦ï¼Œæœ€åæ˜¯ä¸€ä¸ªå¯å˜é•¿åº¦çš„å‚æ•°ï¼Œæ¥ä¸€ ä¸€æ›¿æ¢å‰é¢çš„å ä½ç¬¦ ä¹Ÿå¯ä»¥å‰é¢ä½¿ç”¨ name={name} è¿™ç§å½¢å¼ï¼Œæœ€åä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ª mapï¼Œmap çš„ key å³ä¸ºå‰è¾¹å ä½ç¬¦çš„åå­—ï¼Œmapçš„ value ä¸ºå‚æ•°å€¼ ç¬¬ä¸€ä¸ªè°ƒç”¨åœ°å€ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªURIè€Œä¸æ˜¯å­—ç¬¦ä¸²ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬æ„å»ºä¸€ä¸ªURIå³å¯ï¼Œå‚æ•°ç¥é©¬çš„éƒ½åŒ…å«åœ¨URIä¸­äº†ï¼Œå¦‚ä¸‹ï¼š 1234567@RequestMapping(\"/sayhello3\")public String sayHello3() &#123; UriComponents uriComponents = UriComponentsBuilder.fromUriString(\"http://HELLO-SERVICE/sayhello?name=&#123;name&#125;\").build().expand(\"ç‹äº”\").encode(); URI uri = uriComponents.toUri(); ResponseEntity&lt;String&gt; responseEntity = restTemplate.getForEntity(uri, String.class); return responseEntity.getBody();&#125; é€šè¿‡Springä¸­æä¾›çš„UriComponentsæ¥æ„å»ºUriå³å¯ã€‚ å½“ç„¶ï¼ŒæœåŠ¡æä¾›è€…ä¸ä»…å¯ä»¥è¿”å›Stringï¼Œä¹Ÿå¯ä»¥è¿”å›ä¸€ä¸ªè‡ªå®šä¹‰ç±»å‹çš„å¯¹è±¡ï¼Œæ¯”å¦‚æˆ‘çš„æœåŠ¡æä¾›è€…ä¸­æœ‰å¦‚ä¸‹æ–¹æ³•ï¼š 1234@RequestMapping(value = \"/getbook1\", method = RequestMethod.GET)public Book book1() &#123; return new Book(\"ä¸‰å›½æ¼”ä¹‰\", 90, \"ç½—è´¯ä¸­\", \"èŠ±åŸå‡ºç‰ˆç¤¾\");&#125; å¯¹äºè¯¥æ–¹æ³•æˆ‘å¯ä»¥åœ¨æœåŠ¡æ¶ˆè´¹è€…ä¸­é€šè¿‡å¦‚ä¸‹æ–¹å¼æ¥è°ƒç”¨ï¼š 12345@RequestMapping(\"/book1\")public Book book1() &#123; ResponseEntity&lt;Book&gt; responseEntity = restTemplate.getForEntity(\"http://HELLO-SERVICE/getbook1\", Book.class); return responseEntity.getBody();&#125; è¿è¡Œç»“æœå¦‚ä¸‹ï¼š getForObject â€‹ getForObject å‡½æ•°å®é™…ä¸Šæ˜¯å¯¹ getForEntity å‡½æ•°çš„è¿›ä¸€æ­¥å°è£…ï¼Œå¦‚æœä½ åªå…³æ³¨è¿”å›çš„æ¶ˆæ¯ä½“çš„å†…å®¹ï¼Œå¯¹å…¶ä»–ä¿¡æ¯éƒ½ä¸å…³æ³¨ï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨ getForObjectï¼Œä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œå¦‚ä¸‹ï¼š 12345@RequestMapping(\"/book2\")public Book book2() &#123; Book book = restTemplate.getForObject(\"http://HELLO-SERVICE/getbook1\", Book.class); return book;&#125; POST æ–¹æ³•åœ¨ RestTemplate ä¸­ï¼ŒPOST è¯·æ±‚å¯ä»¥é€šè¿‡å¦‚ä¸‹ä¸‰ä¸ªæ–¹æ³•æ¥å‘èµ·ï¼š postForEntity è¯¥æ–¹æ³•å’Œgetè¯·æ±‚ä¸­çš„getForEntityæ–¹æ³•ç±»ä¼¼ï¼Œå¦‚ä¸‹ä¾‹å­ï¼š 1234567@RequestMapping(\"/book3\")public Book book3() &#123; Book book = new Book(); book.setName(\"çº¢æ¥¼æ¢¦\"); ResponseEntity&lt;Book&gt; responseEntity = restTemplate.postForEntity(\"http://HELLO-SERVICE/getbook2\", book, Book.class); return responseEntity.getBody();&#125; æ–¹æ³•çš„ç¬¬ä¸€å‚æ•°è¡¨ç¤ºè¦è°ƒç”¨çš„æœåŠ¡çš„åœ°å€ æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºä¸Šä¼ çš„å‚æ•° æ–¹æ³•çš„ç¬¬ä¸‰ä¸ªå‚æ•°è¡¨ç¤ºè¿”å›çš„æ¶ˆæ¯ä½“çš„æ•°æ®ç±»å‹ æˆ‘è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªBookå¯¹è±¡ï¼Œè¿™ä¸ªBookå¯¹è±¡åªæœ‰nameå±æ€§æœ‰å€¼ï¼Œå°†ä¹‹ä¼ é€’åˆ°æœåŠ¡æä¾›è€…é‚£é‡Œå»ï¼ŒæœåŠ¡æä¾›è€…ä»£ç å¦‚ä¸‹ï¼š 12345678@RequestMapping(value = \"/getbook2\", method = RequestMethod.POST)public Book book2(@RequestBody Book book) &#123; System.out.println(book.getName()); book.setPrice(33); book.setAuthor(\"æ›¹é›ªèŠ¹\"); book.setPublisher(\"äººæ°‘æ–‡å­¦å‡ºç‰ˆç¤¾\"); return book;&#125; æœåŠ¡æä¾›è€…æ¥æ”¶åˆ°æœåŠ¡æ¶ˆè´¹è€…ä¼ æ¥çš„å‚æ•°bookï¼Œç»™å…¶ä»–å±æ€§è®¾ç½®ä¸Šå€¼å†è¿”å›ï¼Œè°ƒç”¨ç»“æœå¦‚ä¸‹ï¼š postForObject å¦‚æœä½ åªå…³æ³¨ï¼Œè¿”å›çš„æ¶ˆæ¯ä½“ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨postForObjectã€‚ç”¨æ³•å’ŒgetForObjectä¸€è‡´ã€‚ postForLocation postForLocation ä¹Ÿæ˜¯æäº¤æ–°èµ„æºï¼Œæäº¤æˆåŠŸä¹‹åï¼Œè¿”å›æ–°èµ„æºçš„ URIï¼ŒpostForLocation çš„å‚æ•°å’Œå‰é¢ä¸¤ç§çš„å‚æ•°åŸºæœ¬ä¸€è‡´ï¼Œåªä¸è¿‡è¯¥æ–¹æ³•çš„è¿”å›å€¼ä¸º URI ï¼Œè¿™ä¸ªåªéœ€è¦æœåŠ¡æä¾›è€…è¿”å›ä¸€ä¸ª URI å³å¯ï¼Œè¯¥ URI è¡¨ç¤ºæ–°èµ„æºçš„ä½ç½®ã€‚ PUT æ–¹æ³• åœ¨ RestTemplate ä¸­ï¼ŒPUT è¯·æ±‚å¯ä»¥é€šè¿‡ put æ–¹æ³•è°ƒç”¨ï¼Œput æ–¹æ³•çš„å‚æ•°å’Œå‰é¢ä»‹ç»çš„ postForEntity æ–¹æ³•çš„å‚æ•°åŸºæœ¬ä¸€è‡´ï¼Œåªæ˜¯ put æ–¹æ³•æ²¡æœ‰è¿”å›å€¼è€Œå·²ã€‚ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œå¦‚ä¸‹ï¼š 123456@RequestMapping(\"/put\")public void put() &#123; Book book = new Book(); book.setName(\"çº¢æ¥¼æ¢¦\"); restTemplate.put(\"http://HELLO-SERVICE/getbook3/&#123;1&#125;\", book, 99);&#125; bookå¯¹è±¡æ˜¯æˆ‘è¦æäº¤çš„å‚æ•°ï¼Œæœ€åçš„99ç”¨æ¥æ›¿æ¢å‰é¢çš„å ä½ç¬¦{1} DELETE æ–¹æ³• delete è¯·æ±‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ delete æ–¹æ³•è°ƒç”¨æ¥å®ç°ï¼Œå¦‚ä¸‹ä¾‹å­ï¼š 1234@RequestMapping(\"/delete\")public void delete() &#123; restTemplate.delete(\"http://HELLO-SERVICE/getbook4/&#123;1&#125;\", 100);&#125; HEADER æ–¹æ³• è¿”å›èµ„æºçš„æ‰€æœ‰ HTTP headersã€‚ OPTIONS é—®å¯ä»¥æ‰§è¡Œå“ªäº›æ–¹æ³•ã€‚ EXCHANGE ä¸å…¶å®ƒæ¥å£çš„ä¸åŒï¼š å…è®¸è°ƒç”¨è€…æŒ‡å®šHTTPè¯·æ±‚çš„æ–¹æ³•ï¼ˆGET,POST,PUTç­‰ï¼‰ å¯ä»¥åœ¨è¯·æ±‚ä¸­å¢åŠ bodyä»¥åŠå¤´ä¿¡æ¯ï¼Œå…¶å†…å®¹é€šè¿‡å‚æ•° HttpEntity&lt;?&gt;requestEntity æè¿° exchangeæ”¯æŒâ€˜å«å‚æ•°çš„ç±»å‹â€™ï¼ˆå³æ³›å‹ç±»ï¼‰ä½œä¸ºè¿”å›ç±»å‹ï¼Œè¯¥ç‰¹æ€§é€šè¿‡ ParameterizedTypeReferenceresponseType æè¿° EXECUTEç»†å¿ƒçš„ä½ ï¼Œä¸çŸ¥é“æœ‰æ²¡æœ‰å‘ç°ä¸Šé¢æ‰€æœ‰çš„æ–¹æ³•å†…éƒ¨è¿”å›å€¼éƒ½è°ƒç”¨äº†åŒä¸€ä¸ªæ–¹æ³• â€”â€” execute æ–¹æ³•ã€‚ ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹ï¼š å¯ä»¥çœ‹åˆ°ï¼ŒExcuteæ–¹æ³•åªæ˜¯å°† String æ ¼å¼çš„ URI è½¬æˆäº† java.net.URIï¼Œä¹‹åè°ƒç”¨äº†doExecuteæ–¹æ³•ã€‚æ•´ä¸ªè°ƒç”¨è¿‡ç¨‹å…³é”®èµ·ä½œç”¨çš„æ˜¯ doExecute æ–¹æ³• doExecute æ–¹æ³• è¿™é‡Œéœ€è¦äº†è§£ä¸¤ä¸ªç±»ï¼š RequestCallback å’Œ ResponseExtractor RestTemplate ç±»ä¸­å¯ä»¥çœ‹åˆ°ä»–ä»¬ä¸¤çš„å®ç°ç±»ã€‚ RequestCallback ï¼šç”¨äºæ“ä½œè¯·æ±‚å¤´å’Œbodyï¼Œåœ¨è¯·æ±‚å‘å‡ºå‰æ‰§è¡Œã€‚ è¯¥æ¥å£æœ‰ä¸¤ä¸ªå®ç°ç±»ï¼š AcceptHeaderRequestCallback åªå¤„ç†è¯·æ±‚å¤´ï¼Œç”¨äºgetXXX()æ–¹æ³•ã€‚ HttpEntityRequestCallback ç»§æ‰¿äºAcceptHeaderRequestCallbackå¯ä»¥å¤„ç†è¯·æ±‚å¤´å’Œbodyï¼Œç”¨äºputXXX()ã€postXXX()å’Œexchange()æ–¹æ³•ã€‚ ResponseExtractorï¼šè§£æHTTPå“åº”çš„æ•°æ®ï¼Œè€Œä¸”ä¸éœ€è¦æ‹…å¿ƒå¼‚å¸¸å’Œèµ„æºçš„å…³é—­ ä¸Šé¢å›¾çº¸è¿™ä¸ªå®ç°ç±» ResponseEntityResponseExtractor çš„ä½œç”¨æ˜¯ï¼šä½¿ç”¨ HttpMessageConverterExtractor æå– bodyï¼ˆå§”æ‰˜æ¨¡å¼ï¼‰ï¼Œç„¶åå°† body å’Œå“åº”å¤´ã€çŠ¶æ€å°è£…æˆ ResponseEntity å¯¹è±¡ã€‚ æœ€åè½¬è½½è¯·æ³¨æ˜åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2017/12/03/RestTemplate/ å‚è€ƒèµ„æ–™1ã€https://www.cnblogs.com/caolei1108/p/6169950.html 2ã€https://segmentfault.com/a/1190000011093597 å¦‚æœæƒ³å’Œæˆ‘è¿›ä¸€æ­¥äº¤æµè¯·å…³æ³¨ï¼š","tags":[{"name":"Spring","slug":"Spring","permalink":"http://www.54tianzhisheng.cn/tags/Spring/"}]},{"title":"å®ä¹ åœˆç¾¤é‡Œæé—®å°è®°","date":"2017-12-01T16:00:00.000Z","path":"2017/12/02/wx-01/","text":"","tags":[{"name":"å®ä¹ åœˆ","slug":"å®ä¹ åœˆ","permalink":"http://www.54tianzhisheng.cn/tags/å®ä¹ åœˆ/"}]},{"title":"Dockerç³»åˆ—æ–‡ç« ï¼ˆä¸€ï¼‰ï¼šåŸºäº Harbor æ­å»º Docker ç§æœ‰é•œåƒä»“åº“","date":"2017-11-25T16:00:00.000Z","path":"2017/11/26/Docker-harbor/","text":"ä»€ä¹ˆæ˜¯ Harborï¼Ÿç¬¬ä¸€æ¬¡ä½¿ç”¨è¿™ä¸ªçš„æ—¶å€™æ˜¯åˆšè¿›å…¬å¸å¤„ç†çš„ç¬¬ä¸€ä¸ªä»»åŠ¡çš„æ—¶å€™ï¼Œå‘ç° Harbor å°±æ˜¯ä¸€ä¸ªç”¨äºå­˜å‚¨å’Œåˆ†å‘ Docker é•œåƒçš„ä¼ä¸šçº§Registry æœåŠ¡å™¨ã€‚ç½‘ä¸Šæ‰¾åˆ°ä¸€ä¸ª Harbor çš„æ¶æ„å›¾ï¼š Harbor æ˜¯ VMware å…¬å¸å¼€æºçš„ä¼ä¸šçº§ DockerRegistry é¡¹ç›®ï¼Œé¡¹ç›®åœ°å€ä¸º https://github.com/vmware/harborã€‚å…¶ç›®æ ‡æ˜¯å¸®åŠ©ç”¨æˆ·è¿…é€Ÿæ­å»ºä¸€ä¸ªä¼ä¸šçº§çš„ Docker registry æœåŠ¡ã€‚å®ƒä»¥ Docker å…¬å¸å¼€æºçš„ registry ä¸ºåŸºç¡€ï¼Œæä¾›äº†ç®¡ç†UIï¼ŒåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶(Role Based Access Control)ï¼ŒAD/LDAPé›†æˆã€ä»¥åŠå®¡è®¡æ—¥å¿—(Auditlogging) ç­‰ä¼ä¸šç”¨æˆ·éœ€æ±‚çš„åŠŸèƒ½ï¼ŒåŒæ—¶è¿˜åŸç”Ÿæ”¯æŒä¸­æ–‡ã€‚Harbor çš„æ¯ä¸ªç»„ä»¶éƒ½æ˜¯ä»¥ Docker å®¹å™¨çš„å½¢å¼æ„å»ºçš„ï¼Œä½¿ç”¨ Docker Compose æ¥å¯¹å®ƒè¿›è¡Œéƒ¨ç½²ã€‚ ç¯å¢ƒå‡†å¤‡1ã€è‡ªå·±åœ¨è…¾è®¯äº‘ä¹°çš„æœåŠ¡å™¨ï¼ˆCentOS7.3ï¼‰ 2ã€Docker ç‰ˆæœ¬ï¼š17.05.0-ce 3ã€Docker-composeï¼š1.17.1 4ã€Harborï¼š1.1.2 å®‰è£… Dockerå› ä¸ºç³»ç»Ÿæ˜¯ CentOS 7.3 ï¼Œå†…æ ¸å•¥çš„éƒ½å·²ç»æ˜¯ 3.10ï¼Œæ‰€ä»¥ä¸ç”¨æ‹…å¿ƒå†…æ ¸å‡çº§çš„é—®é¢˜ï¼Œä¸€äº›æ“ä½œå•¥çš„åœ¨ 7.x ä¸Šæ“ä½œä¹Ÿå¾ˆæ–¹ä¾¿ã€‚ 1234567891011121314151617181920212223yum update //ç³»ç»Ÿç‰ˆæœ¬æ›´æ–°vim /etc/yum.repos.d/docker.repo //æ·»åŠ ä»¥ä¸‹å†…å®¹[dockerrepo]name=Docker Repositorybaseurl=https://yum.dockerproject.org/repo/main/centos/7/enabled=1gpgcheck=1gpgkey=https://yum.dockerproject.org/gpg//ä¸‹é¢å®‰è£… Docker å¼•æ“yum install docker-engine -y//å®‰è£…dockerå¼•æ“ï¼Œæ­¤æ­¥ä¹Ÿå¯ä½œä¸ºæ›´æ–°dockerç‰ˆæœ¬çš„æ“ä½œï¼šå…ˆ#systemctl stop docker åœæ­¢dockeræœåŠ¡ï¼Œå†#yum install docker-engine æ›´æ–°dockerç‰ˆæœ¬systemctl enable docker.servicesystemctl start docker //å¯åŠ¨dockerå®ˆæŠ¤è¿›ç¨‹docker info //æŸ¥çœ‹dockerè¿è¡Œæƒ…å†µdocker -v //æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯ ä¿®æ”¹ Docker é…ç½®æ–‡ä»¶ /etc/default/docker å¦‚ä¸‹ï¼š 1DOCKER_OPTS=\"--registry-mirror=http://aad0405c.m.daocloud.io\" //æ¢æˆå›½å†…çš„é•œåƒåŠ é€Ÿæºï¼Œä¸ç„¶æ‹‰å–é•œåƒç®€ç›´é¾Ÿé€Ÿï¼Œä¸æƒ³åœ¨åæ§½äº† ä½¿ç”¨ service docker restart é‡å¯ Docker æœåŠ¡å³å¯ã€‚ æˆ–è€…ç”¨å®˜æ–¹æä¾›çš„æ–¹å¼ï¼š 1curl -sSL https://get.daocloud.io/daotools/set_mirror.sh | sh -s http://ef017c13.m.daocloud.io å®‰è£… Docker-composeå¦‚æœæ˜¯æƒ³ç›´æ¥å‘½ä»¤å®‰è£…ä¹Ÿè¡Œï¼Œ 1234567891011121314ä¸‹è½½æŒ‡å®šç‰ˆæœ¬çš„docker-composesudo curl -L https://github.com/docker/compose/releases/download/1.17.0/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-composeå¯¹äºŒè¿›åˆ¶æ–‡ä»¶èµ‹å¯æ‰§è¡Œæƒé™chmod +x /usr/local/bin/docker-composeæµ‹è¯•ä¸‹docker-composeæ˜¯å¦å®‰è£…æˆåŠŸdocker-compose --versionå‡ºç°å¦‚ä¸‹docker-compose version 1.17.1, build 6d101fb ä½†æ˜¯ï¼Œè¿™ç§æ–¹æ³•ç®€ç›´é¾Ÿé€Ÿï¼Œå¹¸å¥½è¿˜æœ‰ç§æ–¹æ³•ï¼Œ è§è¿™é‡Œï¼šhttps://docs.docker.com/compose/install/#install-compose è¿™ç§éœ€è¦é€šè¿‡ Python çš„ pip å®‰è£… å®‰è£… pip123456789wget --no-check-certificate https://pypi.python.org/packages/source/s/setuptools/setuptools-1.4.2.tar.gztar -vxf setuptools-1.4.2.tar.gzcd setuptools-1.4.2python2.7 setup.py install //å› ä¸ºæœåŠ¡å™¨è‡ªå¸¦ Python 2.7easy_install-2.7 pip å®‰è£… docker compose123pip install docker-composedocker-compose --version //æµ‹è¯•å®‰è£…æ˜¯å¦æˆåŠŸ å®‰è£… Harbor12345wget https://github.com/vmware/harbor/releases/download/v1.1.2/harbor-offline-installer-v1.1.2.tgzç¦»çº¿å®‰è£…åŒ…,ä¹Ÿæ˜¯é¾Ÿé€Ÿï¼ŒæŠŠè¿™ä¸ªä¸‹è½½é“¾æ¥ç”¨è¿…é›·ä¸‹è½½ï¼Œé€Ÿåº¦å´è´¼å¿«ï¼Œå˜¿å˜¿ï¼Œç„¶åå†ä¼ åˆ°æœåŠ¡å™¨ä¸Šå»ï¼Œæ•´ä¸ªè¿‡ç¨‹å¿«å¾ˆå¤šï¼tar -zxvf harbor-offline-installer-v1.1.2.tgz è§£å‹ç¼©ä¹‹åï¼Œè¿›å…¥ç›®å½•ä¸‹ä¼šçœ‹åˆ° harbor.cfg æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å°±æ˜¯ Harbor çš„é…ç½®æ–‡ä»¶ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495## Configuration file of Harbor# hostnameè®¾ç½®è®¿é—®åœ°å€ï¼Œå¯ä»¥ä½¿ç”¨ipã€åŸŸåï¼Œä¸å¯ä»¥è®¾ç½®ä¸º127.0.0.1æˆ–localhosthostname = 115.159.227.249 #è¿™é‡Œæˆ‘å…ˆé…ç½®æˆ‘çš„æœåŠ¡å™¨IPåœ°å€# è®¿é—®åè®®ï¼Œé»˜è®¤æ˜¯httpï¼Œä¹Ÿå¯ä»¥è®¾ç½®httpsï¼Œå¦‚æœè®¾ç½®httpsï¼Œåˆ™nginx ssléœ€è¦è®¾ç½®onui_url_protocol = http# mysqlæ•°æ®åº“rootç”¨æˆ·é»˜è®¤å¯†ç root123ï¼Œå®é™…ä½¿ç”¨æ—¶ä¿®æ”¹ä¸‹db_password = root123#Maximum number of job workers in job servicemax_job_workers = 3#Determine whether or not to generate certificate for the registry&apos;s token.#If the value is on, the prepare script creates new root cert and private key#for generating token to access the registry. If the value is off the default key/cert will be used.#This flag also controls the creation of the notary signer&apos;s cert.customize_crt = on#The path of cert and key files for nginx, they are applied only the protocol is set to httpsssl_cert = /data/cert/server.crtssl_cert_key = /data/cert/server.key#The path of secretkey storagesecretkey_path = /data#Admiral&apos;s url, comment this attribute, or set its value to NA when Harbor is standaloneadmiral_url = NA#NOTES: The properties between BEGIN INITIAL PROPERTIES and END INITIAL PROPERTIES#only take effect in the first boot, the subsequent changes of these properties#should be performed on web ui#************************BEGIN INITIAL PROPERTIES************************#Email account settings for sending out password resetting emails.#Email server uses the given username and password to authenticate on TLS connections to host and act as identity.#Identity left blank to act as username.email_identity =email_server = smtp.mydomain.comemail_server_port = 25email_username = sample_admin@mydomain.comemail_password = abcemail_from = admin &lt;sample_admin@mydomain.com&gt;email_ssl = false##The initial password of Harbor admin, only works for the first time when Harbor starts.#It has no effect after the first launch of Harbor.# å¯åŠ¨Harboråï¼Œç®¡ç†å‘˜UIç™»å½•çš„å¯†ç ï¼Œé»˜è®¤æ˜¯Harbor12345harbor_admin_password = Harbor12345# è®¤è¯æ–¹å¼ï¼Œè¿™é‡Œæ”¯æŒå¤šç§è®¤è¯æ–¹å¼ï¼Œå¦‚LADPã€æœ¬æ¬¡å­˜å‚¨ã€æ•°æ®åº“è®¤è¯ã€‚é»˜è®¤æ˜¯db_authï¼Œmysqlæ•°æ®åº“è®¤è¯auth_mode = db_auth#The url for an ldap endpoint.ldap_url = ldaps://ldap.mydomain.com#A user&apos;s DN who has the permission to search the LDAP/AD server.#If your LDAP/AD server does not support anonymous search, you should configure this DN and ldap_search_pwd.#ldap_searchdn = uid=searchuser,ou=people,dc=mydomain,dc=com#the password of the ldap_searchdn#ldap_search_pwd = password#The base DN from which to look up a user in LDAP/ADldap_basedn = ou=people,dc=mydomain,dc=com#Search filter for LDAP/AD, make sure the syntax of the filter is correct.#ldap_filter = (objectClass=person)# The attribute used in a search to match a user, it could be uid, cn, email, sAMAccountName or other attributes depending on your LDAP/AD ldap_uid = uid#the scope to search for users, 1-LDAP_SCOPE_BASE, 2-LDAP_SCOPE_ONELEVEL, 3-LDAP_SCOPE_SUBTREEldap_scope = 3#Timeout (in seconds) when connecting to an LDAP Server. The default value (and most reasonable) is 5 seconds.ldap_timeout = 5# æ˜¯å¦å¼€å¯è‡ªæ³¨å†Œself_registration = on# Tokenæœ‰æ•ˆæ—¶é—´ï¼Œé»˜è®¤30åˆ†é’Ÿtoken_expiration = 30# ç”¨æˆ·åˆ›å»ºé¡¹ç›®æƒé™æ§åˆ¶ï¼Œé»˜è®¤æ˜¯everyoneï¼ˆæ‰€æœ‰äººï¼‰ï¼Œä¹Ÿå¯ä»¥è®¾ç½®ä¸ºadminonlyï¼ˆåªèƒ½ç®¡ç†å‘˜ï¼‰project_creation_restriction = everyone#Determine whether the job service should verify the ssl cert when it connects to a remote registry.#Set this flag to off when the remote registry uses a self-signed or untrusted certificate.verify_remote_cert = on#************************END INITIAL PROPERTIES************************ å¯åŠ¨ harborï¼Œä¿®æ”¹å®Œé…ç½®æ–‡ä»¶åï¼Œåœ¨çš„å½“å‰ç›®å½•æ‰§è¡Œ./install.shï¼ŒHarboræœåŠ¡å°±ä¼šæ ¹æ®å½“æœŸç›®å½•ä¸‹çš„docker-compose.ymlå¼€å§‹ä¸‹è½½ä¾èµ–çš„é•œåƒï¼Œæ£€æµ‹å¹¶æŒ‰ç…§é¡ºåºä¾æ¬¡å¯åŠ¨å„ä¸ªæœåŠ¡ã€‚ å¯åŠ¨å®Œæˆåï¼Œæˆ‘ä»¬è®¿é—®åˆšè®¾ç½®çš„ hostname å³å¯ï¼Œhttp://115.159.227.249/ï¼Œé»˜è®¤æ˜¯80ç«¯å£ï¼Œå¦‚æœç«¯å£å ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥å»ä¿®æ”¹docker-compose.ymlæ–‡ä»¶ä¸­ï¼Œå¯¹åº”æœåŠ¡çš„ç«¯å£æ˜ å°„ã€‚ ç™»å½• Web Harbor , è¾“å…¥ç”¨æˆ·å adminï¼Œé»˜è®¤å¯†ç ï¼ˆæˆ–å·²ä¿®æ”¹å¯†ç ï¼‰ç™»å½•ç³»ç»Ÿã€‚ æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç³»ç»Ÿå„ä¸ªæ¨¡å—å¦‚ä¸‹ï¼š é¡¹ç›®ï¼šæ–°å¢/åˆ é™¤é¡¹ç›®ï¼ŒæŸ¥çœ‹é•œåƒä»“åº“ï¼Œç»™é¡¹ç›®æ·»åŠ æˆå‘˜ã€æŸ¥çœ‹æ“ä½œæ—¥å¿—ã€å¤åˆ¶é¡¹ç›®ç­‰ æ—¥å¿—ï¼šä»“åº“å„ä¸ªé•œåƒcreateã€pushã€pullç­‰æ“ä½œæ—¥å¿— ç³»ç»Ÿç®¡ç† ç”¨æˆ·ç®¡ç†ï¼šæ–°å¢/åˆ é™¤ç”¨æˆ·ã€è®¾ç½®ç®¡ç†å‘˜ç­‰ å¤åˆ¶ç®¡ç†ï¼šæ–°å¢/åˆ é™¤ä»åº“ç›®æ ‡ã€æ–°å»º/åˆ é™¤/å¯åœå¤åˆ¶è§„åˆ™ç­‰ é…ç½®ç®¡ç†ï¼šè®¤è¯æ¨¡å¼ã€å¤åˆ¶ã€é‚®ç®±è®¾ç½®ã€ç³»ç»Ÿè®¾ç½®ç­‰ å…¶ä»–è®¾ç½® ç”¨æˆ·è®¾ç½®ï¼šä¿®æ”¹ç”¨æˆ·åã€é‚®ç®±ã€åç§°ä¿¡æ¯ ä¿®æ”¹å¯†ç ï¼šä¿®æ”¹ç”¨æˆ·å¯†ç  æ³¨æ„ï¼šéç³»ç»Ÿç®¡ç†å‘˜ç”¨æˆ·ç™»å½•ï¼Œåªèƒ½çœ‹åˆ°æœ‰æƒé™çš„é¡¹ç›®å’Œæ—¥å¿—ï¼Œå…¶ä»–æ¨¡å—ä¸å¯è§ã€‚ æˆ‘ä»¬è¦å°è¯•ä¸‹èƒ½ä¸èƒ½æŠŠè‡ªå·± Docker é‡Œé¢çš„é•œåƒ push åˆ° Harbor çš„ library é‡Œæ¥ï¼ˆé»˜è®¤è¿™ä¸ª library é¡¹ç›®æ˜¯å…¬å¼€çš„ï¼Œæ‰€æœ‰äººéƒ½å¯ä»¥æœ‰è¯»çš„æƒé™ï¼Œéƒ½ä¸éœ€è¦ docker login è¿›æ¥ï¼Œå°±å¯ä»¥æ‹‰å–é‡Œé¢çš„é•œåƒï¼‰ã€‚ æ³¨æ„ï¼š ä¸ºäº†åé¢ç•™å‘ï¼Œæˆ‘è¿™é‡Œå…ˆ åœ¨è‡ªå·±çš„ docker.service ä¸­æ·»åŠ ä»“åº“ï¼šï¼ˆè¿™æ˜¯ä¸ªå‘ï¼Œå»ºè®®ä½ å…ˆæŒ‰ç…§æˆ‘è¯´çš„åšï¼Œä¸ç„¶ä¸‹é¢å¯èƒ½ä¼šä¸€ç›´ç™»å½•ä¸ä¸Šï¼‰ 1234vim /usr/lib/systemd/system/docker.serviceé‡Œé¢çš„è¿™è¡Œä¿®æ”¹ä¸ºï¼šï¼ˆå…¶å®å°±æ˜¯æ·»åŠ  --insecure-registry 115.159.227.249 ï¼‰ExecStart=/usr/bin/dockerd --insecure-registry 115.159.227.249 æ·»åŠ å®Œäº†åé‡æ–°å¯åŠ¨ dockerï¼š 1systemctl daemon-reload &amp;&amp; systemctl enable docker &amp;&amp; systemctl start docker å¯åŠ¨ docker æœåŠ¡: 1service docker start ç™»å½•ï¼šï¼ˆä¸ºäº†æµ‹è¯•ä¸‹èƒ½å¦ç™»å½•æˆåŠŸï¼‰ 12345adminç™»å½•$ docker login 115.159.227.249Username: adminPassword:Login Succeeded æ‰“ tag å¹¶ push 12345678910docker tag ubuntu:15.10 115.159.227.249/library/ubuntu:15.10 //ç»™æˆ‘çš„é•œåƒæ‰“ä¸ª tagdocker push 115.159.227.249/library/ubuntuThe push refers to a repository [115.159.227.249/library/ubuntu]98d59071f692: Pushedaf288f00b8a7: Pushed4b955941a4d0: Pushedf121afdbbd5d: Pushed15.10: digest: sha256:ec89c4a90f45f5e103860191890f48d8379e0504a2881ff706aef0768dc0321b size: 1150 ä¸Šä¼ å®Œæ¯•åï¼Œç™»å½•Web Harborï¼Œé€‰æ‹©é¡¹ç›® libraryï¼Œå°±å¯ä»¥çœ‹åˆ°æˆ‘åˆš push çš„é•œåƒäº†ã€‚ åŒç†ï¼Œä½ ä¹Ÿå¯ä»¥æµ‹è¯•ä¸‹ä» Harbor pull é•œåƒåˆ°ä½ çš„ Docker ä¸­å»ï¼Œè¿™é‡Œå°±ä¸ç»§ç»­æ¼”ç¤ºäº†ã€‚ æœ€åè½¬è½½è¯·æ³¨æ˜åœ°å€ä¸ºï¼šhttp://www.54tianzhisheng.cn/2017/11/26/Docker-harbor/","tags":[{"name":"Docker","slug":"Docker","permalink":"http://www.54tianzhisheng.cn/tags/Docker/"}]},{"title":"è°ˆè°ˆæˆ‘çš„ç†è´¢","date":"2017-11-17T16:00:00.000Z","path":"2017/11/18/Money-management/","text":"èƒŒæ™¯æœ€å¼€å§‹æ¥è§¦ç†è´¢æ˜¯å»å¹´çš„æ—¶å€™ï¼Œåœ¨æˆ‘çš„ä¸€ä¸ªç¾¤é‡Œï¼ˆå‡ ä¸ªå¥½æœ‹å‹ï¼‰ï¼Œæœ‰ä¸ªæœ‹å‹ä»–å¥³æœ‹å‹æ˜¯å­¦é‡‘èçš„ï¼Œå½“æ—¶è¿˜å¼€ç©ç¬‘åœ°è¯´å«å¥¹å¸¦å¸¦æˆ‘ä»¬æ€ä¹ˆä¹°è‚¡ç¥¨ã€åŸºé‡‘ã€é»„é‡‘è¿™äº›ä¸œè¥¿å‘¢ã€‚åæ¥åœ¨ç¾¤é‡Œå¶å°”èŠä¸‹è¿™æ–¹é¢çš„ä¸œè¥¿ï¼ é»„é‡‘é‚£æ—¶æˆ‘ç¬¬æ‰å¼€å§‹æ¥è§¦é»„é‡‘ï¼Œä¹Ÿæ˜¯è‡ªå·±ä¸€ä¸ªäººä¹°äº†ç‚¹æ”¯ä»˜å®é‡Œé¢çš„å­˜é‡‘å®ï¼Œï¼ˆä¸å¤šï¼Œå°±å‡ ç™¾å—ï¼‰ï¼Œåæ¥æ…¢æ…¢çš„åŠ ä»“å’Œå‡ä»“ï¼Œåˆšå¼€å§‹çš„æ—¶å€™ï¼Œå› ä¸ºæ˜¯åˆšä¸Šæ‰‹è¿™äº›ä¸œè¥¿ï¼Œæ¯”è¾ƒå¯¹è¿™æ¯å¤©çš„æ•°å­—å¢é•¿å’Œé™ä½å¾ˆåœ¨æ„ï¼Œä¸€å¤©æ‰“å¼€èš‚èšèšå®çš„æ¬¡æ•°å¾ˆå¤šï¼Œè€æ˜¯çœ‹ç€æ¯å¤©çš„å®æ—¶å‚è€ƒé‡‘ä»·ï¼Œåæ­£å°±æ˜¯å¿ƒç†å„ç§ä¸è¸å®ã€‚å°±æ˜¯é‚£ç§æ‚£å¾—æ‚£å¤±çš„æ„Ÿè§‰ï¼Œå“ˆå“ˆï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“æ€ä¹ˆå½¢å®¹äº†ã€‚ã€‚ã€‚ğŸ˜³ é‚£æ—¶ä¹Ÿä¸æ‡‚ï¼Œè€æ˜¯è¿½æ¶¨ä½æŠ›ï¼Œæ²¡æœ‰æ‰“ç®—é•¿æœŸæŒæœ‰ã€‚é™„å›¾ï¼š ç°åœ¨çœ‹çœ‹è¿™å›¾ï¼Œæƒ³æƒ³è‡ªå·±ä»¥å‰çœŸå‚»ã€‚å¯ä»¥å‘ç°ç°åœ¨å·²ç»æ²¡ä¹°é»„é‡‘äº†ï¼Œå¯¹ï¼Œåœ¨ä»Šå¹´çš„æ—¶å€™ä¸»è¦æ˜¯å…³æ³¨äº›åŸºé‡‘ï¼ åŸºé‡‘é€šè¿‡ä¹°é»„é‡‘ï¼Œå‘ç°ï¼Œé»„é‡‘å¢é•¿ä¸‹è·Œç¡®å®ä¸æ€ä¹ˆé‚£ä¹ˆå°½äººæ„ï¼Œåªèµšäº†ä¸€ç‚¹ç‚¹ã€‚ç„¶åæ…¢æ…¢åœ¨å…³æ³¨ç€åŸºé‡‘ï¼Œå‘ç°æœ‰äº›åŸºé‡‘çš„è¿˜æ˜¯æ”¶å…¥æ•ˆæœè¿˜æ˜¯å¾ˆå¥½çš„ã€‚ ä»€ä¹ˆæ˜¯åŸºé‡‘å‘¢ï¼Ÿ å¥½åƒæœ‰å¾ˆå¤šç§ï¼Œä½†æ˜¯æˆ‘çš„ç†è§£æ˜¯ï¼Œæˆ‘ä»¬æ•£æˆ·æœ‰ç‚¹é—²é’±ï¼Œæ‰“ç®—æŠ•èµ„ï¼Œåˆæ²¡æ—¶é—´å»ä¹°è‚¡ç¥¨ï¼Œä¸€æ˜¯ç¼ºä¹ç»éªŒï¼Œä¸çŸ¥é“ä¹°å“ªæ”¯ï¼Œè€Œæ˜¯æ²¡ç©ºå»æ•´å¤©ç›¯ç€è‚¡ç¥¨çš„èµ°åŠ¿ã€‚è¿™æ—¶å°±å‡ºç°äº†ä¸€ä¸ªå¹³å°ï¼Œæˆ‘ä»¬æ•£æˆ·æŠŠé’±æŠ•ç»™è¿™ä¸ªå¹³å°ï¼Œå¹³å°æœ‰ä¸“ä¸šçš„äººå»è¿›è¡Œä¹°è‚¡ç¥¨ï¼Œå¦‚ä¹°è‚¡ç¥¨æœ‰ç›ˆåˆ©ï¼Œåˆ™å¤§å®¶ä¸€èµ·èµšé’±ï¼Œå¦‚æœäºï¼Œåˆ™ä¸€èµ·äºï¼Œæˆ‘å¯¹åŸºé‡‘å°±æ˜¯è¿™æ ·çš„ç†è§£ï¼Œä¹Ÿä¸çŸ¥é“å¯¹ä¸å¯¹ï¼Ÿ å†è¯´è¯´æˆ‘ç°åœ¨ä¸»è¦ä¹°çš„åŸºé‡‘å§ï¼Œçœ‹çœ‹æ”¶ç›Šå›¾ï¼š å˜¿å˜¿ï¼Œè¿™å‡ ä¸ªæ˜¯æˆ‘è§‚å¯Ÿå¾ˆä¹…äº†ï¼Œå¹¶è§‰å¾—é•¿æœŸçœ‹å¥½çš„åŸºé‡‘äº†ï¼Œå½“ç„¶ä»¥å‰ä¹Ÿä¹°è¿‡ä¸€ä¸¤ä¸ªåŸºé‡‘ï¼Œæœ‰ä¸ªäºå¾—ä¸å°‘ï¼Œæœ‰æ¶¨æœ‰è·Œï¼Œç°åœ¨è§‰å¾—åˆè¦å¹³å¸¸å¿ƒï¼Œå¦‚æœæ˜¯é•¿æœŸçœ‹å¥½çš„ï¼Œæ²¡å¿…è¦çº ç»“è¿™ä¸€ä¸¤å¤©çš„æ¶¨è·Œï¼Œç­‰è¿‡æ®µæ—¶é—´å†æ¥çœ‹çœ‹æ•ˆæœå’‹æ ·ï¼ˆå¿ƒæ€ä¸€å®šè¦å¥½ï¼‰ï¼Œå¦‚æœé‡åˆ°è¢«å¥—çš„è¯ï¼Œæœ‰æ—¶ä¹Ÿéœ€è¦è£…æ­»å¿ƒæ€ï¼Œå“ˆå“ˆï¼å¦å¤–ï¼Œæˆ‘è¿˜è‡ªé€‰äº†ä¸€æ‰¹åŸºé‡‘ï¼Œæ­£åœ¨è§‚å¯Ÿä¸­ï¼Œç­‰æœ‰æ—¶é—´æŠŠè§‰å¾—è¿˜è¡Œçš„ç»™ç»Ÿè®¡ä¸‹ï¼ è‚¡ç¥¨è¿™ä¸ªä¸å¤ªæ‡‚ï¼Œä¸è¿‡ç›®å‰è§‰å¾—æˆ‘è‡ªå·±å…¬å¸çš„è‚¡ç¥¨ä¹Ÿè¿˜ä¸é”™ï¼Œæ‰“ç®—çœ‹ä»€ä¹ˆæ—¶å€™æœ‰æœºä¼šä¹°ç‚¹ï¼Œè¿™ä¸œè¥¿éƒ½æ˜¯é è‡ªå·±æ…¢æ…¢ç ”ç©¶å‡ºæ¥çš„ï¼Œç„¶åå°±æ˜¯çœ‹çœ‹é«˜äººæŒ‡ç‚¹ï¼Œæˆ‘å€’æ˜¯å…³æ³¨äº†ç‚¹å¾®ä¿¡å…¬ä¼—å·è®²è¿™æ–¹é¢çš„çŸ¥è¯†ï¼Œå¾®åšä¹Ÿå…³æ³¨äº†å‡ ä¸ªï¼Œåœ¨èš‚èšè´¢å¯Œé‡Œé¢ä¹Ÿå…³æ³¨äº›ï¼Œè§‰å¾—æœ‰äº›è¿˜æ˜¯å¾ˆé è°±çš„ï¼Œè¿˜æ˜¯ä¸€æ ·ï¼Œæœ‰æ—¶é—´ç»§ç»­åšä¸ªç»Ÿè®¡ï¼Œç„¶åå‘åœ¨æˆ‘çš„å°å¯†åœˆé‡Œé¢ã€‚ å‹é‡‘æ‰€æŠ•äº†è¿™ä¸ªæ˜¯å› ä¸ºè¿› stormzhang çš„å°å¯†åœˆï¼Œé€šè¿‡æ³¨å†Œå¹¶æŠ•èµ„ç‚¹å¯ä»¥å…è´¹è¿›ä»–çš„å°å¯†åœˆï¼Œä¸ç„¶å¾—èŠ± 199 å…ƒï¼Œè¿™ç®—å¾ˆä¼˜æƒ äº†ã€‚å› ä¸ºæ˜¯æ–°ç”¨æˆ·ï¼Œæ‰€ä»¥è¿™ä¸ªæ”¶ç›Šå¾ˆé«˜ï¼Œä¸€ä¸ªæœˆæœŸé™ï¼Œ12% çš„æ”¶ç›Šï¼ ä½™é¢å®æ”¯ä»˜å®é‡Œçš„ï¼Œå¹³å¸¸é’±ä¹Ÿä¸€èˆ¬æ”¾è¿™é‡Œé¢ï¼Œå› ä¸ºå¹³æ—¶ç”¨æ”¯ä»˜å®æ¯”è¾ƒå¤šï¼Œæ”¾è¿™é‡Œï¼Œå¯ä»¥ä»˜æ¬¾çš„æ—¶å€™é€‰æ‹©ç›´æ¥ä½™é¢å®æ”¯ä»˜ï¼Œå¦å¤–è¿˜æœ‰å·®ä¸å¤š 4% çš„æ”¶ç›Šï¼Œå¯ä»¥éšæ—¶å­˜å–ï¼Œæ¯”è¾ƒæ–¹ä¾¿ï¼ æœ€åæœ‰æ—¶é—´å°†ä¸Šé¢æ‰€è¯´çš„ï¼šè‡ªé€‰åŸºé‡‘åˆ—è¡¨ã€å¾®ä¿¡å…¬ä¼—å·ã€å¾®åšè¿™å‡ ä¸ªåˆ—è¡¨å‘åœ¨æˆ‘çš„å°å¯†åœˆé‡Œã€‚ æœ€é‡è¦çš„è¯è¿˜æ˜¯å¾—è¯´ä¸‰éï¼š æŠ•èµ„æœ‰é£é™©ï¼Œéœ€è°¨æ…ï¼ æŠ•èµ„æœ‰é£é™©ï¼Œéœ€è°¨æ…ï¼ æŠ•èµ„æœ‰é£é™©ï¼Œéœ€è°¨æ…ï¼","tags":[{"name":"æŠ•èµ„ç†è´¢","slug":"æŠ•èµ„ç†è´¢","permalink":"http://www.54tianzhisheng.cn/tags/æŠ•èµ„ç†è´¢/"}]},{"title":"åŸºäºåˆ†å¸ƒå¼ç¯å¢ƒä¸‹é™æµç³»ç»Ÿçš„è®¾è®¡","date":"2017-11-17T16:00:00.000Z","path":"2017/11/18/flow-control/","text":"å‰æä¸šåŠ¡èƒŒæ™¯å°±æ‹¿å‰äº›å¤©çš„åŒåä¸€çš„ â€œæŠ¢åˆ¸æ´»åŠ¨â€ æ¥è¯´ï¼Œä¸€èˆ¬æ˜¯è®¾ç½®æ•´ç‚¹å¼€å§‹æŠ¢çš„ï¼Œä½ æƒ³æƒ³ï¼Œæ·˜å®çš„ç”¨æˆ·ç¾¤ä½“éå¸¸å¤§ï¼Œå¯ä»¥è¾¾åˆ°äº¿çº§åˆ«ï¼Œè€ŒæœåŠ¡æ¥å£æ¯ç§’èƒ½å¤„ç†çš„é‡æ˜¯æœ‰é™çš„ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™é—®é¢˜å°±ä¼šå‡ºç°ï¼Œæˆ‘ä»¬å¦‚ä½•é€šè¿‡ç¨‹åºæ¥æ§åˆ¶ç”¨æˆ·æŠ¢åˆ¸å‘¢ï¼Œäºæ˜¯å°±å¿…é¡»åŠ ä¸Šè¿™ä¸ªé™æµåŠŸèƒ½äº†ã€‚ ç”Ÿäº§ç¯å¢ƒ1ã€æœåŠ¡æ¥å£æ‰€èƒ½æä¾›çš„æœåŠ¡ä¸Šé™ï¼ˆlimitï¼‰å‡å¦‚æ˜¯ 500æ¬¡/s 2ã€ç”¨æˆ·è¯·æ±‚æ¥å£çš„æ¬¡æ•°æœªçŸ¥ï¼ŒQPSå¯èƒ½è¾¾åˆ° 800æ¬¡/sï¼Œ1000æ¬¡/sï¼Œæˆ–è€…æ›´é«˜ 3ã€å½“æœåŠ¡æ¥å£çš„è®¿é—®é¢‘ç‡è¶…è¿‡ 500æ¬¡/sï¼Œè¶…è¿‡çš„é‡å°†æ‹’ç»æœåŠ¡ï¼Œå¤šå‡ºçš„ä¿¡æ¯å°†ä¼šä¸¢å¤± 4ã€çº¿ä¸Šç¯å¢ƒæ˜¯å¤šèŠ‚ç‚¹éƒ¨ç½²çš„ï¼Œä½†æ˜¯è°ƒç”¨çš„æ˜¯åŒä¸€ä¸ªæœåŠ¡æ¥å£ äºæ˜¯ï¼Œä¸ºäº†ä¿è¯æœåŠ¡çš„å¯ç”¨æ€§ï¼Œå°±è¦å¯¹æœåŠ¡æ¥å£è°ƒç”¨çš„é€Ÿç‡è¿›è¡Œé™åˆ¶ï¼ˆæ¥å£é™æµï¼‰ã€‚ ä»€ä¹ˆæ˜¯é™æµï¼Ÿé™æµæ˜¯å¯¹ç³»ç»Ÿçš„å‡ºå…¥æµé‡è¿›è¡Œæ§åˆ¶ï¼Œé˜²æ­¢å¤§æµé‡å‡ºå…¥ï¼Œå¯¼è‡´èµ„æºä¸è¶³ï¼Œç³»ç»Ÿä¸ç¨³å®šã€‚ é™æµç³»ç»Ÿæ˜¯å¯¹èµ„æºè®¿é—®çš„æ§åˆ¶ç»„ä»¶ï¼Œæ§åˆ¶ä¸»è¦çš„ä¸¤ä¸ªåŠŸèƒ½ï¼šé™æµç­–ç•¥å’Œç†”æ–­ç­–ç•¥ï¼Œå¯¹äºç†”æ–­ç­–ç•¥ï¼Œä¸åŒçš„ç³»ç»Ÿæœ‰ä¸åŒçš„ç†”æ–­ç­–ç•¥è¯‰æ±‚ï¼Œæœ‰çš„ç³»ç»Ÿå¸Œæœ›ç›´æ¥æ‹’ç»ã€æœ‰çš„ç³»ç»Ÿå¸Œæœ›æ’é˜Ÿç­‰å¾…ã€æœ‰çš„ç³»ç»Ÿå¸Œæœ›æœåŠ¡é™çº§ã€æœ‰çš„ç³»ç»Ÿä¼šå®šåˆ¶è‡ªå·±çš„ç†”æ–­ç­–ç•¥ï¼Œè¿™é‡Œåªé’ˆå¯¹é™æµç­–ç•¥è¿™ä¸ªåŠŸèƒ½åšè¯¦ç»†çš„è®¾è®¡ã€‚ é™æµç®—æ³•1ã€é™åˆ¶ç¬æ—¶å¹¶å‘æ•°Guava RateLimiter æä¾›äº†ä»¤ç‰Œæ¡¶ç®—æ³•å®ç°ï¼šå¹³æ»‘çªå‘é™æµ(SmoothBursty)å’Œå¹³æ»‘é¢„çƒ­é™æµ(SmoothWarmingUp)å®ç°ã€‚ 2ã€é™åˆ¶æŸä¸ªæ¥å£çš„æ—¶é—´çª—æœ€å¤§è¯·æ±‚æ•°å³ä¸€ä¸ªæ—¶é—´çª—å£å†…çš„è¯·æ±‚æ•°ï¼Œå¦‚æƒ³é™åˆ¶æŸä¸ªæ¥å£/æœåŠ¡æ¯ç§’/æ¯åˆ†é’Ÿ/æ¯å¤©çš„è¯·æ±‚æ•°/è°ƒç”¨é‡ã€‚å¦‚ä¸€äº›åŸºç¡€æœåŠ¡ä¼šè¢«å¾ˆå¤šå…¶ä»–ç³»ç»Ÿè°ƒç”¨ï¼Œæ¯”å¦‚å•†å“è¯¦æƒ…é¡µæœåŠ¡ä¼šè°ƒç”¨åŸºç¡€å•†å“æœåŠ¡è°ƒç”¨ï¼Œä½†æ˜¯æ€•å› ä¸ºæ›´æ–°é‡æ¯”è¾ƒå¤§å°†åŸºç¡€æœåŠ¡æ‰“æŒ‚ï¼Œè¿™æ—¶æˆ‘ä»¬è¦å¯¹æ¯ç§’/æ¯åˆ†é’Ÿçš„è°ƒç”¨é‡è¿›è¡Œé™é€Ÿï¼›ä¸€ç§å®ç°æ–¹å¼å¦‚ä¸‹æ‰€ç¤ºï¼š 12345678910111213141516171819LoadingCache&lt;Long, AtomicLong&gt; counter = CacheBuilder.newBuilder() .expireAfterWrite(2, TimeUnit.SECONDS) .build(new CacheLoader&lt;Long, AtomicLong&gt;() &#123; @Override public AtomicLong load(Long seconds) throws Exception &#123; return new AtomicLong(0); &#125; &#125;);long limit = 1000;while(true) &#123; //å¾—åˆ°å½“å‰ç§’ long currentSeconds = System.currentTimeMillis() / 1000; if(counter.get(currentSeconds).incrementAndGet() &gt; limit) &#123; System.out.println(\"é™æµäº†:\" + currentSeconds); continue; &#125; //ä¸šåŠ¡å¤„ç†&#125; ä½¿ç”¨Guavaçš„Cacheæ¥å­˜å‚¨è®¡æ•°å™¨ï¼Œè¿‡æœŸæ—¶é—´è®¾ç½®ä¸º2ç§’ï¼ˆä¿è¯1ç§’å†…çš„è®¡æ•°å™¨æ˜¯æœ‰çš„ï¼‰ï¼Œç„¶åæˆ‘ä»¬è·å–å½“å‰æ—¶é—´æˆ³ç„¶åå–ç§’æ•°æ¥ä½œä¸ºKEYè¿›è¡Œè®¡æ•°ç»Ÿè®¡å’Œé™æµï¼Œè¿™ç§æ–¹å¼ä¹Ÿæ˜¯ç®€å•ç²—æš´ï¼Œåˆšæ‰è¯´çš„åœºæ™¯å¤Ÿç”¨äº†ã€‚ 3ã€ä»¤ç‰Œæ¡¶ ç®—æ³•æè¿°ï¼š å‡å¦‚ç”¨æˆ·é…ç½®çš„å¹³å‡å‘é€é€Ÿç‡ä¸ºrï¼Œåˆ™æ¯éš”1/rç§’ä¸€ä¸ªä»¤ç‰Œè¢«åŠ å…¥åˆ°æ¡¶ä¸­ å‡è®¾æ¡¶ä¸­æœ€å¤šå¯ä»¥å­˜æ”¾bä¸ªä»¤ç‰Œã€‚å¦‚æœä»¤ç‰Œåˆ°è¾¾æ—¶ä»¤ç‰Œæ¡¶å·²ç»æ»¡äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªä»¤ç‰Œä¼šè¢«ä¸¢å¼ƒ å½“æµé‡ä»¥é€Ÿç‡vè¿›å…¥ï¼Œä»æ¡¶ä¸­ä»¥é€Ÿç‡vå–ä»¤ç‰Œï¼Œæ‹¿åˆ°ä»¤ç‰Œçš„æµé‡é€šè¿‡ï¼Œæ‹¿ä¸åˆ°ä»¤ç‰Œæµé‡ä¸é€šè¿‡ï¼Œæ‰§è¡Œç†”æ–­é€»è¾‘ å±æ€§ é•¿æœŸæ¥çœ‹ï¼Œç¬¦åˆæµé‡çš„é€Ÿç‡æ˜¯å—åˆ°ä»¤ç‰Œæ·»åŠ é€Ÿç‡çš„å½±å“ï¼Œè¢«ç¨³å®šä¸ºï¼šr å› ä¸ºä»¤ç‰Œæ¡¶æœ‰ä¸€å®šçš„å­˜å‚¨é‡ï¼Œå¯ä»¥æŠµæŒ¡ä¸€å®šçš„æµé‡çªå‘æƒ…å†µ Mæ˜¯ä»¥å­—èŠ‚/ç§’ä¸ºå•ä½çš„æœ€å¤§å¯èƒ½ä¼ è¾“é€Ÿç‡ã€‚ M&gt;r T max = b/(M-r) æ‰¿å—æœ€å¤§ä¼ è¾“é€Ÿç‡çš„æ—¶é—´ B max = T max * M æ‰¿å—æœ€å¤§ä¼ è¾“é€Ÿç‡çš„æ—¶é—´å†…ä¼ è¾“çš„æµé‡ ä¼˜ç‚¹ï¼šæµé‡æ¯”è¾ƒå¹³æ»‘ï¼Œå¹¶ä¸”å¯ä»¥æŠµæŒ¡ä¸€å®šçš„æµé‡çªå‘æƒ…å†µ 4ã€Google guava æä¾›çš„å·¥å…·åº“ä¸­ RateLimiter ç±»ï¼ˆå†…éƒ¨ä¹Ÿæ˜¯é‡‡ç”¨ä»¤ç‰Œæ¡¶ç®—æ³•å®ç°ï¼‰æœ€å¿«çš„æ–¹å¼æ˜¯ä½¿ç”¨ RateLimit ç±»ï¼Œä½†æ˜¯è¿™ä»…é™åˆ¶åœ¨å•èŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„ QPS æ˜¯ä¸€æ ·çš„ï¼Œè¯·æ±‚é‡åˆ°æœåŠ¡æ¥å£é‚£çš„è¯å°±æ˜¯ QPS * èŠ‚ç‚¹æ•° äº†ã€‚æ‰€ä»¥è¿™ç§æ–¹æ¡ˆåœ¨åˆ†å¸ƒå¼çš„æƒ…å†µä¸‹ä¸é€‚ç”¨ï¼ 5ã€åŸºäº Redis å®ç°ï¼Œå­˜å‚¨ä¸¤ä¸ª keyï¼Œä¸€ä¸ªç”¨äºè®¡æ—¶ï¼Œä¸€ä¸ªç”¨äºè®¡æ•°ã€‚è¯·æ±‚æ¯è°ƒç”¨ä¸€æ¬¡ï¼Œè®¡æ•°å™¨å¢åŠ  1ï¼Œè‹¥åœ¨è®¡æ—¶å™¨æ—¶é—´å†…è®¡æ•°å™¨æœªè¶…è¿‡é˜ˆå€¼ï¼Œåˆ™å¯ä»¥å¤„ç†ä»»åŠ¡ã€‚è¿™ç§èƒ½å¤Ÿå¾ˆå¥½åœ°è§£å†³äº†åˆ†å¸ƒå¼ç¯å¢ƒä¸‹å¤šå®ä¾‹æ‰€å¯¼è‡´çš„å¹¶å‘é—®é¢˜ã€‚å› ä¸ºä½¿ç”¨redisè®¾ç½®çš„è®¡æ—¶å™¨å’Œè®¡æ•°å™¨å‡æ˜¯å…¨å±€å”¯ä¸€çš„ï¼Œä¸ç®¡å¤šå°‘ä¸ªèŠ‚ç‚¹ï¼Œå®ƒä»¬ä½¿ç”¨çš„éƒ½æ˜¯åŒæ ·çš„è®¡æ—¶å™¨å’Œè®¡æ•°å™¨ï¼Œå› æ­¤å¯ä»¥åšåˆ°éå¸¸ç²¾å‡†çš„æµæ§ã€‚ ä»£ç å°±ä¸å…¬å¸ƒäº†ï¼Œæ¯•ç«Ÿæ¶‰åŠå…¬å¸éšç§äº†ã€‚ æœ€åå‚è€ƒæ–‡ç« ï¼š åŸºäºRedisçš„é™æµç³»ç»Ÿçš„è®¾è®¡ æ„Ÿå…´è¶£çš„å¯ä»¥çœ‹çœ‹åˆ«äººçš„ä»£ç æ˜¯æ€ä¹ˆå†™çš„ï¼šhttps://github.com/wukq/rate-limiter è½¬è½½è¯·æ³¨æ˜æ–‡ç« åœ°å€ä¸ºï¼šhttp://www.54tianzhisheng.cn/2017/11/18/flow-control/","tags":[{"name":"Redis","slug":"Redis","permalink":"http://www.54tianzhisheng.cn/tags/Redis/"},{"name":"æµæ§","slug":"æµæ§","permalink":"http://www.54tianzhisheng.cn/tags/æµæ§/"}]},{"title":"Maven ä¸­ dependencies ä¸ dependencyManagement çš„åŒºåˆ«","date":"2017-11-10T16:00:00.000Z","path":"2017/11/11/Maven-dependencies-dependencyManagement/","text":"å‰æè¿™æ®µæ—¶é—´é¡¹ç›®ä¸­é‡åˆ°è¿‡äº†ä¸€äº› Jar åŒ…å†²çªçš„é—®é¢˜ï¼Œå¾ˆå¤šæ˜¯ç”±äºæˆ‘ä»¬é¡¹ç›®æ¨¡å—å¾ˆå¤šçš„æ—¶å€™ï¼Œç”¨ Maven ç®¡ç†ä¸å½“å¯¼è‡´çš„å†²çªé—®é¢˜ï¼Œæœ¬æ–‡å°±è¿™ä¸ªé—®é¢˜å‚è€ƒç½‘ä¸Šçš„èµ„æ–™ï¼Œäºæ˜¯æ€»ç»“ä¸‹ Maven ä¸­ dependencies ä¸ dependencyManagement çš„åŒºåˆ«ã€‚ å‡è®¾é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š parent ä¸ºçˆ¶æ¨¡å—ï¼ŒæŠ½è±¡å‡ºæ¥ç®¡ç†å­é¡¹ç›®çš„å…¬å…±ä¾èµ–ï¼Œä¸ºäº†é¡¹ç›®çš„æ­£ç¡®è¿è¡Œï¼Œå¿…é¡»è®©æ‰€æœ‰çš„å­é¡¹ç›®ä½¿ç”¨ä¾èµ–é¡¹çš„ç»Ÿä¸€ç‰ˆæœ¬ï¼Œå¿…é¡»ç¡®ä¿åº”ç”¨çš„å„ä¸ªé¡¹ç›®çš„ä¾èµ–é¡¹å’Œç‰ˆæœ¬ä¸€è‡´ï¼Œæ‰èƒ½ä¿è¯æµ‹è¯•çš„å’Œå‘å¸ƒçš„æ˜¯ç›¸åŒçš„ç»“æœã€‚ dependencyManagementåœ¨é¡¹ç›®çš„ parent å±‚ï¼Œå¯ä»¥é€šè¿‡ dependencyManagement å…ƒç´ æ¥ç®¡ç† jar åŒ…çš„ç‰ˆæœ¬ï¼Œè®©å­é¡¹ç›®ä¸­å¼•ç”¨ä¸€ä¸ªä¾èµ–è€Œä¸ç”¨æ˜¾ç¤ºçš„åˆ—å‡ºç‰ˆæœ¬å·ã€‚ parent ä¸­ pom.xml 123456789101112131415161718&lt;properties&gt; &lt;version.framework&gt;1.0-SNAPSHOT&lt;/version.framework&gt; &lt;javaee-api.version&gt;1.0-SNAPSHOT&lt;/javaee-api.version&gt;&lt;/properties&gt;&lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;com.zhisheng&lt;/groupId&gt; &lt;artifactId&gt;framework-cache&lt;/artifactId&gt; &lt;version&gt;$&#123;version.framework&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;javax&lt;/groupId&gt; &lt;artifactId&gt;javaee-api&lt;/artifactId&gt; &lt;version&gt;$&#123;javaee-api.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt;&lt;/dependencyManagement&gt; extendion ä¸­çš„ pom.xml 123456789101112131415161718192021&lt;parent&gt; &lt;artifactId&gt;parent&lt;/artifactId&gt; &lt;groupId&gt;com.zhisheng&lt;/groupId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;relativePath&gt;../parent/pom.xml&lt;/relativePath&gt;&lt;/parent&gt;&lt;!--ä¾èµ–å…³ç³»--&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;javax&lt;/groupId&gt; &lt;artifactId&gt;javaee-api&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.zhisheng&lt;/groupId&gt; &lt;artifactId&gt;framework-cache&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt; &lt;artifactId&gt;jackson-annotations&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; è¿™æ ·åšçš„å¥½å¤„ï¼šç»Ÿä¸€ç®¡ç†é¡¹ç›®çš„ç‰ˆæœ¬å·ï¼Œç¡®ä¿åº”ç”¨çš„å„ä¸ªé¡¹ç›®çš„ä¾èµ–å’Œç‰ˆæœ¬ä¸€è‡´ï¼Œæ‰èƒ½ä¿è¯æµ‹è¯•çš„å’Œå‘å¸ƒçš„æ˜¯ç›¸åŒçš„æˆæœï¼Œå› æ­¤ï¼Œåœ¨é¡¶å±‚ pom ä¸­å®šä¹‰å…±åŒçš„ä¾èµ–å…³ç³»ã€‚åŒæ—¶å¯ä»¥é¿å…åœ¨æ¯ä¸ªä½¿ç”¨çš„å­é¡¹ç›®ä¸­éƒ½å£°æ˜ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œè¿™æ ·æƒ³å‡çº§æˆ–è€…åˆ‡æ¢åˆ°å¦ä¸€ä¸ªç‰ˆæœ¬æ—¶ï¼Œåªéœ€è¦åœ¨çˆ¶ç±»å®¹å™¨é‡Œæ›´æ–°ï¼Œä¸éœ€è¦ä»»ä½•ä¸€ä¸ªå­é¡¹ç›®çš„ä¿®æ”¹ï¼›å¦‚æœæŸä¸ªå­é¡¹ç›®éœ€è¦å¦å¤–ä¸€ä¸ªç‰ˆæœ¬å·æ—¶ï¼Œåªéœ€è¦åœ¨ dependencies ä¸­å£°æ˜ä¸€ä¸ªç‰ˆæœ¬å·å³å¯ã€‚å­ç±»å°±ä¼šä½¿ç”¨å­ç±»å£°æ˜çš„ç‰ˆæœ¬å·ï¼Œä¸ç»§æ‰¿äºçˆ¶ç±»ç‰ˆæœ¬å·ã€‚ æˆ‘ä»¬çŸ¥é“ Maven çš„ç»§æ‰¿å’Œ Java çš„ç»§æ‰¿ä¸€æ ·ï¼Œæ˜¯æ— æ³•å®ç°å¤šé‡ç»§æ‰¿çš„ï¼Œå¦‚æœ10ä¸ªã€20ä¸ªç”šè‡³æ›´å¤šæ¨¡å—ç»§æ‰¿è‡ªåŒä¸€ä¸ªæ¨¡å—ï¼Œé‚£ä¹ˆæŒ‰ç…§æˆ‘ä»¬ä¹‹å‰çš„åšæ³•ï¼Œè¿™ä¸ªçˆ¶æ¨¡å—çš„ dependencyManagement ä¼šåŒ…å«å¤§é‡çš„ä¾èµ–ã€‚å¦‚æœä½ æƒ³æŠŠè¿™äº›ä¾èµ–åˆ†ç±»ä»¥æ›´æ¸…æ™°çš„ç®¡ç†ï¼Œé‚£å°±ä¸å¯èƒ½äº†ï¼Œimport scope ä¾èµ–èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ä½ å¯ä»¥æŠŠ dependencyManagement æ”¾åˆ°å•ç‹¬çš„ä¸“é—¨ç”¨æ¥ç®¡ç†ä¾èµ–çš„ POM ä¸­ï¼Œç„¶ååœ¨éœ€è¦ä½¿ç”¨ä¾èµ–çš„æ¨¡å—ä¸­é€šè¿‡ import scope ä¾èµ–ï¼Œå°±å¯ä»¥å¼•å…¥dependencyManagementã€‚ä¾‹å¦‚å¯ä»¥å†™è¿™æ ·ä¸€ä¸ªç”¨äºä¾èµ–ç®¡ç†çš„ POMï¼š 12345678910111213141516171819202122&lt;project&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;com.zhisheng.sample&lt;/groupId&gt; &lt;artifactId&gt;sample-dependency-infrastructure&lt;/artifactId&gt; &lt;packaging&gt;pom&lt;/packaging&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactid&gt;junit&lt;/artifactId&gt; &lt;version&gt;4.8.2&lt;/version&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;log4j&lt;/groupId&gt; &lt;artifactid&gt;log4j&lt;/artifactId&gt; &lt;version&gt;1.2.16&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt;&lt;/project&gt; ç„¶åå°±å¯ä»¥é€šè¿‡éç»§æ‰¿çš„æ–¹å¼æ¥å¼•å…¥è¿™æ®µä¾èµ–ç®¡ç†é…ç½®ï¼š 1234567891011121314151617181920&lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;com.zhisheng.sample&lt;/groupId&gt; &lt;artifactid&gt;sample-dependency-infrastructure&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; &lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactid&gt;junit&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;log4j&lt;/groupId&gt; &lt;artifactid&gt;log4j&lt;/artifactId&gt; &lt;/dependency&gt; è¿™æ ·ï¼Œçˆ¶æ¨¡å—çš„ POM å°±ä¼šéå¸¸å¹²å‡€ï¼Œç”±ä¸“é—¨çš„ packaging ä¸º pom çš„ POM æ¥ç®¡ç†ä¾èµ–ï¼Œä¹Ÿå¥‘åˆçš„é¢å‘å¯¹è±¡è®¾è®¡ä¸­çš„å•ä¸€èŒè´£åŸåˆ™ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜èƒ½å¤Ÿåˆ›å»ºå¤šä¸ªè¿™æ ·çš„ä¾èµ–ç®¡ç† POMï¼Œä»¥æ›´ç»†åŒ–çš„æ–¹å¼ç®¡ç†ä¾èµ–ã€‚è¿™ç§åšæ³•ä¸é¢å‘å¯¹è±¡è®¾è®¡ä¸­ä½¿ç”¨ç»„åˆè€Œéç»§æ‰¿ä¹Ÿæœ‰ç‚¹ç›¸ä¼¼çš„å‘³é“ã€‚ dependenciesç›¸å¯¹äº dependencyManagementï¼Œæ‰€æœ‰å£°æ˜åœ¨çˆ¶é¡¹ç›®ä¸­ dependencies é‡Œçš„ä¾èµ–éƒ½ä¼šè¢«å­é¡¹ç›®è‡ªåŠ¨å¼•å…¥ï¼Œå¹¶é»˜è®¤è¢«æ‰€æœ‰çš„å­é¡¹ç›®ç»§æ‰¿ã€‚ åŒºåˆ« dependencies å³ä½¿åœ¨å­é¡¹ç›®ä¸­ä¸å†™è¯¥ä¾èµ–é¡¹ï¼Œé‚£ä¹ˆå­é¡¹ç›®ä»ç„¶ä¼šä»çˆ¶é¡¹ç›®ä¸­ç»§æ‰¿è¯¥ä¾èµ–é¡¹ï¼ˆå…¨éƒ¨ç»§æ‰¿ï¼‰ dependencyManagement é‡Œåªæ˜¯å£°æ˜ä¾èµ–ï¼Œå¹¶ä¸å®ç°å¼•å…¥ï¼Œå› æ­¤å­é¡¹ç›®éœ€è¦æ˜¾ç¤ºçš„å£°æ˜éœ€è¦ç”¨çš„ä¾èµ–ã€‚å¦‚æœä¸åœ¨å­é¡¹ç›®ä¸­å£°æ˜ä¾èµ–ï¼Œæ˜¯ä¸ä¼šä»çˆ¶é¡¹ç›®ä¸­ç»§æ‰¿ä¸‹æ¥çš„ï¼›åªæœ‰åœ¨å­é¡¹ç›®ä¸­å†™äº†è¯¥ä¾èµ–é¡¹ï¼Œå¹¶ä¸”æ²¡æœ‰æŒ‡å®šå…·ä½“ç‰ˆæœ¬ï¼Œæ‰ä¼šä»çˆ¶é¡¹ç›®ä¸­ç»§æ‰¿è¯¥é¡¹ï¼Œå¹¶ä¸” version å’Œ scope éƒ½è¯»å–è‡ªçˆ¶ pom; å¦å¤–å¦‚æœå­é¡¹ç›®ä¸­æŒ‡å®šäº†ç‰ˆæœ¬å·ï¼Œé‚£ä¹ˆä¼šä½¿ç”¨å­é¡¹ç›®ä¸­æŒ‡å®šçš„jarç‰ˆæœ¬ã€‚ æ¶ˆé™¤å¤šæ¨¡å—æ’ä»¶é…ç½®é‡å¤ä¸ dependencyManagement ç±»ä¼¼çš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ pluginManagement å…ƒç´ ç®¡ç†æ’ä»¶ã€‚ä¸€ä¸ªå¸¸è§çš„ç”¨æ³•å°±æ˜¯æˆ‘ä»¬å¸Œæœ›é¡¹ç›®æ‰€æœ‰æ¨¡å—çš„ä½¿ç”¨ Maven Compiler Plugin çš„æ—¶å€™ï¼Œéƒ½ä½¿ç”¨ Java 1.8ï¼Œä»¥åŠæŒ‡å®š Java æºæ–‡ä»¶ç¼–ç ä¸º UTF-8ï¼Œè¿™æ—¶å¯ä»¥åœ¨çˆ¶æ¨¡å—çš„ POM ä¸­å¦‚ä¸‹é…ç½® pluginManagementï¼š 12345678910111213141516&lt;build&gt; &lt;pluginManagement&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt; &lt;version&gt;2.5.1&lt;/version&gt; &lt;configuration&gt; &lt;source&gt;1.8&lt;/source&gt; &lt;target&gt;1.8&lt;/target&gt; &lt;encoding&gt;UTF-8&lt;/encoding&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/pluginManagement&gt;&lt;/build&gt; è¿™æ®µé…ç½®ä¼šè¢«åº”ç”¨åˆ°æ‰€æœ‰å­æ¨¡å—çš„ maven-compiler-plugin ä¸­ï¼Œç”±äº Maven å†…ç½®äº† maven-compiler-plugin ä¸ç”Ÿå‘½å‘¨æœŸçš„ç»‘å®šï¼Œå› æ­¤å­æ¨¡å—å°±ä¸å†éœ€è¦ä»»ä½• maven-compiler-plugin çš„é…ç½®äº†ã€‚ ä¸ä¾èµ–é…ç½®ä¸åŒçš„æ˜¯ï¼Œé€šå¸¸æ‰€æœ‰é¡¹ç›®å¯¹äºä»»æ„ä¸€ä¸ªä¾èµ–çš„é…ç½®éƒ½åº”è¯¥æ˜¯ç»Ÿä¸€çš„ï¼Œä½†æ’ä»¶å´ä¸æ˜¯è¿™æ ·ï¼Œä¾‹å¦‚ä½ å¯ä»¥å¸Œæœ›æ¨¡å— A è¿è¡Œæ‰€æœ‰å•å…ƒæµ‹è¯•ï¼Œæ¨¡å— B è¦è·³è¿‡ä¸€äº›æµ‹è¯•ï¼Œè¿™æ—¶å°±éœ€è¦é…ç½® maven-surefire-plugin æ¥å®ç°ï¼Œé‚£æ ·ä¸¤ä¸ªæ¨¡å—çš„æ’ä»¶é…ç½®å°±ä¸ä¸€è‡´äº†ã€‚è¿™ä¹Ÿå°±æ˜¯è¯´ï¼Œç®€å•çš„æŠŠæ’ä»¶é…ç½®æå–åˆ°çˆ¶ POM çš„ pluginManagement ä¸­å¾€å¾€ä¸é€‚åˆæ‰€æœ‰æƒ…å†µï¼Œé‚£æˆ‘ä»¬åœ¨ä½¿ç”¨çš„æ—¶å€™å°±éœ€è¦æ³¨æ„äº†ï¼Œåªæœ‰é‚£äº›æ™®é€‚çš„æ’ä»¶é…ç½®æ‰åº”è¯¥ä½¿ç”¨ pluginManagement æå–åˆ°çˆ¶ POM ä¸­ã€‚ å…³äºæ’ä»¶ pluginManagementï¼ŒMaven å¹¶æ²¡æœ‰æä¾›ä¸ import scope ä¾èµ–ç±»ä¼¼çš„æ–¹å¼ç®¡ç†ï¼Œé‚£æˆ‘ä»¬åªèƒ½å€ŸåŠ©ç»§æ‰¿å…³ç³»ï¼Œä¸è¿‡å¥½åœ¨ä¸€èˆ¬æ¥è¯´æ’ä»¶é…ç½®çš„æ•°é‡è¿œæ²¡æœ‰ä¾èµ–é…ç½®é‚£ä¹ˆå¤šï¼Œå› æ­¤è¿™ä¹Ÿä¸æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚ æœ€åä½ çœ‹åˆ°çš„åªæ˜¯å†°å±±ä¸€è§’ï¼Œæ›´å¤šè¯·çœ‹ä¹¦ç±ã€ŠMaven å®æˆ˜ã€‹ ã€‚ è½¬è½½è¯·æ³¨æ˜åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2017/11/11/Maven-dependencies-dependencyManagement/","tags":[{"name":"Maven","slug":"Maven","permalink":"http://www.54tianzhisheng.cn/tags/Maven/"}]},{"title":"é€ä½ ä¸€ä»½åŒåä¸€å‰æ‰‹ä¹¦å•ã€å¢™è£‚æ¨èã€‘","date":"2017-11-10T16:00:00.000Z","path":"2017/11/11/recommended-books/","text":"æ˜¨æ™šå’Œæœ‹å‹èŠå¤©è¯´åŒåä¸€éƒ½ä¹°å•¥ï¼Œç»“æœ TMD ç«Ÿç„¶éƒ½æ˜¯ä¹¦ç±ï¼Œä¸æ„§æ˜¯æ ‡å‡†çš„ç¨‹åºçŒ¿ã€‚æ‰€ä»¥è¿™é‡Œæƒ³æ¨èåŸºä½¬çš„ä¸€ä»½ä¹¦å•ï¼Œæ–¹ä¾¿å¤§å®¶åœ¨åŒåä¸€å‰å‰å‰ï¼Œå»ºè®®å…ˆæ”¶è—æœ¬ä¹¦å•ï¼Œè®¤çœŸå•ƒå®Œä¸€æœ¬å†ä¹°ä¸‹ä¸€æœ¬ï¼Œæ‰å®èµ°å®Œæ¯ä¸€æ­¥ï¼Œå¸Œæœ›ä¹¦å•èƒ½åœ¨ä½ æƒ³è¦è¿›ä¸€æ­¥æ‰“æ€ªå‡çº§çš„è·¯ä¸Šï¼Œç»™äºˆäº›è®¸å¸®åŠ©ï¼ ä¹¦ç±åˆ—è¡¨ã€ŠEffective Java ä¸­æ–‡ç‰ˆã€‹ è±†ç“£è¯„åˆ†ï¼š9.1ã€1235 äººè¯„ä»·ã€‘ æ¨èç†ç”±ï¼šæœ¬ä¹¦ä»‹ç»äº†åœ¨Javaç¼–ç¨‹ä¸­78æ¡æå…·å®ç”¨ä»·å€¼çš„ç»éªŒè§„åˆ™ï¼Œè¿™äº›ç»éªŒè§„åˆ™æ¶µç›–äº†å¤§å¤šæ•°å¼€å‘äººå‘˜æ¯å¤©æ‰€é¢ä¸´çš„é—®é¢˜çš„è§£å†³æ–¹æ¡ˆã€‚ å‹æƒ…æç¤ºï¼šåŒæ¨èã€Šé‡æ„ : æ”¹å–„æ—¢æœ‰ä»£ç çš„è®¾è®¡ã€‹ã€ã€Šä»£ç æ•´æ´ä¹‹é“ã€‹ã€ã€Šä»£ç å¤§å…¨ã€‹ï¼Œæœ‰ä¸€å®šçš„å†…å®¹é‡å ã€‚ ã€ŠJavaæ€§èƒ½æƒå¨æŒ‡å—ã€‹ è±†ç“£è¯„åˆ†ï¼š8.2ã€44 äººè¯„ä»·ã€‘ æ¨èç†ç”±ï¼šå¸‚é¢ä¸Šä»‹ç»Javaçš„ä¹¦æœ‰å¾ˆå¤šï¼Œä½†ä¸“æ³¨äºJavaæ€§èƒ½çš„å¹¶ä¸å¤šï¼Œèƒ½æ¸¸åˆƒæœ‰ä½™åœ°å±•ç¤ºJavaæ€§èƒ½ä¼˜åŒ–éš¾ç‚¹çš„æ›´æ˜¯å‡¤æ¯›éºŸè§’ï¼Œæœ¬ä¹¦å³æ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚é€šè¿‡ä½¿ç”¨JVMå’ŒJavaå¹³å°ï¼Œä»¥åŠJavaè¯­è¨€å’Œåº”ç”¨ç¨‹åºæ¥å£ï¼Œæœ¬ä¹¦è¯¦å°½è®²è§£äº†Javaæ€§èƒ½è°ƒä¼˜çš„ç›¸å…³çŸ¥è¯†ï¼Œå¸®åŠ©è¯»è€…æ·±å…¥ç†è§£Javaå¹³å°æ€§èƒ½çš„å„ä¸ªæ–¹é¢ï¼Œæœ€ç»ˆä½¿ç¨‹åºå¦‚è™æ·»ç¿¼ã€‚ ã€ŠSpringæ­ç§˜ã€‹ è±†ç“£è¯„åˆ†ï¼š9.0 ã€162 äººè¯„ä»·ã€‘ æ¨èç†ç”±ï¼šSpring ä½¿ç”¨è€…ä¸å¾—ä¸è¯»ï¼ æ¨èåšå®¢ï¼šSpring4Allç¤¾åŒº æ¨èå…¬ä¼—å·ï¼šSpring4Allç¤¾åŒº ã€ŠSpringBootæ­ç§˜ã€‹ è±†ç“£è¯„åˆ†ï¼š6.8 ã€44 äººè¯„ä»·ã€‘ æ¨èç†ç”±ï¼šã€ŠSpringæ­ç§˜ã€‹ç›¸åŒä½œè€…ã€‚SpringBoot å…¥é—¨ä¹¦ç±ã€‚ ä½œè€…åšå®¢ï¼šæ‰¶å¢™è€å¸ˆè¯´ï¼šä¸€ä¸ªæ¶æ„å£«çš„æ€è€ƒä¸æ²‰æ·€ ä½œè€…å…¬ä¼—å·ï¼šæ‰¶å¢™è€å¸ˆè¯´ ä»˜è´¹æ•™ç¨‹ï¼šã€ŠJava å¾®æœåŠ¡å®è·µ - Spring Boot ç³»åˆ—ã€‹ ã€ŠMyBatisæŠ€æœ¯å†…å¹•ã€‹ è±†ç“£è¯„åˆ†ï¼šæš‚æ—  æ¨èç†ç”±ï¼šä»¥MyBatis 3.4ä¸ºåŸºç¡€ï¼Œé’ˆå¯¹MyBatisçš„æ¶æ„è®¾è®¡å’Œå®ç°ç»†èŠ‚è¿›è¡Œäº†è¯¦ç»†åˆ†æï¼Œå…¶ä¸­ç©¿æ’ä»‹ç»äº†MyBatisæºç ä¸­æ¶‰åŠçš„åŸºç¡€çŸ¥è¯†ã€è®¾è®¡æ¨¡å¼ä»¥åŠç¬”è€…è‡ªå·±åœ¨å®è·µä¸­çš„æ€è€ƒã€‚ ä½œè€…åšå®¢ï¼šç¥–å¤§ä¿Šçš„åšå®¢ ã€Šæœ‰æ•ˆçš„å•å…ƒæµ‹è¯•ã€‹ è±†ç“£è¯„åˆ†ï¼š7.4 ã€18 äººè¯„ä»·ã€‘ æ¨èç†ç”±ï¼šJava å•å…ƒæµ‹è¯•å…¥é—¨ã€‚ ã€ŠJavaå¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‹ è±†ç“£è¯„åˆ†ï¼š9.0 ã€651 äººè¯„ä»·ã€‘ æ¨èç†ç”±ï¼šæœ¬ä¹¦æ·±å…¥æµ…å‡ºåœ°ä»‹ç»äº†Javaçº¿ç¨‹å’Œå¹¶å‘ï¼Œæ˜¯ä¸€æœ¬å®Œç¾çš„Javaå¹¶å‘å‚è€ƒæ‰‹å†Œã€‚ æ¨èåšå®¢ï¼šå¹¶å‘ç¼–ç¨‹ç½‘ æ¨èå…¬ä¼—å·ï¼šå¹¶å‘ç¼–ç¨‹ç½‘ ã€ŠNettyå®æˆ˜ã€‹ è±†ç“£è¯„åˆ†ï¼š7.5ã€24 äººè¯„ä»·ã€‘ è±†ç“£è¯„åˆ†ï¼š8.1ã€83 äººè¯„ä»·ã€‘ ã€ŠNetty in Actionã€‹è‹±æ–‡ç‰ˆ æ¨èç†ç”±ï¼šNettyä¹‹çˆ¶â€Trustin Leeä½œåºæ¨èã€‚ æ¨èå…¬ä¼—å·ï¼šNettyä¹‹å®¶ ã€Šæ·±å…¥å‰–æTomcatã€‹ è±†ç“£è¯„åˆ†ï¼š8.3ã€118 äººè¯„ä»·ã€‘ è±†ç“£è¯„åˆ†ï¼š8.9ã€73 äººè¯„ä»·ã€‘ ã€ŠHow Tomcat Worksã€‹è‹±æ–‡ç‰ˆ æ¨èç†ç”±ï¼šæœ¬ä¹¦æ·±å…¥å‰–æTomcat 4å’ŒTomcat 5ä¸­çš„æ¯ä¸ªç»„ä»¶ï¼Œå¹¶æ­ç¤ºå…¶å†…éƒ¨å·¥ä½œåŸç†ã€‚é€šè¿‡å­¦ä¹ æœ¬ä¹¦ï¼Œä½ å°†å¯ä»¥è‡ªè¡Œå¼€å‘Tomcatç»„ä»¶ï¼Œæˆ–è€…æ‰©å±•å·²æœ‰çš„ç»„ä»¶ã€‚ ã€ŠNginx ä¸­æ–‡å®˜æ–¹æ–‡æ¡£ã€‹ è±†ç“£è¯„åˆ†ï¼šæš‚æ—  æ¨èç†ç”±ï¼šæš‚æ—¶æœªæ‰¾åˆ°å¤§å®¶è¯„ä»·ä¸é”™çš„ Nginx å®æˆ˜ç›¸å…³ä¹¦ç±ï¼Œå…ˆæ¨èçœ‹ä¸­æ–‡ç¿»è¯‘çš„å®˜æ–¹æ–‡æ¡£ã€‚å¦‚æœä½ æœ‰åˆé€‚çš„æ¨èï¼Œçƒ¦è¯·å‘Šè¯‰æˆ‘ã€‚ ã€Šæ·±å…¥ç†è§£Nginxã€‹ è±†ç“£è¯„åˆ†ï¼š8.5ã€138 äººè¯„ä»·ã€‘ æ¨èç†ç”±ï¼šä¹¦ä¸­é¦–å…ˆé€šè¿‡ä»‹ç»å®˜æ–¹Nginxçš„åŸºæœ¬ç”¨æ³•å’Œé…ç½®è§„åˆ™ï¼Œå¸®åŠ©è¯»è€…äº†è§£ä¸€èˆ¬Nginxæ¨¡å—çš„ç”¨æ³•ï¼Œç„¶åé‡ç‚¹ä»‹ç»äº†å¦‚ä½•å¼€å‘HTTPæ¨¡å—(å«HTTPè¿‡æ»¤æ¨¡å—)æ¥å¾—åˆ°å®šåˆ¶åŒ–çš„Nginxï¼Œå…¶ä¸­åŒ…æ‹¬å¼€å‘â€”ä¸ªåŠŸèƒ½å¤æ‚çš„æ¨¡å—æ‰€éœ€è¦äº†è§£çš„å„ç§çŸ¥è¯†ï¼Œå¹¶å¯¹å†…å­˜æ± çš„å®ç°ç»†èŠ‚åŠTCPåè®®è¿›è¡Œäº†è¯¦ç»†ä»‹ç»ï¼›æ¥ç€ï¼Œç»¼åˆNginxæ¡†æ¶ä»£ç åˆ†æäº†Nginxæ¶æ„çš„è®¾è®¡ç†å¿µå’ŒæŠ€å·§ï¼Œæ­¤å¤–ï¼Œè¿˜æ–°å¢äº†å¦‚ä½•åœ¨æ¨¡å—ä¸­æ”¯æŒHTTPå˜é‡ï¼Œä»¥åŠä¸slabå…±äº«å†…å­˜ç­‰ç›¸å…³çš„å†…å®¹ï¼Œç›¸ä¿¡é€šè¿‡å®Œå–„ï¼Œå¯è¿›ä¸€æ­¥å¸®åŠ©è¯»è€…æ›´å¥½åœ°å¼€å‘å‡ºåŠŸèƒ½ä¸°å¯Œã€æ€§èƒ½â€”æµçš„Nginxæ¨¡å—ã€‚ å‹æƒ…æç¤ºï¼šç›¸å¯¹é€‚ç”¨äº Nginx å¼€å‘è€…ã€‚Nginx ä½¿ç”¨è€…å¯ä»¥äº†è§£ã€‚ ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºï¼šJVMé«˜çº§ç‰¹æ€§ä¸æœ€ä½³å®è·µã€‹ è±†ç“£è¯„åˆ†ï¼š8.9 ã€657 äººè¯„ä»·ã€‘ æ¨èç†ç”±ï¼šä¸å»äº†è§£ JVM çš„å·¥ç¨‹å¸ˆï¼Œå’Œå’¸é±¼æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ æ¨èå…¬ä¼—å·ï¼šä½ å‡ç¬¨ æ¨èåšå®¢ï¼šä½ å‡ç¬¨@JVM æ¨èå°ç¨‹åºï¼šJVMPocket ã€ŠJavaæ ¸å¿ƒæŠ€æœ¯ç³»åˆ—ï¼šJavaè™šæ‹Ÿæœºè§„èŒƒï¼ˆJava SE 8ç‰ˆï¼‰ã€‹ è±†ç“£è¯„åˆ†ï¼šæš‚æ— è¯„ä»· è±†ç“£è¯„åˆ†ï¼š8.3 ã€27 äººè¯„ä»·ã€‘ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒ(Java SE 7ç‰ˆ)ã€‹ æ¨èç†ç”±ï¼šåŸºäºJava SE 8,Oracleå®˜æ–¹å‘å¸ƒï¼ŒJavaè™šæ‹ŸæœºæŠ€æœ¯åˆ›å»ºäººæ’°å†™ï¼Œå›½å†…JavaæŠ€æœ¯ä¸“å®¶ç¿»è¯‘ï¼Œæ˜¯æ·±åº¦äº†è§£Javaè™šæ‹Ÿæœºå’ŒJavaè¯­è¨€å®ç°ç»†èŠ‚çš„å¿…è¯»ä¹‹ä½œ æ¨èåšå®¢ï¼šå å°ç‹¼çš„ç®€ä¹¦ æ¨èå…¬ä¼—å·ï¼šå å°ç‹¼çš„åšå®¢ ã€ŠGoè¯­è¨€ç¼–ç¨‹ã€‹ è±†ç“£è¯„åˆ†ï¼š7.1 ã€444 äººè¯„ä»·ã€‘ æ¨èç†ç”±ï¼šè¿™æœ¬ä¹¦ä»æ•´ä½“çš„å†™ä½œé£æ ¼æ¥è¯´ï¼Œä¼šä»¥ä»‹ç» Go è¯­è¨€ç‰¹æ€§ä¸ºä¸»ï¼Œç¤ºä¾‹åˆ™å°½é‡é‡‡ç”¨ä½œè€…å¹³å¸¸çš„å®è·µï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæ²¡æœ‰å¤ªå¤§å®é™…æ„ä¹‰çš„è¯­æ³•ç¤ºèŒƒæ ·ä¾‹ã€‚ å‹æƒ…æç¤ºï¼šæœ¬ä¹¦ä½œè€…èƒŒæ™¯æå¼ºï¼Œè®¸å¼ä¼Ÿä¸ºåŸé‡‘å±±WPSé¦–å¸­æ¶æ„å¸ˆã€æ›¾æ˜¯ç››å¤§åˆ›æ–°é™¢ç ”ç©¶å‘˜ï¼Œç›®å‰æ˜¯å›½å†…Goè¯­è¨€å®è·µåœˆå­å…¬è®¤çš„Goè¯­è¨€ä¸“å®¶ã€‚ ã€Š Goè¯­è¨€å­¦ä¹ ç¬”è®°ã€‹ è±†ç“£è¯„åˆ†ï¼š8.4 ã€57 äººè¯„ä»·ã€‘ æ¨èç†ç”±ï¼šåŸºäºGo1.6ï¼Œ è§£æè¯­è¨€è§„èŒƒï¼Œæ·±å…¥å‰–æGoè¿è¡Œæ—¶æºç  å‹æƒ…æç¤ºï¼šé›¨ç—•å¤§å¤§ï¼Œæ•™ç§‘ä¹¦çº§äººç‰©ã€‚ ã€ŠMySQLæŠ€æœ¯å†…å¹•â€”â€”InnoDBå­˜å‚¨å¼•æ“ã€‹ è±†ç“£è¯„åˆ†ï¼š8.6 ã€104 äººè¯„ä»·ã€‘ æ¨èç†ç”±ï¼šä»æºä»£ç çš„è§’åº¦æ·±åº¦è§£æäº†InnoDBçš„ä½“ç³»ç»“æ„ã€å®ç°åŸç†ã€å·¥ä½œæœºåˆ¶ï¼Œå¹¶ç»™å‡ºäº†å¤§é‡æœ€ä½³å®è·µï¼Œèƒ½å¸®åŠ©ä½ ç³»ç»Ÿè€Œæ·±å…¥åœ°æŒæ¡InnoDBï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œå®ƒèƒ½ä¸ºä½ è®¾è®¡ç®¡ç†é«˜æ€§èƒ½ã€é«˜å¯ç”¨çš„æ•°æ®åº“ç³»ç»Ÿæä¾›ç»ä½³çš„æŒ‡å¯¼ã€‚ æ¨èå…¬ä¼—å·ï¼šDBAplusç¤¾ç¾¤ ã€Šé«˜æ€§èƒ½MySQLã€‹ è±†ç“£è¯„åˆ†ï¼š9.3 ã€245 äººè¯„ä»·ã€‘ æ¨èç†ç”±ï¼šå¯¹äºæƒ³è¦äº†è§£MySQLæ€§èƒ½æå‡çš„äººæ¥è¯´ï¼Œè¿™æ˜¯ä¸€æœ¬ä¸å¯å¤šå¾—çš„ä¹¦ã€‚ä¹¦ä¸­æ²¡æœ‰å„ç§æå‡æ€§èƒ½çš„ç§˜ç±ï¼Œè€Œæ˜¯æ·±å…¥é—®é¢˜çš„æ ¸å¿ƒï¼Œè¯¦ç»†çš„è§£é‡Šäº†æ¯ç§æå‡æ€§èƒ½çš„åŸç†ï¼Œä»è€Œå¯ä»¥ä½¿ä½ å››ä¸¤æ‹¨åƒæ–¤ã€‚æˆä¹‹äºé±¼ä¸å¦‚æˆä¹‹äºæ¸”ï¼Œè¿™æœ¬ä¹¦åšåˆ°äº†ã€‚ æ¨èå…¬ä¼—å·ï¼šè€å¶èŒ¶é¦† ã€Šé«˜å¯ç”¨MySQLã€‹ è±†ç“£è¯„åˆ†ï¼š8.0 ã€87 äººè¯„ä»·ã€‘ æ¨èç†ç”±ï¼šã€Šé«˜æ€§èƒ½MySQLã€‹çš„å§Šå¦¹ç¯‡ã€‚ ã€ŠMongoDBæƒå¨æŒ‡å—ã€‹ è±†ç“£è¯„åˆ†ï¼š8.0 ã€69 äººè¯„ä»·ã€‘ æ¨èç†ç”±ï¼šç®—æ˜¯æ™®é€šçš„å‚è€ƒä¹¦äº†ï¼Œæ²¡æœ‰ç‰¹åˆ«æœ‰æ·±åº¦çš„è®²è§£ã€‚å…¶å®å°±æ˜¯ä¸€æœ¬æ­£å¸¸çš„ä»‹ç»mongoDBæ˜¯æ€ä¹ˆç”¨çš„ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºnosqlå­¦ä¹ çš„å…¥é—¨ã€‚ä½œä¸ºæŒ‡å—ä¹¦ï¼Œè¿˜æ˜¯å¾ˆåˆæ ¼çš„ç¬¦åˆæœŸæœ›ã€‚ æ¨èåšå®¢ï¼šMongoDB ä¸­æ–‡ç¤¾åŒº æ¨èå…¬ä¼—å·ï¼šMongoDB ä¸­æ–‡ç¤¾åŒº ã€ŠRediså¼€å‘ä¸è¿ç»´ã€‹ è±†ç“£è¯„åˆ†ï¼š8.8 ã€41 äººè¯„ä»·ã€‘ æ¨èç†ç”±ï¼šä»å¼€å‘ã€è¿ç»´ä¸¤ä¸ªè§’åº¦æ€»ç»“äº†Rediså®æˆ˜ç»éªŒï¼Œæ·±å…¥æµ…å‡ºåœ°å‰–æåº•å±‚å®ç°ï¼ŒåŒ…å«å¤§è§„æ¨¡é›†ç¾¤å¼€å‘ä¸è¿ç»´çš„å®é™…æ¡ˆä¾‹ã€åº”ç”¨æŠ€å·§ã€‚å…¨é¢è¦†ç›–Redis åŸºæœ¬åŠŸèƒ½åŠåº”ç”¨ï¼Œå›¾ç¤ºä¸°å¯Œï¼Œè®²è§£ç»†è…»ã€‚ æ¨èåšå®¢ï¼šRedis ä¸­å›½ç”¨æˆ·ç»„ æ¨èå…¬ä¼—å·ï¼šCRUG ã€ŠRedisè®¾è®¡ä¸å®ç°ã€‹ è±†ç“£è¯„åˆ†ï¼š8.5 ã€427 äººè¯„ä»·ã€‘ æ¨èç†ç”±ï¼šç³»ç»Ÿè€Œå…¨é¢åœ°æè¿°äº† Redis å†…éƒ¨è¿è¡Œæœºåˆ¶ã€‚å›¾ç¤ºä¸°å¯Œï¼Œæè¿°æ¸…æ™°ï¼Œå¹¶ç»™å‡ºå¤§é‡å‚è€ƒä¿¡æ¯ï¼Œæ˜¯NoSQLæ•°æ®åº“å¼€å‘äººå‘˜æ¡ˆå¤´å¿…å¤‡ã€‚ ã€ŠNoSQLç²¾ç²¹ã€‹ è±†ç“£è¯„åˆ†ï¼š8.2 ã€226 äººè¯„ä»·ã€‘ æ¨èç†ç”±ï¼šä¹¦ä¸­å…¨æ–¹ä½æ¯”è¾ƒäº†å…³ç³»å‹æ•°æ®åº“ä¸NoSQLæ•°æ®åº“çš„å¼‚åŒï¼›åˆ†åˆ«ä»¥Riakã€MongoDBã€Cassandraå’ŒNeo4Jä¸ºä»£è¡¨ï¼Œè¯¦ç»†è®²è§£äº†é”®å€¼æ•°æ®åº“ã€æ–‡æ¡£æ•°æ®åº“ã€åˆ—æ—æ•°æ®åº“å’Œå›¾æ•°æ®åº“è¿™4å¤§ç±»NoSQLæ•°æ®åº“çš„ä¼˜åŠ£åŠ¿ã€ç”¨æ³•å’Œé€‚ç”¨åœºåˆï¼›æ·±å…¥æ¢è®¨äº†å®ç°NoSQLæ•°æ®åº“ç³»ç»Ÿçš„å„ç§ç»†èŠ‚ï¼Œä»¥åŠä¸å…³ç³»å‹æ•°æ®åº“çš„æ··ç”¨ã€‚ ã€ŠElasticSearch å¯æ‰©å±•çš„å¼€æºå¼¹æ€§æœç´¢è§£å†³æ–¹æ¡ˆã€‹ è±†ç“£è¯„åˆ†ï¼š7.3 ã€23 äººè¯„ä»·ã€‘ æ¨èç†ç”±ï¼šåŸºäºElasticSearch çš„0.2 ç‰ˆæœ¬ï¼Œè¦†ç›–äº†ElasticSearch å„ç§åŠŸèƒ½å’Œå‘½ä»¤çš„åº”ç”¨ï¼Œå…¨é¢ã€è¯¦ç»†åœ°ä»‹ç»äº†å¼€æºã€åˆ†å¸ƒå¼ã€RESTfulï¼Œå…·æœ‰å…¨æ–‡æ£€ç´¢åŠŸèƒ½çš„æœç´¢å¼•æ“ElasticSearchã€‚ å‹æƒ…æç¤ºï¼šæœ¬ä¹¦ ElasticSearch æ¯”è¾ƒæ—§ï¼Œä¸å¿æ¨èã€‚ä»…é€‚åˆå…¥é—¨ï¼Œæœ‰å…¶ä»–åˆé€‚çš„ ElasticSearch ä¹¦ç±ï¼Œçƒ¦è¯·å‘Šè¯‰æˆ‘ã€‚ã€ŠElasticsearchæƒå¨æŒ‡å—ã€‹ä¸­æ–‡ç‰ˆï¼Œç›®å‰æ­£åœ¨ç¿»è¯‘ä¸­ã€‚ æ¨èåšå®¢ï¼šElastic ä¸­æ–‡ç¤¾åŒº ã€ŠELK Stackæƒå¨æŒ‡å—ã€‹ è±†ç“£è¯„åˆ†ï¼š7.0 ã€10 äººè¯„ä»·ã€‘ æ¨èç†ç”±ï¼šELK stackæ˜¯ä»¥Elasticsearchã€Logstashã€Kibanaä¸‰ä¸ªå¼€æºè½¯ä»¶ä¸ºä¸»çš„æ•°æ®å¤„ç†å·¥å…·é“¾ï¼Œæ˜¯ç›®å‰å¼€æºç•Œæœ€æµè¡Œçš„å®æ—¶æ•°æ®åˆ†æè§£å†³æ–¹æ¡ˆï¼Œæˆä¸ºå®æ—¶æ—¥å¿—å¤„ç†é¢†åŸŸå¼€æºç•Œçš„ç¬¬ä¸€é€‰æ‹©ã€‚ ã€ŠZooKeeperï¼šåˆ†å¸ƒå¼è¿‡ç¨‹ååŒæŠ€æœ¯è¯¦è§£ã€‹ è±†ç“£è¯„åˆ†ï¼š7.6 ã€49 äººè¯„ä»·ã€‘ æ¨èç†ç”±ï¼šZookeeper å…¥é—¨ å‹æƒ…æç¤ºï¼šç¿»è¯‘å¯èƒ½ç•¥æ˜¾å°´å°¬ã€‚ ã€Šä»Paxosåˆ°Zookeeperåˆ†å¸ƒå¼ä¸€è‡´æ€§åŸç†ä¸å®è·µã€‹ è±†ç“£è¯„åˆ†ï¼š8.1 ã€187 äººè¯„ä»·ã€‘ æ¨èç†ç”±ï¼šä»åˆ†å¸ƒå¼ä¸€è‡´æ€§çš„ç†è®ºå‡ºå‘ï¼Œå‘è¯»è€…ç®€è¦ä»‹ç»å‡ ç§å…¸å‹çš„åˆ†å¸ƒå¼ä¸€è‡´æ€§åè®®ï¼Œä»¥åŠè§£å†³åˆ†å¸ƒå¼ä¸€è‡´æ€§é—®é¢˜çš„æ€è·¯ï¼Œå…¶ä¸­é‡ç‚¹è®²è§£äº†Paxoså’ŒZABåè®®ã€‚åŒæ—¶ï¼Œæœ¬ä¹¦æ·±å…¥ä»‹ç»äº†åˆ†å¸ƒå¼ä¸€è‡´æ€§é—®é¢˜çš„å·¥ä¸šè§£å†³æ–¹æ¡ˆâ€”â€”ZooKeeperï¼Œå¹¶ç€é‡å‘è¯»è€…å±•ç¤ºè¿™ä¸€åˆ†å¸ƒå¼åè°ƒæ¡†æ¶çš„ä½¿ç”¨æ–¹æ³•ã€å†…éƒ¨å®ç°åŠè¿ç»´æŠ€å·§ï¼Œæ—¨åœ¨å¸®åŠ©è¯»è€…å…¨é¢äº†è§£ZooKeeperï¼Œå¹¶æ›´å¥½åœ°ä½¿ç”¨å’Œè¿ç»´ZooKeeperã€‚ ã€ŠRabbitMQå®æˆ˜ï¼šé«˜æ•ˆéƒ¨ç½²åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—ã€‹ è±†ç“£è¯„åˆ†ï¼š6.9 ã€47 äººè¯„ä»·ã€‘ æ¨èç†ç”±ï¼šæœ¬ä¹¦å¯¹RabbitMQåšäº†å…¨é¢ã€ç¿”å®çš„è®²è§£ï¼Œä½“ç°äº†ä¸¤ä½ä¸“å®¶çš„çœŸçŸ¥ç¼è§ã€‚æœ¬ä¹¦é¦–å…ˆä»‹ç»äº†æœ‰å…³MQçš„å†å²ï¼Œç„¶åä»åŸºæœ¬çš„æ¶ˆæ¯é€šä¿¡åŸç†è®²èµ·ï¼Œå¸¦é¢†è¯»è€…ä¸€è·¯æ¢ç´¢RabbitMQçš„æ¶ˆæ¯é€šä¿¡ä¸–ç•Œã€‚ å‹æƒ…æç¤ºï¼šæœ¬ä¹¦ RabbitMQ ç‰ˆæœ¬è¾ƒæ—§ã€‚æ¶ˆæ¯é˜Ÿåˆ—ä¸­é—´ä»¶ RabbitMQã€ActiveMQã€RocketMQã€Kafka å¯ä»¥é€‰æ‹©äº†è§£ä¸€ä¸‹ã€‚ ã€ŠApache Kafkaæºç å‰–æã€‹ è±†ç“£è¯„åˆ†ï¼š7.8 ã€30 äººè¯„ä»·ã€‘ æ¨èç†ç”±ï¼šä»¥Kafka 0.10.0ç‰ˆæœ¬æºç ä¸ºåŸºç¡€ï¼Œé’ˆå¯¹Kafkaçš„æ¶æ„è®¾è®¡åˆ°å®ç°ç»†èŠ‚è¿›è¡Œè¯¦ç»†é˜è¿°ã€‚ ã€Šä½œä¸šè°ƒåº¦ç³»ç»Ÿ Quartz ä¸­æ–‡æ–‡æ¡£ã€‹ è±†ç“£è¯„åˆ†ï¼šæš‚æ—  æ¨èç†ç”±ï¼šæš‚æ—¶æœªæ‰¾åˆ°å¤§å®¶è¯„ä»·ä¸é”™çš„ Quartz å®æˆ˜ç›¸å…³ä¹¦ç±ï¼Œå…ˆæ¨èçœ‹ä¸­æ–‡ç¿»è¯‘çš„å®˜æ–¹æ–‡æ¡£ã€‚å¦‚æœä½ æœ‰åˆé€‚çš„æ¨èï¼Œçƒ¦è¯·å‘Šè¯‰æˆ‘ã€‚ å‹æƒ…æç¤ºï¼šå›½å†…å¼€æºé¡¹ç›® Elastic-Jobï¼ŒXXL-Job éƒ½å¯ä»¥é€‰æ‹©äº†è§£ã€‚ ã€Šå¾®æœåŠ¡è®¾è®¡ã€‹ è±†ç“£è¯„åˆ†ï¼š8.1 ã€273 äººè¯„ä»·ã€‘ æ¨èç†ç”±ï¼šé€šè¿‡Netflixç­‰å¤šä¸ªä¸šç•Œæ¡ˆä¾‹ï¼Œä»å¾®æœåŠ¡æ¶æ„æ¼”è¿›åˆ°åŸç†å‰–æï¼Œå…¨é¢è®²è§£å»ºæ¨¡é›†æˆéƒ¨ç½²ç­‰å¾®æœåŠ¡æ‰€æ¶‰åŠçš„å„ç§ä¸»é¢˜ï¼Œå¾®æœåŠ¡æ¶æ„ä¸å®è·µæŒ‡å—ã€‚ ã€ŠSpring Cloudå¾®æœåŠ¡å®æˆ˜ã€‹ è±†ç“£è¯„åˆ†ï¼š7.9ã€20 äººè¯„ä»·ã€‘ æ¨èç†ç”±ï¼šä»æ—¶ä¸‹æµè¡Œçš„å¾®æœåŠ¡æ¶æ„æ¦‚å¿µå‡ºå‘ï¼Œè¯¦ç»†ä»‹ç»äº†Spring Cloudé’ˆå¯¹å¾®æœåŠ¡æ¶æ„ä¸­å‡ å¤§æ ¸å¿ƒè¦ç´ çš„è§£å†³æ–¹æ¡ˆå’ŒåŸºç¡€ç»„ä»¶ã€‚å¯¹äºå„ä¸ªç»„ä»¶çš„ä»‹ç»ï¼Œä¸»è¦ä»¥ç¤ºä¾‹ä¸æºç ç»“åˆçš„æ–¹å¼æ¥å¸®åŠ©è¯»è€…æ›´å¥½åœ°ç†è§£è¿™äº›ç»„ä»¶çš„ä½¿ç”¨æ–¹æ³•ä»¥åŠè¿è¡ŒåŸç†ã€‚åŒæ—¶ï¼Œåœ¨ä»‹ç»çš„è¿‡ç¨‹ä¸­ï¼Œè¿˜åŒ…å«äº†ä½œè€…åœ¨å®è·µä¸­æ‰€é‡åˆ°çš„ä¸€äº›é—®é¢˜å’Œè§£å†³æ€è·¯ï¼Œå¯ä¾›è¯»è€…åœ¨å®è·µä¸­ä½œä¸ºå‚è€ƒã€‚ ä½œè€…åšå®¢ï¼šhttp://blog.didispace.com/ ä½œè€…å…¬ä¼—å·ï¼šdidispace ã€Šäº¿çº§æµé‡ç½‘ç«™æ¶æ„æ ¸å¿ƒæŠ€æœ¯ã€‹ è±†ç“£è¯„åˆ†ï¼š7.6ã€57 äººè¯„ä»·ã€‘ æ¨èç†ç”±ï¼šæ€»ç»“å¹¶æ¢³ç†äº†äº¿çº§æµé‡ç½‘ç«™é«˜å¯ç”¨å’Œé«˜å¹¶å‘åŸåˆ™ï¼Œé€šè¿‡å®ä¾‹è¯¦ç»†ä»‹ç»äº†å¦‚ä½•è½åœ°è¿™äº›åŸåˆ™ã€‚æœ¬ä¹¦åˆ†ä¸ºå››éƒ¨åˆ†ï¼šæ¦‚è¿°ã€é«˜å¯ç”¨åŸåˆ™ã€é«˜å¹¶å‘åŸåˆ™ã€æ¡ˆä¾‹å®æˆ˜ã€‚ ä½œè€…åšå®¢ï¼šå¼€æ¶›çš„åšå®¢ ä½œè€…å…¬ä¼—å·ï¼šå¼€æ¶›çš„åšå®¢ ã€Šæ¶æ„å³æœªæ¥ï¼šç°ä»£ä¼ä¸šå¯æ‰©å±•çš„Webæ¶æ„ã€æµç¨‹å’Œç»„ç»‡ã€‹ è±†ç“£è¯„åˆ†ï¼š8.7ã€77 äººè¯„ä»·ã€‘ æ¨èç†ç”±ï¼šä»»ä½•ä¸€ä¸ªæŒç»­æˆé•¿çš„å…¬å¸æœ€ç»ˆéƒ½éœ€è¦è§£å†³ç³»ç»Ÿã€ç»„ç»‡å’Œæµç¨‹çš„æ‰©å±•æ€§é—®é¢˜ã€‚æœ¬ä¹¦æ±‡èšäº†ä½œè€…ä»eBayã€VISAã€Salesforce.comåˆ°Appleè¶…è¿‡30å¹´çš„ä¸°å¯Œç»éªŒï¼Œ å…¨é¢é˜é‡Šäº†ç»è¿‡éªŒè¯çš„ä¿¡æ¯æŠ€æœ¯æ‰©å±•æ–¹æ³•ï¼Œå¯¹æ‰€éœ€è¦æŒæ¡çš„äº§å“å’ŒæœåŠ¡çš„å¹³æ»‘æ‰©å±•åšäº†è¯¦å°½çš„è®ºè¿°ï¼Œå¹¶åœ¨ç¬¬1ç‰ˆçš„åŸºç¡€ä¸Šæ›´æ–°äº†æ‰©å±•çš„ç­–ç•¥ã€æŠ€æœ¯å’Œæ¡ˆä¾‹ã€‚ ã€ŠMaven å®æˆ˜ã€‹ è±†ç“£è¯„åˆ†ï¼š8.1ã€563 äººè¯„ä»·ã€‘ æ¨èç†ç”±ï¼šå›½å†…æœ€æƒå¨çš„Mavenä¸“å®¶çš„åŠ›ä½œï¼Œå”¯ä¸€ä¸€æœ¬å“¦ï¼ ã€ŠJenkinsæƒå¨æŒ‡å—ã€‹ è±†ç“£è¯„åˆ†ï¼šæš‚æ— è¯„åˆ† æ¨èç†ç”±ï¼šJenkins å”¯ä¸€å®ä½“ä¹¦ã€‚ å‹æƒ…æç¤ºï¼šå†…å®¹ç›¸å¯¹æ¯”è¾ƒæ—§ï¼Œå¤§å¤šæ˜¯è¿‡æ—¶çš„æ¡ˆä¾‹ã€‚å»ºè®®ï¼Œå¿«é€Ÿè¿‡ä¸€éã€‚Jenkins æ–¹é¢æ— ç‰¹åˆ«å¥½çš„é€‰æ‹©æ¨èä¹¦ç±ã€‚å¯ä»¥é€‰æ‹© Google ä¸€äº›æ•™ç¨‹ã€‚ ã€Šé¸Ÿå“¥çš„Linuxç§æˆ¿èœ ï¼ˆåŸºç¡€å­¦ä¹ ç¯‡ï¼‰ã€‹ è±†ç“£è¯„åˆ†ï¼š9.1ã€2269 äººè¯„ä»·ã€‘ æ¨èç†ç”±ï¼šæœ¬ä¹¦æ˜¯æœ€å…·çŸ¥ååº¦çš„Linuxå…¥é—¨ä¹¦ã€Šé¸Ÿå“¥çš„Linuxç§æˆ¿èœåŸºç¡€å­¦ä¹ ç¯‡ã€‹çš„æœ€æ–°ç‰ˆï¼Œå…¨é¢è€Œè¯¦ç»†åœ°ä»‹ç»äº†Linuxæ“ä½œç³»ç»Ÿã€‚ å‹æƒ…æç¤ºï¼šå†…å®¹éå¸¸å…¨é¢ï¼Œå»ºè®®æŒ‘é€‰å’Œè‡ªå·±å®é™…å·¥ä½œç›¸å…³åº¦è¾ƒé«˜çš„ï¼Œå…¶ä»–éƒ¨åˆ†æœ‰éœ€è¦å†é˜…è¯»ã€‚ ã€Šé¸Ÿå“¥çš„Linuxç§æˆ¿èœ ï¼ˆæœåŠ¡å™¨æ¶è®¾ç¯‡ï¼‰ã€‹ è±†ç“£è¯„åˆ†ï¼š8.8 ã€198 äººè¯„ä»·ã€‘ æ¨èç†ç”±ï¼šæ‚¨å·²æœ‰LinuxåŸºç¡€ï¼Œæƒ³è¦è¿›ä¸€æ­¥å­¦ä¹ æœåŠ¡å™¨æ¶è®¾ï¼Ÿè¿˜æƒ³äº†è§£å¦‚ä½•ç»´æŠ¤ä¸ç®¡ç†æ‚¨çš„æœåŠ¡å™¨ï¼Ÿæœ¬ä¹¦æ˜¯æ‚¨æœ€ä½³çš„é€‰æ‹©ã€‚ ã€ŠZabbixä¼ä¸šçº§åˆ†å¸ƒå¼ç›‘æ§ç³»ç»Ÿã€‹ è±†ç“£è¯„åˆ†ï¼š7.6 ã€39 äººè¯„ä»·ã€‘ æ¨èç†ç”±ï¼šæœ¬ä¹¦ä»è¿ç»´ï¼ˆOPSï¼‰è§’åº¦å¯¹Zabbixçš„å„é¡¹åŠŸèƒ½è¿›è¡Œäº†è¯¦ç»†ä»‹ç»ï¼Œä»¥è‡ªåŠ¨åŒ–è¿ç»´è§†è§’ä¸ºå‡ºå‘ç‚¹ï¼Œå¯¹Zabbixçš„å®‰è£…å’Œé…ç½®ã€è‡ªåŠ¨åŒ–åŠŸèƒ½ã€ç›‘æ§å‘Šè­¦ã€æ€§èƒ½è°ƒä¼˜ã€Zabbix APIã€Zabbixåè®®ã€RPMå®‰è£…åŒ…å®šåˆ¶ï¼Œç»“åˆSaltStackå®ç°è‡ªåŠ¨åŒ–é…ç½®ç®¡ç†ç­‰å†…å®¹è¿›è¡Œäº†å…¨æ–¹ä½çš„æ·±å…¥å‰–æã€‚ ã€Šç¬¬ä¸€æœ¬Dockerä¹¦ã€‹ è±†ç“£è¯„åˆ†ï¼š8.8 ã€63 äººè¯„ä»·ã€‘ æ¨èç†ç”±ï¼šæœ¬ä¹¦ç”±Dockerå…¬å¸å‰æœåŠ¡ä¸æ”¯æŒå‰¯æ€»è£James Turnbullç¼–å†™ï¼Œæ˜¯Dockerå¼€å‘æŒ‡å—ã€‚æœ¬ä¹¦ä¸“æ³¨äºDocker 1.9åŠä»¥ä¸Šç‰ˆæœ¬ï¼ŒæŒ‡å¯¼è¯»è€…å®ŒæˆDockerçš„å®‰è£…ã€éƒ¨ç½²ã€ç®¡ç†å’Œæ‰©å±•ï¼Œå¸¦é¢†è¯»è€…ç»å†ä»æµ‹è¯•åˆ°ç”Ÿäº§çš„æ•´ä¸ªå¼€å‘ç”Ÿå‘½å‘¨æœŸï¼Œè®©è¯»è€…äº†è§£Dockeré€‚ç”¨äºä»€ä¹ˆåœºæ™¯ã€‚ æ¨èåšå®¢ï¼šDockerOne æ¨èå…¬ä¼—å·ï¼šDockerOne ã€ŠDockerâ€”â€”å®¹å™¨ä¸å®¹å™¨äº‘ã€‹ è±†ç“£è¯„åˆ†ï¼š8.5 ã€99 äººè¯„ä»·ã€‘ æ¨èç†ç”±ï¼šæœ¬ä¹¦æ ¹æ®Docker 1.10ç‰ˆå’ŒKubernetes 1.2ç‰ˆå¯¹ç¬¬1ç‰ˆè¿›è¡Œäº†å…¨é¢æ›´æ–°ï¼Œä»å®è·µè€…çš„è§’åº¦å‡ºå‘ï¼Œä»¥Dockerå’ŒKubernetesä¸ºé‡ç‚¹ï¼Œæ²¿ç€â€œåŸºæœ¬ç”¨æ³•ä»‹ç»â€åˆ°â€œæ ¸å¿ƒåŸç†è§£è¯»â€åˆ°â€œé«˜çº§å®è·µæŠ€å·§â€çš„æ€è·¯ï¼Œä¸€æœ¬ä¹¦è®²é€å½“å‰ä¸»æµçš„å®¹å™¨å’Œå®¹å™¨äº‘æŠ€æœ¯ï¼Œæœ‰åŠ©äºè¯»è€…åœ¨å®é™…åœºæ™¯ä¸­åˆ©ç”¨Dockerå®¹å™¨å’Œå®¹å™¨äº‘è§£å†³é—®é¢˜å¹¶å¯å‘æ–°çš„æ€è€ƒã€‚ ã€ŠKubernetesæƒå¨æŒ‡å—ã€‹ è±†ç“£è¯„åˆ†ï¼š7.7ã€15 äººè¯„ä»·ã€‘ æ¨èç†ç”±ï¼šKubernetesé‡ç£…å¼€å±±ä¹‹ä½œï¼Œé’ˆå¯¹Kubernetes v1.6å’Œæœ¬ä¹¦ç¬¬2ç‰ˆè¿›è¡Œå¤§ç¯‡å¹…å†…å®¹æ›´æ–°ï¼Œå…¨æ–¹ä½å®Œç¾è¦†ç›–ï¼Œå¯å€Ÿé‰´æ€§æå¼ºã€‚ æ¨èåšå®¢ï¼šKubernetes ä¸­æ–‡ç¤¾åŒº æ¨èå…¬ä¼—å·ï¼šK8S æŠ€æœ¯ç¤¾åŒº ã€Šç”¨Mesosæ¡†æ¶æ„å»ºåˆ†å¸ƒå¼åº”ç”¨ã€‹ è±†ç“£è¯„åˆ†ï¼šæš‚æ— è¯„åˆ† æ¨èç†ç”±ï¼šè¶…çº§è–„çš„ä¸€æœ¬ä¹¦ï¼Œçœ‹å®Œä¹‹åï¼Œä½ ä¼šå¯¹ Mesos ä¼šéå¸¸äº†è§£ï¼Œå¹¶ä¸”æå¤§å¯èƒ½æ€§å­¦ä¼šå¦‚ä½•åŸºäº Mesos æ¡†æ¶æ„å»ºåˆ†å¸ƒå¼åº”ç”¨ã€‚ ã€Šæ•°æ®ç»“æ„ä¸ç®—æ³•åˆ†æï¼šJavaè¯­è¨€æè¿°ã€‹ è±†ç“£è¯„åˆ†ï¼š8.3ã€183 äººè¯„ä»·ã€‘ æ¨èç†ç”±ï¼šæœ¬ä¹¦æ˜¯å›½å¤–æ•°æ®ç»“æ„ä¸ç®—æ³•åˆ†ææ–¹é¢çš„ç»å…¸æ•™æï¼Œä½¿ç”¨å“è¶Šçš„Javaç¼–ç¨‹è¯­è¨€ä½œä¸ºå®ç°å·¥å…·è®¨è®ºäº†æ•°æ®ç»“æ„ï¼ˆç»„ç»‡å¤§é‡æ•°æ®çš„æ–¹æ³•ï¼‰å’Œç®—æ³•åˆ†æï¼ˆå¯¹ç®—æ³•è¿è¡Œæ—¶é—´çš„ä¼°è®¡ï¼‰ã€‚ å‹æƒ…æç¤ºï¼šç®—æ³•æ–¹æ³•è¿˜æœ‰å…¶ä»–å¾ˆå¥½çš„ä¹¦ç±ï¼Œä¾‹å¦‚ã€Šç®—æ³•å¯¼è®ºã€‹ã€ã€Šç®—æ³•ï¼ˆç¬¬å››ç‰ˆï¼‰ã€‹ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©é˜…è¯»ã€‚é‡è¦çš„æ˜¯ï¼Œä¿æŒè€å¿ƒï¼Œäº«å—è¿™ä¸ªç—›å¹¶å¿«ä¹çš„è¿‡ç¨‹ã€‚ ã€ŠHead First è®¾è®¡æ¨¡å¼ã€‹ è±†ç“£è¯„åˆ†ï¼š9.2ã€2394 äººè¯„ä»·ã€‘ æ¨èç†ç”±ï¼šã€ŠHead Firstè®¾è®¡æ¨¡å¼ã€‹(ä¸­æ–‡ç‰ˆ)å…±æœ‰14ç« ï¼Œæ¯ç« éƒ½ä»‹ç»äº†å‡ ä¸ªè®¾è®¡æ¨¡å¼ï¼Œå®Œæ•´åœ°æ¶µç›–äº†å››äººç»„ç‰ˆæœ¬å…¨éƒ¨23ä¸ªè®¾è®¡æ¨¡å¼ã€‚ ã€ŠHTTPæƒå¨æŒ‡å—ã€‹ è±†ç“£è¯„åˆ†ï¼š8.7 ã€1126 äººè¯„ä»·ã€‘ æ¨èç†ç”±ï¼šæœ¬ä¹¦å°è¯•ç€å°†HTTPä¸­ä¸€äº›äº’ç›¸å…³è”ä¸”å¸¸è¢«è¯¯è§£çš„è§„åˆ™æ¢³ç†æ¸…æ¥šï¼Œå¹¶ç¼–å†™äº†ä¸€ç³»åˆ—åŸºäºå„ç§ä¸»é¢˜çš„ç« èŠ‚ï¼Œå¯¹HTTPå„æ–¹é¢çš„ç‰¹æ€§è¿›è¡Œäº†ä»‹ç»ã€‚çºµè§‚å…¨ä¹¦ï¼Œå¯¹HTTPâ€œä¸ºä»€ä¹ˆâ€è¿™æ ·åšè¿›è¡Œäº†è¯¦ç»†çš„è§£é‡Šï¼Œè€Œä¸ä»…ä»…åœç•™åœ¨å®ƒæ˜¯â€œæ€ä¹ˆåšâ€çš„ã€‚ ã€ŠTCP/IPè¯¦è§£ ç³»åˆ—ã€‹ è±†ç“£è¯„åˆ†ï¼š9.3 ã€1883 äººè¯„ä»·ã€‘ æ¨èç†ç”±ï¼šå®Œæ•´è€Œè¯¦ç»†çš„TCP/IPåè®®æŒ‡å—ã€‚é’ˆå¯¹ä»»ä½•å¸Œæœ›ç†è§£TCP/IPåè®®æ˜¯å¦‚ä½•å®ç°çš„è¯»è€…è®¾è®¡ã€‚ ã€ŠLinuxå†…æ ¸è®¾è®¡ä¸å®ç°ã€‹ è±†ç“£è¯„åˆ†ï¼š8.7ã€286 äººè¯„ä»·ã€‘ è¯¦ç»†æè¿°äº†Linuxå†…æ ¸çš„ä¸»è¦å­ç³»ç»Ÿå’Œç‰¹ç‚¹ï¼ŒåŒ…æ‹¬Linuxå†…æ ¸çš„è®¾è®¡ã€å®ç°å’Œæ¥å£ã€‚ä»ç†è®ºåˆ°å®è·µæ¶µç›–äº†Linuxå†…æ ¸çš„æ–¹æ–¹é¢é¢ï¼Œå¯ä»¥æ»¡è¶³è¯»è€…çš„å„ç§å…´è¶£å’Œéœ€æ±‚ã€‚ å‹æƒ…æç¤ºï¼šLinuxå†…æ ¸æ–¹é¢ä¸ä¹å¥½ä¹¦ã€‚æœ¬ä¹¦ç¯‡å¹…æ–¹é¢è¾ƒä¸ºåˆé€‚ã€‚ ã€Šå‰‘æŒ‡Offerï¼šåä¼é¢è¯•å®˜ç²¾è®²å…¸å‹ç¼–ç¨‹é¢˜ã€‹ è±†ç“£è¯„åˆ†ï¼š8.5ã€508 äººè¯„ä»·ã€‘ æ¨èç†ç”±ï¼šå‰–æäº†80ä¸ªå…¸å‹çš„ç¼–ç¨‹é¢è¯•é¢˜ï¼Œç³»ç»Ÿæ•´ç†åŸºç¡€çŸ¥è¯†ã€ä»£ç è´¨é‡ã€è§£é¢˜æ€è·¯ã€ä¼˜åŒ–æ•ˆç‡å’Œç»¼åˆèƒ½åŠ›è¿™5ä¸ªé¢è¯•è¦ç‚¹ã€‚ æ¨èç½‘ç«™ï¼šç‰›å®¢ç½‘-ä¸“ä¸šITç¬”è¯•é¢è¯•å¤‡è€ƒå¹³å° ã€Šç¨‹åºå‘˜ä»£ç é¢è¯•æŒ‡å—ï¼šITåä¼ç®—æ³•ä¸æ•°æ®ç»“æ„é¢˜ç›®æœ€ä¼˜è§£ã€‹ è±†ç“£è¯„åˆ†ï¼š8.4ã€32 äººè¯„ä»·ã€‘ æ¨èç†ç”±ï¼šç¨‹åºå‘˜åˆ·é¢˜å®å…¸ï¼ç¼–ç¨‹èƒ½åŠ›æå‡ç§˜ç¬ˆï¼ç²¾é€‰ITåä¼çœŸå®ä»£ç é¢è¯•é¢˜ï¼Œå…¨é¢è¦†ç›–ç®—æ³•ä¸æ•°æ®ç»“æ„é¢˜å‹ï¼ ã€Šé¢†åŸŸé©±åŠ¨è®¾è®¡ã€‹ è±†ç“£è¯„åˆ†ï¼š9.0ã€115 äººè¯„ä»·ã€‘ æ¨èç†ç”±ï¼šæ˜¯é¢†åŸŸé©±åŠ¨è®¾è®¡æ–¹é¢çš„ç»å…¸ä¹‹ä½œã€‚å…¨ä¹¦å›´ç»•ç€è®¾è®¡å’Œå¼€å‘å®è·µï¼Œç»“åˆè‹¥å¹²çœŸå®çš„é¡¹ç›®æ¡ˆä¾‹ï¼Œå‘è¯»è€…é˜è¿°å¦‚ä½•åœ¨çœŸå®çš„è½¯ä»¶å¼€å‘ä¸­åº”ç”¨é¢†åŸŸé©±åŠ¨è®¾è®¡ã€‚ å‹æƒ…æç¤ºï¼šç†è®ºçš„ä¹¦ç±å¾€å¾€è¾ƒä¸ºæ¯ç‡¥ï¼Œå‹¤ä¿®å†…åŠŸæ˜¯å¿…é¡»èµ°çš„è·¯ã€‚ ã€Šç«çƒ:UMLå¤§æˆ˜éœ€æ±‚åˆ†æã€‹ è±†ç“£è¯„åˆ†ï¼š7.9ã€115 äººè¯„ä»·ã€‘ æ¨èç†ç”±ï¼šèåˆUMLã€éUMLã€éœ€æ±‚åˆ†æåŠéœ€æ±‚ç®¡ç†ç­‰å„æ–¹é¢çš„çŸ¥è¯†ï¼Œå¸®åŠ©è¯»è€…è§£å†³UMLä¸šç•Œé—®é¢˜ã€éœ€æ±‚åˆ†æåŠéœ€æ±‚ç®¡ç†é—®é¢˜ã€‚ å‹æƒ…æç¤ºï¼šå¯èƒ½ä¸æ˜¯æœ€å¥½çš„ UML ä¹¦ç±ï¼Œä½†ä»æ˜¯å¦èƒ½å¤Ÿé˜…è¯»ç†è§£å®Œçš„è§’åº¦æ¥è¯´ï¼Œæœ¬ä¹¦å¯èƒ½æ˜¯ç›¸å¯¹åˆé€‚çš„ã€‚æœ‰å…´è¶£çš„åŒå­¦ä¹Ÿå¯ä»¥çœ‹çœ‹ã€ŠUMLå’Œæ¨¡å¼åº”ç”¨ã€‹ã€ã€Šå¤§è±¡ï¼šThinking in UMLã€‹ã€‚ TODO Listå¾…æ¨èä¸»é¢˜ä¹¦ç± TODO ã€Šå¤§æ•°æ®æ—¥çŸ¥å½• æ¶æ„ä¸ç®—æ³•ã€‹TODO ã€Šå¤§å‹ç½‘ç«™ç³»ç»Ÿä¸Javaä¸­é—´ä»¶å®è·µã€‹TODO ã€ŠHotSpotå®æˆ˜ã€‹TODO ã€Šåƒåœ¾å›æ”¶çš„ç®—æ³•ä¸å®ç°ã€‹TODO ã€Šå½©è‰²UMLå»ºæ¨¡ã€‹TODO ã€Šä¸ƒå‘¨ä¸ƒå¹¶å‘æ¨¡å‹ã€‹TODO ã€ŠGoç¨‹åºè®¾è®¡è¯­è¨€ã€‹ [x] Go [ ] Node [x] Linux å†…æ ¸ [x] é¢†åŸŸ [x] UML [x] Tomcat [x] SpringCloud [x] Java åŸºç¡€ [x] Netty [x] MyBatis [x] æ•°æ®åº“ [x] MongoDB [x] Maven [x] DevOps [x] Linux è¿ç»´ [x] é¢è¯• [x] æ¶ˆæ¯é˜Ÿåˆ— [x] è®¾è®¡æ¨¡å¼ [x] ç®—æ³•ä¸æ•°æ®ç»“æ„ [x] Zookeeper [x] SpringBoot [x] Nginx [x] å®šæ—¶ä»»åŠ¡ [x] æœç´¢å¼•æ“ [x] åè®® [x] å•å…ƒæµ‹è¯• [x] é‡æ„ [x] æ—¥å¿— [x] Docker [x] ç›‘æ§ æœ€ååŸæ–‡å‡ºå¤„ http://www.iocoder.cn/Architecture/books-recommended/ ã€ŒèŠ‹é“æºç ã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼","tags":[{"name":"ä¹¦ç±","slug":"ä¹¦ç±","permalink":"http://www.54tianzhisheng.cn/tags/ä¹¦ç±/"}]},{"title":"å°ç™½è°ˆæ•°æ®è„±æ•","date":"2017-10-27T16:00:00.000Z","path":"2017/10/28/Data-Desensitization/","text":"ä»€ä¹ˆæ˜¯æ•°æ®è„±æ•ï¼Ÿç™¾åº¦ç™¾ç§‘æ˜¯è¿™æ ·æè¿°çš„ï¼š æ•°æ®è„±æ•æ˜¯æŒ‡å¯¹æŸäº›æ•æ„Ÿä¿¡æ¯é€šè¿‡è„±æ•è§„åˆ™è¿›è¡Œæ•°æ®çš„å˜å½¢ï¼Œå®ç°æ•æ„Ÿéšç§æ•°æ®çš„å¯é ä¿æŠ¤ã€‚åœ¨æ¶‰åŠå®¢æˆ·å®‰å…¨æ•°æ®æˆ–è€…ä¸€äº›å•†ä¸šæ€§æ•æ„Ÿæ•°æ®çš„æƒ…å†µä¸‹ï¼Œåœ¨ä¸è¿åç³»ç»Ÿè§„åˆ™æ¡ä»¶ä¸‹ï¼Œå¯¹çœŸå®æ•°æ®è¿›è¡Œæ”¹é€ å¹¶æä¾›æµ‹è¯•ä½¿ç”¨ï¼Œå¦‚èº«ä»½è¯å·ã€æ‰‹æœºå·ã€å¡å·ã€å®¢æˆ·å§“åã€å®¢æˆ·åœ°å€ã€ç­‰ä¸ªäººæ•æ„Ÿä¿¡æ¯éƒ½éœ€è¦é€šè¿‡è„±æ•è§„åˆ™è¿›è¡Œæ•°æ®çš„å˜å½¢ï¼Œå®ç°æ•æ„Ÿéšç§æ•°æ®çš„å¯é ä¿æŠ¤ã€‚è¿™æ ·å°±å¯ä»¥åœ¨å¼€å‘ã€æµ‹è¯•å’Œå…¶ä»–éç”Ÿäº§ç¯å¢ƒä»¥åŠå¤–åŒ…ç¯å¢ƒä¸­å¯ä»¥å®‰å…¨çš„ä½¿ç”¨è„±æ•åçš„çœŸå®æ•°æ®é›†ã€‚ ç”Ÿæ´»ä¸­çš„å¸¸è§ä¾‹å­1ã€ç«è½¦ç¥¨ï¼š 2ã€æ·˜å®ç½‘é¡µä¸Šçš„æ”¶è·åœ°å€ä¿¡æ¯ï¼š æ•æ„Ÿæ•°æ®æ¢³ç†åœ¨è¿›è¡Œæ•°æ®è„±æ•ä¹‹å‰æˆ‘ä»¬åº”è¯¥è¦ç¡®å®šå…¬å¸çš„å“ªäº›æ•°æ®ï¼ˆå“ªäº›è¡¨ã€å“ªäº›å­—æ®µï¼‰è¦ä½œä¸ºè„±æ•çš„ç›®æ ‡ï¼Œä¸‹é¢ä»ç”¨æˆ·ã€å…¬å¸ã€å–å®¶æ–¹é¢åˆ†æï¼š 1ã€ç”¨æˆ·ï¼šåå­—ã€æ‰‹æœºå·ç ã€èº«ä»½è¯å·ç ã€å›ºå®šç”µè¯ã€æ”¶è´§åœ°å€ã€ç”µå­é‚®ç®±ã€é“¶è¡Œå¡å·ã€å¯†ç ç­‰ 2ã€å–å®¶ï¼šåå­—ã€æ‰‹æœºå·ç ã€èº«ä»½è¯å·ç ã€å›ºå®šç”µè¯ç­‰ 3ã€å…¬å¸ï¼šäº¤æ˜“é‡‘é¢ã€ä¼˜æƒ åˆ¸ç ã€å……å€¼ç ç­‰ ç¡®å®šè„±æ•è§„åˆ™ç¡®å®šå¥½äº†å…¬å¸çš„å“ªäº›æ•°æ®è¦ä½œä¸ºè„±æ•ç›®æ ‡åï¼Œæˆ‘ä»¬å°±éœ€è¦åˆ¶å®šè„±æ•çš„è§„åˆ™ï¼ˆå…·ä½“çš„å®æ–½æ–¹æ³•ï¼‰ã€‚ å¸¸è§æ–¹æ³•ï¼š 1ã€æ›¿æ¢ï¼šå¦‚ç»Ÿä¸€å°†å¥³æ€§ç”¨æˆ·åæ›¿æ¢ä¸ºFï¼Œè¿™ç§æ–¹æ³•æ›´åƒâ€œéšœçœ¼æ³•â€ï¼Œå¯¹å†…éƒ¨äººå‘˜å¯ä»¥å®Œå…¨ä¿æŒä¿¡æ¯å®Œæ•´æ€§ï¼Œä½†æ˜“ç ´è§£ã€‚ 2ã€é‡æ’ï¼šåºå·12345 é‡æ’ä¸º 54321ï¼ŒæŒ‰ç…§ä¸€å®šçš„é¡ºåºè¿›è¡Œæ‰“ä¹±ï¼Œå¾ˆåƒâ€œæ›¿æ¢â€ï¼Œ å¯ä»¥åœ¨éœ€è¦æ—¶æ–¹ä¾¿è¿˜åŸä¿¡æ¯ï¼Œä½†åŒæ ·æ˜“ç ´è§£ã€‚ 3ã€åŠ å¯†ï¼šç¼–å· 12345 åŠ å¯†ä¸º 23456ï¼Œå®‰å…¨ç¨‹åº¦å–å†³äºé‡‡ç”¨å“ªç§åŠ å¯†ç®—æ³•ï¼Œä¸€èˆ¬æ ¹æ®å®é™…æƒ…å†µè€Œå®šã€‚ 4ã€æˆªæ–­ï¼š13811001111 æˆªæ–­ä¸º 138ï¼Œèˆå¼ƒå¿…è¦ä¿¡æ¯æ¥ä¿è¯æ•°æ®çš„æ¨¡ç³Šæ€§ï¼Œæ˜¯æ¯”è¾ƒå¸¸ç”¨çš„è„±æ•æ–¹æ³•ï¼Œä½†å¾€å¾€å¯¹ç”Ÿäº§ä¸å¤Ÿå‹å¥½ã€‚ï¼ˆä¸¢å¤±å­—æ®µçš„é•¿åº¦ï¼‰ 5ã€æ©ç : 123456 -&gt; 1xxxx6ï¼Œä¿ç•™äº†éƒ¨åˆ†ä¿¡æ¯ï¼Œå¹¶ä¸”ä¿è¯äº†ä¿¡æ¯çš„é•¿åº¦ä¸å˜æ€§ï¼Œå¯¹ä¿¡æ¯æŒæœ‰è€…æ›´æ˜“è¾¨åˆ«ï¼Œ å¦‚ç«è½¦ç¥¨ä¸Šå¾—èº«ä»½ä¿¡æ¯ã€‚ï¼ˆå¸¸ç”¨æ–¹æ³•ï¼‰ 6ã€æ—¥æœŸåç§»å–æ•´ï¼š20130520 12:30:45 -&gt; 20130520 12:00:00ï¼Œèˆå¼ƒç²¾åº¦æ¥ä¿è¯åŸå§‹æ•°æ®çš„å®‰å…¨æ€§ï¼Œä¸€èˆ¬æ­¤ç§æ–¹æ³•å¯ä»¥ä¿æŠ¤æ•°æ®çš„æ—¶é—´åˆ†å¸ƒå¯†åº¦ã€‚ ç›®å‰æˆ‘çš„è„±æ•è§„åˆ™æƒ³æ³•æ˜¯ï¼š 1ã€ã€ä¸­æ–‡å§“åã€‘åªæ˜¾ç¤ºç¬¬ä¸€ä¸ªæ±‰å­—ï¼Œå…¶ä»–éšè—ä¸º2ä¸ªæ˜Ÿå·ï¼Œæ¯”å¦‚ï¼šæ** 2ã€ã€èº«ä»½è¯å·ã€‘æ˜¾ç¤ºæœ€åå››ä½ï¼Œå…¶ä»–éšè—ã€‚å…±è®¡18ä½æˆ–è€…15ä½ï¼Œæ¯”å¦‚ï¼š*************1234 3ã€ã€å›ºå®šç”µè¯ã€‘ æ˜¾ç¤ºåå››ä½ï¼Œå…¶ä»–éšè—ï¼Œæ¯”å¦‚ï¼š*******3241 4ã€ã€æ‰‹æœºå·ç ã€‘å‰ä¸‰ä½ï¼Œåå››ä½ï¼Œå…¶ä»–éšè—ï¼Œæ¯”å¦‚ï¼š135****6810 5ã€ã€åœ°å€ã€‘åªæ˜¾ç¤ºåˆ°åœ°åŒºï¼Œä¸æ˜¾ç¤ºè¯¦ç»†åœ°å€ï¼Œæ¯”å¦‚ï¼šä¸Šæµ·å¾æ±‡åŒºæ¼•æ²³æ³¾å¼€å‘åŒº*** 6ã€ã€ç”µå­é‚®ç®±ã€‘ é‚®ç®±å‰ç¼€ä»…æ˜¾ç¤ºç¬¬ä¸€ä¸ªå­—æ¯ï¼Œå‰ç¼€å…¶ä»–éšè—ï¼Œç”¨æ˜Ÿå·ä»£æ›¿ï¼Œ@åŠåé¢çš„åœ°å€æ˜¾ç¤ºï¼Œæ¯”å¦‚ï¼šd**@126.com 7ã€ã€é“¶è¡Œå¡å·ã€‘å‰å…­ä½ï¼Œåå››ä½ï¼Œå…¶ä»–ç”¨æ˜Ÿå·éšè—æ¯ä½1ä¸ªæ˜Ÿå·ï¼Œæ¯”å¦‚ï¼š6222600**********1234 8ã€ã€å¯†ç ã€‘å¯†ç çš„å…¨éƒ¨å­—ç¬¦éƒ½ç”¨ä»£æ›¿ï¼Œæ¯”å¦‚ï¼š* æ ¹æ®ä»¥ä¸Šè§„åˆ™è¿›è¡Œæ•°æ®è„±æ•ï¼ å…·ä½“æ€è·¯ç›®å‰æ˜¯è¿™æ ·çš„ï¼š ä»åŸæ•°æ®æºæŸ¥è¯¢åˆ°çš„ç”Ÿäº§æ•°æ® â€”â€”&gt; æ•°æ®è„±æ• â€”â€”&gt; æ›´æ–°åˆ°ç›®æ ‡æ•°æ®æºã€‚ åŸæ•°æ®æºã€ç›®æ ‡æ•°æ®æºã€éœ€è¦è„±æ•çš„è¡¨ã€å­—æ®µç­‰éƒ½æ”¾åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œåšåˆ°å¯æ‰©å±•æ€§ï¼ è„±æ•å·¥å…·ä»£ç æ ¹æ®ä»¥ä¸Šè§„åˆ™å·²ç»å†™å¥½äº†ä¸€ä»½ç®€å•çš„è„±æ•è§„åˆ™å·¥å…·ç±»ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119/** * æ•°æ®è„±æ•å·¥å…·ç±» * Created by zhisheng_tian on 2017/10/25. */public class DesensitizedUtils &#123; /** * ã€ä¸­æ–‡å§“åã€‘åªæ˜¾ç¤ºç¬¬ä¸€ä¸ªæ±‰å­—ï¼Œå…¶ä»–éšè—ä¸º2ä¸ªæ˜Ÿå·ï¼Œæ¯”å¦‚ï¼šæ** * * @param fullName * @return */ public static String chineseName(String fullName) &#123; if (StringUtils.isBlank(fullName)) &#123; return \"\"; &#125; String name = StringUtils.left(fullName, 1); return StringUtils.rightPad(name, StringUtils.length(fullName), \"*\"); &#125; /** * ã€èº«ä»½è¯å·ã€‘æ˜¾ç¤ºæœ€åå››ä½ï¼Œå…¶ä»–éšè—ã€‚å…±è®¡18ä½æˆ–è€…15ä½ï¼Œæ¯”å¦‚ï¼š*************1234 * * @param id * @return */ public static String idCardNum(String id) &#123; if (StringUtils.isBlank(id)) &#123; return \"\"; &#125; String num = StringUtils.right(id, 4); return StringUtils.leftPad(num, StringUtils.length(id), \"*\"); &#125; /** * ã€å›ºå®šç”µè¯ã€‘ æ˜¾ç¤ºåå››ä½ï¼Œå…¶ä»–éšè—ï¼Œæ¯”å¦‚ï¼š*******3241 * * @param num * @return */ public static String fixedPhone(String num) &#123; if (StringUtils.isBlank(num)) &#123; return \"\"; &#125; return StringUtils.leftPad(StringUtils.right(num, 4), StringUtils.length(num), \"*\"); &#125; /** * ã€æ‰‹æœºå·ç ã€‘å‰ä¸‰ä½ï¼Œåå››ä½ï¼Œå…¶ä»–éšè—ï¼Œæ¯”å¦‚ï¼š135****6810 * * @param num * @return */ public static String mobilePhone(String num) &#123; if (StringUtils.isBlank(num)) &#123; return \"\"; &#125; return StringUtils.left(num, 3).concat(StringUtils.removeStart(StringUtils.leftPad(StringUtils.right(num, 4), StringUtils.length(num), \"*\"), \"***\")); &#125; /** * ã€åœ°å€ã€‘åªæ˜¾ç¤ºåˆ°åœ°åŒºï¼Œä¸æ˜¾ç¤ºè¯¦ç»†åœ°å€ï¼Œæ¯”å¦‚ï¼šä¸Šæµ·å¾æ±‡åŒºæ¼•æ²³æ³¾å¼€å‘åŒº*** * * @param address * @param sensitiveSize æ•æ„Ÿä¿¡æ¯é•¿åº¦ * @return */ public static String address(String address, int sensitiveSize) &#123; if (StringUtils.isBlank(address)) &#123; return \"\"; &#125; int length = StringUtils.length(address); return StringUtils.rightPad(StringUtils.left(address, length - sensitiveSize), length, \"*\"); &#125; /** * ã€ç”µå­é‚®ç®±ã€‘ é‚®ç®±å‰ç¼€ä»…æ˜¾ç¤ºç¬¬ä¸€ä¸ªå­—æ¯ï¼Œå‰ç¼€å…¶ä»–éšè—ï¼Œç”¨æ˜Ÿå·ä»£æ›¿ï¼Œ@åŠåé¢çš„åœ°å€æ˜¾ç¤ºï¼Œæ¯”å¦‚ï¼šd**@126.com * * @param email * @return */ public static String email(String email) &#123; if (StringUtils.isBlank(email)) &#123; return \"\"; &#125; int index = StringUtils.indexOf(email, \"@\"); if (index &lt;= 1) return email; else return StringUtils.rightPad(StringUtils.left(email, 1), index, \"*\").concat(StringUtils.mid(email, index, StringUtils.length(email))); &#125; /** * ã€é“¶è¡Œå¡å·ã€‘å‰å…­ä½ï¼Œåå››ä½ï¼Œå…¶ä»–ç”¨æ˜Ÿå·éšè—æ¯ä½1ä¸ªæ˜Ÿå·ï¼Œæ¯”å¦‚ï¼š6222600**********1234 * * @param cardNum * @return */ public static String bankCard(String cardNum) &#123; if (StringUtils.isBlank(cardNum)) &#123; return \"\"; &#125; return StringUtils.left(cardNum, 6).concat(StringUtils.removeStart(StringUtils.leftPad(StringUtils.right(cardNum, 4), StringUtils.length(cardNum), \"*\"), \"******\")); &#125; /** * ã€å¯†ç ã€‘å¯†ç çš„å…¨éƒ¨å­—ç¬¦éƒ½ç”¨*ä»£æ›¿ï¼Œæ¯”å¦‚ï¼š****** * * @param password * @return */ public static String password(String password) &#123; if (StringUtils.isBlank(password)) &#123; return \"\"; &#125; String pwd = StringUtils.left(password, 0); return StringUtils.rightPad(pwd, StringUtils.length(password), \"*\"); &#125;&#125; æœ€åè½¬è½½è¯·æ³¨æ˜åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2017/10/28/Data-Desensitization/","tags":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"http://www.54tianzhisheng.cn/tags/æ•°æ®åº“/"}]},{"title":"HBase é›†ç¾¤ç›‘æ§","date":"2017-10-20T16:00:00.000Z","path":"2017/10/21/HBase-metrics/","text":"ä¸ºä»€ä¹ˆéœ€è¦ç›‘æ§ï¼Ÿä¸ºäº†ä¿è¯ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œå¯é æ€§ï¼Œå¯è¿ç»´æ€§ã€‚ æŒæ§é›†ç¾¤çš„æ ¸å¿ƒæ€§èƒ½æŒ‡æ ‡ï¼Œäº†è§£é›†ç¾¤çš„æ€§èƒ½è¡¨ç°ã€‚ é›†ç¾¤å‡ºç°é—®é¢˜æ—¶åŠæ—¶æŠ¥è­¦ï¼Œä¾¿äºè¿ç»´åŒå­¦åŠæ—¶ä¿®å¤é—®é¢˜ã€‚ é›†ç¾¤é‡è¦æŒ‡æ ‡å€¼å¼‚å¸¸æ—¶è¿›è¡Œé¢„è­¦ï¼Œå°†é—®é¢˜æ‰¼æ€åœ¨æ‘‡ç¯®ä¸­ï¼Œä¸ç”¨ç­‰é›†ç¾¤çœŸæ­£ä¸å¯ç”¨æ—¶æ‰é‡‡å–è¡ŒåŠ¨ã€‚ å½“é›†ç¾¤å‡ºç°é—®é¢˜æ—¶ï¼Œç›‘æ§ç³»ç»Ÿå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å¿«çš„å®šä½é—®é¢˜å’Œè§£å†³é—®é¢˜ å¦‚ä½•æ„å»º HBase é›†ç¾¤ç›‘æ§ç³»ç»Ÿï¼Ÿå…¬å¸æœ‰è‡ªå·±çš„ç›‘æ§ç³»ç»Ÿï¼Œæˆ‘ä»¬æ‰€è¦åšçš„å°±æ˜¯å°† HBase ä¸­æˆ‘ä»¬å…³å¿ƒçš„æŒ‡æ ‡é¡¹å‘é€åˆ°ç›‘æ§ç³»ç»Ÿå»ï¼Œé—®é¢˜å°±è½¬æ¢ä¸ºæˆ‘ä»¬å¼€å‘ï¼Œé‡‡é›†å¹¶è¿”å›å“ªäº› HBase é›†ç¾¤ç›‘æ§æŒ‡æ ‡é¡¹ã€‚ HBase é›†ç¾¤ç›‘æ§æŒ‡æ ‡é‡‡é›†çš„ç›‘æ§æ•°æ®ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼šæŸå°æœºå™¨ OS å±‚é¢ä¸Šçš„æ•°æ®ï¼Œä¾‹å¦‚ CPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œã€loadã€ç½‘ç»œæµé‡ç­‰ï¼›æŸå° regionserverï¼ˆæˆ–masterï¼‰æœºå™¨ jvm çš„çŠ¶æ€ï¼Œä¾‹å¦‚å…³äºçº¿ç¨‹çš„ä¿¡æ¯ï¼ŒGC çš„æ¬¡æ•°å’Œæ—¶é—´ï¼Œå†…å­˜ä½¿ç”¨çŠ¶å†µï¼Œä»¥åŠ ERRORã€WARNã€Fatal äº‹ä»¶å‡ºç°çš„æ¬¡æ•°ï¼›regionserverï¼ˆæˆ– masterï¼‰è¿›ç¨‹ä¸­çš„ç»Ÿè®¡ä¿¡æ¯ã€‚ å¯ä»¥é€šè¿‡ä»¥ä¸‹åœ°å€è·å– HBase æä¾›çš„ JMX ä¿¡æ¯çš„ web é¡µé¢ 1http://your_master:60010/jmx //æ‰€æœ‰çš„bean JMX web é¡µé¢çš„æ•°æ®æ ¼å¼æ˜¯jsonæ ¼å¼ï¼Œä¿¡æ¯å¾ˆå¤šï¼ OS ç›‘æ§æ•°æ®HBase ä¸­å¯¹äº OS çš„ç›‘æ§æ•°æ®ï¼Œä¸»è¦æ˜¯ OperatingSystem çš„å¯¹è±¡æ¥è¿›è¡Œçš„ï¼Œå¦‚ä¸‹å°±æ˜¯æˆ‘æå–å‡ºæ¥çš„ JSON ä¿¡æ¯ï¼Œ 1234567891011121314151617181920&#123; \"name\" : \"java.lang:type=OperatingSystem\", \"modelerType\" : \"com.sun.management.UnixOperatingSystem\", \"MaxFileDescriptorCount\" : 1000000, \"OpenFileDescriptorCount\" : 413, \"CommittedVirtualMemorySize\" : 1892225024, \"FreePhysicalMemorySize\" : 284946432, \"FreeSwapSpaceSize\" : 535703552, \"ProcessCpuLoad\" : 0.0016732901066722444, \"ProcessCpuTime\" : 59306210000000, \"SystemCpuLoad\" : 0.018197029910060655, \"TotalPhysicalMemorySize\" : 16660848640, \"TotalSwapSpaceSize\" : 536862720, \"AvailableProcessors\" : 8, \"Arch\" : \"amd64\", \"SystemLoadAverage\" : 0.0, \"Name\" : \"Linux\", \"Version\" : \"2.6.32-431.11.7.el6.ucloud.x86_64\", \"ObjectName\" : \"java.lang:type=OperatingSystem\" &#125; å…¶ä¸­æ¯”è¾ƒé‡è¦çš„æŒ‡æ ‡æœ‰ OpenFileDescriptorCount , FreePhysicalMemorySize , ProcessCpuLoad , SystemCpuLoad , AvailableProcessors , SystemLoadAverage JVM ç›‘æ§æ•°æ®Hbase ä¸­å¯¹äº JVM çš„ç›‘æ§æ•°æ®ï¼Œä¸»è¦æ˜¯ JvmMetrics çš„å¯¹è±¡æ¥è¿›è¡Œçš„ï¼Œå¦‚ä¸‹å°±æ˜¯æˆ‘æå–å‡ºæ¥çš„ JSON ä¿¡æ¯ï¼Œ 12345678910111213141516171819202122232425262728293031&#123; \"name\" : \"Hadoop:service=HBase,name=JvmMetrics\", \"modelerType\" : \"JvmMetrics\", \"tag.Context\" : \"jvm\", \"tag.ProcessName\" : \"Master\", \"tag.SessionId\" : \"\", \"tag.Hostname\" : \"uhadoop-qrljqo-master2\", \"MemNonHeapUsedM\" : 53.846107, \"MemNonHeapCommittedM\" : 85.84375, \"MemNonHeapMaxM\" : 130.0, \"MemHeapUsedM\" : 79.05823, \"MemHeapCommittedM\" : 240.125, \"MemHeapMaxM\" : 989.875, \"MemMaxM\" : 989.875, \"GcCountParNew\" : 15190, \"GcTimeMillisParNew\" : 72300, \"GcCountConcurrentMarkSweep\" : 2, \"GcTimeMillisConcurrentMarkSweep\" : 319, \"GcCount\" : 15192, \"GcTimeMillis\" : 72619, \"ThreadsNew\" : 0, \"ThreadsRunnable\" : 21, \"ThreadsBlocked\" : 0, \"ThreadsWaiting\" : 144, \"ThreadsTimedWaiting\" : 18, \"ThreadsTerminated\" : 0, \"LogFatal\" : 0, \"LogError\" : 0, \"LogWarn\" : 0, \"LogInfo\" : 0 &#125; JvmMetrics ä¸»è¦ç»Ÿè®¡çš„ä¿¡æ¯åŒ…æ‹¬ï¼šå†…å­˜çš„ä½¿ç”¨çŠ¶æ€ä¿¡æ¯ï¼›GCçš„ç»Ÿè®¡ä¿¡æ¯ï¼›çº¿ç¨‹çš„ç»Ÿè®¡ä¿¡æ¯ï¼›ä»¥åŠäº‹ä»¶çš„ç»Ÿè®¡ä¿¡æ¯ã€‚ å†…å­˜çš„ç»Ÿè®¡ä¿¡æ¯ä¸»è¦æ˜¯ï¼šJVM å½“å‰å·²ç»ä½¿ç”¨çš„ NonHeapMemory çš„å¤§å°ã€ä»¥åŠé…ç½®çš„ NonHeapMemory çš„å¤§å°ï¼›JVM å½“å‰å·²ç»ä½¿ç”¨çš„ HeapMemory çš„å¤§å°ã€ä»¥åŠé…ç½®çš„ HeapMemory çš„å¤§å°ï¼› JVM è¿è¡Œæ—¶çš„å¯ä»¥ä½¿ç”¨çš„æœ€å¤§çš„å†…å­˜çš„å¤§å°ã€‚ GC çš„ç»Ÿè®¡è¾ƒä¸ºç®€å•ï¼Œä»…ç»Ÿè®¡äº†è¿›ç¨‹åœ¨å›ºå®šé—´éš”å†… GC çš„æ¬¡æ•°å’ŒèŠ±è´¹çš„æ€»æ—¶é—´ã€‚ çº¿ç¨‹çš„ç»Ÿè®¡ï¼Œä¸»è¦æ˜¯ç»Ÿè®¡è¿›ç¨‹å†…å½“å‰çº¿ç¨‹çš„å¤„äº NEW ã€RUNNABLEã€BLOCKEDã€WAITINGã€TIMED_WAITINGã€TERMINATED è¿™å…­ç§çŠ¶æ€ä¸‹çš„çº¿ç¨‹æ•°é‡ã€‚ å¯¹äºäº‹ä»¶çš„ç»Ÿè®¡ï¼Œä¸»è¦ç»Ÿè®¡å›ºå®šæ—¶é—´é—´éš”å†…çš„ Fatalã€Errorã€Warn ä»¥åŠ Info çš„æ•°é‡ã€‚(è¿™å—å¥½åƒä¸æ€ä¹ˆé‡è¦) Region Servers å¥åº·ä½ ä¹Ÿå¯ä»¥é€šè¿‡å¦‚ä¸‹åœ°å€ï¼š 1http://your_master:60010/jmx?qry=Hadoop:service=HBase,name=Master,sub=Server è·å¾—åˆ° Region Servers å¥åº·å€¼ï¼š 123456789101112131415161718&#123; \"name\" : \"Hadoop:service=HBase,name=Master,sub=Server\", \"modelerType\" : \"Master,sub=Server\", \"tag.liveRegionServers\" : \"xxx\", \"tag.deadRegionServers\" : \"\", \"tag.zookeeperQuorum\" : \"xxx\", \"tag.serverName\" : \"xxx2,60000,1495683310213\", \"tag.clusterId\" : \"e5e044a3-ef9f-48f7-ba63-637376f5fa90\", \"tag.isActiveMaster\" : \"true\", \"tag.Context\" : \"master\", \"tag.Hostname\" : \"xxx\", \"masterActiveTime\" : 1495683312239, \"masterStartTime\" : 1495683310213, \"averageLoad\" : 143.66666666666666, \"numRegionServers\" : 3, \"numDeadRegionServers\" : 0, \"clusterRequests\" : 1297834323 &#125; MemoryPoolä»å…¨éƒ¨çš„ JSON å€¼ä¸­ä½ ä¼šçœ‹åˆ°å¾ˆå¤šç§ MemoryPool å€¼ï¼Œæ¯”å¦‚ Par Eden Space ã€CMS Perm Genã€Par Survivor Spaceã€CMS Old Genã€Code Cache ï¼ŒæŒ‰éœ€è·å–å§ã€‚ æ€»ç»“ä»»ä½•ä¸€ä¸ªæœåŠ¡çš„ç›‘æ§ç³»ç»Ÿéƒ½æ˜¯ä¸€ä¸ªä¸æ–­è¿­ä»£ï¼Œä¸æ–­ä¼˜åŒ–çš„è¿‡ç¨‹ï¼Œä¸å¯èƒ½ä¸€å¼€å§‹å°±åšåˆ°æœ€å¥½ã€‚ç›‘æ§æ€»æ˜¯æ¯”é—®é¢˜å‘ç”Ÿæ¥çš„æ›´æ—©ä¸€äº›ï¼Œè€Œæ¯ä¸€æ¬¡å‡ºé—®é¢˜ï¼Œåˆè¿›ä¸€æ­¥åŠ å¼ºç›¸åº”æ–¹é¢çš„ç›‘æ§ï¼Œæˆ‘ä»¬éœ€è¦è®©ç›‘æ§ç³»ç»Ÿä»å‡ºé—®é¢˜æ—¶æ‰æŠ¥è­¦åˆ°å¯èƒ½å‡ºç°é—®é¢˜æ—¶å°±é¢„è­¦é€æ¸è¿‡æ¸¡ï¼Œæœ€ç»ˆè®©ç›‘æ§ç³»ç»Ÿæˆä¸ºæˆ‘ä»¬ä¿è¯ç³»ç»Ÿç¨³å®šæ€§çš„ä¸€ä¸ªæœ‰åŠ›å·¥å…·ã€‚ æœ€åç›‘æ§æŒ‡æ ‡æœ‰å¾ˆå¤šï¼Œä½†è¯·æŒ‰éœ€è·å– ! è½¬è½½æ–‡ç« è¯·æ³¨æ˜åŸå‡ºå¤„ï¼Œè°¢è°¢æ”¯æŒï¼ http://www.54tianzhisheng.cn/2017/10/21/HBase-metrics/ å‚è€ƒèµ„æ–™1ã€hbaseæ€§èƒ½ç›‘æ§ï¼ˆä¸€ï¼‰ 2ã€hbaseæ€§èƒ½ç›‘æ§ï¼ˆäºŒï¼‰ 3ã€hbaseæ€§èƒ½ç›‘æ§ï¼ˆä¸‰ï¼‰ 4ã€HBase é›†ç¾¤ç›‘æ§ç³»ç»Ÿæ„å»º 5ã€hbase jmxå¸¸ç”¨ç›‘æ§æŒ‡æ ‡ æ¨èç›¸å…³æ–‡ç« 1ã€ElasticSearch å•ä¸ªèŠ‚ç‚¹ç›‘æ§ 2ã€ElasticSearch é›†ç¾¤ç›‘æ§","tags":[{"name":"HBase","slug":"HBase","permalink":"http://www.54tianzhisheng.cn/tags/HBase/"}]},{"title":"Elasticsearch ç³»åˆ—æ–‡ç« ï¼ˆå››ï¼‰ï¼šElasticSearch å•ä¸ªèŠ‚ç‚¹ç›‘æ§","date":"2017-10-17T16:00:00.000Z","path":"2017/10/18/ElasticSearch-nodes-metrics/","text":"é›†ç¾¤å¥åº·ç›‘æ§æ˜¯å¯¹é›†ç¾¤ä¿¡æ¯è¿›è¡Œé«˜åº¦çš„æ¦‚æ‹¬ï¼ŒèŠ‚ç‚¹ç»Ÿè®¡å€¼ API æä¾›äº†é›†ç¾¤ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„ç»Ÿè®¡å€¼ã€‚èŠ‚ç‚¹ç»Ÿè®¡å€¼å¾ˆå¤šï¼Œåœ¨ç›‘æ§çš„æ—¶å€™ä»éœ€è¦æˆ‘ä»¬æ¸…æ¥šå“ªäº›æŒ‡æ ‡æ˜¯æœ€å€¼å¾—å…³æ³¨çš„ã€‚ é›†ç¾¤å¥åº·ç›‘æ§å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼šElasticSearch é›†ç¾¤ç›‘æ§ èŠ‚ç‚¹ä¿¡æ¯ Node Info :1curl -XGET &apos;http://localhost:9200/_nodes&apos; æ‰§è¡Œä¸Šè¿°å‘½ä»¤å¯ä»¥è·å–æ‰€æœ‰ node çš„ä¿¡æ¯ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071_nodes: &#123; total: 2, successful: 2, failed: 0&#125;,cluster_name: \"elasticsearch\",nodes: &#123; MSQ_CZ7mTNyOSlYIfrvHag: &#123; name: \"node0\", transport_address: \"192.168.180.110:9300\", host: \"192.168.180.110\", ip: \"192.168.180.110\", version: \"5.5.0\", build_hash: \"260387d\", total_indexing_buffer: 103887667, roles:&#123;...&#125;, settings: &#123;...&#125;, os: &#123; refresh_interval_in_millis: 1000, name: \"Linux\", arch: \"amd64\", version: \"3.10.0-229.el7.x86_64\", available_processors: 4, allocated_processors: 4 &#125;, process: &#123; refresh_interval_in_millis: 1000, id: 3022, mlockall: false &#125;, jvm: &#123; pid: 3022, version: \"1.8.0_121\", vm_name: \"Java HotSpot(TM) 64-Bit Server VM\", vm_version: \"25.121-b13\", vm_vendor: \"Oracle Corporation\", start_time_in_millis: 1507515225302, mem: &#123; heap_init_in_bytes: 1073741824, heap_max_in_bytes: 1038876672, non_heap_init_in_bytes: 2555904, non_heap_max_in_bytes: 0, direct_max_in_bytes: 1038876672 &#125;, gc_collectors: [], memory_pools: [], using_compressed_ordinary_object_pointers: \"true\", input_arguments:&#123;&#125; &#125; thread_pool:&#123; force_merge: &#123;&#125;, fetch_shard_started: &#123;&#125;, listener: &#123;&#125;, index: &#123;&#125;, refresh: &#123;&#125;, generic: &#123;&#125;, warmer: &#123;&#125;, search: &#123;&#125;, flush: &#123;&#125;, fetch_shard_store: &#123;&#125;, management: &#123;&#125;, get: &#123;&#125;, bulk: &#123;&#125;, snapshot: &#123;&#125; &#125; transport: &#123;...&#125;, http: &#123;...&#125;, plugins: [], modules: [], ingest: &#123;...&#125; &#125; ä¸Šé¢æ˜¯æˆ‘å·²ç»ç®€å†™äº†å¾ˆå¤šæ•°æ®ä¹‹åçš„è¿”å›å€¼ï¼Œä½†æ˜¯æŒ‡æ ‡è¿˜æ˜¯å¾ˆå¤šï¼Œæœ‰äº›æ˜¯ä¸€äº›å¸¸è§„çš„æŒ‡æ ‡ï¼Œå¯¹äºç›‘æ§æ¥è¯´ï¼Œæ²¡å¿…è¦æ‹¿å–ã€‚ä»ä¸Šé¢æˆ‘ä»¬å¯ä»¥ä¸»è¦å…³æ³¨ä»¥ä¸‹è¿™äº›æŒ‡æ ‡: 1os, process, jvm, thread_pool, transport, http, ingest and indices èŠ‚ç‚¹ç»Ÿè®¡ nodes-statisticsèŠ‚ç‚¹ç»Ÿè®¡å€¼ API å¯é€šè¿‡å¦‚ä¸‹å‘½ä»¤è·å–ï¼š 1GET /_nodes/stats å¾—åˆ°ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158_nodes: &#123; total: 2, successful: 2, failed: 0&#125;,cluster_name: \"elasticsearch\",nodes: &#123; MSQ_CZ7mTNyOSlYI0yvHag: &#123; timestamp: 1508312932354, name: \"node0\", transport_address: \"192.168.180.110:9300\", host: \"192.168.180.110\", ip: \"192.168.180.110:9300\", roles: [], indices: &#123; docs: &#123; count: 6163666, deleted: 0 &#125;, store: &#123; size_in_bytes: 2301398179, throttle_time_in_millis: 122850 &#125;, indexing: &#123;&#125;, get: &#123;&#125;, search: &#123;&#125;, merges: &#123;&#125;, refresh: &#123;&#125;, flush: &#123;&#125;, warmer: &#123;&#125;, query_cache: &#123;&#125;, fielddata: &#123;&#125;, completion: &#123;&#125;, segments: &#123;&#125;, translog: &#123;&#125;, request_cache: &#123;&#125;, recovery: &#123;&#125; &#125;, os: &#123; timestamp: 1508312932369, cpu: &#123; percent: 0, load_average: &#123; 1m: 0.09, 5m: 0.12, 15m: 0.08 &#125; &#125;, mem: &#123; total_in_bytes: 8358301696, free_in_bytes: 1381613568, used_in_bytes: 6976688128, free_percent: 17, used_percent: 83 &#125;, swap: &#123; total_in_bytes: 8455712768, free_in_bytes: 8455299072, used_in_bytes: 413696 &#125;, cgroup: &#123; cpuacct: &#123;&#125;, cpu: &#123; control_group: \"/user.slice\", cfs_period_micros: 100000, cfs_quota_micros: -1, stat: &#123;&#125; &#125; &#125;&#125;,process: &#123; timestamp: 1508312932369, open_file_descriptors: 228, max_file_descriptors: 65536, cpu: &#123; percent: 0, total_in_millis: 2495040 &#125;, mem: &#123; total_virtual_in_bytes: 5002465280 &#125;&#125;,jvm: &#123; timestamp: 1508312932369, uptime_in_millis: 797735804, mem: &#123; heap_used_in_bytes: 318233768, heap_used_percent: 30, heap_committed_in_bytes: 1038876672, heap_max_in_bytes: 1038876672, non_heap_used_in_bytes: 102379784, non_heap_committed_in_bytes: 108773376, pools: &#123; young: &#123; used_in_bytes: 62375176, max_in_bytes: 279183360, peak_used_in_bytes: 279183360, peak_max_in_bytes: 279183360 &#125;, survivor: &#123; used_in_bytes: 175384, max_in_bytes: 34865152, peak_used_in_bytes: 34865152, peak_max_in_bytes: 34865152 &#125;, old: &#123; used_in_bytes: 255683208, max_in_bytes: 724828160, peak_used_in_bytes: 255683208, peak_max_in_bytes: 724828160 &#125; &#125; &#125;, threads: &#123;&#125;, gc: &#123;&#125;, buffer_pools: &#123;&#125;, classes: &#123;&#125;&#125;, thread_pool: &#123; bulk: &#123;&#125;, fetch_shard_started: &#123;&#125;, fetch_shard_store: &#123;&#125;, flush: &#123;&#125;, force_merge: &#123;&#125;, generic: &#123;&#125;, get: &#123;&#125;, index: &#123; threads: 1, queue: 0, active: 0, rejected: 0, largest: 1, completed: 1 &#125; listener: &#123;&#125;, management: &#123;&#125;, refresh: &#123;&#125;, search: &#123;&#125;, snapshot: &#123;&#125;, warmer: &#123;&#125; &#125;, fs: &#123;&#125;, transport: &#123; server_open: 13, rx_count: 11696, rx_size_in_bytes: 1525774, tx_count: 10282, tx_size_in_bytes: 1440101928 &#125;, http: &#123; current_open: 4, total_opened: 23 &#125;, breakers: &#123;&#125;, script: &#123;&#125;, discovery: &#123;&#125;, ingest: &#123;&#125;&#125; èŠ‚ç‚¹åæ˜¯ä¸€ä¸ª UUIDï¼Œä¸Šé¢åˆ—ä¸¾äº†å¾ˆå¤šæŒ‡æ ‡ï¼Œä¸‹é¢è®²è§£ä¸‹ï¼š ç´¢å¼•éƒ¨åˆ† indicesè¿™éƒ¨åˆ†åˆ—å‡ºäº†è¿™ä¸ªèŠ‚ç‚¹ä¸Šæ‰€æœ‰ç´¢å¼•çš„èšåˆè¿‡çš„ç»Ÿè®¡å€¼ ï¼š docs å±•ç¤ºèŠ‚ç‚¹å†…å­˜æœ‰å¤šå°‘æ–‡æ¡£ï¼ŒåŒ…æ‹¬è¿˜æ²¡æœ‰ä»æ®µé‡Œæ¸…é™¤çš„å·²åˆ é™¤æ–‡æ¡£æ•°é‡ã€‚ store éƒ¨åˆ†æ˜¾ç¤ºèŠ‚ç‚¹è€—ç”¨äº†å¤šå°‘ç‰©ç†å­˜å‚¨ã€‚è¿™ä¸ªæŒ‡æ ‡åŒ…æ‹¬ä¸»åˆ†ç‰‡å’Œå‰¯æœ¬åˆ†ç‰‡åœ¨å†…ã€‚å¦‚æœé™æµæ—¶é—´å¾ˆå¤§ï¼Œé‚£å¯èƒ½è¡¨æ˜ä½ çš„ç£ç›˜é™æµè®¾ç½®å¾—è¿‡ä½ã€‚ indexing æ˜¾ç¤ºå·²ç»ç´¢å¼•äº†å¤šå°‘æ–‡æ¡£ã€‚è¿™ä¸ªå€¼æ˜¯ä¸€ä¸ªç´¯åŠ è®¡æ•°å™¨ã€‚åœ¨æ–‡æ¡£è¢«åˆ é™¤çš„æ—¶å€™ï¼Œæ•°å€¼ä¸ä¼šä¸‹é™ã€‚è¿˜è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨å‘ç”Ÿå†…éƒ¨ ç´¢å¼•æ“ä½œçš„æ—¶å€™ï¼Œè¿™ä¸ªå€¼ä¹Ÿä¼šå¢åŠ ï¼Œæ¯”å¦‚è¯´æ–‡æ¡£æ›´æ–°ã€‚ è¿˜åˆ—å‡ºäº†ç´¢å¼•æ“ä½œè€—è´¹çš„æ—¶é—´ï¼Œæ­£åœ¨ç´¢å¼•çš„æ–‡æ¡£æ•°é‡ï¼Œä»¥åŠåˆ é™¤æ“ä½œçš„ç±»ä¼¼ç»Ÿè®¡å€¼ã€‚ get æ˜¾ç¤ºé€šè¿‡ ID è·å–æ–‡æ¡£çš„æ¥å£ç›¸å…³çš„ç»Ÿè®¡å€¼ã€‚åŒ…æ‹¬å¯¹å•ä¸ªæ–‡æ¡£çš„ GET å’Œ HEAD è¯·æ±‚ã€‚ search æè¿°åœ¨æ´»è·ƒä¸­çš„æœç´¢ï¼ˆ open_contexts ï¼‰æ•°é‡ã€æŸ¥è¯¢çš„æ€»æ•°é‡ã€ä»¥åŠè‡ªèŠ‚ç‚¹å¯åŠ¨ä»¥æ¥åœ¨æŸ¥è¯¢ä¸Šæ¶ˆè€—çš„æ€»æ—¶é—´ã€‚ç”¨ query_time_in_millis / query_total è®¡ç®—çš„æ¯”å€¼ï¼Œå¯ä»¥ç”¨æ¥ç²—ç•¥çš„è¯„ä»·ä½ çš„æŸ¥è¯¢æœ‰å¤šé«˜æ•ˆã€‚æ¯”å€¼è¶Šå¤§ï¼Œæ¯ä¸ªæŸ¥è¯¢èŠ±è´¹çš„æ—¶é—´è¶Šå¤šï¼Œä½ åº”è¯¥è¦è€ƒè™‘è°ƒä¼˜äº†ã€‚ fetch ç»Ÿè®¡å€¼å±•ç¤ºäº†æŸ¥è¯¢å¤„ç†çš„åä¸€åŠæµç¨‹ï¼ˆquery-then-fetch é‡Œçš„ fetch ï¼‰ã€‚å¦‚æœ fetch è€—æ—¶æ¯” query è¿˜å¤šï¼Œè¯´æ˜ç£ç›˜è¾ƒæ…¢ï¼Œæˆ–è€…è·å–äº†å¤ªå¤šæ–‡æ¡£ï¼Œæˆ–è€…å¯èƒ½æœç´¢è¯·æ±‚è®¾ç½®äº†å¤ªå¤§çš„åˆ†é¡µï¼ˆæ¯”å¦‚ï¼Œ size: 10000 ï¼‰ã€‚ merges åŒ…æ‹¬äº† Lucene æ®µåˆå¹¶ç›¸å…³çš„ä¿¡æ¯ã€‚å®ƒä¼šå‘Šè¯‰ä½ ç›®å‰åœ¨è¿è¡Œå‡ ä¸ªåˆå¹¶ï¼Œåˆå¹¶æ¶‰åŠçš„æ–‡æ¡£æ•°é‡ï¼Œæ­£åœ¨åˆå¹¶çš„æ®µçš„æ€»å¤§å°ï¼Œä»¥åŠåœ¨åˆå¹¶æ“ä½œä¸Šæ¶ˆè€—çš„æ€»æ—¶é—´ã€‚ filter_cache å±•ç¤ºäº†å·²ç¼“å­˜çš„è¿‡æ»¤å™¨ä½é›†åˆæ‰€ç”¨çš„å†…å­˜æ•°é‡ï¼Œä»¥åŠè¿‡æ»¤å™¨è¢«é©±é€å‡ºå†…å­˜çš„æ¬¡æ•°ã€‚è¿‡å¤šçš„é©±é€æ•° å¯èƒ½ è¯´æ˜ä½ éœ€è¦åŠ å¤§è¿‡æ»¤å™¨ç¼“å­˜çš„å¤§å°ï¼Œæˆ–è€…ä½ çš„è¿‡æ»¤å™¨ä¸å¤ªé€‚åˆç¼“å­˜ï¼ˆæ¯”å¦‚å®ƒä»¬å› ä¸ºé«˜åŸºæ•°è€Œåœ¨å¤§é‡äº§ç”Ÿï¼Œå°±åƒæ˜¯ç¼“å­˜ä¸€ä¸ª now æ—¶é—´è¡¨è¾¾å¼ï¼‰ã€‚ ä¸è¿‡ï¼Œé©±é€æ•°æ˜¯ä¸€ä¸ªå¾ˆéš¾è¯„å®šçš„æŒ‡æ ‡ã€‚è¿‡æ»¤å™¨æ˜¯åœ¨æ¯ä¸ªæ®µçš„åŸºç¡€ä¸Šç¼“å­˜çš„ï¼Œè€Œä»ä¸€ä¸ªå°çš„æ®µé‡Œé©±é€è¿‡æ»¤å™¨ï¼Œä»£ä»·æ¯”ä»ä¸€ä¸ªå¤§çš„æ®µé‡Œè¦å»‰ä»·çš„å¤šã€‚æœ‰å¯èƒ½ä½ æœ‰å¾ˆå¤§çš„é©±é€æ•°ï¼Œä½†æ˜¯å®ƒä»¬éƒ½å‘ç”Ÿåœ¨å°æ®µä¸Šï¼Œä¹Ÿå°±æ„å‘³ç€è¿™äº›å¯¹æŸ¥è¯¢æ€§èƒ½åªæœ‰å¾ˆå°çš„å½±å“ã€‚ æŠŠé©±é€æ•°æŒ‡æ ‡ä½œä¸ºä¸€ä¸ªç²—ç•¥çš„å‚è€ƒã€‚å¦‚æœä½ çœ‹åˆ°æ•°å­—å¾ˆå¤§ï¼Œæ£€æŸ¥ä¸€ä¸‹ä½ çš„è¿‡æ»¤å™¨ï¼Œç¡®ä¿ä»–ä»¬éƒ½æ˜¯æ­£å¸¸ç¼“å­˜çš„ã€‚ä¸æ–­é©±é€ç€çš„è¿‡æ»¤å™¨ï¼Œå“ªæ€•éƒ½å‘ç”Ÿåœ¨å¾ˆå°çš„æ®µä¸Šï¼Œæ•ˆæœä¹Ÿæ¯”æ­£ç¡®ç¼“å­˜ä½äº†çš„è¿‡æ»¤å™¨å·®å¾ˆå¤šã€‚ field_data æ˜¾ç¤º fielddata ä½¿ç”¨çš„å†…å­˜ï¼Œ ç”¨ä»¥èšåˆã€æ’åºç­‰ç­‰ã€‚è¿™é‡Œä¹Ÿæœ‰ä¸€ä¸ªé©±é€è®¡æ•°ã€‚å’Œ filter_cache ä¸åŒçš„æ˜¯ï¼Œè¿™é‡Œçš„é©±é€è®¡æ•°æ˜¯å¾ˆæœ‰ç”¨çš„ï¼šè¿™ä¸ªæ•°åº”è¯¥æˆ–è€…è‡³å°‘æ˜¯æ¥è¿‘äº 0ã€‚å› ä¸º fielddata ä¸æ˜¯ç¼“å­˜ï¼Œä»»ä½•é©±é€éƒ½æ¶ˆè€—å·¨å¤§ï¼Œåº”è¯¥é¿å…æ‰ã€‚å¦‚æœä½ åœ¨è¿™é‡Œçœ‹åˆ°é©±é€æ•°ï¼Œä½ éœ€è¦é‡æ–°è¯„ä¼°ä½ çš„å†…å­˜æƒ…å†µï¼Œfielddata é™åˆ¶ï¼Œè¯·æ±‚è¯­å¥ï¼Œæˆ–è€…è¿™ä¸‰è€…ã€‚ segments ä¼šå±•ç¤ºè¿™ä¸ªèŠ‚ç‚¹ç›®å‰æ­£åœ¨æœåŠ¡ä¸­çš„ Lucene æ®µçš„æ•°é‡ã€‚ è¿™æ˜¯ä¸€ä¸ªé‡è¦çš„æ•°å­—ã€‚å¤§å¤šæ•°ç´¢å¼•ä¼šæœ‰å¤§æ¦‚ 50â€“150 ä¸ªæ®µï¼Œå“ªæ€•å®ƒä»¬å­˜æœ‰ TB çº§åˆ«çš„æ•°åäº¿æ¡æ–‡æ¡£ã€‚æ®µæ•°é‡è¿‡å¤§è¡¨æ˜åˆå¹¶å‡ºç°äº†é—®é¢˜ï¼ˆæ¯”å¦‚ï¼Œåˆå¹¶é€Ÿåº¦è·Ÿä¸ä¸Šæ®µçš„åˆ›å»ºï¼‰ã€‚æ³¨æ„è¿™ä¸ªç»Ÿè®¡å€¼æ˜¯èŠ‚ç‚¹ä¸Šæ‰€æœ‰ç´¢å¼•çš„æ±‡èšæ€»æ•°ã€‚è®°ä½è¿™ç‚¹ã€‚ memory ç»Ÿè®¡å€¼å±•ç¤ºäº† Lucene æ®µè‡ªå·±ç”¨æ‰çš„å†…å­˜å¤§å°ã€‚ è¿™é‡ŒåŒ…æ‹¬åº•å±‚æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚å€’æ’è¡¨ï¼Œå­—å…¸ï¼Œå’Œå¸ƒéš†è¿‡æ»¤å™¨ç­‰ã€‚å¤ªå¤§çš„æ®µæ•°é‡ä¼šå¢åŠ è¿™äº›æ•°æ®ç»“æ„å¸¦æ¥çš„å¼€é”€ï¼Œè¿™ä¸ªå†…å­˜ä½¿ç”¨é‡å°±æ˜¯ä¸€ä¸ªæ–¹ä¾¿ç”¨æ¥è¡¡é‡å¼€é”€çš„åº¦é‡å€¼ã€‚ æ“ä½œç³»ç»Ÿå’Œè¿›ç¨‹éƒ¨åˆ†OS å’Œ Process éƒ¨åˆ†åŸºæœ¬æ˜¯è‡ªæè¿°çš„ï¼Œä¸ä¼šåœ¨ç»†èŠ‚ä¸­å±•å¼€è®²è§£ã€‚å®ƒä»¬åˆ—å‡ºæ¥åŸºç¡€çš„èµ„æºç»Ÿè®¡å€¼ï¼Œæ¯”å¦‚ CPU å’Œè´Ÿè½½ã€‚OS éƒ¨åˆ†æè¿°äº†æ•´ä¸ªæ“ä½œç³»ç»Ÿï¼Œè€Œ Process éƒ¨åˆ†åªæ˜¾ç¤º Elasticsearch çš„ JVM è¿›ç¨‹ä½¿ç”¨çš„èµ„æºæƒ…å†µã€‚ è¿™äº›éƒ½æ˜¯éå¸¸æœ‰ç”¨çš„æŒ‡æ ‡ï¼Œä¸è¿‡é€šå¸¸åœ¨ä½ çš„ç›‘æ§æŠ€æœ¯æ ˆé‡Œå·²ç»éƒ½æµ‹é‡å¥½äº†ã€‚ç»Ÿè®¡å€¼åŒ…æ‹¬ä¸‹é¢è¿™äº›ï¼š CPU è´Ÿè½½ å†…å­˜ä½¿ç”¨ç‡ ï¼ˆmem.used_percentï¼‰ Swap ä½¿ç”¨ç‡ æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦ ï¼ˆopen_file_descriptorsï¼‰ JVM éƒ¨åˆ†jvm éƒ¨åˆ†åŒ…æ‹¬äº†è¿è¡Œ Elasticsearch çš„ JVM è¿›ç¨‹ä¸€äº›å¾ˆå…³é”®çš„ä¿¡æ¯ã€‚ æœ€é‡è¦çš„ï¼Œå®ƒåŒ…æ‹¬äº†åƒåœ¾å›æ”¶çš„ç»†èŠ‚ï¼Œè¿™å¯¹ä½ çš„ Elasticsearch é›†ç¾¤çš„ç¨³å®šæ€§æœ‰ç€é‡å¤§å½±å“ã€‚ 123456789101112jvm: &#123; timestamp: 1508312932369, uptime_in_millis: 797735804, mem: &#123; heap_used_in_bytes: 318233768, heap_used_percent: 30, heap_committed_in_bytes: 1038876672, heap_max_in_bytes: 1038876672, non_heap_used_in_bytes: 102379784, non_heap_committed_in_bytes: 108773376, &#125;&#125; jvm éƒ¨åˆ†é¦–å…ˆåˆ—å‡ºä¸€äº›å’Œ heap å†…å­˜ä½¿ç”¨æœ‰å…³çš„å¸¸è§ç»Ÿè®¡å€¼ã€‚ä½ å¯ä»¥çœ‹åˆ°æœ‰å¤šå°‘ heap è¢«ä½¿ç”¨äº†ï¼Œå¤šå°‘è¢«æŒ‡æ´¾äº†ï¼ˆå½“å‰è¢«åˆ†é…ç»™è¿›ç¨‹çš„ï¼‰ï¼Œä»¥åŠ heap è¢«å…è®¸åˆ†é…çš„æœ€å¤§å€¼ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œheap_committed_in_bytes åº”è¯¥ç­‰äº heap_max_in_bytes ã€‚å¦‚æœæŒ‡æ´¾çš„å¤§å°æ›´å°ï¼ŒJVM æœ€ç»ˆä¼šè¢«è¿«è°ƒæ•´ heap å¤§å°â€”â€”è¿™æ˜¯ä¸€ä¸ªéå¸¸æ˜‚è´µçš„æ“ä½œã€‚å¦‚æœä½ çš„æ•°å­—ä¸ç›¸ç­‰ï¼Œé˜…è¯» å †å†…å­˜:å¤§å°å’Œäº¤æ¢ å­¦ä¹ å¦‚ä½•æ­£ç¡®çš„é…ç½®å®ƒã€‚ heap_used_percent æŒ‡æ ‡æ˜¯å€¼å¾—å…³æ³¨çš„ä¸€ä¸ªæ•°å­—ã€‚Elasticsearch è¢«é…ç½®ä¸ºå½“ heap è¾¾åˆ° 75% çš„æ—¶å€™å¼€å§‹ GCã€‚å¦‚æœä½ çš„èŠ‚ç‚¹ä¸€ç›´ &gt;= 75%ï¼Œä½ çš„èŠ‚ç‚¹æ­£å¤„äº å†…å­˜å‹åŠ› çŠ¶æ€ã€‚è¿™æ˜¯ä¸ªå±é™©ä¿¡å·ï¼Œä¸è¿œçš„æœªæ¥å¯èƒ½å°±æœ‰æ…¢ GC è¦å‡ºç°äº†ã€‚ å¦‚æœ heap ä½¿ç”¨ç‡ä¸€ç›´ &gt;=85%ï¼Œä½ å°±éº»çƒ¦äº†ã€‚Heap åœ¨ 90â€“95% ä¹‹é—´ï¼Œåˆ™é¢ä¸´å¯æ€•çš„æ€§èƒ½é£é™©ï¼Œæ­¤æ—¶æœ€å¥½çš„æƒ…å†µæ˜¯é•¿è¾¾ 10â€“30s çš„ GCï¼Œæœ€å·®çš„æƒ…å†µå°±æ˜¯å†…å­˜æº¢å‡ºï¼ˆOOMï¼‰å¼‚å¸¸ã€‚ çº¿ç¨‹æ± éƒ¨åˆ†Elasticsearch åœ¨å†…éƒ¨ç»´æŠ¤äº†çº¿ç¨‹æ± ã€‚ è¿™äº›çº¿ç¨‹æ± ç›¸äº’åä½œå®Œæˆä»»åŠ¡ï¼Œæœ‰å¿…è¦çš„è¯ç›¸äº’é—´è¿˜ä¼šä¼ é€’ä»»åŠ¡ã€‚é€šå¸¸æ¥è¯´ï¼Œä½ ä¸éœ€è¦é…ç½®æˆ–è€…è°ƒä¼˜çº¿ç¨‹æ± ï¼Œä¸è¿‡æŸ¥çœ‹å®ƒä»¬çš„ç»Ÿè®¡å€¼æœ‰æ—¶å€™è¿˜æ˜¯æœ‰ç”¨çš„ï¼Œå¯ä»¥æ´å¯Ÿä½ çš„é›†ç¾¤è¡¨ç°å¦‚ä½•ã€‚ æ¯ä¸ªçº¿ç¨‹æ± ä¼šåˆ—å‡ºå·²é…ç½®çš„çº¿ç¨‹æ•°é‡ï¼ˆ threads ï¼‰ï¼Œå½“å‰åœ¨å¤„ç†ä»»åŠ¡çš„çº¿ç¨‹æ•°é‡ï¼ˆ active ï¼‰ï¼Œä»¥åŠåœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…å¤„ç†çš„ä»»åŠ¡å•å…ƒæ•°é‡ï¼ˆ queue ï¼‰ã€‚ å¦‚æœé˜Ÿåˆ—ä¸­ä»»åŠ¡å•å…ƒæ•°è¾¾åˆ°äº†æé™ï¼Œæ–°çš„ä»»åŠ¡å•å…ƒä¼šå¼€å§‹è¢«æ‹’ç»ï¼Œä½ ä¼šåœ¨ rejected ç»Ÿè®¡å€¼ä¸Šçœ‹åˆ°å®ƒåæ˜ å‡ºæ¥ã€‚è¿™é€šå¸¸æ˜¯ä½ çš„é›†ç¾¤åœ¨æŸäº›èµ„æºä¸Šç¢°åˆ°ç“¶é¢ˆçš„ä¿¡å·ã€‚å› ä¸ºé˜Ÿåˆ—æ»¡æ„å‘³ç€ä½ çš„èŠ‚ç‚¹æˆ–é›†ç¾¤åœ¨ç”¨æœ€é«˜é€Ÿåº¦è¿è¡Œï¼Œä½†ä¾ç„¶è·Ÿä¸ä¸Šå·¥ä½œçš„èœ‚æ‹¥è€Œå…¥ã€‚ è¿™é‡Œçš„ä¸€ç³»åˆ—çš„çº¿ç¨‹æ± ï¼Œå¤§å¤šæ•°ä½ å¯ä»¥å¿½ç•¥ï¼Œä½†æ˜¯æœ‰ä¸€å°éƒ¨åˆ†è¿˜æ˜¯å€¼å¾—å…³æ³¨çš„ï¼š indexing æ™®é€šçš„ç´¢å¼•è¯·æ±‚çš„çº¿ç¨‹æ±  bulk æ‰¹é‡è¯·æ±‚ï¼Œå’Œå•æ¡çš„ç´¢å¼•è¯·æ±‚ä¸åŒçš„çº¿ç¨‹æ±  get Get-by-ID æ“ä½œ search æ‰€æœ‰çš„æœç´¢å’ŒæŸ¥è¯¢è¯·æ±‚ merging ä¸“ç”¨äºç®¡ç† Lucene åˆå¹¶çš„çº¿ç¨‹æ±  ç½‘ç»œéƒ¨åˆ† transport æ˜¾ç¤ºå’Œ ä¼ è¾“åœ°å€ ç›¸å…³çš„ä¸€äº›åŸºç¡€ç»Ÿè®¡å€¼ã€‚åŒ…æ‹¬èŠ‚ç‚¹é—´çš„é€šä¿¡ï¼ˆé€šå¸¸æ˜¯ 9300 ç«¯å£ï¼‰ä»¥åŠä»»æ„ä¼ è¾“å®¢æˆ·ç«¯æˆ–è€…èŠ‚ç‚¹å®¢æˆ·ç«¯çš„è¿æ¥ã€‚å¦‚æœçœ‹åˆ°è¿™é‡Œæœ‰å¾ˆå¤šè¿æ¥æ•°ä¸è¦æ‹…å¿ƒï¼›Elasticsearch åœ¨èŠ‚ç‚¹ä¹‹é—´ç»´æŠ¤äº†å¤§é‡çš„è¿æ¥ã€‚ http æ˜¾ç¤º HTTP ç«¯å£ï¼ˆé€šå¸¸æ˜¯ 9200ï¼‰çš„ç»Ÿè®¡å€¼ã€‚å¦‚æœä½ çœ‹åˆ° total_opened æ•°å¾ˆå¤§è€Œä¸”è¿˜åœ¨ä¸€ç›´ä¸Šæ¶¨ï¼Œè¿™æ˜¯ä¸€ä¸ªæ˜ç¡®ä¿¡å·ï¼Œè¯´æ˜ä½ çš„ HTTP å®¢æˆ·ç«¯é‡Œæœ‰æ²¡å¯ç”¨ keep-alive é•¿è¿æ¥çš„ã€‚æŒç»­çš„ keep-alive é•¿è¿æ¥å¯¹æ€§èƒ½å¾ˆé‡è¦ï¼Œå› ä¸ºè¿æ¥ã€æ–­å¼€å¥—æ¥å­—æ˜¯å¾ˆæ˜‚è´µçš„ï¼ˆè€Œä¸”æµªè´¹æ–‡ä»¶æè¿°ç¬¦ï¼‰ã€‚è¯·ç¡®è®¤ä½ çš„å®¢æˆ·ç«¯éƒ½é…ç½®æ­£ç¡®ã€‚ å‚è€ƒèµ„æ–™1ã€nodes-info 2ã€nodes-stats 3ã€ESç›‘æ§æŒ‡æ ‡ æœ€åï¼šè½¬è½½è¯·æ³¨æ˜åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2017/10/18/ElasticSearch-nodes-metrics/","tags":[{"name":"ElasticSearch","slug":"ElasticSearch","permalink":"http://www.54tianzhisheng.cn/tags/ElasticSearch/"}]},{"title":"Elasticsearch ç³»åˆ—æ–‡ç« ï¼ˆä¸‰ï¼‰ï¼šElasticSearch é›†ç¾¤ç›‘æ§","date":"2017-10-14T16:00:00.000Z","path":"2017/10/15/ElasticSearch-cluster-health-metrics/","text":"æœ€è¿‘åœ¨åš ElasticSearch çš„ä¿¡æ¯ï¼ˆé›†ç¾¤å’ŒèŠ‚ç‚¹ï¼‰ç›‘æ§ï¼Œç‰¹æ­¤ç¨å¾®æ•´ç†ä¸‹å­¦åˆ°çš„ä¸œè¥¿ã€‚è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»é›†ç¾¤çš„ç›‘æ§ã€‚ è¦ç›‘æ§å“ªäº› ElasticSearch metrics Elasticsearch æä¾›äº†å¤§é‡çš„ Metricï¼Œå¯ä»¥å¸®åŠ©æ‚¨æ£€æµ‹åˆ°é—®é¢˜çš„è¿¹è±¡ï¼Œåœ¨é‡åˆ°èŠ‚ç‚¹ä¸å¯ç”¨ã€out-of-memoryã€long garbage collection times çš„æ—¶å€™é‡‡å–ç›¸åº”æªæ–½ã€‚ä½†æ˜¯æŒ‡æ ‡å¤ªå¤šäº†ï¼Œæœ‰æ—¶æˆ‘ä»¬å¹¶ä¸éœ€è¦è¿™ä¹ˆå¤šï¼Œè¿™å°±éœ€è¦æˆ‘ä»¬è¿›è¡Œç­›é€‰ã€‚ é›†ç¾¤å¥åº·ä¸€ä¸ª Elasticsearch é›†ç¾¤è‡³å°‘åŒ…æ‹¬ä¸€ä¸ªèŠ‚ç‚¹å’Œä¸€ä¸ªç´¢å¼•ã€‚æˆ–è€…å®ƒ å¯èƒ½æœ‰ä¸€ç™¾ä¸ªæ•°æ®èŠ‚ç‚¹ã€ä¸‰ä¸ªå•ç‹¬çš„ä¸»èŠ‚ç‚¹ï¼Œä»¥åŠä¸€å°æ‰“å®¢æˆ·ç«¯èŠ‚ç‚¹â€”â€”è¿™äº›å…±åŒæ“ä½œä¸€åƒä¸ªç´¢å¼•ï¼ˆä»¥åŠä¸Šä¸‡ä¸ªåˆ†ç‰‡ï¼‰ã€‚ ä¸ç®¡é›†ç¾¤æ‰©å±•åˆ°å¤šå¤§è§„æ¨¡ï¼Œä½ éƒ½ä¼šæƒ³è¦ä¸€ä¸ªå¿«é€Ÿè·å–é›†ç¾¤çŠ¶æ€çš„é€”å¾„ã€‚Cluster Health API å……å½“çš„å°±æ˜¯è¿™ä¸ªè§’è‰²ã€‚ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆæ˜¯åœ¨ä¸€ä¸‡è‹±å°ºçš„é«˜åº¦é¸Ÿç°é›†ç¾¤ã€‚å®ƒå¯ä»¥å‘Šè¯‰ä½ å®‰å¿ƒå§ä¸€åˆ‡éƒ½å¥½ï¼Œæˆ–è€…è­¦å‘Šä½ é›†ç¾¤æŸä¸ªåœ°æ–¹æœ‰é—®é¢˜ã€‚ è®©æˆ‘ä»¬æ‰§è¡Œä¸€ä¸‹ cluster-health API ç„¶åçœ‹çœ‹å“åº”ä½“æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼š 1GET _cluster/health å’Œ Elasticsearch é‡Œå…¶ä»– API ä¸€æ ·ï¼Œcluster-health ä¼šè¿”å›ä¸€ä¸ª JSON å“åº”ã€‚è¿™å¯¹è‡ªåŠ¨åŒ–å’Œå‘Šè­¦ç³»ç»Ÿæ¥è¯´ï¼Œéå¸¸ä¾¿äºè§£æã€‚å“åº”ä¸­åŒ…å«äº†å’Œä½ é›†ç¾¤æœ‰å…³çš„ä¸€äº›å…³é”®ä¿¡æ¯ï¼š 123456789101112&#123; \"cluster_name\": \"elasticsearch_zach\", \"status\": \"green\", \"timed_out\": false, \"number_of_nodes\": 1, \"number_of_data_nodes\": 1, \"active_primary_shards\": 10, \"active_shards\": 10, \"relocating_shards\": 0, \"initializing_shards\": 0, \"unassigned_shards\": 0&#125; å“åº”ä¿¡æ¯ä¸­æœ€é‡è¦çš„ä¸€å—å°±æ˜¯ status å­—æ®µã€‚çŠ¶æ€å¯èƒ½æ˜¯ä¸‹åˆ—ä¸‰ä¸ªå€¼ä¹‹ä¸€ : status å«ä¹‰ green æ‰€æœ‰çš„ä¸»åˆ†ç‰‡å’Œå‰¯æœ¬åˆ†ç‰‡éƒ½å·²åˆ†é…ã€‚ä½ çš„é›†ç¾¤æ˜¯ 100% å¯ç”¨çš„ã€‚ yellow æ‰€æœ‰çš„ä¸»åˆ†ç‰‡å·²ç»åˆ†ç‰‡äº†ï¼Œä½†è‡³å°‘è¿˜æœ‰ä¸€ä¸ªå‰¯æœ¬æ˜¯ç¼ºå¤±çš„ã€‚ä¸ä¼šæœ‰æ•°æ®ä¸¢å¤±ï¼Œæ‰€ä»¥æœç´¢ç»“æœä¾ç„¶æ˜¯å®Œæ•´çš„ã€‚ä¸è¿‡ï¼Œä½ çš„é«˜å¯ç”¨æ€§åœ¨æŸç§ç¨‹åº¦ä¸Šè¢«å¼±åŒ–ã€‚å¦‚æœ æ›´å¤šçš„ åˆ†ç‰‡æ¶ˆå¤±ï¼Œä½ å°±ä¼šä¸¢æ•°æ®äº†ã€‚æŠŠ yellow æƒ³è±¡æˆä¸€ä¸ªéœ€è¦åŠæ—¶è°ƒæŸ¥çš„è­¦å‘Šã€‚ red è‡³å°‘ä¸€ä¸ªä¸»åˆ†ç‰‡ï¼ˆä»¥åŠå®ƒçš„å…¨éƒ¨å‰¯æœ¬ï¼‰éƒ½åœ¨ç¼ºå¤±ä¸­ã€‚è¿™æ„å‘³ç€ä½ åœ¨ç¼ºå°‘æ•°æ®ï¼šæœç´¢åªèƒ½è¿”å›éƒ¨åˆ†æ•°æ®ï¼Œè€Œåˆ†é…åˆ°è¿™ä¸ªåˆ†ç‰‡ä¸Šçš„å†™å…¥è¯·æ±‚ä¼šè¿”å›ä¸€ä¸ªå¼‚å¸¸ã€‚ number_of_nodes å’Œ number_of_data_nodes è¿™ä¸ªå‘½åå®Œå…¨æ˜¯è‡ªæè¿°çš„ã€‚ active_primary_shards æŒ‡å‡ºä½ é›†ç¾¤ä¸­çš„ä¸»åˆ†ç‰‡æ•°é‡ã€‚è¿™æ˜¯æ¶µç›–äº†æ‰€æœ‰ç´¢å¼•çš„æ±‡æ€»å€¼ã€‚ active_shards æ˜¯æ¶µç›–äº†æ‰€æœ‰ç´¢å¼•çš„æ‰€æœ‰åˆ†ç‰‡çš„æ±‡æ€»å€¼ï¼Œå³åŒ…æ‹¬å‰¯æœ¬åˆ†ç‰‡ã€‚ relocating_shards æ˜¾ç¤ºå½“å‰æ­£åœ¨ä»ä¸€ä¸ªèŠ‚ç‚¹è¿å¾€å…¶ä»–èŠ‚ç‚¹çš„åˆ†ç‰‡çš„æ•°é‡ã€‚é€šå¸¸æ¥è¯´åº”è¯¥æ˜¯ 0ï¼Œä¸è¿‡åœ¨ Elasticsearch å‘ç°é›†ç¾¤ä¸å¤ªå‡è¡¡æ—¶ï¼Œè¯¥å€¼ä¼šä¸Šæ¶¨ã€‚æ¯”å¦‚è¯´ï¼šæ·»åŠ äº†ä¸€ä¸ªæ–°èŠ‚ç‚¹ï¼Œæˆ–è€…ä¸‹çº¿äº†ä¸€ä¸ªèŠ‚ç‚¹ã€‚ initializing_shards æ˜¯åˆšåˆšåˆ›å»ºçš„åˆ†ç‰‡çš„ä¸ªæ•°ã€‚æ¯”å¦‚ï¼Œå½“ä½ åˆšåˆ›å»ºç¬¬ä¸€ä¸ªç´¢å¼•ï¼Œåˆ†ç‰‡éƒ½ä¼šçŸ­æš‚çš„å¤„äº initializing çŠ¶æ€ã€‚è¿™é€šå¸¸ä¼šæ˜¯ä¸€ä¸ªä¸´æ—¶äº‹ä»¶ï¼Œåˆ†ç‰‡ä¸åº”è¯¥é•¿æœŸåœç•™åœ¨ initializingçŠ¶æ€ã€‚ä½ è¿˜å¯èƒ½åœ¨èŠ‚ç‚¹åˆšé‡å¯çš„æ—¶å€™çœ‹åˆ° initializing åˆ†ç‰‡ï¼šå½“åˆ†ç‰‡ä»ç£ç›˜ä¸ŠåŠ è½½åï¼Œå®ƒä»¬ä¼šä»initializing çŠ¶æ€å¼€å§‹ã€‚ unassigned_shards æ˜¯å·²ç»åœ¨é›†ç¾¤çŠ¶æ€ä¸­å­˜åœ¨çš„åˆ†ç‰‡ï¼Œä½†æ˜¯å®é™…åœ¨é›†ç¾¤é‡Œåˆæ‰¾ä¸ç€ã€‚é€šå¸¸æœªåˆ†é…åˆ†ç‰‡çš„æ¥æºæ˜¯æœªåˆ†é…çš„å‰¯æœ¬ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªæœ‰ 5 åˆ†ç‰‡å’Œ 1 å‰¯æœ¬çš„ç´¢å¼•ï¼Œåœ¨å•èŠ‚ç‚¹é›†ç¾¤ä¸Šï¼Œå°±ä¼šæœ‰ 5 ä¸ªæœªåˆ†é…å‰¯æœ¬åˆ†ç‰‡ã€‚å¦‚æœä½ çš„é›†ç¾¤æ˜¯ red çŠ¶æ€ï¼Œä¹Ÿä¼šé•¿æœŸä¿æœ‰æœªåˆ†é…åˆ†ç‰‡ï¼ˆå› ä¸ºç¼ºå°‘ä¸»åˆ†ç‰‡ï¼‰ã€‚ é›†ç¾¤ç»Ÿè®¡é›†ç¾¤ç»Ÿè®¡ä¿¡æ¯åŒ…å« é›†ç¾¤çš„åˆ†ç‰‡æ•°ï¼Œæ–‡æ¡£æ•°ï¼Œå­˜å‚¨ç©ºé—´ï¼Œç¼“å­˜ä¿¡æ¯ï¼Œå†…å­˜ä½¿ç”¨ç‡ï¼Œæ’ä»¶å†…å®¹ï¼Œæ–‡ä»¶ç³»ç»Ÿå†…å®¹ï¼ŒJVM ä½œç”¨çŠ¶å†µï¼Œç³»ç»Ÿ CPUï¼ŒOS ä¿¡æ¯ï¼Œæ®µä¿¡æ¯ã€‚ æŸ¥çœ‹å…¨éƒ¨ç»Ÿè®¡ä¿¡æ¯å‘½ä»¤ï¼š 1curl -XGET &apos;http://localhost:9200/_cluster/stats?human&amp;pretty&apos; è¿”å› JSON ç»“æœï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177&#123; \"timestamp\": 1459427693515, \"cluster_name\": \"elasticsearch\", \"status\": \"green\", \"indices\": &#123; \"count\": 2, \"shards\": &#123; \"total\": 10, \"primaries\": 10, \"replication\": 0, \"index\": &#123; \"shards\": &#123; \"min\": 5, \"max\": 5, \"avg\": 5 &#125;, \"primaries\": &#123; \"min\": 5, \"max\": 5, \"avg\": 5 &#125;, \"replication\": &#123; \"min\": 0, \"max\": 0, \"avg\": 0 &#125; &#125; &#125;, \"docs\": &#123; \"count\": 10, \"deleted\": 0 &#125;, \"store\": &#123; \"size\": \"16.2kb\", \"size_in_bytes\": 16684, \"throttle_time\": \"0s\", \"throttle_time_in_millis\": 0 &#125;, \"fielddata\": &#123; \"memory_size\": \"0b\", \"memory_size_in_bytes\": 0, \"evictions\": 0 &#125;, \"query_cache\": &#123; \"memory_size\": \"0b\", \"memory_size_in_bytes\": 0, \"total_count\": 0, \"hit_count\": 0, \"miss_count\": 0, \"cache_size\": 0, \"cache_count\": 0, \"evictions\": 0 &#125;, \"completion\": &#123; \"size\": \"0b\", \"size_in_bytes\": 0 &#125;, \"segments\": &#123; \"count\": 4, \"memory\": \"8.6kb\", \"memory_in_bytes\": 8898, \"terms_memory\": \"6.3kb\", \"terms_memory_in_bytes\": 6522, \"stored_fields_memory\": \"1.2kb\", \"stored_fields_memory_in_bytes\": 1248, \"term_vectors_memory\": \"0b\", \"term_vectors_memory_in_bytes\": 0, \"norms_memory\": \"384b\", \"norms_memory_in_bytes\": 384, \"doc_values_memory\": \"744b\", \"doc_values_memory_in_bytes\": 744, \"index_writer_memory\": \"0b\", \"index_writer_memory_in_bytes\": 0, \"version_map_memory\": \"0b\", \"version_map_memory_in_bytes\": 0, \"fixed_bit_set\": \"0b\", \"fixed_bit_set_memory_in_bytes\": 0, \"file_sizes\": &#123;&#125; &#125;, \"percolator\": &#123; \"num_queries\": 0 &#125; &#125;, \"nodes\": &#123; \"count\": &#123; \"total\": 1, \"data\": 1, \"coordinating_only\": 0, \"master\": 1, \"ingest\": 1 &#125;, \"versions\": [ \"5.6.3\" ], \"os\": &#123; \"available_processors\": 8, \"allocated_processors\": 8, \"names\": [ &#123; \"name\": \"Mac OS X\", \"count\": 1 &#125; ], \"mem\" : &#123; \"total\" : \"16gb\", \"total_in_bytes\" : 17179869184, \"free\" : \"78.1mb\", \"free_in_bytes\" : 81960960, \"used\" : \"15.9gb\", \"used_in_bytes\" : 17097908224, \"free_percent\" : 0, \"used_percent\" : 100 &#125; &#125;, \"process\": &#123; \"cpu\": &#123; \"percent\": 9 &#125;, \"open_file_descriptors\": &#123; \"min\": 268, \"max\": 268, \"avg\": 268 &#125; &#125;, \"jvm\": &#123; \"max_uptime\": \"13.7s\", \"max_uptime_in_millis\": 13737, \"versions\": [ &#123; \"version\": \"1.8.0_74\", \"vm_name\": \"Java HotSpot(TM) 64-Bit Server VM\", \"vm_version\": \"25.74-b02\", \"vm_vendor\": \"Oracle Corporation\", \"count\": 1 &#125; ], \"mem\": &#123; \"heap_used\": \"57.5mb\", \"heap_used_in_bytes\": 60312664, \"heap_max\": \"989.8mb\", \"heap_max_in_bytes\": 1037959168 &#125;, \"threads\": 90 &#125;, \"fs\": &#123; \"total\": \"200.6gb\", \"total_in_bytes\": 215429193728, \"free\": \"32.6gb\", \"free_in_bytes\": 35064553472, \"available\": \"32.4gb\", \"available_in_bytes\": 34802409472 &#125;, \"plugins\": [ &#123; \"name\": \"analysis-icu\", \"version\": \"5.6.3\", \"description\": \"The ICU Analysis plugin integrates Lucene ICU module into elasticsearch, adding ICU relates analysis components.\", \"classname\": \"org.elasticsearch.plugin.analysis.icu.AnalysisICUPlugin\", \"has_native_controller\": false &#125;, &#123; \"name\": \"ingest-geoip\", \"version\": \"5.6.3\", \"description\": \"Ingest processor that uses looksup geo data based on ip adresses using the Maxmind geo database\", \"classname\": \"org.elasticsearch.ingest.geoip.IngestGeoIpPlugin\", \"has_native_controller\": false &#125;, &#123; \"name\": \"ingest-user-agent\", \"version\": \"5.6.3\", \"description\": \"Ingest processor that extracts information from a user agent\", \"classname\": \"org.elasticsearch.ingest.useragent.IngestUserAgentPlugin\", \"has_native_controller\": false &#125; ] &#125;&#125; å†…å­˜ä½¿ç”¨å’Œ GC æŒ‡æ ‡åœ¨è¿è¡Œ Elasticsearch æ—¶ï¼Œå†…å­˜æ˜¯æ‚¨è¦å¯†åˆ‡ç›‘æ§çš„å…³é”®èµ„æºä¹‹ä¸€ã€‚ Elasticsearch å’Œ Lucene ä»¥ä¸¤ç§æ–¹å¼åˆ©ç”¨èŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰å¯ç”¨ RAMï¼šJVM heap å’Œæ–‡ä»¶ç³»ç»Ÿç¼“å­˜ã€‚ Elasticsearch è¿è¡Œåœ¨Javaè™šæ‹Ÿæœºï¼ˆJVMï¼‰ä¸­ï¼Œè¿™æ„å‘³ç€JVMåƒåœ¾å›æ”¶çš„æŒç»­æ—¶é—´å’Œé¢‘ç‡å°†æˆä¸ºå…¶ä»–é‡è¦çš„ç›‘æ§é¢†åŸŸã€‚ ä¸Šé¢è¿”å›çš„ JSONï¼Œç›‘æ§çš„æŒ‡æ ‡æœ‰æˆ‘ä¸ªäººè§‰å¾—æœ‰è¿™äº›ï¼š nodes.successful nodes.failed nodes.total nodes.mem.used_percent nodes.process.cpu.percent nodes.jvm.mem.heap_used å¯ä»¥çœ‹åˆ° JSON æ–‡ä»¶æ˜¯å¾ˆå¤æ‚çš„ï¼Œå¦‚æœä»è¿™å¤æ‚çš„ JSON ä¸­è·å–åˆ°å¯¹åº”çš„æŒ‡æ ‡ï¼ˆkeyï¼‰çš„å€¼å‘¢ï¼Œè¿™é‡Œè¯·çœ‹æ–‡ç«  ï¼šJsonPath â€”â€” JSON è§£æç¥å™¨ æœ€åè¿™é‡Œä¸»è¦è®²ä¸‹ ES é›†ç¾¤çš„ä¸€äº›ç›‘æ§ä¿¡æ¯ï¼Œæœ‰äº›ç›‘æ§æŒ‡æ ‡æ˜¯ä¸ªäººè§‰å¾—éœ€è¦ç›‘æ§çš„ï¼Œä½†æ˜¯å…·ä½“æƒ…å†µè¿˜æ˜¯å¾—çœ‹éœ€æ±‚äº†ã€‚ä¸‹ç¯‡æ–‡ç« ä¸»è¦è®²èŠ‚ç‚¹çš„ç›‘æ§ä¿¡æ¯ã€‚è½¬è½½è¯·æ³¨æ˜åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2017/10/15/ElasticSearch-cluster-health-metrics/ å‚è€ƒèµ„æ–™1ã€How to monitor Elasticsearch performance 2ã€ElasticSearch æ€§èƒ½ç›‘æ§ 3ã€cluster-health 4ã€cluster-stats ç›¸å…³é˜…è¯»1ã€Elasticsearch é»˜è®¤åˆ†è¯å™¨å’Œä¸­åˆ†åˆ†è¯å™¨ä¹‹é—´çš„æ¯”è¾ƒåŠä½¿ç”¨æ–¹æ³• 2ã€å…¨æ–‡æœç´¢å¼•æ“ Elasticsearch é›†ç¾¤æ­å»ºå…¥é—¨æ•™ç¨‹","tags":[{"name":"ElasticSearch","slug":"ElasticSearch","permalink":"http://www.54tianzhisheng.cn/tags/ElasticSearch/"}]},{"title":"JsonPath â€”â€” JSON è§£æç¥å™¨","date":"2017-10-13T16:00:00.000Z","path":"2017/10/14/JsonPath/","text":"çœŸä¹ƒç¥å™¨ä¹Ÿï¼Œå†å¤æ‚çš„ Json éƒ½èƒ½ç»™ä½ è§£æå‡ºæ¥ï¼Œéå¸¸æ–¹ä¾¿çš„è·å– JSON çš„å†…å®¹ï¼Œå¾ˆå¼ºå¤§ï¼è¯­æ³•ç®€ä»‹ JsonPath æè¿° $ æ ¹èŠ‚ç‚¹ @ å½“å‰èŠ‚ç‚¹ .or[] å­èŠ‚ç‚¹ .. é€‰æ‹©æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„èŠ‚ç‚¹ * æ‰€æœ‰èŠ‚ç‚¹ [] è¿­ä»£å™¨æ ‡ç¤ºï¼Œå¦‚æ•°ç»„ä¸‹æ ‡ [,] æ”¯æŒè¿­ä»£å™¨ä¸­åšå¤šé€‰ [start:end:step] æ•°ç»„åˆ‡ç‰‡è¿ç®—ç¬¦ ?() æ”¯æŒè¿‡æ»¤æ“ä½œ () æ”¯æŒè¡¨è¾¾å¼è®¡ç®— JSON å€¼ï¼š 1234567891011121314151617181920&#123; \"store\": &#123; \"book\": [ &#123; \"category\": \"reference\", \"author\": \"Nigel Rees\", \"title\": \"Sayings of the Century\", \"price\": 8.95 &#125;, &#123; \"category\": \"fiction\", \"author\": \"Evelyn Waugh\", \"title\": \"Sword of Honour\", \"price\": 12.99, \"isbn\": \"0-553-21311-3\" &#125; ], \"bicycle\": &#123; \"color\": \"red\", \"price\": 19.95 &#125; &#125;&#125; å¯¼åŒ…ï¼šimport com.jayway.jsonpath.JsonPath è§£æä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344//è¾“å‡ºbook[0]çš„authorå€¼String author = JsonPath.read(json, \"$.store.book[0].author\");System.out.println(\"author\\t\"+author);//è¾“å‡ºå…¨éƒ¨authorçš„å€¼ï¼Œä½¿ç”¨Iteratorè¿­ä»£List&lt;String&gt; authors = JsonPath.read(json, \"$.store.book[*].author\");System.out.println(\"authors\\t\"+authors);//è¾“å‡ºbook[*]ä¸­category == 'reference'çš„bookList&lt;Object&gt; books = JsonPath.read(json, \"$.store.book[?(@.category == 'reference')]\");System.out.println(\"books\\t\"+books);//è¾“å‡ºbook[*]ä¸­category == 'reference'çš„bookæˆ–è€…List&lt;Object&gt; books2 = JsonPath.read(json, \"$.store.book[?(@.category == 'reference' || @.price&gt;10)]\");System.out.println(\"books2\\t\"+books2);//è¾“å‡ºbook[*]ä¸­category == 'reference'çš„bookçš„authorList&lt;Object&gt; books1 = JsonPath.read(json, \"$.store.book[?(@.category == 'reference')].author\");System.out.println(\"books1\\t\"+books1);//è¾“å‡ºbook[*]ä¸­price&gt;10çš„bookList&lt;Object&gt; b1 = JsonPath.read(json, \"$.store.book[?(@.price&gt;10)]\");System.out.println(\"b1\"+b1);//è¾“å‡ºbook[*]ä¸­å«æœ‰isbnå…ƒç´ çš„bookList&lt;Object&gt; b2 = JsonPath.read(json, \"$.store.book[?(@.isbn)]\");System.out.println(\"b2\"+b2);//è¾“å‡ºè¯¥jsonä¸­æ‰€æœ‰priceçš„å€¼List&lt;Double&gt; prices = JsonPath.read(json, \"$..price\");System.out.println(\"prices\"+prices);//è¾“å‡ºè¯¥jsonä¸­æ‰€æœ‰titleçš„å€¼List&lt;Double&gt; title = JsonPath.read(json, \"$..title\");System.out.println(\"title\"+title);//è¾“å‡ºè¯¥jsonä¸­book 0,1çš„å€¼List&lt;Double&gt; book01 = JsonPath.read(json, \"$..book[0,1]\");System.out.println(\"book01\"+book01);/* //è¾“å‡ºè¯¥jsonä¸­book 0,1çš„å€¼List&lt;Double&gt; book012 = JsonPath.read(json, \"$..book[-2:]\");System.out.println(\"book012\"+book012);*///å¯ä»¥æå‰ç¼–è¾‘ä¸€ä¸ªè·¯å¾„ï¼Œå¹¶å¤šæ¬¡ä½¿ç”¨å®ƒJsonPath path = JsonPath.compile(\"$.store.book[*]\");List&lt;Object&gt; b3 = path.read(json);System.out.println(\"path\\t\"+path+\"\\n\"+b3); ç”¨æ³•æ¯”è¾ƒç®€å•ï¼Œå¤šä½¿ç”¨å‡ æ¬¡å°±ä¼šä½¿ç”¨äº†ï¼æ–‡ç« ä¸»è¦å‚è€ƒç½‘ä¸Šï¼åŸè°…å¾ˆå¤šå¤©ä¸è·Ÿåšçš„æˆ‘ç°åœ¨ç«Ÿç„¶è¿™æ ·æ°´äº†è¿™ä¹ˆä¸€ç¯‡æ–‡ç« ï¼Œå“ˆå“ˆï¼å®åœ¨æ˜¯å¿™ï¼","tags":[{"name":"JSON","slug":"JSON","permalink":"http://www.54tianzhisheng.cn/tags/JSON/"}]},{"title":"Centos7 æ­å»ºæœ€æ–° Nexus3 Maven ç§æœ","date":"2017-10-13T16:00:00.000Z","path":"2017/10/14/Nexus3-Maven/","text":"Maven ä»‹ç»Apache Maven æ˜¯ä¸€ä¸ªåˆ›æ–°çš„è½¯ä»¶é¡¹ç›®ç®¡ç†å’Œç»¼åˆå·¥å…·ã€‚Maven æä¾›äº†ä¸€ä¸ªåŸºäºé¡¹ç›®å¯¹è±¡æ¨¡å‹ï¼ˆPOMï¼‰æ–‡ä»¶çš„æ–°æ¦‚å¿µæ¥ç®¡ç†é¡¹ç›®çš„æ„å»ºï¼Œå¯ä»¥ä»ä¸€ä¸ªä¸­å¿ƒèµ„æ–™ç‰‡ç®¡ç†é¡¹ç›®æ„å»ºï¼ŒæŠ¥å‘Šå’Œæ–‡ä»¶ã€‚Maven æœ€å¼ºå¤§çš„åŠŸèƒ½å°±æ˜¯èƒ½å¤Ÿè‡ªåŠ¨ä¸‹è½½é¡¹ç›®ä¾èµ–åº“ã€‚Maven æä¾›äº†å¼€å‘äººå‘˜æ„å»ºä¸€ä¸ªå®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸæ¡†æ¶ã€‚å¼€å‘å›¢é˜Ÿå¯ä»¥è‡ªåŠ¨å®Œæˆé¡¹ç›®çš„åŸºç¡€å·¥å…·å»ºè®¾ï¼ŒMaven ä½¿ç”¨æ ‡å‡†çš„ç›®å½•ç»“æ„å’Œé»˜è®¤æ„å»ºç”Ÿå‘½å‘¨æœŸã€‚åœ¨å¤šä¸ªå¼€å‘å›¢é˜Ÿç¯å¢ƒæ—¶ï¼ŒMaven å¯ä»¥è®¾ç½®æŒ‰æ ‡å‡†åœ¨éå¸¸çŸ­çš„æ—¶é—´é‡Œå®Œæˆé…ç½®å·¥ä½œã€‚ç”±äºå¤§éƒ¨åˆ†é¡¹ç›®çš„è®¾ç½®éƒ½å¾ˆç®€å•ï¼Œå¹¶ä¸”å¯é‡å¤ä½¿ç”¨ï¼ŒMaven è®©å¼€å‘äººå‘˜çš„å·¥ä½œæ›´è½»æ¾ï¼ŒåŒæ—¶åˆ›å»ºæŠ¥è¡¨ï¼Œæ£€æŸ¥ï¼Œæ„å»ºå’Œæµ‹è¯•è‡ªåŠ¨åŒ–è®¾ç½®ã€‚Maven é¡¹ç›®çš„ç»“æ„å’Œå†…å®¹åœ¨ä¸€ä¸ª XML æ–‡ä»¶ä¸­å£°æ˜ï¼Œpom.xml é¡¹ç›®å¯¹è±¡æ¨¡å‹ï¼ˆPOMï¼‰ï¼Œè¿™æ˜¯æ•´ä¸ª Maven ç³»ç»Ÿçš„åŸºæœ¬å•å…ƒã€‚ Maven æä¾›äº†å¼€å‘äººå‘˜çš„æ–¹å¼æ¥ç®¡ç†ï¼š1ï¼‰Builds2ï¼‰Documentation3ï¼‰Reporting4ï¼‰Dependencies5ï¼‰SCMs6ï¼‰Releases7ï¼‰Distribution8ï¼‰mailing listæ¦‚æ‹¬åœ°è¯´ï¼ŒMaven ç®€åŒ–å’Œæ ‡å‡†åŒ–é¡¹ç›®å»ºè®¾è¿‡ç¨‹ã€‚å¤„ç†ç¼–è¯‘ï¼Œåˆ†é…ï¼Œæ–‡æ¡£ï¼Œå›¢é˜Ÿåä½œå’Œå…¶ä»–ä»»åŠ¡çš„æ— ç¼è¿æ¥ã€‚Maven å¢åŠ å¯é‡ç”¨æ€§å¹¶è´Ÿè´£å»ºç«‹ç›¸å…³çš„ä»»åŠ¡ã€‚Maven æœ€åˆè®¾è®¡ï¼Œæ˜¯ä»¥ç®€åŒ– Jakarta Turbine é¡¹ç›®çš„å»ºè®¾ã€‚åœ¨å‡ ä¸ªé¡¹ç›®ï¼Œæ¯ä¸ªé¡¹ç›®åŒ…å«äº†ä¸åŒçš„ Ant æ„å»ºæ–‡ä»¶ã€‚ JAR æ£€æŸ¥åˆ° CVSã€‚Apache ç»„ç»‡å¼€å‘ Maven å¯ä»¥å»ºç«‹å¤šä¸ªé¡¹ç›®ï¼Œå‘å¸ƒé¡¹ç›®ä¿¡æ¯ï¼Œé¡¹ç›®éƒ¨ç½²ï¼Œåœ¨å‡ ä¸ªé¡¹ç›®ä¸­ JAR æ–‡ä»¶æä¾›å›¢é˜Ÿåˆä½œå’Œå¸®åŠ©ã€‚ Maven ä¸»è¦ç›®æ ‡æ˜¯æä¾›ç»™å¼€å‘äººå‘˜ï¼š1ï¼‰é¡¹ç›®æ˜¯å¯é‡å¤ä½¿ç”¨ï¼Œæ˜“ç»´æŠ¤ï¼Œæ›´å®¹æ˜“ç†è§£çš„ä¸€ä¸ªç»¼åˆæ¨¡å‹ã€‚2ï¼‰æ’ä»¶æˆ–äº¤äº’çš„å·¥å…·ï¼Œè¿™ç§å£°æ˜æ€§çš„æ¨¡å¼ã€‚ ç§æœä»‹ç»ç§æœæ˜¯æŒ‡ç§æœ‰æœåŠ¡å™¨ï¼Œæ˜¯æ¶è®¾åœ¨å±€åŸŸç½‘çš„ä¸€ç§ç‰¹æ®Šçš„è¿œç¨‹ä»“åº“ï¼Œç›®çš„æ˜¯ä»£ç†è¿œç¨‹ä»“åº“åŠéƒ¨ç½²ç¬¬ä¸‰æ–¹æ„å»ºã€‚æœ‰äº†ç§æœä¹‹åï¼Œå½“ Maven éœ€è¦ä¸‹è½½æ„ä»¶æ—¶ï¼Œç›´æ¥è¯·æ±‚ç§æœï¼Œç§æœä¸Šå­˜åœ¨åˆ™ä¸‹è½½åˆ°æœ¬åœ°ä»“åº“ï¼›å¦åˆ™ï¼Œç§æœè¯·æ±‚å¤–éƒ¨çš„è¿œç¨‹ä»“åº“ï¼Œå°†æ„ä»¶ä¸‹è½½åˆ°ç§æœï¼Œå†æä¾›ç»™æœ¬åœ°ä»“åº“ä¸‹è½½ã€‚ Nexus ä»‹ç»Nexus æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ Maven ä»“åº“ç®¡ç†å™¨ï¼Œå®ƒæå¤§åœ°ç®€åŒ–äº†æœ¬åœ°å†…éƒ¨ä»“åº“çš„ç»´æŠ¤å’Œå¤–éƒ¨ä»“åº“çš„è®¿é—®ã€‚å¦‚æœä½¿ç”¨äº†å…¬å…±çš„ Maven ä»“åº“æœåŠ¡å™¨ï¼Œå¯ä»¥ä» Maven ä¸­å¤®ä»“åº“ä¸‹è½½æ‰€éœ€è¦çš„æ„ä»¶ï¼ˆArtifactï¼‰ï¼Œä½†è¿™é€šå¸¸ä¸æ˜¯ä¸€ä¸ªå¥½çš„åšæ³•ã€‚æ­£å¸¸åšæ³•æ˜¯åœ¨æœ¬åœ°æ¶è®¾ä¸€ä¸ª Maven ä»“åº“æœåŠ¡å™¨ï¼Œå³åˆ©ç”¨ Nexus ç§æœå¯ä»¥åªåœ¨ä¸€ä¸ªåœ°æ–¹å°±èƒ½å¤Ÿå®Œå…¨æ§åˆ¶è®¿é—®å’Œéƒ¨ç½²åœ¨ä½ æ‰€ç»´æŠ¤ä»“åº“ä¸­çš„æ¯ä¸ª Artifactã€‚Nexus åœ¨ä»£ç†è¿œç¨‹ä»“åº“çš„åŒæ—¶ç»´æŠ¤æœ¬åœ°ä»“åº“ï¼Œä»¥é™ä½ä¸­å¤®ä»“åº“çš„è´Ÿè·, èŠ‚çœå¤–ç½‘å¸¦å®½å’Œæ—¶é—´ï¼ŒNexus ç§æœå°±å¯ä»¥æ»¡è¶³è¿™æ ·çš„éœ€è¦ã€‚Nexus æ˜¯ä¸€å¥— â€œå¼€ç®±å³ç”¨â€ çš„ç³»ç»Ÿä¸éœ€è¦æ•°æ®åº“ï¼Œå®ƒä½¿ç”¨æ–‡ä»¶ç³»ç»ŸåŠ  Lucene æ¥ç»„ç»‡æ•°æ®ã€‚Nexus ä½¿ç”¨ ExtJS æ¥å¼€å‘ç•Œé¢ï¼Œåˆ©ç”¨ Restlet æ¥æä¾›å®Œæ•´çš„ REST APIsï¼Œé€šè¿‡ m2eclipse ä¸ Eclipse é›†æˆä½¿ç”¨ã€‚Nexus æ”¯æŒ WebDAV ä¸ LDAP å®‰å…¨èº«ä»½è®¤è¯ã€‚Nexus è¿˜æä¾›äº†å¼ºå¤§çš„ä»“åº“ç®¡ç†åŠŸèƒ½ï¼Œæ„ä»¶æœç´¢åŠŸèƒ½ï¼Œå®ƒåŸºäº RESTï¼Œå‹å¥½çš„ UI æ˜¯ä¸€ä¸ª extjs çš„ REST å®¢æˆ·ç«¯ï¼Œå®ƒå ç”¨è¾ƒå°‘çš„å†…å­˜ï¼ŒåŸºäºç®€å•æ–‡ä»¶ç³»ç»Ÿè€Œéæ•°æ®åº“ã€‚ ä¸ºä»€ä¹ˆè¦æ„å»º Nexus ç§æœï¼Ÿå¦‚æœæ²¡æœ‰ Nexus ç§æœï¼Œæˆ‘ä»¬æ‰€éœ€çš„æ‰€æœ‰æ„ä»¶éƒ½éœ€è¦é€šè¿‡ maven çš„ä¸­å¤®ä»“åº“å’Œç¬¬ä¸‰æ–¹çš„ Maven ä»“åº“ä¸‹è½½åˆ°æœ¬åœ°ï¼Œè€Œä¸€ä¸ªå›¢é˜Ÿä¸­çš„æ‰€æœ‰äººéƒ½é‡å¤çš„ä» maven ä»“åº“ä¸‹è½½æ„ä»¶æ— ç–‘åŠ å¤§äº†ä»“åº“çš„è´Ÿè½½å’Œæµªè´¹äº†å¤–ç½‘å¸¦å®½ï¼Œå¦‚æœç½‘é€Ÿæ…¢çš„è¯ï¼Œè¿˜ä¼šå½±å“é¡¹ç›®çš„è¿›ç¨‹ã€‚å¾ˆå¤šæƒ…å†µä¸‹é¡¹ç›®çš„å¼€å‘éƒ½æ˜¯åœ¨å†…ç½‘è¿›è¡Œçš„ï¼Œè¿æ¥ä¸åˆ° maven ä»“åº“æ€ä¹ˆåŠå‘¢ï¼Ÿå¼€å‘çš„å…¬å…±æ„ä»¶æ€ä¹ˆè®©å…¶å®ƒé¡¹ç›®ä½¿ç”¨ï¼Ÿè¿™ä¸ªæ—¶å€™æˆ‘ä»¬ä¸å¾—ä¸ä¸ºè‡ªå·±çš„å›¢é˜Ÿæ­å»ºå±äºè‡ªå·±çš„ maven ç§æœï¼Œè¿™æ ·æ—¢èŠ‚çœäº†ç½‘ç»œå¸¦å®½ä¹Ÿä¼šåŠ é€Ÿé¡¹ç›®æ­å»ºçš„è¿›ç¨‹ï¼Œå½“ç„¶å‰ææ¡ä»¶å°±æ˜¯ä½ çš„ç§æœä¸­æ‹¥æœ‰é¡¹ç›®æ‰€éœ€çš„æ‰€æœ‰æ„ä»¶ã€‚ æ€»ä¹‹ï¼Œåœ¨æœ¬åœ°æ„å»º nexus ç§æœçš„å¥½å¤„æœ‰ï¼š1ï¼‰åŠ é€Ÿæ„å»ºï¼›2ï¼‰èŠ‚çœå¸¦å®½ï¼›3ï¼‰èŠ‚çœä¸­å¤® maven ä»“åº“çš„å¸¦å®½ï¼›4ï¼‰ç¨³å®šï¼ˆåº”ä»˜ä¸€æ—¦ä¸­å¤®æœåŠ¡å™¨å‡ºé—®é¢˜çš„æƒ…å†µï¼‰ï¼›5ï¼‰æ§åˆ¶å’Œå®¡è®¡ï¼›6ï¼‰èƒ½å¤Ÿéƒ¨ç½²ç¬¬ä¸‰æ–¹æ„ä»¶ï¼›7ï¼‰å¯ä»¥å»ºç«‹æœ¬åœ°å†…éƒ¨ä»“åº“ï¼›8ï¼‰å¯ä»¥å»ºç«‹å…¬å…±ä»“åº“è¿™äº›ä¼˜ç‚¹ä½¿å¾— Nexus æ—¥è¶‹æˆä¸ºæœ€æµè¡Œçš„ Maven ä»“åº“ç®¡ç†å™¨ã€‚ 1. å®‰è£… jdk1.8å…³äº jdk1.8 çš„å®‰è£…, åœ¨è¿™é‡Œå°±ä¸åšèµ˜è¿°äº† 2. å®‰è£… mavenå…³äº maven çš„å®‰è£…, æœ¬æ–‡åœ¨è¿™é‡Œå°±ä¸è¯¦ç»†å†™äº† 3. å®‰è£… nexus31. ä¸‹è½½ nexus-3.6.0-02-unix.tar.gzå®˜ç½‘é“¾æ¥åœ°å€ï¼šhttps://www.sonatype.com/download-oss-sonatype ä¸‹è½½ linux æœ€æ–°ç‰ˆæœ¬ï¼Œç›´æ¥ä¸‹è½½é€Ÿåº¦å¯èƒ½å¾ˆæ…¢ï¼Œå»ºè®®ç”¨è¿…é›·ä¸‹è½½ä¼šå¿«å¾ˆå¤šçš„ã€‚ 2. è§£å‹1tar -zxvf nexus-3.6.0-02-unix.tar.gz -C /usr/local/ 3. å¯åŠ¨ nexus312cd /usr/local/nexus-3.6.0-02/bin/./nexus run &amp; ç¨ç­‰ä¸€ä¼š (é¦–æ¬¡å¯åŠ¨ä¼šæ¯”è¾ƒæ…¢), å½“å‡ºç°ä»¥ä¸‹æ—¥å¿—çš„æ—¶å€™è¡¨ç¤ºå¯åŠ¨æˆåŠŸ! 12345-------------------------------------------------Started Sonatype Nexus OSS 3.6.0-02------------------------------------------------- 4. å¼€å¯è¿œç¨‹è®¿é—®ç«¯å£å…³é—­é˜²ç«å¢™ï¼Œå¹¶å¼€å¯è¿œç¨‹è®¿é—®ç«¯å£ 8081 123vim /etc/sysconfig/iptablesæ·»åŠ ï¼š-A INPUT -p tcp -m state --state NEW -m tcp --dport 8081 -j ACCEPT 5. æµ‹è¯• 123nexus3é»˜è®¤ç«¯å£æ˜¯:8081nexus3é»˜è®¤è´¦å·æ˜¯:adminnexus3é»˜è®¤å¯†ç æ˜¯:admin123 6. è®¾ç½®å¼€æœºè‡ªå¯åŠ¨123ln -s /usr/local/nexus-3.6.0-02/bin/nexus /etc/init.d/nexus3chkconfig --add nexus3chkconfig nexus3 on 7. ä¿®æ”¹ nexus3 çš„è¿è¡Œç”¨æˆ·ä¸º root1vim nexus.rc 12//è®¾ç½®run_as_user=&quot;root&quot; 8. ä¿®æ”¹ nexus3 å¯åŠ¨æ—¶è¦ä½¿ç”¨çš„ jdk ç‰ˆæœ¬1vim nexus ç¬¬ 14 è¡Œ: 1INSTALL4J_JAVA_HOME_OVERRIDE=/usr/local/java/jdk1.8.0_144 9. ä¿®æ”¹ nexus3 é»˜è®¤ç«¯å£ (å¯é€‰)12cd /usr/local/nexus-3.6.0-02/etc/vim nexus-default.properties é»˜è®¤ç«¯å£: 8081 1application-port=8081 10. ä¿®æ”¹ nexus3 æ•°æ®ä»¥åŠç›¸å…³æ—¥å¿—çš„å­˜å‚¨ä½ç½® (å¯é€‰)ï¼š12[root@MiWiFi-R3-srv bin]# cd /usr/local/nexus-3.6.0-02/bin/[root@MiWiFi-R3-srv bin]# vim nexus.vmoptions 123-XX:LogFile=./sonatype-work/nexus3/log/jvm.log-Dkaraf.data=./sonatype-work/nexus3-Djava.io.tmpdir=./sonatype-work/nexus3/tmp å‡ºç°ä¸Šé¢ 5 ä¸­çš„æµ‹è¯•é¡µé¢ï¼Œè¯´æ˜é…ç½® nexus æˆåŠŸï¼ ç‚¹å‡»å³ä¸Šè§’ â€œLog inâ€ï¼Œ è¾“å…¥é»˜è®¤ç”¨æˆ·å (admin) å’Œé»˜è®¤å¯†ç ï¼ˆadmin123ï¼‰ç™»å½• è‡³æ­¤, nexus3_maven çš„ç§æœå°±æ­å»ºå®Œæˆäº†!!! å¯ä»¥ç‚¹å‡»ä¸Šé¢çš„ â€œè®¾ç½®â€ å›¾æ ‡ï¼Œåœ¨ â€œè®¾ç½®â€ é‡Œå¯ä»¥æ·»åŠ ç”¨æˆ·ã€è§’è‰²ï¼Œå¯¹æ¥ LDAP ç­‰çš„è®¾ç½®ï¼Œå¦‚ä¸‹ï¼š å¯ä»¥åœ¨ â€œç®¡ç†â€ é‡ŒæŸ¥çœ‹ nexus çš„ç³»ç»Ÿä¿¡æ¯ æ³¨æ„ï¼š1.component name çš„ä¸€äº›è¯´æ˜ï¼š 1ï¼‰maven-centralï¼šmaven ä¸­å¤®åº“ï¼Œé»˜è®¤ä» https://repo1.maven.org/maven2 / æ‹‰å– jar 2ï¼‰maven-releasesï¼šç§åº“å‘è¡Œç‰ˆ jar 3ï¼‰maven-snapshotsï¼šç§åº“å¿«ç…§ï¼ˆè°ƒè¯•ç‰ˆæœ¬ï¼‰jar 4ï¼‰maven-publicï¼šä»“åº“åˆ†ç»„ï¼ŒæŠŠä¸Šé¢ä¸‰ä¸ªä»“åº“ç»„åˆåœ¨ä¸€èµ·å¯¹å¤–æä¾›æœåŠ¡ï¼Œåœ¨æœ¬åœ° maven åŸºç¡€é…ç½® settings.xml ä¸­ä½¿ç”¨ã€‚ 2.Nexus é»˜è®¤çš„ä»“åº“ç±»å‹æœ‰ä»¥ä¸‹å››ç§ï¼š 1ï¼‰group(ä»“åº“ç»„ç±»å‹)ï¼šåˆå«ç»„ä»“åº“ï¼Œç”¨äºæ–¹ä¾¿å¼€å‘äººå‘˜è‡ªå·±è®¾å®šçš„ä»“åº“ï¼› 2ï¼‰hosted(å®¿ä¸»ç±»å‹)ï¼šå†…éƒ¨é¡¹ç›®çš„å‘å¸ƒä»“åº“ï¼ˆå†…éƒ¨å¼€å‘äººå‘˜ï¼Œå‘å¸ƒä¸Šå»å­˜æ”¾çš„ä»“åº“ï¼‰ï¼› 3ï¼‰proxy(ä»£ç†ç±»å‹)ï¼šä»è¿œç¨‹ä¸­å¤®ä»“åº“ä¸­å¯»æ‰¾æ•°æ®çš„ä»“åº“ï¼ˆå¯ä»¥ç‚¹å‡»å¯¹åº”çš„ä»“åº“çš„ Configuration é¡µç­¾ä¸‹ Remote Storage Location å±æ€§çš„å€¼å³è¢«ä»£ç†çš„è¿œç¨‹ä»“åº“çš„è·¯å¾„ï¼‰ï¼› 4ï¼‰virtual(è™šæ‹Ÿç±»å‹)ï¼šè™šæ‹Ÿä»“åº“ï¼ˆè¿™ä¸ªåŸºæœ¬ç”¨ä¸åˆ°ï¼Œé‡ç‚¹å…³æ³¨ä¸Šé¢ä¸‰ä¸ªä»“åº“çš„ä½¿ç”¨ï¼‰ï¼› 3.Policy(ç­–ç•¥): è¡¨ç¤ºè¯¥ä»“åº“ä¸ºå‘å¸ƒ (Release) ç‰ˆæœ¬ä»“åº“è¿˜æ˜¯å¿«ç…§ (Snapshot) ç‰ˆæœ¬ä»“åº“ï¼› 4.Public Repositories ä¸‹çš„ä»“åº“ 1ï¼‰3rd party: æ— æ³•ä»å…¬å…±ä»“åº“è·å¾—çš„ç¬¬ä¸‰æ–¹å‘å¸ƒç‰ˆæœ¬çš„æ„ä»¶ä»“åº“ï¼Œå³ç¬¬ä¸‰æ–¹ä¾èµ–çš„ä»“åº“ï¼Œè¿™ä¸ªæ•°æ®é€šå¸¸æ˜¯ç”±å†…éƒ¨äººå‘˜è‡ªè¡Œä¸‹è½½ä¹‹åå‘å¸ƒä¸Šå»ï¼› 2ï¼‰Apache Snapshots: ç”¨äº†ä»£ç† ApacheMaven ä»“åº“å¿«ç…§ç‰ˆæœ¬çš„æ„ä»¶ä»“åº“ 3ï¼‰Central: ç”¨æ¥ä»£ç† maven ä¸­å¤®ä»“åº“ä¸­å‘å¸ƒç‰ˆæœ¬æ„ä»¶çš„ä»“åº“ 4ï¼‰Central M1 shadow: ç”¨äºæä¾›ä¸­å¤®ä»“åº“ä¸­ M1 æ ¼å¼çš„å‘å¸ƒç‰ˆæœ¬çš„æ„ä»¶é•œåƒä»“åº“ 5ï¼‰Codehaus Snapshots: ç”¨æ¥ä»£ç† CodehausMaven ä»“åº“çš„å¿«ç…§ç‰ˆæœ¬æ„ä»¶çš„ä»“åº“ 6ï¼‰Releases: å†…éƒ¨çš„æ¨¡å—ä¸­ release æ¨¡å—çš„å‘å¸ƒä»“åº“ï¼Œç”¨æ¥éƒ¨ç½²ç®¡ç†å†…éƒ¨çš„å‘å¸ƒç‰ˆæœ¬æ„ä»¶çš„å®¿ä¸»ç±»å‹ä»“åº“ï¼›release æ˜¯å‘å¸ƒç‰ˆæœ¬ï¼› 7ï¼‰Snapshots: å‘å¸ƒå†…éƒ¨çš„ SNAPSHOT æ¨¡å—çš„ä»“åº“ï¼Œç”¨æ¥éƒ¨ç½²ç®¡ç†å†…éƒ¨çš„å¿«ç…§ç‰ˆæœ¬æ„ä»¶çš„å®¿ä¸»ç±»å‹ä»“åº“ï¼›snapshots æ˜¯å¿«ç…§ç‰ˆæœ¬ï¼Œä¹Ÿå°±æ˜¯ä¸ç¨³å®šç‰ˆæœ¬æ‰€ä»¥è‡ªå®šä¹‰æ„å»ºçš„ä»“åº“ç»„ä»£ç†ä»“åº“çš„é¡ºåºä¸ºï¼šReleasesï¼ŒSnapshotsï¼Œ3rd partyï¼ŒCentralã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ oschina æ”¾åˆ° Central å‰é¢ï¼Œä¸‹è½½åŒ…ä¼šæ›´å¿«ã€‚ 5.Nexus é»˜è®¤çš„ç«¯å£æ˜¯ 8081ï¼Œå¯ä»¥åœ¨ etc/nexus-default.properties é…ç½®ä¸­ä¿®æ”¹ã€‚ 6.Nexus é»˜è®¤çš„ç”¨æˆ·åå¯†ç æ˜¯ admin/admin123 å½“é‡åˆ°å¥‡æ€ªé—®é¢˜æ—¶ï¼Œé‡å¯ nexusï¼Œé‡å¯å web ç•Œé¢è¦ 1 åˆ†é’Ÿå·¦å³åæ‰èƒ½è®¿é—®ã€‚ 8.Nexus çš„å·¥ä½œç›®å½•æ˜¯ sonatype-workï¼ˆè·¯å¾„ä¸€èˆ¬åœ¨ nexus åŒçº§ç›®å½•ä¸‹ï¼‰12345678[root@master-node local]# pwd/usr/local[root@master-node local]# ls nexus/bin deploy etc lib LICENSE.txt NOTICE.txt public system[root@master-node local]# ls sonatype-work/nexus3[root@master-node local]# ls sonatype-work/nexus3/backup blobs cache db elasticsearch etc generated-bundles health-check instances keystores lock log orient port tmp Nexus ä»“åº“åˆ†ç±»çš„æ¦‚å¿µï¼š1ï¼‰Maven å¯ç›´æ¥ä»å®¿ä¸»ä»“åº“ä¸‹è½½æ„ä»¶, ä¹Ÿå¯ä»¥ä»ä»£ç†ä»“åº“ä¸‹è½½æ„ä»¶, è€Œä»£ç†ä»“åº“é—´æ¥çš„ä»è¿œç¨‹ä»“åº“ä¸‹è½½å¹¶ç¼“å­˜æ„ä»¶2ï¼‰ä¸ºäº†æ–¹ä¾¿, Maven å¯ä»¥ä»ä»“åº“ç»„ä¸‹è½½æ„ä»¶, è€Œä»“åº“ç»„å¹¶æ²¡æœ‰æ—¶é—´çš„å†…å®¹ (ä¸‹å›¾ä¸­ç”¨è™šçº¿è¡¨ç¤º, å®ƒä¼šè½¬å‘åŒ…å«çš„å®¿ä¸»ä»“åº“æˆ–è€…ä»£ç†ä»“åº“è·å¾—å®é™…æ„ä»¶çš„å†…å®¹). Nexus çš„ web ç•Œé¢åŠŸèƒ½ä»‹ç»1.Browse Server Content 1.1 Searchè¿™ä¸ªå°±æ˜¯ç±»ä¼¼ Maven ä»“åº“ä¸Šçš„æœç´¢åŠŸèƒ½ï¼Œå°±æ˜¯ä»ç§æœä¸ŠæŸ¥æ‰¾æ˜¯å¦æœ‰å“ªäº›åŒ…ã€‚æ³¨æ„ï¼š1ï¼‰åœ¨ Search è¿™çº§æ˜¯æ”¯æŒæ¨¡ç³Šæœç´¢çš„ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š 2ï¼‰å¦‚æœè¿›å…¥å…·ä½“çš„ç›®å½•ï¼Œå¥½åƒä¸æ”¯æŒæ¨¡ç³Šæœç´¢ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š 1.2 Browse 1ï¼‰Assetsè¿™æ˜¯èƒ½çœ‹åˆ°æ‰€æœ‰çš„èµ„æºï¼ŒåŒ…å« Jarï¼Œå·²ç»å¯¹ Jar çš„ä¸€äº›æè¿°ä¿¡æ¯ã€‚2ï¼‰Componentsè¿™é‡Œåªèƒ½çœ‹åˆ° Jar åŒ…ã€‚ 2.Server Adminstration And configurationçœ‹åˆ°è¿™ä¸ªé€‰é¡¹çš„å‰ææ˜¯è¦è¿›è¡Œç™»å½•çš„ï¼Œå¦‚ä¸Šé¢å·²ç»ä»‹ç»ç™»é™†æ–¹æ³•ï¼Œå³ä¸Šè§’ç‚¹å‡» â€œSign Inâ€ çš„ç™»å½•æŒ‰é’®ï¼Œè¾“å…¥ admin/admin123, ç™»å½•æˆåŠŸä¹‹åï¼Œå³å¯çœ‹åˆ°æ­¤åŠŸèƒ½ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š 2.1 Blob Storesæ–‡ä»¶å­˜å‚¨çš„åœ°æ–¹ï¼Œåˆ›å»ºä¸€ä¸ªç›®å½•çš„è¯ï¼Œå¯¹åº”æ–‡ä»¶ç³»ç»Ÿçš„ä¸€ä¸ªç›®å½•ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š 2.2 Repositories 1ï¼‰Proxyè¿™é‡Œå°±æ˜¯ä»£ç†çš„æ„æ€ï¼Œä»£ç†ä¸­å¤® Maven ä»“åº“ï¼Œå½“ PC è®¿é—®ä¸­å¤®åº“çš„æ—¶å€™ï¼Œå…ˆé€šè¿‡ Proxy ä¸‹è½½åˆ° Nexus ä»“åº“ï¼Œç„¶åå†ä» Nexus ä»“åº“ä¸‹è½½åˆ° PC æœ¬åœ°ã€‚è¿™æ ·çš„ä¼˜åŠ¿åªè¦å…¶ä¸­ä¸€ä¸ªäººä»ä¸­å¤®åº“ä¸‹æ¥äº†ï¼Œä»¥åå¤§å®¶éƒ½æ˜¯ä» Nexus ç§æœä¸Šè¿›è¡Œä¸‹æ¥ï¼Œç§æœä¸€èˆ¬éƒ¨ç½²åœ¨å†…ç½‘ï¼Œè¿™æ ·å¤§å¤§èŠ‚çº¦çš„å®½å¸¦ã€‚åˆ›å»º Proxy çš„å…·ä½“æ­¥éª¤1 ç‚¹å‡» â€œCreate Repositoriesâ€ æŒ‰é’® 2 é€‰æ‹©è¦åˆ›å»ºçš„ç±»å‹ 3 å¡«å†™è¯¦ç»†ä¿¡æ¯Nameï¼šå°±æ˜¯ä¸ºä»£ç†èµ·ä¸ªåå­—Remote Storage: ä»£ç†çš„åœ°å€ï¼ŒMaven çš„åœ°å€ä¸º: https://repo1.maven.org/maven2/Blob Store: é€‰æ‹©ä»£ç†ä¸‹è½½åŒ…çš„å­˜æ”¾è·¯å¾„ 2ï¼‰HostedHosted æ˜¯å®¿ä¸»æœºçš„æ„æ€ï¼Œå°±æ˜¯æ€ä¹ˆæŠŠç¬¬ä¸‰æ–¹çš„ Jar æ”¾åˆ°ç§æœä¸Šã€‚Hosted æœ‰ä¸‰ç§æ–¹å¼ï¼ŒReleasesã€SNAPSHOTã€MixedReleases: ä¸€èˆ¬æ˜¯å·²ç»å‘å¸ƒçš„ Jar åŒ…Snapshot: æœªå‘å¸ƒçš„ç‰ˆæœ¬Mixedï¼šæ··åˆçš„Hosted çš„åˆ›å»ºå’Œ Proxy æ˜¯ä¸€è‡´çš„ï¼Œå…·ä½“æ­¥éª¤å’Œä¸Šé¢åŸºæœ¬ä¸€è‡´ã€‚å¦‚ä¸‹ï¼š æ³¨æ„äº‹é¡¹ï¼šDeployment Pollcy: éœ€è¦æŠŠç­–ç•¥æ”¹æˆ â€œAllow redeployâ€ã€‚ 3ï¼‰Groupèƒ½æŠŠä¸¤ä¸ªä»“åº“åˆæˆä¸€ä¸ªä»“åº“æ¥ä½¿ç”¨ï¼Œç›®å‰æ²¡ä½¿ç”¨è¿‡ï¼Œæ‰€ä»¥æ²¡åšè¯¦ç»†çš„ç ”ç©¶ã€‚ 2.3 Securityè¿™é‡Œä¸»è¦æ˜¯ç”¨æˆ·ã€è§’è‰²ã€æƒé™çš„é…ç½®ï¼ˆä¸Šé¢å·²ç»æåˆ°äº†åœ¨è¿™é‡Œæ·»åŠ ç”¨æˆ·å’Œè§’è‰²ç­‰ï¼‰ 2.4 SupportåŒ…å«æ—¥å¿—åŠæ•°æ®åˆ†æã€‚ 2.5 Systemä¸»è¦æ˜¯é‚®ä»¶æœåŠ¡å™¨ï¼Œè°ƒåº¦çš„è®¾ç½®åœ°æ–¹è¿™éƒ¨åˆ†ä¸»è¦è®²æ€ä¹ˆå’Œ Maven åšé›†æˆ, é›†æˆçš„æ–¹å¼ä¸»è¦åˆ†ä»¥ä¸‹ç§æƒ…å†µï¼šä»£ç†ä¸­å¤®ä»“åº“ã€Snapshot åŒ…çš„ç®¡ç†ã€Release åŒ…çš„ç®¡ç†ã€ç¬¬ä¸‰æ–¹ Jar ä¸Šä¼ åˆ° Nexus ä¸Šã€‚ ä»£ç†ä¸­å¤®ä»“åº“åªè¦åœ¨ PMO æ–‡ä»¶ä¸­é…ç½®ç§æœçš„åœ°å€ï¼ˆæ¯”å¦‚ http://192.168.1.14:8081ï¼‰å³å¯ï¼Œé…ç½®å¦‚ä¸‹ï¼š 12345678910111213&lt;repositories&gt; &lt;repository&gt; &lt;id&gt;maven-central&lt;/id&gt; &lt;name&gt;maven-central&lt;/name&gt; &lt;url&gt;http://192.168.1.14:8081/repository/maven-central/&lt;/url&gt; &lt;snapshots&gt; &lt;enabled&gt;true&lt;/enabled&gt; &lt;/snapshots&gt; &lt;releases&gt; &lt;enabled&gt;true&lt;/enabled&gt; &lt;/releases&gt; &lt;/repository&gt;&lt;/repositories&gt; Snapshot åŒ…çš„ç®¡ç†1ï¼‰ä¿®æ”¹ Maven çš„ settings.xml æ–‡ä»¶ï¼ŒåŠ å…¥è®¤è¯æœºåˆ¶ 12345&lt;servers&gt; &lt;server&gt;&lt;id&gt;nexus&lt;/id&gt; &lt;username&gt;admin&lt;/username&gt; &lt;password&gt;admin123&lt;/password&gt;&lt;/server&gt; 2ï¼‰ä¿®æ”¹å·¥ç¨‹çš„ Pom æ–‡ä»¶ 123456789101112&lt;distributionManagement&gt; &lt;snapshotRepository&gt; &lt;id&gt;nexus&lt;/id&gt; &lt;name&gt;Nexus Snapshot&lt;/name&gt; &lt;url&gt;http://192.168.1.14:8081/repository/maven-snapshots/&lt;/url&gt; &lt;/snapshotRepository&gt; &lt;site&gt; &lt;id&gt;nexus&lt;/id&gt; &lt;name&gt;Nexus Sites&lt;/name&gt; &lt;url&gt;dav:http://192.168.1.14:8081/repository/maven-snapshots/&lt;/url&gt; &lt;/site&gt;&lt;/distributionManagement&gt; æ³¨æ„äº‹é¡¹: ä¸Šé¢ä¿®æ”¹çš„ Pom æ–‡ä»¶å¦‚æˆªå›¾ä¸­çš„åå­—è¦è·Ÿ / usr/local/maven/conf/settings.xml æ–‡ä»¶ä¸­çš„åå­—ä¸€å®šè¦å¯¹åº”ä¸Šã€‚ 3ï¼‰ä¸Šä¼ åˆ° Nexus ä¸Š 1â€“ é¡¹ç›®ç¼–è¯‘æˆçš„ jar æ˜¯ Snapshot(POM æ–‡ä»¶çš„å¤´éƒ¨) 1234&lt;groupId&gt;com.zhisheng&lt;/groupId&gt;&lt;artifactId&gt;test-nexus&lt;/artifactId&gt;&lt;version&gt;1.0.0-SHAPSHOT&lt;/version&gt;&lt;packaging&gt;jar&lt;/packaging&gt; 2â€“ ä½¿ç”¨ mvn deploy å‘½ä»¤è¿è¡Œå³å¯ï¼ˆè¿è¡Œç»“æœåœ¨æ­¤ç•¥è¿‡ï¼‰ 3â€“ å› ä¸º Snapshot æ˜¯å¿«ç…§ç‰ˆæœ¬ï¼Œé»˜è®¤ä»–æ¯æ¬¡ä¼šæŠŠ Jar åŠ ä¸€ä¸ªæ—¶é—´æˆ³ï¼Œåšä¸ºå†å²å¤‡ä»½ç‰ˆæœ¬ã€‚ Releases åŒ…çš„ç®¡ç†1ï¼‰ä¸ Snapshot å¤§åŒå°å¼‚ï¼Œåªæ˜¯ä¸Šä¼ åˆ°ç§æœä¸Šçš„ Jar åŒ…ä¸ä¼šè‡ªåŠ¨å¸¦æ—¶é—´æˆ³2ï¼‰ä¸ Snapshot é…ç½®ä¸åŒçš„åœ°æ–¹ï¼Œå°±æ˜¯å·¥ç¨‹çš„ PMO æ–‡ä»¶ï¼ŒåŠ å…¥ repository é…ç½® 1234567&lt;distributionManagement&gt; &lt;repository&gt; &lt;id&gt;nexus&lt;/id&gt; &lt;name&gt;Nexus Snapshot&lt;/name&gt; &lt;url&gt;http://192.168.1.14:8081/repository/maven-releases/&lt;/url&gt; &lt;/repository&gt;&lt;/distributionManagement&gt; 3ï¼‰æ‰“åŒ…çš„æ—¶å€™éœ€è¦æŠŠ Snapshot å»æ‰ 1234&lt;groupId&gt;com.zhisheng&lt;/groupId&gt;&lt;artifactId&gt;test-nexus&lt;/artifactId&gt;&lt;version&gt;1.0.0&lt;/version&gt;&lt;packaging&gt;jar&lt;/packaging&gt; | ç¬¬ä¸‰æ–¹ Jar ä¸Šä¼ åˆ° Nexus[root@master-node src]# mvn deploy:deploy-file -DgroupId=org.jasig.cas.client -DartifactId=cas-client-core -Dversion=3.1.3 -Dpackagæ³¨æ„äº‹é¡¹ï¼š-DrepositoryId=nexus å¯¹åº”çš„å°±æ˜¯ Maven ä¸­ settings.xml çš„è®¤è¯é…çš„åå­—ã€‚ æœ€åæ­å»ºçš„æ—¶å€™æ˜¯å‚è€ƒç½‘ä¸Šåšå®¢ï¼Œå†™ç¯‡å®Œæ•´çš„åšå®¢å†å›é¦ˆç»™ç½‘ä¸Šã€‚è½¬è½½è¯·æ³¨æ˜åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2017/10/14/Nexus3-Maven/","tags":[{"name":"Maven","slug":"Maven","permalink":"http://www.54tianzhisheng.cn/tags/Maven/"}]},{"title":"Google Guava ç¼“å­˜å®ç°æ¥å£çš„é™æµ","date":"2017-09-22T16:00:00.000Z","path":"2017/09/23/Guava-limit/","text":"é¡¹ç›®èƒŒæ™¯æœ€è¿‘é¡¹ç›®ä¸­éœ€è¦è¿›è¡Œæ¥å£ä¿æŠ¤ï¼Œé˜²æ­¢é«˜å¹¶å‘çš„æƒ…å†µæŠŠç³»ç»Ÿæå´©ï¼Œå› æ­¤éœ€è¦å¯¹ä¸€ä¸ªæŸ¥è¯¢æ¥å£è¿›è¡Œé™æµï¼Œä¸»è¦çš„ç›®çš„å°±æ˜¯é™åˆ¶å•ä½æ—¶é—´å†…è¯·æ±‚æ­¤æŸ¥è¯¢çš„æ¬¡æ•°ï¼Œä¾‹å¦‚ 1000 æ¬¡ï¼Œæ¥ä¿æŠ¤æ¥å£ã€‚å‚è€ƒäº† å¼€æ¶›çš„åšå®¢èŠèŠé«˜å¹¶å‘ç³»ç»Ÿé™æµç‰¹æŠ€ ï¼Œå­¦ä¹ äº†å…¶ä¸­åˆ©ç”¨ Google Guava ç¼“å­˜å®ç°é™æµçš„æŠ€å·§ï¼Œåœ¨ç½‘ä¸Šä¹ŸæŸ¥åˆ°äº†å¾ˆå¤šå…³äº Google Guava ç¼“å­˜çš„åšå®¢ï¼Œå­¦åˆ°äº†å¥½å¤šï¼Œæ¨èä¸€ä¸ªåšå®¢æ–‡ç« ï¼šhttp://ifeve.com/google-guava-cachesexplained/, å…³äº Google Guava ç¼“å­˜çš„æ›´å¤šç»†èŠ‚æˆ–è€…æŠ€æœ¯ï¼Œè¿™ç¯‡æ–‡ç« è®²çš„å¾ˆè¯¦ç»†ï¼›è¿™é‡Œæˆ‘ä»¬å¹¶ä¸æ˜¯ç”¨ç¼“å­˜æ¥ä¼˜åŒ–æŸ¥è¯¢ï¼Œè€Œæ˜¯åˆ©ç”¨ç¼“å­˜ï¼Œå­˜å‚¨ä¸€ä¸ªè®¡æ•°å™¨ï¼Œç„¶åç”¨è¿™ä¸ªè®¡æ•°å™¨æ¥å®ç°é™æµã€‚ æ•ˆæœå®éªŒ1234567static LoadingCache&lt;Long, AtomicLong&gt; count = CacheBuilder.newBuilder().expireAfterWrite(1, TimeUnit.SECONDS).build(new CacheLoader&lt;Long, AtomicLong&gt;() &#123; @Override public AtomicLong load(Long o) throws Exception &#123; //System.out.println(\"Load call!\"); return new AtomicLong(0L); &#125; &#125;); ä¸Šé¢ï¼Œæˆ‘ä»¬é€šè¿‡ CacheBuilder æ¥æ–°å»ºä¸€ä¸ª LoadingCache ç¼“å­˜å¯¹è±¡ countï¼Œç„¶åè®¾ç½®å…¶æœ‰æ•ˆæ—¶é—´ä¸º 1 ç§’ï¼Œå³æ¯ 1 ç§’é’Ÿåˆ·æ–°ä¸€æ¬¡ï¼›ç¼“å­˜ä¸­ï¼Œkey ä¸ºä¸€ä¸ª long å‹çš„æ—¶é—´æˆ³ç±»å‹ï¼Œvalue æ˜¯ä¸€ä¸ªè®¡æ•°å™¨ï¼Œä½¿ç”¨åŸå­æ€§çš„ AtomicLong ä¿è¯è‡ªå¢å’Œè‡ªå‡æ“ä½œçš„åŸå­æ€§ï¼Œ æ¯æ¬¡æŸ¥è¯¢ç¼“å­˜æ—¶å¦‚æœä¸èƒ½å‘½ä¸­ï¼Œå³æŸ¥è¯¢çš„æ—¶é—´æˆ³ä¸åœ¨ç¼“å­˜ä¸­ï¼Œåˆ™é‡æ–°åŠ è½½ç¼“å­˜ï¼Œæ‰§è¡Œ load å°†å½“å‰çš„æ—¶é—´æˆ³çš„è®¡æ•°å€¼åˆå§‹åŒ–ä¸º 0ã€‚è¿™æ ·å¯¹äºæ¯ä¸€ç§’çš„æ—¶é—´æˆ³ï¼Œèƒ½è®¡ç®—è¿™ä¸€ç§’å†…æ‰§è¡Œçš„æ¬¡æ•°ï¼Œä»è€Œè¾¾åˆ°é™æµçš„ç›®çš„ï¼›è¿™æ˜¯è¦æ‰§è¡Œçš„ä¸€ä¸ª getCounter æ–¹æ³•ï¼š 123456public class Counter &#123; static int counter = 0; public static int getCounter() throws Exception&#123; return counter++; &#125;&#125; ç°åœ¨æˆ‘ä»¬åˆ›å»ºå¤šä¸ªçº¿ç¨‹æ¥æ‰§è¡Œè¿™ä¸ªæ–¹æ³•ï¼š 12345678910111213141516171819202122public class Test &#123; public static void main(String args[]) throws Exception &#123; for(int i = 0;i&lt;100;i++) &#123; new Thread()&#123; @Override public void run() &#123; try &#123; System.out.println(Counter.getCounter()); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125; &#125;.start(); &#125; &#125;&#125; è¿™æ ·æ‰§è¡Œçš„è¯ï¼Œæ‰§è¡Œç»“æœå¾ˆç®€å•ï¼Œå°±æ˜¯å¾ˆå¿«åœ°æ‰§è¡Œè¿™ä¸ª for å¾ªç¯ï¼Œè¿…é€Ÿæ‰“å° 0 åˆ° 99 æŠ˜ 100 ä¸ªæ•°ï¼Œä¸å†è´´å‡ºã€‚è¿™é‡Œçš„ for å¾ªç¯æ‰§è¡Œ 100 ä¸ªè¿›ç¨‹æ—¶é—´æ˜¯å¾ˆå¿«çš„ï¼Œé‚£ä¹ˆç°åœ¨æˆ‘ä»¬è¦é™åˆ¶æ¯ç§’åªèƒ½æœ‰ 10 ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œ getCounter() æ–¹æ³•ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Œä¸Šé¢è®²çš„é™æµæ–¹æ³•å°±æ´¾ä¸Šç”¨åœºäº†ï¼š 12345678910111213141516171819202122public class Counter &#123; static LoadingCache&lt;Long, AtomicLong&gt; count = CacheBuilder.newBuilder().expireAfterWrite(1, TimeUnit.SECONDS).build(new CacheLoader&lt;Long, AtomicLong&gt;() &#123; @Override public AtomicLong load(Long o) throws Exception &#123; System.out.println(\"Load call!\"); return new AtomicLong(0L); &#125; &#125;); static long limits = 10; static int counter = 0; public static synchronized int getCounter() throws Exception&#123; while (true) &#123; //è·å–å½“å‰çš„æ—¶é—´æˆ³ä½œä¸ºkey Long currentSeconds = System.currentTimeMillis() / 1000; if (count.get(currentSeconds).getAndIncrement() &gt; limits) &#123; continue; &#125; return counter++; &#125; &#125;&#125; è¿™æ ·ä¸€æ¥ï¼Œå°±å¯ä»¥é™åˆ¶æ¯ç§’çš„æ‰§è¡Œæ•°äº†ã€‚å¯¹äºæ¯ä¸ªçº¿ç¨‹ï¼Œè·å–å½“å‰æ—¶é—´æˆ³ï¼Œå¦‚æœå½“å‰æ—¶é—´ (å½“å‰è¿™ 1 ç§’) å†…æœ‰è¶…è¿‡ 10 ä¸ªçº¿ç¨‹æ­£åœ¨æ‰§è¡Œï¼Œé‚£ä¹ˆè¿™ä¸ªè¿›ç¨‹ä¸€ç›´åœ¨è¿™é‡Œå¾ªç¯ï¼Œç›´åˆ°ä¸‹ä¸€ç§’ï¼Œæˆ–è€…æ›´é åçš„æ—¶é—´ï¼Œé‡æ–°åŠ è½½ï¼Œæ‰§è¡Œ loadï¼Œå°†æ–°çš„æ—¶é—´æˆ³çš„è®¡æ•°å€¼é‡æ–°ä¸º 0ã€‚æ‰§è¡Œç»“æœï¼šæ¯ç§’æ‰§è¡Œ 11 ä¸ªï¼ˆå› ä¸ºä» 0 å¼€å§‹ï¼‰ï¼Œæ¯ä¸€ç§’ä¹‹åï¼Œload æ–¹æ³•ä¼šæ‰§è¡Œä¸€æ¬¡ï¼› 12345678910111213141516171819202122232425ä¸ºäº†æ›´åŠ ç›´è§‚ï¼Œæˆ‘ä»¬å¯ä»¥è®©æ¯ä¸ªforå¾ªç¯sleepä¸€æ®µæ—¶é—´ï¼špublic class Test &#123; public static void main(String args[]) throws Exception &#123; for(int i = 0;i&lt;100;i++) &#123; new Thread()&#123; @Override public void run() &#123; try &#123; System.out.println(Counter.getCounter()); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125; &#125;.start(); Thread.sleep(100); &#125; &#125;&#125; åœ¨ä¸Šè¿°è¿™æ ·çš„æƒ…å†µä¸‹ï¼Œä¸€ä¸ªçº¿ç¨‹å¦‚æœé‡åˆ°å½“å‰æ—¶é—´æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹è¶…è¿‡ limit å€¼å°±ä¼šä¸€ç›´åœ¨ while å¾ªç¯ï¼Œè¿™æ ·ä¼šæµªè´¹å¤§é‡çš„èµ„æºï¼Œæˆ‘ä»¬åœ¨åšé™æµçš„æ—¶å€™ï¼Œå¦‚æœå‡ºç°è¿™ç§æƒ…å†µï¼Œå¯ä»¥ä¸è¿›è¡Œ while å¾ªç¯ï¼Œè€Œæ˜¯ç›´æ¥æŠ›å‡ºå¼‚å¸¸æˆ–è€…è¿”å›ï¼Œæ¥æ‹’ç»è¿™æ¬¡æ‰§è¡Œï¼ˆæŸ¥è¯¢ï¼‰ï¼Œè¿™æ ·ä¾¿å¯ä»¥èŠ‚çœèµ„æºã€‚ æœ€åæœ¬ç¯‡æ–‡ç« åœ°å€ï¼š http://www.54tianzhisheng.cn/2017/09/23/Guava-limit/","tags":[{"name":"Guava","slug":"Guava","permalink":"http://www.54tianzhisheng.cn/tags/Guava/"}]},{"title":"é¢è¯•è¿‡é˜¿é‡Œç­‰äº’è”ç½‘å¤§å…¬å¸ï¼Œæˆ‘çŸ¥é“äº†è¿™äº›å¥—è·¯","date":"2017-09-16T16:00:00.000Z","path":"2017/09/17/Interview-summary/","text":"å‰é¢æ„Ÿè°¢ä¸€æ³¢å› ä¸ºçœ‹åˆ°æ˜é‡‘åœ¨åšç§‹æ‹›æ±‚èŒå¾æ–‡å¤§èµ›ï¼ŒèµåŠ©å•†ä¹Ÿæœ‰ç‰›å®¢ç½‘ï¼Œè‡ªå·±å‰æ®µæ—¶é—´ä¹Ÿç¨å¾®å†™äº†ç¯‡åšå®¢æ€»ç»“æˆ‘çš„å¤§å­¦ç”Ÿæ´»ï¼Œé‚£äº›å¹´æˆ‘çœ‹è¿‡çš„ä¹¦ â€”â€” è‡´æ•¬æˆ‘çš„å¤§å­¦ç”Ÿæ´» â€”â€” Say Good Bye ï¼ åšå®¢ä¸­ç¨å¾®ç®€å•çš„ä»‹ç»äº†ä¸‹è‡ªå·±çš„æ±‚èŒï¼Œé‡ç‚¹æ˜¯æ¨èäº†ä¸‹æˆ‘è‡ªå·±çœ‹è¿‡çš„é‚£äº›ä¹¦ç±ï¼Œå¯¹æˆ‘å¸®åŠ©çœŸçš„å¾ˆå¤§ã€‚ å¦‚ä»Šå€Ÿè¿™ä¹ˆä¸ªæœºä¼šï¼Œå›é¦ˆæ˜é‡‘å’Œç‰›å®¢ç½‘ï¼Œæƒ³æƒ³è‡ªå·±è¿™ä¸€å¹´åœ¨æ˜é‡‘ä¹Ÿå†™è¿‡ä¸å°‘æ–‡ç« ï¼Œä» 0 ä¸ªç²‰ä¸åˆ°å¦‚ä»Šè¢« 11047 äººï¼ˆæˆªæ­¢å†™æ­¤ç¯‡æ–‡ç« æ—¶ï¼‰å…³æ³¨ï¼Œæœ‰ç‚¹å°æ¿€åŠ¨ï¼Œç«Ÿç„¶è¿™ä¹ˆå¤šç²‰ï¼Œä¹Ÿä¸çŸ¥é“çœŸæ­£æ´»è·ƒçš„ç”¨æˆ·æœ‰å¤šå°‘ã€‚ä¸ç®¡æ€æ ·ï¼Œè¿™ä¸€å¹´åœ¨æ˜é‡‘è¿˜æ˜¯æ”¶è·å¾ˆå¤šçš„ï¼Œä¸ä»…å¯ä»¥é˜…è¯»åˆ°å¾ˆå¤šå¤§ç¥çš„æ–‡ç« ï¼Œå­¦ä¹ æ–°çš„çŸ¥è¯†ï¼Œè€Œä¸”è¿˜é‡åˆ°äº†å¥½å‡ ä¸ªä¸é”™çš„å“¥ä»¬ï¼Œå¦‚ä»Šå¹³å¸¸ä¹Ÿæœ‰å’Œä»–ä»¬äº¤æµï¼Œæ¯”å¦‚ ï¼šèŠ‹é“æºç  è€å“¥äººå°±å¾ˆä¸é”™ï¼Œåœ¨ä¸Šæµ·è¿˜å’Œè€å“¥è§è¿‡é¢ï¼Œåƒè¿‡é¥­ï¼Œå¹³å¸¸å¯¹æˆ‘å¸®åŠ©ä¹Ÿå¾ˆå¤§ï¼Œä¼šæ¨èä¸€äº›å¾ˆæœ‰ç”¨çš„ä¹¦ç±ç»™æˆ‘çœ‹ã€‚æ¬¢è¿å¤§å®¶å…³æ³¨ä»–çš„åšå®¢ï¼šèŠ‹é“æºç çš„åšå®¢ ï¼Œé‡Œé¢æœ‰å¥½å‡ ç³»åˆ—çš„æºç åˆ†æåšå®¢æ–‡ç« å‘¢ã€‚è‡³äºç‰›å®¢ç½‘ï¼Œæˆ‘å°±æ›´æ˜¯è€ç”¨æˆ·äº†ï¼Œå°è±¡ä¸­å¥½åƒæ˜¯å¤§ä¸€çš„æ—¶å€™æ³¨å†Œçš„ï¼Œé‚£æ—¶æœ‰ç©ºçš„è¯å°±ä¼šå»ä¸Šé¢åˆ·å‡ é“åŸºç¡€é¢˜ï¼Œå†™å†™é¢˜è§£ï¼ŒåšæŒäº†å¥½ä¹…äº†ï¼Œå¦‚ä»Šæ—©å·²æ˜¯çº¢åäº†ã€‚ï¼ˆå…¶å®æ˜¯æ°´å‡ºæ¥çš„ï¼Œå“ˆå“ˆï¼‰åœ¨ç‰›å®¢ç½‘é‡åˆ°çš„å¤§ç¥ä¹Ÿæ˜¯è¶…å¤šï¼Œå¥½å¤šæœ‹å‹å‡ ä¹éƒ½æ˜¯é€šè¿‡ç‰›å®¢ç½‘è®¤è¯†çš„ï¼Œé‚£æ—¶æ—©çš„æ—¶å€™ä¸€èµ·åœ¨ä¸€ç¾¤è®¨è®ºé—®é¢˜ï¼Œåˆ«æé‚£åœºé¢äº†ï¼Œéœ‡æƒŠï¼Œæˆ‘ç­‰å¼±æ¸£ç‘Ÿç‘Ÿå‘æŠ–ã€‚æ„Ÿè°¢å¶ç¥ï¼Œå·¦ç¥ï¼Œç‰›å¦¹ï¼ è¯´ç€è¯´ç€ï¼Œå¥½åƒåé¢˜äº†ã€‚ æ­£å¼è¿›å…¥è¯é¢˜å§ï¼ æ­£æ–‡å¼€å§‹æœ¬ç¯‡ç§‹æ‹›æ±‚èŒå¾æ–‡ä¸»è¦åˆ†äº«å¦‚ä¸‹å‡ æ–¹é¢ï¼šæ‹›è˜èŒä½éœ€æ±‚å¥—è·¯ ã€æ‹›è˜é¢è¯•çš„å¥—è·¯ã€ç®€å†æ’°å†™å¥—è·¯ã€ç®€å†æŠ•é€’å¥—è·¯ ã€æ‰¾å·¥ä½œç»å† ã€è‡ªå·±é¢è¯•é¢ç» ã€å®ä¹ æ„Ÿæ‚Ÿã€ä¹¦ç±æ¨è ã€ä¼˜ç§€ç½‘ç«™æ¨è ã€ä¼˜ç§€åšå®¢æ¨è ã€æ±‚èŒèµ„æ–™æ”¾é€ã€‚ æ‹›è˜èŒä½éœ€æ±‚å¥—è·¯æ‘˜ä¸¾ä¸‹å‡ ä¸ªå…¬å¸çš„æ‹›è˜éœ€æ±‚ï¼šï¼ˆfrom lagouï¼‰ 1ã€Javaå¼€å‘æ ¡æ‹›ç”Ÿ( æœ‰èµ ) èŒä½è¯±æƒ‘ï¼šç¦åˆ©å¥½å¾…é‡ä½³ï¼ŒæŠ€æœ¯æ°›å›´æµ“ï¼Œæœ‰å¤§ç‰›å¸¦æˆé•¿å¿«èŒä½æè¿°ï¼š æœ‰èµ2018æ ¡æ‹›å®˜æ–¹ç½‘ç”³åœ°å€ï¼ˆè¯·åœ¨å®˜ç½‘æŠ•é€’ï¼Œå‹¿ç›´æ¥åœ¨Lagouä¸ŠæŠ•é€’ï¼‰ï¼šhttps://job.youzan.com/campuså²—ä½èŒè´£ æˆ‘ä»¬æ‹¥æœ‰ä¸–ç•Œçº§çš„ SaaS ç”µå•†è§£å†³æ–¹æ¡ˆï¼Œæ¯å¤©å¤„ç†å‡ ç™¾ä¸‡è®¢å•ã€å‡ äº¿æ¡æ¶ˆæ¯ï¼Œå¹¶ä¸”é‡çº§ä¸æ–­æ”€å‡ï¼› æˆ‘ä»¬å¼€æ”¾äº†æœ‰èµäº‘ï¼Œè¿æ¥äº†æ•°åä¸‡å¼€å‘è€…ï¼Œå¤§å¤§æå‡äº† SaaS å¯¹å•†å®¶äº§ç”Ÿçš„ä»·å€¼ï¼› æˆ‘ä»¬æ­£åœ¨æ–°é›¶å”®çš„æ½®æµä¸­æ¿€æµå‹‡è¿›ã€å¼€ç–†æ‹“åœŸï¼Œç”¨äº§å“æŠ€æœ¯æ’¬åŠ¨å·¨å¤§çš„å¸‚åœºï¼› è€Œä½ çš„å·¥ä½œï¼Œå°±æ˜¯å‚ä¸è¿™äº›å¤§æµé‡ç³»ç»Ÿçš„ç ”å‘ï¼Œå“ªæ€•æå‡1%çš„æ€§èƒ½å’Œç¨³å®šæ€§éƒ½å°†æ˜¯æ¿€åŠ¨äººå¿ƒçš„æ—¶åˆ»ã€‚ å²—ä½è¦æ±‚ 2018å±Šæœ¬ç§‘åŠä»¥ä¸Šå­¦å†åº”å±Šæ¯•ä¸šç”Ÿï¼Œè®¡ç®—æœºæˆ–è€…è½¯ä»¶å·¥ç¨‹ç›¸å…³ä¸“ä¸šï¼› å…·å¤‡æ‰å®çš„è®¡ç®—æœºåŸºç¡€çŸ¥è¯†ï¼Œè‡³å°‘ç†Ÿç»ƒä½¿ç”¨ä¸€é—¨ä¸»æµå¼€å‘è¯­è¨€ï¼› ç§¯æå‚ä¸å¼€å‘å®è·µï¼Œå¦‚æœæ‹¥æœ‰å¼•ä»¥ä¸ºè±ªçš„é¡¹ç›®ç»å†åˆ™åŠ åˆ†ï¼› çƒ­è¡·æ•°æ®ç»“æ„ä¸ç®—æ³•ï¼Œå¦‚æœä¸€ä¸å°å¿ƒåœ¨ ACM èµ›åœºæ‘˜è¿‡é‡‘ï¼Œå¤ºè¿‡é“¶åˆ™åŠ åˆ†ï¼› èƒ½åœ¨ Linux ä¸Šå†™ä»»ä½•è„šæœ¬ï¼Œæ¯”ç‹è€…è£è€€ä¸Šæ‰‹è¿˜å¿«åˆ™åŠ åˆ†ï¼› å¿«é€Ÿå­¦ä¹ æ–°é²œäº‹ç‰©ï¼Œè‡ªæˆ‘é©±åŠ¨è¿½æ±‚å“è¶Šï¼Œç§¯æåº”å¯¹é—®é¢˜å’Œå˜åŒ–ã€‚ 2ã€äº¬ä¸œå±…å®¶ç”Ÿæ´»äº‹ä¸šéƒ¨-æ±½è½¦ç”¨å“æ‹›è˜å®ä¹ ç”Ÿï¼ˆ2018å±Šï¼‰ èŒä½è¯±æƒ‘ï¼šäº¬ä¸œå•†åŸ èŒä½æè¿°ï¼šäº¬ä¸œå•†åŸ-æ±½è½¦ç”¨å“éƒ¨é—¨æ‹›è˜å®ä¹ ç”Ÿ æˆ‘ä»¬éœ€è¦è¿™æ ·çš„ä½ ï¼š 2018å±Šæ¯•ä¸šç”Ÿï¼ˆæœ¬ç§‘æˆ–ç¡•å£«å‡å¯ï¼‰ å­¦ä¹ èƒ½åŠ›å¼º æ‹…å½“ã€æŠ—å‹ã€æ¥å—å˜åŒ– èƒ½é•¿æœŸå®ä¹ ï¼ˆä¼˜ç§€è€…æœ‰è½¬æ­£æœºä¼šï¼‰ éœ€è¦ä¸€ä¸ªå¤§çš„å¹³å°æ¥å±•ç¤ºå’Œå‘æŒ¥è‡ªå·±çš„èƒ½åŠ› ä½ å°†æ”¶è·ï¼š é‡æ–°è®¤è¯†å¿«é€Ÿæˆé•¿çš„è‡ªå·± ä¸€ä»½ä¸–ç•Œ500å¼ºçš„å®ä¹ ç»å† ä¸€ç¾¤ä¼˜ç§€çš„ä¼™ä¼´ 3ã€çˆ±å¥‡è‰º Java å®ä¹ ç”Ÿ - æ¸¸æˆäº‹ä¸šéƒ¨ è¦æ±‚ï¼šè‡³å°‘ 6 ä¸ªæœˆä»¥ä¸Šæ¯å‘¨ä¸‰å¤©ä»¥ä¸Šå®ä¹ ã€‚ æœ¬ç§‘ä»¥ä¸Šå­¦å†ï¼Œè®¡ç®—æœºã€è½¯ä»¶å·¥ç¨‹ç›¸å…³ä¸“ä¸šï¼› åŸºç¡€æ‰å®ï¼Œç†Ÿæ‚‰ Java ç¼–ç¨‹ï¼Œç†Ÿæ‚‰ Springã€MyBatis ç­‰æ¡†æ¶ä¼˜å…ˆï¼› ç†Ÿæ‚‰ SQL è¯­å¥ï¼Œç†Ÿç»ƒä½¿ç”¨ MySQL æ•°æ®åº“ï¼› è‰¯å¥½çš„æ²Ÿé€šã€è¡¨è¾¾ã€åè°ƒèƒ½åŠ›ï¼Œå¯Œæœ‰æ¿€æƒ…ï¼Œå­¦ä¹ èƒ½åŠ›å¼ºï¼› æœ‰ GitHub è´¦å·æˆ–è€…æŠ€æœ¯åšå®¢ä¼˜å…ˆï¼› çƒ­çˆ±æ¸¸æˆè¡Œä¸šä¼˜å…ˆã€‚ è¿™é‡Œéšä¾¿æ‰¾äº†ä¸‰ä¸ªï¼Œä»æ‹›è˜éœ€æ±‚é‡Œçœ‹ï¼Œå¥½å¤šå…¬å¸ç›®å‰æ‹›è˜çš„è¯åœ¨æ‹›è˜éœ€æ±‚ä¸­å¹¶ä¸æ€ä¹ˆä¼šå†™çš„å¾ˆæ¸…æ¥šï¼Œæœ‰çš„ä¹Ÿä¸ä¼šè¯´æ˜è¦æ±‚çš„æŠ€æœ¯æ ˆï¼Œè¿™å…¶å®æœ‰æ—¶ä¼šå¯¹æˆ‘ä»¬è¿™ç§æ–°äººæ¥è¯´ï¼Œæœ‰ç‚¹ä¸å¥½çš„ï¼Œè¿™æ ·çš„è¯æˆ‘ä»¬å°±æ²¡æœ‰æ˜ç¡®çš„ç›®æ ‡å»å¤ä¹ ï¼Œè¿˜æœ‰å°±æ˜¯ä¸€äº›åŠ åˆ†é¡¹ï¼Œå…¶å®ä¹Ÿæ˜¯æœ‰ç‚¹å¸®åŠ©çš„ã€‚å°±æ¯”å¦‚æœ‰äº›æ‹›è˜ä¸Šé¢çš„è¯´æœ‰ä¼˜ç§€åšå®¢å’Œ GitHub è€…ä¼˜å…ˆï¼Œè¿™ä¸¤ç‚¹çš„è¯æˆ‘ä»¬å…¶å®å¯ä»¥åœ¨å¤§å­¦æ…¢æ…¢ç§¯ç´¯å‡ºæ¥çš„ï¼Œå¯¹é¢è¯•ç¡®å®æœ‰å¸®åŠ©ï¼Œæˆ‘å¥½äº›é¢è¯•æœºä¼šéƒ½æ˜¯é è¿™ä¸¤ä¸ªçš„ã€‚è¿˜æœ‰å¥—è·¯å°±æ˜¯ï¼Œåˆ«å…‰ä¿¡ä»–è¿™æ‹›è˜éœ€æ±‚ï¼Œè¿›å»é¢è¯•å¯èƒ½å°±ä¸é—®ä½ è¿™äº›æ–¹é¢çš„é—®é¢˜äº†ï¼Œé‚£äº›å…¬å¸å‡ ä¹éƒ½æ˜¯è¿™ä¹ˆä¸ªå¥—è·¯ï¼šé¢è¯•é€ ç«ç®­ï¼Œå…¥èŒæ‹§èºä¸ ï¼ è¿›å»å…¬å¸ä¹‹å‰å¯èƒ½éœ€è¦ä½ æ‡‚å¾ˆå¤šä¸œè¥¿ï¼Œä½†æ˜¯è¿›å»çš„è¯è¿˜åªæ˜¯ä¸“é—¨åšä¸€æ–¹é¢çš„ä¸œè¥¿ã€‚ä¸ç®¡æ€æ ·ï¼Œå¦‚æœä½ æœ‰æœºä¼šè¿›å»å¤§å…¬å¸çš„è¯ï¼ˆè€Œä¸”é€‚åˆå»ï¼‰ï¼Œè¿˜æ˜¯å»å¤§å…¬å¸å§ï¼Œå‡ºæ¥å¤§å‚å…‰ç¯ä¸å°‘ã€‚ è®¤çœŸè€å¿ƒåœ°æ‹§èºä¸é’‰ï¼Œè¯´ä¸å®šæœ‰æœºä¼šå»é€ å¤§ç«ç®­â€”â€”æ­£è§„å¤§å…¬å¸çš„èŠ‚å¥ã€‚ çŸ­æ—¶é—´æŠŠèºä¸æ‹§å‡ºèŠ±ï¼Œè¯´ä¸å®šæœ‰æœºä¼šé€ å°ç«ç®­â€”â€”ä¸Šå‡ä¸­åˆ›ä¸šå…¬å¸çš„èŠ‚å¥ã€‚ æ‹›è˜é¢è¯•çš„å¥—è·¯å‚è€ƒï¼šhttps://mp.weixin.qq.com/s/qRwDowetBkJqpeMeAZsIpA ä¸€ä¸ªåœ¨æ˜é‡‘ä¸Šè®¤è¯†çš„è€å“¥ï¼Œåœ¨äº¬ä¸œå·¥ä½œï¼Œå†™çš„ä¸é”™ï¼Œå¹²è„†åˆ†äº«ä¸‹ã€‚å¤§å®¶å¯ä»¥å»çœ‹ä»–çš„åšå®¢ï¼Œhttp://mindwind.me/ å½“æ—¶æˆ‘æ±‚èŒçš„æ—¶å€™é€šè¿‡ä½œè€…åšå®¢ä¹Ÿå­¦åˆ°ä¸å°‘ä¸œè¥¿ã€‚ ä¸€æ¬¡é›†ä¸­çš„æ‰©æ‹›éœ€æ±‚ï¼Œæœ‰ç‚¹åƒæ¯å¹´ä¸€åº¦çš„æ™‹å‡è¯„å®¡ï¼Œéƒ½éœ€è¦å¯¹å¤§é‡çš„å€™é€‰äººè¿›è¡Œå®šçº§è¯„å®¡ï¼Œå› ä¸ºæ¯ä¸€ä¸ªæ–°æ‹›è˜çš„äººå‘˜éƒ½ä¼šå¯¹å…¶æœ‰ä¸€ä¸ªå®šçº§çš„è¿‡ç¨‹ã€‚ ç»´åº¦ï¼š é€šç”¨èƒ½åŠ›ï¼šè€ƒå¯Ÿå…¶æ²Ÿé€šè¡¨è¾¾ã€å­¦ä¹ æˆé•¿ç­‰ ä¸“ä¸šçŸ¥è¯†ï¼šè€ƒå¯Ÿå…¶çŸ¥è¯†çš„æŒæ¡ã€æ·±åº¦ã€å¹¿åº¦ç­‰ ä¸“ä¸šèƒ½åŠ›ï¼šè€ƒå¯Ÿå…¶æŠ€èƒ½åº”ç”¨çš„èƒ½åŠ›å’Œç»“æœ å·¥ä½œä¸šç»©ï¼šè€ƒå¯Ÿå…¶å·¥ä½œæˆæœã€äº§å‡ºã€åˆ›æ–°ç‚¹ç­‰ ä»·å€¼è§‚ï¼šè€ƒå¯Ÿå…¶è®¤çŸ¥ã€ç†è§£ã€è¡Œä¸ºç­‰ æ•´ä¸ªé¢è¯•è¿‡ç¨‹ä¼šåŒ…æ‹¬ä¸‹é¢å‡ ä¸ªéƒ¨åˆ†ï¼š è‡ªæˆ‘ä»‹ç»ä¸€å¼€å§‹çš„ç®€çŸ­è‡ªæˆ‘ä»‹ç»ï¼Œè€ƒå¯Ÿç‚¹åœ¨äºå¯¹è‡ªæˆ‘çš„æ€»ç»“ã€å½’çº³å’Œè®¤çŸ¥èƒ½åŠ›ã€‚è§‚å¯Ÿå…¶è¡¨è¾¾çš„é€»è¾‘æ€§å’Œæ¸…æ™°æ€§ï¼Œæœ‰ä¸ªæ•´ä½“å°è±¡ã€‚ é¡¹ç›®ç»å†ä¸€èˆ¬æˆ‘ä¸ä¼šä¸“é—¨é—®ä¸€äº›æ¯”è¾ƒæ­»çš„ä¸“ä¸šæŠ€æœ¯ç‚¹ä¹‹ç±»çš„çŸ¥è¯†ï¼Œéƒ½æ˜¯å¥—åœ¨å€™é€‰äººçš„é¡¹ç›®ç»å†å’Œè¿‡å¾€ç»éªŒä¸­ç©¿æ’ã€‚é€šè¿‡å…¶æè¿°ï¼Œæ¥åˆ¤æ–­å…¶æŒæ¡çŸ¥è¯†ç‚¹çš„èŒƒå›´å’Œæ·±åº¦ï¼Œä»¥åŠåœ¨å®é™…çš„æ¡ˆä¾‹ä¸­å¦‚ä½•è¿ç”¨è¿™äº›çŸ¥è¯†ä¸æŠ€èƒ½è§£å†³çœŸæ­£çš„é—®é¢˜çš„ã€‚ æ‰€ä»¥ï¼Œä¸ä¼šæœ‰æ‰€è°“çš„é¢˜åº“ã€‚æ¯ä¸€ä¸ªæˆ‘å†³å®šé¢è¯•çš„å€™é€‰äººï¼Œéƒ½æ˜¯æå‰ç»†è¯»å…¶ç®€å†ï¼Œæç‚¼åœºæ™¯å’Œå‘æ˜éœ€è¦é—®çš„é—®é¢˜ï¼Œç›¸å½“äºé¢è¯•å‰æœ‰ä¸ªäºŒä¸‰ååˆ†é’Ÿçš„å¤‡è¯¾è¿‡ç¨‹ï¼Œç»„ç»‡å¥½é¢è¯•æ—¶çš„äº¤äº’è¿‡ç¨‹ä¸åœºæ™¯ï¼Œä»¥é¡ºåˆ©è¾¾åˆ°æˆ‘æƒ³è¦äº†è§£çš„ç‚¹ã€‚ å›¢é˜Ÿåˆä½œé€šå¸¸è¿˜ä¼šé—®å€™é€‰äººå…¶æ‰€åœ¨å›¢é˜Ÿä¸­çš„è§’è‰²ï¼Œä»–ä»¬çš„å·¥ä½œæ¨¡å¼ã€åä½œæ–¹å¼ï¼Œå¹¶ç»™å‡ºä¸€äº›çœŸå®çš„åœºæ™¯åŒ–æ¡ˆä¾‹è§‚å¯Ÿå…¶åº”å¯¹çš„ååº”ã€‚è¯„ä»·ä¸€ä¸‹å…³äºä»–å‘¨å›´çš„åŒäº‹ã€ä¸‹å±æˆ–é¢†å¯¼ï¼Œäº†è§£ä»–åœ¨å›¢é˜Ÿä¸­çš„è‡ªæˆ‘å®šä½ã€‚è¿™é‡Œçš„è€ƒå¯Ÿç‚¹æ˜¯æ²Ÿé€šåä½œæ–¹é¢çš„é€šç”¨èƒ½åŠ›ã€‚ å­¦ä¹ æˆé•¿è¿™ä¸ªç»´åº¦è€ƒå¯Ÿçš„å…³é”®ç‚¹åŒ…æ‹¬ï¼šæˆé•¿æ½œåŠ›ã€èŒä¸šç”Ÿæ¶¯è§„åˆ’çš„æ¸…æ™°åº¦ã€‚äººä¸äººä¹‹é—´æˆé•¿é€Ÿåº¦çš„å…³é”®å·®è·ï¼Œæˆ‘è‡ªå·±è§‚å¯Ÿå¾—å‡ºçš„ç»“è®ºåœ¨äºï¼šè‡ªé©±åŠ›ã€‚è€Œè·¯å¾„çš„æ¸…æ™°æ€§ï¼Œä¹Ÿæ˜¯äº§ç”Ÿè‡ªé©±çš„ä¸€ä¸ªæºåŠ¨åŠ›ï¼Œå¦åˆ™å¯èƒ½ä¼šæ„Ÿè§‰è¿·èŒ«ï¼Œè€Œé™·äºå›°é¡¿ã€‚ æ–‡åŒ–åŒ¹é…è¿™ç®—æ˜¯ä»·å€¼è§‚çš„ä¸€éƒ¨åˆ†å§ã€‚å…¶å®ï¼Œè¿™æ˜¯æœ€éš¾è€ƒæ ¸çš„ï¼Œæˆ‘æ²¡æœ‰ä»€ä¹ˆå¥½æ–¹æ³•ï¼ŒåŸºæœ¬é æ„Ÿè§‰ã€‚æ›¾ç»æœ‰è¿‡å¥½å‡ æ¬¡ç¢°åˆ°ç»å†å’ŒæŠ€èƒ½éƒ½ä¸é”™çš„äººï¼Œä½†æ€»æ˜¯æ„Ÿè§‰å“ªé‡Œä¸å¯¹ï¼Œä½†åˆç€æ€¥è¦äººï¼Œå°±æ”¾è¿›æ¥äº†ã€‚ä½†æœ€ç»ˆæ„Ÿè§‰æ˜¯å¯¹çš„ï¼Œåˆä½œå¾ˆå¿«å°±ç»“æŸäº†ï¼Œäººä¹Ÿèµ°äº†ã€‚ ç»¼åˆè¯„ä»·æ€»ç»“ç‚¹è¯„å€™é€‰äººçš„ä¼˜åŠ¿ã€åŠ£åŠ¿å¹¶è¿›è¡ŒæŠ€æœ¯å®šçº§ï¼Œå®šçº§ä¹Ÿæ²¡æœ‰ç»å¯¹æ ‡å‡†ï¼Œè€Œæ˜¯ç›¸å¯¹çš„ã€‚æˆ‘ä¸€èˆ¬å°±æ˜¯å’Œå‘¨å›´è§‰å¾—å·®ä¸å¤šçº§åˆ«çš„äººçš„å¹³å‡æ°´å‡†æ¯”è¾ƒä¸‹ï¼Œå¤§æ¦‚å°±ä¼šæœ‰ä¸€ä¸ªæŠ€æœ¯çº§åˆ«çš„åˆ¤æ–­ã€‚ å¥—è·¯ æ‹›è˜é¢è¯•ï¼Œå…¶å®æ˜¯ä¸€ä¸ªå¯¹äººçš„ç­›é€‰ï¼Œè€Œç­›é€‰çš„æœ¬è´¨æ˜¯åŒ¹é… â€”â€” åŒ¹é…äººä¸èŒä½ã€‚ç¬¬ä¸€ï¼Œä½ å¾—éå¸¸æ¸…æ¥šåœ°ç†è§£ï¼Œè¿™ä¸ªèŒä½éœ€è¦ä»€ä¹ˆæ ·å±æ€§çš„äººã€‚ç¬¬äºŒï¼Œç¡®å®šä½ çš„å€™é€‰äººæ˜¯å¦æ‹¥æœ‰è¿™ä¸ªèŒä½è¦æ±‚çš„å¿…é¡»å±æ€§ã€‚é‚£ä¹ˆï¼Œé¦–å…ˆå›ç­”ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œä¸€èˆ¬çš„èŒä½éœ€è¦ä»€ä¹ˆæ ·çš„å±æ€§ï¼Ÿ å±æ€§ï¼Œåˆå¯ä»¥è¿›ä¸€æ­¥æ‹†è§£ä¸ºä¸‰ä¸ªå±‚æ¬¡ã€‚ç¬¬ä¸€å±‚æ¬¡æ˜¯ã€ŒæŠ€èƒ½ï¼ˆSkillsï¼‰ã€ï¼ŒæŠ€èƒ½æ˜¯ä½ ä¹ å¾—çš„ä¸€ç§å·¥å…·ï¼Œå°±åƒç¨‹åºå‘˜ä¼šç”¨æŸç§è¯­è¨€å’Œæ¡†æ¶æ¥ç¼–å†™æŸç±»åº”ç”¨ç¨‹åºã€‚ç¬¬äºŒå±‚æ¬¡æ˜¯ã€Œèƒ½åŠ›ï¼ˆAbilitiesï¼‰ã€ï¼Œèƒ½åŠ›æ˜¯ä½ è¿ç”¨å·¥å…·çš„æ€è€ƒå’Œè¡Œä¸ºæ–¹å¼ï¼Œç”¨åŒæ ·çš„è¯­è¨€å’Œæ¡†æ¶ç¼–å†™åŒæ ·ç¨‹åºçš„ç¨‹åºå‘˜èƒ½åŠ›å¯ä»¥å·®åˆ«å¾ˆå¤§ã€‚è€Œç¬¬ä¸‰å±‚æ¬¡æ˜¯ã€Œä»·å€¼è§‚ï¼ˆValuesï¼‰ã€ï¼Œä»·å€¼è§‚æ˜¯ä¸€ä¸ªäººæ ¹æ·±è’‚å›ºçš„ä¿¡å¿µä»¥åŠé©±åŠ¨è¡Œä¸ºçš„åŸå› ä¸åŠ¨åŠ›æ‰€åœ¨ã€‚ ç®€å†æ’°å†™å¥—è·¯å‚è€ƒï¼šhttps://mp.weixin.qq.com/s/3f8hGAQ-auLdkxkQ8XG3CQ ç®€å†ï¼Œæ˜¯å¦‚æ­¤é‡è¦ï¼Œå®ƒæ˜¯è·å¾—ä¸€ä»½æ»¡æ„å·¥ä½œçš„æ•²é—¨ç –ï¼Œä½†ä¸åŒçš„ç®€å†æ•²é—¨çš„å£°å“å¯ä¸åŒã€‚ ä½†å¾ˆå¤šæ—¶å€™ç®€å†ç»™äººçš„æ„Ÿè§‰ä¹Ÿä¼¼ä¹å¾®ä¸è¶³é“ï¼Œå› ä¸ºæ²¡æœ‰äººä¼šçœŸæ­£ç»†è‡´çš„å»è¯»ä¸€ä»½ç®€å†ã€‚è€Œä»…ä»…æ˜¯å¿«é€Ÿçš„æµè§ˆä¸€éï¼Œå°±å‡ ä¹åŒæ—¶å¯¹ä¸€ä¸ªå€™é€‰äººå½¢æˆäº†ä¸€ç§è¦ä¹ˆå¼ºçƒˆï¼Œè¦ä¹ˆæ— æ„Ÿçš„å°è±¡ã€‚ç°å®ä¸­çš„çœŸå®æƒ…å†µæ˜¯ï¼Œä½ çš„ç®€å†åªæœ‰åå‡ äºŒåç§’çš„æ—¶é—´çª—å£æœºä¼šä¼šè¢«æµè§ˆåˆ°ï¼Œç„¶åå°±å†³å®šäº†èƒ½å¦è¿›å…¥ä¸‹ä¸€æ­¥ã€‚ è¦è®©é¢è¯•å®˜çœ‹äº†ä½ çš„ç®€å†åï¼šçŸ¥é“ä½ åšè¿‡ä»€ä¹ˆï¼Ÿçœ‹çœ‹æŠ€èƒ½ã€ç»å†ä¸å²—ä½éœ€æ±‚çš„åŒ¹é…åº¦ï¼Œç„¶åå†é—®é—®ä½ æ˜¯è°ï¼Ÿä½ é€šè¿‡ç®€å†æ•£å‘å‡ºæ¥çš„å‘³é“æ˜¯ä»€ä¹ˆæ„Ÿè§‰ï¼Œæˆ‘æ„¿æ„å’Œè¿™æ ·çš„äººä¸€èµ·å…±äº‹ä¹ˆï¼Ÿ ä¸€ä»½ç®€å†çš„æœ€å°‘å¿…è¦å†…å®¹åŒ…æ‹¬ï¼š ä¸ªäººä¿¡æ¯ å§“å å¹´é¾„ æ‰‹æœº é‚®ç®± æ•™è‚²ç»å† åšå£«ï¼ˆç¡•å£«ã€æœ¬ç§‘ï¼‰ æœ‰å¤šä¸ªå…¨éƒ¨å†™å‡ºæ¥ï¼Œæœ€é«˜å­¦å†å†™åœ¨ä¸Šé¢ å·¥ä½œç»å†ï¼ˆæœ€åŒ¹é…èŒä½éœ€æ±‚çš„ï¼ŒæŒ‘é€‰å‡ºæ¥çš„ TOP3 çš„é¡¹ç›®ï¼‰ é¡¹ç›®1 é¡¹ç›®èƒŒæ™¯ä¸Šä¸‹æ–‡ï¼ˆåœºæ™¯ã€é—®é¢˜ï¼‰ ä½ åœ¨å…¶ä¸­çš„è§’è‰²ï¼ˆèŒè´£ã€å‘æŒ¥çš„ä½œç”¨ã€ç»“æœåº¦é‡ï¼‰ ä¸æ­¤é¡¹ç»å†æœ‰å…³çš„çŸ¥è¯†ä¸æŠ€èƒ½ï¼ˆæŠ€æœ¯æ ˆï¼‰ é¡¹ç›®2 é¡¹ç›®3 é™„åŠ ä¿¡æ¯ åšå®¢ï¼šæŒç»­æœ‰å†…å®¹ï¼Œä¸ç¢ç¢å¿µ å¼€æºï¼šGitHub æŒç»­ commit ç¤¾åŒºï¼šæœ‰ä¸€å®šä¸“ä¸šå½±å“åŠ›çš„ ä¹¦ç±ï¼šç”¨å¿ƒå†™çš„ æ¼”è®²ï¼šè¡Œä¸šå¤§ä¼šçº§åˆ«çš„ ä¸“åˆ©ï¼šå‡‘æ•°çš„å°±ç®—äº† è®ºæ–‡ï¼šå­¦æœ¯ç•Œæ¯”è¾ƒæœ‰å½±å“åŠ›çš„ çˆ±å¥½ï¼šçœŸæ­£çš„å…´è¶£ç‚¹ å¯¹äºæˆ‘ä»¬å­¦ç”Ÿï¼Œç¼ºä¹å·¥ä½œç»å†ï¼Œé‚£å°±å†™å†™ç‹¬ç‰¹çš„å­¦ä¹ æˆ–å®ä¹ ç»å†ã€‚åŒå­¦ä»¬å¤§å®¶éƒ½å…±æœ‰çš„ç»å†å°±ä¸è¦éšä¾¿å†™ä¸Šå»å‡‘æ•°äº†ã€‚å¯¹äºå­¦ç”Ÿï¼Œçœ‹é‡çš„æ˜¯é€šç”¨èƒ½åŠ›ï¼Œå­¦ä¹ èƒ½åŠ›ï¼Œé€‚åº”èƒ½åŠ›ä»¥åŠå¯¹å·¥ä½œçš„æ€åº¦å’Œçƒ­æƒ…ã€‚å¦‚æœæ²¡æœ‰åŒºåˆ†åº¦é«˜çš„ç»å†ï¼Œé‚£ä¹ˆæœ‰ä½œå“ä¹Ÿæ˜¯å¾ˆå¥½çš„ã€‚æ¯”å¦‚å°†ä½ çš„åšçš„ç½‘ç«™éƒ¨ç½²å‡ºæ¥ï¼ŒæŠŠåœ°å€å†™åœ¨ç®€å†ä¸Šã€‚ å…³äºæŠ€æœ¯æ ˆéƒ¨åˆ†çš„æŠ€æœ¯æœ¯è¯­ï¼Œå¾ˆå¤šç¨‹åºå‘˜ä¸å¤ªæ³¨æ„ã€‚æ¯”å¦‚ï¼ŒæŠŠ Java å†™æˆ java æˆ– JAVAï¼ŒJava å·²æ˜¯ä¸€ä¸ªä¸“æœ‰å“ç‰Œåè¯ï¼Œå¤§å°å†™è¦å®Œå…¨ç¬¦åˆï¼Œè¿™ä¸€ç‚¹å’Œ iOS ç±»ä¼¼ï¼ˆi å°å†™ï¼ŒOS å¤§å†™ï¼‰ã€‚å¦å¤–ï¼Œåƒ HTMLï¼ŒCSS åˆ™å…¨éƒ¨å¤§å†™ï¼Œå› ä¸ºè¿™æ˜¯å¤šä¸ªå•è¯çš„ç¼©å†™ã€‚ä¸€äº›å°å°çš„ç»†èŠ‚å°±èƒ½è¯»å‡ºä½ çš„ä¸“ä¸šæ€§å’Œæ•£å‘å‡ºæ¥çš„å‘³é“ã€‚æœ€åï¼ŒæŠ€æœ¯æœ¯è¯­ä¸æ˜¯ç½—åˆ—å¾—å¤šå°±å¥½ï¼Œä¸æ˜¯çœŸæ­£ç†Ÿç»ƒçš„æŠ€èƒ½ï¼Œä¸è¦è½»æ˜“å†™è¿›ç®€å†ã€‚å› ä¸ºè¿™å°†ç»™ä½ è‡ªå·±æŒ–å‘ã€‚ä½ å¯ä»¥å°†ä½ è‡ªå·±æ“…é•¿çš„æˆ–è€…å¾ˆç†Ÿçš„çŸ¥è¯†ç‚¹å†™è¿›å»ï¼Œæœ‰æ—¶æƒ³ç€é‡å°±åŠ ç²—æˆ–è€…æ‰“ä¸ªæ‹¬å·ï¼Œè¿™æ ·å¯ä»¥æŒ–å‘ç»™é¢è¯•å®˜ï¼Œè®©ä»–å»é—®ä½ ç†Ÿæ‚‰çš„ï¼ˆå‰æè¦ç¡®ä¿ä½ çœŸçš„èƒ½è®²æ¸…æ¥šï¼Œæˆ‘è¯•è¿‡è¿™ä¸ªæ–¹æ³•å¾ˆæœ‰æ•ˆçš„ï¼‰ã€‚ ç„¶åå°±æ˜¯ç®€å†æ ¼å¼äº†ï¼Œæœ€å¥½æ˜¯ PDF äº†ï¼ŒWord åœ¨ä¸åŒçš„ç”µè„‘ä¸Šçš„æ‰“å¼€æ•ˆæœå¯èƒ½ä¸ä¸€æ ·ï¼Œæ ¼å¼å¯èƒ½ä¼šå˜ï¼Œå†µä¸”æœ‰äº›äººçš„ç”µè„‘ä¸ä¸€å®šè£…äº† Wordï¼Œä¸è¿‡æˆ‘å–œæ¬¢ç”¨ Markdown å†™ç®€å†ï¼Œç®€æ´ï¼Œé€‚åˆç¨‹åºå‘˜ï¼Œç„¶åæŠŠ Markdown è½¬æ¢æˆ PDF å‡ºæ¥ã€‚ ç®€å†æŠ•é€’å¥—è·¯å†…æ¨ æœ‰å†…æ¨é€šé“å°½é‡èµ°å†…æ¨é€šé“ï¼Œä¸çŸ¥é“æ–¹ä¾¿å¤šå°‘ï¼Œè€Œä¸”æˆåŠŸå‡ ç‡ä¹Ÿå¾ˆå¤§ï¼æ‰¾ç†Ÿäººï¼Œæ‰¾å­¦é•¿å­¦å§å§ï¼ç‰›å®¢ç½‘è®¨è®ºåŒºå¾ˆå¤šå†…æ¨å¸–å­ï¼Œå¯ä»¥å»æ‰¾æ‰¾ã€‚ä¸è¿‡ä»Šå¹´çš„å¥½å¤šå…¬å¸çš„å†…æ¨é€šé“éƒ½ä¸å’‹ç®¡ç”¨äº†ï¼Œå¥—è·¯è¶Šæ¥è¶Šå¤šäº†ã€‚è®°å¾—å»å¹´å¥½å¤šå…¬å¸å†…æ¨éƒ½æ˜¯å…ç¬”è¯•ï¼Œç›´æ¥è¿›å…¥é¢è¯•é˜¶æ®µï¼Œä»Šå¹´ç›´æ¥å˜æˆå†…æ¨å…ç®€å†ç­›é€‰ï¼Œè¿›å…¥ç¬”è¯•ã€‚å› ä¸ºç°åœ¨çš„å†…æ¨è¶Šæ¥è¶Šä¸é è°±ï¼Œç›´æ¥é¢è¯•çš„è¯ï¼Œä¼šå¢åŠ å…¬å¸çš„é¢è¯•æˆæœ¬ï¼Œå¹²è„†ç¬”è¯•å†ç­›é€‰ä¸€éƒ¨åˆ†äººã€‚ æ‹‰å‹¾ç½‘ æ‹‰å‹¾ä¸Šè¿˜æ˜¯ç®—ä¸é”™çš„ã€‚ Boss ç›´è˜ è™½è¯´å‰æ®µæ—¶é—´å‡ºç°äº†ç¨‹åºå‘˜æ‰¾å·¥ä½œè¿›å…¥ä¼ é”€æœ€åå¯¼è‡´æ­»äº¡çš„æƒ¨äº‹å‘ç”Ÿï¼Œä½†æ˜¯é‡Œé¢æ€»æ¯”æ™ºè”æ‹›è˜å’Œå‰ç¨‹æ— å¿§é è°±ç‚¹ã€‚å› ä¸ºæ™ºè”æ‹›è˜å’Œå‰ç¨‹æ— å¿§å‡ ä¹è¢«å¹¿å‘Šå…šå’ŒåŸ¹è®­æœºæ„ç»™å é¢†äº†ã€‚ è„‰è„‰ é‡Œé¢æ‹›åº”å±Šç”Ÿå’Œå®ä¹ ç”Ÿæ¯”è¾ƒå°‘ï¼Œä½†æ˜¯ä¹Ÿæœ‰ï¼Œå¯ä»¥è¯•è¯•ã€‚ æ€»ä¹‹ï¼Œç®€å†æŠ•é€’ç»™å…¬å¸ä¹‹å‰ï¼Œè¯·ç¡®è®¤ä¸‹è¿™å®¶å…¬å¸åˆ°åº•å’‹æ ·ï¼Œå…ˆå»ç™¾åº¦äº†è§£ä¸‹ï¼Œåˆ«è¢«å‘äº†ï¼Œæ¯ä¸ªå¹³å°éƒ½æœ‰ä¸€äº›å±…å¿ƒä¸è‰¯çš„å¹¿å‘Šå…šç­‰ç€ä½ ä¸Šé’©ï¼Œåƒä¸‡åˆ«ä¸Šå½“ï¼ï¼ï¼ æ‰¾å·¥ä½œç»å†è¿™æ®µç»å†ï¼Œç®—æ˜¯è‡ªå·±å¾ˆéš¾å¿˜è®°çš„ç»å†å§ã€‚æ—¢è¾›é…¸æ—¢å……å®çš„æ—¥å­ï¼ä¹Ÿå¾ˆæ„Ÿè°¢è‡ªå·±åœ¨è¿™æ®µæ—¶é—´çš„ç³»ç»Ÿå¤ä¹ ï¼Œæ„Ÿè§‰æŠŠè‡ªå·±çš„åŸºç¡€çŸ¥è¯†å†æ¬¡èšé›†åœ¨ä¸€èµ·äº†ï¼Œè‡ªå·±çš„èƒ½åŠ›åœ¨è¿™ä¸€æ®µæ—¶é—´æå‡çš„ä¹Ÿå¾ˆå¿«ã€‚åé¢æœ‰æœºä¼šçš„è¯æˆ‘ä¹Ÿæƒ³å†™ä¸€ç³»åˆ—çš„ç›¸å…³æ–‡ç« ï¼Œä¸ºåæ¥å‡†å¤‡å·¥ä½œï¼ˆé¢è¯•ï¼‰çš„åŒå­¦æä¾›ä¸€äº›è‡ªå·±çš„å¸®åŠ©ã€‚è‡ªå·±åœ¨æ‰¾å·¥ä½œçš„è¿™æ®µæ—¶é—´é¢è¿‡çš„å…¬å¸ä¹Ÿæœ‰å‡ å®¶å¤§å‚ï¼Œä½†æ˜¯ç»“æœéƒ½ä¸æ˜¯å¾ˆå¥½ï¼Œå¯¹æˆ‘è‡ªå·±æœ‰å¾ˆå¤§çš„å‹åŠ›ï¼Œå½“æ—¶å¿ƒé‡ŒçœŸçš„æ„Ÿè§‰ ï¼šâ€œè‡ªå·±çœŸçš„æœ‰è¿™ä¹ˆå·®â€ï¼Œä¸ºä»€ä¹ˆä¸€ç›´è¢«æ‹’ï¼Œå½“æ—¶å¾ˆæ€€ç–‘è‡ªå·±çš„èƒ½åŠ›ï¼Œè‡ªå·±ä¹Ÿæœ‰æ€»ç»“åŸå› ã€‚ä¸€æ˜¯é¢è¯•çš„æ—¶å€™è‡ªå·±å‡†å¤‡çš„è¿˜ä¸å¤Ÿå……åˆ†ï¼Œè™½è¯´è‡ªå·±è„‘å­é‡Œå¯¹è¿™äº›åŸºç¡€æœ‰ç‚¹å°è±¡ï¼Œä½†æ˜¯é¢è¯•çš„æ—¶å€™è‡ªå·±ç¨ç´§å¼ ä¸‹å°±æè¿°ä¸æ€ä¹ˆæ¸…æ¥šäº†ï¼Œå¯¼è‡´é¢è¯•å®˜è§‰å¾—ä½ å¯èƒ½å¹¿åº¦å¤Ÿäº†ï¼Œæ·±åº¦è¿˜ä¸å¤Ÿï¼ˆè¿™æ˜¯é˜¿é‡Œé¢è¯•å®˜ç”µè¯é¢è¯•è¯´çš„ï¼‰ï¼›äºŒæ˜¯è‡ªå·±çš„è¡¨è¾¾èƒ½åŠ›è¿˜æ˜¯æœ‰æ‰€æ¬ ç¼ºï¼Œä¸èƒ½å¤Ÿå°†è‡ªå·±æ‰€è¦è¡¨è¾¾çš„ä¸œè¥¿è¯´å‡ºæ¥ï¼Œè¿™å¯èƒ½æˆ‘è¦åœ¨åé¢åŠ å¼ºçš„åœ°æ–¹ï¼›ä¸‰æ˜¯æˆ‘çš„å­¦æ ¡é—®é¢˜ã€‚åœ¨é¢äº†å‡ å®¶å…¬å¸å¤±è´¥åï¼Œç»ˆäºé¢äº†å®¶å…¬å¸è¦æˆ‘äº†ï¼Œæˆ‘ä¹Ÿç¡®å®šåœ¨è¿™å®¶å…¬å¸äº†ã€‚å¾ˆå¹¸è¿ï¼Œåˆšå‡ºæ¥ï¼Œå°±æœ‰ä¸€ä¸ªå¾ˆå¥½ï¼ˆå¾ˆè´Ÿè´£ï¼‰çš„æ¶æ„å¸ˆå¸¦æˆ‘ï¼Œè¿™å‘¨å°±ç»™äº†æˆ‘ä¸€ä¸ªå¾ˆç‰›é€¼çš„é¡¹ç›®ç»™æˆ‘çœ‹ï¼Œé‡Œé¢æ–°ä¸œè¥¿å¾ˆå¤šï¼Œè¯´åƒé€äº†è¿™ä¸ªé¡¹ç›®ï¼Œä»¥åç»å¯¹å¯ä»¥æ‹¿å‡ºå»å¹é€¼ï¼ˆä¸€è„¸æ­£ç».jpgï¼‰ã€‚æ‰¾å·¥ä½œæœŸé—´ï¼Œè‡ªå·±ä¹Ÿç»å¸¸å»æ”¶é›†ä¸€äº›åšå®¢ï¼Œå¹¶æŠŠå®ƒä¿å­˜ä¸‹æ¥ï¼Œè¿™æ ·èƒ½å¤Ÿè®©è‡ªå·±ä¸‹æ¬¡æ›´å¥½çš„ç³»ç»Ÿå¤ä¹ ï¼Œè¿˜åœ¨ç‰›å®¢ç½‘æ•´ç†äº†å¾ˆå¤šé¢ç»ï¼Œæ¯å¤©çœ‹å‡ ç¯‡é¢ç»ï¼ŒçŸ¥é“é¢è¯•ä¸€èˆ¬é—®ä»€ä¹ˆé—®é¢˜ï¼Œéƒ½æœ‰å•¥å¥—è·¯ï¼Œå…¶å®ä½ çœ‹å¤šäº†é¢ç»å°±ä¼šå‘ç°ï¼Œé¢è¯•è€ƒçš„é¢˜ç›®å‡ ä¹éƒ½å·®ä¸å¤šï¼ŒåŒºåˆ«ä¸æ˜¯å¾ˆå¤§ã€‚ç›®å‰æˆ‘çš„æ‰¾å·¥ä½œç»å†å°±ç®€çŸ­çš„ä»‹ç»åˆ°è¿™é‡Œäº†ï¼Œå¦‚æœæ„Ÿå…´è¶£çš„è¯ï¼Œå¯ä»¥åŠ ç¾¤ï¼š528776268 æœŸå¾…å¿—åŒé“åˆçš„ä½ ã€‚ è‡ªå·±é¢è¯•é¢ç»äºšä¿¡åœ°å€ï¼šhttp://www.54tianzhisheng.cn/2017/08/04/yaxin/ 1ï¼‰è‡ªæˆ‘ä»‹ç»ï¼ˆè¯´åˆ°ä¸€ä¸ªäº®ç‚¹ï¼šé•¿æœŸåšæŒå†™åšå®¢ï¼Œé¢è¯•å®˜è§‰å¾—è¿™ä¸ªä¹ æƒ¯å¾ˆå¥½ï¼Œç®—åŠ åˆ†é¡¹å§ï¼‰ 2ï¼‰çœ‹åˆ°ç®€å†é¡¹ç›®ä¸­ç”¨åˆ° Solrï¼Œè¯¦ç»†çš„é—®äº†ä¸‹ Solrï¼ˆè‡ªå·±ä»‹ç»äº†ä¸‹ Solr çš„ä½¿ç”¨åœºæ™¯å’Œå»ºç«‹ç´¢å¼•ç­‰ä¸œè¥¿ï¼‰ 3ï¼‰é¡¹ç›®é‡Œé¢å†™äº†ä¸€ä¸ª â€œ æ•æ„Ÿè¯å’Œ JS æ ‡ç­¾è¿‡æ»¤é˜² XSS æ”»å‡»â€ï¼Œé¢è¯•å®˜è®©æˆ‘è®²äº†ä¸‹è¿™ä¸ª XSS æ”»å‡»ï¼Œå¹¶ä¸”æ˜¯æ€æ ·å®ç°çš„ 4ï¼‰é¡¹ç›®é‡Œå†™äº†æ”¯æŒ Markdownï¼Œé—®æ˜¯ä¸æ˜¯è‡ªå·±å†™çš„è§£æä»£ç ï¼Œï¼ˆå›ç­”ä¸æ˜¯ï¼Œè‡ªå·±å¼•ç”¨çš„æ˜¯ GitHubä¸Šçš„ä¸€ä¸ªå¼€æºé¡¹ç›®è§£æçš„ï¼‰ 5ï¼‰æƒ³é—®æˆ‘å‰ç«¯çš„çŸ¥è¯†ï¼Œæˆ‘å›å¤åˆ°ï¼šè‡ªå·±ååç«¯å¼€å‘ï¼Œå‰ç«¯åªæ˜¯äº†è§£ï¼Œç„¶åé¢è¯•å®˜å°±ä¸é—®äº† 6ï¼‰é—®æˆ‘è€ƒä¸è€ƒç ”ï¼Ÿ 7ï¼‰è§‰å¾—æ­å·æ€ä¹ˆæ ·ï¼Ÿæ˜¯æ‰“ç®—å°±å‘†åœ¨æ­å·è¿˜æ˜¯æŠŠæ­å·ä½œä¸ºä¸€ä¸ªè·³æ¿ï¼Ÿ 8ï¼‰æœ‰å•¥å°ç›®æ ‡ï¼Ÿä»¥åæ˜¯æ‰“ç®—ç»§ç»­æŠ€æœ¯æ–¹å‘ï¼Œè¿˜æ˜¯å…ˆæŠ€æœ¯åç®¡ç†ï¼ˆè¿˜å¼€ç©ç¬‘çš„è¯´ï¼šæ˜¯ä¸æ˜¯èµšä»–å‡ ä¸ªäº¿ï¼Œå½“æ—¶æˆ‘ç¬‘äº†ç¬‘ï¼‰ 9ï¼‰æœ‰å•¥å…´è¶£çˆ±å¥½ï¼Ÿ æ€»ç»“ï¼šé¢è¯•é—®çš„é—®é¢˜ä¸ç®—å¤šï¼Œä¸»è¦æ˜¯é€šè¿‡ç®€å†ä¸Šé¡¹ç›®æ‰€æ¶‰åŠçš„ä¸œè¥¿æé—®çš„ï¼Œå¦‚æœè‡ªå·±ä¸å¤ªä¼šçš„åˆ‡è®°ä¸è¦å†™ä¸Šå»ã€‚é¢è¯•ä¸»è¦è€ƒå¯Ÿä½ å›ç­”é—®é¢˜æ¥åˆ¤æ–­ä½ çš„é€»è¾‘æ˜¯å¦å¾ˆæ¸…æ¥šã€‚ çˆ±å¥‡è‰ºåœ°å€ï¼šhttp://www.54tianzhisheng.cn/2017/08/04/iqiyi/ ç¬”è¯•ï¼ˆåŠä¸ªå°æ—¶ï¼‰é¢˜ç›®ï¼šï¼ˆè®°å¾—ä¸€äº›ï¼‰ 1ã€é‡è½½é‡å†™çš„åŒºåˆ«ï¼Ÿ 2ã€è½¬å‘å’Œé‡å®šå‘çš„åŒºåˆ«ï¼Ÿ 3ã€ç”»ä¸‹ HashMap çš„ç»“æ„å›¾ï¼ŸHashMap ã€ HashTable å’Œ ConcurrentHashMap çš„åŒºåˆ«ï¼Ÿ 4ã€statement å’Œ preparedstatement åŒºåˆ«ï¼Ÿ 5ã€JSP ä¸­ä¸€ä¸ª ä¸­å–å€¼ä¸ç›´æ¥å–å€¼çš„åŒºåˆ«ï¼Ÿä¼šæœ‰ä»€ä¹ˆå®‰å…¨é—®é¢˜ï¼Ÿ 6ã€å®ç°ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼ 7ã€ä¸€ä¸ªå†™ sql è¯­å¥çš„é¢˜ç›® 8ã€è‡ªå·±å®ç°ä¸€ä¸ª Listï¼Œï¼ˆä¸»è¦å®ç° addç­‰å¸¸ç”¨æ–¹æ³•ï¼‰ 9ã€Spring ä¸­ IOC å’Œ AOP çš„ç†è§£ï¼Ÿ 10ã€ä¸¤ä¸ªå¯¹è±¡çš„ hashcode ç›¸åŒï¼Œæ˜¯å¦å¯¹è±¡ç›¸åŒï¼Ÿequal() ç›¸åŒå‘¢ï¼Ÿ 11ã€@RequestBody å’Œ @ResponseBody åŒºåˆ«ï¼Ÿ 12ã€JVM ä¸€ä¸ªé”™è¯¯ï¼Œä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‘ç”Ÿï¼Ÿ 13ã€å¸¸ç”¨çš„ Linux å‘½ä»¤ï¼Ÿ ç¬¬ä¸€è½®é¢è¯•ï¼ˆ80 åˆ†é’Ÿï¼‰1ã€è‡ªæˆ‘ä»‹ç» 2ã€ä»‹ç»ä½ æœ€ç†Ÿæ‚‰çš„ä¸€ä¸ªé¡¹ç›® 3ã€è®²ä¸‹è¿™ä¸ª XSS æ”»å‡» 4ã€HashMap çš„ç»“æ„ï¼ŸHashMap ã€ HashTable å’Œ ConcurrentHashMap çš„åŒºåˆ«ï¼Ÿ 5ã€HashMap ä¸­æ€ä¹ˆè§£å†³å†²çªçš„ï¼Ÿï¼ˆè¦æˆ‘è¯¦ç»†è®²ä¸‹ï¼‰ 6ã€ConcurrentHashMap å’Œ HashTable ä¸­çº¿ç¨‹å®‰å…¨çš„åŒºåˆ«ï¼Ÿä¸ºå•¥å»ºè®®ç”¨ ConcurrentHashMap ï¼Ÿèƒ½æŠŠ ConcurrentHashMap é‡Œé¢çš„å®ç°è¯¦ç»†çš„è®²ä¸‹å—ï¼Ÿ 7ã€Session å’Œ Cookie çš„åŒºåˆ«ï¼Ÿ 8ã€ä½ é¡¹ç›®ä¸­ç™»å½•æ˜¯æ€æ ·åšçš„ï¼Œç”¨çš„ Cookie å’Œ Sessionï¼Ÿ 9ã€è®²è®²ä½ å¯¹ Spring ä¸­çš„ IOC å’Œ AOP çš„ç†è§£ï¼Ÿ 10ã€é—®äº†å¥½å‡ ä¸ªæ³¨è§£çš„ä½œç”¨ï¼Ÿ 11ã€statement å’Œ preparedstatement åŒºåˆ«ï¼Ÿ 12ã€$ å’Œ # çš„åŒºåˆ«ï¼Ÿä»¥åŠè¿™ä¸¤ä¸ªåœ¨å“ªäº›åœ°æ–¹ç”¨ï¼Ÿ 13ã€å‰é¢é¡¹ç›®ä»‹ç»äº†æ•°æ®æ˜¯çˆ¬è™«çˆ¬å–è¿‡æ¥çš„ï¼Œé‚£ä½ è®²è®²ä½ çš„çˆ¬è™«æ˜¯å¤šçº¿ç¨‹çš„å§ï¼Ÿ 14ã€è®²è®² Python ä¸­çš„å¤šçº¿ç¨‹å’Œ Java ä¸­çš„å¤šçº¿ç¨‹åŒºåˆ«ï¼Ÿ 15ã€è‡ªå·±åˆšå¥½å‰å‡ å¤©åœ¨çœ‹çº¿ç¨‹æ± ï¼Œç«‹é©¬å°±æŠŠé¢è¯•å®˜å¸¦åˆ°æˆ‘ç†Ÿæ‚‰çš„çº¿ç¨‹æ± ï¼Œå’Œé¢è¯•å®˜è®²äº†ä¸‹ JDK è‡ªå¸¦çš„å››ç§çº¿ç¨‹æ± ã€ThreadPoolExecutor ç±»ä¸­çš„æœ€é‡è¦çš„æ„é€ å™¨é‡Œé¢çš„ä¸ƒä¸ªå‚æ•°ï¼Œç„¶åå†è®²äº†ä¸‹çº¿ç¨‹ä»»åŠ¡è¿›å…¥çº¿ç¨‹æ± å’Œæ ¸å¿ƒçº¿ç¨‹æ•°ã€ç¼“å†²é˜Ÿåˆ—ã€æœ€å¤§çº¿ç¨‹æ•°é‡æ¯”è¾ƒã€‚ 16ã€çº¿ç¨‹åŒæ­¥ï¼Œä½ äº†è§£å“ªå‡ ç§æ–¹å¼ï¼Ÿ 17ã€è®²ä¸‹ Synchronizedï¼Ÿ 18ã€è®²ä¸‹ RecentLock å¯é‡å…¥é”ï¼Ÿ ä»€ä¹ˆæ˜¯å¯é‡å…¥é”ï¼Ÿä¸ºä»€ä¹ˆè¦è®¾è®¡å¯é‡å…¥é”ï¼Ÿ 19ã€è®²ä¸‹ Volatile å§ï¼Ÿä»–æ˜¯æ€æ ·åšåˆ°åŒæ­¥çš„ï¼Ÿ 20ã€Volatile ä¸ºä»€ä¹ˆä¸æ”¯æŒåŸå­æ€§ï¼Ÿä¸¾ä¸ªä¾‹å­ 21ã€Atomic æ€ä¹ˆè®¾è®¡çš„ï¼Ÿï¼ˆæ²¡çœ‹è¿‡æºç ï¼Œå½“æ—¶å›ç­”é”™äº†ï¼Œåæ¥æ‰å‘ç°é‡Œé¢å…¨éƒ¨ç”¨ final ä¿®é¥°çš„å±æ€§å’Œæ–¹æ³•ï¼‰ 22ã€é—®å‡ ä¸ªå‰ç«¯çš„æ ‡ç­¾å§ï¼Ÿï¼ˆé—®äº†ä¸€ä¸ªä¸ä¼šï¼Œç›´æ¥è¯´æ˜æˆ‘ååç«¯ï¼Œå‰ç«¯åªæ˜¯äº†è§£ï¼Œåé¢å°±ä¸é—®äº†ï¼‰ 23ã€SpringBoot çš„äº†è§£ï¼Ÿ 24ã€Linux å¸¸ç”¨å‘½ä»¤ï¼Ÿ 25ã€JVM é‡Œçš„å‡ ä¸ªé—®é¢˜ï¼Ÿ 26ã€äº‹åŠ¡çš„ç‰¹æ€§ï¼Ÿ 27ã€éš”ç¦»çº§åˆ«ï¼Ÿ 28ã€ç½‘ç»œçŠ¶æ€ç ï¼Ÿä»¥ 2ã€3ã€4ã€5 å¼€å¤´çš„ä»£è¡¨ä»€ä¹ˆæ„æ€ã€‚ 29ã€å¹¶å‘å’Œå¹¶è¡Œçš„åŒºåˆ«ï¼Ÿ 30ã€ä½ æœ‰ä»€ä¹ˆé—®é¢˜æƒ³é—®æˆ‘çš„ï¼Ÿ ä¸€é¢é¢å®Œåé¢è¯•å®˜å’Œè¯´è¿™ä»½è¯•å·æ˜¯ç”¨æ¥è€ƒ 1~3 å¹´å¼€å‘å·¥ä½œç»éªŒçš„ï¼Œè®©æˆ‘å‡†å¤‡ä¸€ä¸‹ï¼Œæ¥ä¸‹æ¥çš„äºŒé¢ã€‚ ç¬¬äºŒè½®é¢è¯•ï¼ˆåŠä¸ªå°æ—¶ï¼‰1ã€ä¸€ä¸Šæ¥å°±é—®æ€ä¹ˆç®€å†åå­—éƒ½æ²¡æœ‰ï¼Œæˆ‘æŒ‡äº†ç®€å†ç¬¬ä¸€è¡Œçš„æˆ‘çš„åå­—ï¼Œè¿˜ç‰¹æ„å¤§å†™äº†ï¼Œç„¶åå°±é—®å­¦æ ¡æ˜¯ä¸æ˜¯åœ¨ä¸Šæµ·ï¼Œæˆ‘å›ç­”åœ¨å—æ˜Œï¼ˆæ„Ÿè§‰è¢«é„™è§†äº†ä¸€æ³¢ï¼Œåé¢æˆ‘åœ¨å›ç­”é—®é¢˜çš„æ—¶å€™é¢è¯•å®˜å°±ä¸€ç›´åœ¨ç©æ‰‹æœºï¼Œä¼°è®¡åé¢å¯¹æˆ‘çš„å°è±¡å°±ä¸æ˜¯å¾ˆå¥½äº†ï¼‰ 2ã€è‡ªæˆ‘ä»‹ç» 3ã€è¯´ä¸€è¯´æ•°æ®åº“å»ºè¡¨å§ï¼ˆä»èŒƒå¼è®²ï¼‰ 4ã€è®²è®²å¤šæ€ï¼Ÿï¼ˆè¿™ä¸ªæˆ‘ç­”å‡ºæ¥äº†ï¼Œå¯æ˜¯é¢è¯•å®˜ç«Ÿç„¶è¯´ä¸æ˜¯è¿™æ ·å§ï¼Œå¯èƒ½é¢è¯•å®˜æ²¡å¬è¯·ï¼Œåé¢è¿˜è¯´æˆ‘æ˜¯ä¸æ˜¯å¹³æ—¶å†™å¤šæ€æ¯”è¾ƒå°‘ï¼Œæ„Ÿè§‰è¿™ä¸ªä¹Ÿè®©é¢è¯•å®˜å¯¹æˆ‘å°è±¡å‡åˆ†ï¼‰ 5ã€å°†ä¸¤ä¸ªæ•°è½¬æ¢ï¼ˆä¸å€ŸåŠ©ç¬¬ä¸‰ä¸ªå‚æ•°ï¼‰ 6ã€æ‰‹å†™ä¸ªæ’å…¥æ’åºå§ï¼ˆå†™å®Œäº†å’Œé¢è¯•å®˜è®²äº†ä¸‹æ‰§è¡Œæµç¨‹ï¼‰ 7ã€è®²è®²ä½ å¯¹ Spring ä¸­çš„ IOC å’Œ AOP çš„ç†è§£ï¼Ÿ 8ã€é—®äº†å‡ ä¸ªå¸¸ç”¨çš„ Linux å‘½ä»¤ï¼Ÿ 9ã€ä¹Ÿé—®åˆ°å¤šçº¿ç¨‹ï¼Ÿå’Œä¸€é¢ä¸€æ ·æŠŠè‡ªå·±æœ€è¿‘çœ‹çš„çº¿ç¨‹æ± ä¹Ÿè®²äº†ä¸€é 10ã€å­¦ Java å¤šä¹…äº†ï¼Ÿ 11ã€ä½ æœ‰ä»€ä¹ˆæƒ³é—®çš„ï¼Ÿ æ€»ç»“ï¼šé¢è¯•é¢˜ç›®å¤§æ¦‚å°±æ˜¯è¿™ä¹ˆå¤šäº†ï¼Œæœ‰äº›é—®é¢˜è‡ªå·±ä¹Ÿå¿˜è®°äº†ï¼Œé¢è¯•é¢˜ç›®é¡ºåºä¸ä¸€å®šæ˜¯æŒ‰ç…§ä¸Šé¢æ‰€å†™çš„ã€‚å†æ¬¡æ„Ÿè°¢çˆ±å¥‡è‰ºçš„ç¬¬ä¸€é¢é¢è¯•å®˜äº†ï¼Œè¦ä¸æ˜¯ä»–å¸®å¿™å†…æ¨çš„ï¼Œæˆ‘å¯èƒ½è¿˜æ²¡æœ‰æœºä¼šæ”¶åˆ°é¢è¯•æœºä¼šã€‚è‡ªå·±æ¥åˆ°çˆ±å¥‡è‰ºé¢è¯•é‚€è¯·ç”µè¯æ˜¯æ˜ŸæœŸä¸€æ™šä¸Šå¿«7ç‚¹ä¸­çš„ï¼Œä¹‹ååŠ äº†é¢è¯•å®˜å¾®ä¿¡çº¦å¥½äº†æ˜ŸæœŸå››é¢è¯•çš„ï¼ˆæ—¶é—´å‡†å¤‡è¾ƒçŸ­ï¼Œä¹‹å‰æ²¡ç³»ç»Ÿçš„å¤ä¹ è¿‡ï¼‰ã€‚æ˜ŸæœŸå››ä¸€å¤§æ—©ï¼ˆ5ç‚¹å°±èµ·åºŠäº†ï¼‰ï¼Œç„¶åå°±æ”¶æ‹¾äº†ä¸‹ï¼Œå»ç­‰å…¬äº¤è½¦ï¼Œè½¬äº†ä¸¤æ¬¡è½¦ï¼Œç„¶åå†åšåœ°é“å»çˆ±å¥‡è‰ºå…¬å¸çš„ï¼Œæ€»å…±è·¯ä¸ŠèŠ±è´¹æ—¶é—´å››ä¸ªå¤šå°æ—¶ã€‚æ€»çš„æ¥è¯´ï¼Œè¿™æ¬¡é¢è¯•å‡†å¤‡çš„æ—¶é—´ä¸æ˜¯å¾ˆå……è£•ï¼Œæ‰€ä»¥å‡†å¤‡çš„ä¸ªäººè§‰å¾—ä¸æ˜¯å¾ˆå¥½ï¼Œé€šè¿‡è¿™æ¬¡çš„é¢è¯•ï¼Œå‘ç°é¢è¯•è¿˜æ˜¯æ¯”è¾ƒæ³¨é‡åŸºç¡€å’Œæ·±åº¦çš„ï¼Œæˆ‘ä¹ŸçŸ¥é“äº†è‡ªå·±çš„ä¸€äº›å¼±å¤„ï¼Œè¿˜éœ€è¦åœ¨å“ªé‡ŒåŠ å¼ºï¼Œé¢è¯•æŠ€å·§ä¸Šä¹Ÿè¦æŒæ¡äº›ã€‚ä¸ºåé¢çš„å…¶ä»–å…¬å¸ç»§ç»­åšå¥½å……è¶³çš„å‡†å¤‡ã€‚åŠ æ²¹ï¼ï¼ï¼ é˜¿é‡Œåœ°å€ï¼šhttp://www.54tianzhisheng.cn/2017/08/04/alibaba/ ï¼ˆèœé¸Ÿç½‘ç»œéƒ¨é—¨ï¼‰ï¼ˆ49 åˆ†é’Ÿï¼‰ 2017.08.02 æ™šä¸Š9ç‚¹21æ‰“ç”µè¯è¿‡æ¥ï¼Œé¢„çº¦æ˜å¤©ä»€ä¹ˆæ—¶å€™æœ‰ç©ºé¢è¯•ï¼Œçº¦å¥½ç¬¬äºŒå¤©ä¸‹åˆä¸¤ç‚¹ã€‚ 2017.08.03 ä¸‹åˆä¸¤ç‚¹10åˆ†æ‰“è¿‡æ¥äº†ã€‚ è¯´çœ‹äº†æˆ‘çš„åšå®¢å’Œ GitHubï¼Œè§‰å¾—æˆ‘å­¦çš„è¿˜è¡Œï¼ŒçŸ¥è¯†å¹¿åº¦éƒ½è¿˜ä¸é”™ï¼Œä½†æ˜¯è¿˜æ˜¯è¦é—®é—®å…·ä½“æƒ…å†µï¼Œä¸ºä»€ä¹ˆæ²¡çœ‹åˆ°ä½ æ˜¥æ‹›çš„è®°å½•ï¼Œä»€ä¹ˆåŸå› æ²¡æŠ•é˜¿é‡Œï¼Ÿéå¾—è¯´ä¸€ä¸ªåŸå› ï¼Œé‚£å°±æ˜¯ï¼šæˆ‘è‡ªå·±å¤ªèœäº†ï¼Œä¸æ•¢æŠ•ã€‚ 1ã€å…ˆè‡ªæˆ‘ä»‹ç» 2ã€ä»€ä¹ˆæ˜¯å¤šæ€ï¼Ÿå“ªé‡Œä½“ç°äº†å¤šæ€çš„æ¦‚å¿µï¼Ÿ 3ã€HashMap æºç åˆ†æï¼ŒæŠŠé‡Œé¢çš„ä¸œè¥¿é—®äº†ä¸ªéï¼Ÿæœ€åé—®æ˜¯ä¸æ˜¯çº¿ç¨‹å®‰å…¨ï¼Ÿå¼•å‡º ConcurrentHashMap 4ã€ConcurrentHashMap æºç åˆ†æ 5ã€ç±»åŠ è½½ï¼ŒåŒäº²å§”æ‰˜æœºåˆ¶ 6ã€Javaå†…å­˜æ¨¡å‹ï¼ˆä¸€å¼€å§‹è¯´çš„ä¸æ˜¯ä»–æƒ³è¦çš„ï¼Œä¸»è¦æƒ³é—®æˆ‘å †å’Œæ ˆçš„ç»†èŠ‚ï¼‰ 7ã€åƒåœ¾å›æ”¶ç®—æ³• 8ã€çº¿ç¨‹æ± ï¼Œè‡ªå·±ä¹‹å‰çœ‹è¿‡ï¼Œæ‰€ä»¥è¯´çš„æ¯”è¾ƒå¤šï¼Œæœ€åé¢è¯•å®˜è¯´äº†å¥ï¼šçœ‹ä½ å¯¹çº¿ç¨‹æ± äº†è§£è¿˜æ˜¯å¾ˆæ·±äº† 9ã€äº‹åŠ¡çš„å››ç§ç‰¹æ€§ 10ã€ä»€ä¹ˆæ˜¯æ­»é”ï¼Ÿ 11ã€ä¹è§‚é”å’Œæ‚²è§‚é”çš„ç­–ç•¥ 12ã€é«˜å¯ç”¨ç½‘ç«™çš„è®¾è®¡ï¼ˆæœ‰ä»€ä¹ˆæŠ€æœ¯å®ç°ï¼‰ 13ã€ä½è€¦åˆé«˜å†…èš 14ã€è®¾è®¡æ¨¡å¼äº†è§£ä¸ï¼Ÿä½ ç”¨è¿‡å“ªå‡ ç§ï¼Œä¸ºä»€ä¹ˆç”¨ï¼Œå•ä¾‹æ¨¡å¼å¸®æˆ‘ä»¬åšä»€ä¹ˆä¸œè¥¿ï¼Ÿæœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ 15ã€ä½ å‚ä¸ä»€ä¹ˆé¡¹ç›®ä¸­æˆé•¿æ¯”è¾ƒå¿«ï¼Ÿå­¦åˆ°äº†ä»€ä¹ˆä¸œè¥¿ï¼Œä»¥å‰æ˜¯æ²¡æœ‰å­¦è¿‡çš„ï¼Ÿ 16ã€é¡¹ç›®ä¸­é‡åˆ°çš„æœ€å¤§å›°éš¾æ˜¯æ€æ ·çš„ï¼Ÿæ˜¯æ€ä¹ˆè§£å†³çš„ï¼Ÿ 17ã€æ™ºåŠ›é¢˜ï¼ˆä¸¤æ ¹ä¸å‡åŒ€çš„é¦™ï¼Œç‚¹ä¸€å¤´çƒ§å®Œè¦ä¸€ä¸ªå°æ—¶ï¼Œæ€ä¹ˆç¡®å®š15åˆ†é’Ÿï¼‰ 18ã€ä½ æœ‰ä»€ä¹ˆé—®é¢˜æƒ³è¦é—®æˆ‘çš„ï¼Ÿ 19ã€é—®äº†èœé¸Ÿç½‘ç»œä»–ä»¬éƒ¨é—¨ä¸»è¦åšä»€ä¹ˆï¼Ÿ 20ã€å¯¹æˆ‘è¿™æ¬¡é¢è¯•åšä¸ªè¯„ä»·ï¼šçœ‹äº†ä½ åšå®¢å’Œ GitHubï¼ŒçŸ¥é“ä½ å¯¹å­¦ä¹ çš„çƒ­æƒ…è¿˜æ˜¯å¾ˆé«˜çš„ï¼ŒèŠ±äº†ä¸å°‘åŠŸå¤«ï¼Œåé¢æœ‰é€šçŸ¥ï¼ æ€»ç»“ï¼šé¢è¯•æ€»çš„æ¥è¯´ï¼Œç¬¬ä¸€æ¬¡ç”µè¯é¢è¯•ï¼Œæ„Ÿè§‰å¥½ç´§å¼ ï¼Œå¥½å¤šé—®é¢˜è‡ªå·±ä¼šç‚¹ï¼Œä½†æ˜¯å…¶ä¸­çš„ç»†èŠ‚æ²¡å¼„æ¸…æ¥šï¼Œè‡ªå·±å‡†å¤‡çš„ä¹Ÿä¸å¤Ÿå……åˆ†ã€‚é¢è¯•å®˜å¾ˆå‹å¥½ï¼Œçœ‹åˆ°æˆ‘ç´§å¼ ï¼Œä¹Ÿå®‰æ…°æˆ‘è¯´ä¸è¦ç´§ï¼Œä¸ç®¡ä»¥åå‡ºå»é¢è¯•å•¥çš„ï¼Œä¸éœ€è¦ç´§å¼ ï¼Œå…¬å¸é—®çš„é—®é¢˜å¯èƒ½å¾ˆå¹¿ï¼Œä½ åªéœ€è¦æŠŠä½ çŸ¥é“çš„è¯´å‡ºæ¥å°±è¡Œï¼Œä¸ä¼šçš„ç›´æ¥è¯´ä¸ä¼šå°±è¡Œã€‚ä¹‹å‰ä¸€ç›´ä¸æ•¢æŠ•é˜¿é‡Œï¼Œå› ä¸ºè‡ªå·±å‡†å¤‡çš„å®Œå…¨ä¸å¤Ÿå……åˆ†ï¼Œä½†æ˜¯åœ¨æœ‹å‹ç£Šå“¥çš„å¸®åŠ©ä¸‹ï¼Œè¿˜æ˜¯è¯•äº†ä¸‹ï¼Œä¸ç®¡ç»“æœæ€ä¹ˆæ ·ï¼Œç»å†è¿‡æ€»æ¯”æ²¡æœ‰çš„å¥½ã€‚ åé¢è¯´æœ‰é€šçŸ¥ï¼Œç»“æœå¹¶æ²¡æœ‰ï¼Œåªçœ‹åˆ°å®˜ç½‘çš„æŠ•é€’æŒ‰é’®å˜ç°äº†ã€‚åœ¨æ˜é‡‘ä¸Šä¸€ä¸ªæœ‹å‹ï¼ˆæˆ‘éš”å£å­¦æ ¡çš„ï¼‰ï¼Œå½“æ—¶çœ‹æˆ‘æŒ‚äº†è¯´è¦ä¸è¦è®©ä»–ç§Ÿä¸€èµ·çš„éš”å£é‚»å±…å†å†…æ¨ä¸‹æ·˜å®ï¼Œæˆ‘æƒ³æƒ³è¿˜æ˜¯ç®—äº†ï¼Œè‡ªå·±ç›®å‰èƒ½åŠ›çœŸçš„æ˜¯æœ‰é™ï¼Œè¾¾ä¸åˆ°è¿›é˜¿é‡Œçš„è¦æ±‚ï¼ä¸è¿‡è¿˜æ˜¯è¦æ„Ÿè°¢é‚£ä¸ªå“¥ä»¬ï¼ŒäººçœŸçš„è¶…çº§å¥½ï¼Œè™½ç„¶æˆ‘ä»¬æœªæ›¾è°‹é¢ï¼Œä½†æ˜¯æœ‰æœºä¼šçš„è¯ï¼Œæˆ‘ä¸€å®šä¼šè¯·ä½ åƒé¥­çš„ã€‚ å“”å“©å“”å“©é¦–å…ˆç›´æ¥æ ¹æ®ç®€å†é¡¹ç›®å¼€é—®ï¼Œè‡ªæˆ‘ä»‹ç»éƒ½æ²¡æœ‰ã€‚ 1ã€ç™»å½•ä»å‰ç«¯åˆ°åç«¯æ•´ä¸ªè¿‡ç¨‹æè¿°ä¸€éï¼Ÿè¶Šè¯¦ç»†è¶Šå¥½ï¼Œè¯´åˆ°å¯†ç åŠ å¯†ï¼Œç½‘ç»œä¼ è¾“ï¼Œåå°éªŒè¯ç”¨æˆ·åå’Œå¯†ç ï¼ŒCookie è®¾ç½®ç­‰ã€‚å…·ä½“é—®æˆ‘å¯†ç åŠ å¯†æ˜¯å‰å°è¿˜æ˜¯åå°åŠ å¯†ï¼Œè¯´äº†åœ¨åå°åŠ å¯†ï¼Ÿé¢è¯•å®˜è¯´ï¼Œé‚£ä½ åšè¿™ä¸ªé¡¹ç›®æœ‰ä»€ä¹ˆæ„æ€ï¼Ÿå¯†ç ä¼ è¾“éƒ½æ˜¯æ˜æ–‡çš„ï¼Œé»˜è®¤ HTTP ä¼ é€’æ˜¯æ˜æ–‡ä¼ è¾“ï¼Œå½“æ—¶è¢«é¢è¯•å®˜å¸¦è¿›å‰å°åŠ å¯†è¿˜æ˜¯åå°åŠ å¯†çš„æ²Ÿé‡Œå»äº†ï¼Œæ²¡æƒ³åˆ°ç”¨ HTTPS ï¼Œåæ¥åæ¥çš„è·¯ä¸ŠæŸ¥äº†äº›èµ„æ–™æ‰çŸ¥é“çš„ï¼Œé¢è¯•è¿‡ç¨‹ä¸­ä»–å¾ˆæƒ³æˆ‘è¯´å‰å°åŠ å¯†ï¼Œä½†æ˜¯å‰å°åŠ å¯†ç®—æ³•é‚£ä»£ç å°±æ‘†åœ¨é‚£é‡Œï¼Œå¾ˆå®¹æ˜“å°±ç»™ç ´è§£äº†å§ï¼Œä¹Ÿæ²¡ç»™ç‚¹æç¤ºè¯´ HTTPSï¼Œæˆ‘åªå¥½æŠ•é™ 2ã€å†™ä¸€ä¸ªæŸ¥è¯¢çš„ sql è¯­å¥ 3ã€çº¿ç¨‹åŒæ­¥çš„æ–¹æ³•ï¼ŸSynchronizedã€Volatileã€ï¼ˆé¢è¯•å®˜å¥½åƒè§‰å¾— Volatile ä¸å¯ä»¥åšåˆ°åŒæ­¥ï¼Œæˆ‘å’Œä»–è¯´äº†åŠå¤©çš„ Volatile åŸç† ï¼Œä»–ç«Ÿç„¶ä¸è®¤åŒï¼Œæˆ‘å¼€å§‹æ€€ç–‘ä»–çš„å®åŠ›äº†ï¼‰ã€ThreadLocalã€Atomicã€‚ è¯´åˆ°è¿™äº›äº†ï¼Œæˆ‘å½“æ—¶ç«Ÿç„¶æ²¡æŠŠä»–å¸¦è¿›æˆ‘æˆ‘ç»™ä»–æŒ–çš„å‘é‡Œå»ï¼ˆçº¿ç¨‹æ± ï¼Œä¹‹å‰å¥½å¥½ç ”ç©¶è¿‡å‘¢ï¼Œå¯æƒœäº†ï¼‰ 4ã€Spring IOC å’Œ AOP çš„ç†è§£ï¼Ÿå«æˆ‘å†™ AOP çš„ä»£ç ï¼Œæˆ‘æ²¡å†™ 5ã€JDK åŠ¨æ€ä»£ç†å’Œ Cglib ä»£ç†åŒºåˆ«ï¼Ÿ 5ã€ä½ è§‰å¾—é¡¹ç›®é‡Œé¢ä½ è§‰å¾—å“ªäº›æŠ€æœ¯æ¯”è¾ƒå¥½ï¼Ÿæˆ‘æŒ‡äº†ä¸¤ä¸ªï¼Œç„¶åä»–ä¹Ÿæ²¡æœ‰é—®ä¸‹å»ã€‚ 6ã€è§£é‡Šä¸‹ XSS æ”»å‡» 7ã€Spring å’Œ SpringBoot çš„åŒºåˆ«ï¼Ÿ 8ã€JVM åƒåœ¾å›æ”¶ç®—æ³•ï¼Ÿåˆ†ä»£ä¸­ä¸ºä»€ä¹ˆè¦åˆ†ä¸‰å±‚ï¼Ÿ 9ã€OOM æ˜¯ä»€ä¹ˆï¼Ÿä»€ä¹ˆæƒ…å†µä¼šå‘ç”Ÿï¼Ÿ 10ã€ä½ è§‰å¾—ä½ æœ‰å•¥ä¼˜ç‚¹ï¼Ÿ ç„¶åå°±å«æˆ‘ç­‰ä¸€ä¼šï¼Œä¸€ä¼šæœ‰äººäº‹æ¥é€šçŸ¥æˆ‘ï¼Œç»“æœè¿‡äº†ä¸€ä¼šäººäº‹å«æˆ‘å¯ä»¥å›å»ç­‰é€šçŸ¥äº†ã€‚ æ€»ç»“ï¼šåˆ°å…¬å¸çš„æ—¶å€™å·²ç»ä¸€ç‚¹å¤šé’Ÿäº†ï¼Œé¢è¯•ç›´æ¥åœ¨ä¸€ä¸ªå¾ˆå¤šäººçš„åœ°æ–¹ï¼ˆåƒé¥­çš„åœ°æ–¹ï¼‰ç›´æ¥é¢çš„ï¼Œå‘¨å›´è¿˜æœ‰äººå†åƒé¥­ï¼Œåœºæ™¯æœ‰ç‚¹å°´å°¬ï¼Œé¢è¯•è¿‡ç¨‹æ„Ÿè§‰å¾ˆéšæ„ï¼Œæƒ³åˆ°ä»€ä¹ˆé—®é¢˜å°±é—®ä»€ä¹ˆï¼Œå®Œå…¨æ²¡æœ‰è¡”æ¥ï¼Œé—®åˆ°çš„æœ‰äº›åœ°æ–¹æ„Ÿè§‰é¢è¯•å®˜è‡ªå·±éƒ½ä¸æ¸…æ¥šï¼Œè¿˜æ€€ç–‘æˆ‘æ‰€è¯´çš„ï¼Œå¦å¤–å°±æ˜¯é—®é¢˜æ¯”è¾ƒåˆé’»ï¼Œæ€»ä½“æŠ€æœ¯ä¹Ÿå°±é‚£æ ·å§ï¼ ç›®å‰æ‰€åœ¨å…¬å¸å½“æ—¶æ˜¯æˆ‘ç°åœ¨çš„è€å¤§ï¼ˆæ¶æ„å¸ˆï¼‰é¢çš„ï¼Œå…ˆæ˜¯ç”µè¯é¢è¯•è¿‡ä¸€æ¬¡ï¼Œé—®çš„é—®é¢˜ä¹Ÿæ¯”è¾ƒéš¾ï¼Œä¸è¿‡æœ€åè¿˜æ˜¯è§‰å¾—æˆ‘åŸºç¡€è¿˜æ˜¯ä¸é”™çš„ã€‚æœ€åå«æˆ‘å»å…¬å¸é¢è¯•ä¸‹ï¼Œæ¥åˆ°å…¬å¸é¢è¯•é—®çš„é—®é¢˜é‚£å°±æ›´éš¾äº†ï¼Œå‡ ä¹å¥½å¤šéƒ½å›ç­”ä¸å‡ºæ¥ï¼Œä½†æ˜¯ç®€å•çš„è¯´äº†ä¸‹æ€è·¯ï¼Œæœ€åå†å«ä¸»ä»»é¢è¯•äº†ä¸‹ï¼Œé—®çš„é—®é¢˜å°±å¾ˆç®€å•äº†ï¼Œæœ€åå°±æ˜¯ HR é¢äº†ï¼Œä¸»è¦è¯´äº†ä¸‹å·¥èµ„é—®é¢˜å’Œä»€ä¹ˆæ—¶å€™èƒ½æŠ¥é“ï¼è¿™å‡ æ¬¡é¢è¯•çš„é—®é¢˜å½“æ—¶ç”±äºæ—¶é—´æ¯”è¾ƒç´§ï¼Œä¹Ÿæ²¡å»æ•´ç†ï¼Œç°åœ¨ä¹Ÿè®°ä¸æ¸…æ¥šäº†ï¼ç›®å‰è‡ªå·±å·²ç»å·¥ä½œäº†å¿«ä¸€ä¸ªæœˆäº†ï¼Œç»™çš„é¡¹ç›®ä¹Ÿå®Œå…¨æ˜¯æ–°ä¸œè¥¿ï¼Œå¯¹æˆ‘çš„æŒ‘æˆ˜ä¹Ÿå¾ˆå¤§ï¼Œæœ‰æ—¶è‡ªå·±ä¹Ÿç¡®å®ä¸æ€ä¹ˆçŸ¥é“ï¼Œä¸è¿‡æˆ‘è€å¤§å¾ˆè€å¿ƒçš„æ•™æˆ‘ï¼Œå¯¹æˆ‘ä¹Ÿå¾ˆä¸é”™ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘æ‰“ç®—ç•™åœ¨è¿™é‡Œçš„åŸå› ï¼Œç¢°åˆ°ä¸ªå¥½è€å¤§ä¸æ˜“ï¼å¿…é¡»å¥½å¥½çæƒœï¼ å®ä¹ æ„Ÿæ‚Ÿè¿›å…¬å¸æ˜¯æ¶æ„è¿ç»´ç»„ä¸­çš„ Java å®ä¹ å¼€å‘ï¼Œç›®å‰å®ä¹ å·²ç»å¿«ä¸€ä¸ªæœˆäº†ï¼Œè¯´å®è¯ï¼Œå®ä¹ åæ‰å‘ç°ä¸€å¤©çœŸçš„å¾ˆå¿™ï¼Œå†™ä¸‹è¿™ç¯‡å¾æ–‡ä¹Ÿæ˜¯åœ¨å‘¨æœ«æ•´ç†å¤§æ™šä¸Šå†™çš„ã€‚åˆšè¿›å…¬å¸å°±ç»™äº†ä¸€ä¸ª Consul çš„æœåŠ¡å‘ç°ä¸æ³¨å†Œå’Œå¥åº·æ£€æŸ¥çš„é¡¹ç›®ï¼Œé‡Œé¢æ¶‰åŠçš„ä¸œè¥¿æœ‰ Consulã€Dockerã€Nginxã€Luaã€ElasticSearch è¿˜æœ‰å‡ ä¸ªå¾ˆè½»é‡çº§çš„æ¡†æ¶ï¼Œå¯¹æˆ‘æ¥è¯´å‡ ä¹éƒ½æ˜¯æ–°ä¸œè¥¿ï¼Œç¡®å®éœ€è¦æ—¶é—´å»äº†è§£ï¼Œå†ä¼˜åŒ–å’Œæ”¹é‡Œé¢çš„ bug çš„è¿‡ç¨‹ä¸­ï¼Œå¹¸å¥½æˆ‘è€å¤§å’Œæˆ‘ç†äº†å‡ æ¬¡æ€è·¯ï¼Œæ‰è®©æˆ‘å¯¹æ•´ä¸ªé¡¹ç›®æœ‰æ‰€è¿›å±•ï¼Œåç»­ç»§ç»­æ˜¯åœ¨ä¼˜åŒ–è¿™é¡¹ç›®ï¼ˆå¯èƒ½ä»¥åè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä¸œè¥¿éƒ½æ˜¯æˆ‘æ¥åšï¼‰ã€‚åœ¨ä¸Šæµ·ï¼Œä½çš„åœ°æ–¹ç¦»å…¬å¸æœ‰ä¸€å®šçš„è·ç¦»ï¼Œä¸Šç­å‡ ä¹è¦ä¸€ä¸ªå°æ—¶ï¼Œæ¯å¤©èŠ±åœ¨ä¸Šç­è·¯ä¸Šçš„æ—¶é—´å¾ˆå¤šï¼Œè¿™ä¹Ÿå¯¼è‡´æˆ‘æ¯å¤©æ„Ÿè§‰å¾ˆå¿™ã€‚å…¬å¸ä¸Šç­æ—¶é—´æ¯”è¾ƒå¼¹æ€§ï¼Œæ— æ‰“å¡ï¼Œè™½è¯´å…¬å¸ä¸åŠ ç­ï¼Œä½†æ˜¯æ¯å¤©è‡ªå·±éƒ½ä¸æ€ä¹ˆä¼šæŒ‰ç‚¹ä¸‹ç­ï¼Œè‡ªå·±ä¹Ÿæƒ³åœ¨å®ä¹ é˜¶æ®µå¤šå­¦ç‚¹ä¸œè¥¿ï¼è¿™æ®µæ—¶é—´ä¹Ÿæ˜¯æœ€å…³é”®çš„æ—¶é—´ï¼Œç¢°åˆ°ä¸ªé—®é¢˜ï¼Œè¦èŠ±å¥½ä¹…æ—¶é—´æ‰èƒ½è§£å†³ï¼Œä¹Ÿæœ‰å¯èƒ½æœªå¿…è§£å†³å¾—äº†ï¼Œæœ‰æ—¶è§‰å¾—è‡ªå·±å•¥éƒ½ä¸ä¼šï¼Œè¿™ä¹ˆç‚¹ä¸œè¥¿éƒ½åšä¸å¥½ï¼Œæœ‰ç‚¹å¦å®šè‡ªå·±ã€‚è¿™ä¹Ÿç¡®å®æ˜¯è‡ªå·±çš„æŠ€æœ¯çŸ¥è¯†æ ˆç¼ºä¹ï¼Œå’Œè‡ªå·±å­¦çš„ SSMã€Spring Boot è¿™äº›éƒ½ä¸ç›¸å…³ï¼Œä¹Ÿä¸æ€ä¹ˆå†™ä¸šåŠ¡é€»è¾‘ä»£ç ã€‚æ‰€ä»¥æ„Ÿè§‰å¾ˆç—›è‹¦ï¼Œä¸åƒè‡ªå·±ä»¥å‰å†™çš„ä»£ç é‚£æ ·é¡ºç•…ï¼Œå½“ç„¶å¯èƒ½æ˜¯è‡ªå·±ä»¥å‰è‡ªå·±å†™çš„é¡¹ç›®å¤ª low äº†ã€‚ çœ‹åˆ°æ˜é‡‘-å‡¯ä¼¦å¾æ–‡ä¸­å†™åˆ°ï¼š å…¬å¸å…¶å®å¹¶ä¸æœŸæœ›åˆšåˆšè¿›æ¥çš„ä½ ï¼Œèƒ½å¤Ÿåˆ›é€ å¤šå°‘ä»·å€¼ã€‚æ–°äººæ˜¯è¦æˆé•¿çš„ï¼Œåœ¨æˆé•¿æœŸéš¾å…ä¼šé‡åˆ°å„ç§å„æ ·çš„å°é—®é¢˜ï¼Œè¿™å¯èƒ½æ˜¯å¤§å¤šæ•°äººçš„å¿…ç»ä¹‹è·¯ï¼Œå› ä¸ºä½ æ‰€çœ‹åˆ°çš„åŒäº‹ï¼Œä»–ä»¬éƒ½æ¯”ä½ åœ¨å·¥ä½œé¢†åŸŸå¾…çš„æ—¶é—´æ›´ä¹…ï¼Œæœ‰æ›´å¤šçš„ç»éªŒï¼Œå¯ä»¥æŠŠä»–ä»¬ä½œä¸ºç›®æ ‡ï¼Œä½†ä¸è¦æŠŠä»–ä»¬ä½œä¸ºç°åœ¨è‡ªå·±çš„æ ‡å‡†ï¼Œé‚£æ ·ä¼šå‹åŠ›å¤ªå¤§ã€‚ æ„Ÿè§‰è¿™æ®µè¯å¯¹æˆ‘ç°åœ¨å¾ˆå—ç”¨ï¼ åŠ æ²¹ï¼Œå¥½å¥½æŒºè¿‡è¿™ä¸ªé˜¶æ®µï¼Œåˆ«è½»æ˜“è¯´æ”¾å¼ƒï¼ ä¹¦ç±æ¨èå¤§å­¦ï¼Œæˆ‘ä¸æ€ä¹ˆå–œæ¬¢ç©æ¸¸æˆï¼Œè‡ªå·±ä¹Ÿè¿˜ç®—ä¸æ€ä¹ˆå •è½å§ï¼Œçœ‹äº†ä»¥ä¸‹çš„ä¸€äº›ä¹¦ç±ï¼Œç®—æ˜¯å¯¹æˆ‘åé¢å†™åšå®¢ã€æ‰¾å·¥ä½œä¹Ÿæœ‰å¾ˆå¤§çš„å¸®åŠ©ã€‚å¦‚æœä½ æ˜¯å¤§ç¥ï¼Œè¯·å¿½ç•¥ï¼Œå¦‚æœä½ è¿˜æ˜¯è¿˜åœ¨å¤§å­¦ï¼Œå’Œæˆ‘ä¸€æ ·ä¸æƒ³æŠŠæ—¶é—´æµªè´¹åœ¨æ¸¸æˆä¸Šï¼Œå¯ä»¥çœ‹çœ‹æˆ‘æ¨èçš„ä¸€äº›ä¹¦ç±ï¼Œæœ‰æƒ³è®¨è®ºçš„è¯·åœ¨è¯„è®ºä¸‹ç•™ä¸‹ä½ çš„è¯„è®ºæˆ–è€…åŠ ä¸Šé¢ç»™çš„ç¾¤å·ã€‚ Java1ã€ã€ŠJava æ ¸å¿ƒæŠ€æœ¯ã€‹å·ä¸€ ã€å·äºŒ ä¸¤æœ¬ä¹¦ï¼Œç®—æ˜¯å…¥é—¨æ¯”è¾ƒå¥½çš„ä¹¦ç±äº† 2ã€ã€Šç–¯ç‹‚ Java è®²ä¹‰ã€‹ å¾ˆåšçš„ä¸€æœ¬ä¹¦ï¼Œé‡Œé¢çš„å†…å®¹ä¹Ÿæ˜¯å¾ˆæ³¨é‡åŸºç¡€äº† 3ã€ã€ŠJava å¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹â€”â€” æ–¹è…¾é£ ã€é­é¹ã€ç¨‹æ™“æ˜è‘— æ–¹è…¾é£ æ˜¯å¹¶å‘ç¼–ç¨‹ç½‘çš„åˆ›å§‹äººï¼Œé‡Œé¢çš„æ–‡ç« ç¡®å®è¿˜ä¸é”™ï¼Œå¯ä»¥å¤šçœ‹çœ‹é‡Œé¢çš„æ–‡ç« ï¼Œæ”¶è·ç»å¯¹å¾ˆå¤§ã€‚ 4ã€ã€Š Javaå¤šçº¿ç¨‹ç¼–ç¨‹æ ¸å¿ƒæŠ€æœ¯ã€‹â€”â€” é«˜æ´ªå²©è‘— è¿™æœ¬ä¹¦ä¹Ÿç®—æ˜¯å…¥é—¨å¤šçº¿ç¨‹ç¼–ç¨‹çš„ä¸é”™ä¹¦ç±ï¼Œæˆ‘ä¹‹å‰è¿˜å†™äº†ä¸€ç¯‡è¯»ä¹¦ç¬”è®°å‘¢ï¼Œã€ŠJava å¤šçº¿ç¨‹ç¼–ç¨‹æ ¸å¿ƒæŠ€æœ¯ã€‹å­¦ä¹ ç¬”è®°åŠæ€»ç»“ , å¤§å®¶å¦‚æœä¸æƒ³çœ‹ä¹¦çš„å¯ä»¥å»çœ‹æˆ‘çš„ç¬”è®°ã€‚ 5ã€ã€ŠJava å¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‹ è¿™æœ¬ä¹¦è®²çš„æœ‰ç‚¹éš¾æ‡‚å•Šï¼Œä¸è¿‡ç¡®å®ä¹Ÿæ˜¯ä¸€æœ¬å¾ˆå¥½çš„ä¹¦ï¼Œä»¥ä¸Šä¸‰æœ¬ä¹¦ç±å¦‚æœéƒ½å¼„æ‡‚äº†ï¼Œæˆ‘è§‰å¾—ä½ å¹¶å‘ç¼–ç¨‹è¿™å—å¯èƒ½å¤§æ¦‚å°± OK äº†ï¼Œç„¶åå†å»çœ‹çœ‹çº¿ç¨‹æ± çš„æºç ï¼Œäº†è§£ä¸‹çº¿ç¨‹æ± ï¼Œæˆ‘è§‰å¾—é‚£å°±æ›´æ£’äº†ã€‚ä¸æƒ³çœ‹çš„è¯ï¼Œè¯·çœ‹æˆ‘çš„åšå®¢ï¼šJava çº¿ç¨‹æ± è‰ºæœ¯æ¢ç´¢ æˆ‘ä¸ªäººè§‰å¾—è¿˜æ˜¯å†™çš„å¾ˆä¸é”™ï¼Œé‚£äº›å¤§å‚é¢è¯•ä¹Ÿå‡ ä¹éƒ½ä¼šé—®çº¿ç¨‹æ± çš„ä¸œè¥¿ï¼Œç„¶åå¤§æ¦‚å†…å®¹ä¹Ÿå°±æ˜¯æˆ‘è¿™åšå®¢å†™çš„ 6ã€ã€ŠEffective Javaã€‹ä¸­æ–‡ç‰ˆ ç¬¬äºŒç‰ˆ ç®—æ˜¯ Java çš„è¿›é˜¶ä¹¦ç±äº†ï¼Œé¢è¯•å¥½å¤šé—®é¢˜ä¹Ÿæ˜¯ä»è¿™å‡ºæ¥çš„ 7ã€ã€Šæ·±å…¥ç†è§£ Java è™šæ‹Ÿæœºâ€”â€”JVMé«˜çº§ç‰¹æ€§ä¸æœ€ä½³å®è·µã€‹ç¬¬äºŒç‰ˆ è¿™ç®—æ˜¯å›½å†…è®² JVM æœ€æ¸…æ¥šçš„ä¹¦äº†å§ï¼Œç›®å‰è¿˜æ˜¯åªçœ‹äº†ä¸€éï¼Œåé¢ç»§ç»­å•ƒï¼Œå¤§å‚é¢è¯•å‡ ä¹ä¹Ÿæ˜¯éƒ½ä¼šè€ƒ JVM çš„ï¼Œé˜¿é‡Œé¢ JVM ç‰¹åˆ«å¤šï¼Œæƒ³è¿›é˜¿é‡Œçš„åŒå­¦è¯·ä¸€å®šè¦ä¹°è¿™æœ¬ä¹¦å»çœ‹ã€‚ 8ã€ã€Šæ·±å…¥åˆ†æJava WebæŠ€æœ¯å†…å¹• ä¿®è®¢ç‰ˆã€‹è®¸ä»¤æ³¢è‘— é‡Œé¢çŸ¥è¯†å¾ˆå¹¿ï¼Œæ¯ä¸€ç« éƒ½æ˜¯ä¸€ä¸ªä¸åŒçš„çŸ¥è¯†ï¼Œå¯è§ä½œè€…çš„ä¼˜ç§€ï¼Œä¸æ„§æ˜¯é˜¿é‡Œå¤§ç¥ã€‚ 9ã€ã€Šå¤§å‹ç½‘ç«™ç³»ç»Ÿä¸ Java ä¸­é—´ä»¶å®è·µã€‹â€”â€” æ›½å®ªæ° è‘— ä½œè€…æ˜¯å‰æ·˜å®æŠ€æœ¯æ€»ç›‘ï¼Œè§è¯äº†æ·˜å®ç½‘çš„å‘å±•ï¼Œé‡Œé¢çš„è®²çš„å†…å®¹ä¹Ÿæ˜¯å¾ˆå¥½ï¼Œçœ‹å®Œèƒ½è®©è‡ªå·±ä¹Ÿç«™åœ¨é«˜å¤„å»æ€è€ƒé—®é¢˜ã€‚ 10ã€ã€Šå¤§å‹ç½‘ç«™æŠ€æœ¯æ¶æ„ â€”â€” æ ¸å¿ƒåŸç†ä¸æ¡ˆä¾‹åˆ†æã€‹ â€”â€” ææ™ºæ…§ è‘— æœ€å¥½å’Œä¸Šé¢é‚£æœ¬ä¹¦ç±ä¸€èµ·çœ‹ï¼Œæ•ˆæœæ›´å¥½ï¼Œä¸¤æœ¬çœ‹å®Œäº†ï¼Œæå‡æ€æƒ³çš„é«˜åº¦ï¼ 11ã€ã€Šç–¯ç‹‚Java.çªç ´ç¨‹åºå‘˜åŸºæœ¬åŠŸçš„16è¯¾ã€‹ æåˆš è‘— ä¹¦ä¸­å¾ˆæ³¨é‡ Java çš„ä¸€äº›ç»†èŠ‚ï¼Œè®²çš„å¾ˆæ·±å…¥ï¼Œä½†æ˜¯ä¹¦ä¸­çš„é”™åˆ«å­—ç‰¹å¤šï¼Œå¯ä»¥çœ‹çœ‹æˆ‘çš„è¯»ä¹¦ç¬”è®°ï¼šã€Šç–¯ç‹‚ Java çªç ´ç¨‹åºå‘˜åŸºæœ¬åŠŸçš„ 16 è¯¾ã€‹è¯»ä¹¦ç¬”è®° 12ã€ã€ŠSpring å®æˆ˜ã€‹ Spring å…¥é—¨ä¹¦ç± 13ã€ã€ŠSpring æ­ç§˜ã€‹â€”â€” ç‹ç¦å¼º è‘— è¿™æœ¬ä¹¦åˆ«æå¤šç‰›äº†ï¼Œå‡ºç‰ˆæ—¶æœŸä¸º 2009 å¹´ï¼Œè±†ç“£è¯„åˆ†ä¸º 9.0 åˆ†ï¼Œå†™çš„æ˜¯çœŸæ£’ï¼æŠŠ Spring çš„ IOC å’Œ AOP ç‰¹æ€§å†™çš„å¾ˆæ¸…æ¥šï¼ŒæŠŠ Spring çš„æ¥é¾™å»è„‰è®²çš„å¾ˆå…¨ã€‚å¢™è£‚æ¨èè¿™æœ¬ä¹¦ç±ï¼Œå¦‚æœä½ æƒ³çœ‹ Springï¼Œä½œè€…å¾ˆç‰›ï¼Œèµ„æ·±æ¶æ„å¸ˆï¼Œå¾ˆæœ‰å¹¸å’Œä½œè€…æœ‰è¿‡ä¸€æ¬¡äº¤æµï¼Œå½“æ—¶å› ä¸ºè‡ªå·±çš„ä¸€ç¯‡åšå®¢ Pyspideræ¡†æ¶ â€”â€” Pythonçˆ¬è™«å®æˆ˜ä¹‹çˆ¬å– V2EX ç½‘ç«™å¸–å­ï¼Œç«Ÿç„¶æ‰¾åˆ°æˆ‘æƒ³å«æˆ‘å»å®ä¹ ï¼Œå¯æƒœäº†ï¼Œå½“æ—¶å·®ç‚¹å°±è·Ÿç€ä»–æ··äº†ã€‚ä½œè€…è¿˜æœ‰ä¸€æœ¬ä¹¦ ã€ŠSpring Boot æ­ç§˜ã€‹ã€‚ 14ã€ã€ŠSpring æŠ€æœ¯å†…å¹•ã€‹â€”â€” æ·±å…¥è§£æ Spring æ¶æ„ä¸è®¾è®¡åŸç† è®²è§£ Spring æºç ï¼Œæ·±å…¥äº†å†…éƒ¨æœºåˆ¶ï¼Œä¸ªäººè§‰å¾—è¿˜æ˜¯ä¸é”™çš„ã€‚ 15ã€Spring å®˜æ–¹çš„è‹±æ–‡æ–‡æ¡£ è¿™ä¸ªåˆ«æäº†ï¼Œå¾ˆå¥½ï¼Œèƒ½çœ‹è‹±æ–‡å°½é‡çœ‹è‹±æ–‡ 16ã€ã€Šè·Ÿå¼€æ¶›å­¦ Spring 3ã€‹ ã€Šè·Ÿå¼€æ¶›å­¦ Spring MVCã€‹ äº¬ä¸œå¤§ç¥ï¼Œè†œ 17ã€ã€Šçœ‹é€springMvcæºä»£ç åˆ†æä¸å®è·µã€‹ ç®—æ˜¯æŠŠ Spring MVC æºç è®²çš„å¾ˆå¥½çš„äº† è§æˆ‘çš„ç¬”è®°ï¼š 1ã€é€šè¿‡æºç è¯¦è§£ Servlet 2 ã€çœ‹é€ Spring MVC æºä»£ç åˆ†æä¸å®è·µ â€”â€” ç½‘ç«™åŸºç¡€çŸ¥è¯† 3 ã€çœ‹é€ Spring MVC æºä»£ç åˆ†æä¸å®è·µ â€”â€” ä¿¯è§† Spring MVC 4 ã€çœ‹é€ Spring MVC æºä»£ç åˆ†æä¸å®è·µ â€”â€” Spring MVC ç»„ä»¶åˆ†æ 18ã€ã€ŠSpring Boot å®æˆ˜ã€‹ 19ã€Spring Boot å®˜æ–¹ Reference Guide ç½‘ä¸Šå¥½å¤šå†™ SpringBoot çš„åšå®¢ï¼Œå‡ ä¹å’Œè¿™ä¸ªå·®ä¸å¤šã€‚ 20ã€ã€ŠJavaEEå¼€å‘çš„é¢ è¦†è€…: Spring Bootå®æˆ˜ã€‹ 21ã€MyBatis å½“ç„¶æ˜¯å®˜æ–¹çš„æ–‡æ¡£æœ€å¥½äº†ï¼Œè€Œä¸”è¿˜æ˜¯ä¸­æ–‡çš„ã€‚ è‡ªå·±ä¹Ÿå†™è¿‡å‡ ç¯‡æ–‡ç« ï¼Œå¸®åŠ©è¿‡å¾ˆå¤šäººå…¥é—¨ï¼Œä¼ é€é—¨ï¼š 1ã€é€šè¿‡é¡¹ç›®é€æ­¥æ·±å…¥äº†è§£Mybatisï¼ˆä¸€ï¼‰/) 2ã€é€šè¿‡é¡¹ç›®é€æ­¥æ·±å…¥äº†è§£Mybatisï¼ˆäºŒï¼‰/) 3ã€é€šè¿‡é¡¹ç›®é€æ­¥æ·±å…¥äº†è§£Mybatisï¼ˆä¸‰ï¼‰/) 4ã€é€šè¿‡é¡¹ç›®é€æ­¥æ·±å…¥äº†è§£Mybatisï¼ˆå››ï¼‰/) 22ã€ã€Šæ·±å…¥ç†è§£ Java å†…å­˜æ¨¡å‹ã€‹â€”â€” ç¨‹æ™“æ˜ è‘— æˆ‘è§‰å¾—æ¯ä¸ª Java ç¨‹åºå‘˜éƒ½åº”è¯¥äº†è§£ä¸‹ Java çš„å†…å­˜æ¨¡å‹ï¼Œè¯¥ä¹¦ç±æˆ‘çœ‹çš„æ˜¯ç”µå­ç‰ˆçš„ï¼Œä¸å¤šï¼Œä½†æ˜¯è®²çš„å´å¾ˆæ¸…æ¥šï¼ŒæŠŠé‡æ’åºã€é¡ºåºä¸€è‡´æ€§ã€Volatileã€é”ã€finalç­‰å†™çš„å¾ˆæ¸…æ¥šã€‚ Linuxã€Šé¸Ÿå“¥çš„Linuxç§æˆ¿èœ åŸºç¡€å­¦ä¹ ç¯‡(ç¬¬ä¸‰ç‰ˆ) ã€‹ é¸Ÿå“¥çš„Linuxç§æˆ¿èœï¼šæœåŠ¡å™¨æ¶è®¾ç¯‡(ç¬¬3ç‰ˆ) é¸Ÿå“¥çš„ä¹¦ è®¡ç®—æœºç½‘ç»œã€Šè®¡ç®—æœºç½‘ç»œç¬¬å…­ç‰ˆâ€”â€”è°¢å¸Œä» ç¼–ã€‹ ã€Šè®¡ç®—æœºç½‘ç»œè‡ªé¡¶å‘ä¸‹æ–¹æ³•ã€‹ è®¡ç®—æœºç³»ç»Ÿã€Šä»£ç æ­ç§˜ï¼šä»Cï¼C.çš„è§’åº¦æ¢ç§˜è®¡ç®—æœºç³»ç»Ÿ â€”â€” å·¦é£ã€‹ ã€Šæ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿã€‹ ã€Šè®¡ç®—æœºç§‘å­¦å¯¼è®º_ä½›ç½—èµã€‹ æ•°æ®åº“ã€Šé«˜æ€§èƒ½MySQLã€‹ ã€ŠMysqlæŠ€æœ¯å†…å¹•InnoDBå­˜å‚¨å¼•æ“ã€‹ Pythonè¿™é—¨è¯­è¨€è¯­æ³•å¾ˆç®€å•ï¼Œä¸Šæ‰‹å¿«ï¼Œä¸è¿‡æˆ‘ç›®å‰å¥½ä¹…æ²¡ç”¨äº†ï¼Œéƒ½å¿˜å¾—å·®ä¸å¤šäº†ã€‚å½“æ—¶æ˜¯çœ‹çš„å»–é›ªå³°çš„ Python åšå®¢ è‡ªå·±ä¹Ÿç”¨ Python åšçˆ¬è™«å†™è¿‡å‡ ç¯‡åšå®¢ï¼Œä¸è¿‡æœ‰äº›æ˜¯åœ¨å‰äººçš„åŸºç¡€ä¸Šå†™çš„ã€‚æ„Ÿè°¢é‚£äº›æ ½æ ‘çš„äººï¼ å·¥å…·Git ï¼š å»–é›ªå³°çš„ Git æ•™ç¨‹ IDEAï¼šIntelliJ IDEA ç®€ä½“ä¸­æ–‡ä¸“é¢˜æ•™ç¨‹ Mavenï¼šã€ŠMavenå®æˆ˜ã€‹ å…¶ä»–ã€Šå¦‚ä½•é«˜æ•ˆå­¦ä¹ -æ–¯ç§‘ç‰¹æ¨ã€‹ æ•™ä½ æ€æ ·é«˜æ•ˆå­¦ä¹ çš„ ã€Šè½¯æŠ€èƒ½ï¼šä»£ç ä¹‹å¤–çš„ç”Ÿå­˜æŒ‡å—ã€‹ ç¨‹åºå‘˜é™¤äº†å†™ä»£ç ï¼Œè¿˜å¾—æ‡‚ç‚¹å…¶ä»–çš„è½¯æŠ€èƒ½ã€‚ ã€Šæé—®çš„æ™ºæ…§â€œä¸­æ–‡ç‰ˆâ€ã€‹ ã€ŠHow-To-Ask-Questions-The-Smart-Wayã€‹ ä½œä¸ºç¨‹åºå‘˜çš„ä½ ï¼Œä¸€å®šè¦å­¦ä¼šå’‹æé—®ï¼Œä¸ç„¶åˆ«äººéƒ½ä¸æƒ³é¸Ÿä½ ã€‚ ä¼˜ç§€ç½‘ç«™æ¨è1ã€GitHub åˆ«å’Œæˆ‘è¯´ä¸çŸ¥é“ 2ã€InfoQ æ–‡ç« å¾ˆä¸é”™ 3ã€CSDN ç»å¸¸çœ‹åšå®¢ä¸“å®¶çš„åšå®¢ï¼Œé‡Œé¢å¤§ç‰›å¾ˆå¤šï¼Œä¼ é€é—¨ï¼šzhisheng 4ã€çŸ¥ä¹ å¤šå…³æ³¨äº›å¤§ç‰›ï¼Œçœ‹ä»–ä»¬å¹é€¼ 5ã€æ˜é‡‘ è‡ªå·±ä¹Ÿåœ¨ä¸Šé¢å†™ä¸“æ ï¼Œç²‰ä¸å·²ç»è¶…è¿‡ä¸€ä¸‡äº†ï¼Œä¼ é€é—¨ ï¼šzhisheng 6ã€å¹¶å‘ç¼–ç¨‹ç½‘ å‰é¢å·²ç»ä»‹ç» 7ã€developerworks ä¸Šé¢çš„åšå®¢ä¹Ÿå¾ˆå¥½ 8ã€åšå®¢å›­ é‡Œé¢åº”è¯¥å¤§ç‰›ä¹Ÿå¾ˆå¤šï¼Œä¸è¿‡è‡ªå·±æ²¡åœ¨ä¸Šé¢å†™è¿‡åšå®¢ 9ã€å¾®ä¿¡å…¬ä¼—å· å…³æ³¨äº†å¾ˆå¤šäººï¼Œæœ‰äº›äººçš„æ–‡ç« ç¡®å®å¾ˆå¥½ï¼Œå¹³æ—¶ä¹Ÿç»å¸¸çœ‹ã€‚ 10ã€ç‰›å®¢ç½‘ åˆ·ç¬”è¯•é¢˜ä¸é”™çš„åœ°æ–¹ï¼Œé‡Œé¢å¤§ç‰›è¶…å¤šï¼Œæ€€å¿µå¶ç¥å’Œå·¦ç¥è®²è¯¾çš„æ—¶å€™ï¼Œè¿˜æœ‰å¾ˆæœ‰çˆ±çš„ç‰›å¦¹ã€‚ ä¼˜ç§€åšå®¢æ¨èå»–é›ªå³° Git å’Œ Python å…¥é—¨æ–‡ç« å°±æ˜¯ä»ä»–åšå®¢çœ‹çš„ é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿— é…·å£³-é™ˆçš“ RednaxelaFX Rå¤§ï¼Œç‰›é€¼çš„ä¸å¾—äº† æ±Ÿå—ç™½è¡£ è€å¸æœº stormzhang äººç§°å¸…é€¼å¼ ï¼Œå¾®ä¿¡å…¬ä¼—å·å†™çš„ä¸é”™ ä½ å‡ç¬¨ é˜¿é‡Œæ JVM çš„ï¼Œå¾ˆå‰å®³ å å°ç‹¼ æ³¥ç“¦åŒ BYSocket å´”åº†æ‰ å†™äº†å¥½å¤š Python çˆ¬è™«ç›¸å…³çš„æ–‡ç«  çº¯æ´çš„å¾®ç¬‘ SpringBoot ç³»åˆ—ä¸é”™ï¼Œå…¶ä»–çš„æ–‡ç« è‡ªå·±çœ‹äº†æ„Ÿè§‰æ˜¯è‡ªå·±å–œæ¬¢çš„é‚£ç§æ–‡ç¬” ç¨‹åºçŒ¿DD å‘¨ç«‹ èŠ‹é“æºç çš„åšå®¢ å¥½å¤šç³»åˆ—çš„æºç åˆ†æ zhisheng è¿™ä¸ªæ˜¯æˆ‘ä¸è¦è„¸ï¼Œç«Ÿç„¶æŠŠè‡ªå·±åšå®¢åœ°å€çš„å†™ä¸Šå»äº† æ±‚èŒèµ„æ–™æ”¾é€è‡ªå·±åœ¨å‡†å¤‡æ‰¾å·¥ä½œé‚£æ®µæ—¶é—´ï¼Œç³»ç»Ÿçš„å¤ä¹ äº†ä¸‹å¤§å­¦æ‰€å­¦çš„çŸ¥è¯†ï¼ŒæœŸé—´åœ¨ç½‘ä¸Šå‚è€ƒäº†å¾ˆå¤šä¸é”™çš„åšå®¢ï¼Œå¹¶æ”¶é›†ä¸‹æ¥äº†ï¼Œä¸ªäººè§‰å¾—è¿˜æ˜¯ä¸é”™çš„ï¼Œå› ä¸ºè¿™æ˜¯åŒ…å«äº†è‡ªå·±çš„å¿ƒè¡€ï¼Œæ‰€ä»¥ä¸€ç›´æ²¡æ€ä¹ˆé€å‡ºæ¥ï¼Œåªç»™è¿‡æˆ‘çš„å‡ ä¸ªåŒå­¦ï¼Œè¿˜æœ‰å°±æ˜¯ä¸€äº›å­¦ä¹ è§†é¢‘å’Œå®æˆ˜é¡¹ç›®è§†é¢‘ã€‚å€Ÿç€è¿™æ¬¡å¾æ–‡çš„æœºä¼šï¼Œæˆ‘æƒ³é€ç»™é‚£äº›æœ‰ç¼˜äººï¼Œå¸Œæœ›ä½ æˆ–è®¸æ˜¯é‚£ç§åœ¨æ±‚èŒé“è·¯ä¸Šæ­£åœ¨è‰°éš¾èµ°ç€çš„äººï¼›æˆ–è®¸æ˜¯å¤§ä¸€å¤§äºŒçš„å­¦å¼Ÿå­¦å¦¹ä»¬å´æƒ³å¥½å¥½å­¦ä¹ ï¼Œæœ‰ä¸ªå¥‹æ–—çš„ç›®æ ‡ï¼Œä¸å ªåœ¨å¤§å­¦å •è½çš„ï¼›æˆ–è®¸æ˜¯å·¥ä½œä¸€ä¸¤å¹´åæ„Ÿè§‰åŸºç¡€è¿˜æ¯”è¾ƒè–„å¼±çš„ã€‚è¦èµ„æ–™çš„æ—¶å€™æœŸæœ›ä½ èƒ½ç®€å•çš„ä»‹ç»ä¸‹è‡ªå·±ï¼ŒæœŸæœ›ä½ ï¼è”ç³»æ–¹å¼è¯·çœ‹æ–‡ç« æœ€ä¸‹é¢ã€‚ æœ€åé€ä¸€å¥è¯ï¼Œè¶ŠåŠªåŠ›ï¼Œè¶Šå¹¸è¿ï¼Œç¥æ—©æ—¥æˆä¸ºå¤§ç¥ï¼ è¿™äº›åœ°æ–¹å¯ä»¥æ‰¾åˆ°æˆ‘ï¼š blog: http://www.54tianzhisheng.cn/ GitHub: https://github.com/zhisheng17 QQ ç¾¤ï¼š528776268","tags":[{"name":"é¢ç»","slug":"é¢ç»","permalink":"http://www.54tianzhisheng.cn/tags/é¢ç»/"}]},{"title":"Linux ä¸‹ lua å¼€å‘ç¯å¢ƒå®‰è£…åŠå®‰è£… luafilesystem","date":"2017-09-14T16:00:00.000Z","path":"2017/09/15/linux-lua-lfs-install/","text":"ç«äº‘é‚ªç¥è¯­å½•ï¼šå¤©ä¸‹æ­¦åŠŸï¼Œæ— åšä¸ç ´ï¼Œå”¯å¿«ä¸ç ´ï¼Nginx çš„çœ‹å®¶æœ¬é¢†å°±æ˜¯é€Ÿåº¦ï¼ŒLua çš„æ‹¿æ‰‹å¥½æˆäº¦æ˜¯é€Ÿåº¦ï¼Œè¿™ä¸¤è€…çš„ç»“åˆåœ¨é€Ÿåº¦ä¸Šæ— ç–‘æœ‰åŸºå› ä¸Šçš„ä¼˜åŠ¿ã€‚ æœ€è¿‘ä¸€ç›´å†æŠ˜è…¾è¿™ä¸ªï¼Œå¹²è„†å°±ç¨å¾®æ•´ç†ä¸‹ã€‚ä»¥é˜²åé¢ç»§ç»­è·³å‘ï¼ å®‰è£…ï¼š 1.å…ˆå®‰è£… lua çš„ç›¸å…³ä¾èµ–å®‰è£… C å¼€å‘ç¯å¢ƒç”±äº gcc åŒ…éœ€è¦ä¾èµ– binutils å’Œ cpp åŒ…ï¼Œå¦å¤– make åŒ…ä¹Ÿæ˜¯åœ¨ç¼–è¯‘ä¸­å¸¸ç”¨çš„ï¼Œæ‰€ä»¥ä¸€å…±éœ€è¦ 9 ä¸ªåŒ…æ¥å®Œæˆå®‰è£…ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦æ‰§è¡Œ 9 æ¡æŒ‡ä»¤å³å¯ï¼š 12345678910gccï¼šå‘½ä»¤æœªæ‰¾åˆ°ï¼ˆè§£å†³æ–¹æ³•ï¼‰yum install cppyum install binutilsyum install glibcyum install glibc-kernheadersyum install glibc-commonyum install glibc-develyum install gccyum install makeyum install readline-devel 2.å®‰è£… lua5.1.5ä¸‹è½½åœ°å€ï¼šhttp://www.lua.org/ftp/ 1234567891011121314151617181920tar -zxvf lua-5.1.5.tar.gzcd lua-5.1.5vi Makefileè®¾ç½® INSTALL_TOP= /usr/local/luamake linuxmake testmake installrm -rf /usr/bin/lualn -s /usr/local/lua/bin/lua /usr/bin/lualn -s /usr/local/lua/share/lua /usr/share/luaè®¾ç½®ç¯å¢ƒå˜é‡ï¼švim /etc/profileæ·»åŠ ï¼šexport LUA_HOME=/usr/local/luaexport PATH=$PATH:$LUA_HOME/binç¯å¢ƒå˜é‡ç”Ÿæ•ˆï¼šsource /etc/profile 3ã€å®‰è£… luarocksæ˜¯ä¸€ä¸ª Lua åŒ…ç®¡ç†å™¨ï¼ŒåŸºäº Lua è¯­è¨€å¼€å‘ï¼Œæä¾›ä¸€ä¸ªå‘½ä»¤è¡Œçš„æ–¹å¼æ¥ç®¡ç† Lua åŒ…ä¾èµ–ã€å®‰è£…ç¬¬ä¸‰æ–¹ Lua åŒ…ç­‰ã€‚ åœ°å€ï¼š https://github.com/luarocks/luarocks 12345678910111213141516ä½¿ç”¨ luarocks-2.2.1 ç‰ˆæœ¬åœ¨æˆ‘æœºå™¨ä¸Šæ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯ä½¿ç”¨ luarocks-2.4.2 å‡ºç°é—®é¢˜wget http://luarocks.org/releases/luarocks-2.2.1.tar.gztar -zxvf luarocks-2.2.1.tar.gzcd luarocks-2.2.1./configure --with-lua=/usr/local --with-lua-include=/usr/local/lua/includeè®¾ç½®ç¯å¢ƒå˜é‡ï¼šexport LUA_LUAROCKS_PATH=/usr/local/luarocks-2.2.1export PATH=$PATH:$LUA_LUAROCKS_PATHmake &amp; make install 4ã€å®‰è£… luafilesystemæ˜¯ä¸€ä¸ªç”¨äº lua è¿›è¡Œæ–‡ä»¶è®¿é—®çš„åº“ï¼Œå¯ä»¥æ”¯æŒ lua 5.1 å’Œ lua5.2ï¼Œä¸”æ˜¯è·¨å¹³å°çš„ï¼Œåœ¨ä¸º lua å®‰è£… lfs ä¹‹å‰éœ€è¦å…ˆå®‰è£…luarocksã€‚å› ä¸ºè‡ªå·±çš„éœ€æ±‚åˆšå¥½éœ€è¦è¿™æ¨¡å—ã€‚ åœ°å€ï¼šhttps://github.com/keplerproject/luafilesystem æ–‡æ¡£ï¼š http://keplerproject.github.io/luafilesystem/index.html 1luarocks install luafilesystem 5ã€æµ‹è¯•æµ‹è¯• lua æ˜¯å¦å®‰è£…æˆåŠŸ lua -v ç»“æœï¼š 1Lua 5.1.5 Copyright (C) 1994-2012 Lua.org, PUC-Rio æµ‹è¯• luafilesystem æ˜¯å¦å®‰è£…æˆåŠŸ a.lua 123456789local lfs = require&quot;lfs&quot;function Rreturn(filePath) local time = os.date(&quot;%a, %d %b %Y %X GMT&quot;, lfs.attributes(filePath).modification) --æ‰“å°æ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´ print(time)endRreturn(&quot;/opt/lua/a.txt&quot;) a.txt 123abc è¿è¡Œï¼š 1lua a.lua ç»“æœï¼š 1Tue, 12 Sep 2017 18:43:13 GMT å‡ºç°æ‰“å°å‡ºæ—¶é—´çš„ç»“æœå°±æ„å‘³ç€å·²ç»å®‰è£…å¥½äº†ã€‚ å½“ç„¶ä»¥ä¸Šè¿™æ˜¯åœ¨ Linux å®‰è£…çš„ï¼Œ Windows ä¸Šçš„å…¶å®æ¯”è¿™è¿˜ç®€å•äº†ï¼Œä½†æ˜¯å®‰è£… luafilesystem çš„è¯éœ€è¦è‡ªå·±å»ä¸‹è½½ä¸ª lfs.dll ï¼Œç„¶åæŠŠè¿™ä¸ªæ”¾åˆ° lua çš„å®‰è£…è·¯å¾„å»ã€‚å¾ˆç®€å•çš„ï¼Œè¿™é‡Œå°±ä¸ç»†è¯´äº†ã€‚ å‡ºç°è¿‡çš„é”™è¯¯ï¼š123456789101112[root@n1 lua-5.1.5]# make linux testcd src &amp;&amp; make linuxmake[1]: Entering directory `/opt/lua-5.1.5/src&apos;make all MYCFLAGS=-DLUA_USE_LINUX MYLIBS=&quot;-Wl,-E -ldl -lreadline -lhistory -lncurses&quot;make[2]: Entering directory `/opt/lua-5.1.5/src&apos;gcc -O2 -Wall -DLUA_USE_LINUX -c -o lapi.o lapi.cmake[2]: gccï¼šå‘½ä»¤æœªæ‰¾åˆ°make[2]: *** [lapi.o] é”™è¯¯ 127make[2]: Leaving directory `/opt/lua-5.1.5/src&apos;make[1]: *** [linux] é”™è¯¯ 2make[1]: Leaving directory `/opt/lua-5.1.5/src&apos;make: *** [linux] é”™è¯¯ 2 åŸå› ï¼šæœ€å¼€å§‹çš„é‚£äº›ä¾èµ–æ²¡å®‰è£…","tags":[{"name":"lua","slug":"lua","permalink":"http://www.54tianzhisheng.cn/tags/lua/"}]},{"title":"Elasticsearch ç³»åˆ—æ–‡ç« ï¼ˆäºŒï¼‰ï¼šå…¨æ–‡æœç´¢å¼•æ“ Elasticsearch é›†ç¾¤æ­å»ºå…¥é—¨æ•™ç¨‹","date":"2017-09-08T16:00:00.000Z","path":"2017/09/09/Elasticsearch-install/","text":"ä»‹ç»ElasticSearch æ˜¯ä¸€ä¸ªåŸºäº Lucene çš„æœç´¢æœåŠ¡å™¨ã€‚å®ƒæä¾›äº†ä¸€ä¸ªåˆ†å¸ƒå¼å¤šç”¨æˆ·èƒ½åŠ›çš„å…¨æ–‡æœç´¢å¼•æ“ï¼ŒåŸºäº RESTful web æ¥å£ã€‚Elasticsearch æ˜¯ç”¨ Java å¼€å‘çš„ï¼Œå¹¶ä½œä¸º Apache è®¸å¯æ¡æ¬¾ä¸‹çš„å¼€æ”¾æºç å‘å¸ƒï¼Œæ˜¯å½“å‰æµè¡Œçš„ä¼ä¸šçº§æœç´¢å¼•æ“ã€‚è®¾è®¡ç”¨äºäº‘è®¡ç®—ä¸­ï¼Œèƒ½å¤Ÿè¾¾åˆ°å®æ—¶æœç´¢ï¼Œç¨³å®šï¼Œå¯é ï¼Œå¿«é€Ÿï¼Œå®‰è£…ä½¿ç”¨æ–¹ä¾¿ã€‚åŸºç™¾ç§‘ã€Stack Overflowã€Github éƒ½é‡‡ç”¨å®ƒã€‚ æœ¬æ–‡ä»é›¶å¼€å§‹ï¼Œè®²è§£å¦‚ä½•ä½¿ç”¨ Elasticsearch æ­å»ºè‡ªå·±çš„å…¨æ–‡æœç´¢å¼•æ“ã€‚æ¯ä¸€æ­¥éƒ½æœ‰è¯¦ç»†çš„è¯´æ˜ï¼Œå¤§å®¶è·Ÿç€åšå°±èƒ½å­¦ä¼šã€‚ ç¯å¢ƒ1ã€VMware 2ã€Centos 6.6 3ã€Elasticsearch 5.5.2 4ã€JDK 1.8 VMware å®‰è£…ä»¥åŠåœ¨ VMware ä¸­å®‰è£… Centos è¿™ä¸ªå°±ä¸è¯´äº†ï¼Œç¯å¢ƒé…ç½®ç›´æ¥é»˜è®¤å°±å¥½ï¼Œä¸è¿‡åˆ†é…ç»™æœºå™¨çš„å†…å­˜æœ€å¥½è®¾ç½®å¤§ç‚¹ï¼ˆå»ºè®® 2Gï¼‰ï¼Œ ä½¿ç”¨ dhclient å‘½ä»¤æ¥è‡ªåŠ¨è·å– IP åœ°å€ï¼ŒæŸ¥çœ‹è·å–çš„ IP åœ°å€åˆ™ä½¿ç”¨å‘½ä»¤ ip addr æˆ–è€… ifconfig ï¼Œåˆ™ä¼šçœ‹åˆ°ç½‘å¡ä¿¡æ¯å’Œ lo å¡ä¿¡æ¯ã€‚ ç»™è™šæ‹Ÿæœºé¢ä¸­çš„ linux è®¾ç½®å›ºå®šçš„ ipï¼ˆå› ä¸ºåé¢å‘ç°æ¯æ¬¡æœºå™¨é‡å¯ååˆè¦é‡æ–°ä½¿ç”¨ dhclient å‘½ä»¤æ¥è‡ªåŠ¨è·å– IP åœ°å€ï¼‰ 1vim /etc/sysconfig/network-scripts/ifcfg-eth0 ä¿®æ”¹ï¼š 12onboot=yesbootproto=static å¢åŠ ï¼šï¼ˆä¸‹é¢å¯è®¾ç½®å¯ä¸è®¾ç½®ï¼‰ 123IPADDR=192.168.1.113 ç½‘å¡IPåœ°å€GATEWAY=192.168.1.1NETMASK=255.255.255.0 è®¾ç½®å¥½ä¹‹åï¼ŒæŠŠç½‘ç»œæœåŠ¡é‡å¯ä¸€ä¸‹ï¼Œ service network restart ä¿®æ”¹ ip åœ°å€å‚è€ƒï¼š http://jingyan.baidu.com/article/e4d08ffdd417660fd3f60d70.html å¤§ç¯å¢ƒéƒ½å‡†å¤‡å¥½äº†ï¼Œä¸‹é¢å¼€å§‹å®‰è£…æ­¥éª¤ï¼š å®‰è£… JDK 1.8å…ˆå¸è½½è‡ªå¸¦çš„ openjdkï¼ŒæŸ¥æ‰¾ openjdk 1rpm -qa | grep java å¸è½½ openjdk 12yum -y remove java-1.7.0-openjdk-1.7.0.65-2.5.1.2.el65.x8664yum -y remove java-1.6.0-openjdk-1.6.0.0-11.1.13.4.el6.x86_64 è§£å‹ JDK å®‰è£…åŒ…ï¼š é™„ä¸Šjdk1.8çš„ä¸‹è½½åœ°å€ï¼šhttp://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html è§£å‹å®Œæˆåé…ç½®ä¸€ä¸‹ç¯å¢ƒå˜é‡å°± ok 1ã€åœ¨/usr/local/ä¸‹åˆ›å»ºJavaæ–‡ä»¶å¤¹ 12cd /usr/local/ è¿›å…¥ç›®å½•mkdir java æ–°å»ºjavaç›®å½• 2ã€æ–‡ä»¶å¤¹åˆ›å»ºå®Œæ¯•ï¼ŒæŠŠå®‰è£…åŒ…æ‹·è´åˆ° Java ç›®å½•ä¸­ï¼Œç„¶åè§£å‹ jdk åˆ°å½“å‰ç›®å½• 12cp /usr/jdk-8u144-linux-x64.tar.gz /usr/local/java/ **æ³¨æ„åŒ¹é…ä½ è‡ªå·±çš„æ–‡ä»¶å** æ‹·è´åˆ°javaç›®å½•tar -zxvf jdk-8u144-linux-x64.tar.gz è§£å‹åˆ°å½“å‰ç›®å½•ï¼ˆJavaç›®å½•ï¼‰ 3ã€è§£å‹å®Œä¹‹åï¼ŒJavaç›®å½•ä¸­ä¼šå‡ºç°ä¸€ä¸ªjdk1.8.0_144çš„ç›®å½•ï¼Œè¿™å°±è§£å‹å®Œæˆäº†ã€‚ä¹‹åé…ç½®ä¸€ä¸‹ç¯å¢ƒå˜é‡ã€‚ç¼–è¾‘/etc/ä¸‹çš„profileæ–‡ä»¶ï¼Œé…ç½®ç¯å¢ƒå˜é‡ 12345678vi /etc/profile è¿›å…¥profileæ–‡ä»¶çš„ç¼–è¾‘æ¨¡å¼åœ¨æœ€åè¾¹è¿½åŠ ä¸€ä¸‹å†…å®¹(**é…ç½®çš„æ—¶å€™ä¸€å®šè¦æ ¹æ®è‡ªå·±çš„ç›®å½•æƒ…å†µè€Œå®šå“¦ï¼**) JAVA_HOME=/usr/local/java/jdk1.8.0_144 CLASSPATH=$JAVA_HOME/lib/ PATH=$PATH:$JAVA_HOME/bin export PATH JAVA_HOME CLASSPATH ä¹‹åä¿å­˜å¹¶é€€å‡ºæ–‡ä»¶ä¹‹åã€‚ è®©æ–‡ä»¶ç”Ÿæ•ˆï¼šsource /etc/profile åœ¨æ§åˆ¶å°è¾“å…¥Java å’Œ Java -version çœ‹æœ‰æ²¡æœ‰ä¿¡æ¯è¾“å‡ºï¼Œå¦‚ä¸‹ï¼š java -version 123java version &quot;1.8.0_144&quot; Java(TM) SE Runtime Environment (build 1.8.0_60-b27) Java HotSpot(TM) Client VM (build 25.60-b23, mixed mode) èƒ½æ˜¾ç¤ºä»¥ä¸Šä¿¡æ¯ï¼Œå°±è¯´æ˜ JDK å®‰è£…æˆåŠŸå•¦ å®‰è£… Mavenå› ä¸ºåé¢å¯èƒ½ä¼šç”¨åˆ° maven ï¼Œå…ˆè£…ä¸Šè¿™ä¸ªã€‚ 1ã€ä¸‹è½½ maven 1wget http://mirrors.hust.edu.cn/apache/maven/maven-3/3.2.5/binaries/apache-maven-3.2.5-bin.tar.gz 2ã€è§£å‹è‡³ /usr/local ç›®å½• 1tar -zxvf apache-maven-3.2.5-bin.tar.gz 3ã€é…ç½®å…¬å¸ç»™çš„é…ç½® æ›¿æ¢æˆå…¬å¸ç»™çš„ setting.xml æ–‡ä»¶ï¼Œä¿®æ”¹å…³äºæœ¬åœ°ä»“åº“çš„ä½ç½®, é»˜è®¤ä½ç½®: ${user.home}/.m2/repository 4ã€é…ç½®ç¯å¢ƒå˜é‡etc/profile æœ€åæ·»åŠ ä»¥ä¸‹ä¸¤è¡Œ 12export MAVEN_HOME=/usr/local/apache-maven-3.2.5export PATH=$&#123;PATH&#125;:$&#123;MAVEN_HOME&#125;/bin 5ã€æµ‹è¯• 123[root@localhost ~]# mvn -vApache Maven 3.2.5 (12a6b3acb947671f09b81f49094c53f426d8cea1; 2014-12-14T09:29:23-08:00)Maven home: /usr/local/apache-maven-3.2.5 VMware è™šæ‹Ÿæœºé‡Œé¢çš„ä¸‰å°æœºå™¨ IP åˆ†åˆ«æ˜¯ï¼š 123192.168.153.133192.168.153.134192.168.153.132 é…ç½® hostsåœ¨ /etc/hostsä¸‹é¢ç¼–å†™ï¼šip node èŠ‚ç‚¹çš„åå­—ï¼ˆåŸŸåè§£æï¼‰ 1vim /etc/hosts æ–°å¢ï¼š 123192.168.153.133 es1192.168.153.134 es2192.168.153.132 es3 è®¾ç½® SSH å…å¯†ç ç™»å½•å®‰è£…expectå‘½ä»¤ ï¼š yum -y install expect å°† ssh_p2p.jar éšä¾¿è§£å‹åˆ°ä»»ä½•ç›®å½•ä¸‹ï¼š (è¿™ä¸ª jar åŒ…å¯ä»¥å»ç½‘ä¸Šä¸‹è½½) 1unzip ssh_p2p.zip ä¿®æ”¹ resource çš„ ip å€¼ 1vim /ssh_p2p/deploy_data/resource ï¼ˆå„ä¸ªèŠ‚ç‚¹å’Œè´¦æˆ·åï¼Œå¯†ç ï¼Œfreeä»£è¡¨ç›¸äº’éƒ½å¯ä»¥æ— å¯†ç ç™»é™†ï¼‰ 123456#è®¾ç½®ä¸ºä½ æ¯å°è™šæ‹Ÿæœºçš„ipåœ°å€ï¼Œç”¨æˆ·åï¼Œå¯†ç address=(&quot;192.168.153.133,root,123456,free&quot;&quot;192.168.153,134,root,123456,free&quot;&quot;192.168.153.132,root,123456,free&quot;) ä¿®æ”¹ start.sh çš„è¿è¡Œæƒé™ 1chmod u+x start.sh è¿è¡Œ 1./start.sh æµ‹è¯•ï¼š ssh ipåœ°å€ ï¼ˆæµ‹è¯•æ˜¯å¦å¯ä»¥ç™»å½•ï¼‰ å®‰è£… ElasticSearchä¸‹è½½åœ°å€ï¼š https://www.elastic.co/downloads/elasticsearch 123wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-5.5.2.tar.gzcd /usr/localtar -zxvf elasticsearch-5.5.2.tar.gz su tzs åˆ‡æ¢åˆ° tzs ç”¨æˆ·ä¸‹ ( é»˜è®¤ä¸æ”¯æŒ root ç”¨æˆ·) sh /usr/local/elasticsearch/bin/elasticsearch -d å…¶ä¸­ -d è¡¨ç¤ºåå°å¯åŠ¨ åœ¨ vmware ä¸Šæµ‹è¯•æ˜¯å¦æˆåŠŸï¼šcurl http://localhost:9200/ å‡ºç°å¦‚ä¸Šå›¾è¿™æ ·çš„æ•ˆæœï¼Œå°±ä»£è¡¨å·²ç»è£…å¥½äº†ã€‚ elasticsearch é»˜è®¤ restful-api çš„ç«¯å£æ˜¯ 9200 ä¸æ”¯æŒ IP åœ°å€ï¼Œä¹Ÿå°±æ˜¯è¯´æ— æ³•ä»ä¸»æœºè®¿é—®è™šæ‹Ÿæœºä¸­çš„æœåŠ¡ï¼Œåªèƒ½åœ¨æœ¬æœºç”¨ http://localhost:9200 æ¥è®¿é—®ã€‚å¦‚æœéœ€è¦æ”¹å˜ï¼Œéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ /usr/local/elasticsearch/config/elasticsearch.yml æ–‡ä»¶ï¼ŒåŠ å…¥ä»¥ä¸‹ä¸¤è¡Œï¼š 12network.bind_host: 0.0.0.0network.publish_host: _nonloopback:ipv4 æˆ–å»é™¤ network.host å’Œ http.port ä¹‹å‰çš„æ³¨é‡Šï¼Œå¹¶å°† network.host çš„ IP åœ°å€ä¿®æ”¹ä¸ºæœ¬æœºå¤–ç½‘ IPã€‚ç„¶åé‡å¯ï¼ŒElasticsearch å…³é—­æ–¹æ³•ï¼ˆè¾“å…¥å‘½ä»¤ï¼šps -ef | grep elasticsearch ï¼Œæ‰¾åˆ°è¿›ç¨‹ï¼Œç„¶å kill æ‰å°±è¡Œäº†ã€‚ å¦‚æœå¤–ç½‘è¿˜æ˜¯ä¸èƒ½è®¿é—®ï¼Œåˆ™æœ‰å¯èƒ½æ˜¯é˜²ç«å¢™è®¾ç½®å¯¼è‡´çš„ ( å…³é—­é˜²ç«å¢™ï¼šservice iptables stop ) ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼švim config/elasticsearch.yml cluster.name : my-app (é›†ç¾¤çš„åå­—ï¼Œåå­—ç›¸åŒçš„å°±æ˜¯ä¸€ä¸ªé›†ç¾¤) node.name : es1 ï¼ˆèŠ‚ç‚¹çš„åå­—, å’Œå‰é¢é…ç½®çš„ hosts ä¸­çš„ name è¦ä¸€è‡´ï¼‰ path.data: /data/elasticsearch/data ï¼ˆæ•°æ®çš„è·¯å¾„ã€‚æ²¡æœ‰è¦åˆ›å»ºï¼ˆmkdir -p /data/elasticsearch/{data,logs}ï¼‰ï¼Œå¹¶ä¸”ç»™æ‰§è¡Œç”¨æˆ·æƒé™ chown tzs /data/elasticsearch/{data,logs} -R ï¼‰path.logs: /data/elasticsearch/logs ï¼ˆæ•°æ® log ä¿¡æ¯çš„è·¯å¾„ï¼ŒåŒä¸Šï¼‰network.host: 0.0.0.0 //å…è®¸å¤–ç½‘è®¿é—®ï¼Œä¹Ÿå¯ä»¥æ˜¯è‡ªå·±çš„ipåœ°å€http.port: 9200 //è®¿é—®çš„ç«¯å£discovery.zen.ping.unicast.hosts: [â€œ192.168.153.133â€, â€œ192.168.153.134â€, â€œ192.168.153.132â€] //å„ä¸ªèŠ‚ç‚¹çš„ipåœ°å€ è®°å¾—éœ€è¦æ·»åŠ ä¸Šï¼šï¼ˆè¿™ä¸ªæ˜¯å®‰è£… head æ’ä»¶è¦ç”¨çš„ï¼Œ ç›®å‰ä¸éœ€è¦ï¼‰http.cors.enabled: truehttp.cors.allow-origin: â€œ*â€ æœ€ååœ¨å¤–éƒ¨æµè§ˆå™¨çš„æ•ˆæœå¦‚ä¸‹å›¾ï¼š å®‰è£… IK ä¸­æ–‡åˆ†è¯å¯ä»¥è‡ªå·±ä¸‹è½½æºç ä½¿ç”¨ maven ç¼–è¯‘ï¼Œå½“ç„¶å¦‚æœæ€•éº»çƒ¦å¯ä»¥ç›´æ¥ä¸‹è½½ç¼–è¯‘å¥½çš„ https://github.com/medcl/elasticsearch-analysis-ik/releases/tag/v5.5.2 æ³¨æ„ä¸‹è½½å¯¹åº”çš„ç‰ˆæœ¬æ”¾åœ¨ plugins ç›®å½•ä¸‹ è§£å‹ unzip elasticsearch-analysis-ik-5.5.2.zip åœ¨ es çš„ plugins ä¸‹æ–°å»º ik ç›®å½• mkdir ik å°†åˆšæ‰è§£å‹çš„å¤åˆ¶åˆ°ikç›®å½•ä¸‹ cp -r elasticsearch/* ik åˆ é™¤åˆšæ‰è§£å‹åçš„ 12rm -rf elasticsearchrm -rf elasticsearch-analysis-ik-5.5.2.zip IK å¸¦æœ‰ä¸¤ä¸ªåˆ†è¯å™¨ik_max_word ï¼šä¼šå°†æ–‡æœ¬åšæœ€ç»†ç²’åº¦çš„æ‹†åˆ†ï¼›å°½å¯èƒ½å¤šçš„æ‹†åˆ†å‡ºè¯è¯­ ik_smartï¼šä¼šåšæœ€ç²—ç²’åº¦çš„æ‹†åˆ†ï¼›å·²è¢«åˆ†å‡ºçš„è¯è¯­å°†ä¸ä¼šå†æ¬¡è¢«å…¶å®ƒè¯è¯­å æœ‰ å®‰è£…å®Œ IK ä¸­æ–‡åˆ†è¯å™¨åï¼ˆå½“ç„¶ä¸æ­¢è¿™ç§ä¸­æ–‡åˆ†è¯å™¨ï¼Œè¿˜æœ‰å…¶ä»–çš„ï¼Œå¯ä»¥å‚è€ƒæˆ‘çš„æ–‡ç«  Elasticsearch é»˜è®¤åˆ†è¯å™¨å’Œä¸­åˆ†åˆ†è¯å™¨ä¹‹é—´çš„æ¯”è¾ƒåŠä½¿ç”¨æ–¹æ³•ï¼‰ï¼Œæµ‹è¯•åŒºåˆ«å¦‚ä¸‹ï¼š ik_max_wordcurl -XGET â€˜http://192.168.153.134:9200/_analyze?pretty&amp;analyzer=ik_max_wordâ€˜ -d â€˜è”æƒ³æ˜¯å…¨çƒæœ€å¤§çš„ç¬”è®°æœ¬å‚å•†â€™ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667&#123; &quot;tokens&quot; : [ &#123; &quot;token&quot; : &quot;è”æƒ³&quot;, &quot;start_offset&quot; : 0, &quot;end_offset&quot; : 2, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 0 &#125;, &#123; &quot;token&quot; : &quot;æ˜¯&quot;, &quot;start_offset&quot; : 2, &quot;end_offset&quot; : 3, &quot;type&quot; : &quot;CN_CHAR&quot;, &quot;position&quot; : 1 &#125;, &#123; &quot;token&quot; : &quot;å…¨çƒ&quot;, &quot;start_offset&quot; : 3, &quot;end_offset&quot; : 5, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 2 &#125;, &#123; &quot;token&quot; : &quot;æœ€å¤§&quot;, &quot;start_offset&quot; : 5, &quot;end_offset&quot; : 7, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 3 &#125;, &#123; &quot;token&quot; : &quot;çš„&quot;, &quot;start_offset&quot; : 7, &quot;end_offset&quot; : 8, &quot;type&quot; : &quot;CN_CHAR&quot;, &quot;position&quot; : 4 &#125;, &#123; &quot;token&quot; : &quot;ç¬”è®°æœ¬&quot;, &quot;start_offset&quot; : 8, &quot;end_offset&quot; : 11, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 5 &#125;, &#123; &quot;token&quot; : &quot;ç¬”è®°&quot;, &quot;start_offset&quot; : 8, &quot;end_offset&quot; : 10, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 6 &#125;, &#123; &quot;token&quot; : &quot;æœ¬å‚&quot;, &quot;start_offset&quot; : 10, &quot;end_offset&quot; : 12, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 7 &#125;, &#123; &quot;token&quot; : &quot;å‚å•†&quot;, &quot;start_offset&quot; : 11, &quot;end_offset&quot; : 13, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 8 &#125; ]&#125; ik_smartcurl -XGET â€˜http://localhost:9200/_analyze?pretty&amp;analyzer=ik_smartâ€˜ -d â€˜è”æƒ³æ˜¯å…¨çƒæœ€å¤§çš„ç¬”è®°æœ¬å‚å•†â€™ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253&#123; &quot;tokens&quot; : [ &#123; &quot;token&quot; : &quot;è”æƒ³&quot;, &quot;start_offset&quot; : 0, &quot;end_offset&quot; : 2, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 0 &#125;, &#123; &quot;token&quot; : &quot;æ˜¯&quot;, &quot;start_offset&quot; : 2, &quot;end_offset&quot; : 3, &quot;type&quot; : &quot;CN_CHAR&quot;, &quot;position&quot; : 1 &#125;, &#123; &quot;token&quot; : &quot;å…¨çƒ&quot;, &quot;start_offset&quot; : 3, &quot;end_offset&quot; : 5, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 2 &#125;, &#123; &quot;token&quot; : &quot;æœ€å¤§&quot;, &quot;start_offset&quot; : 5, &quot;end_offset&quot; : 7, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 3 &#125;, &#123; &quot;token&quot; : &quot;çš„&quot;, &quot;start_offset&quot; : 7, &quot;end_offset&quot; : 8, &quot;type&quot; : &quot;CN_CHAR&quot;, &quot;position&quot; : 4 &#125;, &#123; &quot;token&quot; : &quot;ç¬”è®°æœ¬&quot;, &quot;start_offset&quot; : 8, &quot;end_offset&quot; : 11, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 5 &#125;, &#123; &quot;token&quot; : &quot;å‚å•†&quot;, &quot;start_offset&quot; : 11, &quot;end_offset&quot; : 13, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 6 &#125; ]&#125; å®‰è£… head æ’ä»¶elasticsearch-head æ˜¯ä¸€ä¸ª elasticsearch çš„é›†ç¾¤ç®¡ç†å·¥å…·ï¼Œå®ƒæ˜¯å®Œå…¨ç”± html5 ç¼–å†™çš„ç‹¬ç«‹ç½‘é¡µç¨‹åºï¼Œä½ å¯ä»¥é€šè¿‡æ’ä»¶æŠŠå®ƒé›†æˆåˆ° esã€‚ æ•ˆæœå¦‚ä¸‹å›¾ï¼šï¼ˆå›¾ç‰‡æ¥è‡ªç½‘ç»œï¼‰ å®‰è£… git123yum remove gityum install gitgit clone git://github.com/mobz/elasticsearch-head.git æ‹‰å– head æ’ä»¶åˆ°æœ¬åœ°ï¼Œæˆ–è€…ç›´æ¥åœ¨ GitHub ä¸‹è½½ å‹ç¼©åŒ…ä¸‹æ¥ å®‰è£…nodejså…ˆå»å®˜ç½‘ä¸‹è½½ node-v8.4.0-linux-x64.tar.xz 12tar -Jxv -f node-v8.4.0-linux-x64.tar.xzmv node-v8.4.0-linux-x64 node ç¯å¢ƒå˜é‡è®¾ç½®ï¼š 1vim /etc/profile æ–°å¢ï¼š 123export NODE_HOME=/opt/nodeexport PATH=$PATH:$NODE_HOME/binexport NODE_PATH=$NODE_HOME/lib/node_modules ä½¿é…ç½®æ–‡ä»¶ç”Ÿæ•ˆï¼ˆè¿™æ­¥å¾ˆé‡è¦ï¼Œè‡ªå·±è¦å¤šæ³¨æ„è¿™æ­¥ï¼‰ 1source /etc/profile æµ‹è¯•æ˜¯å¦å…¨å±€å¯ç”¨äº†ï¼š 1node -v ç„¶å 12345mv elasticsearch-head headcd head/npm install -g grunt-clinpm installgrunt server å† es çš„é…ç½®æ–‡ä»¶ä¸­åŠ ï¼š 12http.cors.enabled: truehttp.cors.allow-origin: &quot;*&quot; åœ¨æµè§ˆå™¨æ‰“å¼€ http://192.168.153.133:9100/ å°±å¯ä»¥çœ‹åˆ°æ•ˆæœäº†ï¼Œ é‡åˆ°é—®é¢˜æŠŠå‘éƒ½èµ°äº†ä¸€éï¼Œé˜²æ­¢ä»¥åå†æ¬¡å…¥å‘ï¼Œç‰¹æ­¤è®°å½•ä¸‹æ¥ 1ã€ERROR Could not register mbeans java.security.AccessControlException: access denied (â€œjavax.management.MBeanTrustPermissionâ€ â€œregisterâ€) æ”¹å˜ elasticsearch æ–‡ä»¶å¤¹æ‰€æœ‰è€…åˆ°å½“å‰ç”¨æˆ· sudo chown -R noroot:noroot elasticsearch è¿™æ˜¯å› ä¸º elasticsearch éœ€è¦è¯»å†™é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦ç»™äºˆ config æ–‡ä»¶å¤¹æƒé™ï¼Œä¸Šé¢æ–°å»ºäº† elsearch ç”¨æˆ·ï¼Œelsearch ç”¨æˆ·ä¸å…·å¤‡è¯»å†™æƒé™ï¼Œå› æ­¤è¿˜æ˜¯ä¼šæŠ¥é”™ï¼Œè§£å†³æ–¹æ³•æ˜¯åˆ‡æ¢åˆ°ç®¡ç†å‘˜è´¦æˆ·ï¼Œèµ‹äºˆæƒé™å³å¯ï¼š sudo -i chmod -R 775 config 2ã€[WARN ][o.e.b.ElasticsearchUncaughtExceptionHandler] [] uncaught exception in thread [main]org.elasticsearch.bootstrap.StartupException: java.lang.RuntimeException: can not run elasticsearch as root åŸå› æ˜¯elasticsearché»˜è®¤æ˜¯ä¸æ”¯æŒç”¨rootç”¨æˆ·æ¥å¯åŠ¨çš„ã€‚ è§£å†³æ–¹æ¡ˆä¸€ï¼šDes.insecure.allow.root=true ä¿®æ”¹/usr/local/elasticsearch-2.4.0/bin/elasticsearchï¼Œ æ·»åŠ  ES_JAVA_OPTS=â€-Des.insecure.allow.root=trueâ€ æˆ–æ‰§è¡Œæ—¶æ·»åŠ ï¼š sh /usr/local/elasticsearch-2.4.0/bin/elasticsearch -d -Des.insecure.allow.root=true æ³¨æ„ï¼šæ­£å¼ç¯å¢ƒç”¨rootè¿è¡Œå¯èƒ½ä¼šæœ‰å®‰å…¨é£é™©ï¼Œä¸å»ºè®®ç”¨rootæ¥è·‘ã€‚ è§£å†³æ–¹æ¡ˆäºŒï¼šæ·»åŠ ä¸“é—¨çš„ç”¨æˆ· 1234useradd elasticchown -R elastic:elastic elasticsearch-2.4.0su elasticsh /usr/local/elasticsearch-2.4.0/bin/elasticsearch -d 3ã€UnsupportedOperationException: seccomp unavailable: requires kernel 3.5+ with CONFIG_SECCOMP and CONFIG_SECCOMP_FILTER compiled in åªæ˜¯è­¦å‘Šï¼Œä½¿ç”¨æ–°çš„linuxç‰ˆæœ¬ï¼Œå°±ä¸ä¼šå‡ºç°æ­¤ç±»é—®é¢˜äº†ã€‚ 4ã€ERROR: [4] bootstrap checks failed[1]: max file descriptors [4096] for elasticsearch process is too low, increase to at least [65536] åŸå› ï¼šæ— æ³•åˆ›å»ºæœ¬åœ°æ–‡ä»¶é—®é¢˜,ç”¨æˆ·æœ€å¤§å¯åˆ›å»ºæ–‡ä»¶æ•°å¤ªå° è§£å†³æ–¹æ¡ˆï¼šåˆ‡æ¢åˆ° root ç”¨æˆ·ï¼Œç¼–è¾‘ limits.conf é…ç½®æ–‡ä»¶ï¼Œ æ·»åŠ ç±»ä¼¼å¦‚ä¸‹å†…å®¹ï¼š vim /etc/security/limits.conf æ·»åŠ å¦‚ä¸‹å†…å®¹: 1234* soft nofile 65536* hard nofile 131072* soft nproc 2048* hard nproc 4096 [2]: max number of threads [1024] for user [tzs] is too low, increase to at least [2048] åŸå› ï¼šæ— æ³•åˆ›å»ºæœ¬åœ°çº¿ç¨‹é—®é¢˜,ç”¨æˆ·æœ€å¤§å¯åˆ›å»ºçº¿ç¨‹æ•°å¤ªå° è§£å†³æ–¹æ¡ˆï¼šåˆ‡æ¢åˆ°rootç”¨æˆ·ï¼Œè¿›å…¥limits.dç›®å½•ä¸‹ï¼Œä¿®æ”¹90-nproc.conf é…ç½®æ–‡ä»¶ã€‚ vim /etc/security/limits.d/90-nproc.conf æ‰¾åˆ°å¦‚ä¸‹å†…å®¹ï¼š soft nproc 1024 ä¿®æ”¹ä¸º soft nproc 2048 [3]: max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144] åŸå› ï¼šæœ€å¤§è™šæ‹Ÿå†…å­˜å¤ªå° rootç”¨æˆ·æ‰§è¡Œå‘½ä»¤ï¼š sysctl -w vm.max_map_count=262144 æˆ–è€…ä¿®æ”¹ /etc/sysctl.conf æ–‡ä»¶ï¼Œæ·»åŠ  â€œvm.max_map_countâ€è®¾ç½®è®¾ç½®åï¼Œå¯ä»¥ä½¿ç”¨$ sysctl -p [4]: system call filters failed to install; check the logs and fix your configuration or disable system call filters at your own risk åŸå› ï¼šCentos6ä¸æ”¯æŒSecCompï¼Œè€ŒES5.4.1é»˜è®¤bootstrap.system_call_filterä¸ºtrueè¿›è¡Œæ£€æµ‹ï¼Œæ‰€ä»¥å¯¼è‡´æ£€æµ‹å¤±è´¥ï¼Œå¤±è´¥åç›´æ¥å¯¼è‡´ESä¸èƒ½å¯åŠ¨ã€‚è¯¦è§ ï¼šhttps://github.com/elastic/elasticsearch/issues/22899 è§£å†³æ–¹æ³•ï¼šåœ¨elasticsearch.ymlä¸­æ–°å¢é…ç½®bootstrap.system_call_filterï¼Œè®¾ä¸ºfalseï¼Œæ³¨æ„è¦åœ¨Memoryä¸‹é¢:bootstrap.memory_lock: falsebootstrap.system_call_filter: false 5ã€ java.lang.IllegalArgumentException: property [elasticsearch.version] is missing for plugin [head] å† es çš„é…ç½®æ–‡ä»¶ä¸­åŠ ï¼š 12http.cors.enabled: truehttp.cors.allow-origin: &quot;*&quot; æœ€åæ•´ä¸ªæ­å»ºçš„è¿‡ç¨‹å…¨ç¨‹è‡ªå·±æ‰‹åŠ¨å®‰è£…ï¼Œä¸æ˜“ï¼Œå¦‚æœå®‰è£…å¾ˆå¤šå°æœºå™¨ï¼Œæ˜¯å¦å¯ä»¥å†™ä¸ªè„šæœ¬ä¹‹ç±»çš„è‡ªåŠ¨æ­å»ºå‘¢ï¼Ÿå¯ä»¥å»æƒ³æƒ³çš„ã€‚é¦–å‘äºï¼šhttp://www.54tianzhisheng.cn/2017/09/09/Elasticsearch-install/ ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼Œè°¢è°¢é…åˆï¼","tags":[{"name":"ElasticSearch","slug":"ElasticSearch","permalink":"http://www.54tianzhisheng.cn/tags/ElasticSearch/"}]},{"title":"Elasticsearch ç³»åˆ—æ–‡ç« ï¼ˆä¸€ï¼‰ï¼šElasticsearch é»˜è®¤åˆ†è¯å™¨å’Œä¸­åˆ†åˆ†è¯å™¨ä¹‹é—´çš„æ¯”è¾ƒåŠä½¿ç”¨æ–¹æ³•","date":"2017-09-07T16:00:00.000Z","path":"2017/09/08/Elasticsearch-analyzers/","text":"ä»‹ç»ï¼šElasticSearch æ˜¯ä¸€ä¸ªåŸºäº Lucene çš„æœç´¢æœåŠ¡å™¨ã€‚å®ƒæä¾›äº†ä¸€ä¸ªåˆ†å¸ƒå¼å¤šç”¨æˆ·èƒ½åŠ›çš„å…¨æ–‡æœç´¢å¼•æ“ï¼ŒåŸºäº RESTful web æ¥å£ã€‚Elasticsearch æ˜¯ç”¨ Java å¼€å‘çš„ï¼Œå¹¶ä½œä¸ºApacheè®¸å¯æ¡æ¬¾ä¸‹çš„å¼€æ”¾æºç å‘å¸ƒï¼Œæ˜¯å½“å‰æµè¡Œçš„ä¼ä¸šçº§æœç´¢å¼•æ“ã€‚è®¾è®¡ç”¨äºäº‘è®¡ç®—ä¸­ï¼Œèƒ½å¤Ÿè¾¾åˆ°å®æ—¶æœç´¢ï¼Œç¨³å®šï¼Œå¯é ï¼Œå¿«é€Ÿï¼Œå®‰è£…ä½¿ç”¨æ–¹ä¾¿ã€‚ Elasticsearchä¸­ï¼Œå†…ç½®äº†å¾ˆå¤šåˆ†è¯å™¨ï¼ˆanalyzersï¼‰ã€‚ä¸‹é¢æ¥è¿›è¡Œæ¯”è¾ƒä¸‹ç³»ç»Ÿé»˜è®¤åˆ†è¯å™¨å’Œå¸¸ç”¨çš„ä¸­æ–‡åˆ†è¯å™¨ä¹‹é—´çš„åŒºåˆ«ã€‚ ç³»ç»Ÿé»˜è®¤åˆ†è¯å™¨ï¼š1ã€standard åˆ†è¯å™¨https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-standard-analyzer.html å¦‚ä½•ä½¿ç”¨ï¼šhttp://www.yiibai.com/lucene/lucene_standardanalyzer.html è‹±æ–‡çš„å¤„ç†èƒ½åŠ›åŒäºStopAnalyzer.æ”¯æŒä¸­æ–‡é‡‡ç”¨çš„æ–¹æ³•ä¸ºå•å­—åˆ‡åˆ†ã€‚ä»–ä¼šå°†è¯æ±‡å•å…ƒè½¬æ¢æˆå°å†™å½¢å¼ï¼Œå¹¶å»é™¤åœç”¨è¯å’Œæ ‡ç‚¹ç¬¦å·ã€‚ 12345/**StandardAnalyzeråˆ†æå™¨*/public void standardAnalyzer(String msg)&#123; StandardAnalyzer analyzer = new StandardAnalyzer(Version.LUCENE_36); this.getTokens(analyzer, msg);&#125; 2ã€simple åˆ†è¯å™¨https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-simple-analyzer.html å¦‚ä½•ä½¿ç”¨: http://www.yiibai.com/lucene/lucene_simpleanalyzer.html åŠŸèƒ½å¼ºäºWhitespaceAnalyzer, é¦–å…ˆä¼šé€šè¿‡éå­—æ¯å­—ç¬¦æ¥åˆ†å‰²æ–‡æœ¬ä¿¡æ¯ï¼Œç„¶åå°†è¯æ±‡å•å…ƒç»Ÿä¸€ä¸ºå°å†™å½¢å¼ã€‚è¯¥åˆ†æå™¨ä¼šå»æ‰æ•°å­—ç±»å‹çš„å­—ç¬¦ã€‚ 12345/**SimpleAnalyzeråˆ†æå™¨*/ public void simpleAnalyzer(String msg)&#123; SimpleAnalyzer analyzer = new SimpleAnalyzer(Version.LUCENE_36); this.getTokens(analyzer, msg); &#125; 3ã€Whitespace åˆ†è¯å™¨https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-whitespace-analyzer.html å¦‚ä½•ä½¿ç”¨ï¼šhttp://www.yiibai.com/lucene/lucene_whitespaceanalyzer.html ä»…ä»…æ˜¯å»é™¤ç©ºæ ¼ï¼Œå¯¹å­—ç¬¦æ²¡æœ‰lowcaseåŒ–,ä¸æ”¯æŒä¸­æ–‡ï¼›å¹¶ä¸”ä¸å¯¹ç”Ÿæˆçš„è¯æ±‡å•å…ƒè¿›è¡Œå…¶ä»–çš„è§„èŒƒåŒ–å¤„ç†ã€‚ 12345/**WhitespaceAnalyzeråˆ†æå™¨*/ public void whitespaceAnalyzer(String msg)&#123; WhitespaceAnalyzer analyzer = new WhitespaceAnalyzer(Version.LUCENE_36); this.getTokens(analyzer, msg); &#125; 4ã€Stop åˆ†è¯å™¨https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-stop-analyzer.html å¦‚ä½•ä½¿ç”¨ï¼šhttp://www.yiibai.com/lucene/lucene_stopanalyzer.html StopAnalyzerçš„åŠŸèƒ½è¶…è¶Šäº†SimpleAnalyzerï¼Œåœ¨SimpleAnalyzerçš„åŸºç¡€ä¸Šå¢åŠ äº†å»é™¤è‹±æ–‡ä¸­çš„å¸¸ç”¨å•è¯ï¼ˆå¦‚theï¼Œaç­‰ï¼‰ï¼Œä¹Ÿå¯ä»¥æ›´åŠ è‡ªå·±çš„éœ€è¦è®¾ç½®å¸¸ç”¨å•è¯ï¼›ä¸æ”¯æŒä¸­æ–‡ 12345/**StopAnalyzeråˆ†æå™¨*/ public void stopAnalyzer(String msg)&#123; StopAnalyzer analyzer = new StopAnalyzer(Version.LUCENE_36); this.getTokens(analyzer, msg); &#125; 5ã€keyword åˆ†è¯å™¨KeywordAnalyzeræŠŠæ•´ä¸ªè¾“å…¥ä½œä¸ºä¸€ä¸ªå•ç‹¬è¯æ±‡å•å…ƒï¼Œæ–¹ä¾¿ç‰¹æ®Šç±»å‹çš„æ–‡æœ¬è¿›è¡Œç´¢å¼•å’Œæ£€ç´¢ã€‚é’ˆå¯¹é‚®æ”¿ç¼–ç ï¼Œåœ°å€ç­‰æ–‡æœ¬ä¿¡æ¯ä½¿ç”¨å…³é”®è¯åˆ†è¯å™¨è¿›è¡Œç´¢å¼•é¡¹å»ºç«‹éå¸¸æ–¹ä¾¿ã€‚ 6ã€pattern åˆ†è¯å™¨https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-pattern-analyzer.html ä¸€ä¸ªpatternç±»å‹çš„analyzerå¯ä»¥é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼å°†æ–‡æœ¬åˆ†æˆâ€termsâ€(ç»è¿‡token Filter åå¾—åˆ°çš„ä¸œè¥¿ )ã€‚æ¥å—å¦‚ä¸‹è®¾ç½®: ä¸€ä¸ª pattern analyzer å¯ä»¥åšå¦‚ä¸‹çš„å±æ€§è®¾ç½®: lowercase termsæ˜¯å¦æ˜¯å°å†™. é»˜è®¤ä¸º true å°å†™. pattern æ­£åˆ™è¡¨è¾¾å¼çš„pattern, é»˜è®¤æ˜¯ \\W+. flags æ­£åˆ™è¡¨è¾¾å¼çš„flags stopwords ä¸€ä¸ªç”¨äºåˆå§‹åŒ–stop filterçš„éœ€è¦stop å•è¯çš„åˆ—è¡¨.é»˜è®¤å•è¯æ˜¯ç©ºçš„åˆ—è¡¨ 7ã€language åˆ†è¯å™¨https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-lang-analyzer.html ä¸€ä¸ªç”¨äºè§£æç‰¹æ®Šè¯­è¨€æ–‡æœ¬çš„analyzeré›†åˆã€‚ï¼ˆ arabic,armenian, basque, brazilian, bulgarian, catalan, cjk, czech, danish, dutch, english, finnish, french,galician, german, greek, hindi, hungarian, indonesian, irish, italian, latvian, lithuanian, norwegian,persian, portuguese, romanian, russian, sorani, spanish, swedish, turkish, thai.ï¼‰å¯æƒœæ²¡æœ‰ä¸­æ–‡ã€‚ä¸äºˆè€ƒè™‘ 8ã€snowball åˆ†è¯å™¨ä¸€ä¸ªsnowballç±»å‹çš„analyzeræ˜¯ç”±standard tokenizerå’Œstandard filterã€lowercase filterã€stop filterã€snowball filterè¿™å››ä¸ªfilteræ„æˆçš„ã€‚ snowball analyzer åœ¨Luceneä¸­é€šå¸¸æ˜¯ä¸æ¨èä½¿ç”¨çš„ã€‚ 9ã€Custom åˆ†è¯å™¨æ˜¯è‡ªå®šä¹‰çš„analyzerã€‚å…è®¸å¤šä¸ªé›¶åˆ°å¤šä¸ªtokenizerï¼Œé›¶åˆ°å¤šä¸ª Char Filters. custom analyzer çš„åå­—ä¸èƒ½ä»¥ â€œ_â€å¼€å¤´. The following are settings that can be set for a custom analyzer type: Setting Description tokenizer é€šç”¨çš„æˆ–è€…æ³¨å†Œçš„tokenizer. filter é€šç”¨çš„æˆ–è€…æ³¨å†Œçš„token filters char_filter é€šç”¨çš„æˆ–è€…æ³¨å†Œçš„ character filters position_increment_gap è·ç¦»æŸ¥è¯¢æ—¶ï¼Œæœ€å¤§å…è®¸æŸ¥è¯¢çš„è·ç¦»ï¼Œé»˜è®¤æ˜¯100 è‡ªå®šä¹‰çš„æ¨¡æ¿ï¼š 1234567891011121314151617181920212223242526index : analysis : analyzer : myAnalyzer2 : type : custom tokenizer : myTokenizer1 filter : [myTokenFilter1, myTokenFilter2] char_filter : [my_html] position_increment_gap: 256 tokenizer : myTokenizer1 : type : standard max_token_length : 900 filter : myTokenFilter1 : type : stop stopwords : [stop1, stop2, stop3, stop4] myTokenFilter2 : type : length min : 0 max : 2000 char_filter : my_html : type : html_strip escaped_tags : [xxx, yyy] read_ahead : 1024 10ã€fingerprint åˆ†è¯å™¨https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-fingerprint-analyzer.html ä¸­æ–‡åˆ†è¯å™¨ï¼š1ã€ik-analyzerhttps://github.com/wks/ik-analyzer IKAnalyzeræ˜¯ä¸€ä¸ªå¼€æºçš„ï¼ŒåŸºäºjavaè¯­è¨€å¼€å‘çš„è½»é‡çº§çš„ä¸­æ–‡åˆ†è¯å·¥å…·åŒ…ã€‚ é‡‡ç”¨äº†ç‰¹æœ‰çš„â€œæ­£å‘è¿­ä»£æœ€ç»†ç²’åº¦åˆ‡åˆ†ç®—æ³•â€œï¼Œæ”¯æŒç»†ç²’åº¦å’Œæœ€å¤§è¯é•¿ä¸¤ç§åˆ‡åˆ†æ¨¡å¼ï¼›å…·æœ‰83ä¸‡å­—/ç§’ï¼ˆ1600KB/Sï¼‰çš„é«˜é€Ÿå¤„ç†èƒ½åŠ›ã€‚ é‡‡ç”¨äº†å¤šå­å¤„ç†å™¨åˆ†ææ¨¡å¼ï¼Œæ”¯æŒï¼šè‹±æ–‡å­—æ¯ã€æ•°å­—ã€ä¸­æ–‡è¯æ±‡ç­‰åˆ†è¯å¤„ç†ï¼Œå…¼å®¹éŸ©æ–‡ã€æ—¥æ–‡å­—ç¬¦ ä¼˜åŒ–çš„è¯å…¸å­˜å‚¨ï¼Œæ›´å°çš„å†…å­˜å ç”¨ã€‚æ”¯æŒç”¨æˆ·è¯å…¸æ‰©å±•å®šä¹‰ é’ˆå¯¹Luceneå…¨æ–‡æ£€ç´¢ä¼˜åŒ–çš„æŸ¥è¯¢åˆ†æå™¨IKQueryParser(ä½œè€…åè¡€æ¨è)ï¼›å¼•å…¥ç®€å•æœç´¢è¡¨è¾¾å¼ï¼Œé‡‡ç”¨æ­§ä¹‰åˆ†æç®—æ³•ä¼˜åŒ–æŸ¥è¯¢å…³é”®å­—çš„æœç´¢æ’åˆ—ç»„åˆï¼Œèƒ½æå¤§çš„æé«˜Luceneæ£€ç´¢çš„å‘½ä¸­ç‡ã€‚ Mavenç”¨æ³•ï¼š 12345&lt;dependency&gt; &lt;groupId&gt;org.wltea.ik-analyzer&lt;/groupId&gt; &lt;artifactId&gt;ik-analyzer&lt;/artifactId&gt; &lt;version&gt;3.2.8&lt;/version&gt;&lt;/dependency&gt; åœ¨IK AnalyzeråŠ å…¥Maven Central Repositoryä¹‹å‰ï¼Œä½ éœ€è¦æ‰‹åŠ¨å®‰è£…ï¼Œå®‰è£…åˆ°æœ¬åœ°çš„repositoryï¼Œæˆ–è€…ä¸Šä¼ åˆ°è‡ªå·±çš„Maven repositoryæœåŠ¡å™¨ä¸Šã€‚ è¦å®‰è£…åˆ°æœ¬åœ°Maven repositoryï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼Œå°†è‡ªåŠ¨ç¼–è¯‘ï¼Œæ‰“åŒ…å¹¶å®‰è£…ï¼šmvn install -Dmaven.test.skip=true Elasticsearchæ·»åŠ ä¸­æ–‡åˆ†è¯å®‰è£…IKåˆ†è¯æ’ä»¶https://github.com/medcl/elasticsearch-analysis-ik è¿›å…¥elasticsearch-analysis-ik-master æ›´å¤šå®‰è£…è¯·å‚è€ƒåšå®¢ï¼š 1ã€ä¸ºelasticæ·»åŠ ä¸­æ–‡åˆ†è¯ ï¼š http://blog.csdn.net/dingzfang/article/details/42776693 2ã€å¦‚ä½•åœ¨Elasticsearchä¸­å®‰è£…ä¸­æ–‡åˆ†è¯å™¨(IK+pinyin) ï¼šhttp://www.cnblogs.com/xing901022/p/5910139.html 3ã€Elasticsearch ä¸­æ–‡åˆ†è¯å™¨ IK é…ç½®å’Œä½¿ç”¨ ï¼š http://blog.csdn.net/jam00/article/details/52983056 ik å¸¦æœ‰ä¸¤ä¸ªåˆ†è¯å™¨ik_max_word ï¼šä¼šå°†æ–‡æœ¬åšæœ€ç»†ç²’åº¦çš„æ‹†åˆ†ï¼›å°½å¯èƒ½å¤šçš„æ‹†åˆ†å‡ºè¯è¯­ ik_smartï¼šä¼šåšæœ€ç²—ç²’åº¦çš„æ‹†åˆ†ï¼›å·²è¢«åˆ†å‡ºçš„è¯è¯­å°†ä¸ä¼šå†æ¬¡è¢«å…¶å®ƒè¯è¯­å æœ‰ åŒºåˆ«ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133# ik_max_wordcurl -XGET &apos;http://localhost:9200/_analyze?pretty&amp;analyzer=ik_max_word&apos; -d &apos;è”æƒ³æ˜¯å…¨çƒæœ€å¤§çš„ç¬”è®°æœ¬å‚å•†&apos;#è¿”å›&#123; &quot;tokens&quot; : [ &#123; &quot;token&quot; : &quot;è”æƒ³&quot;, &quot;start_offset&quot; : 0, &quot;end_offset&quot; : 2, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 0 &#125;, &#123; &quot;token&quot; : &quot;æ˜¯&quot;, &quot;start_offset&quot; : 2, &quot;end_offset&quot; : 3, &quot;type&quot; : &quot;CN_CHAR&quot;, &quot;position&quot; : 1 &#125;, &#123; &quot;token&quot; : &quot;å…¨çƒ&quot;, &quot;start_offset&quot; : 3, &quot;end_offset&quot; : 5, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 2 &#125;, &#123; &quot;token&quot; : &quot;æœ€å¤§&quot;, &quot;start_offset&quot; : 5, &quot;end_offset&quot; : 7, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 3 &#125;, &#123; &quot;token&quot; : &quot;çš„&quot;, &quot;start_offset&quot; : 7, &quot;end_offset&quot; : 8, &quot;type&quot; : &quot;CN_CHAR&quot;, &quot;position&quot; : 4 &#125;, &#123; &quot;token&quot; : &quot;ç¬”è®°æœ¬&quot;, &quot;start_offset&quot; : 8, &quot;end_offset&quot; : 11, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 5 &#125;, &#123; &quot;token&quot; : &quot;ç¬”è®°&quot;, &quot;start_offset&quot; : 8, &quot;end_offset&quot; : 10, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 6 &#125;, &#123; &quot;token&quot; : &quot;æœ¬å‚&quot;, &quot;start_offset&quot; : 10, &quot;end_offset&quot; : 12, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 7 &#125;, &#123; &quot;token&quot; : &quot;å‚å•†&quot;, &quot;start_offset&quot; : 11, &quot;end_offset&quot; : 13, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 8 &#125; ]&#125;# ik_smartcurl -XGET &apos;http://localhost:9200/_analyze?pretty&amp;analyzer=ik_smart&apos; -d &apos;è”æƒ³æ˜¯å…¨çƒæœ€å¤§çš„ç¬”è®°æœ¬å‚å•†&apos;# è¿”å›&#123; &quot;tokens&quot; : [ &#123; &quot;token&quot; : &quot;è”æƒ³&quot;, &quot;start_offset&quot; : 0, &quot;end_offset&quot; : 2, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 0 &#125;, &#123; &quot;token&quot; : &quot;æ˜¯&quot;, &quot;start_offset&quot; : 2, &quot;end_offset&quot; : 3, &quot;type&quot; : &quot;CN_CHAR&quot;, &quot;position&quot; : 1 &#125;, &#123; &quot;token&quot; : &quot;å…¨çƒ&quot;, &quot;start_offset&quot; : 3, &quot;end_offset&quot; : 5, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 2 &#125;, &#123; &quot;token&quot; : &quot;æœ€å¤§&quot;, &quot;start_offset&quot; : 5, &quot;end_offset&quot; : 7, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 3 &#125;, &#123; &quot;token&quot; : &quot;çš„&quot;, &quot;start_offset&quot; : 7, &quot;end_offset&quot; : 8, &quot;type&quot; : &quot;CN_CHAR&quot;, &quot;position&quot; : 4 &#125;, &#123; &quot;token&quot; : &quot;ç¬”è®°æœ¬&quot;, &quot;start_offset&quot; : 8, &quot;end_offset&quot; : 11, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 5 &#125;, &#123; &quot;token&quot; : &quot;å‚å•†&quot;, &quot;start_offset&quot; : 11, &quot;end_offset&quot; : 13, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 6 &#125; ]&#125; ä¸‹é¢æˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªç´¢å¼•ï¼Œä½¿ç”¨ ikåˆ›å»ºä¸€ä¸ªåå« iktest çš„ç´¢å¼•ï¼Œè®¾ç½®å®ƒçš„åˆ†æå™¨ç”¨ ik ï¼Œåˆ†è¯å™¨ç”¨ ik_max_wordï¼Œå¹¶åˆ›å»ºä¸€ä¸ª article çš„ç±»å‹ï¼Œé‡Œé¢æœ‰ä¸€ä¸ª subject çš„å­—æ®µï¼ŒæŒ‡å®šå…¶ä½¿ç”¨ ik_max_word åˆ†è¯å™¨ 12345678910111213141516171819202122curl -XPUT &apos;http://localhost:9200/iktest?pretty&apos; -d &apos;&#123; &quot;settings&quot; : &#123; &quot;analysis&quot; : &#123; &quot;analyzer&quot; : &#123; &quot;ik&quot; : &#123; &quot;tokenizer&quot; : &quot;ik_max_word&quot; &#125; &#125; &#125; &#125;, &quot;mappings&quot; : &#123; &quot;article&quot; : &#123; &quot;dynamic&quot; : true, &quot;properties&quot; : &#123; &quot;subject&quot; : &#123; &quot;type&quot; : &quot;string&quot;, &quot;analyzer&quot; : &quot;ik_max_word&quot; &#125; &#125; &#125; &#125;&#125;&apos; æ‰¹é‡æ·»åŠ å‡ æ¡æ•°æ®ï¼Œè¿™é‡Œæˆ‘æŒ‡å®šå…ƒæ•°æ® _id æ–¹ä¾¿æŸ¥çœ‹ï¼Œsubject å†…å®¹ä¸ºæˆ‘éšä¾¿æ‰¾çš„å‡ æ¡æ–°é—»çš„æ ‡é¢˜ 123456789101112curl -XPOST http://localhost:9200/iktest/article/_bulk?pretty -d &apos;&#123; &quot;index&quot; : &#123; &quot;_id&quot; : &quot;1&quot; &#125; &#125;&#123;&quot;subject&quot; : &quot;ï¼‚é—ºèœœï¼‚å´”é¡ºå®è¢«éŸ©æ£€æ–¹ä¼ å”¤ éŸ©æ€»ç»Ÿåºœä¿ƒå½»æŸ¥çœŸç›¸&quot; &#125;&#123; &quot;index&quot; : &#123; &quot;_id&quot; : &quot;2&quot; &#125; &#125;&#123;&quot;subject&quot; : &quot;éŸ©ä¸¾è¡Œï¼‚æŠ¤å›½è®­ç»ƒï¼‚ é’ç“¦å°:å†³ä¸è®¸å›½å®¶å®‰å…¨å‡ºé—®é¢˜&quot; &#125;&#123; &quot;index&quot; : &#123; &quot;_id&quot; : &quot;3&quot; &#125; &#125;&#123;&quot;subject&quot; : &quot;åª’ä½“ç§°FBIå·²ç»å–å¾—æœæŸ¥ä»¤ æ£€è§†å¸Œæ‹‰é‡Œç”µé‚®&quot; &#125;&#123; &quot;index&quot; : &#123; &quot;_id&quot; : &quot;4&quot; &#125; &#125;&#123;&quot;subject&quot; : &quot;æ‘ä¸Šæ˜¥æ ‘è·å®‰å¾’ç”Ÿå¥– æ¼”è®²ä¸­è°ˆåŠæ¬§æ´²æ’å¤–é—®é¢˜&quot; &#125;&#123; &quot;index&quot; : &#123; &quot;_id&quot; : &quot;5&quot; &#125; &#125;&#123;&quot;subject&quot; : &quot;å¸Œæ‹‰é‡Œå›¢é˜Ÿç‚®è½°FBI å‚é™¢æ°‘ä¸»å…šé¢†è¢–æ‰¹å…¶â€œè¿æ³•â€&quot; &#125;&apos; æŸ¥è¯¢ â€œå¸Œæ‹‰é‡Œå’ŒéŸ©å›½â€ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071curl -XPOST http://localhost:9200/iktest/article/_search?pretty -d&apos;&#123; &quot;query&quot; : &#123; &quot;match&quot; : &#123; &quot;subject&quot; : &quot;å¸Œæ‹‰é‡Œå’ŒéŸ©å›½&quot; &#125;&#125;, &quot;highlight&quot; : &#123; &quot;pre_tags&quot; : [&quot;&lt;font color=&apos;red&apos;&gt;&quot;], &quot;post_tags&quot; : [&quot;&lt;/font&gt;&quot;], &quot;fields&quot; : &#123; &quot;subject&quot; : &#123;&#125; &#125; &#125;&#125;&apos;#è¿”å›&#123; &quot;took&quot; : 113, &quot;timed_out&quot; : false, &quot;_shards&quot; : &#123; &quot;total&quot; : 5, &quot;successful&quot; : 5, &quot;failed&quot; : 0 &#125;, &quot;hits&quot; : &#123; &quot;total&quot; : 4, &quot;max_score&quot; : 0.034062363, &quot;hits&quot; : [ &#123; &quot;_index&quot; : &quot;iktest&quot;, &quot;_type&quot; : &quot;article&quot;, &quot;_id&quot; : &quot;2&quot;, &quot;_score&quot; : 0.034062363, &quot;_source&quot; : &#123; &quot;subject&quot; : &quot;éŸ©ä¸¾è¡Œï¼‚æŠ¤å›½è®­ç»ƒï¼‚ é’ç“¦å°:å†³ä¸è®¸å›½å®¶å®‰å…¨å‡ºé—®é¢˜&quot; &#125;, &quot;highlight&quot; : &#123; &quot;subject&quot; : [ &quot;&lt;font color=red&gt;éŸ©&lt;/font&gt;ä¸¾è¡Œï¼‚æŠ¤&lt;font color=red&gt;å›½&lt;/font&gt;è®­ç»ƒï¼‚ é’ç“¦å°:å†³ä¸è®¸å›½å®¶å®‰å…¨å‡ºé—®é¢˜&quot; ] &#125; &#125;, &#123; &quot;_index&quot; : &quot;iktest&quot;, &quot;_type&quot; : &quot;article&quot;, &quot;_id&quot; : &quot;3&quot;, &quot;_score&quot; : 0.0076681254, &quot;_source&quot; : &#123; &quot;subject&quot; : &quot;åª’ä½“ç§°FBIå·²ç»å–å¾—æœæŸ¥ä»¤ æ£€è§†å¸Œæ‹‰é‡Œç”µé‚®&quot; &#125;, &quot;highlight&quot; : &#123; &quot;subject&quot; : [ &quot;åª’ä½“ç§°FBIå·²ç»å–å¾—æœæŸ¥ä»¤ æ£€è§†&lt;font color=red&gt;å¸Œæ‹‰é‡Œ&lt;/font&gt;ç”µé‚®&quot; ] &#125; &#125;, &#123; &quot;_index&quot; : &quot;iktest&quot;, &quot;_type&quot; : &quot;article&quot;, &quot;_id&quot; : &quot;5&quot;, &quot;_score&quot; : 0.006709609, &quot;_source&quot; : &#123; &quot;subject&quot; : &quot;å¸Œæ‹‰é‡Œå›¢é˜Ÿç‚®è½°FBI å‚é™¢æ°‘ä¸»å…šé¢†è¢–æ‰¹å…¶â€œè¿æ³•â€&quot; &#125;, &quot;highlight&quot; : &#123; &quot;subject&quot; : [ &quot;&lt;font color=red&gt;å¸Œæ‹‰é‡Œ&lt;/font&gt;å›¢é˜Ÿç‚®è½°FBI å‚é™¢æ°‘ä¸»å…šé¢†è¢–æ‰¹å…¶â€œè¿æ³•â€&quot; ] &#125; &#125;, &#123; &quot;_index&quot; : &quot;iktest&quot;, &quot;_type&quot; : &quot;article&quot;, &quot;_id&quot; : &quot;1&quot;, &quot;_score&quot; : 0.0021509775, &quot;_source&quot; : &#123; &quot;subject&quot; : &quot;ï¼‚é—ºèœœï¼‚å´”é¡ºå®è¢«éŸ©æ£€æ–¹ä¼ å”¤ éŸ©æ€»ç»Ÿåºœä¿ƒå½»æŸ¥çœŸç›¸&quot; &#125;, &quot;highlight&quot; : &#123; &quot;subject&quot; : [ &quot;ï¼‚é—ºèœœï¼‚å´”é¡ºå®è¢«&lt;font color=red&gt;éŸ©&lt;/font&gt;æ£€æ–¹ä¼ å”¤ &lt;font color=red&gt;éŸ©&lt;/font&gt;æ€»ç»Ÿåºœä¿ƒå½»æŸ¥çœŸç›¸&quot; ] &#125; &#125; ] &#125;&#125; è¿™é‡Œç”¨äº†é«˜äº®å±æ€§ highlightï¼Œç›´æ¥æ˜¾ç¤ºåˆ° html ä¸­ï¼Œè¢«åŒ¹é…åˆ°çš„å­—æˆ–è¯å°†ä»¥çº¢è‰²çªå‡ºæ˜¾ç¤ºã€‚è‹¥è¦ç”¨è¿‡æ»¤æœç´¢ï¼Œç›´æ¥å°† match æ”¹ä¸º term å³å¯ çƒ­è¯æ›´æ–°é…ç½®ç½‘ç»œè¯è¯­æ—¥æ–°æœˆå¼‚ï¼Œå¦‚ä½•è®©æ–°å‡ºçš„ç½‘ç»œçƒ­è¯ï¼ˆæˆ–ç‰¹å®šçš„è¯è¯­ï¼‰å®æ—¶çš„æ›´æ–°åˆ°æˆ‘ä»¬çš„æœç´¢å½“ä¸­å‘¢ å…ˆç”¨ ik æµ‹è¯•ä¸€ä¸‹ 12345678910111213141516171819202122232425262728293031323334353637curl -XGET &apos;http://localhost:9200/_analyze?pretty&amp;analyzer=ik_max_word&apos; -d &apos;æˆé¾™åŸåé™ˆæ¸¯ç”Ÿ&apos;#è¿”å›&#123; &quot;tokens&quot; : [ &#123; &quot;token&quot; : &quot;æˆé¾™&quot;, &quot;start_offset&quot; : 1, &quot;end_offset&quot; : 3, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 0 &#125;, &#123; &quot;token&quot; : &quot;åŸå&quot;, &quot;start_offset&quot; : 3, &quot;end_offset&quot; : 5, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 1 &#125;, &#123; &quot;token&quot; : &quot;é™ˆ&quot;, &quot;start_offset&quot; : 5, &quot;end_offset&quot; : 6, &quot;type&quot; : &quot;CN_CHAR&quot;, &quot;position&quot; : 2 &#125;, &#123; &quot;token&quot; : &quot;æ¸¯&quot;, &quot;start_offset&quot; : 6, &quot;end_offset&quot; : 7, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 3 &#125;, &#123; &quot;token&quot; : &quot;ç”Ÿ&quot;, &quot;start_offset&quot; : 7, &quot;end_offset&quot; : 8, &quot;type&quot; : &quot;CN_CHAR&quot;, &quot;position&quot; : 4 &#125; ]&#125; ik çš„ä¸»è¯å…¸ä¸­æ²¡æœ‰â€é™ˆæ¸¯ç”Ÿâ€ è¿™ä¸ªè¯ï¼Œæ‰€ä»¥è¢«æ‹†åˆ†äº†ã€‚ç°åœ¨æˆ‘ä»¬æ¥é…ç½®ä¸€ä¸‹ ä¿®æ”¹ IK çš„é…ç½®æ–‡ä»¶ ï¼šES ç›®å½•/plugins/ik/config/ik/IKAnalyzer.cfg.xml ä¿®æ”¹å¦‚ä¸‹ï¼š 12345678910111213&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE properties SYSTEM &quot;http://java.sun.com/dtd/properties.dtd&quot;&gt;&lt;properties&gt; &lt;comment&gt;IK Analyzer æ‰©å±•é…ç½®&lt;/comment&gt; &lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è‡ªå·±çš„æ‰©å±•å­—å…¸ --&gt; &lt;entry key=&quot;ext_dict&quot;&gt;custom/mydict.dic;custom/single_word_low_freq.dic&lt;/entry&gt; &lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è‡ªå·±çš„æ‰©å±•åœæ­¢è¯å­—å…¸--&gt; &lt;entry key=&quot;ext_stopwords&quot;&gt;custom/ext_stopword.dic&lt;/entry&gt; &lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è¿œç¨‹æ‰©å±•å­—å…¸ --&gt; &lt;entry key=&quot;remote_ext_dict&quot;&gt;http://192.168.1.136/hotWords.php&lt;/entry&gt; &lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è¿œç¨‹æ‰©å±•åœæ­¢è¯å­—å…¸--&gt; &lt;!-- &lt;entry key=&quot;remote_ext_stopwords&quot;&gt;words_location&lt;/entry&gt; --&gt;&lt;/properties&gt; è¿™é‡Œæˆ‘æ˜¯ç”¨çš„æ˜¯è¿œç¨‹æ‰©å±•å­—å…¸ï¼Œå› ä¸ºå¯ä»¥ä½¿ç”¨å…¶ä»–ç¨‹åºè°ƒç”¨æ›´æ–°ï¼Œä¸”ä¸ç”¨é‡å¯ ESï¼Œå¾ˆæ–¹ä¾¿ï¼›å½“ç„¶ä½¿ç”¨è‡ªå®šä¹‰çš„ mydict.dic å­—å…¸ä¹Ÿæ˜¯å¾ˆæ–¹ä¾¿çš„ï¼Œä¸€è¡Œä¸€ä¸ªè¯ï¼Œè‡ªå·±åŠ å°±å¯ä»¥äº† æ—¢ç„¶æ˜¯è¿œç¨‹è¯å…¸ï¼Œé‚£ä¹ˆå°±è¦æ˜¯ä¸€ä¸ªå¯è®¿é—®çš„é“¾æ¥ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªé¡µé¢ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªtxtçš„æ–‡æ¡£ï¼Œä½†è¦ä¿è¯è¾“å‡ºçš„å†…å®¹æ˜¯ utf-8 çš„æ ¼å¼ hotWords.php çš„å†…å®¹ 12345678$s = &lt;&lt;&lt;'EOF'é™ˆæ¸¯ç”Ÿå…ƒæ¥¼è“ç˜¦EOF;header('Last-Modified: '.gmdate('D, d M Y H:i:s', time()).' GMT', true, 200);header('ETag: \"5816f349-19\"');echo $s; ik æ¥æ”¶ä¸¤ä¸ªè¿”å›çš„å¤´éƒ¨å±æ€§ Last-Modified å’Œ ETagï¼Œåªè¦å…¶ä¸­ä¸€ä¸ªæœ‰å˜åŒ–ï¼Œå°±ä¼šè§¦å‘æ›´æ–°ï¼Œik ä¼šæ¯åˆ†é’Ÿè·å–ä¸€æ¬¡é‡å¯ Elasticsearch ï¼ŒæŸ¥çœ‹å¯åŠ¨è®°å½•ï¼Œçœ‹åˆ°äº†ä¸‰ä¸ªè¯å·²è¢«åŠ è½½è¿›æ¥ å†æ¬¡æ‰§è¡Œä¸Šé¢çš„è¯·æ±‚ï¼Œè¿”å›, å°±å¯ä»¥çœ‹åˆ° ik åˆ†è¯å™¨å·²ç»åŒ¹é…åˆ°äº† â€œé™ˆæ¸¯ç”Ÿâ€ è¿™ä¸ªè¯ï¼ŒåŒç†ä¸€äº›å…³äºæˆ‘ä»¬å…¬å¸çš„ä¸“æœ‰åå­—ï¼ˆä¾‹å¦‚ï¼šæ°¸è¾‰ã€æ°¸è¾‰è¶…å¸‚ã€æ°¸è¾‰äº‘åˆ›ã€äº‘åˆ› â€¦. ï¼‰ä¹Ÿå¯ä»¥è‡ªå·±æ‰‹åŠ¨æ·»åŠ åˆ°å­—å…¸ä¸­å»ã€‚ 2ã€ç»“å·´ä¸­æ–‡åˆ†è¯ç‰¹ç‚¹ï¼š1ã€æ”¯æŒä¸‰ç§åˆ†è¯æ¨¡å¼ï¼š ç²¾ç¡®æ¨¡å¼ï¼Œè¯•å›¾å°†å¥å­æœ€ç²¾ç¡®åœ°åˆ‡å¼€ï¼Œé€‚åˆæ–‡æœ¬åˆ†æï¼› å…¨æ¨¡å¼ï¼ŒæŠŠå¥å­ä¸­æ‰€æœ‰çš„å¯ä»¥æˆè¯çš„è¯è¯­éƒ½æ‰«æå‡ºæ¥, é€Ÿåº¦éå¸¸å¿«ï¼Œä½†æ˜¯ä¸èƒ½è§£å†³æ­§ä¹‰ï¼› æœç´¢å¼•æ“æ¨¡å¼ï¼Œåœ¨ç²¾ç¡®æ¨¡å¼çš„åŸºç¡€ä¸Šï¼Œå¯¹é•¿è¯å†æ¬¡åˆ‡åˆ†ï¼Œæé«˜å¬å›ç‡ï¼Œé€‚åˆç”¨äºæœç´¢å¼•æ“åˆ†è¯ã€‚ 2ã€æ”¯æŒç¹ä½“åˆ†è¯ 3ã€æ”¯æŒè‡ªå®šä¹‰è¯å…¸ 3ã€THULACTHULACï¼ˆTHU Lexical Analyzer for Chineseï¼‰ç”±æ¸…åå¤§å­¦è‡ªç„¶è¯­è¨€å¤„ç†ä¸ç¤¾ä¼šäººæ–‡è®¡ç®—å®éªŒå®¤ç ”åˆ¶æ¨å‡ºçš„ä¸€å¥—ä¸­æ–‡è¯æ³•åˆ†æå·¥å…·åŒ…ï¼Œå…·æœ‰ä¸­æ–‡åˆ†è¯å’Œè¯æ€§æ ‡æ³¨åŠŸèƒ½ã€‚THULACå…·æœ‰å¦‚ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š èƒ½åŠ›å¼ºã€‚åˆ©ç”¨æˆ‘ä»¬é›†æˆçš„ç›®å‰ä¸–ç•Œä¸Šè§„æ¨¡æœ€å¤§çš„äººå·¥åˆ†è¯å’Œè¯æ€§æ ‡æ³¨ä¸­æ–‡è¯­æ–™åº“ï¼ˆçº¦å«5800ä¸‡å­—ï¼‰è®­ç»ƒè€Œæˆï¼Œæ¨¡å‹æ ‡æ³¨èƒ½åŠ›å¼ºå¤§ã€‚ å‡†ç¡®ç‡é«˜ã€‚è¯¥å·¥å…·åŒ…åœ¨æ ‡å‡†æ•°æ®é›†Chinese Treebankï¼ˆCTB5ï¼‰ä¸Šåˆ†è¯çš„F1å€¼å¯è¾¾97.3ï¼…ï¼Œè¯æ€§æ ‡æ³¨çš„F1å€¼å¯è¾¾åˆ°92.9ï¼…ï¼Œä¸è¯¥æ•°æ®é›†ä¸Šæœ€å¥½æ–¹æ³•æ•ˆæœç›¸å½“ã€‚ é€Ÿåº¦è¾ƒå¿«ã€‚åŒæ—¶è¿›è¡Œåˆ†è¯å’Œè¯æ€§æ ‡æ³¨é€Ÿåº¦ä¸º300KB/sï¼Œæ¯ç§’å¯å¤„ç†çº¦15ä¸‡å­—ã€‚åªè¿›è¡Œåˆ†è¯é€Ÿåº¦å¯è¾¾åˆ°1.3MB/sã€‚ ä¸­æ–‡åˆ†è¯å·¥å…·thulac4jå‘å¸ƒ 1ã€è§„èŒƒåŒ–åˆ†è¯è¯å…¸ï¼Œå¹¶å»æ‰ä¸€äº›æ— ç”¨è¯ï¼› 2ã€é‡å†™DATï¼ˆåŒæ•°ç»„Trieæ ‘ï¼‰çš„æ„é€ ç®—æ³•ï¼Œç”Ÿæˆçš„DAT sizeå‡å°‘äº†8%å·¦å³ï¼Œä»è€ŒèŠ‚çœäº†å†…å­˜ï¼› 3ã€ä¼˜åŒ–åˆ†è¯ç®—æ³•ï¼Œæé«˜äº†åˆ†è¯é€Ÿç‡ã€‚ 12345&lt;dependency&gt; &lt;groupId&gt;io.github.yizhiru&lt;/groupId&gt; &lt;artifactId&gt;thulac4j&lt;/artifactId&gt; &lt;version&gt;$&#123;thulac4j.version&#125;&lt;/version&gt;&lt;/dependency&gt; http://www.cnblogs.com/en-heng/p/6526598.html thulac4jæ”¯æŒä¸¤ç§åˆ†è¯æ¨¡å¼ï¼š SegOnlyæ¨¡å¼ï¼Œåªåˆ†è¯æ²¡æœ‰è¯æ€§æ ‡æ³¨ï¼› SegPosæ¨¡å¼ï¼Œåˆ†è¯å…¼æœ‰è¯æ€§æ ‡æ³¨ã€‚ 12345678910// SegOnly modeString sentence = \"æ»”æ»”çš„æµæ°´ï¼Œå‘ç€æ³¢å£«é¡¿æ¹¾æ— å£°é€å»\";SegOnly seg = new SegOnly(\"models/seg_only.bin\");System.out.println(seg.segment(sentence));// [æ»”æ»”, çš„, æµæ°´, ï¼Œ, å‘ç€, æ³¢å£«é¡¿æ¹¾, æ— å£°, é€å»]// SegPos modeSegPos pos = new SegPos(\"models/seg_pos.bin\");System.out.println(pos.segment(sentence));//[æ»”æ»”/a, çš„/u, æµæ°´/n, ï¼Œ/w, å‘ç€/p, æ³¢å£«é¡¿æ¹¾/ns, æ— å£°/v, é€å»/v] 4ã€NLPIRä¸­ç§‘é™¢è®¡ç®—æ‰€ NLPIRï¼šhttp://ictclas.nlpir.org/nlpir/ (å¯ç›´æ¥åœ¨çº¿åˆ†æä¸­æ–‡) ä¸‹è½½åœ°å€ï¼šhttps://github.com/NLPIR-team/NLPIR ä¸­ç§‘é™¢åˆ†è¯ç³»ç»Ÿ(NLPIR)JAVAç®€æ˜“æ•™ç¨‹: http://www.cnblogs.com/wukongjiuwo/p/4092480.html 5ã€ansjåˆ†è¯å™¨https://github.com/NLPchina/ansj_seg è¿™æ˜¯ä¸€ä¸ªåŸºäºn-Gram+CRF+HMMçš„ä¸­æ–‡åˆ†è¯çš„javaå®ç°. åˆ†è¯é€Ÿåº¦è¾¾åˆ°æ¯ç§’é’Ÿå¤§çº¦200ä¸‡å­—å·¦å³ï¼ˆmac airä¸‹æµ‹è¯•ï¼‰ï¼Œå‡†ç¡®ç‡èƒ½è¾¾åˆ°96%ä»¥ä¸Š ç›®å‰å®ç°äº†.ä¸­æ–‡åˆ†è¯. ä¸­æ–‡å§“åè¯†åˆ« . ç”¨æˆ·è‡ªå®šä¹‰è¯å…¸,å…³é”®å­—æå–ï¼Œè‡ªåŠ¨æ‘˜è¦ï¼Œå…³é”®å­—æ ‡è®°ç­‰åŠŸèƒ½å¯ä»¥åº”ç”¨åˆ°è‡ªç„¶è¯­è¨€å¤„ç†ç­‰æ–¹é¢,é€‚ç”¨äºå¯¹åˆ†è¯æ•ˆæœè¦æ±‚é«˜çš„å„ç§é¡¹ç›®. maven å¼•å…¥ï¼š 12345&lt;dependency&gt; &lt;groupId&gt;org.ansj&lt;/groupId&gt; &lt;artifactId&gt;ansj_seg&lt;/artifactId&gt; &lt;version&gt;5.1.1&lt;/version&gt;&lt;/dependency&gt; è°ƒç”¨demo 1234String str = \"æ¬¢è¿ä½¿ç”¨ansj_seg,(ansjä¸­æ–‡åˆ†è¯)åœ¨è¿™é‡Œå¦‚æœä½ é‡åˆ°ä»€ä¹ˆé—®é¢˜éƒ½å¯ä»¥è”ç³»æˆ‘.æˆ‘ä¸€å®šå°½æˆ‘æ‰€èƒ½.å¸®åŠ©å¤§å®¶.ansj_segæ›´å¿«,æ›´å‡†,æ›´è‡ªç”±!\" ; System.out.println(ToAnalysis.parse(str)); æ¬¢è¿/v,ä½¿ç”¨/v,ansj/en,_,seg/en,,,(,ansj/en,ä¸­æ–‡/nz,åˆ†è¯/n,),åœ¨/p,è¿™é‡Œ/r,å¦‚æœ/c,ä½ /r,é‡åˆ°/v,ä»€ä¹ˆ/r,é—®é¢˜/n,éƒ½/d,å¯ä»¥/v,è”ç³»/v,æˆ‘/r,./m,æˆ‘/r,ä¸€å®š/d,å°½æˆ‘æ‰€èƒ½/l,./m,å¸®åŠ©/v,å¤§å®¶/r,./m,ansj/en,_,seg/en,æ›´å¿«/d,,,æ›´/d,å‡†/a,,,æ›´/d,è‡ªç”±/a,! 6ã€å“ˆå·¥å¤§çš„LTPhttps://link.zhihu.com/?target=https%3A//github.com/HIT-SCIR/ltp LTPåˆ¶å®šäº†åŸºäºXMLçš„è¯­è¨€å¤„ç†ç»“æœè¡¨ç¤ºï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šæä¾›äº†ä¸€æ•´å¥—è‡ªåº•å‘ä¸Šçš„ä¸°å¯Œè€Œä¸”é«˜æ•ˆçš„ä¸­æ–‡è¯­è¨€å¤„ç†æ¨¡å—ï¼ˆåŒ…æ‹¬è¯æ³•ã€å¥æ³•ã€è¯­ä¹‰ç­‰6é¡¹ä¸­æ–‡å¤„ç†æ ¸å¿ƒæŠ€æœ¯ï¼‰ï¼Œä»¥åŠåŸºäºåŠ¨æ€é“¾æ¥åº“ï¼ˆDynamic Link Library, DLLï¼‰çš„åº”ç”¨ç¨‹åºæ¥å£ã€å¯è§†åŒ–å·¥å…·ï¼Œå¹¶ä¸”èƒ½å¤Ÿä»¥ç½‘ç»œæœåŠ¡ï¼ˆWeb Serviceï¼‰çš„å½¢å¼è¿›è¡Œä½¿ç”¨ã€‚ å…³äºLTPçš„ä½¿ç”¨ï¼Œè¯·å‚è€ƒ: http://ltp.readthedocs.io/zh_CN/latest/ 7ã€åº–ä¸è§£ç‰›ä¸‹è½½åœ°å€ï¼šhttp://pan.baidu.com/s/1eQ88SZS ä½¿ç”¨åˆ†ä¸ºå¦‚ä¸‹å‡ æ­¥ï¼š é…ç½®dicæ–‡ä»¶ï¼šä¿®æ”¹paoding-analysis.jarä¸­çš„paoding-dic-home.propertiesæ–‡ä»¶ï¼Œå°†â€œ#paoding.dic.home=dicâ€çš„æ³¨é‡Šå»æ‰ï¼Œå¹¶é…ç½®æˆè‡ªå·±dicæ–‡ä»¶çš„æœ¬åœ°å­˜æ”¾è·¯å¾„ã€‚egï¼š/home/hadoop/work/paoding-analysis-2.0.4-beta/dic æŠŠJaråŒ…å¯¼å…¥åˆ°é¡¹ç›®ä¸­ï¼šå°†paoding-analysis.jarã€commons-logging.jarã€lucene-analyzers-2.2.0.jarå’Œlucene-core-2.2.0.jarå››ä¸ªåŒ…å¯¼å…¥åˆ°é¡¹ç›®ä¸­ï¼Œè¿™æ—¶å°±å¯ä»¥åœ¨ä»£ç ç‰‡æ®µä¸­ä½¿ç”¨åº–ä¸è§£ç‰›å·¥å…·æä¾›çš„ä¸­æ–‡åˆ†è¯æŠ€æœ¯ï¼Œä¾‹å¦‚ï¼š 123456789101112Analyzer analyzer = new PaodingAnalyzer(); //å®šä¹‰ä¸€ä¸ªè§£æå™¨String text = \"åº–ä¸ç³»ç»Ÿæ˜¯ä¸ªå®Œå…¨åŸºäºluceneçš„ä¸­æ–‡åˆ†è¯ç³»ç»Ÿï¼Œå®ƒå°±æ˜¯é‡æ–°å»ºäº†ä¸€ä¸ªanalyzerï¼Œå«åšPaodingAnalyzerï¼Œè¿™ä¸ªanalyerçš„æ ¸å¿ƒä»»åŠ¡å°±æ˜¯ç”Ÿæˆä¸€ä¸ªå¯ä»¥åˆ‡è¯TokenStreamã€‚\"; &lt;span style=\"font-family: Arial, Helvetica, sans-serif;\"&gt;//å¾…åˆ†è¯çš„å†…å®¹&lt;/span&gt;TokenStream tokenStream = analyzer.tokenStream(text, new StringReader(text)); //å¾—åˆ°tokenåºåˆ—çš„è¾“å‡ºæµtry &#123; Token t; while ((t = tokenStream.next()) != null) &#123; System.out.println(t); //è¾“å‡ºæ¯ä¸ªtoken &#125;&#125; catch (IOException e) &#123; e.printStackTrace();&#125; 8ã€sogoåœ¨çº¿åˆ†è¯sogoåœ¨çº¿åˆ†è¯é‡‡ç”¨äº†åŸºäºæ±‰å­—æ ‡æ³¨çš„åˆ†è¯æ–¹æ³•ï¼Œä¸»è¦ä½¿ç”¨äº†çº¿æ€§é“¾é“¾CRFï¼ˆLinear-chain CRFï¼‰æ¨¡å‹ã€‚è¯æ€§æ ‡æ³¨æ¨¡å—ä¸»è¦åŸºäºç»“æ„åŒ–çº¿æ€§æ¨¡å‹ï¼ˆStructured Linear Modelï¼‰ åœ¨çº¿ä½¿ç”¨åœ°å€ä¸ºï¼šhttp://www.sogou.com/labs/webservice/ 9ã€wordåˆ†è¯åœ°å€ï¼š https://github.com/ysc/word wordåˆ†è¯æ˜¯ä¸€ä¸ªJavaå®ç°çš„åˆ†å¸ƒå¼çš„ä¸­æ–‡åˆ†è¯ç»„ä»¶ï¼Œæä¾›äº†å¤šç§åŸºäºè¯å…¸çš„åˆ†è¯ç®—æ³•ï¼Œå¹¶åˆ©ç”¨ngramæ¨¡å‹æ¥æ¶ˆé™¤æ­§ä¹‰ã€‚èƒ½å‡†ç¡®è¯†åˆ«è‹±æ–‡ã€æ•°å­—ï¼Œä»¥åŠæ—¥æœŸã€æ—¶é—´ç­‰æ•°é‡è¯ï¼Œèƒ½è¯†åˆ«äººåã€åœ°åã€ç»„ç»‡æœºæ„åç­‰æœªç™»å½•è¯ã€‚èƒ½é€šè¿‡è‡ªå®šä¹‰é…ç½®æ–‡ä»¶æ¥æ”¹å˜ç»„ä»¶è¡Œä¸ºï¼Œèƒ½è‡ªå®šä¹‰ç”¨æˆ·è¯åº“ã€è‡ªåŠ¨æ£€æµ‹è¯åº“å˜åŒ–ã€æ”¯æŒå¤§è§„æ¨¡åˆ†å¸ƒå¼ç¯å¢ƒï¼Œèƒ½çµæ´»æŒ‡å®šå¤šç§åˆ†è¯ç®—æ³•ï¼Œèƒ½ä½¿ç”¨refineåŠŸèƒ½çµæ´»æ§åˆ¶åˆ†è¯ç»“æœï¼Œè¿˜èƒ½ä½¿ç”¨è¯é¢‘ç»Ÿè®¡ã€è¯æ€§æ ‡æ³¨ã€åŒä¹‰æ ‡æ³¨ã€åä¹‰æ ‡æ³¨ã€æ‹¼éŸ³æ ‡æ³¨ç­‰åŠŸèƒ½ã€‚æä¾›äº†10ç§åˆ†è¯ç®—æ³•ï¼Œè¿˜æä¾›äº†10ç§æ–‡æœ¬ç›¸ä¼¼åº¦ç®—æ³•ï¼ŒåŒæ—¶è¿˜æ— ç¼å’ŒLuceneã€Solrã€ElasticSearchã€Lukeé›†æˆã€‚æ³¨æ„ï¼šword1.3éœ€è¦JDK1.8 maven ä¸­å¼•å…¥ä¾èµ–ï¼š 1234567&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.apdplat&lt;/groupId&gt; &lt;artifactId&gt;word&lt;/artifactId&gt; &lt;version&gt;1.3&lt;/version&gt; &lt;/dependency&gt;&lt;/dependencies&gt; ElasticSearchæ’ä»¶ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344451ã€æ‰“å¼€å‘½ä»¤è¡Œå¹¶åˆ‡æ¢åˆ°elasticsearchçš„binç›®å½•cd elasticsearch-2.1.1/bin2ã€è¿è¡Œpluginè„šæœ¬å®‰è£…wordåˆ†è¯æ’ä»¶ï¼š./plugin install http://apdplat.org/word/archive/v1.4.zipå®‰è£…çš„æ—¶å€™æ³¨æ„ï¼š å¦‚æœæç¤ºï¼š ERROR: failed to download æˆ–è€… Failed to install word, reason: failed to download æˆ–è€… ERROR: incorrect hash (SHA1) åˆ™é‡æ–°å†æ¬¡è¿è¡Œå‘½ä»¤ï¼Œå¦‚æœè¿˜æ˜¯ä¸è¡Œï¼Œå¤šè¯•ä¸¤æ¬¡å¦‚æœæ˜¯elasticsearch1.xç³»åˆ—ç‰ˆæœ¬ï¼Œåˆ™ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š./plugin -u http://apdplat.org/word/archive/v1.3.1.zip -i word3ã€ä¿®æ”¹æ–‡ä»¶elasticsearch-2.1.1/config/elasticsearch.ymlï¼Œæ–°å¢å¦‚ä¸‹é…ç½®ï¼šindex.analysis.analyzer.default.type : &quot;word&quot;index.analysis.tokenizer.default.type : &quot;word&quot;4ã€å¯åŠ¨ElasticSearchæµ‹è¯•æ•ˆæœï¼Œåœ¨Chromeæµè§ˆå™¨ä¸­è®¿é—®ï¼šhttp://localhost:9200/_analyze?analyzer=word&amp;text=æ¨å°šå·æ˜¯APDPlatåº”ç”¨çº§äº§å“å¼€å‘å¹³å°çš„ä½œè€…5ã€è‡ªå®šä¹‰é…ç½®ä¿®æ”¹é…ç½®æ–‡ä»¶elasticsearch-2.1.1/plugins/word/word.local.conf6ã€æŒ‡å®šåˆ†è¯ç®—æ³•ä¿®æ”¹æ–‡ä»¶elasticsearch-2.1.1/config/elasticsearch.ymlï¼Œæ–°å¢å¦‚ä¸‹é…ç½®ï¼šindex.analysis.analyzer.default.segAlgorithm : &quot;ReverseMinimumMatching&quot;index.analysis.tokenizer.default.segAlgorithm : &quot;ReverseMinimumMatching&quot;è¿™é‡ŒsegAlgorithmå¯æŒ‡å®šçš„å€¼æœ‰ï¼šæ­£å‘æœ€å¤§åŒ¹é…ç®—æ³•ï¼šMaximumMatchingé€†å‘æœ€å¤§åŒ¹é…ç®—æ³•ï¼šReverseMaximumMatchingæ­£å‘æœ€å°åŒ¹é…ç®—æ³•ï¼šMinimumMatchingé€†å‘æœ€å°åŒ¹é…ç®—æ³•ï¼šReverseMinimumMatchingåŒå‘æœ€å¤§åŒ¹é…ç®—æ³•ï¼šBidirectionalMaximumMatchingåŒå‘æœ€å°åŒ¹é…ç®—æ³•ï¼šBidirectionalMinimumMatchingåŒå‘æœ€å¤§æœ€å°åŒ¹é…ç®—æ³•ï¼šBidirectionalMaximumMinimumMatchingå…¨åˆ‡åˆ†ç®—æ³•ï¼šFullSegmentationæœ€å°‘è¯æ•°ç®—æ³•ï¼šMinimalWordCountæœ€å¤§Ngramåˆ†å€¼ç®—æ³•ï¼šMaxNgramScoreå¦‚ä¸æŒ‡å®šï¼Œé»˜è®¤ä½¿ç”¨åŒå‘æœ€å¤§åŒ¹é…ç®—æ³•ï¼šBidirectionalMaximumMatching 10ã€jcsegåˆ†è¯å™¨https://code.google.com/archive/p/jcseg/ 11ã€stanfordåˆ†è¯å™¨Stanfordå¤§å­¦çš„ä¸€ä¸ªå¼€æºåˆ†è¯å·¥å…·ï¼Œç›®å‰å·²æ”¯æŒæ±‰è¯­ã€‚ é¦–å…ˆï¼Œå»ã€1ã€‘ä¸‹è½½Download Stanford Word Segmenter version 3.5.2ï¼Œå–å¾—é‡Œé¢çš„ data æ–‡ä»¶å¤¹ï¼Œæ”¾åœ¨maven projectçš„ src/main/resources é‡Œã€‚ ç„¶åï¼Œmavenä¾èµ–æ·»åŠ ï¼š 123456789101112131415161718192021222324&lt;properties&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;corenlp.version&gt;3.6.0&lt;/corenlp.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;edu.stanford.nlp&lt;/groupId&gt; &lt;artifactId&gt;stanford-corenlp&lt;/artifactId&gt; &lt;version&gt;$&#123;corenlp.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;edu.stanford.nlp&lt;/groupId&gt; &lt;artifactId&gt;stanford-corenlp&lt;/artifactId&gt; &lt;version&gt;$&#123;corenlp.version&#125;&lt;/version&gt; &lt;classifier&gt;models&lt;/classifier&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;edu.stanford.nlp&lt;/groupId&gt; &lt;artifactId&gt;stanford-corenlp&lt;/artifactId&gt; &lt;version&gt;$&#123;corenlp.version&#125;&lt;/version&gt; &lt;classifier&gt;models-chinese&lt;/classifier&gt; &lt;/dependency&gt; &lt;/dependencies&gt; æµ‹è¯•ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243import java.util.Properties;import edu.stanford.nlp.ie.crf.CRFClassifier;public class CoreNLPSegment &#123; private static CoreNLPSegment instance; private CRFClassifier classifier; private CoreNLPSegment()&#123; Properties props = new Properties(); props.setProperty(\"sighanCorporaDict\", \"data\"); props.setProperty(\"serDictionary\", \"data/dict-chris6.ser.gz\"); props.setProperty(\"inputEncoding\", \"UTF-8\"); props.setProperty(\"sighanPostProcessing\", \"true\"); classifier = new CRFClassifier(props); classifier.loadClassifierNoExceptions(\"data/ctb.gz\", props); classifier.flags.setProperties(props); &#125; public static CoreNLPSegment getInstance() &#123; if (instance == null) &#123; instance = new CoreNLPSegment(); &#125; return instance; &#125; public String[] doSegment(String data) &#123; return (String[]) classifier.segmentString(data).toArray(); &#125; public static void main(String[] args) &#123; String sentence = \"ä»–å’Œæˆ‘åœ¨å­¦æ ¡é‡Œå¸¸æ‰“æ¡Œçƒã€‚\"; String ret[] = CoreNLPSegment.getInstance().doSegment(sentence); for (String str : ret) &#123; System.out.println(str); &#125; &#125;&#125; åšå®¢ï¼š https://blog.sectong.com/blog/corenlp_segment.html http://blog.csdn.net/lightty/article/details/51766602 12ã€SmartcnSmartcnä¸ºApache2.0åè®®çš„å¼€æºä¸­æ–‡åˆ†è¯ç³»ç»Ÿï¼ŒJavaè¯­è¨€ç¼–å†™ï¼Œä¿®æ”¹çš„ä¸­ç§‘é™¢è®¡ç®—æ‰€ICTCLASåˆ†è¯ç³»ç»Ÿã€‚å¾ˆæ—©ä»¥å‰çœ‹åˆ°Luceneä¸Šå¤šäº†ä¸€ä¸ªä¸­æ–‡åˆ†è¯çš„contributionï¼Œå½“æ—¶åªæ˜¯ç®€å•çš„æ‰«äº†ä¸€ä¸‹.classæ–‡ä»¶çš„æ–‡ä»¶åï¼Œé€šè¿‡æ–‡ä»¶åå¯ä»¥çœ‹å¾—å‡ºåˆæ˜¯ä¸€ä¸ªæ”¹çš„ICTCLASçš„åˆ†è¯ç³»ç»Ÿã€‚ http://lucene.apache.org/core/5_1_0/analyzers-smartcn/org/apache/lucene/analysis/cn/smart/SmartChineseAnalyzer.html 13ã€pinyin åˆ†è¯å™¨pinyinåˆ†è¯å™¨å¯ä»¥è®©ç”¨æˆ·è¾“å…¥æ‹¼éŸ³ï¼Œå°±èƒ½æŸ¥æ‰¾åˆ°ç›¸å…³çš„å…³é”®è¯ã€‚æ¯”å¦‚åœ¨æŸä¸ªå•†åŸæœç´¢ä¸­ï¼Œè¾“å…¥ yonghuiï¼Œå°±èƒ½åŒ¹é…åˆ° æ°¸è¾‰ã€‚è¿™æ ·çš„ä½“éªŒè¿˜æ˜¯éå¸¸å¥½çš„ã€‚ pinyinåˆ†è¯å™¨çš„å®‰è£…ä¸IKæ˜¯ä¸€æ ·çš„ã€‚ä¸‹è½½åœ°å€ï¼šhttps://github.com/medcl/elasticsearch-analysis-pinyin ä¸€äº›å‚æ•°è¯·å‚è€ƒ GitHub çš„ readme æ–‡æ¡£ã€‚ è¿™ä¸ªåˆ†è¯å™¨åœ¨1.8ç‰ˆæœ¬ä¸­ï¼Œæä¾›äº†ä¸¤ç§åˆ†è¯è§„åˆ™ï¼š pinyin,å°±æ˜¯æ™®é€šçš„æŠŠæ±‰å­—è½¬æ¢æˆæ‹¼éŸ³ï¼› pinyin_first_letterï¼Œæå–æ±‰å­—çš„æ‹¼éŸ³é¦–å­—æ¯ ä½¿ç”¨ï¼š 1.Create a index with custom pinyin analyzer 1234567891011121314151617181920212223curl -XPUT http://localhost:9200/medcl/ -d&apos;&#123; &quot;index&quot; : &#123; &quot;analysis&quot; : &#123; &quot;analyzer&quot; : &#123; &quot;pinyin_analyzer&quot; : &#123; &quot;tokenizer&quot; : &quot;my_pinyin&quot; &#125; &#125;, &quot;tokenizer&quot; : &#123; &quot;my_pinyin&quot; : &#123; &quot;type&quot; : &quot;pinyin&quot;, &quot;keep_separate_first_letter&quot; : false, &quot;keep_full_pinyin&quot; : true, &quot;keep_original&quot; : true, &quot;limit_first_letter_length&quot; : 16, &quot;lowercase&quot; : true, &quot;remove_duplicated_term&quot; : true &#125; &#125; &#125; &#125;&#125;&apos; 2.Test Analyzer, analyzing a chinese name, such as åˆ˜å¾·å 1http://localhost:9200/medcl/_analyze?text=%e5%88%98%e5%be%b7%e5%8d%8e&amp;analyzer=pinyin_analyzer 123456789101112131415161718192021222324252627282930313233343536373839&#123; &quot;tokens&quot; : [ &#123; &quot;token&quot; : &quot;liu&quot;, &quot;start_offset&quot; : 0, &quot;end_offset&quot; : 1, &quot;type&quot; : &quot;word&quot;, &quot;position&quot; : 0 &#125;, &#123; &quot;token&quot; : &quot;de&quot;, &quot;start_offset&quot; : 1, &quot;end_offset&quot; : 2, &quot;type&quot; : &quot;word&quot;, &quot;position&quot; : 1 &#125;, &#123; &quot;token&quot; : &quot;hua&quot;, &quot;start_offset&quot; : 2, &quot;end_offset&quot; : 3, &quot;type&quot; : &quot;word&quot;, &quot;position&quot; : 2 &#125;, &#123; &quot;token&quot; : &quot;åˆ˜å¾·å&quot;, &quot;start_offset&quot; : 0, &quot;end_offset&quot; : 3, &quot;type&quot; : &quot;word&quot;, &quot;position&quot; : 3 &#125;, &#123; &quot;token&quot; : &quot;ldh&quot;, &quot;start_offset&quot; : 0, &quot;end_offset&quot; : 3, &quot;type&quot; : &quot;word&quot;, &quot;position&quot; : 4 &#125; ]&#125; 3.Create mapping 12345678910111213141516171819curl -XPOST http://localhost:9200/medcl/folks/_mapping -d&apos;&#123; &quot;folks&quot;: &#123; &quot;properties&quot;: &#123; &quot;name&quot;: &#123; &quot;type&quot;: &quot;keyword&quot;, &quot;fields&quot;: &#123; &quot;pinyin&quot;: &#123; &quot;type&quot;: &quot;text&quot;, &quot;store&quot;: &quot;no&quot;, &quot;term_vector&quot;: &quot;with_offsets&quot;, &quot;analyzer&quot;: &quot;pinyin_analyzer&quot;, &quot;boost&quot;: 10 &#125; &#125; &#125; &#125; &#125;&#125;&apos; 4.Indexing 1curl -XPOST http://localhost:9200/medcl/folks/andy -d&apos;&#123;&quot;name&quot;:&quot;åˆ˜å¾·å&quot;&#125;&apos; 5.Letâ€™s search 12345http://localhost:9200/medcl/folks/_search?q=name:%E5%88%98%E5%BE%B7%E5%8D%8Ecurl http://localhost:9200/medcl/folks/_search?q=name.pinyin:%e5%88%98%e5%be%b7curl http://localhost:9200/medcl/folks/_search?q=name.pinyin:liucurl http://localhost:9200/medcl/folks/_search?q=name.pinyin:ldhcurl http://localhost:9200/medcl/folks/_search?q=name.pinyin:de+hua 6.Using Pinyin-TokenFilter 123456789101112131415161718192021222324252627curl -XPUT http://localhost:9200/medcl1/ -d&apos;&#123; &quot;index&quot; : &#123; &quot;analysis&quot; : &#123; &quot;analyzer&quot; : &#123; &quot;user_name_analyzer&quot; : &#123; &quot;tokenizer&quot; : &quot;whitespace&quot;, &quot;filter&quot; : &quot;pinyin_first_letter_and_full_pinyin_filter&quot; &#125; &#125;, &quot;filter&quot; : &#123; &quot;pinyin_first_letter_and_full_pinyin_filter&quot; : &#123; &quot;type&quot; : &quot;pinyin&quot;, &quot;keep_first_letter&quot; : true, &quot;keep_full_pinyin&quot; : false, &quot;keep_none_chinese&quot; : true, &quot;keep_original&quot; : false, &quot;limit_first_letter_length&quot; : 16, &quot;lowercase&quot; : true, &quot;trim_whitespace&quot; : true, &quot;keep_none_chinese_in_first_letter&quot; : true &#125; &#125; &#125; &#125;&#125;&apos; Token Test:åˆ˜å¾·å å¼ å­¦å‹ éƒ­å¯ŒåŸ é»æ˜ å››å¤§å¤©ç‹ 1curl -XGET http://localhost:9200/medcl1/_analyze?text=%e5%88%98%e5%be%b7%e5%8d%8e+%e5%bc%a0%e5%ad%a6%e5%8f%8b+%e9%83%ad%e5%af%8c%e5%9f%8e+%e9%bb%8e%e6%98%8e+%e5%9b%9b%e5%a4%a7%e5%a4%a9%e7%8e%8b&amp;analyzer=user_name_analyzer 12345678910111213141516171819202122232425262728293031323334353637383940&#123; &quot;tokens&quot; : [ &#123; &quot;token&quot; : &quot;ldh&quot;, &quot;start_offset&quot; : 0, &quot;end_offset&quot; : 3, &quot;type&quot; : &quot;word&quot;, &quot;position&quot; : 0 &#125;, &#123; &quot;token&quot; : &quot;zxy&quot;, &quot;start_offset&quot; : 4, &quot;end_offset&quot; : 7, &quot;type&quot; : &quot;word&quot;, &quot;position&quot; : 1 &#125;, &#123; &quot;token&quot; : &quot;gfc&quot;, &quot;start_offset&quot; : 8, &quot;end_offset&quot; : 11, &quot;type&quot; : &quot;word&quot;, &quot;position&quot; : 2 &#125;, &#123; &quot;token&quot; : &quot;lm&quot;, &quot;start_offset&quot; : 12, &quot;end_offset&quot; : 14, &quot;type&quot; : &quot;word&quot;, &quot;position&quot; : 3 &#125;, &#123; &quot;token&quot; : &quot;sdtw&quot;, &quot;start_offset&quot; : 15, &quot;end_offset&quot; : 19, &quot;type&quot; : &quot;word&quot;, &quot;position&quot; : 4 &#125; ]&#125; 7.Used in phrase query (1)ã€ 123456789101112131415161718192021222324252627282930PUT /medcl/ &#123; &quot;index&quot; : &#123; &quot;analysis&quot; : &#123; &quot;analyzer&quot; : &#123; &quot;pinyin_analyzer&quot; : &#123; &quot;tokenizer&quot; : &quot;my_pinyin&quot; &#125; &#125;, &quot;tokenizer&quot; : &#123; &quot;my_pinyin&quot; : &#123; &quot;type&quot; : &quot;pinyin&quot;, &quot;keep_first_letter&quot;:false, &quot;keep_separate_first_letter&quot; : false, &quot;keep_full_pinyin&quot; : true, &quot;keep_original&quot; : false, &quot;limit_first_letter_length&quot; : 16, &quot;lowercase&quot; : true &#125; &#125; &#125; &#125; &#125; GET /medcl/folks/_search &#123; &quot;query&quot;: &#123;&quot;match_phrase&quot;: &#123; &quot;name.pinyin&quot;: &quot;åˆ˜å¾·å&quot; &#125;&#125; &#125; (2)ã€ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647PUT /medcl/ &#123; &quot;index&quot; : &#123; &quot;analysis&quot; : &#123; &quot;analyzer&quot; : &#123; &quot;pinyin_analyzer&quot; : &#123; &quot;tokenizer&quot; : &quot;my_pinyin&quot; &#125; &#125;, &quot;tokenizer&quot; : &#123; &quot;my_pinyin&quot; : &#123; &quot;type&quot; : &quot;pinyin&quot;, &quot;keep_first_letter&quot;:false, &quot;keep_separate_first_letter&quot; : true, &quot;keep_full_pinyin&quot; : false, &quot;keep_original&quot; : false, &quot;limit_first_letter_length&quot; : 16, &quot;lowercase&quot; : true &#125; &#125; &#125; &#125; &#125; POST /medcl/folks/andy &#123;&quot;name&quot;:&quot;åˆ˜å¾·å&quot;&#125; GET /medcl/folks/_search &#123; &quot;query&quot;: &#123;&quot;match_phrase&quot;: &#123; &quot;name.pinyin&quot;: &quot;åˆ˜å¾·h&quot; &#125;&#125; &#125; GET /medcl/folks/_search &#123; &quot;query&quot;: &#123;&quot;match_phrase&quot;: &#123; &quot;name.pinyin&quot;: &quot;åˆ˜dh&quot; &#125;&#125; &#125; GET /medcl/folks/_search &#123; &quot;query&quot;: &#123;&quot;match_phrase&quot;: &#123; &quot;name.pinyin&quot;: &quot;dh&quot; &#125;&#125; &#125; 14ã€Mmseg åˆ†è¯å™¨ä¹Ÿæ”¯æŒ Elasticsearch ä¸‹è½½åœ°å€ï¼šhttps://github.com/medcl/elasticsearch-analysis-mmseg/releases æ ¹æ®å¯¹åº”çš„ç‰ˆæœ¬è¿›è¡Œä¸‹è½½ å¦‚ä½•ä½¿ç”¨ï¼š 1ã€åˆ›å»ºç´¢å¼•ï¼š 1curl -XPUT http://localhost:9200/index 2ã€åˆ›å»º mapping 123456789101112curl -XPOST http://localhost:9200/index/fulltext/_mapping -d&apos;&#123; &quot;properties&quot;: &#123; &quot;content&quot;: &#123; &quot;type&quot;: &quot;text&quot;, &quot;term_vector&quot;: &quot;with_positions_offsets&quot;, &quot;analyzer&quot;: &quot;mmseg_maxword&quot;, &quot;search_analyzer&quot;: &quot;mmseg_maxword&quot; &#125; &#125;&#125;&apos; 3.Indexing some docs 123456789101112131415curl -XPOST http://localhost:9200/index/fulltext/1 -d&apos;&#123;&quot;content&quot;:&quot;ç¾å›½ç•™ç»™ä¼Šæ‹‰å…‹çš„æ˜¯ä¸ªçƒ‚æ‘Šå­å—&quot;&#125;&apos;curl -XPOST http://localhost:9200/index/fulltext/2 -d&apos;&#123;&quot;content&quot;:&quot;å…¬å®‰éƒ¨ï¼šå„åœ°æ ¡è½¦å°†äº«æœ€é«˜è·¯æƒ&quot;&#125;&apos;curl -XPOST http://localhost:9200/index/fulltext/3 -d&apos;&#123;&quot;content&quot;:&quot;ä¸­éŸ©æ¸”è­¦å†²çªè°ƒæŸ¥ï¼šéŸ©è­¦å¹³å‡æ¯å¤©æ‰£1è‰˜ä¸­å›½æ¸”èˆ¹&quot;&#125;&apos;curl -XPOST http://localhost:9200/index/fulltext/4 -d&apos;&#123;&quot;content&quot;:&quot;ä¸­å›½é©»æ´›æ‰çŸ¶é¢†äº‹é¦†é­äºšè£”ç”·å­æªå‡» å«ŒçŠ¯å·²è‡ªé¦–&quot;&#125;&apos; 4.Query with highlighting(æŸ¥è¯¢é«˜äº®) 123456789101112curl -XPOST http://localhost:9200/index/fulltext/_search -d&apos;&#123; &quot;query&quot; : &#123; &quot;term&quot; : &#123; &quot;content&quot; : &quot;ä¸­å›½&quot; &#125;&#125;, &quot;highlight&quot; : &#123; &quot;pre_tags&quot; : [&quot;&lt;tag1&gt;&quot;, &quot;&lt;tag2&gt;&quot;], &quot;post_tags&quot; : [&quot;&lt;/tag1&gt;&quot;, &quot;&lt;/tag2&gt;&quot;], &quot;fields&quot; : &#123; &quot;content&quot; : &#123;&#125; &#125; &#125;&#125;&apos; 5ã€ç»“æœï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243&#123; &quot;took&quot;: 14, &quot;timed_out&quot;: false, &quot;_shards&quot;: &#123; &quot;total&quot;: 5, &quot;successful&quot;: 5, &quot;failed&quot;: 0 &#125;, &quot;hits&quot;: &#123; &quot;total&quot;: 2, &quot;max_score&quot;: 2, &quot;hits&quot;: [ &#123; &quot;_index&quot;: &quot;index&quot;, &quot;_type&quot;: &quot;fulltext&quot;, &quot;_id&quot;: &quot;4&quot;, &quot;_score&quot;: 2, &quot;_source&quot;: &#123; &quot;content&quot;: &quot;ä¸­å›½é©»æ´›æ‰çŸ¶é¢†äº‹é¦†é­äºšè£”ç”·å­æªå‡» å«ŒçŠ¯å·²è‡ªé¦–&quot; &#125;, &quot;highlight&quot;: &#123; &quot;content&quot;: [ &quot;&lt;tag1&gt;ä¸­å›½&lt;/tag1&gt;é©»æ´›æ‰çŸ¶é¢†äº‹é¦†é­äºšè£”ç”·å­æªå‡» å«ŒçŠ¯å·²è‡ªé¦– &quot; ] &#125; &#125;, &#123; &quot;_index&quot;: &quot;index&quot;, &quot;_type&quot;: &quot;fulltext&quot;, &quot;_id&quot;: &quot;3&quot;, &quot;_score&quot;: 2, &quot;_source&quot;: &#123; &quot;content&quot;: &quot;ä¸­éŸ©æ¸”è­¦å†²çªè°ƒæŸ¥ï¼šéŸ©è­¦å¹³å‡æ¯å¤©æ‰£1è‰˜ä¸­å›½æ¸”èˆ¹&quot; &#125;, &quot;highlight&quot;: &#123; &quot;content&quot;: [ &quot;å‡æ¯å¤©æ‰£1è‰˜&lt;tag1&gt;ä¸­å›½&lt;/tag1&gt;æ¸”èˆ¹ &quot; ] &#125; &#125; ] &#125;&#125; å‚è€ƒåšå®¢ï¼š ä¸ºelasticæ·»åŠ ä¸­æ–‡åˆ†è¯: http://blog.csdn.net/dingzfang/article/details/42776693 15ã€bosonnlp ï¼ˆç»æ£®æ•°æ®ä¸­æ–‡åˆ†æå™¨ï¼‰ä¸‹è½½åœ°å€ï¼šhttps://github.com/bosondata/elasticsearch-analysis-bosonnlp å¦‚ä½•ä½¿ç”¨ï¼š è¿è¡Œ ElasticSearch ä¹‹å‰éœ€è¦åœ¨ config æ–‡ä»¶å¤¹ä¸­ä¿®æ”¹ elasticsearch.yml æ¥å®šä¹‰ä½¿ç”¨ç»æ£®ä¸­æ–‡åˆ†æå™¨ï¼Œå¹¶å¡«å†™ç»æ£® API_TOKEN ä»¥åŠç»æ£®åˆ†è¯ API çš„åœ°å€ï¼Œå³åœ¨è¯¥æ–‡ä»¶ç»“å°¾å¤„æ·»åŠ ï¼š 12345678910111213141516171819202122index: analysis: analyzer: bosonnlp: type: bosonnlp API_URL: http://api.bosonnlp.com/tag/analysis # You MUST give the API_TOKEN value, otherwise it doesn&apos;t work API_TOKEN: *PUT YOUR API TOKEN HERE* # Please uncomment if you want to specify ANY ONE of the following # areguments, otherwise the DEFAULT value will be used, i.e., # space_mode is 0, # oov_level is 3, # t2s is 0, # special_char_conv is 0. # More detials can be found in bosonnlp docs: # http://docs.bosonnlp.com/tag.html # # # space_mode: put your value here(range from 0-3) # oov_level: put your value here(range from 0-4) # t2s: put your value here(range from 0-1) # special_char_conv: put your value here(range from 0-1) éœ€è¦æ³¨æ„çš„æ˜¯ å¿…é¡»åœ¨ API_URL å¡«å†™ç»™å®šçš„åˆ†è¯åœ°å€ä»¥åŠåœ¨API_TOKENï¼šPUT YOUR API TOKEN HERE ä¸­å¡«å†™ç»™å®šçš„ç»æ£®æ•°æ®API_TOKENï¼Œå¦åˆ™æ— æ³•ä½¿ç”¨ç»æ£®ä¸­æ–‡åˆ†æå™¨ã€‚è¯¥ API_TOKEN æ˜¯æ³¨å†Œç»æ£®æ•°æ®è´¦å·æ‰€è·å¾—ã€‚ å¦‚æœé…ç½®æ–‡ä»¶ä¸­å·²ç»æœ‰é…ç½®è¿‡å…¶ä»–çš„ analyzerï¼Œè¯·ç›´æ¥åœ¨ analyzer ä¸‹å¦‚ä¸Šæ·»åŠ  bosonnlp analyzerã€‚ å¦‚æœæœ‰å¤šä¸ª node å¹¶ä¸”éƒ½éœ€è¦ BosonNLP çš„åˆ†è¯æ’ä»¶ï¼Œåˆ™æ¯ä¸ª node ä¸‹çš„ yaml æ–‡ä»¶éƒ½éœ€è¦å¦‚ä¸Šå®‰è£…å’Œè®¾ç½®ã€‚ å¦å¤–ï¼Œç»æ£®ä¸­æ–‡åˆ†è¯è¿˜æä¾›äº†4ä¸ªå‚æ•°ï¼ˆspace_modeï¼Œoov_levelï¼Œt2sï¼Œspecial_char_convï¼‰å¯æ»¡è¶³ä¸åŒçš„åˆ†è¯éœ€æ±‚ã€‚å¦‚æœå–é»˜è®¤å€¼ï¼Œåˆ™æ— éœ€ä»»ä½•ä¿®æ”¹ï¼›å¦åˆ™ï¼Œå¯å–æ¶ˆå¯¹åº”å‚æ•°çš„æ³¨é‡Šå¹¶èµ‹å€¼ã€‚ æµ‹è¯•ï¼š å»ºç«‹ index 1curl -XPUT &apos;localhost:9200/test&apos; æµ‹è¯•åˆ†æå™¨æ˜¯å¦é…ç½®æˆåŠŸ 1curl -XGET &apos;localhost:9200/test/_analyze?analyzer=bosonnlp&amp;pretty&apos; -d &apos;è¿™æ˜¯ç»æ£®æ•°æ®åˆ†è¯çš„æµ‹è¯•&apos; ç»“æœ 123456789101112131415161718192021222324252627282930313233343536373839404142434445&#123; &quot;tokens&quot; : [ &#123; &quot;token&quot; : &quot;è¿™&quot;, &quot;start_offset&quot; : 0, &quot;end_offset&quot; : 1, &quot;type&quot; : &quot;word&quot;, &quot;position&quot; : 0 &#125;, &#123; &quot;token&quot; : &quot;æ˜¯&quot;, &quot;start_offset&quot; : 1, &quot;end_offset&quot; : 2, &quot;type&quot; : &quot;word&quot;, &quot;position&quot; : 1 &#125;, &#123; &quot;token&quot; : &quot;ç»æ£®&quot;, &quot;start_offset&quot; : 2, &quot;end_offset&quot; : 4, &quot;type&quot; : &quot;word&quot;, &quot;position&quot; : 2 &#125;, &#123; &quot;token&quot; : &quot;æ•°æ®&quot;, &quot;start_offset&quot; : 4, &quot;end_offset&quot; : 6, &quot;type&quot; : &quot;word&quot;, &quot;position&quot; : 3 &#125;, &#123; &quot;token&quot; : &quot;åˆ†è¯&quot;, &quot;start_offset&quot; : 6, &quot;end_offset&quot; : 8, &quot;type&quot; : &quot;word&quot;, &quot;position&quot; : 4 &#125;, &#123; &quot;token&quot; : &quot;çš„&quot;, &quot;start_offset&quot; : 8, &quot;end_offset&quot; : 9, &quot;type&quot; : &quot;word&quot;, &quot;position&quot; : 5 &#125;, &#123; &quot;token&quot; : &quot;æµ‹è¯•&quot;, &quot;start_offset&quot; : 9, &quot;end_offset&quot; : 11, &quot;type&quot; : &quot;word&quot;, &quot;position&quot; : 6 &#125; ]&#125; é…ç½® Token Filter ç°æœ‰çš„ BosonNLP åˆ†æå™¨æ²¡æœ‰å†…ç½® token filterï¼Œå¦‚æœæœ‰è¿‡æ»¤ Token çš„éœ€æ±‚ï¼Œå¯ä»¥åˆ©ç”¨ BosonNLP Tokenizer å’Œ ES æä¾›çš„ token filter æ­å»ºå®šåˆ¶åˆ†æå™¨ã€‚ æ­¥éª¤ é…ç½®å®šåˆ¶çš„ analyzer æœ‰ä»¥ä¸‹ä¸‰ä¸ªæ­¥éª¤ï¼š æ·»åŠ  BosonNLP tokenizeråœ¨ elasticsearch.yml æ–‡ä»¶ä¸­ analysis ä¸‹æ·»åŠ  tokenizerï¼Œ å¹¶åœ¨ tokenizer ä¸­æ·»åŠ  BosonNLP tokenizer çš„é…ç½®ï¼š 123456789101112131415161718192021222324index: analysis: analyzer: ... tokenizer: bosonnlp: type: bosonnlp API_URL: http://api.bosonnlp.com/tag/analysis # You MUST give the API_TOKEN value, otherwise it doesn&apos;t work API_TOKEN: *PUT YOUR API TOKEN HERE* # Please uncomment if you want to specify ANY ONE of the following # areguments, otherwise the DEFAULT value will be used, i.e., # space_mode is 0, # oov_level is 3, # t2s is 0, # special_char_conv is 0. # More detials can be found in bosonnlp docs: # http://docs.bosonnlp.com/tag.html # # # space_mode: put your value here(range from 0-3) # oov_level: put your value here(range from 0-4) # t2s: put your value here(range from 0-1) # special_char_conv: put your value here(range from 0-1) æ·»åŠ  token filter åœ¨ elasticsearch.yml æ–‡ä»¶ä¸­ analysis ä¸‹æ·»åŠ  filterï¼Œ å¹¶åœ¨ filter ä¸­æ·»åŠ æ‰€éœ€ filter çš„é…ç½®ï¼ˆä¸‹é¢ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä»¥ lowercase filter ä¸ºä¾‹ï¼‰ï¼š 123456789index: analysis: analyzer: ... tokenizer: ... filter: lowercase: type: lowercase æ·»åŠ å®šåˆ¶çš„ analyzer åœ¨ elasticsearch.yml æ–‡ä»¶ä¸­ analysis ä¸‹æ·»åŠ  analyzerï¼Œ å¹¶åœ¨ analyzer ä¸­æ·»åŠ å®šåˆ¶çš„ analyzer çš„é…ç½®ï¼ˆä¸‹é¢ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æŠŠå®šåˆ¶çš„ analyzer å‘½åä¸º filter_bosonnlpï¼‰ï¼š 12345678index: analysis: analyzer: ... filter_bosonnlp: type: custom tokenizer: bosonnlp filter: [lowercase] è‡ªå®šä¹‰åˆ†è¯å™¨è™½ç„¶Elasticsearchå¸¦æœ‰ä¸€äº›ç°æˆçš„åˆ†æå™¨ï¼Œç„¶è€Œåœ¨åˆ†æå™¨ä¸ŠElasticsearchçœŸæ­£çš„å¼ºå¤§ä¹‹å¤„åœ¨äºï¼Œä½ å¯ä»¥é€šè¿‡åœ¨ä¸€ä¸ªé€‚åˆä½ çš„ç‰¹å®šæ•°æ®çš„è®¾ç½®ä¹‹ä¸­ç»„åˆå­—ç¬¦è¿‡æ»¤å™¨ã€åˆ†è¯å™¨ã€è¯æ±‡å•å…ƒè¿‡æ»¤å™¨æ¥åˆ›å»ºè‡ªå®šä¹‰çš„åˆ†æå™¨ã€‚ å­—ç¬¦è¿‡æ»¤å™¨ï¼š å­—ç¬¦è¿‡æ»¤å™¨ ç”¨æ¥ æ•´ç† ä¸€ä¸ªå°šæœªè¢«åˆ†è¯çš„å­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬çš„æ–‡æœ¬æ˜¯HTMLæ ¼å¼çš„ï¼Œå®ƒä¼šåŒ…å«åƒ &lt;p&gt; æˆ–è€… &lt;div&gt; è¿™æ ·çš„HTMLæ ‡ç­¾ï¼Œè¿™äº›æ ‡ç­¾æ˜¯æˆ‘ä»¬ä¸æƒ³ç´¢å¼•çš„ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ htmlæ¸…é™¤ å­—ç¬¦è¿‡æ»¤å™¨ æ¥ç§»é™¤æ‰æ‰€æœ‰çš„HTMLæ ‡ç­¾ï¼Œå¹¶ä¸”åƒæŠŠ &amp;Aacute; è½¬æ¢ä¸ºç›¸å¯¹åº”çš„Unicodeå­—ç¬¦ Ã è¿™æ ·ï¼Œè½¬æ¢HTMLå®ä½“ã€‚ ä¸€ä¸ªåˆ†æå™¨å¯èƒ½æœ‰0ä¸ªæˆ–è€…å¤šä¸ªå­—ç¬¦è¿‡æ»¤å™¨ã€‚ åˆ†è¯å™¨: ä¸€ä¸ªåˆ†æå™¨ å¿…é¡» æœ‰ä¸€ä¸ªå”¯ä¸€çš„åˆ†è¯å™¨ã€‚ åˆ†è¯å™¨æŠŠå­—ç¬¦ä¸²åˆ†è§£æˆå•ä¸ªè¯æ¡æˆ–è€…è¯æ±‡å•å…ƒã€‚ æ ‡å‡† åˆ†æå™¨é‡Œä½¿ç”¨çš„ æ ‡å‡† åˆ†è¯å™¨ æŠŠä¸€ä¸ªå­—ç¬¦ä¸²æ ¹æ®å•è¯è¾¹ç•Œåˆ†è§£æˆå•ä¸ªè¯æ¡ï¼Œå¹¶ä¸”ç§»é™¤æ‰å¤§éƒ¨åˆ†çš„æ ‡ç‚¹ç¬¦å·ï¼Œç„¶è€Œè¿˜æœ‰å…¶ä»–ä¸åŒè¡Œä¸ºçš„åˆ†è¯å™¨å­˜åœ¨ã€‚ è¯å•å…ƒè¿‡æ»¤å™¨: ç»è¿‡åˆ†è¯ï¼Œä½œä¸ºç»“æœçš„ è¯å•å…ƒæµ ä¼šæŒ‰ç…§æŒ‡å®šçš„é¡ºåºé€šè¿‡æŒ‡å®šçš„è¯å•å…ƒè¿‡æ»¤å™¨ ã€‚ è¯å•å…ƒè¿‡æ»¤å™¨å¯ä»¥ä¿®æ”¹ã€æ·»åŠ æˆ–è€…ç§»é™¤è¯å•å…ƒã€‚æˆ‘ä»¬å·²ç»æåˆ°è¿‡ lowercase å’Œ stop è¯è¿‡æ»¤å™¨ ï¼Œä½†æ˜¯åœ¨ Elasticsearch é‡Œé¢è¿˜æœ‰å¾ˆå¤šå¯ä¾›é€‰æ‹©çš„è¯å•å…ƒè¿‡æ»¤å™¨ã€‚ è¯å¹²è¿‡æ»¤å™¨ æŠŠå•è¯ éåˆ¶ ä¸º è¯å¹²ã€‚ ascii_folding è¿‡æ»¤å™¨ç§»é™¤å˜éŸ³ç¬¦ï¼ŒæŠŠä¸€ä¸ªåƒ â€œtrÃ¨sâ€ è¿™æ ·çš„è¯è½¬æ¢ä¸º â€œtresâ€ ã€‚ ngram å’Œ edge_ngram è¯å•å…ƒè¿‡æ»¤å™¨ å¯ä»¥äº§ç”Ÿ é€‚åˆç”¨äºéƒ¨åˆ†åŒ¹é…æˆ–è€…è‡ªåŠ¨è¡¥å…¨çš„è¯å•å…ƒã€‚ åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰åˆ†æå™¨æˆ‘ä»¬å¯ä»¥åœ¨ analysis ä¸‹çš„ç›¸åº”ä½ç½®è®¾ç½®å­—ç¬¦è¿‡æ»¤å™¨ã€åˆ†è¯å™¨å’Œè¯å•å…ƒè¿‡æ»¤å™¨: 1234567891011PUT /my_index&#123; &quot;settings&quot;: &#123; &quot;analysis&quot;: &#123; &quot;char_filter&quot;: &#123; ... custom character filters ... &#125;, &quot;tokenizer&quot;: &#123; ... custom tokenizers ... &#125;, &quot;filter&quot;: &#123; ... custom token filters ... &#125;, &quot;analyzer&quot;: &#123; ... custom analyzers ... &#125; &#125; &#125;&#125; è¿™ä¸ªåˆ†æå™¨å¯ä»¥åšåˆ°ä¸‹é¢çš„è¿™äº›äº‹: 1ã€ä½¿ç”¨ htmlæ¸…é™¤ å­—ç¬¦è¿‡æ»¤å™¨ç§»é™¤HTMLéƒ¨åˆ†ã€‚ 2ã€ä½¿ç”¨ä¸€ä¸ªè‡ªå®šä¹‰çš„ æ˜ å°„ å­—ç¬¦è¿‡æ»¤å™¨æŠŠ &amp; æ›¿æ¢ä¸º â€œå’Œâ€ ï¼š 123456&quot;char_filter&quot;: &#123; &quot;&amp;_to_and&quot;: &#123; &quot;type&quot;: &quot;mapping&quot;, &quot;mappings&quot;: [ &quot;&amp;=&gt; and &quot;] &#125;&#125; 3ã€ä½¿ç”¨ æ ‡å‡† åˆ†è¯å™¨åˆ†è¯ã€‚ 4ã€å°å†™è¯æ¡ï¼Œä½¿ç”¨ å°å†™ è¯è¿‡æ»¤å™¨å¤„ç†ã€‚ 5ã€ä½¿ç”¨è‡ªå®šä¹‰ åœæ­¢ è¯è¿‡æ»¤å™¨ç§»é™¤è‡ªå®šä¹‰çš„åœæ­¢è¯åˆ—è¡¨ä¸­åŒ…å«çš„è¯ï¼š 123456&quot;filter&quot;: &#123; &quot;my_stopwords&quot;: &#123; &quot;type&quot;: &quot;stop&quot;, &quot;stopwords&quot;: [ &quot;the&quot;, &quot;a&quot; ] &#125;&#125; æˆ‘ä»¬çš„åˆ†æå™¨å®šä¹‰ç”¨æˆ‘ä»¬ä¹‹å‰å·²ç»è®¾ç½®å¥½çš„è‡ªå®šä¹‰è¿‡æ»¤å™¨ç»„åˆäº†å·²ç»å®šä¹‰å¥½çš„åˆ†è¯å™¨å’Œè¿‡æ»¤å™¨ï¼š 12345678&quot;analyzer&quot;: &#123; &quot;my_analyzer&quot;: &#123; &quot;type&quot;: &quot;custom&quot;, &quot;char_filter&quot;: [ &quot;html_strip&quot;, &quot;&amp;_to_and&quot; ], &quot;tokenizer&quot;: &quot;standard&quot;, &quot;filter&quot;: [ &quot;lowercase&quot;, &quot;my_stopwords&quot; ] &#125;&#125; æ±‡æ€»èµ·æ¥ï¼Œå®Œæ•´çš„ åˆ›å»ºç´¢å¼• è¯·æ±‚ çœ‹èµ·æ¥åº”è¯¥åƒè¿™æ ·ï¼š 1234567891011121314151617181920212223PUT /my_index&#123; &quot;settings&quot;: &#123; &quot;analysis&quot;: &#123; &quot;char_filter&quot;: &#123; &quot;&amp;_to_and&quot;: &#123; &quot;type&quot;: &quot;mapping&quot;, &quot;mappings&quot;: [ &quot;&amp;=&gt; and &quot;] &#125;&#125;, &quot;filter&quot;: &#123; &quot;my_stopwords&quot;: &#123; &quot;type&quot;: &quot;stop&quot;, &quot;stopwords&quot;: [ &quot;the&quot;, &quot;a&quot; ] &#125;&#125;, &quot;analyzer&quot;: &#123; &quot;my_analyzer&quot;: &#123; &quot;type&quot;: &quot;custom&quot;, &quot;char_filter&quot;: [ &quot;html_strip&quot;, &quot;&amp;_to_and&quot; ], &quot;tokenizer&quot;: &quot;standard&quot;, &quot;filter&quot;: [ &quot;lowercase&quot;, &quot;my_stopwords&quot; ] &#125;&#125;&#125;&#125;&#125; ç´¢å¼•è¢«åˆ›å»ºä»¥åï¼Œä½¿ç”¨ analyze API æ¥ æµ‹è¯•è¿™ä¸ªæ–°çš„åˆ†æå™¨ï¼š 12GET /my_index/_analyze?analyzer=my_analyzerThe quick &amp; brown fox ä¸‹é¢çš„ç¼©ç•¥ç»“æœå±•ç¤ºå‡ºæˆ‘ä»¬çš„åˆ†æå™¨æ­£åœ¨æ­£ç¡®åœ°è¿è¡Œï¼š 12345678&#123; &quot;tokens&quot; : [ &#123; &quot;token&quot; : &quot;quick&quot;, &quot;position&quot; : 2 &#125;, &#123; &quot;token&quot; : &quot;and&quot;, &quot;position&quot; : 3 &#125;, &#123; &quot;token&quot; : &quot;brown&quot;, &quot;position&quot; : 4 &#125;, &#123; &quot;token&quot; : &quot;fox&quot;, &quot;position&quot; : 5 &#125; ]&#125; è¿™ä¸ªåˆ†æå™¨ç°åœ¨æ˜¯æ²¡æœ‰å¤šå¤§ç”¨å¤„çš„ï¼Œé™¤éæˆ‘ä»¬å‘Šè¯‰ Elasticsearchåœ¨å“ªé‡Œç”¨ä¸Šå®ƒã€‚æˆ‘ä»¬å¯ä»¥åƒä¸‹é¢è¿™æ ·æŠŠè¿™ä¸ªåˆ†æå™¨åº”ç”¨åœ¨ä¸€ä¸ª string å­—æ®µä¸Šï¼š 123456789PUT /my_index/_mapping/my_type&#123; &quot;properties&quot;: &#123; &quot;title&quot;: &#123; &quot;type&quot;: &quot;string&quot;, &quot;analyzer&quot;: &quot;my_analyzer&quot; &#125; &#125;&#125; æœ€åæ•´ç†å‚è€ƒç½‘ä¸Šèµ„æ–™ï¼Œå¦‚æœ‰ä¸æ­£ç¡®çš„åœ°æ–¹è¿˜è¯·å¤šå¤šæŒ‡æ•™ï¼","tags":[{"name":"ElasticSearch","slug":"ElasticSearch","permalink":"http://www.54tianzhisheng.cn/tags/ElasticSearch/"}]},{"title":"é‚£äº›å¹´æˆ‘çœ‹è¿‡çš„ä¹¦ â€”â€” è‡´æ•¬æˆ‘çš„å¤§å­¦ç”Ÿæ´» â€”â€” Say Good Bye ï¼","date":"2017-08-27T16:00:00.000Z","path":"2017/08/28/recommend-books/","text":"å¼€å¤´2017.08.21 æ­£å¼å¼€å¯æˆ‘å…¥èŒçš„é‡Œç¨‹ï¼Œç°åœ¨å·²æ˜¯å·¥ä½œäº†ä¸€ä¸ªæ˜ŸæœŸäº†ï¼Œè¿™ä¸ªæ˜ŸæœŸç®—æ˜¯æˆ‘å…¥èŒçš„è¿‡æ¸¡æœŸï¼Œç®—æ˜¯çŸ¥é“äº†å­¦æ ¡ç”Ÿæ´»å’Œå·¥ä½œçš„å·®è·äº†ï¼Œæ€»ä¹‹ï¼Œå°½å¿«ä¹ æƒ¯è¿™ç§ç”Ÿæ´»å§ã€‚ä¸‹é¢è®²ä¸‹è‡ªå·±çš„æ‰¾å·¥ä½œç»å†å’Œå¤§å­¦é˜…è¯»çš„ä¹¦ç±ï¼Œç®—æ˜¯ä¸€ç§ä¹¦ç±æ¨èï¼Œä¸ºè¿˜åœ¨è¿·èŒ«çš„ä½ æŒ‡å¼•æ–¹å‘ï¼ŒåŒæ—¶ä¸ºæˆ‘ä¸‰å¹´çš„å¤§å­¦ç”Ÿæ´»è‡´æ•¬ï¼ä¹Ÿæ¿€åŠ±æˆ‘å¤§å››åœ¨å…¬å¸å®ä¹ èƒ½æ›´ä¸Šä¸€å±‚æ¥¼ï¼ æ‰¾å·¥ä½œç»å†è¿™æ®µç»å†ï¼Œç®—æ˜¯è‡ªå·±å¾ˆéš¾å¿˜è®°çš„ç»å†å§ã€‚æ—¢è¾›é…¸æ—¢å……å®çš„æ—¥å­ï¼ä¹Ÿå¾ˆæ„Ÿè°¢è‡ªå·±åœ¨è¿™æ®µæ—¶é—´çš„ç³»ç»Ÿå¤ä¹ ï¼Œæ„Ÿè§‰æŠŠè‡ªå·±çš„åŸºç¡€çŸ¥è¯†å†æ¬¡èšé›†åœ¨ä¸€èµ·äº†ï¼Œè‡ªå·±çš„èƒ½åŠ›åœ¨è¿™ä¸€æ®µæ—¶é—´æå‡çš„ä¹Ÿå¾ˆå¿«ã€‚åé¢æœ‰æœºä¼šçš„è¯æˆ‘ä¹Ÿæƒ³å†™ä¸€ç³»åˆ—çš„ç›¸å…³æ–‡ç« ï¼Œä¸ºåæ¥å‡†å¤‡å·¥ä½œï¼ˆé¢è¯•ï¼‰çš„åŒå­¦æä¾›ä¸€äº›è‡ªå·±çš„å¸®åŠ©ã€‚è‡ªå·±åœ¨æ‰¾å·¥ä½œçš„è¿™æ®µæ—¶é—´é¢è¿‡çš„å…¬å¸ä¹Ÿæœ‰å‡ å®¶å¤§å‚ï¼Œä½†æ˜¯ç»“æœéƒ½ä¸æ˜¯å¾ˆå¥½ï¼Œå¯¹æˆ‘è‡ªå·±æœ‰å¾ˆå¤§çš„å‹åŠ›ï¼Œå½“æ—¶å¿ƒé‡ŒçœŸçš„æ„Ÿè§‰ ï¼šâ€œè‡ªå·±çœŸçš„æœ‰è¿™ä¹ˆå·®â€ï¼Œä¸ºä»€ä¹ˆä¸€ç›´è¢«æ‹’ï¼Œå½“æ—¶å¾ˆæ€€ç–‘è‡ªå·±çš„èƒ½åŠ›ï¼Œè‡ªå·±ä¹Ÿæœ‰æ€»ç»“åŸå› ã€‚ä¸€æ˜¯é¢è¯•çš„æ—¶å€™è‡ªå·±å‡†å¤‡çš„è¿˜ä¸å¤Ÿå……åˆ†ï¼Œè™½è¯´è‡ªå·±è„‘å­é‡Œå¯¹è¿™äº›åŸºç¡€æœ‰ç‚¹å°è±¡ï¼Œä½†æ˜¯é¢è¯•çš„æ—¶å€™è‡ªå·±ç¨ç´§å¼ ä¸‹å°±æè¿°ä¸æ€ä¹ˆæ¸…æ¥šäº†ï¼Œå¯¼è‡´é¢è¯•å®˜è§‰å¾—ä½ å¯èƒ½å¹¿åº¦å¤Ÿäº†ï¼Œæ·±åº¦è¿˜ä¸å¤Ÿï¼ˆè¿™æ˜¯é˜¿é‡Œé¢è¯•å®˜ç”µè¯é¢è¯•è¯´çš„ï¼‰ï¼›äºŒæ˜¯è‡ªå·±çš„è¡¨è¾¾èƒ½åŠ›è¿˜æ˜¯æœ‰æ‰€æ¬ ç¼ºï¼Œä¸èƒ½å¤Ÿå°†è‡ªå·±æ‰€è¦è¡¨è¾¾çš„ä¸œè¥¿è¯´å‡ºæ¥ï¼Œè¿™å¯èƒ½æˆ‘è¦åœ¨åé¢åŠ å¼ºçš„åœ°æ–¹ï¼›ä¸‰æ˜¯æˆ‘çš„å­¦æ ¡é—®é¢˜ã€‚åœ¨é¢äº†å‡ å®¶å…¬å¸å¤±è´¥åï¼Œç»ˆäºé¢äº†å®¶å…¬å¸è¦æˆ‘äº†ï¼Œæˆ‘ä¹Ÿç¡®å®šåœ¨è¿™å®¶å…¬å¸äº†ã€‚å¾ˆå¹¸è¿ï¼Œåˆšå‡ºæ¥ï¼Œå°±æœ‰ä¸€ä¸ªå¾ˆå¥½ï¼ˆå¾ˆè´Ÿè´£ï¼‰çš„æ¶æ„å¸ˆå¸¦æˆ‘ï¼Œè¿™å‘¨å°±ç»™äº†æˆ‘ä¸€ä¸ªå¾ˆç‰›é€¼çš„é¡¹ç›®ç»™æˆ‘çœ‹ï¼ˆè™½ç„¶è‡ªå·±ç›®å‰è¿˜æ²¡æœ‰æ€è·¯æ”¹é‡Œé¢çš„ä»£ç ï¼‰ï¼Œé‡Œé¢æ–°ä¸œè¥¿å¾ˆå¤šï¼Œè¯´åƒé€äº†è¿™ä¸ªé¡¹ç›®ï¼Œä»¥åç»å¯¹å¯ä»¥æ‹¿å‡ºå»å¹é€¼ï¼ˆä¸€è„¸æ­£ç».jpgï¼‰ã€‚ç›®å‰æˆ‘çš„æ‰¾å·¥ä½œç»å†å°±ç®€çŸ­çš„ä»‹ç»åˆ°è¿™é‡Œäº†ï¼Œå¦‚æœæ„Ÿå…´è¶£çš„è¯ï¼Œå¯ä»¥åŠ ç¾¤ï¼š528776268 è¿›æ¥å’Œæˆ‘è®¨è®ºäº¤æµã€‚ ä¹¦ç±æ¨èå¤§å­¦ï¼Œæˆ‘ä¸æ€ä¹ˆå–œæ¬¢ç©æ¸¸æˆï¼Œè‡ªå·±ä¹Ÿè¿˜ç®—ä¸æ€ä¹ˆå •è½å§ï¼Œçœ‹äº†ä»¥ä¸‹çš„ä¸€äº›ä¹¦ç±ï¼Œç®—æ˜¯å¯¹æˆ‘åé¢å†™åšå®¢ã€æ‰¾å·¥ä½œä¹Ÿæœ‰å¾ˆå¤§çš„å¸®åŠ©ã€‚å¦‚æœä½ æ˜¯å¤§ç¥ï¼Œè¯·å¿½ç•¥ï¼Œå¦‚æœä½ è¿˜æ˜¯è¿˜åœ¨å¤§å­¦ï¼Œå’Œæˆ‘ä¸€æ ·ä¸æƒ³æŠŠæ—¶é—´æµªè´¹åœ¨æ¸¸æˆä¸Šï¼Œå¯ä»¥çœ‹çœ‹æˆ‘æ¨èçš„ä¸€äº›ä¹¦ç±ï¼Œæœ‰æƒ³è®¨è®ºçš„è¯·åœ¨è¯„è®ºä¸‹ç•™ä¸‹ä½ çš„è¯„è®ºæˆ–è€…åŠ ä¸Šé¢ç»™çš„ç¾¤å·ã€‚ Java1ã€ã€ŠJava æ ¸å¿ƒæŠ€æœ¯ã€‹å·ä¸€ ã€å·äºŒ ä¸¤æœ¬ä¹¦ï¼Œç®—æ˜¯å…¥é—¨æ¯”è¾ƒå¥½çš„ä¹¦ç±äº† 2ã€ã€Šç–¯ç‹‚ Java è®²ä¹‰ã€‹ å¾ˆåšçš„ä¸€æœ¬ä¹¦ï¼Œé‡Œé¢çš„å†…å®¹ä¹Ÿæ˜¯å¾ˆæ³¨é‡åŸºç¡€äº† 3ã€ã€ŠJava å¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹â€”â€” æ–¹è…¾é£ ã€é­é¹ã€ç¨‹æ™“æ˜è‘— æ–¹è…¾é£ æ˜¯å¹¶å‘ç¼–ç¨‹ç½‘çš„åˆ›å§‹äººï¼Œé‡Œé¢çš„æ–‡ç« ç¡®å®è¿˜ä¸é”™ï¼Œå¯ä»¥å¤šçœ‹çœ‹é‡Œé¢çš„æ–‡ç« ï¼Œæ”¶è·ç»å¯¹å¾ˆå¤§ã€‚ 4ã€ã€Š Javaå¤šçº¿ç¨‹ç¼–ç¨‹æ ¸å¿ƒæŠ€æœ¯ã€‹â€”â€” é«˜æ´ªå²©è‘— è¿™æœ¬ä¹¦ä¹Ÿç®—æ˜¯å…¥é—¨å¤šçº¿ç¨‹ç¼–ç¨‹çš„ä¸é”™ä¹¦ç±ï¼Œæˆ‘ä¹‹å‰è¿˜å†™äº†ä¸€ç¯‡è¯»ä¹¦ç¬”è®°å‘¢ï¼Œã€ŠJava å¤šçº¿ç¨‹ç¼–ç¨‹æ ¸å¿ƒæŠ€æœ¯ã€‹å­¦ä¹ ç¬”è®°åŠæ€»ç»“ , å¤§å®¶å¦‚æœä¸æƒ³çœ‹ä¹¦çš„å¯ä»¥å»çœ‹æˆ‘çš„ç¬”è®°ã€‚ 5ã€ã€ŠJava å¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‹ è¿™æœ¬ä¹¦è®²çš„æœ‰ç‚¹éš¾æ‡‚å•Šï¼Œä¸è¿‡ç¡®å®ä¹Ÿæ˜¯ä¸€æœ¬å¾ˆå¥½çš„ä¹¦ï¼Œä»¥ä¸Šä¸‰æœ¬ä¹¦ç±å¦‚æœéƒ½å¼„æ‡‚äº†ï¼Œæˆ‘è§‰å¾—ä½ å¹¶å‘ç¼–ç¨‹è¿™å—å¯èƒ½å¤§æ¦‚å°± OK äº†ï¼Œç„¶åå†å»çœ‹çœ‹çº¿ç¨‹æ± çš„æºç ï¼Œäº†è§£ä¸‹çº¿ç¨‹æ± ï¼Œæˆ‘è§‰å¾—é‚£å°±æ›´æ£’äº†ã€‚ä¸æƒ³çœ‹çš„è¯ï¼Œè¯·çœ‹æˆ‘çš„åšå®¢ï¼šJava çº¿ç¨‹æ± è‰ºæœ¯æ¢ç´¢ æˆ‘ä¸ªäººè§‰å¾—è¿˜æ˜¯å†™çš„å¾ˆä¸é”™ï¼Œé‚£äº›å¤§å‚é¢è¯•ä¹Ÿå‡ ä¹éƒ½ä¼šé—®çº¿ç¨‹æ± çš„ä¸œè¥¿ï¼Œç„¶åå¤§æ¦‚å†…å®¹ä¹Ÿå°±æ˜¯æˆ‘è¿™åšå®¢å†™çš„ 6ã€ã€ŠEffective Javaã€‹ä¸­æ–‡ç‰ˆ ç¬¬äºŒç‰ˆ ç®—æ˜¯ Java çš„è¿›é˜¶ä¹¦ç±äº†ï¼Œé¢è¯•å¥½å¤šé—®é¢˜ä¹Ÿæ˜¯ä»è¿™å‡ºæ¥çš„ 7ã€ã€Šæ·±å…¥ç†è§£ Java è™šæ‹Ÿæœºâ€”â€”JVMé«˜çº§ç‰¹æ€§ä¸æœ€ä½³å®è·µã€‹ç¬¬äºŒç‰ˆ è¿™ç®—æ˜¯å›½å†…è®² JVM æœ€æ¸…æ¥šçš„ä¹¦äº†å§ï¼Œç›®å‰è¿˜æ˜¯åªçœ‹äº†ä¸€éï¼Œåé¢ç»§ç»­å•ƒï¼Œå¤§å‚é¢è¯•å‡ ä¹ä¹Ÿæ˜¯éƒ½ä¼šè€ƒ JVM çš„ï¼Œé˜¿é‡Œé¢ JVM ç‰¹åˆ«å¤šï¼Œæƒ³è¿›é˜¿é‡Œçš„åŒå­¦è¯·ä¸€å®šè¦ä¹°è¿™æœ¬ä¹¦å»çœ‹ã€‚ 8ã€ã€Šæ·±å…¥åˆ†æJava WebæŠ€æœ¯å†…å¹• ä¿®è®¢ç‰ˆã€‹è®¸ä»¤æ³¢è‘— é‡Œé¢çŸ¥è¯†å¾ˆå¹¿ï¼Œæ¯ä¸€ç« éƒ½æ˜¯ä¸€ä¸ªä¸åŒçš„çŸ¥è¯†ï¼Œå¯è§ä½œè€…çš„ä¼˜ç§€ï¼Œä¸æ„§æ˜¯é˜¿é‡Œå¤§ç¥ã€‚ 9ã€ã€Šå¤§å‹ç½‘ç«™ç³»ç»Ÿä¸ Java ä¸­é—´ä»¶å®è·µã€‹â€”â€” æ›½å®ªæ° è‘— ä½œè€…æ˜¯å‰æ·˜å®æŠ€æœ¯æ€»ç›‘ï¼Œè§è¯äº†æ·˜å®ç½‘çš„å‘å±•ï¼Œé‡Œé¢çš„è®²çš„å†…å®¹ä¹Ÿæ˜¯å¾ˆå¥½ï¼Œçœ‹å®Œèƒ½è®©è‡ªå·±ä¹Ÿç«™åœ¨é«˜å¤„å»æ€è€ƒé—®é¢˜ã€‚ 10ã€ã€Šå¤§å‹ç½‘ç«™æŠ€æœ¯æ¶æ„ â€”â€” æ ¸å¿ƒåŸç†ä¸æ¡ˆä¾‹åˆ†æã€‹ â€”â€” ææ™ºæ…§ è‘— æœ€å¥½å’Œä¸Šé¢é‚£æœ¬ä¹¦ç±ä¸€èµ·çœ‹ï¼Œæ•ˆæœæ›´å¥½ï¼Œä¸¤æœ¬çœ‹å®Œäº†ï¼Œæå‡æ€æƒ³çš„é«˜åº¦ï¼ 11ã€ã€Šç–¯ç‹‚Java.çªç ´ç¨‹åºå‘˜åŸºæœ¬åŠŸçš„16è¯¾ã€‹ æåˆš è‘— ä¹¦ä¸­å¾ˆæ³¨é‡ Java çš„ä¸€äº›ç»†èŠ‚ï¼Œè®²çš„å¾ˆæ·±å…¥ï¼Œä½†æ˜¯ä¹¦ä¸­çš„é”™åˆ«å­—ç‰¹å¤šï¼Œå¯ä»¥çœ‹çœ‹æˆ‘çš„è¯»ä¹¦ç¬”è®°ï¼šã€Šç–¯ç‹‚ Java çªç ´ç¨‹åºå‘˜åŸºæœ¬åŠŸçš„ 16 è¯¾ã€‹è¯»ä¹¦ç¬”è®° 12ã€ã€ŠSpring å®æˆ˜ã€‹ Spring å…¥é—¨ä¹¦ç± 13ã€ã€ŠSpring æ­ç§˜ã€‹â€”â€” ç‹ç¦å¼º è‘— è¿™æœ¬ä¹¦åˆ«æå¤šç‰›äº†ï¼Œå‡ºç‰ˆæ—¶æœŸä¸º 2009 å¹´ï¼Œè±†ç“£è¯„åˆ†ä¸º 9.0 åˆ†ï¼Œå†™çš„æ˜¯çœŸæ£’ï¼æŠŠ Spring çš„ IOC å’Œ AOP ç‰¹æ€§å†™çš„å¾ˆæ¸…æ¥šï¼ŒæŠŠ Spring çš„æ¥é¾™å»è„‰è®²çš„å¾ˆå…¨ã€‚å¢™è£‚æ¨èè¿™æœ¬ä¹¦ç±ï¼Œå¦‚æœä½ æƒ³çœ‹ Springï¼Œä½œè€…å¾ˆç‰›ï¼Œèµ„æ·±æ¶æ„å¸ˆï¼Œå¾ˆæœ‰å¹¸å’Œä½œè€…æœ‰è¿‡ä¸€æ¬¡äº¤æµï¼Œå½“æ—¶å› ä¸ºè‡ªå·±çš„ä¸€ç¯‡åšå®¢ Pyspideræ¡†æ¶ â€”â€” Pythonçˆ¬è™«å®æˆ˜ä¹‹çˆ¬å– V2EX ç½‘ç«™å¸–å­ï¼Œç«Ÿç„¶æ‰¾åˆ°æˆ‘æƒ³å«æˆ‘å»å®ä¹ ï¼Œå¯æƒœäº†ï¼Œå½“æ—¶å·®ç‚¹å°±è·Ÿç€ä»–æ··äº†ã€‚ä½œè€…è¿˜æœ‰ä¸€æœ¬ä¹¦ ã€ŠSpring Boot æ­ç§˜ã€‹ã€‚ 14ã€ã€ŠSpring æŠ€æœ¯å†…å¹•ã€‹â€”â€” æ·±å…¥è§£æ Spring æ¶æ„ä¸è®¾è®¡åŸç† è®²è§£ Spring æºç ï¼Œæ·±å…¥äº†å†…éƒ¨æœºåˆ¶ï¼Œä¸ªäººè§‰å¾—è¿˜æ˜¯ä¸é”™çš„ã€‚ 15ã€Spring å®˜æ–¹çš„è‹±æ–‡æ–‡æ¡£ è¿™ä¸ªåˆ«æäº†ï¼Œå¾ˆå¥½ï¼Œèƒ½çœ‹è‹±æ–‡å°½é‡çœ‹è‹±æ–‡ 16ã€ã€Šè·Ÿå¼€æ¶›å­¦ Spring 3ã€‹ ã€Šè·Ÿå¼€æ¶›å­¦ Spring MVCã€‹ äº¬ä¸œå¤§ç¥ï¼Œè†œ 17ã€ã€Šçœ‹é€springMvcæºä»£ç åˆ†æä¸å®è·µã€‹ ç®—æ˜¯æŠŠ Spring MVC æºç è®²çš„å¾ˆå¥½çš„äº† è§æˆ‘çš„ç¬”è®°ï¼š 1ã€é€šè¿‡æºç è¯¦è§£ Servlet 2 ã€çœ‹é€ Spring MVC æºä»£ç åˆ†æä¸å®è·µ â€”â€” ç½‘ç«™åŸºç¡€çŸ¥è¯† 3 ã€çœ‹é€ Spring MVC æºä»£ç åˆ†æä¸å®è·µ â€”â€” ä¿¯è§† Spring MVC 4 ã€çœ‹é€ Spring MVC æºä»£ç åˆ†æä¸å®è·µ â€”â€” Spring MVC ç»„ä»¶åˆ†æ 18ã€ã€ŠSpring Boot å®æˆ˜ã€‹ 19ã€Spring Boot å®˜æ–¹ Reference Guide ç½‘ä¸Šå¥½å¤šå†™ SpringBoot çš„åšå®¢ï¼Œå‡ ä¹å’Œè¿™ä¸ªå·®ä¸å¤šã€‚ 20ã€ã€ŠJavaEEå¼€å‘çš„é¢ è¦†è€…: Spring Bootå®æˆ˜ã€‹ 21ã€MyBatis å½“ç„¶æ˜¯å®˜æ–¹çš„æ–‡æ¡£æœ€å¥½äº†ï¼Œè€Œä¸”è¿˜æ˜¯ä¸­æ–‡çš„ã€‚ è‡ªå·±ä¹Ÿå†™è¿‡å‡ ç¯‡æ–‡ç« ï¼Œå¸®åŠ©è¿‡å¾ˆå¤šäººå…¥é—¨ï¼Œä¼ é€é—¨ï¼š 1ã€é€šè¿‡é¡¹ç›®é€æ­¥æ·±å…¥äº†è§£Mybatisï¼ˆä¸€ï¼‰/) 2ã€é€šè¿‡é¡¹ç›®é€æ­¥æ·±å…¥äº†è§£Mybatisï¼ˆäºŒï¼‰/) 3ã€é€šè¿‡é¡¹ç›®é€æ­¥æ·±å…¥äº†è§£Mybatisï¼ˆä¸‰ï¼‰/) 4ã€é€šè¿‡é¡¹ç›®é€æ­¥æ·±å…¥äº†è§£Mybatisï¼ˆå››ï¼‰/) 22ã€ã€Šæ·±å…¥ç†è§£ Java å†…å­˜æ¨¡å‹ã€‹â€”â€” ç¨‹æ™“æ˜ è‘— æˆ‘è§‰å¾—æ¯ä¸ª Java ç¨‹åºå‘˜éƒ½åº”è¯¥äº†è§£ä¸‹ Java çš„å†…å­˜æ¨¡å‹ï¼Œè¯¥ä¹¦ç±æˆ‘çœ‹çš„æ˜¯ç”µå­ç‰ˆçš„ï¼Œä¸å¤šï¼Œä½†æ˜¯è®²çš„å´å¾ˆæ¸…æ¥šï¼ŒæŠŠé‡æ’åºã€é¡ºåºä¸€è‡´æ€§ã€Volatileã€é”ã€finalç­‰å†™çš„å¾ˆæ¸…æ¥šã€‚ Linuxã€Šé¸Ÿå“¥çš„Linuxç§æˆ¿èœ åŸºç¡€å­¦ä¹ ç¯‡(ç¬¬ä¸‰ç‰ˆ) ã€‹ é¸Ÿå“¥çš„Linuxç§æˆ¿èœï¼šæœåŠ¡å™¨æ¶è®¾ç¯‡(ç¬¬3ç‰ˆ) é¸Ÿå“¥çš„ä¹¦ è®¡ç®—æœºç½‘ç»œã€Šè®¡ç®—æœºç½‘ç»œç¬¬å…­ç‰ˆâ€”â€”è°¢å¸Œä» ç¼–ã€‹ ã€Šè®¡ç®—æœºç½‘ç»œè‡ªé¡¶å‘ä¸‹æ–¹æ³•ã€‹ è®¡ç®—æœºç³»ç»Ÿã€Šä»£ç æ­ç§˜ï¼šä»Cï¼C.çš„è§’åº¦æ¢ç§˜è®¡ç®—æœºç³»ç»Ÿ â€”â€” å·¦é£ã€‹ ã€Šæ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿã€‹ ã€Šè®¡ç®—æœºç§‘å­¦å¯¼è®º_ä½›ç½—èµã€‹ æ•°æ®åº“ã€Šé«˜æ€§èƒ½MySQLã€‹ ã€ŠMysqlæŠ€æœ¯å†…å¹•InnoDBå­˜å‚¨å¼•æ“ã€‹ Pythonè¿™é—¨è¯­è¨€è¯­æ³•å¾ˆç®€å•ï¼Œä¸Šæ‰‹å¿«ï¼Œä¸è¿‡æˆ‘ç›®å‰å¥½ä¹…æ²¡ç”¨äº†ï¼Œéƒ½å¿˜å¾—å·®ä¸å¤šäº†ã€‚å½“æ—¶æ˜¯çœ‹çš„å»–é›ªå³°çš„ Python åšå®¢ è‡ªå·±ä¹Ÿç”¨ Python åšçˆ¬è™«å†™è¿‡å‡ ç¯‡åšå®¢ï¼Œä¸è¿‡æœ‰äº›æ˜¯åœ¨å‰äººçš„åŸºç¡€ä¸Šå†™çš„ã€‚æ„Ÿè°¢é‚£äº›æ ½æ ‘çš„äººï¼ å·¥å…·Git ï¼š å»–é›ªå³°çš„ Git æ•™ç¨‹ IDEAï¼šIntelliJ IDEA ç®€ä½“ä¸­æ–‡ä¸“é¢˜æ•™ç¨‹ Mavenï¼šã€ŠMavenå®æˆ˜ã€‹ å…¶ä»–ã€Šå¦‚ä½•é«˜æ•ˆå­¦ä¹ -æ–¯ç§‘ç‰¹æ¨ã€‹ æ•™ä½ æ€æ ·é«˜æ•ˆå­¦ä¹ çš„ ã€Šè½¯æŠ€èƒ½ï¼šä»£ç ä¹‹å¤–çš„ç”Ÿå­˜æŒ‡å—ã€‹ ç¨‹åºå‘˜é™¤äº†å†™ä»£ç ï¼Œè¿˜å¾—æ‡‚ç‚¹å…¶ä»–çš„è½¯æŠ€èƒ½ã€‚ ã€Šæé—®çš„æ™ºæ…§â€œä¸­æ–‡ç‰ˆâ€ã€‹ ã€ŠHow-To-Ask-Questions-The-Smart-Wayã€‹ ä½œä¸ºç¨‹åºå‘˜çš„ä½ ï¼Œä¸€å®šè¦å­¦ä¼šå’‹æé—®ï¼Œä¸ç„¶åˆ«äººéƒ½ä¸æƒ³é¸Ÿä½ ã€‚ ä¼˜ç§€ç½‘ç«™æ¨è1ã€GitHub åˆ«å’Œæˆ‘è¯´ä¸çŸ¥é“ 2ã€InfoQ æ–‡ç« å¾ˆä¸é”™ 3ã€CSDN ç»å¸¸çœ‹åšå®¢ä¸“å®¶çš„åšå®¢ï¼Œé‡Œé¢å¤§ç‰›å¾ˆå¤šï¼Œä¼ é€é—¨ï¼šzhisheng 4ã€çŸ¥ä¹ å¤šå…³æ³¨äº›å¤§ç‰›ï¼Œçœ‹ä»–ä»¬å¹é€¼ 5ã€æ˜é‡‘ è‡ªå·±ä¹Ÿåœ¨ä¸Šé¢å†™ä¸“æ ï¼Œç²‰ä¸å·²ç»è¶…è¿‡ä¸€ä¸‡äº†ï¼Œä¼ é€é—¨ ï¼šzhisheng 6ã€å¹¶å‘ç¼–ç¨‹ç½‘ å‰é¢å·²ç»ä»‹ç» 7ã€developerworks ä¸Šé¢çš„åšå®¢ä¹Ÿå¾ˆå¥½ 8ã€åšå®¢å›­ é‡Œé¢åº”è¯¥å¤§ç‰›ä¹Ÿå¾ˆå¤šï¼Œä¸è¿‡è‡ªå·±æ²¡åœ¨ä¸Šé¢å†™è¿‡åšå®¢ 9ã€å¾®ä¿¡å…¬ä¼—å· å…³æ³¨äº†å¾ˆå¤šäººï¼Œæœ‰äº›äººçš„æ–‡ç« ç¡®å®å¾ˆå¥½ã€‚ 10ã€ç‰›å®¢ç½‘ åˆ·ç¬”è¯•é¢˜ä¸é”™çš„åœ°æ–¹ï¼Œé‡Œé¢å¤§ç‰›è¶…å¤šï¼Œæ€€å¿µå¶ç¥å’Œå·¦ç¥è®²è¯¾çš„æ—¶å€™ï¼Œè¿˜æœ‰å¾ˆæœ‰çˆ±çš„ç‰›å¦¹ã€‚ 11ã€ä¼˜ç§€åšä¸»çš„åšå®¢åœ°å€äº† ä¼˜ç§€åšå®¢æ¨èå»–é›ªå³° Git å’Œ Python å…¥é—¨æ–‡ç« å°±æ˜¯ä»ä»–åšå®¢çœ‹çš„ é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿— é…·å£³-é™ˆçš“ RednaxelaFX Rå¤§ï¼Œç‰›é€¼çš„ä¸å¾—äº† æ±Ÿå—ç™½è¡£ è€å¸æœº stormzhang äººç§°å¸…é€¼å¼ ï¼Œå¾®ä¿¡å…¬ä¼—å·å†™çš„ä¸é”™ ä½ å‡ç¬¨ é˜¿é‡Œæ JVM çš„ï¼Œå¾ˆå‰å®³ å å°ç‹¼ æ³¥ç“¦åŒ BYSocket å´”åº†æ‰ å†™äº†å¥½å¤š Python çˆ¬è™«ç›¸å…³çš„æ–‡ç«  çº¯æ´çš„å¾®ç¬‘ SpringBoot ç³»åˆ—ä¸é”™ï¼Œå…¶ä»–çš„æ–‡ç« è‡ªå·±çœ‹äº†æ„Ÿè§‰æ˜¯è‡ªå·±å–œæ¬¢çš„é‚£ç§æ–‡ç¬” ç¨‹åºçŒ¿DD å‘¨ç«‹ èŠ‹è‰¿Vçš„åšå®¢ å¥½å¤šç³»åˆ—çš„æºç åˆ†æ zhisheng è¿™ä¸ªæ˜¯æˆ‘ä¸è¦è„¸ï¼Œç«Ÿç„¶æŠŠè‡ªå·±åšå®¢åœ°å€çš„å†™ä¸Šå»äº† æœ€åé€ä¸€å¥è¯ï¼Œè¶ŠåŠªåŠ›ï¼Œè¶Šå¹¸è¿ï¼Œç¥æ—©æ—¥æˆä¸ºå¤§ç¥ï¼ è¿™äº›åœ°æ–¹å¯ä»¥æ‰¾åˆ°æˆ‘ï¼š blog: http://www.54tianzhisheng.cn/ GitHub: https://github.com/zhisheng17 QQ ç¾¤ï¼š528776268","tags":[{"name":"éšç¬”","slug":"éšç¬”","permalink":"http://www.54tianzhisheng.cn/tags/éšç¬”/"}]},{"title":"Ubuntu16.10 å®‰è£… Nginx","date":"2017-08-17T16:00:00.000Z","path":"2017/08/18/Ubuntu-install-Nginx/","text":"å®‰è£… Nginx ä¾èµ–åº“å®‰è£… gcc g++ çš„ä¾èµ–åº“Ubuntu å¹³å°ä½¿ç”¨ï¼š 12apt-get install build-essentialapt-get install libtool CentOS å¹³å°ä½¿ç”¨ï¼š 12345centoså¹³å°ç¼–è¯‘ç¯å¢ƒä½¿ç”¨å¦‚ä¸‹æŒ‡ä»¤å®‰è£…makeï¼šyum -y install gcc automake autoconf libtool makeå®‰è£…g++:yum install gcc gcc-c++ å®‰è£… pcre ä¾èµ–åº“12sudo apt-get updatesudo apt-get install libpcre3 libpcre3-dev å®‰è£… zlib ä¾èµ–åº“1apt-get install zlib1g-dev å®‰è£… ssl ä¾èµ–åº“1apt-get install openssl å®‰è£… Nginxåœ¨ç½‘ä¸Šä¸‹è½½äº† nginx-1.8.1.tar.gz ç‰ˆæœ¬ã€‚ 1234567891011121314151617#è§£å‹ï¼štar -zxvf nginx-1.8.1.tar.gz#è¿›å…¥è§£å‹ç›®å½•ï¼šcd nginx-1.8.1#é…ç½®ï¼š./configure --prefix=/usr/local/nginx#ç¼–è¾‘nginxï¼šmakeæ³¨æ„ï¼šè¿™é‡Œå¯èƒ½ä¼šæŠ¥é”™ï¼Œæç¤ºâ€œpcre.h No such file or directoryâ€,å…·ä½“è¯¦è§ï¼šhttp://stackoverflow.com/questions/22555561/error-building-fatal-error-pcre-h-no-such-file-or-directoryéœ€è¦å®‰è£… libpcre3-dev,å‘½ä»¤ä¸ºï¼šsudo apt-get install libpcre3-dev#å®‰è£…nginxï¼šsudo make install#å¯åŠ¨nginxï¼šsudo /usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.confæ³¨æ„ï¼š-c æŒ‡å®šé…ç½®æ–‡ä»¶çš„è·¯å¾„ï¼Œä¸åŠ çš„è¯ï¼Œnginxä¼šè‡ªåŠ¨åŠ è½½é»˜è®¤è·¯å¾„çš„é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ -hæŸ¥çœ‹å¸®åŠ©å‘½ä»¤ã€‚#æŸ¥çœ‹nginxè¿›ç¨‹ï¼šps -ef|grep nginx Nginx å¸¸ç”¨å‘½ä»¤å¯åŠ¨ Nginxåˆ‡æ¢åˆ° /usr/local/nginx/sbin/ ç›®å½•ä¸‹ï¼Œæ‰§è¡Œå‘½ä»¤ 1./nginx æŸ¥çœ‹æ•ˆæœï¼š åœæ­¢ Nginx12./nginx -s stop./nginx -s quit -s éƒ½æ˜¯é‡‡ç”¨å‘ Nginx å‘é€ä¿¡å·çš„æ–¹å¼ã€‚ Nginx é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶1./nginx -s reload æŒ‡å®šé…ç½®æ–‡ä»¶1./nginx -c /usr/local/nginx/conf/nginx.conf -c è¡¨ç¤º configurationï¼ŒæŒ‡å®šé…ç½®æ–‡ä»¶ æŸ¥çœ‹ Nginx ç‰ˆæœ¬12./nginx -v //æŸ¥çœ‹ Nginx ç‰ˆæœ¬ä¿¡æ¯çš„å‚æ•°./nginx -V //æŸ¥çœ‹ Nginx è¯¦ç»†çš„ç‰ˆæœ¬ä¿¡æ¯ æ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®1./nginx -t å¦‚æœå‡ºç°æµ‹è¯•å¤±è´¥ï¼Œè¡¨ç¤ºæ²¡æœ‰è®¿é—®é”™è¯¯æ—¥å¿—æ–‡ä»¶å’Œè¿›ç¨‹ï¼Œå¯ä»¥ sudo ä¸€ä¸‹ã€‚é…ç½®æ­£ç¡®çš„è¯ä¼šæœ‰ç›¸å…³çš„æç¤ºã€‚ æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯123./nginx -hæˆ–è€…./nginx -? Nginx çš„ç‰¹ç‚¹å’Œåº”ç”¨åœºåˆè§æ–‡ç« ï¼šNginx åŸºæœ¬çŸ¥è¯†å¿«é€Ÿå…¥é—¨ æœ€åæ–‡ç« é¦–å‘åœ°å€ï¼šzhishengçš„åšå®¢ ï¼Œè½¬è½½è¯·æ³¨æ˜åœ°å€ http://www.54tianzhisheng.cn/2017/08/18/Ubuntu-install-Nginx/","tags":[{"name":"Nginx","slug":"Nginx","permalink":"http://www.54tianzhisheng.cn/tags/Nginx/"}]},{"title":"é©¬äº‘çƒ­è¡€åŠ±å¿—æ¼”è®²ã€Šæœ€ä¼Ÿå¤§çš„æˆåŠŸã€‹","date":"2017-08-10T16:00:00.000Z","path":"2017/08/11/most-success/","text":"å½“ä½ ä¹è§‚çš„æ—¶å€™ï¼Œæ€»æ˜¯ä¼šæœ‰æœºä¼šçš„ã€‚é‚£ä¹ˆä½ å¯èƒ½è¦é—®äº†â€œæœºä¼šåœ¨å“ªå‘¢ï¼Ÿâ€ä½ å¯èƒ½æ²¡æœ‰ç‰¹åˆ«æƒ³å®ç°çš„äº‹ï¼Œæ²¡æœ‰è¿«åˆ‡è¦æˆåŠŸçš„æ¬²æœ›ï¼Œæ²¡æœ‰å‹‡æ”€é«˜å³°çš„å†³å¿ƒï¼Œæ²¡æœ‰æ°´æ»´çŸ³ç©¿çš„æ¯…åŠ›ï¼Œä¹Ÿæ²¡æœ‰ä¸€é¢—æ‰€å‘æŠ«é¡çš„å¼ºå¤§å¿ƒè„ã€‚é‚£ä¹ˆï¼Œè®©æ¥è‡ªé©¬äº‘çš„è¿™æ®µæ¼”è®²æ¥å‘Šè¯‰ä½ ï¼Œä½ æœ‰ä»€ä¹ˆã€‚ä½ æœ‰å¹´è½»çš„èº«ä½“ï¼Œä½ æœ‰å¥‡å¦™çš„æƒ³æ³•ï¼Œä½ æœ‰ä¹è§‚çš„å¿ƒæ€ï¼Œä½ æœ‰æ— é™çš„å¯èƒ½æ€§ã€‚ æˆ‘æƒ³ï¼Œé©¬äº‘çš„è¿™æ®µåŠ±å¿—æ¼”è®²ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€é¢é•œå­å¯ä»¥ç”¨äºè‡ªç…§ã€‚ä¸Šé¢â€œä½ æœ‰ä»€ä¹ˆâ€è¯´å®Œäº†ï¼Œæ¥ä¸‹æ¥è®©æˆ‘è®¨è®ºä¸€ä¸‹â€œä½ å¯èƒ½æ²¡æœ‰ä»€ä¹ˆâ€ã€‚ ä½ æ€»çˆ±æŠ±æ€¨ï¼Œæœºä¼šå´æ€»æ˜¯èº²åœ¨äººä»¬æŠ±æ€¨çš„åœ°æ–¹ã€‚ä½ æ²¡æœ‰ä»”ç»†æƒ³æƒ³æ€ä¹ˆèƒ½æŠŠäº‹æƒ…åšå¾—ä¸ä¸€æ ·ã€‚ä½ æ²¡æœ‰è¡ŒåŠ¨åŠ›ï¼Œä½ ç¼ºå°‘åšæŒä¸‹å»çš„é•¿åŠ²å„¿ã€‚ä½ æŠ—å‹èƒ½åŠ›å·®ï¼Œä½ åŠ¨ä¸åŠ¨å°±ç»ç’ƒå¿ƒã€‚ä½ ä¸ç›¸ä¿¡è‡ªå·±ä¹Ÿä¸ç›¸ä¿¡åˆ«äººï¼Œä½ æ€•çŠ¯é”™ã€‚ç°åœ¨æ˜¯ä¸æ˜¯è§‰å¾—è¿™ç¢—é¸¡æ±¤æœ‰ç‚¹éš¾ä»¥ä¸‹å’½äº†ï¼Ÿå¦‚æœè®¤è¯†åˆ°å·®è·ï¼Œä¸å¦‚ä»ä»Šå¤©å¼€å§‹æ”¹å˜ã€‚æ˜å¤©çš„ä½ åªè¦æ¯”ä»Šå¤©çš„ä½ å¤šè¿ˆå‡º0.1æ­¥ï¼Œä¹Ÿæ˜¯è¿›æ­¥ã€‚ ä¸ºè‡ªå·±è€Œå·¥ä½œã€‚åœæ­¢æŠ±æ€¨ï¼Œç”¨æŠ±æ€¨çš„æ—¶é—´å¤šåšäº‹ã€‚æŠŠé‚£äº›å¤œé‡Œå†’å‡ºæ¥çš„å¥½ç‚¹å­åœ¨ç™½å¤©ä»˜è¯¸è¡ŒåŠ¨ï¼Œæ—¢ç„¶æœ‰äº†è®¾æƒ³ï¼Œé‚£å°±è¡ŒåŠ¨èµ·æ¥ã€‚è¡ŒåŠ¨æ˜¯ä½ è¿ˆå‡ºçš„ç¬¬ä¸€æ­¥ï¼Œåé¢å¯èƒ½ä¼šæ›´éš¾ï¼Œå†ç»æ— æ•°æ¬¡åŠ¨æ‘‡ï¼Œé¢ä¸´æ— æ•°æ¬¡è¯±æƒ‘ï¼Œæ„Ÿå—æ— æ•°æ¬¡å¤±è´¥çš„è‹¦å‘³å’Œéš¾ä»¥ä¸ºç»§çš„è¾›é…¸ã€‚é¡¶ä½è¿™ä¸€åˆ‡ï¼Œæ¯”å¸¸äººæ›´å‹‡æ•¢åœ°å»é¢å¯¹ï¼Œå¹¶ä¸”åšæŒä¸‹å»ã€‚æ’é™¤ä¸‡éš¾ï¼Œåˆ«è¢«æ¥è‡ªä¸–äººçš„éè®®å’Œè´¨ç–‘å½±å“ã€‚ç›¸ä¿¡ä½ è‡ªå·±ï¼Œç›¸ä¿¡ä½ çš„å›¢é˜Ÿã€‚æœåŠ¡å¥½ä½ çš„å®¢æˆ·ï¼Œä¹‹åå†æƒ³æ€ä¹ˆå›é¦ˆç¤¾ä¼šã€‚çŠ¯è¶³å¤Ÿå¤šçš„é”™ï¼Œå¹´è½»æ—¶èµ°è¿‡çš„å¼¯è·¯æ˜¯æœ€æ£’çš„æ”¶è·ã€‚ é©¬äº‘è¿˜æ›¾ç»è¯´è¿‡â€œä»Šå¤©å¾ˆè‰°éš¾ï¼Œæ˜å¤©æ¯”ä»Šå¤©æ›´éš¾ï¼Œåå¤©å¯èƒ½æ˜¯ç¾å¥½çš„ï¼Œä½†æ›´å¤šçš„äººæ­»åœ¨äº†æ˜å¤©â€ã€‚æ˜¯ä¸æ˜¯æ„Ÿåˆ°è†ç›–ä¸­ç®­äº†ï¼Ÿä¸å¦¨å¹²äº†è¿™ç¢—â€œæ¯’é¸¡æ±¤â€ã€‚æˆåŠŸçš„æ³•åˆ™æœ¬å°±å¹¶éåƒç¯‡ä¸€å¾‹ï¼Œä½ ä¼šæœ‰ä½ è‡ªå·±å‘ä¸Šçš„å­¦é—®ã€‚é‚£ä¸å¦‚ä»æ˜å¤©å¼€å§‹ï¼Œå»æ‘¸ç´¢ï¼Œå»è·µè¡Œï¼Œå“ªæ€•åªæ¯”æ˜¨å¤©çš„ä½ å¤šè¿ˆå‡º0.01æ­¥ã€‚ é€ç»™æ­£åœ¨æ‰¾å®ä¹ å·¥ä½œçš„è‡ªå·±ï¼åŠ æ²¹ï¼ï¼ï¼","tags":[{"name":"åŠ±å¿—","slug":"åŠ±å¿—","permalink":"http://www.54tianzhisheng.cn/tags/åŠ±å¿—/"}]},{"title":"æºç å¤§æ‹›ï¼šä¸æœæ¥æˆ˜ï¼æ’¸è¿™äº›å®Œæ•´é¡¹ç›®ï¼Œä½ ä¸ç‰›é€¼éƒ½éš¾ï¼","date":"2017-08-07T16:00:00.000Z","path":"2017/08/08/android-projects/","text":"ç»å¸¸æœ‰äººé—®æˆ‘æœ‰æ²¡æœ‰ä»€ä¹ˆé¡¹ç›®ä»£ç ï¼Œæˆ‘å›å¤è¯´å» Github æ‰¾ï¼Œä½†æ˜¯è¿˜æ˜¯å¥½å¤šäººä¸çŸ¥é“å¦‚ä½•æ‰¾åˆ°é‚£äº›æ¯”è¾ƒå¥½çš„é¡¹ç›®ã€‚ ä»Šå¤©èŠ±äº†ç‚¹æ—¶é—´æ‰¾äº†äº›å®‰å“çš„é¡¹ç›®ï¼Œè§‰å¾—è¿˜æ˜¯ä¸é”™çš„ï¼Œå‡ ä¹å°±æ˜¯è‡ªå·±ç”Ÿæ´»å¸¸ç”¨çš„ä¸€äº› app ï¼Œå¦‚æœä½ æ˜¯ä¸€ä¸ª Android å¼€å‘è€…ï¼Œæˆ‘è§‰å¾—æ’¸å®Œè¿™äº›é¡¹ç›®ï¼Œä½ æƒ³ä¸ç‰›é€¼éƒ½éš¾ã€‚ å…³æ³¨æˆ‘ èœé¸Ÿæ–°é—»èœé¸Ÿæ–°é—» å®¢æˆ·ç«¯æ˜¯ä¸€ä¸ªä»¿ç…§36Krå®˜æ–¹,å® æ—¶æŠ“å–36Krå®˜ç½‘æ•°æ®çš„èµ„è®¯ç±»æ–°é—»å®¢æˆ·ç«¯ã€‚ åŒ…æ‹¬é¦–é¡µæ–°é—»,è¯¦æƒ…,å‘ç°,æ´»åŠ¨,å®æ—¶æ•°æ®æŠ“å–,ä¾§æ»‘æ•ˆæœ,ç¬¬ä¸‰æ–¹ç™»å½•ä»¥åŠåˆ†äº«,æ¶ˆæ¯æ¨é€ç­‰ç›¸å…³åŠŸèƒ½å®¢æˆ·ç«¯ã€‚ è¯¾ç¨‹åœ°å€ï¼š http://www.cniao5.com/clazz/view/10076.htmlè§†é¢‘ä¸‹è½½é“¾æ¥ï¼š http://pan.baidu.com/s/1eQLyQxc å¯†ç ï¼š3ts1 é¡¹ç›®æºç ä¸‹è½½åœ°å€ï¼šhttps://github.com/yxs666/cniao5-news è¿è¡Œæˆªå›¾: .gif) KuaiChuanä»¿èŒ„å­å¿«ä¼ çš„ä¸€æ¬¾æ–‡ä»¶ä¼ è¾“åº”ç”¨ï¼Œ æ¶‰åŠåˆ°Socketé€šä¿¡ï¼ŒåŒ…æ‹¬TCPï¼ŒUDPé€šä¿¡ é¡¹ç›®æºç ï¼šhttps://github.com/mayubao/KuaiChuan è¿è¡Œæˆªå›¾ï¼š CoolShoppingä¸€ä¸ªä»¿æ‹‰æ‰‹å›¢è´­çš„è´­ç‰©Appï¼Œé‡‡ç”¨Bmobåå°å®ç°çŸ­ä¿¡éªŒè¯ç æ³¨å†Œã€ç™»å½•ã€æ”¶è—ã€è®¢å•ç®¡ç†ã€è‡ªåŠ¨æ›´æ–°ç­‰åŠŸèƒ½ï¼Œæ•°æ®æŠ“å–è‡ªæ‹‰æ‰‹å›¢è´­ é¡¹ç›®åœ°å€ï¼šhttps://github.com/myxh/CoolShopping è¿è¡Œæˆªå›¾ï¼š RNPolymerPoRNPolymerPo æ˜¯ä¸€ä¸ªåŸºäº React Native çš„ç”Ÿæ´»ç±»èšåˆå®æˆ˜é¡¹ç›®ï¼Œç›®å‰ç”±äºæ²¡æœ‰ MAC è®¾å¤‡ï¼Œæ‰€ä»¥æ²¡æœ‰é€‚é… iOSï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥è‡ªè¡Œé€‚é… app ç›®å½•ä¸‹ç›¸å…³ JS ä»£ç å³å¯ã€‚ é¡¹ç›®åœ°å€ï¼šhttps://github.com/yanbober/RNPolymerPo è¿è¡Œæˆªå›¾ï¼š bilibiliä»¿ bilibili çš„å®¢æˆ·ç«¯ é¡¹ç›®åœ°å€ï¼šhttps://github.com/HotBitmapGG/bilibili-android-client è¿è¡Œæˆªå›¾ï¼š StockCharté‡‡ç”¨ä¸»æµrxjava+retrofit+dagger2æ¡†æ¶ï¼ŒStockChartçœ‹è‚¡ç¥¨çš„åˆ†æ—¶å›¾ï¼Œkçº¿å›¾ã€‚ é¡¹ç›®åœ°å€ï¼šhttps://github.com/AndroidJiang/StockChart Androidç²¾å‡†è®¡æ­¥å™¨é¡¹ç›®åœ°å€ï¼šhttps://github.com/linglongxin24/DylanStepCount è¿è¡Œæˆªå›¾ï¼š èœé¸Ÿå¾®åšèœé¸Ÿå¾®åšã€Šé€šè¿‡å¯¹æ–°æµªå¾®åšå¼€å‘æ¡ˆä¾‹çš„è¯¦ç»†è§£æï¼Œè®²è§£äº†ä¸€ä¸ªå®Œæ•´çš„ Android å®é™…é¡¹ç›®çš„å¼€å‘è¿‡ç¨‹ã€‚ æœ‰æ–°æµªå¾®åšçš„ä¸»è¦åŠŸèƒ½ï¼Œæœ‰Toolbar,RecyclerViewç­‰æœ€æ–°æ§ä»¶çš„ç”¨æ³•ï¼›å„ç§å¿«é€Ÿå¼€å‘æ¡†æ¶çš„ä½¿ç”¨ï¼Œæ¯”å¦‚ Glide,PhotoView ï¼ŒEventBus ï¼ŒOKHttpï¼ŒpullToRefreshç­‰ã€‚ å­¦ä¹ è§†é¢‘+æºç  è§†é¢‘ä¸­è¿˜ä¼šè®²åˆ°MVPè®¾è®¡æ¨¡å¼ä»¥åŠä¸€äº›æ¶æ„å¸ˆçš„å…¥é—¨çŸ¥è¯†ã€‚ è¯¾ç¨‹åœ°å€ï¼š http://www.cniao5.com/clazz/view/10075.htmlè§†é¢‘ä¸‹è½½é“¾æ¥ï¼š http://pan.baidu.com/s/1gexq3VP å¯†ç ï¼šf0t9 é¡¹ç›®åœ°å€ï¼šhttps://github.com/yxs666/cniao5-weibo è¿è¡Œæˆªå›¾ï¼š åœ¨çº¿äº‘æ‰“å°å¹³å°ä¸€ä¸ªåœ¨çº¿äº‘æ‰“å°å¹³å°ï¼ˆandroidéƒ¨åˆ†ï¼‰å«è®¢å•ç®¡ç†ã€ç™¾åº¦åœ°å›¾ã€äºŒç»´ç ç­‰ç­‰ é¡¹ç›®åœ°å€ï¼šhttps://github.com/LehmanHe/A4print è¿è¡Œæˆªå›¾ï¼š é“œæ¿è¡—é¡¹ç›®åœ°å€ï¼šhttps://github.com/robotlife/TongBanJie è¿è¡Œæˆªå›¾ï¼š ç¤¼ç‰©è¯´é¡¹ç›®åœ°å€ï¼šhttps://github.com/Orangelittle/Liwusuo IotXmppæœ¬é¡¹ç›®æ˜¯åŸºäºXMPPçš„ç‰©è”ç½‘å®¢æˆ·ç«¯è½¯ä»¶çš„å®ç°ï¼Œå…¶å®ç°çš„ä¸»è¦åŠŸèƒ½æ˜¯ä¸€æ¬¾èƒ½å’Œç‰©è”ç½‘èŠ‚ç‚¹äº¤äº’çš„å³æ—¶é€šè®¯è½¯ä»¶ã€‚ç›®å‰æ”¯æŒä¹ç±»ä¼ æ„Ÿå™¨èŠ‚ç‚¹äº¤äº’ï¼Œä¸»è¦æœ‰ï¼šæ¸©æ¹¿åº¦ã€é£æ‰‡ã€ç›´æµç”µæœºã€LEDç¯ã€æ­¥è¿›ç”µæœºã€é—¨ç£ã€å…‰ç”µæ¥è¿‘ã€çƒŸé›¾å’Œå…‰ç…§ã€‚æœ¬è½¯ä»¶ä¸ä»…èƒ½å’Œè¿™äº›ä¼ æ„Ÿå™¨èŠ‚ç‚¹äº¤äº’ï¼Œè¿˜å®ç°äº†ç±»ä¼¼å¾®ä¿¡çš„è®¢é˜…å’Œå–æ¶ˆè®¢é˜…åŠŸèƒ½ã€‚å½“è®¢é˜…ä¸€ä¸ªèŠ‚ç‚¹åèŠ‚ç‚¹å°±ä¼šæŒ‰ç…§è®¾å®šå¥½çš„å‘¨æœŸå‘å®¢æˆ·ç«¯æ±‡æŠ¥æ•°æ®ï¼Œå®¢æˆ·ç«¯ä¹Ÿèƒ½è®¾ç½®å‘¨æœŸã€è®¾ç½®æŠ¥è­¦ä¸Šä¸‹é™ç­‰ã€‚è¿™äº›åŠŸèƒ½çš„å®ç°æå¤§çš„æ–¹ä¾¿äº†æˆ‘ä»¬å’Œç‰©è”ç½‘èŠ‚ç‚¹çš„äº¤äº’ã€‚ é¡¹ç›®åœ°å€ï¼šhttps://github.com/tiandawu/IotXmpp é¡¹ç›®æˆªå›¾ï¼š Livesç”Ÿæ´»å¨±ä¹ç»“åˆçš„APP, ç°æœ‰ä¸»è¦åŠŸèƒ½ï¼š å›¾ä¹¦ ç¿»è¯‘ éŸ³ä¹ è§†é¢‘ é¡¹ç›®åœ°å€ï¼šhttps://github.com/Allyns/Lives é¡¹ç›®æˆªå›¾ï¼š CoCoinä¸€æ¬¾å¤šè§†å›¾è®°è´¦APP é¡¹ç›®åœ°å€ï¼šhttps://github.com/Nightonke/CoCoin è¿è¡Œæˆªå›¾ï¼š AppLockAppLockåº”ç”¨é”ï¼Œä¿æŠ¤ä½ çš„éšç§ é¡¹ç›®åœ°å€ï¼šhttps://github.com/lizixian18/AppLock è¿è¡Œæˆªå›¾ï¼š jianshi ç®€è¯—ä¸€æ¬¾ä¼˜é›…çš„ä¸­å›½é£Android Appï¼ŒåŒ…æ‹¬Androidç«¯å’ŒServerç«¯ï¼Œæ”¯æŒç™»å½•æ³¨å†Œï¼Œæ•°æ®äº‘ç«¯åŒæ­¥ï¼Œç¦»çº¿æ•°æ®å­˜å‚¨å’Œæˆªå±åˆ†äº«ç­‰åŠŸèƒ½ã€‚ é¡¹ç›®åœ°å€ï¼š è¿è¡Œæˆªå›¾ï¼š storage-chooserä¸€æ¬¾æ–‡ä»¶ç®¡ç†å™¨app é¡¹ç›®åœ°å€ï¼šhttps://github.com/codekidX/storage-chooser è¿è¡Œæˆªå›¾ï¼š LQRWeChatä»¿æœ€æ–°ç‰ˆå¾®ä¿¡6.5.7ï¼ˆé™¤å›¾ç‰‡é€‰æ‹©å™¨å¤–ï¼‰ã€‚æœ¬é¡¹ç›®åŸºäºèäº‘SDKï¼Œä½¿ç”¨ç›®å‰è¾ƒç«çš„ Rxjava+Retrofit+MVP+Glide æŠ€æœ¯å¼€å‘ã€‚ç›¸æ¯”ä¸Šä¸ªç‰ˆæœ¬ï¼ŒåŠ å…¥å‘é€ä½ç½®æ¶ˆæ¯ï¼Œçº¢åŒ…æ¶ˆæ¯ç­‰åŠŸèƒ½ã€‚ é¡¹ç›®åœ°å€ï¼šhttps://github.com/GitLqr/LQRWeChat è¿è¡Œæˆªå›¾ï¼š PonyExpress å°é©¬å¿«é€’å°é©¬å¿«é€’ï¼Œæ‚¨çš„å¥½å¸®æ‰‹ã€‚æŸ¥è¯¢å¹¶è·Ÿè¸ªå¿«é€’ï¼Œå¿«é€’ä¿¡æ¯åŠæ—¶æŒæ¡ã€‚æ”¯æŒå…¨å›½100å¤šå®¶å¿«é€’å…¬å¸ï¼Œæ”¯æŒæ‰«ç æŸ¥è¯¢ï¼Œæ™ºèƒ½è¯†åˆ«å¿«é€’å…¬å¸ã€‚é™„å¸¦ç”ŸæˆäºŒç»´ç å°å·¥å…·ï¼Œæ–¹ä¾¿å®ç”¨ã€‚ä½“ç§¯å°å·§ï¼Œæ— å¹¿å‘Šï¼Œæ— å¤šä½™æƒé™ã€‚ é¡¹ç›®åœ°å€ï¼šhttps://github.com/wangchenyan/PonyExpress è¿è¡Œæˆªå›¾ï¼š CloudReader äº‘é˜…ä¸€æ¬¾åŸºäºç½‘æ˜“äº‘éŸ³ä¹UIï¼Œä½¿ç”¨Gank.IoåŠè±†ç“£apiå¼€å‘çš„ç¬¦åˆGoogle Material Designçš„Androidå®¢æˆ·ç«¯ã€‚é¡¹ç›®é‡‡å–çš„æ˜¯MVVM-DataBindingæ¶æ„å¼€å‘ï¼Œç°ä¸»è¦åŒ…æ‹¬ï¼šå¹²è´§åŒºã€ç”µå½±åŒºå’Œä¹¦ç±åŒºä¸‰ä¸ªå­æ¨¡å—ã€‚DIYç½‘æ˜“äº‘éŸ³ä¹åŸæ¥æ˜¯å¦‚æ­¤Cool é¡¹ç›®åœ°å€ï¼šhttps://github.com/youlookwhat/CloudReader è¿è¡Œæˆªå›¾ï¼š ç¡…è°·å•†åŸæ˜¯ä¸€æ¬¾æŒ‰ç…§ä¼ä¸šçº§æ ‡å‡†ç ”å‘çš„é¡¹ç›®ã€‚æœ¬å¥—ä»£ç æ˜¯ç›®å‰å›½å†…å¸‚åœºç¬¬ä¸€å¥—è¯¦ç»†è®²è§£å•†åŸç±»é¡¹ç›®çš„å…è´¹ä»£ç ã€‚è¯¥ä»£ç ä¸­çš„å†…å®¹åŒ…æ‹¬ä½†ä¸ä»…é™äºï¼Œæ¡†æ¶çš„æ­å»º ã€ä¸»é¡µæ¨¡å—ã€åˆ†ç±»æ¨¡å—ã€å‘ç°æ¨¡å—ã€è´­ç‰©è½¦æ¨¡å—å’Œä¸ªäººä¸­å¿ƒæ¨¡å—ã€‚é¡¹ç›®ä¸­è®²è§£çš„ä¸»æµæŠ€æœ¯åŒ…æ‹¬ä¸”ä¸é™äºRadioGroup + Fragmentã€OKHttpã€FastJsonã€RecyclerViewã€ ScrollViewContainerã€Bannerã€å€’è®¡æ—¶ç§’æ€ã€è‡ªå®šä¹‰è´­ç‰©è½¦ã€æ”¯ä»˜å®ç­‰æŠ€æœ¯ã€‚è¯¥é¡¹ç›®ä¸­è®²è§£çš„æŠ€æœ¯å¯åº”ç”¨åœ¨ç”µå•†ã€æ–°é—»ã€æ—…æ¸¸ã€åŒ»ç–—ã€åœ¨çº¿æ•™è‚²ç­‰é¢†åŸŸã€‚ é¡¹ç›®åœ°å€ï¼šhttps://github.com/atguigu01/Shopping è¿è¡Œæˆªå›¾ï¼š è§‰å¾—æ£’çš„ï¼Œæ¬¢è¿ç‚¹èµå’Œè½¬å‘åˆ†äº«ï¼Œè°¢è°¢å¤§å®¶ï¼è½¬è½½çš„è¯æ³¨æ˜æ¥æºåœ°å€ä¸º www.54tianzhisheng.cn/2017/05/13/android-projects/ å³å¯ã€‚","tags":[{"name":"Android","slug":"Android","permalink":"http://www.54tianzhisheng.cn/tags/Android/"}]},{"title":"Nginx åŸºæœ¬çŸ¥è¯†å¿«é€Ÿå…¥é—¨","date":"2017-08-04T16:00:00.000Z","path":"2017/08/05/Nginx/","text":"ä»€ä¹ˆæ˜¯ Nginxï¼ŸNginx æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ HTTP å’Œåå‘ä»£ç†æœåŠ¡å™¨ï¼Œä»¥é«˜ç¨³å®šæ€§ã€ä¸°å¯Œçš„åŠŸèƒ½é›†ã€ç¤ºä¾‹é…ç½®æ–‡ä»¶å’Œä½ç³»ç»Ÿèµ„æºçš„æ¶ˆè€—è€Œé—»åã€‚ Nginx ç‰¹ç‚¹ å¤„ç†é™æ€æ–‡ä»¶ï¼Œç´¢å¼•æ–‡ä»¶ä»¥åŠè‡ªåŠ¨ç´¢å¼•ï¼›æ‰“å¼€æ–‡ä»¶æè¿°ç¬¦ç¼“å†²ï¼ æ— ç¼“å­˜çš„åå‘ä»£ç†åŠ é€Ÿï¼Œç®€å•çš„è´Ÿè½½å‡è¡¡å’Œå®¹é”™ï¼ FastCGIï¼Œç®€å•çš„è´Ÿè½½å‡è¡¡å’Œå®¹é”™ï¼ æ¨¡å—åŒ–çš„ç»“æ„ã€‚åŒ…æ‹¬ gzipping, byte ranges, chunked responses,ä»¥åŠ SSI-filter ç­‰ filterã€‚å¦‚æœç”± FastCGI æˆ–å…¶å®ƒä»£ç†æœåŠ¡å™¨å¤„ç†å•é¡µä¸­å­˜åœ¨çš„å¤šä¸ª SSIï¼Œåˆ™è¿™é¡¹å¤„ç†å¯ä»¥å¹¶è¡Œè¿è¡Œï¼Œè€Œä¸éœ€è¦ç›¸äº’ç­‰å¾…ã€‚ æ”¯æŒ SSL å’Œ TLSSNIï¼ ä¸»è¦åº”ç”¨åœºåˆ1ã€é™æ€ HTTP æœåŠ¡å™¨é¦–å…ˆï¼ŒNginxæ˜¯ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œå¯ä»¥å°†æœåŠ¡å™¨ä¸Šçš„é™æ€æ–‡ä»¶ï¼ˆå¦‚ HTMLã€å›¾ç‰‡ï¼‰é€šè¿‡ HTTP åè®®å±•ç°ç»™å®¢æˆ·ç«¯ã€‚ é…ç½®ï¼š 123456server &#123; listen 80; # ç«¯å£å· location / &#123; root /usr/share/nginx/html; # é™æ€æ–‡ä»¶è·¯å¾„ &#125;&#125; 2ã€åå‘ä»£ç†æœåŠ¡å™¨ä»€ä¹ˆæ˜¯åå‘ä»£ç†ï¼Ÿ å®¢æˆ·ç«¯æœ¬æ¥å¯ä»¥ç›´æ¥é€šè¿‡ HTTP åè®®è®¿é—®æŸç½‘ç«™åº”ç”¨æœåŠ¡å™¨ï¼Œå¦‚æœç½‘ç«™ç®¡ç†å‘˜åœ¨ä¸­é—´åŠ ä¸Šä¸€ä¸ª Nginxï¼Œå®¢æˆ·ç«¯è¯·æ±‚Nginxï¼ŒNginx è¯·æ±‚åº”ç”¨æœåŠ¡å™¨ï¼Œç„¶åå°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œæ­¤æ—¶ Nginx å°±æ˜¯åå‘ä»£ç†æœåŠ¡å™¨ã€‚ é…ç½®ï¼š 123456server &#123; listen 80; location / &#123; proxy_pass http://192.168.20.1:8080; # åº”ç”¨æœåŠ¡å™¨HTTPåœ°å€ &#125;&#125; æ—¢ç„¶æœåŠ¡å™¨å¯ä»¥ç›´æ¥ HTTP è®¿é—®ï¼Œä¸ºä»€ä¹ˆè¦åœ¨ä¸­é—´åŠ ä¸Šä¸€ä¸ªåå‘ä»£ç†ï¼Œä¸æ˜¯å¤šæ­¤ä¸€ä¸¾å—ï¼Ÿåå‘ä»£ç†æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿç»§ç»­å¾€ä¸‹çœ‹ï¼Œä¸‹é¢çš„è´Ÿè½½å‡è¡¡ã€è™šæ‹Ÿä¸»æœºï¼Œéƒ½åŸºäºåå‘ä»£ç†å®ç°ï¼Œå½“ç„¶åå‘ä»£ç†çš„åŠŸèƒ½ä¹Ÿä¸ä»…ä»…æ˜¯è¿™äº›ã€‚ 3ã€è´Ÿè½½å‡è¡¡å½“ç½‘ç«™è®¿é—®é‡éå¸¸å¤§ï¼Œç½‘ç«™ç«™é•¿å¼€å¿ƒèµšé’±çš„åŒæ—¶ï¼Œä¹Ÿæ‘Šä¸Šäº‹å„¿äº†ã€‚å› ä¸ºç½‘ç«™è¶Šæ¥è¶Šæ…¢ï¼Œä¸€å°æœåŠ¡å™¨å·²ç»ä¸å¤Ÿç”¨äº†ã€‚äºæ˜¯å°†ç›¸åŒçš„åº”ç”¨éƒ¨ç½²åœ¨å¤šå°æœåŠ¡å™¨ä¸Šï¼Œå°†å¤§é‡ç”¨æˆ·çš„è¯·æ±‚åˆ†é…ç»™å¤šå°æœºå™¨å¤„ç†ã€‚åŒæ—¶å¸¦æ¥çš„å¥½å¤„æ˜¯ï¼Œå…¶ä¸­ä¸€å°æœåŠ¡å™¨ä¸‡ä¸€æŒ‚äº†ï¼Œåªè¦è¿˜æœ‰å…¶ä»–æœåŠ¡å™¨æ­£å¸¸è¿è¡Œï¼Œå°±ä¸ä¼šå½±å“ç”¨æˆ·ä½¿ç”¨ã€‚ å½“æˆ‘ä»¬ç½‘ç«™è¿›è¡Œå¤§çš„å‡çº§æ›´æ–°æ—¶ï¼Œæˆ‘ä»¬ä¸å¯èƒ½ç›´æ¥å°†æ‰€æœ‰çš„æœåŠ¡å™¨éƒ½å…³æ‰ï¼Œç„¶åå†å‡çº§çš„ã€‚é€šå¸¸æˆ‘ä»¬éƒ½æ˜¯æ‰¹é‡çš„å…³æ‰ä¸€äº›æœåŠ¡å™¨ï¼Œå»å‡çº§ç½‘ç«™ï¼Œå½“æœ‰ç”¨æˆ·çš„è¯·æ±‚æ—¶åˆ™åˆ†é…ç»™å…¶ä»–è¿˜åœ¨è¿ä½œçš„æœºå™¨å¤„ç†ã€‚å½“ä¹‹å‰å…³æ‰çš„æœºå™¨æ›´æ–°å®Œæˆåï¼Œå†æ¬¡å¼€å¯ï¼Œç„¶ååˆæ‰¹é‡å…³æ‰éƒ¨åˆ†æœºå™¨ï¼Œå¦‚ä¸Šå¾ªç¯ï¼Œç›´åˆ°æœ€åå…¨éƒ¨æœºå™¨éƒ½æ›´æ–°å®Œæˆã€‚è¿™æ ·å°±ä¸ä¼šå½±å“ç”¨æˆ·ä½¿ç”¨ã€‚ Nginx å¯ä»¥é€šè¿‡åå‘ä»£ç†æ¥å®ç°è´Ÿè½½å‡è¡¡ã€‚ é…ç½®ï¼š 12345678910upstream myapp &#123; server 192.168.20.1:8080; # åº”ç”¨æœåŠ¡å™¨1 server 192.168.20.2:8080; # åº”ç”¨æœåŠ¡å™¨2&#125;server &#123; listen 80; location / &#123; proxy_pass http://myapp; &#125;&#125; 4ã€è™šæ‹Ÿä¸»æœºç½‘ç«™è®¿é—®é‡å¤§ï¼Œéœ€è¦è´Ÿè½½å‡è¡¡ã€‚ç„¶è€Œå¹¶ä¸æ˜¯æ‰€æœ‰ç½‘ç«™éƒ½å¦‚æ­¤å‡ºè‰²ï¼Œæœ‰çš„ç½‘ç«™ï¼Œç”±äºè®¿é—®é‡å¤ªå°ï¼Œéœ€è¦èŠ‚çœæˆæœ¬ï¼Œå°†å¤šä¸ªç½‘ç«™éƒ¨ç½²åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šã€‚ ä¾‹å¦‚å°† www.aaa.com å’Œ www.bbb.com ä¸¤ä¸ªç½‘ç«™éƒ¨ç½²åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šï¼Œä¸¤ä¸ªåŸŸåè§£æåˆ°åŒä¸€ä¸ª IP åœ°å€ï¼Œä½†æ˜¯ç”¨æˆ·é€šè¿‡ä¸¤ä¸ªåŸŸåå´å¯ä»¥æ‰“å¼€ä¸¤ä¸ªå®Œå…¨ä¸åŒçš„ç½‘ç«™ï¼Œäº’ç›¸ä¸å½±å“ï¼Œå°±åƒè®¿é—®ä¸¤ä¸ªæœåŠ¡å™¨ä¸€æ ·ï¼Œæ‰€ä»¥å«ä¸¤ä¸ªè™šæ‹Ÿä¸»æœºã€‚ é…ç½®ï¼š 12345678910111213141516171819server &#123; listen 80 default_server; server_name _; return 444; # è¿‡æ»¤å…¶ä»–åŸŸåçš„è¯·æ±‚ï¼Œè¿”å›444çŠ¶æ€ç &#125;server &#123; listen 80; server_name www.aaa.com; # www.aaa.comåŸŸå location / &#123; proxy_pass http://localhost:8080; # å¯¹åº”ç«¯å£å·8080 &#125;&#125;server &#123; listen 80; server_name www.bbb.com; # www.bbb.comåŸŸå location / &#123; proxy_pass http://localhost:8081; # å¯¹åº”ç«¯å£å·8081 &#125;&#125; åœ¨æœåŠ¡å™¨ 8080 å’Œ 8081 ä¸¤ä¸ªç«¯å£åˆ†åˆ«å¼€äº†ä¸€ä¸ªåº”ç”¨ï¼Œå®¢æˆ·ç«¯é€šè¿‡ä¸åŒçš„åŸŸåè®¿é—®ï¼Œæ ¹æ® server_name å¯ä»¥åå‘ä»£ç†åˆ°å¯¹åº”çš„åº”ç”¨æœåŠ¡å™¨ã€‚ è™šæ‹Ÿä¸»æœºçš„åŸç†æ˜¯é€šè¿‡ HTTP è¯·æ±‚å¤´ä¸­çš„ Host æ˜¯å¦åŒ¹é… server_name æ¥å®ç°çš„ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥ç ”ç©¶ä¸€ä¸‹ HTTP åè®®ã€‚ å¦å¤–ï¼Œserver_name é…ç½®è¿˜å¯ä»¥è¿‡æ»¤æœ‰äººæ¶æ„å°†æŸäº›åŸŸåæŒ‡å‘ä½ çš„ä¸»æœºæœåŠ¡å™¨ã€‚ 5ã€FastCGINginx æœ¬èº«ä¸æ”¯æŒ PHP ç­‰è¯­è¨€ï¼Œä½†æ˜¯å®ƒå¯ä»¥é€šè¿‡ FastCGI æ¥å°†è¯·æ±‚æ‰”ç»™æŸäº›è¯­è¨€æˆ–æ¡†æ¶å¤„ç†ï¼ˆä¾‹å¦‚ PHPã€Pythonã€Perlï¼‰ã€‚ 123456789server &#123; listen 80; location ~ \\.php$ &#123; include fastcgi_params; fastcgi_param SCRIPT_FILENAME /PHPæ–‡ä»¶è·¯å¾„$fastcgi_script_name; # PHPæ–‡ä»¶è·¯å¾„ fastcgi_pass 127.0.0.1:9000; # PHP-FPMåœ°å€å’Œç«¯å£å· # å¦ä¸€ç§æ–¹å¼ï¼šfastcgi_pass unix:/var/run/php5-fpm.sock; &#125;&#125; é…ç½®ä¸­å°† .php ç»“å°¾çš„è¯·æ±‚é€šè¿‡ FashCGI äº¤ç»™ PHP-FPM å¤„ç†ï¼ŒPHP-FPM æ˜¯ PHP çš„ä¸€ä¸ª FastCGI ç®¡ç†å™¨ã€‚æœ‰å…³FashCGI å¯ä»¥æŸ¥é˜…å…¶ä»–èµ„æ–™ï¼Œæœ¬æ–‡ä¸å†ä»‹ç»ã€‚ fastcgi_pass å’Œ proxy_pass æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä¸‹é¢ä¸€å¼ å›¾å¸¦ä½ çœ‹æ˜ç™½ï¼š å‚è€ƒèµ„æ–™1ã€NginxåŸºæœ¬åŠŸèƒ½æé€Ÿå…¥é—¨ 2ã€Nginx å­¦ä¹ ç¬”è®°","tags":[{"name":"Nginx","slug":"Nginx","permalink":"http://www.54tianzhisheng.cn/tags/Nginx/"}]},{"title":"ç§‹æ‹›ç¬¬ä¸‰ç«™ â€”â€” å†…æ¨é˜¿é‡Œï¼ˆä¸€é¢ï¼‰","date":"2017-08-03T16:00:00.000Z","path":"2017/08/04/alibaba/","text":"3ã€é˜¿é‡Œå·´å·´ï¼ˆèœé¸Ÿç½‘ç»œéƒ¨é—¨ï¼‰ï¼ˆä¸€é¢ 49 åˆ†é’Ÿï¼‰2017.08.02 æ™šä¸Š9ç‚¹21æ‰“ç”µè¯è¿‡æ¥ï¼Œé¢„çº¦æ˜å¤©ä»€ä¹ˆæ—¶å€™æœ‰ç©ºé¢è¯•ï¼Œçº¦å¥½ç¬¬äºŒå¤©ä¸‹åˆä¸¤ç‚¹ã€‚ 2017.08.03 ä¸‹åˆä¸¤ç‚¹10åˆ†æ‰“è¿‡æ¥äº†ã€‚ è¯´çœ‹äº†æˆ‘çš„åšå®¢å’Œ GitHubï¼Œè§‰å¾—æˆ‘å­¦çš„è¿˜è¡Œï¼ŒçŸ¥è¯†å¹¿åº¦éƒ½è¿˜ä¸é”™ï¼Œä½†æ˜¯è¿˜æ˜¯è¦é—®é—®å…·ä½“æƒ…å†µï¼Œä¸ºä»€ä¹ˆæ²¡çœ‹åˆ°ä½ æ˜¥æ‹›çš„è®°å½•ï¼Œä»€ä¹ˆåŸå› æ²¡æŠ•é˜¿é‡Œï¼Ÿéå¾—è¯´ä¸€ä¸ªåŸå› ï¼Œé‚£å°±æ˜¯ï¼šæˆ‘è‡ªå·±å¤ªèœäº†ï¼Œä¸æ•¢æŠ•ã€‚1ã€å…ˆè‡ªæˆ‘ä»‹ç» 2ã€ä»€ä¹ˆæ˜¯å¤šæ€ï¼Ÿå“ªé‡Œä½“ç°äº†å¤šæ€çš„æ¦‚å¿µï¼Ÿ 3ã€HashMap æºç åˆ†æï¼ŒæŠŠé‡Œé¢çš„ä¸œè¥¿é—®äº†ä¸ªéï¼Ÿæœ€åé—®æ˜¯ä¸æ˜¯çº¿ç¨‹å®‰å…¨ï¼Ÿå¼•å‡º ConcurrentHashMap 4ã€ConcurrentHashMap æºç åˆ†æ 5ã€ç±»åŠ è½½ï¼ŒåŒäº²å§”æ‰˜æœºåˆ¶ 6ã€Javaå†…å­˜æ¨¡å‹ï¼ˆä¸€å¼€å§‹è¯´çš„ä¸æ˜¯ä»–æƒ³è¦çš„ï¼Œä¸»è¦æƒ³é—®æˆ‘å †å’Œæ ˆçš„ç»†èŠ‚ï¼‰ 7ã€åƒåœ¾å›æ”¶ç®—æ³• 8ã€çº¿ç¨‹æ± ï¼Œè‡ªå·±ä¹‹å‰çœ‹è¿‡ï¼Œæ‰€ä»¥è¯´çš„æ¯”è¾ƒå¤šï¼Œæœ€åé¢è¯•å®˜è¯´äº†å¥ï¼šçœ‹ä½ å¯¹çº¿ç¨‹æ± äº†è§£è¿˜æ˜¯å¾ˆæ·±äº† 9ã€äº‹åŠ¡çš„å››ç§ç‰¹æ€§ 10ã€ä»€ä¹ˆæ˜¯æ­»é”ï¼Ÿ 11ã€ä¹è§‚é”å’Œæ‚²è§‚é”çš„ç­–ç•¥ 12ã€é«˜å¯ç”¨ç½‘ç«™çš„è®¾è®¡ï¼ˆæœ‰ä»€ä¹ˆæŠ€æœ¯å®ç°ï¼‰ 13ã€ä½è€¦åˆé«˜å†…èš 14ã€è®¾è®¡æ¨¡å¼äº†è§£ä¸ï¼Ÿä½ ç”¨è¿‡å“ªå‡ ç§ï¼Œä¸ºä»€ä¹ˆç”¨ï¼Œå•ä¾‹æ¨¡å¼å¸®æˆ‘ä»¬åšä»€ä¹ˆä¸œè¥¿ï¼Ÿæœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ 15ã€ä½ å‚ä¸ä»€ä¹ˆé¡¹ç›®ä¸­æˆé•¿æ¯”è¾ƒå¿«ï¼Ÿå­¦åˆ°äº†ä»€ä¹ˆä¸œè¥¿ï¼Œä»¥å‰æ˜¯æ²¡æœ‰å­¦è¿‡çš„ï¼Ÿ 16ã€é¡¹ç›®ä¸­é‡åˆ°çš„æœ€å¤§å›°éš¾æ˜¯æ€æ ·çš„ï¼Ÿæ˜¯æ€ä¹ˆè§£å†³çš„ï¼Ÿ 17ã€æ™ºåŠ›é¢˜ï¼ˆä¸¤æ ¹ä¸å‡åŒ€çš„é¦™ï¼Œç‚¹ä¸€å¤´çƒ§å®Œè¦ä¸€ä¸ªå°æ—¶ï¼Œæ€ä¹ˆç¡®å®š15åˆ†é’Ÿï¼‰ 18ã€ä½ æœ‰ä»€ä¹ˆé—®é¢˜æƒ³è¦é—®æˆ‘çš„ï¼Ÿ 19ã€é—®äº†èœé¸Ÿç½‘ç»œä»–ä»¬éƒ¨é—¨ä¸»è¦åšä»€ä¹ˆï¼Ÿ 20ã€å¯¹æˆ‘è¿™æ¬¡é¢è¯•åšä¸ªè¯„ä»·ï¼šçœ‹äº†ä½ åšå®¢å’Œ GitHubï¼ŒçŸ¥é“ä½ å¯¹å­¦ä¹ çš„çƒ­æƒ…è¿˜æ˜¯å¾ˆé«˜çš„ï¼ŒèŠ±äº†ä¸å°‘åŠŸå¤«ï¼Œä½†æ˜¯æœ‰äº›ä¸œè¥¿è¿˜æ˜¯éœ€è¦åŠ å¼ºæ·±åº¦ï¼Œé˜¿é‡Œéœ€è¦é‚£ç§å¯¹æŠ€æœ¯æœ‰æ·±åº¦ï¼Œæœ‰è‡ªå·±ç‹¬åˆ°è§è§£çš„äººæ‰ã€‚æ„æ€å°±æ˜¯ GG äº†ã€‚ æ€»ç»“ï¼šé¢è¯•æ€»çš„æ¥è¯´ï¼Œç¬¬ä¸€æ¬¡ç”µè¯é¢è¯•ï¼Œæ„Ÿè§‰å¥½ç´§å¼ ï¼Œå¥½å¤šé—®é¢˜è‡ªå·±ä¼šç‚¹ï¼Œä½†æ˜¯å…¶ä¸­çš„ç»†èŠ‚æ²¡å¼„æ¸…æ¥šï¼Œè‡ªå·±å‡†å¤‡çš„ä¹Ÿä¸å¤Ÿå……åˆ†ã€‚é¢è¯•å®˜å¾ˆå‹å¥½ï¼Œçœ‹åˆ°æˆ‘ç´§å¼ ï¼Œä¹Ÿå®‰æ…°æˆ‘è¯´ä¸è¦ç´§ï¼Œä¸ç®¡ä»¥åå‡ºå»é¢è¯•å•¥çš„ï¼Œä¸éœ€è¦ç´§å¼ ï¼Œå…¬å¸é—®çš„é—®é¢˜å¯èƒ½å¾ˆå¹¿ï¼Œä½ åªéœ€è¦æŠŠä½ çŸ¥é“çš„è¯´å‡ºæ¥å°±è¡Œï¼Œä¸ä¼šçš„ç›´æ¥è¯´ä¸ä¼šå°±è¡Œã€‚ä¹‹å‰ä¸€ç›´ä¸æ•¢æŠ•é˜¿é‡Œï¼Œå› ä¸ºè‡ªå·±å‡†å¤‡çš„å®Œå…¨ä¸å¤Ÿå……åˆ†ï¼Œä½†æ˜¯åœ¨æœ‹å‹ç£Šå“¥çš„å¸®åŠ©ä¸‹ï¼Œè¿˜æ˜¯è¯•äº†ä¸‹ï¼Œä¸ç®¡ç»“æœæ€ä¹ˆæ ·ï¼Œç»å†è¿‡æ€»æ¯”æ²¡æœ‰çš„å¥½ã€‚","tags":[{"name":"é¢ç»","slug":"é¢ç»","permalink":"http://www.54tianzhisheng.cn/tags/é¢ç»/"}]},{"title":"ç§‹æ‹›ç¬¬äºŒç«™ â€”â€” å†…æ¨çˆ±å¥‡è‰ºï¼ˆä¸€é¢äºŒé¢ï¼‰","date":"2017-08-03T16:00:00.000Z","path":"2017/08/04/iqiyi/","text":"ç¬¬ 2 ç«™ ã€çˆ±å¥‡è‰º åç«¯ Java å¼€å‘å®ä¹ ç”Ÿç¬”è¯•ï¼ˆåŠä¸ªå°æ—¶ï¼‰é¢˜ç›®ï¼šï¼ˆè®°å¾—ä¸€äº›ï¼‰ 1ã€é‡è½½é‡å†™çš„åŒºåˆ«ï¼Ÿ 2ã€è½¬å‘å’Œé‡å®šå‘çš„åŒºåˆ«ï¼Ÿ3ã€ç”»ä¸‹ HashMap çš„ç»“æ„å›¾ï¼ŸHashMap ã€ HashTable å’Œ ConcurrentHashMap çš„åŒºåˆ«ï¼Ÿ 4ã€statement å’Œ preparedstatement åŒºåˆ«ï¼Ÿ 5ã€JSP ä¸­ä¸€ä¸ª ä¸­å–å€¼ä¸ç›´æ¥å–å€¼çš„åŒºåˆ«ï¼Ÿä¼šæœ‰ä»€ä¹ˆå®‰å…¨é—®é¢˜ï¼Ÿ 6ã€å®ç°ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼ 7ã€ä¸€ä¸ªå†™ sql è¯­å¥çš„é¢˜ç›® 8ã€è‡ªå·±å®ç°ä¸€ä¸ª Listï¼Œï¼ˆä¸»è¦å®ç° addç­‰å¸¸ç”¨æ–¹æ³•ï¼‰ 9ã€Spring ä¸­ IOC å’Œ AOP çš„ç†è§£ï¼Ÿ 10ã€ä¸¤ä¸ªå¯¹è±¡çš„ hashcode ç›¸åŒï¼Œæ˜¯å¦å¯¹è±¡ç›¸åŒï¼Ÿequal() ç›¸åŒå‘¢ï¼Ÿ 11ã€@RequestBody å’Œ @ResponseBody åŒºåˆ«ï¼Ÿ 12ã€JVM ä¸€ä¸ªé”™è¯¯ï¼Œä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‘ç”Ÿï¼Ÿ 13ã€å¸¸ç”¨çš„ Linux å‘½ä»¤ï¼Ÿ ç¬¬ä¸€è½®é¢è¯•ï¼ˆ80 åˆ†é’Ÿï¼‰1ã€è‡ªæˆ‘ä»‹ç» 2ã€ä»‹ç»ä½ æœ€ç†Ÿæ‚‰çš„ä¸€ä¸ªé¡¹ç›® 3ã€è®²ä¸‹è¿™ä¸ª XSS æ”»å‡» 4ã€HashMap çš„ç»“æ„ï¼ŸHashMap ã€ HashTable å’Œ ConcurrentHashMap çš„åŒºåˆ«ï¼Ÿ 5ã€HashMap ä¸­æ€ä¹ˆè§£å†³å†²çªçš„ï¼Ÿï¼ˆè¦æˆ‘è¯¦ç»†è®²ä¸‹ï¼‰ 6ã€ConcurrentHashMap å’Œ HashTable ä¸­çº¿ç¨‹å®‰å…¨çš„åŒºåˆ«ï¼Ÿä¸ºå•¥å»ºè®®ç”¨ ConcurrentHashMap ï¼Ÿèƒ½æŠŠ ConcurrentHashMap é‡Œé¢çš„å®ç°è¯¦ç»†çš„è®²ä¸‹å—ï¼Ÿ 7ã€Session å’Œ Cookie çš„åŒºåˆ«ï¼Ÿ 8ã€ä½ é¡¹ç›®ä¸­ç™»å½•æ˜¯æ€æ ·åšçš„ï¼Œç”¨çš„ Cookie å’Œ Sessionï¼Ÿ 9ã€è®²è®²ä½ å¯¹ Spring ä¸­çš„ IOC å’Œ AOP çš„ç†è§£ï¼Ÿ 10ã€é—®äº†å¥½å‡ ä¸ªæ³¨è§£çš„ä½œç”¨ï¼Ÿ 11ã€statement å’Œ preparedstatement åŒºåˆ«ï¼Ÿ 12ã€$ å’Œ # çš„åŒºåˆ«ï¼Ÿä»¥åŠè¿™ä¸¤ä¸ªåœ¨å“ªäº›åœ°æ–¹ç”¨ï¼Ÿ 13ã€å‰é¢é¡¹ç›®ä»‹ç»äº†æ•°æ®æ˜¯çˆ¬è™«çˆ¬å–è¿‡æ¥çš„ï¼Œé‚£ä½ è®²è®²ä½ çš„çˆ¬è™«æ˜¯å¤šçº¿ç¨‹çš„å§ï¼Ÿ 14ã€è®²è®² Python ä¸­çš„å¤šçº¿ç¨‹å’Œ Java ä¸­çš„å¤šçº¿ç¨‹åŒºåˆ«ï¼Ÿ 15ã€è‡ªå·±åˆšå¥½å‰å‡ å¤©åœ¨çœ‹çº¿ç¨‹æ± ï¼Œç«‹é©¬å°±æŠŠé¢è¯•å®˜å¸¦åˆ°æˆ‘ç†Ÿæ‚‰çš„çº¿ç¨‹æ± ï¼Œå’Œé¢è¯•å®˜è®²äº†ä¸‹ JDK è‡ªå¸¦çš„å››ç§çº¿ç¨‹æ± ã€ThreadPoolExecutor ç±»ä¸­çš„æœ€é‡è¦çš„æ„é€ å™¨é‡Œé¢çš„ä¸ƒä¸ªå‚æ•°ï¼Œç„¶åå†è®²äº†ä¸‹çº¿ç¨‹ä»»åŠ¡è¿›å…¥çº¿ç¨‹æ± å’Œæ ¸å¿ƒçº¿ç¨‹æ•°ã€ç¼“å†²é˜Ÿåˆ—ã€æœ€å¤§çº¿ç¨‹æ•°é‡æ¯”è¾ƒã€‚ 16ã€çº¿ç¨‹åŒæ­¥ï¼Œä½ äº†è§£å“ªå‡ ç§æ–¹å¼ï¼Ÿ 17ã€è®²ä¸‹ Synchronizedï¼Ÿ 18ã€è®²ä¸‹ RecentLock å¯é‡å…¥é”ï¼Ÿ ä»€ä¹ˆæ˜¯å¯é‡å…¥é”ï¼Ÿä¸ºä»€ä¹ˆè¦è®¾è®¡å¯é‡å…¥é”ï¼Ÿ 19ã€è®²ä¸‹ Volatile å§ï¼Ÿä»–æ˜¯æ€æ ·åšåˆ°åŒæ­¥çš„ï¼Ÿ 20ã€Volatile ä¸ºä»€ä¹ˆä¸æ”¯æŒåŸå­æ€§ï¼Ÿä¸¾ä¸ªä¾‹å­ 21ã€Atomic æ€ä¹ˆè®¾è®¡çš„ï¼Ÿï¼ˆæ²¡çœ‹è¿‡æºç ï¼Œå½“æ—¶å›ç­”é”™äº†ï¼Œåæ¥æ‰å‘ç°é‡Œé¢å…¨éƒ¨ç”¨ final ä¿®é¥°çš„å±æ€§å’Œæ–¹æ³•ï¼‰ 22ã€é—®å‡ ä¸ªå‰ç«¯çš„æ ‡ç­¾å§ï¼Ÿï¼ˆé—®äº†ä¸€ä¸ªä¸ä¼šï¼Œç›´æ¥è¯´æ˜æˆ‘ååç«¯ï¼Œå‰ç«¯åªæ˜¯äº†è§£ï¼Œåé¢å°±ä¸é—®äº†ï¼‰ 23ã€SpringBoot çš„äº†è§£ï¼Ÿ 24ã€Linux å¸¸ç”¨å‘½ä»¤ï¼Ÿ 25ã€JVM é‡Œçš„å‡ ä¸ªé—®é¢˜ï¼Ÿ 26ã€äº‹åŠ¡çš„ç‰¹æ€§ï¼Ÿ 27ã€éš”ç¦»çº§åˆ«ï¼Ÿ 28ã€ç½‘ç»œçŠ¶æ€ç ï¼Ÿä»¥ 2ã€3ã€4ã€5 å¼€å¤´çš„ä»£è¡¨ä»€ä¹ˆæ„æ€ã€‚ 29ã€å¹¶å‘å’Œå¹¶è¡Œçš„åŒºåˆ«ï¼Ÿ 30ã€ä½ æœ‰ä»€ä¹ˆé—®é¢˜æƒ³é—®æˆ‘çš„ï¼Ÿ ä¸€é¢é¢å®Œåé¢è¯•å®˜å’Œè¯´è¿™ä»½è¯•å·æ˜¯ç”¨æ¥è€ƒ 1~3 å¹´å¼€å‘å·¥ä½œç»éªŒçš„ï¼Œè®©æˆ‘å‡†å¤‡ä¸€ä¸‹ï¼Œæ¥ä¸‹æ¥çš„äºŒé¢ã€‚ ç¬¬äºŒè½®é¢è¯•ï¼ˆåŠä¸ªå°æ—¶ï¼‰1ã€ä¸€ä¸Šæ¥å°±é—®æ€ä¹ˆç®€å†åå­—éƒ½æ²¡æœ‰ï¼Œæˆ‘æŒ‡äº†ç®€å†ç¬¬ä¸€è¡Œçš„æˆ‘çš„åå­—ï¼Œè¿˜ç‰¹æ„å¤§å†™äº†ï¼Œç„¶åå°±é—®å­¦æ ¡æ˜¯ä¸æ˜¯åœ¨ä¸Šæµ·ï¼Œæˆ‘å›ç­”åœ¨å—æ˜Œï¼ˆæ„Ÿè§‰è¢«é„™è§†äº†ä¸€æ³¢ï¼Œåé¢æˆ‘åœ¨å›ç­”é—®é¢˜çš„æ—¶å€™é¢è¯•å®˜å°±ä¸€ç›´åœ¨ç©æ‰‹æœºï¼Œä¼°è®¡åé¢å¯¹æˆ‘çš„å°è±¡å°±ä¸æ˜¯å¾ˆå¥½äº†ï¼‰ 2ã€è‡ªæˆ‘ä»‹ç» 3ã€è¯´ä¸€è¯´æ•°æ®åº“å»ºè¡¨å§ï¼ˆä»èŒƒå¼è®²ï¼‰ 4ã€è®²è®²å¤šæ€ï¼Ÿï¼ˆè¿™ä¸ªæˆ‘ç­”å‡ºæ¥äº†ï¼Œå¯æ˜¯é¢è¯•å®˜ç«Ÿç„¶è¯´ä¸æ˜¯è¿™æ ·å§ï¼Œå¯èƒ½é¢è¯•å®˜æ²¡å¬è¯·ï¼Œåé¢è¿˜è¯´æˆ‘æ˜¯ä¸æ˜¯å¹³æ—¶å†™å¤šæ€æ¯”è¾ƒå°‘ï¼Œæ„Ÿè§‰è¿™ä¸ªä¹Ÿè®©é¢è¯•å®˜å¯¹æˆ‘å°è±¡å‡åˆ†ï¼‰ 5ã€å°†ä¸¤ä¸ªæ•°è½¬æ¢ï¼ˆä¸å€ŸåŠ©ç¬¬ä¸‰ä¸ªå‚æ•°ï¼‰ 6ã€æ‰‹å†™ä¸ªæ’å…¥æ’åºå§ï¼ˆå†™å®Œäº†å’Œé¢è¯•å®˜è®²äº†ä¸‹æ‰§è¡Œæµç¨‹ï¼‰ 7ã€è®²è®²ä½ å¯¹ Spring ä¸­çš„ IOC å’Œ AOP çš„ç†è§£ï¼Ÿ 8ã€é—®äº†å‡ ä¸ªå¸¸ç”¨çš„ Linux å‘½ä»¤ï¼Ÿ 9ã€ä¹Ÿé—®åˆ°å¤šçº¿ç¨‹ï¼Ÿå’Œä¸€é¢ä¸€æ ·æŠŠè‡ªå·±æœ€è¿‘çœ‹çš„çº¿ç¨‹æ± ä¹Ÿè®²äº†ä¸€é 10ã€å­¦ Java å¤šä¹…äº†ï¼Ÿ 11ã€ä½ æœ‰ä»€ä¹ˆæƒ³é—®çš„ï¼Ÿ æ€»ç»“ï¼šé¢è¯•é¢˜ç›®å¤§æ¦‚å°±æ˜¯è¿™ä¹ˆå¤šäº†ï¼Œæœ‰äº›é—®é¢˜è‡ªå·±ä¹Ÿå¿˜è®°äº†ï¼Œé¢è¯•é¢˜ç›®é¡ºåºä¸ä¸€å®šæ˜¯æŒ‰ç…§ä¸Šé¢æ‰€å†™çš„ã€‚å†æ¬¡æ„Ÿè°¢çˆ±å¥‡è‰ºçš„ç¬¬ä¸€é¢é¢è¯•å®˜äº†ï¼Œè¦ä¸æ˜¯ä»–å¸®å¿™å†…æ¨çš„ï¼Œæˆ‘å¯èƒ½è¿˜æ²¡æœ‰æœºä¼šæ”¶åˆ°é¢è¯•æœºä¼šã€‚è‡ªå·±æ¥åˆ°çˆ±å¥‡è‰ºé¢è¯•é‚€è¯·ç”µè¯æ˜¯æ˜ŸæœŸä¸€æ™šä¸Šå¿«7ç‚¹ä¸­çš„ï¼Œä¹‹ååŠ äº†é¢è¯•å®˜å¾®ä¿¡çº¦å¥½äº†æ˜ŸæœŸå››é¢è¯•çš„ï¼ˆæ—¶é—´å‡†å¤‡è¾ƒçŸ­ï¼Œä¹‹å‰æ²¡ç³»ç»Ÿçš„å¤ä¹ è¿‡ï¼‰ã€‚æ˜ŸæœŸå››ä¸€å¤§æ—©ï¼ˆ5ç‚¹å°±èµ·åºŠäº†ï¼‰ï¼Œç„¶åå°±æ”¶æ‹¾äº†ä¸‹ï¼Œå»ç­‰å…¬äº¤è½¦ï¼Œè½¬äº†ä¸¤æ¬¡è½¦ï¼Œç„¶åå†åšåœ°é“å»çˆ±å¥‡è‰ºå…¬å¸çš„ï¼Œæ€»å…±è·¯ä¸ŠèŠ±è´¹æ—¶é—´å››ä¸ªå¤šå°æ—¶ã€‚æ€»çš„æ¥è¯´ï¼Œè¿™æ¬¡é¢è¯•å‡†å¤‡çš„æ—¶é—´ä¸æ˜¯å¾ˆå……è£•ï¼Œæ‰€ä»¥å‡†å¤‡çš„ä¸ªäººè§‰å¾—ä¸æ˜¯å¾ˆå¥½ï¼Œé€šè¿‡è¿™æ¬¡çš„é¢è¯•ï¼Œå‘ç°é¢è¯•è¿˜æ˜¯æ¯”è¾ƒæ³¨é‡åŸºç¡€å’Œæ·±åº¦çš„ï¼Œæˆ‘ä¹ŸçŸ¥é“äº†è‡ªå·±çš„ä¸€äº›å¼±å¤„ï¼Œè¿˜éœ€è¦åœ¨å“ªé‡ŒåŠ å¼ºï¼Œé¢è¯•æŠ€å·§ä¸Šä¹Ÿè¦æŒæ¡äº›ã€‚ä¸ºåé¢çš„å…¶ä»–å…¬å¸ç»§ç»­åšå¥½å……è¶³çš„å‡†å¤‡ã€‚åŠ æ²¹ï¼ï¼ï¼","tags":[{"name":"é¢ç»","slug":"é¢ç»","permalink":"http://www.54tianzhisheng.cn/tags/é¢ç»/"}]},{"title":"ç§‹æ‹›ç¬¬ä¸€ç«™ â€”â€” äºšä¿¡ç§‘æŠ€","date":"2017-08-03T16:00:00.000Z","path":"2017/08/04/yaxin/","text":"ç¬¬ 1 ç«™ã€äºšä¿¡ç§‘æŠ€ Java å¼€å‘1ï¼‰è‡ªæˆ‘ä»‹ç»ï¼ˆè¯´åˆ°ä¸€ä¸ªäº®ç‚¹ï¼šé•¿æœŸåšæŒå†™åšå®¢ï¼Œé¢è¯•å®˜è§‰å¾—è¿™ä¸ªä¹ æƒ¯å¾ˆå¥½ï¼Œç®—åŠ åˆ†é¡¹å§ï¼‰ 2ï¼‰çœ‹åˆ°ç®€å†é¡¹ç›®ä¸­ç”¨åˆ° Solrï¼Œè¯¦ç»†çš„é—®äº†ä¸‹ Solrï¼ˆè‡ªå·±ä»‹ç»äº†ä¸‹ Solr çš„ä½¿ç”¨åœºæ™¯å’Œå»ºç«‹ç´¢å¼•ç­‰ä¸œè¥¿ï¼‰3ï¼‰é¡¹ç›®é‡Œé¢å†™äº†ä¸€ä¸ª â€œ æ•æ„Ÿè¯å’Œ JS æ ‡ç­¾è¿‡æ»¤é˜² XSS æ”»å‡»â€ï¼Œé¢è¯•å®˜è®©æˆ‘è®²äº†ä¸‹è¿™ä¸ª XSS æ”»å‡»ï¼Œå¹¶ä¸”æ˜¯æ€æ ·å®ç°çš„ 4ï¼‰é¡¹ç›®é‡Œå†™äº†æ”¯æŒ Markdownï¼Œé—®æ˜¯ä¸æ˜¯è‡ªå·±å†™çš„è§£æä»£ç ï¼Œï¼ˆå›ç­”ä¸æ˜¯ï¼Œè‡ªå·±å¼•ç”¨çš„æ˜¯ GitHubä¸Šçš„ä¸€ä¸ªå¼€æºé¡¹ç›®è§£æçš„ï¼‰ 5ï¼‰æƒ³é—®æˆ‘å‰ç«¯çš„çŸ¥è¯†ï¼Œæˆ‘å›å¤åˆ°ï¼šè‡ªå·±ååç«¯å¼€å‘ï¼Œå‰ç«¯åªæ˜¯äº†è§£ï¼Œç„¶åé¢è¯•å®˜å°±ä¸é—®äº† 6ï¼‰é—®æˆ‘è€ƒä¸è€ƒç ”ï¼Ÿ 7ï¼‰è§‰å¾—æ­å·æ€ä¹ˆæ ·ï¼Ÿæ˜¯æ‰“ç®—å°±å‘†åœ¨æ­å·è¿˜æ˜¯æŠŠæ­å·ä½œä¸ºä¸€ä¸ªè·³æ¿ï¼Ÿ 8ï¼‰æœ‰å•¥å°ç›®æ ‡ï¼Ÿä»¥åæ˜¯æ‰“ç®—ç»§ç»­æŠ€æœ¯æ–¹å‘ï¼Œè¿˜æ˜¯å…ˆæŠ€æœ¯åç®¡ç†ï¼ˆè¿˜å¼€ç©ç¬‘çš„è¯´ï¼šæ˜¯ä¸æ˜¯èµšä»–å‡ ä¸ªäº¿ï¼Œå½“æ—¶æˆ‘ç¬‘äº†ç¬‘ï¼‰ 9ï¼‰æœ‰å•¥å…´è¶£çˆ±å¥½ï¼Ÿ å¤§æ¦‚å°±è®°å¾—è¿™ä¹ˆå¤šäº†ï¼Œç›®å‰å·²ç»æ‹¿åˆ° Offer äº†ã€‚ æ€»ç»“ï¼šé¢è¯•é—®çš„é—®é¢˜ä¸ç®—å¤šï¼Œä¸»è¦æ˜¯é€šè¿‡ç®€å†ä¸Šé¡¹ç›®æ‰€æ¶‰åŠçš„ä¸œè¥¿æé—®çš„ï¼Œå¦‚æœè‡ªå·±ä¸å¤ªä¼šçš„åˆ‡è®°ä¸è¦å†™ä¸Šå»ã€‚é¢è¯•ä¸»è¦è€ƒå¯Ÿä½ å›ç­”é—®é¢˜æ¥åˆ¤æ–­ä½ çš„é€»è¾‘æ˜¯å¦å¾ˆæ¸…æ¥šã€‚","tags":[{"name":"é¢ç»","slug":"é¢ç»","permalink":"http://www.54tianzhisheng.cn/tags/é¢ç»/"}]},{"title":"Java çº¿ç¨‹æ± è‰ºæœ¯æ¢ç´¢","date":"2017-07-28T16:00:00.000Z","path":"2017/07/29/ThreadPool/","text":"çº¿ç¨‹æ± Wiki ä¸Šæ˜¯è¿™æ ·è§£é‡Šçš„ï¼šThread Pool ä½œç”¨ï¼šåˆ©ç”¨çº¿ç¨‹æ± å¯ä»¥å¤§å¤§å‡å°‘åœ¨åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹ä¸Šæ‰€èŠ±çš„æ—¶é—´ä»¥åŠç³»ç»Ÿèµ„æºçš„å¼€é”€ï¼ ä¸‹é¢ä¸»è¦è®²ä¸‹çº¿ç¨‹æ± ä¸­æœ€é‡è¦çš„ä¸€ä¸ªç±» ThreadPoolExecutor ã€‚ ThreadPoolExecutor ThreadPoolExecutor æ„é€ å™¨ï¼š æœ‰å››ä¸ªæ„é€ å™¨çš„ï¼ŒæŒ‘äº†å‚æ•°æœ€é•¿çš„ä¸€ä¸ªè¿›è¡Œè®²è§£ã€‚ ä¸ƒä¸ªå‚æ•°ï¼š corePoolSizeï¼šæ ¸å¿ƒæ± çš„å¤§å°ï¼Œåœ¨åˆ›å»ºäº†çº¿ç¨‹æ± åï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œçº¿ç¨‹æ± ä¸­å¹¶æ²¡æœ‰ä»»ä½•çº¿ç¨‹ï¼Œè€Œæ˜¯ç­‰å¾…æœ‰ä»»åŠ¡åˆ°æ¥æ‰åˆ›å»ºçº¿ç¨‹å»æ‰§è¡Œä»»åŠ¡ï¼Œå½“æœ‰ä»»åŠ¡æ¥ä¹‹åï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹å»æ‰§è¡Œä»»åŠ¡ï¼Œå½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ç›®è¾¾åˆ°corePoolSizeåï¼Œå°±ä¼šæŠŠåˆ°è¾¾çš„ä»»åŠ¡æ”¾åˆ°ç¼“å­˜é˜Ÿåˆ—å½“ä¸­ï¼› maximumPoolSizeï¼šçº¿ç¨‹æ± æœ€å¤§çº¿ç¨‹æ•°ï¼› keepAliveTimeï¼šè¡¨ç¤ºçº¿ç¨‹æ²¡æœ‰ä»»åŠ¡æ‰§è¡Œæ—¶æœ€å¤šä¿æŒå¤šä¹…æ—¶é—´ä¼šç»ˆæ­¢ï¼› unitï¼šå‚æ•°keepAliveTimeçš„æ—¶é—´å•ä½ï¼ˆDAYSã€HOURSã€MINUTESã€SECONDS ç­‰ï¼‰ï¼› workQueueï¼šé˜»å¡é˜Ÿåˆ—ï¼Œç”¨æ¥å­˜å‚¨ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡ï¼› ArrayBlockingQueue ï¼ˆæœ‰ç•Œé˜Ÿåˆ—ï¼‰ LinkedBlockingQueue ï¼ˆæ— ç•Œé˜Ÿåˆ—ï¼‰ SynchronousQueue threadFactoryï¼šçº¿ç¨‹å·¥å‚ï¼Œä¸»è¦ç”¨æ¥åˆ›å»ºçº¿ç¨‹ handlerï¼šæ‹’ç»å¤„ç†ä»»åŠ¡çš„ç­–ç•¥ AbortPolicyï¼šä¸¢å¼ƒä»»åŠ¡å¹¶æŠ›å‡º RejectedExecutionException å¼‚å¸¸ã€‚ï¼ˆé»˜è®¤è¿™ç§ï¼‰ DiscardPolicyï¼šä¹Ÿæ˜¯ä¸¢å¼ƒä»»åŠ¡ï¼Œä½†æ˜¯ä¸æŠ›å‡ºå¼‚å¸¸ DiscardOldestPolicyï¼šä¸¢å¼ƒé˜Ÿåˆ—æœ€å‰é¢çš„ä»»åŠ¡ï¼Œç„¶åé‡æ–°å°è¯•æ‰§è¡Œä»»åŠ¡ï¼ˆé‡å¤æ­¤è¿‡ç¨‹ï¼‰ CallerRunsPolicyï¼šç”±è°ƒç”¨çº¿ç¨‹å¤„ç†è¯¥ä»»åŠ¡ é‡è¦æ–¹æ³•ï¼š execute()ï¼šé€šè¿‡è¿™ä¸ªæ–¹æ³•å¯ä»¥å‘çº¿ç¨‹æ± æäº¤ä¸€ä¸ªä»»åŠ¡ï¼Œäº¤ç”±çº¿ç¨‹æ± å»æ‰§è¡Œï¼› shutdown()ï¼šå…³é—­çº¿ç¨‹æ± ï¼› execute() æ–¹æ³•ï¼š æ³¨ï¼šJDK 1.7 å’Œ 1.8 è¿™ä¸ªæ–¹æ³•æœ‰ç‚¹åŒºåˆ«ï¼Œä¸‹é¢ä»£ç æ˜¯ 1.8 ä¸­çš„ã€‚ 1234567891011121314151617181920212223public void execute(Runnable command) &#123; if (command == null) throw new NullPointerException(); int c = ctl.get(); //1ã€å¦‚æœå½“å‰çš„çº¿ç¨‹æ•°å°äºæ ¸å¿ƒçº¿ç¨‹æ± çš„å¤§å°ï¼Œæ ¹æ®ç°æœ‰çš„çº¿ç¨‹ä½œä¸ºç¬¬ä¸€ä¸ª Worker è¿è¡Œçš„çº¿ç¨‹ï¼Œæ–°å»ºä¸€ä¸ª Workerï¼ŒaddWorker è‡ªåŠ¨çš„æ£€æŸ¥å½“å‰çº¿ç¨‹æ± çš„çŠ¶æ€å’Œ Worker çš„æ•°é‡ï¼Œé˜²æ­¢çº¿ç¨‹æ± åœ¨ä¸èƒ½æ·»åŠ çº¿ç¨‹çš„çŠ¶æ€ä¸‹æ·»åŠ çº¿ç¨‹ if (workerCountOf(c) &lt; corePoolSize) &#123; if (addWorker(command, true)) return; c = ctl.get(); &#125; //2ã€å¦‚æœçº¿ç¨‹å…¥é˜ŸæˆåŠŸï¼Œç„¶åè¿˜æ˜¯è¦è¿›è¡Œ double-check çš„ï¼Œå› ä¸ºçº¿ç¨‹åœ¨å…¥é˜Ÿä¹‹åçŠ¶æ€æ˜¯å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–çš„ if (isRunning(c) &amp;&amp; workQueue.offer(command)) &#123; int recheck = ctl.get(); // recheck é˜²æ­¢çº¿ç¨‹æ± çŠ¶æ€çš„çªå˜ï¼Œå¦‚æœçªå˜ï¼Œé‚£ä¹ˆå°† reject çº¿ç¨‹ï¼Œé˜²æ­¢ workQueue ä¸­å¢åŠ æ–°çº¿ç¨‹ if (! isRunning(recheck) &amp;&amp; remove(command)) reject(command); else if (workerCountOf(recheck) == 0)//ä¸Šä¸‹ä¸¤ä¸ªæ“ä½œéƒ½æœ‰ addWorker çš„æ“ä½œï¼Œä½†æ˜¯å¦‚æœåœ¨workQueue.offer çš„æ—¶å€™ Worker å˜ä¸º 0ï¼Œé‚£ä¹ˆå°†æ²¡æœ‰ Worker æ‰§è¡Œæ–°çš„ taskï¼Œæ‰€ä»¥å¢åŠ ä¸€ä¸ª Worker. addWorker(null, false); &#125; //3ã€å¦‚æœ task ä¸èƒ½å…¥é˜Ÿ(é˜Ÿåˆ—æ»¡äº†)ï¼Œè¿™æ—¶å€™å°è¯•å¢åŠ ä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œå¦‚æœå¢åŠ å¤±è´¥é‚£ä¹ˆå½“å‰çš„çº¿ç¨‹æ± çŠ¶æ€å˜åŒ–äº†æˆ–è€…çº¿ç¨‹æ± å·²ç»æ»¡äº†ç„¶åæ‹’ç»task else if (!addWorker(command, false)) reject(command); &#125; å…¶ä¸­è°ƒç”¨äº† addWorker() æ–¹æ³•ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768private boolean addWorker(Runnable firstTask, boolean core) &#123;// firstTask: æ–°å¢ä¸€ä¸ªçº¿ç¨‹å¹¶æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ï¼Œå¯ç©ºï¼Œå¢åŠ çš„çº¿ç¨‹ä»é˜Ÿåˆ—è·å–ä»»åŠ¡ï¼›coreï¼šæ˜¯å¦ä½¿ç”¨ corePoolSize ä½œä¸ºä¸Šé™ï¼Œå¦åˆ™ä½¿ç”¨ maxmunPoolSize retry: for (;;) &#123; int c = ctl.get(); int rs = runStateOf(c); // Check if queue empty only if necessary. /** * rs!=Shutdown || fistTaskï¼=null || workQueue.isEmpty * å¦‚æœå½“å‰çš„çº¿ç¨‹æ± çš„çŠ¶æ€ &gt; SHUTDOWN é‚£ä¹ˆæ‹’ç» Worker çš„ add å¦‚æœ =SHUTDOWN * é‚£ä¹ˆæ­¤æ—¶ä¸èƒ½æ–°åŠ å…¥ä¸ä¸º null çš„ Taskï¼Œå¦‚æœåœ¨ workQueue ä¸º empty çš„æ—¶å€™ä¸èƒ½åŠ å…¥ä»»ä½•ç±»å‹çš„ Workerï¼Œ * å¦‚æœä¸ä¸º empty å¯ä»¥åŠ å…¥ task ä¸º null çš„ Worker, å¢åŠ æ¶ˆè´¹çš„ Worker */ if (rs &gt;= SHUTDOWN &amp;&amp; ! (rs == SHUTDOWN &amp;&amp; firstTask == null &amp;&amp;! workQueue.isEmpty())) return false; for (;;) &#123; int wc = workerCountOf(c); //å¦‚æœå½“å‰çš„æ•°é‡è¶…è¿‡äº† CAPACITYï¼Œæˆ–è€…è¶…è¿‡äº† corePoolSize å’Œ maximumPoolSizeï¼ˆè¯• core è€Œå®šï¼‰ if (wc &gt;= CAPACITY || wc &gt;= (core ? corePoolSize : maximumPoolSize)) return false; //CAS å°è¯•å¢åŠ çº¿ç¨‹æ•°ï¼Œå¦‚æœå¤±è´¥ï¼Œè¯æ˜æœ‰ç«äº‰ï¼Œé‚£ä¹ˆé‡æ–°åˆ° retryã€‚ if (compareAndIncrementWorkerCount(c))// AtomicInteger çš„ CAS æ“ä½œ; break retry; c = ctl.get(); // Re-read ctl //åˆ¤æ–­å½“å‰çº¿ç¨‹æ± çš„è¿è¡ŒçŠ¶æ€,çŠ¶æ€å‘ç”Ÿæ”¹å˜ï¼Œé‡è¯• retry; if (runStateOf(c) != rs) continue retry; // else CAS failed due to workerCount change; retry inner loop &#125; &#125; boolean workerStarted = false; boolean workerAdded = false; Worker w = null; try &#123; w = new Worker(firstTask);// Worker ä¸ºå†…éƒ¨ç±»ï¼Œå°è£…äº†çº¿ç¨‹å’Œä»»åŠ¡ï¼Œé€šè¿‡ ThreadFactory åˆ›å»ºçº¿ç¨‹ï¼Œå¯èƒ½å¤±è´¥æŠ›å¼‚å¸¸æˆ–è€…è¿”å› null final Thread t = w.thread; if (t != null) &#123; final ReentrantLock mainLock = this.mainLock; mainLock.lock(); try &#123; // Recheck while holding lock. // Back out on ThreadFactory failure or if // shut down before lock acquired. int rs = runStateOf(ctl.get()); if (rs &lt; SHUTDOWN || (rs == SHUTDOWN &amp;&amp; firstTask == null)) &#123; if (t.isAlive()) // precheck that t is startable // SHUTDOWN ä»¥åçš„çŠ¶æ€å’Œ SHUTDOWN çŠ¶æ€ä¸‹ firstTask ä¸º nullï¼Œä¸å¯æ–°å¢çº¿ç¨‹ throw new IllegalThreadStateException(); workers.add(w); int s = workers.size(); if (s &gt; largestPoolSize) largestPoolSize = s;//è®°å½•æœ€å¤§çº¿ç¨‹æ•° workerAdded = true; &#125; &#125; finally &#123; mainLock.unlock(); &#125; if (workerAdded) &#123; t.start(); workerStarted = true; &#125; &#125; &#125; finally &#123; if (! workerStarted) addWorkerFailed(w);//å¤±è´¥å›é€€,ä» wokers ç§»é™¤ w, çº¿ç¨‹æ•°å‡ä¸€ï¼Œå°è¯•ç»“æŸçº¿ç¨‹æ± (è°ƒç”¨tryTerminate æ–¹æ³•) &#125; return workerStarted; &#125; ç¤ºæ„å›¾ï¼š æ‰§è¡Œæµç¨‹ï¼š 1ã€å½“æœ‰ä»»åŠ¡è¿›å…¥æ—¶ï¼Œçº¿ç¨‹æ± åˆ›å»ºçº¿ç¨‹å»æ‰§è¡Œä»»åŠ¡ï¼Œç›´åˆ°æ ¸å¿ƒçº¿ç¨‹æ•°æ»¡ä¸ºæ­¢ 2ã€æ ¸å¿ƒçº¿ç¨‹æ•°é‡æ»¡äº†ä¹‹åï¼Œä»»åŠ¡å°±ä¼šè¿›å…¥ä¸€ä¸ªç¼“å†²çš„ä»»åŠ¡é˜Ÿåˆ—ä¸­ å½“ä»»åŠ¡é˜Ÿåˆ—ä¸ºæ— ç•Œé˜Ÿåˆ—æ—¶ï¼Œä»»åŠ¡å°±ä¼šä¸€ç›´æ”¾å…¥ç¼“å†²çš„ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œä¸ä¼šå’Œæœ€å¤§çº¿ç¨‹æ•°é‡è¿›è¡Œæ¯”è¾ƒ å½“ä»»åŠ¡é˜Ÿåˆ—ä¸ºæœ‰ç•Œé˜Ÿåˆ—æ—¶ï¼Œä»»åŠ¡å…ˆæ”¾å…¥ç¼“å†²çš„ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œå½“ä»»åŠ¡é˜Ÿåˆ—æ»¡äº†ä¹‹åï¼Œæ‰ä¼šå°†ä»»åŠ¡æ”¾å…¥çº¿ç¨‹æ± ï¼Œæ­¤æ—¶ä¼šä¸çº¿ç¨‹æ± ä¸­æœ€å¤§çš„çº¿ç¨‹æ•°é‡è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœè¶…å‡ºäº†ï¼Œåˆ™é»˜è®¤ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚ç„¶åçº¿ç¨‹æ± æ‰ä¼šæ‰§è¡Œä»»åŠ¡ï¼Œå½“ä»»åŠ¡æ‰§è¡Œå®Œï¼Œåˆä¼šå°†ç¼“å†²é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡æ”¾å…¥çº¿ç¨‹æ± ä¸­ï¼Œç„¶åé‡å¤æ­¤æ“ä½œã€‚ shutdown() æ–¹æ³•ï¼š 1234567891011121314151617public void shutdown() &#123; final ReentrantLock mainLock = this.mainLock; mainLock.lock(); try &#123; //åˆ¤æ–­æ˜¯å¦å¯ä»¥æ“ä½œç›®æ ‡çº¿ç¨‹ checkShutdownAccess(); //è®¾ç½®çº¿ç¨‹æ± çŠ¶æ€ä¸º SHUTDOWN, æ­¤å¤„ä¹‹åï¼Œçº¿ç¨‹æ± ä¸­ä¸ä¼šå¢åŠ æ–° Task advanceRunState(SHUTDOWN); //ä¸­æ–­æ‰€æœ‰çš„ç©ºé—²çº¿ç¨‹ interruptIdleWorkers(); onShutdown(); // hook for ScheduledThreadPoolExecutor &#125; finally &#123; mainLock.unlock(); &#125; //è½¬åˆ° Terminate tryTerminate(); &#125; å‚è€ƒèµ„æ–™ï¼šæ·±å…¥ç†è§£javaçº¿ç¨‹æ± â€”ThreadPoolExecutor JDK è‡ªå¸¦å››ç§çº¿ç¨‹æ± åˆ†æä¸æ¯”è¾ƒ 1ã€newFixedThreadPoolåˆ›å»ºä¸€ä¸ªå®šé•¿çº¿ç¨‹æ± ï¼Œå¯æ§åˆ¶çº¿ç¨‹æœ€å¤§å¹¶å‘æ•°ï¼Œè¶…å‡ºçš„çº¿ç¨‹ä¼šåœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…ã€‚ 2ã€newSingleThreadExecutoråˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹åŒ–çš„çº¿ç¨‹æ± ï¼Œå®ƒåªä¼šç”¨å”¯ä¸€çš„å·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œä¿è¯æ‰€æœ‰ä»»åŠ¡æŒ‰ç…§æŒ‡å®šé¡ºåº(FIFO, LIFO, ä¼˜å…ˆçº§)æ‰§è¡Œã€‚ 3ã€newCachedThreadPoolåˆ›å»ºä¸€ä¸ªå¯ç¼“å­˜çº¿ç¨‹æ± ï¼Œå¦‚æœçº¿ç¨‹æ± é•¿åº¦è¶…è¿‡å¤„ç†éœ€è¦ï¼Œå¯çµæ´»å›æ”¶ç©ºé—²çº¿ç¨‹ï¼Œè‹¥æ— å¯å›æ”¶ï¼Œåˆ™æ–°å»ºçº¿ç¨‹ã€‚ 4ã€newScheduledThreadPoolåˆ›å»ºä¸€ä¸ªå®šé•¿çº¿ç¨‹æ± ï¼Œæ”¯æŒå®šæ—¶åŠå‘¨æœŸæ€§ä»»åŠ¡æ‰§è¡Œã€‚ å››ç§çº¿ç¨‹æ± å…¶å®å†…éƒ¨æ–¹æ³•éƒ½æ˜¯è°ƒç”¨çš„ ThreadPoolExecutor ç±»ï¼Œåªä¸è¿‡åˆ©ç”¨äº†å…¶ä¸åŒçš„æ„é€ å™¨æ–¹æ³•è€Œå·²ï¼ˆä¼ å…¥è‡ªå·±éœ€è¦ä¼ å…¥çš„å‚æ•°ï¼‰ï¼Œé‚£ä¹ˆåˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œæˆ‘ä»¬è‡ªå·±ä¹Ÿæ˜¯å¯ä»¥å®ç°è‡ªå·±å®šä¹‰çš„çº¿ç¨‹æ± çš„ã€‚ è‡ªå®šä¹‰çº¿ç¨‹æ± 1ã€åˆ›å»ºä»»åŠ¡ç±» 12345678910111213141516171819202122232425262728293031323334353637package com.zhisheng.thread.threadpool.demo;/** * Created by 10412 on 2017/7/24. * ä»»åŠ¡ */public class MyTask implements Runnable&#123; private int taskId; //ä»»åŠ¡ id private String taskName; //ä»»åŠ¡åå­— public int getTaskId() &#123; return taskId; &#125; public void setTaskId(int taskId) &#123; this.taskId = taskId; &#125; public String getTaskName() &#123; return taskName; &#125; public void setTaskName(String taskName) &#123; this.taskName = taskName; &#125; public MyTask(int taskId, String taskName) &#123; this.taskId = taskId; this.taskName = taskName; &#125; @Override public void run() &#123; System.out.println(\"å½“å‰æ­£åœ¨æ‰§è¡Œ ****** çº¿ç¨‹Id--&gt;\" + taskId + \",ä»»åŠ¡åç§°--&gt;\" + taskName); try &#123; Thread.currentThread().sleep(5 * 1000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; System.out.println(\"çº¿ç¨‹Id--&gt;\" + taskId + \",ä»»åŠ¡åç§°--&gt;\" + taskName + \" ----------- æ‰§è¡Œå®Œæ¯•ï¼\"); &#125;&#125; 2ã€è‡ªå®šä¹‰æ‹’ç»ç­–ç•¥ï¼Œå®ç° RejectedExecutionHandler æ¥å£ï¼Œé‡å†™ rejectedExecution æ–¹æ³• 12345678910111213141516package com.zhisheng.thread.threadpool.demo;import java.util.concurrent.RejectedExecutionHandler;import java.util.concurrent.ThreadPoolExecutor;/** * Created by 10412 on 2017/7/24. * è‡ªå®šä¹‰æ‹’ç»ç­–ç•¥ï¼Œå®ç° RejectedExecutionHandler æ¥å£ */public class RejectedThreadPoolHandler implements RejectedExecutionHandler&#123; public RejectedThreadPoolHandler() &#123; &#125; @Override public void rejectedExecution(Runnable r, ThreadPoolExecutor executor) &#123; System.out.println(\"WARNING è‡ªå®šä¹‰æ‹’ç»ç­–ç•¥: Task \" + r.toString() + \" rejected from \" + executor.toString()); &#125;&#125; 3ã€åˆ›å»ºçº¿ç¨‹æ±  1234567891011121314151617181920212223242526272829303132package com.zhisheng.thread.threadpool.demo;import java.util.concurrent.ArrayBlockingQueue;import java.util.concurrent.ThreadPoolExecutor;import java.util.concurrent.TimeUnit;/** * Created by 10412 on 2017/7/24. */public class ThreadPool&#123; public static void main(String[] args) &#123; //æ ¸å¿ƒçº¿ç¨‹æ•°é‡ä¸º 2ï¼Œæœ€å¤§çº¿ç¨‹æ•°é‡ 4ï¼Œç©ºé—²çº¿ç¨‹å­˜æ´»çš„æ—¶é—´ 60sï¼Œæœ‰ç•Œé˜Ÿåˆ—é•¿åº¦ä¸º 3, //ThreadPoolExecutor pool = new ThreadPoolExecutor(2, 4, 60, TimeUnit.SECONDS, new ArrayBlockingQueue&lt;&gt;(3)); //æ ¸å¿ƒçº¿ç¨‹æ•°é‡ä¸º 2ï¼Œæœ€å¤§çº¿ç¨‹æ•°é‡ 4ï¼Œç©ºé—²çº¿ç¨‹å­˜æ´»çš„æ—¶é—´ 60sï¼Œ æ— ç•Œé˜Ÿåˆ—, //ThreadPoolExecutor pool = new ThreadPoolExecutor(2, 4, 60L, TimeUnit.SECONDS, new LinkedBlockingDeque&lt;&gt;()); //æ ¸å¿ƒçº¿ç¨‹æ•°é‡ä¸º 2ï¼Œæœ€å¤§çº¿ç¨‹æ•°é‡ 4ï¼Œç©ºé—²çº¿ç¨‹å­˜æ´»çš„æ—¶é—´ 60sï¼Œæœ‰ç•Œé˜Ÿåˆ—é•¿åº¦ä¸º 3, ä½¿ç”¨è‡ªå®šä¹‰æ‹’ç»ç­–ç•¥ ThreadPoolExecutor pool = new ThreadPoolExecutor(2, 4, 60, TimeUnit.SECONDS, new ArrayBlockingQueue&lt;Runnable&gt;(3), new RejectedThreadPoolHandler()); for (int i = 1; i &lt;= 10; i++) &#123; //åˆ›å»º 10 ä¸ªä»»åŠ¡ MyTask task = new MyTask(i, \"ä»»åŠ¡\" + i); //è¿è¡Œ pool.execute(task); System.out.println(\"æ´»è·ƒçš„çº¿ç¨‹æ•°ï¼š\"+pool.getActiveCount() + \",æ ¸å¿ƒçº¿ç¨‹æ•°ï¼š\" + pool.getCorePoolSize() + \",çº¿ç¨‹æ± å¤§å°ï¼š\" + pool.getPoolSize() + \",é˜Ÿåˆ—çš„å¤§å°\" + pool.getQueue().size()); &#125; //å…³é—­çº¿ç¨‹æ±  pool.shutdown(); &#125;&#125; è¿™é‡Œè¿è¡Œç»“æœå°±ä¸æˆªå›¾äº†ï¼Œæˆ‘åœ¨æœ¬åœ°æµ‹è¯•äº†ä»£ç æ˜¯æ²¡é—®é¢˜çš„ï¼Œæ„Ÿå…´è¶£çš„å»ºè®®è¿˜æ˜¯è‡ªå·±è·‘ä¸€ä¸‹ï¼Œç„¶ååˆ†æä¸‹ç»“æœæ˜¯ä¸æ˜¯å’Œå‰é¢åˆ†æçš„ä¸€æ ·ï¼Œå¦‚æœ‰é—®é¢˜ï¼Œè¯·åœ¨æˆ‘åšå®¢ä¸‹é¢è¯„è®ºï¼ æ€»ç»“æœ¬æ–‡ä¸€å¼€å§‹è®²äº†çº¿ç¨‹æ± çš„ä»‹ç»å’Œå¥½å¤„ï¼Œç„¶ååˆ†æäº†çº¿ç¨‹æ± ä¸­æœ€æ ¸å¿ƒçš„ ThreadPoolExecutor ç±»ä¸­æ„é€ å™¨çš„ä¸ƒä¸ªå‚æ•°çš„ä½œç”¨ã€ç±»ä¸­ä¸¤ä¸ªé‡è¦çš„æ–¹æ³•ï¼Œç„¶ååœ¨å¯¹æ¯”ç ”ç©¶äº†ä¸‹ JDK ä¸­è‡ªå¸¦çš„å››ç§çº¿ç¨‹æ± çš„ç”¨æ³•å’Œå†…éƒ¨ä»£ç ç»†èŠ‚ï¼Œæœ€åå†™äº†ä¸€ä¸ªè‡ªå®šä¹‰çš„çº¿ç¨‹æ± ã€‚","tags":[{"name":"Java","slug":"Java","permalink":"http://www.54tianzhisheng.cn/tags/Java/"},{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"http://www.54tianzhisheng.cn/tags/å¤šçº¿ç¨‹/"},{"name":"çº¿ç¨‹æ± ","slug":"çº¿ç¨‹æ± ","permalink":"http://www.54tianzhisheng.cn/tags/çº¿ç¨‹æ± /"}]},{"title":"Java æ€§èƒ½è°ƒä¼˜éœ€è¦æ ¼å¤–æ³¨æ„çš„ç»†èŠ‚","date":"2017-07-24T16:00:00.000Z","path":"2017/07/25/Java-performance-tuning/","text":"æ˜¨å¤©å†™äº†ç¯‡æ–‡ç«  ã€ŠMySQL å¤„ç†æµ·é‡æ•°æ®æ—¶çš„ä¸€äº›ä¼˜åŒ–æŸ¥è¯¢é€Ÿåº¦æ–¹æ³•ã€‹ ï¼Œå…¶å®å¼€å‘ä¸­ä¸æ­¢æ•°æ®åº“è¦ä¼˜åŒ–ï¼Œè¿˜æœ‰æˆ‘ä»¬æœ¬èº«çš„å¼€å‘ä»£ç ä¹Ÿéœ€è¦ä¼˜åŒ–ï¼Œè¿™æ ·æˆ‘ä»¬å¼€å‘çš„äº§å“æ‰èƒ½å¤Ÿå¾—åˆ°æè‡´çš„ä½“éªŒã€‚ä¹Ÿè®¸æœ‰äº›äººè®¤ä¸ºè¿™äº›ç»†å°çš„åœ°æ–¹æ²¡æœ‰å•¥å¥½ä¿®æ”¹çš„ï¼Œæ”¹ä¸ä¸æ”¹å¯¹è¿è¡Œæ•ˆç‡æ²¡å•¥å¤§çš„å½±å“ï¼Ÿé¦–å…ˆåœ¨æˆ‘ä»¬æœ¬åœ°ä¸€ä¸ªäººæµ‹è¯•ä¸‹æ•ˆç‡æ˜¯ä¸æ€ä¹ˆæ˜æ˜¾ï¼Œä½†æ˜¯å¦‚æœåˆ°å‘å¸ƒä¸Šçº¿åï¼Œä½ çš„ç”¨æˆ·æœ‰å‡ ç™¾ä¸‡ï¼Œç”šè‡³ä¸Šåƒä¸‡ï¼Œè¿™äº›ç”¨æˆ·åŒæ—¶è®¿é—®ä½ çš„ç½‘ç«™ï¼Œé‚£ä¹ˆä½ çš„ç½‘ç«™æ˜¯å¦ç»å¾—ä½è€ƒéªŒå‘¢ï¼Œæ•ˆç‡é‚£é«˜ä¸é«˜å‘¢ï¼Œå¦‚æœæ•ˆç‡ä¸é«˜ï¼Œé‚£ä¹ˆéœ€è¦å¤šå‡ºå¾ˆå¤šä¹°æœåŠ¡å™¨çš„ç»è´¹å‘¢ï¼Œæ‰€ä»¥æƒ³æƒ³è¿˜æ˜¯å¾ˆæœ‰å¿…è¦æ³¨æ„è¿™äº›å°çš„ç»†èŠ‚ã€‚ä»Šå¤©å°±è®²è®²ä¸€äº› Java æ€§èƒ½è°ƒä¼˜éœ€è¦æ ¼å¤–æ³¨æ„çš„ä¸€äº›ç»†èŠ‚ã€‚ ä»£ç ä¼˜åŒ–çš„ç›®æ ‡ï¼š å‡å°‘ä»£ç çš„ä½“ç§¯ æé«˜ä»£ç çš„è¿è¡Œæ•ˆç‡ ä»£ç ä¼˜åŒ–ç»†èŠ‚1ã€å°½é‡æŒ‡å®šç±»ã€æ–¹æ³•çš„finalä¿®é¥°ç¬¦ å¸¦æœ‰finalä¿®é¥°ç¬¦çš„ç±»æ˜¯ä¸å¯æ´¾ç”Ÿçš„ã€‚åœ¨Javaæ ¸å¿ƒAPIä¸­ï¼Œæœ‰è®¸å¤šåº”ç”¨finalçš„ä¾‹å­ï¼Œä¾‹å¦‚java.lang.Stringï¼Œæ•´ä¸ªç±»éƒ½æ˜¯finalçš„ã€‚ä¸ºç±»æŒ‡å®šfinalä¿®é¥°ç¬¦å¯ä»¥è®©ç±»ä¸å¯ä»¥è¢«ç»§æ‰¿ï¼Œä¸ºæ–¹æ³•æŒ‡å®šfinalä¿®é¥°ç¬¦å¯ä»¥è®©æ–¹æ³•ä¸å¯ä»¥è¢«é‡å†™ã€‚å¦‚æœæŒ‡å®šäº†ä¸€ä¸ªç±»ä¸ºfinalã€‚Javaç¼–è¯‘å™¨ä¼šå¯»æ‰¾æœºä¼šå†…è”æ‰€æœ‰çš„finalæ–¹æ³•ï¼Œå†…è”å¯¹äºæå‡Javaè¿è¡Œæ•ˆç‡ä½œç”¨é‡å¤§ï¼Œå…·ä½“å‚è§Javaè¿è¡ŒæœŸä¼˜åŒ–ã€‚ æ­¤ä¸¾èƒ½å¤Ÿä½¿æ€§èƒ½å¹³å‡æé«˜50% ã€‚ 2ã€å°½é‡é‡ç”¨å¯¹è±¡ ç‰¹åˆ«æ˜¯Stringå¯¹è±¡çš„ä½¿ç”¨ï¼Œå‡ºç°å­—ç¬¦ä¸²è¿æ¥æ—¶åº”è¯¥ä½¿ç”¨StringBuilder/StringBufferä»£æ›¿ã€‚ç”±äºJavaè™šæ‹Ÿæœºä¸ä»…è¦èŠ±æ—¶é—´ç”Ÿæˆå¯¹è±¡ï¼Œä»¥åå¯èƒ½è¿˜éœ€è¦èŠ±æ—¶é—´å¯¹è¿™äº›å¯¹è±¡è¿›è¡Œåƒåœ¾å›æ”¶å’Œå¤„ç†ï¼Œå› æ­¤ï¼Œç”Ÿæˆè¿‡å¤šçš„å¯¹è±¡å°†ä¼šç»™ç¨‹åºçš„æ€§èƒ½å¸¦æ¥å¾ˆå¤§çš„å½±å“ã€‚ 3ã€å°½å¯èƒ½ä½¿ç”¨å±€éƒ¨å˜é‡ è°ƒç”¨æ–¹æ³•æ—¶ä¼ é€’çš„å‚æ•°ä»¥åŠåœ¨è°ƒç”¨ä¸­åˆ›å»ºçš„ä¸´æ—¶å˜é‡éƒ½ä¿å­˜åœ¨æ ˆä¸­é€Ÿåº¦è¾ƒå¿«ï¼Œå…¶ä»–å˜é‡ï¼Œå¦‚é™æ€å˜é‡ã€å®ä¾‹å˜é‡ç­‰ï¼Œéƒ½åœ¨å †ä¸­åˆ›å»ºï¼Œé€Ÿåº¦è¾ƒæ…¢ã€‚å¦å¤–ï¼Œæ ˆä¸­åˆ›å»ºçš„å˜é‡ï¼Œéšç€æ–¹æ³•çš„è¿è¡Œç»“æŸï¼Œè¿™äº›å†…å®¹å°±æ²¡äº†ï¼Œä¸éœ€è¦é¢å¤–çš„åƒåœ¾å›æ”¶ã€‚ 4ã€åŠæ—¶å…³é—­æµ Javaç¼–ç¨‹è¿‡ç¨‹ä¸­ï¼Œè¿›è¡Œæ•°æ®åº“è¿æ¥ã€I/Oæµæ“ä½œæ—¶åŠ¡å¿…å°å¿ƒï¼Œåœ¨ä½¿ç”¨å®Œæ¯•åï¼ŒåŠæ—¶å…³é—­ä»¥é‡Šæ”¾èµ„æºã€‚å› ä¸ºå¯¹è¿™äº›å¤§å¯¹è±¡çš„æ“ä½œä¼šé€ æˆç³»ç»Ÿå¤§çš„å¼€é”€ï¼Œç¨æœ‰ä¸æ…ï¼Œå°†ä¼šå¯¼è‡´ä¸¥é‡çš„åæœã€‚ 5ã€å°½é‡å‡å°‘å¯¹å˜é‡çš„é‡å¤è®¡ç®— æ˜ç¡®ä¸€ä¸ªæ¦‚å¿µï¼Œå¯¹æ–¹æ³•çš„è°ƒç”¨ï¼Œå³ä½¿æ–¹æ³•ä¸­åªæœ‰ä¸€å¥è¯­å¥ï¼Œä¹Ÿæ˜¯æœ‰æ¶ˆè€—çš„ï¼ŒåŒ…æ‹¬åˆ›å»ºæ ˆå¸§ã€è°ƒç”¨æ–¹æ³•æ—¶ä¿æŠ¤ç°åœºã€è°ƒç”¨æ–¹æ³•å®Œæ¯•æ—¶æ¢å¤ç°åœºç­‰ã€‚æ‰€ä»¥ä¾‹å¦‚ä¸‹é¢çš„æ“ä½œï¼š 12for (int i = 0; i &lt; list.size(); i++)&#123;...&#125; å»ºè®®æ›¿æ¢ä¸ºï¼š 12for (int i = 0, int length = list.size(); i &lt; length; i++)&#123;...&#125; è¿™æ ·ï¼Œåœ¨list.size()å¾ˆå¤§çš„æ—¶å€™ï¼Œå°±å‡å°‘äº†å¾ˆå¤šçš„æ¶ˆè€— 6ã€å°½é‡é‡‡ç”¨æ‡’åŠ è½½çš„ç­–ç•¥ï¼Œå³åœ¨éœ€è¦çš„æ—¶å€™æ‰åˆ›å»º ä¾‹å¦‚ï¼š 1234String str = \"aaa\";if (i == 1)&#123; list.add(str);&#125; å»ºè®®æ›¿æ¢ä¸ºï¼š 12345if (i == 1)&#123; String str = \"aaa\"; list.add(str);&#125; 7ã€æ…ç”¨å¼‚å¸¸ å¼‚å¸¸å¯¹æ€§èƒ½ä¸åˆ©ã€‚æŠ›å‡ºå¼‚å¸¸é¦–å…ˆè¦åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼ŒThrowableæ¥å£çš„æ„é€ å‡½æ•°è°ƒç”¨åä¸º fillInStackTrace() çš„æœ¬åœ°åŒæ­¥æ–¹æ³•ï¼ŒfillInStackTrace() æ–¹æ³•æ£€æŸ¥å †æ ˆï¼Œæ”¶é›†è°ƒç”¨è·Ÿè¸ªä¿¡æ¯ã€‚åªè¦æœ‰å¼‚å¸¸è¢«æŠ›å‡ºï¼ŒJavaè™šæ‹Ÿæœºå°±å¿…é¡»è°ƒæ•´è°ƒç”¨å †æ ˆï¼Œå› ä¸ºåœ¨å¤„ç†è¿‡ç¨‹ä¸­åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚å¼‚å¸¸åªèƒ½ç”¨äºé”™è¯¯å¤„ç†ï¼Œä¸åº”è¯¥ç”¨æ¥æ§åˆ¶ç¨‹åºæµç¨‹ã€‚ 8ã€ä¸è¦åœ¨å¾ªç¯ä¸­ä½¿ç”¨ tryâ€¦catchâ€¦ï¼Œåº”è¯¥æŠŠå…¶æ”¾åœ¨æœ€å¤–å±‚ é™¤éä¸å¾—å·²ã€‚å¦‚æœæ¯«æ— ç†ç”±åœ°è¿™ä¹ˆå†™äº†ï¼Œåªè¦ä½ çš„é¢†å¯¼èµ„æ·±ä¸€ç‚¹ã€æœ‰å¼ºè¿«ç—‡ä¸€ç‚¹ï¼Œå…«æˆå°±è¦éª‚ä½ ä¸ºä»€ä¹ˆå†™å‡ºè¿™ç§åƒåœ¾ä»£ç æ¥äº†ã€‚ 9ã€å¦‚æœèƒ½ä¼°è®¡åˆ°å¾…æ·»åŠ çš„å†…å®¹é•¿åº¦ï¼Œä¸ºåº•å±‚ä»¥æ•°ç»„æ–¹å¼å®ç°çš„é›†åˆã€å·¥å…·ç±»æŒ‡å®šåˆå§‹é•¿åº¦ æ¯”å¦‚ ArrayListã€LinkedLlistã€StringBuilderã€StringBufferã€HashMapã€HashSet ç­‰ç­‰ï¼Œä»¥ StringBuilder ä¸ºä¾‹ï¼š ï¼ˆ1ï¼‰StringBuilder() // é»˜è®¤åˆ†é…16ä¸ªå­—ç¬¦çš„ç©ºé—´ ï¼ˆ2ï¼‰StringBuilder(int size) // é»˜è®¤åˆ†é…sizeä¸ªå­—ç¬¦çš„ç©ºé—´ ï¼ˆ3ï¼‰StringBuilder(String str) // é»˜è®¤åˆ†é…16ä¸ªå­—ç¬¦+str.length()ä¸ªå­—ç¬¦ç©ºé—´ å¯ä»¥é€šè¿‡ç±»ï¼ˆè¿™é‡ŒæŒ‡çš„ä¸ä»…ä»…æ˜¯ä¸Šé¢çš„ StringBuilder ï¼‰çš„æ¥è®¾å®šå®ƒçš„åˆå§‹åŒ–å®¹é‡ï¼Œè¿™æ ·å¯ä»¥æ˜æ˜¾åœ°æå‡æ€§èƒ½ã€‚æ¯”å¦‚ StringBuilder å§ï¼Œlength è¡¨ç¤ºå½“å‰çš„ StringBuilder èƒ½ä¿æŒçš„å­—ç¬¦æ•°é‡ã€‚å› ä¸ºå½“ StringBuilder è¾¾åˆ°æœ€å¤§å®¹é‡çš„æ—¶å€™ï¼Œå®ƒä¼šå°†è‡ªèº«å®¹é‡å¢åŠ åˆ°å½“å‰çš„2å€å†åŠ 2ï¼Œæ— è®ºä½•æ—¶åªè¦ StringBuilder è¾¾åˆ°å®ƒçš„æœ€å¤§å®¹é‡ï¼Œå®ƒå°±ä¸å¾—ä¸åˆ›å»ºä¸€ä¸ªæ–°çš„å­—ç¬¦æ•°ç»„ç„¶åå°†æ—§çš„å­—ç¬¦æ•°ç»„å†…å®¹æ‹·è´åˆ°æ–°å­—ç¬¦æ•°ç»„ä¸­â€”-è¿™æ˜¯ååˆ†è€—è´¹æ€§èƒ½çš„ä¸€ä¸ªæ“ä½œã€‚è¯•æƒ³ï¼Œå¦‚æœèƒ½é¢„ä¼°åˆ°å­—ç¬¦æ•°ç»„ä¸­å¤§æ¦‚è¦å­˜æ”¾5000ä¸ªå­—ç¬¦è€Œä¸æŒ‡å®šé•¿åº¦ï¼Œæœ€æ¥è¿‘5000çš„2æ¬¡å¹‚æ˜¯4096ï¼Œæ¯æ¬¡æ‰©å®¹åŠ çš„2ä¸ç®¡ï¼Œé‚£ä¹ˆï¼š ï¼ˆ1ï¼‰åœ¨4096 çš„åŸºç¡€ä¸Šï¼Œå†ç”³è¯·8194ä¸ªå¤§å°çš„å­—ç¬¦æ•°ç»„ï¼ŒåŠ èµ·æ¥ç›¸å½“äºä¸€æ¬¡ç”³è¯·äº†12290ä¸ªå¤§å°çš„å­—ç¬¦æ•°ç»„ï¼Œå¦‚æœä¸€å¼€å§‹èƒ½æŒ‡å®š5000ä¸ªå¤§å°çš„å­—ç¬¦æ•°ç»„ï¼Œå°±èŠ‚çœäº†ä¸€å€ä»¥ä¸Šçš„ç©ºé—´ï¼› ï¼ˆ2ï¼‰æŠŠåŸæ¥çš„4096ä¸ªå­—ç¬¦æ‹·è´åˆ°æ–°çš„çš„å­—ç¬¦æ•°ç»„ä¸­å»ã€‚ è¿™æ ·ï¼Œæ—¢æµªè´¹å†…å­˜ç©ºé—´åˆé™ä½ä»£ç è¿è¡Œæ•ˆç‡ã€‚æ‰€ä»¥ï¼Œç»™åº•å±‚ä»¥æ•°ç»„å®ç°çš„é›†åˆã€å·¥å…·ç±»è®¾ç½®ä¸€ä¸ªåˆç†çš„åˆå§‹åŒ–å®¹é‡æ˜¯é”™ä¸äº†çš„ï¼Œè¿™ä¼šå¸¦æ¥ç«‹ç«¿è§å½±çš„æ•ˆæœã€‚ä½†æ˜¯ï¼Œæ³¨æ„ï¼ŒåƒHashMapè¿™ç§æ˜¯ä»¥æ•°ç»„+é“¾è¡¨å®ç°çš„é›†åˆï¼Œåˆ«æŠŠåˆå§‹å¤§å°å’Œä½ ä¼°è®¡çš„å¤§å°è®¾ç½®å¾—ä¸€æ ·ï¼Œå› ä¸ºä¸€ä¸ªtableä¸Šåªè¿æ¥ä¸€ä¸ªå¯¹è±¡çš„å¯èƒ½æ€§å‡ ä¹ä¸º0ã€‚åˆå§‹å¤§å°å»ºè®®è®¾ç½®ä¸º2çš„Næ¬¡å¹‚ï¼Œå¦‚æœèƒ½ä¼°è®¡åˆ°æœ‰2000ä¸ªå…ƒç´ ï¼Œè®¾ç½®æˆ new HashMap(128)ã€new HashMap(256) éƒ½å¯ä»¥ã€‚ 10ã€å½“å¤åˆ¶å¤§é‡æ•°æ®æ—¶ï¼Œä½¿ç”¨ System.arraycopy() å‘½ä»¤ 11ã€ä¹˜æ³•å’Œé™¤æ³•ä½¿ç”¨ç§»ä½æ“ä½œ ä¾‹å¦‚ï¼š 12345for (val = 0; val &lt; 100000; val += 5)&#123; a = val * 8; b = val / 2;&#125; ç”¨ç§»ä½æ“ä½œå¯ä»¥æå¤§åœ°æé«˜æ€§èƒ½ï¼Œå› ä¸ºåœ¨è®¡ç®—æœºåº•å±‚ï¼Œå¯¹ä½çš„æ“ä½œæ˜¯æœ€æ–¹ä¾¿ã€æœ€å¿«çš„ï¼Œå› æ­¤å»ºè®®ä¿®æ”¹ä¸ºï¼š 12345for (val = 0; val &lt; 100000; val += 5)&#123; a = val &lt;&lt; 3; b = val &gt;&gt; 1;&#125; ç§»ä½æ“ä½œè™½ç„¶å¿«ï¼Œä½†æ˜¯å¯èƒ½ä¼šä½¿ä»£ç ä¸å¤ªå¥½ç†è§£ï¼Œå› æ­¤æœ€å¥½åŠ ä¸Šç›¸åº”çš„æ³¨é‡Šã€‚ 12ã€å¾ªç¯å†…ä¸è¦ä¸æ–­åˆ›å»ºå¯¹è±¡å¼•ç”¨ ä¾‹å¦‚ï¼š 1234for (int i = 1; i &lt;= count; i++)&#123; Object obj = new Object();&#125; è¿™ç§åšæ³•ä¼šå¯¼è‡´å†…å­˜ä¸­æœ‰countä»½Objectå¯¹è±¡å¼•ç”¨å­˜åœ¨ï¼Œcountå¾ˆå¤§çš„è¯ï¼Œå°±è€—è´¹å†…å­˜äº†ï¼Œå»ºè®®ä¸ºæ”¹ä¸ºï¼š 12345Object obj = null;for (int i = 0; i &lt;= count; i++) &#123; obj = new Object(); &#125; è¿™æ ·çš„è¯ï¼Œå†…å­˜ä¸­åªæœ‰ä¸€ä»½ Object å¯¹è±¡å¼•ç”¨ï¼Œæ¯æ¬¡ new Object() çš„æ—¶å€™ï¼ŒObject å¯¹è±¡å¼•ç”¨æŒ‡å‘ä¸åŒçš„Objectç½¢äº†ï¼Œä½†æ˜¯å†…å­˜ä¸­åªæœ‰ä¸€ä»½ï¼Œè¿™æ ·å°±å¤§å¤§èŠ‚çœäº†å†…å­˜ç©ºé—´äº†ã€‚ 13ã€åŸºäºæ•ˆç‡å’Œç±»å‹æ£€æŸ¥çš„è€ƒè™‘ï¼Œåº”è¯¥å°½å¯èƒ½ä½¿ç”¨arrayï¼Œæ— æ³•ç¡®å®šæ•°ç»„å¤§å°æ—¶æ‰ä½¿ç”¨ ArrayList 14ã€å°½é‡ä½¿ç”¨ HashMapã€ArrayListã€StringBuilderï¼Œé™¤éçº¿ç¨‹å®‰å…¨éœ€è¦ï¼Œå¦åˆ™ä¸æ¨èä½¿ç”¨ Hashtableã€Vectorã€StringBufferï¼Œåä¸‰è€…ç”±äºä½¿ç”¨åŒæ­¥æœºåˆ¶è€Œå¯¼è‡´äº†æ€§èƒ½å¼€é”€ 15ã€ä¸è¦å°†æ•°ç»„å£°æ˜ä¸º public static final å› ä¸ºè¿™æ¯«æ— æ„ä¹‰ï¼Œè¿™æ ·åªæ˜¯å®šä¹‰äº†å¼•ç”¨ä¸º static finalï¼Œæ•°ç»„çš„å†…å®¹è¿˜æ˜¯å¯ä»¥éšæ„æ”¹å˜çš„ï¼Œå°†æ•°ç»„å£°æ˜ä¸º public æ›´æ˜¯ä¸€ä¸ªå®‰å…¨æ¼æ´ï¼Œè¿™æ„å‘³ç€è¿™ä¸ªæ•°ç»„å¯ä»¥è¢«å¤–éƒ¨ç±»æ‰€æ”¹å˜ã€‚ 16ã€å°½é‡åœ¨åˆé€‚çš„åœºåˆä½¿ç”¨å•ä¾‹ ä½¿ç”¨å•ä¾‹å¯ä»¥å‡è½»åŠ è½½çš„è´Ÿæ‹…ã€ç¼©çŸ­åŠ è½½çš„æ—¶é—´ã€æé«˜åŠ è½½çš„æ•ˆç‡ï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰åœ°æ–¹éƒ½é€‚ç”¨äºå•ä¾‹ï¼Œç®€å•æ¥è¯´ï¼Œå•ä¾‹ä¸»è¦é€‚ç”¨äºä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢ï¼š ï¼ˆ1ï¼‰æ§åˆ¶èµ„æºçš„ä½¿ç”¨ï¼Œé€šè¿‡çº¿ç¨‹åŒæ­¥æ¥æ§åˆ¶èµ„æºçš„å¹¶å‘è®¿é—® ï¼ˆ2ï¼‰æ§åˆ¶å®ä¾‹çš„äº§ç”Ÿï¼Œä»¥è¾¾åˆ°èŠ‚çº¦èµ„æºçš„ç›®çš„ ï¼ˆ3ï¼‰æ§åˆ¶æ•°æ®çš„å…±äº«ï¼Œåœ¨ä¸å»ºç«‹ç›´æ¥å…³è”çš„æ¡ä»¶ä¸‹ï¼Œè®©å¤šä¸ªä¸ç›¸å…³çš„è¿›ç¨‹æˆ–çº¿ç¨‹ä¹‹é—´å®ç°é€šä¿¡ 17ã€å°½é‡é¿å…éšæ„ä½¿ç”¨é™æ€å˜é‡ è¦çŸ¥é“ï¼Œå½“æŸä¸ªå¯¹è±¡è¢«å®šä¹‰ä¸ºstaticçš„å˜é‡æ‰€å¼•ç”¨ï¼Œé‚£ä¹ˆgcé€šå¸¸æ˜¯ä¸ä¼šå›æ”¶è¿™ä¸ªå¯¹è±¡æ‰€å æœ‰çš„å †å†…å­˜çš„ï¼Œå¦‚ï¼š 1234public class A&#123; private static B b = new B();&#125; æ­¤æ—¶é™æ€å˜é‡bçš„ç”Ÿå‘½å‘¨æœŸä¸Aç±»ç›¸åŒï¼Œå¦‚æœAç±»ä¸è¢«å¸è½½ï¼Œé‚£ä¹ˆå¼•ç”¨BæŒ‡å‘çš„Bå¯¹è±¡ä¼šå¸¸é©»å†…å­˜ï¼Œç›´åˆ°ç¨‹åºç»ˆæ­¢ 18ã€åŠæ—¶æ¸…é™¤ä¸å†éœ€è¦çš„ä¼šè¯ ä¸ºäº†æ¸…é™¤ä¸å†æ´»åŠ¨çš„ä¼šè¯ï¼Œè®¸å¤šåº”ç”¨æœåŠ¡å™¨éƒ½æœ‰é»˜è®¤çš„ä¼šè¯è¶…æ—¶æ—¶é—´ï¼Œä¸€èˆ¬ä¸º30åˆ†é’Ÿã€‚å½“åº”ç”¨æœåŠ¡å™¨éœ€è¦ä¿å­˜æ›´å¤šçš„ä¼šè¯æ—¶ï¼Œå¦‚æœå†…å­˜ä¸è¶³ï¼Œé‚£ä¹ˆæ“ä½œç³»ç»Ÿä¼šæŠŠéƒ¨åˆ†æ•°æ®è½¬ç§»åˆ°ç£ç›˜ï¼Œåº”ç”¨æœåŠ¡å™¨ä¹Ÿå¯èƒ½æ ¹æ®MRUï¼ˆæœ€è¿‘æœ€é¢‘ç¹ä½¿ç”¨ï¼‰ç®—æ³•æŠŠéƒ¨åˆ†ä¸æ´»è·ƒçš„ä¼šè¯è½¬å‚¨åˆ°ç£ç›˜ï¼Œç”šè‡³å¯èƒ½æŠ›å‡ºå†…å­˜ä¸è¶³çš„å¼‚å¸¸ã€‚å¦‚æœä¼šè¯è¦è¢«è½¬å‚¨åˆ°ç£ç›˜ï¼Œé‚£ä¹ˆå¿…é¡»è¦å…ˆè¢«åºåˆ—åŒ–ï¼Œåœ¨å¤§è§„æ¨¡é›†ç¾¤ä¸­ï¼Œå¯¹å¯¹è±¡è¿›è¡Œåºåˆ—åŒ–çš„ä»£ä»·æ˜¯å¾ˆæ˜‚è´µçš„ã€‚å› æ­¤ï¼Œå½“ä¼šè¯ä¸å†éœ€è¦æ—¶ï¼Œåº”å½“åŠæ—¶è°ƒç”¨ HttpSession çš„ invalidate() æ–¹æ³•æ¸…é™¤ä¼šè¯ã€‚ 19ã€å®ç° RandomAccess æ¥å£çš„é›†åˆæ¯”å¦‚ ArrayListï¼Œåº”å½“ä½¿ç”¨æœ€æ™®é€šçš„ for å¾ªç¯è€Œä¸æ˜¯ foreach å¾ªç¯æ¥éå† è¿™æ˜¯JDKæ¨èç»™ç”¨æˆ·çš„ã€‚JDK APIå¯¹äº RandomAccess æ¥å£çš„è§£é‡Šæ˜¯ï¼šå®ç° RandomAccess æ¥å£ç”¨æ¥è¡¨æ˜å…¶æ”¯æŒå¿«é€Ÿéšæœºè®¿é—®ï¼Œæ­¤æ¥å£çš„ä¸»è¦ç›®çš„æ˜¯å…è®¸ä¸€èˆ¬çš„ç®—æ³•æ›´æ”¹å…¶è¡Œä¸ºï¼Œä»è€Œå°†å…¶åº”ç”¨åˆ°éšæœºæˆ–è¿ç»­è®¿é—®åˆ—è¡¨æ—¶èƒ½æä¾›è‰¯å¥½çš„æ€§èƒ½ã€‚å®é™…ç»éªŒè¡¨æ˜ï¼Œå®ç° RandomAccess æ¥å£çš„ç±»å®ä¾‹ï¼Œå‡å¦‚æ˜¯éšæœºè®¿é—®çš„ï¼Œä½¿ç”¨æ™®é€š for å¾ªç¯æ•ˆç‡å°†é«˜äºä½¿ç”¨ foreach å¾ªç¯ï¼›åè¿‡æ¥ï¼Œå¦‚æœæ˜¯é¡ºåºè®¿é—®çš„ï¼Œåˆ™ä½¿ç”¨ Iterator ä¼šæ•ˆç‡æ›´é«˜ã€‚å¯ä»¥ä½¿ç”¨ç±»ä¼¼å¦‚ä¸‹çš„ä»£ç ä½œåˆ¤æ–­ï¼š 12345678910if (list instanceof RandomAccess)&#123; for (int i = 0; i &lt; list.size(); i++)&#123;&#125;&#125;else&#123; Iterator&lt;?&gt; iterator = list.iterable(); while (iterator.hasNext()) &#123; iterator.next(); &#125;&#125; foreach å¾ªç¯çš„åº•å±‚å®ç°åŸç†å°±æ˜¯è¿­ä»£å™¨ Iteratorï¼Œå‚è§Javaè¯­æ³•ç³–1ï¼šå¯å˜é•¿åº¦å‚æ•°ä»¥åŠ foreach å¾ªç¯åŸç†ã€‚æ‰€ä»¥ååŠå¥â€åè¿‡æ¥ï¼Œå¦‚æœæ˜¯é¡ºåºè®¿é—®çš„ï¼Œåˆ™ä½¿ç”¨ Iterator ä¼šæ•ˆç‡æ›´é«˜â€çš„æ„æ€å°±æ˜¯é¡ºåºè®¿é—®çš„é‚£äº›ç±»å®ä¾‹ï¼Œä½¿ç”¨ foreach å¾ªç¯å»éå†ã€‚ 20ã€ä½¿ç”¨åŒæ­¥ä»£ç å—æ›¿ä»£åŒæ­¥æ–¹æ³• è¿™ç‚¹åœ¨å¤šçº¿ç¨‹æ¨¡å—ä¸­çš„ synchronized é”æ–¹æ³•å—ä¸€æ–‡ä¸­å·²ç»è®²å¾—å¾ˆæ¸…æ¥šäº†ï¼Œé™¤éèƒ½ç¡®å®šä¸€æ•´ä¸ªæ–¹æ³•éƒ½æ˜¯éœ€è¦è¿›è¡ŒåŒæ­¥çš„ï¼Œå¦åˆ™å°½é‡ä½¿ç”¨åŒæ­¥ä»£ç å—ï¼Œé¿å…å¯¹é‚£äº›ä¸éœ€è¦è¿›è¡ŒåŒæ­¥çš„ä»£ç ä¹Ÿè¿›è¡Œäº†åŒæ­¥ï¼Œå½±å“äº†ä»£ç æ‰§è¡Œæ•ˆç‡ã€‚ 21ã€å°†å¸¸é‡å£°æ˜ä¸º static finalï¼Œå¹¶ä»¥å¤§å†™å‘½å è¿™æ ·åœ¨ç¼–è¯‘æœŸé—´å°±å¯ä»¥æŠŠè¿™äº›å†…å®¹æ”¾å…¥å¸¸é‡æ± ä¸­ï¼Œé¿å…è¿è¡ŒæœŸé—´è®¡ç®—ç”Ÿæˆå¸¸é‡çš„å€¼ã€‚å¦å¤–ï¼Œå°†å¸¸é‡çš„åå­—ä»¥å¤§å†™å‘½åä¹Ÿå¯ä»¥æ–¹ä¾¿åŒºåˆ†å‡ºå¸¸é‡ä¸å˜é‡ 22ã€ä¸è¦åˆ›å»ºä¸€äº›ä¸ä½¿ç”¨çš„å¯¹è±¡ï¼Œä¸è¦å¯¼å…¥ä¸€äº›ä¸ä½¿ç”¨çš„ç±» è¿™æ¯«æ— æ„ä¹‰ï¼Œå¦‚æœä»£ç ä¸­å‡ºç°â€The value of the local variable i is not usedâ€ã€â€The import java.util is never usedâ€ï¼Œé‚£ä¹ˆè¯·åˆ é™¤è¿™äº›æ— ç”¨çš„å†…å®¹ 23ã€ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­é¿å…ä½¿ç”¨åå°„ å…³äºï¼Œè¯·å‚è§åå°„ã€‚åå°„æ˜¯Javaæä¾›ç»™ç”¨æˆ·ä¸€ä¸ªå¾ˆå¼ºå¤§çš„åŠŸèƒ½ï¼ŒåŠŸèƒ½å¼ºå¤§å¾€å¾€æ„å‘³ç€æ•ˆç‡ä¸é«˜ã€‚ä¸å»ºè®®åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ä½¿ç”¨å°¤å…¶æ˜¯é¢‘ç¹ä½¿ç”¨åå°„æœºåˆ¶ï¼Œç‰¹åˆ«æ˜¯Methodçš„invokeæ–¹æ³•ï¼Œå¦‚æœç¡®å®æœ‰å¿…è¦ï¼Œä¸€ç§å»ºè®®æ€§çš„åšæ³•æ˜¯å°†é‚£äº›éœ€è¦é€šè¿‡åå°„åŠ è½½çš„ç±»åœ¨é¡¹ç›®å¯åŠ¨çš„æ—¶å€™é€šè¿‡åå°„å®ä¾‹åŒ–å‡ºä¸€ä¸ªå¯¹è±¡å¹¶æ”¾å…¥å†…å­˜â€”-ç”¨æˆ·åªå…³å¿ƒå’Œå¯¹ç«¯äº¤äº’çš„æ—¶å€™è·å–æœ€å¿«çš„å“åº”é€Ÿåº¦ï¼Œå¹¶ä¸å…³å¿ƒå¯¹ç«¯çš„é¡¹ç›®å¯åŠ¨èŠ±å¤šä¹…æ—¶é—´ã€‚ 24ã€ä½¿ç”¨æ•°æ®åº“è¿æ¥æ± å’Œçº¿ç¨‹æ±  è¿™ä¸¤ä¸ªæ± éƒ½æ˜¯ç”¨äºé‡ç”¨å¯¹è±¡çš„ï¼Œå‰è€…å¯ä»¥é¿å…é¢‘ç¹åœ°æ‰“å¼€å’Œå…³é—­è¿æ¥ï¼Œåè€…å¯ä»¥é¿å…é¢‘ç¹åœ°åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹ 25ã€ä½¿ç”¨å¸¦ç¼“å†²çš„è¾“å…¥è¾“å‡ºæµè¿›è¡ŒIOæ“ä½œ å¸¦ç¼“å†²çš„è¾“å…¥è¾“å‡ºæµï¼Œå³BufferedReaderã€BufferedWriterã€BufferedInputStreamã€BufferedOutputStreamï¼Œè¿™å¯ä»¥æå¤§åœ°æå‡IOæ•ˆç‡ 26ã€é¡ºåºæ’å…¥å’Œéšæœºè®¿é—®æ¯”è¾ƒå¤šçš„åœºæ™¯ä½¿ç”¨ArrayListï¼Œå…ƒç´ åˆ é™¤å’Œä¸­é—´æ’å…¥æ¯”è¾ƒå¤šçš„åœºæ™¯ä½¿ç”¨LinkedListè¿™ä¸ªï¼Œç†è§£ArrayListå’ŒLinkedListçš„åŸç†å°±çŸ¥é“äº† 27ã€ä¸è¦è®©publicæ–¹æ³•ä¸­æœ‰å¤ªå¤šçš„å½¢å‚ publicæ–¹æ³•å³å¯¹å¤–æä¾›çš„æ–¹æ³•ï¼Œå¦‚æœç»™è¿™äº›æ–¹æ³•å¤ªå¤šå½¢å‚çš„è¯ä¸»è¦æœ‰ä¸¤ç‚¹åå¤„ï¼š 1ã€è¿åäº†é¢å‘å¯¹è±¡çš„ç¼–ç¨‹æ€æƒ³ï¼ŒJavaè®²æ±‚ä¸€åˆ‡éƒ½æ˜¯å¯¹è±¡ï¼Œå¤ªå¤šçš„å½¢å‚ï¼Œå’Œé¢å‘å¯¹è±¡çš„ç¼–ç¨‹æ€æƒ³å¹¶ä¸å¥‘åˆ 2ã€å‚æ•°å¤ªå¤šåŠ¿å¿…å¯¼è‡´æ–¹æ³•è°ƒç”¨çš„å‡ºé”™æ¦‚ç‡å¢åŠ  è‡³äºè¿™ä¸ªâ€å¤ªå¤šâ€æŒ‡çš„æ˜¯å¤šå°‘ä¸ªï¼Œ3ã€4ä¸ªå§ã€‚æ¯”å¦‚æˆ‘ä»¬ç”¨JDBCå†™ä¸€ä¸ªinsertStudentInfoæ–¹æ³•ï¼Œæœ‰10ä¸ªå­¦ç”Ÿä¿¡æ¯å­—æ®µè¦æ’å¦‚Studentè¡¨ä¸­ï¼Œå¯ä»¥æŠŠè¿™10ä¸ªå‚æ•°å°è£…åœ¨ä¸€ä¸ªå®ä½“ç±»ä¸­ï¼Œä½œä¸ºinsertæ–¹æ³•çš„å½¢å‚ã€‚ 28ã€å­—ç¬¦ä¸²å˜é‡å’Œå­—ç¬¦ä¸²å¸¸é‡equalsçš„æ—¶å€™å°†å­—ç¬¦ä¸²å¸¸é‡å†™åœ¨å‰é¢ è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„å°æŠ€å·§äº†ï¼Œå¦‚æœæœ‰ä»¥ä¸‹ä»£ç ï¼š 12String str = \"123\";if (str.equals(\"123\")) &#123;...&#125; å»ºè®®ä¿®æ”¹ä¸ºï¼š 12345String str = \"123\";if (\"123\".equals(str))&#123;...&#125; è¿™ä¹ˆåšä¸»è¦æ˜¯å¯ä»¥é¿å…ç©ºæŒ‡é’ˆå¼‚å¸¸ 29ã€è¯·çŸ¥é“ï¼Œåœ¨javaä¸­if (i == 1)å’Œif (1 == i)æ˜¯æ²¡æœ‰åŒºåˆ«çš„ï¼Œä½†ä»é˜…è¯»ä¹ æƒ¯ä¸Šè®²ï¼Œå»ºè®®ä½¿ç”¨å‰è€… å¹³æ—¶æœ‰äººé—®ï¼Œâ€if (i == 1)â€å’Œâ€if (1== i)â€æœ‰æ²¡æœ‰åŒºåˆ«ï¼Œè¿™å°±è¦ä»C/C++è®²èµ·ã€‚ åœ¨C/C++ä¸­ï¼Œâ€if (i == 1)â€åˆ¤æ–­æ¡ä»¶æˆç«‹ï¼Œæ˜¯ä»¥0ä¸é0ä¸ºåŸºå‡†çš„ï¼Œ0è¡¨ç¤ºfalseï¼Œé0è¡¨ç¤ºtrueï¼Œå¦‚æœæœ‰è¿™ä¹ˆä¸€æ®µä»£ç ï¼š 123456int i = 2;if (i == 1)&#123;...&#125;else&#123;...&#125; C/C++åˆ¤æ–­â€i==1â€³ä¸æˆç«‹ï¼Œæ‰€ä»¥ä»¥0è¡¨ç¤ºï¼Œå³falseã€‚ä½†æ˜¯å¦‚æœï¼š 1234567int i = 2;if (i = 1)&#123; ... &#125;else&#123;... &#125; ä¸‡ä¸€ç¨‹åºå‘˜ä¸€ä¸ªä¸å°å¿ƒï¼ŒæŠŠâ€if (i == 1)â€å†™æˆâ€if (i = 1)â€ï¼Œè¿™æ ·å°±æœ‰é—®é¢˜äº†ã€‚åœ¨ifä¹‹å†…å°†ièµ‹å€¼ä¸º1ï¼Œifåˆ¤æ–­é‡Œé¢çš„å†…å®¹é0ï¼Œè¿”å›çš„å°±æ˜¯trueäº†ï¼Œä½†æ˜¯æ˜æ˜iä¸º2ï¼Œæ¯”è¾ƒçš„å€¼æ˜¯1ï¼Œåº”è¯¥è¿”å›çš„falseã€‚è¿™ç§æƒ…å†µåœ¨C/C++çš„å¼€å‘ä¸­æ˜¯å¾ˆå¯èƒ½å‘ç”Ÿçš„å¹¶ä¸”ä¼šå¯¼è‡´ä¸€äº›éš¾ä»¥ç†è§£çš„é”™è¯¯äº§ç”Ÿï¼Œæ‰€ä»¥ï¼Œä¸ºäº†é¿å…å¼€å‘è€…åœ¨ifè¯­å¥ä¸­ä¸æ­£ç¡®çš„èµ‹å€¼æ“ä½œï¼Œå»ºè®®å°†ifè¯­å¥å†™ä¸ºï¼š 123456int i = 2;if (1 == i) &#123;... &#125;else&#123;... &#125; è¿™æ ·ï¼Œå³ä½¿å¼€å‘è€…ä¸å°å¿ƒå†™æˆäº†â€1 = iâ€ï¼ŒC/C++ç¼–è¯‘å™¨ä¹Ÿå¯ä»¥ç¬¬ä¸€æ—¶é—´æ£€æŸ¥å‡ºæ¥ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥å¯¹ä¸€ä¸ªå˜é‡èµ‹å€¼iä¸º1ï¼Œä½†æ˜¯ä¸èƒ½å¯¹ä¸€ä¸ªå¸¸é‡èµ‹å€¼1ä¸ºiã€‚ ä½†æ˜¯ï¼Œåœ¨Javaä¸­ï¼ŒC/C++è¿™ç§â€if (i = 1)â€çš„è¯­æ³•æ˜¯ä¸å¯èƒ½å‡ºç°çš„ï¼Œå› ä¸ºä¸€æ—¦å†™äº†è¿™ç§è¯­æ³•ï¼ŒJavaå°±ä¼šç¼–è¯‘æŠ¥é”™â€Type mismatch: cannot convert from int to booleanâ€ã€‚ä½†æ˜¯ï¼Œå°½ç®¡Javaçš„â€if (i == 1)â€å’Œâ€if (1 == i)â€åœ¨è¯­ä¹‰ä¸Šæ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼Œä½†æ˜¯ä»é˜…è¯»ä¹ æƒ¯ä¸Šè®²ï¼Œå»ºè®®ä½¿ç”¨å‰è€…ä¼šæ›´å¥½äº›ã€‚ 30ã€ä¸è¦å¯¹æ•°ç»„ä½¿ç”¨toString()æ–¹æ³• çœ‹ä¸€ä¸‹å¯¹æ•°ç»„ä½¿ç”¨toString()æ‰“å°å‡ºæ¥çš„æ˜¯ä»€ä¹ˆï¼š 12345public static void main(String[] args)&#123; int[] is = new int[]&#123;1, 2, 3&#125;; System.out.println(is.toString());&#125; ç»“æœæ˜¯ï¼š 1[I@18a992f æœ¬æ„æ˜¯æƒ³æ‰“å°å‡ºæ•°ç»„å†…å®¹ï¼Œå´æœ‰å¯èƒ½å› ä¸ºæ•°ç»„å¼•ç”¨isä¸ºç©ºè€Œå¯¼è‡´ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚ä¸è¿‡è™½ç„¶å¯¹æ•°ç»„toString()æ²¡æœ‰æ„ä¹‰ï¼Œä½†æ˜¯å¯¹é›†åˆtoString()æ˜¯å¯ä»¥æ‰“å°å‡ºé›†åˆé‡Œé¢çš„å†…å®¹çš„ï¼Œå› ä¸ºé›†åˆçš„çˆ¶ç±»AbstractCollectionsé‡å†™äº†Objectçš„toString()æ–¹æ³•ã€‚ 31ã€ä¸è¦å¯¹è¶…å‡ºèŒƒå›´çš„åŸºæœ¬æ•°æ®ç±»å‹åšå‘ä¸‹å¼ºåˆ¶è½¬å‹ è¿™ç»ä¸ä¼šå¾—åˆ°æƒ³è¦çš„ç»“æœï¼š 12345public static void main(String[] args)&#123; long l = 12345678901234L;int i = (int)l; System.out.println(i);&#125; æˆ‘ä»¬å¯èƒ½æœŸæœ›å¾—åˆ°å…¶ä¸­çš„æŸå‡ ä½ï¼Œä½†æ˜¯ç»“æœå´æ˜¯ï¼š 1942892530 è§£é‡Šä¸€ä¸‹ã€‚Javaä¸­longæ˜¯8ä¸ªå­—èŠ‚64ä½çš„ï¼Œæ‰€ä»¥12345678901234åœ¨è®¡ç®—æœºä¸­çš„è¡¨ç¤ºåº”è¯¥æ˜¯ï¼š 0000 0000 0000 0000 0000 1011 0011 1010 0111 0011 1100 1110 0010 1111 1111 0010 ä¸€ä¸ªintå‹æ•°æ®æ˜¯4ä¸ªå­—èŠ‚32ä½çš„ï¼Œä»ä½ä½å–å‡ºä¸Šé¢è¿™ä¸²äºŒè¿›åˆ¶æ•°æ®çš„å‰32ä½æ˜¯ï¼š 0111 0011 1100 1110 0010 1111 1111 0010 è¿™ä¸²äºŒè¿›åˆ¶è¡¨ç¤ºä¸ºåè¿›åˆ¶1942892530ï¼Œæ‰€ä»¥å°±æ˜¯æˆ‘ä»¬ä¸Šé¢çš„æ§åˆ¶å°ä¸Šè¾“å‡ºçš„å†…å®¹ã€‚ä»è¿™ä¸ªä¾‹å­ä¸Šè¿˜èƒ½é¡ºä¾¿å¾—åˆ°ä¸¤ä¸ªç»“è®ºï¼š 1ã€æ•´å‹é»˜è®¤çš„æ•°æ®ç±»å‹æ˜¯intï¼Œlong l = 12345678901234Lï¼Œè¿™ä¸ªæ•°å­—å·²ç»è¶…å‡ºäº†intçš„èŒƒå›´äº†ï¼Œæ‰€ä»¥æœ€åæœ‰ä¸€ä¸ªLï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªlongå‹æ•°ã€‚é¡ºä¾¿ï¼Œæµ®ç‚¹å‹çš„é»˜è®¤ç±»å‹æ˜¯doubleï¼Œæ‰€ä»¥å®šä¹‰floatçš„æ—¶å€™è¦å†™æˆâ€â€float f = 3.5fâ€ 2ã€æ¥ä¸‹æ¥å†å†™ä¸€å¥â€int ii = l + i;â€ä¼šæŠ¥é”™ï¼Œå› ä¸ºlong + intæ˜¯ä¸€ä¸ªlongï¼Œä¸èƒ½èµ‹å€¼ç»™int 32ã€å…¬ç”¨çš„é›†åˆç±»ä¸­ä¸ä½¿ç”¨çš„æ•°æ®ä¸€å®šè¦åŠæ—¶removeæ‰ å¦‚æœä¸€ä¸ªé›†åˆç±»æ˜¯å…¬ç”¨çš„ï¼ˆä¹Ÿå°±æ˜¯è¯´ä¸æ˜¯æ–¹æ³•é‡Œé¢çš„å±æ€§ï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ªé›†åˆé‡Œé¢çš„å…ƒç´ æ˜¯ä¸ä¼šè‡ªåŠ¨é‡Šæ”¾çš„ï¼Œå› ä¸ºå§‹ç»ˆæœ‰å¼•ç”¨æŒ‡å‘å®ƒä»¬ã€‚æ‰€ä»¥ï¼Œå¦‚æœå…¬ç”¨é›†åˆé‡Œé¢çš„æŸäº›æ•°æ®ä¸ä½¿ç”¨è€Œä¸å»removeæ‰å®ƒä»¬ï¼Œé‚£ä¹ˆå°†ä¼šé€ æˆè¿™ä¸ªå…¬ç”¨é›†åˆä¸æ–­å¢å¤§ï¼Œä½¿å¾—ç³»ç»Ÿæœ‰å†…å­˜æ³„éœ²çš„éšæ‚£ã€‚ 33ã€æŠŠä¸€ä¸ªåŸºæœ¬æ•°æ®ç±»å‹è½¬ä¸ºå­—ç¬¦ä¸²ï¼ŒåŸºæœ¬æ•°æ®ç±»å‹.toString()æ˜¯æœ€å¿«çš„æ–¹å¼ã€String.valueOf(æ•°æ®)æ¬¡ä¹‹ã€æ•°æ®+â€â€æœ€æ…¢ æŠŠä¸€ä¸ªåŸºæœ¬æ•°æ®ç±»å‹è½¬ä¸ºä¸€èˆ¬æœ‰ä¸‰ç§æ–¹å¼ï¼Œæˆ‘æœ‰ä¸€ä¸ªIntegerå‹æ•°æ®iï¼Œå¯ä»¥ä½¿ç”¨i.toString()ã€String.valueOf(i)ã€i+â€â€ä¸‰ç§æ–¹å¼ï¼Œä¸‰ç§æ–¹å¼çš„æ•ˆç‡å¦‚ä½•ï¼Œçœ‹ä¸€ä¸ªæµ‹è¯•ï¼š 1234567891011121314151617181920212223public static void main(String[] args)&#123; int loopTime = 50000; Integer i = 0; long startTime = System.currentTimeMillis(); for (int j = 0; j &lt; loopTime; j++) &#123; String str = String.valueOf(i); &#125;System.out.println(\"String.valueOf()ï¼š\" + (System.currentTimeMillis() - startTime) + \"ms\"); startTime = System.currentTimeMillis(); for (int j = 0; j &lt; loopTime; j++) &#123; String str = i.toString(); &#125;System.out.println(\"Integer.toString()ï¼š\" + (System.currentTimeMillis() - startTime) + \"ms\");startTime = System.currentTimeMillis(); for (int j = 0; j &lt; loopTime; j++)&#123; String str = i + \"\";&#125;System.out.println(\"i + \\\"\\\"ï¼š\" + (System.currentTimeMillis() - startTime) + \"ms\");&#125; è¿è¡Œç»“æœä¸ºï¼š 1String.valueOf()ï¼š11ms Integer.toString()ï¼š5ms i + &quot;&quot;ï¼š25ms æ‰€ä»¥ä»¥åé‡åˆ°æŠŠä¸€ä¸ªåŸºæœ¬æ•°æ®ç±»å‹è½¬ä¸ºStringçš„æ—¶å€™ï¼Œä¼˜å…ˆè€ƒè™‘ä½¿ç”¨toString()æ–¹æ³•ã€‚è‡³äºä¸ºä»€ä¹ˆï¼Œå¾ˆç®€å•ï¼š 1ã€String.valueOf()æ–¹æ³•åº•å±‚è°ƒç”¨äº†Integer.toString()æ–¹æ³•ï¼Œä½†æ˜¯ä¼šåœ¨è°ƒç”¨å‰åšç©ºåˆ¤æ–­ 2ã€Integer.toString()æ–¹æ³•å°±ä¸è¯´äº†ï¼Œç›´æ¥è°ƒç”¨äº† 3ã€i + â€œâ€åº•å±‚ä½¿ç”¨äº†StringBuilderå®ç°ï¼Œå…ˆç”¨appendæ–¹æ³•æ‹¼æ¥ï¼Œå†ç”¨toString()æ–¹æ³•è·å–å­—ç¬¦ä¸² ä¸‰è€…å¯¹æ¯”ä¸‹æ¥ï¼Œæ˜æ˜¾æ˜¯2æœ€å¿«ã€1æ¬¡ä¹‹ã€3æœ€æ…¢ 34ã€ä½¿ç”¨æœ€æœ‰æ•ˆç‡çš„æ–¹å¼å»éå†Map éå†Mapçš„æ–¹å¼æœ‰å¾ˆå¤šï¼Œé€šå¸¸åœºæ™¯ä¸‹æˆ‘ä»¬éœ€è¦çš„æ˜¯éå†Mapä¸­çš„Keyå’ŒValueï¼Œé‚£ä¹ˆæ¨èä½¿ç”¨çš„ã€æ•ˆç‡æœ€é«˜çš„æ–¹å¼æ˜¯ï¼š 123456789101112public static void main(String[] args)&#123;HashMap&lt;String, String&gt; hm = new HashMap&lt;String, String&gt;();hm.put(\"111\", \"222\");Set&lt;Map.Entry&lt;String, String&gt;&gt; entrySet = hm.entrySet();Iterator&lt;Map.Entry&lt;String, String&gt;&gt; iter = entrySet.iterator(); while (iter.hasNext())&#123;Map.Entry&lt;String, String&gt; entry = iter.next();System.out.println(entry.getKey() + \"\\t\" + entry.getValue());&#125;&#125; å¦‚æœä½ åªæ˜¯æƒ³éå†ä¸€ä¸‹è¿™ä¸ªMapçš„keyå€¼ï¼Œé‚£ç”¨â€Set keySet = hm.keySet();â€ä¼šæ¯”è¾ƒåˆé€‚ä¸€äº› 35ã€å¯¹èµ„æºçš„close()å»ºè®®åˆ†å¼€æ“ä½œ æ„æ€æ˜¯ï¼Œæ¯”å¦‚æˆ‘æœ‰è¿™ä¹ˆä¸€æ®µä»£ç ï¼š 12345try&#123;XXX.close();YYY.close();&#125;catch (Exception e)&#123;...&#125; å»ºè®®ä¿®æ”¹ä¸ºï¼š 123456789try&#123; XXX.close(); &#125;catch (Exception e) &#123; ... &#125;try&#123; YYY.close(); &#125;catch (Exception e) &#123; ... &#125; è™½ç„¶æœ‰äº›éº»çƒ¦ï¼Œå´èƒ½é¿å…èµ„æºæ³„éœ²ã€‚æˆ‘æƒ³ï¼Œå¦‚æœæ²¡æœ‰ä¿®æ”¹è¿‡çš„ä»£ç ï¼Œä¸‡ä¸€XXX.close()æŠ›å¼‚å¸¸äº†ï¼Œé‚£ä¹ˆå°±è¿›å…¥äº†cathå—ä¸­äº†ï¼ŒYYY.close()ä¸ä¼šæ‰§è¡Œï¼ŒYYYè¿™å—èµ„æºå°±ä¸ä¼šå›æ”¶äº†ï¼Œä¸€ç›´å ç”¨ç€ï¼Œè¿™æ ·çš„ä»£ç ä¸€å¤šï¼Œæ˜¯å¯èƒ½å¼•èµ·èµ„æºå¥æŸ„æ³„éœ²çš„ã€‚è€Œæ”¹ä¸ºä¸Šé¢çš„å†™æ³•ä¹‹åï¼Œå°±ä¿è¯äº†æ— è®ºå¦‚ä½•XXXå’ŒYYYéƒ½ä¼šè¢«closeæ‰ã€‚ ä»¥ä¸Šå°±æ˜¯ Java å¼€å‘ç¼–ç¨‹æ³¨æ„ç»†èŠ‚çš„å…¨éƒ¨å†…å®¹äº†ï¼Œæ„Ÿè°¢å¤§å®¶çš„é˜…è¯»ï¼","tags":[{"name":"Java","slug":"Java","permalink":"http://www.54tianzhisheng.cn/tags/Java/"}]},{"title":"Spring MVCç³»åˆ—æ–‡ç« ï¼ˆäº”ï¼‰ï¼šçœ‹é€ Spring MVC æºä»£ç åˆ†æä¸å®è·µ â€”â€”  Spring MVC ç»„ä»¶åˆ†æ","date":"2017-07-20T16:00:00.000Z","path":"2017/07/21/Spring-MVC03/","text":"SpringBoot ç³»åˆ—æ–‡ç«  ç”±äºæ˜ŸæœŸä¸€æ¥åˆ°é¢è¯•é€šçŸ¥ï¼Œå’Œé¢è¯•å®˜çº¦å¥½äº†æ˜ŸæœŸå››é¢è¯•ï¼Œæ‰€ä»¥è¿™å‡ å¤©æ²¡æ›´æ–°å®Œè¿™ç³»åˆ—çš„æ–‡ç« ï¼Œé¢å®Œè¯•åç«‹é©¬å°±æŠŠè¿™ä¸ªè§£å†³æ‰ã€‚é€šè¿‡è¿™æ¬¡é¢è¯•ï¼Œä¹Ÿè®©æˆ‘æ‡‚å¾—äº†å¾ˆå¤šï¼ŒçŸ¥é“äº†è‡ªå·±çš„ä¸€äº›ä¸è¶³ä¹‹å¤„ï¼Œåé¢è¿˜è¦ç»§ç»­ä¸‹åŠŸå¤«å¥½å¥½çš„æ·±å…¥å¤ä¹ ä¸‹å»ã€‚è¿™å‡ ç¯‡æ–‡ç« å†™çš„æˆ‘è§‰å¾—è¿˜æ˜¯ä¸å¤Ÿä»”ç»†ï¼Œæ„Ÿå…´è¶£çš„è¿˜æ˜¯å»ºè®®è‡ªå·±å»çœ‹çœ‹æºç ã€‚ ç¬¬ 11 ç«  â€”â€” ç»„ä»¶æ¦‚è§ˆHandlerMapping æ ¹æ® request æ‰¾åˆ°å¯¹åº”çš„å¤„ç†å™¨ Handler å’Œ Interceptorsã€‚å†…éƒ¨åªæœ‰ä¸€ä¸ªæ–¹æ³• 1HandlerExecutionChain getHandler(HttpServletRequest request) throws Exception; HandlerAdapter Handler é€‚é…å™¨ï¼Œå†…éƒ¨æ–¹æ³•å¦‚ä¸‹ï¼š 123boolean supports(Object handler);//åˆ¤æ–­æ˜¯å¦å¯ä»¥ä½¿ç”¨æŸä¸ª HandlerModelAndView handle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception; //å…·ä½“ä½¿ç”¨long getLastModified(HttpServletRequest request, Object handler);//è·å–èµ„æºä¸Šä¸€æ¬¡ä¿®æ”¹çš„æ—¶é—´ HandlerExceptionResolver æ ¹æ®å¼‚å¸¸è®¾ç½® ModelAndView ï¼Œå†äº¤ç»™ render æ–¹æ³•è¿›è¡Œæ¸²æŸ“ã€‚ 12ModelAndView resolveException( HttpServletRequest request, HttpServletResponse response, @Nullable Object handler, Exception ex) ViewResolver ç”¨æ¥å°† String ç±»å‹çš„è§†å›¾åå’Œ Locale è§£æä¸º View ç±»å‹çš„è§†å›¾ã€‚ 1View resolveViewName(String viewName, Locale locale) throws Exception; å®ƒçš„ä¸€ä¸ªå®ç°ç±» BeanNameViewResolverï¼Œå®ƒé‡å†™ resolveViewName æ–¹æ³•å¦‚ä¸‹: 1234567891011121314151617181920212223public View resolveViewName(String viewName, Locale locale) throws BeansException &#123; ApplicationContext context = getApplicationContext(); //å¦‚æœåº”ç”¨ä¸Šä¸‹æ–‡æ²¡æœ‰æ‰¾åˆ°è§†å›¾ï¼Œè¿”å› null if (!context.containsBean(viewName)) &#123; if (logger.isDebugEnabled()) &#123; logger.debug(\"No matching bean found for view name '\" + viewName + \"'\"); &#125; // Allow for ViewResolver chaining... return null; &#125; //å¦‚æœæ‰¾åˆ°çš„è§†å›¾ç±»å‹ä¸åŒ¹é…ï¼Œä¹Ÿè¿”å› null if (!context.isTypeMatch(viewName, View.class)) &#123; if (logger.isDebugEnabled()) &#123; logger.debug(\"Found matching bean for view name '\" + viewName + \"' - to be ignored since it does not implement View\"); &#125; // Since we're looking into the general ApplicationContext here, // let's accept this as a non-match and allow for chaining as well... return null; &#125; //æ ¹æ®è§†å›¾åç§°ä» Spring å®¹å™¨ä¸­æŸ¥æ‰¾ Beanï¼Œè¿”å›æ‰¾åˆ°çš„ bean return context.getBean(viewName, View.class); &#125; RequestToViewNameTranslator è·å– request ä¸­çš„è§†å›¾åã€‚æ¥å£é‡Œé¢ä¹Ÿæ˜¯åªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼š 1String getViewName(HttpServletRequest request) throws Exception; //æ ¹æ® request æŸ¥æ‰¾è§†å›¾å LocaleResolver ç”¨äºä» request è§£æå‡º Localeã€‚ 123456public interface LocaleResolver &#123; //ä» request è§£æå‡º Locale Locale resolveLocale(HttpServletRequest request); //æ ¹æ® request è®¾ç½® locale void setLocale(HttpServletRequest request, HttpServletResponse response, @Nullable Locale locale);&#125; ThemeResolver è§£æä¸»é¢˜ 123456public interface ThemeResolver &#123; //é€šè¿‡ç»™å®šçš„ request æŸ¥æ‰¾ä¸»é¢˜å String resolveThemeName(HttpServletRequest request); //æ ¹æ®ç»™å®šçš„ request è®¾ç½®ä¸»é¢˜å void setThemeName(HttpServletRequest request, HttpServletResponse response, String themeName);&#125; åœ¨ RequestContext.java æ–‡ä»¶ä¸­å¯ä»¥è·å–ä¸»é¢˜ï¼š 1234567891011121314151617public String getThemeMessage(String code, String defaultMessage) &#123; //è·å–ä¸»é¢˜çš„ä¿¡æ¯ return getTheme().getMessageSource().getMessage(code, null, defaultMessage, this.locale); &#125;public Theme getTheme() &#123; //åˆ¤æ–­ä¸»é¢˜æ˜¯å¦ä¸ºç©º if (this.theme == null) &#123; // é€šè¿‡ RequestContextUtils è·å– request ä¸­çš„ä¸»é¢˜å this.theme = RequestContextUtils.getTheme(this.request); if (this.theme == null) &#123; //å¦‚æœè¿˜æ˜¯ä¸ºç©ºçš„è¯ //é‚£å°±æ˜¯æ²¡æœ‰æœ‰æ•ˆçš„ä¸»é¢˜è§£æå™¨å’Œä¸»é¢˜ this.theme = getFallbackTheme(); &#125; &#125; return this.theme; &#125; RequestContextUtils.getTheme() æ–¹æ³•ï¼š 1234567891011public static Theme getTheme(HttpServletRequest request) &#123; ThemeResolver themeResolver = getThemeResolver(request); ThemeSource themeSource = getThemeSource(request); if (themeResolver != null &amp;&amp; themeSource != null) &#123; String themeName = themeResolver.resolveThemeName(request); return themeSource.getTheme(themeName); &#125; else &#123; return null; &#125; &#125; MultipartResolver ç”¨äºå¤„ç†ä¸Šä¼ è¯·æ±‚ï¼Œå¤„ç†æ–¹æ³•ï¼šå°†æ™®é€šçš„ request åŒ…è£…æˆ MultipartHttpServletRequest 12345678public interface MultipartResolver &#123; //æ ¹æ® request åˆ¤æ–­æ˜¯å¦æ˜¯ä¸Šä¼ è¯·æ±‚ boolean isMultipart(HttpServletRequest request); //å°† request åŒ…è£…æˆ MultipartHttpServletRequest MultipartHttpServletRequest resolveMultipart(HttpServletRequest request) throws MultipartException; //æ¸…ç†ä¸Šä¼ è¿‡ç¨‹ä¸­äº§ç”Ÿçš„ä¸´æ—¶èµ„æº void cleanupMultipart(MultipartHttpServletRequest request);&#125; FlashMapManager FlashMap ä¸»è¦åœ¨ redirect ä¸­ä¼ é€’å‚æ•°ï¼ŒFlashMapManager ç”¨æ¥ç®¡ç† FlashMap çš„ã€‚ 1234567public interface FlashMapManager &#123; //æ¢å¤å‚æ•°ï¼Œå¹¶å°†æ¢å¤è¿‡çš„å’Œè¶…æ—¶çš„å‚æ•°ä»ä¿å­˜ä»‹è´¨ä¸­åˆ é™¤ @Nullable FlashMap retrieveAndUpdate(HttpServletRequest request, HttpServletResponse response); //å°†å‚æ•°ä¿å­˜èµ·æ¥ void saveOutputFlashMap(FlashMap flashMap, HttpServletRequest request, HttpServletResponse response);&#125; å°ç»“ä»‹ç» Spring MVC ä¸­ä¹å¤§ç»„ä»¶çš„æ¥å£ã€ä½œç”¨ã€å†…éƒ¨æ–¹æ³•å®ç°åŠä½œç”¨è¿›è¡Œäº†ç®€å•çš„ä»‹ç»ï¼Œè¯¦ç»†çš„è¿˜éœ€å¤§å®¶è‡ªå·±å»çœ‹æºç ã€‚ æ€»ç»“Spring MVC åŸç†æ€»ç»“æœ¬è´¨æ˜¯ä¸€ä¸ª Servletï¼Œè¿™ä¸ª Servlet ç»§æ‰¿è‡ª HttpServletã€‚Spring MVC ä¸­æä¾›äº†ä¸‰ä¸ªå±‚æ¬¡çš„ Servletï¼šHttpServletBeanã€FrameworkServlet å’Œ DispatcherServletã€‚ä»–ä»¬ç›¸äº’ç»§æ‰¿ï¼Œ HttpServletBean ç›´æ¥ç»§æ‰¿è‡ª Java çš„ HttpServletã€‚HttpServletBean ç”¨äºå°† Servlet ä¸­çš„ Servlet ä¸­é…ç½®çš„å‚æ•°è®¾ç½®åˆ°ç›¸åº”çš„å±æ€§ä¸­ï¼ŒFrameworkServlet åˆå§‹åŒ–äº† Spring MVC ä¸­æ‰€ä½¿ç”¨çš„ WebApplicationContextï¼Œå…·ä½“å¤„ç†è¯·æ±‚çš„ 9 å¤§ç»„ä»¶æ˜¯åœ¨ DispatcherServlet ä¸­åˆå§‹åŒ–çš„ï¼Œæ•´ä¸ªç»§æ‰¿å›¾å¦‚ä¸‹ï¼š æœ€åæ–‡ç« å¯è½¬å‘ï¼Œä½†è¯·æ³¨æ˜åŸåˆ›åœ°å€ï¼Œè°¢è°¢æ”¯æŒã€‚","tags":[{"name":"Spring MVC","slug":"Spring-MVC","permalink":"http://www.54tianzhisheng.cn/tags/Spring-MVC/"}]},{"title":"Spring MVCç³»åˆ—æ–‡ç« ï¼ˆä¸‰ï¼‰ï¼šçœ‹é€ Spring MVC æºä»£ç åˆ†æä¸å®è·µ â€”â€”  ç½‘ç«™åŸºç¡€çŸ¥è¯†","date":"2017-07-13T16:00:00.000Z","path":"2017/07/14/Spring-MVC01/","text":"ç½‘ç«™æ¶æ„åŠå…¶æ¼”å˜è¿‡ç¨‹åŸºç¡€ç»“æ„ç½‘ç»œä¼ è¾“åˆ†è§£æ–¹å¼ï¼š æ ‡å‡†çš„ OSI å‚è€ƒæ¨¡å‹ TCP/IP å‚è€ƒæ¨¡å‹ SpringBoot ç³»åˆ—æ–‡ç«  æµ·é‡æ•°æ®çš„è§£å†³æ–¹æ¡ˆ ç¼“å­˜å’Œé¡µé¢é™æ€åŒ– ç¼“å­˜ é€šè¿‡ç¨‹åºç›´æ¥ä¿å­˜åœ¨å†…å­˜ä¸­ ä½¿ç”¨ç¼“å­˜æ¡†æ¶ ï¼ˆEncacheã€Redisã€Memcacheï¼‰ é¡µé¢é™æ€åŒ– ä½¿ç”¨æ¨¡æ¿æŠ€æœ¯ç”Ÿæˆï¼ˆVelocityã€FreeMakerç­‰ï¼‰ æ•°æ®åº“ä¼˜åŒ– è¡¨ç»“æ„ä¼˜åŒ– SQL è¯­å¥ä¼˜åŒ– åˆ†åŒº åˆ†è¡¨ ç´¢å¼•ä¼˜åŒ– ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹ä»£æ›¿ç›´æ¥æ“ä½œè¿‡ç¨‹ åˆ†ç¦»æ´»è·ƒæ•°æ® æ‰¹é‡è¯»å–å’Œå»¶è¿Ÿä¿®æ”¹ è¯»å†™åˆ†ç¦» åˆ†å¸ƒå¼æ•°æ®åº“ NoSQL å’Œ Hadoop é«˜å¹¶å‘çš„è§£å†³æ–¹æ¡ˆ åº”ç”¨å’Œé™æ€èµ„æºçš„åˆ†ç¦»ï¼šé™æ€æ–‡ä»¶ï¼ˆå›¾ç‰‡ã€è§†é¢‘ã€JSã€CSSç­‰ï¼‰æ”¾åœ¨ä¸“é—¨çš„æœåŠ¡å™¨ä¸Š é¡µé¢ç¼“å­˜ï¼ˆNginx æœåŠ¡å™¨ã€Squid æœåŠ¡å™¨ï¼‰ é›†ç¾¤ä¸åˆ†å¸ƒå¼ åå‘ä»£ç† CDN åº•å±‚ä¼˜åŒ–ï¼šç½‘ç»œä¼ è¾“åè®® å¸¸è§åè®®å’Œæ ‡å‡†TCP/IP åè®®IPï¼šæŸ¥æ‰¾åœ°å€ï¼Œå¯¹åº”ç€å›½é™…äº’è”ç½‘ TCPï¼šè§„èŒƒä¼ è¾“è§„åˆ™ï¼Œå¯¹åº”ç€ä¼ è¾“å±‚ TCP åœ¨ä¼ è¾“ä¹‹å‰ä¼šè¿›è¡Œä¸‰æ¬¡æ²Ÿé€šï¼Œç§° â€œä¸‰æ¬¡æ¡æ‰‹â€ï¼Œä¼ å®Œæ•°æ®æ–­å¼€çš„æ—¶å€™è¦è¿›è¡Œå››æ¬¡æ²Ÿé€šï¼Œç§° â€œå››æ¬¡æŒ¥æ‰‹â€ã€‚ TCP ä¸¤ä¸ªåºå·ï¼Œä¸‰ä¸ªæ ‡å¿—ä½å«ä¹‰ï¼š seqï¼šè¡¨ç¤ºæ‰€ä¼ æ•°æ®çš„åºå·ã€‚TCP ä¼ è¾“æ—¶æ¯ä¸€ä¸ªå­—èŠ‚éƒ½æœ‰ä¸€ä¸ªåºå·ï¼Œå‘é€æ•°æ®çš„æ—¶å€™ä¼šå°†æ•°æ®çš„ç¬¬ä¸€ä¸ªåºå·å‘é€ç»™å¯¹æ–¹ï¼Œæ¥æ”¶æ–¹ä¼šæŒ‰åºå·æ£€æŸ¥æ˜¯å¦æ¥æ”¶å®Œæ•´äº†ï¼Œå¦‚æœæ²¡æ¥æ”¶å®Œæ•´å°±éœ€è¦é‡æ–°ä¼ é€ï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯æ•°æ®çš„å®Œæ•´æ€§ã€‚ ackï¼šè¡¨ç¤ºç¡®è®¤å·ã€‚æ¥æ”¶ç«¯ç”¨å®ƒæ¥ç»™å‘é€ç«¯åé¦ˆå·²ç»æˆåŠŸæ¥æ”¶åˆ°çš„æ•°æ®ä¿¡æ¯ï¼Œå®ƒçš„å€¼ä¸ºå¸Œæœ›æ¥æ”¶çš„ä¸‹ä¸€ä¸ªæ•°æ®åŒ…èµ·å§‹åºå·ã€‚ ACKï¼šç¡®è®¤ä½ï¼Œåªæœ‰ ACK = 1 çš„æ—¶å€™ ack æ‰èµ·ä½œç”¨ã€‚æ­£å¸¸é€šä¿¡æ—¶ ACK ä¸º 1ï¼Œç¬¬ä¸€æ¬¡å‘èµ·è¯·æ±‚æ—¶å› ä¸ºæ²¡æœ‰éœ€è¦ç¡®è®¤æ¥æ”¶çš„æ•°æ®æ‰€ä»¥ ACK ä¸º 0ã€‚ SYNï¼šåŒæ­¥ä½ï¼Œç”¨äºåœ¨å»ºç«‹è¿æ¥æ—¶åŒæ­¥åºå·ã€‚åˆšå¼€å§‹å»ºç«‹è¿æ¥æ—¶å¹¶æ²¡æœ‰å†å²æ¥æ”¶çš„æ•°æ®ï¼Œæ‰€ä»¥ ack ä¹Ÿå°±æ²¡æœ‰åŠæ³•è®¾ç½®ï¼Œè¿™æ˜¯æŒ‰ç…§æ­£å¸¸çš„æœºåˆ¶å°±æ— æ³•è¿è¡Œäº†ï¼ŒSYN çš„ä½œç”¨å°±æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜çš„ï¼Œå½“æ¥æ”¶ç«¯æ¥æ”¶åˆ° SYN = 1 çš„æŠ¥æ–‡æ—¶å°±ä¼šç›´æ¥å°† ack è®¾ç½®ä¸ºæ¥æ”¶åˆ°çš„ seq + 1 çš„å€¼ï¼Œæ³¨æ„è¿™é‡Œçš„å€¼å¹¶ä¸æ˜¯æ£€éªŒåè®¾ç½®çš„ï¼Œè€Œæ˜¯æ ¹æ® SYN ç›´æ¥è®¾ç½®çš„ï¼Œè¿™æ ·æ­£å¸¸çš„æœºåˆ¶å°±å¯ä»¥è¿è¡Œäº†ï¼Œæ‰€ä»¥ SYN å«åŒæ­¥ä½ã€‚SYN ä¼šåœ¨å‰ä¸¤æ¬¡æ¡æ‰‹æ—¶éƒ½ä¸º 1ï¼Œè¿™æ˜¯å› ä¸ºé€šä¿¡çš„åŒæ–¹çš„ ack éƒ½éœ€è¦è®¾ç½®ä¸€ä¸ªåˆå§‹å€¼ã€‚ FINï¼šç»ˆæ­¢ä½ï¼Œç”¨æ¥åœ¨æ•°æ®ä¼ è¾“å®Œæ¯•åé‡Šæ”¾è¿æ¥ã€‚ DNS çš„è®¾ç½®DNS è§£æå‚è€ƒåŸŸåè®¾ç½®ï¼Œå¦‚ä¸‹æ˜¯æˆ‘åœ¨è…¾è®¯äº‘åŸŸåçš„è®¾ç½® è®°å½•ç±»å‹ï¼š Aè®°å½•ï¼š å°†åŸŸåæŒ‡å‘ä¸€ä¸ªIPv4åœ°å€ï¼ˆä¾‹å¦‚ï¼š8.8.8.8ï¼‰CNAMEï¼šå°†åŸŸåæŒ‡å‘å¦ä¸€ä¸ªåŸŸåï¼ˆä¾‹å¦‚ www.54tianzhisheng.cnï¼‰MXï¼š å°†åŸŸåæŒ‡å‘é‚®ä»¶æœåŠ¡å™¨åœ°å€TXTï¼š å¯ä»»æ„å¡«å†™ï¼Œé•¿åº¦é™åˆ¶255ï¼Œé€šå¸¸åšSPFè®°å½•ï¼ˆååƒåœ¾é‚®ä»¶ï¼‰NSï¼š åŸŸåæœåŠ¡å™¨è®°å½•ï¼Œå°†å­åŸŸåæŒ‡å®šå…¶ä»–DNSæœåŠ¡å™¨è§£æAAAAï¼šå°†åŸŸåæŒ‡å‘ä¸€ä¸ªiPv6åœ°å€ï¼ˆä¾‹å¦‚ï¼šff06:0:0:0:0:0:0:c3ï¼‰SRVï¼šè®°å½•æä¾›ç‰¹å®šæœåŠ¡çš„æœåŠ¡å™¨ï¼ˆä¾‹å¦‚_xmpp-server._tcpï¼‰æ˜¾æ€§URLï¼šå°†åŸŸå301é‡å®šå‘åˆ°å¦ä¸€ä¸ªåœ°å€éšæ€§URLï¼šç±»ä¼¼æ˜¾æ€§URLï¼Œä½†æ˜¯ä¼šéšè—çœŸå®ç›®æ ‡åœ°å€ ä¸»æœºè®°å½•ï¼š è¦è§£æ www.54tianzhisheng.cnï¼Œè¯·å¡«å†™ wwwã€‚ä¸»æœºè®°å½•å°±æ˜¯åŸŸåå‰ç¼€ï¼Œå¸¸è§ç”¨æ³•æœ‰ï¼š www: è§£æåçš„åŸŸåä¸º www.54tianzhisheng.cnã€‚@: ç›´æ¥è§£æä¸»åŸŸå 54tianzhisheng.cnã€‚*: æ³›è§£æï¼ŒåŒ¹é…å…¶ä»–æ‰€æœ‰åŸŸå .54tianzhisheng.cnã€‚mail: å°†åŸŸåè§£æä¸º mail.54tianzhisheng.cnï¼Œé€šå¸¸ç”¨äºè§£æé‚®ç®±æœåŠ¡å™¨ã€‚äºŒçº§åŸŸå: å¦‚ï¼šabc.54tianzhisheng.cnï¼Œå¡«å†™abcã€‚*æ‰‹æœºç½‘ç«™: å¦‚ï¼šm.54tianzhisheng.cnï¼Œå¡«å†™mã€‚ Java ä¸­ Socket çš„ç”¨æ³•æ™®é€š Soket çš„ç”¨æ³•Socket åˆ†ä¸º ServerSocket å’Œ Socket ä¸¤å¤§ç±»ã€‚ ServerSocket ç”¨äºæœåŠ¡å™¨ç«¯ï¼Œå¯ä»¥é€šè¿‡ accept æ–¹æ³•ç›‘å¬è¯·æ±‚ï¼Œç›‘å¬åˆ°è¯·æ±‚åè¿”å› Socketï¼› Socket ç”¨æˆ·å…·ä½“å®Œæˆæ•°æ®ä¼ è¾“ï¼Œå®¢æˆ·ç«¯ç›´æ¥ä½¿ç”¨ Socket å‘é€è¯·æ±‚å¹¶ä¼ è¾“æ•°æ®ã€‚ éšä¾¿å†™äº†ä¸ªå•æ–¹é¢å‘é€æ¶ˆæ¯çš„ demoï¼š å®¢æˆ·ç«¯ï¼š 12345678910111213141516171819202122232425import java.io.IOException;import java.io.OutputStream;import java.net.Socket;/** * Created by 10412 on 2017/5/2. * TCPå®¢æˆ·ç«¯ï¼š â‘ ï¼šå»ºç«‹tcpçš„socketæœåŠ¡ï¼Œæœ€å¥½æ˜ç¡®å…·ä½“çš„åœ°å€å’Œç«¯å£ã€‚è¿™ä¸ªå¯¹è±¡åœ¨åˆ›å»ºæ—¶ï¼Œå°±å·²ç»å¯ä»¥å¯¹æŒ‡å®šipå’Œç«¯å£è¿›è¡Œè¿æ¥(ä¸‰æ¬¡æ¡æ‰‹)ã€‚ â‘¡ï¼šå¦‚æœè¿æ¥æˆåŠŸï¼Œå°±æ„å‘³ç€é€šé“å»ºç«‹äº†ï¼Œsocketæµå°±å·²ç»äº§ç”Ÿäº†ã€‚åªè¦è·å–åˆ°socketæµä¸­çš„è¯»å–æµå’Œå†™å…¥æµå³å¯ï¼Œåªè¦é€šè¿‡getInputStreamå’ŒgetOutputStreamå°±å¯ä»¥è·å–ä¸¤ä¸ªæµå¯¹è±¡ã€‚ â‘¢ï¼šå…³é—­èµ„æºã€‚ *///å•æ–¹é¢çš„è¾“å…¥ï¼public class TcpClient&#123; public static void main(String[] args) &#123; try &#123; Socket s = new Socket(\"127.0.0.1\", 9999); OutputStream o = s.getOutputStream(); o.write(\"tcp sssss\".getBytes()); s.close(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125;&#125; æœåŠ¡å™¨ç«¯ï¼š 1234567891011121314151617181920212223242526272829303132import java.io.IOException;import java.io.InputStream;import java.net.ServerSocket;import java.net.Socket;/** * Created by 10412 on 2017/5/2. */public class TcpServer&#123; public static void main(String[] args) &#123; try &#123; ServerSocket ss = new ServerSocket(9999);//å»ºç«‹æœåŠ¡ç«¯çš„socketæœåŠ¡ Socket s = ss.accept();//è·å–å®¢æˆ·ç«¯å¯¹è±¡ String ip = s.getInetAddress().getHostAddress(); int port = s.getPort(); System.out.println(ip + \" : \" + port + \" connected\"); // å¯ä»¥é€šè¿‡è·å–åˆ°çš„socketå¯¹è±¡ä¸­çš„socketæµå’Œå…·ä½“çš„å®¢æˆ·ç«¯è¿›è¡Œé€šè®¯ã€‚ InputStream ins = s.getInputStream();//è¯»å–å®¢æˆ·ç«¯çš„æ•°æ®ï¼Œä½¿ç”¨å®¢æˆ·ç«¯å¯¹è±¡çš„socketè¯»å–æµ byte[] bytes = new byte[1024]; int len = ins.read(bytes); String text = new String(bytes, 0, len); System.out.println(text); //å…³é—­èµ„æº s.close(); ss.close(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125;&#125; NioSocket çš„ç”¨æ³•è§ä»¥å‰çš„ä¸€ç¯‡æ–‡ç« ï¼šJava NIO ç³»åˆ—æ•™ç¨‹ ä¹¦ä¸­ç¬¬äº”ç« ç®€å•çš„è®²äº†ä¸‹å®ç° HTTP åè®®ã€‚ç¬¬å…­ç« ä¸»è¦è®² Servletï¼Œå†™äº† Servlet æ¥å£å’Œå…¶å®ç°ç±»ã€‚ç¬¬ä¸ƒç« æŠŠ Tomcat åˆ†æçš„å¾ˆä¸é”™ï¼Œå¦‚æœæœ‰è¯»è€…æ„Ÿå…´è¶£çš„è¯ï¼Œå¯ä»¥å»çœ‹çœ‹ã€‚","tags":[{"name":"Spring MVC","slug":"Spring-MVC","permalink":"http://www.54tianzhisheng.cn/tags/Spring-MVC/"}]},{"title":"Spring MVCç³»åˆ—æ–‡ç« ï¼ˆå››ï¼‰ï¼šçœ‹é€ Spring MVC æºä»£ç åˆ†æä¸å®è·µ â€”â€”  ä¿¯è§† Spring MVC","date":"2017-07-13T16:00:00.000Z","path":"2017/07/14/Spring-MVC02/","text":"Spring MVC SpringBoot ç³»åˆ—æ–‡ç«  Spring MVC ä¹‹åˆä½“éªŒç¯å¢ƒæ­å»ºåœ¨ IDEA ä¸­æ–°å»ºä¸€ä¸ª web é¡¹ç›®ï¼Œç”¨ Maven ç®¡ç†é¡¹ç›®çš„è¯ï¼Œåœ¨ pom.xml ä¸­åŠ å…¥ Spring MVC å’Œ Servlet ä¾èµ–å³å¯ã€‚ 12345678910111213&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-webmvc --&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt; &lt;version&gt;4.3.9.RELEASE&lt;/version&gt;&lt;/dependency&gt;&lt;!-- https://mvnrepository.com/artifact/javax.servlet/javax.servlet-api --&gt;&lt;dependency&gt; &lt;groupId&gt;javax.servlet&lt;/groupId&gt; &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt; &lt;version&gt;3.1.0&lt;/version&gt; &lt;scope&gt;provided&lt;/scope&gt;&lt;/dependency&gt; Spring MVC ç®€å•é…ç½® åœ¨ web.xml ä¸­é…ç½® Servlet åˆ›å»º Spring MVC çš„ xml é…ç½®æ–‡ä»¶ åˆ›å»º Controller å’Œ View 1ã€web.xml 12345678910111213141516171819202122232425262728293031323334&lt;!-- Spring MVCé…ç½® --&gt;&lt;!-- ====================================== --&gt;&lt;servlet&gt; &lt;servlet-name&gt;spring&lt;/servlet-name&gt; &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt; &lt;!-- å¯ä»¥è‡ªå®šä¹‰servlet.xmlé…ç½®æ–‡ä»¶çš„ä½ç½®å’Œåç§°ï¼Œé»˜è®¤ä¸ºWEB-INFç›®å½•ä¸‹ï¼Œåç§°ä¸º[&lt;servlet-name&gt;]-servlet.xmlï¼Œå¦‚spring-servlet.xml &lt;init-param&gt; &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt; &lt;param-value&gt;/WEB-INF/spring-servlet.xml&lt;/param-value&gt;&amp;nbsp; é»˜è®¤ &lt;/init-param&gt; --&gt; &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;&lt;/servlet&gt;&lt;servlet-mapping&gt; &lt;servlet-name&gt;spring&lt;/servlet-name&gt; &lt;url-pattern&gt;*.do&lt;/url-pattern&gt;&lt;/servlet-mapping&gt;&lt;!-- Springé…ç½® --&gt;&lt;!-- ====================================== --&gt;&lt;listener&gt; &lt;listenerclass&gt; org.springframework.web.context.ContextLoaderListener &lt;/listener-class&gt;&lt;/listener&gt;&lt;!-- æŒ‡å®šSpring Beançš„é…ç½®æ–‡ä»¶æ‰€åœ¨ç›®å½•ã€‚é»˜è®¤é…ç½®åœ¨WEB-INFç›®å½•ä¸‹ --&gt;&lt;context-param&gt; &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt; &lt;param-value&gt;classpath:config/applicationContext.xml&lt;/param-value&gt;&lt;/context-param&gt; 2ã€spring-servlet.xml 123456789101112131415161718192021&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;beans xmlns=\"http://www.springframework.org/schema/beans\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:p=\"http://www.springframework.org/schema/p\" xmlns:context=\"http://www.springframework.org/schema/context\" xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.0.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-3.0.xsd http://www.springframework.org/schema/context &lt;a href=\"http://www.springframework.org/schema/context/spring-context-3.0.xsd\"&gt;http://www.springframework.org/schema/context/spring-context-3.0.xsd&lt;/a&gt;\"&gt; &lt;!-- å¯ç”¨spring mvc æ³¨è§£ --&gt; &lt;context:annotation-config /&gt; &lt;!-- è®¾ç½®ä½¿ç”¨æ³¨è§£çš„ç±»æ‰€åœ¨çš„jaråŒ… --&gt; &lt;context:component-scan base-package=\"controller\"&gt;&lt;/context:component-scan&gt; &lt;!-- å®Œæˆè¯·æ±‚å’Œæ³¨è§£POJOçš„æ˜ å°„ --&gt; &lt;bean class=\"org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter\" /&gt; &lt;!-- å¯¹è½¬å‘é¡µé¢çš„è·¯å¾„è§£æã€‚prefixï¼šå‰ç¼€ï¼Œ suffixï¼šåç¼€ --&gt; &lt;bean class=\"org.springframework.web.servlet.view.InternalResourceViewResolver\" p:prefix=\"/jsp/\" p:suffix=\".jsp\" /&gt;&lt;/beans&gt; 3ã€Controller 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061package controller;import javax.servlet.http.HttpServletRequest;import org.springframework.stereotype.Controller;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestParam;import entity.User;@Controller //ç±»ä¼¼Strutsçš„Actionpublic class TestController &#123; @RequestMapping(\"/test/login.do\") // è¯·æ±‚urlåœ°å€æ˜ å°„ï¼Œç±»ä¼¼Strutsçš„action-mapping public String testLogin(@RequestParam(value=\"username\")String username, String password, HttpServletRequest request) &#123; // @RequestParamæ˜¯æŒ‡è¯·æ±‚urlåœ°å€æ˜ å°„ä¸­å¿…é¡»å«æœ‰çš„å‚æ•°(é™¤éå±æ€§ required=false, é»˜è®¤ä¸º true) // @RequestParamå¯ç®€å†™ä¸ºï¼š@RequestParam(\"username\") if (!\"admin\".equals(username) || !\"admin\".equals(password)) &#123; return \"loginError\"; // è·³è½¬é¡µé¢è·¯å¾„ï¼ˆé»˜è®¤ä¸ºè½¬å‘ï¼‰ï¼Œè¯¥è·¯å¾„ä¸éœ€è¦åŒ…å«spring-servleté…ç½®æ–‡ä»¶ä¸­é…ç½®çš„å‰ç¼€å’Œåç¼€ &#125; return \"loginSuccess\"; &#125; @RequestMapping(\"/test/login2.do\") public ModelAndView testLogin2(String username, String password, int age)&#123; // requestå’Œresponseä¸å¿…éè¦å‡ºç°åœ¨æ–¹æ³•ä¸­ï¼Œå¦‚æœç”¨ä¸ä¸Šçš„è¯å¯ä»¥å»æ‰ // å‚æ•°çš„åç§°æ˜¯ä¸é¡µé¢æ§ä»¶çš„nameç›¸åŒ¹é…ï¼Œå‚æ•°ç±»å‹ä¼šè‡ªåŠ¨è¢«è½¬æ¢ if (!\"admin\".equals(username) || !\"admin\".equals(password) || age &lt; 5) &#123; return new ModelAndView(\"loginError\"); // æ‰‹åŠ¨å®ä¾‹åŒ–ModelAndViewå®Œæˆè·³è½¬é¡µé¢ï¼ˆè½¬å‘ï¼‰ï¼Œæ•ˆæœç­‰åŒäºä¸Šé¢çš„æ–¹æ³•è¿”å›å­—ç¬¦ä¸² &#125; return new ModelAndView(new RedirectView(\"../index.jsp\")); // é‡‡ç”¨é‡å®šå‘æ–¹å¼è·³è½¬é¡µé¢ // é‡å®šå‘è¿˜æœ‰ä¸€ç§ç®€å•å†™æ³• // return new ModelAndView(\"redirect:../index.jsp\"); &#125; @RequestMapping(\"/test/login3.do\") public ModelAndView testLogin3(User user) &#123; // åŒæ ·æ”¯æŒå‚æ•°ä¸ºè¡¨å•å¯¹è±¡ï¼Œç±»ä¼¼äºStrutsçš„ActionFormï¼ŒUserä¸éœ€è¦ä»»ä½•é…ç½®ï¼Œç›´æ¥å†™å³å¯ String username = user.getUsername(); String password = user.getPassword(); int age = user.getAge(); if (!\"admin\".equals(username) || !\"admin\".equals(password) || age &lt; 5) &#123; return new ModelAndView(\"loginError\"); &#125; return new ModelAndView(\"loginSuccess\"); &#125; @Resource(name = \"loginService\") // è·å–applicationContext.xmlä¸­beançš„idä¸ºloginServiceçš„ï¼Œå¹¶æ³¨å…¥ private LoginService loginService; //ç­‰ä»·äºspringä¼ ç»Ÿæ³¨å…¥æ–¹å¼å†™getå’Œsetæ–¹æ³•ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯ç®€æ´å·¥æ•´ï¼Œçœå»äº†ä¸å¿…è¦å¾—ä»£ç  @RequestMapping(\"/test/login4.do\") public String testLogin4(User user) &#123; if (loginService.login(user) == false) &#123; return \"loginError\"; &#125; return \"loginSuccess\"; &#125;&#125; @RequestMapping å¯ä»¥å†™åœ¨æ–¹æ³•ä¸Šï¼Œä¹Ÿå¯ä»¥å†™åœ¨ç±»ä¸Šï¼Œä¸Šé¢ä»£ç æ–¹æ³•ä¸Šçš„ RequestMapping éƒ½å«æœ‰ /test ï¼Œ é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å°†å…¶æŠ½å‡ºç›´æ¥å†™åœ¨ç±»ä¸Šï¼Œé‚£ä¹ˆæ–¹æ³•é‡Œé¢å°±ä¸éœ€è¦å†™ /test äº†ã€‚ å¦‚ä¸‹å³å¯ï¼š 12345678910111213141516@Controller@RequestMapping(\"/test\")public class TestController &#123; @RequestMapping(\"/login.do\") // è¯·æ±‚urlåœ°å€æ˜ å°„ï¼Œç±»ä¼¼Strutsçš„action-mapping public String testLogin(@RequestParam(value=\"username\")String username, String password, HttpServletRequest request) &#123; // @RequestParamæ˜¯æŒ‡è¯·æ±‚urlåœ°å€æ˜ å°„ä¸­å¿…é¡»å«æœ‰çš„å‚æ•°(é™¤éå±æ€§ required=false, é»˜è®¤ä¸º true) // @RequestParamå¯ç®€å†™ä¸ºï¼š@RequestParam(\"username\") if (!\"admin\".equals(username) || !\"admin\".equals(password)) &#123; return \"loginError\"; // è·³è½¬é¡µé¢è·¯å¾„ï¼ˆé»˜è®¤ä¸ºè½¬å‘ï¼‰ï¼Œè¯¥è·¯å¾„ä¸éœ€è¦åŒ…å«spring-servleté…ç½®æ–‡ä»¶ä¸­é…ç½®çš„å‰ç¼€å’Œåç¼€ &#125; return \"loginSuccess\"; &#125; //çœç•¥å…¶ä»–çš„&#125; ä¸Šé¢çš„ä»£ç æ–¹æ³•çš„å‚æ•°ä¸­å¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ª @RequestParam æ³¨è§£ï¼Œå…¶å®è¿˜æœ‰ @PathVariable ã€‚è¿™ä¸¤ä¸ªçš„åŒºåˆ«æ˜¯å•¥å‘¢ï¼Ÿ @PathVariable æ ‡è®°åœ¨æ–¹æ³•çš„å‚æ•°ä¸Šï¼Œåˆ©ç”¨å®ƒæ ‡è®°çš„å‚æ•°å¯ä»¥åˆ©ç”¨è¯·æ±‚è·¯å¾„ä¼ å€¼ã€‚ @RequestParamæ˜¯æŒ‡è¯·æ±‚urlåœ°å€æ˜ å°„ä¸­å¿…é¡»å«æœ‰çš„å‚æ•°(é™¤éå±æ€§ required=false, é»˜è®¤ä¸º true) çœ‹å¦‚ä¸‹ä¾‹å­ï¼š 123456789101112@RequestMapping(\"/user/&#123;userId&#125;\") // è¯·æ±‚urlåœ°å€æ˜ å°„public String userinfo(Model model, @PathVariable(\"userId\") int userId, HttpSession session) &#123; System.out.println(\"è¿›å…¥ userinfo é¡µé¢\"); //åˆ¤æ–­æ˜¯å¦æœ‰ç”¨æˆ·ç™»å½• User user1 = (User) session.getAttribute(\"user\"); if (user1 == null) &#123; return \"login\"; &#125; User user = userService.selectUserById(userId); model.addAttribute(\"user\", user); return \"userinfo\"; &#125; ä¸Šé¢ä¾‹å­ä¸­å¦‚æœæµè§ˆå™¨è¯·æ±‚çš„æ˜¯ /user/1 çš„æ—¶å€™ï¼Œå°±è¡¨ç¤ºæ­¤æ—¶çš„ç”¨æˆ· id ä¸º 1ï¼Œæ­¤æ—¶å°±ä¼šå…ˆä» session ä¸­æŸ¥æ‰¾æ˜¯å¦æœ‰ â€œuserâ€ å±æ€§ï¼Œå¦‚æœæœ‰çš„è¯ï¼Œå°±ä»£è¡¨ç”¨æˆ·æ­¤æ—¶å¤„äºç™»å½•çš„çŠ¶æ€ï¼Œå¦‚æœæ²¡æœ‰çš„è¯ï¼Œå°±ä¼šè®©ç”¨æˆ·è¿”å›åˆ°ç™»å½•é¡µé¢ï¼Œè¿™ç§æœºåˆ¶åœ¨å„ç§ç½‘ç«™ç»å¸¸ä¼šä½¿ç”¨çš„ï¼Œç„¶åæ ¹æ®è¿™ä¸ª id = 1 ï¼Œå»æŸ¥æ‰¾ç”¨æˆ·çš„ä¿¡æ¯ï¼Œç„¶åæŠŠæŸ¥æ‰¾çš„ â€œuserâ€ æ”¾åœ¨ model ä¸­ï¼Œç„¶åè¿”å›ç”¨æˆ·è¯¦æƒ…é¡µé¢ï¼Œæœ€ååœ¨é¡µé¢ä¸­ç”¨ $!{user.name} è·å–ç”¨æˆ·çš„åå­—ï¼ŒåŒæ ·çš„æ–¹å¼å¯ä»¥è·å–ç”¨æˆ·çš„å…¶ä»–ä¿¡æ¯ï¼ŒæŠŠæ‰€æœ‰çš„ç”¨æˆ·è¯¦æƒ…ä¿¡æ¯å±•ç¤ºå‡ºæ¥ã€‚ åˆ›å»º Spring MVC ä¹‹å™¨Spring MVC æ ¸å¿ƒ Servlet æ¶æ„å›¾å¦‚ä¸‹ï¼š Java ä¸­å¸¸ç”¨çš„ Servlet æˆ‘åœ¨å¦å¤–ä¸€ç¯‡æ–‡ç« å†™çš„å¾ˆæ¸…æ¥šäº†ï¼Œæœ‰å…´è¶£çš„è¯·çœ‹ï¼šé€šè¿‡æºç è¯¦è§£ Servlet ï¼Œè¿™é‡Œæˆ‘å°±ä¸å†è§£é‡Šäº†ã€‚ è¿™é‡Œä¸»è¦è®² Spring ä¸­çš„ HttpServletBeanã€FrameworkServletã€DispatcherServlet è¿™ä¸‰ä¸ªç±»çš„åˆ›å»ºè¿‡ç¨‹ã€‚ é€šè¿‡ä¸Šé¢çš„å›¾ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸‰ä¸ªç±»ç›´æ¥å®ç°ä¸‰ä¸ªæ¥å£ï¼šEnvironmentCapableã€EnvironmentAwareã€ApplicationContextAwareã€‚ä¸‹é¢æˆ‘ä»¬ç›´æ¥çœ‹ä¸‹è¿™ä¸‰ä¸ªæ¥å£çš„å†…éƒ¨æ˜¯æ€æ ·å†™çš„ã€‚ EnvironmentCapable.java 12345public interface EnvironmentCapable &#123; //è¿”å›ç»„ä»¶çš„ç¯å¢ƒï¼Œå¯èƒ½è¿”å› null æˆ–è€…é»˜è®¤ç¯å¢ƒ @Nullable Environment getEnvironment();&#125; EnvironmentAware.java 1234public interface EnvironmentAware extends Aware &#123; //è®¾ç½®ç»„ä»¶çš„è¿è¡Œç¯å¢ƒ void setEnvironment(Environment environment);&#125; ApplicationContextAware.java 12345public interface ApplicationContextAware extends Aware &#123; //è®¾ç½®è¿è¡Œå¯¹è±¡çš„åº”ç”¨ä¸Šä¸‹æ–‡ //å½“ç±»å®ç°è¿™ä¸ªæ¥å£åï¼Œè¿™ä¸ªç±»å¯ä»¥è·å–ApplicationContextä¸­æ‰€æœ‰çš„beanï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªç±»å¯ä»¥ç›´æ¥è·å–Springé…ç½®æ–‡ä»¶ä¸­æ‰€æœ‰æœ‰å¼•ç”¨åˆ°çš„beanå¯¹è±¡ void setApplicationContext(ApplicationContext applicationContext) throws BeansException;&#125; æ€ä¹ˆä½¿ç”¨è¿™ä¸ªè¿™ä¸ªæ¥å£å‘¢ï¼Ÿ å‚è€ƒæ–‡ç« ï¼šorg.springframework.context.ApplicationContextAwareä½¿ç”¨ç†è§£ HttpServletBean è¿™é‡Œå°±ç›´æ¥çœ‹å…¶ä¸­æœ€é‡è¦çš„ init() æ–¹æ³•çš„ä»£ç äº†ï¼š 12345678910111213141516171819202122232425262728293031323334/** * å°†é…ç½®å‚æ•°æ˜ å°„åˆ°æ­¤servletçš„beanå±æ€§ï¼Œå¹¶è°ƒç”¨å­ç±»åˆå§‹åŒ–ã€‚ * å¦‚æœ bean é…ç½®ä¸åˆæ³•ï¼ˆæˆ–è€…éœ€è¦çš„å‚æ•°ä¸¢å¤±ï¼‰æˆ–è€…å­ç±»åˆå§‹åŒ–å‘ç”Ÿé”™è¯¯ï¼Œé‚£ä¹ˆå°±ä¼šæŠ›å‡º ServletException å¼‚å¸¸ */@Overridepublic final void init() throws ServletException &#123; //æ—¥å¿—ä»£ç åˆ é™¤äº† // ä»initå‚æ•°è®¾ç½®beanå±æ€§ã€‚ //è·å¾—web.xmlä¸­çš„contextConfigLocationé…ç½®å±æ€§ï¼Œå°±æ˜¯spring MVCçš„é…ç½®æ–‡ä»¶ PropertyValues pvs = new ServletConfigPropertyValues(getServletConfig(), this.requiredProperties); if (!pvs.isEmpty()) &#123; try &#123; BeanWrapper bw = PropertyAccessorFactory.forBeanPropertyAccess(this); //è·å–æœåŠ¡å™¨çš„å„ç§ä¿¡æ¯ ResourceLoader resourceLoader = new ServletContextResourceLoader(getServletContext()); bw.registerCustomEditor(Resource.class, new ResourceEditor(resourceLoader, getEnvironment())); //æ¨¡æ¿æ–¹æ³•ï¼Œå¯ä»¥åœ¨å­ç±»ä¸­è°ƒç”¨ï¼Œåšä¸€äº›åˆå§‹åŒ–å·¥ä½œï¼Œbwä»£è¡¨DispatcherServelt initBeanWrapper(bw); //å°†é…ç½®çš„åˆå§‹åŒ–å€¼è®¾ç½®åˆ°DispatcherServletä¸­ bw.setPropertyValues(pvs, true); &#125; catch (BeansException ex) &#123; //æ—¥å¿—ä»£ç  throw ex; &#125; &#125; // Let subclasses do whatever initialization they like. //æ¨¡æ¿æ–¹æ³•ï¼Œå­ç±»åˆå§‹åŒ–çš„å…¥å£æ–¹æ³• initServletBean(); //æ—¥å¿—ä»£ç åˆ é™¤äº†&#125; FrameworkServlet å…¶ä¸­é‡è¦æ–¹æ³•å¦‚ä¸‹ï¼šé‡Œé¢ä¹Ÿå°±ä¸¤å¥å…³é”®ä»£ç ï¼Œæ—¥å¿—ä»£ç æˆ‘ç›´æ¥åˆ æ‰äº† 12345678910111213141516171819202122protected final void initServletBean() throws ServletException &#123; //æ—¥å¿—ä»£ç åˆ é™¤äº† long startTime = System.currentTimeMillis(); //å°±æ˜¯ try è¯­å¥é‡Œé¢æœ‰ä¸¤å¥å…³é”®ä»£ç  try &#123; //åˆå§‹åŒ– webApplicationContext this.webApplicationContext = initWebApplicationContext(); //æ¨¡æ¿æ–¹æ³•ï¼Œ initFrameworkServlet(); &#125; catch (ServletException ex) &#123; this.logger.error(\"Context initialization failed\", ex); throw ex; &#125; catch (RuntimeException ex) &#123; this.logger.error(\"Context initialization failed\", ex); throw ex; &#125; //æ—¥å¿—ä»£ç åˆ é™¤äº† &#125; å†æ¥çœ‹çœ‹ä¸Šé¢ä»£ç ä¸­è°ƒç”¨çš„ initWebApplicationContext() æ–¹æ³• 1234567891011121314151617181920212223242526272829303132333435363738394041424344protected WebApplicationContext initWebApplicationContext() &#123; //è·å– rootContext WebApplicationContext rootContext = WebApplicationContextUtils.getWebApplicationContext(getServletContext()); WebApplicationContext wac = null; if (this.webApplicationContext != null) &#123; // ä¸Šä¸‹æ–‡å®ä¾‹åœ¨æ„é€ æ—¶æ³¨å…¥ - &gt;ä½¿ç”¨å®ƒ wac = this.webApplicationContext; if (wac instanceof ConfigurableWebApplicationContext) &#123; ConfigurableWebApplicationContext cwac = (ConfigurableWebApplicationContext) wac; if (!cwac.isActive()) &#123; // å¦‚æœä¸Šä¸‹æ–‡å°šæœªåˆ·æ–° -&gt; æä¾›è¯¸å¦‚è®¾ç½®çˆ¶ä¸Šä¸‹æ–‡ï¼Œè®¾ç½®åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡IDç­‰æœåŠ¡ if (cwac.getParent() == null) &#123; // ä¸Šä¸‹æ–‡å®ä¾‹è¢«æ³¨å…¥æ²¡æœ‰æ˜¾å¼çš„çˆ¶ç±» -&gt; å°†æ ¹åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ï¼ˆå¦‚æœæœ‰çš„è¯å¯èƒ½ä¸ºnullï¼‰è®¾ç½®ä¸ºçˆ¶çº§ cwac.setParent(rootContext); &#125; configureAndRefreshWebApplicationContext(cwac); &#125; &#125; &#125; if (wac == null) &#123; // å½“ WebApplicationContext å·²ç»å­˜åœ¨ ServletContext ä¸­æ—¶ï¼Œé€šè¿‡é…ç½®åœ¨ servlet ä¸­çš„ ContextAttribute å‚æ•°è·å– wac = findWebApplicationContext(); &#125; if (wac == null) &#123; // å¦‚æœ WebApplicationContext è¿˜æ²¡æœ‰åˆ›å»ºï¼Œåˆ™åˆ›å»ºä¸€ä¸ª wac = createWebApplicationContext(rootContext); &#125; if (!this.refreshEventReceived) &#123; // å½“ ContextRefreshedEvent äº‹ä»¶æ²¡æœ‰è§¦å‘æ—¶è°ƒç”¨æ­¤æ–¹æ³•ï¼Œæ¨¡æ¿æ–¹æ³•ï¼Œå¯ä»¥åœ¨å­ç±»é‡å†™ onRefresh(wac); &#125; if (this.publishContext) &#123; // å°† ApplicationContext ä¿å­˜åˆ° ServletContext ä¸­å» String attrName = getServletContextAttributeName(); getServletContext().setAttribute(attrName, wac); if (this.logger.isDebugEnabled()) &#123; this.logger.debug(\"Published WebApplicationContext of servlet '\" + getServletName() + \"' as ServletContext attribute with name [\" + attrName + \"]\"); &#125; &#125; return wac; &#125; initWebApplicationContext æ–¹æ³•åšäº†ä¸‰ä»¶äº‹ï¼š è·å– Spring çš„æ ¹å®¹å™¨ rootContext è®¾ç½® webApplicationContext å¹¶æ ¹æ®æƒ…å†µè°ƒç”¨ onRefresh æ–¹æ³• å°† webApplicationContext è®¾ç½®åˆ° ServletContext ä¸­ è¿™é‡Œåœ¨è®²è®²ä¸Šé¢ä»£ç ä¸­çš„ wac == null çš„å‡ ç§æƒ…å†µï¼š 1ï¼‰ã€å½“ WebApplicationContext å·²ç»å­˜åœ¨ ServletContext ä¸­æ—¶ï¼Œé€šè¿‡é…ç½®åœ¨ servlet ä¸­çš„ ContextAttribute å‚æ•°è·å–ï¼Œè°ƒç”¨çš„æ˜¯ findWebApplicationContext() æ–¹æ³• 123456789101112protected WebApplicationContext findWebApplicationContext() &#123; String attrName = getContextAttribute(); if (attrName == null) &#123; return null; &#125; WebApplicationContext wac = WebApplicationContextUtils.getWebApplicationContext(getServletContext(), attrName); if (wac == null) &#123; throw new IllegalStateException(\"No WebApplicationContext found: initializer not registered?\"); &#125; return wac; &#125; 2)ã€å¦‚æœ WebApplicationContext è¿˜æ²¡æœ‰åˆ›å»ºï¼Œè°ƒç”¨çš„æ˜¯ createWebApplicationContext æ–¹æ³• 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758protected WebApplicationContext createWebApplicationContext(@Nullable ApplicationContext parent) &#123; //è·å–åˆ›å»ºç±»å‹ Class&lt;?&gt; contextClass = getContextClass(); //åˆ é™¤äº†æ‰“å°æ—¥å¿—ä»£ç  //æ£€æŸ¥åˆ›å»ºç±»å‹ if (!ConfigurableWebApplicationContext.class.isAssignableFrom(contextClass)) &#123; throw new ApplicationContextException( \"Fatal initialization error in servlet with name '\" + getServletName() + \"': custom WebApplicationContext class [\" + contextClass.getName() + \"] is not of type ConfigurableWebApplicationContext\"); &#125; //å…·ä½“åˆ›å»º ConfigurableWebApplicationContext wac = (ConfigurableWebApplicationContext) BeanUtils.instantiateClass(contextClass); wac.setEnvironment(getEnvironment()); wac.setParent(parent); //å¹¶è®¾ç½®çš„ contextConfigLocation å‚æ•°ä¼ ç»™ wacï¼Œé»˜è®¤æ˜¯ WEB-INFO/[ServletName]-Servlet.xml wac.setConfigLocation(getContextConfigLocation()); //è°ƒç”¨çš„æ˜¯ä¸‹é¢çš„æ–¹æ³• configureAndRefreshWebApplicationContext(wac); return wac; &#125;protected void configureAndRefreshWebApplicationContext(ConfigurableWebApplicationContext wac) &#123; if (ObjectUtils.identityToString(wac).equals(wac.getId())) &#123; // The application context id is still set to its original default value // -&gt; assign a more useful id based on available information if (this.contextId != null) &#123; wac.setId(this.contextId); &#125; else &#123; // Generate default id... wac.setId(ConfigurableWebApplicationContext.APPLICATION_CONTEXT_ID_PREFIX + ObjectUtils.getDisplayString(getServletContext().getContextPath()) + '/' + getServletName()); &#125; &#125; wac.setServletContext(getServletContext()); wac.setServletConfig(getServletConfig()); wac.setNamespace(getNamespace()); wac.addApplicationListener(new SourceFilteringListener(wac, new ContextRefreshListener())); // The wac environment's #initPropertySources will be called in any case when the context // is refreshed; do it eagerly here to ensure servlet property sources are in place for // use in any post-processing or initialization that occurs below prior to #refresh ConfigurableEnvironment env = wac.getEnvironment(); if (env instanceof ConfigurableWebEnvironment) &#123; ((ConfigurableWebEnvironment) env).initPropertySources(getServletContext(), getServletConfig()); &#125; postProcessWebApplicationContext(wac); applyInitializers(wac); wac.refresh(); &#125; é‡Œé¢è¿˜æœ‰ doXXX() æ–¹æ³•ï¼Œå¤§å®¶æ„Ÿå…´è¶£çš„å¯ä»¥å»çœ‹çœ‹ã€‚ DispatcherServlet DispatcherServlet ç»§æ‰¿è‡ª FrameworkServletï¼ŒonRefresh æ–¹æ³•æ˜¯ DispatcherServlet çš„å…¥å£æ–¹æ³•ï¼Œåœ¨ initStrategies æ–¹æ³•ä¸­è°ƒç”¨äº† 9 ä¸ªåˆå§‹åŒ–çš„æ–¹æ³•ã€‚ è¿™é‡Œåˆ†æå…¶ä¸­ä¸€ä¸ªåˆå§‹åŒ–æ–¹æ³•ï¼šinitLocaleResolver() æ–¹æ³• 123456789101112private void initLocaleResolver(ApplicationContext context) &#123; try &#123; //åœ¨ context ä¸­è·å– this.localeResolver = context.getBean(LOCALE_RESOLVER_BEAN_NAME, LocaleResolver.class); //åˆ é™¤äº†æ‰“å°æ—¥å¿—çš„ä»£ç  &#125; catch (NoSuchBeanDefinitionException ex) &#123; //ä½¿ç”¨é»˜è®¤çš„ç­–ç•¥ this.localeResolver = getDefaultStrategy(context, LocaleResolver.class); //åˆ é™¤äº†æ‰“å°æ—¥å¿—çš„ä»£ç  &#125; &#125; æŸ¥çœ‹é»˜è®¤ç­–ç•¥ä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647protected &lt;T&gt; T getDefaultStrategy(ApplicationContext context, Class&lt;T&gt; strategyInterface) &#123; //è°ƒç”¨ getDefaultStrategies æ–¹æ³• List&lt;T&gt; strategies = getDefaultStrategies(context, strategyInterface); if (strategies.size() != 1) &#123; throw new BeanInitializationException( \"DispatcherServlet needs exactly 1 strategy for interface [\" + strategyInterface.getName() + \"]\"); &#125; return strategies.get(0); &#125; /** * Create a List of default strategy objects for the given strategy interface. * &lt;p&gt;The default implementation uses the \"DispatcherServlet.properties\" file (in the same * package as the DispatcherServlet class) to determine the class names. It instantiates * the strategy objects through the context's BeanFactory. */ @SuppressWarnings(\"unchecked\") protected &lt;T&gt; List&lt;T&gt; getDefaultStrategies(ApplicationContext context, Class&lt;T&gt; strategyInterface) &#123; String key = strategyInterface.getName(); //æ ¹æ®ç­–ç•¥æ¥å£çš„åå­—ä» defaultStrategies è·å–æ‰€éœ€ç­–ç•¥çš„ç±»å‹ String value = defaultStrategies.getProperty(key); if (value != null) &#123; //å¦‚æœæœ‰å¤šä¸ªé»˜è®¤å€¼çš„è¯ï¼Œå°±ä»¥é€—å·åˆ†éš”ä¸ºæ•°ç»„ String[] classNames = StringUtils.commaDelimitedListToStringArray(value); List&lt;T&gt; strategies = new ArrayList&lt;&gt;(classNames.length); //æŒ‰è·å–åˆ°çš„ç±»å‹åˆå§‹åŒ–ç­–ç•¥ for (String className : classNames) &#123; try &#123; Class&lt;?&gt; clazz = ClassUtils.forName(className, DispatcherServlet.class.getClassLoader()); Object strategy = createDefaultStrategy(context, clazz); strategies.add((T) strategy); &#125; catch (ClassNotFoundException ex) &#123; throw new BeanInitializationException( \"Could not find DispatcherServlet's default strategy class [\" + className + \"] for interface [\" + key + \"]\", ex); &#125; catch (LinkageError err) &#123; throw new BeanInitializationException( \"Error loading DispatcherServlet's default strategy class [\" + className + \"] for interface [\" + key + \"]: problem with class file or dependent class\", err); &#125; &#125; return strategies; &#125; else &#123; return new LinkedList&lt;&gt;(); &#125; &#125; å…¶ä»–å‡ ä¸ªæ–¹æ³•å¤§æ¦‚ä¹Ÿç±»ä¼¼ï¼Œæˆ‘å°±ä¸å†å†™äº†ã€‚ å°ç»“ä¸»è¦è®²äº† Spring MVC è‡ªèº«åˆ›å»ºè¿‡ç¨‹ï¼Œåˆ†æäº† Spring MVC ä¸­ Servlet çš„ä¸‰ä¸ªå±‚æ¬¡ï¼šHttpServletBeanã€FrameworkServlet å’Œ DispatcherServletã€‚HttpServletBean ç»§æ‰¿è‡ª Java çš„ HttpServletï¼Œå…¶ä½œç”¨æ˜¯å°†é…ç½®çš„å‚æ•°è®¾ç½®åˆ°ç›¸åº”çš„å±æ€§ä¸Šï¼›FrameworkServlet åˆå§‹åŒ–äº† WebApplicationContextï¼›DispatcherServlet åˆå§‹åŒ–äº†è‡ªèº«çš„ 9 ä¸ªç»„ä»¶ã€‚ Spring MVC ä¹‹ç”¨åˆ†æ Spring MVC æ˜¯æ€ä¹ˆå¤„ç†è¯·æ±‚çš„ã€‚é¦–å…ˆåˆ†æ HttpServletBeanã€FrameworkServlet å’Œ DispatcherServlet è¿™ä¸‰ä¸ª Servlet çš„å¤„ç†è¿‡ç¨‹ï¼Œæœ€ååˆ†æ doDispatcher çš„ç»“æ„ã€‚ HttpServletBean å‚ä¸äº†åˆ›å»ºå·¥ä½œï¼Œå¹¶æ²¡æœ‰æ¶‰åŠè¯·æ±‚çš„å¤„ç†ã€‚ FrameworkServlet åœ¨ç±»ä¸­çš„ service() ã€doGet()ã€doPost()ã€doPut()ã€doDelete()ã€doOptions()ã€doTrace() è¿™äº›æ–¹æ³•ä¸­å¯ä»¥çœ‹åˆ°éƒ½è°ƒç”¨äº†ä¸€ä¸ªå…±åŒçš„æ–¹æ³• processRequest() ï¼Œå®ƒæ˜¯ç±»åœ¨å¤„ç†è¯·æ±‚ä¸­æœ€æ ¸å¿ƒçš„æ–¹æ³•ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142protected final void processRequest(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123; long startTime = System.currentTimeMillis(); Throwable failureCause = null; //è·å– LocaleContextHolder ä¸­åŸæ¥ä¿å­˜çš„ LocaleContext LocaleContext previousLocaleContext = LocaleContextHolder.getLocaleContext(); //è·å–å½“å‰è¯·æ±‚çš„ LocaleContext LocaleContext localeContext = buildLocaleContext(request); //è·å– RequestContextHolder ä¸­åŸæ¥ä¿å­˜çš„ RequestAttributes RequestAttributes previousAttributes = RequestContextHolder.getRequestAttributes(); //è·å–å½“å‰è¯·æ±‚çš„ ServletRequestAttributes ServletRequestAttributes requestAttributes = buildRequestAttributes(request, response, previousAttributes); WebAsyncManager asyncManager = WebAsyncUtils.getAsyncManager(request); asyncManager.registerCallableInterceptor(FrameworkServlet.class.getName(), new RequestBindingInterceptor());//å°†å½“å‰è¯·æ±‚çš„ LocaleContext å’Œ ServletRequestAttributes è®¾ç½®åˆ° LocaleContextHolder å’Œ RequestContextHolder initContextHolders(request, localeContext, requestAttributes); try &#123; //å®é™…å¤„ç†è¯·æ±‚çš„å…¥å£ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•ï¼Œåœ¨ Dispatcher ç±»ä¸­æ‰æœ‰å…·ä½“å®ç° doService(request, response); &#125;catch (ServletException ex) &#123; failureCause = ex; throw ex; &#125;catch (IOException ex) &#123; failureCause = ex; throw ex; &#125;catch (Throwable ex) &#123; failureCause = ex; throw new NestedServletException(\"Request processing failed\", ex); &#125;finally &#123; //å°† previousLocaleContextï¼ŒpreviousAttributes æ¢å¤åˆ° LocaleContextHolder å’Œ RequestContextHolder ä¸­ resetContextHolders(request, previousLocaleContext, previousAttributes); if (requestAttributes != null) &#123; requestAttributes.requestCompleted(); &#125; //åˆ é™¤äº†æ—¥å¿—æ‰“å°ä»£ç  //å‘å¸ƒäº†ä¸€ä¸ª ServletRequestHandledEvent ç±»å‹çš„æ¶ˆæ¯ publishRequestHandledEvent(request, response, startTime, failureCause); &#125; &#125; DispatcherServlet ä¸Šä¸€ç« ä¸­å…¶å®è¿˜æ²¡æŠŠè¯¥ç±»è®²æ¸…æ¥šï¼Œåœ¨è¿™ä¸ªç±»ä¸­ï¼Œé‡Œé¢çš„æ™ºè¡Œå¤„ç†çš„å…¥å£æ–¹æ³•åº”è¯¥æ˜¯ doService æ–¹æ³•ï¼Œæ–¹æ³•é‡Œé¢è°ƒç”¨äº† doDispatch è¿›è¡Œå…·ä½“çš„å¤„ç†ï¼Œåœ¨è°ƒç”¨ doDispatch æ–¹æ³•ä¹‹å‰ doService åšäº†ä¸€äº›äº‹æƒ…ï¼šé¦–å…ˆåˆ¤æ–­æ˜¯ä¸æ˜¯ include è¯·æ±‚ï¼Œå¦‚æœæ˜¯åˆ™å¯¹ request çš„ Attribute åšä¸ªå¿«ç…§å¤‡ä»½ï¼Œç­‰ doDispatcher å¤„ç†å®Œä¹‹åï¼ˆå¦‚æœä¸æ˜¯å¼‚æ­¥è°ƒç”¨ä¸”æœªå®Œæˆï¼‰è¿›è¡Œè¿˜åŸ ï¼Œåœ¨åšå®Œå¿«ç…§ååˆå¯¹ request è®¾ç½®äº†ä¸€äº›å±æ€§ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839protected void doService(HttpServletRequest request, HttpServletResponse response) throws Exception &#123; // Keep a snapshot of the request attributes in case of an include, // to be able to restore the original attributes after the include. Map&lt;String, Object&gt; attributesSnapshot = null; if (WebUtils.isIncludeRequest(request)) &#123; attributesSnapshot = new HashMap&lt;&gt;(); Enumeration&lt;?&gt; attrNames = request.getAttributeNames(); while (attrNames.hasMoreElements()) &#123; String attrName = (String) attrNames.nextElement(); if (this.cleanupAfterInclude || attrName.startsWith(DEFAULT_STRATEGIES_PREFIX))&#123; attributesSnapshot.put(attrName, request.getAttribute(attrName)); &#125; &#125; &#125; // Make framework objects available to handlers and view objects. request.setAttribute(WEB_APPLICATION_CONTEXT_ATTRIBUTE, getWebApplicationContext()); request.setAttribute(LOCALE_RESOLVER_ATTRIBUTE, this.localeResolver); request.setAttribute(THEME_RESOLVER_ATTRIBUTE, this.themeResolver); request.setAttribute(THEME_SOURCE_ATTRIBUTE, getThemeSource()); FlashMap inputFlashMap = this.flashMapManager.retrieveAndUpdate(request, response); if (inputFlashMap != null) &#123; request.setAttribute(INPUT_FLASH_MAP_ATTRIBUTE, Collections.unmodifiableMap(inputFlashMap)); &#125; request.setAttribute(OUTPUT_FLASH_MAP_ATTRIBUTE, new FlashMap()); request.setAttribute(FLASH_MAP_MANAGER_ATTRIBUTE, this.flashMapManager); try &#123; //è°ƒç”¨ doDispatch æ–¹æ³• doDispatch(request, response); &#125;finally &#123; if (!WebAsyncUtils.getAsyncManager(request).isConcurrentHandlingStarted()) &#123; // Restore the original attribute snapshot, in case of an include. if (attributesSnapshot != null) &#123; restoreAttributesAfterInclude(request, attributesSnapshot); &#125; &#125; &#125; &#125; doDispatch() æ–¹æ³•ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879protected void doDispatch(HttpServletRequest request, HttpServletResponse response) throws Exception &#123; HttpServletRequest processedRequest = request; HandlerExecutionChain mappedHandler = null; boolean multipartRequestParsed = false; WebAsyncManager asyncManager = WebAsyncUtils.getAsyncManager(request); try &#123; ModelAndView mv = null; Exception dispatchException = null; try &#123; //æ£€æŸ¥æ˜¯ä¸æ˜¯ä¸Šä¼ è¯·æ±‚ processedRequest = checkMultipart(request); multipartRequestParsed = (processedRequest != request); // Determine handler for the current request. æ ¹æ® request æ‰¾åˆ° Handler mappedHandler = getHandler(processedRequest); if (mappedHandler == null || mappedHandler.getHandler() == null) &#123; noHandlerFound(processedRequest, response); return; &#125; // Determine handler adapter for the current request.æ ¹æ® Handler æ‰¾åˆ°å¯¹åº”çš„ HandlerAdapter HandlerAdapter ha = getHandlerAdapter(mappedHandler.getHandler()); // Process last-modified header, if supported by the handler. //å¤„ç† GET ã€ HEAD è¯·æ±‚çš„ LastModified String method = request.getMethod(); boolean isGet = \"GET\".equals(method); if (isGet || \"HEAD\".equals(method)) &#123; long lastModified = ha.getLastModified(request, mappedHandler.getHandler()); if (logger.isDebugEnabled()) &#123; logger.debug(\"Last-Modified value for [\" + getRequestUri(request) + \"] is: \" + lastModified); &#125; if (new ServletWebRequest(request, response).checkNotModified(lastModified) &amp;&amp; isGet) &#123; return; &#125; &#125; //æ‰§è¡Œç›¸åº”çš„ Interceptor çš„ preHandle if (!mappedHandler.applyPreHandle(processedRequest, response)) &#123; return; &#125; // Actually invoke the handler. HandlerAdapter ä½¿ç”¨ Handler å¤„ç†è¯·æ±‚ mv = ha.handle(processedRequest, response, mappedHandler.getHandler()); //å¦‚æœéœ€è¦å¼‚æ­¥å¤„ç†ï¼Œç›´æ¥è¿”å› if (asyncManager.isConcurrentHandlingStarted()) &#123; return; &#125; //å½“ view ä¸ºç©ºæ—¶ï¼Œæ ¹æ® request è®¾ç½®é»˜è®¤ view applyDefaultViewName(processedRequest, mv); //æ‰§è¡Œç›¸åº” Interceptor çš„ postHandler mappedHandler.applyPostHandle(processedRequest, response, mv); &#125;catch (Exception ex) &#123; dispatchException = ex; &#125;catch (Throwable err) &#123; // As of 4.3, we're processing Errors thrown from handler methods as well, // making them available for @ExceptionHandler methods and other scenarios. dispatchException = new NestedServletException(\"Handler dispatch failed\", err); &#125; //è°ƒç”¨ processDispatchResult æ–¹æ³•å¤„ç†ä¸Šé¢å¤„ç†ä¹‹åçš„ç»“æœï¼ˆåŒ…æ‹¬å¤„ç†å¼‚å¸¸ï¼Œæ¸²æŸ“é¡µé¢ï¼Œå‘å‡ºå®Œæˆé€šçŸ¥è§¦å‘ Interceptor çš„ afterCompletionï¼‰ processDispatchResult(processedRequest, response, mappedHandler, mv, dispatchException); &#125;catch (Exception ex) &#123; triggerAfterCompletion(processedRequest, response, mappedHandler, ex); &#125;catch (Throwable err) &#123; triggerAfterCompletion(processedRequest, response, mappedHandler, new NestedServletException(\"Handler processing failed\", err)); &#125;finally &#123; //åˆ¤æ–­æ˜¯å¦æ‰§è¡Œå¼‚æ­¥è¯·æ±‚ if (asyncManager.isConcurrentHandlingStarted()) &#123; // Instead of postHandle and afterCompletion if (mappedHandler != null) &#123; mappedHandler.applyAfterConcurrentHandlingStarted(processedRequest, response); &#125; &#125;else &#123; // Clean up any resources used by a multipart request. åˆ é™¤ä¸Šä¼ è¯·æ±‚çš„èµ„æº if (multipartRequestParsed) &#123; cleanupMultipart(processedRequest); &#125; &#125; &#125; &#125; Handlerï¼ŒHandlerMappingï¼ŒHandlerAdapter ä¸‰ä¸ªåŒºåˆ«ï¼š Handlerï¼šå¤„ç†å™¨ï¼Œå¯¹åº” MVC çš„ Cå±‚ï¼Œä¹Ÿå°±æ˜¯ Controller å±‚ï¼Œå…·ä½“è¡¨ç°å½¢å¼æœ‰å¾ˆå¤šç§ï¼Œå¯ä»¥æ˜¯ç±»ï¼Œæ–¹æ³•ï¼Œå®ƒçš„ç±»å‹æ˜¯ Objectï¼Œåªè¦å¯ä»¥å¤„ç†å®é™…è¯·æ±‚å°±å¯ä»¥æ˜¯ Handlerã€‚ HandlerMappingï¼šç”¨æ¥æŸ¥æ‰¾ Handler çš„ã€‚ HandlerAdapter ï¼šHandler é€‚é…å™¨ï¼Œ å¦å¤– View å’Œ ViewResolver çš„åŸç†ä¸ Handler å’Œ HandlerMapping çš„åŸç†ç±»ä¼¼ã€‚ å°ç»“æœ¬ç« åˆ†æäº† Spring MVC çš„è¯·æ±‚å¤„ç†çš„è¿‡ç¨‹ã€‚","tags":[{"name":"Spring MVC","slug":"Spring-MVC","permalink":"http://www.54tianzhisheng.cn/tags/Spring-MVC/"}]},{"title":"é€šè¿‡æºç è¯¦è§£ Servlet","date":"2017-07-08T16:00:00.000Z","path":"2017/07/09/servlet/","text":"Servlet ç»“æ„ 1ã€ServletServlet è¯¥æ¥å£å®šä¹‰äº†5ä¸ªæ–¹æ³•ã€‚ init()ï¼Œåˆå§‹åŒ– servlet å¯¹è±¡ï¼Œå®Œæˆä¸€äº›åˆå§‹åŒ–å·¥ä½œã€‚å®ƒæ˜¯ç”± servlet å®¹å™¨æ§åˆ¶çš„ï¼Œè¯¥æ–¹æ³•åªèƒ½è¢«è°ƒç”¨ä¸€æ¬¡ service()ï¼Œæ¥å—å®¢æˆ·ç«¯è¯·æ±‚å¯¹è±¡ï¼Œæ‰§è¡Œä¸šåŠ¡æ“ä½œï¼Œåˆ©ç”¨å“åº”å¯¹è±¡å“åº”å®¢æˆ·ç«¯è¯·æ±‚ã€‚ destroy()ï¼Œå½“å®¹å™¨ç›‘æµ‹åˆ°ä¸€ä¸ªservletä»æœåŠ¡ä¸­è¢«ç§»é™¤æ—¶ï¼Œå®¹å™¨è°ƒç”¨è¯¥æ–¹æ³•ï¼Œé‡Šæ”¾èµ„æºï¼Œè¯¥æ–¹æ³•åªèƒ½è¢«è°ƒç”¨ä¸€æ¬¡ã€‚ getServletConfig()ï¼ŒServletConfig æ˜¯å®¹å™¨å‘ servlet ä¼ é€’å‚æ•°çš„è½½ä½“ã€‚ getServletInfo()ï¼Œè·å– servlet ç›¸å…³ä¿¡æ¯ã€‚ Servlet çš„ç”Ÿå‘½å‘¨æœŸï¼š 1ï¼Œåˆå§‹åŒ–é˜¶æ®µ è°ƒç”¨ init() æ–¹æ³• 2ï¼Œå“åº”å®¢æˆ·è¯·æ±‚é˜¶æ®µ è°ƒç”¨ service() æ–¹æ³• 3ï¼Œç»ˆæ­¢é˜¶æ®µ è°ƒç”¨ destroy() æ–¹æ³• åœ¨ Servlet æ¥å£ä¸­çš„äº”ä¸ªæ–¹æ³•ä¸­æ¶‰åŠçš„æ¥å£æœ‰ä¸‰ä¸ªï¼šServletConfig ã€ ServletRequestã€ ServletResponse è¿™é‡Œå…ˆè®²è®² ServletRequest å’Œ ServletResponseã€‚ 1ï¼‰ServletRequest ç”± Servlet å®¹å™¨æ¥ç®¡ç†ï¼Œå½“å®¢æˆ·è¯·æ±‚åˆ°æ¥æ—¶ï¼Œå®¹å™¨åˆ›å»ºä¸€ä¸ª ServletRequest å¯¹è±¡ï¼Œå°è£…è¯·æ±‚æ•°æ®ï¼ŒåŒæ—¶åˆ›å»ºä¸€ä¸ª ServletResponse å¯¹è±¡ï¼Œå°è£…å“åº”æ•°æ®ã€‚è¿™ä¸¤ä¸ªå¯¹è±¡å°†è¢«å®¹å™¨ä½œä¸º serviceï¼ˆï¼‰æ–¹æ³•çš„å‚æ•°ä¼ é€’ç»™ Servletï¼ŒSerlvet åˆ©ç”¨ ServletRequest å¯¹è±¡è·å–å®¢æˆ·ç«¯å‘æ¥çš„è¯·æ±‚æ•°æ®ï¼Œåˆ©ç”¨ ServletResponse å¯¹è±¡å‘é€å“åº”æ•°æ®ã€‚ ä¸‹é¢æ˜¯ ServletRequest ä¸­æ‰€æœ‰çš„æ–¹æ³•ï¼Œæ ¹æ®æ–¹æ³•åå¤§æ¦‚å°±å¯ä»¥çŒœåˆ°è¿™äº›æ–¹æ³•åˆ°åº•æ˜¯å¹²å•¥ç”¨çš„ã€‚ 2ï¼‰ServletResponse å‘é€å“åº”æ•°æ® 2ã€ServletConfigServletConfig æ˜¯å®¹å™¨å‘ servlet ä¼ é€’å‚æ•°çš„è½½ä½“ã€‚ ServletConfigçš„4ä¸ªå¸¸ç”¨æ–¹æ³•ï¼š 1ï¼‰public String getInitParameterï¼ˆString nameï¼‰ï¼šè¿”å›æŒ‡å®šåç§°çš„åˆå§‹åŒ–å‚æ•°å€¼ï¼› 2ï¼‰public Enumeration getInitParameterNamesï¼ˆï¼‰ï¼šè¿”å›ä¸€ä¸ªåŒ…å«æ‰€æœ‰åˆå§‹åŒ–å‚æ•°åçš„ Enumeration å¯¹è±¡ï¼› 3ï¼‰public String getServletName()ï¼šè¿”å›åœ¨ DD æ–‡ä»¶ä¸­&lt;servlet-name&gt;å…ƒç´ æŒ‡å®šçš„ Servlet åç§°ï¼› 4ï¼‰public ServletContext getServletContextï¼ˆï¼‰ï¼šè¿”å›è¯¥ Servlet æ‰€åœ¨çš„ä¸Šä¸‹æ–‡å¯¹è±¡ï¼› è¿™é‡Œè¯¦ç»†è®²ä¸‹ ServletContext ï¼š Servlet ä¸Šä¸‹æ–‡å¯¹è±¡ï¼ˆServletContextï¼‰ï¼šæ¯ä¸ªWebåº”ç”¨ç¨‹åºåœ¨è¢«å¯åŠ¨æ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªå”¯ä¸€çš„ä¸Šä¸‹æ–‡å¯¹è±¡ï¼ŒServlet å¯é€šè¿‡å…¶è·å¾— Web åº”ç”¨ç¨‹åºçš„åˆå§‹åŒ–å‚æ•°æˆ– Servlet å®¹å™¨çš„ç‰ˆæœ¬ç­‰ä¿¡æ¯ï¼Œä¹Ÿå¯è¢« Servlet ç”¨æ¥ä¸å…¶ä»– Servlet å…±äº«æ•°æ®ã€‚ 1ã€è·å¾— ServletContext åº”ç”¨ï¼š ï¼ˆ1ï¼‰ã€ç›´æ¥è°ƒç”¨ getServletContextï¼ˆï¼‰æ–¹æ³• ServletContext context = getServletContextï¼ˆï¼‰; ï¼ˆ2ï¼‰ã€ä½¿ç”¨ ServletConfig åº”ç”¨ï¼Œå†è°ƒç”¨å®ƒçš„ getServletContextï¼ˆï¼‰æ–¹æ³• ServletContext context = getServletConfig.getServletContext(); 2ã€è·å¾—åº”ç”¨ç¨‹åºçš„åˆå§‹åŒ–å‚æ•°ï¼š ï¼ˆ1ï¼‰ã€public String getInitParameterï¼ˆString nameï¼‰ï¼šè¿”å›æŒ‡å®šå‚æ•°åçš„å­—ç¬¦ä¸²å‚æ•°å€¼ï¼Œæ²¡æœ‰åˆ™è¿”å› nullï¼› ï¼ˆ2ï¼‰ã€public Enumeration getInitParameterNames()ï¼šè¿”å›ä¸€ä¸ªåŒ…å«å¤šæœ‰åˆå§‹åŒ–å‚æ•°åçš„ Enumeration å¯¹è±¡ï¼› 3ã€é€šè¿‡ ServletContext å¯¹è±¡è·å¾—èµ„æº ï¼ˆ1ï¼‰ã€public URl getResourceï¼ˆString pathï¼‰:è¿”å›ç”±ç»™å®šè·¯å¾„çš„èµ„æºçš„ URL å¯¹è±¡ï¼Œä»¥ â€œ/â€ å¼€å¤´ï¼Œä¸ºç›¸å¯¹è·¯å¾„ï¼Œç›¸å¯¹äºWeb åº”ç”¨ç¨‹åºçš„æ–‡æ¡£æ ¹ç›®å½•ï¼› ï¼ˆ2ï¼‰ã€public InputStream getResourceAsStreamï¼ˆString pathï¼‰ï¼šä»èµ„æºä¸Šè·å¾—ä¸€ä¸ª InputStream å¯¹è±¡ï¼Œç­‰ä»·äºgetResourceï¼ˆpathï¼‰.oprenStream(); ï¼ˆ3ï¼‰ã€public String getRealPath(String path)ï¼šè¿”å›ç»™å®šçš„è™šæ‹Ÿè·¯å¾„çš„çœŸå®è·¯å¾„ï¼› 4ã€ç™»é™†æ—¥å¿—ï¼šä½¿ç”¨ logï¼ˆï¼‰æ–¹æ³•å¯ä»¥å°†æŒ‡å®šçš„æ¶ˆæ¯å†™åˆ°æœåŠ¡å™¨çš„æ—¥å¿—æ–‡ä»¶ä¸­ ï¼ˆ1ï¼‰ã€public void logï¼ˆString msgï¼‰ï¼šå‚æ•° msg ä¸ºå†™å…¥æ—¥å¿—æ–‡ä»¶æ¶ˆæ¯ ï¼ˆ2ï¼‰ã€public void logï¼ˆString msgï¼ŒThrowable throwableï¼‰ï¼šå°† msg æŒ‡å®šçš„æ¶ˆæ¯å’Œå¼‚å¸¸çš„æ ˆè·Ÿè¸ªä¿¡æ¯å†™å…¥æ—¥å¿—æ–‡ä»¶ 5ã€ä½¿ç”¨ RequestDispatcher å®ç°è¯·æ±‚è½¬å‘ ï¼ˆ1ï¼‰ã€RequestDispatcher getRequestDiapatcher(String path)ï¼šå¿…é¡»ä»¥ â€œ/â€œ å¼€å¤´ç›¸å¯¹äºåº”ç”¨ç¨‹åºæ ¹ç›®å½•ï¼Œè€ŒServletRequest å¯ä»¥ä¼ é€’ä¸€ä¸ªç›¸å¯¹è·¯å¾„ ï¼ˆ2ï¼‰ã€RequestDipatcher getNamedDiapatcherï¼ˆString nameï¼‰ï¼šå‚æ•° name ä¸ºä¸€ä¸ªå‘½åçš„ Servlet å¯¹è±¡ 6ã€ä½¿ç”¨ ServletContext å¯¹è±¡å­˜å‚¨æ•°æ® ï¼ˆ1ï¼‰ã€public void serAttributeï¼ˆString nameï¼ŒObject objectï¼‰ï¼šå°†ç»™å®šåç§°çš„å±æ€§å€¼å¯¹è±¡ç»‘å®šåˆ°ä¸Šä¸‹æ–‡å¯¹è±¡ä¸Šï¼› ï¼ˆ2ï¼‰ã€public Object getAttributeï¼ˆString nameï¼‰ï¼šè¿”å›ç»‘å®šåˆ°ä¸Šä¸‹æ–‡å¯¹è±¡çš„ç»™å®šåç§°çš„å±æ€§å€¼ï¼› ï¼ˆ3ï¼‰ã€public Enumeration getAttributeNames()ï¼šè¿”å›ç»‘å®šåˆ°ä¸Šä¸‹æ–‡å¯¹è±¡ä¸Šçš„æ‰€æœ‰å±æ€§åçš„ Enumeration å¯¹è±¡ï¼› ï¼ˆ4ï¼‰ã€public void removeAttributeï¼ˆString nameï¼‰ï¼šåˆ é™¤ç»‘å®šåˆ°ä¸Šä¸‹æ–‡å¯¹è±¡æŒ‡å®šåç§°çš„å±æ€§ï¼› ServletRequest å…±äº«çš„å¯¹è±¡ä»…åœ¨è¯·æ±‚çš„ç”Ÿå­˜å‘¨æœŸä¸­å¯ä»¥è¢«è®¿é—®ï¼› HttpSession å…±äº«çš„å¯¹è±¡ä»…åœ¨ä¼šè¯çš„ç”Ÿå­˜å‘¨æœŸä¸­å¯ä»¥è¢«è®¿é—®ï¼› ServletContext å…±äº«çš„å¯¹è±¡åœ¨æ•´ä¸ª Web åº”ç”¨ç¨‹åºå¯åŠ¨çš„ç”Ÿå­˜å‘¨æœŸä¸­å¯ä»¥è¢«è®¿é—®ï¼› 7ã€æ£€ç´¢ Servlet å®¹å™¨çš„ä¿¡æ¯ ï¼ˆ1ï¼‰ã€public String getServletInfo()ï¼šè¿”å› Servlet æ‰€è¿è¡Œå®¹å™¨çš„åç§°å’Œç‰ˆæœ¬ï¼› ï¼ˆ2ï¼‰ã€public int getMajorVersionï¼ˆï¼‰ï¼šè¿”å›å®¹å™¨æ‰€æ”¯æŒçš„ Servlet API çš„ä¸»ç‰ˆæœ¬å·ï¼› ï¼ˆ3ï¼‰ã€public int getMinorVersionï¼ˆï¼‰ï¼šè¿”å›å®¹å™¨æ‰€æ”¯æŒçš„ Servlet API çš„æ¬¡ç‰ˆæœ¬å·ï¼› ï¼ˆ4ï¼‰ã€public String getServletContextï¼ˆï¼‰ï¼šè¿”å› ServletContext å¯¹åº”çš„ web åº”ç”¨ç¨‹åºåç§° &lt;display-name&gt;å…ƒç´ å®šä¹‰çš„åç§°ï¼› 3ã€GenericServlet æŠ½è±¡ç±»GenericServlet å®šä¹‰äº†ä¸€ä¸ªé€šç”¨çš„ï¼Œä¸ä¾èµ–å…·ä½“åè®®çš„ Servletï¼Œå®ƒå®ç°äº† Servlet æ¥å£å’Œ ServletConfig æ¥å£ï¼Œå®ƒçš„æ–¹æ³•åœ¨æ–‡ç« çš„ç¬¬ä¸€å¼ å›¾å°±ç»™å‡ºäº†ã€‚ 4ã€HttpServlet æŠ½è±¡ç±»4.1ã€HTTP è¯·æ±‚æ–¹å¼ GET : è·å–ç”±è¯·æ±‚ URL æ ‡è¯†çš„èµ„æº POST : å‘ Web æœåŠ¡å™¨å‘é€æ— é™åˆ¶é•¿åº¦çš„æ•°æ® PUT : å­˜å‚¨ä¸€ä¸ªèµ„æºåˆ°è¯·æ±‚çš„ URL DELETE : åˆ é™¤ç”± URL æ ‡è¯†çš„èµ„æº HEAD : è¿”å› URL æ ‡è¯†çš„å¤´ä¿¡æ¯ OPTIONS : è¿”å›æœåŠ¡å™¨æ”¯æŒçš„ HTTP æ–¹æ³• TRACE : è¿”å› TRACE è¯·æ±‚é™„å¸¦çš„å¤´å­—æ®µ 4.2ã€å¯¹åº”çš„æœåŠ¡æ–¹æ³•ï¼š doGet() : è°ƒç”¨æœåŠ¡å™¨çš„èµ„æº, å¹¶å°†å…¶ä½œä¸ºå“åº”è¿”å›ç»™å®¢æˆ·ç«¯. doGet() è°ƒç”¨åœ¨ URL é‡Œæ˜¾ç¤ºæ­£åœ¨ä¼ é€ç»™ Servlet çš„æ•°æ®,è¿™åœ¨ç³»ç»Ÿçš„å®‰å…¨æ–¹é¢å¯èƒ½å¸¦æ¥ä¸€äº›é—®é¢˜, æ¯”å¦‚è¯´, ç”¨æˆ·ç™»å½•æ—¶, è¡¨å•é‡Œçš„ç”¨æˆ·åå’Œå¯†ç éœ€è¦å‘é€åˆ°æœåŠ¡å™¨ç«¯, doGet() è°ƒç”¨ä¼šåœ¨æµè§ˆå™¨çš„ URL é‡Œæ˜¾ç¤ºç”¨æˆ·åå’Œå¯†ç . doPost() : å®ƒç”¨äºæŠŠå®¢æˆ·ç«¯çš„æ•°æ®ä¼ ç»™æœåŠ¡ç«¯, ä½¿ç”¨å®ƒå¯ä»¥ä»¥éšè—æ–¹å¼ç»™æœåŠ¡å™¨ç«¯å‘é€æ•°æ®. Post é€‚åˆå‘é€å¤§é‡æ•°æ®. doPut() : è°ƒç”¨å’Œ doPost() ç›¸ä¼¼, å¹¶ä¸”å®ƒå…è®¸å®¢æˆ·ç«¯æŠŠçœŸæ­£çš„æ–‡ä»¶å­˜æ”¾åœ¨æœåŠ¡å™¨ä¸Š, è€Œä¸ä»…ä»…æ˜¯ä¼ é€æ•°æ®. doDelete() : å®ƒå…è®¸å®¢æˆ·ç«¯åˆ é™¤æœåŠ¡å™¨ç«¯çš„æ–‡ä»¶æˆ–è€… Web é¡µé¢ï¼å®ƒçš„ä½¿ç”¨éå¸¸å°‘ï¼ doHead() : å®ƒç”¨äºå¤„ç†å®¢æˆ·ç«¯çš„ Head è°ƒç”¨,å¹¶ä¸”è¿”å›ä¸€ä¸ª response. å½“å®¢æˆ·ç«¯åªéœ€è¦å“åº”çš„ Header æ—¶,å®ƒå°±å‘å‡ºä¸€ä¸ªHeader è¯·æ±‚.è¿™ç§æƒ…å†µä¸‹å®¢æˆ·ç«¯å¾€å¾€å…³å¿ƒå“åº”çš„é•¿åº¦å’Œå“åº”çš„ MIME ç±»å‹. doOptions(): å®ƒç”¨äºå¤„ç†å®¢æˆ·ç«¯çš„ Options è°ƒç”¨,é€šè¿‡è¿™ä¸ªè°ƒç”¨, å®¢æˆ·ç«¯å¯ä»¥è·å¾—æ­¤ Servlet æ”¯æŒçš„æ–¹æ³•.å¦‚æœ Servlet è¦†ç›–äº† doPost() æ–¹æ³•, é‚£ä¹ˆå°†è¿”å›: Allow: POST, TRACE, OPTIONS, HEAD doTraceï¼šå¤„ç† TRACE è¯·æ±‚ 4.3ã€Servlet Service æ–¹æ³•è¯¦è§£12345678910111213141516public void service(ServletRequest req, ServletResponse res) throws ServletException, IOException &#123; HttpServletRequest request; HttpServletResponse response; // å¦‚æœä¼ å…¥çš„ HTTP è¯·æ±‚å’Œ HTTP å“åº”ä¸æ˜¯ HTTP çš„é¢†åŸŸæ¨¡å‹ï¼Œåˆ™æŠ›å‡º Servlet å¼‚å¸¸ï¼Œè¿™ä¸ªå¼‚å¸¸ä¼šè¢« Servlet å®¹å™¨æ‰€å¤„ç† if (!(req instanceof HttpServletRequest &amp;&amp; res instanceof HttpServletResponse)) &#123; throw new ServletException(\"non-HTTP request or response\"); &#125; // æ—¢ç„¶æ˜¯ HTTP åè®®ç»‘å®šçš„ Serlvet, å¼ºåˆ¶è½¬æ¢åˆ° HTTP çš„é¢†åŸŸæ¨¡å‹ request = (HttpServletRequest) req; response = (HttpServletResponse) res; // å¦‚æœä¼ å…¥çš„è¯·æ±‚å’Œå“åº”æ˜¯é¢„æœŸçš„ HTTP è¯·æ±‚å’Œ HTTP å“åº”ï¼Œåˆ™è°ƒç”¨ HttpServlet çš„ service() æ–¹æ³•ã€‚ service(request, response); &#125; 4.4ã€HttpServlet service æ–¹æ³•è¯¦è§£1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123; // ä» HTTP è¯·æ±‚ä¸­å–å¾—è¿™æ¬¡è¯·æ±‚æ‰€ä½¿ç”¨çš„ HTTT æ–¹æ³• String method = req.getMethod(); // å¦‚æœè¿™æ¬¡è¯·æ±‚ä½¿ç”¨ GET æ–¹æ³• if (method.equals(METHOD_GET)) &#123; // å–å¾—è¿™ä¸ª Servlet çš„æœ€åä¿®æ”¹çš„æ—¶é—´ long lastModified = getLastModified(req); if (lastModified == -1) &#123; // servlet doesn't support if-modified-since, no reason // to go through further expensive logic //-1 ä»£è¡¨è¿™ä¸ª Servlet ä¸æ”¯æŒæœ€åä¿®æ”¹æ“ä½œï¼Œç›´æ¥è°ƒç”¨ doGet() è¿›è¡Œå¤„ç† HTTP GET è¯·æ±‚ doGet(req, resp); &#125; else &#123; // å¦‚æœè¿™ä¸ª Servlet æ”¯æŒæœ€åä¿®æ”¹æ“ä½œï¼Œå–å¾—è¯·æ±‚å¤´ä¸­åŒ…å«çš„è¯·æ±‚çš„æœ€åä¿®æ”¹æ—¶é—´ long ifModifiedSince = req.getDateHeader(HEADER_IFMODSINCE); if (ifModifiedSince &lt; lastModified) &#123; // If the servlet mod time is later, call doGet() // Round down to the nearest second for a proper compare // A ifModifiedSince of -1 will always be less // å¦‚æœè¯·æ±‚å¤´ä¸­åŒ…å«çš„ä¿®æ”¹æ—¶é—´æ—©äºè¿™ä¸ª Servlet çš„æœ€åä¿®æ”¹æ—¶é—´ï¼Œè¯´æ˜è¿™ä¸ª Servlet è‡ªä»å®¢æˆ·ä¸Šä¸€æ¬¡ HTTP è¯·æ±‚å·²ç»è¢«ä¿®æ”¹äº† , è®¾ç½®æœ€æ–°ä¿®æ”¹æ—¶é—´åˆ°å“åº”å¤´ä¸­ maybeSetLastModified(resp, lastModified); // è°ƒç”¨ doGet è¿›è¡Œè¿›è¡Œå¤„ç† HTTP GET è¯·æ±‚ doGet(req, resp); &#125; else &#123; // å¦‚æœè¯·æ±‚å¤´ä¸­åŒ…å«ä¿®æ”¹æ—¶é—´æ™šäºè¿™ä¸ª Servlet çš„æœ€åä¿®æ”¹æ—¶é—´ï¼Œè¯´æ˜è¿™ä¸ª Servlet è‡ªä»è¯·æ±‚çš„æœ€åä¿®æ”¹æ—¶é—´åæ²¡æœ‰æ›´æ”¹è¿‡ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œä»…ä»…è¿”å›ä¸€ä¸ª HTTP å“åº”çŠ¶æ€ SC_NOT_MODIFIED resp.setStatus(HttpServletResponse.SC_NOT_MODIFIED); &#125; &#125; &#125; else if (method.equals(METHOD_HEAD)) &#123; // å¦‚æœè¿™æ¬¡è¯·æ±‚ä½¿ç”¨ HEAD æ–¹æ³• // å¦‚æœè¿™ä¸ª Servlet æ”¯æŒæœ€åä¿®æ”¹æ“ä½œï¼Œåˆ™è®¾ç½®è¿™ä¸ª Servlet çš„æœ€åä¿®æ”¹æ—¶é—´åˆ°å“åº”å¤´ä¸­ long lastModified = getLastModified(req); maybeSetLastModified(resp, lastModified); // å’Œå¯¹ HTTP GET æ–¹æ³•å¤„ç†ä¸åŒçš„æ˜¯ï¼Œæ— è®ºè¯·æ±‚å¤´ä¸­çš„ä¿®æ”¹æ—¶é—´æ˜¯ä¸æ˜¯æ—©äºè¿™ä¸ª Sevlet çš„æœ€åä¿®æ”¹æ—¶é—´ï¼Œéƒ½ä¼šå‘ HEAD å“åº”ç»™å®¢æˆ·ï¼Œå› ä¸º HTTP HEAD å“åº”æ˜¯ç”¨æ¥æŸ¥è¯¢ Servlet å¤´ä¿¡æ¯çš„æ“ä½œ doHead(req, resp); &#125; else if (method.equals(METHOD_POST)) &#123; // å¦‚æœè¿™æ¬¡è¯·æ±‚ä½¿ç”¨ POST æ–¹æ³• doPost(req, resp); &#125; else if (method.equals(METHOD_PUT)) &#123; // å¦‚æœè¿™æ¬¡è¯·æ±‚ä½¿ç”¨ PUT æ–¹æ³• doPut(req, resp); &#125; else if (method.equals(METHOD_DELETE)) &#123; // å¦‚æœè¿™æ¬¡è¯·æ±‚ä½¿ç”¨ DELETE æ–¹æ³• doDelete(req, resp); &#125; else if (method.equals(METHOD_OPTIONS)) &#123; // å¦‚æœè¿™æ¬¡è¯·æ±‚ä½¿ç”¨ OPTIONS æ–¹æ³• doOptions(req,resp); &#125; else if (method.equals(METHOD_TRACE)) &#123; // å¦‚æœè¿™æ¬¡è¯·æ±‚ä½¿ç”¨ TRACE æ–¹æ³• doTrace(req,resp); &#125; else &#123; // Note that this means NO servlet supports whatever // method was requested, anywhere on this server. // å¦‚æœè¿™æ¬¡è¯·æ±‚æ˜¯å…¶ä»–æœªçŸ¥æ–¹æ³•ï¼Œè¿”å›é”™è¯¯ä»£ç  SC_NOT_IMPLEMENTED ç»™ HTTP å“åº”ï¼Œå¹¶ä¸”æ˜¾ç¤ºä¸€ä¸ªé”™è¯¯æ¶ˆæ¯ï¼Œè¯´æ˜è¿™ä¸ªæ“ä½œæ˜¯æ²¡æœ‰å®ç°çš„ String errMsg = lStrings.getString(\"http.method_not_implemented\"); Object[] errArgs = new Object[1]; errArgs[0] = method; errMsg = MessageFormat.format(errMsg, errArgs); resp.sendError(HttpServletResponse.SC_NOT_IMPLEMENTED, errMsg); &#125; &#125; 5ã€Servlet çš„å¤šçº¿ç¨‹é—®é¢˜1ã€å½“æ¶‰åŠåˆ° Servlet éœ€è¦å…±äº«èµ„æºæ˜¯ï¼Œéœ€ä¿è¯ Servlet æ˜¯çº¿ç¨‹å®‰å…¨çš„ 2ã€æ³¨æ„äº‹é¡¹ï¼š ï¼ˆ1ï¼‰ã€ç”¨æ–¹æ³•çš„å±€éƒ¨å˜é‡ä¿æŒè¯·æ±‚ä¸­çš„ä¸“æœ‰æ•°æ®ï¼› ï¼ˆ2ï¼‰ã€åªç”¨ Servlet çš„æˆå‘˜å˜é‡æ¥å­˜æ”¾é‚£äº›ä¸ä¼šæ”¹å˜çš„æ•°æ®ï¼› ï¼ˆ3ï¼‰ã€å¯¹å¯èƒ½è¢«è¯·æ±‚ä¿®æ”¹çš„æˆå‘˜å˜é‡åŒæ­¥ï¼ˆç”¨ Synchronized å…³é”®å­—ä¿®é¥°ï¼‰ï¼› ï¼ˆ4ï¼‰ã€å¦‚æœ Servlet è®¿é—®å¤–éƒ¨èµ„æºï¼Œé‚£ä¹ˆéœ€è¦åŒæ­¥è®¿é—®è¿™äº›èµ„æºï¼› 3ã€å®ç° SingleThreadModel æ¥å£çš„ Servlet åœ¨è¢«å¤šä¸ªå®¢æˆ·è¯·æ±‚æ—¶ä¸€ä¸ªæ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è¿è¡Œï¼Œä¸æ¨èä½¿ç”¨ã€‚ 4ã€å¦‚æœå¿…é¡»åœ¨ servlet ä½¿ç”¨åŒæ­¥ä»£ç ï¼Œåº”å°½é‡åœ¨æœ€å°çš„èŒƒå›´ä¸Šï¼ˆä»£ç å—ï¼‰è¿›è¡ŒåŒæ­¥ï¼ŒåŒæ­¥ä»£ç è¶Šå°‘ï¼ŒServlet æ‰§è¡Œæ‰èƒ½è¶Šå¥½ï¼Œé¿å…å¯¹ doGet() æˆ– doPost() æ–¹æ³•åŒæ­¥ã€‚ æ€»ç»“å…¨æ–‡é¦–å…ˆé€šè¿‡ä¸€å¼  Servlet ä¸­çš„æ ¸å¿ƒ Servlet ç±»å›¾å…³ç³»ï¼Œäº†è§£äº†å‡ ç§ Servlet ä¹‹é—´çš„å…³ç³»åŠå…¶å†…éƒ¨æ–¹æ³•ã€‚ç„¶ååœ¨åˆ†åˆ«ä»‹ç»è¿™å‡ ç§ Servletï¼Œé€šè¿‡åˆ†æéƒ¨åˆ†é‡è¦æ–¹æ³•çš„æºç æ¥äº†è§£ï¼Œè¿˜ä»‹ç»äº† Servlet ä¸­å¤šçº¿ç¨‹çš„é—®é¢˜çš„è§£å†³æ–¹æ³•ã€‚ æ³¨ï¼šæ–‡ç« åŸåˆ›ï¼Œé¦–å‘äºï¼šzhisheng çš„åšå®¢ï¼Œæ–‡ç« å¯è½¬è½½ä½†è¯·æ³¨æ˜åœ°å€ä¸ºï¼šhttp://www.54tianzhisheng.cn/2017/07/09/servlet/","tags":[{"name":"Java","slug":"Java","permalink":"http://www.54tianzhisheng.cn/tags/Java/"},{"name":"Servlet","slug":"Servlet","permalink":"http://www.54tianzhisheng.cn/tags/Servlet/"}]},{"title":"Velocity å¾ªç¯æŒ‡ä»¤ä¸€ç§å¥½çš„è§£å†³æ–¹æ³•","date":"2017-06-27T16:00:00.000Z","path":"2017/06/28/Velocity-foreach/","text":"å‰æå‰å°çš„æ•°æ®ç»å¸¸æ˜¯ç”±éœ€è¦é€šè¿‡ foreach å¾ªç¯è·å–ã€‚ å¥½çš„è§£å†³æ–¹æ¡ˆï¼šï¼ˆæ‹¿æˆ‘æœ€è¿‘åšçš„ä¸€ä¸ªé¡¹ç›®åšä¾‹å­ï¼‰è´­ç‰©å•†åŸå·¦è¾¹çš„å¯¼èˆªæ ï¼Œå•†å“å¤§åˆ†ç±»å’Œå°åˆ†ç±»ï¼ˆCategoryï¼‰ 1ã€åœ¨ model åŒ…ä¸‹åˆ›å»ºä¸€ä¸ª ViewObject ç±» 1234567891011public class ViewObject&#123; private Map&lt;String, Object&gt; objs = new HashMap&lt;&gt;(); public void set(String key, Object value) &#123; objs.put(key, value); &#125; public Object get(String key) &#123; return objs.get(key); &#125;&#125; 2ã€åœ¨ controller åŒ…ä¸‹åˆ›å»ºä¸ª BaseController ç±» 12345678910111213141516171819202122232425262728293031323334/** * åœ¨æ¯ä¸ªé¡µé¢æ˜¾ç¤ºå›¾ä¹¦å¤§åˆ†ç±»ï¼ŒæŠ½ç¦»å‡ºæ¥ * @return */ public List&lt;ViewObject&gt; selectAllCategory() &#123; List&lt;Category&gt; categories = categoryService.selectAllCategory(); List&lt;ViewObject&gt; vos = new ArrayList&lt;&gt;(); for (Category category : categories) &#123; ViewObject vo = new ViewObject(); vo.set(\"category\", category); vo.set(\"id\", category.getId()); //System.out.println(\"category ä¸­çš„ id æ˜¯ \"+category.getId()); vos.add(vo); &#125; return vos; &#125; /** * è·å–å›¾ä¹¦çš„å°åˆ†ç±»ï¼Œåœ¨è¿™é‡Œå°†å°åˆ†ç±»ä¸­çš„å¤§åˆ†ç±»idæŸ¥æ‰¾å‡ºæ¥ï¼Œä¿å­˜åœ¨ cds.id ä¸­ï¼Œ * ç„¶ååœ¨æ¨¡æ¿å¼•æ“ä¸­é€šè¿‡å°† vos.id å’Œ cds.id ç›¸æ¯”è¾ƒã€‚ç„¶åå¦‚æœç›¸åŒçš„è¯ï¼Œå°±å–å‡ºæ¥æ”¾åœ¨å¯¹åº”çš„å¤§åˆ†ç±»ä¸‹ * @return */ public List&lt;ViewObject&gt; selectAllCategoryDetail() &#123; List&lt;CategoryDetail&gt; categoryDetails = categoryDetailService.selectAllCategoryDetail(); List&lt;ViewObject&gt; cds = new ArrayList&lt;&gt;(); for (CategoryDetail categoryDetail : categoryDetails) &#123; ViewObject vo = new ViewObject(); vo.set(\"categoryDetail\", categoryDetail); //System.out.println(\"categoryDetail ä¸­çš„ categoryDetail id =\" + categoryDetail.getId() + \"category id = \" + categoryDetail.getCategory_id() + \" name = \" + categoryDetail.getName()); vo.set(\"id\", categoryDetail.getCategory_id()); cds.add(vo); &#125; return cds; &#125; 3ã€åœ¨ IndexController ç±»ä¸‹ï¼Œéœ€è¦ç»§æ‰¿ BaseController.java ç±» 12345678910111213/** * è¿”å›é¦–é¡µ * @param model * @return */ @RequestMapping(path = &#123;\"/\", \"/index\"&#125;) public String index(Model model) &#123; //æ¨¡æ¿å¼•æ“è®¾ç½®å›¾ä¹¦åˆ†ç±»å·¦è¾¹å¯¼èˆªæ  model.addAttribute(\"vos\", selectAllCategory()); model.addAttribute(\"cds\", selectAllCategoryDetail()); //è¿”å›ä¸»é¡µ return \"index\"; &#125; 4ã€æŠ½ç¦»å¯¼èˆªéƒ¨åˆ†çš„ä»£ç  left.html 1234567891011121314151617&lt;!--å·¦è¾¹å›¾ä¹¦åˆ†ç±»å¯¼èˆªæ --&gt;&lt;div class=\"c3_b1_left\"&gt; &lt;dl&gt; #foreach($vo in $vos) &lt;dd&gt; &lt;h1&gt;$!&#123;vo.category.name&#125;&lt;/h1&gt; &lt;p&gt; #foreach($cd in $cds) #if($vo.id == $cd.id) &lt;a href=\"/list\"&gt;$!&#123;cd.categoryDetail.name&#125;&lt;/a&gt; #end #end &lt;/p&gt; &lt;/dd&gt; #end &lt;/dl&gt;&lt;/div&gt; 5ã€é¦–é¡µä¸­ç›¸åº”çš„ä½ç½®å¼•å…¥ left.html 1#parse(\"left.html\") è¿™æ ·å°±å¯ä»¥è§£å†³é—®é¢˜äº†ï¼Œå¯æ˜¯æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦æ§åˆ¶å¾ªç¯çš„ä¸ªæ•°ï¼Œå› ä¸ºæˆ‘ä»¬ç½‘é¡µç«¯å¯èƒ½åªéœ€è¦ç‰¹å®šçš„æ•°æ®é‡ é‚£ä¹ˆå°±éœ€è¦ä¸­æ–­ foreachï¼Œå¯ä»¥ä½¿ç”¨ #break æŒ‡ä»¤ç»ˆæ­¢å¾ªç¯ 123456#foreach( $vo in $vos ) #if( $foreach.count &gt; 5 ) #break #end $!&#123;vo.customer.Name&#125;#end å‚è€ƒVelocityå…¥é—¨æŒ‡å—â€”â€”ç¬¬ä¸ƒç«  å¾ªç¯æŒ‡ä»¤","tags":[{"name":"Velocity","slug":"Velocity","permalink":"http://www.54tianzhisheng.cn/tags/Velocity/"}]},{"title":"AJAX å­¦ä¹ ","date":"2017-06-22T16:00:00.000Z","path":"2017/06/23/AJAX/","text":"èƒŒæ™¯æœ€è¿‘çš„é¡¹ç›®ä¸­å¤§é‡åœ°æ–¹éœ€è¦ä½¿ç”¨ AJAXï¼Œæ— å¥ˆï¼Œè°å«æˆ‘æ—¢è¦å†™å‰å°åˆè¦å†™åå°å‘¢ï¼Œåªå¥½å­¦ä¹ ä¸‹è¿™ä¸ªæŠ€æœ¯ç‚¹ï¼Œä¸»è¦å‚è€ƒ W3school æ–‡æ¡£ï¼Œä¸‹é¢è®°å½•ä¸‹è¿™äº›çŸ¥è¯†ç‚¹ï¼Œä¾¿äºæ—¥åè‡ªå·±æŸ¥é˜…ï¼Œä¸‹é¢çš„ä¸€äº›æµ‹è¯•ä»£ç å»ºè®®åœ¨ W3school ä¸­æµ‹è¯•ã€‚ AJAX åŸºç¡€ï¼š AJAX = Asynchronous JavaScript and XMLï¼ˆå¼‚æ­¥çš„ JavaScript å’Œ XMLï¼‰ã€‚ AJAX æ˜¯ä¸€ç§åœ¨æ— éœ€é‡æ–°åŠ è½½æ•´ä¸ªç½‘é¡µçš„æƒ…å†µä¸‹ï¼Œèƒ½å¤Ÿæ›´æ–°éƒ¨åˆ†ç½‘é¡µçš„æŠ€æœ¯ã€‚ åœ¨å¾ˆå¤šç½‘ç«™å¯ä»¥è§åˆ°ä½¿ç”¨è¿™ç§æŠ€æœ¯ã€‚ AJAX - XMLHttpRequest åˆ›å»º XMLHttpRequest å¯¹è±¡ XMLHttpRequest æ˜¯ AJAX çš„åŸºç¡€ã€‚XMLHttpRequest ç”¨äºåœ¨åå°ä¸æœåŠ¡å™¨äº¤æ¢æ•°æ®ã€‚è¿™æ„å‘³ç€å¯ä»¥åœ¨ä¸é‡æ–°åŠ è½½æ•´ä¸ªç½‘é¡µçš„æƒ…å†µä¸‹ï¼Œå¯¹ç½‘é¡µçš„æŸéƒ¨åˆ†è¿›è¡Œæ›´æ–°ã€‚ åˆ›å»º XMLHttpRequest å¯¹è±¡çš„è¯­æ³•ï¼š 1variable = new XMLHttpRequest(); ä½†æ˜¯å¯¹äºè€ç‰ˆæœ¬çš„ Internet Explorer ï¼ˆIE5 å’Œ IE6ï¼‰å´æ˜¯ä½¿ç”¨ ActiveX å¯¹è±¡ï¼Œæ‰€ä»¥åœ¨å¼€å‘ä¸­ä¸ºäº†é€‚åº”å¤§å¤šæ•°çš„æµè§ˆå™¨ï¼Œå¸¸ä½¿ç”¨å¦‚ä¸‹ï¼š 123456789var xmlhttp;if (window.XMLHttpRequest) &#123;// code for IE7+, Firefox, Chrome, Opera, Safari xmlhttp = new XMLHttpRequest(); &#125;else &#123;// code for IE6, IE5 xmlhttp = new ActiveXObject(\"Microsoft.XMLHTTP\"); &#125; å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ ä½¿ç”¨ XMLHttpRequest å¯¹è±¡çš„ open() å’Œ send() æ–¹æ³•ï¼š 12xmlhttp.open(\"GET\",\"test1.txt\",true);xmlhttp.send(); method description open(method, url, async) è§„å®šè¯·æ±‚çš„ç±»å‹ã€URL ä»¥åŠæ˜¯å¦å¼‚æ­¥å¤„ç†è¯·æ±‚ã€‚methodï¼šè¯·æ±‚çš„ç±»å‹ï¼›GET æˆ– POST urlï¼šæ–‡ä»¶åœ¨æœåŠ¡å™¨ä¸Šçš„ä½ç½® asyncï¼štrueï¼ˆå¼‚æ­¥ï¼‰æˆ– falseï¼ˆåŒæ­¥ï¼‰ send(string) å°†è¯·æ±‚å‘é€åˆ°æœåŠ¡å™¨ã€‚stringï¼šä»…ç”¨äº POST è¯·æ±‚ GET è¿˜æ˜¯ POSTï¼Ÿ ä¸ POST ç›¸æ¯”ï¼ŒGET æ›´ç®€å•ä¹Ÿæ›´å¿«ï¼Œå¹¶ä¸”åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹éƒ½èƒ½ç”¨ã€‚ ç„¶è€Œï¼Œåœ¨ä»¥ä¸‹æƒ…å†µä¸­ï¼Œè¯·ä½¿ç”¨ POST è¯·æ±‚ï¼š æ— æ³•ä½¿ç”¨ç¼“å­˜æ–‡ä»¶ï¼ˆæ›´æ–°æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶æˆ–æ•°æ®åº“ï¼‰ å‘æœåŠ¡å™¨å‘é€å¤§é‡æ•°æ®ï¼ˆPOST æ²¡æœ‰æ•°æ®é‡é™åˆ¶ï¼‰ å‘é€åŒ…å«æœªçŸ¥å­—ç¬¦çš„ç”¨æˆ·è¾“å…¥æ—¶ï¼ŒPOST æ¯” GET æ›´ç¨³å®šä¹Ÿæ›´å¯é  ç¤ºä¾‹ï¼šGET è¯·æ±‚ 1ã€ç®€å•çš„ GET è¯·æ±‚ 12345678910111213141516171819202122232425262728293031323334&lt;html&gt;&lt;head&gt;&lt;script type=\"text/javascript\"&gt;function loadXMLDoc()&#123;var xmlhttp;if (window.XMLHttpRequest) &#123;// code for IE7+, Firefox, Chrome, Opera, Safari xmlhttp=new XMLHttpRequest(); &#125;else &#123;// code for IE6, IE5 xmlhttp=new ActiveXObject(\"Microsoft.XMLHTTP\"); &#125;xmlhttp.onreadystatechange=function() &#123; if (xmlhttp.readyState==4 &amp;&amp; xmlhttp.status==200) &#123; document.getElementById(\"myDiv\").innerHTML=xmlhttp.responseText; &#125; &#125;xmlhttp.open(\"GET\",\"/ajax/demo_get.asp?t=\" + Math.random(),true);xmlhttp.send();&#125;&lt;/script&gt;&lt;/head&gt;&lt;body&gt;&lt;h2&gt;AJAX&lt;/h2&gt;&lt;button type=\"button\" onclick=\"loadXMLDoc()\"&gt;è¯·æ±‚æ•°æ®&lt;/button&gt;&lt;div id=\"myDiv\"&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt; 2ã€é€šè¿‡ GET æ–¹æ³•å‘é€ä¿¡æ¯ 12345678910111213141516171819202122232425262728293031323334&lt;html&gt;&lt;head&gt;&lt;script type=\"text/javascript\"&gt;function loadXMLDoc()&#123;var xmlhttp;if (window.XMLHttpRequest) &#123;// code for IE7+, Firefox, Chrome, Opera, Safari xmlhttp=new XMLHttpRequest(); &#125;else &#123;// code for IE6, IE5 xmlhttp=new ActiveXObject(\"Microsoft.XMLHTTP\"); &#125;xmlhttp.onreadystatechange=function() &#123; if (xmlhttp.readyState==4 &amp;&amp; xmlhttp.status==200) &#123; document.getElementById(\"myDiv\").innerHTML=xmlhttp.responseText; &#125; &#125;xmlhttp.open(\"GET\",\"/ajax/demo_get2.asp?fname=Bill&amp;lname=Gates\",true);xmlhttp.send();&#125;&lt;/script&gt;&lt;/head&gt;&lt;body&gt;&lt;h2&gt;AJAX&lt;/h2&gt;&lt;button type=\"button\" onclick=\"loadXMLDoc()\"&gt;è¯·æ±‚æ•°æ®&lt;/button&gt;&lt;div id=\"myDiv\"&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt; ç¤ºä¾‹ï¼šPOST è¯·æ±‚ 1ã€ç®€å• POST è¯·æ±‚ 12345678910111213141516171819202122232425262728293031323334&lt;html&gt;&lt;head&gt;&lt;script type=\"text/javascript\"&gt;function loadXMLDoc()&#123;var xmlhttp;if (window.XMLHttpRequest) &#123;// code for IE7+, Firefox, Chrome, Opera, Safari xmlhttp=new XMLHttpRequest(); &#125;else &#123;// code for IE6, IE5 xmlhttp=new ActiveXObject(\"Microsoft.XMLHTTP\"); &#125;xmlhttp.onreadystatechange=function() &#123; if (xmlhttp.readyState==4 &amp;&amp; xmlhttp.status==200) &#123; document.getElementById(\"myDiv\").innerHTML=xmlhttp.responseText; &#125; &#125;xmlhttp.open(\"POST\",\"/ajax/demo_post.asp\",true);xmlhttp.send();&#125;&lt;/script&gt;&lt;/head&gt;&lt;body&gt;&lt;h2&gt;AJAX&lt;/h2&gt;&lt;button type=\"button\" onclick=\"loadXMLDoc()\"&gt;è¯·æ±‚æ•°æ®&lt;/button&gt;&lt;div id=\"myDiv\"&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt; 2ã€åƒ HTML è¡¨å•é‚£æ · POST æ•°æ®ï¼Œè¯·ä½¿ç”¨ setRequestHeader() æ¥æ·»åŠ  HTTP å¤´ã€‚ç„¶ååœ¨ send() æ–¹æ³•ä¸­è§„å®šæ‚¨å¸Œæœ›å‘é€çš„æ•°æ® 123456789101112131415161718192021222324252627282930313233343536&lt;html&gt;&lt;head&gt;&lt;script type=\"text/javascript\"&gt;function loadXMLDoc()&#123;var xmlhttp;if (window.XMLHttpRequest) &#123;// code for IE7+, Firefox, Chrome, Opera, Safari xmlhttp=new XMLHttpRequest(); &#125;else &#123;// code for IE6, IE5 xmlhttp=new ActiveXObject(\"Microsoft.XMLHTTP\"); &#125;xmlhttp.onreadystatechange=function() &#123; if (xmlhttp.readyState==4 &amp;&amp; xmlhttp.status==200) &#123; document.getElementById(\"myDiv\").innerHTML=xmlhttp.responseText; &#125; &#125;xmlhttp.open(\"POST\",\"/ajax/demo_post2.asp\",true);xmlhttp.setRequestHeader(\"Content-type\",\"application/x-www-form-urlencoded\");xmlhttp.send(\"fname=Bill&amp;lname=Gates\");&#125;&lt;/script&gt;&lt;/head&gt;&lt;body&gt;&lt;h2&gt;AJAX&lt;/h2&gt;&lt;button type=\"button\" onclick=\"loadXMLDoc()\"&gt;è¯·æ±‚æ•°æ®&lt;/button&gt;&lt;div id=\"myDiv\"&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt; æ³¨æ„ï¼šsetRequestHeader(header, value) å‘è¯·æ±‚æ·»åŠ  HTTP å¤´ï¼Œheader: è§„å®šå¤´çš„åç§°, value: è§„å®šå¤´çš„å€¼ã€‚ url - æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ open() æ–¹æ³•çš„ url å‚æ•°æ˜¯æœåŠ¡å™¨ä¸Šæ–‡ä»¶çš„åœ°å€ï¼š 1xmlhttp.open(\"GET\",\"ajax_test.asp\",true); è¯¥æ–‡ä»¶å¯ä»¥æ˜¯ä»»ä½•ç±»å‹çš„æ–‡ä»¶ï¼Œæ¯”å¦‚ .txt å’Œ .xmlï¼Œæˆ–è€…æœåŠ¡å™¨è„šæœ¬æ–‡ä»¶ï¼Œæ¯”å¦‚ .asp å’Œ .php ï¼ˆåœ¨ä¼ å›å“åº”ä¹‹å‰ï¼Œèƒ½å¤Ÿåœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»åŠ¡ï¼‰ã€‚ å¼‚æ­¥ - True or False ï¼Ÿ XMLHttpRequest å¯¹è±¡å¦‚æœè¦ç”¨äº AJAX çš„è¯ï¼Œå…¶ open() æ–¹æ³•çš„ async å‚æ•°å¿…é¡»è®¾ç½®ä¸º trueï¼Œå¯¹äº web å¼€å‘äººå‘˜æ¥è¯´ï¼Œå‘é€å¼‚æ­¥è¯·æ±‚æ˜¯ä¸€ä¸ªå·¨å¤§çš„è¿›æ­¥ã€‚å¾ˆå¤šåœ¨æœåŠ¡å™¨æ‰§è¡Œçš„ä»»åŠ¡éƒ½ç›¸å½“è´¹æ—¶ã€‚AJAX å‡ºç°ä¹‹å‰ï¼Œè¿™å¯èƒ½ä¼šå¼•èµ·åº”ç”¨ç¨‹åºæŒ‚èµ·æˆ–åœæ­¢ã€‚ é€šè¿‡ AJAXï¼ŒJavaScript æ— éœ€ç­‰å¾…æœåŠ¡å™¨çš„å“åº”ï¼Œè€Œæ˜¯ï¼š åœ¨ç­‰å¾…æœåŠ¡å™¨å“åº”æ—¶æ‰§è¡Œå…¶ä»–è„šæœ¬ å½“å“åº”å°±ç»ªåå¯¹å“åº”è¿›è¡Œå¤„ç† Async = true å½“ä½¿ç”¨ async = true æ—¶ï¼Œè¯·è§„å®šåœ¨å“åº”å¤„äº onreadystatechange äº‹ä»¶ä¸­çš„å°±ç»ªçŠ¶æ€æ—¶æ‰§è¡Œçš„å‡½æ•° 123456789101112131415161718192021222324252627282930313233&lt;html&gt;&lt;head&gt;&lt;script type=\"text/javascript\"&gt;function loadXMLDoc()&#123;var xmlhttp;if (window.XMLHttpRequest) &#123;// code for IE7+, Firefox, Chrome, Opera, Safari xmlhttp=new XMLHttpRequest(); &#125;else &#123;// code for IE6, IE5 xmlhttp=new ActiveXObject(\"Microsoft.XMLHTTP\"); &#125;xmlhttp.onreadystatechange=function() &#123; if (xmlhttp.readyState==4 &amp;&amp; xmlhttp.status==200) &#123; document.getElementById(\"myDiv\").innerHTML=xmlhttp.responseText; &#125; &#125;xmlhttp.open(\"GET\",\"/ajax/test1.txt\",true);xmlhttp.send();&#125;&lt;/script&gt;&lt;/head&gt;&lt;body&gt;&lt;div id=\"myDiv\"&gt;&lt;h2&gt;Let AJAX change this text&lt;/h2&gt;&lt;/div&gt;&lt;button type=\"button\" onclick=\"loadXMLDoc()\"&gt;é€šè¿‡ AJAX æ”¹å˜å†…å®¹&lt;/button&gt;&lt;/body&gt;&lt;/html&gt; Async = false å¦‚éœ€ä½¿ç”¨ async = falseï¼Œè¯·å°† open() æ–¹æ³•ä¸­çš„ç¬¬ä¸‰ä¸ªå‚æ•°æ”¹ä¸º false ä¸æ¨èä½¿ç”¨ async = falseï¼Œä½†æ˜¯å¯¹äºä¸€äº›å°å‹çš„è¯·æ±‚ï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ è¯·è®°ä½ï¼ŒJavaScript ä¼šç­‰åˆ°æœåŠ¡å™¨å“åº”å°±ç»ªæ‰ç»§ç»­æ‰§è¡Œã€‚å¦‚æœæœåŠ¡å™¨ç¹å¿™æˆ–ç¼“æ…¢ï¼Œåº”ç”¨ç¨‹åºä¼šæŒ‚èµ·æˆ–åœæ­¢ã€‚ æ³¨é‡Šï¼šå½“æ‚¨ä½¿ç”¨ async=false æ—¶ï¼Œè¯·ä¸è¦ç¼–å†™ onreadystatechange å‡½æ•° - æŠŠä»£ç æ”¾åˆ° send() è¯­å¥åé¢å³å¯ï¼š 123456789101112131415161718192021222324252627&lt;html&gt;&lt;head&gt;&lt;script type=\"text/javascript\"&gt;function loadXMLDoc()&#123;var xmlhttp;if (window.XMLHttpRequest) &#123;// code for IE7+, Firefox, Chrome, Opera, Safari xmlhttp=new XMLHttpRequest(); &#125;else &#123;// code for IE6, IE5 xmlhttp=new ActiveXObject(\"Microsoft.XMLHTTP\"); &#125;xmlhttp.open(\"GET\",\"/ajax/test1.txt\",false);xmlhttp.send();document.getElementById(\"myDiv\").innerHTML=xmlhttp.responseText;&#125;&lt;/script&gt;&lt;/head&gt;&lt;body&gt;&lt;div id=\"myDiv\"&gt;&lt;h2&gt;Let AJAX change this text&lt;/h2&gt;&lt;/div&gt;&lt;button type=\"button\" onclick=\"loadXMLDoc()\"&gt;é€šè¿‡ AJAX æ”¹å˜å†…å®¹&lt;/button&gt;&lt;/body&gt;&lt;/html&gt; æœåŠ¡å™¨å“åº” ä½¿ç”¨ XMLHttpRequest å¯¹è±¡çš„ responseText æˆ– responseXML å±æ€§ã€‚ responseText è·å¾—å­—ç¬¦ä¸²å½¢å¼çš„å“åº”æ•°æ®ã€‚ responseXML è·å¾— XML å½¢å¼çš„å“åº”æ•°æ®ã€‚ 1ã€responseText å±æ€§ å¦‚æœæ¥è‡ªæœåŠ¡å™¨çš„å“åº”å¹¶é XMLï¼Œè¯·ä½¿ç”¨ responseText å±æ€§ã€‚ responseText å±æ€§è¿”å›å­—ç¬¦ä¸²å½¢å¼çš„å“åº”ï¼Œå› æ­¤æ‚¨å¯ä»¥è¿™æ ·ä½¿ç”¨ï¼š 1document.getElementById(\"myDiv\").innerHTML=xmlhttp.responseText; 2ã€responseXML å±æ€§ å¦‚æœæ¥è‡ªæœåŠ¡å™¨çš„å“åº”æ˜¯ XMLï¼Œè€Œä¸”éœ€è¦ä½œä¸º XML å¯¹è±¡è¿›è¡Œè§£æï¼Œè¯·ä½¿ç”¨ responseXML å±æ€§ï¼š è¯·æ±‚ books.xml æ–‡ä»¶ï¼Œå¹¶è§£æå“åº”ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243&lt;html&gt;&lt;head&gt;&lt;script type=\"text/javascript\"&gt;function loadXMLDoc()&#123;var xmlhttp;var txt,x,i;if (window.XMLHttpRequest) &#123;// code for IE7+, Firefox, Chrome, Opera, Safari xmlhttp=new XMLHttpRequest(); &#125;else &#123;// code for IE6, IE5 xmlhttp=new ActiveXObject(\"Microsoft.XMLHTTP\"); &#125;xmlhttp.onreadystatechange=function() &#123; if (xmlhttp.readyState==4 &amp;&amp; xmlhttp.status==200) &#123; xmlDoc=xmlhttp.responseXML; txt=\"\"; x=xmlDoc.getElementsByTagName(\"title\"); for (i=0;i&lt;x.length;i++) &#123; txt=txt + x[i].childNodes[0].nodeValue + \"&lt;br /&gt;\"; &#125; document.getElementById(\"myDiv\").innerHTML=txt; &#125; &#125;xmlhttp.open(\"GET\",\"/example/xmle/books.xml\",true);xmlhttp.send();&#125;&lt;/script&gt;&lt;/head&gt;&lt;body&gt;&lt;h2&gt;My Book Collection:&lt;/h2&gt;&lt;div id=\"myDiv\"&gt;&lt;/div&gt;&lt;button type=\"button\" onclick=\"loadXMLDoc()\"&gt;è·å¾—æˆ‘çš„å›¾ä¹¦æ”¶è—åˆ—è¡¨&lt;/button&gt;&lt;/body&gt;&lt;/html&gt; onreadystatechange äº‹ä»¶ å½“è¯·æ±‚è¢«å‘é€åˆ°æœåŠ¡å™¨æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ‰§è¡Œä¸€äº›åŸºäºå“åº”çš„ä»»åŠ¡ã€‚æ¯å½“ readyState æ”¹å˜æ—¶ï¼Œå°±ä¼šè§¦å‘ onreadystatechange äº‹ä»¶ã€‚readyState å±æ€§å­˜æœ‰ XMLHttpRequest çš„çŠ¶æ€ä¿¡æ¯ã€‚ ä¸‹é¢æ˜¯ XMLHttpRequest å¯¹è±¡çš„ä¸‰ä¸ªé‡è¦çš„å±æ€§ï¼š onreadystatechange å­˜å‚¨å‡½æ•°ï¼ˆæˆ–å‡½æ•°åï¼‰ï¼Œæ¯å½“ readyState å±æ€§æ”¹å˜æ—¶ï¼Œå°±ä¼šè°ƒç”¨è¯¥å‡½æ•° readyState å­˜æœ‰ XMLHttpRequest çš„çŠ¶æ€ã€‚ä» 0 åˆ° 4 å‘ç”Ÿå˜åŒ–ã€‚ 0: è¯·æ±‚æœªåˆå§‹åŒ– 1: æœåŠ¡å™¨è¿æ¥å·²å»ºç«‹ 2: è¯·æ±‚å·²æ¥æ”¶ 3: è¯·æ±‚å¤„ç†ä¸­ 4: è¯·æ±‚å·²å®Œæˆï¼Œä¸”å“åº”å·²å°±ç»ª status 200: â€œOKâ€ 404: æœªæ‰¾åˆ°é¡µé¢ åœ¨ onreadystatechange äº‹ä»¶ä¸­ï¼Œæˆ‘ä»¬è§„å®šå½“æœåŠ¡å™¨å“åº”å·²åšå¥½è¢«å¤„ç†çš„å‡†å¤‡æ—¶æ‰€æ‰§è¡Œçš„ä»»åŠ¡ã€‚ å½“ readyState ç­‰äº 4 ä¸”çŠ¶æ€ä¸º 200 æ—¶ï¼Œè¡¨ç¤ºå“åº”å·²å°±ç»ªï¼š 1234567xmlhttp.onreadystatechange=function() &#123; if (xmlhttp.readyState==4 &amp;&amp; xmlhttp.status==200) &#123; document.getElementById(\"myDiv\").innerHTML=xmlhttp.responseText; &#125; &#125; ä½¿ç”¨ Callback å‡½æ•° callback å‡½æ•°æ˜¯ä¸€ç§ä»¥å‚æ•°å½¢å¼ä¼ é€’ç»™å¦ä¸€ä¸ªå‡½æ•°çš„å‡½æ•°ã€‚ å¦‚æœæ‚¨çš„ç½‘ç«™ä¸Šå­˜åœ¨å¤šä¸ª AJAX ä»»åŠ¡ï¼Œé‚£ä¹ˆæ‚¨åº”è¯¥ä¸ºåˆ›å»º XMLHttpRequest å¯¹è±¡ç¼–å†™ä¸€ä¸ªæ ‡å‡† çš„å‡½æ•°ï¼Œå¹¶ä¸ºæ¯ä¸ª AJAX ä»»åŠ¡è°ƒç”¨è¯¥å‡½æ•°ã€‚ è¯¥å‡½æ•°è°ƒç”¨åº”è¯¥åŒ…å« URL ä»¥åŠå‘ç”Ÿ onreadystatechange äº‹ä»¶æ—¶æ‰§è¡Œçš„ä»»åŠ¡ï¼ˆæ¯æ¬¡è°ƒç”¨å¯èƒ½ä¸å°½ç›¸åŒï¼‰ï¼š 12345678910function myFunction()&#123;loadXMLDoc(\"ajax_info.txt\",function() &#123; if (xmlhttp.readyState==4 &amp;&amp; xmlhttp.status==200) &#123; document.getElementById(\"myDiv\").innerHTML=xmlhttp.responseText; &#125; &#125;);&#125; AJAX - é«˜çº§ASP/PHP è¯·æ±‚å®ä¾‹ - AJAX ç”¨äºåˆ›é€ åŠ¨æ€æ€§æ›´å¼ºçš„åº”ç”¨ç¨‹åºã€‚ AJAX å¯ç”¨æ¥ä¸æ•°æ®åº“è¿›è¡ŒåŠ¨æ€é€šä¿¡ã€‚ AJAX å¯ç”¨æ¥ä¸ XML æ–‡ä»¶è¿›è¡Œäº¤äº’å¼é€šä¿¡ã€‚ AJAX å®ä¾‹ä½¿ç”¨ XMLHttpRequest å¯¹è±¡çš„å®ä¾‹","tags":[{"name":"AJAX","slug":"AJAX","permalink":"http://www.54tianzhisheng.cn/tags/AJAX/"}]},{"title":"Java IOæµå­¦ä¹ è¶…è¯¦ç»†æ€»ç»“ï¼ˆå›¾æ–‡å¹¶èŒ‚ï¼‰","date":"2017-06-22T16:00:00.000Z","path":"2017/06/23/java-io/","text":"Javaæµæ“ä½œæœ‰å…³çš„ç±»æˆ–æ¥å£ï¼šJavaæµç±»å›¾ç»“æ„ï¼š æµçš„æ¦‚å¿µå’Œä½œç”¨æµæ˜¯ä¸€ç»„æœ‰é¡ºåºçš„ï¼Œæœ‰èµ·ç‚¹å’Œç»ˆç‚¹çš„å­—èŠ‚é›†åˆï¼Œæ˜¯å¯¹æ•°æ®ä¼ è¾“çš„æ€»ç§°æˆ–æŠ½è±¡ã€‚å³æ•°æ®åœ¨ä¸¤è®¾å¤‡é—´çš„ä¼ è¾“ç§°ä¸ºæµï¼Œæµçš„æœ¬è´¨æ˜¯æ•°æ®ä¼ è¾“ï¼Œæ ¹æ®æ•°æ®ä¼ è¾“ç‰¹æ€§å°†æµæŠ½è±¡ä¸ºå„ç§ç±»ï¼Œæ–¹ä¾¿æ›´ç›´è§‚çš„è¿›è¡Œæ•°æ®æ“ä½œã€‚ IOæµçš„åˆ†ç±» æ ¹æ®å¤„ç†æ•°æ®ç±»å‹çš„ä¸åŒåˆ†ä¸ºï¼šå­—ç¬¦æµå’Œå­—èŠ‚æµ æ ¹æ®æ•°æ®æµå‘ä¸åŒåˆ†ä¸ºï¼šè¾“å…¥æµå’Œè¾“å‡ºæµ å­—ç¬¦æµå’Œå­—èŠ‚æµå­—ç¬¦æµçš„ç”±æ¥ï¼š å› ä¸ºæ•°æ®ç¼–ç çš„ä¸åŒï¼Œè€Œæœ‰äº†å¯¹å­—ç¬¦è¿›è¡Œé«˜æ•ˆæ“ä½œçš„æµå¯¹è±¡ã€‚æœ¬è´¨å…¶å®å°±æ˜¯åŸºäºå­—èŠ‚æµè¯»å–æ—¶ï¼Œå»æŸ¥äº†æŒ‡å®šçš„ç è¡¨ã€‚ å­—èŠ‚æµå’Œå­—ç¬¦æµçš„åŒºåˆ«ï¼š è¯»å†™å•ä½ä¸åŒï¼šå­—èŠ‚æµä»¥å­—èŠ‚ï¼ˆ8bitï¼‰ä¸ºå•ä½ï¼Œå­—ç¬¦æµä»¥å­—ç¬¦ä¸ºå•ä½ï¼Œæ ¹æ®ç è¡¨æ˜ å°„å­—ç¬¦ï¼Œä¸€æ¬¡å¯èƒ½è¯»å¤šä¸ªå­—èŠ‚ã€‚ å¤„ç†å¯¹è±¡ä¸åŒï¼šå­—èŠ‚æµèƒ½å¤„ç†æ‰€æœ‰ç±»å‹çš„æ•°æ®ï¼ˆå¦‚å›¾ç‰‡ã€aviç­‰ï¼‰ï¼Œè€Œå­—ç¬¦æµåªèƒ½å¤„ç†å­—ç¬¦ç±»å‹çš„æ•°æ®ã€‚ ç»“è®ºï¼šåªè¦æ˜¯å¤„ç†çº¯æ–‡æœ¬æ•°æ®ï¼Œå°±ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨å­—ç¬¦æµã€‚ é™¤æ­¤ä¹‹å¤–éƒ½ä½¿ç”¨å­—èŠ‚æµã€‚ è¾“å…¥æµå’Œè¾“å‡ºæµå¯¹è¾“å…¥æµåªèƒ½è¿›è¡Œè¯»æ“ä½œï¼Œå¯¹è¾“å‡ºæµåªèƒ½è¿›è¡Œå†™æ“ä½œï¼Œç¨‹åºä¸­éœ€è¦æ ¹æ®å¾…ä¼ è¾“æ•°æ®çš„ä¸åŒç‰¹æ€§è€Œä½¿ç”¨ä¸åŒçš„æµã€‚ Java IOæµå¯¹è±¡1.è¾“å…¥å­—èŠ‚æµInputStreamIO ä¸­è¾“å…¥å­—èŠ‚æµçš„ç»§æ‰¿å›¾å¯è§ä¸Šå›¾ï¼Œå¯ä»¥çœ‹å‡ºï¼š InputStream æ˜¯æ‰€æœ‰çš„è¾“å…¥å­—èŠ‚æµçš„çˆ¶ç±»ï¼Œå®ƒæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ã€‚ ByteArrayInputStreamã€StringBufferInputStreamã€FileInputStream æ˜¯ä¸‰ç§åŸºæœ¬çš„ä»‹è´¨æµï¼Œå®ƒä»¬åˆ†åˆ«ä»Byte æ•°ç»„ã€StringBufferã€å’Œæœ¬åœ°æ–‡ä»¶ä¸­è¯»å–æ•°æ®ã€‚PipedInputStream æ˜¯ä»ä¸å…¶å®ƒçº¿ç¨‹å…±ç”¨çš„ç®¡é“ä¸­è¯»å–æ•°æ®ï¼Œä¸Piped ç›¸å…³çš„çŸ¥è¯†åç»­å•ç‹¬ä»‹ç»ã€‚ ObjectInputStream å’Œæ‰€æœ‰FilterInputStream çš„å­ç±»éƒ½æ˜¯è£…é¥°æµï¼ˆè£…é¥°å™¨æ¨¡å¼çš„ä¸»è§’ï¼‰ã€‚ 2.è¾“å‡ºå­—èŠ‚æµOutputStreamIO ä¸­è¾“å‡ºå­—èŠ‚æµçš„ç»§æ‰¿å›¾å¯è§ä¸Šå›¾ï¼Œå¯ä»¥çœ‹å‡ºï¼š OutputStream æ˜¯æ‰€æœ‰çš„è¾“å‡ºå­—èŠ‚æµçš„çˆ¶ç±»ï¼Œå®ƒæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ã€‚ ByteArrayOutputStreamã€FileOutputStream æ˜¯ä¸¤ç§åŸºæœ¬çš„ä»‹è´¨æµï¼Œå®ƒä»¬åˆ†åˆ«å‘Byte æ•°ç»„ã€å’Œæœ¬åœ°æ–‡ä»¶ä¸­å†™å…¥æ•°æ®ã€‚PipedOutputStream æ˜¯å‘ä¸å…¶å®ƒçº¿ç¨‹å…±ç”¨çš„ç®¡é“ä¸­å†™å…¥æ•°æ®ï¼Œ ObjectOutputStream å’Œæ‰€æœ‰FilterOutputStream çš„å­ç±»éƒ½æ˜¯è£…é¥°æµã€‚ 3.å­—èŠ‚æµçš„è¾“å…¥ä¸è¾“å‡ºçš„å¯¹åº” å›¾ä¸­è“è‰²çš„ä¸ºä¸»è¦çš„å¯¹åº”éƒ¨åˆ†ï¼Œçº¢è‰²çš„éƒ¨åˆ†å°±æ˜¯ä¸å¯¹åº”éƒ¨åˆ†ã€‚ç´«è‰²çš„è™šçº¿éƒ¨åˆ†ä»£è¡¨è¿™äº›æµä¸€èˆ¬è¦æ­é…ä½¿ç”¨ã€‚ä»ä¸Šé¢çš„å›¾ä¸­å¯ä»¥çœ‹å‡ºJava IO ä¸­çš„å­—èŠ‚æµæ˜¯æå…¶å¯¹ç§°çš„ã€‚â€œå­˜åœ¨åŠåˆç†â€æˆ‘ä»¬çœ‹çœ‹è¿™äº›å­—èŠ‚æµä¸­ä¸å¤ªå¯¹ç§°çš„å‡ ä¸ªç±»å§ï¼ LineNumberInputStream ä¸»è¦å®Œæˆä»æµä¸­è¯»å–æ•°æ®æ—¶ï¼Œä¼šå¾—åˆ°ç›¸åº”çš„è¡Œå·ï¼Œè‡³äºä»€ä¹ˆæ—¶å€™åˆ†è¡Œã€åœ¨å“ªé‡Œåˆ†è¡Œæ˜¯ç”±æ”¹ç±»ä¸»åŠ¨ç¡®å®šçš„ï¼Œå¹¶ä¸æ˜¯åœ¨åŸå§‹ä¸­æœ‰è¿™æ ·ä¸€ä¸ªè¡Œå·ã€‚åœ¨è¾“å‡ºéƒ¨åˆ†æ²¡æœ‰å¯¹åº”çš„éƒ¨åˆ†ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥è‡ªå·±å»ºç«‹ä¸€ä¸ªLineNumberOutputStreamï¼Œåœ¨æœ€åˆå†™å…¥æ—¶ä¼šæœ‰ä¸€ä¸ªåŸºå‡†çš„è¡Œå·ï¼Œä»¥åæ¯æ¬¡é‡åˆ°æ¢è¡Œæ—¶ä¼šåœ¨ä¸‹ä¸€è¡Œæ·»åŠ ä¸€ä¸ªè¡Œå·ï¼Œçœ‹èµ·æ¥ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚å¥½åƒæ›´ä¸å…¥æµäº†ã€‚ PushbackInputStream çš„åŠŸèƒ½æ˜¯æŸ¥çœ‹æœ€åä¸€ä¸ªå­—èŠ‚ï¼Œä¸æ»¡æ„å°±æ”¾å…¥ç¼“å†²åŒºã€‚ä¸»è¦ç”¨åœ¨ç¼–è¯‘å™¨çš„è¯­æ³•ã€è¯æ³•åˆ†æéƒ¨åˆ†ã€‚è¾“å‡ºéƒ¨åˆ†çš„BufferedOutputStream å‡ ä¹å®ç°ç›¸è¿‘çš„åŠŸèƒ½ã€‚ StringBufferInputStream å·²ç»è¢«Deprecatedï¼Œæœ¬èº«å°±ä¸åº”è¯¥å‡ºç°åœ¨InputStream éƒ¨åˆ†ï¼Œä¸»è¦å› ä¸ºString åº”è¯¥å±äºå­—ç¬¦æµçš„èŒƒå›´ã€‚å·²ç»è¢«åºŸå¼ƒäº†ï¼Œå½“ç„¶è¾“å‡ºéƒ¨åˆ†ä¹Ÿæ²¡æœ‰å¿…è¦éœ€è¦å®ƒäº†ï¼è¿˜å…è®¸å®ƒå­˜åœ¨åªæ˜¯ä¸ºäº†ä¿æŒç‰ˆæœ¬çš„å‘ä¸‹å…¼å®¹è€Œå·²ã€‚ SequenceInputStream å¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªå·¥å…·ç±»ï¼Œå°†ä¸¤ä¸ªæˆ–è€…å¤šä¸ªè¾“å…¥æµå½“æˆä¸€ä¸ªè¾“å…¥æµä¾æ¬¡è¯»å–ã€‚å®Œå…¨å¯ä»¥ä»IO åŒ…ä¸­å»é™¤ï¼Œè¿˜å®Œå…¨ä¸å½±å“IO åŒ…çš„ç»“æ„ï¼Œå´è®©å…¶æ›´â€œçº¯æ´â€â€•â€•çº¯æ´çš„Decorator æ¨¡å¼ã€‚ PrintStream ä¹Ÿå¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªè¾…åŠ©å·¥å…·ã€‚ä¸»è¦å¯ä»¥å‘å…¶ä»–è¾“å‡ºæµï¼Œæˆ–è€…FileInputStream å†™å…¥æ•°æ®ï¼Œæœ¬èº«å†…éƒ¨å®ç°è¿˜æ˜¯å¸¦ç¼“å†²çš„ã€‚æœ¬è´¨ä¸Šæ˜¯å¯¹å…¶å®ƒæµçš„ç»¼åˆè¿ç”¨çš„ä¸€ä¸ªå·¥å…·è€Œå·²ã€‚ä¸€æ ·å¯ä»¥è¸¢å‡ºIO åŒ…ï¼System.out å’ŒSystem.out å°±æ˜¯PrintStream çš„å®ä¾‹ï¼ 4.å­—ç¬¦è¾“å…¥æµReaderåœ¨ä¸Šé¢çš„ç»§æ‰¿å…³ç³»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼š Reader æ˜¯æ‰€æœ‰çš„è¾“å…¥å­—ç¬¦æµçš„çˆ¶ç±»ï¼Œå®ƒæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ã€‚ CharReaderã€StringReader æ˜¯ä¸¤ç§åŸºæœ¬çš„ä»‹è´¨æµï¼Œå®ƒä»¬åˆ†åˆ«å°†Char æ•°ç»„ã€Stringä¸­è¯»å–æ•°æ®ã€‚PipedReader æ˜¯ä»ä¸å…¶å®ƒçº¿ç¨‹å…±ç”¨çš„ç®¡é“ä¸­è¯»å–æ•°æ®ã€‚ BufferedReader å¾ˆæ˜æ˜¾å°±æ˜¯ä¸€ä¸ªè£…é¥°å™¨ï¼Œå®ƒå’Œå…¶å­ç±»è´Ÿè´£è£…é¥°å…¶å®ƒReader å¯¹è±¡ã€‚ FilterReader æ˜¯æ‰€æœ‰è‡ªå®šä¹‰å…·ä½“è£…é¥°æµçš„çˆ¶ç±»ï¼Œå…¶å­ç±»PushbackReader å¯¹Reader å¯¹è±¡è¿›è¡Œè£…é¥°ï¼Œä¼šå¢åŠ ä¸€ä¸ªè¡Œå·ã€‚ InputStreamReader æ˜¯ä¸€ä¸ªè¿æ¥å­—èŠ‚æµå’Œå­—ç¬¦æµçš„æ¡¥æ¢ï¼Œå®ƒå°†å­—èŠ‚æµè½¬å˜ä¸ºå­—ç¬¦æµã€‚FileReader å¯ä»¥è¯´æ˜¯ä¸€ä¸ªè¾¾åˆ°æ­¤åŠŸèƒ½ã€å¸¸ç”¨çš„å·¥å…·ç±»ï¼Œåœ¨å…¶æºä»£ç ä¸­æ˜æ˜¾ä½¿ç”¨äº†å°†FileInputStream è½¬å˜ä¸ºReader çš„æ–¹æ³•ã€‚æˆ‘ä»¬å¯ä»¥ä»è¿™ä¸ªç±»ä¸­å¾—åˆ°ä¸€å®šçš„æŠ€å·§ã€‚Reader ä¸­å„ä¸ªç±»çš„ç”¨é€”å’Œä½¿ç”¨æ–¹æ³•åŸºæœ¬å’ŒInputStream ä¸­çš„ç±»ä½¿ç”¨ä¸€è‡´ã€‚åé¢ä¼šæœ‰Reader ä¸InputStream çš„å¯¹åº”å…³ç³»ã€‚ 5.å­—ç¬¦è¾“å‡ºæµWriteråœ¨ä¸Šé¢çš„å…³ç³»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼š Writer æ˜¯æ‰€æœ‰çš„è¾“å‡ºå­—ç¬¦æµçš„çˆ¶ç±»ï¼Œå®ƒæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ã€‚ CharArrayWriterã€StringWriter æ˜¯ä¸¤ç§åŸºæœ¬çš„ä»‹è´¨æµï¼Œå®ƒä»¬åˆ†åˆ«å‘Char æ•°ç»„ã€String ä¸­å†™å…¥æ•°æ®ã€‚PipedWriter æ˜¯å‘ä¸å…¶å®ƒçº¿ç¨‹å…±ç”¨çš„ç®¡é“ä¸­å†™å…¥æ•°æ®ï¼Œ BufferedWriter æ˜¯ä¸€ä¸ªè£…é¥°å™¨ä¸ºWriter æä¾›ç¼“å†²åŠŸèƒ½ã€‚ PrintWriter å’ŒPrintStream æå…¶ç±»ä¼¼ï¼ŒåŠŸèƒ½å’Œä½¿ç”¨ä¹Ÿéå¸¸ç›¸ä¼¼ã€‚ OutputStreamWriter æ˜¯OutputStream åˆ°Writer è½¬æ¢çš„æ¡¥æ¢ï¼Œå®ƒçš„å­ç±»FileWriter å…¶å®å°±æ˜¯ä¸€ä¸ªå®ç°æ­¤åŠŸèƒ½çš„å…·ä½“ç±»ï¼ˆå…·ä½“å¯ä»¥ç ”ç©¶ä¸€SourceCodeï¼‰ã€‚åŠŸèƒ½å’Œä½¿ç”¨å’ŒOutputStream æå…¶ç±»ä¼¼ï¼Œåé¢ä¼šæœ‰å®ƒä»¬çš„å¯¹åº”å›¾ã€‚ 6.å­—ç¬¦æµçš„è¾“å…¥ä¸è¾“å‡ºçš„å¯¹åº” 7.å­—ç¬¦æµä¸å­—èŠ‚æµè½¬æ¢è½¬æ¢æµçš„ç‰¹ç‚¹ï¼š å…¶æ˜¯å­—ç¬¦æµå’Œå­—èŠ‚æµä¹‹é—´çš„æ¡¥æ¢ å¯å¯¹è¯»å–åˆ°çš„å­—èŠ‚æ•°æ®ç»è¿‡æŒ‡å®šç¼–ç è½¬æ¢æˆå­—ç¬¦ å¯å¯¹è¯»å–åˆ°çš„å­—ç¬¦æ•°æ®ç»è¿‡æŒ‡å®šç¼–ç è½¬æ¢æˆå­—èŠ‚ ä½•æ—¶ä½¿ç”¨è½¬æ¢æµï¼Ÿ å½“å­—èŠ‚å’Œå­—ç¬¦ä¹‹é—´æœ‰è½¬æ¢åŠ¨ä½œæ—¶ï¼› æµæ“ä½œçš„æ•°æ®éœ€è¦ç¼–ç æˆ–è§£ç æ—¶ã€‚ å…·ä½“çš„å¯¹è±¡ä½“ç°ï¼š InputStreamReader:å­—èŠ‚åˆ°å­—ç¬¦çš„æ¡¥æ¢ OutputStreamWriter:å­—ç¬¦åˆ°å­—èŠ‚çš„æ¡¥æ¢ è¿™ä¸¤ä¸ªæµå¯¹è±¡æ˜¯å­—ç¬¦ä½“ç³»ä¸­çš„æˆå‘˜ï¼Œå®ƒä»¬æœ‰è½¬æ¢ä½œç”¨ï¼Œæœ¬èº«åˆæ˜¯å­—ç¬¦æµï¼Œæ‰€ä»¥åœ¨æ„é€ çš„æ—¶å€™éœ€è¦ä¼ å…¥å­—èŠ‚æµå¯¹è±¡è¿›æ¥ã€‚ 8.Fileç±»Fileç±»æ˜¯å¯¹æ–‡ä»¶ç³»ç»Ÿä¸­æ–‡ä»¶ä»¥åŠæ–‡ä»¶å¤¹è¿›è¡Œå°è£…çš„å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡å¯¹è±¡çš„æ€æƒ³æ¥æ“ä½œæ–‡ä»¶å’Œæ–‡ä»¶å¤¹ã€‚ Fileç±»ä¿å­˜æ–‡ä»¶æˆ–ç›®å½•çš„å„ç§å…ƒæ•°æ®ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ–‡ä»¶åã€æ–‡ä»¶é•¿åº¦ã€æœ€åä¿®æ”¹æ—¶é—´ã€æ˜¯å¦å¯è¯»ã€è·å–å½“å‰æ–‡ä»¶çš„è·¯å¾„åï¼Œåˆ¤æ–­æŒ‡å®šæ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€è·å¾—å½“å‰ç›®å½•ä¸­çš„æ–‡ä»¶åˆ—è¡¨ï¼Œåˆ›å»ºã€åˆ é™¤æ–‡ä»¶å’Œç›®å½•ç­‰æ–¹æ³•ã€‚ 9.RandomAccessFileç±»è¯¥å¯¹è±¡å¹¶ä¸æ˜¯æµä½“ç³»ä¸­çš„ä¸€å‘˜ï¼Œå…¶å°è£…äº†å­—èŠ‚æµï¼ŒåŒæ—¶è¿˜å°è£…äº†ä¸€ä¸ªç¼“å†²åŒºï¼ˆå­—ç¬¦æ•°ç»„ï¼‰ï¼Œé€šè¿‡å†…éƒ¨çš„æŒ‡é’ˆæ¥æ“ä½œå­—ç¬¦æ•°ç»„ä¸­çš„æ•°æ®ã€‚ è¯¥å¯¹è±¡ç‰¹ç‚¹ï¼š è¯¥å¯¹è±¡åªèƒ½æ“ä½œæ–‡ä»¶ï¼Œæ‰€ä»¥æ„é€ å‡½æ•°æ¥æ”¶ä¸¤ç§ç±»å‹çš„å‚æ•°ï¼ša.å­—ç¬¦ä¸²æ–‡ä»¶è·¯å¾„ï¼›b.Fileå¯¹è±¡ã€‚ è¯¥å¯¹è±¡æ—¢å¯ä»¥å¯¹æ–‡ä»¶è¿›è¡Œè¯»æ“ä½œï¼Œä¹Ÿèƒ½è¿›è¡Œå†™æ“ä½œï¼Œåœ¨è¿›è¡Œå¯¹è±¡å®ä¾‹åŒ–æ—¶å¯æŒ‡å®šæ“ä½œæ¨¡å¼(r,rw) æ³¨æ„ï¼šè¯¥å¯¹è±¡åœ¨å®ä¾‹åŒ–æ—¶ï¼Œå¦‚æœè¦æ“ä½œçš„æ–‡ä»¶ä¸å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºï¼›å¦‚æœæ–‡ä»¶å­˜åœ¨ï¼Œå†™æ•°æ®æœªæŒ‡å®šä½ç½®ï¼Œä¼šä»å¤´å¼€å§‹å†™ï¼Œå³è¦†ç›–åŸæœ‰çš„å†…å®¹ã€‚ å¯ä»¥ç”¨äºå¤šçº¿ç¨‹ä¸‹è½½æˆ–å¤šä¸ªçº¿ç¨‹åŒæ—¶å†™æ•°æ®åˆ°æ–‡ä»¶ã€‚ æ›´å¤šç²¾å½©æ–‡ç« è¯·è§æˆ‘çš„ä¸ªäººåšå®¢åœ°å€ï¼šhttp://www.54tianzhisheng.cn","tags":[{"name":"Java","slug":"Java","permalink":"http://www.54tianzhisheng.cn/tags/Java/"},{"name":"IO","slug":"IO","permalink":"http://www.54tianzhisheng.cn/tags/IO/"}]},{"title":"java.sql.SQLException Field 'id' doesn't have a default value","date":"2017-06-19T16:00:00.000Z","path":"2017/06/20/Java-error1/","text":"1ã€é”™è¯¯æè¿° åœ¨åšä¸€ä¸ªç”µå•†ç½‘ç«™é¡¹ç›®æ—¶ï¼Œä½¿ç”¨ Mybatis + MySQL æ—¶å‡ºç°é—®é¢˜ Caused by: java.sql.SQLException: Field &#39;id&#39; doesn&#39;t have a default value ï¼Œç½‘ä¸Šå¾ˆå¤šäººè¯´æ˜¯ MyBatis æ’å…¥æ•°æ®è¡Œ ID æ²¡ç”Ÿæˆè‡ªå¢ã€‚ä½†æ˜¯æˆ‘å°è¯•å¥½ä¹…ï¼Œæ²¡è§£å†³è¯¥é—®é¢˜ã€‚ 2ã€é”™è¯¯åŸå›  åæ¥æ‰å‘ç°æ˜¯å› ä¸ºåˆ›å»ºæ•°æ®åº“æ—¶çš„å»ºè¡¨è¯­å¥ä¸­çš„ id æ˜¯ä¸»é”®çš„ï¼Œä½†æ˜¯åœ¨æ’å…¥çš„è¿‡ç¨‹ä¸­ï¼Œæ²¡æœ‰ç»™äºˆæ•°å€¼ï¼Œå¹¶ä¸”æ²¡æœ‰è®© id è‡ªå¢ã€‚ 3ã€è§£å†³åŠæ³• ä¿®æ”¹æ•°æ®åº“è¡¨ä¸­çš„idï¼Œè®©å…¶è‡ªå¢ï¼ˆåœ¨æ’å…¥çš„è¿‡ç¨‹ä¸­ï¼Œä¸æ’å…¥idæ•°æ®æ—¶ï¼‰ã€‚ ï¼ˆæˆ‘æ˜¯ç›´æ¥å°†æ•´ä¸ªæ•°æ®åº“éƒ½å¯¼å‡ºæ¥ï¼Œç„¶ååœ¨æ¯ä¸ªè¡¨çš„ id åé¢åŠ ä¸Šä¸€ä¸ª auto_incrementï¼‰, å¦‚ä¸‹ ï¼š12345678910CREATE TABLE `d_user` ( `id` int(11) NOT NULL auto_increment, `name` varchar(45) DEFAULT NULL, `password` varchar(45) DEFAULT NULL, `zip` varchar(45) DEFAULT NULL, `address` varchar(45) DEFAULT NULL, `phone` varchar(45) DEFAULT NULL, `email` varchar(45) DEFAULT NULL, PRIMARY KEY (`id`))","tags":[{"name":"Java","slug":"Java","permalink":"http://www.54tianzhisheng.cn/tags/Java/"}]},{"title":"ä¸­ç¼€è¡¨è¾¾å¼è½¬æ¢æˆå‰ç¼€å’Œåç¼€è¡¨è¾¾å¼è¿™ç±»é¢˜ç›®çš„è¶…å®ç”¨è§£é¢˜æŠ€å·§","date":"2017-06-18T16:00:00.000Z","path":"2017/06/19/ä¸­ç¼€è¡¨è¾¾å¼è½¬æ¢æˆå‰ç¼€å’Œåç¼€è¡¨è¾¾å¼è¿™ç±»é¢˜ç›®çš„è¶…å®ç”¨è§£é¢˜æŠ€å·§/","text":"çœ‹åˆ°äº†æ ‡é¢˜å¦‚æœè¿˜ä¸äº†è§£çš„è¿™å‡ ä¸ªæ¦‚å¿µçš„è¯·å…ˆçœ‹çœ‹åšå®¢ï¼šè¯¦è§£å‰ç¼€ã€ä¸­ç¼€ã€åç¼€è¡¨è¾¾å¼ å…ˆç»™å‡ ä¸ªä¸­ç¼€è¡¨è¾¾å¼è½¬æ¢æˆåç¼€è¡¨è¾¾å¼é¢˜ç›®åšåšå§ï¼Œæœ€åæˆ‘ä»¬åœ¨æ€»ç»“è¶…å®ç”¨çš„æŠ€å·§ï¼ï¼ 1. è¡¨è¾¾å¼â€œX=A+B*ï¼ˆCâ€“Dï¼‰/Eâ€çš„åç¼€è¡¨ç¤ºå½¢å¼å¯ä»¥ä¸º A. XAB+CDE/-*= B. XA+BC-DE/*= C. XABCD-*E/+= D. XABCDE+*/= å…ˆæŠŠç­”æ¡ˆè¯´å‡ºæ¥å§ï¼Œä¸è¿‡ä½ å¯ä»¥è‡ªå·±å…ˆå¥½å¥½çš„æƒ³æƒ³å¯ä»¥æ€ä¹ˆåšæ‰èƒ½æ›´å¿«çš„æŠŠç­”æ¡ˆé€‰å‡ºæ¥å‘¢ï¼Ÿ ç­”æ¡ˆï¼šC å…ˆçœ‹çœ‹ä¸‹é¢å›¾ç‰‡ä¸­çš„è¿™ç§æ–¹æ³•å¦‚ä½•ï¼Ÿ 2. å·²çŸ¥-ç®—æœ¯è¡¨è¾¾å¼çš„ä¸­ç¼€è¡¨è¾¾å¼ä¸ºa-(b+c/d)*e,å…¶åç¼€å½¢å¼ä¸º() A. -a+b*c/d B. -a+b*cd/e C. -+*abc/de D. abcd/+e*- ç­”æ¡ˆï¼šD 3. ç®—æœ¯è¡¨è¾¾å¼a+b*(c+d/e)è½¬ä¸ºåç¼€è¡¨è¾¾å¼åä¸º() A. ab+cde/* B. abcde/+*+ C. abcde/*++ D. abcde*/++ ç­”æ¡ˆï¼šB 4. è¡¨è¾¾å¼a*(b+c)-dçš„åç¼€è¡¨è¾¾å¼æ˜¯() A. abcd*+- B. abc+*d- C. abc*+d- D. -+*abcd ç­”æ¡ˆï¼šB å¥½ï¼Œé¢˜ç›®æˆ‘ä»¬ä¹Ÿçœ‹äº†è¿™ä¹ˆå¤šäº†ï¼Œé‚£æˆ‘ä»¬è¯¥å¦‚ä½•è§£å†³è¿™ä¸€ç±»çš„é¢˜ç›®å‘¢ï¼Ÿå¦‚æœä½ çœ‹äº†æ–‡ç« é¦–éƒ¨çš„é‚£ç¯‡ åšå®¢çš„è¯ï¼Œé‚£ä½ è‚¯å®šä¼šè§‰å¾—é‚£ä¸ªè§£æ³•å¾ˆå¤æ‚ï¼Œå¦‚æœçœŸçš„æ˜¯åœ¨ç¬”è¯•ä¸­å‡ºç°è¿™æ ·çš„é¢˜ç›®ï¼Œé‚£å¾—è€—è´¹ä¸ å°‘çš„æ—¶é—´å•Šã€‚æœ‰äººè¦é—®äº†ï¼Œè¯´äº†é‚£ä¹ˆä¸€å †ï¼Œé‚£ç©¶ç«Ÿæœ‰æ²¡æœ‰ä»€ä¹ˆå¿«é€Ÿçš„æ–¹æ³•å‘¢æˆ–è€…è¯´æœ‰æ²¡æœ‰ä»€ä¹ˆç®€ å•çš„æ–¹æ³•å¯ä»¥ç›´æ¥å£ç®—çš„æŠŠç­”æ¡ˆå†™å‡ºæ¥å‘¢ï¼Œç­”æ¡ˆæ˜¯ï¼šæœ‰çš„ï¼è€Œä¸”è¿˜çœŸçš„æ˜¯ç‰¹åˆ«çš„ç®€å•ï¼ï¼ï¼ è§£é¢˜é‡ç‚¹ï¼š è¿™é‡Œæˆ‘ç»™å‡ºä¸€ä¸ªä¸­ç¼€è¡¨è¾¾å¼~ a+b*c-(d+e) ç¬¬ä¸€æ­¥ï¼šæŒ‰ç…§è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§å¯¹æ‰€æœ‰çš„è¿ç®—å•ä½åŠ æ‹¬å· åˆ™å¼å­å˜æˆæ‹‰ï¼š((a+(b*c))-(d+e)) ç¬¬äºŒæ­¥ï¼šè½¬æ¢å‰ç¼€ä¸åç¼€è¡¨è¾¾å¼ 1. å‰ç¼€è¡¨è¾¾å¼ï¼šæŠŠè¿ç®—ç¬¦å·ç§»åŠ¨åˆ°å¯¹åº”çš„æ‹¬å·å‰é¢ åˆ™å˜æˆæ‹‰ï¼š-( +(a *(bc)) +(de)) æŠŠæ‹¬å·å»æ‰ï¼š-+a*bc+de å‰ç¼€è¡¨è¾¾å¼å‡ºç° 2. åç¼€è¡¨è¾¾å¼ï¼šæŠŠè¿ç®—ç¬¦å·ç§»åŠ¨åˆ°å¯¹åº”çš„æ‹¬å·åé¢ åˆ™å˜æˆæ‹‰ï¼š((a(bc)* )+ (de)+ )- æŠŠæ‹¬å·å»æ‰ï¼šabc*+de+- åç¼€è¡¨è¾¾å¼å‡ºç° å‘ç°æ²¡æœ‰ï¼Œå‰ç¼€è¡¨è¾¾å¼ï¼Œåç¼€è¡¨è¾¾å¼æ˜¯ä¸éœ€è¦ç”¨æ‹¬å·æ¥è¿›è¡Œä¼˜å…ˆçº§çš„ç¡®å®šçš„ã€‚ å¦‚æœä½ ä¹ æƒ¯æ‹‰ä»–çš„è¿ç®—æ–¹æ³•ã€‚è®¡ç®—çš„æ—¶å€™ä¹Ÿå°±æ˜¯ä»ä¸¤ä¸ªæ“ä½œæ•°çš„å‰é¢ æˆ–è€…åé¢æ‰¾è¿ç®—ç¬¦ã€‚è€Œä¸æ˜¯ä¸­é—´æ‰¾ï¼Œé‚£ä¹ˆä¹Ÿå°±ç›´æ¥å¯ä»¥å£ç®—å•¦ï¼ ä½ è¯´è¿™ç§æ–¹æ³•æ˜¯ä¸æ˜¯å¾ˆç®€å•å•Šï¼ï¼ï¼ ç°åœ¨ä½ å†å»çœ‹çœ‹åˆšæ‰çš„é‚£å››é“é¢˜ç›®ï¼Œæ˜¯ä¸æ˜¯å¾ˆç®€å•çš„ç­”æ¡ˆå°±å£ç®—å‡ºæ¥äº†å•Šï¼ï¼ï¼ 6ä¸6ï¼Ÿ","tags":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"http://www.54tianzhisheng.cn/tags/æ•°æ®ç»“æ„/"},{"name":"è¡¨è¾¾å¼","slug":"è¡¨è¾¾å¼","permalink":"http://www.54tianzhisheng.cn/tags/è¡¨è¾¾å¼/"}]},{"title":"å¾ªç¯é˜Ÿåˆ—çš„ç›¸å…³æ¡ä»¶å’Œå…¬å¼","date":"2017-06-17T16:00:00.000Z","path":"2017/06/18/å¾ªç¯é˜Ÿåˆ—çš„ç›¸å…³æ¡ä»¶å’Œå…¬å¼/","text":"å¾ªç¯é˜Ÿåˆ—çš„ç›¸å…³æ¡ä»¶å’Œå…¬å¼ï¼šé˜Ÿå°¾æŒ‡é’ˆæ˜¯rear,é˜Ÿå¤´æ˜¯frontï¼Œå…¶ä¸­QueueSizeä¸ºå¾ªç¯é˜Ÿåˆ—çš„æœ€å¤§é•¿åº¦ é˜Ÿç©ºæ¡ä»¶ï¼šrear==front é˜Ÿæ»¡æ¡ä»¶ï¼š(rear+1) %QueueSIze==front è®¡ç®—é˜Ÿåˆ—é•¿åº¦ï¼šï¼ˆrear-front+QueueSizeï¼‰%QueueSize å…¥é˜Ÿï¼šï¼ˆrear+1ï¼‰%QueueSize å‡ºé˜Ÿï¼šï¼ˆfront+1ï¼‰%QueueSize é˜Ÿåˆ—ä¸­å…ƒç´ çš„ä¸ªæ•°ï¼š (rear-front+QueueSize)%QueueSize","tags":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"http://www.54tianzhisheng.cn/tags/æ•°æ®ç»“æ„/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"http://www.54tianzhisheng.cn/tags/ç®—æ³•/"},{"name":"å¾ªç¯é˜Ÿåˆ—","slug":"å¾ªç¯é˜Ÿåˆ—","permalink":"http://www.54tianzhisheng.cn/tags/å¾ªç¯é˜Ÿåˆ—/"}]},{"title":"Bootstrapå…¥é—¨éœ€æŒæ¡çš„çŸ¥è¯†ç‚¹ï¼ˆä¸€ï¼‰","date":"2017-06-17T16:00:00.000Z","path":"2017/06/18/Bootstrapå…¥é—¨éœ€æŒæ¡çš„çŸ¥è¯†ç‚¹ï¼ˆä¸€ï¼‰/","text":"BootstrapBootstrapä¸­æ–‡ç½‘ï¼šhttp://www.bootcss.com/ 1.ä»€ä¹ˆæ˜¯ Bootstrapï¼Ÿ å®˜æ–¹ä»‹ç»ï¼šç®€æ´ã€ç›´è§‚ã€å¼ºæ‚çš„å‰ç«¯å¼€å‘æ¡†æ¶ï¼Œè®©webå¼€å‘æ›´è¿…é€Ÿã€ç®€å•ã€‚ Bootstrap ä¸‹è½½ Bootstrap3ä¸‹è½½åœ°å€ï¼šhttp://v3.bootcss.com/getting-started/#download Bootstrap æ–‡ä»¶ç›®å½•ç»“æ„ 1234567891011121314151617dist -css -bootstrap.css -bootstrap.css.map -bootstrap.min.cssï¼ˆå¸¸ç”¨ï¼‰ -bootstrap-theme.css -bootstrap-theme.css.map -bootstrap-theme.min.css -fonts -glyphicons-halflings-regular.eot -glyphicons-halflings-regular.svg -glyphicons-halflings-regular.ttf -glyphicons-halflings-regular.woff -js -bootstrap.js -bootstrap.min.jsï¼ˆå¸¸ç”¨ï¼‰ -npm.js Bootstrap ä¾èµ– è¦æƒ³ä½¿ç”¨ Bootstrap ï¼Œé‚£ä¹ˆå¿…é¡»å…ˆå¼•å…¥ jQueryï¼ˆjquery.min.jsï¼‰æ–‡ä»¶ã€‚ 5.ä½¿ç”¨ Bootstrap å‹ç¼©ç‰ˆæœ¬é€‚äºå®é™…åº”ç”¨ï¼Œæœªå‹ç¼©ç‰ˆæœ¬é€‚äºå¼€å‘è°ƒè¯•è¿‡ç¨‹ ç›´æ¥å¼•ç”¨å®˜ç½‘ä¸‹è½½ä¸‹æ¥çš„æ–‡ä»¶ã€‚ ä½¿ç”¨ Bootstrap ä¸­æ–‡ç½‘æä¾›çš„å…è´¹ CDN æœåŠ¡ã€‚ 1234567891011&lt;!-- æ–° Bootstrap æ ¸å¿ƒ CSS æ–‡ä»¶ --&gt;&lt;link rel=\"stylesheet\" href=\"http://cdn.bootcss.com/bootstrap/3.3.0/css/bootstrap.min.css\"&gt;&lt;!-- å¯é€‰çš„Bootstrapä¸»é¢˜æ–‡ä»¶ï¼ˆä¸€èˆ¬ä¸ç”¨å¼•å…¥ï¼‰ --&gt;&lt;link rel=\"stylesheet\" href=\"http://cdn.bootcss.com/bootstrap/3.3.0/css/bootstrap-theme.min.css\"&gt;&lt;!-- jQueryæ–‡ä»¶ã€‚åŠ¡å¿…åœ¨bootstrap.min.js ä¹‹å‰å¼•å…¥ --&gt;&lt;script src=\"http://cdn.bootcss.com/jquery/1.11.1/jquery.min.js\"&gt;&lt;/script&gt;&lt;!-- æœ€æ–°çš„ Bootstrap æ ¸å¿ƒ JavaScript æ–‡ä»¶ --&gt;&lt;script src=\"http://cdn.bootcss.com/bootstrap/3.3.0/js/bootstrap.min.js\"&gt;&lt;/script&gt; Bootstrap åŸºæœ¬æ¨¡æ¿ 123456789101112131415161718192021222324252627&lt;!DOCTYPE html&gt;&lt;html lang=\"zh-cn\"&gt; &lt;head&gt; &lt;meta charset=\"utf-8\"&gt; &lt;meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\"&gt; &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"&gt; &lt;title&gt;Bootstrap åŸºæœ¬æ¨¡æ¿&lt;/title&gt; &lt;!-- Bootstrap --&gt; &lt;link href=\"css/bootstrap.min.css\" rel=\"stylesheet\"&gt; &lt;!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries --&gt; &lt;!-- WARNING: Respond.js doesn't work if you view the page via file:// --&gt; &lt;!--[if lt IE 9]&gt; &lt;script src=\"http://cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js\"&gt;&lt;/script&gt; &lt;script src=\"http://cdn.bootcss.com/respond.js/1.4.2/respond.min.js\"&gt;&lt;/script&gt; &lt;![endif]--&gt; &lt;/head&gt; &lt;body&gt; &lt;h1&gt;ä½ å¥½ï¼Œä¸–ç•Œï¼&lt;/h1&gt; &lt;!-- jQuery (necessary for Bootstrap's JavaScript plugins) --&gt; &lt;script src=\"http://cdn.bootcss.com/jquery/1.11.1/jquery.min.js\"&gt;&lt;/script&gt; &lt;!-- Include all compiled plugins (below), or include individual files as needed --&gt; &lt;script src=\"js/bootstrap.min.js\"&gt;&lt;/script&gt; &lt;/body&gt;&lt;/html&gt; Bootstrap å®ä¾‹ç²¾é€‰ï¼šhttp://v3.bootcss.com/getting-started/#examples å…¨å±€ CSS æ ·å¼HTML5 æ–‡æ¡£ç±»å‹Bootstrap ä½¿ç”¨åˆ°çš„æŸäº› HTML å…ƒç´ å’Œ CSS å±æ€§éœ€è¦å°†é¡µé¢è®¾ç½®ä¸º HTML5 æ–‡æ¡£ç±»å‹ã€‚ 1234&lt;!DOCTYPE html&gt;&lt;html lang=\"zh-CN\"&gt; ...&lt;/html&gt; ç§»åŠ¨è®¾å¤‡ä¼˜å…ˆåœ¨ bootstrap3 ä¸­ç§»åŠ¨è®¾å¤‡ä¼˜å…ˆè€ƒè™‘çš„ã€‚ä¸ºäº†ä¿è¯é€‚å½“çš„ç»˜åˆ¶å’Œè§¦å±ç¼©æ”¾ï¼Œéœ€è¦åœ¨&lt;head&gt;ä¹‹ä¸­æ·»åŠ  viewport å…ƒæ•°æ®æ ‡ç­¾ã€‚ 1&lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"&gt; åœ¨ç§»åŠ¨è®¾å¤‡æµè§ˆå™¨ä¸Šï¼Œå¯ä»¥é€šè¿‡è§†å£ viewport è®¾ç½®metaå±æ€§ä¸ºuser-scalable=noå¯ä»¥ç¦ç”¨å…¶ç¼©æ”¾ï¼ˆzoomingï¼‰åŠŸèƒ½ï¼Œè¿™æ ·åç”¨æˆ·åªèƒ½æ»šåŠ¨å±å¹•ã€‚ï¼ˆçœ‹æƒ…å†µè€Œå®šï¼‰ 1&lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1, maximum-scala=1, user-scalable=no\"&gt; æ’ç‰ˆä¸é“¾æ¥Bootstrap æ’ç‰ˆã€é“¾æ¥æ ·å¼è®¾ç½®äº†åŸºæœ¬çš„å…¨å±€æ ·å¼ã€‚åˆ†åˆ«æ˜¯ï¼š ä¸º body å…ƒç´ è®¾ç½® background-color: #fff; ä½¿ç”¨ @font-family-baseã€@font-size-base å’Œ @line-height-base aå˜é‡ä½œä¸ºæ’ç‰ˆçš„åŸºæœ¬å‚æ•° ä¸ºæ‰€æœ‰é“¾æ¥è®¾ç½®äº†åŸºæœ¬é¢œè‰² @link-color ï¼Œå¹¶ä¸”å½“é“¾æ¥å¤„äº :hover çŠ¶æ€æ—¶æ‰æ·»åŠ ä¸‹åˆ’çº¿ è¿™äº›æ ·å¼éƒ½èƒ½åœ¨ scaffolding.less æ–‡ä»¶ä¸­æ‰¾åˆ°å¯¹åº”çš„æºç ã€‚ Normalize.cssä¸ºäº†å¢å¼ºè·¨æµè§ˆå™¨è¡¨ç°çš„ä¸€è‡´æ€§ï¼Œbootstrapä½¿ç”¨äº† Normalize.cssï¼Œè¿™æ˜¯ç”± Nicolas Gallagher å’Œ Jonathan Neal ç»´æŠ¤çš„ä¸€ä¸ªCSS é‡ç½®æ ·å¼åº“ã€‚ å¸ƒå±€å®¹å™¨Bootstrap éœ€è¦ä¸ºé¡µé¢å†…å®¹å’Œæ …æ ¼ç³»ç»ŸåŒ…è£¹ä¸€ä¸ª .container å®¹å™¨ã€‚Bootstrapæä¾›äº†ä¸¤ä¸ªä½œæ­¤ç”¨å¤„çš„ç±»ã€‚æ³¨æ„ï¼Œç”±äº paddingç­‰å±æ€§çš„åŸå› ï¼Œè¿™ä¸¤ç§å®¹å™¨ç±»ä¸èƒ½äº’ç›¸åµŒå¥—ã€‚ .container ç±»ç”¨äºå›ºå®šå®½åº¦å¹¶æ”¯æŒå“åº”å¼å¸ƒå±€çš„å®¹å™¨ã€‚ 123&lt;div class=\"container\"&gt; ...&lt;/div&gt; .container-fluid ç±»ç”¨äº 100% å®½åº¦ï¼Œå æ®å…¨éƒ¨è§†å£ï¼ˆviewportï¼‰çš„å®¹å™¨ã€‚ 123&lt;div class=\"container-fluid\"&gt; ...&lt;/div&gt; æ …æ ¼ç³»ç»ŸBootstrap æä¾›äº†ä¸€å¥—å“åº”å¼ã€ç§»åŠ¨è®¾å¤‡ä¼˜å…ˆçš„æµå¼æ …æ ¼ç³»ç»Ÿï¼Œéšç€å±å¹•æˆ–è§†å£ï¼ˆviewportï¼‰å°ºå¯¸çš„å¢åŠ ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ†ä¸ºæœ€å¤š12åˆ—ã€‚å®ƒåŒ…å«äº†æ˜“äºä½¿ç”¨çš„é¢„å®šä¹‰ç±»ï¼Œè¿˜æœ‰å¼ºå¤§çš„mixin ç”¨äºç”Ÿæˆæ›´å…·è¯­ä¹‰çš„å¸ƒå±€ã€‚ ç®€ä»‹æ …æ ¼ç³»ç»Ÿç”¨äºé€šè¿‡ä¸€ç³»åˆ—çš„è¡Œï¼ˆrowï¼‰ä¸åˆ—ï¼ˆcolumnï¼‰çš„ç»„åˆæ¥åˆ›å»ºé¡µé¢å¸ƒå±€ï¼Œä½ çš„å†…å®¹å°±å¯ä»¥æ”¾å…¥è¿™äº›åˆ›å»ºå¥½çš„å¸ƒå±€ä¸­ã€‚ä¸‹é¢å°±ä»‹ç»ä¸€ä¸‹ Bootstrap æ …æ ¼ç³»ç»Ÿçš„å·¥ä½œåŸç†ï¼š â€œè¡Œï¼ˆrowï¼‰â€å¿…é¡»åŒ…å«åœ¨ .container ï¼ˆå›ºå®šå®½åº¦ï¼‰æˆ– .container-fluid ï¼ˆ100% å®½åº¦ï¼‰ä¸­ï¼Œä»¥ä¾¿ä¸ºå…¶èµ‹äºˆåˆé€‚çš„æ’åˆ—ï¼ˆaligmentï¼‰å’Œå†…è¡¥ï¼ˆpaddingï¼‰ã€‚ é€šè¿‡â€œè¡Œï¼ˆrowï¼‰â€åœ¨æ°´å¹³æ–¹å‘åˆ›å»ºä¸€ç»„â€œåˆ—ï¼ˆcolumnï¼‰â€ã€‚ ä½ çš„å†…å®¹åº”å½“æ”¾ç½®äºâ€œåˆ—ï¼ˆcolumnï¼‰â€å†…ï¼Œå¹¶ä¸”ï¼Œåªæœ‰â€œåˆ—ï¼ˆcolumnï¼‰â€å¯ä»¥ä½œä¸ºè¡Œï¼ˆrowï¼‰â€çš„ç›´æ¥å­å…ƒç´ ã€‚ ç±»ä¼¼ .row å’Œ .col-xs-4 è¿™ç§é¢„å®šä¹‰çš„ç±»ï¼Œå¯ä»¥ç”¨æ¥å¿«é€Ÿåˆ›å»ºæ …æ ¼å¸ƒå±€ã€‚Bootstrap æºç ä¸­å®šä¹‰çš„ mixin ä¹Ÿå¯ä»¥ç”¨æ¥åˆ›å»ºè¯­ä¹‰åŒ–çš„å¸ƒå±€ã€‚ é€šè¿‡ä¸ºâ€œåˆ—ï¼ˆcolumnï¼‰â€è®¾ç½® padding å±æ€§ï¼Œä»è€Œåˆ›å»ºåˆ—ä¸åˆ—ä¹‹é—´çš„é—´éš”ï¼ˆgutterï¼‰ã€‚é€šè¿‡ä¸º .row å…ƒç´ è®¾ç½®è´Ÿå€¼margin ä»è€ŒæŠµæ¶ˆæ‰ä¸º .container å…ƒç´ è®¾ç½®çš„ paddingï¼Œä¹Ÿå°±é—´æ¥ä¸ºâ€œè¡Œï¼ˆrowï¼‰â€æ‰€åŒ…å«çš„â€œåˆ—ï¼ˆcolumnï¼‰â€æŠµæ¶ˆæ‰äº†paddingã€‚ The negative margin is why the examples below are outdented. Itâ€™s so that content within grid columns is lined up with non-grid content. Grid columns are created by specifying the number of twelve available columns you wish to span. For example, three equal columns would use three .col-xs-4. å¦‚æœä¸€â€œè¡Œï¼ˆrowï¼‰â€ä¸­åŒ…å«äº†çš„â€œåˆ—ï¼ˆcolumnï¼‰â€å¤§äº 12ï¼Œå¤šä½™çš„â€œåˆ—ï¼ˆcolumnï¼‰â€æ‰€åœ¨çš„å…ƒç´ å°†è¢«ä½œä¸ºä¸€ä¸ªæ•´ä½“å¦èµ·ä¸€è¡Œæ’åˆ—ã€‚ Grid classes apply to devices with screen widths greater than or equal to the breakpoint sizes, and override grid classes targeted at smaller devices. Therefore, applying any .col-md- class to an element will not only affect its styling on medium devices but also on large devices if a .col-lg- class is not present. é€šè¿‡ç ”ç©¶åé¢çš„å®ä¾‹ï¼Œå¯ä»¥å°†è¿™äº›åŸç†åº”ç”¨åˆ°ä½ çš„ä»£ç ä¸­ã€‚ åª’ä½“æŸ¥è¯¢åœ¨æ …æ ¼ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬åœ¨ Less æ–‡ä»¶ä¸­ä½¿ç”¨ä»¥ä¸‹åª’ä½“æŸ¥è¯¢ï¼ˆmedia queryï¼‰æ¥åˆ›å»ºå…³é”®çš„åˆ†ç•Œç‚¹é˜ˆå€¼ã€‚ 1234567891011/* è¶…å°å±å¹•ï¼ˆæ‰‹æœºï¼Œå°äº 768pxï¼‰ *//* æ²¡æœ‰ä»»ä½•åª’ä½“æŸ¥è¯¢ç›¸å…³çš„ä»£ç ï¼Œå› ä¸ºè¿™åœ¨ Bootstrap ä¸­æ˜¯é»˜è®¤çš„ï¼ˆè¿˜è®°å¾— Bootstrap æ˜¯ç§»åŠ¨è®¾å¤‡ä¼˜å…ˆçš„å—ï¼Ÿï¼‰ *//* å°å±å¹•ï¼ˆå¹³æ¿ï¼Œå¤§äºç­‰äº 768pxï¼‰ */@media (min-width: @screen-sm-min) &#123; ... &#125;/* ä¸­ç­‰å±å¹•ï¼ˆæ¡Œé¢æ˜¾ç¤ºå™¨ï¼Œå¤§äºç­‰äº 992pxï¼‰ */@media (min-width: @screen-md-min) &#123; ... &#125;/* å¤§å±å¹•ï¼ˆå¤§æ¡Œé¢æ˜¾ç¤ºå™¨ï¼Œå¤§äºç­‰äº 1200pxï¼‰ */@media (min-width: @screen-lg-min) &#123; ... &#125; å¶å°”ä¹Ÿä¼šåœ¨åª’ä½“æŸ¥è¯¢ä»£ç ä¸­åŒ…å« max-width ä»è€Œå°† CSS çš„å½±å“é™åˆ¶åœ¨æ›´å°èŒƒå›´çš„å±å¹•å¤§å°ä¹‹å†… 1234@media (max-width: @screen-xs-max) &#123; ... &#125;@media (min-width: @screen-sm-min) and (max-width: @screen-sm-max) &#123; ... &#125;@media (min-width: @screen-md-min) and (max-width: @screen-md-max) &#123; ... &#125;@media (min-width: @screen-lg-min) &#123; ... &#125; æ …æ ¼å‚æ•°é€šè¿‡ä¸‹è¡¨å¯ä»¥è¯¦ç»†æŸ¥çœ‹ Bootstrap çš„æ …æ ¼ç³»ç»Ÿæ˜¯å¦‚ä½•åœ¨å¤šç§å±å¹•è®¾å¤‡ä¸Šå·¥ä½œçš„ã€‚ è¶…å°å±å¹• æ‰‹æœº (&lt;768px) å°å±å¹• å¹³æ¿ (â‰¥768px) ä¸­ç­‰å±å¹• æ¡Œé¢æ˜¾ç¤ºå™¨ (â‰¥992px) å¤§å±å¹• å¤§æ¡Œé¢æ˜¾ç¤ºå™¨ (â‰¥1200px) æ …æ ¼ç³»ç»Ÿè¡Œä¸º æ€»æ˜¯æ°´å¹³æ’åˆ— å¼€å§‹æ˜¯å †å åœ¨ä¸€èµ·çš„ï¼Œå½“å¤§äºè¿™äº›é˜ˆå€¼æ—¶å°†å˜ä¸ºæ°´å¹³æ’åˆ—C åŒå·¦ åŒå·¦ .container æœ€å¤§å®½åº¦ None ï¼ˆè‡ªåŠ¨ï¼‰ 750px 970px 1170px ç±»å‰ç¼€ .col-xs- .col-sm- .col-md- .col-lg- åˆ—ï¼ˆcolumnï¼‰æ•° 12 12 12 12 æœ€å¤§åˆ—ï¼ˆcolumnï¼‰å®½ è‡ªåŠ¨ ~62px ~81px ~97px æ§½ï¼ˆgutterï¼‰å®½ 30px ï¼ˆæ¯åˆ—å·¦å³å‡æœ‰ 15pxï¼‰ åŒå·¦ åŒå·¦ åŒå·¦ å¯åµŒå¥— æ˜¯ æ˜¯ æ˜¯ æ˜¯ åç§»ï¼ˆOffsetsï¼‰ æ˜¯ æ˜¯ æ˜¯ æ˜¯ åˆ—æ’åº æ˜¯ æ˜¯ æ˜¯ æ˜¯ å®ä¾‹ï¼šä»å †å åˆ°æ°´å¹³æ’åˆ—ä½¿ç”¨å•ä¸€çš„ä¸€ç»„ .col-md-* æ …æ ¼ç±»ï¼Œå°±å¯ä»¥åˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„æ …æ ¼ç³»ç»Ÿï¼Œåœ¨æ‰‹æœºå’Œå¹³æ¿è®¾å¤‡ä¸Šä¸€å¼€å§‹æ˜¯å †å åœ¨ä¸€èµ·çš„ï¼ˆè¶…å°å±å¹•åˆ°å°å±å¹•è¿™ä¸€èŒƒå›´ï¼‰ï¼Œåœ¨æ¡Œé¢ï¼ˆä¸­ç­‰ï¼‰å±å¹•è®¾å¤‡ä¸Šå˜ä¸ºæ°´å¹³æ’åˆ—ã€‚æ‰€æœ‰â€œåˆ—ï¼ˆcolumnï¼‰å¿…é¡»æ”¾åœ¨ â€ .row å†…ã€‚ 123456789101112131415161718192021222324252627&lt;div class=\"row\"&gt; &lt;div class=\"col-md-1\"&gt;.col-md-1&lt;/div&gt; &lt;div class=\"col-md-1\"&gt;.col-md-1&lt;/div&gt; &lt;div class=\"col-md-1\"&gt;.col-md-1&lt;/div&gt; &lt;div class=\"col-md-1\"&gt;.col-md-1&lt;/div&gt; &lt;div class=\"col-md-1\"&gt;.col-md-1&lt;/div&gt; &lt;div class=\"col-md-1\"&gt;.col-md-1&lt;/div&gt; &lt;div class=\"col-md-1\"&gt;.col-md-1&lt;/div&gt; &lt;div class=\"col-md-1\"&gt;.col-md-1&lt;/div&gt; &lt;div class=\"col-md-1\"&gt;.col-md-1&lt;/div&gt; &lt;div class=\"col-md-1\"&gt;.col-md-1&lt;/div&gt; &lt;div class=\"col-md-1\"&gt;.col-md-1&lt;/div&gt; &lt;div class=\"col-md-1\"&gt;.col-md-1&lt;/div&gt;&lt;/div&gt;&lt;div class=\"row\"&gt; &lt;div class=\"col-md-8\"&gt;.col-md-8&lt;/div&gt; &lt;div class=\"col-md-4\"&gt;.col-md-4&lt;/div&gt;&lt;/div&gt;&lt;div class=\"row\"&gt; &lt;div class=\"col-md-4\"&gt;.col-md-4&lt;/div&gt; &lt;div class=\"col-md-4\"&gt;.col-md-4&lt;/div&gt; &lt;div class=\"col-md-4\"&gt;.col-md-4&lt;/div&gt;&lt;/div&gt;&lt;div class=\"row\"&gt; &lt;div class=\"col-md-6\"&gt;.col-md-6&lt;/div&gt; &lt;div class=\"col-md-6\"&gt;.col-md-6&lt;/div&gt;&lt;/div&gt; å®ä¾‹ï¼šç§»åŠ¨è®¾å¤‡å’Œæ¡Œé¢å±å¹•æ˜¯å¦ä¸å¸Œæœ›åœ¨å°å±å¹•è®¾å¤‡ä¸Šæ‰€æœ‰åˆ—éƒ½å †å åœ¨ä¸€èµ·ï¼Ÿé‚£å°±ä½¿ç”¨é’ˆå¯¹è¶…å°å±å¹•å’Œä¸­ç­‰å±å¹•è®¾å¤‡æ‰€å®šä¹‰çš„ç±»å§ï¼Œå³ .col-xs-*å’Œ .col-md-*ã€‚è¯·çœ‹ä¸‹é¢çš„å®ä¾‹ï¼Œç ”ç©¶ä¸€ä¸‹è¿™äº›æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚ 123456789101112131415161718&lt;!-- Stack the columns on mobile by making one full-width and the other half-width --&gt;&lt;div class=\"row\"&gt; &lt;div class=\"col-xs-12 col-md-8\"&gt;.col-xs-12 .col-md-8&lt;/div&gt; &lt;div class=\"col-xs-6 col-md-4\"&gt;.col-xs-6 .col-md-4&lt;/div&gt;&lt;/div&gt;&lt;!-- Columns start at 50% wide on mobile and bump up to 33.3% wide on desktop --&gt;&lt;div class=\"row\"&gt; &lt;div class=\"col-xs-6 col-md-4\"&gt;.col-xs-6 .col-md-4&lt;/div&gt; &lt;div class=\"col-xs-6 col-md-4\"&gt;.col-xs-6 .col-md-4&lt;/div&gt; &lt;div class=\"col-xs-6 col-md-4\"&gt;.col-xs-6 .col-md-4&lt;/div&gt;&lt;/div&gt;&lt;!-- Columns are always 50% wide, on mobile and desktop --&gt;&lt;div class=\"row\"&gt; &lt;div class=\"col-xs-6\"&gt;.col-xs-6&lt;/div&gt; &lt;div class=\"col-xs-6\"&gt;.col-xs-6&lt;/div&gt;&lt;/div&gt; æ’ç‰ˆæ ‡é¢˜HTML ä¸­çš„æ‰€æœ‰æ ‡é¢˜æ ‡ç­¾ï¼Œåˆ° å‡å¯ä½¿ç”¨ã€‚å¦å¤–ï¼Œè¿˜æä¾›äº† .h1 åˆ° .h6 ç±»ï¼Œä¸ºçš„æ˜¯ç»™å†…è”ï¼ˆinlineï¼‰å±æ€§çš„æ–‡æœ¬èµ‹äºˆæ ‡é¢˜çš„æ ·å¼ 123456&lt;h1&gt;h1. Bootstrap heading&lt;/h1&gt;&lt;h2&gt;h2. Bootstrap heading&lt;/h2&gt;&lt;h3&gt;h3. Bootstrap heading&lt;/h3&gt;&lt;h4&gt;h4. Bootstrap heading&lt;/h4&gt;&lt;h5&gt;h5. Bootstrap heading&lt;/h5&gt;&lt;h6&gt;h6. Bootstrap heading&lt;/h6&gt; åœ¨æ ‡é¢˜å†…è¿˜å¯ä»¥åŒ…å« &lt;small&gt; æ ‡ç­¾æˆ–èµ‹äºˆ .small ç±»çš„å…ƒç´ ï¼Œå¯ä»¥ç”¨æ¥æ ‡è®°å‰¯æ ‡é¢˜ã€‚ 123456&lt;h1&gt;h1. Bootstrap heading &lt;small&gt;Secondary text&lt;/small&gt;&lt;/h1&gt;&lt;h2&gt;h2. Bootstrap heading &lt;small&gt;Secondary text&lt;/small&gt;&lt;/h2&gt;&lt;h3&gt;h3. Bootstrap heading &lt;small&gt;Secondary text&lt;/small&gt;&lt;/h3&gt;&lt;h4&gt;h4. Bootstrap heading &lt;small&gt;Secondary text&lt;/small&gt;&lt;/h4&gt;&lt;h5&gt;h5. Bootstrap heading &lt;small&gt;Secondary text&lt;/small&gt;&lt;/h5&gt;&lt;h6&gt;h6. Bootstrap heading &lt;small&gt;Secondary text&lt;/small&gt;&lt;/h6&gt; é¡µé¢ä¸»ä½“Bootstrap å°†å…¨å±€ font-size è®¾ç½®ä¸º 14pxï¼Œline-height è®¾ç½®ä¸º 1.428ã€‚è¿™äº›å±æ€§ç›´æ¥èµ‹äºˆ å…ƒç´ å’Œæ‰€æœ‰æ®µè½å…ƒç´ ã€‚å¦å¤–ï¼Œ ï¼ˆæ®µè½ï¼‰å…ƒç´ è¿˜è¢«è®¾ç½®äº†ç­‰äº 1/2 è¡Œé«˜ï¼ˆå³ 10pxï¼‰çš„åº•éƒ¨å¤–è¾¹è·ï¼ˆmarginï¼‰ã€‚ ä¸­å¿ƒå†…å®¹é€šè¿‡æ·»åŠ  .lead ç±»å¯ä»¥è®©æ®µè½çªå‡ºæ˜¾ç¤ºã€‚ 1&lt;p class=\"lead\"&gt;...&lt;/p&gt; ä½¿ç”¨ Less å·¥å…·æ„å»ºvariables.less æ–‡ä»¶ä¸­å®šä¹‰çš„ä¸¤ä¸ª Less å˜é‡å†³å®šäº†æ’ç‰ˆå°ºå¯¸ï¼š@font-size-base å’Œ @line-height-baseã€‚ç¬¬ä¸€ä¸ªå˜é‡å®šä¹‰äº†å…¨å±€ font-size åŸºå‡†ï¼Œç¬¬äºŒä¸ªå˜é‡æ˜¯ line-height åŸºå‡†ã€‚æˆ‘ä»¬ä½¿ç”¨è¿™äº›å˜é‡å’Œä¸€äº›ç®€å•çš„å…¬å¼è®¡ç®—å‡ºå…¶å®ƒæ‰€æœ‰é¡µé¢å…ƒç´ çš„ marginã€ padding å’Œ line-heightã€‚è‡ªå®šä¹‰è¿™äº›å˜é‡å³å¯æ”¹å˜ Bootstrap çš„é»˜è®¤æ ·å¼ å†…è”æ–‡æœ¬å…ƒç´ æ ‡è®°æ–‡æœ¬ä¸ºäº†é«˜äº®æ–‡æœ¬ï¼Œå¯ä»¥ä½¿ç”¨ &lt;mark&gt; æ ‡ç­¾ 1You can use the mark tag to &lt;mark&gt;highlight&lt;/mark&gt; text. è¢«åˆ é™¤çš„æ–‡æœ¬å¯¹äºè¢«åˆ é™¤çš„æ–‡æœ¬ï¼Œå¯ä»¥ä½¿ç”¨ &lt;del&gt; æ ‡ç­¾ã€‚ 1&lt;del&gt;This line of text is meant to be treated as deleted text.&lt;/del&gt; æ— ç”¨æ–‡æœ¬å¯¹äºæ— ç”¨æ–‡æœ¬å¯ä»¥ä½¿ç”¨ &lt;s&gt; æ ‡ç­¾ã€‚ 1&lt;s&gt;This line of text is meant to be treated as no longer accurate.&lt;/s&gt; æ’å…¥æ–‡æœ¬è€Œå¤–æ’å…¥æ–‡æœ¬ä½¿ç”¨ &lt;ins&gt; æ ‡ç­¾ 1&lt;ins&gt;This line of text is meant to be treated as an addition to the document.&lt;/ins&gt; å¸¦ä¸‹åˆ’çº¿çš„æ–‡æœ¬ä¸ºæ–‡æœ¬æ·»åŠ ä¸‹åˆ’çº¿ï¼Œä½¿ç”¨ &lt;u&gt; æ ‡ç­¾ã€‚ 1&lt;u&gt;This line of text will render as underlined&lt;/u&gt; å°å·æ–‡æœ¬ä½¿ç”¨æ ‡ç­¾ &lt;small&gt; ç€é‡å¼ºè°ƒä½¿ç”¨æ ‡ç­¾ &lt;strong&gt; æ ‡ç­¾ æ–œä½“ä½¿ç”¨ &lt;em&gt; æ ‡ç­¾ æ–‡æœ¬å¯¹é½ 12345&lt;p class=\"text-left\"&gt;Left aligned text.&lt;/p&gt;&lt;p class=\"text-center\"&gt;Center aligned text.&lt;/p&gt;&lt;p class=\"text-right\"&gt;Right aligned text.&lt;/p&gt;&lt;p class=\"text-justify\"&gt;Justified text.&lt;/p&gt;&lt;p class=\"text-nowrap\"&gt;No wrap text.&lt;/p&gt; æ”¹å˜å¤§å°å†™ 123&lt;p class=\"text-lowercase\"&gt;Lowercased text.&lt;/p&gt;&lt;p class=\"text-uppercase\"&gt;Uppercased text.&lt;/p&gt;&lt;p class=\"text-capitalize\"&gt;Capitalized text.&lt;/p&gt; å¼•ç”¨åœ¨ä½ çš„æ–‡æ¡£ä¸­å¼•ç”¨å…¶ä»–çš„æ¥æºï¼Œå¯ä»¥ä½¿ç”¨ &lt;blockquote&gt; æ¥è¡¨ç¤ºå¼•ç”¨æ ·å¼ã€‚å¯¹äºç›´æ¥å¼•ç”¨ï¼Œå»ºè®®ä½¿ç”¨ &lt;p&gt; æ ‡ç­¾ã€‚ 123&lt;blockquote&gt; &lt;p&gt;Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer posuere erat a ante.&lt;/p&gt;&lt;/blockquote&gt; åˆ—è¡¨æ— åºåˆ—è¡¨æ’åˆ—é¡ºåºæ— å…³ç´§è¦çš„ä¸€åˆ—å…ƒç´ ã€‚ 123&lt;ul&gt; &lt;li&gt;...&lt;/li&gt;&lt;/ul&gt; æœ‰åºåˆ—è¡¨é¡ºåºè‡³å…³é‡è¦çš„ä¸€ç»„å…ƒç´  123&lt;ol&gt; &lt;li&gt;...&lt;/li&gt;&lt;/ol&gt; ä»£ç å†…è”ä»£ç 1For example, &lt;code&gt;&amp;lt;section&amp;gt;&lt;/code&gt; should be wrapped as inline. ç”¨æˆ·è¾“å…¥é€šè¿‡ kbd æ ‡ç­¾æ ‡è®°ç”¨æˆ·é€šè¿‡é”®ç›˜è¾“å…¥çš„å†…å®¹ã€‚ 12To switch directories, type &lt;kbd&gt;cd&lt;/kbd&gt; followed by the name of the directory.&lt;br&gt;To edit settings, press &lt;kbd&gt;&lt;kbd&gt;ctrl&lt;/kbd&gt; + &lt;kbd&gt;,&lt;/kbd&gt;&lt;/kbd&gt; ä»£ç å—å¤šè¡Œä»£ç å¯ä»¥ä½¿ç”¨ &lt;pre&gt; æ ‡ç­¾ã€‚ä¸ºäº†æ­£ç¡®çš„å±•ç¤ºä»£ç ï¼Œæ³¨æ„å°†å°–æ‹¬å·åšè½¬ä¹‰å¤„ç†ã€‚ å˜é‡é€šè¿‡ &lt;var&gt; æ ‡ç­¾æ ‡è®°å˜é‡ ç¨‹åºè¾“å‡ºé€šè¿‡ &lt;samp&gt; æ ‡ç­¾æ¥æ ‡è®°ç¨‹åºè¾“å‡ºçš„å†…å®¹ æœŸå¾…åé¢çš„æ–‡ç« ï¼","tags":[{"name":"Bootstrap","slug":"Bootstrap","permalink":"http://www.54tianzhisheng.cn/tags/Bootstrap/"},{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"http://www.54tianzhisheng.cn/tags/å‰ç«¯/"}]},{"title":"Bootstrapå…¥é—¨éœ€æŒæ¡çš„çŸ¥è¯†ç‚¹ï¼ˆäºŒï¼‰","date":"2017-06-17T16:00:00.000Z","path":"2017/06/18/Bootstrapå…¥é—¨éœ€æŒæ¡çš„çŸ¥è¯†ç‚¹ï¼ˆäºŒï¼‰/","text":"ç›¸å…³é˜…è¯»ï¼šBootstrapå…¥é—¨éœ€æŒæ¡çš„çŸ¥è¯†ç‚¹ï¼ˆä¸€ï¼‰è¡¨æ ¼åŸºæœ¬å®ä¾‹ä¸ºä»»æ„ &lt;table&gt; æ ‡ç­¾æ·»åŠ  .table ç±»å¯ä»¥ä¸ºå…¶èµ‹äºˆåŸºæœ¬çš„æ ·å¼ â€” å°‘é‡çš„å†…è¡¥ï¼ˆpaddingï¼‰å’Œæ°´å¹³æ–¹å‘çš„åˆ†éš”çº¿ã€‚ 123&lt;table class=&quot;table&quot;&gt; ...&lt;/table&gt; æ¡çº¹çŠ¶è¡¨æ ¼é€šè¿‡ .table-striped ç±»å¯ä»¥ç»™ &lt;tbody&gt; ä¹‹å†…çš„æ¯ä¸€è¡Œå¢åŠ æ–‘é©¬æ¡çº¹æ ·å¼ã€‚ 123&lt;table class=\"table table-striped\"&gt; ...&lt;/table&gt; å¸¦è¾¹æ¡†çš„è¡¨æ ¼æ·»åŠ  .table-bordered ç±»ä¸ºè¡¨æ ¼å’Œå…¶ä¸­çš„æ¯ä¸ªå•å…ƒæ ¼å¢åŠ è¾¹æ¡†ã€‚ 123&lt;table class=\"table table-bordered\"&gt; ...&lt;/table&gt; é¼ æ ‡æ‚¬åœé€šè¿‡æ·»åŠ  .table-hover ç±»å¯ä»¥è®© ä¸­çš„æ¯ä¸€è¡Œå¯¹é¼ æ ‡æ‚¬åœçŠ¶æ€ä½œå‡ºå“åº”ã€‚ 123&lt;table class=\"table table-hover\"&gt; ...&lt;/table&gt; çŠ¶æ€ç±»é€šè¿‡è¿™äº›çŠ¶æ€ç±»å¯ä»¥ä¸ºè¡Œæˆ–å•å…ƒæ ¼è®¾ç½®é¢œè‰²ã€‚ Class æè¿° .active é¼ æ ‡æ‚¬åœåœ¨è¡Œæˆ–å•å…ƒæ ¼ä¸Šæ—¶æ‰€è®¾ç½®çš„é¢œè‰² .success æ ‡è¯†æˆåŠŸæˆ–ç§¯æçš„åŠ¨ä½œ .info æ ‡è¯†æ™®é€šçš„æç¤ºä¿¡æ¯æˆ–åŠ¨ä½œ .warning æ ‡è¯†è­¦å‘Šæˆ–éœ€è¦ç”¨æˆ·æ³¨æ„ .danger æ ‡è¯†å±é™©æˆ–æ½œåœ¨çš„å¸¦æ¥è´Ÿé¢å½±å“çš„åŠ¨ä½œ 123456789101112131415&lt;!-- On rows --&gt;&lt;tr class=\"active\"&gt;...&lt;/tr&gt;&lt;tr class=\"success\"&gt;...&lt;/tr&gt;&lt;tr class=\"warning\"&gt;...&lt;/tr&gt;&lt;tr class=\"danger\"&gt;...&lt;/tr&gt;&lt;tr class=\"info\"&gt;...&lt;/tr&gt;&lt;!-- On cells (`td` or `th`) --&gt;&lt;tr&gt; &lt;td class=\"active\"&gt;...&lt;/td&gt; &lt;td class=\"success\"&gt;...&lt;/td&gt; &lt;td class=\"warning\"&gt;...&lt;/td&gt; &lt;td class=\"danger\"&gt;...&lt;/td&gt; &lt;td class=\"info\"&gt;...&lt;/td&gt;&lt;/tr&gt; å“åº”å¼è¡¨æ ¼å°†ä»»ä½• .table å…ƒç´ åŒ…è£¹åœ¨ .table-responsive å…ƒç´ å†…ï¼Œå³å¯åˆ›å»ºå“åº”å¼è¡¨æ ¼ï¼Œå…¶ä¼šåœ¨å°å±å¹•è®¾å¤‡ä¸Šï¼ˆå°äº768pxï¼‰æ°´å¹³æ»šåŠ¨ã€‚å½“å±å¹•å¤§äº 768px å®½åº¦æ—¶ï¼Œæ°´å¹³æ»šåŠ¨æ¡æ¶ˆå¤±ã€‚ 12345&lt;div class=\"table-responsive\"&gt; &lt;table class=\"table\"&gt; ... &lt;/table&gt;&lt;/div&gt; è¡¨å•åŸºæœ¬å®ä¾‹å•ç‹¬çš„è¡¨å•æ§ä»¶ä¼šè¢«è‡ªåŠ¨èµ‹äºˆä¸€äº›å…¨å±€æ ·å¼ã€‚æ‰€æœ‰è®¾ç½®äº† .form-control ç±»çš„ &lt;input&gt;ã€&lt;textarea&gt; å’Œ &lt;select&gt; å…ƒç´ éƒ½å°†è¢«é»˜è®¤è®¾ç½®å®½åº¦å±æ€§ä¸º width: 100%;ã€‚ å°† label å…ƒç´ å’Œå‰é¢æåˆ°çš„æ§ä»¶åŒ…è£¹åœ¨ .form-group ä¸­å¯ä»¥è·å¾—æœ€å¥½çš„æ’åˆ—ã€‚ 123456789101112131415161718192021&lt;form role=\"form\"&gt; &lt;div class=\"form-group\"&gt; &lt;label for=\"exampleInputEmail1\"&gt;Email address&lt;/label&gt; &lt;input type=\"email\" class=\"form-control\" id=\"exampleInputEmail1\" placeholder=\"Enter email\"&gt; &lt;/div&gt; &lt;div class=\"form-group\"&gt; &lt;label for=\"exampleInputPassword1\"&gt;Password&lt;/label&gt; &lt;input type=\"password\" class=\"form-control\" id=\"exampleInputPassword1\" placeholder=\"Password\"&gt; &lt;/div&gt; &lt;div class=\"form-group\"&gt; &lt;label for=\"exampleInputFile\"&gt;File input&lt;/label&gt; &lt;input type=\"file\" id=\"exampleInputFile\"&gt; &lt;p class=\"help-block\"&gt;Example block-level help text here.&lt;/p&gt; &lt;/div&gt; &lt;div class=\"checkbox\"&gt; &lt;label&gt; &lt;input type=\"checkbox\"&gt; Check me out &lt;/label&gt; &lt;/div&gt; &lt;button type=\"submit\" class=\"btn btn-default\"&gt;Submit&lt;/button&gt;&lt;/form&gt; æ³¨æ„ï¼šä¸è¦å°†è¡¨å•ç»„ç›´æ¥å’Œè¾“å…¥æ¡†ç»„æ··åˆä½¿ç”¨ï¼Œå»ºè®®å°†è¾“å…¥æ¡†ç»„åµŒå¥—åˆ°è¡¨å•ç»„ä¸­ä½¿ç”¨ã€‚ å†…è”è¡¨å•ä¸º &lt;form&gt; å…ƒç´ æ·»åŠ  .form-inline ç±»å¯ä½¿å…¶å†…å®¹å·¦å¯¹é½å¹¶ä¸”è¡¨ç°ä¸º inline-block çº§åˆ«çš„æ§ä»¶ã€‚åªé€‚ç”¨äºè§†å£ï¼ˆviewportï¼‰è‡³å°‘åœ¨ 768px å®½åº¦æ—¶ï¼ˆè§†å£å®½åº¦å†å°çš„è¯å°±ä¼šä½¿è¡¨å•æŠ˜å ï¼‰ã€‚ æ³¨æ„ï¼š éœ€è¦æ‰‹åŠ¨è®¾ç½®å®½åº¦åœ¨ Bootstrap ä¸­ï¼Œè¾“å…¥æ¡†å’Œå•é€‰/å¤šé€‰æ¡†æ§ä»¶é»˜è®¤è¢«è®¾ç½®ä¸º width: 100%; å®½åº¦ã€‚åœ¨å†…è”è¡¨å•ï¼Œæˆ‘ä»¬å°†è¿™äº›å…ƒç´ çš„å®½åº¦è®¾ç½®ä¸º width: auto;ï¼Œå› æ­¤ï¼Œå¤šä¸ªæ§ä»¶å¯ä»¥æ’åˆ—åœ¨åŒä¸€è¡Œã€‚æ ¹æ®ä½ çš„å¸ƒå±€éœ€æ±‚ï¼Œå¯èƒ½éœ€è¦ä¸€äº›é¢å¤–çš„å®šåˆ¶åŒ–ç»„ä»¶ã€‚ ä¸€å®šè¦æ·»åŠ  label æ ‡ç­¾å¦‚æœä½ æ²¡æœ‰ä¸ºæ¯ä¸ªè¾“å…¥æ§ä»¶è®¾ç½® label æ ‡ç­¾ï¼Œå±å¹•é˜…è¯»å™¨å°†æ— æ³•æ­£ç¡®è¯†åˆ«ã€‚å¯¹äºè¿™äº›å†…è”è¡¨å•ï¼Œä½ å¯ä»¥é€šè¿‡ä¸ºlabel è®¾ç½® .sr-only ç±»å°†å…¶éšè—ã€‚ 12345678910111213141516171819202122&lt;form class=\"form-inline\" role=\"form\"&gt; &lt;div class=\"form-group\"&gt; &lt;label class=\"sr-only\" for=\"exampleInputEmail2\"&gt;Email address&lt;/label&gt; &lt;input type=\"email\" class=\"form-control\" id=\"exampleInputEmail2\" placeholder=\"Enter email\"&gt; &lt;/div&gt; &lt;div class=\"form-group\"&gt; &lt;div class=\"input-group\"&gt; &lt;div class=\"input-group-addon\"&gt;@&lt;/div&gt; &lt;input class=\"form-control\" type=\"email\" placeholder=\"Enter email\"&gt; &lt;/div&gt; &lt;/div&gt; &lt;div class=\"form-group\"&gt; &lt;label class=\"sr-only\" for=\"exampleInputPassword2\"&gt;Password&lt;/label&gt; &lt;input type=\"password\" class=\"form-control\" id=\"exampleInputPassword2\" placeholder=\"Password\"&gt; &lt;/div&gt; &lt;div class=\"checkbox\"&gt; &lt;label&gt; &lt;input type=\"checkbox\"&gt; Remember me &lt;/label&gt; &lt;/div&gt; &lt;button type=\"submit\" class=\"btn btn-default\"&gt;Sign in&lt;/button&gt;&lt;/form&gt; æ°´å¹³æ’åˆ—çš„è¡¨å•é€šè¿‡ä¸ºè¡¨å•æ·»åŠ  .form-horizontal ç±»ï¼Œå¹¶è”åˆä½¿ç”¨ Bootstrap é¢„ç½®çš„æ …æ ¼ç±»ï¼Œå¯ä»¥å°† label æ ‡ç­¾å’Œæ§ä»¶ç»„æ°´å¹³å¹¶æ’å¸ƒå±€ã€‚è¿™æ ·åšå°†æ”¹å˜ .form-group çš„è¡Œä¸ºï¼Œä½¿å…¶è¡¨ç°ä¸ºæ …æ ¼ç³»ç»Ÿä¸­çš„è¡Œï¼ˆrowï¼‰ï¼Œå› æ­¤å°±æ— éœ€å†é¢å¤–æ·»åŠ  .row äº†ã€‚ 12345678910111213141516171819202122232425262728&lt;form class=\"form-horizontal\" role=\"form\"&gt; &lt;div class=\"form-group\"&gt; &lt;label for=\"inputEmail3\" class=\"col-sm-2 control-label\"&gt;Email&lt;/label&gt; &lt;div class=\"col-sm-10\"&gt; &lt;input type=\"email\" class=\"form-control\" id=\"inputEmail3\" placeholder=\"Email\"&gt; &lt;/div&gt; &lt;/div&gt; &lt;div class=\"form-group\"&gt; &lt;label for=\"inputPassword3\" class=\"col-sm-2 control-label\"&gt;Password&lt;/label&gt; &lt;div class=\"col-sm-10\"&gt; &lt;input type=\"password\" class=\"form-control\" id=\"inputPassword3\" placeholder=\"Password\"&gt; &lt;/div&gt; &lt;/div&gt; &lt;div class=\"form-group\"&gt; &lt;div class=\"col-sm-offset-2 col-sm-10\"&gt; &lt;div class=\"checkbox\"&gt; &lt;label&gt; &lt;input type=\"checkbox\"&gt; Remember me &lt;/label&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;div class=\"form-group\"&gt; &lt;div class=\"col-sm-offset-2 col-sm-10\"&gt; &lt;button type=\"submit\" class=\"btn btn-default\"&gt;Sign in&lt;/button&gt; &lt;/div&gt; &lt;/div&gt;&lt;/form&gt; è¢«æ”¯æŒçš„æ§ä»¶è¡¨å•å¸ƒå±€å®ä¾‹ä¸­å±•ç¤ºäº†å…¶æ‰€æ”¯æŒçš„æ ‡å‡†è¡¨å•æ§ä»¶ã€‚ 1ã€è¾“å…¥æ¡†åŒ…æ‹¬å¤§éƒ¨åˆ†è¡¨å•æ§ä»¶ã€æ–‡æœ¬è¾“å…¥åŸŸæ§ä»¶ï¼Œè¿˜æ”¯æŒæ‰€æœ‰ HTML5 ç±»å‹çš„è¾“å…¥æ§ä»¶ï¼štextã€passwordã€datetimeã€datetime-localã€dateã€monthã€timeã€weekã€numberã€emailã€urlã€searchã€tel å’Œ colorã€‚ 1&lt;input type=\"text\" class=\"form-control\" placeholder=\"Text input\"&gt; å¦‚éœ€åœ¨æ–‡æœ¬è¾“å…¥åŸŸ &lt;input&gt; å‰é¢æˆ–åé¢æ·»åŠ æ–‡æœ¬å†…å®¹æˆ–æŒ‰é’®æ§ä»¶ï¼Œè¯·å‚è€ƒè¾“å…¥æ§ä»¶ç»„ã€‚ 2ã€æ–‡æœ¬åŸŸæ”¯æŒå¤šè¡Œæ–‡æœ¬çš„è¡¨å•æ§ä»¶ã€‚å¯æ ¹æ®éœ€è¦æ”¹å˜ rows å±æ€§ã€‚ 1&lt;textarea class=\"form-control\" rows=\"3\"&gt;&lt;/textarea&gt; 3ã€å¤šé€‰å’Œå•é€‰æ¡†å¤šé€‰æ¡†ï¼ˆcheckboxï¼‰ç”¨äºé€‰æ‹©åˆ—è¡¨ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªé€‰é¡¹ï¼Œè€Œå•é€‰æ¡†ï¼ˆradioï¼‰ç”¨äºä»å¤šä¸ªé€‰é¡¹ä¸­åªé€‰æ‹©ä¸€ä¸ªã€‚ è®¾ç½®äº† disabled å±æ€§çš„å•é€‰æˆ–å¤šé€‰æ¡†éƒ½èƒ½è¢«èµ‹äºˆåˆé€‚çš„æ ·å¼ã€‚å¯¹äºå’Œå¤šé€‰æˆ–å•é€‰æ¡†è”åˆä½¿ç”¨çš„ &lt;label&gt; æ ‡ç­¾ï¼Œå¦‚æœä¹Ÿå¸Œæœ›å°†æ‚¬åœäºä¸Šæ–¹çš„é¼ æ ‡è®¾ç½®ä¸ºâ€œç¦æ­¢ç‚¹å‡»â€çš„æ ·å¼ï¼Œè¯·å°† .disabled ç±»èµ‹äºˆ .radioã€.radio-inlineã€.checkbox ã€.checkbox-inline æˆ– &lt;fieldset&gt;ã€‚ 12345678910111213141516171819202122232425262728293031&lt;div class=\"checkbox\"&gt; &lt;label&gt; &lt;input type=\"checkbox\" value=\"\"&gt; Option one is this and that&amp;mdash;be sure to include why it's great &lt;/label&gt;&lt;/div&gt;&lt;div class=\"checkbox disabled\"&gt; &lt;label&gt; &lt;input type=\"checkbox\" value=\"\" disabled&gt; Option two is disabled &lt;/label&gt;&lt;/div&gt;&lt;div class=\"radio\"&gt; &lt;label&gt; &lt;input type=\"radio\" name=\"optionsRadios\" id=\"optionsRadios1\" value=\"option1\" checked&gt; Option one is this and that&amp;mdash;be sure to include why it's great &lt;/label&gt;&lt;/div&gt;&lt;div class=\"radio\"&gt; &lt;label&gt; &lt;input type=\"radio\" name=\"optionsRadios\" id=\"optionsRadios2\" value=\"option2\"&gt; Option two can be something else and selecting it will deselect option one &lt;/label&gt;&lt;/div&gt;&lt;div class=\"radio disabled\"&gt; &lt;label&gt; &lt;input type=\"radio\" name=\"optionsRadios\" id=\"optionsRadios3\" value=\"option3\" disabled&gt; Option three is disabled &lt;/label&gt;&lt;/div&gt; å†…è”å•é€‰å’Œå¤šé€‰æ¡†é€šè¿‡å°† .checkbox-inline æˆ– .radio-inline ç±»åº”ç”¨åˆ°ä¸€ç³»åˆ—çš„å¤šé€‰æ¡†ï¼ˆcheckboxï¼‰æˆ–å•é€‰æ¡†ï¼ˆradioï¼‰æ§ä»¶ä¸Šï¼Œå¯ä»¥ä½¿è¿™äº›æ§ä»¶æ’åˆ—åœ¨ä¸€è¡Œã€‚ 12345678910111213141516171819&lt;label class=\"checkbox-inline\"&gt; &lt;input type=\"checkbox\" id=\"inlineCheckbox1\" value=\"option1\"&gt; 1&lt;/label&gt;&lt;label class=\"checkbox-inline\"&gt; &lt;input type=\"checkbox\" id=\"inlineCheckbox2\" value=\"option2\"&gt; 2&lt;/label&gt;&lt;label class=\"checkbox-inline\"&gt; &lt;input type=\"checkbox\" id=\"inlineCheckbox3\" value=\"option3\"&gt; 3&lt;/label&gt;&lt;label class=\"radio-inline\"&gt; &lt;input type=\"radio\" name=\"inlineRadioOptions\" id=\"inlineRadio1\" value=\"option1\"&gt; 1&lt;/label&gt;&lt;label class=\"radio-inline\"&gt; &lt;input type=\"radio\" name=\"inlineRadioOptions\" id=\"inlineRadio2\" value=\"option2\"&gt; 2&lt;/label&gt;&lt;label class=\"radio-inline\"&gt; &lt;input type=\"radio\" name=\"inlineRadioOptions\" id=\"inlineRadio3\" value=\"option3\"&gt; 3&lt;/label&gt; å¤é€‰æ¡† 12345678910&lt;div class=\"checkbox\"&gt; &lt;label&gt; &lt;input type=\"checkbox\" id=\"blankCheckbox\" value=\"option1\"&gt; &lt;/label&gt;&lt;/div&gt;&lt;div class=\"radio\"&gt; &lt;label&gt; &lt;input type=\"radio\" name=\"blankRadio\" id=\"blankRadio1\" value=\"option1\"&gt; &lt;/label&gt;&lt;/div&gt; ä¸‹æ‹‰åˆ—è¡¨ï¼ˆselectï¼‰ä½¿ç”¨é»˜è®¤é€‰é¡¹æˆ–æ·»åŠ  multiple å±æ€§å¯ä»¥åŒæ—¶æ˜¾ç¤ºå¤šä¸ªé€‰é¡¹ã€‚ 123456789101112131415&lt;select class=\"form-control\"&gt; &lt;option&gt;1&lt;/option&gt; &lt;option&gt;2&lt;/option&gt; &lt;option&gt;3&lt;/option&gt; &lt;option&gt;4&lt;/option&gt; &lt;option&gt;5&lt;/option&gt;&lt;/select&gt;&lt;select multiple class=\"form-control\"&gt; &lt;option&gt;1&lt;/option&gt; &lt;option&gt;2&lt;/option&gt; &lt;option&gt;3&lt;/option&gt; &lt;option&gt;4&lt;/option&gt; &lt;option&gt;5&lt;/option&gt;&lt;/select&gt; é™æ€æ§ä»¶å¦‚æœéœ€è¦åœ¨è¡¨å•ä¸­å°†ä¸€è¡Œçº¯æ–‡æœ¬å’Œ label å…ƒç´ æ”¾ç½®äºåŒä¸€è¡Œï¼Œä¸º &lt;p&gt; å…ƒç´ æ·»åŠ  .form-control-static ç±»å³å¯ã€‚ 1234567891011121314&lt;form class=\"form-horizontal\" role=\"form\"&gt; &lt;div class=\"form-group\"&gt; &lt;label class=\"col-sm-2 control-label\"&gt;Email&lt;/label&gt; &lt;div class=\"col-sm-10\"&gt; &lt;p class=\"form-control-static\"&gt;email@example.com&lt;/p&gt; &lt;/div&gt; &lt;/div&gt; &lt;div class=\"form-group\"&gt; &lt;label for=\"inputPassword\" class=\"col-sm-2 control-label\"&gt;Password&lt;/label&gt; &lt;div class=\"col-sm-10\"&gt; &lt;input type=\"password\" class=\"form-control\" id=\"inputPassword\" placeholder=\"Password\"&gt; &lt;/div&gt; &lt;/div&gt;&lt;/form&gt; 1234567891011&lt;form class=\"form-inline\" role=\"form\"&gt; &lt;div class=\"form-group\"&gt; &lt;label class=\"sr-only\"&gt;Email&lt;/label&gt; &lt;p class=\"form-control-static\"&gt;email@example.com&lt;/p&gt; &lt;/div&gt; &lt;div class=\"form-group\"&gt; &lt;label for=\"inputPassword2\" class=\"sr-only\"&gt;Password&lt;/label&gt; &lt;input type=\"password\" class=\"form-control\" id=\"inputPassword2\" placeholder=\"Password\"&gt; &lt;/div&gt; &lt;button type=\"submit\" class=\"btn btn-default\"&gt;Confirm identity&lt;/button&gt;&lt;/form&gt; è¾“å…¥æ¡†ç„¦ç‚¹æˆ‘ä»¬å°†æŸäº›è¡¨å•æ§ä»¶çš„é»˜è®¤ outline æ ·å¼ç§»é™¤ï¼Œç„¶åå¯¹ :focus çŠ¶æ€èµ‹äºˆ box-shadow å±æ€§ã€‚ è¢«ç¦ç”¨çš„è¾“å…¥æ¡†ä¸ºè¾“å…¥æ¡†è®¾ç½® disabled å±æ€§å¯ä»¥é˜²æ­¢ç”¨æˆ·è¾“å…¥ï¼Œå¹¶èƒ½å¯¹å¤–è§‚åšä¸€äº›ä¿®æ”¹ï¼Œä½¿å…¶æ›´ç›´è§‚ã€‚ 1&lt;input class=\"form-control\" id=\"disabledInput\" type=\"text\" placeholder=\"Disabled input here...\" disabled&gt; 1234567891011121314151617181920&lt;form role=\"form\"&gt; &lt;fieldset disabled&gt; &lt;div class=\"form-group\"&gt; &lt;label for=\"disabledTextInput\"&gt;Disabled input&lt;/label&gt; &lt;input type=\"text\" id=\"disabledTextInput\" class=\"form-control\" placeholder=\"Disabled input\"&gt; &lt;/div&gt; &lt;div class=\"form-group\"&gt; &lt;label for=\"disabledSelect\"&gt;Disabled select menu&lt;/label&gt; &lt;select id=\"disabledSelect\" class=\"form-control\"&gt; &lt;option&gt;Disabled select&lt;/option&gt; &lt;/select&gt; &lt;/div&gt; &lt;div class=\"checkbox\"&gt; &lt;label&gt; &lt;input type=\"checkbox\"&gt; Can't check this &lt;/label&gt; &lt;/div&gt; &lt;button type=\"submit\" class=\"btn btn-primary\"&gt;Submit&lt;/button&gt; &lt;/fieldset&gt;&lt;/form&gt; åªè¯»è¾“å…¥æ¡†ä¸ºè¾“å…¥æ¡†è®¾ç½® readonly å±æ€§å¯ä»¥ç¦æ­¢ç”¨æˆ·è¾“å…¥ï¼Œå¹¶ä¸”è¾“å…¥æ¡†çš„æ ·å¼ä¹Ÿæ˜¯ç¦ç”¨çŠ¶æ€ã€‚ 1&lt;input class=\"form-control\" type=\"text\" placeholder=\"Readonly input hereâ€¦\" readonly&gt; æ ¡éªŒçŠ¶æ€Bootstrap å¯¹è¡¨å•æ§ä»¶çš„æ ¡éªŒçŠ¶æ€ï¼Œå¦‚ errorã€warning å’Œ success çŠ¶æ€ï¼Œéƒ½å®šä¹‰äº†æ ·å¼ã€‚ä½¿ç”¨æ—¶ï¼Œæ·»åŠ  .has-warningã€.has-error æˆ– .has-success ç±»åˆ°è¿™äº›æ§ä»¶çš„çˆ¶å…ƒç´ å³å¯ã€‚ä»»ä½•åŒ…å«åœ¨æ­¤å…ƒç´ ä¹‹å†…çš„ .control-labelã€.form-control å’Œ .help-block å…ƒç´ éƒ½å°†æ¥å—è¿™äº›æ ¡éªŒçŠ¶æ€çš„æ ·å¼ã€‚ 123456789101112131415161718192021222324252627282930313233343536&lt;div class=\"form-group has-success\"&gt; &lt;label class=\"control-label\" for=\"inputSuccess1\"&gt;Input with success&lt;/label&gt; &lt;input type=\"text\" class=\"form-control\" id=\"inputSuccess1\"&gt;&lt;/div&gt;&lt;div class=\"form-group has-warning\"&gt; &lt;label class=\"control-label\" for=\"inputWarning1\"&gt;Input with warning&lt;/label&gt; &lt;input type=\"text\" class=\"form-control\" id=\"inputWarning1\"&gt;&lt;/div&gt;&lt;div class=\"form-group has-error\"&gt; &lt;label class=\"control-label\" for=\"inputError1\"&gt;Input with error&lt;/label&gt; &lt;input type=\"text\" class=\"form-control\" id=\"inputError1\"&gt;&lt;/div&gt;&lt;div class=\"has-success\"&gt; &lt;div class=\"checkbox\"&gt; &lt;label&gt; &lt;input type=\"checkbox\" id=\"checkboxSuccess\" value=\"option1\"&gt; Checkbox with success &lt;/label&gt; &lt;/div&gt;&lt;/div&gt;&lt;div class=\"has-warning\"&gt; &lt;div class=\"checkbox\"&gt; &lt;label&gt; &lt;input type=\"checkbox\" id=\"checkboxWarning\" value=\"option1\"&gt; Checkbox with warning &lt;/label&gt; &lt;/div&gt;&lt;/div&gt;&lt;div class=\"has-error\"&gt; &lt;div class=\"checkbox\"&gt; &lt;label&gt; &lt;input type=\"checkbox\" id=\"checkboxError\" value=\"option1\"&gt; Checkbox with error &lt;/label&gt; &lt;/div&gt;&lt;/div&gt; æ·»åŠ é¢å¤–çš„å›¾æ ‡ä½ è¿˜å¯ä»¥é’ˆå¯¹æ ¡éªŒçŠ¶æ€ä¸ºè¾“å…¥æ¡†æ·»åŠ é¢å¤–çš„å›¾æ ‡ã€‚åªéœ€è®¾ç½®ç›¸åº”çš„ .has-feedback ç±»å¹¶æ·»åŠ æ­£ç¡®çš„å›¾æ ‡å³å¯ã€‚ Feedback icons only work with textual &lt;input class=&quot;form-control&quot;&gt; elements. å›¾æ ‡ã€label å’Œè¾“å…¥æ§ä»¶ç»„å¯¹äºä¸å¸¦æœ‰ label æ ‡ç­¾çš„è¾“å…¥æ¡†ä»¥åŠå³ä¾§å¸¦æœ‰é™„åŠ ç»„ä»¶çš„è¾“å…¥æ¡†ç»„ï¼Œéœ€è¦æ‰‹åŠ¨ä¸ºå…¶å›¾æ ‡å®šä½ã€‚ä¸ºäº†è®©æ‰€æœ‰ç”¨æˆ·éƒ½èƒ½è®¿é—®ä½ çš„ç½‘ç«™ï¼Œæˆ‘ä»¬å¼ºçƒˆå»ºè®®ä¸ºæ‰€æœ‰è¾“å…¥æ¡†æ·»åŠ  label æ ‡ç­¾ã€‚å¦‚æœä½ ä¸å¸Œæœ›å°† label æ ‡ç­¾å±•ç¤ºå‡ºæ¥ï¼Œå¯ä»¥é€šè¿‡æ·»åŠ  sr-only ç±»æ¥å®ç°ã€‚å¦‚æœçš„ç¡®ä¸èƒ½æ·»åŠ  label æ ‡ç­¾ï¼Œè¯·è°ƒæ•´å›¾æ ‡çš„ top å€¼ã€‚å¯¹äºè¾“å…¥æ¡†ç»„ï¼Œè¯·æ ¹æ®ä½ çš„å®é™…æƒ…å†µè°ƒæ•´ right å€¼ã€‚ 123456789101112131415&lt;div class=\"form-group has-success has-feedback\"&gt; &lt;label class=\"control-label\" for=\"inputSuccess2\"&gt;Input with success&lt;/label&gt; &lt;input type=\"text\" class=\"form-control\" id=\"inputSuccess2\"&gt; &lt;span class=\"glyphicon glyphicon-ok form-control-feedback\"&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=\"form-group has-warning has-feedback\"&gt; &lt;label class=\"control-label\" for=\"inputWarning2\"&gt;Input with warning&lt;/label&gt; &lt;input type=\"text\" class=\"form-control\" id=\"inputWarning2\"&gt; &lt;span class=\"glyphicon glyphicon-warning-sign form-control-feedback\"&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=\"form-group has-error has-feedback\"&gt; &lt;label class=\"control-label\" for=\"inputError2\"&gt;Input with error&lt;/label&gt; &lt;input type=\"text\" class=\"form-control\" id=\"inputError2\"&gt; &lt;span class=\"glyphicon glyphicon-remove form-control-feedback\"&gt;&lt;/span&gt;&lt;/div&gt; æ§ä»¶å°ºå¯¸é€šè¿‡ .input-lg ç±»ä¼¼çš„ç±»å¯ä»¥ä¸ºæ§ä»¶è®¾ç½®é«˜åº¦ï¼Œé€šè¿‡ .col-lg-* ç±»ä¼¼çš„ç±»å¯ä»¥ä¸ºæ§ä»¶è®¾ç½®å®½åº¦ã€‚ é«˜åº¦å°ºå¯¸åˆ›å»ºå¤§ä¸€äº›æˆ–å°ä¸€äº›çš„è¡¨å•æ§ä»¶ä»¥åŒ¹é…æŒ‰é’®å°ºå¯¸ã€‚ 1234567&lt;input class=\"form-control input-lg\" type=\"text\" placeholder=\".input-lg\"&gt;&lt;input class=\"form-control\" type=\"text\" placeholder=\"Default input\"&gt;&lt;input class=\"form-control input-sm\" type=\"text\" placeholder=\".input-sm\"&gt;&lt;select class=\"form-control input-lg\"&gt;...&lt;/select&gt;&lt;select class=\"form-control\"&gt;...&lt;/select&gt;&lt;select class=\"form-control input-sm\"&gt;...&lt;/select&gt; æŒ‰é’®é¢„å®šä¹‰æ ·å¼ä½¿ç”¨ä¸‹é¢åˆ—å‡ºçš„ç±»å¯ä»¥å¿«é€Ÿåˆ›å»ºä¸€ä¸ªå¸¦æœ‰é¢„å®šä¹‰æ ·å¼çš„æŒ‰é’®ã€‚ 1234567891011121314151617181920&lt;!-- Standard button --&gt;&lt;button type=\"button\" class=\"btn btn-default\"&gt;Default&lt;/button&gt;&lt;!-- Provides extra visual weight and identifies the primary action in a set of buttons --&gt;&lt;button type=\"button\" class=\"btn btn-primary\"&gt;Primary&lt;/button&gt;&lt;!-- Indicates a successful or positive action --&gt;&lt;button type=\"button\" class=\"btn btn-success\"&gt;Success&lt;/button&gt;&lt;!-- Contextual button for informational alert messages --&gt;&lt;button type=\"button\" class=\"btn btn-info\"&gt;Info&lt;/button&gt;&lt;!-- Indicates caution should be taken with this action --&gt;&lt;button type=\"button\" class=\"btn btn-warning\"&gt;Warning&lt;/button&gt;&lt;!-- Indicates a dangerous or potentially negative action --&gt;&lt;button type=\"button\" class=\"btn btn-danger\"&gt;Danger&lt;/button&gt;&lt;!-- Deemphasize a button by making it look like a link while maintaining button behavior --&gt;&lt;button type=\"button\" class=\"btn btn-link\"&gt;Link&lt;/button&gt; å°ºå¯¸éœ€è¦è®©æŒ‰é’®å…·æœ‰ä¸åŒå°ºå¯¸å—ï¼Ÿä½¿ç”¨ .btn-lgã€.btn-sm æˆ– .btn-xs å¯ä»¥è·å¾—ä¸åŒå°ºå¯¸çš„æŒ‰é’®ã€‚ 12345678910111213141516&lt;p&gt; &lt;button type=\"button\" class=\"btn btn-primary btn-lg\"&gt;Large button&lt;/button&gt; &lt;button type=\"button\" class=\"btn btn-default btn-lg\"&gt;Large button&lt;/button&gt;&lt;/p&gt;&lt;p&gt; &lt;button type=\"button\" class=\"btn btn-primary\"&gt;Default button&lt;/button&gt; &lt;button type=\"button\" class=\"btn btn-default\"&gt;Default button&lt;/button&gt;&lt;/p&gt;&lt;p&gt; &lt;button type=\"button\" class=\"btn btn-primary btn-sm\"&gt;Small button&lt;/button&gt; &lt;button type=\"button\" class=\"btn btn-default btn-sm\"&gt;Small button&lt;/button&gt;&lt;/p&gt;&lt;p&gt; &lt;button type=\"button\" class=\"btn btn-primary btn-xs\"&gt;Extra small button&lt;/button&gt; &lt;button type=\"button\" class=\"btn btn-default btn-xs\"&gt;Extra small button&lt;/button&gt;&lt;/p&gt; é€šè¿‡ç»™æŒ‰é’®æ·»åŠ  .btn-block ç±»å¯ä»¥å°†å…¶æ‹‰ä¼¸è‡³çˆ¶å…ƒç´ 100%çš„å®½åº¦ï¼Œè€Œä¸”æŒ‰é’®ä¹Ÿå˜ä¸ºäº†å—çº§ï¼ˆblockï¼‰å…ƒç´ ã€‚ 12&lt;button type=\"button\" class=\"btn btn-primary btn-lg btn-block\"&gt;Block level button&lt;/button&gt;&lt;button type=\"button\" class=\"btn btn-default btn-lg btn-block\"&gt;Block level button&lt;/button&gt; æ¿€æ´»çŠ¶æ€å½“æŒ‰é’®å¤„äºæ¿€æ´»çŠ¶æ€æ—¶ï¼Œå…¶è¡¨ç°ä¸ºè¢«æŒ‰å‹ä¸‹å»ï¼ˆåº•è‰²æ›´æ·±ã€è¾¹æ¡†å¤œè‰²æ›´æ·±ã€å‘å†…æŠ•å°„é˜´å½±ï¼‰ã€‚å¯¹äº &lt;button&gt; å…ƒç´ ï¼Œæ˜¯é€šè¿‡ :active çŠ¶æ€å®ç°çš„ã€‚å¯¹äº &lt;a&gt;å…ƒç´ ï¼Œæ˜¯é€šè¿‡ .active ç±»å®ç°çš„ã€‚ç„¶è€Œï¼Œä½ è¿˜å¯ä»¥å°† .active åº”ç”¨åˆ° &lt;button&gt;ä¸Šï¼Œå¹¶é€šè¿‡ç¼–ç¨‹çš„æ–¹å¼ä½¿å…¶å¤„äºæ¿€æ´»çŠ¶æ€ã€‚ button å…ƒç´ ç”±äº :active æ˜¯ä¼ªçŠ¶æ€ï¼Œå› æ­¤æ— éœ€é¢å¤–æ·»åŠ ï¼Œä½†æ˜¯åœ¨éœ€è¦è®©å…¶è¡¨ç°å‡ºåŒæ ·å¤–è§‚çš„æ—¶å€™å¯ä»¥æ·»åŠ  .active ç±»ã€‚ 12&lt;button type=\"button\" class=\"btn btn-primary btn-lg active\"&gt;Primary button&lt;/button&gt;&lt;button type=\"button\" class=\"btn btn-default btn-lg active\"&gt;Button&lt;/button&gt; é“¾æ¥ï¼ˆ&lt;a&gt;ï¼‰å…ƒç´ å¯ä»¥ä¸ºåŸºäº &lt;a&gt;å…ƒç´ åˆ›å»ºçš„æŒ‰é’®æ·»åŠ  .active ç±»ã€‚ 12&lt;a href=\"#\" class=\"btn btn-primary btn-lg active\" role=\"button\"&gt;Primary link&lt;/a&gt;&lt;a href=\"#\" class=\"btn btn-default btn-lg active\" role=\"button\"&gt;Link&lt;/a&gt; æŒ‰é’®ç±»ä¸º &lt;a&gt;ã€&lt;button&gt; æˆ– &lt;input&gt; å…ƒç´ åº”ç”¨æŒ‰é’®ç±» 1234&lt;a class=\"btn btn-default\" href=\"#\" role=\"button\"&gt;Link&lt;/a&gt;&lt;button class=\"btn btn-default\" type=\"submit\"&gt;Button&lt;/button&gt;&lt;input class=\"btn btn-default\" type=\"button\" value=\"Input\"&gt;&lt;input class=\"btn btn-default\" type=\"submit\" value=\"Submit\"&gt; å›¾ç‰‡å“åº”å¼å›¾ç‰‡åœ¨ Bootstrap ç‰ˆæœ¬ 3 ä¸­ï¼Œé€šè¿‡ä¸ºå›¾ç‰‡æ·»åŠ  .img-responsive ç±»å¯ä»¥è®©å›¾ç‰‡æ”¯æŒå“åº”å¼å¸ƒå±€ã€‚å…¶å®è´¨æ˜¯ä¸ºå›¾ç‰‡è®¾ç½®äº† max-width: 100%; å’Œ height: auto; å±æ€§ï¼Œä»è€Œè®©å›¾ç‰‡åœ¨å…¶çˆ¶å…ƒç´ ä¸­æ›´å¥½çš„ç¼©æ”¾ã€‚ 1&lt;img src=\"...\" class=\"img-responsive\" alt=\"Responsive image\"&gt; å›¾ç‰‡å½¢çŠ¶é€šè¿‡ä¸º &lt;img&gt; å…ƒç´ æ·»åŠ ä»¥ä¸‹ç›¸åº”çš„ç±»ï¼Œå¯ä»¥è®©å›¾ç‰‡å‘ˆç°ä¸åŒçš„å½¢çŠ¶ã€‚ 123&lt;img src=&quot;...&quot; alt=&quot;...&quot; class=&quot;img-rounded&quot;&gt;&lt;img src=&quot;...&quot; alt=&quot;...&quot; class=&quot;img-circle&quot;&gt;&lt;img src=&quot;...&quot; alt=&quot;...&quot; class=&quot;img-thumbnail&quot;&gt;","tags":[{"name":"Bootstrap","slug":"Bootstrap","permalink":"http://www.54tianzhisheng.cn/tags/Bootstrap/"},{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"http://www.54tianzhisheng.cn/tags/å‰ç«¯/"}]},{"title":"æ­å»ºä¸€ä¸ªåšå®¢é¡¹ç›®åçš„ç¢ç¢å¿µ","date":"2017-06-16T16:00:00.000Z","path":"2017/06/17/blog-talk/","text":"å‰è¨€ ä»¥å‰å¤§äºŒçš„æ—¶å€™å°±æƒ³ä¸€ä¸ªäººç‹¬ç«‹åšä¸€ä¸ªç”± Java å¼€å‘çš„ä¸ªäººåšå®¢, å¯è€å½“æ—¶è¿˜å¾ˆå¼±é¸¡ï¼Œä¸€ä¸ªäººéš¾ä»¥ç‹¬æŒ¡ä¸€ç‰‡ï¼Œå› ä¸ºè¦ä¼šçš„ä¸œè¥¿å¤ªå¤šï¼Œåæ¥è‡ªå·±çœ‹åˆ°å¾ˆå¤šéƒ½æ˜¯ç”± WordPress æ­å»ºçš„åšå®¢ï¼Œå¾ˆå¤šæ¨¡æ¿å¾ˆæ¼‚äº®ï¼Œå¯æ˜¯è‡ªå·±è¦ç¨å¾®å¯¹ â€œæ‹é»„ç‰‡â€ äº†è§£ä¸€ç‚¹ï¼Œå¹¶ä¸”é‡Œé¢çš„å„ç§æ’ä»¶ç‰¹ç‰¹åˆ«çš„å¤šã€‚å»å¹´çš„æ—¶å€™å°±å¼€å§‹ç”¨ä¸Šäº† GitHub Page æ­å»ºé™æ€çš„åšå®¢ï¼Œå› ä¸ºè‡ªå·±ä¸€ç›´ä¹ æƒ¯ç”¨ Markdown å†™ä½œï¼Œå†™å®Œåï¼Œè½¯ä»¶å¯ä»¥ç›´æ¥ç”Ÿæˆ PDF å’Œ HTML æ–‡ä»¶ï¼Œè¿™æ ·å°±å¾ˆæ–¹ä¾¿äº†ï¼Œç›´æ¥å°†è‡ªå·±çš„ HTMLã€PDF å’Œ MD æ–‡ä»¶ä¸€èµ· push åˆ° GitHub ä¸Šï¼Œç„¶åè‡ªå·±åœ¨é€šè¿‡åŸŸååŠ ä¸Šæ–‡ç« é“¾æ¥å°±å¯ä»¥ç›´æ¥è®¿é—®æˆ‘çš„åšå®¢äº†ï¼Œè¿™æ ·å°±çœäº†å¾ˆå¤šäº‹äº†ã€‚è¿˜æä¾›äº† PDF å’Œ MD ç‰ˆæœ¬ï¼Œå¯¹æœ‰ä¸åŒéœ€æ±‚çš„äººéƒ½å¯æ»¡è¶³äº†ã€‚å¯æ˜¯åæ¥è§‰å¾—è¿™æ ·çš„é€¼æ ¼è¿˜æ˜¯ä¸å¤Ÿé«˜ï¼Œå°±åˆå¼€å§‹æŠ˜è…¾ Hexo äº†ï¼Œå‘ç°ç”¨ Hexo ä¹Ÿæ˜¯å¾ˆéå¸¸ç®€å•çš„ï¼ˆå…¶å®æ˜¯çœ‹åˆ° Hexo çš„ yilia ä¸»é¢˜éå¸¸æ¼‚äº®ï¼‰ã€‚äºæ˜¯å°±æ¢ä¸Šäº† Hexo äº†ï¼Œè‡ªå·±åœ¨è¿™ä¸Šé¢å†™åšå®¢ä¹Ÿå¾ˆæ–¹ä¾¿ã€‚æ¯æ¬¡ç”¨è½¯ä»¶å†™å®Œåï¼Œåœ¨ Git Bash ä¸‹æ•²ä¸€è¡Œå‘½ä»¤ hexo d -g å°±è¡Œäº†ï¼Œå¾ˆæ–¹ä¾¿ï¼å‰æ®µæ—¶é—´çœ‹åˆ°äº†ä¸€æ¬¾å¼€æºçš„åšå®¢ï¼ˆç”± Java æ­å»ºè€Œæˆï¼‰â€”â€” Taleï¼Œä¸»é¢˜æ¯”è¾ƒç®€æ´ï¼Œç¬¦åˆç¨‹åºå‘˜çš„èŒƒã€‚ä¹Ÿåˆšå¥½ç¬¦åˆè‡ªå·±æœ€åˆçš„æƒ³æ³•ï¼Œä½†æ˜¯æˆ‘æ˜¯æ²¡æ‰“ç®—æ”¾å¼ƒç°åœ¨çš„åšå®¢ï¼Œå°±æ˜¯æœ‰ä¸€ä¸ªæƒ³æ³•ï¼Œè‡ªå·±ä¹Ÿè·Ÿç€åœ¨é‚£ä¸ªåŸºç¡€å±±ä¿®æ”¹ä¸‹ã€‚ï¼ˆå› ä¸º Tale ä½¿ç”¨çš„æ˜¯è½»é‡çº§ mvc æ¡†æ¶ Blade å¼€å‘ï¼Œæˆ‘å¥½åƒä¸å¤ªäº†è§£è¿™ä¸ªæ¡†æ¶å‘¢ï¼‰ï¼Œæƒ³ç€å°± SpringBoot å¼€å‘æ¯”è¾ƒå¿«ï¼Œä¸Šæ‰‹ä¹Ÿç®€å•ã€‚å½“æ—¶å°±æœ‰è¿™ä¸ªæƒ³æ³•ï¼Œå¯æ€œæ²¡æ—¶é—´ï¼Œä¸è¿‡å‰äº›å¤©å‘ç°æœ‰äººå°±æ˜¯åŸºäºé‚£ä¸ª Tale åšå®¢é‡æ–°ä¿®æ”¹äº†ï¼Œç”¨çš„å°±æ˜¯ SpringBoot ï¼Œå“‡ï¼Œæœç„¶æ˜¯è‹±é›„æ‰€è§ç•¥åŒã€‚å½“æ—¶å°±å’Œä½œè€…é‚®ä»¶è”ç³»äº†ï¼Œäºæ˜¯è¹­è¿™äº›å¤©çš„æ—¶é—´èµ¶ç´§å»çœ‹çœ‹ï¼Œç»“æœä¸åªæ˜¯çœ‹çœ‹ï¼Œå®Œå…¨è‡ªå·±å°±å…¨éƒ¨æ•²äº†ä¸€éï¼Œç»ˆäºåœ¨ä»Šå¤©æå®šäº†ï¼Œä¸ºäº†åº†ç¥ï¼Œæ‰å†™ä¸‹è¿™ç¯‡æ–‡ç« ï¼Œå¥½å¥½è®°å½•è¿™äº›ç¾å¥½çš„æ—¶åˆ»ï¼ˆåšå®¢å¯ä»¥å®Œå…¨å‘æŒ¥ï¼Œä¸é™é¢˜æï¼‰ã€‚é€šè¿‡è‡ªå·±æ·±å…¥è¿™ä¸ªé¡¹ç›®ï¼Œæ‰èƒ½å¤Ÿå¾ˆäº†è§£å†…éƒ¨çš„å®ç°æ–¹å¼ï¼Œè¿™ç‚¹æ”¶è·å¾ˆå¤§ï¼Œè¿™åå¤©æ—¶é—´èŠ±çš„å€¼ï¼Œå†æ­¤æ„Ÿè°¢ä¸¤ä½åŸä½œè€… ZHENFENG13 ã€otale ã€‚ åšå®¢ä»‹ç»Tale ä½¿ç”¨äº†è½»é‡çº§ mvc æ¡†æ¶ Blade å¼€å‘ï¼Œé»˜è®¤ä¸»é¢˜ä½¿ç”¨äº†æ¼‚äº®çš„ pinghsu ã€‚ My-Blog ä½¿ç”¨çš„æ˜¯ Docker + SpringBoot + Mybatis + thymeleaf æ‰“é€ çš„ä¸€ä¸ªä¸ªäººåšå®¢æ¨¡æ¿ã€‚ Blog æ˜¯è‡ªå·±èŠ±äº†åå¤©çš„æ—¶é—´æŠŠæ•´ä¸ªé¡¹ç›®çš„ä»£ç éƒ½æ•²äº†ä¸€éï¼Œç†Ÿæ‚‰äº†æ•´ä¸ªé¡¹ç›®ï¼Œåšäº†ä¼˜åŒ–ï¼Œå»é™¤äº† Dockerï¼Œ å…¶ä¸­ä¿®æ”¹äº†åŸæ¥çš„ä¸€äº› bugï¼Œå¹¶åœ¨åŸä½œè€…çš„é¡¹ç›®ä¸­æå‡ºäº† issue ï¼Œ åŸä½œè€…å·²ä¿®å¤ã€‚ : å–œæ¬¢è¯¥é¡¹ç›®çš„è¯ï¼Œå¯ä»¥ç»™é¡¹ç›®ç‚¹ä¸ª starï¼Œå¦‚æœä½ æƒ³åœ¨è¿™åŸºç¡€ä¸Šä¿®æ”¹ï¼Œé‚£ä¹ˆå»ºè®®ä½  fork è¯¥é¡¹ç›®ï¼Œç„¶åå†ä¿®æ”¹å“¦ã€‚ åšå®¢é¦–é¡µï¼š å½’æ¡£ï¼š å‹é“¾ï¼š å…³äºï¼š æœç´¢ï¼š åå°ç®¡ç† ç®¡ç†ç™»å½•ï¼š ç®¡ç†é¦–é¡µï¼š å‘å¸ƒæ–‡ç« ï¼š æ–‡ç« ç®¡ç†ï¼š é¡µé¢ç®¡ç†ï¼š åˆ†ç±»æ ‡ç­¾ï¼š æ–‡ä»¶ç®¡ç†ï¼š å‹é“¾ç®¡ç†ï¼š ç³»ç»Ÿè®¾ç½®ï¼š æœ€åæˆ‘ä»€ä¹ˆæˆ‘è¿™ä¹ˆå–œæ¬¢æŠ˜è…¾åšå®¢å‘¢ï¼Œç†Ÿæ‚‰æˆ‘çš„æœ‹å‹éƒ½çŸ¥é“ï¼Œæˆ‘å†å¾ˆå¤šå¹³å°éƒ½å†™è¿‡åšå®¢ï¼Œæœ‰äº›æ˜¯ä»–ä»¬å¹³å°çš„è¿è¥äººå‘˜é‚€è¯·è¿‡å»çš„ã€‚å¯æ˜¯åœ¨è¿™äº›å¹³å°ä¸Šå†™åšå®¢ç»ˆç©¶æ˜¯æ²¡æœ‰æ„Ÿè§‰ï¼Œå¦‚ä»Šè‡ªå·±åœ¨è‡ªå·±çš„åšå®¢ç½‘ç«™å†™æ–‡ç« ï¼Œæ¯”è¾ƒè½»æ¾ï¼Œè€Œä¸”ä¹Ÿç¬¦åˆæˆ‘çš„å†™ä½œé£æ ¼ã€‚åœ¨å…¶ä»–çš„å¹³å°éƒ½æœ‰äº›å¤§å¤§å°å°çš„ä¸é€‚ï¼ˆå¯¹ç¨‹åºå‘˜æ¥è¯´åº”è¯¥æ˜¯ bugï¼‰ï¼Œè™½ç„¶ç›®å‰è¿˜æ˜¯ä¼šåœ¨è¿™äº›å¹³å°ç»§ç»­å‘å¸ƒæˆ‘æ–°å†™çš„æ–‡ç« ï¼Œä½†æ˜¯æˆ‘ä¿è¯æœ€æ–°çš„æ–‡ç« ï¼Œé¦–å‘è‚¯å®šæ˜¯æˆ‘è‡ªå·±çš„åšå®¢ç½‘ç«™ï¼Œæœ‰äº›æ˜¯ä¸ä¼šåœ¨å…¶ä»–å¹³å°å‘çš„ï¼Œæœ‰è§‰å¾—ä¸é”™çš„å¯ä»¥ RSS è®¢é˜…æˆ‘çš„åšå®¢ï¼Œæˆ–è€…æ˜¯ç›´æ¥æ”¶è—ç½‘å€ä¸‹æ¥ã€‚è‡ªä»å†™åšå®¢ä¸‹æ¥é‡åˆ°å¾ˆå¤šå¿—åŒé“åˆçš„äººï¼Œè¿™ç‚¹æ­£æ˜¯è®©æˆ‘è§‰å¾—æœ‰å†™ä¸‹å»çš„å¿…è¦äº†ã€‚è‡ªå·±å°†ä¼šåšæŒä¸‹å»ï¼Œæ—¶åˆ»è­¦é†’è‡ªå·±ï¼šå‹¿å¿˜åˆå¿ƒï¼æœ€åçš„æœ€åï¼Œè¿˜æ˜¯æƒ³è¯´ä¸€å¥ï¼šå¦‚æœä½ æƒ³å’Œæˆ‘ä¸€æ ·æŠ˜è…¾åšå®¢ï¼Œé‚£ä¹ˆæˆ‘å»ºè®®ä½ å…ˆåœ¨ä¸€å®¶å¹³å°åšæŒå†™ä¸‹å»ï¼Œç­‰åšå®¢æ•°é‡ä¸Šæ¥äº†ï¼Œåœ¨è‡ªå·±æŠ˜è…¾è‡ªå·±çš„åšå®¢ç½‘ç«™ã€‚è¿˜æœ‰å°±æ˜¯ä½ æƒ³æé«˜è‡ªå·±çš„è¯ï¼Œè¿˜æ˜¯éœ€è¦å¾ˆåœ¨æ„ä½ çš„åŸºç¡€ï¼Œç„¶åå°±æ˜¯è¦å¤šç»ƒæ‰‹å‡ ä¸ªé¡¹ç›®ï¼Œæˆ‘è‡ªå·±åœ¨ç»ƒæ‰‹è¿™ä¸ªé¡¹ç›®çš„æ—¶å€™å°±æ”¶è·å¾ˆå¤šã€‚","tags":[{"name":"Java","slug":"Java","permalink":"http://www.54tianzhisheng.cn/tags/Java/"}]},{"title":"è¯¦è§£ Filter è¿‡æ»¤å™¨","date":"2017-06-16T16:00:00.000Z","path":"2017/06/17/è¯¦è§£ Filter è¿‡æ»¤å™¨/","text":"1ã€ç®€ä»‹ Filterä¹Ÿç§°ä¹‹ä¸ºè¿‡æ»¤å™¨ï¼Œå®ƒæ˜¯ServletæŠ€æœ¯ä¸­æœ€å®ç”¨çš„æŠ€æœ¯ï¼ŒWEBå¼€å‘äººå‘˜é€šè¿‡FilteræŠ€æœ¯ï¼Œå¯¹webæœåŠ¡å™¨ç®¡ç†çš„æ‰€æœ‰webèµ„æºï¼šä¾‹å¦‚Jsp, Servlet, é™æ€å›¾ç‰‡æ–‡ä»¶æˆ–é™æ€ html æ–‡ä»¶ç­‰è¿›è¡Œæ‹¦æˆªï¼Œä»è€Œå®ç°ä¸€äº›ç‰¹æ®Šçš„åŠŸèƒ½ã€‚ä¾‹å¦‚å®ç°URLçº§åˆ«çš„æƒé™è®¿é—®æ§åˆ¶ã€è¿‡æ»¤æ•æ„Ÿè¯æ±‡ã€å‹ç¼©å“åº”ä¿¡æ¯ç­‰ä¸€äº›é«˜çº§åŠŸèƒ½ã€‚ å®ƒä¸»è¦ç”¨äºå¯¹ç”¨æˆ·è¯·æ±‚è¿›è¡Œé¢„å¤„ç†ï¼Œä¹Ÿå¯ä»¥å¯¹HttpServletResponse è¿›è¡Œåå¤„ç†ã€‚ä½¿ç”¨Filter çš„å®Œæ•´æµç¨‹ï¼šFilter å¯¹ç”¨æˆ·è¯·æ±‚è¿›è¡Œé¢„å¤„ç†ï¼Œæ¥ç€å°†è¯·æ±‚äº¤ç»™Servlet è¿›è¡Œå¤„ç†å¹¶ç”Ÿæˆå“åº”ï¼Œæœ€åFilter å†å¯¹æœåŠ¡å™¨å“åº”è¿›è¡Œåå¤„ç†ã€‚ FilteråŠŸèƒ½ï¼š åœ¨HttpServletRequest åˆ°è¾¾ Servlet ä¹‹å‰ï¼Œæ‹¦æˆªå®¢æˆ·çš„ HttpServletRequest ã€‚ æ ¹æ®éœ€è¦æ£€æŸ¥ HttpServletRequest ï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹HttpServletRequest å¤´å’Œæ•°æ®ã€‚ åœ¨HttpServletResponse åˆ°è¾¾å®¢æˆ·ç«¯ä¹‹å‰ï¼Œæ‹¦æˆªHttpServletResponse ã€‚ æ ¹æ®éœ€è¦æ£€æŸ¥ HttpServletResponse ï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹HttpServletResponseå¤´å’Œæ•°æ®ã€‚ 2ã€å¦‚ä½•å®ç°æ‹¦æˆª Filteræ¥å£ä¸­æœ‰ä¸€ä¸ªdoFilteræ–¹æ³•ï¼Œå½“å¼€å‘äººå‘˜ç¼–å†™å¥½Filterï¼Œå¹¶é…ç½®å¯¹å“ªä¸ªwebèµ„æºè¿›è¡Œæ‹¦æˆªåï¼ŒWEBæœåŠ¡å™¨æ¯æ¬¡åœ¨è°ƒç”¨webèµ„æºçš„serviceæ–¹æ³•ä¹‹å‰ï¼Œéƒ½ä¼šå…ˆè°ƒç”¨ä¸€ä¸‹filterçš„doFilteræ–¹æ³•ï¼Œå› æ­¤ï¼Œåœ¨è¯¥æ–¹æ³•å†…ç¼–å†™ä»£ç å¯è¾¾åˆ°å¦‚ä¸‹ç›®çš„ï¼š è°ƒç”¨ç›®æ ‡èµ„æºä¹‹å‰ï¼Œè®©ä¸€æ®µä»£ç æ‰§è¡Œã€‚ æ˜¯å¦è°ƒç”¨ç›®æ ‡èµ„æºï¼ˆå³æ˜¯å¦è®©ç”¨æˆ·è®¿é—®webèµ„æºï¼‰ã€‚ webæœåŠ¡å™¨åœ¨è°ƒç”¨doFilteræ–¹æ³•æ—¶ï¼Œä¼šä¼ é€’ä¸€ä¸ªfilterChainå¯¹è±¡è¿›æ¥ï¼ŒfilterChainå¯¹è±¡æ˜¯filteræ¥å£ä¸­æœ€é‡è¦çš„ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒä¹Ÿæä¾›äº†ä¸€ä¸ªdoFilteræ–¹æ³•ï¼Œå¼€å‘äººå‘˜å¯ä»¥æ ¹æ®éœ€æ±‚å†³å®šæ˜¯å¦è°ƒç”¨æ­¤æ–¹æ³•ï¼Œè°ƒç”¨è¯¥æ–¹æ³•ï¼Œåˆ™webæœåŠ¡å™¨å°±ä¼šè°ƒç”¨webèµ„æºçš„serviceæ–¹æ³•ï¼Œå³webèµ„æºå°±ä¼šè¢«è®¿é—®ï¼Œå¦åˆ™webèµ„æºä¸ä¼šè¢«è®¿é—®ã€‚ 3ã€Filterå¼€å‘ä¸¤æ­¥èµ° ç¼–å†™javaç±»å®ç°Filteræ¥å£ï¼Œå¹¶å®ç°å…¶doFilteræ–¹æ³•ã€‚ åœ¨ web.xml æ–‡ä»¶ä¸­ä½¿ç”¨å’Œå…ƒç´ å¯¹ç¼–å†™çš„filterç±»è¿›è¡Œæ³¨å†Œï¼Œå¹¶è®¾ç½®å®ƒæ‰€èƒ½æ‹¦æˆªçš„èµ„æºã€‚ web.xmlé…ç½®å„èŠ‚ç‚¹ä»‹ç»ï¼š 12345678910111213141516&lt;filter-name&gt;ç”¨äºä¸ºè¿‡æ»¤å™¨æŒ‡å®šä¸€ä¸ªåå­—ï¼Œè¯¥å…ƒç´ çš„å†…å®¹ä¸èƒ½ä¸ºç©ºã€‚&lt;filter-class&gt;å…ƒç´ ç”¨äºæŒ‡å®šè¿‡æ»¤å™¨çš„å®Œæ•´çš„é™å®šç±»åã€‚&lt;init-param&gt;å…ƒç´ ç”¨äºä¸ºè¿‡æ»¤å™¨æŒ‡å®šåˆå§‹åŒ–å‚æ•°ï¼Œå®ƒçš„å­å…ƒç´ &lt;param-name&gt;æŒ‡å®šå‚æ•°çš„åå­—ï¼Œ&lt;param-value&gt;æŒ‡å®šå‚æ•°çš„å€¼ã€‚åœ¨è¿‡æ»¤å™¨ä¸­ï¼Œå¯ä»¥ä½¿ç”¨FilterConfigæ¥å£å¯¹è±¡æ¥è®¿é—®åˆå§‹åŒ–å‚æ•°ã€‚&lt;filter-mapping&gt;å…ƒç´ ç”¨äºè®¾ç½®ä¸€ä¸ª Filter æ‰€è´Ÿè´£æ‹¦æˆªçš„èµ„æºã€‚ä¸€ä¸ªFilteræ‹¦æˆªçš„èµ„æºå¯é€šè¿‡ä¸¤ç§æ–¹å¼æ¥æŒ‡å®šï¼šServlet åç§°å’Œèµ„æºè®¿é—®çš„è¯·æ±‚è·¯å¾„&lt;filter-name&gt;å­å…ƒç´ ç”¨äºè®¾ç½®filterçš„æ³¨å†Œåç§°ã€‚è¯¥å€¼å¿…é¡»æ˜¯åœ¨&lt;filter&gt;å…ƒç´ ä¸­å£°æ˜è¿‡çš„è¿‡æ»¤å™¨çš„åå­—&lt;url-pattern&gt;è®¾ç½® filter æ‰€æ‹¦æˆªçš„è¯·æ±‚è·¯å¾„(è¿‡æ»¤å™¨å…³è”çš„URLæ ·å¼)&lt;servlet-name&gt;æŒ‡å®šè¿‡æ»¤å™¨æ‰€æ‹¦æˆªçš„Servletåç§°ã€‚&lt;dispatcher&gt;æŒ‡å®šè¿‡æ»¤å™¨æ‰€æ‹¦æˆªçš„èµ„æºè¢« Servlet å®¹å™¨è°ƒç”¨çš„æ–¹å¼ï¼Œå¯ä»¥æ˜¯REQUEST,INCLUDE,FORWARDå’ŒERRORä¹‹ä¸€ï¼Œé»˜è®¤REQUESTã€‚ç”¨æˆ·å¯ä»¥è®¾ç½®å¤šä¸ª&lt;dispatcher&gt; å­å…ƒç´ ç”¨æ¥æŒ‡å®š Filter å¯¹èµ„æºçš„å¤šç§è°ƒç”¨æ–¹å¼è¿›è¡Œæ‹¦æˆªã€‚&lt;dispatcher&gt; å­å…ƒç´ å¯ä»¥è®¾ç½®çš„å€¼åŠå…¶æ„ä¹‰ï¼šREQUESTï¼šå½“ç”¨æˆ·ç›´æ¥è®¿é—®é¡µé¢æ—¶ï¼ŒWebå®¹å™¨å°†ä¼šè°ƒç”¨è¿‡æ»¤å™¨ã€‚å¦‚æœç›®æ ‡èµ„æºæ˜¯é€šè¿‡RequestDispatcherçš„include()æˆ–forward()æ–¹æ³•è®¿é—®æ—¶ï¼Œé‚£ä¹ˆè¯¥è¿‡æ»¤å™¨å°±ä¸ä¼šè¢«è°ƒç”¨ã€‚INCLUDEï¼šå¦‚æœç›®æ ‡èµ„æºæ˜¯é€šè¿‡RequestDispatcherçš„include()æ–¹æ³•è®¿é—®æ—¶ï¼Œé‚£ä¹ˆè¯¥è¿‡æ»¤å™¨å°†è¢«è°ƒç”¨ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¯¥è¿‡æ»¤å™¨ä¸ä¼šè¢«è°ƒç”¨ã€‚FORWARDï¼šå¦‚æœç›®æ ‡èµ„æºæ˜¯é€šè¿‡RequestDispatcherçš„forward()æ–¹æ³•è®¿é—®æ—¶ï¼Œé‚£ä¹ˆè¯¥è¿‡æ»¤å™¨å°†è¢«è°ƒç”¨ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¯¥è¿‡æ»¤å™¨ä¸ä¼šè¢«è°ƒç”¨ã€‚ERRORï¼šå¦‚æœç›®æ ‡èµ„æºæ˜¯é€šè¿‡å£°æ˜å¼å¼‚å¸¸å¤„ç†æœºåˆ¶è°ƒç”¨æ—¶ï¼Œé‚£ä¹ˆè¯¥è¿‡æ»¤å™¨å°†è¢«è°ƒç”¨ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿‡æ»¤å™¨ä¸ä¼šè¢«è°ƒç”¨ã€‚ 4ã€Filteré“¾ åœ¨ä¸€ä¸ªwebåº”ç”¨ä¸­ï¼Œå¯ä»¥å¼€å‘ç¼–å†™å¤šä¸ªFilterï¼Œè¿™äº›Filterç»„åˆèµ·æ¥ç§°ä¹‹ä¸ºä¸€ä¸ªFilteré“¾ã€‚ webæœåŠ¡å™¨æ ¹æ®Filteråœ¨web.xmlæ–‡ä»¶ä¸­çš„æ³¨å†Œé¡ºåºï¼Œå†³å®šå…ˆè°ƒç”¨å“ªä¸ªFilterï¼Œå½“ç¬¬ä¸€ä¸ªFilterçš„doFilteræ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼ŒwebæœåŠ¡å™¨ä¼šåˆ›å»ºä¸€ä¸ªä»£è¡¨Filteré“¾çš„FilterChainå¯¹è±¡ä¼ é€’ç»™è¯¥æ–¹æ³•ã€‚åœ¨doFilteræ–¹æ³•ä¸­ï¼Œå¼€å‘äººå‘˜å¦‚æœè°ƒç”¨äº†FilterChainå¯¹è±¡çš„doFilteræ–¹æ³•ï¼Œåˆ™webæœåŠ¡å™¨ä¼šæ£€æŸ¥FilterChainå¯¹è±¡ä¸­æ˜¯å¦è¿˜æœ‰filterï¼Œå¦‚æœæœ‰ï¼Œåˆ™è°ƒç”¨ç¬¬2ä¸ªfilterï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™è°ƒç”¨ç›®æ ‡èµ„æºã€‚ å¤šä¸ªè¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº ä¸€ä¸ªç›®æ ‡èµ„æºå¯ä»¥æŒ‡å®šå¤šä¸ªè¿‡æ»¤å™¨ï¼Œè¿‡æ»¤å™¨çš„æ‰§è¡Œé¡ºåºæ˜¯åœ¨web.xmlæ–‡ä»¶ä¸­çš„éƒ¨ç½²é¡ºåºï¼š 12345678910111213141516&lt;filter&gt; &lt;filter-name&gt;myFilter1&lt;/filter-name&gt; &lt;filter-class&gt;cn.cloud.filter.MyFilter1&lt;/filter-class&gt; &lt;/filter&gt; &lt;filter-mapping&gt; &lt;filter-name&gt;myFilter1&lt;/filter-name&gt; &lt;url-pattern&gt;/index.jsp&lt;/url-pattern&gt; &lt;/filter-mapping&gt; &lt;filter&gt; &lt;filter-name&gt;myFilter2&lt;/filter-name&gt; &lt;filter-class&gt;cn. cloud.filter.MyFilter2&lt;/filter-class&gt; &lt;/filter&gt; &lt;filter-mapping&gt; &lt;filter-name&gt;myFilter2&lt;/filter-name&gt; &lt;url-pattern&gt;/index.jsp&lt;/url-pattern&gt; &lt;/filter-mapping&gt; MyFilter1 12345678public class MyFilter1 extends HttpFilter &#123; public void doFilter(HttpServletRequest request, HttpServletResponse response, FilterChain chain) throws IOException, ServletException &#123; System.out.println(\"filter1 start...\"); chain.doFilter(request, response);//æ”¾è¡Œï¼Œæ‰§è¡ŒMyFilter2çš„doFilter()æ–¹æ³• System.out.println(\"filter1 end...\"); &#125;&#125; MyFilter2 12345678public class MyFilter2 extends HttpFilter &#123; public void doFilter(HttpServletRequest request, HttpServletResponse response, FilterChain chain) throws IOException, ServletException &#123; System.out.println(\"filter2 start...\"); chain.doFilter(request, response);//æ”¾è¡Œï¼Œæ‰§è¡Œç›®æ ‡èµ„æº System.out.println(\"filter2 end...\"); &#125;&#125; 12345&lt;body&gt; This is my JSP page. &lt;br&gt; &lt;h1&gt;index.jsp&lt;/h1&gt; &lt;%System.out.println(\"index.jsp\"); %&gt; &lt;/body&gt; å½“æœ‰ç”¨æˆ·è®¿é—®index.jspé¡µé¢æ—¶ï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š 12345filter1 start...filter2 start...index.jspfilter2 end...filter1 end... 5ã€Filterçš„ç”Ÿå‘½å‘¨æœŸ 1public void init(FilterConfig filterConfig) throws ServletException;//åˆå§‹åŒ– å’Œæˆ‘ä»¬ç¼–å†™çš„Servletç¨‹åºä¸€æ ·ï¼ŒFilterçš„åˆ›å»ºå’Œé”€æ¯ç”±WEBæœåŠ¡å™¨è´Ÿè´£ã€‚ web åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ï¼Œweb æœåŠ¡å™¨å°†åˆ›å»ºFilter çš„å®ä¾‹å¯¹è±¡ï¼Œå¹¶è°ƒç”¨å…¶initæ–¹æ³•ï¼Œè¯»å–web.xmlé…ç½®ï¼Œå®Œæˆå¯¹è±¡çš„åˆå§‹åŒ–åŠŸèƒ½ï¼Œä»è€Œä¸ºåç»­çš„ç”¨æˆ·è¯·æ±‚ä½œå¥½æ‹¦æˆªçš„å‡†å¤‡å·¥ä½œï¼ˆfilterå¯¹è±¡åªä¼šåˆ›å»ºä¸€æ¬¡ï¼Œinitæ–¹æ³•ä¹Ÿåªä¼šæ‰§è¡Œä¸€æ¬¡ï¼‰ã€‚å¼€å‘äººå‘˜é€šè¿‡initæ–¹æ³•çš„å‚æ•°ï¼Œå¯è·å¾—ä»£è¡¨å½“å‰filteré…ç½®ä¿¡æ¯çš„FilterConfigå¯¹è±¡ã€‚ 1public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException;//æ‹¦æˆªè¯·æ±‚ è¿™ä¸ªæ–¹æ³•å®Œæˆå®é™…çš„è¿‡æ»¤æ“ä½œã€‚å½“å®¢æˆ·è¯·æ±‚è®¿é—®ä¸è¿‡æ»¤å™¨å…³è”çš„URLï¼ˆç›®æ ‡èµ„æºï¼‰çš„æ—¶å€™ï¼ŒServletè¿‡æ»¤å™¨å°†å…ˆæ‰§è¡ŒdoFilteræ–¹æ³•ã€‚FilterChainå‚æ•°ç”¨äºè®¿é—®åç»­è¿‡æ»¤å™¨ã€‚ 1public void destroy();//é”€æ¯ æœåŠ¡å™¨åœ¨åˆ›å»ºFilterå¯¹è±¡ä¹‹åï¼ŒæŠŠFilteræ”¾åˆ°ç¼“å­˜ä¸­ä¸€ç›´ä½¿ç”¨ï¼ˆä¼šé©»ç•™åœ¨å†…å­˜ï¼‰ï¼Œé€šå¸¸ä¸ä¼šé”€æ¯å®ƒï¼Œå½“webåº”ç”¨ç§»é™¤æˆ–æœåŠ¡å™¨åœæ­¢æ—¶æ‰é”€æ¯Filterå¯¹è±¡ã€‚åœ¨Webå®¹å™¨å¸è½½ Filter å¯¹è±¡ä¹‹å‰è¢«è°ƒç”¨ã€‚è¯¥æ–¹æ³•åœ¨Filterçš„ç”Ÿå‘½å‘¨æœŸä¸­ä»…æ‰§è¡Œä¸€æ¬¡ã€‚åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œå¯ä»¥é‡Šæ”¾è¿‡æ»¤å™¨ä½¿ç”¨çš„èµ„æºã€‚ 6ã€FilterConfigæ¥å£ ç”¨æˆ·åœ¨é…ç½®filteræ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä¸ºfilteré…ç½®ä¸€äº›åˆå§‹åŒ–å‚æ•°ï¼Œå½“webå®¹å™¨å®ä¾‹åŒ–Filterå¯¹è±¡ï¼Œè°ƒç”¨å…¶initæ–¹æ³•æ—¶ï¼Œä¼šæŠŠå°è£…äº†filteråˆå§‹åŒ–å‚æ•°çš„filterConfigå¯¹è±¡ä¼ é€’è¿›æ¥ã€‚å› æ­¤å¼€å‘äººå‘˜åœ¨ç¼–å†™filteræ—¶ï¼Œé€šè¿‡filterConfigå¯¹è±¡çš„æ–¹æ³•ï¼Œå°±å¯è·å¾—ä»¥ä¸‹å†…å®¹ï¼š 1234String getFilterName();//å¾—åˆ°filterçš„åç§°ï¼›ä¸&lt;filter-name&gt;å…ƒç´ å¯¹åº”ã€‚String getInitParameter(String name);//è¿”å›åœ¨éƒ¨ç½²æè¿°ä¸­æŒ‡å®šåç§°çš„åˆå§‹åŒ–å‚æ•°çš„å€¼ã€‚å¦‚æœä¸å­˜åœ¨è¿”å›nullï¼Œä¸&lt;init-param&gt;å…ƒç´ å¯¹åº”.Enumeration getInitParameterNames();//è¿”å›è¿‡æ»¤å™¨çš„æ‰€æœ‰åˆå§‹åŒ–å‚æ•°çš„åå­—çš„æšä¸¾é›†åˆã€‚public ServletContext getServletContext();//è¿”å›Servletä¸Šä¸‹æ–‡å¯¹è±¡çš„å¼•ç”¨ã€‚ 7ã€FilterChain doFilter()æ–¹æ³•çš„å‚æ•°ä¸­æœ‰ä¸€ä¸ªç±»å‹ä¸ºFilterChainçš„å‚æ•°ï¼Œå®ƒåªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼šdoFilter(ServletRequest,ServletResponse) doFilter() æ–¹æ³•çš„æ”¾è¡Œï¼Œè®©è¯·æ±‚æµè®¿é—®ç›®æ ‡èµ„æºï¼å…¶å®è°ƒç”¨è¯¥æ–¹æ³•çš„æ„æ€æ˜¯ï¼Œå½“å‰ Filter æ”¾è¡Œäº†ï¼Œä½†ä¸ä»£è¡¨å…¶ä»–è¿‡æ»¤å™¨ä¹Ÿæ”¾è¡Œã€‚ä¸€ä¸ªç›®æ ‡èµ„æºä¸Šï¼Œå¯èƒ½éƒ¨ç½²äº†å¤šä¸ªè¿‡æ»¤å™¨ï¼Œæ‰€ä»¥è°ƒç”¨ FilterChain ç±»çš„ doFilter() æ–¹æ³•è¡¨ç¤ºçš„æ˜¯æ‰§è¡Œä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨çš„ doFilter() æ–¹æ³•ï¼Œæˆ–è€…æ˜¯æ‰§è¡Œç›®æ ‡èµ„æºï¼ å¦‚æœå½“å‰è¿‡æ»¤å™¨æ˜¯æœ€åä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œé‚£ä¹ˆè°ƒç”¨ chain.doFilter() æ–¹æ³•è¡¨ç¤ºæ‰§è¡Œç›®æ ‡èµ„æºï¼Œè€Œä¸æ˜¯æœ€åä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œé‚£ä¹ˆ chain.doFilter() è¡¨ç¤ºæ‰§è¡Œä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨çš„ doFilter() æ–¹æ³•ã€‚ 8ã€è¿‡æ»¤å™¨çš„åº”ç”¨åœºæ™¯ æ‰§è¡Œç›®æ ‡èµ„æºä¹‹å‰åšé¢„å¤„ç†å·¥ä½œï¼Œä¾‹å¦‚è®¾ç½®ç¼–ç ï¼Œè¿™ç§è¯•é€šå¸¸éƒ½ä¼šæ”¾è¡Œï¼Œåªæ˜¯åœ¨ç›®æ ‡èµ„æºæ‰§è¡Œä¹‹å‰åšä¸€äº›å‡†å¤‡å·¥ä½œï¼› é€šè¿‡æ¡ä»¶åˆ¤æ–­æ˜¯å¦æ”¾è¡Œï¼Œä¾‹å¦‚æ ¡éªŒå½“å‰ç”¨æˆ·æ˜¯å¦å·²ç»ç™»å½•ï¼Œæˆ–è€…ç”¨æˆ·IPæ˜¯å¦å·²ç»è¢«ç¦ç”¨ï¼› åœ¨ç›®æ ‡èµ„æºæ‰§è¡Œåï¼Œåšä¸€äº›åç»­çš„ç‰¹æ®Šå¤„ç†å·¥ä½œï¼Œä¾‹å¦‚æŠŠç›®æ ‡èµ„æºè¾“å‡ºçš„æ•°æ®è¿›è¡Œå¤„ç† è®¾ç½®ç›®æ ‡èµ„æº åœ¨web.xmlæ–‡ä»¶ä¸­éƒ¨ç½²Filteræ—¶ï¼Œå¯ä»¥é€šè¿‡â€œ*â€æ¥æ‰§è¡Œç›®æ ‡èµ„æºï¼š 1234&lt;filter-mapping&gt; &lt;filter-name&gt;myfilter&lt;/filter-name&gt; &lt;url-pattern&gt;/*&lt;/url-pattern&gt; &lt;/filter-mapping&gt; ç‰¹æ€§ä¸Servletå®Œå…¨ç›¸åŒï¼é€šè¿‡è¿™ä¸€ç‰¹æ€§ï¼Œå¯ä»¥åœ¨ç”¨æˆ·è®¿é—®æ•æ„Ÿèµ„æºæ—¶ï¼Œæ‰§è¡Œè¿‡æ»¤å™¨ï¼Œä¾‹å¦‚ï¼š/admin/*ï¼Œå¯ä»¥æŠŠæ‰€æœ‰ç®¡ç†å‘˜æ‰èƒ½è®¿é—®çš„èµ„æºæ”¾åˆ°/adminè·¯å¾„ä¸‹ï¼Œè¿™æ—¶å¯ä»¥é€šè¿‡è¿‡æ»¤å™¨æ¥æ ¡éªŒç”¨æˆ·èº«ä»½ã€‚ è¿˜å¯ä»¥ä¸ºæŒ‡å®šç›®æ ‡èµ„æºä¸ºæŸä¸ªServletï¼Œä¾‹å¦‚ï¼š 12345678910111213141516&lt;servlet&gt; &lt;servlet-name&gt;myservlet&lt;/servlet-name&gt; &lt;servlet-class&gt;cn.cloud.servlet.MyServlet&lt;/servlet-class&gt; &lt;/servlet&gt; &lt;servlet-mapping&gt; &lt;servlet-name&gt;myservlet&lt;/servlet-name&gt; &lt;url-pattern&gt;/abc&lt;/url-pattern&gt; &lt;/servlet-mapping&gt; &lt;filter&gt; &lt;filter-name&gt;myfilter&lt;/filter-name&gt; &lt;filter-class&gt;cn.cloud.filter.MyFilter&lt;/filter-class&gt; &lt;/filter&gt; &lt;filter-mapping&gt; &lt;filter-name&gt;myfilter&lt;/filter-name&gt; &lt;servlet-name&gt;myservlet&lt;/servlet-name&gt; &lt;/filter-mapping&gt; å½“ç”¨æˆ·è®¿é—®http://localhost:8080/filtertest/abcæ—¶ï¼Œä¼šæ‰§è¡Œåå­—ä¸ºmyservletçš„Servletï¼Œè¿™æ—¶ä¼šæ‰§è¡Œè¿‡æ»¤å™¨ã€‚ 9ã€å››ç§æ‹¦æˆªæ–¹å¼ å†™ä¸€ä¸ªè¿‡æ»¤å™¨ï¼ŒæŒ‡å®šè¿‡æ»¤çš„èµ„æºä¸ºb.jspï¼Œç„¶ååœ¨æµè§ˆå™¨ä¸­ç›´æ¥è®¿é—®b.jspï¼Œä¼šå‘ç°è¿‡æ»¤å™¨æ‰§è¡Œäº†.ä½†æ˜¯ï¼Œå½“åœ¨a.jspä¸­request.getRequestDispathcer(â€œ/b.jspâ€).forward(request,response)æ—¶ï¼Œå°±ä¸ä¼šå†æ‰§è¡Œè¿‡æ»¤å™¨äº†ï¼ä¹Ÿå°±æ˜¯è¯´ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œåªèƒ½ç›´æ¥è®¿é—®ç›®æ ‡èµ„æºæ‰ä¼šæ‰§è¡Œè¿‡æ»¤å™¨ï¼Œè€Œforwardæ‰§è¡Œç›®æ ‡èµ„æºï¼Œä¸ä¼šæ‰§è¡Œè¿‡æ»¤å™¨ï¼ 12345678public class MyFilter extends HttpFilter &#123; public void doFilter(HttpServletRequest request, HttpServletResponse response, FilterChain chain) throws IOException, ServletException &#123; System.out.println(\"myfilter...\"); chain.doFilter(request, response); &#125;&#125; 12345678&lt;filter&gt; &lt;filter-name&gt;myfilter&lt;/filter-name&gt; &lt;filter-class&gt;cn.itcast.filter.MyFilter&lt;/filter-class&gt; &lt;/filter&gt; &lt;filter-mapping&gt; &lt;filter-name&gt;myfilter&lt;/filter-name&gt; &lt;url-pattern&gt;/b.jsp&lt;/url-pattern&gt; &lt;/filter-mapping&gt; 123&lt;body&gt; &lt;h1&gt;b.jsp&lt;/h1&gt; &lt;/body&gt; 12345&lt;h1&gt;a.jsp&lt;/h1&gt; &lt;% request.getRequestDispatcher(\"/b.jsp\").forward(request, response); %&gt; &lt;/body&gt; åœ¨æµè§ˆå™¨è¾“å…¥ï¼š http://localhost:8080/filtertest/b.jsp ç›´æ¥è®¿é—®b.jspæ—¶ï¼Œä¼šæ‰§è¡Œè¿‡æ»¤å™¨å†…å®¹ï¼› http://localhost:8080/filtertest/a.jsp è®¿é—®a.jspï¼Œä½†a.jspä¼šforwardåˆ°b.jspï¼Œè¿™æ—¶å°±ä¸ä¼šæ‰§è¡Œè¿‡æ»¤å™¨ï¼ è¿‡æ»¤å™¨æœ‰å››ç§æ‹¦æˆªæ–¹å¼ï¼åˆ†åˆ«æ˜¯ï¼šREQUESTã€FORWARDã€INCLUDEã€ERRORã€‚ REQUESTï¼šç›´æ¥è®¿é—®ç›®æ ‡èµ„æºæ—¶æ‰§è¡Œè¿‡æ»¤å™¨ã€‚åŒ…æ‹¬ï¼šåœ¨åœ°å€æ ä¸­ç›´æ¥è®¿é—®ã€è¡¨å•æäº¤ã€è¶…é“¾æ¥ã€é‡å®šå‘ï¼Œåªè¦åœ¨åœ°å€æ ä¸­å¯ä»¥çœ‹åˆ°ç›®æ ‡èµ„æºçš„è·¯å¾„ï¼Œå°±æ˜¯REQUEST FORWARDï¼šè½¬å‘è®¿é—®æ‰§è¡Œè¿‡æ»¤å™¨ã€‚åŒ…æ‹¬RequestDispatcher#forward()æ–¹æ³•ã€æ ‡ç­¾éƒ½æ˜¯è½¬å‘è®¿é—® INCLUDEï¼šåŒ…å«è®¿é—®æ‰§è¡Œè¿‡æ»¤å™¨ã€‚åŒ…æ‹¬RequestDispatcher#include()æ–¹æ³•ã€æ ‡ç­¾éƒ½æ˜¯åŒ…å«è®¿é—® ERRORï¼šå½“ç›®æ ‡èµ„æºåœ¨web.xmlä¸­é…ç½®ä¸ºä¸­æ—¶ï¼Œå¹¶ä¸”çœŸçš„å‡ºç°äº†å¼‚å¸¸ï¼Œè½¬å‘åˆ°ç›®æ ‡èµ„æºæ—¶ï¼Œä¼šæ‰§è¡Œè¿‡æ»¤å™¨ã€‚ å¯ä»¥åœ¨ä¸­æ·»åŠ 0~nä¸ªå­å…ƒç´ ï¼Œæ¥è¯´æ˜å½“å‰è®¿é—®çš„æ‹¦æˆªæ–¹å¼ã€‚ å¦‚ï¼š 123456&lt;filter-mapping&gt; &lt;filter-name&gt;myfilter&lt;/filter-name&gt; &lt;url-pattern&gt;/b.jsp&lt;/url-pattern&gt; &lt;dispatcher&gt;REQUEST&lt;/dispatcher&gt; &lt;dispatcher&gt;FORWARD&lt;/dispatcher&gt; &lt;/filter-mapping&gt; æœ€ä¸ºå¸¸ç”¨çš„å°±æ˜¯REQUESTå’ŒFORWARDä¸¤ç§æ‹¦æˆªæ–¹å¼ï¼Œè€ŒINCLUDEå’ŒERRORéƒ½æ¯”è¾ƒå°‘ç”¨ï¼å…¶ä¸­INCLUDEæ¯”è¾ƒå¥½ç†è§£ï¼ŒERRORæ–¹å¼ä¸æ˜“ç†è§£ï¼Œä¸‹é¢ç»™å‡ºERRORæ‹¦æˆªæ–¹å¼çš„ä¾‹å­ï¼š 123456789&lt;filter-mapping&gt; &lt;filter-name&gt;myfilter&lt;/filter-name&gt; &lt;url-pattern&gt;/b.jsp&lt;/url-pattern&gt; &lt;dispatcher&gt;ERROR&lt;/dispatcher&gt; &lt;/filter-mapping&gt; &lt;error-page&gt; &lt;error-code&gt;500&lt;/error-code&gt; &lt;location&gt;/b.jsp&lt;/location&gt; &lt;/error-page&gt; 1234567&lt;body&gt; &lt;h1&gt;a.jsp&lt;/h1&gt; &lt;% if(true) throw new RuntimeException(\"å˜»å˜»~\"); %&gt; &lt;/body&gt; 10ã€Filterä½¿ç”¨æ¡ˆä¾‹ 1ã€ä½¿ç”¨FilteréªŒè¯ç”¨æˆ·ç™»å½•å®‰å…¨æ§åˆ¶ å‰æ®µæ—¶é—´å‚ä¸ç»´æŠ¤ä¸€ä¸ªé¡¹ç›®ï¼Œç”¨æˆ·é€€å‡ºç³»ç»Ÿåï¼Œå†å»åœ°å€æ è®¿é—®å†å²ï¼Œæ ¹æ®urlï¼Œä»ç„¶èƒ½å¤Ÿè¿›å…¥ç³»ç»Ÿå“åº”é¡µé¢ã€‚æˆ‘å»æ£€æŸ¥ä¸€ä¸‹å‘ç°å¯¹è¯·æ±‚æœªè¿›è¡Œè¿‡æ»¤éªŒè¯ç”¨æˆ·ç™»å½•ã€‚æ·»åŠ ä¸€ä¸ªfilteræå®šé—®é¢˜ï¼ å…ˆåœ¨web.xmlé…ç½® 123456789101112131415161718192021222324&lt;filter&gt; &lt;filter-name&gt;SessionFilter&lt;/filter-name&gt; &lt;filter-class&gt;com.action.login.SessionFilter&lt;/filter-class&gt; &lt;init-param&gt; &lt;param-name&gt;logonStrings&lt;/param-name&gt;&lt;!-- å¯¹ç™»å½•é¡µé¢ä¸è¿›è¡Œè¿‡æ»¤ --&gt; &lt;param-value&gt;/project/index.jsp;login.do&lt;/param-value&gt; &lt;/init-param&gt; &lt;init-param&gt; &lt;param-name&gt;includeStrings&lt;/param-name&gt;&lt;!-- åªå¯¹æŒ‡å®šè¿‡æ»¤å‚æ•°åç¼€è¿›è¡Œè¿‡æ»¤ --&gt; &lt;param-value&gt;.do;.jsp&lt;/param-value&gt; &lt;/init-param&gt; &lt;init-param&gt; &lt;param-name&gt;redirectPath&lt;/param-name&gt;&lt;!-- æœªé€šè¿‡è·³è½¬åˆ°ç™»å½•ç•Œé¢ --&gt; &lt;param-value&gt;/index.jsp&lt;/param-value&gt; &lt;/init-param&gt; &lt;init-param&gt; &lt;param-name&gt;disabletestfilter&lt;/param-name&gt;&lt;!-- Y:è¿‡æ»¤æ— æ•ˆ --&gt; &lt;param-value&gt;N&lt;/param-value&gt; &lt;/init-param&gt;&lt;/filter&gt;&lt;filter-mapping&gt; &lt;filter-name&gt;SessionFilter&lt;/filter-name&gt; &lt;url-pattern&gt;/*&lt;/url-pattern&gt;&lt;/filter-mapping&gt; æ¥ç€ç¼–å†™FilterServletï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576package com.action.login;import java.io.IOException;import javax.servlet.Filter;import javax.servlet.FilterChain;import javax.servlet.FilterConfig;import javax.servlet.ServletException;import javax.servlet.ServletRequest;import javax.servlet.ServletResponse;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import javax.servlet.http.HttpServletResponseWrapper;/** * åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»å½•,æœªç™»å½•åˆ™é€€å‡ºç³»ç»Ÿ */public class SessionFilter implements Filter &#123; public FilterConfig config; public void destroy() &#123; this.config = null; &#125; public static boolean isContains(String container, String[] regx) &#123; boolean result = false; for (int i = 0; i &lt; regx.length; i++) &#123; if (container.indexOf(regx[i]) != -1) &#123; return true; &#125; &#125; return result; &#125; public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException &#123; HttpServletRequest hrequest = (HttpServletRequest)request; HttpServletResponseWrapper wrapper = new HttpServletResponseWrapper((HttpServletResponse) response); String logonStrings = config.getInitParameter(\"logonStrings\"); // ç™»å½•ç™»é™†é¡µé¢ String includeStrings = config.getInitParameter(\"includeStrings\"); // è¿‡æ»¤èµ„æºåç¼€å‚æ•° String redirectPath = hrequest.getContextPath() + config.getInitParameter(\"redirectPath\");// æ²¡æœ‰ç™»é™†è½¬å‘é¡µé¢ String disabletestfilter = config.getInitParameter(\"disabletestfilter\");// è¿‡æ»¤å™¨æ˜¯å¦æœ‰æ•ˆ if (disabletestfilter.toUpperCase().equals(\"Y\")) &#123; // è¿‡æ»¤æ— æ•ˆ chain.doFilter(request, response); return; &#125; String[] logonList = logonStrings.split(\";\"); String[] includeList = includeStrings.split(\";\"); if (!this.isContains(hrequest.getRequestURI(), includeList)) &#123;// åªå¯¹æŒ‡å®šè¿‡æ»¤å‚æ•°åç¼€è¿›è¡Œè¿‡æ»¤ chain.doFilter(request, response); return; &#125; if (this.isContains(hrequest.getRequestURI(), logonList)) &#123;// å¯¹ç™»å½•é¡µé¢ä¸è¿›è¡Œè¿‡æ»¤ chain.doFilter(request, response); return; &#125; String user = ( String ) hrequest.getSession().getAttribute(\"useronly\");//åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»å½• if (user == null) &#123; wrapper.sendRedirect(redirectPath); return; &#125;else &#123; chain.doFilter(request, response); return; &#125; &#125; public void init(FilterConfig filterConfig) throws ServletException &#123; config = filterConfig; &#125;&#125; è¿™æ ·æ—¢å¯å®Œæˆå¯¹ç”¨æˆ·æ‰€æœ‰è¯·æ±‚ï¼Œå‡è¦ç»è¿‡è¿™ä¸ªFilterè¿›è¡ŒéªŒè¯ç”¨æˆ·ç™»å½•ã€‚ 2ã€é˜²æ­¢ä¸­æ–‡ä¹±ç è¿‡æ»¤å™¨ é¡¹ç›®ä½¿ç”¨springæ¡†æ¶æ—¶ã€‚å½“å‰å°JSPé¡µé¢å’ŒJAVAä»£ç ä¸­ä½¿ç”¨äº†ä¸åŒçš„å­—ç¬¦é›†è¿›è¡Œç¼–ç çš„æ—¶å€™å°±ä¼šå‡ºç°è¡¨å•æäº¤çš„æ•°æ®æˆ–è€…ä¸Šä¼ /ä¸‹è½½ä¸­æ–‡åç§°æ–‡ä»¶å‡ºç°ä¹±ç çš„é—®é¢˜ï¼Œé‚£å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªè¿‡æ»¤å™¨ã€‚ 12345678910111213141516&lt;filter&gt; &lt;filter-name&gt;encoding&lt;/filter-name&gt; &lt;filter-class&gt;org.springframework.web.filter.CharacterEncodingFilter&lt;/filter-class&gt; &lt;init-param&gt; &lt;param-name&gt;encoding&lt;/param-name&gt;&lt;!--ç”¨æ¥æŒ‡å®šä¸€ä¸ªå…·ä½“çš„å­—ç¬¦é›†--&gt; &lt;param-value&gt;UTF-8&lt;/param-value&gt; &lt;/init-param&gt; &lt;init-param&gt; &lt;param-name&gt;forceEncoding&lt;/param-name&gt;&lt;!--trueï¼šæ— è®ºrequestæ˜¯å¦æŒ‡å®šäº†å­—ç¬¦é›†ï¼Œéƒ½æ˜¯ç”¨encodingï¼›falseï¼šå¦‚æœrequestå·²æŒ‡å®šä¸€ä¸ªå­—ç¬¦é›†ï¼Œåˆ™ä¸ä½¿ç”¨encoding--&gt; &lt;param-value&gt;false&lt;/param-value&gt; &lt;/init-param&gt;&lt;/filter&gt;&lt;filter-mapping&gt; &lt;filter-name&gt;encoding&lt;/filter-name&gt; &lt;url-pattern&gt;/*&lt;/url-pattern&gt;&lt;/filter-mapping&gt; 3ã€Spring+Hibernateçš„OpenSessionInViewFilteræ§åˆ¶sessionçš„å¼€å…³ å½“ hibernate+spring é…åˆä½¿ç”¨çš„æ—¶å€™ï¼Œå¦‚æœè®¾ç½®äº†lazy=trueï¼ˆå»¶è¿ŸåŠ è½½ï¼‰,é‚£ä¹ˆåœ¨è¯»å–æ•°æ®çš„æ—¶å€™ï¼Œå½“è¯»å–äº†çˆ¶æ•°æ®åï¼Œhibernate ä¼šè‡ªåŠ¨å…³é—­ sessionï¼Œè¿™æ ·ï¼Œå½“è¦ä½¿ç”¨ä¸ä¹‹å…³è”æ•°æ®ã€å­æ•°æ®çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šæŠ›å‡ºlazyinitçš„é”™è¯¯ï¼Œè¿™æ—¶å°±éœ€è¦ä½¿ç”¨ spring æä¾›çš„ OpenSessionInViewFilter è¿‡æ»¤å™¨ã€‚ OpenSessionInViewFilterä¸»è¦æ˜¯ä¿æŒ Session çŠ¶æ€ç›´åˆ° request å°†å…¨éƒ¨é¡µé¢å‘é€åˆ°å®¢æˆ·ç«¯ï¼Œç›´åˆ°è¯·æ±‚ç»“æŸåæ‰å…³é—­ sessionï¼Œè¿™æ ·å°±å¯ä»¥è§£å†³å»¶è¿ŸåŠ è½½å¸¦æ¥çš„é—®é¢˜ã€‚ æ³¨æ„ï¼šOpenSessionInViewFilter é…ç½®è¦å†™åœ¨struts2çš„é…ç½®å‰é¢ã€‚å› ä¸º tomcat å®¹å™¨åœ¨åŠ è½½è¿‡æ»¤å™¨çš„æ—¶å€™æ˜¯æŒ‰ç…§é¡ºåºåŠ è½½çš„ï¼Œå¦‚æœé…ç½®æ–‡ä»¶å…ˆå†™çš„æ˜¯ struts2 çš„è¿‡æ»¤å™¨é…ç½®ï¼Œç„¶åæ‰æ˜¯ OpenSessionInViewFilter è¿‡æ»¤å™¨é…ç½®ï¼Œæ‰€ä»¥åŠ è½½çš„é¡ºåºå¯¼è‡´ï¼Œaction åœ¨è·å¾—æ•°æ®çš„æ—¶å€™ session å¹¶æ²¡æœ‰è¢« spring ç®¡ç†ã€‚ 1234567891011121314151617&lt;!-- lazy loading enabled in spring --&gt;&lt;filter&gt; &lt;filter-name&gt;OpenSessionInViewFilter&lt;/filter-name&gt; &lt;filter-class&gt;org.springframework.orm.hibernate3.support.OpenSessionInViewFilter&lt;/filter-class&gt; &lt;init-param&gt; &lt;param-name&gt;sessionFactoryBeanName&lt;/param-name&gt;&lt;!-- å¯ç¼ºçœã€‚é»˜è®¤æ˜¯ä»springå®¹å™¨ä¸­æ‰¾idä¸ºsessionFactoryçš„beanï¼Œå¦‚æœidä¸ä¸ºsessionFactoryï¼Œåˆ™éœ€è¦é…ç½®å¦‚ä¸‹ï¼Œæ­¤å¤„SessionFactoryä¸ºspringå®¹å™¨ä¸­çš„beanã€‚ --&gt; &lt;param-value&gt;sessionFactory&lt;/param-value&gt; &lt;/init-param&gt; &lt;init-param&gt; &lt;param-name&gt;singleSession&lt;/param-name&gt;&lt;!-- singleSessioné»˜è®¤ä¸ºtrue,è‹¥è®¾ä¸ºfalseåˆ™ç­‰äºæ²¡ç”¨OpenSessionInView --&gt; &lt;param-value&gt;true&lt;/param-value&gt; &lt;/init-param&gt;&lt;/filter&gt;&lt;filter-mapping&gt; &lt;filter-name&gt;OpenSessionInViewFilter&lt;/filter-name&gt; &lt;url-pattern&gt;*.do&lt;/url-pattern&gt;&lt;/filter-mapping&gt; 4ã€Struts2çš„web.xmlé…ç½® é¡¹ç›®ä¸­ä½¿ç”¨Struts2åŒæ ·éœ€è¦åœ¨web.xmlé…ç½®è¿‡æ»¤å™¨ï¼Œç”¨æ¥æˆªå–è¯·æ±‚ï¼Œè½¬åˆ°Struts2çš„Actionè¿›è¡Œå¤„ç†ã€‚ æ³¨æ„ï¼šå¦‚æœåœ¨2.1.3ä»¥å‰çš„Struts2ç‰ˆæœ¬ï¼Œè¿‡æ»¤å™¨ä½¿ç”¨org.apache.struts2.dispatcher.FilterDispatcherã€‚å¦åˆ™ä½¿ç”¨org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilterã€‚ä»Struts2.1.3å¼€å§‹ï¼Œå°†åºŸå¼ƒActionContextCleanUpè¿‡æ»¤å™¨ï¼Œè€Œåœ¨StrutsPrepareAndExecuteFilterè¿‡æ»¤å™¨ä¸­åŒ…å«ç›¸åº”çš„åŠŸèƒ½ã€‚ ä¸‰ä¸ªåˆå§‹åŒ–å‚æ•°é…ç½®ï¼š configå‚æ•°ï¼šæŒ‡å®šè¦åŠ è½½çš„é…ç½®æ–‡ä»¶ã€‚é€—å·åˆ†å‰²ã€‚ actionPackageså‚æ•°ï¼šæŒ‡å®šActionç±»æ‰€åœ¨çš„åŒ…ç©ºé—´ã€‚é€—å·åˆ†å‰²ã€‚ configProviderså‚æ•°ï¼šè‡ªå®šä¹‰é…ç½®æ–‡ä»¶æä¾›è€…ï¼Œéœ€è¦å®ç°ConfigurationProvideræ¥å£ç±»ã€‚é€—å·åˆ†å‰²ã€‚ 123456789&lt;!-- struts 2.x filter --&gt;&lt;filter&gt; &lt;filter-name&gt;struts2&lt;/filter-name&gt; &lt;filter-class&gt;org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter&lt;/filter-class&gt;&lt;/filter&gt;&lt;filter-mapping&gt; &lt;filter-name&gt;struts2&lt;/filter-name&gt; &lt;url-pattern&gt;*.do&lt;/url-pattern&gt;&lt;/filter-mapping&gt;","tags":[{"name":"Java","slug":"Java","permalink":"http://www.54tianzhisheng.cn/tags/Java/"},{"name":"Filterè¿‡æ»¤å™¨","slug":"Filterè¿‡æ»¤å™¨","permalink":"http://www.54tianzhisheng.cn/tags/Filterè¿‡æ»¤å™¨/"}]},{"title":"è¯¦ç»†æ·±å…¥åˆ†æ Java ClassLoader å·¥ä½œæœºåˆ¶","date":"2017-06-16T16:00:00.000Z","path":"2017/06/17/è¯¦ç»†æ·±å…¥åˆ†æ Java ClassLoader å·¥ä½œæœºåˆ¶/","text":"ä»€ä¹ˆæ˜¯ ClassLoader ï¼Ÿå¤§å®¶éƒ½çŸ¥é“ï¼Œå½“æˆ‘ä»¬å†™å¥½ä¸€ä¸ª Java ç¨‹åºä¹‹åï¼Œä¸æ˜¯ç®¡æ˜¯ C/S è¿˜æ˜¯ B/S åº”ç”¨ï¼Œéƒ½æ˜¯ç”±è‹¥å¹²ä¸ª .class æ–‡ä»¶ç»„ç»‡è€Œæˆçš„ä¸€ä¸ªå®Œæ•´çš„ Java åº”ç”¨ç¨‹åºï¼Œå½“ç¨‹åºåœ¨è¿è¡Œæ—¶ï¼Œå³ä¼šè°ƒç”¨è¯¥ç¨‹åºçš„ä¸€ä¸ªå…¥å£å‡½æ•°æ¥è°ƒç”¨ç³»ç»Ÿçš„ç›¸å…³åŠŸèƒ½ï¼Œè€Œè¿™äº›åŠŸèƒ½éƒ½è¢«å°è£…åœ¨ä¸åŒçš„ class æ–‡ä»¶å½“ä¸­ï¼Œæ‰€ä»¥ç»å¸¸è¦ä»è¿™ä¸ª class æ–‡ä»¶ä¸­è¦è°ƒç”¨å¦å¤–ä¸€ä¸ª class æ–‡ä»¶ä¸­çš„æ–¹æ³•ï¼Œå¦‚æœå¦å¤–ä¸€ä¸ªæ–‡ä»¶ä¸å­˜åœ¨çš„ï¼Œåˆ™ä¼šå¼•å‘ç³»ç»Ÿå¼‚å¸¸ã€‚è€Œç¨‹åºåœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œå¹¶ä¸ä¼šä¸€æ¬¡æ€§åŠ è½½ç¨‹åºæ‰€è¦ç”¨çš„æ‰€æœ‰classæ–‡ä»¶ï¼Œè€Œæ˜¯æ ¹æ®ç¨‹åºçš„éœ€è¦ï¼Œé€šè¿‡Javaçš„ç±»åŠ è½½æœºåˆ¶ï¼ˆClassLoaderï¼‰æ¥åŠ¨æ€åŠ è½½æŸä¸ª class æ–‡ä»¶åˆ°å†…å­˜å½“ä¸­çš„ï¼Œä»è€Œåªæœ‰ class æ–‡ä»¶è¢«è½½å…¥åˆ°äº†å†…å­˜ä¹‹åï¼Œæ‰èƒ½è¢«å…¶å®ƒ class æ‰€å¼•ç”¨ã€‚æ‰€ä»¥ ClassLoader å°±æ˜¯ç”¨æ¥åŠ¨æ€åŠ è½½ class æ–‡ä»¶åˆ°å†…å­˜å½“ä¸­ç”¨çš„ã€‚ ClassLoader ä½œç”¨ï¼š è´Ÿè´£å°† Class åŠ è½½åˆ° JVM ä¸­ å®¡æŸ¥æ¯ä¸ªç±»ç”±è°åŠ è½½ï¼ˆçˆ¶ä¼˜å…ˆçš„ç­‰çº§åŠ è½½æœºåˆ¶ï¼‰ å°† Class å­—èŠ‚ç é‡æ–°è§£ææˆ JVM ç»Ÿä¸€è¦æ±‚çš„å¯¹è±¡æ ¼å¼ 1ã€ClassLoader ç±»ç»“æ„åˆ†æä¸ºäº†æ›´å¥½çš„ç†è§£ç±»çš„åŠ è½½æœºåˆ¶ï¼Œæˆ‘ä»¬æ¥æ·±å…¥ç ”ç©¶ä¸€ä¸‹ ClassLoader å’Œä»–çš„æ–¹æ³•ã€‚ public abstract class ClassLoader ClassLoaderç±»æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œsunå…¬å¸æ˜¯è¿™ä¹ˆè§£é‡Šè¿™ä¸ªç±»çš„ï¼š 1234567/** * A class loader is an object that is responsible for loading classes. The * class ClassLoader is an abstract class. Given the binary name of a class, a class loader should attempt to * locate or generate data that constitutes a definition for the class. A * typical strategy is to transform the name into a file name and then read a * &quot;class file&quot; of that name from a file system.**/ å¤§è‡´æ„æ€å¦‚ä¸‹ï¼š class loader æ˜¯ä¸€ä¸ªè´Ÿè´£åŠ è½½ classes çš„å¯¹è±¡ï¼ŒClassLoader ç±»æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œéœ€è¦ç»™å‡ºç±»çš„äºŒè¿›åˆ¶åç§°ï¼Œclass loader å°è¯•å®šä½æˆ–è€…äº§ç”Ÿä¸€ä¸ª class çš„æ•°æ®ï¼Œä¸€ä¸ªå…¸å‹çš„ç­–ç•¥æ˜¯æŠŠäºŒè¿›åˆ¶åå­—è½¬æ¢æˆæ–‡ä»¶åç„¶ååˆ°æ–‡ä»¶ç³»ç»Ÿä¸­æ‰¾åˆ°è¯¥æ–‡ä»¶ã€‚ ä»¥ä¸‹æ˜¯ ClassLoader å¸¸ç”¨åˆ°çš„å‡ ä¸ªæ–¹æ³•åŠå…¶é‡è½½æ–¹æ³•ï¼š ClassLoader defineClass(byte[], int, int) æŠŠå­—èŠ‚æ•°ç»„ bä¸­çš„å†…å®¹è½¬æ¢æˆ Java ç±»ï¼Œè¿”å›çš„ç»“æœæ˜¯java.lang.Classç±»çš„å®ä¾‹ã€‚è¿™ä¸ªæ–¹æ³•è¢«å£°æ˜ä¸ºfinalçš„ findClass(String name) æŸ¥æ‰¾åç§°ä¸º nameçš„ç±»ï¼Œè¿”å›çš„ç»“æœæ˜¯java.lang.Classç±»çš„å®ä¾‹ loadClass(String name) åŠ è½½åç§°ä¸º nameçš„ç±»ï¼Œè¿”å›çš„ç»“æœæ˜¯java.lang.Classç±»çš„å®ä¾‹ resolveClass(Class&lt;?&gt;) é“¾æ¥æŒ‡å®šçš„ Java ç±» å…¶ä¸­ defineClass æ–¹æ³•ç”¨æ¥å°† byte å­—èŠ‚æµè§£ææˆ JVM èƒ½å¤Ÿè¯†åˆ«çš„ Class å¯¹è±¡ï¼Œæœ‰äº†è¿™ä¸ªæ–¹æ³•æ„å‘³ç€æˆ‘ä»¬ä¸ä»…ä»…å¯ä»¥é€šè¿‡ class æ–‡ä»¶å®ä¾‹åŒ–å¯¹è±¡ï¼Œè¿˜å¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼å®ä¾‹åŒ–å¯¹è±¡ï¼Œå¦‚æœæˆ‘ä»¬é€šè¿‡ç½‘ç»œæ¥æ”¶åˆ°ä¸€ä¸ªç±»çš„å­—èŠ‚ç ï¼Œæ‹¿åˆ°è¿™ä¸ªå­—èŠ‚ç æµç›´æ¥åˆ›å»ºç±»çš„ Class å¯¹è±¡å½¢å¼å®ä¾‹åŒ–å¯¹è±¡ã€‚å¦‚æœç›´æ¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•ç”Ÿæˆç±»çš„ Class å¯¹è±¡ï¼Œè¿™ä¸ªç±»çš„ Class å¯¹è±¡è¿˜æ²¡æœ‰ resolve ï¼Œè¿™ä¸ª resolve å°†ä¼šåœ¨è¿™ä¸ªå¯¹è±¡çœŸæ­£å®ä¾‹åŒ–æ—¶æ‰è¿›è¡Œã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹loadClassæ–¹æ³•çš„å®ç°æ–¹å¼ï¼š 123456789101112131415161718192021222324252627282930313233343536protected Class&gt; loadClass(String name, boolean resolve) throws ClassNotFoundException &#123; synchronized (getClassLoadingLock(name)) &#123; // First, check if the class has already been loaded Class c = findLoadedClass(name); if (c == null) &#123; long t0 = System.nanoTime(); try &#123; if (parent != null) &#123; c = parent.loadClass(name, false); &#125; else &#123; c = findBootstrapClassOrNull(name); &#125; &#125; catch (ClassNotFoundException e) &#123; // ClassNotFoundException thrown if class not found // from the non-null parent class loader &#125; if (c == null) &#123; // If still not found, then invoke findClass in order // to find the class. long t1 = System.nanoTime(); c = findClass(name); // this is the defining class loader; record the stats sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0); sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1); sun.misc.PerfCounter.getFindClasses().increment(); &#125; &#125; if (resolve) &#123; resolveClass(c); &#125; return c; &#125; &#125; è¯¥æ–¹æ³•å¤§æ¦‚æ„æ€ï¼š ä½¿ç”¨æŒ‡å®šçš„äºŒè¿›åˆ¶åç§°æ¥åŠ è½½ç±»ï¼Œè¿™ä¸ªæ–¹æ³•çš„é»˜è®¤å®ç°æŒ‰ç…§ä»¥ä¸‹é¡ºåºæŸ¥æ‰¾ç±»ï¼š è°ƒç”¨findLoadedClass(String) æ–¹æ³•æ£€æŸ¥è¿™ä¸ªç±»æ˜¯å¦è¢«åŠ è½½è¿‡ ä½¿ç”¨çˆ¶åŠ è½½å™¨è°ƒç”¨ loadClass(String) æ–¹æ³•ï¼Œå¦‚æœçˆ¶åŠ è½½å™¨ä¸º Nullï¼Œç±»åŠ è½½å™¨è£…è½½è™šæ‹Ÿæœºå†…ç½®çš„åŠ è½½å™¨è°ƒç”¨ findClass(String) æ–¹æ³•è£…è½½ç±»ï¼Œ å¦‚æœï¼ŒæŒ‰ç…§ä»¥ä¸Šçš„æ­¥éª¤æˆåŠŸçš„æ‰¾åˆ°å¯¹åº”çš„ç±»ï¼Œå¹¶ä¸”è¯¥æ–¹æ³•æ¥æ”¶çš„ resolve å‚æ•°çš„å€¼ä¸º true,é‚£ä¹ˆå°±è°ƒç”¨resolveClass(Class) æ–¹æ³•æ¥å¤„ç†ç±»ã€‚ ClassLoader çš„å­ç±»æœ€å¥½è¦†ç›– findClass(String) è€Œä¸æ˜¯è¿™ä¸ªæ–¹æ³•ã€‚ é™¤éè¢«é‡å†™ï¼Œè¿™ä¸ªæ–¹æ³•é»˜è®¤åœ¨æ•´ä¸ªè£…è½½è¿‡ç¨‹ä¸­éƒ½æ˜¯åŒæ­¥çš„ï¼ˆçº¿ç¨‹å®‰å…¨çš„ï¼‰ã€‚ 2ã€ClassLoader çš„ç­‰çº§åŠ è½½æœºåˆ¶Javaé»˜è®¤æä¾›çš„ä¸‰ä¸ªClassLoader BootStrap ClassLoaderï¼šç§°ä¸ºå¯åŠ¨ç±»åŠ è½½å™¨ï¼Œæ˜¯Javaç±»åŠ è½½å±‚æ¬¡ä¸­æœ€é¡¶å±‚çš„ç±»åŠ è½½å™¨ï¼Œè´Ÿè´£åŠ è½½JDKä¸­çš„æ ¸å¿ƒç±»åº“ï¼Œå¦‚ï¼šrt.jarã€resources.jarã€charsets.jarç­‰ï¼Œå¯é€šè¿‡å¦‚ä¸‹ç¨‹åºè·å¾—è¯¥ç±»åŠ è½½å™¨ä»å“ªäº›åœ°æ–¹åŠ è½½äº†ç›¸å…³çš„jaræˆ–classæ–‡ä»¶ï¼š 12345678910public class BootStrapTest&#123; public static void main(String[] args) &#123; URL[] urls = sun.misc.Launcher.getBootstrapClassPath().getURLs(); for (int i = 0; i &lt; urls.length; i++) &#123; System.out.println(urls[i].toExternalForm()); &#125; &#125;&#125; ä»¥ä¸‹å†…å®¹æ˜¯ä¸Šè¿°ç¨‹åºä»æœ¬æœºJDKç¯å¢ƒæ‰€è·å¾—çš„ç»“æœï¼š å…¶å®ä¸Šè¿°ç»“æœä¹Ÿæ˜¯é€šè¿‡æŸ¥æ‰¾ sun.boot.class.path è¿™ä¸ªç³»ç»Ÿå±æ€§æ‰€å¾—çŸ¥çš„ã€‚ 1System.out.println(System.getProperty(\"sun.boot.class.path\")); 1æ‰“å°ç»“æœï¼šC:\\Java\\jdk1.8.0_60\\jre\\lib\\resources.jar;C:\\Java\\jdk1.8.0_60\\jre\\lib\\rt.jar;C:\\Java\\jdk1.8.0_60\\jre\\lib\\sunrsasign.jar;C:\\Java\\jdk1.8.0_60\\jre\\lib\\jsse.jar;C:\\Java\\jdk1.8.0_60\\jre\\lib\\jce.jar;C:\\Java\\jdk1.8.0_60\\jre\\lib\\charsets.jar;C:\\Java\\jdk1.8.0_60\\jre\\lib\\jfr.jar;C:\\Java\\jdk1.8.0_60\\jre\\classes Extension ClassLoaderï¼šç§°ä¸ºæ‰©å±•ç±»åŠ è½½å™¨ï¼Œè´Ÿè´£åŠ è½½Javaçš„æ‰©å±•ç±»åº“ï¼ŒJava è™šæ‹Ÿæœºçš„å®ç°ä¼šæä¾›ä¸€ä¸ªæ‰©å±•åº“ç›®å½•ã€‚è¯¥ç±»åŠ è½½å™¨åœ¨æ­¤ç›®å½•é‡Œé¢æŸ¥æ‰¾å¹¶åŠ è½½ Java ç±»ã€‚é»˜è®¤åŠ è½½JAVA_HOME/jre/lib/ext/ç›®ä¸‹çš„æ‰€æœ‰jarã€‚ App ClassLoaderï¼šç§°ä¸ºç³»ç»Ÿç±»åŠ è½½å™¨ï¼Œè´Ÿè´£åŠ è½½åº”ç”¨ç¨‹åºclasspathç›®å½•ä¸‹çš„æ‰€æœ‰jarå’Œclassæ–‡ä»¶ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒJava åº”ç”¨çš„ç±»éƒ½æ˜¯ç”±å®ƒæ¥å®ŒæˆåŠ è½½çš„ã€‚å¯ä»¥é€šè¿‡ ClassLoader.getSystemClassLoader()æ¥è·å–å®ƒã€‚ â€‹ é™¤äº†ç³»ç»Ÿæä¾›çš„ç±»åŠ è½½å™¨ä»¥å¤–ï¼Œå¼€å‘äººå‘˜å¯ä»¥é€šè¿‡ç»§æ‰¿java.lang.ClassLoaderç±»çš„æ–¹å¼å®ç°è‡ªå·±çš„ç±»åŠ è½½å™¨ï¼Œä»¥æ»¡è¶³ä¸€äº›ç‰¹æ®Šçš„éœ€æ±‚ã€‚ é™¤äº†å¼•å¯¼ç±»åŠ è½½å™¨ä¹‹å¤–ï¼Œæ‰€æœ‰çš„ç±»åŠ è½½å™¨éƒ½æœ‰ä¸€ä¸ªçˆ¶ç±»åŠ è½½å™¨ã€‚ ç»™å‡ºçš„ getParent()æ–¹æ³•å¯ä»¥å¾—åˆ°ã€‚å¯¹äºç³»ç»Ÿæä¾›çš„ç±»åŠ è½½å™¨æ¥è¯´ï¼Œç³»ç»Ÿç±»åŠ è½½å™¨çš„çˆ¶ç±»åŠ è½½å™¨æ˜¯æ‰©å±•ç±»åŠ è½½å™¨ï¼Œè€Œæ‰©å±•ç±»åŠ è½½å™¨çš„çˆ¶ç±»åŠ è½½å™¨æ˜¯å¼•å¯¼ç±»åŠ è½½å™¨ï¼›å¯¹äºå¼€å‘äººå‘˜ç¼–å†™çš„ç±»åŠ è½½å™¨æ¥è¯´ï¼Œå…¶çˆ¶ç±»åŠ è½½å™¨æ˜¯åŠ è½½æ­¤ç±»åŠ è½½å™¨ Java ç±»çš„ç±»åŠ è½½å™¨ã€‚å› ä¸ºç±»åŠ è½½å™¨ Java ç±»å¦‚åŒå…¶å®ƒçš„ Java ç±»ä¸€æ ·ï¼Œä¹Ÿæ˜¯è¦ç”±ç±»åŠ è½½å™¨æ¥åŠ è½½çš„ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¼€å‘äººå‘˜ç¼–å†™çš„ç±»åŠ è½½å™¨çš„çˆ¶ç±»åŠ è½½å™¨æ˜¯ç³»ç»Ÿç±»åŠ è½½å™¨ã€‚ç±»åŠ è½½å™¨é€šè¿‡è¿™ç§æ–¹å¼ç»„ç»‡èµ·æ¥ï¼Œå½¢æˆæ ‘çŠ¶ç»“æ„ã€‚æ ‘çš„æ ¹èŠ‚ç‚¹å°±æ˜¯å¼•å¯¼ç±»åŠ è½½å™¨ã€‚ â€‹ ClassLoaderåŠ è½½ç±»çš„åŸç†1. åŸç†ä»‹ç»ClassLoaderä½¿ç”¨çš„æ˜¯åŒäº²å§”æ‰˜æ¨¡å‹æ¥æœç´¢ç±»çš„ï¼Œæ¯ä¸ªClassLoaderå®ä¾‹éƒ½æœ‰ä¸€ä¸ªçˆ¶ç±»åŠ è½½å™¨çš„å¼•ç”¨ï¼ˆä¸æ˜¯ç»§æ‰¿çš„å…³ç³»ï¼Œæ˜¯ä¸€ä¸ªåŒ…å«çš„å…³ç³»ï¼‰ï¼Œè™šæ‹Ÿæœºå†…ç½®çš„ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰æœ¬èº«æ²¡æœ‰çˆ¶ç±»åŠ è½½å™¨ï¼Œä½†å¯ä»¥ç”¨ä½œå…¶å®ƒClassLoaderå®ä¾‹çš„çš„çˆ¶ç±»åŠ è½½å™¨ã€‚å½“ä¸€ä¸ªClassLoaderå®ä¾‹éœ€è¦åŠ è½½æŸä¸ªç±»æ—¶ï¼Œå®ƒä¼šè¯•å›¾äº²è‡ªæœç´¢æŸä¸ªç±»ä¹‹å‰ï¼Œå…ˆæŠŠè¿™ä¸ªä»»åŠ¡å§”æ‰˜ç»™å®ƒçš„çˆ¶ç±»åŠ è½½å™¨ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯ç”±ä¸Šè‡³ä¸‹ä¾æ¬¡æ£€æŸ¥çš„ï¼Œé¦–å…ˆç”±æœ€é¡¶å±‚çš„ç±»åŠ è½½å™¨Bootstrap ClassLoaderè¯•å›¾åŠ è½½ï¼Œå¦‚æœæ²¡åŠ è½½åˆ°ï¼Œåˆ™æŠŠä»»åŠ¡è½¬äº¤ç»™Extension ClassLoaderè¯•å›¾åŠ è½½ï¼Œå¦‚æœä¹Ÿæ²¡åŠ è½½åˆ°ï¼Œåˆ™è½¬äº¤ç»™App ClassLoaderè¿›è¡ŒåŠ è½½ï¼Œå¦‚æœå®ƒä¹Ÿæ²¡æœ‰åŠ è½½å¾—åˆ°çš„è¯ï¼Œåˆ™è¿”å›ç»™å§”æ‰˜çš„å‘èµ·è€…ï¼Œç”±å®ƒåˆ°æŒ‡å®šçš„æ–‡ä»¶ç³»ç»Ÿæˆ–ç½‘ç»œç­‰URLä¸­åŠ è½½è¯¥ç±»ã€‚å¦‚æœå®ƒä»¬éƒ½æ²¡æœ‰åŠ è½½åˆ°è¿™ä¸ªç±»æ—¶ï¼Œåˆ™æŠ›å‡ºClassNotFoundExceptionå¼‚å¸¸ã€‚å¦åˆ™å°†è¿™ä¸ªæ‰¾åˆ°çš„ç±»ç”Ÿæˆä¸€ä¸ªç±»çš„å®šä¹‰ï¼Œå¹¶å°†å®ƒåŠ è½½åˆ°å†…å­˜å½“ä¸­ï¼Œæœ€åè¿”å›è¿™ä¸ªç±»åœ¨å†…å­˜ä¸­çš„Classå®ä¾‹å¯¹è±¡ã€‚ 2ã€ä¸ºä»€ä¹ˆè¦ä½¿ç”¨åŒäº²å§”æ‰˜è¿™ç§æ¨¡å‹å‘¢ï¼Ÿå› ä¸ºè¿™æ ·å¯ä»¥é¿å…é‡å¤åŠ è½½ï¼Œå½“çˆ¶äº²å·²ç»åŠ è½½äº†è¯¥ç±»çš„æ—¶å€™ï¼Œå°±æ²¡æœ‰å¿…è¦ ClassLoaderå†åŠ è½½ä¸€æ¬¡ã€‚è€ƒè™‘åˆ°å®‰å…¨å› ç´ ï¼Œæˆ‘ä»¬è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœä¸ä½¿ç”¨è¿™ç§å§”æ‰˜æ¨¡å¼ï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥éšæ—¶ä½¿ç”¨è‡ªå®šä¹‰çš„Stringæ¥åŠ¨æ€æ›¿ä»£javaæ ¸å¿ƒapiä¸­å®šä¹‰çš„ç±»å‹ï¼Œè¿™æ ·ä¼šå­˜åœ¨éå¸¸å¤§çš„å®‰å…¨éšæ‚£ï¼Œè€ŒåŒäº²å§”æ‰˜çš„æ–¹å¼ï¼Œå°±å¯ä»¥é¿å…è¿™ç§æƒ…å†µï¼Œå› ä¸ºStringå·²ç»åœ¨å¯åŠ¨æ—¶å°±è¢«å¼•å¯¼ç±»åŠ è½½å™¨ï¼ˆBootstrcp ClassLoaderï¼‰åŠ è½½ï¼Œæ‰€ä»¥ç”¨æˆ·è‡ªå®šä¹‰çš„ClassLoaderæ°¸è¿œä¹Ÿæ— æ³•åŠ è½½ä¸€ä¸ªè‡ªå·±å†™çš„Stringï¼Œé™¤éä½ æ”¹å˜JDKä¸­ClassLoaderæœç´¢ç±»çš„é»˜è®¤ç®—æ³•ã€‚ 3ã€ ä½†æ˜¯JVMåœ¨æœç´¢ç±»çš„æ—¶å€™ï¼Œåˆæ˜¯å¦‚ä½•åˆ¤å®šä¸¤ä¸ªclassæ˜¯ç›¸åŒçš„å‘¢ï¼ŸJVMåœ¨åˆ¤å®šä¸¤ä¸ªclassæ˜¯å¦ç›¸åŒæ—¶ï¼Œä¸ä»…è¦åˆ¤æ–­ä¸¤ä¸ªç±»åæ˜¯å¦ç›¸åŒï¼Œè€Œä¸”è¦åˆ¤æ–­æ˜¯å¦ç”±åŒä¸€ä¸ªç±»åŠ è½½å™¨å®ä¾‹åŠ è½½çš„ã€‚åªæœ‰ä¸¤è€…åŒæ—¶æ»¡è¶³çš„æƒ…å†µä¸‹ï¼ŒJVMæ‰è®¤ä¸ºè¿™ä¸¤ä¸ªclassæ˜¯ç›¸åŒçš„ã€‚å°±ç®—ä¸¤ä¸ªclassæ˜¯åŒä¸€ä»½classå­—èŠ‚ç ï¼Œå¦‚æœè¢«ä¸¤ä¸ªä¸åŒçš„ClassLoaderå®ä¾‹æ‰€åŠ è½½ï¼ŒJVMä¹Ÿä¼šè®¤ä¸ºå®ƒä»¬æ˜¯ä¸¤ä¸ªä¸åŒclassã€‚æ¯”å¦‚ç½‘ç»œä¸Šçš„ä¸€ä¸ªJavaç±»org.classloader.simple.NetClassLoaderSimpleï¼Œjavacç¼–è¯‘ä¹‹åç”Ÿæˆå­—èŠ‚ç æ–‡ä»¶NetClassLoaderSimple.classï¼ŒClassLoaderAå’ŒClassLoaderBè¿™ä¸¤ä¸ªç±»åŠ è½½å™¨å¹¶è¯»å–äº†NetClassLoaderSimple.classæ–‡ä»¶ï¼Œå¹¶åˆ†åˆ«å®šä¹‰å‡ºäº†java.lang.Classå®ä¾‹æ¥è¡¨ç¤ºè¿™ä¸ªç±»ï¼Œå¯¹äºJVMæ¥è¯´ï¼Œå®ƒä»¬æ˜¯ä¸¤ä¸ªä¸åŒçš„å®ä¾‹å¯¹è±¡ï¼Œä½†å®ƒä»¬ç¡®å®æ˜¯åŒä¸€ä»½å­—èŠ‚ç æ–‡ä»¶ï¼Œå¦‚æœè¯•å›¾å°†è¿™ä¸ªClasså®ä¾‹ç”Ÿæˆå…·ä½“çš„å¯¹è±¡è¿›è¡Œè½¬æ¢æ—¶ï¼Œå°±ä¼šæŠ›è¿è¡Œæ—¶å¼‚å¸¸java.lang.ClassCaseExceptionï¼Œæç¤ºè¿™æ˜¯ä¸¤ä¸ªä¸åŒçš„ç±»å‹ã€‚ç°åœ¨é€šè¿‡å®ä¾‹æ¥éªŒè¯ä¸Šè¿°æ‰€æè¿°çš„æ˜¯å¦æ­£ç¡®ï¼š1ï¼‰ã€åœ¨webæœåŠ¡å™¨ä¸Šå»ºä¸€ä¸ªorg.classloader.simple.NetClassLoaderSimple.javaç±» 1234567public class NetClassLoaderSimple&#123; private NetClassLoaderSimple instance; public void setNetClassLoaderSimple(Object object)&#123; this.instance = (NetClassLoaderSimple)object; &#125;&#125; org.classloader.simple.NetClassLoaderSimpleç±»çš„setNetClassLoaderSimpleæ–¹æ³•æ¥æ”¶ä¸€ä¸ªObjectç±»å‹å‚æ•°ï¼Œå¹¶å°†å®ƒå¼ºåˆ¶è½¬æ¢æˆorg.classloader.simple.NetClassLoaderSimpleç±»å‹ã€‚ 2ï¼‰ã€æµ‹è¯•ä¸¤ä¸ªclassæ˜¯å¦ç›¸åŒ NetWorkClassLoader.java 12345678910111213141516171819202122package classloader;public class NewworkClassLoaderTest &#123; public static void main(String[] args) &#123; try &#123; //æµ‹è¯•åŠ è½½ç½‘ç»œä¸­çš„classæ–‡ä»¶ String rootUrl = &quot;http://localhost:8080/httpweb/classes&quot;; String className = &quot;org.classloader.simple.NetClassLoaderSimple&quot;; NetworkClassLoader ncl1 = new NetworkClassLoader(rootUrl); NetworkClassLoader ncl2 = new NetworkClassLoader(rootUrl); Class&lt;?&gt; clazz1 = ncl1.loadClass(className); Class&lt;?&gt; clazz2 = ncl2.loadClass(className); Object obj1 = clazz1.newInstance(); Object obj2 = clazz2.newInstance(); clazz1.getMethod(&quot;setNetClassLoaderSimple&quot;, Object.class).invoke(obj1, obj2); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125;&#125; é¦–å…ˆè·å¾—ç½‘ç»œä¸Šä¸€ä¸ªclassæ–‡ä»¶çš„äºŒè¿›åˆ¶åç§°ï¼Œç„¶åé€šè¿‡è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨NetworkClassLoaderåˆ›å»ºä¸¤ä¸ªå®ä¾‹ï¼Œå¹¶æ ¹æ®ç½‘ç»œåœ°å€åˆ†åˆ«åŠ è½½è¿™ä»½classï¼Œå¹¶å¾—åˆ°è¿™ä¸¤ä¸ªClassLoaderå®ä¾‹åŠ è½½åç”Ÿæˆçš„Classå®ä¾‹clazz1å’Œclazz2ï¼Œæœ€åå°†è¿™ä¸¤ä¸ªClasså®ä¾‹åˆ†åˆ«ç”Ÿæˆå…·ä½“çš„å®ä¾‹å¯¹è±¡obj1å’Œobj2ï¼Œå†é€šè¿‡åå°„è°ƒç”¨clazz1ä¸­çš„setNetClassLoaderSimpleæ–¹æ³•ã€‚ 3ï¼‰ã€æŸ¥çœ‹æµ‹è¯•ç»“æœ ç»“è®ºï¼šä»ç»“æœä¸­å¯ä»¥çœ‹å‡ºï¼Œè¿è¡Œæ—¶æŠ›å‡ºäº†java.lang.ClassCastExceptionå¼‚å¸¸ã€‚è™½ç„¶ä¸¤ä¸ªå¯¹è±¡obj1å’Œ obj2çš„ç±»çš„åå­—ç›¸åŒï¼Œä½†æ˜¯è¿™ä¸¤ä¸ªç±»æ˜¯ç”±ä¸åŒçš„ç±»åŠ è½½å™¨å®ä¾‹æ¥åŠ è½½çš„ï¼Œæ‰€ä»¥JVMè®¤ä¸ºå®ƒä»¬å°±æ˜¯ä¸¤ä¸ªä¸åŒçš„ç±»ã€‚ äº†è§£äº†è¿™ä¸€ç‚¹ä¹‹åï¼Œå°±å¯ä»¥ç†è§£ä»£ç†æ¨¡å¼çš„è®¾è®¡åŠ¨æœºäº†ã€‚ä»£ç†æ¨¡å¼æ˜¯ä¸ºäº†ä¿è¯ Java æ ¸å¿ƒåº“çš„ç±»å‹å®‰å…¨ã€‚æ‰€æœ‰ Java åº”ç”¨éƒ½è‡³å°‘éœ€è¦å¼•ç”¨ java.lang.Objectç±»ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨è¿è¡Œçš„æ—¶å€™ï¼Œjava.lang.Objectè¿™ä¸ªç±»éœ€è¦è¢«åŠ è½½åˆ° Java è™šæ‹Ÿæœºä¸­ã€‚å¦‚æœè¿™ä¸ªåŠ è½½è¿‡ç¨‹ç”± Java åº”ç”¨è‡ªå·±çš„ç±»åŠ è½½å™¨æ¥å®Œæˆçš„è¯ï¼Œå¾ˆå¯èƒ½å°±å­˜åœ¨å¤šä¸ªç‰ˆæœ¬çš„ java.lang.Objectç±»ï¼Œè€Œä¸”è¿™äº›ç±»ä¹‹é—´æ˜¯ä¸å…¼å®¹çš„ã€‚é€šè¿‡ä»£ç†æ¨¡å¼ï¼Œå¯¹äº Java æ ¸å¿ƒåº“çš„ç±»çš„åŠ è½½å·¥ä½œç”±å¼•å¯¼ç±»åŠ è½½å™¨æ¥ç»Ÿä¸€å®Œæˆï¼Œä¿è¯äº†Java åº”ç”¨æ‰€ä½¿ç”¨çš„éƒ½æ˜¯åŒä¸€ä¸ªç‰ˆæœ¬çš„ Java æ ¸å¿ƒåº“çš„ç±»ï¼Œæ˜¯äº’ç›¸å…¼å®¹çš„ã€‚ ä¸åŒçš„ç±»åŠ è½½å™¨ä¸ºç›¸åŒåç§°çš„ç±»åˆ›å»ºäº†é¢å¤–çš„åç§°ç©ºé—´ã€‚ç›¸åŒåç§°çš„ç±»å¯ä»¥å¹¶å­˜åœ¨ Java è™šæ‹Ÿæœºä¸­ï¼Œåªéœ€è¦ç”¨ä¸åŒçš„ç±»åŠ è½½å™¨æ¥åŠ è½½å®ƒä»¬å³å¯ã€‚ä¸åŒç±»åŠ è½½å™¨åŠ è½½çš„ç±»ä¹‹é—´æ˜¯ä¸å…¼å®¹çš„ï¼Œè¿™å°±ç›¸å½“äºåœ¨ Java è™šæ‹Ÿæœºå†…éƒ¨åˆ›å»ºäº†ä¸€ä¸ªä¸ªç›¸äº’éš”ç¦»çš„ Java ç±»ç©ºé—´ã€‚ ClassLoaderçš„ä½“ç³»æ¶æ„ï¼š ç±»åŠ è½½å™¨çš„æ ‘çŠ¶ç»„ç»‡ç»“æ„æµ‹è¯•ä¸€ï¼š 1234567891011public class ClassLoaderTree&#123; public static void main(String[] args) &#123; ClassLoader loader = ClassLoaderTree.class.getClassLoader(); while (loader!=null)&#123; System.out.println(loader.toString()); loader = loader.getParent(); &#125; System.out.println(loader); &#125;&#125; æ¯ä¸ª Java ç±»éƒ½ç»´æŠ¤ç€ä¸€ä¸ªæŒ‡å‘å®šä¹‰å®ƒçš„ç±»åŠ è½½å™¨çš„å¼•ç”¨ï¼Œé€šè¿‡ getClassLoader()æ–¹æ³•å°±å¯ä»¥è·å–åˆ°æ­¤å¼•ç”¨ã€‚ä»£ç ä¸­é€šè¿‡é€’å½’è°ƒç”¨ getParent()æ–¹æ³•æ¥è¾“å‡ºå…¨éƒ¨çš„çˆ¶ç±»åŠ è½½å™¨ã€‚ ç»“æœæ˜¯ï¼š ç¬¬ä¸€ä¸ªè¾“å‡ºçš„æ˜¯ClassLoaderTreeç±»çš„ç±»åŠ è½½å™¨ï¼Œå³ç³»ç»Ÿç±»åŠ è½½å™¨ã€‚å®ƒæ˜¯sun.misc.Launcher$AppClassLoaderç±»çš„å®ä¾‹ï¼›ç¬¬äºŒä¸ªè¾“å‡ºçš„æ˜¯æ‰©å±•ç±»åŠ è½½å™¨ï¼Œæ˜¯sun.misc.Launcher$ExtClassLoaderç±»çš„å®ä¾‹ã€‚éœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œå¹¶æ²¡æœ‰è¾“å‡ºå¼•å¯¼ç±»åŠ è½½å™¨ï¼Œè¿™æ˜¯ç”±äºæœ‰äº› JDK çš„å®ç°å¯¹äºçˆ¶ç±»åŠ è½½å™¨æ˜¯å¼•å¯¼ç±»åŠ è½½å™¨çš„æƒ…å†µï¼ŒgetParent()æ–¹æ³•è¿”å› nullã€‚ç¬¬ä¸‰è¡Œç»“æœè¯´æ˜ï¼šExtClassLoaderçš„ç±»åŠ å™¨æ˜¯Bootstrap ClassLoaderï¼Œå› ä¸ºBootstrap ClassLoaderä¸æ˜¯ä¸€ä¸ªæ™®é€šçš„Javaç±»ï¼Œæ‰€ä»¥ExtClassLoaderçš„parent=nullï¼Œæ‰€ä»¥ç¬¬ä¸‰è¡Œçš„æ‰“å°ç»“æœä¸ºnullå°±æ˜¯è¿™ä¸ªåŸå› ã€‚ æµ‹è¯•äºŒï¼š å°†ClassLoaderTree.classæ‰“åŒ…æˆClassLoaderTree.jarï¼Œæ”¾åˆ°Extension ClassLoaderçš„åŠ è½½ç›®å½•ä¸‹ï¼ˆJAVA_HOME/jre/lib/extï¼‰ï¼Œç„¶åé‡æ–°è¿è¡Œè¿™ä¸ªç¨‹åºï¼Œå¾—åˆ°çš„ç»“æœä¼šæ˜¯ä»€ä¹ˆæ ·å‘¢ï¼Ÿ æ­¤å¤„æˆ‘åœ¨ IDEA ä¸­çš„è¿è¡Œç»“æœè¿˜å’Œä¸Šé¢çš„ä¸€æ ·ï¼Œä¸æ–‡ç«  æ·±å…¥åˆ†æJava ClassLoaderåŸç† ä¸­çš„æœ‰å·®è·ï¼Œå…·ä½“åŸå› æœªå¼„æ¸…æ¥šï¼Œè¿˜å¸Œæœ›è¯»è€…èƒ½å¤Ÿäº²è‡ªæµ‹è¯•ã€‚ é‚£æ–‡ç« ä¸­çš„ç»“æœæ˜¯ï¼š æ‰“å°ç»“æœåˆ†æï¼šä¸ºä»€ä¹ˆç¬¬ä¸€è¡Œçš„ç»“æœæ˜¯ExtClassLoaderå‘¢ï¼Ÿ å› ä¸º ClassLoader çš„å§”æ‰˜æ¨¡å‹æœºåˆ¶ï¼Œå½“æˆ‘ä»¬è¦ç”¨ ClassLoaderTest.class è¿™ä¸ªç±»çš„æ—¶å€™ï¼ŒAppClassLoader åœ¨è¯•å›¾åŠ è½½ä¹‹å‰ï¼Œå…ˆå§”æ‰˜ç»™ Bootstrcp ClassLoaderï¼ŒBootstracp ClassLoader å‘ç°è‡ªå·±æ²¡æ‰¾åˆ°ï¼Œå®ƒå°±å‘Šè¯‰ ExtClassLoaderï¼Œå…„å¼Ÿï¼Œæˆ‘è¿™é‡Œæ²¡æœ‰è¿™ä¸ªç±»ï¼Œä½ å»åŠ è½½çœ‹çœ‹ï¼Œç„¶å Extension ClassLoader æ‹¿ç€è¿™ä¸ªç±»å»å®ƒæŒ‡å®šçš„ç±»è·¯å¾„ï¼ˆJAVA_HOME/jre/lib/extï¼‰è¯•å›¾åŠ è½½ï¼Œå”‰ï¼Œå®ƒå‘ç°åœ¨ClassLoaderTest.jar è¿™æ ·ä¸€ä¸ªæ–‡ä»¶ä¸­åŒ…å« ClassLoaderTest.class è¿™æ ·çš„ä¸€ä¸ªæ–‡ä»¶ï¼Œç„¶åå®ƒæŠŠæ‰¾åˆ°çš„è¿™ä¸ªç±»åŠ è½½åˆ°å†…å­˜å½“ä¸­ï¼Œå¹¶ç”Ÿæˆè¿™ä¸ªç±»çš„ Class å®ä¾‹å¯¹è±¡ï¼Œæœ€åæŠŠè¿™ä¸ªå®ä¾‹è¿”å›ã€‚æ‰€ä»¥ ClassLoaderTest.class çš„ç±»åŠ è½½å™¨æ˜¯ ExtClassLoaderã€‚ ç¬¬äºŒè¡Œçš„ç»“æœä¸ºnullï¼Œæ˜¯å› ä¸ºExtClassLoaderçš„çˆ¶ç±»åŠ è½½å™¨æ˜¯Bootstrap ClassLoaderã€‚ JVMåŠ è½½classæ–‡ä»¶çš„ä¸¤ç§æ–¹æ³•ï¼› éšå¼åŠ è½½ï¼Œ ç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­å½“ç¢°åˆ°é€šè¿‡new ç­‰æ–¹å¼ç”Ÿæˆå¯¹è±¡æ—¶ï¼Œéšå¼è°ƒç”¨ç±»è£…è½½å™¨åŠ è½½å¯¹åº”çš„ç±»åˆ°jvmä¸­ã€‚ æ˜¾å¼åŠ è½½ï¼Œ é€šè¿‡class.forname()ã€this.getClass.getClassLoader().loadClass()ç­‰æ–¹æ³•æ˜¾å¼åŠ è½½éœ€è¦çš„ç±»ï¼Œæˆ–è€…æˆ‘ä»¬è‡ªå·±å®ç°çš„ ClassLoader çš„ findlass() æ–¹æ³•ã€‚ ä¸‹é¢ä»‹ç»ä¸‹ class.forNameçš„åŠ è½½ç±»æ–¹æ³•ï¼š Class.forNameæ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ï¼ŒåŒæ ·å¯ä»¥ç”¨æ¥åŠ è½½ç±»ã€‚è¯¥æ–¹æ³•æœ‰ä¸¤ç§å½¢å¼ï¼šClass.forName(String name,boolean initialize, ClassLoader loader)å’ŒClass.forName(String className)ã€‚ç¬¬ä¸€ç§å½¢å¼çš„å‚æ•° nameè¡¨ç¤ºçš„æ˜¯ç±»çš„å…¨åï¼›initializeè¡¨ç¤ºæ˜¯å¦åˆå§‹åŒ–ç±»ï¼›loaderè¡¨ç¤ºåŠ è½½æ—¶ä½¿ç”¨çš„ç±»åŠ è½½å™¨ã€‚ç¬¬äºŒç§å½¢å¼åˆ™ç›¸å½“äºè®¾ç½®äº†å‚æ•° initializeçš„å€¼ä¸º trueï¼Œloaderçš„å€¼ä¸ºå½“å‰ç±»çš„ç±»åŠ è½½å™¨ã€‚Class.forNameçš„ä¸€ä¸ªå¾ˆå¸¸è§çš„ç”¨æ³•æ˜¯åœ¨åŠ è½½æ•°æ®åº“é©±åŠ¨çš„æ—¶å€™ã€‚å¦‚Class.forName(&quot;org.apache.derby.jdbc.EmbeddedDriver&quot;)ç”¨æ¥åŠ è½½ Apache Derby æ•°æ®åº“çš„é©±åŠ¨ã€‚ ç±»åŠ è½½çš„åŠ¨æ€æ€§ä½“ç°ï¼šä¸€ä¸ªåº”ç”¨ç¨‹åºæ€»æ˜¯ç”±nå¤šä¸ªç±»ç»„æˆï¼ŒJavaç¨‹åºå¯åŠ¨æ—¶ï¼Œå¹¶ä¸æ˜¯ä¸€æ¬¡æŠŠæ‰€æœ‰çš„ç±»å…¨éƒ¨åŠ è½½åå†è¿è¡Œï¼Œå®ƒæ€»æ˜¯å…ˆæŠŠä¿è¯ç¨‹åºè¿è¡Œçš„åŸºç¡€ç±»ä¸€æ¬¡æ€§åŠ è½½åˆ°jvmä¸­ï¼Œå…¶å®ƒç±»ç­‰åˆ°jvmç”¨åˆ°çš„æ—¶å€™å†åŠ è½½ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯èŠ‚çœäº†å†…å­˜çš„å¼€é”€ï¼Œå› ä¸ºjavaæœ€æ—©å°±æ˜¯ä¸ºåµŒå…¥å¼ç³»ç»Ÿè€Œè®¾è®¡çš„ï¼Œå†…å­˜å®è´µï¼Œè¿™æ˜¯ä¸€ç§å¯ä»¥ç†è§£çš„æœºåˆ¶ï¼Œè€Œç”¨åˆ°æ—¶å†åŠ è½½è¿™ä¹Ÿæ˜¯javaåŠ¨æ€æ€§çš„ä¸€ç§ä½“ç°ã€‚ 3ã€å¦‚ä½•åŠ è½½ class æ–‡ä»¶ ç¬¬ä¸€é˜¶æ®µæ‰¾åˆ° .class æ–‡ä»¶å¹¶æŠŠè¿™ä¸ªæ–‡ä»¶åŒ…å«çš„å­—èŠ‚ç åŠ è½½åˆ°å†…å­˜ä¸­ã€‚ ç¬¬äºŒé˜¶æ®µä¸­åˆ†ä¸‰æ­¥ï¼Œå­—èŠ‚ç éªŒè¯ï¼›class ç±»æ•°æ®ç»“æ„åˆ†æåŠç›¸åº”çš„å†…å­˜åˆ†é…ï¼›æœ€åçš„ç¬¦å·è¡¨çš„é“¾æ¥ã€‚ ç¬¬ä¸‰é˜¶æ®µæ˜¯ç±»ä¸­é™æ€å±æ€§å’Œåˆå§‹åŒ–èµ‹å€¼ï¼Œä»¥åŠé™æ€å—çš„æ‰§è¡Œç­‰ã€‚ 3.1 ã€åŠ è½½å­—èŠ‚ç åˆ°å†…å­˜ã€‚ã€‚ 3.2 ã€éªŒè¯ä¸åˆ†æ å­—èŠ‚ç éªŒè¯ï¼Œç±»è£…å…¥å™¨å¯¹äºç±»çš„å­—èŠ‚ç è¦åšå¾ˆå¤šæ£€æµ‹ï¼Œä»¥ç¡®ä¿æ ¼å¼æ­£ç¡®ï¼Œè¡Œä¸ºæ­£ç¡®ã€‚ ç±»è£…å¤‡ï¼Œå‡†å¤‡ä»£è¡¨æ¯ä¸ªç±»ä¸­å®šä¹‰çš„å­—æ®µã€æ–¹æ³•å’Œå®ç°æ¥å£æ‰€å¿…é¡»çš„æ•°æ®ç»“æ„ã€‚ è§£æï¼Œè£…å…¥å™¨è£…å…¥ç±»æ‰€å¼•ç”¨çš„å…¶ä»–æ‰€æœ‰ç±»ã€‚ 4ã€å¸¸è§åŠ è½½ç±»é”™è¯¯åˆ†æ4.1 ã€ ClassNotFoundExecptionClassNotFoundExecption å¼‚å¸¸æ˜¯å¹³å¸¸ç¢°åˆ°çš„æœ€å¤šçš„ã€‚è¿™ä¸ªå¼‚å¸¸é€šå¸¸å‘ç”Ÿåœ¨æ˜¾ç¤ºåŠ è½½ç±»çš„æ—¶å€™ã€‚ 12345678910public class ClassNotFoundExceptionTest&#123; public static void main(String[] args) &#123; try &#123; Class.forName(&quot;NotFoundClass&quot;); &#125;catch (ClassNotFoundException e)&#123; e.printStackTrace(); &#125; &#125;&#125; æ˜¾ç¤ºåŠ è½½ä¸€ä¸ªç±»é€šå¸¸æœ‰ï¼š é€šè¿‡ç±» Class ä¸­çš„ forName() æ–¹æ³• é€šè¿‡ç±» ClassLoader ä¸­çš„ loadClass() æ–¹æ³• é€šè¿‡ç±» ClassLoader ä¸­çš„ findSystemClass() æ–¹æ³• å‡ºç°è¿™ç§é”™è¯¯å…¶å®å°±æ˜¯å½“ JVM è¦åŠ è½½æŒ‡å®šæ–‡ä»¶çš„å­—èŠ‚ç åˆ°å†…å­˜æ—¶ï¼Œå¹¶æ²¡æœ‰æ‰¾åˆ°è¿™ä¸ªæ–‡ä»¶å¯¹åº”çš„å­—èŠ‚ç ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªæ–‡ä»¶å¹¶ä¸å­˜åœ¨ã€‚è§£å†³æ–¹æ³•å°±æ˜¯æ£€æŸ¥åœ¨å½“å‰çš„ classpath ç›®å½•ä¸‹æœ‰æ²¡æœ‰æŒ‡å®šçš„æ–‡ä»¶ã€‚ 4.2 ã€ NoClassDefFoundErroråœ¨JavaDocä¸­å¯¹NoClassDefFoundErrorçš„äº§ç”Ÿå¯èƒ½çš„æƒ…å†µå°±æ˜¯ä½¿ç”¨newå…³é”®å­—ã€å±æ€§å¼•ç”¨æŸä¸ªç±»ã€ç»§æ‰¿äº†æŸä¸ªæ¥å£æˆ–è€…ç±»ï¼Œä»¥åŠæ–¹æ³•çš„æŸä¸ªå‚æ•°ä¸­å¼•ç”¨äº†æŸä¸ªç±»ï¼Œè¿™æ—¶å°±ä¼šè§¦å‘JVMæˆ–è€…ç±»åŠ è½½å™¨å®ä¾‹å°è¯•åŠ è½½ç±»å‹çš„å®šä¹‰ï¼Œä½†æ˜¯è¯¥å®šä¹‰å´æ²¡æœ‰æ‰¾åˆ°ï¼Œå½±å“äº†æ‰§è¡Œè·¯å¾„ã€‚æ¢å¥è¯è¯´ï¼Œåœ¨ç¼–è¯‘æ—¶è¿™ä¸ªç±»æ˜¯èƒ½å¤Ÿè¢«æ‰¾åˆ°çš„ï¼Œä½†æ˜¯åœ¨æ‰§è¡Œæ—¶å´æ²¡æœ‰æ‰¾åˆ°ã€‚ è§£å†³è¿™ä¸ªé”™è¯¯çš„æ–¹æ³•å°±æ˜¯ç¡®ä¿æ¯ä¸ªç±»å¼•ç”¨çš„ç±»éƒ½åœ¨å½“å‰çš„classpathä¸‹é¢ã€‚ 4.3 ã€ UnsatisfiedLinkErrorè¯¥é”™è¯¯é€šå¸¸æ˜¯åœ¨ JVM å¯åŠ¨çš„æ—¶å€™ï¼Œå¦‚æœ JVM ä¸­çš„æŸä¸ª lib åˆ é™¤äº†ï¼Œå°±æœ‰å¯èƒ½æŠ¥è¿™ä¸ªé”™è¯¯ã€‚ 12345678910public class UnsatisfiedLinkErrorTest&#123; public native void nativeMethod(); static &#123; System.loadLibrary(\"NoLib\"); &#125; public static void main(String[] args) &#123; new UnsatisfiedLinkErrorTest().nativeMethod(); //è§£ænativeæ ‡è¯†çš„æ–¹æ³•æ—¶JVMæ‰¾ä¸åˆ°å¯¹åº”çš„åº“æ–‡ä»¶ &#125;&#125; 4.4 ã€ ClassCastExceptionè¯¥é”™è¯¯é€šå¸¸å‡ºç°å¼ºåˆ¶ç±»å‹è½¬æ¢æ—¶å‡ºç°è¿™ä¸ªé”™è¯¯ã€‚ 123456789101112public class ClassCastExceptionTest&#123; public static Map m = new HashMap()&#123; &#123; put(\"a\", \"2\"); &#125; &#125;; public static void main(String[] args) &#123; Integer integer = (Integer) m.get(\"a\"); //å°†må¼ºåˆ¶è½¬æ¢æˆIntegerç±»å‹ System.out.println(integer); &#125;&#125; æ³¨æ„ï¼šJVM åœ¨åšç±»å‹è½¬æ¢æ—¶çš„è§„åˆ™ï¼š å¯¹äºæ™®é€šå¯¹è±¡ï¼Œå¯¹è±¡å¿…é¡»æ˜¯ç›®æ ‡ç±»çš„å®ä¾‹æˆ–ç›®æ ‡ç±»çš„å­ç±»çš„å®ä¾‹ã€‚å¦‚æœç›®æ ‡ç±»æ˜¯æ¥å£ï¼Œé‚£ä¹ˆä¼šæŠŠå®ƒå½“ä½œå®ç°äº†è¯¥æ¥å£çš„ä¸€ä¸ªå­ç±»ã€‚ å¯¹äºæ•°ç»„ç±»å‹ï¼Œç›®æ ‡ç±»å¿…é¡»æ˜¯æ•°ç»„ç±»å‹æˆ– java.lang.Objectã€java.lang.Cloneableã€java.io.Serializableã€‚ å¦‚æœä¸æ»¡è¶³ä¸Šé¢çš„è§„åˆ™ï¼ŒJVM å°±ä¼šæŠ¥é”™ï¼Œæœ‰ä¸¤ç§æ–¹å¼å¯é¿å…é”™è¯¯ï¼š åœ¨å®¹å™¨ç±»å‹ä¸­æ˜¾å¼çš„æŒ‡æ˜è¿™ä¸ªå®¹å™¨æ‰€åŒ…å«çš„å¯¹è±¡ç±»å‹ã€‚ å…ˆé€šè¿‡ instanceof æ£€æŸ¥æ˜¯ä¸æ˜¯ç›®æ ‡ç±»å‹ï¼Œç„¶åå†è¿›è¡Œå¼ºåˆ¶ç±»å‹çš„è½¬æ¢ã€‚ ä¸Šé¢ä»£ç ä¸­æ”¹æˆå¦‚ä¸‹å°±å¯ä»¥é¿å…é”™è¯¯äº†ï¼š 4.5 ã€ ExceptionInInitializerError12345678910public class ExceptionInInitializerErrorTest&#123; public static Map m = new HashMap()&#123;&#123; m.put(\"a\", \"2\"); &#125;&#125;; public static void main(String[] args) &#123; Integer integer = (Integer) m.get(\"a\"); System.out.println(integer); &#125;&#125; åœ¨åˆå§‹åŒ–è¿™ä¸ªç±»æ—¶ï¼Œç»™é™æ€å±æ€§ m èµ‹å€¼æ—¶å‡ºç°äº†å¼‚å¸¸å¯¼è‡´æŠ›å‡ºé”™è¯¯ ExceptionInInitializerErrorã€‚ 4.6 NoSuchMethodErrorNoSuchMethodErrorä»£è¡¨è¿™ä¸ªç±»å‹ç¡®å®å­˜åœ¨ï¼Œä½†æ˜¯ä¸€ä¸ªä¸æ­£ç¡®çš„ç‰ˆæœ¬è¢«åŠ è½½äº†ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ â€˜Â­verbose:classâ€™ æ¥åˆ¤æ–­è¯¥JVMåŠ è½½çš„åˆ°åº•æ˜¯å“ªä¸ªç‰ˆæœ¬ã€‚ 4.7 LinkageErroræœ‰æ—¶å€™äº‹æƒ…ä¼šå˜å¾—æ›´ç³Ÿï¼Œå’Œ ClassCastException æœ¬è´¨ä¸€æ ·ï¼ŒåŠ è½½è‡ªä¸åŒä½ç½®çš„ç›¸åŒç±»åœ¨åŒä¸€æ®µé€»è¾‘ï¼ˆæ¯”å¦‚ï¼šæ–¹æ³•ï¼‰ä¸­äº¤äº’æ—¶ï¼Œä¼šå‡ºç° LinkageError ã€‚ LinkageError éœ€è¦è§‚å¯Ÿå“ªä¸ªç±»è¢«ä¸åŒçš„ç±»åŠ è½½å™¨åŠ è½½äº†ï¼Œåœ¨å“ªä¸ªæ–¹æ³•æˆ–è€…è°ƒç”¨å¤„å‘ç”Ÿï¼ˆäº¤æ±‡ï¼‰çš„ï¼Œç„¶åæ‰èƒ½æƒ³è§£å†³æ–¹æ³•ï¼Œè§£å†³æ–¹æ³•æ— å¤–ä¹ä¸¤ç§ã€‚ç¬¬ä¸€ï¼Œè¿˜æ˜¯ä¸åŒçš„ç±»åŠ è½½å™¨åŠ è½½ï¼Œä½†æ˜¯ç›¸äº’ä¸å†äº¤æ±‡å½±å“ï¼Œè¿™é‡Œéœ€è¦é’ˆå¯¹å‘ç”Ÿé—®é¢˜çš„åœ°æ–¹åšä¸€äº›æ”¹åŠ¨ï¼Œæ¯”å¦‚æ›´æ¢å®ç°æ–¹å¼ï¼Œé¿å…å‡ºç°ä¸Šè¿°é—®é¢˜ï¼›ç¬¬äºŒï¼Œå†²çªçš„ç±»éœ€è¦ç”±ä¸€ä¸ªParentç±»åŠ è½½å™¨è¿›è¡ŒåŠ è½½ã€‚LinkageError å’ŒClassCastException æœ¬è´¨æ˜¯ä¸€æ ·çš„ï¼ŒåŠ è½½è‡ªä¸åŒç±»åŠ è½½å™¨çš„ç±»å‹ï¼Œåœ¨åŒä¸€ä¸ªç±»çš„æ–¹æ³•æˆ–è€…è°ƒç”¨ä¸­å‡ºç°ï¼Œå¦‚æœæœ‰è½¬å‹æ“ä½œé‚£ä¹ˆå°±ä¼šæŠ› ClassCastException ï¼Œå¦‚æœæ˜¯ç›´æ¥çš„æ–¹æ³•è°ƒç”¨å¤„çš„å‚æ•°æˆ–è€…è¿”å›å€¼è§£æï¼Œé‚£ä¹ˆå°±ä¼šäº§ç”Ÿ LinkageError ã€‚ 5ã€å¸¸ç”¨çš„ ClassLoader åˆ†æã€‚ã€‚å‚è§ä¹¦ç±ã€Šæ·±å…¥åˆ†æJava WebæŠ€æœ¯å†…å¹•ã€‹ 6ã€å¦‚ä½•å®ç°è‡ªå·±çš„ ClassLoaderClassLoader èƒ½å¤Ÿå®Œæˆçš„äº‹æƒ…æœ‰ä»¥ä¸‹æƒ…å†µï¼š åœ¨è‡ªå®šä¹‰è·¯å¾„ä¸‹æŸ¥æ‰¾è‡ªå®šä¹‰çš„classç±»æ–‡ä»¶ã€‚ å¯¹æˆ‘ä»¬è‡ªå·±è¦åŠ è½½çš„ç±»åšç‰¹æ®Šå¤„ç†ã€‚ å¯ä»¥å®šä¹‰ç±»çš„å®ç°æœºåˆ¶ã€‚ è™½ç„¶åœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç³»ç»Ÿé»˜è®¤æä¾›çš„ç±»åŠ è½½å™¨å®ç°å·²ç»å¯ä»¥æ»¡è¶³éœ€æ±‚ã€‚ä½†æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ‚¨è¿˜æ˜¯éœ€è¦ä¸ºåº”ç”¨å¼€å‘å‡ºè‡ªå·±çš„ç±»åŠ è½½å™¨ã€‚æ¯”å¦‚æ‚¨çš„åº”ç”¨é€šè¿‡ç½‘ç»œæ¥ä¼ è¾“ Java ç±»çš„å­—èŠ‚ä»£ç ï¼Œä¸ºäº†ä¿è¯å®‰å…¨æ€§ï¼Œè¿™äº›å­—èŠ‚ä»£ç ç»è¿‡äº†åŠ å¯†å¤„ç†ã€‚è¿™ä¸ªæ—¶å€™æ‚¨å°±éœ€è¦è‡ªå·±çš„ç±»åŠ è½½å™¨æ¥ä»æŸä¸ªç½‘ç»œåœ°å€ä¸Šè¯»å–åŠ å¯†åçš„å­—èŠ‚ä»£ç ï¼Œæ¥ç€è¿›è¡Œè§£å¯†å’ŒéªŒè¯ï¼Œæœ€åå®šä¹‰å‡ºè¦åœ¨ Java è™šæ‹Ÿæœºä¸­è¿è¡Œçš„ç±»æ¥ã€‚ å®šä¹‰è‡ªå·²çš„ç±»åŠ è½½å™¨åˆ†ä¸ºä¸¤æ­¥ï¼š1ã€ç»§æ‰¿java.lang.ClassLoader2ã€é‡å†™çˆ¶ç±»çš„findClassæ–¹æ³• 6.1 ã€æ–‡ä»¶ç³»ç»Ÿç±»åŠ è½½å™¨åŠ è½½å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸Šçš„ Java å­—èŠ‚ä»£ç ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142public class FileSystemClassLoader extends ClassLoader&#123; private String rootDir; public FileSystemClassLoader(String rootDir)&#123; this.rootDir = rootDir; &#125; protected Class&lt;?&gt; findClass(String name) throws ClassNotFoundException &#123; byte[] classData = getClassData(name); if (classData == null)&#123; throw new ClassNotFoundException(); &#125; else &#123; return defineClass(name, classData, 0, classData.length); &#125; &#125; private byte[] getClassData(String className) &#123; String path = classNameToPath(className); try &#123; InputStream ins = new FileInputStream(path); ByteArrayOutputStream baos = new ByteArrayOutputStream(); int bufferSize = 4096; byte[] buffer = new byte[bufferSize]; int bytesNumRead = 0; while ((bytesNumRead = ins.read(buffer)) != -1)&#123; baos.write(buffer, 0, bytesNumRead); &#125; return baos.toByteArray(); &#125; catch (FileNotFoundException e) &#123; e.printStackTrace(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; return null; &#125; private String classNameToPath(String className) &#123; return rootDir + File.separatorChar + className.replace('.', File.separatorChar) + \".class\"; &#125;&#125; ç±» FileSystemClassLoaderç»§æ‰¿è‡ªç±»java.lang.ClassLoaderã€‚java.lang.ClassLoaderç±»çš„æ–¹æ³•loadClass()å°è£…äº†å‰é¢æåˆ°çš„ä»£ç†æ¨¡å¼çš„å®ç°ã€‚è¯¥æ–¹æ³•ä¼šé¦–å…ˆè°ƒç”¨ findLoadedClass()æ–¹æ³•æ¥æ£€æŸ¥è¯¥ç±»æ˜¯å¦å·²ç»è¢«åŠ è½½è¿‡ï¼›å¦‚æœæ²¡æœ‰åŠ è½½è¿‡çš„è¯ï¼Œä¼šè°ƒç”¨çˆ¶ç±»åŠ è½½å™¨çš„loadClass()æ–¹æ³•æ¥å°è¯•åŠ è½½è¯¥ç±»ï¼›å¦‚æœçˆ¶ç±»åŠ è½½å™¨æ— æ³•åŠ è½½è¯¥ç±»çš„è¯ï¼Œå°±è°ƒç”¨ findClass()æ–¹æ³•æ¥æŸ¥æ‰¾è¯¥ç±»ã€‚å› æ­¤ï¼Œä¸ºäº†ä¿è¯ç±»åŠ è½½å™¨éƒ½æ­£ç¡®å®ç°ä»£ç†æ¨¡å¼ï¼Œåœ¨å¼€å‘è‡ªå·±çš„ç±»åŠ è½½å™¨æ—¶ï¼Œæœ€å¥½ä¸è¦è¦†å†™ loadClass()æ–¹æ³•ï¼Œè€Œæ˜¯è¦†å†™findClass()æ–¹æ³•ã€‚ ç±» FileSystemClassLoaderçš„ findClass()æ–¹æ³•é¦–å…ˆæ ¹æ®ç±»çš„å…¨ååœ¨ç¡¬ç›˜ä¸ŠæŸ¥æ‰¾ç±»çš„å­—èŠ‚ä»£ç æ–‡ä»¶ï¼ˆ.class æ–‡ä»¶ï¼‰ï¼Œç„¶åè¯»å–è¯¥æ–‡ä»¶å†…å®¹ï¼Œæœ€åé€šè¿‡ defineClass()æ–¹æ³•æ¥æŠŠè¿™äº›å­—èŠ‚ä»£ç è½¬æ¢æˆ java.lang.Classç±»çš„å®ä¾‹ã€‚ 6.2 ã€ ç½‘ç»œç±»åŠ è½½å™¨ä¸€ä¸ªç½‘ç»œç±»åŠ è½½å™¨æ¥è¯´æ˜å¦‚ä½•é€šè¿‡ç±»åŠ è½½å™¨æ¥å®ç°ç»„ä»¶çš„åŠ¨æ€æ›´æ–°ã€‚å³åŸºæœ¬çš„åœºæ™¯æ˜¯ï¼šJava å­—èŠ‚ä»£ç ï¼ˆ.classï¼‰æ–‡ä»¶å­˜æ”¾åœ¨æœåŠ¡å™¨ä¸Šï¼Œå®¢æˆ·ç«¯é€šè¿‡ç½‘ç»œçš„æ–¹å¼è·å–å­—èŠ‚ä»£ç å¹¶æ‰§è¡Œã€‚å½“æœ‰ç‰ˆæœ¬æ›´æ–°çš„æ—¶å€™ï¼Œåªéœ€è¦æ›¿æ¢æ‰æœåŠ¡å™¨ä¸Šä¿å­˜çš„æ–‡ä»¶å³å¯ã€‚é€šè¿‡ç±»åŠ è½½å™¨å¯ä»¥æ¯”è¾ƒç®€å•çš„å®ç°è¿™ç§éœ€æ±‚ã€‚ ç±» NetworkClassLoader è´Ÿè´£é€šè¿‡ç½‘ç»œä¸‹è½½ Java ç±»å­—èŠ‚ä»£ç å¹¶å®šä¹‰å‡º Java ç±»ã€‚å®ƒçš„å®ç°ä¸FileSystemClassLoader ç±»ä¼¼ã€‚åœ¨é€šè¿‡ NetworkClassLoader åŠ è½½äº†æŸä¸ªç‰ˆæœ¬çš„ç±»ä¹‹åï¼Œä¸€èˆ¬æœ‰ä¸¤ç§åšæ³•æ¥ä½¿ç”¨å®ƒã€‚ç¬¬ä¸€ç§åšæ³•æ˜¯ä½¿ç”¨ Java åå°„ APIã€‚å¦å¤–ä¸€ç§åšæ³•æ˜¯ä½¿ç”¨æ¥å£ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¹¶ä¸èƒ½ç›´æ¥åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­å¼•ç”¨ä»æœåŠ¡å™¨ä¸Šä¸‹è½½çš„ç±»ï¼Œå› ä¸ºå®¢æˆ·ç«¯ä»£ç çš„ç±»åŠ è½½å™¨æ‰¾ä¸åˆ°è¿™äº›ç±»ã€‚ä½¿ç”¨ Java åå°„ API å¯ä»¥ç›´æ¥è°ƒç”¨ Java ç±»çš„æ–¹æ³•ã€‚è€Œä½¿ç”¨æ¥å£çš„åšæ³•åˆ™æ˜¯æŠŠæ¥å£çš„ç±»æ”¾åœ¨å®¢æˆ·ç«¯ä¸­ï¼Œä»æœåŠ¡å™¨ä¸ŠåŠ è½½å®ç°æ­¤æ¥å£çš„ä¸åŒç‰ˆæœ¬çš„ç±»ã€‚åœ¨å®¢æˆ·ç«¯é€šè¿‡ç›¸åŒçš„æ¥å£æ¥ä½¿ç”¨è¿™äº›å®ç°ç±»ã€‚ ç½‘ç»œç±»åŠ è½½å™¨çš„ä»£ç ï¼šClassLoader 7ã€ç±»åŠ è½½å™¨ä¸Webå®¹å™¨å¯¹äºè¿è¡Œåœ¨ Java EEâ„¢å®¹å™¨ä¸­çš„ Web åº”ç”¨æ¥è¯´ï¼Œç±»åŠ è½½å™¨çš„å®ç°æ–¹å¼ä¸ä¸€èˆ¬çš„ Java åº”ç”¨æœ‰æ‰€ä¸åŒã€‚ä¸åŒçš„ Web å®¹å™¨çš„å®ç°æ–¹å¼ä¹Ÿä¼šæœ‰æ‰€ä¸åŒã€‚ä»¥ Apache Tomcat æ¥è¯´ï¼Œæ¯ä¸ªWeb åº”ç”¨éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„ç±»åŠ è½½å™¨å®ä¾‹ã€‚è¯¥ç±»åŠ è½½å™¨ä¹Ÿä½¿ç”¨ä»£ç†æ¨¡å¼ï¼Œæ‰€ä¸åŒçš„æ˜¯å®ƒæ˜¯é¦–å…ˆå°è¯•å»åŠ è½½æŸä¸ªç±»ï¼Œå¦‚æœæ‰¾ä¸åˆ°å†ä»£ç†ç»™çˆ¶ç±»åŠ è½½å™¨ã€‚è¿™ä¸ä¸€èˆ¬ç±»åŠ è½½å™¨çš„é¡ºåºæ˜¯ç›¸åçš„ã€‚è¿™æ˜¯ Java Servlet è§„èŒƒä¸­çš„æ¨èåšæ³•ï¼Œå…¶ç›®çš„æ˜¯ä½¿å¾—Web åº”ç”¨è‡ªå·±çš„ç±»çš„ä¼˜å…ˆçº§é«˜äº Web å®¹å™¨æä¾›çš„ç±»ã€‚è¿™ç§ä»£ç†æ¨¡å¼çš„ä¸€ä¸ªä¾‹å¤–æ˜¯ï¼šJava æ ¸å¿ƒåº“çš„ç±»æ˜¯ä¸åœ¨æŸ¥æ‰¾èŒƒå›´ä¹‹å†…çš„ã€‚è¿™ä¹Ÿæ˜¯ä¸ºäº†ä¿è¯ Java æ ¸å¿ƒåº“çš„ç±»å‹å®‰å…¨ã€‚ ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒWeb åº”ç”¨çš„å¼€å‘äººå‘˜ä¸éœ€è¦è€ƒè™‘ä¸ç±»åŠ è½½å™¨ç›¸å…³çš„ç»†èŠ‚ã€‚ä¸‹é¢ç»™å‡ºå‡ æ¡ç®€å•çš„åŸåˆ™ï¼š æ¯ä¸ª Web åº”ç”¨è‡ªå·±çš„ Java ç±»æ–‡ä»¶å’Œä½¿ç”¨çš„åº“çš„ jar åŒ…ï¼Œåˆ†åˆ«æ”¾åœ¨ WEB-INF/classeså’Œ WEB-INF/libç›®å½•ä¸‹é¢ã€‚ å¤šä¸ªåº”ç”¨å…±äº«çš„ Java ç±»æ–‡ä»¶å’Œ jar åŒ…ï¼Œåˆ†åˆ«æ”¾åœ¨ Web å®¹å™¨æŒ‡å®šçš„ç”±æ‰€æœ‰ Web åº”ç”¨å…±äº«çš„ç›®å½•ä¸‹é¢ã€‚ å½“å‡ºç°æ‰¾ä¸åˆ°ç±»çš„é”™è¯¯æ—¶ï¼Œæ£€æŸ¥å½“å‰ç±»çš„ç±»åŠ è½½å™¨å’Œå½“å‰çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨æ˜¯å¦æ­£ç¡® 8ã€æ€»ç»“æœ¬ç¯‡æ–‡ç« è¯¦ç»†æ·±å…¥çš„ä»‹ç»äº† ClassLoader çš„å·¥ä½œæœºåˆ¶ï¼Œè¿˜å†™äº†å¦‚ä½•è‡ªå·±å®ç°æ‰€éœ€çš„ ClassLoader ã€‚ å‚è€ƒèµ„æ–™1ã€æ·±åº¦åˆ†æ Java çš„ ClassLoader æœºåˆ¶ï¼ˆæºç çº§åˆ«ï¼‰ 2ã€æ·±å…¥æµ…å‡ºClassLoader 3ã€æ·±å…¥æ¢è®¨ Java ç±»åŠ è½½å™¨ 4ã€æ·±å…¥åˆ†æJava ClassLoaderåŸç† 5ã€ã€Šæ·±å…¥åˆ†æ Java Web æŠ€æœ¯å†…å¹•ã€‹ä¿®è®¢ç‰ˆ â€”â€” æ·±å…¥åˆ†æ ClassLoader å·¥ä½œæœºåˆ¶","tags":[{"name":"Java","slug":"Java","permalink":"http://www.54tianzhisheng.cn/tags/Java/"},{"name":"JVM","slug":"JVM","permalink":"http://www.54tianzhisheng.cn/tags/JVM/"},{"name":"ç±»åŠ è½½æœºåˆ¶","slug":"ç±»åŠ è½½æœºåˆ¶","permalink":"http://www.54tianzhisheng.cn/tags/ç±»åŠ è½½æœºåˆ¶/"}]},{"title":"é€šè¿‡é¡¹ç›®é€æ­¥æ·±å…¥äº†è§£Spring MVCï¼ˆä¸€ï¼‰","date":"2017-06-15T16:00:00.000Z","path":"2017/06/16/é€šè¿‡é¡¹ç›®é€æ­¥æ·±å…¥äº†è§£Spring MVCï¼ˆä¸€ï¼‰/","text":"ç›¸å…³é˜…è¯»ï¼šæœ¬æ–‡æ¡£å’Œé¡¹ç›®ä»£ç åœ°å€ï¼šhttps://github.com/zhisheng17/springmvc äº†è§£ Springï¼š Spring å®˜ç½‘ï¼šhttp://spring.io/ ä¸€ä¸ªå¥½çš„ä¸œè¥¿ä¸€èˆ¬éƒ½ä¼šæœ‰ä¸€ä¸ªå¥½çš„æ–‡æ¡£è§£é‡Šè¯´æ˜ï¼Œå¦‚æœä½ è‹±è¯­è¿˜è¡Œï¼Œå»ºè®®è¿˜æ˜¯çœ‹å®˜æ–¹æ–‡æ¡£ã€‚ Spring MVCåŸºç¡€çŸ¥è¯†ä»€ä¹ˆæ˜¯Spring MVCï¼Ÿ Spring MVCæ¡†æ¶åŸç†ï¼ˆæŒæ¡ï¼‰ â€‹ å‰ç«¯æ§åˆ¶å™¨ã€å¤„ç†å™¨æ˜ å°„å™¨ã€å¤„ç†å™¨é€‚é…å™¨ã€è¯•å›¾è§£æå™¨Spring MVC å…¥é—¨ç¨‹åº â€‹ ç›®çš„ï¼šå¯¹å‰ç«¯æ§åˆ¶å™¨ã€å¤„ç†å™¨æ˜ å°„å™¨ã€å¤„ç†å™¨é€‚é…å™¨ã€è¯•å›¾è§£æå™¨å­¦ä¹  â€‹ éæ³¨è§£çš„å¤„ç†å™¨æ˜ å°„å™¨ã€å¤„ç†å™¨é€‚é…å™¨ â€‹ æ³¨è§£çš„å¤„ç†å™¨æ˜ å°„å™¨ã€å¤„ç†å™¨é€‚é…å™¨ï¼ˆæŒæ¡ï¼‰ Spring MVC å’Œ Mybatis æ•´åˆï¼ˆæŒæ¡ï¼‰ Spring MVC æ³¨è§£å¼€å‘ï¼šï¼ˆæŒæ¡ï¼‰ â€‹ å¸¸ç”¨çš„æ³¨è§£å­¦ä¹  â€‹ å‚æ•°ç»‘å®šï¼ˆç®€å•ç±»å‹ï¼Œpojoç±»å‹ã€é›†åˆç±»å‹ï¼‰ â€‹ è‡ªå®šä¹‰çš„å‚æ•°ç»‘å®šï¼ˆæŒæ¡ï¼‰ Spring MVC å’Œ Struts2åŒºåˆ« Spring MVCé«˜çº§åº”ç”¨å‚æ•°ç»‘å®šï¼ˆé›†åˆç±»å‹ï¼‰ æ•°æ®å›æ˜¾ ä¸Šä¼ å›¾ç‰‡ json æ•°æ®äº¤äº’ RESTful æ”¯æŒ æ‹¦æˆªå™¨ Spring MVC æ¡†æ¶ä»€ä¹ˆæ˜¯Spring MVCï¼Ÿspringmvcæ˜¯springæ¡†æ¶çš„ä¸€ä¸ªæ¨¡å—ï¼Œspringmvcå’Œspringæ— éœ€é€šè¿‡ä¸­é—´æ•´åˆå±‚è¿›è¡Œæ•´åˆã€‚springmvcæ˜¯ä¸€ä¸ªåŸºäºmvcçš„webæ¡†æ¶ã€‚ Web MVCMVC è®¾è®¡æ¨¡å¼åœ¨ B/S ç³»ç»Ÿä¸‹åº”ç”¨ï¼š 1ã€ ç”¨æˆ·å‘èµ·requestè¯·æ±‚è‡³æ§åˆ¶å™¨(Controller) æ§åˆ¶æ¥æ”¶ç”¨æˆ·è¯·æ±‚çš„æ•°æ®ï¼Œå§”æ‰˜ç»™æ¨¡å‹è¿›è¡Œå¤„ç† 2ã€ æ§åˆ¶å™¨é€šè¿‡æ¨¡å‹(Model)å¤„ç†æ•°æ®å¹¶å¾—åˆ°å¤„ç†ç»“æœ æ¨¡å‹é€šå¸¸æ˜¯æŒ‡ä¸šåŠ¡é€»è¾‘ 3ã€ æ¨¡å‹å¤„ç†ç»“æœè¿”å›ç»™æ§åˆ¶å™¨ 4ã€ æ§åˆ¶å™¨å°†æ¨¡å‹æ•°æ®åœ¨è§†å›¾(View)ä¸­å±•ç¤º webä¸­æ¨¡å‹æ— æ³•å°†æ•°æ®ç›´æ¥åœ¨è§†å›¾ä¸Šæ˜¾ç¤ºï¼Œéœ€è¦é€šè¿‡æ§åˆ¶å™¨å®Œæˆã€‚å¦‚æœåœ¨C/Såº”ç”¨ä¸­æ¨¡å‹æ˜¯å¯ä»¥å°†æ•°æ®åœ¨è§†å›¾ä¸­å±•ç¤ºçš„ã€‚ 5ã€ æ§åˆ¶å™¨å°†è§†å›¾responseå“åº”ç»™ç”¨æˆ· é€šè¿‡è§†å›¾å±•ç¤ºç»™ç”¨æˆ·è¦çš„æ•°æ®æˆ–å¤„ç†ç»“æœã€‚ Spring MVC æ¡†æ¶ ç¬¬ä¸€æ­¥ï¼šå‘èµ·è¯·æ±‚åˆ°å‰ç«¯æ§åˆ¶å™¨(DispatcherServlet) ç¬¬äºŒæ­¥ï¼šå‰ç«¯æ§åˆ¶å™¨è¯·æ±‚HandlerMappingæŸ¥æ‰¾ Handler å¯ä»¥æ ¹æ®xmlé…ç½®ã€æ³¨è§£è¿›è¡ŒæŸ¥æ‰¾ ç¬¬ä¸‰æ­¥ï¼šå¤„ç†å™¨æ˜ å°„å™¨HandlerMappingå‘å‰ç«¯æ§åˆ¶å™¨è¿”å›Handler ç¬¬å››æ­¥ï¼šå‰ç«¯æ§åˆ¶å™¨è°ƒç”¨å¤„ç†å™¨é€‚é…å™¨å»æ‰§è¡ŒHandler ç¬¬äº”æ­¥ï¼šå¤„ç†å™¨é€‚é…å™¨å»æ‰§è¡ŒHandler ç¬¬å…­æ­¥ï¼šHandleræ‰§è¡Œå®Œæˆç»™é€‚é…å™¨è¿”å›ModelAndView ç¬¬ä¸ƒæ­¥ï¼šå¤„ç†å™¨é€‚é…å™¨å‘å‰ç«¯æ§åˆ¶å™¨è¿”å›ModelAndView ModelAndViewæ˜¯springmvcæ¡†æ¶çš„ä¸€ä¸ªåº•å±‚å¯¹è±¡ï¼ŒåŒ…æ‹¬Modelå’Œview ç¬¬å…«æ­¥ï¼šå‰ç«¯æ§åˆ¶å™¨è¯·æ±‚è§†å›¾è§£æå™¨å»è¿›è¡Œè§†å›¾è§£æ æ ¹æ®é€»è¾‘è§†å›¾åè§£ææˆçœŸæ­£çš„è§†å›¾(jsp) ç¬¬ä¹æ­¥ï¼šè§†å›¾è§£æå™¨å‘å‰ç«¯æ§åˆ¶å™¨è¿”å›View ç¬¬åæ­¥ï¼šå‰ç«¯æ§åˆ¶å™¨è¿›è¡Œè§†å›¾æ¸²æŸ“ è§†å›¾æ¸²æŸ“å°†æ¨¡å‹æ•°æ®(åœ¨ModelAndViewå¯¹è±¡ä¸­)å¡«å……åˆ°requeståŸŸ ç¬¬åä¸€æ­¥ï¼šå‰ç«¯æ§åˆ¶å™¨å‘ç”¨æˆ·å“åº”ç»“æœ ç»„ä»¶ï¼š 1ã€å‰ç«¯æ§åˆ¶å™¨DispatcherServletï¼ˆä¸éœ€è¦ç¨‹åºå‘˜å¼€å‘ï¼‰ ä½œç”¨æ¥æ”¶è¯·æ±‚ï¼Œå“åº”ç»“æœï¼Œç›¸å½“äºè½¬å‘å™¨ï¼Œä¸­å¤®å¤„ç†å™¨ã€‚ æœ‰äº†DispatcherServletå‡å°‘äº†å…¶å®ƒç»„ä»¶ä¹‹é—´çš„è€¦åˆåº¦ã€‚ 2ã€å¤„ç†å™¨æ˜ å°„å™¨HandlerMapping(ä¸éœ€è¦ç¨‹åºå‘˜å¼€å‘) ä½œç”¨ï¼šæ ¹æ®è¯·æ±‚çš„urlæŸ¥æ‰¾Handler 3ã€å¤„ç†å™¨é€‚é…å™¨HandlerAdapter ä½œç”¨ï¼šæŒ‰ç…§ç‰¹å®šè§„åˆ™ï¼ˆHandlerAdapterè¦æ±‚çš„è§„åˆ™ï¼‰å»æ‰§è¡ŒHandler 4ã€å¤„ç†å™¨Handler(éœ€è¦ç¨‹åºå‘˜å¼€å‘) æ³¨æ„ï¼šç¼–å†™Handleræ—¶æŒ‰ç…§HandlerAdapterçš„è¦æ±‚å»åšï¼Œè¿™æ ·é€‚é…å™¨æ‰å¯ä»¥å»æ­£ç¡®æ‰§è¡ŒHandler 5ã€è§†å›¾è§£æå™¨View resolver(ä¸éœ€è¦ç¨‹åºå‘˜å¼€å‘) ä½œç”¨ï¼šè¿›è¡Œè§†å›¾è§£æï¼Œæ ¹æ®é€»è¾‘è§†å›¾åè§£ææˆçœŸæ­£çš„è§†å›¾ï¼ˆviewï¼‰ 6ã€è§†å›¾View(éœ€è¦ç¨‹åºå‘˜å¼€å‘jsp) Viewæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ç°ç±»æ”¯æŒä¸åŒçš„Viewç±»å‹ï¼ˆjspã€freemarkerã€pdfâ€¦ï¼‰","tags":[{"name":"Java","slug":"Java","permalink":"http://www.54tianzhisheng.cn/tags/Java/"},{"name":"Spring MVC","slug":"Spring-MVC","permalink":"http://www.54tianzhisheng.cn/tags/Spring-MVC/"}]},{"title":"é€šè¿‡é¡¹ç›®é€æ­¥æ·±å…¥äº†è§£Mybatisï¼ˆå››ï¼‰","date":"2017-06-14T16:00:00.000Z","path":"2017/06/15/é€šè¿‡é¡¹ç›®é€æ­¥æ·±å…¥äº†è§£Mybatis(å››)/","text":"ç›¸å…³é˜…è¯»ï¼š 1ã€é€šè¿‡é¡¹ç›®é€æ­¥æ·±å…¥äº†è§£Mybatis&lt;ä¸€&gt; 2ã€é€šè¿‡é¡¹ç›®é€æ­¥æ·±å…¥äº†è§£Mybatis&lt;äºŒ&gt; 3ã€é€šè¿‡é¡¹ç›®é€æ­¥æ·±å…¥äº†è§£Mybatis&lt;ä¸‰&gt; æœ¬é¡¹ç›®æ‰€æœ‰ä»£ç åŠæ–‡æ¡£éƒ½æ‰˜ç®¡åœ¨ Githubåœ°å€ï¼šhttps://github.com/zhisheng17/mybatis å»¶è¿ŸåŠ è½½ä»€ä¹ˆæ˜¯å»¶è¿ŸåŠ è½½ï¼ŸresultMapå¯ä»¥å®ç°é«˜çº§æ˜ å°„ï¼ˆä½¿ç”¨associationã€collectionå®ç°ä¸€å¯¹ä¸€åŠä¸€å¯¹å¤šæ˜ å°„ï¼‰ï¼Œassociationã€collectionå…·å¤‡å»¶è¿ŸåŠ è½½åŠŸèƒ½ã€‚éœ€æ±‚ï¼šå¦‚æœæŸ¥è¯¢è®¢å•å¹¶ä¸”å…³è”æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ã€‚å¦‚æœå…ˆæŸ¥è¯¢è®¢å•ä¿¡æ¯å³å¯æ»¡è¶³è¦æ±‚ï¼Œå½“æˆ‘ä»¬éœ€è¦æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯æ—¶å†æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ã€‚æŠŠå¯¹ç”¨æˆ·ä¿¡æ¯çš„æŒ‰éœ€å»æŸ¥è¯¢å°±æ˜¯å»¶è¿ŸåŠ è½½ã€‚ å»¶è¿ŸåŠ è½½ï¼šå…ˆä»å•è¡¨æŸ¥è¯¢ã€éœ€è¦æ—¶å†ä»å…³è”è¡¨å»å…³è”æŸ¥è¯¢ï¼Œå¤§å¤§æé«˜ æ•°æ®åº“æ€§èƒ½ï¼Œå› ä¸ºæŸ¥è¯¢å•è¡¨è¦æ¯”å…³è”æŸ¥è¯¢å¤šå¼ è¡¨é€Ÿåº¦è¦å¿«ã€‚ æ‰“å¼€å»¶è¿ŸåŠ è½½å¼€å…³åœ¨mybatisæ ¸å¿ƒé…ç½®æ–‡ä»¶ä¸­é…ç½®ï¼š lazyLoadingEnabledã€aggressiveLazyLoading è®¾ç½®é¡¹ æè¿° å…è®¸å€¼ é»˜è®¤å€¼ lazyLoadingEnabled å…¨å±€æ€§è®¾ç½®æ‡’åŠ è½½ã€‚å¦‚æœè®¾ä¸ºâ€˜falseâ€™ï¼Œåˆ™æ‰€æœ‰ç›¸å…³è”çš„éƒ½ä¼šè¢«åˆå§‹åŒ–åŠ è½½ã€‚ true \\ false false aggressiveLazyLoading å½“è®¾ç½®ä¸ºâ€˜trueâ€™çš„æ—¶å€™ï¼Œæ‡’åŠ è½½çš„å¯¹è±¡å¯èƒ½è¢«ä»»ä½•æ‡’å±æ€§å…¨éƒ¨åŠ è½½ã€‚å¦åˆ™ï¼Œæ¯ä¸ªå±æ€§éƒ½æŒ‰éœ€åŠ è½½ã€‚ true \\ false true 1234&lt;settings&gt; &lt;setting name=\"lazyLoadingEnabled\" value=\"true\"/&gt; &lt;setting name=\"aggressiveLazyLoading\" value=\"false\"/&gt;&lt;/settings&gt; ä½¿ç”¨ association å®ç°å»¶è¿ŸåŠ è½½éœ€æ±‚ï¼šæŸ¥è¯¢è®¢å•å¹¶ä¸”å…³è”æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ Mapper.xmléœ€è¦å®šä¹‰ä¸¤ä¸ª mapper çš„æ–¹æ³•å¯¹åº”çš„ statementã€‚ 1ã€åªæŸ¥è¯¢è®¢å•ä¿¡æ¯ SQL è¯­å¥ï¼š select * from orders åœ¨æŸ¥è¯¢è®¢å•çš„ statement ä¸­ä½¿ç”¨ association å»å»¶è¿ŸåŠ è½½ï¼ˆæ‰§è¡Œï¼‰ä¸‹è¾¹çš„ statement (å…³è”æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯) 1234&lt;!--æŸ¥è¯¢è®¢å•å¹¶ä¸”å…³è”æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼Œå…³è”ç”¨æˆ·ä¿¡æ¯éœ€è¦é€šè¿‡ association å»¶è¿ŸåŠ è½½--&gt; &lt;select id=\"findOrdersUserLazyLoading\" resultMap=\"OrdersUserLazyLoadingResultMap\"&gt; select * from orders &lt;/select&gt; 2ã€å…³è”æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ é€šè¿‡ä¸Šé¢æŸ¥è¯¢è®¢å•ä¿¡æ¯ä¸­çš„ user_id æ¥å…³è”æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ã€‚ä½¿ç”¨ UserMapper.xml ä¸­çš„ findUserById SQLè¯­å¥ï¼šselect * from user where id = user_id 123&lt;select id=\"findUserById\" parameterType=\"int\" resultType=\"user\"&gt; select * from user where id = #&#123;value&#125; &lt;/select&gt; ä¸Šè¾¹å…ˆå»æ‰§è¡Œ findOrdersUserLazyLoadingï¼Œå½“éœ€è¦å»æŸ¥è¯¢ç”¨æˆ·çš„æ—¶å€™å†å»æ‰§è¡Œ findUserById ï¼Œé€šè¿‡ resultMapçš„å®šä¹‰å°†å»¶è¿ŸåŠ è½½æ‰§è¡Œé…ç½®èµ·æ¥ã€‚ä¹Ÿå°±æ˜¯é€šè¿‡ resultMap å»åŠ è½½ UserMapper.xml æ–‡ä»¶ä¸­çš„ select = findUserById å»¶è¿ŸåŠ è½½çš„ resultMap1234567891011121314151617181920&lt;!--å®šä¹‰ å…³è”ç”¨æˆ·ä¿¡æ¯ï¼ˆé€šè¿‡ association å»¶è¿ŸåŠ è½½ï¼‰çš„resultMap--&gt; &lt;resultMap id=\"OrdersUserLazyLoadingResultMap\" type=\"cn.zhisheng.mybatis.po.Orders\"&gt; &lt;!--å¯¹è®¢å•ä¿¡æ¯æ˜ å°„--&gt; &lt;id column=\"id\" property=\"id\"/&gt; &lt;result column=\"user_id\" property=\"userId\"/&gt; &lt;result column=\"number\" property=\"number\"/&gt; &lt;result column=\"createtime\" property=\"createtime\"/&gt; &lt;result column=\"note\" property=\"note\"/&gt; &lt;!-- å®ç°å¯¹ç”¨æˆ·ä¿¡æ¯è¿›è¡Œå»¶è¿ŸåŠ è½½ selectï¼šæŒ‡å®šå»¶è¿ŸåŠ è½½éœ€è¦æ‰§è¡Œçš„statementçš„idï¼ˆæ˜¯æ ¹æ®user_idæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯çš„statementï¼‰ è¦ä½¿ç”¨userMapper.xmlä¸­findUserByIdå®Œæˆæ ¹æ®ç”¨æˆ·id(user_id)ç”¨æˆ·ä¿¡æ¯çš„æŸ¥è¯¢ï¼Œå¦‚æœfindUserByIdä¸åœ¨æœ¬mapperä¸­éœ€è¦å‰è¾¹åŠ namespace columnï¼šè®¢å•ä¿¡æ¯ä¸­å…³è”ç”¨æˆ·ä¿¡æ¯æŸ¥è¯¢çš„åˆ—ï¼Œæ˜¯user_id å…³è”æŸ¥è¯¢çš„sqlç†è§£ä¸ºï¼š SELECT orders.*, (SELECT username FROM USER WHERE orders.user_id = user.id)username, (SELECT sex FROM USER WHERE orders.user_id = user.id)sex FROM orders--&gt; &lt;association property=\"user\" javaType=\"cn.zhisheng.mybatis.po.User\" select=\"cn.zhisheng.mybatis.mapper.UserMapper.findUserById\" column=\"user_id\"&gt; &lt;/association&gt; &lt;/resultMap&gt; OrderMapperCustom.java1public List&lt;Orders&gt; findOrdersUserLazyLoading() throws Exception; æµ‹è¯•ä»£ç ï¼š1234567891011121314151617@Test public void testFindOrdersUserLazyLoading() throws Exception &#123; SqlSession sqlSession = sqlSessionFactory.openSession(); //åˆ›å»ºOrdersMapperCustomå¯¹è±¡,mybatisè‡ªåŠ¨ç”Ÿæˆä»£ç†å¯¹è±¡ OrdersMapperCustom ordersMapperCustom = sqlSession.getMapper(OrdersMapperCustom.class); //æŸ¥è¯¢è®¢å•ä¿¡æ¯ List&lt;Orders&gt; list = ordersMapperCustom.findOrdersUserLazyLoading(); //éå†æ‰€æŸ¥è¯¢çš„çš„è®¢å•ä¿¡æ¯ for (Orders orders : list) &#123; //æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ User user = orders.getUser(); System.out.println(user); &#125; sqlSession.close(); &#125; æµ‹è¯•ç»“æœï¼š æ•´ä¸ªå»¶è¿ŸåŠ è½½çš„æ€è·¯ï¼š 1ã€æ‰§è¡Œä¸Šè¾¹mapperæ–¹æ³•ï¼ˆfindOrdersUserLazyLoadingï¼‰ï¼Œå†…éƒ¨å»è°ƒç”¨cn.zhisheng.mybatis.mapper.OrdersMapperCustom ä¸­çš„ findOrdersUserLazyLoading åªæŸ¥è¯¢ orders ä¿¡æ¯ï¼ˆå•è¡¨ï¼‰ã€‚ 2ã€åœ¨ç¨‹åºä¸­å»éå†ä¸Šä¸€æ­¥éª¤æŸ¥è¯¢å‡ºçš„ Listï¼Œå½“æˆ‘ä»¬è°ƒç”¨ Orders ä¸­çš„ getUser æ–¹æ³•æ—¶ï¼Œå¼€å§‹è¿›è¡Œå»¶è¿ŸåŠ è½½ã€‚ 3ã€å»¶è¿ŸåŠ è½½ï¼Œå»è°ƒç”¨ UserMapper.xml ä¸­ findUserbyId è¿™ä¸ªæ–¹æ³•è·å–ç”¨æˆ·ä¿¡æ¯ã€‚ æ€è€ƒï¼šä¸ä½¿ç”¨ mybatis æä¾›çš„ association åŠ collection ä¸­çš„å»¶è¿ŸåŠ è½½åŠŸèƒ½ï¼Œå¦‚ä½•å®ç°å»¶è¿ŸåŠ è½½ï¼Ÿï¼Ÿ å®ç°æ–¹æ³•å¦‚ä¸‹ï¼š å®šä¹‰ä¸¤ä¸ªmapperæ–¹æ³•ï¼š 1ã€æŸ¥è¯¢è®¢å•åˆ—è¡¨ 2ã€æ ¹æ®ç”¨æˆ·idæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ å®ç°æ€è·¯ï¼š å…ˆå»æŸ¥è¯¢ç¬¬ä¸€ä¸ªmapperæ–¹æ³•ï¼Œè·å–è®¢å•ä¿¡æ¯åˆ—è¡¨ åœ¨ç¨‹åºä¸­ï¼ˆserviceï¼‰ï¼ŒæŒ‰éœ€å»è°ƒç”¨ç¬¬äºŒä¸ªmapperæ–¹æ³•å»æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ã€‚ æ€»ä¹‹ï¼š ä½¿ç”¨å»¶è¿ŸåŠ è½½æ–¹æ³•ï¼Œå…ˆå»æŸ¥è¯¢ ç®€å•çš„ sqlï¼ˆæœ€å¥½å•è¡¨ï¼Œä¹Ÿå¯ä»¥å…³è”æŸ¥è¯¢ï¼‰ï¼Œå†å»æŒ‰éœ€è¦åŠ è½½å…³è”æŸ¥è¯¢çš„å…¶å®ƒä¿¡æ¯ã€‚ ä¸€å¯¹å¤šå»¶è¿ŸåŠ è½½ä¸Šé¢çš„é‚£ä¸ªæ¡ˆä¾‹æ˜¯ä¸€å¯¹ä¸€å»¶è¿ŸåŠ è½½ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬æƒ³ä¸€å¯¹å¤šè¿›è¡Œå»¶è¿ŸåŠ è½½å‘¢ï¼Œå…¶å®ä¹Ÿæ˜¯å¾ˆç®€å•çš„ã€‚ ä¸€å¯¹å¤šå»¶è¿ŸåŠ è½½çš„æ–¹æ³•åŒä¸€å¯¹ä¸€å»¶è¿ŸåŠ è½½ï¼Œåœ¨collectionæ ‡ç­¾ä¸­é…ç½®selectå†…å®¹ã€‚ å»¶è¿ŸåŠ è½½æ€»ç»“ï¼šä½œç”¨ï¼š å½“éœ€è¦æŸ¥è¯¢å…³è”ä¿¡æ¯æ—¶å†å»æ•°æ®åº“æŸ¥è¯¢ï¼Œé»˜è®¤ä¸å»å…³è”æŸ¥è¯¢ï¼Œæé«˜æ•°æ®åº“æ€§èƒ½ã€‚åªæœ‰ä½¿ç”¨resultMapæ”¯æŒå»¶è¿ŸåŠ è½½è®¾ç½®ã€‚ åœºåˆï¼š å½“åªæœ‰éƒ¨åˆ†è®°å½•éœ€è¦å…³è”æŸ¥è¯¢å…¶å®ƒä¿¡æ¯æ—¶ï¼Œæ­¤æ—¶å¯æŒ‰éœ€å»¶è¿ŸåŠ è½½ï¼Œéœ€è¦å…³è”æŸ¥è¯¢æ—¶å†å‘æ•°æ®åº“å‘å‡ºsqlï¼Œä»¥æé«˜æ•°æ®åº“æ€§èƒ½ã€‚ å½“å…¨éƒ¨éœ€è¦å…³è”æŸ¥è¯¢ä¿¡æ¯æ—¶ï¼Œæ­¤æ—¶ä¸ç”¨å»¶è¿ŸåŠ è½½ï¼Œç›´æ¥å°†å…³è”æŸ¥è¯¢ä¿¡æ¯å…¨éƒ¨è¿”å›å³å¯ï¼Œå¯ä½¿ç”¨resultTypeæˆ–resultMapå®Œæˆæ˜ å°„ã€‚ æŸ¥è¯¢ç¼“å­˜ä»€ä¹ˆæ˜¯æŸ¥è¯¢ç¼“å­˜ï¼Ÿmybatisæä¾›æŸ¥è¯¢ç¼“å­˜ï¼Œç”¨äºå‡è½»æ•°æ®å‹åŠ›ï¼Œæé«˜æ•°æ®åº“æ€§èƒ½ã€‚ mybaitsæä¾›ä¸€çº§ç¼“å­˜ï¼Œå’ŒäºŒçº§ç¼“å­˜ã€‚ ä¸€çº§ç¼“å­˜æ˜¯SqlSessionçº§åˆ«çš„ç¼“å­˜ã€‚åœ¨æ“ä½œæ•°æ®åº“æ—¶éœ€è¦æ„é€  sqlSessionå¯¹è±¡ï¼Œåœ¨å¯¹è±¡ä¸­æœ‰ä¸€ä¸ªæ•°æ®ç»“æ„ï¼ˆHashMapï¼‰ç”¨äºå­˜å‚¨ç¼“å­˜æ•°æ®ã€‚ä¸åŒçš„sqlSessionä¹‹é—´çš„ç¼“å­˜æ•°æ®åŒºåŸŸï¼ˆHashMapï¼‰æ˜¯äº’ç›¸ä¸å½±å“çš„ã€‚ äºŒçº§ç¼“å­˜æ˜¯mapperçº§åˆ«çš„ç¼“å­˜ï¼Œå¤šä¸ªSqlSessionå»æ“ä½œåŒä¸€ä¸ªMapperçš„sqlè¯­å¥ï¼Œå¤šä¸ªSqlSessionå¯ä»¥å…±ç”¨äºŒçº§ç¼“å­˜ï¼ŒäºŒçº§ç¼“å­˜æ˜¯è·¨SqlSessionçš„ã€‚ ä¸ºä»€ä¹ˆè¦ç”¨ç¼“å­˜ï¼Ÿ å¦‚æœç¼“å­˜ä¸­æœ‰æ•°æ®å°±ä¸ç”¨ä»æ•°æ®åº“ä¸­è·å–ï¼Œå¤§å¤§æé«˜ç³»ç»Ÿæ€§èƒ½ã€‚ ä¸€çº§ç¼“å­˜å·¥ä½œåŸç†ï¼š ç¬¬ä¸€æ¬¡å‘èµ·æŸ¥è¯¢ç”¨æˆ·idä¸º1çš„ç”¨æˆ·ä¿¡æ¯ï¼Œå…ˆå»æ‰¾ç¼“å­˜ä¸­æ˜¯å¦æœ‰idä¸º1çš„ç”¨æˆ·ä¿¡æ¯ï¼Œå¦‚æœæ²¡æœ‰ï¼Œä»æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ã€‚ å¾—åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œå°†ç”¨æˆ·ä¿¡æ¯å­˜å‚¨åˆ°ä¸€çº§ç¼“å­˜ä¸­ã€‚ å¦‚æœsqlSessionå»æ‰§è¡Œcommitæ“ä½œï¼ˆæ‰§è¡Œæ’å…¥ã€æ›´æ–°ã€åˆ é™¤ï¼‰ï¼Œæ¸…ç©ºSqlSessionä¸­çš„ä¸€çº§ç¼“å­˜ï¼Œè¿™æ ·åšçš„ç›®çš„ä¸ºäº†è®©ç¼“å­˜ä¸­å­˜å‚¨çš„æ˜¯æœ€æ–°çš„ä¿¡æ¯ï¼Œé¿å…è„è¯»ã€‚ ç¬¬äºŒæ¬¡å‘èµ·æŸ¥è¯¢ç”¨æˆ·idä¸º1çš„ç”¨æˆ·ä¿¡æ¯ï¼Œå…ˆå»æ‰¾ç¼“å­˜ä¸­æ˜¯å¦æœ‰idä¸º1çš„ç”¨æˆ·ä¿¡æ¯ï¼Œç¼“å­˜ä¸­æœ‰ï¼Œç›´æ¥ä»ç¼“å­˜ä¸­è·å–ç”¨æˆ·ä¿¡æ¯ã€‚ ä¸€çº§ç¼“å­˜æµ‹è¯• Mybatis é»˜è®¤æ”¯æŒä¸€çº§ç¼“å­˜ï¼Œä¸éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®ã€‚ æ‰€ä»¥æˆ‘ä»¬ç›´æ¥æŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤è¿›è¡Œæµ‹è¯•ï¼š 123456789101112131415//ä¸€çº§ç¼“å­˜æµ‹è¯• @Test public void testCache1() throws Exception &#123; SqlSession sqlSession = sqlSessionFactory.openSession(); //åˆ›å»ºUserMapperå¯¹è±¡,mybatisè‡ªåŠ¨ç”Ÿæˆä»£ç†å¯¹è±¡ UserMapper userMapper = sqlSession.getMapper(UserMapper.class); //æŸ¥è¯¢ä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ªsession //ç¬¬ä¸€æ¬¡å‘èµ·è¯·æ±‚ï¼ŒæŸ¥è¯¢Id ä¸º1çš„ç”¨æˆ·ä¿¡æ¯ User user1 = userMapper.findUserById(1); System.out.println(user1); //ç¬¬äºŒæ¬¡å‘èµ·è¯·æ±‚ï¼ŒæŸ¥è¯¢Id ä¸º1çš„ç”¨æˆ·ä¿¡æ¯ User user2 = userMapper.findUserById(1); System.out.println(user2); sqlSession.close(); &#125; é€šè¿‡ç»“æœå¯ä»¥çœ‹å‡ºç¬¬äºŒæ¬¡æ²¡æœ‰å‘å‡ºsqlæŸ¥è¯¢è¯·æ±‚ï¼Œ æ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨ä¸­é—´æ‰§è¡Œ commit æ“ä½œ 123456789//å¦‚æœsqlSessionå»æ‰§è¡Œcommitæ“ä½œï¼ˆæ‰§è¡Œæ’å…¥ã€æ›´æ–°ã€åˆ é™¤ï¼‰ï¼Œ// æ¸…ç©ºSqlSessionä¸­çš„ä¸€çº§ç¼“å­˜ï¼Œè¿™æ ·åšçš„ç›®çš„ä¸ºäº†è®©ç¼“å­˜ä¸­å­˜å‚¨çš„æ˜¯æœ€æ–°çš„ä¿¡æ¯ï¼Œé¿å…è„è¯»ã€‚//æ›´æ–°user1çš„ä¿¡æ¯ï¼Œuser1.setUsername(\"æé£\");//user1.setSex(\"ç”·\");//user1.setAddress(\"åŒ—äº¬\");userMapper.updateUserById(user1);//æäº¤äº‹åŠ¡,æ‰ä¼šå»æ¸…ç©ºç¼“å­˜sqlSession.commit(); æµ‹è¯• ä¸€çº§ç¼“å­˜åº”ç”¨ æ­£å¼å¼€å‘ï¼Œæ˜¯å°† mybatis å’Œ spring è¿›è¡Œæ•´åˆå¼€å‘ï¼Œäº‹åŠ¡æ§åˆ¶åœ¨ service ä¸­ã€‚ ä¸€ä¸ª service æ–¹æ³•ä¸­åŒ…æ‹¬å¾ˆå¤š mapper æ–¹æ³•è°ƒç”¨ã€‚ service{ //å¼€å§‹æ‰§è¡Œæ—¶ï¼Œå¼€å¯äº‹åŠ¡ï¼Œåˆ›å»ºSqlSessionå¯¹è±¡ //ç¬¬ä¸€æ¬¡è°ƒç”¨mapperçš„æ–¹æ³•findUserById(1) //ç¬¬äºŒæ¬¡è°ƒç”¨mapperçš„æ–¹æ³•findUserById(1)ï¼Œä»ä¸€çº§ç¼“å­˜ä¸­å–æ•°æ® //æ–¹æ³•ç»“æŸï¼ŒsqlSessionå…³é—­ } å¦‚æœæ˜¯æ‰§è¡Œä¸¤æ¬¡serviceè°ƒç”¨æŸ¥è¯¢ç›¸åŒçš„ç”¨æˆ·ä¿¡æ¯ï¼Œä¸èµ°ä¸€çº§ç¼“å­˜ï¼Œå› ä¸ºsessionæ–¹æ³•ç»“æŸï¼ŒsqlSessionå°±å…³é—­ï¼Œä¸€çº§ç¼“å­˜å°±æ¸…ç©ºã€‚ äºŒçº§ç¼“å­˜åŸç† é¦–å…ˆå¼€å¯mybatisçš„äºŒçº§ç¼“å­˜ã€‚ sqlSession1å»æŸ¥è¯¢ç”¨æˆ·idä¸º1çš„ç”¨æˆ·ä¿¡æ¯ï¼ŒæŸ¥è¯¢åˆ°ç”¨æˆ·ä¿¡æ¯ä¼šå°†æŸ¥è¯¢æ•°æ®å­˜å‚¨åˆ°äºŒçº§ç¼“å­˜ä¸­ã€‚ å¦‚æœSqlSession3å»æ‰§è¡Œç›¸åŒ mapperä¸‹sqlï¼Œæ‰§è¡Œcommitæäº¤ï¼Œæ¸…ç©ºè¯¥ mapperä¸‹çš„äºŒçº§ç¼“å­˜åŒºåŸŸçš„æ•°æ®ã€‚ sqlSession2å»æŸ¥è¯¢ç”¨æˆ·idä¸º1çš„ç”¨æˆ·ä¿¡æ¯ï¼Œå»ç¼“å­˜ä¸­æ‰¾æ˜¯å¦å­˜åœ¨æ•°æ®ï¼Œå¦‚æœå­˜åœ¨ç›´æ¥ä»ç¼“å­˜ä¸­å–å‡ºæ•°æ®ã€‚ äºŒçº§ç¼“å­˜ä¸ä¸€çº§ç¼“å­˜åŒºåˆ«ï¼ŒäºŒçº§ç¼“å­˜çš„èŒƒå›´æ›´å¤§ï¼Œå¤šä¸ªsqlSessionå¯ä»¥å…±äº«ä¸€ä¸ªUserMapperçš„äºŒçº§ç¼“å­˜åŒºåŸŸã€‚ UserMapperæœ‰ä¸€ä¸ªäºŒçº§ç¼“å­˜åŒºåŸŸï¼ˆæŒ‰namespaceåˆ†ï¼‰ ï¼Œå…¶å®ƒmapperä¹Ÿæœ‰è‡ªå·±çš„äºŒçº§ç¼“å­˜åŒºåŸŸï¼ˆæŒ‰namespaceåˆ†ï¼‰ã€‚ æ¯ä¸€ä¸ªnamespaceçš„mapperéƒ½æœ‰ä¸€ä¸ªäºŒç¼“å­˜åŒºåŸŸï¼Œä¸¤ä¸ªmapperçš„namespaceå¦‚æœç›¸åŒï¼Œè¿™ä¸¤ä¸ªmapperæ‰§è¡ŒsqlæŸ¥è¯¢åˆ°æ•°æ®å°†å­˜åœ¨ç›¸åŒçš„äºŒçº§ç¼“å­˜åŒºåŸŸä¸­ã€‚ å¼€å¯äºŒçº§ç¼“å­˜ï¼š mybaitsçš„äºŒçº§ç¼“å­˜æ˜¯mapperèŒƒå›´çº§åˆ«ï¼Œé™¤äº†åœ¨SqlMapConfig.xmlè®¾ç½®äºŒçº§ç¼“å­˜çš„æ€»å¼€å…³ï¼Œè¿˜è¦åœ¨å…·ä½“çš„mapper.xmlä¸­å¼€å¯äºŒçº§ç¼“å­˜ åœ¨ SqlMapConfig.xml å¼€å¯äºŒçº§å¼€å…³ 12&lt;!-- å¼€å¯äºŒçº§ç¼“å­˜ --&gt;&lt;setting name=\"cacheEnabled\" value=\"true\"/&gt; ç„¶ååœ¨ä½ çš„ Mapper æ˜ å°„æ–‡ä»¶ä¸­æ·»åŠ ä¸€è¡Œï¼š ï¼Œè¡¨ç¤ºæ­¤ mapper å¼€å¯äºŒçº§ç¼“å­˜ã€‚ è°ƒç”¨ pojo ç±»å®ç°åºåˆ—åŒ–æ¥å£ï¼š äºŒçº§ç¼“å­˜éœ€è¦æŸ¥è¯¢ç»“æœæ˜ å°„çš„pojoå¯¹è±¡å®ç°java.io.Serializableæ¥å£å®ç°åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ“ä½œï¼ˆå› ä¸ºäºŒçº§ç¼“å­˜æ•°æ®å­˜å‚¨ä»‹è´¨å¤šç§å¤šæ ·ï¼Œåœ¨å†…å­˜ä¸ä¸€æ ·ï¼‰ï¼Œæ³¨æ„å¦‚æœå­˜åœ¨çˆ¶ç±»ã€æˆå‘˜pojoéƒ½éœ€è¦å®ç°åºåˆ—åŒ–æ¥å£ã€‚ 12public class Orders implements Serializablepublic class User implements Serializable æµ‹è¯• 12345678910111213141516171819202122232425262728293031323334//äºŒçº§ç¼“å­˜æµ‹è¯• @Test public void testCache2() throws Exception &#123; SqlSession sqlSession1 = sqlSessionFactory.openSession(); SqlSession sqlSession2 = sqlSessionFactory.openSession(); SqlSession sqlSession3 = sqlSessionFactory.openSession(); //åˆ›å»ºUserMapperå¯¹è±¡,mybatisè‡ªåŠ¨ç”Ÿæˆä»£ç†å¯¹è±¡ UserMapper userMapper1 = sqlSession1.getMapper(UserMapper.class); //sqlSession1 æ‰§è¡ŒæŸ¥è¯¢ å†™å…¥ç¼“å­˜(ç¬¬ä¸€æ¬¡æŸ¥è¯¢è¯·æ±‚) User user1 = userMapper1.findUserById(1); System.out.println(user1); sqlSession1.close(); //sqlSession3 æ‰§è¡Œæäº¤ æ¸…ç©ºç¼“å­˜ UserMapper userMapper3 = sqlSession3.getMapper(UserMapper.class); User user3 = userMapper3.findUserById(1); user3.setSex(\"å¥³\"); user3.setAddress(\"å±±ä¸œæµå—\"); user3.setUsername(\"å´”å»º\"); userMapper3.updateUserById(user3); //æäº¤äº‹åŠ¡ï¼Œæ¸…ç©ºç¼“å­˜ sqlSession3.commit(); sqlSession3.close(); //sqlSession2 æ‰§è¡ŒæŸ¥è¯¢(ç¬¬äºŒæ¬¡æŸ¥è¯¢è¯·æ±‚) UserMapper userMapper2 = sqlSession2.getMapper(UserMapper.class); User user2 = userMapper2.findUserById(1); System.out.println(user2); sqlSession2.close(); &#125; ç»“æœï¼š useCache é…ç½® åœ¨ statement ä¸­è®¾ç½® useCache=false å¯ä»¥ç¦ç”¨å½“å‰ select è¯­å¥çš„äºŒçº§ç¼“å­˜ï¼Œå³æ¯æ¬¡æŸ¥è¯¢éƒ½ä¼šå‘å‡ºsqlå»æŸ¥è¯¢ï¼Œé»˜è®¤æƒ…å†µæ˜¯trueï¼Œå³è¯¥sqlä½¿ç”¨äºŒçº§ç¼“å­˜ã€‚ 1&lt;select id=\"findUserById\" parameterType=\"int\" resultType=\"user\" useCache=\"false\"&gt; æ€»ç»“ï¼šé’ˆå¯¹æ¯æ¬¡æŸ¥è¯¢éƒ½éœ€è¦æœ€æ–°çš„æ•°æ®sqlï¼Œè¦è®¾ç½®æˆuseCache=falseï¼Œç¦ç”¨äºŒçº§ç¼“å­˜ã€‚ åˆ·æ–°ç¼“å­˜ï¼ˆæ¸…ç©ºç¼“å­˜ï¼‰ åœ¨mapperçš„åŒä¸€ä¸ªnamespaceä¸­ï¼Œå¦‚æœæœ‰å…¶å®ƒinsertã€updateã€deleteæ“ä½œæ•°æ®åéœ€è¦åˆ·æ–°ç¼“å­˜ï¼Œå¦‚æœä¸æ‰§è¡Œåˆ·æ–°ç¼“å­˜ä¼šå‡ºç°è„è¯»ã€‚ è®¾ç½®statementé…ç½®ä¸­çš„flushCache=â€trueâ€ å±æ€§ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸ºtrueå³åˆ·æ–°ç¼“å­˜ï¼Œå¦‚æœæ”¹æˆfalseåˆ™ä¸ä¼šåˆ·æ–°ã€‚ä½¿ç”¨ç¼“å­˜æ—¶å¦‚æœæ‰‹åŠ¨ä¿®æ”¹æ•°æ®åº“è¡¨ä¸­çš„æŸ¥è¯¢æ•°æ®ä¼šå‡ºç°è„è¯»ã€‚ å¦‚ä¸‹ï¼š 1&lt;insert id=\"insetrUser\" parameterType=\"cn.zhisheng.mybatis.po.User\" flushCache=\"true\"&gt; ä¸€èˆ¬ä¸‹æ‰§è¡Œå®Œcommitæ“ä½œéƒ½éœ€è¦åˆ·æ–°ç¼“å­˜ï¼ŒflushCache=trueè¡¨ç¤ºåˆ·æ–°ç¼“å­˜ï¼Œè¿™æ ·å¯ä»¥é¿å…æ•°æ®åº“è„è¯»ã€‚ Mybatis Cacheå‚æ•°flushIntervalï¼ˆåˆ·æ–°é—´éš”ï¼‰å¯ä»¥è¢«è®¾ç½®ä¸ºä»»æ„çš„æ­£æ•´æ•°ï¼Œè€Œä¸”å®ƒä»¬ä»£è¡¨ä¸€ä¸ªåˆç†çš„æ¯«ç§’å½¢å¼çš„æ—¶é—´æ®µã€‚é»˜è®¤æƒ…å†µæ˜¯ä¸è®¾ç½®ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰åˆ·æ–°é—´éš”ï¼Œç¼“å­˜ä»…ä»…è°ƒç”¨è¯­å¥æ—¶åˆ·æ–°ã€‚ sizeï¼ˆå¼•ç”¨æ•°ç›®ï¼‰å¯ä»¥è¢«è®¾ç½®ä¸ºä»»æ„æ­£æ•´æ•°ï¼Œè¦è®°ä½ä½ ç¼“å­˜çš„å¯¹è±¡æ•°ç›®å’Œä½ è¿è¡Œç¯å¢ƒçš„å¯ç”¨å†…å­˜èµ„æºæ•°ç›®ã€‚é»˜è®¤å€¼æ˜¯1024ã€‚ readOnlyï¼ˆåªè¯»ï¼‰å±æ€§å¯ä»¥è¢«è®¾ç½®ä¸ºtrueæˆ–falseã€‚åªè¯»çš„ç¼“å­˜ä¼šç»™æ‰€æœ‰è°ƒç”¨è€…è¿”å›ç¼“å­˜å¯¹è±¡çš„ç›¸åŒå®ä¾‹ã€‚å› æ­¤è¿™äº›å¯¹è±¡ä¸èƒ½è¢«ä¿®æ”¹ã€‚è¿™æä¾›äº†å¾ˆé‡è¦çš„æ€§èƒ½ä¼˜åŠ¿ã€‚å¯è¯»å†™çš„ç¼“å­˜ä¼šè¿”å›ç¼“å­˜å¯¹è±¡çš„æ‹·è´ï¼ˆé€šè¿‡åºåˆ—åŒ–ï¼‰ã€‚è¿™ä¼šæ…¢ä¸€äº›ï¼Œä½†æ˜¯å®‰å…¨ï¼Œå› æ­¤é»˜è®¤æ˜¯falseã€‚ å¦‚ä¸‹ä¾‹å­ï¼š 1&lt;cache eviction=\"FIFO\" flushInterval=\"60000\" size=\"512\" readOnly=\"true\"/&gt; è¿™ä¸ªæ›´é«˜çº§çš„é…ç½®åˆ›å»ºäº†ä¸€ä¸ª FIFO ç¼“å­˜,å¹¶æ¯éš” 60 ç§’åˆ·æ–°,å­˜æ•°ç»“æœå¯¹è±¡æˆ–åˆ—è¡¨çš„ 512 ä¸ªå¼•ç”¨,è€Œä¸”è¿”å›çš„å¯¹è±¡è¢«è®¤ä¸ºæ˜¯åªè¯»çš„,å› æ­¤åœ¨ä¸åŒçº¿ç¨‹ä¸­çš„è°ƒç”¨è€…ä¹‹é—´ä¿®æ”¹å®ƒä»¬ä¼šå¯¼è‡´å†²çªã€‚å¯ç”¨çš„æ”¶å›ç­–ç•¥æœ‰, é»˜è®¤çš„æ˜¯ LRU: LRU â€“ æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„:ç§»é™¤æœ€é•¿æ—¶é—´ä¸è¢«ä½¿ç”¨çš„å¯¹è±¡ã€‚ FIFO â€“ å…ˆè¿›å…ˆå‡º:æŒ‰å¯¹è±¡è¿›å…¥ç¼“å­˜çš„é¡ºåºæ¥ç§»é™¤å®ƒä»¬ã€‚ SOFT â€“ è½¯å¼•ç”¨:ç§»é™¤åŸºäºåƒåœ¾å›æ”¶å™¨çŠ¶æ€å’Œè½¯å¼•ç”¨è§„åˆ™çš„å¯¹è±¡ã€‚ WEAK â€“ å¼±å¼•ç”¨:æ›´ç§¯æåœ°ç§»é™¤åŸºäºåƒåœ¾æ”¶é›†å™¨çŠ¶æ€å’Œå¼±å¼•ç”¨è§„åˆ™çš„å¯¹è±¡ã€‚ Mybatis æ•´åˆ ehcacheehcache æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç¼“å­˜æ¡†æ¶ã€‚ åˆ†å¸ƒç¼“å­˜ æˆ‘ä»¬ç³»ç»Ÿä¸ºäº†æé«˜ç³»ç»Ÿå¹¶å‘ï¼Œæ€§èƒ½ã€ä¸€èˆ¬å¯¹ç³»ç»Ÿè¿›è¡Œåˆ†å¸ƒå¼éƒ¨ç½²ï¼ˆé›†ç¾¤éƒ¨ç½²æ–¹å¼ï¼‰ ä¸ä½¿ç”¨åˆ†å¸ƒç¼“å­˜ï¼Œç¼“å­˜çš„æ•°æ®åœ¨å„å„æœåŠ¡å•ç‹¬å­˜å‚¨ï¼Œä¸æ–¹ä¾¿ç³»ç»Ÿ å¼€å‘ã€‚æ‰€ä»¥è¦ä½¿ç”¨åˆ†å¸ƒå¼ç¼“å­˜å¯¹ç¼“å­˜æ•°æ®è¿›è¡Œé›†ä¸­ç®¡ç†ã€‚ mybatisæ— æ³•å®ç°åˆ†å¸ƒå¼ç¼“å­˜ï¼Œéœ€è¦å’Œå…¶å®ƒåˆ†å¸ƒå¼ç¼“å­˜æ¡†æ¶è¿›è¡Œæ•´åˆã€‚ æ•´åˆæ–¹æ³• mybatis æä¾›äº†ä¸€ä¸ªäºŒçº§ç¼“å­˜ cache æ¥å£ï¼ˆorg.apache.ibatis.cache ä¸‹çš„ Cacheï¼‰ï¼Œå¦‚æœè¦å®ç°è‡ªå·±çš„ç¼“å­˜é€»è¾‘ï¼Œå®ç°cacheæ¥å£å¼€å‘å³å¯ã€‚ 12345678910import java.util.concurrent.locks.ReadWriteLock;public interface Cache &#123; String getId(); void putObject(Object var1, Object var2); Object getObject(Object var1); Object removeObject(Object var1); void clear(); int getSize(); ReadWriteLock getReadWriteLock();&#125; mybatiså’Œehcacheæ•´åˆï¼Œmybatis å’Œ ehcache æ•´åˆåŒ…ä¸­æä¾›äº†ä¸€ä¸ª cache æ¥å£çš„å®ç°ç±»(org.apache.ibatis.cache.impl ä¸‹çš„ PerpetualCache)ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253package org.apache.ibatis.cache.impl;import java.util.HashMap;import java.util.Map;import java.util.concurrent.locks.ReadWriteLock;import org.apache.ibatis.cache.Cache;import org.apache.ibatis.cache.CacheException;public class PerpetualCache implements Cache &#123; private String id; private Map&lt;Object, Object&gt; cache = new HashMap(); public PerpetualCache(String id) &#123; this.id = id; &#125; public String getId() &#123; return this.id; &#125; public int getSize() &#123; return this.cache.size(); &#125; public void putObject(Object key, Object value) &#123; this.cache.put(key, value); &#125; public Object getObject(Object key) &#123; return this.cache.get(key); &#125; public Object removeObject(Object key) &#123; return this.cache.remove(key); &#125; public void clear() &#123; this.cache.clear(); &#125; public ReadWriteLock getReadWriteLock() &#123; return null; &#125; public boolean equals(Object o) &#123; if(this.getId() == null) &#123; throw new CacheException(\"Cache instances require an ID.\"); &#125; else if(this == o) &#123; return true; &#125; else if(!(o instanceof Cache)) &#123; return false; &#125; else &#123; Cache otherCache = (Cache)o; return this.getId().equals(otherCache.getId()); &#125; &#125; public int hashCode() &#123; if(this.getId() == null) &#123; throw new CacheException(\"Cache instances require an ID.\"); &#125; else &#123; return this.getId().hashCode(); &#125; &#125;&#125; é€šè¿‡å®ç° Cache æ¥å£å¯ä»¥å®ç° mybatis ç¼“å­˜æ•°æ®é€šè¿‡å…¶å®ƒç¼“å­˜æ•°æ®åº“æ•´åˆï¼Œmybatis çš„ç‰¹é•¿æ˜¯sqlæ“ä½œï¼Œç¼“å­˜æ•°æ®çš„ç®¡ç†ä¸æ˜¯ mybatis çš„ç‰¹é•¿ï¼Œä¸ºäº†æé«˜ç¼“å­˜çš„æ€§èƒ½å°† mybatis å’Œç¬¬ä¸‰æ–¹çš„ç¼“å­˜æ•°æ®åº“æ•´åˆï¼Œæ¯”å¦‚ ehcacheã€memcacheã€redisç­‰ã€‚ å¼•å…¥ä¾èµ–åŒ… ehcache-core-2.6.5.jar å’Œ mybatis-ehcache-1.0.2.jar å¼•å…¥ç¼“å­˜é…ç½®æ–‡ä»¶ classpathä¸‹æ·»åŠ ï¼šehcache.xml å†…å®¹å¦‚ä¸‹ï¼š 1234567891011121314&lt;ehcache xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:noNamespaceSchemaLocation=\"http://ehcache.org/ehcache.xsd\"&gt; &lt;diskStore path=\"C:\\JetBrains\\IDEAProject\\ehcache\" /&gt; &lt;defaultCache maxElementsInMemory=\"1000\" maxElementsOnDisk=\"10000000\" eternal=\"false\" overflowToDisk=\"false\" timeToIdleSeconds=\"120\" timeToLiveSeconds=\"120\" diskExpiryThreadIntervalSeconds=\"120\" memoryStoreEvictionPolicy=\"LRU\"&gt; &lt;/defaultCache&gt;&lt;/ehcache&gt; å±æ€§è¯´æ˜ï¼š diskStoreï¼šæŒ‡å®šæ•°æ®åœ¨ç£ç›˜ä¸­çš„å­˜å‚¨ä½ç½®ã€‚ defaultCacheï¼šå½“å€ŸåŠ© CacheManager.add(â€œdemoCacheâ€) åˆ›å»ºCacheæ—¶ï¼ŒEhCache ä¾¿ä¼šé‡‡ç”¨æŒ‡å®šçš„çš„ç®¡ç†ç­–ç•¥ ä»¥ä¸‹å±æ€§æ˜¯å¿…é¡»çš„ï¼š maxElementsInMemory - åœ¨å†…å­˜ä¸­ç¼“å­˜çš„elementçš„æœ€å¤§æ•°ç›® maxElementsOnDisk - åœ¨ç£ç›˜ä¸Šç¼“å­˜çš„elementçš„æœ€å¤§æ•°ç›®ï¼Œè‹¥æ˜¯0è¡¨ç¤ºæ— ç©·å¤§ eternal - è®¾å®šç¼“å­˜çš„elementsæ˜¯å¦æ°¸è¿œä¸è¿‡æœŸã€‚å¦‚æœä¸ºtrueï¼Œåˆ™ç¼“å­˜çš„æ•°æ®å§‹ç»ˆæœ‰æ•ˆï¼Œå¦‚æœä¸ºfalseé‚£ä¹ˆè¿˜è¦æ ¹æ®timeToIdleSecondsï¼ŒtimeToLiveSecondsåˆ¤æ–­ overflowToDisk- è®¾å®šå½“å†…å­˜ç¼“å­˜æº¢å‡ºçš„æ—¶å€™æ˜¯å¦å°†è¿‡æœŸçš„elementç¼“å­˜åˆ°ç£ç›˜ä¸Š ä»¥ä¸‹å±æ€§æ˜¯å¯é€‰çš„ï¼š timeToIdleSeconds - å½“ç¼“å­˜åœ¨EhCacheä¸­çš„æ•°æ®å‰åä¸¤æ¬¡è®¿é—®çš„æ—¶é—´è¶…è¿‡timeToIdleSecondsçš„å±æ€§å–å€¼æ—¶ï¼Œè¿™äº›æ•°æ®ä¾¿ä¼šåˆ é™¤ï¼Œé»˜è®¤å€¼æ˜¯0,ä¹Ÿå°±æ˜¯å¯é—²ç½®æ—¶é—´æ— ç©·å¤§ timeToLiveSeconds - ç¼“å­˜elementçš„æœ‰æ•ˆç”Ÿå‘½æœŸï¼Œé»˜è®¤æ˜¯0.,ä¹Ÿå°±æ˜¯elementå­˜æ´»æ—¶é—´æ— ç©·å¤§ diskSpoolBufferSizeMB è¿™ä¸ªå‚æ•°è®¾ç½®DiskStore(ç£ç›˜ç¼“å­˜)çš„ç¼“å­˜åŒºå¤§å°.é»˜è®¤æ˜¯30MB.æ¯ä¸ªCacheéƒ½åº”è¯¥æœ‰è‡ªå·±çš„ä¸€ä¸ªç¼“å†²åŒº. diskPersistent- åœ¨VMé‡å¯çš„æ—¶å€™æ˜¯å¦å¯ç”¨ç£ç›˜ä¿å­˜EhCacheä¸­çš„æ•°æ®ï¼Œé»˜è®¤æ˜¯falseã€‚ diskExpiryThreadIntervalSeconds - ç£ç›˜ç¼“å­˜çš„æ¸…ç†çº¿ç¨‹è¿è¡Œé—´éš”ï¼Œé»˜è®¤æ˜¯120ç§’ã€‚æ¯ä¸ª120sï¼Œç›¸åº”çš„çº¿ç¨‹ä¼šè¿›è¡Œä¸€æ¬¡EhCacheä¸­æ•°æ®çš„æ¸…ç†å·¥ä½œ memoryStoreEvictionPolicy - å½“å†…å­˜ç¼“å­˜è¾¾åˆ°æœ€å¤§ï¼Œæœ‰æ–°çš„elementåŠ å…¥çš„æ—¶å€™ï¼Œ ç§»é™¤ç¼“å­˜ä¸­elementçš„ç­–ç•¥ã€‚é»˜è®¤æ˜¯LRUï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰ï¼Œå¯é€‰çš„æœ‰LFUï¼ˆæœ€ä¸å¸¸ä½¿ç”¨ï¼‰å’ŒFIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰ å¼€å¯ehcacheç¼“å­˜ EhcacheCache æ˜¯ehcacheå¯¹Cacheæ¥å£çš„å®ç°ï¼›ä¿®æ”¹mapper.xmlæ–‡ä»¶ï¼Œåœ¨cacheä¸­æŒ‡å®šEhcacheCacheã€‚ æ ¹æ®éœ€æ±‚è°ƒæ•´ç¼“å­˜å‚æ•°ï¼š 123456789&lt;cache type=\"org.mybatis.caches.ehcache.EhcacheCache\" &gt; &lt;property name=\"timeToIdleSeconds\" value=\"3600\"/&gt; &lt;property name=\"timeToLiveSeconds\" value=\"3600\"/&gt; &lt;!-- åŒehcacheå‚æ•°maxElementsInMemory --&gt; &lt;property name=\"maxEntriesLocalHeap\" value=\"1000\"/&gt; &lt;!-- åŒehcacheå‚æ•°maxElementsOnDisk --&gt; &lt;property name=\"maxEntriesLocalDisk\" value=\"10000000\"/&gt; &lt;property name=\"memoryStoreEvictionPolicy\" value=\"LRU\"/&gt; &lt;/cache&gt; æµ‹è¯• ï¼š(è¿™å‘½ä¸­ç‡å°±ä»£è¡¨æˆåŠŸå°†ehcache ä¸ mybatis æ•´åˆäº†) åº”ç”¨åœºæ™¯å¯¹äºè®¿é—®å¤šçš„æŸ¥è¯¢è¯·æ±‚ä¸”ç”¨æˆ·å¯¹æŸ¥è¯¢ç»“æœå®æ—¶æ€§è¦æ±‚ä¸é«˜ï¼Œæ­¤æ—¶å¯é‡‡ç”¨ mybatis äºŒçº§ç¼“å­˜æŠ€æœ¯é™ä½æ•°æ®åº“è®¿é—®é‡ï¼Œæé«˜è®¿é—®é€Ÿåº¦ï¼Œä¸šåŠ¡åœºæ™¯æ¯”å¦‚ï¼šè€—æ—¶è¾ƒé«˜çš„ç»Ÿè®¡åˆ†æsqlã€ç”µè¯è´¦å•æŸ¥è¯¢sqlç­‰ã€‚ å®ç°æ–¹æ³•å¦‚ä¸‹ï¼šé€šè¿‡è®¾ç½®åˆ·æ–°é—´éš”æ—¶é—´ï¼Œç”± mybatis æ¯éš”ä¸€æ®µæ—¶é—´è‡ªåŠ¨æ¸…ç©ºç¼“å­˜ï¼Œæ ¹æ®æ•°æ®å˜åŒ–é¢‘ç‡è®¾ç½®ç¼“å­˜åˆ·æ–°é—´éš” flushIntervalï¼Œæ¯”å¦‚è®¾ç½®ä¸º30åˆ†é’Ÿã€60åˆ†é’Ÿã€24å°æ—¶ç­‰ï¼Œæ ¹æ®éœ€æ±‚è€Œå®šã€‚ å±€é™æ€§mybatis äºŒçº§ç¼“å­˜å¯¹ç»†ç²’åº¦çš„æ•°æ®çº§åˆ«çš„ç¼“å­˜å®ç°ä¸å¥½ï¼Œæ¯”å¦‚å¦‚ä¸‹éœ€æ±‚ï¼šå¯¹å•†å“ä¿¡æ¯è¿›è¡Œç¼“å­˜ï¼Œç”±äºå•†å“ä¿¡æ¯æŸ¥è¯¢è®¿é—®é‡å¤§ï¼Œä½†æ˜¯è¦æ±‚ç”¨æˆ·æ¯æ¬¡éƒ½èƒ½æŸ¥è¯¢æœ€æ–°çš„å•†å“ä¿¡æ¯ï¼Œæ­¤æ—¶å¦‚æœä½¿ç”¨ mybatis çš„äºŒçº§ç¼“å­˜å°±æ— æ³•å®ç°å½“ä¸€ä¸ªå•†å“å˜åŒ–æ—¶åªåˆ·æ–°è¯¥å•†å“çš„ç¼“å­˜ä¿¡æ¯è€Œä¸åˆ·æ–°å…¶å®ƒå•†å“çš„ä¿¡æ¯ï¼Œå› ä¸º mybaits çš„äºŒçº§ç¼“å­˜åŒºåŸŸä»¥ mapper ä¸ºå•ä½åˆ’åˆ†ï¼Œå½“ä¸€ä¸ªå•†å“ä¿¡æ¯å˜åŒ–ä¼šå°†æ‰€æœ‰å•†å“ä¿¡æ¯çš„ç¼“å­˜æ•°æ®å…¨éƒ¨æ¸…ç©ºã€‚è§£å†³æ­¤ç±»é—®é¢˜éœ€è¦åœ¨ä¸šåŠ¡å±‚æ ¹æ®éœ€æ±‚å¯¹æ•°æ®æœ‰é’ˆå¯¹æ€§ç¼“å­˜ã€‚","tags":[{"name":"Mybatis","slug":"Mybatis","permalink":"http://www.54tianzhisheng.cn/tags/Mybatis/"},{"name":"SpringMVC","slug":"SpringMVC","permalink":"http://www.54tianzhisheng.cn/tags/SpringMVC/"}]},{"title":"é€šè¿‡é¡¹ç›®é€æ­¥æ·±å…¥äº†è§£Mybatisï¼ˆä¸‰ï¼‰","date":"2017-06-13T16:00:00.000Z","path":"2017/06/14/é€šè¿‡é¡¹ç›®é€æ­¥æ·±å…¥äº†è§£Mybatis(ä¸‰)/","text":"ç›¸å…³é˜…è¯»ï¼š1ã€é€šè¿‡é¡¹ç›®é€æ­¥æ·±å…¥äº†è§£Mybatis&lt;ä¸€&gt; 2ã€ é€šè¿‡é¡¹ç›®é€æ­¥æ·±å…¥äº†è§£Mybatis&lt;äºŒ&gt; æœ¬é¡¹ç›®æ‰€æœ‰ä»£ç åŠæ–‡æ¡£éƒ½æ‰˜ç®¡åœ¨ Githubåœ°å€ï¼šhttps://github.com/zhisheng17/mybatis Mybatis é«˜çº§çŸ¥è¯†å®‰æ’ï¼šå¯¹è®¢å•å•†å“æ•°æ®æ¨¡å‹è¿›è¡Œåˆ†æ è®¢å•å•†å“æ•°æ®æ¨¡å‹ æ•°æ®æ¨¡å‹åˆ†ææ€è·¯ï¼š1ã€æ¯å¼ è¡¨è®°å½•çš„æ•°æ®å†…å®¹ï¼ˆåˆ†æ¨¡å—å¯¹æ¯å¼ è¡¨è®°å½•çš„å†…å®¹è¿›è¡Œç†Ÿæ‚‰ï¼Œç›¸å½“äºå­¦ä¹ ç³»ç»Ÿéœ€æ±‚çš„è¿‡ç¨‹ï¼‰ 2ã€æ¯å¼ è¡¨é‡è¦çš„çš„å­—æ®µè®¾ç½®ï¼ˆéç©ºå­—æ®µã€å¤–é”®å­—æ®µï¼‰ 3ã€æ•°æ®åº“çº§åˆ«è¡¨ä¸è¡¨ä¹‹é—´çš„å…³ç³»ï¼ˆå¤–é”®å…³ç³»ï¼‰ 4ã€è¡¨ä¸è¡¨ä¸šåŠ¡ä¹‹é—´çš„å…³ç³»ï¼ˆè¦å»ºç«‹åœ¨æ¯ä¸ªä¸šåŠ¡æ„ä¹‰çš„åŸºç¡€ä¸Šå»åˆ†æï¼‰ æ•°æ®æ¨¡å‹åˆ†ææ¨¡å‹ ç”¨æˆ·è¡¨ userï¼šè®°å½•è´­ä¹°å•†å“çš„ç”¨æˆ·ä¿¡æ¯ è®¢å•è¡¨ orderï¼šè®°å½•ç”¨æˆ·æ‰€åˆ›å»ºçš„è®¢å•(è´­ä¹°å•†å“çš„è®¢å•) è®¢å•æ˜ç»†è¡¨ orderdetailï¼šï¼ˆè®°å½•äº†è®¢å•çš„è¯¦ç»†ä¿¡æ¯å³è´­ä¹°å•†å“çš„ä¿¡æ¯ï¼‰ å•†å“è¡¨ itemsï¼šè®°å½•äº†å•†å“ä¿¡æ¯ è¡¨ä¸è¡¨ä¸šåŠ¡ä¹‹é—´çš„å…³ç³»ï¼š åœ¨åˆ†æè¡¨ä¸è¡¨ä¹‹é—´çš„ä¸šåŠ¡å…³ç³»æ—¶éœ€è¦å»ºç«‹åœ¨æŸä¸ªä¸šåŠ¡æ„ä¹‰åŸºç¡€ä¸Šå»åˆ†æã€‚ å…ˆåˆ†ææ•°æ®çº§åˆ«ä¹‹é—´æœ‰å…³ç³»çš„è¡¨ä¹‹é—´çš„ä¸šåŠ¡å…³ç³»ï¼š 1ã€usreå’Œordersï¼š user â€”&gt; ordersï¼šä¸€ä¸ªç”¨æˆ·å¯ä»¥åˆ›å»ºå¤šä¸ªè®¢å•ï¼Œä¸€å¯¹å¤š orders â€”&gt; userï¼šä¸€ä¸ªè®¢å•åªç”±ä¸€ä¸ªç”¨æˆ·åˆ›å»ºï¼Œä¸€å¯¹ä¸€ 2ã€ orderså’Œorderdetailï¼š orders â€”&gt; orderdetailï¼šä¸€ä¸ªè®¢å•å¯ä»¥åŒ…æ‹¬ å¤šä¸ªè®¢å•æ˜ç»†ï¼Œå› ä¸ºä¸€ä¸ªè®¢å•å¯ä»¥è´­ä¹°å¤šä¸ªå•†å“ï¼Œæ¯ä¸ªå•†å“çš„è´­ä¹°ä¿¡æ¯åœ¨orderdetailè®°å½•ï¼Œä¸€å¯¹å¤šå…³ç³» orderdetail â€”&gt; ordersï¼šä¸€ä¸ªè®¢å•æ˜ç»†åªèƒ½åŒ…æ‹¬åœ¨ä¸€ä¸ªè®¢å•ä¸­ï¼Œä¸€å¯¹ä¸€ 3ã€ orderdetail å’Œ itesmï¼š orderdetail â€”&gt; itesmsï¼šä¸€ä¸ªè®¢å•æ˜ç»†åªå¯¹åº”ä¸€ä¸ªå•†å“ä¿¡æ¯ï¼Œä¸€å¯¹ä¸€ items â€”&gt; orderdetail:ä¸€ä¸ªå•†å“å¯ä»¥åŒ…æ‹¬åœ¨å¤šä¸ªè®¢å•æ˜ç»† ï¼Œä¸€å¯¹å¤š å†åˆ†ææ•°æ®åº“çº§åˆ«æ²¡æœ‰å…³ç³»çš„è¡¨ä¹‹é—´æ˜¯å¦æœ‰ä¸šåŠ¡å…³ç³»ï¼š 4ã€ orders å’Œ itemsï¼š orders å’Œ items ä¹‹é—´å¯ä»¥é€šè¿‡ orderdetail è¡¨å»ºç«‹ å…³ç³»ã€‚ ä¸€å¯¹ä¸€æŸ¥è¯¢éœ€æ±‚ï¼šæŸ¥è¯¢è®¢å•ä¿¡æ¯ï¼Œå…³è”æŸ¥è¯¢åˆ›å»ºè®¢å•çš„ç”¨æˆ·ä¿¡æ¯ ä½¿ç”¨ resultType sql è¯­å¥ ç¡®å®šæŸ¥è¯¢çš„ä¸»è¡¨ï¼šè®¢å•è¡¨ ç¡®å®šæŸ¥è¯¢çš„å…³è”è¡¨ï¼šç”¨æˆ·è¡¨ å…³è”æŸ¥è¯¢ä½¿ç”¨å†…é“¾æ¥ï¼Ÿè¿˜æ˜¯å¤–é“¾æ¥ï¼Ÿ ç”±äºordersè¡¨ä¸­æœ‰ä¸€ä¸ªå¤–é”®ï¼ˆuser_idï¼‰ï¼Œé€šè¿‡å¤–é”®å…³è”æŸ¥è¯¢ç”¨æˆ·è¡¨åªèƒ½æŸ¥è¯¢å‡ºä¸€æ¡è®°å½•ï¼Œå¯ä»¥ä½¿ç”¨å†…é“¾æ¥ã€‚ 1SELECT orders.*, USER.username, USER.sex, USER.address FROM orders, USER WHERE orders.user_id = user.id åˆ›å»º pojo Orders.java 123456789101112public class Orders &#123; private Integer id; private Integer userId; private String number; private Date createtime; private String note; //ç”¨æˆ·ä¿¡æ¯ private User user; //è®¢å•æ˜ç»† private List&lt;Orderdetail&gt; orderdetails; //getter and setter&#125; OrderCustom.java 1234567891011//é€šè¿‡æ­¤ç±»æ˜ å°„è®¢å•å’Œç”¨æˆ·æŸ¥è¯¢çš„ç»“æœï¼Œè®©æ­¤ç±»ç»§æ‰¿åŒ…æ‹¬ å­—æ®µè¾ƒå¤šçš„pojoç±»public class OrdersCustom extends Orders&#123; //æ·»åŠ ç”¨æˆ·å±æ€§ /*USER.username, USER.sex, USER.address */ private String username; private String sex; private String address; //getter and setter&#125; æ˜ å°„æ–‡ä»¶ OrdersMapperCustom.xml 1234&lt;!--æŸ¥è¯¢è®¢å•å…³è”æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯--&gt; &lt;select id=\"findOrdersUser\" resultType=\"cn.zhisheng.mybatis.po.OrdersCustom\"&gt; SELECT orders.*, USER.username, USER.sex, USER.address FROM orders, USER WHERE orders.user_id = user.id &lt;/select&gt; Mapper æ–‡ä»¶ OrdersMapperCustom.java 1234public interface OrdersMapperCustom&#123; public OrdersCustom findOrdersUser() throws Exception;&#125; æµ‹è¯•ä»£ç ï¼ˆè®°å¾—åœ¨ SqlConfig.xmlä¸­æ·»åŠ è½½ OrdersMapperCustom.xml æ–‡ä»¶ï¼‰ 1234567891011@Test public void testFindOrdersUser() throws Exception &#123; SqlSession sqlSession = sqlSessionFactory.openSession(); //åˆ›å»ºOrdersMapperCustomå¯¹è±¡,mybatisè‡ªåŠ¨ç”Ÿæˆä»£ç†å¯¹è±¡ OrdersMapperCustom ordersMapperCustom = sqlSession.getMapper(OrdersMapperCustom.class); //è°ƒç”¨OrdersMapperCustomçš„æ–¹æ³• List&lt;OrdersCustom&gt; list = ordersMapperCustom.findOrdersUser(); System.out.println(list); sqlSession.close(); &#125; æµ‹è¯•ç»“æœ â€‹ â€‹ ä½¿ç”¨ resultMap sql è¯­å¥ï¼ˆå’Œä¸Šé¢çš„ä¸€è‡´ï¼‰ ä½¿ç”¨ resultMap æ˜ å°„æ€è·¯ ä½¿ç”¨ resultMap å°†æŸ¥è¯¢ç»“æœä¸­çš„è®¢å•ä¿¡æ¯æ˜ å°„åˆ° Orders å¯¹è±¡ä¸­ï¼Œåœ¨ orders ç±»ä¸­æ·»åŠ  User å±æ€§ï¼Œå°†å…³è”æŸ¥è¯¢å‡ºæ¥çš„ç”¨æˆ·ä¿¡æ¯æ˜ å°„åˆ° orders å¯¹è±¡ä¸­çš„ user å±æ€§ä¸­ã€‚ 12//ç”¨æˆ·ä¿¡æ¯private User user; æ˜ å°„æ–‡ä»¶ OrdersMapperCustom.xml å…ˆå®šä¹‰ resultMap 1234567891011121314151617181920212223242526272829303132&lt;!--å®šä¹‰æŸ¥è¯¢è®¢å•å…³è”æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯çš„resultMap å°†æ•´ä¸ªæŸ¥è¯¢ç»“æœæ˜ å°„åˆ°cn.zhisheng.mybatis.po.Orders --&gt; &lt;resultMap id=\"OrdersUserResultMap\" type=\"cn.zhisheng.mybatis.po.Orders\"&gt; &lt;!--é…ç½®æ˜ å°„çš„è®¢å•ä¿¡æ¯--&gt; &lt;!--idè¡¨ç¤ºæŸ¥è¯¢ç»“æœä¸­çš„å”¯ä¸€æ ‡è¯† åœ¨è¿™é‡Œæ˜¯è®¢å•çš„å”¯ä¸€æ ‡è¯† å¦‚æœæ˜¯ç”±å¤šåˆ—ç»„æˆçš„å”¯ä¸€æ ‡è¯†ï¼Œé‚£ä¹ˆå°±éœ€è¦é…ç½®å¤šä¸ªid columnï¼šid æ˜¯è®¢å•ä¿¡æ¯ä¸­çš„å”¯ä¸€æ ‡è¯†åˆ— propertyï¼šid æ˜¯è®¢å•ä¿¡æ¯å”¯ä¸€æ ‡è¯†åˆ—æ‰€æ˜ å°„åˆ°ordersä¸­çš„idå±æ€§ æœ€ç»ˆresultMapå¯¹columnå’Œpropertyåšä¸€ä¸ªæ˜ å°„å…³ç³»ï¼ˆå¯¹åº”å…³ç³»ï¼‰ --&gt; &lt;id column=\"id\" property=\"id\"/&gt; &lt;result column=\"user_id\" property=\"userId\"/&gt; &lt;result column=\"number\" property=\"number\"/&gt; &lt;result column=\"createtime\" property=\"createtime\"/&gt; &lt;result column=\"note\" property=\"note\"/&gt; &lt;!--é…ç½®æ˜ å°„çš„å…³è”ç”¨æˆ·ä¿¡æ¯ association ç”¨äºæ˜ å°„å…³è”æŸ¥è¯¢å•ä¸ªå¯¹è±¡çš„ä¿¡æ¯ property å°†è¦å…³è”æŸ¥è¯¢çš„ç”¨æˆ·ä¿¡æ¯æ˜ å°„åˆ° ordersä¸­çš„å±æ€§ä¸­å» --&gt; &lt;association property=\"user\" javaType=\"cn.zhisheng.mybatis.po.User\"&gt; &lt;!--id å…³è”ç”¨æˆ·ä¿¡æ¯çš„å”¯ä¸€æ ‡è¯† column: æŒ‡å®šå”¯ä¸€æ ‡è¯†ç”¨æˆ·çš„ä¿¡æ¯ propertyï¼šæ˜ å°„åˆ°userçš„é‚£ä¸ªå±æ€§ --&gt; &lt;id column=\"user_id\" property=\"id\"/&gt; &lt;result column=\"username\" property=\"username\"/&gt; &lt;result column=\"sex\" property=\"sex\"/&gt; &lt;result column=\"address\" property=\"address\"/&gt; &lt;result column=\"birthday\" property=\"birthday\"/&gt; &lt;/association&gt; &lt;/resultMap&gt; 1234&lt;!--æŸ¥è¯¢è®¢å•å…³è”æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯, ä½¿ç”¨ resultMap--&gt; &lt;select id=\"findOrdersUserResultMap\" resultMap=\"OrdersUserResultMap\"&gt; SELECT orders.*, USER.username, USER.sex, USER.address FROM orders, USER WHERE orders.user_id = user.id &lt;/select&gt; Mapper æ–‡ä»¶ 1public List&lt;Orders&gt; findOrdersUserResultMap() throws Exception; æµ‹è¯•ä»£ç  1234567891011@Test public void testFindOrdersUserResultMap() throws Exception &#123; SqlSession sqlSession = sqlSessionFactory.openSession(); //åˆ›å»ºOrdersMapperCustomå¯¹è±¡,mybatisè‡ªåŠ¨ç”Ÿæˆä»£ç†å¯¹è±¡ OrdersMapperCustom ordersMapperCustom = sqlSession.getMapper(OrdersMapperCustom.class); //è°ƒç”¨OrdersMapperCustomçš„æ–¹æ³• List&lt;Orders&gt; list = ordersMapperCustom.findOrdersUserResultMap(); System.out.println(list); sqlSession.close(); &#125; æµ‹è¯•ç»“æœ ä½¿ç”¨ resultType å’Œ resultMap ä¸€å¯¹ä¸€æŸ¥è¯¢å°ç»“ resultTypeï¼šä½¿ç”¨resultTypeå®ç°è¾ƒä¸ºç®€å•ï¼Œå¦‚æœpojoä¸­æ²¡æœ‰åŒ…æ‹¬æŸ¥è¯¢å‡ºæ¥çš„åˆ—åï¼Œéœ€è¦å¢åŠ åˆ—åå¯¹åº”çš„å±æ€§ï¼Œå³å¯å®Œæˆæ˜ å°„ã€‚å¦‚æœæ²¡æœ‰æŸ¥è¯¢ç»“æœçš„ç‰¹æ®Šè¦æ±‚å»ºè®®ä½¿ç”¨resultTypeã€‚ resultMapï¼šéœ€è¦å•ç‹¬å®šä¹‰resultMapï¼Œå®ç°æœ‰ç‚¹éº»çƒ¦ï¼Œå¦‚æœå¯¹æŸ¥è¯¢ç»“æœæœ‰ç‰¹æ®Šçš„è¦æ±‚ï¼Œä½¿ç”¨resultMapå¯ä»¥å®Œæˆå°†å…³è”æŸ¥è¯¢æ˜ å°„pojoçš„å±æ€§ä¸­ã€‚resultMapå¯ä»¥å®ç°å»¶è¿ŸåŠ è½½ï¼ŒresultTypeæ— æ³•å®ç°å»¶è¿ŸåŠ è½½ã€‚ ä¸€å¯¹å¤šæŸ¥è¯¢éœ€æ±‚ï¼šæŸ¥è¯¢è®¢å•åŠè®¢å•æ˜ç»†ä¿¡æ¯ SQLè¯­å¥ï¼š ç¡®å®šä¸»æŸ¥è¯¢è¡¨ï¼šè®¢å•è¡¨ ç¡®å®šå…³è”æŸ¥è¯¢è¡¨ï¼šè®¢å•æ˜ç»†è¡¨ åœ¨ä¸€å¯¹ä¸€æŸ¥è¯¢åŸºç¡€ä¸Šæ·»åŠ è®¢å•æ˜ç»†è¡¨å…³è”å³å¯ã€‚ 12SELECT orders.*, USER.username, USER.sex, USER.address, orderdetail.id orderdetail_id, orderdetail.items_id, orderdetail.items_num, orderdetail.orders_id FROM orders, USER,orderdetail WHERE orders.user_id = user.id AND orderdetail.orders_id=orders.id åˆ†æï¼š ä½¿ç”¨ resultType å°†ä¸Šè¾¹çš„æŸ¥è¯¢ç»“æœæ˜ å°„åˆ° pojo ä¸­ï¼Œè®¢å•ä¿¡æ¯çš„å°±æ˜¯é‡å¤ã€‚ è¦æ±‚ï¼š å¯¹ orders æ˜ å°„ä¸èƒ½å‡ºç°é‡å¤è®°å½•ã€‚ åœ¨ orders.java ç±»ä¸­æ·»åŠ  List orderDetails å±æ€§ã€‚ æœ€ç»ˆä¼šå°†è®¢å•ä¿¡æ¯æ˜ å°„åˆ° orders ä¸­ï¼Œè®¢å•æ‰€å¯¹åº”çš„è®¢å•æ˜ç»†æ˜ å°„åˆ° orders ä¸­çš„ orderDetails å±æ€§ä¸­ã€‚ æ˜ å°„æˆçš„ orders è®°å½•æ•°ä¸ºä¸¤æ¡ï¼ˆordersä¿¡æ¯ä¸é‡å¤ï¼‰ æ¯ä¸ª orders ä¸­çš„ orderDetails å±æ€§å­˜å‚¨äº†è¯¥è®¢å•æ‰€å¯¹åº”çš„è®¢å•æ˜ç»†ã€‚ æ˜ å°„æ–‡ä»¶ï¼š é¦–å…ˆå®šä¹‰ resultMap 1234567891011121314151617181920&lt;!--å®šä¹‰æŸ¥è¯¢è®¢å•åŠè®¢å•æ˜ç»†ä¿¡æ¯çš„resultMapä½¿ç”¨extendsç»§æ‰¿ï¼Œä¸ç”¨åœ¨ä¸­é…ç½®è®¢å•ä¿¡æ¯å’Œç”¨æˆ·ä¿¡æ¯çš„æ˜ å°„--&gt; &lt;resultMap id=\"OrdersAndOrderDetailResultMap\" type=\"cn.zhisheng.mybatis.po.Orders\" extends=\"OrdersUserResultMap\"&gt; &lt;!-- è®¢å•ä¿¡æ¯ --&gt; &lt;!-- ç”¨æˆ·ä¿¡æ¯ --&gt; &lt;!-- ä½¿ç”¨extendsç»§æ‰¿ï¼Œä¸ç”¨åœ¨ä¸­é…ç½®è®¢å•ä¿¡æ¯å’Œç”¨æˆ·ä¿¡æ¯çš„æ˜ å°„ --&gt; &lt;!-- è®¢å•æ˜ç»†ä¿¡æ¯ ä¸€ä¸ªè®¢å•å…³è”æŸ¥è¯¢å‡ºäº†å¤šæ¡æ˜ç»†ï¼Œè¦ä½¿ç”¨collectionè¿›è¡Œæ˜ å°„ collectionï¼šå¯¹å…³è”æŸ¥è¯¢åˆ°å¤šæ¡è®°å½•æ˜ å°„åˆ°é›†åˆå¯¹è±¡ä¸­ propertyï¼šå°†å…³è”æŸ¥è¯¢åˆ°å¤šæ¡è®°å½•æ˜ å°„åˆ°cn.zhisheng.mybatis.po.Orderså“ªä¸ªå±æ€§ ofTypeï¼šæŒ‡å®šæ˜ å°„åˆ°listé›†åˆå±æ€§ä¸­pojoçš„ç±»å‹ --&gt; &lt;collection property=\"orderdetails\" ofType=\"cn.zhisheng.mybatis.po.Orderdetail\"&gt; &lt;!-- idï¼šè®¢å•æ˜ç»†å”¯ ä¸€æ ‡è¯† property:è¦å°†è®¢å•æ˜ç»†çš„å”¯ ä¸€æ ‡è¯† æ˜ å°„åˆ°cn.zhisheng.mybatis.po.Orderdetailçš„å“ªä¸ªå±æ€§--&gt; &lt;id column=\"orderdetail_id\" property=\"id\"/&gt; &lt;result column=\"items_id\" property=\"itemsId\"/&gt; &lt;result column=\"items_num\" property=\"itemsNum\"/&gt; &lt;result column=\"orders_id\" property=\"ordersId\"/&gt; &lt;/collection&gt; &lt;/resultMap&gt; 12345&lt;!--æŸ¥è¯¢è®¢å•åŠè®¢å•æ˜ç»†ä¿¡æ¯, ä½¿ç”¨ resultMap--&gt; &lt;select id=\"findOrdersAndOrderDetailResultMap\" resultMap=\"OrdersAndOrderDetailResultMap\"&gt; SELECT orders.*, USER.username, USER.sex, USER.address, orderdetail.id orderdetail_id, orderdetail.items_id, orderdetail.items_num, orderdetail.orders_id FROM orders, USER,orderdetail WHERE orders.user_id = user.id AND orderdetail.orders_id=orders.id &lt;/select&gt; Mapper æ–‡ä»¶ 1public List&lt;Orders&gt; findOrdersAndOrderDetailResultMap() throws Exception; æµ‹è¯•æ–‡ä»¶ 1234567891011@Test public void testFindOrdersAndOrderDetailResultMap() throws Exception &#123; SqlSession sqlSession = sqlSessionFactory.openSession(); //åˆ›å»ºOrdersMapperCustomå¯¹è±¡,mybatisè‡ªåŠ¨ç”Ÿæˆä»£ç†å¯¹è±¡ OrdersMapperCustom ordersMapperCustom = sqlSession.getMapper(OrdersMapperCustom.class); //è°ƒç”¨OrdersMapperCustomçš„æ–¹æ³• List&lt;Orders&gt; list = ordersMapperCustom.findOrdersAndOrderDetailResultMap(); System.out.println(list); sqlSession.close(); &#125; æµ‹è¯•ç»“æœ æ€»ç»“ï¼šmybatisä½¿ç”¨resultMapçš„collectionå¯¹å…³è”æŸ¥è¯¢çš„å¤šæ¡è®°å½•æ˜ å°„åˆ°ä¸€ä¸ªlisté›†åˆå±æ€§ä¸­ã€‚ ä½¿ç”¨resultTypeå®ç°ï¼šå°†è®¢å•æ˜ç»†æ˜ å°„åˆ°ordersä¸­çš„orderdetailsä¸­ï¼Œéœ€è¦è‡ªå·±å¤„ç†ï¼Œä½¿ç”¨åŒé‡å¾ªç¯éå†ï¼Œå»æ‰é‡å¤è®°å½•ï¼Œå°†è®¢å•æ˜ç»†æ”¾åœ¨orderdetailsä¸­ã€‚ å¤šå¯¹å¤šæŸ¥è¯¢éœ€æ±‚ï¼šæŸ¥è¯¢ç”¨æˆ·åŠç”¨æˆ·è´­ä¹°å•†å“ä¿¡æ¯ã€‚ SQLè¯­å¥ï¼š æŸ¥è¯¢ä¸»è¡¨æ˜¯ï¼šç”¨æˆ·è¡¨ å…³è”è¡¨ï¼šç”±äºç”¨æˆ·å’Œå•†å“æ²¡æœ‰ç›´æ¥å…³è”ï¼Œé€šè¿‡è®¢å•å’Œè®¢å•æ˜ç»†è¿›è¡Œå…³è”ï¼Œæ‰€ä»¥å…³è”è¡¨ï¼š ordersã€orderdetailã€items 123SELECT orders.*, USER.username, USER.sex, USER.address, orderdetail.id orderdetail_id,orderdetail.items_id, orderdetail.items_num, orderdetail.orders_id, items.name items_name,items.detail items_detail, items.price items_price FROM orders, USER, orderdetail, items WHERE orders.user_id = user.id AND orderdetail.orders_id=orders.id AND orderdetail.items_id = items.id æ˜ å°„æ€è·¯ï¼š å°†ç”¨æˆ·ä¿¡æ¯æ˜ å°„åˆ° user ä¸­ã€‚åœ¨ user ç±»ä¸­æ·»åŠ è®¢å•åˆ—è¡¨å±æ€§List orderslistï¼Œå°†ç”¨æˆ·åˆ›å»ºçš„è®¢å•æ˜ å°„åˆ°ordersliståœ¨Ordersä¸­æ·»åŠ è®¢å•æ˜ç»†åˆ—è¡¨å±æ€§Listorderdetialsï¼Œå°†è®¢å•çš„æ˜ç»†æ˜ å°„åˆ°orderdetialsåœ¨OrderDetailä¸­æ·»åŠ Itemså±æ€§ï¼Œå°†è®¢å•æ˜ç»†æ‰€å¯¹åº”çš„å•†å“æ˜ å°„åˆ°Items å®šä¹‰ resultMapï¼š12345678910111213141516171819202122232425262728293031323334353637383940414243&lt;!--å®šä¹‰æŸ¥è¯¢ç”¨æˆ·åŠç”¨æˆ·è´­ä¹°å•†å“ä¿¡æ¯çš„ resultMap--&gt; &lt;resultMap id=\"UserAndItemsResultMap\" type=\"cn.zhisheng.mybatis.po.User\"&gt; &lt;!--ç”¨æˆ·ä¿¡æ¯--&gt; &lt;id column=\"user_id\" property=\"id\"/&gt; &lt;result column=\"username\" property=\"username\"/&gt; &lt;result column=\"sex\" property=\"sex\"/&gt; &lt;result column=\"birthday\" property=\"birthday\"/&gt; &lt;result column=\"address\" property=\"address\"/&gt; &lt;!--è®¢å•ä¿¡æ¯ ä¸€ä¸ªç”¨æˆ·å¯¹åº”å¤šä¸ªè®¢å•ï¼Œä½¿ç”¨collectionæ˜ å°„ --&gt; &lt;collection property=\"ordersList\" ofType=\"cn.zhisheng.mybatis.po.Orders\"&gt; &lt;id column=\"id\" property=\"id\"/&gt; &lt;result column=\"user_id\" property=\"userId\"/&gt; &lt;result column=\"number\" property=\"number\"/&gt; &lt;result column=\"createtime\" property=\"createtime\"/&gt; &lt;result column=\"note\" property=\"note\"/&gt; &lt;!-- è®¢å•æ˜ç»† ä¸€ä¸ªè®¢å•åŒ…æ‹¬ å¤šä¸ªæ˜ç»† --&gt; &lt;collection property=\"orderdetails\" ofType=\"cn.zhisheng.mybatis.po.Orderdetail\"&gt; &lt;id column=\"orderdetail_id\" property=\"id\"/&gt; &lt;result column=\"orders_id\" property=\"ordersId\"/&gt; &lt;result column=\"items_id\" property=\"itemsId\"/&gt; &lt;result column=\"items_num\" property=\"itemsNum\"/&gt; &lt;!-- å•†å“ä¿¡æ¯ ä¸€ä¸ªè®¢å•æ˜ç»†å¯¹åº”ä¸€ä¸ªå•†å“ --&gt; &lt;association property=\"items\" javaType=\"cn.zhisheng.mybatis.po.Items\"&gt; &lt;id column=\"items_id\" property=\"id\"/&gt; &lt;result column=\"items_name\" property=\"name\"/&gt; &lt;result column=\"items_price\" property=\"price\"/&gt; &lt;result column=\"items_pic\" property=\"pic\"/&gt; &lt;result column=\"items_createtime\" property=\"createtime\"/&gt; &lt;result column=\"items_detail\" property=\"detail\"/&gt; &lt;/association&gt; &lt;/collection&gt; &lt;/collection&gt; &lt;/resultMap&gt; æ˜ å°„æ–‡ä»¶12345&lt;!--æŸ¥è¯¢ç”¨æˆ·åŠç”¨æˆ·è´­ä¹°å•†å“ä¿¡æ¯, ä½¿ç”¨ resultMap--&gt; &lt;select id=\"findUserAndItemsResultMap\" resultMap=\"UserAndItemsResultMap\"&gt; SELECT orders.*, USER.username, USER.sex, USER.address, orderdetail.id orderdetail_id, orderdetail.items_id, orderdetail.items_num, orderdetail.orders_id FROM orders, USER,orderdetail WHERE orders.user_id = user.id AND orderdetail.orders_id=orders.id &lt;/select&gt; Mapper æ–‡ä»¶1public List&lt;User&gt; findUserAndItemsResultMap() throws Exception; æµ‹è¯•æ–‡ä»¶1234567891011@Test public void testFindUserAndItemsResultMap() throws Exception &#123; SqlSession sqlSession = sqlSessionFactory.openSession(); //åˆ›å»ºOrdersMapperCustomå¯¹è±¡,mybatisè‡ªåŠ¨ç”Ÿæˆä»£ç†å¯¹è±¡ OrdersMapperCustom ordersMapperCustom = sqlSession.getMapper(OrdersMapperCustom.class); //è°ƒç”¨OrdersMapperCustomçš„æ–¹æ³• List&lt;User&gt; list = ordersMapperCustom.findUserAndItemsResultMap(); System.out.println(list); sqlSession.close(); &#125; æµ‹è¯•ï¼š æˆ‘å»ï¼Œç«Ÿç„¶æŠ¥é”™äº†ï¼Œä½†æ˜¯ä¸è¦æ€•ï¼Œé€šè¿‡æŸ¥çœ‹æŠ¥é”™ä¿¡æ¯å¯ä»¥çŸ¥é“æˆ‘å¿˜è®°åœ¨ User.java ä¸­åŠ å…¥ orderlist å±æ€§äº†ï¼Œæ¥ä¸‹æ¥æˆ‘åŠ ä¸Šå»ï¼Œå¹¶åŠ ä¸Š getter å’Œ setter æ–¹æ³•ã€‚ 12345678//ç”¨æˆ·åˆ›å»ºçš„è®¢å•åˆ—è¡¨ private List&lt;Orders&gt; ordersList; public List&lt;Orders&gt; getOrdersList() &#123; return ordersList; &#125; public void setOrdersList(List&lt;Orders&gt; ordersList) &#123; this.ordersList = ordersList; &#125; å†æ¬¡æµ‹è¯•å°±èƒ½æˆåŠŸäº†ã€‚ å¤šå¯¹å¤šæŸ¥è¯¢æ€»ç»“å°†æŸ¥è¯¢ç”¨æˆ·è´­ä¹°çš„å•†å“ä¿¡æ¯æ˜ç»†æ¸…å•ï¼Œï¼ˆç”¨æˆ·åã€ç”¨æˆ·åœ°å€ã€è´­ä¹°å•†å“åç§°ã€è´­ä¹°å•†å“æ—¶é—´ã€è´­ä¹°å•†å“æ•°é‡ï¼‰ é’ˆå¯¹ä¸Šè¾¹çš„éœ€æ±‚å°±ä½¿ç”¨resultTypeå°†æŸ¥è¯¢åˆ°çš„è®°å½•æ˜ å°„åˆ°ä¸€ä¸ªæ‰©å±•çš„pojoä¸­ï¼Œå¾ˆç®€å•å®ç°æ˜ç»†æ¸…å•çš„åŠŸèƒ½ã€‚ ä¸€å¯¹å¤šæ˜¯å¤šå¯¹å¤šçš„ç‰¹ä¾‹ï¼Œå¦‚ä¸‹éœ€æ±‚ï¼š æŸ¥è¯¢ç”¨æˆ·è´­ä¹°çš„å•†å“ä¿¡æ¯ï¼Œç”¨æˆ·å’Œå•†å“çš„å…³ç³»æ˜¯å¤šå¯¹å¤šå…³ç³»ã€‚ éœ€æ±‚1ï¼š æŸ¥è¯¢å­—æ®µï¼šç”¨æˆ·è´¦å·ã€ç”¨æˆ·åç§°ã€ç”¨æˆ·æ€§åˆ«ã€å•†å“åç§°ã€å•†å“ä»·æ ¼(æœ€å¸¸è§) ä¼ä¸šå¼€å‘ä¸­å¸¸è§æ˜ç»†åˆ—è¡¨ï¼Œç”¨æˆ·è´­ä¹°å•†å“æ˜ç»†åˆ—è¡¨ï¼Œ ä½¿ç”¨resultTypeå°†ä¸Šè¾¹æŸ¥è¯¢åˆ—æ˜ å°„åˆ°pojoè¾“å‡ºã€‚ éœ€æ±‚2ï¼š æŸ¥è¯¢å­—æ®µï¼šç”¨æˆ·è´¦å·ã€ç”¨æˆ·åç§°ã€è´­ä¹°å•†å“æ•°é‡ã€å•†å“æ˜ç»†ï¼ˆé¼ æ ‡ç§»ä¸Šæ˜¾ç¤ºæ˜ç»†ï¼‰ ä½¿ç”¨resultMapå°†ç”¨æˆ·è´­ä¹°çš„å•†å“æ˜ç»†åˆ—è¡¨æ˜ å°„åˆ°userå¯¹è±¡ä¸­ã€‚ æ€»ç»“ï¼š ä½¿ç”¨resultMapæ˜¯é’ˆå¯¹é‚£äº›å¯¹æŸ¥è¯¢ç»“æœæ˜ å°„æœ‰ç‰¹æ®Šè¦æ±‚çš„åŠŸèƒ½ï¼Œï¼Œæ¯”å¦‚ç‰¹æ®Šè¦æ±‚æ˜ å°„æˆlistä¸­åŒ…æ‹¬å¤šä¸ªlistã€‚ ResultMap æ€»ç»“resultTypeï¼šä½œç”¨ï¼š å°†æŸ¥è¯¢ç»“æœæŒ‰ç…§sqlåˆ—åpojoå±æ€§åä¸€è‡´æ€§æ˜ å°„åˆ°pojoä¸­ã€‚ åœºåˆï¼š å¸¸è§ä¸€äº›æ˜ç»†è®°å½•çš„å±•ç¤ºï¼Œæ¯”å¦‚ç”¨æˆ·è´­ä¹°å•†å“æ˜ç»†ï¼Œå°†å…³è”æŸ¥è¯¢ä¿¡æ¯å…¨éƒ¨å±•ç¤ºåœ¨é¡µé¢æ—¶ï¼Œæ­¤æ—¶å¯ç›´æ¥ä½¿ç”¨resultTypeå°†æ¯ä¸€æ¡è®°å½•æ˜ å°„åˆ°pojoä¸­ï¼Œåœ¨å‰ç«¯é¡µé¢éå†listï¼ˆlistä¸­æ˜¯pojoï¼‰å³å¯ã€‚ resultMapï¼š ä½¿ç”¨associationå’Œcollectionå®Œæˆä¸€å¯¹ä¸€å’Œä¸€å¯¹å¤šé«˜çº§æ˜ å°„ï¼ˆå¯¹ç»“æœæœ‰ç‰¹æ®Šçš„æ˜ å°„è¦æ±‚ï¼‰ã€‚ associationï¼šä½œç”¨ï¼š å°†å…³è”æŸ¥è¯¢ä¿¡æ¯æ˜ å°„åˆ°ä¸€ä¸ªpojoå¯¹è±¡ä¸­ã€‚ åœºåˆï¼š ä¸ºäº†æ–¹ä¾¿æŸ¥è¯¢å…³è”ä¿¡æ¯å¯ä»¥ä½¿ç”¨associationå°†å…³è”è®¢å•ä¿¡æ¯æ˜ å°„ä¸ºç”¨æˆ·å¯¹è±¡çš„pojoå±æ€§ä¸­ï¼Œæ¯”å¦‚ï¼šæŸ¥è¯¢è®¢å•åŠå…³è”ç”¨æˆ·ä¿¡æ¯ã€‚ä½¿ç”¨resultTypeæ— æ³•å°†æŸ¥è¯¢ç»“æœæ˜ å°„åˆ°pojoå¯¹è±¡çš„pojoå±æ€§ä¸­ï¼Œæ ¹æ®å¯¹ç»“æœé›†æŸ¥è¯¢éå†çš„éœ€è¦é€‰æ‹©ä½¿ç”¨resultTypeè¿˜æ˜¯resultMapã€‚ collectionï¼šä½œç”¨ï¼š å°†å…³è”æŸ¥è¯¢ä¿¡æ¯æ˜ å°„åˆ°ä¸€ä¸ªlisté›†åˆä¸­ã€‚ åœºåˆï¼š ä¸ºäº†æ–¹ä¾¿æŸ¥è¯¢éå†å…³è”ä¿¡æ¯å¯ä»¥ä½¿ç”¨collectionå°†å…³è”ä¿¡æ¯æ˜ å°„åˆ°listé›†åˆä¸­ï¼Œæ¯”å¦‚ï¼šæŸ¥è¯¢ç”¨æˆ·æƒé™èŒƒå›´æ¨¡å—åŠæ¨¡å—ä¸‹çš„èœå•ï¼Œå¯ä½¿ç”¨collectionå°†æ¨¡å—æ˜ å°„åˆ°æ¨¡å—listä¸­ï¼Œå°†èœå•åˆ—è¡¨æ˜ å°„åˆ°æ¨¡å—å¯¹è±¡çš„èœå•listå±æ€§ä¸­ï¼Œè¿™æ ·çš„ä½œçš„ç›®çš„ä¹Ÿæ˜¯æ–¹ä¾¿å¯¹æŸ¥è¯¢ç»“æœé›†è¿›è¡Œéå†æŸ¥è¯¢ã€‚å¦‚æœä½¿ç”¨resultTypeæ— æ³•å°†æŸ¥è¯¢ç»“æœæ˜ å°„åˆ°listé›†åˆä¸­ã€‚","tags":[{"name":"Mybatis","slug":"Mybatis","permalink":"http://www.54tianzhisheng.cn/tags/Mybatis/"},{"name":"SpringMVC","slug":"SpringMVC","permalink":"http://www.54tianzhisheng.cn/tags/SpringMVC/"}]},{"title":"Hexo + yilia ä¸»é¢˜å®ç°æ–‡ç« ç›®å½•","date":"2017-06-12T16:00:00.000Z","path":"2017/06/13/Hexo-yilia-toc/","text":"å‰æä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹æ¯ç¯‡æ–‡ç« çš„ç›®å½•ç»“æ„ï¼Œå¯ä»¥å®šä½åˆ°æƒ³çœ‹çš„åœ°æ–¹ï¼Œç‰¹åœ°æ‰¾äº†ä¸‹å¦‚ä½•å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚ æ·»åŠ  CSS æ ·å¼æ‰“å¼€ themes\\yilia\\source ä¸‹çš„ main.234bc0.css æ–‡ä»¶ï¼Œç›´æ¥åœ¨åé¢æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š123456789/* æ–°æ·»åŠ çš„ */#container .show-toc-btn,#container .toc-article&#123;display:block&#125;.toc-article&#123;z-index:100;background:#fff;border:1px solid #ccc;max-width:250px;min-width:150px;max-height:500px;overflow-y:auto;-webkit-box-shadow:5px 5px 2px #ccc;box-shadow:5px 5px 2px #ccc;font-size:12px;padding:10px;position:fixed;right:35px;top:129px&#125;.toc-article .toc-close&#123;font-weight:700;font-size:20px;cursor:pointer;float:right;color:#ccc&#125;.toc-article .toc-close:hover&#123;color:#000&#125;.toc-article .toc&#123;font-size:12px;padding:0;line-height:20px&#125;.toc-article .toc .toc-number&#123;color:#333&#125;.toc-article .toc .toc-text:hover&#123;text-decoration:underline;color:#2a6496&#125;.toc-article li&#123;list-style-type:none&#125;.toc-article .toc-level-1&#123;margin:4px 0&#125;.toc-article .toc-child&#123;&#125;@-moz-keyframes cd-bounce-1&#123;0%&#123;opacity:0;-o-transform:scale(1);-webkit-transform:scale(1);-moz-transform:scale(1);-ms-transform:scale(1);transform:scale(1)&#125;60%&#123;opacity:1;-o-transform:scale(1.01);-webkit-transform:scale(1.01);-moz-transform:scale(1.01);-ms-transform:scale(1.01);transform:scale(1.01)&#125;100%&#123;-o-transform:scale(1);-webkit-transform:scale(1);-moz-transform:scale(1);-ms-transform:scale(1);transform:scale(1)&#125;&#125;@-webkit-keyframes cd-bounce-1&#123;0%&#123;opacity:0;-o-transform:scale(1);-webkit-transform:scale(1);-moz-transform:scale(1);-ms-transform:scale(1);transform:scale(1)&#125;60%&#123;opacity:1;-o-transform:scale(1.01);-webkit-transform:scale(1.01);-moz-transform:scale(1.01);-ms-transform:scale(1.01);transform:scale(1.01)&#125;100%&#123;-o-transform:scale(1);-webkit-transform:scale(1);-moz-transform:scale(1);-ms-transform:scale(1);transform:scale(1)&#125;&#125;@-o-keyframes cd-bounce-1&#123;0%&#123;opacity:0;-o-transform:scale(1);-webkit-transform:scale(1);-moz-transform:scale(1);-ms-transform:scale(1);transform:scale(1)&#125;60%&#123;opacity:1;-o-transform:scale(1.01);-webkit-transform:scale(1.01);-moz-transform:scale(1.01);-ms-transform:scale(1.01);transform:scale(1.01)&#125;100%&#123;-o-transform:scale(1);-webkit-transform:scale(1);-moz-transform:scale(1);-ms-transform:scale(1);transform:scale(1)&#125;&#125;@keyframes cd-bounce-1&#123;0%&#123;opacity:0;-o-transform:scale(1);-webkit-transform:scale(1);-moz-transform:scale(1);-ms-transform:scale(1);transform:scale(1)&#125;60%&#123;opacity:1;-o-transform:scale(1.01);-webkit-transform:scale(1.01);-moz-transform:scale(1.01);-ms-transform:scale(1.01);transform:scale(1.01)&#125;100%&#123;-o-transform:scale(1);-webkit-transform:scale(1);-moz-transform:scale(1);-ms-transform:scale(1);transform:scale(1)&#125;&#125;.show-toc-btn&#123;display:none;z-index:10;width:30px;min-height:14px;overflow:hidden;padding:4px 6px 8px 5px;border:1px solid #ddd;border-right:none;position:fixed;right:40px;text-align:center;background-color:#f9f9f9&#125;.show-toc-btn .btn-bg&#123;margin-top:2px;display:block;width:16px;height:14px;background:url(http://7xtawy.com1.z0.glb.clouddn.com/show.png) no-repeat;-webkit-background-size:100%;-moz-background-size:100%;background-size:100%&#125;.show-toc-btn .btn-text&#123;color:#999;font-size:12px&#125;.show-toc-btn:hover&#123;cursor:pointer&#125;.show-toc-btn:hover .btn-bg&#123;background-position:0 -16px&#125;.show-toc-btn:hover .btn-text&#123;font-size:12px;color:#ea8010&#125;.toc-article li ol, .toc-article li ul &#123; margin-left: 30px;&#125;.toc-article ol, .toc-article ul &#123; margin: 10px 0;&#125; ä¿®æ”¹ article.ejs æ–‡ä»¶æ‰“å¼€ themes\\yilia\\layout\\_partial æ–‡ä»¶å¤¹ä¸‹çš„ article.ejs æ–‡ä»¶, åœ¨ &lt;/header&gt; &lt;% } %&gt; ä¸‹é¢åŠ å…¥å¦‚ä¸‹å†…å®¹ï¼ˆæ³¨æ„ä½ç½®ï¼‰ 123456789101112131415161718192021222324252627&lt;!-- ç›®å½•å†…å®¹ --&gt;&lt;% if (!index &amp;&amp; post.toc)&#123; %&gt; &lt;p class=&quot;show-toc-btn&quot; id=&quot;show-toc-btn&quot; onclick=&quot;showToc();&quot; style=&quot;display:none&quot;&gt; &lt;span class=&quot;btn-bg&quot;&gt;&lt;/span&gt; &lt;span class=&quot;btn-text&quot;&gt;æ–‡ç« å¯¼èˆª&lt;/span&gt; &lt;/p&gt; &lt;div id=&quot;toc-article&quot; class=&quot;toc-article&quot;&gt; &lt;span id=&quot;toc-close&quot; class=&quot;toc-close&quot; title=&quot;éšè—å¯¼èˆª&quot; onclick=&quot;showBtn();&quot;&gt;Ã—&lt;/span&gt; &lt;strong class=&quot;toc-title&quot;&gt;æ–‡ç« ç›®å½•&lt;/strong&gt; &lt;%- toc(post.content) %&gt; &lt;/div&gt; &lt;script type=&quot;text/javascript&quot;&gt; function showToc()&#123; var toc_article = document.getElementById(&quot;toc-article&quot;); var show_toc_btn = document.getElementById(&quot;show-toc-btn&quot;); toc_article.setAttribute(&quot;style&quot;,&quot;display:block&quot;); show_toc_btn.setAttribute(&quot;style&quot;,&quot;display:none&quot;); &#125;; function showBtn()&#123; var toc_article = document.getElementById(&quot;toc-article&quot;); var show_toc_btn = document.getElementById(&quot;show-toc-btn&quot;); toc_article.setAttribute(&quot;style&quot;,&quot;display:none&quot;); show_toc_btn.setAttribute(&quot;style&quot;,&quot;display:block&quot;); &#125;; &lt;/script&gt; &lt;% &#125; %&gt;&lt;!-- ç›®å½•å†…å®¹ç»“æŸ --&gt; ç„¶åè‹¥æƒ³è¦æ–‡ç« æ˜¾ç¤ºç›®å½•ï¼Œåœ¨æ¯ç¯‡æ–‡ç« å¼€å¤´åŠ å…¥ï¼štoc: true å³å¯ã€‚ å‚è€ƒæ–‡ç« ï¼šHexo+yiliaä¸»é¢˜å®ç°æ–‡ç« ç›®å½•å’Œæ·»åŠ è§†é¢‘ æ–°å¢ç”±äºé—®é¢˜å¤ªå¤šäº†ï¼Œæ‰€ä»¥æ–°å†™äº†ç¯‡æ–‡ç« ï¼šGithub page + Hexo + yilia æ­å»ºåšå®¢å¯èƒ½ä¼šé‡åˆ°çš„æ‰€æœ‰ç–‘é—®","tags":[{"name":"hexo","slug":"hexo","permalink":"http://www.54tianzhisheng.cn/tags/hexo/"}]},{"title":"Javaè¿æ¥Oracleæ•°æ®åº“çš„ä¸‰ç§è¿æ¥æ–¹å¼","date":"2017-06-12T16:00:00.000Z","path":"2017/06/13/Javaè¿æ¥Oracleæ•°æ®åº“çš„ä¸‰ç§è¿æ¥æ–¹å¼/","text":"èƒŒæ™¯ï¼šè¿™ä¸¤å¤©åœ¨å­¦ä¹ Oracleæ•°æ®åº“ï¼Œè¿™é‡Œå°±æ€»ç»“ä¸‹è‡ªå·±ä¸Šè¯¾æ‰€å­¦çš„çŸ¥è¯†ï¼ŒåŒæ—¶è®°å½•ä¸‹æ¥ï¼Œæ–¹ä¾¿æ•´ç†å½“å¤©æ‰€å­¦ä¸‹çš„çŸ¥è¯†ï¼Œä¹ŸåŒæ—¶æ–¹ä¾¿æ—¥åè‡ªå·±æŸ¥è¯¢ã€‚ SQLè¯­å¥çš„è¯ï¼Œè¿™é‡Œæˆ‘å°±ä¸å¤šè®²äº†ï¼Œæ„Ÿè§‰å’Œå…¶ä»–çš„æ•°æ®åº“ï¼ˆMySQLã€SQL Serverï¼‰éƒ½æ˜¯ç±»ä¼¼ï¼ŒåŒºåˆ«ä¸å¤§ã€‚ ä»Šå¤©åœ¨è¿™é‡Œå°±å†™ä¸‹ Java è¿æ¥ Oracle æ•°æ®åº“çš„ä¸‰ç§è¿æ¥æ–¹å¼ã€‚ å·¥å…·ï¼š Oracle Database 10g Express Edition cmdå‘½ä»¤çª—å£ IDEA 2016.1.3 ojdbc6_g.jarï¼ˆæ•°æ®åº“é©±åŠ¨åŒ…ï¼‰ jdk 1.8 åˆ›å»ºæ•°æ®åº“è¡¨ï¼šé¦–å…ˆåœ¨æœ¬åœ°å†™å¥½åˆ›å»ºçš„æ•°æ®åº“è¡¨çš„åˆ›å»ºä»£ç åï¼Œç„¶åç²˜è´´åœ¨cmdå‘½ä»¤çª—å£ä¸‹ï¼Œå³å¯åˆ›å»ºæˆåŠŸã€‚ï¼ˆå‰ææ˜¯è¿›å…¥å®‰è£…å¥½äº†oracleï¼Œè¿›å…¥äº†ç”¨æˆ·ï¼Œç„¶ååœ¨å½“å‰ç”¨æˆ·ä¸‹åˆ›å»ºè¿™ä¸ªè¡¨ï¼‰ éƒ¨é—¨è¡¨ï¼štb1_dept ï¼ˆå«æœ‰id name cityä¸‰ä¸ªå±æ€§ï¼‰ 12345create table tb1_dept( id number(5) primary key, name varchar2(10) not null, city varchar2(10) not null); æ’å…¥æ•°æ®ï¼šç„¶ååŒæ ·å†™å¥½æ’å…¥æ•°æ®çš„sqlè¯­å¥ï¼Œè¿™é‡Œæˆ‘å°±å†™ä¸‰æ¡æ•°æ®ã€‚ 123insert into tb1_dept(id, name, city) values(1,&apos;java&apos;, &apos;å—æ˜Œ&apos;);insert into tb1_dept(id, name, city) values(2,&apos;c&apos;, &apos;ä¸Šæµ·&apos;);insert into tb1_dept(id, name, city) values(3,&apos;java&apos;, &apos;å—æ˜Œ&apos;); å¥½ï¼Œæ•°æ®åº“è¡¨å·²ç»åˆ›å»ºå¥½äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦å‡†å¤‡çš„æ˜¯æ•°æ®åº“é©±åŠ¨åŒ…ã€‚ è¿™é‡Œæˆ‘ç”¨çš„æ˜¯ ojdbc6_g.jar é©±åŠ¨åŒ…ã€‚ æ¥ä¸‹æ¥å…ˆäº†è§£ä¸€äº›åŸºç¡€çŸ¥è¯†ï¼š JDBCçš„å…­å¤§æ­¥éª¤ï¼šè¿™é‡Œæˆ‘ä»¬å°±æŒ‰ç…§jdbcçš„è¿™å…­å¤§æ­¥éª¤æ‰§è¡Œä¸‹å»ï¼š æ³¨å†Œé©±åŠ¨ è·å–è¿æ¥ è·å–æ‰§è¡Œsqlè¯­å¥å¯¹è±¡ æ‰§è¡Œsqlè¯­å¥ å¤„ç†ç»“æœé›† å…³é—­èµ„æº URLï¼šç»Ÿä¸€èµ„æºå®šä½å™¨ oracle URLï¼š jdbc:oracle:thin:@localhost:1521:XE jdbc:oracle:thin:@127.0.0.1:1521:XE MySQL URLï¼šjdbc:mysql://localhost:3306/æ•°æ®åº“åç§° thinï¼šå°å‹é©±åŠ¨ï¼Œé©±åŠ¨æ–¹å¼ @localhost æœ¬æœºipåœ°å€ 127.0.0.1 XEï¼šæ•°æ®åº“çš„åå­— ipconfigï¼šipåœ°å€æŸ¥è¯¢ URIï¼šç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦ URNï¼šç”¨ç‰¹å®šå‘½åç©ºé—´çš„åå­—æ ‡è¯†èµ„æº å¦‚æœä½ ä¸çŸ¥é“ URLã€ URIã€URNä¸‰è€…çš„åŒºåˆ«çš„è¯ï¼Œé‚£ä¹ˆä½ å¯ä»¥å‚è€ƒä¸‹é¢æˆ‘æ¨èçš„ä¸€ç¯‡æ–‡ç« ã€‚ ä½ çŸ¥é“URLã€URIå’ŒURNä¸‰è€…ä¹‹é—´çš„åŒºåˆ«å—ï¼Ÿ ä¸‰ç§è¿æ¥æ–¹å¼ä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586package cn.zhisheng.test.jdbc;import oracle.jdbc.driver.OracleDriver;import java.sql.*;import java.util.Properties;/** * Created by 10412 on 2016/12/27. * JDBCçš„å…­å¤§æ­¥éª¤ * JAVAè¿æ¥Oracleçš„ä¸‰ç§æ–¹å¼ */public class JdbcTest&#123; public static void main(String[] args) &#123; Connection connect = null; Statement statement = null; ResultSet resultSet = null; try &#123; //ç¬¬ä¸€æ­¥ï¼šæ³¨å†Œé©±åŠ¨ //ç¬¬ä¸€ç§æ–¹å¼ï¼šç±»åŠ è½½(å¸¸ç”¨) //Class.forName(\"oracle.jdbc.OracleDriver\"); //ç¬¬äºŒç§æ–¹å¼ï¼šåˆ©ç”¨Driverå¯¹è±¡ Driver driver = new OracleDriver(); DriverManager.deregisterDriver(driver); //ç¬¬ä¸‰ç§æ–¹å¼:åˆ©ç”¨ç³»ç»Ÿå‚æ•° éœ€åœ¨ideaä¸­é…ç½®program argumentsä¸ºä¸‹é¢çš„å‚æ•° //-Djdbc.drivers = oracle.jdbc.OracleDriver //ç¬¬äºŒæ­¥ï¼šè·å–è¿æ¥ //ç¬¬ä¸€ç§æ–¹å¼ï¼šåˆ©ç”¨DriverManagerï¼ˆå¸¸ç”¨ï¼‰ //connect = DriverManager.getConnection(\"jdbc:oracle:thin:@localhost:1521:XE\", \"ä½ çš„oracleæ•°æ®åº“ç”¨æˆ·å\", \"ç”¨æˆ·åå¯†ç \"); //ç¬¬äºŒç§æ–¹å¼ï¼šç›´æ¥ä½¿ç”¨Driver Properties pro = new Properties(); pro.put(\"user\", \"ä½ çš„oracleæ•°æ®åº“ç”¨æˆ·å\"); pro.put(\"password\", \"ç”¨æˆ·åå¯†ç \"); connect = driver.connect(\"jdbc:oracle:thin:@localhost:1521:XE\", pro); //æµ‹è¯•connectæ­£ç¡®ä¸å¦ System.out.println(connect); //ç¬¬ä¸‰æ­¥ï¼šè·å–æ‰§è¡Œsqlè¯­å¥å¯¹è±¡ //ç¬¬ä¸€ç§æ–¹å¼:statement //statement = connect.createStatement(); //ç¬¬äºŒç§æ–¹å¼ï¼šPreStatement PreparedStatement preState = connect.prepareStatement(\"select * from tb1_dept where id = ?\"); //ç¬¬å››æ­¥ï¼šæ‰§è¡Œsqlè¯­å¥ //ç¬¬ä¸€ç§æ–¹å¼ï¼š //resultSet = statement.executeQuery(\"select * from tb1_dept\"); //ç¬¬äºŒç§æ–¹å¼ï¼š preState.setInt(1, 2);//1æ˜¯æŒ‡sqlè¯­å¥ä¸­ç¬¬ä¸€ä¸ªï¼Ÿ, 2æ˜¯æŒ‡ç¬¬ä¸€ä¸ªï¼Ÿçš„valueså€¼ //resultSet = preState.executeQuery(); //æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ //æŸ¥è¯¢ä»»ä½•è¯­å¥ï¼Œå¦‚æœæœ‰ç»“æœé›†ï¼Œè¿”å›trueï¼Œæ²¡æœ‰çš„è¯è¿”å›false,æ³¨æ„å¦‚æœæ˜¯æ’å…¥ä¸€æ¡æ•°æ®çš„è¯ï¼Œè™½ç„¶æ˜¯æ²¡æœ‰ç»“æœé›†ï¼Œè¿”å›falseï¼Œä½†æ˜¯å´èƒ½æˆåŠŸçš„æ’å…¥ä¸€æ¡æ•°æ® boolean execute = preState.execute(); System.out.println(execute); //ç¬¬äº”æ­¥ï¼šå¤„ç†ç»“æœé›† while (resultSet.next()) &#123; int id = resultSet.getInt(\"id\"); String name = resultSet.getString(\"name\"); String city = resultSet.getString(\"city\"); System.out.println(id+\" \"+name+\" \"+city); //æ‰“å°è¾“å‡ºç»“æœé›† &#125; &#125; catch (Exception e) &#123; e.printStackTrace(); &#125;finally &#123; //ç¬¬å…­æ­¥ï¼šå…³é—­èµ„æº try &#123; if (resultSet!=null) resultSet.close(); if (statement!=null) statement.close(); if (connect!=null) connect.close(); &#125; catch (SQLException e) &#123; e.printStackTrace(); &#125; &#125; &#125;&#125; æ³¨è§£ï¼š1ã€ ç¬¬ä¸€æ­¥ï¼šæ³¨å†Œé©±åŠ¨ ä¸­çš„ç¬¬ä¸‰ç§æ–¹æ³• åˆ©ç”¨ç³»ç»Ÿå‚æ•° éœ€åœ¨ideaä¸­é…ç½®program argumentsä¸ºä¸‹é¢çš„å‚æ•° è¿™é‡Œæˆ‘è¯´ä¸€ä¸‹æ€ä¹ˆåœ¨IDEAä¸­çš„é…ç½®æ–¹å¼å§ è¿è¡Œæˆªå›¾ï¼š OK ! ä¸‹ç¯‡æ–‡ç« å°†å†™ JDBC çš„å°è£…ã€‚","tags":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"http://www.54tianzhisheng.cn/tags/æ•°æ®åº“/"},{"name":"Java","slug":"Java","permalink":"http://www.54tianzhisheng.cn/tags/Java/"},{"name":"Oracle","slug":"Oracle","permalink":"http://www.54tianzhisheng.cn/tags/Oracle/"}]},{"title":"MyBatisçš„foreachè¯­å¥è¯¦è§£","date":"2017-06-12T16:00:00.000Z","path":"2017/06/13/MyBatis-foreach/","text":"foreach çš„ä¸»è¦ç”¨åœ¨æ„å»ºinæ¡ä»¶ä¸­ï¼Œå®ƒå¯ä»¥åœ¨SQLè¯­å¥ä¸­è¿›è¡Œè¿­ä»£ä¸€ä¸ªé›†åˆã€‚ foreach å…ƒç´ çš„å±æ€§ä¸»è¦æœ‰ itemï¼Œindexï¼Œcollectionï¼Œopenï¼Œseparatorï¼Œcloseã€‚ item è¡¨ç¤ºé›†åˆä¸­æ¯ä¸€ä¸ªå…ƒç´ è¿›è¡Œè¿­ä»£æ—¶çš„åˆ«åï¼Œ index æŒ‡ å®šä¸€ä¸ªåå­—ï¼Œç”¨äºè¡¨ç¤ºåœ¨è¿­ä»£è¿‡ç¨‹ä¸­ï¼Œæ¯æ¬¡è¿­ä»£åˆ°çš„ä½ç½®ï¼Œ open è¡¨ç¤ºè¯¥è¯­å¥ä»¥ä»€ä¹ˆå¼€å§‹ï¼Œ separator è¡¨ç¤ºåœ¨æ¯æ¬¡è¿›è¡Œè¿­ä»£ä¹‹é—´ä»¥ä»€ä¹ˆç¬¦å·ä½œä¸ºåˆ†éš” ç¬¦ï¼Œ close è¡¨ç¤ºä»¥ä»€ä¹ˆç»“æŸã€‚ åœ¨ä½¿ç”¨ foreach çš„æ—¶å€™æœ€å…³é”®çš„ä¹Ÿæ˜¯æœ€å®¹æ˜“å‡ºé”™çš„å°±æ˜¯ collection å±æ€§ï¼Œè¯¥å±æ€§æ˜¯å¿…é¡»æŒ‡å®šçš„ï¼Œä½†æ˜¯åœ¨ä¸åŒæƒ…å†µ ä¸‹ï¼Œè¯¥å±æ€§çš„å€¼æ˜¯ä¸ä¸€æ ·çš„ï¼Œä¸»è¦æœ‰ä¸€ä¸‹3ç§æƒ…å†µï¼š å¦‚æœä¼ å…¥çš„æ˜¯å•å‚æ•°ä¸”å‚æ•°ç±»å‹æ˜¯ä¸€ä¸ªListçš„æ—¶å€™ï¼Œcollection å±æ€§å€¼ä¸º list å¦‚æœä¼ å…¥çš„æ˜¯å•å‚æ•°ä¸”å‚æ•°ç±»å‹æ˜¯ä¸€ä¸ª array æ•°ç»„çš„æ—¶å€™ï¼Œcollection çš„å±æ€§å€¼ä¸º array å¦‚æœä¼ å…¥çš„å‚æ•°æ˜¯å¤šä¸ªçš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦æŠŠå®ƒä»¬å°è£…æˆä¸€ä¸ª Map äº†ï¼Œå½“ç„¶å•å‚æ•°ä¹Ÿå¯ä»¥å°è£…æˆmapï¼Œå®é™…ä¸Šå¦‚æœä½ åœ¨ä¼ å…¥å‚æ•°çš„æ—¶å€™ï¼Œåœ¨ breast é‡Œé¢ä¹Ÿæ˜¯ä¼šæŠŠå®ƒå°è£…æˆä¸€ä¸ª Map çš„ï¼Œmap çš„ key å°±æ˜¯å‚æ•°åï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™ collection å±æ€§å€¼å°±æ˜¯ä¼ å…¥çš„ List æˆ– array å¯¹è±¡åœ¨è‡ªå·±å°è£…çš„ map é‡Œé¢çš„ key ã€‚ ä¸‹é¢åˆ†åˆ«æ¥çœ‹çœ‹ä¸Šè¿°ä¸‰ç§æƒ…å†µçš„ç¤ºä¾‹ä»£ç ï¼š 1.å•å‚æ•° List çš„ç±»å‹ï¼š 123456&lt;select id=\"dynamicForeachTest\" resultType=\"Blog\"&gt; select * from t_blog where id in &lt;foreach collection=\"list\" index=\"index\" item=\"item\" open=\"(\" separator=\",\" close=\")\"&gt; #&#123;item&#125; &lt;/foreach&gt;&lt;/select&gt; ä¸Šè¿° collection çš„å€¼ä¸ºlistï¼Œå¯¹åº”çš„ Mapper æ˜¯è¿™æ ·çš„ 1public List&lt;Blog&gt; dynamicForeachTest(List&lt;Integer&gt; ids); æµ‹è¯•ä»£ç ï¼š 12345678910111213@Test public void dynamicForeachTest() &#123; SqlSession session = Util.getSqlSessionFactory().openSession(); BlogMapper blogMapper = session.getMapper(BlogMapper.class); List&lt;Integer&gt; ids = new ArrayList&lt;Integer&gt;(); ids.add(1); ids.add(3); ids.add(6); List&lt;Blog&gt; blogs = blogMapper.dynamicForeachTest(ids); for (Blog blog : blogs) System.out.println(blog); session.close(); &#125; 2.å•å‚æ•°arrayæ•°ç»„çš„ç±»å‹ï¼š 123456&lt;select id=\"dynamicForeach2Test\" resultType=\"Blog\"&gt; select * from t_blog where id in &lt;foreach collection=\"array\" index=\"index\" item=\"item\" open=\"(\" separator=\",\" close=\")\"&gt; #&#123;item&#125; &lt;/foreach&gt;&lt;/select&gt; ä¸Šè¿°collectionä¸ºarrayï¼Œå¯¹åº”çš„Mapperä»£ç ï¼š 1public List&lt;Blog&gt; dynamicForeach2Test(int[] ids); å¯¹åº”çš„æµ‹è¯•ä»£ç ï¼š 12345678910@Test public void dynamicForeach2Test() &#123; SqlSession session = Util.getSqlSessionFactory().openSession(); BlogMapper blogMapper = session.getMapper(BlogMapper.class); int[] ids = new int[] &#123;1,3,6,9&#125;; List&lt;Blog&gt; blogs = blogMapper.dynamicForeach2Test(ids); for (Blog blog : blogs) System.out.println(blog); session.close(); &#125; 3.è‡ªå·±æŠŠå‚æ•°å°è£…æˆMapçš„ç±»å‹ 123456&lt;select id=\"dynamicForeach3Test\" resultType=\"Blog\"&gt; select * from t_blog where title like \"%\"#&#123;title&#125;\"%\" and id in &lt;foreach collection=\"ids\" index=\"index\" item=\"item\" open=\"(\" separator=\",\" close=\")\"&gt; #&#123;item&#125; &lt;/foreach&gt;&lt;/select&gt; ä¸Šè¿°collectionçš„å€¼ä¸ºidsï¼Œæ˜¯ä¼ å…¥çš„å‚æ•°Mapçš„keyï¼Œå¯¹åº”çš„Mapperä»£ç ï¼š 1public List&lt;Blog&gt; dynamicForeach3Test(Map&lt;String, Object&gt; params); å¯¹åº”æµ‹è¯•ä»£ç ï¼š 12345678910111213141516171819@Test public void dynamicForeach3Test() &#123; SqlSession session = Util.getSqlSessionFactory().openSession(); BlogMapper blogMapper = session.getMapper(BlogMapper.class); final List&lt;Integer&gt; ids = new ArrayList&lt;Integer&gt;(); ids.add(1); ids.add(2); ids.add(3); ids.add(6); ids.add(7); ids.add(9); Map&lt;String, Object&gt; params = new HashMap&lt;String, Object&gt;(); params.put(\"ids\", ids); params.put(\"title\", \"ä¸­å›½\"); List&lt;Blog&gt; blogs = blogMapper.dynamicForeach3Test(params); for (Blog blog : blogs) System.out.println(blog); session.close(); &#125;","tags":[{"name":"Mybatis","slug":"Mybatis","permalink":"http://www.54tianzhisheng.cn/tags/Mybatis/"},{"name":"foreach","slug":"foreach","permalink":"http://www.54tianzhisheng.cn/tags/foreach/"}]},{"title":"Spring MVCç³»åˆ—æ–‡ç« ï¼ˆä¸€ï¼‰ï¼šSpring MVC + Hibernate JPA + Bootstrap æ­å»ºçš„åšå®¢ç³»ç»Ÿ Demo","date":"2017-06-12T16:00:00.000Z","path":"2017/06/13/Spring MVC + Hibernate JPA + Bootstrap æ­å»ºçš„åšå®¢ç³»ç»Ÿ/","text":"SpringBoot ç³»åˆ—æ–‡ç«  ç›¸å…³é˜…è¯»ï¼š1ã€Spring MVC+Hibernate JPA+ Bootstrap æ­å»ºçš„åšå®¢ç³»ç»Ÿé¡¹ç›®ä¸­æ‰€é‡åˆ°çš„å‘ ç”±äºæ•´ä¸ªç³»ç»Ÿä¸æ˜¯å¾ˆéš¾ï¼Œè¿™é‡Œå°±ä¸è¯¦ç»†ä»‹ç»äº†ï¼Œæˆ‘ç›¸ä¿¡çœ‹æºç çš„è¯ï¼Œåº”è¯¥èƒ½å¤Ÿçœ‹å¾—æ‡‚ã€‚ æºç åœ°å€ï¼šhttps://github.com/zhisheng17/springmvcæ•°æ®åº“ï¼šspringdemo.sql ä¸‹é¢ç»™å‡ºä¸‹æ•´ä¸ªç³»ç»Ÿçš„æˆªå›¾å§ï¼Œè§‰å¾—ä¸é”™ï¼Œå¯ä»¥ç»™ä¸ª star ï¼Œå“ˆå“ˆï¼åç»­ç»§ç»­åœ¨è¿™ä¸ªé¡¹ç›®ä¸­åŠ å…¥æ–°çš„é¡¹ç›®ã€‚ æˆªå›¾ï¼šé¦–é¡µ ç”¨æˆ·ç®¡ç†æ¨¡å— ç”¨æˆ·åˆ—è¡¨ æ·»åŠ ç”¨æˆ· ç”¨æˆ·ä¿¡æ¯è¯¦æƒ… æ›´æ–°ç”¨æˆ·ä¿¡æ¯ åˆ é™¤ç”¨æˆ· åšå®¢ç®¡ç†æ¨¡å— åšå®¢åˆ—è¡¨ åšå®¢è¯¦æƒ… æ·»åŠ åšå®¢ æ›´æ–°åšå®¢ åˆ é™¤åšå®¢","tags":[{"name":"Java","slug":"Java","permalink":"http://www.54tianzhisheng.cn/tags/Java/"},{"name":"Spring","slug":"Spring","permalink":"http://www.54tianzhisheng.cn/tags/Spring/"},{"name":"Spring MVC","slug":"Spring-MVC","permalink":"http://www.54tianzhisheng.cn/tags/Spring-MVC/"},{"name":"Hibernate JPA","slug":"Hibernate-JPA","permalink":"http://www.54tianzhisheng.cn/tags/Hibernate-JPA/"},{"name":"Bootstrap","slug":"Bootstrap","permalink":"http://www.54tianzhisheng.cn/tags/Bootstrap/"},{"name":"MySQL","slug":"MySQL","permalink":"http://www.54tianzhisheng.cn/tags/MySQL/"}]},{"title":"å…³äºString s = new String(\"xyz\"); åˆ›å»ºå‡ ä¸ªå¯¹è±¡çš„é—®é¢˜","date":"2017-06-12T16:00:00.000Z","path":"2017/06/13/String-new/","text":"ä½ çŸ¥é“åœ¨ java ä¸­é™¤äº† 8 ç§åŸºæœ¬ç±»å‹å¤–ï¼Œå…¶ä»–çš„éƒ½æ˜¯ç±»å¯¹è±¡ä»¥åŠå…¶å¼•ç”¨ã€‚æ‰€ä»¥ &quot;xyz &quot;åœ¨ java ä¸­å®ƒæ˜¯ä¸€ä¸ªString å¯¹è±¡.å¯¹äº string ç±»å¯¹è±¡æ¥è¯´ä»–çš„å¯¹è±¡å€¼æ˜¯ä¸èƒ½ä¿®æ”¹çš„ï¼Œä¹Ÿå°±æ˜¯å…·æœ‰ä¸å˜æ€§ã€‚ çœ‹ï¼š1234String s= &quot;hello &quot;; s= &quot;Java &quot;; String s1= &quot;hello &quot;; String s2=new String( &quot;hello &quot;); ç»“æœå¦‚ä¸‹å›¾ï¼š å•Šï¼Œs æ‰€å¼•ç”¨çš„ string å¯¹è±¡ä¸æ˜¯è¢«ä¿®æ”¹äº†å—ï¼Ÿä¹‹å‰æ‰€è¯´çš„ä¸å˜æ€§ï¼Œå»é‚£é‡Œäº†å•Šï¼Ÿä½ åˆ«ç€æ€¥ï¼Œè®©æˆ‘å‘Šè¯‰ä½ è¯´å‘ç”Ÿäº†ä»€ä¹ˆäº‹æƒ…ï¼šåœ¨ jvm çš„å·¥ä½œè¿‡ç¨‹ä¸­ï¼Œä¼šåˆ›å»ºä¸€ç‰‡çš„å†…å­˜ç©ºé—´ä¸“é—¨å­˜å…¥ string å¯¹è±¡ã€‚æˆ‘ä»¬æŠŠè¿™ç‰‡å†…å­˜ç©ºé—´å«åš string æ± ã€‚ String s = â€œhello â€œ; å½“ jvm çœ‹åˆ° â€œhelloâ€ï¼Œåœ¨ string æ± åˆ›å»º string å¯¹è±¡å­˜å‚¨å®ƒï¼Œå¹¶å°†ä»–çš„å¼•ç”¨è¿”å›ç»™sã€‚s = â€œjava â€œï¼Œå½“ jvm çœ‹åˆ° â€œjava â€œï¼Œåœ¨ string æ± åˆ›å»ºæ–°çš„ string å¯¹è±¡å­˜å‚¨å®ƒï¼Œå†æŠŠæ–°å»ºçš„ string å¯¹è±¡çš„å¼•ç”¨è¿”å›ç»™sã€‚è€ŒåŸå…ˆçš„ â€œhelloâ€ä»ç„¶åœ¨ string æ± å†…ã€‚æ²¡æœ‰æ¶ˆå¤±ï¼Œä»–æ˜¯ä¸èƒ½è¢«ä¿®æ”¹çš„ã€‚ æ‰€ä»¥æˆ‘ä»¬ä»…ä»…æ˜¯æ”¹å˜äº†sçš„å¼•ç”¨ï¼Œè€Œæ²¡æœ‰æ”¹å˜ä»–æ‰€å¼•ç”¨çš„å¯¹è±¡ï¼Œå› ä¸º string å¯¹è±¡çš„å€¼æ˜¯ä¸èƒ½è¢«ä¿®æ”¹çš„ã€‚ String s1 = â€œhelloâ€ ; jvm é¦–å…ˆåœ¨ string æ± å†…é‡Œé¢çœ‹æ‰¾ä¸æ‰¾å¾—åˆ°å­—ç¬¦ä¸² â€œhelloâ€, å¦‚æœæ‰¾å¾—åˆ°,è¿”å›ä»–çš„å¼•ç”¨ç»™ s1ï¼Œå¦åˆ™çš„è¯å°±ä¼šåˆ›å»ºæ–°çš„ string å¯¹è±¡ï¼Œæ”¾åˆ° string æ± é‡Œã€‚è¿™é‡Œç”±äº s = â€œhelloâ€äº†,å¯¹è±¡å·²ç»è¢«å¼•ç”¨ï¼Œæ‰€ä»¥ä¾æ®è§„åˆ™ s å’Œ s1 éƒ½æ˜¯å¼•ç”¨åŒä¸€ä¸ªå¯¹è±¡ã€‚æ‰€ä»¥ s == s1 å°†è¿”å› trueã€‚( == å¯¹äºéåŸºæœ¬ç±»å‹ï¼Œæ˜¯æ¯”è¾ƒä¸¤å¼•ç”¨æ˜¯å¦å¼•ç”¨å†…å­˜ä¸­çš„åŒä¸€ä¸ªå¯¹è±¡ï¼Œè¿™é‡Œå…ˆä¸åŒºåˆ† == å’Œ equals çš„åŒºåˆ« ) String s2 = new String( â€œhelloâ€); jvm é¦–å…ˆåœ¨ string æ± å†…é‡Œé¢çœ‹æ‰¾ä¸æ‰¾å¾—åˆ°å­—ç¬¦ä¸² â€œhelloâ€, å¦‚æœæ‰¾å¾—åˆ°, ä¸åšä»»ä½•äº‹æƒ…ï¼Œå¦åˆ™çš„è¯å°±ä¼šåˆ›å»ºæ–°çš„ string å¯¹è±¡ï¼Œæ”¾åˆ° string æ± é‡Œé¢ã€‚ç”±äºé‡åˆ°äº† newï¼Œè¿˜ä¼šåœ¨å†…å­˜ä¸Šï¼ˆä¸æ˜¯ string æ± é‡Œé¢ï¼‰åˆ›å»º string å¯¹è±¡å­˜å‚¨ â€œhelloâ€ï¼Œå¹¶å°†å†…å­˜ä¸Šçš„ï¼ˆä¸æ˜¯ string æ± å†…çš„ï¼‰string å¯¹è±¡è¿”å›ç»™ s2ã€‚æ‰€ä»¥ s == s2 å°†è¿”å› falseï¼Œä¸æ˜¯å¼•ç”¨åŒä¸€ä¸ªå¯¹è±¡ã€‚ å¥½ç°åœ¨æˆ‘ä»¬çœ‹é¢˜ç›®ï¼šString s = new String( â€œxyz â€œ);é¦–å…ˆåœ¨ string æ± å†…æ‰¾ï¼Œæ‰¾åˆ°ï¼Ÿä¸åˆ›å»º string å¯¹è±¡ï¼Œå¦åˆ™åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œé‡åˆ° new è¿ç®—ç¬¦å·äº†ï¼Œåœ¨å†…å­˜ä¸Šåˆ›å»º string å¯¹è±¡ï¼Œå¹¶å°†å…¶è¿”å›ç»™ sï¼Œåˆä¸€ä¸ªå¯¹è±¡ æ‰€ä»¥æ€»å…±æ˜¯ 1ä¸ª æˆ–è€… 2ä¸ªå¯¹è±¡ ã€‚ è€Œä¸ºä»€ä¹ˆåœ¨ç½‘ä¸Šéƒ½è¯´ String s=new String(â€œhelloâ€); åˆ›å»ºäº†2ä¸ªå¯¹è±¡ï¼Ÿé‚£å¯èƒ½å› ä¸ºå®ƒå°±å†™è¿™ä¹ˆä¸€å¥ä»£ç ï¼Œè¯¯è®©äººé»˜è®¤çš„è®¤ä¸ºæ‰§è¡Œä»£ç ä¹‹å‰å¹¶ä¸å®ä¾‹ä»»ä½•ä¸€ä¸ª String å¯¹è±¡è¿‡ï¼ˆä¹Ÿè®¸ å¾ˆå¤šäººä¸ä¼šè¿™ä¹ˆæƒ³ï¼Œï¼‰ï¼Œè·Ÿç€åˆ«äººæˆ–è€…ä¸ç»æ€è€ƒçš„å°±è¯´2ä¸ªï¼Œæ–Ÿæ˜¯è¯´å­˜æ”¾åœ¨æ ˆå†…å­˜ä¸­ä¸“é—¨å­˜æ”¾ String å¯¹è±¡å¼•ç”¨çš„ s å˜é‡æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼","tags":[{"name":"Java","slug":"Java","permalink":"http://www.54tianzhisheng.cn/tags/Java/"},{"name":"String","slug":"String","permalink":"http://www.54tianzhisheng.cn/tags/String/"}]},{"title":"ã€å­—ç¬¦ä¸²ã€‘åˆ¤æ–­ä¸¤å­—ç¬¦ä¸²æ˜¯å¦äº’ä¸ºæ—‹è½¬è¯ï¼Ÿ","date":"2017-06-12T16:00:00.000Z","path":"2017/06/13/ã€å­—ç¬¦ä¸²ã€‘åˆ¤æ–­ä¸¤å­—ç¬¦ä¸²æ˜¯å¦äº’ä¸ºæ—‹è½¬è¯ï¼Ÿ/","text":"ç›¸å…³é˜…è¯»ï¼šå­—ç¬¦ä¸²é€†åºé—®é¢˜çš„è§£å†³æ–¹æ³•é¢˜ç›®ï¼š å¦‚æœå¯¹äºä¸€ä¸ªå­—ç¬¦ä¸²Aï¼Œå°†Açš„å‰é¢ä»»æ„ä¸€éƒ¨åˆ†æŒªåˆ°åè¾¹å»å½¢æˆçš„å­—ç¬¦ä¸²ç§°ä¸ºAçš„æ—‹è½¬è¯ã€‚ æ¯”å¦‚A=â€12345â€,Açš„æ—‹è½¬è¯æœ‰â€12345â€,â€23451â€,â€34512â€,â€45123â€å’Œâ€51234â€ã€‚ å¯¹äºä¸¤ä¸ªå­—ç¬¦ä¸²Aå’ŒBï¼Œè¯·åˆ¤æ–­Aå’ŒBæ˜¯å¦äº’ä¸ºæ—‹è½¬è¯ã€‚ ç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸²Aå’ŒBåŠä»–ä»¬çš„é•¿åº¦lenaï¼Œlenbï¼Œè¯·è¿”å›ä¸€ä¸ªboolå€¼ï¼Œä»£è¡¨ä»–ä»¬æ˜¯å¦äº’ä¸ºæ—‹è½¬è¯ã€‚ æµ‹è¯•æ ·ä¾‹ï¼š â€œcdabâ€,4,â€abcdâ€,4 è¿”å›ï¼štrue é€šè¿‡ä»£ç ï¼š 1234567891011121314import java.util.*;public class Rotation&#123; public static boolean chkRotation(String A, int lena, String B, int lenb) &#123; // write code here if (lena != lenb)&#123; return false; &#125;else &#123; String str = A + A; return str.contains(B); &#125; &#125;&#125; ä¹Ÿå¯ä»¥ä½¿ç”¨ indexOfã€‚ å…¶åŒºåˆ«æ˜¯ï¼š contains æ˜¯æ‰¾æŒ‡å®šå­—ç¬¦ä¸²æ˜¯å¦åŒ…å«ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¿”å›å€¼çš„ boolean ç±»å‹ï¼Œå³åªæœ‰ true å’Œ false indexOf æœ‰å¤šä¸ªé‡è½½ï¼Œä½†æ— è®ºå“ªä¸ªï¼Œéƒ½æ˜¯åšä¸€å®šçš„åŒ¹é…ï¼Œç„¶åæŠŠåŒ¹é…çš„ç¬¬ä¸€ä¸ªå­—ç¬¦çš„ä½ç½®è¿”å›ï¼Œè¿”å›çš„æ˜¯ int ç±»å‹ï¼Œå¦‚æœæ²¡æ‰¾åˆ°ï¼Œé‚£ä¹ˆè¿”å› -1 ç¨å¾®å†æ·±ç©¶ä¸€ä¸‹çš„æˆ‘çœ‹äº†ä¸‹ contains çš„æºç ï¼Œç»“æœå‘ç°ä»–è°ƒç”¨çš„æ˜¯ indexOf æ–¹æ³•ã€‚ æºç å¦‚ä¸‹ï¼š 1234567891011/** * Returns true if and only if this string contains the specified * sequence of char values. * * @param s the sequence to search for * @return true if this string contains &#123;@code s&#125;, false otherwise * @since 1.5 */ public boolean contains(CharSequence s) &#123; return indexOf(s.toString()) &gt; -1; &#125; æ„æ€å°±æ˜¯å¦‚ä¸Šé¢çš„åŒºåˆ«æ‰€è¯´çš„ï¼Œä»–åªæœ‰ä¸¤ä¸ªè¿”å›å€¼ true å’Œ falseã€‚ äºæ˜¯æˆ‘ä»¬ç»§ç»­çœ‹ä¸€ä¸‹ indexOf æ–¹æ³•çš„æºç ï¼š 1234567891011121314151617/** * Returns the index within this string of the first occurrence of the * specified substring. * * &lt;p&gt;The returned index is the smallest value &lt;i&gt;k&lt;/i&gt; for which: * &lt;blockquote&gt;&lt;pre&gt; * this.startsWith(str, &lt;i&gt;k&lt;/i&gt;) * &lt;/pre&gt;&lt;/blockquote&gt; * If no such value of &lt;i&gt;k&lt;/i&gt; exists, then &#123;@code -1&#125; is returned. * * @param str the substring to search for. * @return the index of the first occurrence of the specified substring, * or &#123;@code -1&#125; if there is no such occurrence. public int indexOf(String str) &#123; return indexOf(str, 0); &#125; ç»§ç»­å¯ä»¥å‘ç°ä»–åˆè°ƒç”¨äº† indexOf çš„ä¸¤ä¸ªå‚æ•°æ–¹æ³•ï¼Œåªä¸è¿‡ç´¢å¼•æ˜¯ 0 ã€‚ ç„¶åæˆ‘ç»§ç»­çœ‹å¸¦æœ‰ä¸¤ä¸ªå‚æ•°çš„ indexOf æ–¹æ³•æºç å¦‚ä¸‹ï¼š 123456789101112131415161718192021/** * Returns the index within this string of the first occurrence of the * specified substring, starting at the specified index. * * &lt;p&gt;The returned index is the smallest value &lt;i&gt;k&lt;/i&gt; for which: * &lt;blockquote&gt;&lt;pre&gt; * &lt;i&gt;k&lt;/i&gt; &amp;gt;= fromIndex &#123;@code &amp;&amp;&#125; this.startsWith(str, &lt;i&gt;k&lt;/i&gt;) * &lt;/pre&gt;&lt;/blockquote&gt; * If no such value of &lt;i&gt;k&lt;/i&gt; exists, then &#123;@code -1&#125; is returned. * * @param str the substring to search for. * @param fromIndex the index from which to start the search. * @return the index of the first occurrence of the specified substring, * starting at the specified index, * or &#123;@code -1&#125; if there is no such occurrence. */ public int indexOf(String str, int fromIndex) &#123; return indexOf(value, 0, value.length, str.value, 0, str.value.length, fromIndex); &#125; å“ˆå“ˆï¼Œå‘ç°ä»–åˆè°ƒç”¨äº† indexOf çš„æ–¹æ³•ï¼Œè¿™æ¬¡ç»ˆäºæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ€åçš„ æŸ¥æ‰¾ç®—æ³• å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950/** * Code shared by String and StringBuffer to do searches. The * source is the character array being searched, and the target * is the string being searched for. * * @param source the characters being searched. * @param sourceOffset offset of the source string. * @param sourceCount count of the source string. * @param target the characters being searched for. * @param targetOffset offset of the target string. * @param targetCount count of the target string. * @param fromIndex the index to begin searching from. */static int indexOf(char[] source, int sourceOffset, int sourceCount, char[] target, int targetOffset, int targetCount, int fromIndex) &#123; if (fromIndex &gt;= sourceCount) &#123; return (targetCount == 0 ? sourceCount : -1); &#125; if (fromIndex &lt; 0) &#123; fromIndex = 0; &#125; if (targetCount == 0) &#123; return fromIndex; &#125; char first = target[targetOffset]; int max = sourceOffset + (sourceCount - targetCount); for (int i = sourceOffset + fromIndex; i &lt;= max; i++) &#123; /* Look for first character. */ if (source[i] != first) &#123; while (++i &lt;= max &amp;&amp; source[i] != first); &#125; /* Found first character, now look at the rest of v2 */ if (i &lt;= max) &#123; int j = i + 1; int end = j + targetCount - 1; for (int k = targetOffset + 1; j &lt; end &amp;&amp; source[j] == target[k]; j++, k++); if (j == end) &#123; /* Found whole string. */ return i - sourceOffset; &#125; &#125; &#125; return -1;&#125; æ€»ç»“ï¼šé‡åˆ°è¿™ç§é—®é¢˜å¤šæŸ¥çœ‹æºç ï¼Œæƒ³æ·±å…¥å°±å¾—ä»åº•å±‚åšèµ·ï¼","tags":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"http://www.54tianzhisheng.cn/tags/æ•°æ®ç»“æ„/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"http://www.54tianzhisheng.cn/tags/ç®—æ³•/"},{"name":"å­—ç¬¦ä¸²","slug":"å­—ç¬¦ä¸²","permalink":"http://www.54tianzhisheng.cn/tags/å­—ç¬¦ä¸²/"},{"name":"æ—‹è½¬è¯","slug":"æ—‹è½¬è¯","permalink":"http://www.54tianzhisheng.cn/tags/æ—‹è½¬è¯/"}]},{"title":"å­—ç¬¦ä¸²","date":"2017-06-12T16:00:00.000Z","path":"2017/06/13/ã€å­—ç¬¦ä¸²ã€‘å­—ç¬¦ä¸²é€†åº/","text":"é¢˜ç›®ä¸€ï¼šå¦‚æœä¸€ä¸ªå­—ç¬¦ä¸² str ï¼ŒæŠŠå­—ç¬¦ä¸² str å‰é¢çš„ä»»æ„éƒ¨åˆ†æŒªåˆ°åé¢å»å½¢æˆçš„å­—ç¬¦ä¸²å«åš str çš„æ—‹è½¬è¯ã€‚æ¯”å¦‚ str = â€œ 1234 â€ ï¼Œ é‚£ä¹ˆ str çš„æ—‹è½¬è¯æœ‰ â€œ 1234 â€ ï¼Œ â€œ 2341 â€ ï¼Œ â€œ 3412 â€ ï¼Œ â€œ 4123 â€ ã€‚ç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸² a å’Œ b ï¼Œè¯·åˆ¤æ–­ a å’Œ b æ˜¯å¦äº’ä¸ºæ—‹è½¬è¯ï¼Ÿä¸¾ä¾‹ï¼š a = â€œ cdab â€œ , b = â€œ abcd â€œ ã€‚è¿”å› trueã€‚ a = â€œ 1ab2 â€œ , b = â€œ ab12 â€œ ã€‚è¿”å› falseã€‚ a = â€œ 2ab1 â€œ , b= â€œ ab12 â€œ ã€‚ è¿”å› trueã€‚ æ€è·¯ï¼šæœ€ä¼˜è§£æ—¶é—´å¤æ‚åº¦ä¸º O(N) å…ˆåˆ¤æ–­å­—ç¬¦ä¸² a å’Œ b æ˜¯å¦é•¿åº¦ç›¸ç­‰ã€‚ å¦‚æœé•¿åº¦ç›¸ç­‰ï¼Œç”Ÿæˆ a + a çš„å¤§å­—ç¬¦ä¸²ã€‚ ç„¶ååˆ¤æ–­å¤§å­—ç¬¦ä¸²ä¸­æ˜¯å¦åŒ…å« b å­—ç¬¦ä¸²ã€‚ï¼ˆä½¿ç”¨ kmp ç®—æ³•åˆ¤æ–­ï¼‰å¦‚æœå¤§å­—ç¬¦ä¸²ä¸­åŒ…å«å­—ç¬¦ä¸² b ï¼Œé‚£ä¹ˆå­—ç¬¦ä¸² a å’Œ b å°±äº’ä¸ºæ—‹è½¬è¯ã€‚ ä¸¾ä¾‹ï¼š a = â€œ 1234 â€œ a + a = â€œ 12341234 â€œ å¾ˆæ˜æ˜¾å‘ç°ï¼Œå¦‚æœå­—ç¬¦ä¸² a çš„é•¿åº¦ä¸º Nï¼Œåœ¨ a + a çš„å¤§å­—ç¬¦ä¸²ä¸­ï¼Œä»»æ„ä¸€ä¸ªé•¿åº¦ä¸º N çš„å­ä¸²éƒ½æ˜¯ a çš„æ—‹è½¬è¯ã€‚ é¢˜ç›®äºŒï¼šç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² aï¼Œ è¯·åœ¨å•è¯é—´åšé€†åºè°ƒæ•´ã€‚ ä¸¾ä¾‹ï¼š â€œ pig loves dog â€œ é€†åºæˆ â€œ dog loves pig â€œ ã€‚ â€œ Iâ€™m a student. â€œ é€†åºæˆ â€œ student. a Iâ€™m â€œ æ€è·¯ï¼š å®ç°å°†å­—ç¬¦ä¸²å±€éƒ¨æ‰€æœ‰å­—ç¬¦é€†åºçš„å‡½æ•° f åˆ©ç”¨ f å°†å­—ç¬¦ä¸²æ‰€æœ‰å­—ç¬¦é€†åº æ‰¾åˆ°é€†åºåçš„å­—ç¬¦ä¸²ä¸­æ¯ä¸€ä¸ªå•è¯çš„åŒºåŸŸï¼Œåˆ©ç”¨ f å°†æ¯ä¸€ä¸ªå•è¯çš„åŒºåŸŸé€†åº é¢˜ç›®ä¸‰ï¼šç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² a å’Œä¸€ä¸ªæ•´æ•° iã€‚Nä¸ºå­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œi ä¸º a ä¸­çš„ä½ç½®ï¼Œå°† a [ 0 â€¦ i ] ç§»åˆ°å³ä¾§ï¼Œa [ i + 1 â€¦ N - 1 ]ç§»åˆ°å·¦ä¾§ã€‚ ä¸¾ä¾‹ï¼š a = â€œ ABCDE â€œ ï¼Œi = 2 ã€‚å°† str è°ƒæ•´ä¸º â€œ DEABC â€œ ã€‚ è¦æ±‚ï¼šæ—¶é—´å¤æ‚åº¦ä¸º O(N)ï¼Œé¢å¤–ç©ºé—´å¤æ‚åº¦ä¸º O(1)ã€‚ æ€è·¯ï¼š å…ˆå°† a[ 0 â€¦ i ] éƒ¨åˆ†çš„å­—ç¬¦é€†åº å†å°† a[ i + 1 â€¦ N - 1 ] éƒ¨åˆ†çš„å­—ç¬¦é€†åº æœ€åå°†æ•´ä½“çš„å­—ç¬¦ a é€†åº é¢˜ç›®å››ï¼šç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„æ•°ç»„ strsï¼Œè¯·æ‰¾åˆ°ä¸€ç§æ‹¼æ¥é¡ºåºï¼Œä½¿å¾—å°†æ‰€æœ‰çš„å­—ç¬¦ä¸²æ‹¼æ¥èµ·æ¥ç»„æˆçš„å¤§å­—ç¬¦ä¸²æ˜¯æ‰€æœ‰å¯èƒ½æ€§ä¸­å­—å…¸é¡ºåºæœ€å°çš„ï¼Œå¹¶è¿”å›è¿™ä¸ªå­—ç¬¦ä¸²ã€‚ ä¸¾ä¾‹ï¼š strs = [ â€œ abc â€œ , â€œ de â€œ ]ï¼Œå¯ä»¥æ‹¼æ¥æˆ â€œ abcde â€œï¼Œä¹Ÿå¯ä»¥æ‹¼æ¥æˆ â€œ deabc â€œï¼Œä½†æ˜¯å‰è€…çš„å­—å…¸é¡ºåºæ›´å°ï¼Œæ‰€ä»¥è¿”å› â€œ abcde â€œ ã€‚ strs = [ â€œ b â€œ, â€œ ba â€œ ], å¯ä»¥æ‹¼æ¥æˆ â€œ bba â€œ, ä¹Ÿå¯ä»¥æ‹¼æ¥æˆ â€œ bab â€œ,ä½†æ˜¯åè€…çš„å­—å…¸é¡ºåºæ›´å°ï¼Œæ‰€ä»¥è¿”å› â€œ bab â€œã€‚ æ€è·¯ï¼šæœ€ä¼˜è§£çš„æ—¶é—´å¤æ‚åº¦O(N*logN)ï¼Œå…¶å®è´¨æ˜¯ä¸€ç§æ’åºçš„å®ç°ã€‚ æ–¹æ¡ˆäºŒä¸­æ˜¯æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²å½¼æ­¤æ‹¼æ¥åçš„å­—å…¸é¡ºåºï¼Œæ‰€ä»¥èƒ½æˆåŠŸã€‚","tags":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"http://www.54tianzhisheng.cn/tags/æ•°æ®ç»“æ„/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"http://www.54tianzhisheng.cn/tags/ç®—æ³•/"},{"name":"å­—ç¬¦ä¸²","slug":"å­—ç¬¦ä¸²","permalink":"http://www.54tianzhisheng.cn/tags/å­—ç¬¦ä¸²/"}]},{"title":"å¥‡æ€ªçš„Javaé¢˜ï¼šä¸ºä»€ä¹ˆ128 == 128è¿”å›ä¸ºFalseï¼Œè€Œ127 == 127ä¼šè¿”å›ä¸ºTrue?","date":"2017-06-12T16:00:00.000Z","path":"2017/06/13/å¥‡æ€ªçš„Javaé¢˜ï¼šä¸ºä»€ä¹ˆ128 == 128è¿”å›ä¸ºFalseï¼Œè€Œ127 == 127ä¼šè¿”å›ä¸ºTrue-/","text":"è¿™æ˜¯æˆ‘ä»¬ä»Šå¤©è¦è®¨è®ºçš„è¯é¢˜ï¼Œå› ä¸ºæˆ‘è§‰å¾—å®ƒéå¸¸çš„æœ‰è¶£ã€‚ å¦‚æœä½ è¿è¡Œå¦‚ä¸‹ä»£ç ï¼š 12345678910class A&#123; public static void main(String[] args) &#123; Integer a = 128, b = 128; System.out.println(a == b); Integer c = 127, d = 127; System.out.println(c == d); &#125;&#125; ä½ ä¼šå¾—åˆ°å¦‚ä¸‹ç»“æœï¼š 12falsetrue æˆ‘ä»¬çŸ¥é“ï¼Œå¦‚æœä¸¤ä¸ªå¼•ç”¨æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆ==å°±æˆç«‹ï¼›åä¹‹ï¼Œå¦‚æœä¸¤ä¸ªå¼•ç”¨æŒ‡å‘çš„ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆ==å°±ä¸æˆç«‹ï¼Œå³ä¾¿ä¸¤ä¸ªå¼•ç”¨çš„å†…å®¹æ˜¯ä¸€æ ·çš„ã€‚å› æ­¤ï¼Œç»“æœå°±ä¼šå‡ºç°falseã€‚ è¿™æ˜¯éå¸¸æœ‰è¶£çš„åœ°æ–¹ã€‚å¦‚æœä½ æŸ¥çœ‹Integer.javaç±»ï¼Œä½ ä¼šæ‰¾åˆ°IntegerCache.javaè¿™ä¸ªå†…éƒ¨ç§æœ‰ç±»ï¼Œå®ƒä¸º-128åˆ°127ä¹‹é—´çš„æ‰€æœ‰æ•´æ•°å¯¹è±¡æä¾›ç¼“å­˜ã€‚ è¿™ä¸ªä¸œè¥¿ä¸ºé‚£äº›æ•°å€¼æ¯”è¾ƒå°çš„æ•´æ•°æä¾›å†…éƒ¨ç¼“å­˜ï¼Œå½“è¿›è¡Œå¦‚æ­¤å£°æ˜æ—¶ï¼š 1Integer c = 127 å®ƒçš„å†…éƒ¨å°±æ˜¯è¿™æ ·çš„ï¼š 1Integer var3 = Integer.valueOf(127); å…¶å®æˆ‘é€šè¿‡å°†A.classæ–‡ä»¶åç¼–è¯‘åï¼Œä»£ç å¦‚ä¸‹å›¾ï¼š å¦‚æœæˆ‘ä»¬è§‚å¯ŸvalueOf()ç±»å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š 12345public static Integer valueOf(int i) &#123; if (i &gt;= IntegerCache.low &amp;&amp; i &lt;= IntegerCache.high) return IntegerCache.cache[i + (-IntegerCache.low)]; return new Integer(i); &#125; é€šè¿‡çœ‹æºç èƒ½å¤ŸçŸ¥é“ï¼Œæ•´æ•°ç±»å‹åœ¨-128ï½127ä¹‹é—´æ—¶ï¼Œä¼šä½¿ç”¨ç¼“å­˜ï¼Œé€ æˆçš„æ•ˆæœå°±æ˜¯ï¼Œå¦‚æœå·²ç»åˆ›å»ºäº†ä¸€ä¸ªç›¸åŒçš„æ•´æ•°ï¼Œä½¿ç”¨valueOfåˆ›å»ºç¬¬äºŒæ¬¡æ—¶ï¼Œä¸ä¼šä½¿ç”¨newå…³é”®å­—ï¼Œè€Œç”¨å·²ç»ç¼“å­˜çš„å¯¹è±¡ã€‚æ‰€ä»¥ä½¿ç”¨valueOfæ–¹æ³•åˆ›å»ºä¸¤æ¬¡å¯¹è±¡ï¼Œè‹¥å¯¹åº”çš„æ•°å€¼ç›¸åŒï¼Œä¸”æ•°å€¼åœ¨-128ï½127ä¹‹é—´æ—¶ï¼Œä¸¤ä¸ªå¯¹è±¡éƒ½æŒ‡å‘åŒä¸€ä¸ªåœ°å€ã€‚ å› æ­¤ã€‚ã€‚ã€‚ 1Integer c = 127, d = 127; ä¸¤è€…æŒ‡å‘åŒæ ·çš„å¯¹è±¡ã€‚ è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¸‹é¢è¿™æ®µä»£ç çš„ç»“æœä¸ºtrueäº†ï¼š 1System.out.println(c == d); ç°åœ¨ä½ å¯èƒ½ä¼šé—®ï¼Œä¸ºä»€ä¹ˆä¼šä¸º-128åˆ°127ä¹‹é—´çš„æ‰€æœ‰æ•´æ•°è®¾ç½®ç¼“å­˜ï¼Ÿ è¿™æ˜¯å› ä¸ºåœ¨è¿™ä¸ªèŒƒå›´å†…çš„å°æ•°å€¼æ•´æ•°åœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­çš„ä½¿ç”¨é¢‘ç‡è¦æ¯”å…¶å®ƒçš„å¤§å¾—å¤šï¼Œå¤šæ¬¡ä½¿ç”¨ç›¸åŒçš„åº•å±‚å¯¹è±¡è¿™ä¸€ç‰¹æ€§å¯ä»¥é€šè¿‡è¯¥è®¾ç½®è¿›è¡Œæœ‰æ•ˆçš„å†…å­˜ä¼˜åŒ–ã€‚ä½ å¯ä»¥ä½¿ç”¨reflection APIä»»æ„ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½ã€‚ è¿è¡Œä¸‹é¢çš„è¿™æ®µä»£ç ï¼Œä½ å°±ä¼šæ˜ç™½å®ƒçš„ç¥å¥‡æ‰€åœ¨äº†ã€‚ 12345678910111213public static void main(String[] args) throws NoSuchFieldException, IllegalAccessException &#123; Class cache = Integer.class.getDeclaredClasses()[0]; Field myCache = cache.getDeclaredField(&quot;cache&quot;); myCache.setAccessible(true); Integer[] newCache = (Integer[]) myCache.get(cache); newCache[132] = newCache[133]; int a = 2; int b = a + a; System.out.printf(&quot;%d + %d = %d&quot;, a, a, b); // &#125; æ‰“å°ç»“æœç«Ÿç„¶æ˜¯ï¼š 12 + 2 = 5 æˆ‘ä»¬å†æ¬¡çœ‹ä¸€ä¸‹åæ±‡ç¼–ä»£ç ï¼š æ˜¯ä¸æ˜¯åˆå’Œä¸Šé¢çš„æ˜¯åŒä¸€ä¸ªé—®é¢˜å‘¢ï¼Ÿ ä½†æ˜¯ç»“æœä¸ºä»€ä¹ˆæ˜¯ 2 + 2 = 5 å‘¢ï¼Ÿ æˆ‘ä»¬ç»§ç»­å»çœ‹ä¸€ä¸‹ Integer æºç ï¼Œå»æ·±å…¥äº†è§£ Integer ç¼“å­˜æœºåˆ¶ï¼Œä¸‹é¢æˆªä¸ªå›¾ï¼š æ ¹æ®æºç å¯ä»¥å‘ç°æœ€åä¿®æ”¹ Integer ç¼“å­˜ä¸Šé™æ—¶å€™çš„æ–¹æ³•æœ‰ç‚¹å°ç‘•ç–µã€‚æˆ‘ä»¬çœ‹çœ‹Apiç»™æˆ‘ä»¬æ€ä¹ˆå»ºè®®çš„ä¸€æ®µè¯ï¼š1the size of the cache may be controlled by the &#123;@code -XX:AutoBoxCacheMax=&lt;size&gt;&#125; option. åŸæ¥æˆ‘ä»¬åªéœ€è¦ï¼šè¿è¡Œæ—¶è®¾ç½® -XX:AutoBoxCacheMax=133 å°±OKã€‚ å‚è€ƒæ–‡ç« ï¼š å¥‡æ€ªçš„Javaé¢˜ï¼šä¸ºä»€ä¹ˆ1000 == 1000è¿”å›ä¸ºFalseï¼Œè€Œ100 == 100ä¼šè¿”å›ä¸ºTrue?","tags":[{"name":"Java","slug":"Java","permalink":"http://www.54tianzhisheng.cn/tags/Java/"}]},{"title":"ç¨‹åºè®¿é—®æ–‡ä»¶çš„å‡ ç§æ–¹å¼","date":"2017-06-12T16:00:00.000Z","path":"2017/06/13/ç¨‹åºè®¿é—®æ–‡ä»¶çš„å‡ ç§æ–¹å¼/","text":"IOç¨‹åºè®¿é—®æ–‡ä»¶çš„å‡ ç§æ–¹å¼ è¯»å–å’Œå†™å…¥æ–‡ä»¶ I/O æ“ä½œéƒ½è°ƒç”¨æ“ä½œç³»ç»Ÿæä¾›çš„æ¥å£ã€‚å› ä¸ºç£ç›˜è®¾å¤‡æ˜¯ç”±æ“ä½œç³»ç»Ÿç®¡ç†çš„ï¼Œåº”ç”¨ç¨‹åºè¦è®¿é—®ç‰©ç†è®¾å¤‡åªèƒ½é€šè¿‡ç³»ç»Ÿè°ƒç”¨çš„æ–¹å¼æ¥å·¥ä½œã€‚è¯»å’Œå†™åˆ†åˆ«å¯¹åº” read() å’Œ write() ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨ã€‚è€Œåªè¦æ˜¯ç³»ç»Ÿè°ƒç”¨å°±å¯èƒ½å­˜åœ¨å†…æ ¸ç©ºé—´åœ°å€å’Œç”¨æˆ·ç©ºé—´åœ°å€åˆ‡æ¢çš„é—®é¢˜ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæ“ä½œç³»ç»Ÿä¸ºäº†ä¿æŠ¤ç³»ç»Ÿæœ¬èº«çš„è¿è¡Œå®‰å…¨è€Œå°†å†…æ ¸ç¨‹åºè¿è¡Œä½¿ç”¨çš„å†…å­˜ç©ºé—´å’Œç”¨æˆ·ç¨‹åºè¿è¡Œçš„å†…å­˜ç©ºé—´è¿›è¡Œéš”ç¦»é€ æˆçš„ã€‚è™½ç„¶è¿™æ ·å¯ä»¥ä¿è¯å†…æ ¸ç¨‹åºè¿è¡Œçš„å®‰å…¨æ€§ï¼Œä½†æ˜¯ä¹Ÿå­˜åœ¨æ•°æ®å¯èƒ½éœ€è¦ä»å†…æ ¸ç©ºé—´å‘ç”¨æˆ·ç©ºé—´å¤åˆ¶çš„é—®é¢˜ã€‚ å¦‚æœé‡åˆ°éå¸¸è€—æ—¶çš„æ“ä½œï¼Œå¦‚ç£ç›˜ I/Oï¼Œ æ•°æ®ä»ç£ç›˜å¤åˆ¶åˆ°å†…æ ¸ç©ºé—´ï¼Œç„¶ååˆä»å†…æ ¸ç©ºé—´å¤åˆ¶åˆ°ç”¨æˆ·ç©ºé—´ï¼Œå°†ä¼šéå¸¸ç¼“æ…¢ã€‚è¿™æ—¶æ“ä½œç³»ç»Ÿä¸ºäº†åŠ é€Ÿ I/O è®¿é—®ï¼Œåœ¨å†…æ ¸ç©ºé—´ä½¿ç”¨ç¼“å­˜æœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯å°†ä»ç£ç›˜è¯»å–çš„æ–‡ä»¶æŒ‰ç…§ä¸€å®šçš„ç»„ç»‡æ–¹å¼è¿›è¡Œç¼“å­˜ï¼Œå¦‚æœç”¨æˆ·ç¨‹åºè®¿é—®çš„æ˜¯åŒä¸€æ®µç£ç›˜åœ°å€çš„ç©ºé—´æ•°æ®ï¼Œé‚£ä¹ˆæ“ä½œç³»ç»Ÿå°†ä»å†…æ ¸ç¼“å­˜ä¸­ç›´æ¥å–å‡ºè¿”å›ç»™ç”¨æˆ·ç¨‹åºï¼Œè¿™æ ·å°±å¯ä»¥å‡å° I/O çš„å“åº”æ—¶é—´ã€‚ 1. æ ‡å‡†è®¿é—®æ–‡ä»¶çš„æ–¹å¼æ ‡å‡†è®¿é—®æ–‡ä»¶çš„æ–¹å¼å°±æ˜¯å½“åº”ç”¨ç¨‹åºè°ƒç”¨ read() æ¥å£æ—¶ï¼Œæ“ä½œç³»ç»Ÿæ£€æŸ¥åœ¨å†…æ ¸çš„é«˜é€Ÿç¼“å­˜ä¸­æœ‰æ²¡æœ‰éœ€è¦çš„æ•°æ®ï¼Œå¦‚æœå·²ç»ç¼“å­˜äº†ï¼Œé‚£ä¹ˆå°±ç›´æ¥ä»ç¼“å­˜ä¸­è¿”å›ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™ä»ç£ç›˜ä¸­è¯»å–ï¼Œç„¶åç¼“å­˜åœ¨æ“ä½œç³»ç»Ÿçš„ç¼“å­˜ä¸­ã€‚ å†™å…¥çš„æ–¹å¼æ˜¯ï¼Œç”¨æˆ·çš„åº”ç”¨ç¨‹åºè°ƒç”¨ write() æ¥å£å°†æ•°æ®ä»ç”¨æˆ·åœ°å€ç©ºé—´å¤åˆ¶åˆ°å†…æ ¸åœ°å€ç©ºé—´çš„ç¼“å­˜ä¸­ã€‚è¿™æ—¶å¯¹ç”¨æˆ·ç¨‹åºæ¥è¯´å†™æ“ä½œå°±å·²ç»å®Œæˆäº†ï¼Œè‡³äºä»€ä¹ˆæ—¶å€™å†å†™åˆ°ç£ç›˜ä¸­ç”±æ“ä½œç³»ç»Ÿå†³å®šï¼Œé™¤éæ˜¾ç¤ºåœ°è°ƒç”¨ sync åŒæ­¥å‘½ä»¤ã€‚ æ ‡å‡†è®¿é—®æ–‡ä»¶çš„æ–¹å¼å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 2. ç›´æ¥ I/O çš„æ–¹å¼ç›´æ¥ I/O æ–¹å¼å°±æ˜¯åº”ç”¨ç¨‹åºç›´æ¥è®¿é—®ç£ç›˜æ•°æ®ï¼Œè€Œä¸ç»è¿‡æ“ä½œç³»ç»Ÿå†…æ ¸æ•°æ®ç¼“å†²åŒºï¼Œè¿™æ ·åšçš„ç›®çš„å°±æ˜¯å‡å°‘ä¸€æ¬¡ä»å†…æ ¸ç¼“å†²åŒºåˆ°ç”¨æˆ·ç¨‹åºç¼“å­˜çš„æ•°æ®å¤åˆ¶ã€‚æ­¤ç§æ–¹å¼é€šå¸¸æ˜¯åœ¨å¯¹æ•°æ®çš„ç¼“å­˜ç®¡ç†ç”±åº”ç”¨ç¨‹åºå®ç°çš„æ•°æ®åº“ç®¡ç†ç³»ç»Ÿä¸­ã€‚å¦‚åœ¨æ•°æ®åº“ç®¡ç†ç³»ç»Ÿä¸­ï¼Œç³»ç»Ÿæ˜ç¡®çš„çŸ¥é“åº”è¯¥ç¼“å­˜å“ªäº›æ•°æ®ï¼Œåº”è¯¥å¤±æ•ˆå“ªäº›æ•°æ®ï¼Œè¿˜å¯ä»¥å¯¹ä¸€äº›çƒ­ç‚¹çš„æ•°æ®è¿›è¡Œé¢„åŠ è½½ï¼Œæå‰å°†çƒ­ç‚¹æ•°æ®åŠ è½½åˆ°å†…å­˜ï¼Œå¯ä»¥åŠ é€Ÿæ•°æ®çš„è®¿é—®æ•ˆç‡ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œå¦‚æœæ˜¯ç”±æ“ä½œç³»ç»Ÿè¿›è¡Œç¼“å­˜ï¼Œåˆ™å¾ˆéš¾åšåˆ°ï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿå¹¶ä¸çŸ¥é“å“ªäº›æ˜¯çƒ­ç‚¹æ•°æ®ï¼Œå“ªäº›æ•°æ®æ˜¯è®¿é—®ä¸€æ¬¡åå†ä¹Ÿä¸ä¼šè®¿é—®äº†ï¼Œæ“ä½œç³»ç»Ÿå°±æ˜¯ç®€å•çš„ç¼“å­˜æœ€è¿‘ä¸€æ¬¡ä»ç£ç›˜è¯»å–çš„æ•°æ®ã€‚ ä½†æ˜¯ç›´æ¥ I/O ä¹Ÿæœ‰è´Ÿé¢çš„å½±å“ï¼Œå¦‚æœè®¿é—®çš„æ•°æ®ä¸å†åº”ç”¨ç¨‹åºç¼“å­˜ä¸­ï¼Œåˆ™æ¯æ¬¡æ•°æ®çš„åŠ è½½éƒ½éœ€è¦ä»ç£ç›˜è¯»å–ï¼Œæ ·åŠ è½½çš„è¯é€Ÿåº¦éå¸¸çš„æ…¢ï¼Œé€šå¸¸æ˜¯ç›´æ¥ I/O ä¸ å¼‚æ­¥ I/O ç»“åˆä½¿ç”¨ï¼Œä¼šå¾—åˆ°è¾ƒå¥½çš„æ€§èƒ½ã€‚ ç›´æ¥ I/O çš„æ–¹å¼å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 3. åŒæ­¥è®¿é—®æ–‡ä»¶çš„æ–¹å¼åŒæ­¥è®¿é—®æ–‡ä»¶çš„æ–¹å¼å°±æ˜¯æ•°æ®çš„è¯»å–å’Œå†™å…¥éƒ½æ˜¯åŒæ­¥æ“ä½œçš„ï¼Œå®ƒä¸æ ‡å‡†è®¿é—®æ–‡ä»¶çš„æ–¹å¼ä¸åŒçš„æ˜¯ï¼Œåªæœ‰å½“æ•°æ®è¢«æˆåŠŸå†™åˆ°ç£ç›˜æ—¶æ‰è¿”å›ç»™åº”ç”¨ç¨‹åºæˆåŠŸçš„æ ‡å¿—ã€‚ è¿™ç§è®¿é—®æ–‡ä»¶çš„æ–¹å¼æ€§èƒ½æ¯”è¾ƒå·®ï¼Œåªæœ‰åœ¨ä¸€äº›æ•°æ®å®‰å…¨æ€§è¦æ±‚æ¯”è¾ƒé«˜çš„åœºæ™¯ä¸­æ‰ä¼šä½¿ç”¨ï¼Œè€Œä¸”é€šå¸¸è¿™ç§æ–¹å¼çš„ç¡¬ä»¶éƒ½æ˜¯å®šåˆ¶çš„ã€‚ åŒæ­¥è®¿é—®æ–‡ä»¶çš„æ–¹å¼å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 4. å¼‚æ­¥è®¿é—®æ–‡ä»¶çš„æ–¹å¼å¼‚æ­¥è®¿é—®æ–‡ä»¶çš„æ–¹å¼å°±æ˜¯å½“è®¿é—®æ•°æ®çš„çº¿ç¨‹å‘å‡ºè¯·æ±‚ä¹‹åï¼Œçº¿ç¨‹ä¼šæ¥ç€å»å¤„ç†å…¶ä»–äº‹æƒ…ï¼Œè€Œä¸æ˜¯é˜»å¡ç­‰å¾…ï¼Œå½“è¯·æ±‚çš„æ•°æ®è¿”å›åç»§ç»­å¤„ç†ä¸‹é¢çš„æ“ä½œã€‚è¿™ç§æ–¹å¼å¯ä»¥æ˜æ˜¾çš„æé«˜åº”ç”¨ç¨‹åºçš„æ•ˆç‡ï¼Œä½†æ˜¯ä¸ä¼šæ”¹å˜è®¿é—®æ–‡ä»¶çš„æ•ˆç‡ã€‚ å¼‚æ­¥è®¿é—®æ–‡ä»¶çš„æ–¹å¼å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 5. å†…å­˜æ˜ å°„çš„æ–¹å¼å†…å­˜æ˜ å°„çš„æ–¹å¼æ˜¯æŒ‡æ“ä½œç³»ç»Ÿå°†å†…å­˜ä¸­çš„æŸä¸€å—åŒºåŸŸä¸ç£ç›˜ä¸­çš„æ–‡ä»¶å…³è”èµ·æ¥ï¼Œå½“è¦è®¿é—®å†…å­˜ä¸­çš„ä¸€æ®µæ•°æ®æ—¶ï¼Œè½¬æ¢ä¸ºè®¿é—®æ–‡ä»¶çš„æŸä¸€æ®µæ•°æ®ã€‚è¿™ç§æ–¹å¼çš„ç›®çš„åŒæ ·æ˜¯å‡å°‘æ•°æ®ä»å†…æ ¸ç©ºé—´ç¼“å­˜åˆ°ç”¨æˆ·ç©ºé—´ç¼“å­˜çš„æ•°æ®å¤åˆ¶æ“ä½œï¼Œå› ä¸ºè¿™ä¸¤ä¸ªç©ºé—´çš„æ•°æ®æ˜¯å…±äº«çš„ã€‚ å†…å­˜æ˜ å°„çš„æ–¹å¼å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æ³¨ï¼šä»¥ä¸Šå‚è€ƒä¹¦ç±ã€Šæ·±å…¥åˆ†æJava Web æŠ€æœ¯å†…å¹•ä¿®è®¢ç‰ˆã€‹è®¸ä»¤æ³¢ï¼Œæ›´å¤šç²¾å½©çŸ¥è¯†è¿˜è¯·çœ‹åŸä¹¦ã€‚","tags":[{"name":"IO","slug":"IO","permalink":"http://www.54tianzhisheng.cn/tags/IO/"}]},{"title":"MySQL å¤„ç†æµ·é‡æ•°æ®æ—¶çš„ä¸€äº›ä¼˜åŒ–æŸ¥è¯¢é€Ÿåº¦æ–¹æ³•","date":"2017-06-12T16:00:00.000Z","path":"2017/06/13/MySQL-select-good/","text":"åœ¨å‚ä¸å®é™…é¡¹ç›®ä¸­ï¼Œå½“ MySQL è¡¨çš„æ•°æ®é‡è¾¾åˆ°ç™¾ä¸‡çº§æ—¶ï¼Œæ™®é€šçš„ SQL æŸ¥è¯¢æ•ˆç‡å‘ˆç›´çº¿ä¸‹é™ï¼Œè€Œä¸”å¦‚æœ where ä¸­çš„æŸ¥è¯¢æ¡ä»¶è¾ƒå¤šæ—¶ï¼Œå…¶æŸ¥è¯¢é€Ÿåº¦æ— æ³•å®¹å¿ã€‚æƒ³æƒ³å¯çŸ¥ï¼Œå‡å¦‚æˆ‘ä»¬æŸ¥è¯¢æ·˜å®çš„ä¸€ä¸ªè®¢å•è¯¦æƒ…ï¼Œå¦‚æœæŸ¥è¯¢æ—¶é—´é«˜è¾¾å‡ åç§’ï¼Œè¿™ä¹ˆé«˜çš„æŸ¥è¯¢å»¶æ—¶ï¼Œä»»ä½•ç”¨æˆ·éƒ½ä¼šæŠ“ç‹‚ã€‚å› æ­¤å¦‚ä½•æé«˜ SQL è¯­å¥æŸ¥è¯¢æ•ˆç‡ï¼Œæ˜¾å¾—ååˆ†é‡è¦ã€‚ æŸ¥è¯¢é€Ÿåº¦æ…¢çš„åŸå› 1ã€æ²¡æœ‰ç´¢å¼•æˆ–è€…æ²¡æœ‰ç”¨åˆ°ç´¢å¼•ï¼ˆè¿™æ˜¯æŸ¥è¯¢æ…¢æœ€å¸¸è§çš„é—®é¢˜ï¼Œæ˜¯ç¨‹åºè®¾è®¡çš„ç¼ºé™·ï¼‰ 2ã€I/O ååé‡å°ï¼Œå½¢æˆäº†ç“¶é¢ˆæ•ˆåº”ã€‚ 3ã€æ²¡æœ‰åˆ›å»ºè®¡ç®—åˆ—å¯¼è‡´æŸ¥è¯¢ä¸ä¼˜åŒ–ã€‚ 4ã€å†…å­˜ä¸è¶³ 5ã€ç½‘ç»œé€Ÿåº¦æ…¢ 6ã€æŸ¥è¯¢å‡ºçš„æ•°æ®é‡è¿‡å¤§ï¼ˆå¯é‡‡ç”¨å¤šæ¬¡æŸ¥è¯¢ï¼Œå…¶ä»–çš„æ–¹æ³•é™ä½æ•°æ®é‡ï¼‰ 7ã€é”æˆ–è€…æ­»é”ï¼ˆè¿™æ˜¯æŸ¥è¯¢æ…¢æœ€å¸¸è§çš„é—®é¢˜ï¼Œæ˜¯ç¨‹åºè®¾è®¡çš„ç¼ºé™·ï¼‰ 8ã€sp_lock,sp_who,æ´»åŠ¨çš„ç”¨æˆ·æŸ¥çœ‹,åŸå› æ˜¯è¯»å†™ç«äº‰èµ„æºã€‚ 9ã€è¿”å›äº†ä¸å¿…è¦çš„è¡Œå’Œåˆ— 10ã€æŸ¥è¯¢è¯­å¥ä¸å¥½ï¼Œæ²¡æœ‰ä¼˜åŒ– 30 ç§ SQL æŸ¥è¯¢è¯­å¥çš„ä¼˜åŒ–æ–¹æ³•ï¼š1ã€åº”å°½é‡é¿å…åœ¨ where å­å¥ä¸­ä½¿ç”¨ != æˆ–è€… &lt;&gt; æ“ä½œç¬¦ï¼Œå¦åˆ™å°†å¼•æ“æ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æã€‚ 2ã€åº”å°½é‡é¿å…åœ¨ where å­å¥ä¸­å¯¹å­—æ®µè¿›è¡Œ null å€¼åˆ¤æ–­ï¼Œå¦åˆ™å°†å¯¼è‡´å¼•æ“æ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æï¼Œå¦‚ï¼š 1select id from t where num is null; å¯ä»¥åœ¨ num ä¸Šè®¾ç½®é»˜è®¤å€¼ 0 ï¼Œç¡®ä¿è¡¨ä¸­ num åˆ—æ²¡æœ‰ null å€¼ï¼Œç„¶åè¿™æ ·æŸ¥è¯¢ï¼š 1select id from t where num = 0; 3ã€å¯¹æŸ¥è¯¢è¿›è¡Œä¼˜åŒ–ï¼Œåº”å°½é‡é¿å…å…¨è¡¨æ‰«æï¼Œé¦–å…ˆåº”è€ƒè™‘åœ¨ where åŠ order by æ¶‰åŠçš„åˆ—ä¸Šå»ºç«‹ç´¢å¼•ã€‚ 4ã€å°½é‡é¿å…åœ¨ where å­å¥ä¸­ä½¿ç”¨ or æ¥è¿æ¥æ¡ä»¶ï¼Œå¦åˆ™å°†å¯¼è‡´å¼•æ“æ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æï¼Œå¦‚ï¼š 1select id from t where num = 10 or num = 20; å¯ä»¥è¿™æ ·æŸ¥è¯¢ï¼š 123select id from t where num = 10union allselect id from t where num = 20; 5ã€ä¸‹é¢çš„æŸ¥è¯¢ä¹Ÿå°†å¯¼è‡´å…¨è¡¨æ‰«æï¼šï¼ˆä¸èƒ½å‰ç½®ç™¾åˆ†å·ï¼‰ 1select id from t where name like '%abc%'; è‹¥è¦æé«˜æ•ˆç‡ï¼Œå¯ä»¥è€ƒè™‘å…¨æ–‡æ£€ç´¢ã€‚ 6ã€in å’Œ not in ä¹Ÿè¦æ…ç”¨ï¼Œå¦åˆ™ä¼šå¯¼è‡´å…¨è¡¨æ‰«æï¼Œå¦‚ï¼š 1select id from t where num in(1, 2, 3); å¯¹äºè¿ç»­çš„æ•°å€¼ï¼Œèƒ½ç”¨ between å°±ä¸è¦ç”¨ in äº†ï¼š 1select id from t where num between 1 and 3; 12345select xx,phone FROM send a JOIN ( select '13891030091' phone union select '13992085916' â€¦â€¦â€¦â€¦ UNION SELECT '13619100234' ) b on a.Phone=b.phone--æ›¿ä»£ä¸‹é¢ å¾ˆå¤šæ•°æ®éš”å¼€çš„æ—¶å€™in('13891030091','13992085916','13619100234'â€¦â€¦â€¦â€¦) 7ã€å¦‚æœåœ¨ where å­å¥ä¸­ä½¿ç”¨å‚æ•°ï¼Œä¹Ÿä¼šå¯¼è‡´å…¨è¡¨æ‰«æã€‚å› ä¸º SQL åªæœ‰åœ¨è¿è¡Œæ—¶æ‰ä¼šè§£æå±€éƒ¨å˜é‡ï¼Œä½†ä¼˜åŒ–ç¨‹åºä¸èƒ½å°†è®¿é—®è®¡åˆ’çš„é€‰æ‹©åˆ°è¿è¡Œæ—¶ï¼›å®ƒå¿…é¡»åœ¨ç¼–è¯‘æ—¶è¿›è¡Œé€‰æ‹©ã€‚ç„¶è€Œï¼Œå¦‚æœåœ¨ç¼–è¯‘æ—¶ç®€å†è®¿é—®è®¡åˆ’ï¼Œå˜é‡çš„å€¼è¿˜æ˜¯æœªçŸ¥çš„ï¼Œå› è€Œæ— æ³•ä½œä¸ºç´¢å¼•é€‰æ‹©çš„è¾“å…¥é¡¹ã€‚å¦‚ä¸‹é¢è¯­å¥å°†è¿›è¡Œå…¨è¡¨æ‰«æï¼š 1select id from t where num = @num; å¯ä»¥æ”¹ä¸ºå¼ºåˆ¶æŸ¥è¯¢ä½¿ç”¨ç´¢å¼•ï¼š 1select id from t with(index(ç´¢å¼•å)) where num = @num; 8ã€åº”å°½é‡é¿å…åœ¨ where å­å¥ä¸­å¯¹å­—æ®µè¿›è¡Œè¡¨è¾¾å¼æ“ä½œï¼Œè¿™å°†å¯¼è‡´å¼•æ“æ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æã€‚å¦‚ï¼š 1select id from t where num/2 = 100; åº”æ”¹ä¸ºï¼š 1select id from t where num = 100 * 2; 9ã€åº”å°½é‡é¿å…åœ¨ where å­å¥ä¸­å¯¹å­—æ®µè¿›è¡Œå‡½æ•°æ“ä½œï¼Œè¿™å°†å¯¼è‡´å¼•æ“æ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æã€‚å¦‚ï¼š 12select id from t where substring(name, 1, 3) = â€™abcâ€™â€“name; //ä»¥abcå¼€å¤´çš„idselect id from t where datediff(day,createdate,â€™2005-11-30â€²) = 0â€“â€™2005-11-30â€²; //ç”Ÿæˆçš„id åº”æ”¹ä¸º: 12select id from t where name like â€˜abc%â€™select id from t where createdate &gt;= â€™2005-11-30â€² and createdate &lt; â€™2005-12-1â€²; 10ã€ä¸è¦åœ¨ where å­å¥ä¸­çš„ â€œ=â€ å·¦è¾¹è¿›è¡Œå‡½æ•°ï¼Œç®—æœ¯è¿ç®—æˆ–è€…å…¶ä»–è¡¨è¾¾å¼è¿ç®—ï¼Œå¦åˆ™ç³»ç»Ÿå°†å¯èƒ½æ— æ³•æ­£ç¡®ä½¿ç”¨ç´¢å¼•ã€‚ 11ã€åœ¨ä½¿ç”¨ç´¢å¼•å­—æ®µä½œä¸ºæ¡ä»¶æ—¶ï¼Œå¦‚æœè¯¥ç´¢å¼•æ˜¯å¤åˆç´¢å¼•ï¼Œé‚£ä¹ˆå¿…é¡»ä½¿ç”¨åˆ°è¯¥ç´¢å¼•çš„ç¬¬ä¸€ä¸ªå­—æ®µä½œä¸ºæ¡ä»¶æ—¶æ‰èƒ½ä¿è¯ç³»ç»Ÿä½¿ç”¨è¯¥ç´¢å¼•ï¼Œå¦åˆ™è¯¥ç´¢å¼•å°†ä¸ä¼šè¢«ä½¿ç”¨ï¼Œå¹¶ä¸”åº”å°½å¯èƒ½çš„è®©å­—æ®µé¡ºåºä¸ç´¢å¼•é¡ºåºç›¸ä¸€è‡´ã€‚ 12ã€ä¸è¦äº›ä¸€äº›æ²¡æœ‰æ„ä¹‰çš„æŸ¥è¯¢ï¼Œå¦‚éœ€è¦ç”Ÿæˆä¸€ä¸ªç©ºè¡¨ç»“æ„ï¼š 1select col1,col2 into #t from t where 1=0; è¿™ç±»ä»£ç ä¸ä¼šè¿”å›ä»»ä½•ç»“æœé›†ï¼Œä½†æ˜¯ä¼šæ¶ˆè€—ç³»ç»Ÿèµ„æºçš„ï¼Œåº”æ”¹æˆè¿™æ ·ï¼š 1create table #t(â€¦) 13ã€å¾ˆå¤šæ—¶å€™ç”¨ exists ä»£æ›¿ in æ˜¯ä¸€ä¸ªå¥½çš„é€‰æ‹©ï¼š 1select num from a where num in(select num from b); ç”¨ä¸‹é¢çš„è¯­å¥æ›¿æ¢ï¼š 1select num from a where exists(select 1 from b where num=a.num); 14ã€å¹¶ä¸æ˜¯æ‰€æœ‰ç´¢å¼•å¯¹æŸ¥è¯¢éƒ½æœ‰æ•ˆï¼ŒSQLæ˜¯æ ¹æ®è¡¨ä¸­æ•°æ®æ¥è¿›è¡ŒæŸ¥è¯¢ä¼˜åŒ–çš„ï¼Œå½“ç´¢å¼•åˆ—æœ‰å¤§é‡æ•°æ®é‡å¤æ—¶ï¼ŒSQLæŸ¥è¯¢å¯èƒ½ä¸ä¼šå»åˆ©ç”¨ç´¢å¼•ï¼Œå¦‚ä¸€è¡¨ä¸­æœ‰å­—æ®µ sexï¼Œmaleã€femaleå‡ ä¹å„ä¸€åŠï¼Œé‚£ä¹ˆå³ä½¿åœ¨sexä¸Šå»ºäº†ç´¢å¼•ä¹Ÿå¯¹æŸ¥è¯¢æ•ˆç‡èµ·ä¸äº†ä½œç”¨ã€‚ 15ã€ç´¢å¼•å¹¶ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œç´¢å¼•å›ºç„¶å¯ä»¥æé«˜ç›¸åº”çš„ select çš„æ•ˆç‡ï¼Œä½†åŒæ—¶ä¹Ÿé™ä½äº† insert åŠ update çš„æ•ˆç‡ï¼Œå› ä¸º insert æˆ– update æ—¶æœ‰å¯èƒ½ä¼šé‡å»ºç´¢å¼•ï¼Œæ‰€ä»¥æ€æ ·å»ºç´¢å¼•éœ€è¦æ…é‡è€ƒè™‘ï¼Œè§†å…·ä½“æƒ…å†µè€Œå®šã€‚ä¸€ä¸ªè¡¨çš„ç´¢å¼•æ•°æœ€å¥½ä¸è¦è¶…è¿‡6ä¸ªï¼Œè‹¥å¤ªå¤šåˆ™åº”è€ƒè™‘ä¸€äº›ä¸å¸¸ä½¿ç”¨åˆ°çš„åˆ—ä¸Šå»ºçš„ç´¢å¼•æ˜¯å¦æœ‰å¿…è¦ã€‚ 16ã€åº”å°½å¯èƒ½çš„é¿å…æ›´æ–° clustered ç´¢å¼•æ•°æ®åˆ—ï¼Œå› ä¸º clustered ç´¢å¼•æ•°æ®åˆ—çš„é¡ºåºå°±æ˜¯è¡¨è®°å½•çš„ç‰©ç†å­˜å‚¨é¡ºåºï¼Œä¸€æ—¦è¯¥åˆ—å€¼æ”¹å˜å°†å¯¼è‡´æ•´ä¸ªè¡¨è®°å½•çš„é¡ºåºçš„è°ƒæ•´ï¼Œä¼šè€—è´¹ç›¸å½“å¤§çš„èµ„æºã€‚è‹¥åº”ç”¨ç³»ç»Ÿéœ€è¦é¢‘ç¹æ›´æ–° clustered ç´¢å¼•æ•°æ®åˆ—ï¼Œé‚£ä¹ˆéœ€è¦è€ƒè™‘æ˜¯å¦åº”å°†è¯¥ç´¢å¼•å»ºä¸º clustered ç´¢å¼•ã€‚ 17ã€å°½é‡ä½¿ç”¨æ•°å­—å‹å­—æ®µï¼Œè‹¥åªå«æ•°å€¼ä¿¡æ¯çš„å­—æ®µå°½é‡ä¸è¦è®¾è®¡ä¸ºå­—ç¬¦å‹ï¼Œè¿™ä¼šé™ä½æŸ¥è¯¢å’Œè¿æ¥çš„æ€§èƒ½ï¼Œå¹¶ä¼šå¢åŠ å­˜å‚¨å¼€é”€ã€‚è¿™æ˜¯å› ä¸ºå¼•æ“åœ¨å¤„ç†æŸ¥è¯¢å’Œè¿æ¥æ—¶ä¼š é€ä¸ªæ¯”è¾ƒå­—ç¬¦ä¸²ä¸­æ¯ä¸€ä¸ªå­—ç¬¦ï¼Œè€Œå¯¹äºæ•°å­—å‹è€Œè¨€åªéœ€è¦æ¯”è¾ƒä¸€æ¬¡å°±å¤Ÿäº†ã€‚ 18ã€å°½å¯èƒ½çš„ä½¿ç”¨ varchar/nvarchar ä»£æ›¿ char/nchar ï¼Œå› ä¸ºé¦–å…ˆå˜é•¿å­—æ®µå­˜å‚¨ç©ºé—´å°ï¼Œå¯ä»¥èŠ‚çœå­˜å‚¨ç©ºé—´ï¼Œå…¶æ¬¡å¯¹äºæŸ¥è¯¢æ¥è¯´ï¼Œåœ¨ä¸€ä¸ªç›¸å¯¹è¾ƒå°çš„å­—æ®µå†…æœç´¢æ•ˆç‡æ˜¾ç„¶è¦é«˜äº›ã€‚ 19ã€ä»»ä½•åœ°æ–¹éƒ½ä¸è¦ä½¿ç”¨ select * from t ï¼Œç”¨å…·ä½“çš„å­—æ®µåˆ—è¡¨ä»£æ›¿ *ï¼Œä¸è¦è¿”å›ç”¨ä¸åˆ°çš„ä»»ä½•å­—æ®µã€‚ 20ã€å°½é‡ä½¿ç”¨è¡¨å˜é‡æ¥ä»£æ›¿ä¸´æ—¶è¡¨ã€‚å¦‚æœè¡¨å˜é‡åŒ…å«å¤§é‡æ•°æ®ï¼Œè¯·æ³¨æ„ç´¢å¼•éå¸¸æœ‰é™ï¼ˆåªæœ‰ä¸»é”®ç´¢å¼•ï¼‰ã€‚ 21ã€é¿å…é¢‘ç¹åˆ›å»ºå’Œåˆ é™¤ä¸´æ—¶è¡¨ï¼Œä»¥å‡å°‘ç³»ç»Ÿè¡¨èµ„æºçš„æ¶ˆè€—ã€‚ 22ã€ä¸´æ—¶è¡¨å¹¶ä¸æ˜¯ä¸å¯ä½¿ç”¨ï¼Œé€‚å½“åœ°ä½¿ç”¨å®ƒä»¬å¯ä»¥ä½¿æŸäº›ä¾‹ç¨‹æ›´æœ‰æ•ˆï¼Œä¾‹å¦‚ï¼Œå½“éœ€è¦é‡å¤å¼•ç”¨å¤§å‹è¡¨æˆ–å¸¸ç”¨è¡¨ä¸­çš„æŸä¸ªæ•°æ®é›†æ—¶ã€‚ä½†æ˜¯ï¼Œå¯¹äºä¸€æ¬¡æ€§äº‹ä»¶ï¼Œæœ€å¥½ä½¿ç”¨å¯¼å‡ºè¡¨ã€‚ 23ã€åœ¨æ–°å»ºä¸´æ—¶è¡¨æ—¶ï¼Œå¦‚æœä¸€æ¬¡æ€§æ’å…¥æ•°æ®é‡å¾ˆå¤§ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ select into ä»£æ›¿ create tableï¼Œé¿å…é€ æˆå¤§é‡ log ï¼Œä»¥æé«˜é€Ÿåº¦ï¼›å¦‚æœæ•°æ®é‡ä¸å¤§ï¼Œä¸ºäº†ç¼“å’Œç³»ç»Ÿè¡¨çš„èµ„æºï¼Œåº”å…ˆ create tableï¼Œç„¶å insertã€‚ 24ã€å¦‚æœä½¿ç”¨åˆ°äº†ä¸´æ—¶è¡¨ï¼Œåœ¨å­˜å‚¨è¿‡ç¨‹çš„æœ€ååŠ¡å¿…å°†æ‰€æœ‰çš„ä¸´æ—¶è¡¨æ˜¾å¼åˆ é™¤ï¼Œå…ˆ truncate table ï¼Œç„¶å drop table ï¼Œè¿™æ ·å¯ä»¥é¿å…ç³»ç»Ÿè¡¨çš„è¾ƒé•¿æ—¶é—´é”å®šã€‚ 25ã€å°½é‡é¿å…ä½¿ç”¨æ¸¸æ ‡ï¼Œå› ä¸ºæ¸¸æ ‡çš„æ•ˆç‡è¾ƒå·®ï¼Œå¦‚æœæ¸¸æ ‡æ“ä½œçš„æ•°æ®è¶…è¿‡1ä¸‡è¡Œï¼Œé‚£ä¹ˆå°±åº”è¯¥è€ƒè™‘æ”¹å†™ã€‚ 26ã€ä½¿ç”¨åŸºäºæ¸¸æ ‡çš„æ–¹æ³•æˆ–ä¸´æ—¶è¡¨æ–¹æ³•ä¹‹å‰ï¼Œåº”å…ˆå¯»æ‰¾åŸºäºé›†çš„è§£å†³æ–¹æ¡ˆæ¥è§£å†³é—®é¢˜ï¼ŒåŸºäºé›†çš„æ–¹æ³•é€šå¸¸æ›´æœ‰æ•ˆã€‚ 27ã€ä¸ä¸´æ—¶è¡¨ä¸€æ ·ï¼Œæ¸¸æ ‡å¹¶ä¸æ˜¯ä¸å¯ä½¿ç”¨ã€‚å¯¹å°å‹æ•°æ®é›†ä½¿ç”¨ FAST_FORWARD æ¸¸æ ‡é€šå¸¸è¦ä¼˜äºå…¶ä»–é€è¡Œå¤„ç†æ–¹æ³•ï¼Œå°¤å…¶æ˜¯åœ¨å¿…é¡»å¼•ç”¨å‡ ä¸ªè¡¨æ‰èƒ½è·å¾—æ‰€éœ€çš„æ•°æ®æ—¶ã€‚åœ¨ç»“æœé›†ä¸­åŒ…æ‹¬â€œåˆè®¡â€çš„ä¾‹ç¨‹é€šå¸¸è¦æ¯”ä½¿ç”¨æ¸¸æ ‡æ‰§è¡Œçš„é€Ÿåº¦å¿«ã€‚å¦‚æœå¼€å‘æ—¶ é—´å…è®¸ï¼ŒåŸºäºæ¸¸æ ‡çš„æ–¹æ³•å’ŒåŸºäºé›†çš„æ–¹æ³•éƒ½å¯ä»¥å°è¯•ä¸€ä¸‹ï¼Œçœ‹å“ªä¸€ç§æ–¹æ³•çš„æ•ˆæœæ›´å¥½ã€‚ 28ã€åœ¨æ‰€æœ‰çš„å­˜å‚¨è¿‡ç¨‹å’Œè§¦å‘å™¨çš„å¼€å§‹å¤„è®¾ç½® SET NOCOUNT ON ï¼Œåœ¨ç»“æŸæ—¶è®¾ç½® SET NOCOUNT OFF ã€‚æ— éœ€åœ¨æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹å’Œè§¦å‘å™¨çš„æ¯ä¸ªè¯­å¥åå‘å®¢æˆ·ç«¯å‘é€ DONE_IN_PROC æ¶ˆæ¯ã€‚ 29ã€å°½é‡é¿å…å‘å®¢æˆ·ç«¯è¿”å›å¤§æ•°æ®é‡ï¼Œè‹¥æ•°æ®é‡è¿‡å¤§ï¼Œåº”è¯¥è€ƒè™‘ç›¸åº”éœ€æ±‚æ˜¯å¦åˆç†ã€‚ 30ã€å°½é‡é¿å…å¤§äº‹åŠ¡æ“ä½œï¼Œæé«˜ç³»ç»Ÿå¹¶å‘èƒ½åŠ›ã€‚","tags":[{"name":"MySQL","slug":"MySQL","permalink":"http://www.54tianzhisheng.cn/tags/MySQL/"}]},{"title":"Pyspideræ¡†æ¶ â€”â€” Pythonçˆ¬è™«å®æˆ˜ä¹‹çˆ¬å– V2EX ç½‘ç«™å¸–å­","date":"2017-06-12T16:00:00.000Z","path":"2017/06/13/Pyspideræ¡†æ¶ â€”â€” Pythonçˆ¬è™«å®æˆ˜ä¹‹çˆ¬å– V2EX ç½‘ç«™å¸–å­/","text":"èƒŒæ™¯ï¼š PySpiderï¼šä¸€ä¸ªå›½äººç¼–å†™çš„å¼ºå¤§çš„ç½‘ç»œçˆ¬è™«ç³»ç»Ÿå¹¶å¸¦æœ‰å¼ºå¤§çš„WebUIã€‚é‡‡ç”¨Pythonè¯­è¨€ç¼–å†™ï¼Œåˆ†å¸ƒå¼æ¶æ„ï¼Œæ”¯æŒå¤šç§æ•°æ®åº“åç«¯ï¼Œå¼ºå¤§çš„WebUIæ”¯æŒè„šæœ¬ç¼–è¾‘å™¨ï¼Œä»»åŠ¡ç›‘è§†å™¨ï¼Œé¡¹ç›®ç®¡ç†å™¨ä»¥åŠç»“æœæŸ¥çœ‹å™¨ã€‚åœ¨çº¿ç¤ºä¾‹ï¼š http://demo.pyspider.org/ å®˜æ–¹æ–‡æ¡£ï¼š http://docs.pyspider.org/en/latest/ Github : https://github.com/binux/pyspider æœ¬æ–‡çˆ¬è™«ä»£ç  Github åœ°å€ï¼šhttps://github.com/zhisheng17/Python-Projects/blob/master/v2ex/V2EX.py è¯´äº†è¿™ä¹ˆå¤šï¼Œæˆ‘ä»¬è¿˜æ˜¯æ¥çœ‹æ­£æ–‡å§ï¼ å‰æ: ä½ å·²ç»å®‰è£…å¥½äº†Pyspider å’Œ MySQL-pythonï¼ˆä¿å­˜æ•°æ®ï¼‰ å¦‚æœä½ è¿˜æ²¡å®‰è£…çš„è¯ï¼Œè¯·çœ‹çœ‹æˆ‘çš„å‰ä¸€ç¯‡æ–‡ç« ï¼Œé˜²æ­¢ä½ ä¹Ÿèµ°å¼¯è·¯ã€‚ Pyspider æ¡†æ¶å­¦ä¹ æ—¶èµ°è¿‡çš„ä¸€äº›å‘ HTTP 599: SSL certificate problem: unable to get local issuer certificateé”™è¯¯ æˆ‘æ‰€é‡åˆ°çš„ä¸€äº›é”™è¯¯ï¼š é¦–å…ˆï¼Œæœ¬çˆ¬è™«ç›®æ ‡ï¼šä½¿ç”¨ Pyspider æ¡†æ¶çˆ¬å– V2EX ç½‘ç«™çš„å¸–å­ä¸­çš„é—®é¢˜å’Œå†…å®¹ï¼Œç„¶åå°†çˆ¬å–çš„æ•°æ®ä¿å­˜åœ¨æœ¬åœ°ã€‚ V2EX ä¸­å¤§éƒ¨åˆ†çš„å¸–å­æŸ¥çœ‹æ˜¯ä¸éœ€è¦ç™»å½•çš„ï¼Œå½“ç„¶ä¹Ÿæœ‰äº›å¸–å­æ˜¯éœ€è¦ç™»é™†åæ‰èƒ½å¤ŸæŸ¥çœ‹çš„ã€‚ï¼ˆå› ä¸ºåæ¥çˆ¬å–çš„æ—¶å€™å‘ç°ä¸€ç›´ error ï¼ŒæŸ¥çœ‹å…·ä½“åŸå› åæ‰çŸ¥é“æ˜¯éœ€è¦ç™»å½•çš„æ‰å¯ä»¥æŸ¥çœ‹é‚£äº›å¸–å­çš„ï¼‰æ‰€ä»¥æˆ‘è§‰å¾—æ²¡å¿…è¦ç”¨åˆ° Cookieï¼Œå½“ç„¶å¦‚æœä½ éå¾—è¦ç™»å½•ï¼Œé‚£ä¹Ÿå¾ˆç®€å•ï¼Œç®€å•åœ°æ–¹æ³•å°±æ˜¯æ·»åŠ ä½ ç™»å½•åçš„ cookie äº†ã€‚ æˆ‘ä»¬åœ¨ https://www.v2ex.com/ æ‰«äº†ä¸€éï¼Œå‘ç°å¹¶æ²¡æœ‰ä¸€ä¸ªåˆ—è¡¨èƒ½åŒ…å«æ‰€æœ‰çš„å¸–å­ï¼Œåªèƒ½é€€è€Œæ±‚å…¶æ¬¡ï¼Œé€šè¿‡æŠ“å–åˆ†ç±»ä¸‹çš„æ‰€æœ‰çš„æ ‡ç­¾åˆ—è¡¨é¡µï¼Œæ¥éå†æ‰€æœ‰çš„å¸–å­ï¼š https://www.v2ex.com/?tab=tech ç„¶åæ˜¯ https://www.v2ex.com/go/programmer æœ€åæ¯ä¸ªå¸–å­çš„è¯¦æƒ…åœ°å€æ˜¯ ï¼ˆä¸¾ä¾‹ï¼‰ï¼š https://www.v2ex.com/t/314683#reply1 åˆ›å»ºä¸€ä¸ªé¡¹ç›® åœ¨ pyspider çš„ dashboard çš„å³ä¸‹è§’ï¼Œç‚¹å‡» â€œCreateâ€ æŒ‰é’® æ›¿æ¢ on_start å‡½æ•°çš„ self.crawl çš„ URLï¼š 123@every(minutes=24 * 60) def on_start(self): self.crawl(&apos;https://www.v2ex.com/&apos;, callback=self.index_page, validate_cert=False) self.crawl å‘Šè¯‰ pyspider æŠ“å–æŒ‡å®šé¡µé¢ï¼Œç„¶åä½¿ç”¨ callback å‡½æ•°å¯¹ç»“æœè¿›è¡Œè§£æã€‚ @every) ä¿®é¥°å™¨ï¼Œè¡¨ç¤º on_start æ¯å¤©ä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œè¿™æ ·å°±èƒ½æŠ“åˆ°æœ€æ–°çš„å¸–å­äº†ã€‚ validate_cert=False ä¸€å®šè¦è¿™æ ·ï¼Œå¦åˆ™ä¼šæŠ¥ HTTP 599: SSL certificate problem: unable to get local issuer certificateé”™è¯¯ é¦–é¡µï¼š ç‚¹å‡»ç»¿è‰²çš„ run æ‰§è¡Œï¼Œä½ ä¼šçœ‹åˆ° follows ä¸Šé¢æœ‰ä¸€ä¸ªçº¢è‰²çš„ 1ï¼Œåˆ‡æ¢åˆ° follows é¢æ¿ï¼Œç‚¹å‡»ç»¿è‰²çš„æ’­æ”¾æŒ‰é’®ï¼š ç¬¬äºŒå¼ æˆªå›¾ä¸€å¼€å§‹æ˜¯å‡ºç°è¿™ä¸ªé—®é¢˜äº†ï¼Œè§£å†³åŠæ³•çœ‹å‰é¢å†™çš„æ–‡ç« ï¼Œåæ¥é—®é¢˜å°±ä¸å†ä¼šå‡ºç°äº†ã€‚ Tab åˆ—è¡¨é¡µ : åœ¨ tab åˆ—è¡¨é¡µ ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æå–å‡ºæ‰€æœ‰çš„ä¸»é¢˜åˆ—è¡¨é¡µ çš„ URLã€‚ä½ å¯èƒ½å·²ç»å‘ç°äº†ï¼Œsample handler å·²ç»æå–äº†éå¸¸å¤šå¤§çš„ URL ä»£ç ï¼š1234@config(age=10 * 24 * 60 * 60) def index_page(self, response): for each in response.doc(&apos;a[href^=&quot;https://www.v2ex.com/?tab=&quot;]&apos;).items(): self.crawl(each.attr.href, callback=self.tab_page, validate_cert=False) ç”±äºå¸–å­åˆ—è¡¨é¡µå’Œ tabåˆ—è¡¨é¡µé•¿çš„å¹¶ä¸ä¸€æ ·ï¼Œåœ¨è¿™é‡Œæ–°å»ºäº†ä¸€ä¸ª callback ä¸º self.tab_page @config(age=10 24 60 * 60) åœ¨è¿™è¡¨ç¤ºæˆ‘ä»¬è®¤ä¸º 10 å¤©å†…é¡µé¢æœ‰æ•ˆï¼Œä¸ä¼šå†æ¬¡è¿›è¡Œæ›´æ–°æŠ“å– Goåˆ—è¡¨é¡µ : ä»£ç ï¼š 1234@config(age=10 * 24 * 60 * 60) def tab_page(self, response): for each in response.doc(&apos;a[href^=&quot;https://www.v2ex.com/go/&quot;]&apos;).items(): self.crawl(each.attr.href, callback=self.board_page, validate_cert=False) å¸–å­è¯¦æƒ…é¡µï¼ˆTï¼‰: ä½ å¯ä»¥çœ‹åˆ°ç»“æœé‡Œé¢å‡ºç°äº†ä¸€äº›replyçš„ä¸œè¥¿ï¼Œå¯¹äºè¿™äº›æˆ‘ä»¬æ˜¯å¯ä»¥ä¸éœ€è¦çš„ï¼Œæˆ‘ä»¬å¯ä»¥å»æ‰ã€‚ åŒæ—¶æˆ‘ä»¬è¿˜éœ€è¦è®©ä»–è‡ªå·±å®ç°è‡ªåŠ¨ç¿»é¡µåŠŸèƒ½ã€‚ ä»£ç ï¼š123456789@config(age=10 * 24 * 60 * 60) def board_page(self, response): for each in response.doc(&apos;a[href^=&quot;https://www.v2ex.com/t/&quot;]&apos;).items(): url = each.attr.href if url.find(&apos;#reply&apos;)&gt;0: url = url[0:url.find(&apos;#&apos;)] self.crawl(url, callback=self.detail_page, validate_cert=False) for each in response.doc(&apos;a.page_normal&apos;).items(): self.crawl(each.attr.href, callback=self.board_page, validate_cert=False) #å®ç°è‡ªåŠ¨ç¿»é¡µåŠŸèƒ½ å»æ‰åçš„è¿è¡Œæˆªå›¾ï¼š å®ç°è‡ªåŠ¨ç¿»é¡µåçš„æˆªå›¾ï¼š æ­¤æ—¶æˆ‘ä»¬å·²ç»å¯ä»¥åŒ¹é…äº†æ‰€æœ‰çš„å¸–å­çš„ url äº†ã€‚ ç‚¹å‡»æ¯ä¸ªå¸–å­åé¢çš„æŒ‰é’®å°±å¯ä»¥æŸ¥çœ‹å¸–å­å…·ä½“è¯¦æƒ…äº†ã€‚ ä»£ç ï¼š 12345678910@config(priority=2) def detail_page(self, response): title = response.doc(&apos;h1&apos;).text() content = response.doc(&apos;div.topic_content&apos;).html().replace(&apos;&quot;&apos;, &apos;\\\\&quot;&apos;) self.add_question(title, content) #æ’å…¥æ•°æ®åº“ return &#123; &quot;url&quot;: response.url, &quot;title&quot;: title, &quot;content&quot;: content, &#125; æ’å…¥æ•°æ®åº“çš„è¯ï¼Œéœ€è¦æˆ‘ä»¬åœ¨ä¹‹å‰å®šä¹‰ä¸€ä¸ªadd_questionå‡½æ•°ã€‚ 123456789101112131415#è¿æ¥æ•°æ®åº“def __init__(self): self.db = MySQLdb.connect(&apos;localhost&apos;, &apos;root&apos;, &apos;root&apos;, &apos;wenda&apos;, charset=&apos;utf8&apos;) def add_question(self, title, content): try: cursor = self.db.cursor() sql = &apos;insert into question(title, content, user_id, created_date, comment_count) values (&quot;%s&quot;,&quot;%s&quot;,%d, %s, 0)&apos; % (title, content, random.randint(1, 10) , &apos;now()&apos;); #æ’å…¥æ•°æ®åº“çš„SQLè¯­å¥ print sql cursor.execute(sql) print cursor.lastrowid self.db.commit() except Exception, e: print e self.db.rollback() æŸ¥çœ‹çˆ¬è™«è¿è¡Œç»“æœï¼š å…ˆdebugä¸‹ï¼Œå†è°ƒæˆrunningã€‚pyspideræ¡†æ¶åœ¨windowsä¸‹çš„bug è®¾ç½®è·‘çš„é€Ÿåº¦ï¼Œå»ºè®®ä¸è¦è·‘çš„å¤ªå¿«ï¼Œå¦åˆ™å¾ˆå®¹æ˜“è¢«å‘ç°æ˜¯çˆ¬è™«çš„ï¼Œäººå®¶å°±ä¼šæŠŠä½ çš„IPç»™å°æ‰çš„ æŸ¥çœ‹è¿è¡Œå·¥ä½œ æŸ¥çœ‹çˆ¬å–ä¸‹æ¥çš„å†…å®¹ ç„¶åå†æœ¬åœ°æ•°æ®åº“GUIè½¯ä»¶ä¸ŠæŸ¥è¯¢ä¸‹å°±å¯ä»¥çœ‹åˆ°æ•°æ®å·²ç»ä¿å­˜åˆ°æœ¬åœ°äº†ã€‚ è‡ªå·±éœ€è¦ç”¨çš„è¯å°±å¯ä»¥å¯¼å…¥å‡ºæ¥äº†ã€‚ åœ¨å¼€å¤´æˆ‘å°±å‘Šè¯‰å¤§å®¶çˆ¬è™«çš„ä»£ç äº†ï¼Œå¦‚æœè¯¦ç»†çš„çœ‹çœ‹é‚£ä¸ªprojectï¼Œä½ å°±ä¼šæ‰¾åˆ°æˆ‘ä¸Šä¼ çš„çˆ¬å–æ•°æ®äº†ã€‚ï¼ˆä»…ä¾›å­¦ä¹ ä½¿ç”¨ï¼Œåˆ‡å‹¿å•†ç”¨ï¼ï¼‰ å½“ç„¶ä½ è¿˜ä¼šçœ‹åˆ°å…¶ä»–çš„çˆ¬è™«ä»£ç çš„äº†ï¼Œå¦‚æœä½ è§‰å¾—ä¸é”™å¯ä»¥ç»™ä¸ª Starï¼Œæˆ–è€…ä½ ä¹Ÿæ„Ÿå…´è¶£çš„è¯ï¼Œä½ å¯ä»¥forkæˆ‘çš„é¡¹ç›®ï¼Œå’Œæˆ‘ä¸€èµ·å­¦ä¹ ï¼Œè¿™ä¸ªé¡¹ç›®é•¿æœŸæ›´æ–°ä¸‹å»ã€‚ æœ€åï¼š ä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869# created by 10412# !/usr/bin/env python# -*- encoding: utf-8 -*-# Created on 2016-10-20 20:43:00# Project: V2EXfrom pyspider.libs.base_handler import *import reimport randomimport MySQLdbclass Handler(BaseHandler): crawl_config = &#123; &#125; def __init__(self): self.db = MySQLdb.connect(&apos;localhost&apos;, &apos;root&apos;, &apos;root&apos;, &apos;wenda&apos;, charset=&apos;utf8&apos;) def add_question(self, title, content): try: cursor = self.db.cursor() sql = &apos;insert into question(title, content, user_id, created_date, comment_count) values (&quot;%s&quot;,&quot;%s&quot;,%d, %s, 0)&apos; % (title, content, random.randint(1, 10) , &apos;now()&apos;); print sql cursor.execute(sql) print cursor.lastrowid self.db.commit() except Exception, e: print e self.db.rollback() @every(minutes=24 * 60) def on_start(self): self.crawl(&apos;https://www.v2ex.com/&apos;, callback=self.index_page, validate_cert=False) @config(age=10 * 24 * 60 * 60) def index_page(self, response): for each in response.doc(&apos;a[href^=&quot;https://www.v2ex.com/?tab=&quot;]&apos;).items(): self.crawl(each.attr.href, callback=self.tab_page, validate_cert=False) @config(age=10 * 24 * 60 * 60) def tab_page(self, response): for each in response.doc(&apos;a[href^=&quot;https://www.v2ex.com/go/&quot;]&apos;).items(): self.crawl(each.attr.href, callback=self.board_page, validate_cert=False) @config(age=10 * 24 * 60 * 60) def board_page(self, response): for each in response.doc(&apos;a[href^=&quot;https://www.v2ex.com/t/&quot;]&apos;).items(): url = each.attr.href if url.find(&apos;#reply&apos;)&gt;0: url = url[0:url.find(&apos;#&apos;)] self.crawl(url, callback=self.detail_page, validate_cert=False) for each in response.doc(&apos;a.page_normal&apos;).items(): self.crawl(each.attr.href, callback=self.board_page, validate_cert=False) @config(priority=2) def detail_page(self, response): title = response.doc(&apos;h1&apos;).text() content = response.doc(&apos;div.topic_content&apos;).html().replace(&apos;&quot;&apos;, &apos;\\\\&quot;&apos;) self.add_question(title, content) #æ’å…¥æ•°æ®åº“ return &#123; &quot;url&quot;: response.url, &quot;title&quot;: title, &quot;content&quot;: content, &#125;","tags":[{"name":"Python","slug":"Python","permalink":"http://www.54tianzhisheng.cn/tags/Python/"},{"name":"çˆ¬è™«","slug":"çˆ¬è™«","permalink":"http://www.54tianzhisheng.cn/tags/çˆ¬è™«/"},{"name":"Pyspider","slug":"Pyspider","permalink":"http://www.54tianzhisheng.cn/tags/Pyspider/"}]},{"title":"Spring MVCç³»åˆ—æ–‡ç« ï¼ˆäºŒï¼‰ï¼šSpring MVC+Hibernate JPAæ­å»ºçš„åšå®¢ç³»ç»Ÿé¡¹ç›®ä¸­æ‰€é‡åˆ°çš„å‘","date":"2017-06-12T16:00:00.000Z","path":"2017/06/13/Spring MVC+Hibernate JPAæ­å»ºçš„åšå®¢ç³»ç»Ÿé¡¹ç›®ä¸­æ‰€é‡åˆ°çš„å‘/","text":"SpringBoot ç³»åˆ—æ–‡ç«  é¡¹ç›®ä»£ç åœ°å€ï¼šhttps://github.com/zhisheng17/springmvcæœ€è¿‘åœ¨å­¦ä¹  Spring MVC ï¼Œå…¶ä¸­åœ¨åšä¸€ä¸ªç®€å•çš„åšå®¢ç³»ç»Ÿdemoï¼Œæ˜¯ä½¿ç”¨ SpringMVC é›†æˆ Spring Data JPAï¼ˆç”± Hibernate JPA æä¾›ï¼‰ï¼Œæ¥è¿›è¡Œå¼ºå¤§çš„æ•°æ®åº“è®¿é—®ã€‚ç»“æœå…¶ä¸­é‡åˆ°çš„å‘ä¸ æ˜¯ä¸€ç‚¹ç‚¹å•Šï¼Œæˆ‘å·®ç‚¹å´©æºƒäº†ï¼Œå…¶ä¸­æœ€å¤§çš„åŸå› å°±æ˜¯ç”±äº Hibernate JPA ä¸­çš„bugäº†ï¼Œåæ­£ä¸€å¼€å§‹ è¿˜ä¸çŸ¥é“æ˜¯è¿™ä¸ªé—®é¢˜ï¼Œå¯¼è‡´æŠ˜è…¾äº†å¿«ä¸€å¤©çš„æ—¶é—´ã€‚æƒ³æƒ³éƒ½å¯æ€•å•Šã€‚ mvc-dispatch-servlet.xmlä»£ç  12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;beans xmlns=\"http://www.springframework.org/schema/beans\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:context=\"http://www.springframework.org/schema/context\" xmlns:mvc=\"http://www.springframework.org/schema/mvc\" xmlns:jpa=\"http://www.springframework.org/schema/data/jpa\" xmlns:tx=\"http://www.springframework.org/schema/tx\" xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd http://www.springframework.org/schema/data/jpa http://www.springframework.org/schema/data/jpa/spring-jpa.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd\"&gt; &lt;!--æŒ‡æ˜ controller æ‰€åœ¨åŒ…ï¼Œå¹¶æ‰«æå…¶ä¸­çš„æ³¨è§£--&gt; &lt;context:component-scan base-package=\"cn.zhisheng.controller\"/&gt; &lt;!-- é™æ€èµ„æº(jsã€imageç­‰)çš„è®¿é—® --&gt; &lt;mvc:default-servlet-handler/&gt; &lt;!-- å¼€å¯æ³¨è§£ --&gt; &lt;mvc:annotation-driven/&gt; &lt;!--ViewResolver è§†å›¾è§£æå™¨--&gt; &lt;!--ç”¨äºæ”¯æŒServletã€JSPè§†å›¾è§£æ--&gt; &lt;bean id=\"jspViewResolver\" class=\"org.springframework.web.servlet.view.InternalResourceViewResolver\"&gt; &lt;property name=\"viewClass\" value=\"org.springframework.web.servlet.view.JstlView\"/&gt; &lt;property name=\"prefix\" value=\"/WEB-INF/pages/\"/&gt; &lt;property name=\"suffix\" value=\".jsp\"/&gt; &lt;/bean&gt; &lt;!-- è¡¨ç¤ºJPA Repositoryæ‰€åœ¨çš„åŒ… --&gt; &lt;jpa:repositories base-package=\"cn.zhisheng.repository\"/&gt; &lt;bean id=\"entityManagerFactory\" class=\"org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean\"&gt; &lt;property name=\"persistenceUnitName\" value=\"defaultPersistenceUnit\"/&gt; &lt;property name=\"packagesToScan\" value=\"cn.zhisheng.model\" /&gt; &lt;property name=\"jpaVendorAdapter\"&gt; &lt;bean class=\"org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter\"/&gt; &lt;/property&gt; &lt;property name=\"jpaProperties\"&gt; &lt;props&gt; &lt;prop key=\"hibernate.connection.driver_class\"&gt;com.mysql.jdbc.Driver&lt;/prop&gt; &lt;prop key=\"hibernate.connection.url\"&gt;jdbc:mysql://localhost:3306/springdemo?useSSL=false&lt;/prop&gt; &lt;prop key=\"hibernate.connection.username\"&gt;root&lt;/prop&gt; &lt;prop key=\"hibernate.connection.password\"&gt;root&lt;/prop&gt; &lt;prop key=\"hibernate.show_sql\"&gt;false&lt;/prop&gt; &lt;prop key=\"hibernate.connection.useUnicode\"&gt;true&lt;/prop&gt; &lt;prop key=\"hibernate.connection.characterEncoding\"&gt;UTF-8&lt;/prop&gt; &lt;prop key=\"hibernate.format_sql\"&gt;true&lt;/prop&gt; &lt;prop key=\"hibernate.use_sql_comments\"&gt;true&lt;/prop&gt; &lt;prop key=\"hibernate.hbm2ddl.auto\"&gt;update&lt;/prop&gt; &lt;prop key=\"hibernate.connection.autoReconnect\"&gt;true&lt;/prop&gt; &lt;prop key=\"hibernate.dialect\"&gt;org.hibernate.dialect.MySQL5Dialect&lt;/prop&gt; &lt;prop key=\"connection.autoReconnectForPools\"&gt;true&lt;/prop&gt; &lt;prop key=\"connection.is-connection-validation-required\"&gt;true&lt;/prop&gt; &lt;prop key=\"hibernate.c3p0.validate\"&gt;true&lt;/prop&gt; &lt;prop key=\"hibernate.connection.provider_class\"&gt;org.hibernate.service.jdbc.connections.internal.C3P0ConnectionProvider&lt;/prop&gt; &lt;prop key=\"hibernate.c3p0.min_size\"&gt;5&lt;/prop&gt; &lt;prop key=\"hibernate.c3p0.max_size\"&gt;600&lt;/prop&gt; &lt;prop key=\"hibernate.c3p0.timeout\"&gt;1800&lt;/prop&gt; &lt;prop key=\"hibernate.c3p0.max_statements\"&gt;50&lt;/prop&gt; &lt;prop key=\"hibernate.c3p0.preferredTestQuery\"&gt;SELECT 1;&lt;/prop&gt; &lt;prop key=\"hibernate.c3p0.testConnectionOnCheckout\"&gt;true&lt;/prop&gt; &lt;prop key=\"hibernate.c3p0.idle_test_period\"&gt;3000&lt;/prop&gt; &lt;prop key=\"javax.persistence.validation.mode\"&gt;none&lt;/prop&gt; &lt;/props&gt; &lt;/property&gt; &lt;/bean&gt; &lt;!-- äº‹åŠ¡ç®¡ç† --&gt; &lt;bean id=\"transactionManager\" class=\"org.springframework.orm.jpa.JpaTransactionManager\"&gt; &lt;property name=\"entityManagerFactory\" ref=\"entityManagerFactory\"/&gt; &lt;/bean&gt; &lt;!-- å¼€å¯äº‹åŠ¡ç®¡ç†æ³¨è§£ --&gt; &lt;tx:annotation-driven transaction-manager=\"transactionManager\"/&gt;&lt;/beans&gt; pom.xml 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374&lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd\"&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;cn.zhisheng&lt;/groupId&gt; &lt;artifactId&gt;springmvc&lt;/artifactId&gt; &lt;packaging&gt;war&lt;/packaging&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;name&gt;springmvc Maven Webapp&lt;/name&gt; &lt;url&gt;http://maven.apache.org&lt;/url&gt; &lt;properties&gt; &lt;spring.version&gt;4.2.6.RELEASE&lt;/spring.version&gt; &lt;hibernate.version&gt;5.1.0.Final&lt;/hibernate.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.data&lt;/groupId&gt; &lt;artifactId&gt;spring-data-jpa&lt;/artifactId&gt; &lt;version&gt;1.10.1.RELEASE&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.hibernate&lt;/groupId&gt; &lt;artifactId&gt;hibernate-entitymanager&lt;/artifactId&gt; &lt;version&gt;$&#123;hibernate.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.hibernate&lt;/groupId&gt; &lt;artifactId&gt;hibernate-c3p0&lt;/artifactId&gt; &lt;version&gt;$&#123;hibernate.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.mchange&lt;/groupId&gt; &lt;artifactId&gt;c3p0&lt;/artifactId&gt; &lt;version&gt;0.9.5.2&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;javax.servlet&lt;/groupId&gt; &lt;artifactId&gt;jstl&lt;/artifactId&gt; &lt;version&gt;1.2&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;5.1.39&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;finalName&gt;springmvc&lt;/finalName&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt; &lt;configuration&gt; &lt;source&gt;1.8&lt;/source&gt; &lt;target&gt;1.8&lt;/target&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt;&lt;/project&gt; ä¸€å¼€å§‹æˆ‘æ˜¯ç”¨é»˜è®¤çš„åœ¨resourcesæ–‡ä»¶é‡Œé¢ç”Ÿæˆäº†persistence.xmlé…ç½®æ–‡ä»¶è¿›è¡Œæ•°æ®åº“é…ç½®çš„ï¼Œåæ¥ç”±äºç”¨é‚£ç§æ–¹æ³•ï¼Œç¢°åˆ°çš„é—®é¢˜æœ‰å¾ˆå¤šï¼Œè‡ªå·±æäº†å¥½å‡ ä¸ªä¸ªå°æ—¶éƒ½æ²¡å¼„å¥½ï¼Œåªå¥½æ¢ç§æ–¹æ³•ï¼Œæ²¡æƒ³åˆ°ç«Ÿç„¶è¿˜æ˜¯è¿™ç§æ•ˆæœï¼ˆæ³ªå´©ï¼‰ï¼Œçœ‹æ¥æ˜¯ä¸æ²»æ ‡ä¹Ÿä¸æ²»æœ¬ã€‚ æ— å¥ˆï¼Œåªå¥½ç¡¬åˆšäº†ï¼Œç¢°åˆ°é”™è¯¯ï¼Œç™¾åº¦+googleï¼Œçœ‹äº†å¤§é‡çš„çš„è§£å†³æ–¹æ³•ï¼Œéƒ½æ˜¯æ²¡ç”¨ï¼Œæ…¢æ…¢çš„æˆ‘æ‰€åŠ çš„jaråŒ…è¶Šæ¥è¶Šå¤šï¼Œç”¨mavenç®¡ç†çš„ä¾èµ–çš„ä¹Ÿå˜å¾—å¤šèµ·æ¥äº†ï¼Œä½†ç»ˆç©¶æ˜¯ä¸èƒ½å¤Ÿè§£å†³é—®é¢˜çš„ã€‚ å…¶å®è¿™æ—¶æˆ‘çœ‹äº†è¿™ä¹ˆå¤šçš„åšå®¢å’Œè§£å†³æ–¹æ³•ï¼Œæˆ‘å·²ç»çŸ¥é“äº†æ˜¯ Hibernate JPA çš„bugé—®é¢˜ï¼Œé€”ä¸­è‡ªå·±ä¹Ÿæ¢äº†ä¸€äº›ç‰ˆæœ¬ï¼Œè¿˜æ˜¯æ²¡èƒ½è§£å†³åŠæ³•ã€‚ æœ€ååœ¨åƒå®Œå®Œæ™šé¥­åï¼ŒåˆæŠ˜è…¾äº†å¿«ä¸‰å°æ—¶ï¼Œç»ˆäºæ‰¾åˆ°å¯é æœ‰ç”¨çš„è§£å†³æ–¹æ¡ˆäº†ã€‚ è¿è¡ŒæˆåŠŸåï¼Œæˆ‘å½“æ—¶å°±æ¿€åŠ¨èµ·æ¥äº†ã€‚é©¬ä¸¹ï¼Œè€å­ç»ˆäºå°†ä½ è§£å†³äº†ã€‚ æ‰€ä»¥åœ¨è¿™é‡Œç«‹é©¬å°±å°†è‡ªå·±è¿™æ¬¡çš„è¡€å´©å†å²çºªå½•ä¸‹æ¥ã€‚ ä¸‹é¢å†™ä¸‹é‡åˆ°çš„é—®é¢˜ï¼šï¼ˆå…¶ä¸­æœ‰äº›å¯èƒ½è¿˜ä¸è®°å¾—å†™äº†ï¼‰ java.lang.ClassNotFoundException: javax.persistence.EntityManager java.lang.NoSuchMethodError: javax.persistence.JoinColumn.foreignKey()Ljavax/persistence/ForeignKey; javax.persistence.PersistenceException: No Persistence provider for EntityManager named defaultPersistenceUnit javax.persistence.PersistenceException: No Persistence provider for EntityManager named defaultPersi java.lang.NoClassDefFoundError: org/hibernate/ejb/HibernatePersistence java.lang.NoClassDefFoundError: org/slf4j/LoggerFactory java.lang.ClassNotFoundException: org.hibernate.MappingException NoSuchMethodError: javax.persistence.xxx ç­‰ï¼Œè¿˜æœ‰å‡ ä¸ªï¼Œå¿˜è®°äº†ã€‚ã€‚ é¦–å…ˆé€šè¿‡æŠ¥é”™ä¿¡æ¯å¯ä»¥çŸ¥é“æœ‰äº›æ˜¯å› ä¸ºjaråŒ…çš„é—®é¢˜ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯å…‰æ˜¯ç¼ºå°‘jaråŒ…çš„é—®é¢˜ï¼Œå¾ˆå¤§çš„åŸ å› å°±æ˜¯å› ä¸ºjaråŒ…çš„ç‰ˆæœ¬ä¸åŒï¼Œåˆšå¥½é‚£ä¸ªjaråŒ…åˆæ˜¯æœ‰é—®é¢˜çš„ï¼ˆè‡ªèº«æœ‰bugï¼‰ã€‚ å°±æ¯”å¦‚é”™è¯¯ï¼š java.lang.NoSuchMethodError: javax.persistence.JoinColumn.foreignKey()Ljavax/persistence/ForeignKey; å°±æ˜¯å› ä¸ºJAVAEE6.0ä¸­çš„ javax.persistence.jarä¸ hibernate4.3.8ä¸­çš„hibernate-jpa-2.1-api-1.0.0.Final.jarå†²çª JoinColumn.foreignKey() was introduced with JPA 2.1, which was not implemented by Hibernate 4 until version 4.3. If youâ€™re using an older version of Hibernate 4 then try upgrading to 4.3.x. If youâ€™re already using Hibernate 4.3 then make sure youâ€™re also using JPA 2.1 to make sure the API and implementation match up. å›¾ç‰‡æ¥è‡ª : http://stackoverflow.com/questions/24588860/error-javax-persistence-joincolumn-foreignkeyljavax-persistence-foreignkey-wi I finally solved this similar problem, there was an old version(hibernate-jpa-2.0-api-1.0.0-Final.jar) in my lib folder which I guess has been preventing maven dependency from loading. So after I manually deleted it and added (hibernate-jpa-2.1-api-1.0.0-Final.jar) everything started to work. æ„æ€å¤§æ¦‚å°±æ˜¯ï¼š å› ä¸ºJAVAEE6.0ä¸­çš„ javax.persistence.jarä¸ hibernate4.3.8ä¸­çš„hibernate-jpa-2.1-api-1.0.0.Final.jarå†²çª ï¼Œæˆ‘ä»¬åœ¨pomæ–‡ä»¶ä¸‹æ·»åŠ ä¾èµ–åï¼Œç«Ÿç„¶æ²¡å‘ç°åœ¨ springmvcï¼ˆé¡¹ç›®åç§°ï¼‰\\target\\springmvcï¼ˆé¡¹ç›®åç§°ï¼‰\\WEB-INF\\lib ä¸‹çœ‹åˆ° javax.persistence.jar æ–‡ä»¶ï¼Œç»“æœç«Ÿç„¶åœ¨ springmvc\\libä¸‹æ‰¾åˆ°ä»–äº†ã€‚ è§£å†³åŠæ³•å°±æ˜¯åœ¨ pomæ–‡ä»¶å’Œ mvc-dispatcher-servlet.xml éƒ½é…ç½®å¥½çš„æƒ…å†µä¸‹ï¼Œå°† springmvc\\libä¸‹çš„ javax.persistence.jar åˆ é™¤ã€‚ æœ€åå†è¯´ä¸€å¥ï¼šThough the error drove almost crazy, hold on, you wil get smile ï¼ Fighting","tags":[{"name":"Java","slug":"Java","permalink":"http://www.54tianzhisheng.cn/tags/Java/"},{"name":"Spring","slug":"Spring","permalink":"http://www.54tianzhisheng.cn/tags/Spring/"},{"name":"Spring MVC","slug":"Spring-MVC","permalink":"http://www.54tianzhisheng.cn/tags/Spring-MVC/"},{"name":"Hibernate JPA","slug":"Hibernate-JPA","permalink":"http://www.54tianzhisheng.cn/tags/Hibernate-JPA/"},{"name":"Bootstrap","slug":"Bootstrap","permalink":"http://www.54tianzhisheng.cn/tags/Bootstrap/"},{"name":"MySQL","slug":"MySQL","permalink":"http://www.54tianzhisheng.cn/tags/MySQL/"}]},{"title":"è®°å½•ä¸‹è‡ªå·±ç¬¬ä¸€æ¬¡åé£æœºçš„æ„Ÿå—","date":"2017-06-12T16:00:00.000Z","path":"2017/06/13/feiji/","text":"å‰æå› ä¸ºå­¦æ ¡çš„åŸå› ï¼Œéœ€è¦åœ¨å¤§ä¸‰çš„æ—¶å€™å‡ºå»å®è®­å‡ ä¸ªæœˆï¼Œç„¶åé€‰æ‹©çš„æ˜¯åœ¨æ˜†å±±ï¼Œå…¬å¸è§„å®šè¦åœ¨ 2017 å¹´ 4 æœˆ 19 å·ä¹‹å‰èµ¶åˆ°ï¼Œæ‰€ä»¥æˆ‘æå‰è®¢çš„æœºç¥¨æ˜¯ 17 å·ï¼Œä¹‹æ‰€ä»¥ä¼šè®¢æœºç¥¨ï¼Œå…¶å®å¾ˆå¤§ä¸€éƒ¨åˆ†åŸå› æ˜¯ç”±äºè‡ªå·±ä¹‹å‰æ²¡æœ‰åè¿‡é£æœºï¼Œæ‰€ä»¥æƒ³ä½“éªŒä¸€ä¸‹åé£æœºçš„æ„Ÿè„šï¼ˆå˜¿å˜¿ï¼‰ï¼Œå†åŠ ä¸Šè¿™æ˜¯æœºç¥¨çš„æ·¡å­£ï¼Œæ‰€ä»¥åé£æœºçš„ä»·é’±æ¯”åšé«˜é“è¿˜ä¾¿å®œã€‚æ•´ä¸ªè¡Œç¨‹ï¼šå­¦æ ¡ â€”â€”&gt; å—æ˜Œæœºåœº â€”â€”&gt; ä¸Šæµ·è™¹æ¡¥æœºåœº â€”â€”&gt; å…¬å¸ å­¦æ ¡å‡ºå‘10 ç‚¹å·¦å³å»é£Ÿå ‚åƒäº†ä¸ªæ—©é¤ï¼Œç„¶åæ‰“åŒ…å¥½è‡ªå·±çš„è¡Œæï¼Œç”±äºç¬¬ä¸€æ¬¡åé£æœºï¼Œæ‰€ä»¥æ‰“ç®—æå‰æ—¶é—´å»æœºåœºï¼Œç„¶ååœ¨æœºåœºç†Ÿæ‚‰ç†Ÿæ‚‰ç¯å¢ƒï¼Œä¸ç„¶çš„è¯é”™è¿‡é£æœºï¼Œé‚£å°± gg äº†ã€‚å¤§æ¦‚ 11ï¼š30 äº†ï¼Œå°±æ‹–ç€è¡Œæå‡ºé—¨ï¼Œåœ¨å­¦æ ¡é—¨å£å«äº†è¾† æ»´æ»´è½¦ å»æœºåœºï¼ˆå› ä¸ºå…¬äº¤è½¦è¦åå¥½ä¹…å¹¶ä¸”å»æœºåœºçš„è·¯å¥½çƒ‚ï¼‰ï¼Œå«çš„æ»´æ»´è½¦ä»–èµ°çš„æ˜¯é«˜é€Ÿï¼Œå¾ˆå¿«ã€‚ å—æ˜Œæœºåœºä¸åˆ°åŠå°æ—¶å°±åˆ°äº†æœºåœºï¼Œé¦–å…ˆå¹²çš„äº‹å°±æ˜¯å–ç¥¨ã€‚ ç„¶åå°†è¡Œæç®±å…è´¹æ‰˜è¿ï¼ˆå°äº20å…¬æ–¤å¯å…è´¹æ‰˜è¿ï¼Œè¶…è¿‡çš„è¯é‚£å°±å‡†å¤‡å¥½ Money å§ï¼‰ï¼Œä¸€ä¸ªåŒè¡Œçš„åŒå­¦å°±è¶…é‡äº†ã€‚å¹²å®Œäº†è¿™äº›äº‹å°±æ²¡å•¥äº‹äº†ï¼Œç„¶åå°±ååœ¨å‡³å­ä¸Šçœ‹èµ·äº†æœ€è¿‘å¾ˆç«çš„ç”µè§†å‰§ã€Šäººæ°‘çš„åä¹‰ã€‹ï¼Œçš„ç¡®å¾ˆå¥½çœ‹çš„ï¼Œæ²¡çœ‹è¿‡çš„è¯ï¼Œå¯ä»¥å»çœ‹çœ‹ã€‚ å¤§æ¦‚ 13ï¼š40 æ—¶ï¼Œå‡†å¤‡è¿›ç«™äº†ï¼Œè¿™é‡Œè¦è¯´çš„å°±æ¯”è¾ƒæœ‰è¶£äº†ã€‚æˆ‘å°±å…·ä½“çš„è¯´ä¸‹ï¼š ä¸€å¼€å§‹æ’é˜Ÿï¼ˆäººä¸å¤šï¼‰ï¼Œè½®åˆ°æˆ‘ï¼ŒæŠŠæœºç¥¨å’Œèº«ä»½è¯ç»™å¥¹ï¼Œç„¶åå¯¹ç€æ‘„åƒå¤´æ‹äº†ä¸ªç…§å°±è¿›å»æ£€æŸ¥éšèº«æºå¸¦çš„ç‰©å“äº†ã€‚ è¿™é‡Œä¹‹å‰æˆ‘å°±å¬è¯´äº†ï¼šè¯´æ˜¯é£æœºä¸Šä¸èƒ½æºå¸¦æ¶²ä½“ï¼Œä¸çŸ¥é“æˆ‘ä¹¦åŒ…å¸¦çš„æ´—å‘æ¶²èƒ½ä¸èƒ½è¿‡å…³ï¼ŸåŒå­¦å’Œæˆ‘ä¹‹å‰è¿˜åœ¨ä¸€èµ·å¼€ç©ç¬‘è¯´ï¼š1ã€å¦‚æœä¸èƒ½å¸¦ï¼Œæˆ‘å°±å½“åœºä¸€å£é—·äº†å®ƒã€‚ï¼ˆè¿™ä¹Ÿè¡Œï¼Œä¸‹å›¾éšæ„æ‰¾äº†ä¸ªè¡¨æƒ…åŒ…ï¼‰ 2ã€æˆ‘å…è´¹è¯·å¤§å®¶æ´—ä¸ªå¤´ ç”µè„‘å’Œé›¨ä¼è€Œå¤–æ£€æŸ¥ ä¹¦åŒ…å’Œéšèº«æºå¸¦ç‰©å“éƒ½æ‹¿å‡ºæ¥è¿‡å®‰æ£€ äººæ‰«æï¼ˆæ£€æŸ¥çš„æŒºç»†è‡´çš„ï¼Œæ¯”ç«è½¦ä¸¥å¤šäº†ï¼‰ ç»“æœæ£€æŸ¥äººå‘˜å‘ŠçŸ¥æˆ‘ï¼šæŠŠ æ´—å‘æ¶² å’Œ ä¸¤ä¸ªèºä¸åˆ€ æ‹¿å‡ºæ¥ã€‚ï¼ˆæˆ‘å½“åœºå°±éœ‡æƒŠäº†ï¼Œæˆ‘é‚£ä¹ˆå°çš„èºä¸åˆ€éƒ½è¢«æ£€æŸ¥åˆ°äº†ï¼Œè¿™å‡ ä¹æŠŠæˆ‘çš„ä¹¦åŒ…ç»™é€è§†äº†ä¸€ä¸ªéï¼‰ ç„¶åå‘¢ï¼Œè‡ªå·±åªå¥½å°†è¿ç¦ç‰©å“éƒ½æ‹¿å‡ºæ¥ï¼Œå†æ¬¡æ£€æŸ¥å°±å¯ä»¥é€šè¿‡äº†ã€‚ èµ°è¿›å»çš„æ—¶å€™æ‹çš„ä¸€å¼ ç…§ç‰‡, ï¼ˆç”µæ¢¯å¥½é•¿ï¼Œä¸è¿‡åæ¥åœ¨ä¸Šæµ·æœºåœºä¸‹è½¦æ‰å‘ç°é‚£ä¸ªä¹Ÿè¿˜å¥½äº†ï¼‰ è¿›å»åï¼Œåˆæœ‰ä¸€ä¸ªå°çš„è¿›ç«™å®¤ï¼Œåˆåœ¨é‚£é‡Œç­‰å¾…äº†ä¼šã€‚ åˆå¼€å§‹æ£€ç¥¨ï¼Œæ£€å®Œç¥¨ååå…¬äº¤è½¦å»é£æœºä¸‹é¢ï¼ˆå› ä¸ºé£æœºåœºå¤ªå¤§ï¼Œæˆ‘åçš„é‚£æ¶é£æœºä¸æ˜¯é è¿‘ç«™å°çš„ï¼‰ ä¸Šé£æœºåä»çª—å£æ‹çš„ä¸€å¼ ç…§ç‰‡ é£æœºä¸Šçœ‹è§é£æœºçš„ç©ºå§å’Œç©ºå°‘äº†ã€‚ã€‚ï¼ˆç©ºå§å¾ˆæ¼‚äº®ï¼Œå˜»å˜»ï¼Œæ²¡æ‹ç…§ç‰‡ï¼‰ é£æœºèµ·é£çš„æ—¶å€™ï¼Œæœºèˆ±é‡Œæœ‰è¯­éŸ³æ’­æ”¾å«æˆ‘ä»¬ç³»ä¸Šå®‰å…¨å¸¦ï¼Œå¹¶ä¸”å…³é—­æ‰‹æœºï¼Œæ‰€ä»¥åé¢å°±æ²¡ç…§ç‰‡äº†ã€‚ èµ·é£æ„Ÿè§‰èµ°äº†å¥½è¿œï¼Œç„¶åçªç„¶ä¸€åŠ é€Ÿï¼Œé£æœºå°±æ…¢æ…¢çš„å‘ä¸Šé£èµ·ï¼Œæ•´ä¸ªäººé‡å¿ƒéƒ½æ˜¯å¾€åå€’çš„ã€‚ ä¸ä¸€ä¼šï¼Œé£æœºå°±é£çš„å¥½é«˜äº†ï¼Œä»çª—å£æœ›ä¸‹å»ï¼Œä¸‹é¢çš„æ„Ÿè§‰å¥½ç¾ï¼Œä¸€è·¯ä¸Šçš„é£æ™¯æ„Ÿè§‰éƒ½æŒºæ¼‚äº®çš„ï¼Œæœ‰æ—¶è¿˜å¯ä»¥çœ‹åˆ°ç™½äº‘ã€‚ å¤§æ¦‚ä¸€ä¸ªå°æ—¶åï¼Œç©ºå§æ¨ç€ä¸ªè½¦ï¼Œæä¾›ç»™æˆ‘ä»¬ç‚¹é›¶é£Ÿï¼ˆé¢åŒ…ã€é¥¼å¹²ã€æ¦¨èœï¼‰å’Œé¥®æ–™ï¼ˆæ©™æ±ã€è‹¹æœé†‹ã€çŸ¿æ³‰æ°´ã€å’–å•¡ï¼Œå¯è‡ªé€‰ä¸€æ ·ï¼Œå¯å†åŠ ä¸€æ¯ï¼‰ï¼ŒæœåŠ¡è¿˜æ˜¯æŒºè´´å¿ƒçš„ï¼Œæˆ‘åœ¨è¿™é‡Œç»™ä¸­å›½ä¸œæ–¹èˆªç©ºç‚¹ä¸ªèµã€‚ é£æœºä¸­é€”æœ‰æ—¶ä¼šé¢ ç°¸ï¼Œæœºèˆ±é‡Œè¯­éŸ³è¯´æ˜¯é‡åˆ°ç©ºæ°”æ°”æµçš„å½±å“ã€‚ï¼ˆå¤§éƒ¨åˆ†æ—¶é—´è¿˜æ˜¯å¾ˆå¥½çš„ï¼‰ è¯´è¯´é£æœºä¸‹é™çš„æ—¶å€™å§ï¼ŒåŒæ ·ï¼Œæ„Ÿè§‰å£°éŸ³å¾ˆå¤§ï¼Œè€³æœµæœ‰ç‚¹å—ä¸äº†ã€‚ä¸çŸ¥é“ç©ºå§ã€ç©ºå°‘ä»¬æ€ä¹ˆé•¿æœŸå—å¾—äº†è¿™è¿™å£°éŸ³ï¼Œé•¿æœŸä¸‹å»ï¼Œé‚£ä¼°è®¡è€³æœµéƒ½è¦å‡ºæ¯›ç—…çš„å§ï¼Ÿ ä¸Šæµ·è™¹æ¡¥æœºåœºæœºåœºç»™äººçš„æ„Ÿè§‰å¾ˆå¤§ï¼Œèµ°äº†é‚£ä¸ªç”µæ¢¯éƒ½èµ°äº†å¾ˆè¿œã€‚ å°±åªæœ‰ä¸€å¼ ç…§ç‰‡ã€‚ ç„¶åå†å»å–æˆ‘çš„è¡Œæç®±ï¼Œæœ‰ä¸ªä¸“é—¨æ¥è‡ªå—æ˜Œçš„å–è¡Œæå¤„ï¼Œè¡Œæç®±ä¸€ä¸ªçš„æ”¾åœ¨ä¼ é€å¸¦ä¸Šï¼Œè‡ªå·±æ‹¿è‡ªå·±çš„è¡Œæå‡ºå»ã€‚è¿™é‡Œæœ‰ä¸ªç–‘é—®ï¼Œå¦‚æœè¡Œæè¢«åˆ«äººæèµ°çš„è¯ï¼Œé‚£è¯¥å’‹åŠï¼Œæˆ‘çœ‹å‡ºå£éƒ½æ²¡è®¾ç½®æ£€æŸ¥è¡Œææ˜¯å¦å’Œæœ¬äººçš„åŒ¹é…ï¼Ÿ å…¬å¸å…¬å¸æå‰æœ‰å¤§å·´æ¥æ¥æˆ‘ä»¬ï¼Œåä¸Šå¤§å·´ï¼Œç„¶ååœ¨è½¦ä¸Šèººäº†ä¸‹ï¼Œå°±ç¡ç€äº†ï¼Œç›´åˆ°åˆ°è¾¾å…¬å¸ã€‚ ä½å®¿åœ°å€å’Œå…¬å¸æœ‰ç‚¹è¿œï¼Œæ‰€ä»¥ä¹°äº†è¾† æ­»é£è‡ªè¡Œè½¦ï¼Œæ–¹ä¾¿å‡ºè¡Œï¼Œè‡ªå·±å‘¨æœ«ä¹Ÿå¯ä»¥å‡ºå»ç©ç©ã€‚ æ€»ç»“ç¬¬ä¸€æ¬¡åé£æœºï¼Œæ„Ÿè§‰è¿˜æ˜¯æŒºå¥½çš„ã€‚æµç¨‹ä¹Ÿä¸å¤æ‚ï¼Œæ‰€ä»¥ä¸éº»çƒ¦ã€‚ ä¸è¿‡è‡ªå·±è¦æ³¨æ„ä¸€äº›ä¸œè¥¿ï¼š ä¸è¦æºå¸¦é£æœºä¸Šè¿ç¦ç‰©å“ï¼ˆæ¶²ä½“ã€è¶…è¿‡å¤šå¤§çš„å……ç”µå®ã€åˆ€æªç­‰ï¼‰ ä¸€å®šè¦æå‰åŠ¨èº«ï¼Œä»¥é˜²å‘ç”Ÿçªå‘äº‹ä»¶ æ³¨æ„ä¿ç®¡å¥½è‡ªå·±çš„èº«ä»½è¯ æœ€åè¿™æ˜¯æˆ‘åœ¨æˆ‘åšå®¢ä¸Šå†™çš„ç¬¬ä¸€ç¯‡éšç¬”æ–‡ç« ï¼Œä¸çŸ¥é“å’‹å†™ï¼Œå°±éšä¾¿å†™ã€‚ å› ä¸ºæ˜ŸæœŸå…­ï¼ˆæ˜¨å¤©ï¼‰å‡ºå»ç©äº†ï¼Œæ‰€ä»¥ä»Šå¤©æ—©ä¸Šèµ·æ¥å†™ä¸‹æ¥è¿™ç¯‡ï¼Œæœ‰äº›äº‹è¿˜æ˜¯å¾—èµ¶ç´§åšæ‰å»ï¼Œä¸ç„¶ä¸€ç›´æ‹–ï¼Œæ‹–ç€æ‹–ç€å°±æ²¡æœ‰æƒ³åšçš„æ¬²æœ›äº†ã€‚ å…¬å¸å‘¨å›´ç¯å¢ƒæŒºå¥½çš„ï¼Œæ°´ä¹¡ä¹‹åœ°ï¼Œæœ‰ä¸ªé˜³æ¾„æ¹–ï¼Œç››äº§å¤§é—¸èŸ¹ï¼Œå‘¨å›´çš„å¤§é—¸èŸ¹åº„ï¼Œé‚£å«ä¸€ä¸ªå­—ï¼šå¤šã€‚æœ‰ç©ºçš„æ—¶å€™æˆ‘å°½é‡å¤šå»é€›é€›ï¼Œæ‹ç‚¹ç…§ç‰‡å›æ¥ã€‚ ä»Šåä¹Ÿä¼šå¤šå†™ç‚¹éšç¬”ï¼Œè®°å½•ç”Ÿæ´»ä¸­ä¸€äº›æœ‰è¶£ä¸”å€¼å¾—çºªå¿µçš„ç‚¹æ»´ã€‚ æ„Ÿè°¢é˜…è¯»ï¼ï¼ï¼","tags":[{"name":"éšç¬”","slug":"éšç¬”","permalink":"http://www.54tianzhisheng.cn/tags/éšç¬”/"}]},{"title":"ä»å¯¹è±¡æ·±å…¥åˆ†æ Java ä¸­å®ä¾‹å˜é‡å’Œç±»å˜é‡çš„åŒºåˆ«","date":"2017-06-12T16:00:00.000Z","path":"2017/06/13/java-var/","text":"å®ä¾‹å˜é‡ å’Œ ç±»å˜é‡å±€éƒ¨å˜é‡ç‰¹ç‚¹ï¼šä½œç”¨æ—¶é—´çŸ­ï¼Œå­˜å‚¨åœ¨æ–¹æ³•çš„æ ˆå†…å­˜ä¸­ ç§ç±»ï¼š å½¢å‚ï¼šæ–¹æ³•ç­¾åä¸­å®šä¹‰çš„å±€éƒ¨å˜é‡ï¼Œç”±æ–¹æ³•è°ƒç”¨è€…è´Ÿè´£ä¸ºå…¶èµ‹å€¼ï¼Œéšæ–¹æ³•ç»“æŸè€Œæ¶ˆäº¡ æ–¹æ³•å†…çš„å±€éƒ¨å˜é‡ï¼šæ–¹æ³•å†…å®šä¹‰çš„å±€éƒ¨å˜é‡ï¼Œå¿…é¡»åœ¨æ–¹æ³•å†…å¯¹å…¶è¿›è¡Œæ˜¾ç¤ºåˆå§‹åŒ–ï¼Œä»åˆå§‹åŒ–åå¼€å§‹ç”Ÿæ•ˆï¼Œéšæ–¹æ³•ç»“æŸè€Œæ¶ˆäº¡ ä»£ç å—å†…çš„å±€éƒ¨å˜é‡ï¼šåœ¨ä»£ç å—ä¸­å®šä¹‰çš„å±€éƒ¨å˜é‡ï¼Œå¿…é¡»åœ¨ä»£ç å—ä¸­è¿›è¡Œæ˜¾ç¤ºåˆå§‹åŒ–ï¼Œä»åˆå§‹åŒ–åå¼€å§‹ç”Ÿæ•ˆï¼Œéšä»£ç å—ç»“æŸè€Œæ¶ˆäº¡ æˆå‘˜å˜é‡ç±»ä½“å†…å®šä¹‰çš„å˜é‡ï¼Œå¦‚æœè¯¥æˆå‘˜å˜é‡æ²¡æœ‰ä½¿ç”¨ static ä¿®é¥°ï¼Œé‚£è¯¥æˆå‘˜å˜é‡åˆè¢«ç§°ä¸ºéé™æ€å˜é‡æˆ–å®ä¾‹å˜é‡ï¼Œå¦‚æœä½¿ç”¨ static ä¿®é¥°ï¼Œåˆ™è¯¥æˆå‘˜å˜é‡åˆå¯è¢«ç§°ä¸ºé™æ€å˜é‡æˆ–ç±»å˜é‡ã€‚ å®ä¾‹å˜é‡å’Œç±»å˜é‡çš„å±æ€§ä½¿ç”¨ static ä¿®é¥°çš„æˆå‘˜å˜é‡æ˜¯ç±»å˜é‡ï¼Œå±äºè¯¥ç±»æœ¬èº«ï¼Œæ²¡æœ‰ä½¿ç”¨ static ä¿®é¥°çš„æˆå‘˜å˜é‡æ˜¯å®ä¾‹å˜é‡ï¼Œå±äºè¯¥ç±»çš„å®ä¾‹ï¼Œåœ¨åŒä¸€ä¸ªç±»ä¸­ï¼Œæ¯ä¸€ä¸ªç±»åªå¯¹åº”ä¸€ä¸ª Class å¯¹è±¡ï¼Œä½†æ¯ä¸ªç±»å¯ä»¥åˆ›å»ºå¤šä¸ªå¯¹è±¡ã€‚ ç”±äºåŒä¸€ä¸ª JVM å†…çš„æ¯ä¸ªç±»åªå¯¹åº”ä¸€ä¸ª CLass å¯¹è±¡ï¼Œå› æ­¤åŒä¸€ä¸ª JVM å†…çš„ä¸€ä¸ªç±»çš„ç±»å˜é‡åªéœ€è¦ä¸€å—å†…å­˜ç©ºé—´ï¼›ä½†å¯¹äºå®ä¾‹å˜é‡è€Œè¨€ï¼Œè¯¥ç±»æ¯åˆ›å»ºä¸€æ¬¡å®ä¾‹ï¼Œå°±éœ€è¦ä¸ºè¯¥å®ä¾‹å˜é‡åˆ†é…ä¸€å—å†…å­˜ç©ºé—´ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç¨‹åºä¸­åˆ›å»ºäº†å‡ ä¸ªå®ä¾‹ï¼Œå®ä¾‹å˜é‡å°±éœ€è¦å‡ å—å†…å­˜ç©ºé—´ã€‚ è¿™é‡Œæˆ‘æƒ³åˆ°ä¸€é“é¢è¯•é¢˜ç›®ï¼š 123456789101112public class A&#123; &#123; System.out.println(\"æˆ‘æ˜¯ä»£ç å—\"); &#125; static&#123; System.out.println(\"æˆ‘æ˜¯é™æ€ä»£ç å—\"); &#125; public static void main(String[] args) &#123; A a = new A(); A a1 = new A(); &#125;&#125; ç»“æœï¼š 123æˆ‘æ˜¯é™æ€ä»£ç å—æˆ‘æ˜¯ä»£ç å—æˆ‘æ˜¯ä»£ç å— é™æ€ä»£ç å—åªæ‰§è¡Œä¸€æ¬¡ï¼Œè€Œä»£ç å—æ¯åˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼Œå°±ä¼šæ‰“å°ä¸€æ¬¡ã€‚ å®ä¾‹å˜é‡çš„åˆå§‹åŒ–æ—¶æœºç¨‹åºå¯åœ¨3ä¸ªåœ°æ–¹å¯¹å®ä¾‹å˜é‡æ‰§è¡Œåˆå§‹åŒ–ï¼š å®šä¹‰å®ä¾‹å˜é‡æ—¶æŒ‡å®šåˆå§‹å€¼ éé™æ€åˆå§‹åŒ–å—ä¸­å¯¹å®ä¾‹å˜é‡æŒ‡å®šåˆå§‹å€¼ æ„é€ å™¨ä¸­å¯¹å®ä¾‹å˜é‡æŒ‡å®šåˆå§‹å€¼ ä¸Šé¢ç¬¬ä¸€ç§å’Œç¬¬äºŒç§æ–¹å¼æ¯”ç¬¬ä¸‰ç§æ–¹å¼æ›´æ—©æ‰§è¡Œï¼Œä½†ç¬¬ä¸€ã€äºŒç§æ–¹å¼çš„æ‰§è¡Œé¡ºåºä¸ä»–ä»¬åœ¨æºç¨‹åºä¸­çš„æ’åˆ—é¡ºåºç›¸åŒã€‚ åŒæ ·åœ¨ä¸Šé¢é‚£ä¸ªä»£ç ä¸ŠåŠ ä¸Šä¸€ä¸ªå˜é‡ weight çš„æˆå‘˜å˜é‡ï¼Œæˆ‘ä»¬æ¥éªŒè¯ä¸‹ä¸Šé¢çš„åˆå§‹åŒ–é¡ºåºï¼š 1ã€å®šä¹‰å®ä¾‹å˜é‡æŒ‡å®šåˆå§‹å€¼ åœ¨ éé™æ€åˆå§‹åŒ–å—å¯¹å®ä¾‹å˜é‡æŒ‡å®šåˆå§‹å€¼ ä¹‹å: 123456789101112131415public class A&#123; &#123; weight = 2.1; System.out.println(\"æˆ‘æ˜¯ä»£ç å—\"); &#125; double weight = 2.0; static&#123; System.out.println(\"æˆ‘æ˜¯é™æ€ä»£ç å—\"); &#125; public static void main(String[] args) &#123; A a = new A(); A a1 = new A(); System.out.println(a.weight); &#125;&#125; ç»“æœæ˜¯ï¼š 1234æˆ‘æ˜¯é™æ€ä»£ç å—æˆ‘æ˜¯ä»£ç å—æˆ‘æ˜¯ä»£ç å—2.0 2ã€å®šä¹‰å®ä¾‹å˜é‡æŒ‡å®šåˆå§‹å€¼ åœ¨ éé™æ€åˆå§‹åŒ–å—å¯¹å®ä¾‹å˜é‡æŒ‡å®šåˆå§‹å€¼ ä¹‹å‰: 123456789101112131415public class A&#123; double weight = 2.0; &#123; weight = 2.1; System.out.println(\"æˆ‘æ˜¯ä»£ç å—\"); &#125; static&#123; System.out.println(\"æˆ‘æ˜¯é™æ€ä»£ç å—\"); &#125; public static void main(String[] args) &#123; A a = new A(); A a1 = new A(); System.out.println(a.weight); &#125;&#125; ç»“æœä¸ºï¼š 1234æˆ‘æ˜¯é™æ€ä»£ç å—æˆ‘æ˜¯ä»£ç å—æˆ‘æ˜¯ä»£ç å—2.1 å¤§å®¶æœ‰æ²¡æœ‰è§‰å¾—å¾ˆå¥‡æ€ªï¼Ÿ æˆ‘æ¥å¥½å¥½è¯´æ¸…æ¥šä¸‹ï¼š å®šä¹‰å®ä¾‹å˜é‡æ—¶æŒ‡å®šçš„åˆå§‹å€¼ã€åˆå§‹ä»£ç å—ä¸­ä¸ºå®ä¾‹å˜é‡æŒ‡å®šåˆå§‹å€¼çš„è¯­å¥çš„åœ°ä½æ˜¯å¹³ç­‰çš„ï¼Œå½“ç»è¿‡ç¼–è¯‘å™¨å¤„ç†åï¼Œä»–ä»¬éƒ½å°†ä¼šè¢«æå–åˆ°æ„é€ å™¨ä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™æ¡è¯­å¥ double weight = 2.0; å®é™…ä¸Šä¼šè¢«åˆ†æˆå¦‚ä¸‹ 2 æ¬¡æ‰§è¡Œï¼š double weight; : åˆ›å»º Java å¯¹è±¡æ—¶ç³»ç»Ÿæ ¹æ®è¯¥è¯­å¥ä¸ºè¯¥å¯¹è±¡åˆ†é…å†…å­˜ã€‚ weight = 2.1; : è¿™æ¡è¯­å¥å°†ä¼šè¢«æå–åˆ° Java ç±»çš„æ„é€ å™¨ä¸­æ‰§è¡Œã€‚ åªè¯´åŸç†ï¼Œå¤§å®¶è‚¯å®šä¸æ€ä¹ˆä¿¡ï¼Œé‚£ä¹ˆè¿˜æœ‰æ‹¿å‡ºæºç æ¥ï¼Œè¿™æ ·æ‰æœ‰ä¿¡æœèƒ½åŠ›çš„å—ï¼Ÿæ˜¯ä¸ï¼Ÿ è¿™é‡Œæˆ‘ç›´æ¥ä½¿ç”¨è½¯ä»¶å°†ä»£ç çš„å­—èŠ‚ç æ–‡ä»¶åç¼–è¯‘è¿‡æ¥ï¼Œçœ‹çœ‹é‡Œé¢æ˜¯æ€æ ·çš„ç»„æˆï¼Ÿ ç¬¬ä¸€ä¸ªä»£ç çš„åç¼–è¯‘æºç å¦‚ä¸‹ï¼š 1234567891011121314151617181920public class A&#123; double weight; public A() &#123; this.weight = 2.1D; System.out.println(\"æˆ‘æ˜¯ä»£ç å—\"); this.weight = 2.0D; &#125; static &#123; System.out.println(\"æˆ‘æ˜¯é™æ€ä»£ç å—\"); &#125; public static void main(String[] args) &#123; A a = new A(); A a1 = new A(); System.out.println(a.weight); &#125;&#125; ç¬¬äºŒä¸ªä»£ç åç¼–è¯‘æºç å¦‚ä¸‹ï¼š 1234567891011121314151617181920public class A&#123; double weight; public A() &#123; this.weight = 2.0D; this.weight = 2.1D; System.out.println(\"æˆ‘æ˜¯ä»£ç å—\"); &#125; static &#123; System.out.println(\"æˆ‘æ˜¯é™æ€ä»£ç å—\"); &#125; public static void main(String[] args) &#123; A a = new A(); A a1 = new A(); System.out.println(a.weight); &#125;&#125; è¿™ä¸‹å­æ»¡æ„äº†å§ï¼ é€šè¿‡åç¼–è¯‘çš„æºç å¯ä»¥çœ‹åˆ°è¯¥ç±»å®šä¹‰çš„ weight å®ä¾‹å˜é‡æ—¶ä¸å†æœ‰åˆå§‹å€¼ï¼Œä¸º weight æŒ‡å®šåˆå§‹å€¼çš„ä»£ç ä¹Ÿè¢«æåˆ°äº†æ„é€ å™¨ä¸­å»äº†ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿå¯ä»¥å‘ç°ä¹‹å‰è§„åˆ™ä¹Ÿæ˜¯æ»¡è¶³çš„ã€‚ ä»–ä»¬çš„èµ‹å€¼è¯­å¥éƒ½è¢«åˆå¹¶åˆ°æ„é€ å™¨ä¸­ï¼Œåœ¨åˆå¹¶è¿‡ç¨‹ä¸­ï¼Œå®šä¹‰çš„å˜é‡è¯­å¥è½¬æ¢å¾—åˆ°çš„èµ‹å€¼è¯­å¥ï¼Œåˆå§‹ä»£ç å—ä¸­çš„è¯­å¥éƒ½è½¬æ¢å¾—åˆ°çš„èµ‹å€¼è¯­å¥ï¼Œæ€»æ˜¯ä½äºæ„é€ å™¨çš„æ‰€æœ‰è¯­å¥ä¹‹å‰ï¼Œåˆå¹¶åï¼Œä¸¤ç§èµ‹å€¼è¯­å¥çš„é¡ºåºä¹Ÿä¿æŒäº†å®ƒä»¬åœ¨ Java æºä»£ç ä¸­çš„é¡ºåºã€‚ å¤§è‡´è¿‡ç¨‹åº”è¯¥äº†è§£äº†å§ï¼Ÿå¦‚æœè¿˜ä¸æ€ä¹ˆæ¸…æ¥šçš„ï¼Œå»ºè®®è¿˜æ˜¯è‡ªå·±å°†æ€ä¸ªè¿‡ç¨‹åœ¨è‡ªå·±çš„ç”µè„‘ä¸Šæ“ä½œä¸€éï¼Œæ¯•ç«Ÿå…‰çœ‹ä¸ç»ƒå‡æŠŠå¼ã€‚ ç±»å˜é‡çš„åˆå§‹åŒ–æ—¶æœºJVM å¯¹æ¯ä¸€ä¸ª Java ç±»åªåˆå§‹åŒ–ä¸€æ¬¡ï¼Œå› æ­¤ Java ç¨‹åºæ¯è¿è¡Œä¸€æ¬¡ï¼Œç³»ç»Ÿåªä¸ºç±»å˜é‡åˆ†é…ä¸€æ¬¡å†…å­˜ç©ºé—´ï¼Œæ‰§è¡Œä¸€æ¬¡åˆå§‹åŒ–ã€‚ç¨‹åºå¯åœ¨ä¸¤ä¸ªåœ°æ–¹å¯¹ç±»å˜é‡æ‰§è¡Œåˆå§‹åŒ–ï¼š å®šä¹‰ç±»å˜é‡æ—¶æŒ‡å®šåˆå§‹å€¼ é™æ€åˆå§‹åŒ–ä»£ç å—ä¸­å¯¹ç±»å˜é‡æŒ‡å®šåˆå§‹å€¼ è¿™ä¸¤ç§æ–¹å¼çš„æ‰§è¡Œé¡ºåºä¸å®ƒä»¬åœ¨æºä»£ç ä¸­çš„æ’åˆ—é¡ºåºç›¸åŒã€‚ è¿˜æ˜¯ç”¨ä¸Šé¢é‚£ä¸ªç¤ºä¾‹ï¼Œæˆ‘ä»¬åœ¨å…¶åŸºç¡€ä¸ŠåŠ ä¸ªè¢« static ä¿®é¥°çš„å˜é‡ heightï¼š 1ã€å®šä¹‰ç±»å˜é‡æ—¶æŒ‡å®šåˆå§‹å€¼ åœ¨ é™æ€åˆå§‹åŒ–ä»£ç å—ä¸­å¯¹ç±»å˜é‡æŒ‡å®šåˆå§‹å€¼ ä¹‹åï¼š 123456789101112131415161718public class A&#123; double weight = 2.0; &#123; weight = 2.1; System.out.println(\"æˆ‘æ˜¯ä»£ç å—\"); &#125; static&#123; height = 10.1; System.out.println(\"æˆ‘æ˜¯é™æ€ä»£ç å—\"); &#125; static double height = 10.0; public static void main(String[] args) &#123; A a = new A(); A a1 = new A(); System.out.println(a.weight); System.out.println(height); &#125;&#125; è¿è¡Œç»“æœï¼š 12345æˆ‘æ˜¯é™æ€ä»£ç å—æˆ‘æ˜¯ä»£ç å—æˆ‘æ˜¯ä»£ç å—2.110.0 2ã€å®šä¹‰ç±»å˜é‡æ—¶æŒ‡å®šåˆå§‹å€¼ åœ¨ é™æ€åˆå§‹åŒ–ä»£ç å—ä¸­å¯¹ç±»å˜é‡æŒ‡å®šåˆå§‹å€¼ ä¹‹å‰ï¼š 123456789101112131415161718public class A&#123; static double height = 10.0; double weight = 2.0; &#123; weight = 2.1; System.out.println(\"æˆ‘æ˜¯ä»£ç å—\"); &#125; static&#123; height = 10.1; System.out.println(\"æˆ‘æ˜¯é™æ€ä»£ç å—\"); &#125; public static void main(String[] args) &#123; A a = new A(); A a1 = new A(); System.out.println(a.weight); System.out.println(height); &#125;&#125; è¿è¡Œç»“æœï¼š 12345æˆ‘æ˜¯é™æ€ä»£ç å—æˆ‘æ˜¯ä»£ç å—æˆ‘æ˜¯ä»£ç å—2.110.1 å…¶è¿è¡Œç»“æœæ­£å¦‚æˆ‘ä»¬é¢„æ–™ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯çœ‹çœ‹åç¼–è¯‘åçš„ä»£ç å§ï¼ ç¬¬ä¸€ç§æƒ…å†µä¸‹åç¼–è¯‘çš„ä»£ç ï¼š 1234567891011121314151617181920212223public class A&#123; double weight; public A() &#123; this.weight = 2.0D; this.weight = 2.1D; System.out.println(\"æˆ‘æ˜¯ä»£ç å—\"); &#125; static &#123; System.out.println(\"æˆ‘æ˜¯é™æ€ä»£ç å—\"); &#125; static double height = 10.0D; public static void main(String[] args) &#123; A a = new A(); A a1 = new A(); System.out.println(a.weight); System.out.println(height); &#125;&#125; ç¬¬äºŒç§æƒ…å†µä¸‹åç¼–è¯‘çš„ä»£ç ï¼š 123456789101112131415161718192021222324public class A&#123; static double height = 10.0D; double weight; public A() &#123; this.weight = 2.0D; this.weight = 2.1D; System.out.println(\"æˆ‘æ˜¯ä»£ç å—\"); &#125; static &#123; height = 10.1D; System.out.println(\"æˆ‘æ˜¯é™æ€ä»£ç å—\"); &#125; public static void main(String[] args) &#123; A a = new A(); A a1 = new A(); System.out.println(a.weight); System.out.println(height); &#125;&#125; é€šè¿‡åç¼–è¯‘æºç ï¼Œå¯ä»¥çœ‹åˆ°ç¬¬ä¸€ç§æƒ…å†µä¸‹(å®šä¹‰ç±»å˜é‡æ—¶æŒ‡å®šåˆå§‹å€¼ åœ¨ é™æ€åˆå§‹åŒ–ä»£ç å—ä¸­å¯¹ç±»å˜é‡æŒ‡å®šåˆå§‹å€¼ ä¹‹å): æˆ‘ä»¬åœ¨ é™æ€åˆå§‹åŒ–ä»£ç å—ä¸­å¯¹ç±»å˜é‡æŒ‡å®šåˆå§‹å€¼ å·²ç»ä¸å­˜åœ¨äº†ï¼Œåªæœ‰ä¸€ä¸ªç±»å˜é‡æŒ‡å®šçš„åˆå§‹å€¼ static double height = 10.0D; , è€Œåœ¨ç¬¬äºŒç§æƒ…å†µä¸‹ï¼ˆå®šä¹‰ç±»å˜é‡æ—¶æŒ‡å®šåˆå§‹å€¼ åœ¨ é™æ€åˆå§‹åŒ–ä»£ç å—ä¸­å¯¹ç±»å˜é‡æŒ‡å®šåˆå§‹å€¼ ä¹‹å‰ï¼‰å’Œä¹‹å‰çš„æºä»£ç é¡ºåºæ˜¯ä¸€æ ·çš„ï¼Œæ²¡å•¥åŒºåˆ«ã€‚ ä¸Šé¢çš„ä»£ç ä¸­å……åˆ†çš„å±•ç¤ºäº†ç±»å˜é‡çš„ä¸¤ç§åˆå§‹åŒ–æ–¹å¼ ï¼šæ¯æ¬¡è¿è¡Œè¯¥ç¨‹åºæ—¶ï¼Œç³»ç»Ÿä¼šä¸º A ç±»æ‰§è¡Œåˆå§‹åŒ–ï¼Œå…ˆä¸ºæ‰€æœ‰ç±»å˜é‡åˆ†é…å†…å­˜ç©ºé—´ï¼Œå†æŒ‰ç…§æºä»£ç ä¸­çš„æ’åˆ—é¡ºåºæ‰§è¡Œé™æ€åˆå§‹ä»£ç å—ä¸­æ‰€æŒ‡å®šçš„åˆå§‹å€¼å’Œå®šä¹‰ç±»å˜é‡æ—¶æ‰€æŒ‡å®šçš„åˆå§‹å€¼ã€‚","tags":[{"name":"Java","slug":"Java","permalink":"http://www.54tianzhisheng.cn/tags/Java/"}]},{"title":"Javaè¯»å–æ–‡ä»¶","date":"2017-06-12T16:00:00.000Z","path":"2017/06/13/javaè¯»å–æ–‡ä»¶/","text":"ä»¥å­—èŠ‚ä¸ºå•ä½è¯»å–æ–‡ä»¶ ä»¥å­—ç¬¦ä¸ºå•ä½è¯»å–æ–‡ä»¶ ä»¥è¡Œä¸ºå•ä½è¯»å–æ–‡ä»¶ éšæœºè¯»å–æ–‡ä»¶å†…å®¹ ReadFromFile.java123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263package cn.zhisheng.io;import java.io.*;/** * javaè¯»å–æ–‡ä»¶ * Created by 10412 on 2016/12/29. */public class ReadFromFile&#123; /** * ä»¥å­—èŠ‚ä¸ºå•ä½è¯»å–æ–‡ä»¶ï¼Œå¸¸ç”¨äºè¯»äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¦‚å›¾ç‰‡ã€å£°éŸ³ã€å½±åƒç­‰æ–‡ä»¶ * @param fileName æ–‡ä»¶å */ public static void readFileByBytes(String fileName) &#123; File file = new File(fileName); InputStream in = null; try &#123; System.out.println(\"ä»¥å­—èŠ‚ä¸ºå•ä½è¯»å–æ–‡ä»¶å†…å®¹ï¼Œä¸€æ¬¡è¯»å–ä¸€ä¸ªå­—èŠ‚\"); //ä¸€æ¬¡è¯»ä¸€ä¸ªå­—èŠ‚ in = new FileInputStream(file); int tempbyte; while ((tempbyte = in.read()) != -1) &#123; System.out.println(tempbyte); &#125; in.close(); &#125; catch (FileNotFoundException e) &#123; e.printStackTrace(); &#125; catch (IOException e) &#123; e.printStackTrace(); return; &#125; try &#123; System.out.println(\"ä»¥å­—èŠ‚ä¸ºå•ä½è¯»å–æ–‡ä»¶å†…å®¹ï¼Œä¸€æ¬¡è¯»å–å¤šä¸ªå­—èŠ‚\"); //ä¸€æ¬¡è¯»å–å¤šä¸ªå­—èŠ‚ byte[] tempbytes = new byte[100]; int byteread = 0; in = new FileInputStream(fileName); ReadFromFile.showAvailableBytes(in); // è¯»å…¥å¤šä¸ªå­—èŠ‚åˆ°å­—èŠ‚æ•°ç»„ä¸­ï¼Œbytereadä¸ºä¸€æ¬¡è¯»å…¥çš„å­—èŠ‚æ•° while ((byteread = in.read(tempbytes)) != -1) &#123; System.out.write(tempbytes, 0, byteread); &#125; &#125; catch (FileNotFoundException e) &#123; e.printStackTrace(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125;finally &#123; if (in != null) &#123; try &#123; in.close(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125; /** * ä»¥å­—ç¬¦ä¸ºå•ä½è¯»å–æ–‡ä»¶ï¼Œå¸¸ç”¨äºè¯»æ–‡æœ¬ï¼Œæ•°å­—ç­‰ç±»å‹çš„æ–‡ä»¶ * @param fileName æ–‡ä»¶å */ public static void readFileByChars(String fileName) &#123; File file = new File(fileName); Reader reader = null; try &#123; System.out.println(\"ä»¥å­—ç¬¦ä¸ºå•ä½è¯»å–æ–‡ä»¶å†…å®¹ï¼Œä¸€æ¬¡è¯»ä¸€ä¸ªå­—ç¬¦ï¼š\"); // ä¸€æ¬¡è¯»ä¸€ä¸ªå­—ç¬¦ reader = new InputStreamReader(new FileInputStream(file)); int tempchar; while ((tempchar = reader.read()) != -1) &#123; // å¯¹äºwindowsä¸‹ï¼Œ\\r\\nè¿™ä¸¤ä¸ªå­—ç¬¦åœ¨ä¸€èµ·æ—¶ï¼Œè¡¨ç¤ºä¸€ä¸ªæ¢è¡Œã€‚ // ä½†å¦‚æœè¿™ä¸¤ä¸ªå­—ç¬¦åˆ†å¼€æ˜¾ç¤ºæ—¶ï¼Œä¼šæ¢ä¸¤æ¬¡è¡Œã€‚ // å› æ­¤ï¼Œå±è”½æ‰\\rï¼Œæˆ–è€…å±è”½\\nã€‚å¦åˆ™ï¼Œå°†ä¼šå¤šå‡ºå¾ˆå¤šç©ºè¡Œã€‚ if (((char)tempchar) != '\\r') &#123; System.out.print((char) tempchar); &#125; &#125; reader.close(); &#125; catch (FileNotFoundException e) &#123; e.printStackTrace(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; try &#123; System.out.println(\"ä»¥å­—ç¬¦ä¸ºå•ä½è¯»å–æ–‡ä»¶å†…å®¹ï¼Œä¸€æ¬¡è¯»å¤šä¸ªå­—ç¬¦ï¼š\"); //ä¸€æ¬¡è¯»å¤šä¸ªå­—ç¬¦ char[] tempchars = new char[30]; int charread = 0; reader = new InputStreamReader(new FileInputStream(fileName)); // è¯»å…¥å¤šä¸ªå­—ç¬¦åˆ°å­—ç¬¦æ•°ç»„ä¸­ï¼Œcharreadä¸ºä¸€æ¬¡è¯»å–å­—ç¬¦æ•° while ((charread = reader.read(tempchars)) != -1) &#123; // åŒæ ·å±è”½æ‰\\rä¸æ˜¾ç¤º if ((charread == tempchars.length) &amp;&amp; (tempchars[tempchars.length - 1]) != '\\r') &#123; System.out.print(tempchars); &#125; else &#123; for (int i = 0; i &lt; charread; i++ ) &#123; if (tempchars[i] == '\\r') &#123; continue; &#125; else &#123; System.out.print(tempchars[i]); &#125; &#125; &#125; &#125; &#125; catch (FileNotFoundException e) &#123; e.printStackTrace(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125;finally &#123; if (reader != null) &#123; try &#123; reader.close(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125; /** * ä»¥è¡Œä¸ºå•ä½è¯»å–æ–‡ä»¶ï¼Œå¸¸ç”¨äºè¯»é¢å‘è¡Œçš„æ ¼å¼åŒ–æ–‡ä»¶ * @param fileName æ–‡ä»¶å */ public static void readFileByLines(String fileName) &#123; File file = new File(fileName); BufferedReader reader =null; try &#123; System.out.println(\"ä»¥è¡Œä¸ºå•ä½è¯»å–æ–‡ä»¶å†…å®¹ï¼Œä¸€æ¬¡è¯»ä¸€æ•´è¡Œï¼š\"); reader = new BufferedReader(new FileReader(file)); String tempString = null; int line = 1; // ä¸€æ¬¡è¯»å…¥ä¸€è¡Œï¼Œç›´åˆ°è¯»å…¥nullä¸ºæ–‡ä»¶ç»“æŸ while ((tempString = reader.readLine()) != null) &#123; // æ˜¾ç¤ºè¡Œå· System.out.println(\"line \"+line+\": \"+tempString); line++; &#125; &#125; catch (FileNotFoundException e) &#123; e.printStackTrace(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125;finally &#123; if (reader != null) &#123; try &#123; reader.close(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125; /** * éšæœºè¯»å–æ–‡ä»¶å†…å®¹ * @param fileName æ–‡ä»¶å */ public static void readFileBRandomAccess(String fileName) &#123; RandomAccessFile randomFile = null; try &#123; System.out.println(\"éšæœºè¯»å–ä¸€æ®µæ–‡ä»¶å†…å®¹ï¼š\"); // æ‰“å¼€ä¸€ä¸ªéšæœºè®¿é—®æ–‡ä»¶æµï¼ŒæŒ‰åªè¯»æ–¹å¼ randomFile = new RandomAccessFile(fileName, \"r\"); // æ–‡ä»¶é•¿åº¦ï¼Œå­—èŠ‚æ•° long fileLength = randomFile.length(); // è¯»æ–‡ä»¶çš„èµ·å§‹ä½ç½® int beginIndex = (fileLength &gt; 4) ? 4 : 0; // å°†è¯»æ–‡ä»¶çš„å¼€å§‹ä½ç½®ç§»åˆ°beginIndexä½ç½® randomFile.seek(beginIndex); byte[] bytes = new byte[10]; int byteread = 0; // ä¸€æ¬¡è¯»10ä¸ªå­—èŠ‚ï¼Œå¦‚æœæ–‡ä»¶å†…å®¹ä¸è¶³10ä¸ªå­—èŠ‚ï¼Œåˆ™è¯»å‰©ä¸‹çš„å­—èŠ‚ã€‚ // å°†ä¸€æ¬¡è¯»å–çš„å­—èŠ‚æ•°èµ‹ç»™byteread while ((byteread = randomFile.read(bytes)) != -1) &#123; System.out.write(bytes, 0, byteread); &#125; &#125; catch (FileNotFoundException e) &#123; e.printStackTrace(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125;finally &#123; if (randomFile != null) try &#123; randomFile.close(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; &#125; /** * æ˜¾ç¤ºè¾“å…¥æµä¸­å‰©ä½™çš„å­—èŠ‚æ•° * @param in */ public static void showAvailableBytes(InputStream in) &#123; try &#123; System.out.println(\"å½“å‰å­—èŠ‚æµè¾“å…¥æµä¸­å‰©ä½™çš„å­—èŠ‚æ•°ä¸º:\"+in.available()); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; public static void main(String[] args) &#123; String fileName = \"C:\\\\Users\\\\10412\\\\Desktop\\\\1.txt\"; //æ–‡æœ¬æ–‡ä»¶ //String fileName = \"C:\\\\Users\\\\10412\\\\Desktop\\\\sp20161227_204413.png\"; //å›¾ç‰‡æ–‡ä»¶ //readFileByBytes(fileName); //readFileByChars(fileName); //readFileByLines(fileName); readFileBRandomAccess(fileName); &#125;&#125; æ–‡ä»¶è¿½åŠ å†…å®¹AppendToFile.java12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576package cn.zhisheng.io;import java.io.FileNotFoundException;import java.io.FileWriter;import java.io.IOException;import java.io.RandomAccessFile;/** * è¿½åŠ å†…å®¹åˆ°æ–‡ä»¶å°¾éƒ¨ * Created by 10412 on 2016/12/29. */public class AppendToFile&#123; /** * ç¬¬ä¸€ç§æ–¹æ³•è¿½åŠ æ–‡ä»¶ï¼šä½¿ç”¨RandomAccessFile * @param fileName æ–‡ä»¶å * @param content è¿½åŠ å†…å®¹ */ public static void appendMethod1(String fileName, String content) &#123; try &#123; // æ‰“å¼€ä¸€ä¸ªéšæœºè®¿é—®æ–‡ä»¶æµï¼ŒæŒ‰è¯»å†™æ–¹å¼ RandomAccessFile randomFile = new RandomAccessFile(fileName, \"rw\"); // æ–‡ä»¶é•¿åº¦ï¼Œå­—èŠ‚æ•° long fileLength = randomFile.length(); //å°†å†™æ–‡ä»¶æŒ‡é’ˆç§»åˆ°æ–‡ä»¶å°¾ randomFile.seek(fileLength); randomFile.writeBytes(content); randomFile.close(); &#125; catch (FileNotFoundException e) &#123; e.printStackTrace(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; /** * ç¬¬äºŒç§æ–¹æ³•è¿½åŠ æ–‡ä»¶ï¼šä½¿ç”¨FileWriter * @param fileName æ–‡ä»¶å * @param content è¿½åŠ å†…å®¹ */ public static void appendMethod2(String fileName, String content) &#123; try &#123; //æ‰“å¼€ä¸€ä¸ªå†™æ–‡ä»¶å™¨ï¼Œæ„é€ å‡½æ•°ä¸­çš„ç¬¬äºŒä¸ªå‚æ•°trueè¡¨ç¤ºä»¥è¿½åŠ å½¢å¼å†™æ–‡ä»¶ FileWriter writer = new FileWriter(fileName, true); writer.write(content); writer.close(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; public static void main(String[] args) &#123; String fileName = \"C:\\\\Users\\\\10412\\\\Desktop\\\\1.txt\"; //æ–‡æœ¬æ–‡ä»¶ String content = \"new append!\"; //æŒ‰æ–¹æ³•1è¿½åŠ æ–‡ä»¶// AppendToFile.appendMethod1(fileName, content);// AppendToFile.appendMethod1(fileName, \"\\new append. ç¬¬ä¸€ç§æ–¹æ³•\\n\"); //æŒ‰ç…§æ–¹æ³•2è¿½åŠ æ–‡ä»¶ AppendToFile.appendMethod2(fileName, content); AppendToFile.appendMethod2(fileName, \"\\nnew append. ç¬¬äºŒç§æ–¹æ³•\\n\"); //æ˜¾ç¤ºæ–‡ä»¶å†…å®¹ ReadFromFile.readFileByLines(fileName); &#125;&#125;","tags":[{"name":"Java","slug":"Java","permalink":"http://www.54tianzhisheng.cn/tags/Java/"},{"name":"æ–‡ä»¶","slug":"æ–‡ä»¶","permalink":"http://www.54tianzhisheng.cn/tags/æ–‡ä»¶/"}]},{"title":"åˆ©ç”¨Github Page æ­å»ºä¸ªäººåšå®¢ç½‘ç«™","date":"2017-06-12T16:00:00.000Z","path":"2017/06/13/åˆ©ç”¨Github Page æ­å»ºä¸ªäººåšå®¢ç½‘ç«™/","text":"å‰è¨€æœ€è¿‘è¿™å‡ å¤©ï¼Œæ²¡äº‹å¹²ï¼Œæƒ³æ‰¾ç‚¹äº‹æŠ˜è…¾ä¸‹ï¼Œäºæ˜¯è‡ªå·±ä¾¿æƒ³åˆ°äº†è‡ªå·±ä¸€ç›´æƒ³å¹²çš„ä¸€ä»¶äº‹ï¼šæ­å»ºä¸€ä¸ªå±äºè‡ªå·±çš„åšå®¢ç½‘ç«™ã€‚ç›®å‰æ­å»ºä¸ªäºº blog ç½‘ç«™æœ€å¥½çš„æ˜¯ç”¨ wordpress ï¼Œä½†æ˜¯é‚£ä¸ªæŠ˜è…¾èµ·æ¥å¥½åƒè¿˜æŒºéº»çƒ¦çš„ï¼Œå†åŠ ä¸Šè¿˜éœ€è¦è‡ªå·±ä¿®æ”¹äº›å‰ç«¯ä»£ç å’Œç”¨ PHP åšï¼ˆè™½ç„¶æˆ‘å­¦äº†å‡ å¤©æ‹é»„ç‰‡ï¼Œä½†æ˜¯æ—©å·²å¿˜äº†ï¼‰ï¼Œç„¶åå°±æ˜¯ç”¨ Github Page å§ï¼Œè‡ªå·±ä¹Ÿä¸€ç›´åœ¨è¿™ä¸ªæœ€å¤§çš„äº¤å‹ç½‘ç«™è£… X ã€‚æƒ³æƒ³å°±ç”¨è¿™ä¸ªå§ï¼ˆåæ¥å¥½åƒè§‰å¾—è¿™ä¸ªè¿˜æŒºçœäº‹çš„ï¼‰ å†è¯´è¯´æ‹¥æœ‰ä¸ªäººåšå®¢ç½‘ç«™çš„å¥½å¤„å§ï¼š è£… Xï¼ˆå¦‚æœç½‘ç«™å¤Ÿç‚«ï¼‰ å¾ˆå¥½çš„ç”¨æ¥æ€»ç»“è‡ªå·±æ‰€å­¦çš„çŸ¥è¯† é¢è¯•åŠ åˆ†ï¼ˆåœ¨ç®€å†ä¸Šæ”¾ä¸Šè‡ªå·±çš„ä¸ªäººç½‘ç«™é“¾æ¥ï¼Œé¢è¯•å®˜å°±å¯ä»¥æ›´å¥½çš„äº†è§£ä½ ï¼ŒçŸ¥é“ä½ æ‰€å­¦çŸ¥è¯†çš„æ·±åº¦å’Œå¹¿åº¦ï¼‰ ä¸å†å—å…¶ä»–åšå®¢å¹³å°çš„è§„åˆ™æ‰€æŸç¼š å¦‚æœä½ ç°åœ¨è¿˜æ²¡æœ‰è‡ªå·±ä¸ªäººåšå®¢ç½‘ç«™çš„è¯ï¼Œé‚£ä¹ˆæˆ‘è§‰å¾—ä½ çœ‹å®Œæœ¬ç¯‡åšå®¢åï¼Œå¼ºçƒˆçš„å»ºè®®ä½ å»æŠ˜è…¾æŠ˜è…¾ä¸‹ï¼Œæä¸ªè‡ªå·±çš„ï¼Œè®©è‡ªå·±ä¹Ÿèƒ½å¤Ÿä½“éªŒè£… X çš„æ„Ÿè§‰ã€‚ è¦æƒ³ç”¨æ­å»ºä¸€ä¸ªä¸ªäººåšå®¢ç½‘ç«™ï¼Œé¦–å…ˆä½ å¾—æœ‰ä¸€ä¸ªåŸŸåï¼Œè¿™æ ·åˆ«äººæ‰å¯ä»¥é€šè¿‡åŸŸåè®¿é—®ï¼Œå…¶æ¬¡ä½ è¿˜è¦ä¸€ä¸ªç©ºé—´æ¥å­˜æ”¾ä½ çš„é¡µé¢ã€‚ åŸŸå åŸŸåçš„è¯ï¼Œä½ å¯ä»¥åœ¨ä¸‡ç½‘ã€é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ç­‰æ³¨å†Œï¼Œæˆ‘çš„åŸŸå www.54tianzhisheng.cn å°±æ˜¯åœ¨è…¾è®¯äº‘æ³¨å†Œçš„ï¼Œè®°å¾—æ˜¯è…¾è®¯äº‘ä¸€å…ƒé’±ï¼ˆä¸€ä¸ªåŸŸå+ä¸»æœºï¼‰æçš„ï¼Œè¿™æ˜¯è…¾è®¯äº‘å¯¹å­¦ç”Ÿæ‰æœ‰è¿™ä¼˜æƒ ã€‚ .cn çš„åŸŸåéœ€è¦å¤‡æ¡ˆï¼Œå¤‡æ¡ˆçš„å®¡æ ¸é€Ÿåº¦æˆ‘è§‰å¾—è¿˜æ˜¯æŒºå¿«çš„ï¼Œè¿˜éœ€è¦ä¸Šä¼ è¯ä»¶ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥ä¹°å…¶ä»–çš„é‚£äº›ä¸éœ€è¦å¤‡æ¡ˆçš„åŸŸåï¼Œçœå¾—éº»çƒ¦äº‹ã€‚ ç©ºé—´ ç©ºé—´æœ‰å…è´¹çš„ç©ºé—´ï¼Œä¹Ÿæœ‰æ”¶è´¹çš„ç©ºé—´ã€‚å…è´¹çš„å½“ç„¶å°±ä¸å¤Ÿç¨³å®šäº†ï¼Œæ”¶è´¹çš„å°±å¾ˆè´µäº†ï¼Œç»ˆç©¶æ˜¯å¾ˆä¸çˆ½ï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆåœ°æ–¹æ˜¯æ—¢å…è´¹åˆç¨³å®šçš„ç©ºé—´å‘¢ï¼Ÿæœ‰ï¼ŒGithub ã€‚å®ƒå…è®¸ä¸Šä¼ ä¸ªäººç½‘ç«™é¡¹ç›®å¹¶è‡ªå®šä¹‰ä½ çš„åŸŸåï¼Œè€Œä¸”åˆæœ‰ç¨³å®šçš„æœåŠ¡ï¼Œå®åœ¨æ˜¯ä¸èƒ½å¤Ÿåœ¨å¥½äº†ã€‚ ä¸‹é¢å°±ä¸€èµ·è·Ÿç€æˆ‘æ¥ä¸€æ­¥ä¸€æ­¥çš„åˆ©ç”¨ Github æ­å»ºä¸ªäººåšå®¢ç½‘ç«™å§ï¼ 1. æ‹¥æœ‰ä¸€ä¸ªåŸŸåè¿™ä¸ªæ­¥éª¤æˆ‘å°±ä¸è¯¦è¿°äº†ã€‚ ä¸¾ä¾‹ï¼š æ‰“å¼€è…¾è®¯äº‘å®˜ç½‘ æœç´¢ä½ æƒ³è¦çš„åŸŸåï¼Œä¸‹å•ä¹°ä¸€ä¸ª 2. æ‹¥æœ‰ä¸€ä¸ª Githubè´¦å·äº’è”ç½‘å´‡å°šè‡ªç”±ä¸åˆ†äº«ã€‚Github æ˜¯ä¸€ä¸ªå…¨ä¸–ç•Œç¨‹åºå‘˜èšé›†çš„åœ°æ–¹ï¼Œå¤§å®¶ç›¸äº’åˆ†äº«è‡ªå·±å†™çš„ä»£ç ï¼Œæå‡åˆ«äººï¼Œä¹Ÿæå‡è‡ªå·±ã€‚å¤§å®¶éƒ½åœ¨ä¸ºç€å¼€æºç¤¾åŒºåŠªåŠ›ç€ã€‚å› ä¸ºæˆ‘ä»å¼€æºé¡¹ç›®ä¸­å­¦åˆ°å¾ˆå¤šçŸ¥è¯†ï¼Œæ‰€ä»¥æˆ‘ä¹Ÿéå¸¸æ„¿æ„åˆ†äº«æˆ‘çš„æ‰€è§æ‰€å­¦æ‰€å¾—ï¼Œæˆ‘çš„ Github ä¸»é¡µï¼šhttps://github.com/zhisheng17 ï¼ˆæ¬¢è¿ follow å’Œå¯¹æˆ‘çš„é¡¹ç›®ç»™ä¸ª star æˆ–è€… fork æˆ‘çš„é¡¹ç›®ä¸€èµ·æ¥å’Œæˆ‘å®Œå–„é¡¹ç›®ï¼‰ å¦‚æœè¿˜æ²¡æœ‰ Github è´¦å·çš„è¯ä½ å°±å…ˆå»æ³¨å†Œä¸€ä¸ªå§ï¼Œæœ‰çš„è¯ï¼Œç›´æ¥ç™»å½•å°±è¡Œï¼Œåé¢çš„æ“ä½œéƒ½è¦ç”¨åˆ° Github çš„ã€‚ 3. Github ä¸Šæ–°å»ºä¸ªäººç½‘ç«™é¡¹ç›®ç™»å½• GitHub ä¹‹åï¼Œåœ¨é¡µé¢å³ä¸Šè§’ç‚¹å‡» + åŠ å·æŒ‰é’®ï¼Œç‚¹å‡» New repositoryã€‚ ç”±äºæˆ‘ä»¬æ˜¯æ–°å»ºä¸€ä¸ªä¸ªäººç½‘ç«™é¡¹ç›®ï¼Œæ‰€æœ‰ä»“åº“çš„åç§°éœ€è¦å®‰è£… GitHub ä¸ªäººç½‘ç«™é¡¹ç›®çš„è§„å®šæ¥å†™ã€‚ è§„åˆ™å°±æ˜¯ï¼š YOUR-GITHUB-USERNAME.github.io æ¯”å¦‚æˆ‘çš„ GitHub ç”¨æˆ·åæ˜¯ zhisheng17ï¼Œé‚£æˆ‘å°±è¦å¡«å†™ zhisheng17.github.ioã€‚ç„¶åé€‰æ‹©å…¬å¼€æ¨¡å¼ï¼Œæ¥ç€ç‚¹å‡»åˆ›å»ºä»“åº“æŒ‰é’®ã€‚ åˆ›å»ºæˆåŠŸä¹‹åï¼Œè¿›å…¥äº†é¡¹ç›®ä¸»é¡µé¢ã€‚ç‚¹å‡»è®¾ç½®æŒ‰é’®ã€‚ è¿›å…¥ä¹‹åï¼Œæ»šåŠ¨é¡µé¢åˆ°ä¸‹æ–¹ã€‚ç‚¹å‡»é¡µé¢è‡ªåŠ¨ç”Ÿæˆå™¨æŒ‰é’®ã€‚ ç‚¹å‡»å³ä¸‹æ–¹ç»§ç»­å»å¸ƒå±€æŒ‰é’®ã€‚ é€‰æ‹©ä¸€ä¸ªæ¨¡æ¿ï¼Œç‚¹å‡»å‘å¸ƒé¡µé¢æŒ‰é’®ã€‚ è¿™ä¸ªæ—¶å€™ï¼Œä½ å°±å¯ä»¥é€šè¿‡YOUR-GITHUB-USERNAME.github.ioæ¥è®¿é—®æ­¤é¡µé¢äº†ã€‚ 4. ä¸Šä¼ ä¸ªäººç½‘é¡µåˆ° Githubè‡ªåŠ¨ç”Ÿæˆé¡µé¢ï¼Œè‚¯å®šä¸ç¬¦åˆæˆ‘ä»¬çš„è¦æ±‚ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿè‡ªå·±è®¾è®¡è‡ªå·±çš„ä¸ªäººç½‘ç«™ã€‚æˆ‘ä»¬å¯ä»¥è‡ªå·±ç¼–å†™ä¸€ä¸ªç½‘é¡µæ–‡ä»¶ï¼Œå‘½åä¸º index.htmlã€‚ç„¶åä¸Šä¼ åˆ° GitHubä¸ªäººç½‘ç«™é¡¹ç›®ä¸Šã€‚è¿™é‡Œä¸ºäº†èŠ‚çº¦æ—¶é—´ï¼Œå¯ä»¥å…ˆä¸‹è½½æˆ‘çš„ä¸ªäººç½‘ç«™é¡¹ç›®ä»£ç ï¼Œç„¶åä¿®æ”¹ä¸ºä½ çš„ç½‘é¡µä¸Šä¼ åˆ° GitHubã€‚ ä¸‹é¢ä»‹ç»è¯¦ç»†æ­¥éª¤ã€‚ è¿›å…¥æ­¤é¡¹ç›®https://github.com/zhisheng17/zhisheng17.github.ioï¼Œç„¶åä¸‹è½½æºç ã€‚è§£å‹ä¹‹åï¼Œæ‹¿åˆ°é‡Œé¢çš„index.htmlæ–‡ä»¶ã€‚ ç„¶åè¿›å…¥è‡ªå·±çš„ä¸ªäººç½‘ç«™é¡¹ç›®ä¸»é¡µ YOUR-GITHUB-USERNAME/YOUR-GITHUB-USERNAME.github.ioã€‚ç‚¹å‡»ä¸Šä¼ æ–‡ä»¶æŒ‰é’®ï¼Œè¿›å…¥ä¸Šä¼ æ–‡ä»¶é¡µé¢ï¼Œå°† index.html æ–‡ä»¶æ‹–å…¥è“è‰²å¤§åœˆåœˆåŒºåŸŸï¼Œç‚¹å‡»æäº¤æŒ‰é’®å³å¯æäº¤æˆåŠŸã€‚æ­¤æ—¶æ‰“å¼€ç½‘å€ YOUR-GITHUB-USERNAME.github.io å°±å¯ä»¥çœ‹åˆ°ä¸»é¡µå·²ç»æ”¹å˜ä¸ºæˆ‘ä»¬è‡ªå·±çš„ç½‘é¡µäº†ã€‚ é€šè¿‡ zhisheng17.github.io æŸ¥çœ‹æ•ˆæœï¼š 5. åŸŸåCNAMEåˆ°ä¸ªäººç½‘ç«™é¡¹ç›®ç½‘é¡µä¸Šä¼ æˆåŠŸäº†ï¼Œæˆ‘ä»¬ä¸æƒ³ä¸€ç›´é€šè¿‡YOUR-GITHUB-USERNAME.github.ioæ¥è®¿é—®æˆ‘ä»¬çš„ä¸ªäººç½‘ç«™ï¼Œè€Œæ˜¯å¸Œæœ›é€šè¿‡è‡ªå·±çš„åŸŸåæ¥è®¿é—®ã€‚ ä¸‹é¢è®²è¿°è¯¦ç»†æ­¥éª¤ã€‚ ç‚¹å‡»æˆ‘ä»¬çš„ä¸ªäººç½‘ç«™é¡¹ç›®è®¾ç½®é€‰é¡¹å¡ï¼Œæ»šåŠ¨åˆ°ä¸‹é¢ï¼Œå°±ä¼šå‘ç°ä¸€ä¸ªè‡ªå®šä¹‰åŸŸåå¡ç‰‡ã€‚è¾“å…¥æˆ‘ä»¬ä¹°çš„åŸŸåï¼Œç„¶åç‚¹å‡»ä¿å­˜ã€‚ æ¥ç€æˆ‘ä»¬è¿˜è¦å°†æˆ‘ä»¬çš„åŸŸåè§£æåˆ°è¿™ä¸ªä¸ªäººç½‘ç«™é¡¹ç›®ä¸Šã€‚å› ä¸ºæˆ‘çš„åŸŸåæ˜¯åœ¨è…¾è®¯äº‘ä¸Šé¢ä¹°çš„ï¼Œæ‰€ä»¥æˆ‘æ‰“å¼€è…¾è®¯äº‘åŸŸåç®¡ç†é¡µé¢ï¼Œè¿›è¡Œç›¸å…³çš„è®¾ç½®ã€‚ æ¥ç€ï¼Œç‚¹å‡»æ·»åŠ ä¸€æ¡åŸŸåè§£æè®°å½•ï¼Œä¸»æœºå¡«å†™wwwï¼Œä»£è¡¨ä½ æ˜¯ä¸€çº§åŸŸåæ¥è®¿é—®ï¼ŒæŒ‡å‘å¡«å†™YOUR-GITHUB-USERNAME.github.ioï¼Œç„¶åç‚¹å‡»ä¿å­˜æŒ‰é’®ã€‚åº”è¯¥è¦ç­‰ä¼šï¼ŒåŸŸåçš„è§£ææ—¶é—´å¯èƒ½ä¸ä¸€æ ·ï¼Œæˆ‘çš„è…¾è®¯äº‘å°±æ˜¯å¾ˆæ…¢çš„ 6. è®¿é—®ä½ çš„åŸŸåæ‰€æœ‰è¿™äº›æ­¥éª¤åšå®Œä¹‹åï¼Œåœ¨æµè§ˆå™¨é‡Œè¾“å…¥è‡ªå·±çš„åŸŸåï¼Œå›è½¦é”®ä¸€æŒ‰ï¼Œå°±ä¼šè¿”å›æˆ‘ä»¬åˆšåˆšä¸Šä¼ åˆ° GitHub çš„index.html é¡µé¢äº†ã€‚ è¿™é‡Œåªæ˜¯å…¥é—¨äº† GitHub æ­å»ºä¸ªäººç½‘ç«™çš„åŠŸèƒ½ï¼ŒGitHub å®˜æ–¹æ¨è Jekyll åšå®¢ç³»ç»Ÿæ¥å‘å¸ƒè‡ªå·±çš„é¡µé¢ã€‚ä»¥åæœ‰æ•°æ®æ›´æ–°ï¼Œéƒ½å¯ä»¥é€šè¿‡ Jekyll æ¥é‡æ–°ç¼–è¯‘æ•´ä¸ªç½‘ç«™ã€‚ï¼ˆæœŸå¾…åç»­æˆ‘çš„ä½¿ç”¨ Jekyll åšå®¢ç³»ç»Ÿå‘å¸ƒè‡ªå·±åšå®¢çš„æ–‡ç« å§ï¼‰ 7. æ³¨æ„äº‹é¡¹å°½ç®¡GitHubä¸ªäººç½‘ç«™é¡¹ç›®æ˜¯å…è´¹çš„ï¼Œä½†æ˜¯å´æœ‰ä¸€äº›é™åˆ¶ã€‚æ€»ä½“æ¥è¯´ï¼Œå®Œå…¨å¤Ÿç”¨ï¼Œç”šè‡³å¤ªå¤šäº†ã€‚ å•ä¸ªä»“åº“å¤§å°ä¸è¶…è¿‡1GBï¼Œä¸Šä¼ å•ä¸ªæ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡100MBï¼Œå¦‚æœé€šè¿‡æµè§ˆå™¨ä¸Šä¼ ä¸èƒ½è¶…è¿‡25MB ä¸ªäººç½‘ç«™é¡¹ç›®ä¹Ÿä¸ä¾‹å¤–ï¼Œæœ€å¤§ç©ºé—´1GB ä¸ªäººç½‘ç«™é¡¹ç›®æ¯ä¸ªæœˆè®¿é—®è¯·æ±‚æ•°ä¸èƒ½è¶…è¿‡10ä¸‡æ¬¡ï¼Œæ€»æµé‡ä¸èƒ½è¶…è¿‡100GB ä¸ªäººç½‘ç«™é¡¹ç›®ä¸€å°æ—¶åˆ›å»ºæ•°é‡ä¸èƒ½è¶…è¿‡10ä¸ª å½“ç„¶äº†ï¼Œè¿™äº›æ”¿ç­–å¯èƒ½éšæ—¶æ”¹å˜ï¼Œå¯ä»¥é€šè¿‡æ­¤ç½‘é¡µæŸ¥çœ‹æœ€æ–°æ”¿ç­–ã€‚ https://help.github.com/articles/what-is-github-pages/#recommended-limits æ–°å¢ç”±äºé—®é¢˜å¤ªå¤šäº†ï¼Œæ‰€ä»¥æ–°å†™äº†ç¯‡æ–‡ç« ï¼šGithub page + Hexo + yilia æ­å»ºåšå®¢å¯èƒ½ä¼šé‡åˆ°çš„æ‰€æœ‰ç–‘é—®","tags":[{"name":"Github Page","slug":"Github-Page","permalink":"http://www.54tianzhisheng.cn/tags/Github-Page/"},{"name":"åšå®¢ç½‘ç«™","slug":"åšå®¢ç½‘ç«™","permalink":"http://www.54tianzhisheng.cn/tags/åšå®¢ç½‘ç«™/"}]},{"title":"è§£å†³jdk1.8ä¸­å‘é€é‚®ä»¶å¤±è´¥ï¼ˆhandshake_failureï¼‰é—®é¢˜","date":"2017-06-12T16:00:00.000Z","path":"2017/06/13/è§£å†³jdk1.8ä¸­å‘é€é‚®ä»¶å¤±è´¥ï¼ˆhandshake_failureï¼‰é—®é¢˜/","text":"æš‘å‡åœ¨å®¶åšä¸€ä¸ªç±»ä¼¼çŸ¥ä¹çš„é—®ç­”å‹ç½‘ç«™ï¼ˆä»£ç å¯è§ï¼šGithub/wenda å–œæ¬¢çš„å¯ä»¥ç»™ä¸ªstaræˆ–è€…è‡ªå·±forkç„¶åä¿®æ”¹ï¼Œç›®å‰åŠŸèƒ½è¿˜æœªå¾ˆå®Œå–„ï¼‰ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªç«™å†…é‚®ä»¶é€šçŸ¥ç³»ç»Ÿï¼ˆè¿™é‡Œç®€å•çš„è®²ä¸€ä¸ªä¾‹å­ï¼šå¦‚æœç”¨æˆ·ç™»å½•çš„æ—¶å€™å‡ºç°å¼‚å¸¸ï¼Œé‚£ä¹ˆå°±ä¼šé€šè¿‡é‚®ä»¶å‘é€é€šçŸ¥ç”¨æˆ·ï¼‰ã€‚ç„¶è€Œå´ç¢°åˆ°ä¸€ä¸ªé—®é¢˜ã€‚é—®é¢˜é”™è¯¯ä¿¡æ¯å¦‚ä¸‹ï¼š å‘é€é‚®ä»¶å¤±è´¥Mail server connection failed; nested exception is javax.mail.MessagingException: Could not connect to SMTP host: smtp.qq.com, port: 465;nested exception is: javax.net.ssl.SSLHandshakeException: Received fatal alert: handshake_failure. Failed messages: javax.mail. MessagingException: Could not connect to SMTP host: smtp.qq.com, port: 465;nested exception is: javax.net.ssl.SSLHandshakeException: Received fatal alert: handshake_failure è‡ªå·±åœ¨å°†é”™è¯¯ä¿¡æ¯ä»£ç googleäº†ä¸€ä¸‹ï¼Œæ‰¾äº†å¾ˆä¹…å‘ç°å¾ˆå¤šè§£å†³æ–¹æ¡ˆï¼ŒåŒ…æ‹¬stackoverflowä¸Šçš„ä¸€äº›è§£å†³æ–¹æ¡ˆï¼Œä½†è¿˜æ˜¯æ²¡ç”¨ã€‚ç„¶åå‘¢ç”¨ç™¾åº¦è¯•äº†ä¸‹ï¼Œç»“æœåœ¨ç¬¬ä¸€æ¡æ˜¯å¼€æºä¸­å›½çš„ä¸€ç¯‡åšå®¢:javax.net.ssl.SSLHandshakeException: Received fatal alert: handshake_failureã€‚ ç‚¹è¿›å»æ˜¯è¿™æ ·çš„ï¼šï¼ˆå¦‚ä¸‹å›¾ï¼‰ ç»“æœå°±æ˜¯ï¼šè¿™ä¸ªé—®é¢˜æ˜¯jdkå¯¼è‡´çš„ï¼Œjdk1.8é‡Œé¢æœ‰ä¸€ä¸ªjceçš„åŒ…ï¼Œå®‰å…¨æ€§æœºåˆ¶å¯¼è‡´çš„è®¿é—®httpsä¼šæŠ¥é”™ï¼Œå®˜ç½‘ä¸Šæœ‰æ›¿ä»£çš„jaråŒ…ï¼Œå¦‚æœæ›¿æ¢æ‰å°±å¯ä»¥äº†ã€‚é—®é¢˜çš„è§£å†³æ–¹æ³•è¿˜å¯ä»¥å°±æ˜¯åœ¨æ•´ä¸ªé¡¹ç›®ä¸­æŠŠä½ çš„jdkæ¢æˆæ˜¯1.7å»ï¼ŒåŒæ ·ä¹Ÿå¯ä»¥è§£å†³è¿™ä¸ªæˆ‘é—®é¢˜ã€‚ è¿™ä¸¤ä¸ªjaråŒ…çš„ä¸‹è½½åœ°å€ï¼šhttp://www.oracle.com/technetwork/java/javase/downloads/jce-7-download-432124.html ç„¶åä¸‹è½½ä¹‹åï¼ŒæŠŠè¿™ä¸ªå‹ç¼©æ–‡ä»¶è§£å‹ï¼Œå¾—åˆ°ä¸¤ä¸ªjaråŒ…å»è¦†ç›–jdkå®‰è£…ç›®å½•ä¸‹çš„jre\\lib\\security\\ä¸‹ç›¸åŒçš„jaråŒ…å°±èƒ½è§£å†³java8çš„é‚®ä»¶å‘é€é—®é¢˜ã€‚ æ¥ç€ç”¨QQé‚®ç®±æˆ‘äº²æµ‹æœ‰ç”¨ï¼Œä½†æ˜¯è¦æ³¨æ„ä¸€ç‚¹å°±æ˜¯ï¼šå¼€å¯SMTPæœåŠ¡åè¦è®°å¾—å°†ä½ çš„16ä½æˆæƒç ä½œä¸ºä½ çš„qqé‚®ç®±ç™»å½•å¯†ç ã€‚ MailSender.javaä¸­mailSender.setPassword(â€œ16ä½æˆæƒç â€); mailSender.setHost(â€œsmtp.qq.comâ€);mailSender.setPort(465); ä¸‹é¢æŠŠå®Œæ•´ä»£ç å‘å¸ƒå‡ºæ¥ï¼š 1. LoginExceptionHandler.java 12345678910111213141516171819202122232425262728293031323334package com.nowcoder.async.handler;import com.nowcoder.async.EventHandler;import com.nowcoder.async.EventModel;import com.nowcoder.async.EventType;import com.nowcoder.util.MailSender;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Component;import java.util.Arrays;import java.util.HashMap;import java.util.List;import java.util.Map;/** * Created by 10412 on 2016/8/10. */@Componentpublic class LoginExceptionHandler implements EventHandler&#123; @Autowired MailSender mailSender; @Override public void doHandle(EventModel model) &#123; // xxxxåˆ¤æ–­å‘ç°è¿™ä¸ªç”¨æˆ·ç™»é™†å¼‚å¸¸ Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;(); map.put(\"username\", model.getExt(\"username\")); mailSender.sendWithHTMLTemplate(model.getExt(\"email\"), \"ç™»é™†IPå¼‚å¸¸\", \"mails/login_exception.html\", map); &#125; @Override public List&lt;EventType&gt; getSupportEventTypes() &#123; return Arrays.asList(EventType.LOGIN); &#125;&#125; 2. LoginController.java123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114package com.nowcoder.controller;import com.nowcoder.async.EventModel;import com.nowcoder.async.EventProducer;import com.nowcoder.async.EventType;import com.nowcoder.service.UserService;import org.apache.commons.lang.StringUtils;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.ui.Model;import org.springframework.web.bind.annotation.CookieValue;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestMethod;import org.springframework.web.bind.annotation.RequestParam;import javax.servlet.http.Cookie;import javax.servlet.http.HttpServletResponse;import java.util.Map;/** * Created by 10412 on 2016/7/2. */@Controllerpublic class LoginController &#123; private static final Logger logger = LoggerFactory.getLogger(LoginController.class); @Autowired UserService userService; @Autowired EventProducer eventProducer; @RequestMapping(path = &#123;&quot;/reg/&quot;&#125;, method = &#123;RequestMethod.POST&#125;) public String reg(Model model, @RequestParam(&quot;username&quot;) String username, @RequestParam(&quot;password&quot;) String password, @RequestParam(&quot;next&quot;) String next, @RequestParam(value=&quot;rememberme&quot;, defaultValue = &quot;false&quot;) boolean rememberme, HttpServletResponse response) &#123; try &#123; Map&lt;String, Object&gt; map = userService.register(username, password); if (map.containsKey(&quot;ticket&quot;)) &#123; Cookie cookie = new Cookie(&quot;ticket&quot;, map.get(&quot;ticket&quot;).toString()); cookie.setPath(&quot;/&quot;); if (rememberme) &#123; cookie.setMaxAge(3600*24*5); &#125; response.addCookie(cookie); if (StringUtils.isNotBlank(next)) &#123; return &quot;redirect:&quot; + next; &#125; return &quot;redirect:/&quot;; &#125; else &#123; model.addAttribute(&quot;msg&quot;, map.get(&quot;msg&quot;)); return &quot;login&quot;; &#125; &#125; catch (Exception e) &#123; logger.error(&quot;æ³¨å†Œå¼‚å¸¸&quot; + e.getMessage()); model.addAttribute(&quot;msg&quot;, &quot;æœåŠ¡å™¨é”™è¯¯&quot;); return &quot;login&quot;; &#125; &#125; @RequestMapping(path = &#123;&quot;/reglogin&quot;&#125;, method = &#123;RequestMethod.GET&#125;) public String regloginPage(Model model, @RequestParam(value = &quot;next&quot;, required = false) String next) &#123; model.addAttribute(&quot;next&quot;, next); return &quot;login&quot;; &#125; @RequestMapping(path = &#123;&quot;/login/&quot;&#125;, method = &#123;RequestMethod.POST&#125;) public String login(Model model, @RequestParam(&quot;username&quot;) String username, @RequestParam(&quot;password&quot;) String password, @RequestParam(value=&quot;next&quot;, required = false) String next, @RequestParam(value=&quot;rememberme&quot;, defaultValue = &quot;false&quot;) boolean rememberme, HttpServletResponse response) &#123; try &#123; Map&lt;String, Object&gt; map = userService.login(username, password); if (map.containsKey(&quot;ticket&quot;)) &#123; Cookie cookie = new Cookie(&quot;ticket&quot;, map.get(&quot;ticket&quot;).toString()); cookie.setPath(&quot;/&quot;); if (rememberme) &#123; cookie.setMaxAge(3600*24*5); &#125; response.addCookie(cookie); eventProducer.fireEvent(new EventModel(EventType.LOGIN) .setExt(&quot;username&quot;, username).setExt(&quot;email&quot;, &quot;****@qq.com&quot;) .setActorId((int)map.get(&quot;userId&quot;))); if (StringUtils.isNotBlank(next)) &#123; return &quot;redirect:&quot; + next; &#125; return &quot;redirect:/&quot;; &#125; else &#123; model.addAttribute(&quot;msg&quot;, map.get(&quot;msg&quot;)); return &quot;login&quot;; &#125; &#125; catch (Exception e) &#123; logger.error(&quot;ç™»é™†å¼‚å¸¸&quot; + e.getMessage()); return &quot;login&quot;; &#125; &#125; @RequestMapping(path = &#123;&quot;/logout&quot;&#125;, method = &#123;RequestMethod.GET, RequestMethod.POST&#125;) public String logout(@CookieValue(&quot;ticket&quot;) String ticket) &#123; userService.logout(ticket); return &quot;redirect:/&quot;; &#125;&#125; 3. EventHandler.java1234567891011121314package com.nowcoder.async;import java.util.List;/** * Created by 10412 on 2016/8/10. */public interface EventHandler&#123; void doHandle(EventModel model); List&lt;EventType&gt; getSupportEventTypes();&#125; 4. MailSender.java 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970package com.nowcoder.util;import org.apache.velocity.app.VelocityEngine;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import org.springframework.beans.factory.InitializingBean;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.mail.javamail.JavaMailSenderImpl;import org.springframework.mail.javamail.MimeMessageHelper;import org.springframework.stereotype.Service;import org.springframework.ui.velocity.VelocityEngineUtils;import javax.mail.internet.InternetAddress;import javax.mail.internet.MimeMessage;import javax.mail.internet.MimeUtility;import java.util.Map;import java.util.Properties;/** * Created by 10412 on 2016/8/10. // ***@qq.com wnppafhsbrcgbfbhï¼ˆ16ä½æˆæƒç ï¼‰ */@Servicepublic class MailSender implements InitializingBean &#123; private static final Logger logger = LoggerFactory.getLogger(MailSender.class); private JavaMailSenderImpl mailSender; @Autowired private VelocityEngine velocityEngine; public boolean sendWithHTMLTemplate(String to, String subject, String template, Map&lt;String, Object&gt; model) &#123; try &#123; String nick = MimeUtility.encodeText(\"***\"); InternetAddress from = new InternetAddress(nick + \"&lt;****@qq.com&gt;\"); MimeMessage mimeMessage = mailSender.createMimeMessage(); MimeMessageHelper mimeMessageHelper = new MimeMessageHelper(mimeMessage); String result = VelocityEngineUtils .mergeTemplateIntoString(velocityEngine, template, \"UTF-8\", model); mimeMessageHelper.setTo(to); mimeMessageHelper.setFrom(from); mimeMessageHelper.setSubject(subject); mimeMessageHelper.setText(result, true); mailSender.send(mimeMessage); return true; &#125; catch (Exception e) &#123; logger.error(\"å‘é€é‚®ä»¶å¤±è´¥\" + e.getMessage()); return false; &#125; &#125; @Override public void afterPropertiesSet() throws Exception &#123; mailSender = new JavaMailSenderImpl(); mailSender.setUsername(\"***@qq.com\"); mailSender.setPassword(\"wnppafhsbrcgbfbh\"); //qqé‚®ç®±å¼€å¯smtpæœåŠ¡åä½¿ç”¨16ä½æˆæƒç åœ¨ç¬¬ä¸‰æ–¹ç™»å½•// mailSender.setHost(\"smtp.exmail.qq.com\"); mailSender.setHost(\"smtp.qq.com\"); mailSender.setPort(465);// mailSender.setHost(\"smtp.163.com\"); //163é‚®ç®±// mailSender.setPort(25); mailSender.setProtocol(\"smtps\"); mailSender.setDefaultEncoding(\"utf8\"); Properties javaMailProperties = new Properties(); javaMailProperties.put(\"mail.smtp.ssl.enable\", true); //javaMailProperties.put(\"mail.smtp.auth\", true); //javaMailProperties.put(\"mail.smtp.starttls.enable\", true); mailSender.setJavaMailProperties(javaMailProperties); &#125;&#125; 5. login_exception.html å‘é€æ¶ˆæ¯æ¨¡æ¿ï¼ˆå¯è‡ªå®šä¹‰ï¼‰ 1ä½ å¥½$usernameï¼Œä½ çš„ç™»é™†æœ‰é—®é¢˜! ä¸€åˆ‡éƒ½å¥½äº†ï¼Œè¿è¡Œã€‚ ç™»å½•ã€‚ å‘é€é‚®ä»¶è¿‡æ¥äº†ã€‚ æ€»ç»“æ¥è¯´ï¼šè¿™ä¸ªé”™è¯¯å°±æ˜¯jdk1.8ä¸­çš„ä¸€ä¸ªjceçš„åŒ…ï¼Œå®‰å…¨æ€§æœºåˆ¶å¯¼è‡´è®¿é—®httpsä¼šæŠ¥é”™ã€‚","tags":[{"name":"Java","slug":"Java","permalink":"http://www.54tianzhisheng.cn/tags/Java/"},{"name":"é‚®ä»¶å‘é€","slug":"é‚®ä»¶å‘é€","permalink":"http://www.54tianzhisheng.cn/tags/é‚®ä»¶å‘é€/"}]},{"title":"HashMapã€Hashtableã€HashSet å’Œ ConcurrentHashMap çš„æ¯”è¾ƒ","date":"2017-06-12T16:00:00.000Z","path":"2017/06/13/HashMap-Hashtable/","text":"HashMap å’Œ Hashtable çš„æ¯”è¾ƒæ˜¯ Java é¢è¯•ä¸­çš„å¸¸è§é—®é¢˜ï¼Œç”¨æ¥è€ƒéªŒç¨‹åºå‘˜æ˜¯å¦èƒ½å¤Ÿæ­£ç¡®ä½¿ç”¨é›†åˆç±»ä»¥åŠæ˜¯å¦å¯ä»¥éšæœºåº”å˜ä½¿ç”¨å¤šç§æ€è·¯è§£å†³é—®é¢˜ã€‚HashMap çš„å·¥ä½œåŸç†ã€ArrayList ä¸ Vector çš„æ¯”è¾ƒä»¥åŠè¿™ä¸ªé—®é¢˜æ˜¯æœ‰å…³ Java é›†åˆæ¡†æ¶çš„æœ€ç»å…¸çš„é—®é¢˜ã€‚Hashtable æ˜¯ä¸ªè¿‡æ—¶çš„é›†åˆç±»ï¼Œå­˜åœ¨äº Java API ä¸­å¾ˆä¹…äº†ã€‚åœ¨ Java 4 ä¸­è¢«é‡å†™äº†ï¼Œå®ç°äº† Map æ¥å£ï¼Œæ‰€ä»¥è‡ªæ­¤ä»¥åä¹Ÿæˆäº† Java é›†åˆæ¡†æ¶ä¸­çš„ä¸€éƒ¨åˆ†ã€‚Hashtable å’Œ HashMap åœ¨ Java é¢è¯•ä¸­ç›¸å½“å®¹æ˜“è¢«é—®åˆ°ï¼Œç”šè‡³æˆä¸ºäº†é›†åˆæ¡†æ¶é¢è¯•é¢˜ä¸­æœ€å¸¸è¢«è€ƒçš„é—®é¢˜ï¼Œæ‰€ä»¥åœ¨å‚åŠ ä»»ä½• Java é¢è¯•ä¹‹å‰ï¼Œéƒ½ä¸è¦å¿˜äº†å‡†å¤‡è¿™ä¸€é¢˜ã€‚è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä¸ä»…å°†ä¼šçœ‹åˆ° HashMap å’Œ Hashtable çš„åŒºåˆ«ï¼Œè¿˜å°†çœ‹åˆ°å®ƒä»¬ä¹‹é—´çš„ç›¸ä¼¼ä¹‹å¤„ã€‚ HashMap å’Œ Hashtable çš„åŒºåˆ«HashMap å’Œ Hashtable éƒ½å®ç°äº† Map æ¥å£ï¼Œä½†å†³å®šç”¨å“ªä¸€ä¸ªä¹‹å‰å…ˆè¦å¼„æ¸…æ¥šå®ƒä»¬ä¹‹é—´çš„åˆ†åˆ«ã€‚ä¸»è¦çš„åŒºåˆ«æœ‰ï¼šçº¿ç¨‹å®‰å…¨æ€§ï¼ŒåŒæ­¥ (synchronization)ï¼Œä»¥åŠé€Ÿåº¦ã€‚ HashMap å‡ ä¹å¯ä»¥ç­‰ä»·äº Hashtableï¼Œé™¤äº† HashMap æ˜¯é synchronized çš„ï¼Œå¹¶å¯ä»¥æ¥å— null(HashMap å¯ä»¥æ¥å—ä¸º null çš„é”®å€¼ (key) å’Œå€¼ (value)ï¼Œè€Œ Hashtable åˆ™ä¸è¡Œ)ã€‚ HashMap æ˜¯é synchronizedï¼Œè€Œ Hashtable æ˜¯ synchronizedï¼Œè¿™æ„å‘³ç€ Hashtable æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥å…±äº«ä¸€ä¸ª Hashtableï¼›è€Œå¦‚æœæ²¡æœ‰æ­£ç¡®çš„åŒæ­¥çš„è¯ï¼Œå¤šä¸ªçº¿ç¨‹æ˜¯ä¸èƒ½å…±äº« HashMap çš„ã€‚Java 5 æä¾›äº† ConcurrentHashMapï¼Œå®ƒæ˜¯ HashTable çš„æ›¿ä»£ï¼Œæ¯” HashTable çš„æ‰©å±•æ€§æ›´å¥½ã€‚ å¦ä¸€ä¸ªåŒºåˆ«æ˜¯ HashMap çš„è¿­ä»£å™¨ (Iterator) æ˜¯ fail-fast è¿­ä»£å™¨ï¼Œè€Œ Hashtable çš„ enumerator è¿­ä»£å™¨ä¸æ˜¯ fail-fast çš„ã€‚æ‰€ä»¥å½“æœ‰å…¶å®ƒçº¿ç¨‹æ”¹å˜äº† HashMap çš„ç»“æ„ï¼ˆå¢åŠ æˆ–è€…ç§»é™¤å…ƒç´ ï¼‰ï¼Œå°†ä¼šæŠ›å‡ºConcurrentModificationExceptionï¼Œä½†è¿­ä»£å™¨æœ¬èº«çš„ remove() æ–¹æ³•ç§»é™¤å…ƒç´ åˆ™ä¸ä¼šæŠ›å‡ºConcurrentModificationException å¼‚å¸¸ã€‚ä½†è¿™å¹¶ä¸æ˜¯ä¸€ä¸ªä¸€å®šå‘ç”Ÿçš„è¡Œä¸ºï¼Œè¦çœ‹ JVMã€‚è¿™æ¡åŒæ ·ä¹Ÿæ˜¯Enumeration å’Œ Iterato rçš„åŒºåˆ«ã€‚ ç”±äº Hashtable æ˜¯çº¿ç¨‹å®‰å…¨çš„ä¹Ÿæ˜¯ synchronizedï¼Œæ‰€ä»¥åœ¨å•çº¿ç¨‹ç¯å¢ƒä¸‹å®ƒæ¯” HashMap è¦æ…¢ã€‚å¦‚æœä½ ä¸éœ€è¦åŒæ­¥ï¼Œåªéœ€è¦å•ä¸€çº¿ç¨‹ï¼Œé‚£ä¹ˆä½¿ç”¨ HashMap æ€§èƒ½è¦å¥½è¿‡ Hashtableã€‚ HashMap ä¸èƒ½ä¿è¯éšç€æ—¶é—´çš„æ¨ç§» Map ä¸­çš„å…ƒç´ æ¬¡åºæ˜¯ä¸å˜çš„ã€‚ è¦æ³¨æ„çš„ä¸€äº›é‡è¦æœ¯è¯­ï¼š1) sychronized æ„å‘³ç€åœ¨ä¸€æ¬¡ä»…æœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿæ›´æ”¹ Hashtableã€‚å°±æ˜¯è¯´ä»»ä½•çº¿ç¨‹è¦æ›´æ–° Hashtable æ—¶è¦é¦–å…ˆè·å¾—åŒæ­¥é”ï¼Œå…¶å®ƒçº¿ç¨‹è¦ç­‰åˆ°åŒæ­¥é”è¢«é‡Šæ”¾ä¹‹åæ‰èƒ½å†æ¬¡è·å¾—åŒæ­¥é”æ›´æ–° Hashtableã€‚ 2) Fail-safe å’Œ iterator è¿­ä»£å™¨ç›¸å…³ã€‚å¦‚æœæŸä¸ªé›†åˆå¯¹è±¡åˆ›å»ºäº† Iterator æˆ–è€… ListIteratorï¼Œç„¶åå…¶å®ƒçš„çº¿ç¨‹è¯•å›¾â€œç»“æ„ä¸Šâ€æ›´æ”¹é›†åˆå¯¹è±¡ï¼Œå°†ä¼šæŠ›å‡º ConcurrentModificationException å¼‚å¸¸ã€‚ä½†å…¶å®ƒçº¿ç¨‹å¯ä»¥é€šè¿‡ set() æ–¹æ³•æ›´æ”¹é›†åˆå¯¹è±¡æ˜¯å…è®¸çš„ï¼Œå› ä¸ºè¿™å¹¶æ²¡æœ‰ä»â€œç»“æ„ä¸Šâ€æ›´æ”¹é›†åˆã€‚ä½†æ˜¯å‡å¦‚å·²ç»ä»ç»“æ„ä¸Šè¿›è¡Œäº†æ›´æ”¹ï¼Œå†è°ƒç”¨ set() æ–¹æ³•ï¼Œå°†ä¼šæŠ›å‡º IllegalArgumentException å¼‚å¸¸ã€‚ 3) ç»“æ„ä¸Šçš„æ›´æ”¹æŒ‡çš„æ˜¯åˆ é™¤æˆ–è€…æ’å…¥ä¸€ä¸ªå…ƒç´ ï¼Œè¿™æ ·ä¼šå½±å“åˆ° map çš„ç»“æ„ã€‚ æˆ‘ä»¬èƒ½å¦è®© HashMap åŒæ­¥ï¼ŸHashMap å¯ä»¥é€šè¿‡ä¸‹é¢çš„è¯­å¥è¿›è¡ŒåŒæ­¥ï¼šMap m = Collections.synchronizeMap(hashMap); ç»“è®ºHashtable å’Œ HashMap æœ‰å‡ ä¸ªä¸»è¦çš„ä¸åŒï¼šçº¿ç¨‹å®‰å…¨ä»¥åŠé€Ÿåº¦ã€‚ä»…åœ¨ä½ éœ€è¦å®Œå…¨çš„çº¿ç¨‹å®‰å…¨çš„æ—¶å€™ä½¿ç”¨Hashtableï¼Œè€Œå¦‚æœä½ ä½¿ç”¨ Java 5 æˆ–ä»¥ä¸Šçš„è¯ï¼Œè¯·ä½¿ç”¨ ConcurrentHashMap å§ã€‚ è½¬è½½è‡ªï¼šHashMapå’ŒHashtableçš„åŒºåˆ« å…³äº HashMap çº¿ç¨‹ä¸å®‰å…¨è¿™ä¸€ç‚¹ï¼Œã€ŠJavaå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹ä¸€ä¹¦ä¸­æ˜¯è¿™æ ·è¯´çš„ï¼š HashMap åœ¨å¹¶å‘æ‰§è¡Œ put æ“ä½œæ—¶ä¼šå¼•èµ·æ­»å¾ªç¯ï¼Œå¯¼è‡´ CPU åˆ©ç”¨ç‡æ¥è¿‘ 100%ã€‚å› ä¸ºå¤šçº¿ç¨‹ä¼šå¯¼è‡´ HashMap çš„ Node é“¾è¡¨å½¢æˆç¯å½¢æ•°æ®ç»“æ„ï¼Œä¸€æ—¦å½¢æˆç¯å½¢æ•°æ®ç»“æ„ï¼ŒNode çš„ next èŠ‚ç‚¹æ°¸è¿œä¸ä¸ºç©ºï¼Œå°±ä¼šåœ¨è·å– Node æ—¶äº§ç”Ÿæ­»å¾ªç¯ã€‚ åŸå› ï¼š ç–«è‹—ï¼šJAVA HASHMAPçš„æ­»å¾ªç¯ â€”â€” é…·å£³ HashMapåœ¨javaå¹¶å‘ä¸­å¦‚ä½•å‘ç”Ÿæ­»å¾ªç¯ How does a HashMap work in JAVA ä¸‹é¢çš„æ˜¯è‡ªå·±æœ‰é“äº‘ç¬”è®°ä¸­è®°å½•çš„ï¼š HashMap ï¼Œ HashTable å’Œ HashSet åŒºåˆ« å…³äº HashMap çš„ä¸€äº›è¯´æ³•ï¼š a) HashMap å®é™…ä¸Šæ˜¯ä¸€ä¸ªâ€œé“¾è¡¨æ•£åˆ—â€çš„æ•°æ®ç»“æ„ï¼Œå³æ•°ç»„å’Œé“¾è¡¨çš„ç»“åˆä½“ã€‚HashMap çš„åº•å±‚ç»“æ„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­çš„æ¯ä¸€é¡¹æ˜¯ä¸€æ¡é“¾è¡¨ã€‚ b) HashMap çš„å®ä¾‹æœ‰ä¿©ä¸ªå‚æ•°å½±å“å…¶æ€§èƒ½ï¼š â€œåˆå§‹å®¹é‡â€ å’Œ è£…å¡«å› å­ã€‚ c) HashMap å®ç°ä¸åŒæ­¥ï¼Œçº¿ç¨‹ä¸å®‰å…¨ã€‚ HashTable çº¿ç¨‹å®‰å…¨ d) HashMap ä¸­çš„ key-value éƒ½æ˜¯å­˜å‚¨åœ¨ Entry ä¸­çš„ã€‚ e) HashMap å¯ä»¥å­˜ null é”®å’Œ null å€¼ï¼Œä¸ä¿è¯å…ƒç´ çš„é¡ºåºæ’ä¹…ä¸å˜ï¼Œå®ƒçš„åº•å±‚ä½¿ç”¨çš„æ˜¯æ•°ç»„å’Œé“¾è¡¨ï¼Œé€šè¿‡hashCode() æ–¹æ³•å’Œ equals æ–¹æ³•ä¿è¯é”®çš„å”¯ä¸€æ€§ f) è§£å†³å†²çªä¸»è¦æœ‰ä¸‰ç§æ–¹æ³•ï¼šå®šå€æ³•ï¼Œæ‹‰é“¾æ³•ï¼Œå†æ•£åˆ—æ³•ã€‚HashMap æ˜¯é‡‡ç”¨æ‹‰é“¾æ³•è§£å†³å“ˆå¸Œå†²çªçš„ã€‚ æ³¨ï¼š é“¾è¡¨æ³•æ˜¯å°†ç›¸åŒ hash å€¼çš„å¯¹è±¡ç»„æˆä¸€ä¸ªé“¾è¡¨æ”¾åœ¨ hash å€¼å¯¹åº”çš„æ§½ä½ï¼› ç”¨å¼€æ”¾å®šå€æ³•è§£å†³å†²çªçš„åšæ³•æ˜¯ï¼šå½“å†²çªå‘ç”Ÿæ—¶ï¼Œä½¿ç”¨æŸç§æ¢æŸ¥(äº¦ç§°æ¢æµ‹)æŠ€æœ¯åœ¨æ•£åˆ—è¡¨ä¸­å½¢æˆä¸€ä¸ªæ¢æŸ¥(æµ‹)åºåˆ—ã€‚ æ²¿æ­¤åºåˆ—é€ä¸ªå•å…ƒåœ°æŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°ç»™å®š çš„å…³é”®å­—ï¼Œæˆ–è€…ç¢°åˆ°ä¸€ä¸ªå¼€æ”¾çš„åœ°å€(å³è¯¥åœ°å€å•å…ƒä¸ºç©º)ä¸ºæ­¢ï¼ˆè‹¥è¦æ’å…¥ï¼Œåœ¨æ¢æŸ¥åˆ°å¼€æ”¾çš„åœ°å€ï¼Œåˆ™å¯å°†å¾…æ’å…¥çš„æ–°ç»“ç‚¹å­˜äººè¯¥åœ°å€å•å…ƒï¼‰ã€‚ æ‹‰é“¾æ³•è§£å†³å†²çªçš„åšæ³•æ˜¯ï¼š å°†æ‰€æœ‰å…³é”®å­—ä¸ºåŒä¹‰è¯çš„ç»“ç‚¹é“¾æ¥åœ¨åŒä¸€ä¸ªå•é“¾è¡¨ä¸­ ã€‚è‹¥é€‰å®šçš„æ•£åˆ—è¡¨é•¿åº¦ä¸ºmï¼Œåˆ™å¯å°†æ•£åˆ—è¡¨å®šä¹‰ä¸ºä¸€ä¸ªç”±mä¸ªå¤´æŒ‡é’ˆç»„æˆçš„æŒ‡é’ˆæ•° ç»„T[0..m-1]ã€‚å‡¡æ˜¯æ•£åˆ—åœ°å€ä¸ºiçš„ç»“ç‚¹ï¼Œå‡æ’å…¥åˆ°ä»¥T[i]ä¸ºå¤´æŒ‡é’ˆçš„å•é“¾è¡¨ä¸­ã€‚Tä¸­å„åˆ†é‡çš„åˆå€¼å‡åº”ä¸ºç©ºæŒ‡é’ˆã€‚åœ¨æ‹‰é“¾æ³•ä¸­ï¼Œè£…å¡«å› å­Î±å¯ä»¥å¤§äº1ï¼Œä½†ä¸€èˆ¬å‡å–Î±â‰¤1ã€‚æ‹‰é“¾æ³•é€‚åˆæœªè§„å®šå…ƒç´ çš„å¤§å°ã€‚ Hashtable å’Œ HashMap çš„åŒºåˆ«ï¼š a) ç»§æ‰¿ä¸åŒã€‚ public class Hashtable extends Dictionary implements Map public class HashMap extends AbstractMap implements Map b) Hashtable ä¸­çš„æ–¹æ³•æ˜¯åŒæ­¥çš„ï¼Œè€Œ HashMap ä¸­çš„æ–¹æ³•åœ¨ç¼ºçœæƒ…å†µä¸‹æ˜¯éåŒæ­¥çš„ã€‚åœ¨å¤šçº¿ç¨‹å¹¶å‘çš„ç¯å¢ƒä¸‹ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ Hashtableï¼Œä½†æ˜¯è¦ä½¿ç”¨ HashMap çš„è¯å°±è¦è‡ªå·±å¢åŠ åŒæ­¥å¤„ç†äº†ã€‚ c) Hashtable ä¸­ï¼Œ key å’Œ value éƒ½ä¸å…è®¸å‡ºç° null å€¼ã€‚ åœ¨ HashMap ä¸­ï¼Œ null å¯ä»¥ä½œä¸ºé”®ï¼Œè¿™æ ·çš„é”®åªæœ‰ä¸€ä¸ªï¼›å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªé”®æ‰€å¯¹åº”çš„å€¼ä¸º null ã€‚å½“ get() æ–¹æ³•è¿”å› null å€¼æ—¶ï¼Œå³å¯ä»¥è¡¨ç¤º HashMap ä¸­æ²¡æœ‰è¯¥é”®ï¼Œä¹Ÿå¯ä»¥è¡¨ç¤ºè¯¥é”®æ‰€å¯¹åº”çš„å€¼ä¸º null ã€‚å› æ­¤ï¼Œåœ¨ HashMap ä¸­ä¸èƒ½ç”± get() æ–¹æ³•æ¥åˆ¤æ–­ HashMap ä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªé”®ï¼Œ è€Œåº”è¯¥ç”¨ containsKey() æ–¹æ³•æ¥åˆ¤æ–­ã€‚ d) ä¸¤ä¸ªéå†æ–¹å¼çš„å†…éƒ¨å®ç°ä¸Šä¸åŒã€‚Hashtableã€HashMap éƒ½ä½¿ç”¨äº†Iteratorã€‚è€Œç”±äºå†å²åŸå› ï¼ŒHashtableè¿˜ä½¿ç”¨äº† Enumeration çš„æ–¹å¼ ã€‚ e) å“ˆå¸Œå€¼çš„ä½¿ç”¨ä¸åŒï¼ŒHashTable ç›´æ¥ä½¿ç”¨å¯¹è±¡çš„ hashCodeã€‚è€Œ HashMap é‡æ–°è®¡ç®— hash å€¼ã€‚ f) Hashtable å’Œ HashMap å®ƒä»¬ä¸¤ä¸ªå†…éƒ¨å®ç°æ–¹å¼çš„æ•°ç»„çš„åˆå§‹å¤§å°å’Œæ‰©å®¹çš„æ–¹å¼ã€‚HashTable ä¸­ hash æ•°ç»„é»˜è®¤å¤§å°æ˜¯11ï¼Œå¢åŠ çš„æ–¹å¼æ˜¯ old*2+1ã€‚HashMap ä¸­ hash æ•°ç»„çš„é»˜è®¤å¤§å°æ˜¯ 16ï¼Œè€Œä¸”ä¸€å®šæ˜¯2çš„æŒ‡æ•°ã€‚ æ³¨ï¼š HashSet å­ç±»ä¾é  hashCode() å’Œ equal() æ–¹æ³•æ¥åŒºåˆ†é‡å¤å…ƒç´ ã€‚ HashSet å†…éƒ¨ä½¿ç”¨ Map ä¿å­˜æ•°æ®ï¼Œå³å°† HashSet çš„æ•°æ®ä½œä¸º Map çš„ key å€¼ä¿å­˜ï¼Œè¿™ä¹Ÿæ˜¯ HashSet ä¸­å…ƒç´ ä¸èƒ½é‡å¤çš„åŸå› ã€‚è€Œ Map ä¸­ä¿å­˜ key å€¼çš„,ä¼šå»åˆ¤æ–­å½“å‰ Map ä¸­æ˜¯å¦å«æœ‰è¯¥ Key å¯¹è±¡ï¼Œå†…éƒ¨æ˜¯å…ˆé€šè¿‡ key çš„hashCode, ç¡®å®šæœ‰ç›¸åŒçš„ hashCode ä¹‹åï¼Œå†é€šè¿‡ equals æ–¹æ³•åˆ¤æ–­æ˜¯å¦ç›¸åŒã€‚ ã€ŠHashMap çš„å·¥ä½œåŸç†ã€‹ HashMapçš„å·¥ä½œåŸç†æ˜¯è¿‘å¹´æ¥å¸¸è§çš„Javaé¢è¯•é¢˜ã€‚å‡ ä¹æ¯ä¸ªJavaç¨‹åºå‘˜éƒ½çŸ¥é“HashMapï¼Œéƒ½çŸ¥é“å“ªé‡Œè¦ç”¨HashMapï¼ŒçŸ¥é“ Hashtableå’ŒHashMapä¹‹é—´çš„åŒºåˆ«ï¼Œé‚£ä¹ˆä¸ºä½•è¿™é“é¢è¯•é¢˜å¦‚æ­¤ç‰¹æ®Šå‘¢ï¼Ÿæ˜¯å› ä¸ºè¿™é“é¢˜è€ƒå¯Ÿçš„æ·±åº¦å¾ˆæ·±ã€‚è¿™é¢˜ç»å¸¸å‡ºç°åœ¨é«˜çº§æˆ–ä¸­é«˜çº§é¢è¯•ä¸­ã€‚æŠ•èµ„é“¶è¡Œæ›´å–œæ¬¢é—®è¿™ä¸ªé—®é¢˜ï¼Œç”šè‡³ä¼šè¦æ±‚ä½ å®ç°HashMapæ¥è€ƒå¯Ÿä½ çš„ç¼–ç¨‹èƒ½åŠ›ã€‚ConcurrentHashMapå’Œå…¶å®ƒåŒæ­¥é›†åˆçš„å¼•å…¥è®©è¿™é“é¢˜å˜å¾—æ›´åŠ å¤æ‚ã€‚è®©æˆ‘ä»¬å¼€å§‹æ¢ç´¢çš„æ—…ç¨‹å§ï¼ å…ˆæ¥äº›ç®€å•çš„é—®é¢˜â€œä½ ç”¨è¿‡HashMapå—ï¼Ÿâ€ â€œä»€ä¹ˆæ˜¯HashMapï¼Ÿä½ ä¸ºä»€ä¹ˆç”¨åˆ°å®ƒï¼Ÿâ€ å‡ ä¹æ¯ä¸ªäººéƒ½ä¼šå›ç­”â€œæ˜¯çš„â€ï¼Œç„¶åå›ç­”HashMapçš„ä¸€äº›ç‰¹æ€§ï¼Œè­¬å¦‚HashMapå¯ä»¥æ¥å—nullé”®å€¼å’Œå€¼ï¼Œè€ŒHashtableåˆ™ä¸èƒ½ï¼›HashMapæ˜¯ésynchronized;HashMapå¾ˆå¿«ï¼›ä»¥åŠHashMapå‚¨å­˜çš„æ˜¯é”®å€¼å¯¹ç­‰ç­‰ã€‚è¿™æ˜¾ç¤ºå‡ºä½ å·²ç»ç”¨è¿‡HashMapï¼Œè€Œä¸”å¯¹å®ƒç›¸å½“çš„ç†Ÿæ‚‰ã€‚ä½†æ˜¯é¢è¯•å®˜æ¥ä¸ªæ€¥è½¬ç›´ä¸‹ï¼Œä»æ­¤åˆ»å¼€å§‹é—®å‡ºä¸€äº›åˆé’»çš„é—®é¢˜ï¼Œå…³äºHashMapçš„æ›´å¤šåŸºç¡€çš„ç»†èŠ‚ã€‚é¢è¯•å®˜å¯èƒ½ä¼šé—®å‡ºä¸‹é¢çš„é—®é¢˜ï¼š â€œä½ çŸ¥é“HashMapçš„å·¥ä½œåŸç†å—ï¼Ÿâ€ â€œä½ çŸ¥é“HashMapçš„get()æ–¹æ³•çš„å·¥ä½œåŸç†å—ï¼Ÿâ€ ä½ ä¹Ÿè®¸ä¼šå›ç­”â€œæˆ‘æ²¡æœ‰è¯¦æŸ¥æ ‡å‡†çš„Java APIï¼Œä½ å¯ä»¥çœ‹çœ‹Javaæºä»£ç æˆ–è€…Open JDKã€‚â€â€œæˆ‘å¯ä»¥ç”¨Googleæ‰¾åˆ°ç­”æ¡ˆã€‚â€ ä½†ä¸€äº›é¢è¯•è€…å¯èƒ½å¯ä»¥ç»™å‡ºç­”æ¡ˆï¼Œâ€œHashMapæ˜¯åŸºäºhashingçš„åŸç†ï¼Œæˆ‘ä»¬ä½¿ç”¨put(key, value)å­˜å‚¨å¯¹è±¡åˆ°HashMapä¸­ï¼Œä½¿ç”¨get(key)ä»HashMapä¸­è·å–å¯¹è±¡ã€‚å½“æˆ‘ä»¬ç»™put()æ–¹æ³•ä¼ é€’é”®å’Œå€¼æ—¶ï¼Œæˆ‘ä»¬å…ˆå¯¹é”®è°ƒç”¨hashCode()æ–¹æ³•ï¼Œè¿”å›çš„hashCodeç”¨äºæ‰¾åˆ°bucketä½ç½®æ¥å‚¨å­˜Entryå¯¹è±¡ã€‚â€è¿™é‡Œå…³é”®ç‚¹åœ¨äºæŒ‡å‡ºï¼ŒHashMapæ˜¯åœ¨bucketä¸­å‚¨å­˜é”®å¯¹è±¡å’Œå€¼å¯¹è±¡ï¼Œä½œä¸ºMap.Entryã€‚è¿™ä¸€ç‚¹æœ‰åŠ©äºç†è§£è·å–å¯¹è±¡çš„é€»è¾‘ã€‚å¦‚æœä½ æ²¡æœ‰æ„è¯†åˆ°è¿™ä¸€ç‚¹ï¼Œæˆ–è€…é”™è¯¯çš„è®¤ä¸ºä»…ä»…åªåœ¨bucketä¸­å­˜å‚¨å€¼çš„è¯ï¼Œä½ å°†ä¸ä¼šå›ç­”å¦‚ä½•ä»HashMapä¸­è·å–å¯¹è±¡çš„é€»è¾‘ã€‚è¿™ä¸ªç­”æ¡ˆç›¸å½“çš„æ­£ç¡®ï¼Œä¹Ÿæ˜¾ç¤ºå‡ºé¢è¯•è€…ç¡®å®çŸ¥é“hashingä»¥åŠHashMapçš„å·¥ä½œåŸç†ã€‚ä½†æ˜¯è¿™ä»…ä»…æ˜¯æ•…äº‹çš„å¼€å§‹ï¼Œå½“é¢è¯•å®˜åŠ å…¥ä¸€äº›Javaç¨‹åºå‘˜æ¯å¤©è¦ç¢°åˆ°çš„å®é™…åœºæ™¯çš„æ—¶å€™ï¼Œé”™è¯¯çš„ç­”æ¡ˆé¢‘ç°ã€‚ä¸‹ä¸ªé—®é¢˜å¯èƒ½æ˜¯å…³äºHashMapä¸­çš„ç¢°æ’æ¢æµ‹(collision detection)ä»¥åŠç¢°æ’çš„è§£å†³æ–¹æ³•ï¼š â€œå½“ä¸¤ä¸ªå¯¹è±¡çš„hashcodeç›¸åŒä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿâ€ ä»è¿™é‡Œå¼€å§‹ï¼ŒçœŸæ­£çš„å›°æƒ‘å¼€å§‹äº†ï¼Œä¸€äº›é¢è¯•è€…ä¼šå›ç­”å› ä¸ºhashcodeç›¸åŒï¼Œæ‰€ä»¥ä¸¤ä¸ªå¯¹è±¡æ˜¯ç›¸ç­‰çš„ï¼ŒHashMapå°†ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œæˆ–è€…ä¸ä¼šå­˜å‚¨å®ƒä»¬ã€‚ç„¶åé¢è¯•å®˜å¯èƒ½ä¼šæé†’ä»–ä»¬æœ‰equals()å’ŒhashCode()ä¸¤ä¸ªæ–¹æ³•ï¼Œå¹¶å‘Šè¯‰ä»–ä»¬ä¸¤ä¸ªå¯¹è±¡å°±ç®—hashcodeç›¸åŒï¼Œä½†æ˜¯å®ƒä»¬å¯èƒ½å¹¶ä¸ç›¸ç­‰ã€‚ä¸€äº›é¢è¯•è€…å¯èƒ½å°±æ­¤æ”¾å¼ƒï¼Œè€Œå¦å¤–ä¸€äº›è¿˜èƒ½ç»§ç»­æŒºè¿›ï¼Œä»–ä»¬å›ç­”â€œå› ä¸ºhashcodeç›¸åŒï¼Œæ‰€ä»¥å®ƒä»¬çš„bucketä½ç½®ç›¸åŒï¼Œâ€˜ç¢°æ’â€™ä¼šå‘ç”Ÿã€‚å› ä¸ºHashMapä½¿ç”¨é“¾è¡¨å­˜å‚¨å¯¹è±¡ï¼Œè¿™ä¸ªEntry(åŒ…å«æœ‰é”®å€¼å¯¹çš„Map.Entryå¯¹è±¡)ä¼šå­˜å‚¨åœ¨é“¾è¡¨ä¸­ã€‚â€è¿™ä¸ªç­”æ¡ˆéå¸¸çš„åˆç†ï¼Œè™½ç„¶æœ‰å¾ˆå¤šç§å¤„ç†ç¢°æ’çš„æ–¹æ³•ï¼Œè¿™ç§æ–¹æ³•æ˜¯æœ€ç®€å•çš„ï¼Œä¹Ÿæ­£æ˜¯HashMapçš„å¤„ç†æ–¹æ³•ã€‚ä½†æ•…äº‹è¿˜æ²¡æœ‰å®Œç»“ï¼Œé¢è¯•å®˜ä¼šç»§ç»­é—®ï¼š â€œå¦‚æœä¸¤ä¸ªé”®çš„hashcodeç›¸åŒï¼Œä½ å¦‚ä½•è·å–å€¼å¯¹è±¡ï¼Ÿâ€ é¢è¯•è€…ä¼šå›ç­”ï¼šå½“æˆ‘ä»¬è°ƒç”¨get()æ–¹æ³•ï¼ŒHashMapä¼šä½¿ç”¨é”®å¯¹è±¡çš„hashcodeæ‰¾åˆ°bucketä½ç½®ï¼Œç„¶åè·å–å€¼å¯¹è±¡ã€‚é¢è¯•å®˜æé†’ä»–å¦‚æœæœ‰ä¸¤ä¸ªå€¼å¯¹è±¡å‚¨å­˜åœ¨åŒä¸€ä¸ªbucketï¼Œä»–ç»™å‡ºç­”æ¡ˆ:å°†ä¼šéå†é“¾è¡¨ç›´åˆ°æ‰¾åˆ°å€¼å¯¹è±¡ã€‚é¢è¯•å®˜ä¼šé—®å› ä¸ºä½ å¹¶æ²¡æœ‰å€¼å¯¹è±¡å»æ¯”è¾ƒï¼Œä½ æ˜¯å¦‚ä½•ç¡®å®šç¡®å®šæ‰¾åˆ°å€¼å¯¹è±¡çš„ï¼Ÿé™¤éé¢è¯•è€…ç›´åˆ°HashMapåœ¨é“¾è¡¨ä¸­å­˜å‚¨çš„æ˜¯é”®å€¼å¯¹ï¼Œå¦åˆ™ä»–ä»¬ä¸å¯èƒ½å›ç­”å‡ºè¿™ä¸€é¢˜ã€‚ å…¶ä¸­ä¸€äº›è®°å¾—è¿™ä¸ªé‡è¦çŸ¥è¯†ç‚¹çš„é¢è¯•è€…ä¼šè¯´ï¼Œæ‰¾åˆ°bucketä½ç½®ä¹‹åï¼Œä¼šè°ƒç”¨keys.equals()æ–¹æ³•å»æ‰¾åˆ°é“¾è¡¨ä¸­æ­£ç¡®çš„èŠ‚ç‚¹ï¼Œæœ€ç»ˆæ‰¾åˆ°è¦æ‰¾çš„å€¼å¯¹è±¡ã€‚å®Œç¾çš„ç­”æ¡ˆï¼ è®¸å¤šæƒ…å†µä¸‹ï¼Œé¢è¯•è€…ä¼šåœ¨è¿™ä¸ªç¯èŠ‚ä¸­å‡ºé”™ï¼Œå› ä¸ºä»–ä»¬æ··æ·†äº†hashCode()å’Œequals()æ–¹æ³•ã€‚å› ä¸ºåœ¨æ­¤ä¹‹å‰hashCode()å±¡å±¡å‡ºç°ï¼Œè€Œequals()æ–¹æ³•ä»…ä»…åœ¨è·å–å€¼å¯¹è±¡çš„æ—¶å€™æ‰å‡ºç°ã€‚ä¸€äº›ä¼˜ç§€çš„å¼€å‘è€…ä¼šæŒ‡å‡ºä½¿ç”¨ä¸å¯å˜çš„ã€å£°æ˜ä½œfinalçš„å¯¹è±¡ï¼Œå¹¶ä¸”é‡‡ç”¨åˆé€‚çš„equals()å’ŒhashCode()æ–¹æ³•çš„è¯ï¼Œå°†ä¼šå‡å°‘ç¢°æ’çš„å‘ç”Ÿï¼Œæé«˜æ•ˆç‡ã€‚ä¸å¯å˜æ€§ä½¿å¾—èƒ½å¤Ÿç¼“å­˜ä¸åŒé”®çš„hashcodeï¼Œè¿™å°†æé«˜æ•´ä¸ªè·å–å¯¹è±¡çš„é€Ÿåº¦ï¼Œä½¿ç”¨Stringï¼ŒIntergerè¿™æ ·çš„wrapperç±»ä½œä¸ºé”®æ˜¯éå¸¸å¥½çš„é€‰æ‹©ã€‚ å¦‚æœä½ è®¤ä¸ºåˆ°è¿™é‡Œå·²ç»å®Œç»“äº†ï¼Œé‚£ä¹ˆå¬åˆ°ä¸‹é¢è¿™ä¸ªé—®é¢˜çš„æ—¶å€™ï¼Œä½ ä¼šå¤§åƒä¸€æƒŠã€‚ â€œå¦‚æœHashMapçš„å¤§å°è¶…è¿‡äº†è´Ÿè½½å› å­(load factor)å®šä¹‰çš„å®¹é‡ï¼Œæ€ä¹ˆåŠï¼Ÿâ€ é™¤éä½ çœŸæ­£çŸ¥é“HashMapçš„å·¥ä½œåŸç†ï¼Œå¦åˆ™ä½ å°†å›ç­”ä¸å‡ºè¿™é“é¢˜ã€‚é»˜è®¤çš„è´Ÿè½½å› å­å¤§å°ä¸º0.75ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ä¸€ä¸ªmapå¡«æ»¡äº†75%çš„bucketæ—¶å€™ï¼Œå’Œå…¶å®ƒé›†åˆç±»(å¦‚ArrayListç­‰)ä¸€æ ·ï¼Œå°†ä¼šåˆ›å»ºåŸæ¥HashMapå¤§å°çš„ä¸¤å€çš„bucketæ•°ç»„ï¼Œæ¥é‡æ–°è°ƒæ•´mapçš„å¤§å°ï¼Œå¹¶å°†åŸæ¥çš„å¯¹è±¡æ”¾å…¥æ–°çš„bucketæ•°ç»„ä¸­ã€‚è¿™ä¸ªè¿‡ç¨‹å«ä½œrehashingï¼Œå› ä¸ºå®ƒè°ƒç”¨hashæ–¹æ³•æ‰¾åˆ°æ–°çš„bucketä½ç½®ã€‚ å¦‚æœä½ èƒ½å¤Ÿå›ç­”è¿™é“é—®é¢˜ï¼Œä¸‹é¢çš„é—®é¢˜æ¥äº†ï¼š â€œä½ äº†è§£é‡æ–°è°ƒæ•´HashMapå¤§å°å­˜åœ¨ä»€ä¹ˆé—®é¢˜å—ï¼Ÿâ€ ä½ å¯èƒ½å›ç­”ä¸ä¸Šæ¥ï¼Œè¿™æ—¶é¢è¯•å®˜ä¼šæé†’ä½ å½“å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½äº§ç”Ÿæ¡ä»¶ç«äº‰(race condition)ã€‚ å½“é‡æ–°è°ƒæ•´HashMapå¤§å°çš„æ—¶å€™ï¼Œç¡®å®å­˜åœ¨æ¡ä»¶ç«äº‰ï¼Œå› ä¸ºå¦‚æœä¸¤ä¸ªçº¿ç¨‹éƒ½å‘ç°HashMapéœ€è¦é‡æ–°è°ƒæ•´å¤§å°äº†ï¼Œå®ƒä»¬ä¼šåŒæ—¶è¯•ç€è°ƒæ•´å¤§å°ã€‚åœ¨è°ƒæ•´å¤§å°çš„è¿‡ç¨‹ä¸­ï¼Œå­˜å‚¨åœ¨é“¾è¡¨ä¸­çš„å…ƒç´ çš„æ¬¡åºä¼šåè¿‡æ¥ï¼Œå› ä¸ºç§»åŠ¨åˆ°æ–°çš„bucketä½ç½®çš„æ—¶å€™ï¼ŒHashMapå¹¶ä¸ä¼šå°†å…ƒç´ æ”¾åœ¨é“¾è¡¨çš„å°¾éƒ¨ï¼Œè€Œæ˜¯æ”¾åœ¨å¤´éƒ¨ï¼Œè¿™æ˜¯ä¸ºäº†é¿å…å°¾éƒ¨éå†(tail traversing)ã€‚å¦‚æœæ¡ä»¶ç«äº‰å‘ç”Ÿäº†ï¼Œé‚£ä¹ˆå°±æ­»å¾ªç¯äº†ã€‚è¿™ä¸ªæ—¶å€™ï¼Œä½ å¯ä»¥è´¨é—®é¢è¯•å®˜ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆå¥‡æ€ªï¼Œè¦åœ¨å¤šçº¿ç¨‹çš„ç¯å¢ƒä¸‹ä½¿ç”¨HashMapå‘¢ï¼Ÿï¼šï¼‰ çƒ­å¿ƒçš„è¯»è€…è´¡çŒ®äº†æ›´å¤šçš„å…³äºHashMapçš„é—®é¢˜ï¼š ä¸ºä»€ä¹ˆString, Intergerè¿™æ ·çš„wrapperç±»é€‚åˆä½œä¸ºé”®ï¼Ÿ String, Intergerè¿™æ ·çš„wrapperç±»ä½œä¸ºHashMapçš„é”®æ˜¯å†é€‚åˆä¸è¿‡äº†ï¼Œè€Œä¸”Stringæœ€ä¸ºå¸¸ç”¨ã€‚å› ä¸ºStringæ˜¯ä¸å¯å˜çš„ï¼Œä¹Ÿæ˜¯finalçš„ï¼Œè€Œä¸”å·²ç»é‡å†™äº†equals()å’ŒhashCode()æ–¹æ³•äº†ã€‚å…¶ä»–çš„wrapperç±»ä¹Ÿæœ‰è¿™ä¸ªç‰¹ç‚¹ã€‚ä¸å¯å˜æ€§æ˜¯å¿…è¦çš„ï¼Œå› ä¸ºä¸ºäº†è¦è®¡ç®—hashCode()ï¼Œå°±è¦é˜²æ­¢é”®å€¼æ”¹å˜ï¼Œå¦‚æœé”®å€¼åœ¨æ”¾å…¥æ—¶å’Œè·å–æ—¶è¿”å›ä¸åŒçš„hashcodeçš„è¯ï¼Œé‚£ä¹ˆå°±ä¸èƒ½ä»HashMapä¸­æ‰¾åˆ°ä½ æƒ³è¦çš„å¯¹è±¡ã€‚ä¸å¯å˜æ€§è¿˜æœ‰å…¶ä»–çš„ä¼˜ç‚¹å¦‚çº¿ç¨‹å®‰å…¨ã€‚å¦‚æœä½ å¯ä»¥ä»…ä»…é€šè¿‡å°†æŸä¸ªfieldå£°æ˜æˆfinalå°±èƒ½ä¿è¯hashCodeæ˜¯ä¸å˜çš„ï¼Œé‚£ä¹ˆè¯·è¿™ä¹ˆåšå§ã€‚å› ä¸ºè·å–å¯¹è±¡çš„æ—¶å€™è¦ç”¨åˆ°equals()å’ŒhashCode()æ–¹æ³•ï¼Œé‚£ä¹ˆé”®å¯¹è±¡æ­£ç¡®çš„é‡å†™è¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯éå¸¸é‡è¦çš„ã€‚å¦‚æœä¸¤ä¸ªä¸ç›¸ç­‰çš„å¯¹è±¡è¿”å›ä¸åŒçš„hashcodeçš„è¯ï¼Œé‚£ä¹ˆç¢°æ’çš„å‡ ç‡å°±ä¼šå°äº›ï¼Œè¿™æ ·å°±èƒ½æé«˜HashMapçš„æ€§èƒ½ã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„å¯¹è±¡ä½œä¸ºé”®å—ï¼Ÿ è¿™æ˜¯å‰ä¸€ä¸ªé—®é¢˜çš„å»¶ä¼¸ã€‚å½“ç„¶ä½ å¯èƒ½ä½¿ç”¨ä»»ä½•å¯¹è±¡ä½œä¸ºé”®ï¼Œåªè¦å®ƒéµå®ˆäº†equals()å’ŒhashCode()æ–¹æ³•çš„å®šä¹‰è§„åˆ™ï¼Œå¹¶ä¸”å½“å¯¹è±¡æ’å…¥åˆ°Mapä¸­ä¹‹åå°†ä¸ä¼šå†æ”¹å˜äº†ã€‚å¦‚æœè¿™ä¸ªè‡ªå®šä¹‰å¯¹è±¡æ—¶ä¸å¯å˜çš„ï¼Œé‚£ä¹ˆå®ƒå·²ç»æ»¡è¶³äº†ä½œä¸ºé”®çš„æ¡ä»¶ï¼Œå› ä¸ºå½“å®ƒåˆ›å»ºä¹‹åå°±å·²ç»ä¸èƒ½æ”¹å˜äº†ã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨CocurrentHashMapæ¥ä»£æ›¿Hashtableå—ï¼Ÿ è¿™æ˜¯å¦å¤–ä¸€ä¸ªå¾ˆçƒ­é—¨çš„é¢è¯•é¢˜ï¼Œå› ä¸ºConcurrentHashMapè¶Šæ¥è¶Šå¤šäººç”¨äº†ã€‚æˆ‘ä»¬çŸ¥é“Hashtableæ˜¯synchronizedçš„ï¼Œä½†æ˜¯ConcurrentHashMapåŒæ­¥æ€§èƒ½æ›´å¥½ï¼Œå› ä¸ºå®ƒä»…ä»…æ ¹æ®åŒæ­¥çº§åˆ«å¯¹mapçš„ä¸€éƒ¨åˆ†è¿›è¡Œä¸Šé”ã€‚ConcurrentHashMapå½“ç„¶å¯ä»¥ä»£æ›¿HashTableï¼Œä½†æ˜¯HashTableæä¾›æ›´å¼ºçš„çº¿ç¨‹å®‰å…¨æ€§ã€‚çœ‹çœ‹ è¿™ç¯‡åšå®¢ æŸ¥çœ‹Hashtableå’ŒConcurrentHashMapçš„åŒºåˆ«ã€‚ æˆ‘ä¸ªäººå¾ˆå–œæ¬¢è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºè¿™ä¸ªé—®é¢˜çš„æ·±åº¦å’Œå¹¿åº¦ï¼Œä¹Ÿä¸ç›´æ¥çš„æ¶‰åŠåˆ°ä¸åŒçš„æ¦‚å¿µã€‚è®©æˆ‘ä»¬å†æ¥çœ‹çœ‹è¿™äº›é—®é¢˜è®¾è®¡å“ªäº›çŸ¥è¯†ç‚¹ï¼š hashingçš„æ¦‚å¿µ HashMapä¸­è§£å†³ç¢°æ’çš„æ–¹æ³• equals()å’ŒhashCode()çš„åº”ç”¨ï¼Œä»¥åŠå®ƒä»¬åœ¨HashMapä¸­çš„é‡è¦æ€§ ä¸å¯å˜å¯¹è±¡çš„å¥½å¤„ HashMapå¤šçº¿ç¨‹çš„æ¡ä»¶ç«äº‰ é‡æ–°è°ƒæ•´HashMapçš„å¤§å° æ€»ç»“HashMapçš„å·¥ä½œåŸç†HashMapåŸºäºhashingåŸç†ï¼Œæˆ‘ä»¬é€šè¿‡put()å’Œget()æ–¹æ³•å‚¨å­˜å’Œè·å–å¯¹è±¡ã€‚å½“æˆ‘ä»¬å°†é”®å€¼å¯¹ä¼ é€’ç»™put()æ–¹æ³•æ—¶ï¼Œå®ƒè°ƒç”¨é”®å¯¹è±¡çš„hashCode()æ–¹æ³•æ¥è®¡ç®—hashcodeï¼Œè®©åæ‰¾åˆ°bucketä½ç½®æ¥å‚¨å­˜å€¼å¯¹è±¡ã€‚å½“è·å–å¯¹è±¡æ—¶ï¼Œé€šè¿‡é”®å¯¹è±¡çš„equals()æ–¹æ³•æ‰¾åˆ°æ­£ç¡®çš„é”®å€¼å¯¹ï¼Œç„¶åè¿”å›å€¼å¯¹è±¡ã€‚HashMapä½¿ç”¨é“¾è¡¨æ¥è§£å†³ç¢°æ’é—®é¢˜ï¼Œå½“å‘ç”Ÿç¢°æ’äº†ï¼Œå¯¹è±¡å°†ä¼šå‚¨å­˜åœ¨é“¾è¡¨çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ä¸­ã€‚ HashMapåœ¨æ¯ä¸ªé“¾è¡¨èŠ‚ç‚¹ä¸­å‚¨å­˜é”®å€¼å¯¹å¯¹è±¡ã€‚ å½“ä¸¤ä¸ªä¸åŒçš„é”®å¯¹è±¡çš„hashcodeç›¸åŒæ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ å®ƒä»¬ä¼šå‚¨å­˜åœ¨åŒä¸€ä¸ªbucketä½ç½®çš„é“¾è¡¨ä¸­ã€‚é”®å¯¹è±¡çš„equals()æ–¹æ³•ç”¨æ¥æ‰¾åˆ°é”®å€¼å¯¹ã€‚ å› ä¸ºHashMapçš„å¥½å¤„éå¸¸å¤šï¼Œæˆ‘æ›¾ç»åœ¨ç”µå­å•†åŠ¡çš„åº”ç”¨ä¸­ä½¿ç”¨HashMapä½œä¸ºç¼“å­˜ã€‚å› ä¸ºé‡‘èé¢†åŸŸéå¸¸å¤šçš„è¿ç”¨Javaï¼Œä¹Ÿå‡ºäºæ€§èƒ½çš„è€ƒè™‘ï¼Œæˆ‘ä»¬ä¼šç»å¸¸ç”¨åˆ°HashMapå’ŒConcurrentHashMapã€‚ä½ å¯ä»¥æŸ¥çœ‹æ›´å¤šçš„å…³äºHashMapçš„æ–‡ç« : HashMapå’ŒHashtableçš„åŒºåˆ« HashMapå’ŒHashSetçš„åŒºåˆ« è½¬è½½è‡ªï¼šHashMapçš„å·¥ä½œåŸç† å…¶ä»–çš„ HashMap å­¦ä¹ èµ„æ–™ï¼š jdk7ä¸­HashMapçŸ¥è¯†ç‚¹æ•´ç† HashMapæºç åˆ†æï¼ˆå››ï¼‰put-jdk8-çº¢é»‘æ ‘çš„å¼•å…¥ JDK7ä¸JDK8ä¸­HashMapçš„å®ç° JDK1.8HashMapåŸç†å’Œæºç åˆ†æ(javaé¢è¯•æ”¶è—) è°ˆè°ˆConcurrentHashMap1.7å’Œ1.8çš„ä¸åŒå®ç° jdk1.8çš„HashMapå’ŒConcurrentHashMap ConcurrentHashMapæºç åˆ†æï¼ˆJDK8ç‰ˆæœ¬ï¼‰ æœ€åè°¢è°¢é˜…è¯»ï¼Œå¦‚æœå¯ä»¥çš„è¯æ¬¢è¿å¤§å®¶è½¬å‘å’Œç‚¹èµã€‚å¦‚éœ€è½¬è½½æ³¨æ˜åŸåœ°å€å°±è¡Œã€‚ ç¾¤ 528776268 æ¬¢è¿å„ä½å¤§ç‰›è¿›ç¾¤ä¸€èµ·è®¨è®ºã€‚","tags":[{"name":"Java","slug":"Java","permalink":"http://www.54tianzhisheng.cn/tags/Java/"}]},{"title":"JVMæ€§èƒ½è°ƒä¼˜ç›‘æ§å·¥å…·jpsã€jstackã€jmapã€jhatã€jstatç­‰ä½¿ç”¨è¯¦è§£","date":"2017-06-12T16:00:00.000Z","path":"2017/06/13/JVMæ€§èƒ½è°ƒä¼˜ç›‘æ§å·¥å…·jpsã€jstackã€jmapã€jhatã€jstatç­‰ä½¿ç”¨è¯¦è§£/","text":"javap å’Œ javac javac -verbose ç±»å.java java -verbose ç±»å javap -c ç±»å javap -verbose ç±»å javap -helpç”¨æ³•: javap å…¶ä¸­, å¯èƒ½çš„é€‰é¡¹åŒ…æ‹¬: -help â€“help -? è¾“å‡ºæ­¤ç”¨æ³•æ¶ˆæ¯ -version ç‰ˆæœ¬ä¿¡æ¯ -v -verbose è¾“å‡ºé™„åŠ ä¿¡æ¯ -l è¾“å‡ºè¡Œå·å’Œæœ¬åœ°å˜é‡è¡¨ -public ä»…æ˜¾ç¤ºå…¬å…±ç±»å’Œæˆå‘˜ -protected æ˜¾ç¤ºå—ä¿æŠ¤çš„/å…¬å…±ç±»å’Œæˆå‘˜ -package æ˜¾ç¤ºç¨‹åºåŒ…/å—ä¿æŠ¤çš„/å…¬å…±ç±» å’Œæˆå‘˜ (é»˜è®¤) -p -private æ˜¾ç¤ºæ‰€æœ‰ç±»å’Œæˆå‘˜ -c å¯¹ä»£ç è¿›è¡Œåæ±‡ç¼– -s è¾“å‡ºå†…éƒ¨ç±»å‹ç­¾å -sysinfo æ˜¾ç¤ºæ­£åœ¨å¤„ç†çš„ç±»çš„ ç³»ç»Ÿä¿¡æ¯ (è·¯å¾„, å¤§å°, æ—¥æœŸ, MD5 æ•£åˆ—) -constants æ˜¾ç¤ºæœ€ç»ˆå¸¸é‡ -classpath æŒ‡å®šæŸ¥æ‰¾ç”¨æˆ·ç±»æ–‡ä»¶çš„ä½ç½® -cp æŒ‡å®šæŸ¥æ‰¾ç”¨æˆ·ç±»æ–‡ä»¶çš„ä½ç½® -bootclasspath è¦†ç›–å¼•å¯¼ç±»æ–‡ä»¶çš„ä½ç½® javac -helpç”¨æ³•: javac å…¶ä¸­, å¯èƒ½çš„é€‰é¡¹åŒ…æ‹¬: -g ç”Ÿæˆæ‰€æœ‰è°ƒè¯•ä¿¡æ¯ -g:none ä¸ç”Ÿæˆä»»ä½•è°ƒè¯•ä¿¡æ¯ -g:{lines,vars,source} åªç”ŸæˆæŸäº›è°ƒè¯•ä¿¡æ¯ -nowarn ä¸ç”Ÿæˆä»»ä½•è­¦å‘Š -verbose è¾“å‡ºæœ‰å…³ç¼–è¯‘å™¨æ­£åœ¨æ‰§è¡Œçš„æ“ä½œçš„æ¶ˆæ¯ -deprecation è¾“å‡ºä½¿ç”¨å·²è¿‡æ—¶çš„ API çš„æºä½ç½® -classpath &lt;è·¯å¾„&gt; æŒ‡å®šæŸ¥æ‰¾ç”¨æˆ·ç±»æ–‡ä»¶å’Œæ³¨é‡Šå¤„ç†ç¨‹åºçš„ä½ç½® -cp &lt;è·¯å¾„&gt; æŒ‡å®šæŸ¥æ‰¾ç”¨æˆ·ç±»æ–‡ä»¶å’Œæ³¨é‡Šå¤„ç†ç¨‹åºçš„ä½ç½® -sourcepath &lt;è·¯å¾„&gt; æŒ‡å®šæŸ¥æ‰¾è¾“å…¥æºæ–‡ä»¶çš„ä½ç½® -bootclasspath &lt;è·¯å¾„&gt; è¦†ç›–å¼•å¯¼ç±»æ–‡ä»¶çš„ä½ç½® -extdirs &lt;ç›®å½•&gt; è¦†ç›–æ‰€å®‰è£…æ‰©å±•çš„ä½ç½® -endorseddirs &lt;ç›®å½•&gt; è¦†ç›–ç­¾åçš„æ ‡å‡†è·¯å¾„çš„ä½ç½® -proc:{none,only} æ§åˆ¶æ˜¯å¦æ‰§è¡Œæ³¨é‡Šå¤„ç†å’Œ/æˆ–ç¼–è¯‘ã€‚ -processor [,,â€¦] è¦è¿è¡Œçš„æ³¨é‡Šå¤„ç†ç¨‹åºçš„åç§°; ç»•è¿‡é»˜è®¤çš„æœç´¢è¿›ç¨‹ -processorpath &lt;è·¯å¾„&gt; æŒ‡å®šæŸ¥æ‰¾æ³¨é‡Šå¤„ç†ç¨‹åºçš„ä½ç½® -parameters ç”Ÿæˆå…ƒæ•°æ®ä»¥ç”¨äºæ–¹æ³•å‚æ•°çš„åå°„ -d &lt;ç›®å½•&gt; æŒ‡å®šæ”¾ç½®ç”Ÿæˆçš„ç±»æ–‡ä»¶çš„ä½ç½® -s &lt;ç›®å½•&gt; æŒ‡å®šæ”¾ç½®ç”Ÿæˆçš„æºæ–‡ä»¶çš„ä½ç½® -h &lt;ç›®å½•&gt; æŒ‡å®šæ”¾ç½®ç”Ÿæˆçš„æœ¬æœºæ ‡å¤´æ–‡ä»¶çš„ä½ç½® -implicit:{none,class} æŒ‡å®šæ˜¯å¦ä¸ºéšå¼å¼•ç”¨æ–‡ä»¶ç”Ÿæˆç±»æ–‡ä»¶ -encoding &lt;ç¼–ç &gt; æŒ‡å®šæºæ–‡ä»¶ä½¿ç”¨çš„å­—ç¬¦ç¼–ç  -source &lt;å‘è¡Œç‰ˆ&gt; æä¾›ä¸æŒ‡å®šå‘è¡Œç‰ˆçš„æºå…¼å®¹æ€§ -target &lt;å‘è¡Œç‰ˆ&gt; ç”Ÿæˆç‰¹å®š VM ç‰ˆæœ¬çš„ç±»æ–‡ä»¶ -profile &lt;é…ç½®æ–‡ä»¶&gt; è¯·ç¡®ä¿ä½¿ç”¨çš„ API åœ¨æŒ‡å®šçš„é…ç½®æ–‡ä»¶ä¸­å¯ç”¨ -version ç‰ˆæœ¬ä¿¡æ¯ -help è¾“å‡ºæ ‡å‡†é€‰é¡¹çš„æè¦ -Aå…³é”®å­—[=å€¼] ä¼ é€’ç»™æ³¨é‡Šå¤„ç†ç¨‹åºçš„é€‰é¡¹ -X è¾“å‡ºéæ ‡å‡†é€‰é¡¹çš„æè¦ -J&lt;æ ‡è®°&gt; ç›´æ¥å°† &lt;æ ‡è®°&gt; ä¼ é€’ç»™è¿è¡Œæ—¶ç³»ç»Ÿ -Werror å‡ºç°è­¦å‘Šæ—¶ç»ˆæ­¢ç¼–è¯‘ @&lt;æ–‡ä»¶å&gt; ä»æ–‡ä»¶è¯»å–é€‰é¡¹å’Œæ–‡ä»¶å jpsç”¨æ¥æŸ¥çœ‹åŸºäºHotSpotçš„JVMé‡Œé¢ä¸­ï¼Œæ‰€æœ‰å…·æœ‰è®¿é—®æƒé™çš„Javaè¿›ç¨‹çš„å…·ä½“çŠ¶æ€, åŒ…æ‹¬è¿›ç¨‹IDï¼Œè¿›ç¨‹å¯åŠ¨çš„è·¯å¾„åŠå¯åŠ¨å‚æ•°ç­‰ç­‰ï¼Œä¸unixä¸Šçš„psç±»ä¼¼ï¼Œåªä¸è¿‡jpsæ˜¯ç”¨æ¥æ˜¾ç¤ºjavaè¿›ç¨‹ï¼Œå¯ä»¥æŠŠjpsç†è§£ä¸ºpsçš„ä¸€ä¸ªå­é›†ã€‚ ä½¿ç”¨jpsæ—¶ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šhostidï¼Œå®ƒåªä¼šæ˜¾ç¤ºæœ¬åœ°ç¯å¢ƒä¸­æ‰€æœ‰çš„Javaè¿›ç¨‹ï¼›å¦‚æœæŒ‡å®šäº†hostidï¼Œå®ƒå°±ä¼šæ˜¾ç¤ºæŒ‡å®šhostidä¸Šé¢çš„javaè¿›ç¨‹ï¼Œä¸è¿‡è¿™éœ€è¦è¿œç¨‹æœåŠ¡ä¸Šå¼€å¯äº†jstatdæœåŠ¡ã€‚ jps -helpusage: jps [-help] jps [-q] [-mlvV] [&lt;hostid&gt;] Definitions: &lt;hostid&gt;: &lt;hostname&gt;[:&lt;port&gt;] -qï¼šå¿½ç•¥è¾“å‡ºçš„ç±»åã€Jaråä»¥åŠä¼ é€’ç»™mainæ–¹æ³•çš„å‚æ•°ï¼Œåªè¾“å‡ºpidã€‚ -mï¼šè¾“å‡ºä¼ é€’ç»™mainæ–¹æ³•çš„å‚æ•°ï¼Œå¦‚æœæ˜¯å†…åµŒçš„JVMåˆ™è¾“å‡ºä¸ºnullã€‚ -lï¼šè¾“å‡ºå®Œå…¨çš„åŒ…åï¼Œåº”ç”¨ä¸»ç±»åï¼Œjarçš„å®Œå…¨è·¯å¾„å -vï¼šè¾“å‡ºä¼ ç»™jvmçš„å‚æ•° -Vï¼šè¾“å‡ºé€šè¿‡æ ‡è®°çš„æ–‡ä»¶ä¼ é€’ç»™JVMçš„å‚æ•°ï¼ˆ.hotspotrcæ–‡ä»¶ï¼Œæˆ–è€…æ˜¯é€šè¿‡å‚æ•°-XX:Flags=æŒ‡å®šçš„æ–‡ä»¶ï¼‰ã€‚ -J ç”¨äºä¼ é€’jvmé€‰é¡¹åˆ°ç”±javacè°ƒç”¨çš„javaåŠ è½½å™¨ä¸­ï¼Œä¾‹å¦‚ï¼Œâ€œ-J-Xms48mâ€å°†æŠŠå¯åŠ¨å†…å­˜è®¾ç½®ä¸º48Mï¼Œä½¿ç”¨-Jé€‰é¡¹å¯ä»¥éå¸¸æ–¹ä¾¿çš„å‘åŸºäºJavaçš„å¼€å‘çš„åº•å±‚è™šæ‹Ÿæœºåº”ç”¨ç¨‹åºä¼ é€’å‚æ•°ã€‚ jstackjstackç”¨äºæ‰“å°å‡ºç»™å®šçš„javaè¿›ç¨‹IDæˆ–core fileæˆ–è¿œç¨‹è°ƒè¯•æœåŠ¡çš„Javaå †æ ˆä¿¡æ¯ï¼Œå¦‚æœæ˜¯åœ¨64ä½æœºå™¨ä¸Šï¼Œéœ€è¦æŒ‡å®šé€‰é¡¹â€-J-d64â€ï¼ŒWindowsçš„jstackä½¿ç”¨æ–¹å¼åªæ”¯æŒä»¥ä¸‹çš„è¿™ç§æ–¹å¼ï¼š jstack [-l] pid å¦‚æœjavaç¨‹åºå´©æºƒç”Ÿæˆcoreæ–‡ä»¶ï¼Œjstackå·¥å…·å¯ä»¥ç”¨æ¥è·å¾—coreæ–‡ä»¶çš„java stackå’Œnative stackçš„ä¿¡æ¯ï¼Œä»è€Œå¯ä»¥è½»æ¾åœ°çŸ¥é“javaç¨‹åºæ˜¯å¦‚ä½•å´©æºƒå’Œåœ¨ç¨‹åºä½•å¤„å‘ç”Ÿé—®é¢˜ã€‚å¦å¤–ï¼Œjstackå·¥å…·è¿˜å¯ä»¥é™„å±åˆ°æ­£åœ¨è¿è¡Œçš„javaç¨‹åºä¸­ï¼Œçœ‹åˆ°å½“æ—¶è¿è¡Œçš„javaç¨‹åºçš„java stackå’Œnative stackçš„ä¿¡æ¯, å¦‚æœç°åœ¨è¿è¡Œçš„javaç¨‹åºå‘ˆç°hungçš„çŠ¶æ€ï¼Œjstackæ˜¯éå¸¸æœ‰ç”¨çš„ã€‚ jstack -helpUsage: jstack [-l] &lt;pid&gt; (to connect to running process) jstack -F [-m] [-l] &lt;pid&gt; (to connect to a hung process) jstack [-m] [-l] &lt;executable&gt; &lt;core&gt; (to connect to a core file) jstack [-m] [-l] [server_id@]&lt;remote server IP or hostname&gt; (to connect to a remote debug server) Options: -F to force a thread dump. Use when jstack &lt;pid&gt; does not respond (process is hung)(å½“â€™jstack [-l] pidâ€™æ²¡æœ‰ç›¸åº”çš„æ—¶å€™å¼ºåˆ¶æ‰“å°æ ˆä¿¡æ¯) -m to print both java and native frames (mixed mode)(æ‰“å°javaå’Œnative c/c++æ¡†æ¶çš„æ‰€æœ‰æ ˆä¿¡æ¯.) -l long listing. Prints additional information about locks (é•¿åˆ—è¡¨. æ‰“å°å…³äºé”çš„é™„åŠ ä¿¡æ¯,ä¾‹å¦‚å±äºjava.util.concurrentçš„ownable synchronizersåˆ—è¡¨.) -h or -help to print this help message (æ‰“å°å¸®åŠ©ä¿¡æ¯) jstatJstat ç”¨äºç›‘æ§åŸºäºHotSpotçš„JVMï¼Œå¯¹å…¶å †çš„ä½¿ç”¨æƒ…å†µè¿›è¡Œå®æ—¶çš„å‘½ä»¤è¡Œçš„ç»Ÿè®¡ï¼Œä½¿ç”¨jstatæˆ‘ä»¬å¯ä»¥å¯¹æŒ‡å®šçš„JVMåšå¦‚ä¸‹ç›‘æ§ï¼š ç±»çš„åŠ è½½åŠå¸è½½æƒ…å†µ æŸ¥çœ‹æ–°ç”Ÿä»£ã€è€ç”Ÿä»£åŠæŒä¹…ä»£çš„å®¹é‡åŠä½¿ç”¨æƒ…å†µ æŸ¥çœ‹æ–°ç”Ÿä»£ã€è€ç”Ÿä»£åŠæŒä¹…ä»£çš„åƒåœ¾æ”¶é›†æƒ…å†µï¼ŒåŒ…æ‹¬åƒåœ¾å›æ”¶çš„æ¬¡æ•°åŠåƒåœ¾å›æ”¶æ‰€å ç”¨çš„æ—¶é—´ æŸ¥çœ‹æ–°ç”Ÿä»£ä¸­EdenåŒºåŠSurvioråŒºä¸­å®¹é‡åŠåˆ†é…æƒ…å†µç­‰ jstat -help Usage: jstat -help|-options jstat -&lt;option&gt; [-t] [-h&lt;lines&gt;] &lt;vmid&gt; [&lt;interval&gt; [&lt;count&gt;]] Definitions:&gt; An option reported by the -options option Virtual Machine Identifier. A vmid takes the following form: [@[:]] Where is the local vm identifier for the target Java virtual machine, typically a process id; is the name of the host running the target Java virtual machine; and is the port number for the rmiregistry on the target host. See the jvmstat documentation for a more complete description of the Virtual Machine Identifier. Number of samples between header lines. Sampling interval. The following forms are allowed: [â€œmsâ€|â€sâ€] Where is an integer and the suffix specifies the units as milliseconds(â€œmsâ€) or seconds(â€œsâ€). The default units are â€œmsâ€. Number of samples to take before terminating. -J Pass directly to the runtime system. å‚è€ƒæ–‡ç« 1ã€jstatå‘½ä»¤è¯¦è§£ 2ã€jstatå‘½ä»¤(Java Virtual Machine Statistics Monitoring Tool) 3ã€http://docs.oracle.com/javase/1.5.0/docs/tooldocs/share/jstat.html#class_option jmapæ‰“å°å‡ºæŸä¸ªjavaè¿›ç¨‹ï¼ˆä½¿ç”¨pidï¼‰å†…å­˜å†…çš„ï¼Œæ‰€æœ‰â€˜å¯¹è±¡â€™çš„æƒ…å†µï¼ˆå¦‚ï¼šäº§ç”Ÿé‚£äº›å¯¹è±¡ï¼ŒåŠå…¶æ•°é‡ï¼‰ã€‚ å¯ä»¥è¾“å‡ºæ‰€æœ‰å†…å­˜ä¸­å¯¹è±¡çš„å·¥å…·ï¼Œç”šè‡³å¯ä»¥å°†VM ä¸­çš„heapï¼Œä»¥äºŒè¿›åˆ¶è¾“å‡ºæˆæ–‡æœ¬ã€‚ä½¿ç”¨æ–¹æ³• jmap -histo pid å¦‚æœè¿ç”¨SHELL jmap -histo pid&gt;a.log å¯ä»¥å°†å…¶ä¿å­˜åˆ°æ–‡æœ¬ä¸­å»ï¼Œåœ¨ä¸€æ®µæ—¶é—´åï¼Œä½¿ç”¨æ–‡æœ¬å¯¹æ¯”å·¥å…·ï¼Œå¯ä»¥å¯¹æ¯”å‡ºGCå›æ”¶äº†å“ªäº›å¯¹è±¡ã€‚ jmap -dump:format=b,file=outfile 3024 å¯ä»¥å°†3024è¿›ç¨‹çš„å†…å­˜heapè¾“å‡ºå‡ºæ¥åˆ°outfileæ–‡ä»¶é‡Œï¼Œå†é…åˆMATï¼ˆå†…å­˜åˆ†æå·¥å…·(Memory Analysis Toolï¼‰ï¼Œä½¿ç”¨å‚è§ï¼šhttp://blog.csdn.net/fenglibing/archive/2011/04/02/6298326.aspxï¼‰æˆ–ä¸jhat (Java Heap Analysis Tool)ä¸€èµ·ä½¿ç”¨ï¼Œèƒ½å¤Ÿä»¥å›¾åƒçš„å½¢å¼ç›´è§‚çš„å±•ç¤ºå½“å‰å†…å­˜æ˜¯å¦æœ‰é—®é¢˜ã€‚ 64ä½æœºä¸Šä½¿ç”¨éœ€è¦ä½¿ç”¨å¦‚ä¸‹æ–¹å¼ï¼š jmap -J-d64 -heap pid jmap -helpUsage: jmap [option] &lt;pid&gt; (to connect to running process) jmap [option] &lt;executable &lt;core&gt; (to connect to a core file) jmap [option] [server_id@]&lt;remote server IP or hostname&gt; (to connect to remote debug server) where is one of: &lt;none&gt; to print same info as Solaris pmap -heap to print java heap summary -histo[:live] to print histogram of java object heap; if the &quot;live&quot; suboption is specified, only count live objects -clstats to print class loader statistics -finalizerinfo to print information on objects awaiting finalization -dump:&lt;dump-options&gt; to dump java heap in hprof binary format dump-options: live dump only live objects; if not specified, all objects in the heap are dumped. format=b binary format file=&lt;file&gt; dump heap to &lt;file&gt; Example: jmap -dump:live,format=b,file=heap.bin &lt;pid&gt; -F force. Use with -dump:&lt;dump-options&gt; &lt;pid&gt; or -histo to force a heap dump or histogram when &lt;pid&gt; does not respond. The &quot;live&quot; suboption is not supported in this mode. -h | -help to print this help message -J&lt;flag&gt; to pass &lt;flag&gt; directly to the runtime system å‚æ•°è¯´æ˜ 1)ã€optionsï¼š executable Java executable from which the core dump was produced.(å¯èƒ½æ˜¯äº§ç”Ÿcore dumpçš„javaå¯æ‰§è¡Œç¨‹åº) core å°†è¢«æ‰“å°ä¿¡æ¯çš„core dumpæ–‡ä»¶ remote-hostname-or-IP è¿œç¨‹debugæœåŠ¡çš„ä¸»æœºåæˆ–ip server-id å”¯ä¸€id,å‡å¦‚ä¸€å°ä¸»æœºä¸Šå¤šä¸ªè¿œç¨‹debugæœåŠ¡ 2ï¼‰ã€åŸºæœ¬å‚æ•°ï¼š -dump:[live,]format=b,file= ä½¿ç”¨hprofäºŒè¿›åˆ¶å½¢å¼,è¾“å‡ºjvmçš„heapå†…å®¹åˆ°æ–‡ä»¶=. liveå­é€‰é¡¹æ˜¯å¯é€‰çš„ï¼Œå‡å¦‚æŒ‡å®šliveé€‰é¡¹,é‚£ä¹ˆåªè¾“å‡ºæ´»çš„å¯¹è±¡åˆ°æ–‡ä»¶. -finalizerinfo æ‰“å°æ­£ç­‰å€™å›æ”¶çš„å¯¹è±¡çš„ä¿¡æ¯. -heap æ‰“å°heapçš„æ¦‚è¦ä¿¡æ¯ï¼ŒGCä½¿ç”¨çš„ç®—æ³•ï¼Œheapçš„é…ç½®åŠwise heapçš„ä½¿ç”¨æƒ…å†µ. -histo[:live] æ‰“å°æ¯ä¸ªclassçš„å®ä¾‹æ•°ç›®,å†…å­˜å ç”¨,ç±»å…¨åä¿¡æ¯. VMçš„å†…éƒ¨ç±»åå­—å¼€å¤´ä¼šåŠ ä¸Šå‰ç¼€â€*â€. å¦‚æœliveå­å‚æ•°åŠ ä¸Šå,åªç»Ÿè®¡æ´»çš„å¯¹è±¡æ•°é‡. -permstat æ‰“å°classloadå’Œjvm heapé•¿ä¹…å±‚çš„ä¿¡æ¯. åŒ…å«æ¯ä¸ªclassloaderçš„åå­—,æ´»æ³¼æ€§,åœ°å€,çˆ¶classloaderå’ŒåŠ è½½çš„classæ•°é‡. å¦å¤–,å†…éƒ¨Stringçš„æ•°é‡å’Œå ç”¨å†…å­˜æ•°ä¹Ÿä¼šæ‰“å°å‡ºæ¥. -F å¼ºè¿«.åœ¨pidæ²¡æœ‰ç›¸åº”çš„æ—¶å€™ä½¿ç”¨-dumpæˆ–è€…-histoå‚æ•°. åœ¨è¿™ä¸ªæ¨¡å¼ä¸‹,liveå­å‚æ•°æ— æ•ˆ. -h | -help æ‰“å°è¾…åŠ©ä¿¡æ¯ -J ä¼ é€’å‚æ•°ç»™jmapå¯åŠ¨çš„jvm. pid éœ€è¦è¢«æ‰“å°é…ç›¸ä¿¡æ¯çš„javaè¿›ç¨‹id,åˆ›ä¸šä¸æ‰“å·¥çš„åŒºåˆ« - åšæ–‡é¢„è§ˆ,å¯ä»¥ç”¨jpsæŸ¥é—®. jinfojinfo å¯ä»¥è¾“å‡ºå¹¶ä¿®æ”¹è¿è¡Œæ—¶çš„java è¿›ç¨‹çš„optsã€‚ ç”¨å¤„æ¯”è¾ƒç®€å•ï¼Œç”¨äºè¾“å‡ºJAVAç³»ç»Ÿå‚æ•°åŠå‘½ä»¤è¡Œå‚æ•°ã€‚ ç”¨æ³•æ˜¯ jinfo -opt pid å¦‚ï¼šæŸ¥çœ‹2788çš„MaxPermå¤§å°å¯ä»¥ç”¨ jinfo -flag MaxPermSize 2788ã€‚ jinfo -help Usage: jinfo [option] &lt;pid&gt; (to connect to running process) jinfo [option] &lt;executable &lt;core&gt; (to connect to a core file) jinfo [option] [server_id@]&lt;remote server IP or hostname&gt; (to connect to remote debug server) where is one of: -flag &lt;name&gt; to print the value of the named VM flag -flag [+|-]&lt;name&gt; to enable or disable the named VM flag -flag &lt;name&gt;=&lt;value&gt; to set the named VM flag to the given value -flags to print VM flags -sysprops to print Java system properties &lt;no option&gt; to print both of the above -h | -help to print this help message jconsoleä¸€ä¸ªjava GUIç›‘è§†å·¥å…·ï¼Œå¯ä»¥ä»¥å›¾è¡¨åŒ–çš„å½¢å¼æ˜¾ç¤ºå„ç§æ•°æ®ã€‚å¹¶å¯é€šè¿‡è¿œç¨‹è¿æ¥ç›‘è§†è¿œç¨‹çš„æœåŠ¡å™¨VMã€‚ç”¨javaå†™çš„GUIç¨‹åºï¼Œç”¨æ¥ç›‘æ§VMï¼Œå¹¶å¯ç›‘æ§è¿œç¨‹çš„VMï¼Œéå¸¸æ˜“ç”¨ï¼Œè€Œä¸”åŠŸèƒ½éå¸¸å¼ºã€‚å‘½ä»¤è¡Œé‡Œæ‰“ jconsoleï¼Œé€‰åˆ™è¿›ç¨‹å°±å¯ä»¥äº†ã€‚ éœ€è¦æ³¨æ„çš„å°±æ˜¯åœ¨è¿è¡Œjconsoleä¹‹å‰ï¼Œå¿…é¡»è¦å…ˆè®¾ç½®ç¯å¢ƒå˜é‡DISPLAYï¼Œå¦åˆ™ä¼šæŠ¥é”™è¯¯ï¼ŒLinuxä¸‹è®¾ç½®ç¯å¢ƒå˜é‡å¦‚ä¸‹ï¼š export DISPLAY=:0.0 å¯ä»¥è¿™é‡Œé€‰æ‹©æŸ¥çœ‹æœ¬åœ°è¿›ç¨‹çš„çŠ¶å†µï¼Œè¿˜æ˜¯è¿œç¨‹è¿›ç¨‹çš„çŠ¶å†µ é€šè¿‡è¿™å¼ å›¾å¯ä»¥çœ‹åˆ°å†…å­˜ã€çº¿ç¨‹ã€ç±»åŠCPUä½¿ç”¨çš„ä¸€äº›æƒ…å†µã€‚ jvisualvmå‚è€ƒæ–‡ç« ï¼š ç¨‹åºå‘˜å¿…å¤‡åˆ©å™¨â€”Javaç¨‹åºæ€§èƒ½åˆ†æå·¥å…·Java VisualVMï¼ˆVisual GCï¼‰ jhatç”¨äºå¯¹JAVA heapè¿›è¡Œç¦»çº¿åˆ†æçš„å·¥å…·ï¼Œä»–å¯ä»¥å¯¹ä¸åŒè™šæ‹Ÿæœºä¸­å¯¼å‡ºçš„heapä¿¡æ¯æ–‡ä»¶è¿›è¡Œåˆ†æï¼Œå¦‚Linuxä¸Šå¯¼å‡ºçš„æ–‡ä»¶å¯ä»¥æ‹¿åˆ°WINDOWSä¸Šè¿›è¡Œåˆ†æï¼Œå¯ä»¥æŸ¥æ‰¾è¯¸å¦‚å†…å­˜æ–¹é¢çš„é—®é¢˜ï¼Œä½¿ç”¨æ–¹å¼å¯ä»¥æŸ¥çœ‹è¿™ç¯‡æ–‡ç« ï¼š jhatå‘½ä»¤ ä¸è¿‡jhatå’ŒMATæ¯”è¾ƒèµ·æ¥ï¼Œå°±æ²¡æœ‰MATé‚£ä¹ˆç›´è§‚äº†ï¼ŒMATæ˜¯ä»¥å›¾å½¢ç•Œé¢çš„æ–¹å¼å±•ç°ç»“æœï¼ŒMATçš„ä½¿ç”¨æ–¹å¼å¯ä»¥å‚çœ‹æ–‡ç« ï¼š MAT(Memory Analyzer Tool)å·¥å…·å…¥é—¨ä»‹ç» Usage:jhat [-stack ] [-refs ] [-port ] [-baseline ] [-debug ] [-version] [-h|-help] -J&lt;flag&gt; Pass &lt;flag&gt; directly to the runtime system. For example, -J-mx512m to use a maximum heap size of 512MB -stack false: Turn off tracking object allocation call stack. -refs false: Turn off tracking of references to objects -port &lt;port&gt;: Set the port for the HTTP server. Defaults to 7000 -exclude &lt;file&gt;: Specify a file that lists data members that should be excluded from the reachableFrom query. -baseline &lt;file&gt;: Specify a baseline object dump. Objects in both heap dumps with the same ID and same class will be marked as not being &quot;new&quot;. -debug &lt;int&gt;: Set debug level. 0: No debug output 1: Debug hprof file parsing 2: Debug hprof file parsing, no server -version Report version number -h|-help Print this help and exit &lt;file&gt; The file to read jdbç”¨æ¥å¯¹coreæ–‡ä»¶å’Œæ­£åœ¨è¿è¡Œçš„Javaè¿›ç¨‹è¿›è¡Œå®æ—¶åœ°è°ƒè¯•ï¼Œé‡Œé¢åŒ…å«äº†ä¸°å¯Œçš„å‘½ä»¤å¸®åŠ©æ‚¨è¿›è¡Œè°ƒè¯•ï¼Œå®ƒçš„åŠŸèƒ½å’ŒSun studioé‡Œé¢æ‰€å¸¦çš„dbxéå¸¸ç›¸ä¼¼ï¼Œä½† jdbæ˜¯ä¸“é—¨ç”¨æ¥é’ˆå¯¹Javaåº”ç”¨ç¨‹åºçš„ã€‚ jstatdjstatdæ˜¯ä¸€ä¸ªåŸºäºRMIï¼ˆRemove Method Invocationï¼‰çš„æœåŠ¡ç¨‹åºï¼Œå®ƒç”¨äºç›‘æ§åŸºäºHotSpotçš„JVMä¸­èµ„æºçš„åˆ›å»ºåŠé”€æ¯ï¼Œå¹¶ä¸”æä¾›äº†ä¸€ä¸ªè¿œç¨‹æ¥å£å…è®¸è¿œç¨‹çš„ç›‘æ§å·¥å…·è¿æ¥åˆ°æœ¬åœ°çš„JVMæ‰§è¡Œå‘½ä»¤ã€‚ jstatdæ˜¯åŸºäºRMIçš„ï¼Œæ‰€ä»¥åœ¨è¿è¡Œjstatdçš„æœåŠ¡å™¨ä¸Šå¿…é¡»å­˜åœ¨RMIæ³¨å†Œä¸­å¿ƒï¼Œå¦‚æœæ²¡æœ‰é€šè¿‡é€‰é¡¹â€-p portâ€æŒ‡å®šè¦è¿æ¥çš„ç«¯å£ï¼Œjstatdä¼šå°è¯•è¿æ¥RMIæ³¨å†Œä¸­å¿ƒçš„é»˜è®¤ç«¯å£ã€‚ ç”¨æ³•ï¼š jstatd [-nr] [-p port] [-n rminame] -nr å¦‚æœRMIæ³¨å†Œä¸­å¿ƒæ²¡æœ‰æ‰¾åˆ°ï¼Œä¸ä¼šåˆ›å»ºä¸€ä¸ªå†…éƒ¨çš„RMIæ³¨å†Œä¸­å¿ƒã€‚ -p port RMIæ³¨å†Œä¸­å¿ƒçš„ç«¯å£å·ï¼Œé»˜è®¤ä¸º1099ã€‚ -n rminame é»˜è®¤ä¸ºJStatRemoteHostï¼›å¦‚æœåŒä¸€å°ä¸»æœºä¸ŠåŒæ—¶è¿è¡Œäº†å¤šä¸ªjstatdæœåŠ¡ï¼Œrminameå¯ä»¥ç”¨äºå”¯ä¸€ç¡®å®šä¸€ä¸ªjstatdæœåŠ¡ï¼›è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œå¦‚æœå¼€å¯äº†è¿™ä¸ªé€‰é¡¹ï¼Œé‚£ä¹ˆç›‘æ§å®¢æˆ·ç«¯è¿œç¨‹è¿æ¥æ—¶ï¼Œå¿…é¡»åŒæ—¶æŒ‡å®šhostidåŠvmidï¼Œæ‰å¯ä»¥å”¯ä¸€ç¡®å®šè¦è¿æ¥çš„æœåŠ¡ï¼Œè¿™ä¸ªå¯ä»¥å‚çœ‹jpsç« èŠ‚ä¸­åˆ—å‡ºè¿œç¨‹æœåŠ¡å™¨ä¸ŠJavaè¿›ç¨‹çš„ç¤ºä¾‹ã€‚ -J ç”¨äºä¼ é€’jvmé€‰é¡¹åˆ°ç”±javacè°ƒç”¨çš„javaåŠ è½½å™¨ä¸­ï¼Œä¾‹å¦‚ï¼Œâ€œ-J-Xms48mâ€å°†æŠŠå¯åŠ¨å†…å­˜è®¾ç½®ä¸º48Mï¼Œä½¿ç”¨-Jé€‰é¡¹å¯ä»¥éå¸¸æ–¹ä¾¿çš„å‘åŸºäºJavaçš„å¼€å‘çš„åº•å±‚è™šæ‹Ÿæœºåº”ç”¨ç¨‹åºä¼ é€’å‚æ•°ã€‚ å‚è€ƒæ–‡ç«  JDKå†…ç½®å·¥å…·ä½¿ç”¨","tags":[{"name":"JVM","slug":"JVM","permalink":"http://www.54tianzhisheng.cn/tags/JVM/"},{"name":"æ€§èƒ½è°ƒä¼˜å·¥å…·","slug":"æ€§èƒ½è°ƒä¼˜å·¥å…·","permalink":"http://www.54tianzhisheng.cn/tags/æ€§èƒ½è°ƒä¼˜å·¥å…·/"}]},{"title":"Pythonçˆ¬è™«å®æˆ˜ä¹‹çˆ¬å–ç™¾åº¦è´´å§å¸–å­","date":"2017-06-12T16:00:00.000Z","path":"2017/06/13/Pythonçˆ¬è™«å®æˆ˜ä¹‹çˆ¬å–ç™¾åº¦è´´å§å¸–å­/","text":"å¤§å®¶å¥½ï¼Œä¸Šæ¬¡æˆ‘ä»¬å®éªŒäº†çˆ¬å–äº†ç³—äº‹ç™¾ç§‘çš„æ®µå­ï¼Œé‚£ä¹ˆè¿™æ¬¡æˆ‘ä»¬æ¥å°è¯•ä¸€ä¸‹çˆ¬å–ç™¾åº¦è´´å§çš„å¸–å­ã€‚ä¸ä¸Šä¸€ç¯‡ä¸åŒçš„æ˜¯ï¼Œè¿™æ¬¡æˆ‘ä»¬éœ€è¦ç”¨åˆ°æ–‡ä»¶çš„ç›¸å…³æ“ä½œã€‚ æœ¬ç¯‡ç›®æ ‡ å¯¹ç™¾åº¦è´´å§çš„ä»»æ„å¸–å­è¿›è¡ŒæŠ“å– æŒ‡å®šæ˜¯å¦åªæŠ“å–æ¥¼ä¸»å‘å¸–å†…å®¹ å°†æŠ“å–åˆ°çš„å†…å®¹åˆ†æå¹¶ä¿å­˜åˆ°æ–‡ä»¶ 1. URLæ ¼å¼çš„ç¡®å®šé¦–å…ˆï¼Œæˆ‘ä»¬å…ˆè§‚å¯Ÿä¸€ä¸‹ç™¾åº¦è´´å§çš„ä»»æ„ä¸€ä¸ªå¸–å­ã€‚ æ¯”å¦‚ï¼šhttp://tieba.baidu.com/p/3138733512?see_lz=1&amp;pn=1ï¼Œè¿™æ˜¯ä¸€ä¸ªå…³äºNBA50å¤§çš„ç›˜ç‚¹ï¼Œåˆ†æä¸€ä¸‹è¿™ä¸ªåœ°å€ã€‚ http:// ä»£è¡¨èµ„æºä¼ è¾“ä½¿ç”¨httpåè®® tieba.baidu.com æ˜¯ç™¾åº¦çš„äºŒçº§åŸŸåï¼ŒæŒ‡å‘ç™¾åº¦è´´å§çš„æœåŠ¡å™¨ã€‚ /p/3138733512 æ˜¯æœåŠ¡å™¨æŸä¸ªèµ„æºï¼Œå³è¿™ä¸ªå¸–å­çš„åœ°å€å®šä½ç¬¦ see_lz å’Œ pn æ˜¯è¯¥ URL çš„ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«ä»£è¡¨äº†åªçœ‹æ¥¼ä¸»å’Œå¸–å­é¡µç ï¼Œç­‰äº1è¡¨ç¤ºè¯¥æ¡ä»¶ä¸ºçœŸ æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠŠURLåˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†ä¸ºåŸºç¡€éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†ä¸ºå‚æ•°éƒ¨åˆ†ã€‚ ä¾‹å¦‚ï¼Œä¸Šé¢çš„URLæˆ‘ä»¬åˆ’åˆ†åŸºç¡€éƒ¨åˆ†æ˜¯ http://tieba.baidu.com/p/3138733512ï¼Œå‚æ•°éƒ¨åˆ†æ˜¯ ?see_lz=1&amp;pn=1 2. é¡µé¢çš„æŠ“å–ç†Ÿæ‚‰äº†URLçš„æ ¼å¼ï¼Œé‚£å°±è®©æˆ‘ä»¬ç”¨urllib2åº“æ¥è¯•ç€æŠ“å–é¡µé¢å†…å®¹å§ã€‚ä¸Šä¸€ç¯‡ç³—äº‹ç™¾ç§‘æˆ‘ä»¬æœ€åæ”¹æˆäº†é¢å‘å¯¹è±¡çš„ç¼–ç æ–¹å¼ï¼Œè¿™æ¬¡æˆ‘ä»¬ç›´æ¥å°è¯•ä¸€ä¸‹ï¼Œå®šä¹‰ä¸€ä¸ªç±»åå«BDTB(ç™¾åº¦è´´å§)ï¼Œä¸€ä¸ªåˆå§‹åŒ–æ–¹æ³•ï¼Œä¸€ä¸ªè·å–é¡µé¢çš„æ–¹æ³•ã€‚ å…¶ä¸­ï¼Œæœ‰äº›å¸–å­æˆ‘ä»¬æƒ³æŒ‡å®šç»™ç¨‹åºæ˜¯å¦è¦åªçœ‹æ¥¼ä¸»ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠåªçœ‹æ¥¼ä¸»çš„å‚æ•°åˆå§‹åŒ–æ”¾åœ¨ç±»çš„åˆå§‹åŒ–ä¸Šï¼Œå³initæ–¹æ³•ã€‚å¦å¤–ï¼Œè·å–é¡µé¢çš„æ–¹æ³•æˆ‘ä»¬éœ€è¦çŸ¥é“ä¸€ä¸ªå‚æ•°å°±æ˜¯å¸–å­é¡µç ï¼Œæ‰€ä»¥è¿™ä¸ªå‚æ•°çš„æŒ‡å®šæˆ‘ä»¬æ”¾åœ¨è¯¥æ–¹æ³•ä¸­ã€‚ ç»¼ä¸Šï¼Œæˆ‘ä»¬åˆæ­¥æ„å»ºå‡ºåŸºç¡€ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526#-*-coding:utf8-*-#created by 10412import urllibimport urllib2import re#ç™¾åº¦è´´å§çˆ¬è™«ç±»class BDTB: #åˆå§‹åŒ–ï¼Œä¼ å…¥åŸºåœ°å€ï¼Œæ˜¯å¦åªçœ‹æ¥¼ä¸»çš„å‚æ•° def __init__(self, baseUrl, seeLZ): self.baseURL = baseUrl self.seeLZ = &apos;?see_lz=&apos; + str(seeLZ) #ä¼ å…¥é¡µç ï¼Œè·å–è¯¥é¡µå¸–å­çš„ä»£ç  def getPage(self, pageNum): try: url = self.baseURL + self.seeLZ + &apos;&amp;pn=&apos; + str(pageNum) request = urllib2.Request(url) response = urllib2.urlopen(request) print response.read() return response except urllib2.URLError, e: if hasattr(e, &quot;reason&quot;): print u&quot;è¿æ¥ç™¾åº¦è´´å§å¤±è´¥,é”™è¯¯åŸå› &quot;,e.reason return NonebaseURL = &apos;http://tieba.baidu.com/p/3138733512&apos;bdtb = BDTB(baseURL, 1)bdtb.getPage(1) è¿è¡Œä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å±å¹•ä¸Šæ‰“å°å‡ºäº†è¿™ä¸ªå¸–å­ç¬¬ä¸€é¡µæ¥¼ä¸»å‘è¨€çš„æ‰€æœ‰å†…å®¹ï¼Œå½¢å¼ä¸ºHTMLä»£ç ã€‚ 3. æå–ç›¸å…³ä¿¡æ¯1)æå–å¸–å­æ ‡é¢˜åœ¨æµè§ˆå™¨ä¸­å®¡æŸ¥å…ƒç´ ï¼Œæˆ–è€…æŒ‰F12ï¼ŒæŸ¥çœ‹é¡µé¢æºä»£ç ï¼Œæˆ‘ä»¬æ‰¾åˆ°æ ‡é¢˜æ‰€åœ¨çš„ä»£ç æ®µå¦‚ä¸‹: 1&lt;h3 class=\"core_title_txt pull-left text-overflow \" title=\"çº¯åŸåˆ›æˆ‘å¿ƒä¸­çš„NBA2014-2015èµ›å­£ç°å½¹50å¤§\" style=\"width: 416px\"&gt;çº¯åŸåˆ›æˆ‘å¿ƒä¸­çš„NBA2014-2015èµ›å­£ç°å½¹50å¤§&lt;/h3&gt; æ‰€ä»¥æˆ‘ä»¬è¦æå– &lt;h3&gt; ä¸­çš„å†…å®¹ï¼Œå› ä¸ºä¸€å¼€å§‹å¯ä»¥æŸ¥çœ‹æ•´ä¸ªç•Œé¢çš„åŸä»£ç ï¼ŒæŸ¥çœ‹é‡Œé¢å«æœ‰ &lt;h3&gt;æ ‡ç­¾çš„ä¸æ­¢ä¸€ä¸ªã€‚æ‰€ä»¥éœ€è¦å†™æ­£åˆ™è¡¨è¾¾å¼æ¥åŒ¹é…ï¼Œå¦‚ä¸‹ï¼š 1&lt;h3 class=&quot;core_title_txt.*?&gt;(.*?)&lt;/h3&gt; ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥å†™ä¸ªè·å–æ ‡é¢˜çš„æ–¹æ³• 12345678910# è·å–å¸–å­æ ‡é¢˜ def getTitle(self): page = self.getPage(1) pattern = re.compile(&apos;&lt;h3 class=&quot;core_title_txt.*?&gt;(.*?)&lt;/h3&gt;&apos;, re.S) result = re.search(pattern, page) if result: # print result.group(1) #æµ‹è¯•è¾“å‡º return result.group(1).strip() else: return None 2ï¼‰æå–å¸–å­é¡µæ•°åŒæ ·åœ°ï¼Œå¸–å­æ€»é¡µæ•°æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡åˆ†æé¡µé¢ä¸­çš„å…±?é¡µæ¥è·å–ã€‚ 1&lt;li class=\"l_reply_num\" style=\"margin-left:8px\"&gt;&lt;span class=\"red\" style=\"margin-right:3px\"&gt;4784&lt;/span&gt;å›å¤è´´ï¼Œå…±&lt;span class=\"red\"&gt;36&lt;/span&gt;é¡µ&lt;/li&gt; æ‰€ä»¥æˆ‘ä»¬çš„è·å–æ€»é¡µæ•°çš„æ–¹æ³•å¦‚ä¸‹ 12345678910#è·å–å¸–å­ä¸€å…±æœ‰å¤šå°‘é¡µdef getPageNum(self): page = self.getPage(1) pattern = re.compile('&lt;li class=\"l_reply_num.*?&lt;/span&gt;.*?&lt;span.*?&gt;(.*?)&lt;/span&gt;',re.S) result = re.search(pattern,page) if result: #print result.group(1) #æµ‹è¯•è¾“å‡º return result.group(1).strip() else: return None 3ï¼‰æå–æ­£æ–‡å†…å®¹å®¡æŸ¥å…ƒç´ ï¼Œå¯ä»¥çœ‹åˆ°ç™¾åº¦è´´å§æ¯ä¸€å±‚æ¥¼çš„ä¸»è¦å†…å®¹éƒ½åœ¨æ ‡ç­¾é‡Œé¢ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å†™å¦‚ä¸‹çš„æ­£åˆ™è¡¨è¾¾å¼ 1&lt;div id=\"post_content_.*?&gt;(.*?)&lt;/div&gt; æ‰€ä»¥æå–æ­£æ–‡å†…å®¹çš„æ–¹æ³•ï¼š 123456#è·å–æ¯ä¸€å±‚æ¥¼çš„å†…å®¹,ä¼ å…¥é¡µé¢å†…å®¹def getContent(self,page): pattern = re.compile('&lt;div id=\"post_content_.*?&gt;(.*?)&lt;/div&gt;',re.S) items = re.findall(pattern,page) for item in items: print item è¿è¡Œæˆªå›¾å¦‚ä¸‹ï¼š å¯ä»¥çœ‹åˆ°æœ‰å¾ˆå¤šçš„æ¢è¡Œç¬¦å’Œå›¾ç‰‡ç¬¦ï¼Œæ—¢ç„¶å‡ºç°è¿™æ ·çš„æƒ…å†µï¼Œé‚£è‚¯å®šä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœã€‚é‚£æˆ‘ä»¬å°±å¿…é¡»è¦å°†æ–‡æœ¬è¿›è¡Œå¤„ç†ï¼Œå°†å„ç§å¤æ‚çš„æ ‡ç­¾ç»™å‰”é™¤ï¼Œè¿˜åŸå¸–å­çš„åŸæ¥é¢è²Œã€‚å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ–¹æ³•æˆ–è€…ç±»å°†è¿™ä¸ªå¤„ç†æ–‡æœ¬çš„å®ç°ï¼Œä¸è¿‡ä¸ºäº†æ›´å¥½çš„ä»£ç é‡ç”¨å’Œæ¶æ„ï¼Œè¿˜æ˜¯å»ºè®®ä½¿ç”¨ä¸€ä¸ªç±»ã€‚ æˆ‘ä»¬å°†è¿™ä¸ªç±»å‘½åä¸ºTooï¼ˆå·¥å…·ç±»ï¼‰ï¼Œé‡Œé¢å®šä¹‰ä¸€ä¸ªreplaceæ–¹æ³•ï¼Œæ›¿æ¢å„ç§æ ‡ç­¾ã€‚ç„¶ååœ¨ç±»ä¸­å®šä¹‰å‡ ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œåˆ©ç”¨re.subæ–¹æ³•å¯¹æ–‡æœ¬è¿›è¡ŒåŒ¹é…åç„¶åæ›¿æ¢ã€‚ 123456789101112131415161718192021222324252627import re#å¤„ç†é¡µé¢æ ‡ç­¾ç±»class Tool: #å»é™¤imgæ ‡ç­¾,7ä½é•¿ç©ºæ ¼ removeImg = re.compile('&lt;img.*?&gt;| &#123;7&#125;|') #åˆ é™¤è¶…é“¾æ¥æ ‡ç­¾ removeAddr = re.compile('&lt;a.*?&gt;|&lt;/a&gt;') #æŠŠæ¢è¡Œçš„æ ‡ç­¾æ¢ä¸º\\n replaceLine = re.compile('&lt;tr&gt;|&lt;div&gt;|&lt;/div&gt;|&lt;/p&gt;') #å°†è¡¨æ ¼åˆ¶è¡¨&lt;td&gt;æ›¿æ¢ä¸º\\t replaceTD= re.compile('&lt;td&gt;') #æŠŠæ®µè½å¼€å¤´æ¢ä¸º\\nåŠ ç©ºä¸¤æ ¼ replacePara = re.compile('&lt;p.*?&gt;') #å°†æ¢è¡Œç¬¦æˆ–åŒæ¢è¡Œç¬¦æ›¿æ¢ä¸º\\n replaceBR = re.compile('&lt;br&gt;&lt;br&gt;|&lt;br&gt;') #å°†å…¶ä½™æ ‡ç­¾å‰”é™¤ removeExtraTag = re.compile('&lt;.*?&gt;') def replace(self,x): x = re.sub(self.removeImg,\"\",x) x = re.sub(self.removeAddr,\"\",x) x = re.sub(self.replaceLine,\"\\n\",x) x = re.sub(self.replaceTD,\"\\t\",x) x = re.sub(self.replacePara,\"\\n \",x) x = re.sub(self.replaceBR,\"\\n\",x) x = re.sub(self.removeExtraTag,\"\",x) #strip()å°†å‰åå¤šä½™å†…å®¹åˆ é™¤ return x.strip() åœ¨ä½¿ç”¨æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦åˆå§‹åŒ–ä¸€ä¸‹è¿™ä¸ªç±»ï¼Œç„¶åè°ƒç”¨replaceæ–¹æ³•å³å¯ã€‚ ç°åœ¨æ•´ä½“ä»£ç æ˜¯å¦‚ä¸‹è¿™æ ·å­çš„ï¼Œç°åœ¨æˆ‘çš„ä»£ç æ˜¯å†™åˆ°è¿™æ ·å­çš„: 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879#-*-coding:utf8-*-#created by 10412import urllibimport urllib2import re# å¤„ç†é¡µé¢æ ‡ç­¾ç±»class Tool: # å»é™¤imgæ ‡ç­¾,7ä½é•¿ç©ºæ ¼ removeImg = re.compile('&lt;img.*?&gt;| &#123;7&#125;|') # åˆ é™¤è¶…é“¾æ¥æ ‡ç­¾ removeAddr = re.compile('&lt;a.*?&gt;|&lt;/a&gt;') # æŠŠæ¢è¡Œçš„æ ‡ç­¾æ¢ä¸º\\n replaceLine = re.compile('&lt;tr&gt;|&lt;div&gt;|&lt;/div&gt;|&lt;/p&gt;') # å°†è¡¨æ ¼åˆ¶è¡¨&lt;td&gt;æ›¿æ¢ä¸º\\t replaceTD = re.compile('&lt;td&gt;') # æŠŠæ®µè½å¼€å¤´æ¢ä¸º\\nåŠ ç©ºä¸¤æ ¼ replacePara = re.compile('&lt;p.*?&gt;') # å°†æ¢è¡Œç¬¦æˆ–åŒæ¢è¡Œç¬¦æ›¿æ¢ä¸º\\n replaceBR = re.compile('&lt;br&gt;&lt;br&gt;|&lt;br&gt;') # å°†å…¶ä½™æ ‡ç­¾å‰”é™¤ removeExtraTag = re.compile('&lt;.*?&gt;') def replace(self, x): x = re.sub(self.removeImg, \"\", x) x = re.sub(self.removeAddr, \"\", x) x = re.sub(self.replaceLine, \"\\n\", x) x = re.sub(self.replaceTD, \"\\t\", x) x = re.sub(self.replacePara, \"\\n \", x) x = re.sub(self.replaceBR, \"\\n\", x) x = re.sub(self.removeExtraTag, \"\", x) # strip()å°†å‰åå¤šä½™å†…å®¹åˆ é™¤ return x.strip()# ç™¾åº¦è´´å§çˆ¬è™«ç±»class BDTB: # åˆå§‹åŒ–ï¼Œä¼ å…¥åŸºåœ°å€ï¼Œæ˜¯å¦åªçœ‹æ¥¼ä¸»çš„å‚æ•° def __init__(self, baseUrl, seeLZ): self.baseURL = baseUrl self.seeLZ = '?see_lz=' + str(seeLZ) self.tool = Tool() # ä¼ å…¥é¡µç ï¼Œè·å–è¯¥é¡µå¸–å­çš„ä»£ç  def getPage(self, pageNum): try: url = self.baseURL + self.seeLZ + '&amp;pn=' + str(pageNum) request = urllib2.Request(url) response = urllib2.urlopen(request) return response.read().decode('utf-8') except urllib2.URLError, e: if hasattr(e, \"reason\"): print u\"è¿æ¥ç™¾åº¦è´´å§å¤±è´¥,é”™è¯¯åŸå› \", e.reason return None # è·å–å¸–å­æ ‡é¢˜ def getTitle(self): page = self.getPage(1) pattern = re.compile('&lt;h1 class=\"core_title_txt.*?&gt;(.*?)&lt;/h1&gt;', re.S) result = re.search(pattern, page) if result: # print result.group(1) #æµ‹è¯•è¾“å‡º return result.group(1).strip() else: return None # è·å–å¸–å­ä¸€å…±æœ‰å¤šå°‘é¡µ def getPageNum(self): page = self.getPage(1) pattern = re.compile('&lt;li class=\"l_reply_num.*?&lt;/span&gt;.*?&lt;span.*?&gt;(.*?)&lt;/span&gt;', re.S) result = re.search(pattern, page) if result: # print result.group(1) #æµ‹è¯•è¾“å‡º return result.group(1).strip() else: return None # è·å–æ¯ä¸€å±‚æ¥¼çš„å†…å®¹,ä¼ å…¥é¡µé¢å†…å®¹ def getContent(self, page): pattern = re.compile('&lt;div id=\"post_content_.*?&gt;(.*?)&lt;/div&gt;', re.S) items = re.findall(pattern, page) # for item in items: # print item print self.tool.replace(items[1])baseURL = 'http://tieba.baidu.com/p/3138733512'bdtb = BDTB(baseURL, 1)bdtb.getContent(bdtb.getPage(1)) è¿è¡Œæˆªå›¾å¦‚ä¸‹ï¼š 4ï¼‰æ›¿æ¢æ¥¼å±‚è‡³äºè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘æ„Ÿè§‰ç›´æ¥æå–æ¥¼å±‚æ²¡ä»€ä¹ˆå¿…è¦å‘€ï¼Œå› ä¸ºåªçœ‹æ¥¼ä¸»çš„è¯ï¼Œæœ‰äº›æ¥¼å±‚çš„ç¼–å·æ˜¯é—´éš”çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—åˆ°çš„æ¥¼å±‚åºå·æ˜¯ä¸è¿ç»­çš„ï¼Œè¿™æ ·æˆ‘ä»¬ä¿å­˜ä¸‹æ¥ä¹Ÿæ²¡ä»€ä¹ˆç”¨ã€‚ æ‰€ä»¥å¯ä»¥å°è¯•ä¸‹é¢çš„æ–¹æ³•ï¼š 1.æ¯æ‰“å°è¾“å‡ºä¸€æ®µæ¥¼å±‚ï¼Œå†™å…¥ä¸€è¡Œæ¨ªçº¿æ¥é—´éš”ï¼Œæˆ–è€…æ¢è¡Œç¬¦ä¹Ÿå¥½ã€‚ 2.è¯•ç€é‡æ–°ç¼–ä¸€ä¸ªæ¥¼å±‚ï¼ŒæŒ‰ç…§é¡ºåºï¼Œè®¾ç½®ä¸€ä¸ªå˜é‡ï¼Œæ¯æ‰“å°å‡ºä¸€ä¸ªç»“æœå˜é‡åŠ ä¸€ï¼Œæ‰“å°å‡ºè¿™ä¸ªå˜é‡å½“åšæ¥¼å±‚ã€‚ å°†getContentæ–¹æ³•ä¿®æ”¹å¦‚ä¸‹ï¼š 123456789#è·å–æ¯ä¸€å±‚æ¥¼çš„å†…å®¹,ä¼ å…¥é¡µé¢å†…å®¹def getContent(self,page): pattern = re.compile('&lt;div id=\"post_content_.*?&gt;(.*?)&lt;/div&gt;',re.S) items = re.findall(pattern,page) floor = 1 for item in items: print floor,u\"æ¥¼------------------------------------------------------------------------------------------------------------------------------------\\n\" print self.tool.replace(item) floor += 1 è¿è¡Œç»“æœæˆªå›¾å¦‚ä¸‹ï¼š 4. å†™å…¥æ–‡ä»¶ä»£ç ï¼š 12file = open(â€œtb.txtâ€,â€wâ€)file.writelines(obj) 5. å®Œå–„ä»£ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134#-*-coding:utf8-*-#created by 10412import urllibimport urllib2import re#å¤„ç†é¡µé¢æ ‡ç­¾ç±»class Tool: #å»é™¤imgæ ‡ç­¾,7ä½é•¿ç©ºæ ¼ removeImg = re.compile('&lt;img.*?&gt;| &#123;7&#125;|') #åˆ é™¤è¶…é“¾æ¥æ ‡ç­¾ removeAddr = re.compile('&lt;a.*?&gt;|&lt;/a&gt;') #æŠŠæ¢è¡Œçš„æ ‡ç­¾æ¢ä¸º\\n replaceLine = re.compile('&lt;tr&gt;|&lt;div&gt;|&lt;/div&gt;|&lt;/p&gt;') #å°†è¡¨æ ¼åˆ¶è¡¨&lt;td&gt;æ›¿æ¢ä¸º\\t replaceTD= re.compile('&lt;td&gt;') #æŠŠæ®µè½å¼€å¤´æ¢ä¸º\\nåŠ ç©ºä¸¤æ ¼ replacePara = re.compile('&lt;p.*?&gt;') #å°†æ¢è¡Œç¬¦æˆ–åŒæ¢è¡Œç¬¦æ›¿æ¢ä¸º\\n replaceBR = re.compile('&lt;br&gt;&lt;br&gt;|&lt;br&gt;') #å°†å…¶ä½™æ ‡ç­¾å‰”é™¤ removeExtraTag = re.compile('&lt;.*?&gt;') def replace(self,x): x = re.sub(self.removeImg,\"\",x) x = re.sub(self.removeAddr,\"\",x) x = re.sub(self.replaceLine,\"\\n\",x) x = re.sub(self.replaceTD,\"\\t\",x) x = re.sub(self.replacePara,\"\\n \",x) x = re.sub(self.replaceBR,\"\\n\",x) x = re.sub(self.removeExtraTag,\"\",x) #strip()å°†å‰åå¤šä½™å†…å®¹åˆ é™¤ return x.strip()#ç™¾åº¦è´´å§çˆ¬è™«ç±»class BDTB: #åˆå§‹åŒ–ï¼Œä¼ å…¥åŸºåœ°å€ï¼Œæ˜¯å¦åªçœ‹æ¥¼ä¸»çš„å‚æ•° def __init__(self,baseUrl,seeLZ,floorTag): #baseé“¾æ¥åœ°å€ self.baseURL = baseUrl #æ˜¯å¦åªçœ‹æ¥¼ä¸» self.seeLZ = '?see_lz='+str(seeLZ) #HTMLæ ‡ç­¾å‰”é™¤å·¥å…·ç±»å¯¹è±¡ self.tool = Tool() #å…¨å±€fileå˜é‡ï¼Œæ–‡ä»¶å†™å…¥æ“ä½œå¯¹è±¡ self.file = None #æ¥¼å±‚æ ‡å·ï¼Œåˆå§‹ä¸º1 self.floor = 1 #é»˜è®¤çš„æ ‡é¢˜ï¼Œå¦‚æœæ²¡æœ‰æˆåŠŸè·å–åˆ°æ ‡é¢˜çš„è¯åˆ™ä¼šç”¨è¿™ä¸ªæ ‡é¢˜ self.defaultTitle = u\"ç™¾åº¦è´´å§\" #æ˜¯å¦å†™å…¥æ¥¼åˆ†éš”ç¬¦çš„æ ‡è®° self.floorTag = floorTag #ä¼ å…¥é¡µç ï¼Œè·å–è¯¥é¡µå¸–å­çš„ä»£ç  def getPage(self,pageNum): try: #æ„å»ºURL url = self.baseURL+ self.seeLZ + '&amp;pn=' + str(pageNum) request = urllib2.Request(url) response = urllib2.urlopen(request) #è¿”å›UTF-8æ ¼å¼ç¼–ç å†…å®¹ return response.read().decode('utf-8') #æ— æ³•è¿æ¥ï¼ŒæŠ¥é”™ except urllib2.URLError, e: if hasattr(e,\"reason\"): print u\"è¿æ¥ç™¾åº¦è´´å§å¤±è´¥,é”™è¯¯åŸå› \",e.reason return None #è·å–å¸–å­æ ‡é¢˜ def getTitle(self,page): #å¾—åˆ°æ ‡é¢˜çš„æ­£åˆ™è¡¨è¾¾å¼ pattern = re.compile('&lt;h1 class=\"core_title_txt.*?&gt;(.*?)&lt;/h1&gt;',re.S) result = re.search(pattern,page) if result: #å¦‚æœå­˜åœ¨ï¼Œåˆ™è¿”å›æ ‡é¢˜ return result.group(1).strip() else: return None #è·å–å¸–å­ä¸€å…±æœ‰å¤šå°‘é¡µ def getPageNum(self,page): #è·å–å¸–å­é¡µæ•°çš„æ­£åˆ™è¡¨è¾¾å¼ pattern = re.compile('&lt;li class=\"l_reply_num.*?&lt;/span&gt;.*?&lt;span.*?&gt;(.*?)&lt;/span&gt;',re.S) result = re.search(pattern,page) if result: return result.group(1).strip() else: return None #è·å–æ¯ä¸€å±‚æ¥¼çš„å†…å®¹,ä¼ å…¥é¡µé¢å†…å®¹ def getContent(self,page): #åŒ¹é…æ‰€æœ‰æ¥¼å±‚çš„å†…å®¹ pattern = re.compile('&lt;div id=\"post_content_.*?&gt;(.*?)&lt;/div&gt;',re.S) items = re.findall(pattern,page) contents = [] for item in items: #å°†æ–‡æœ¬è¿›è¡Œå»é™¤æ ‡ç­¾å¤„ç†ï¼ŒåŒæ—¶åœ¨å‰ååŠ å…¥æ¢è¡Œç¬¦ content = \"\\n\"+self.tool.replace(item)+\"\\n\" contents.append(content.encode('utf-8')) return contents def setFileTitle(self,title): #å¦‚æœæ ‡é¢˜ä¸æ˜¯ä¸ºNoneï¼Œå³æˆåŠŸè·å–åˆ°æ ‡é¢˜ if title is not None: self.file = open(title + \".txt\",\"w+\") else: self.file = open(self.defaultTitle + \".txt\",\"w+\") def writeData(self,contents): #å‘æ–‡ä»¶å†™å…¥æ¯ä¸€æ¥¼çš„ä¿¡æ¯ for item in contents: if self.floorTag == '1': #æ¥¼ä¹‹é—´çš„åˆ†éš”ç¬¦ floorLine = \"\\n\" + str(self.floor) + u\"-----------------------------------------------------------------------------------------\\n\" self.file.write(floorLine) self.file.write(item) self.floor += 1 def start(self): indexPage = self.getPage(1) pageNum = self.getPageNum(indexPage) title = self.getTitle(indexPage) self.setFileTitle(title) if pageNum == None: print \"URLå·²å¤±æ•ˆï¼Œè¯·é‡è¯•\" return try: print \"è¯¥å¸–å­å…±æœ‰\" + str(pageNum) + \"é¡µ\" for i in range(1,int(pageNum)+1): print \"æ­£åœ¨å†™å…¥ç¬¬\" + str(i) + \"é¡µæ•°æ®\" page = self.getPage(i) contents = self.getContent(page) self.writeData(contents) #å‡ºç°å†™å…¥å¼‚å¸¸ except IOError,e: print \"å†™å…¥å¼‚å¸¸ï¼ŒåŸå› \" + e.message finally: print \"å†™å…¥ä»»åŠ¡å®Œæˆ\"print u\"è¯·è¾“å…¥å¸–å­ä»£å·\"baseURL = 'http://tieba.baidu.com/p/' + str(raw_input(u'http://tieba.baidu.com/p/'))seeLZ = raw_input(\"æ˜¯å¦åªè·å–æ¥¼ä¸»å‘è¨€ï¼Œæ˜¯è¾“å…¥1ï¼Œå¦è¾“å…¥0\\n\")floorTag = raw_input(\"æ˜¯å¦å†™å…¥æ¥¼å±‚ä¿¡æ¯ï¼Œæ˜¯è¾“å…¥1ï¼Œå¦è¾“å…¥0\\n\")bdtb = BDTB(baseURL,seeLZ,floorTag)bdtb.start() è¿è¡Œåæˆªå›¾å¦‚ä¸‹ï¼š å¤‡æ³¨ï¼š è¿è¡Œåæ³¨æ„è¾“å…¥å¸–å­çš„ä»£å·å…ˆåœ¨ç½‘å€åç©ºæ ¼ï¼Œå†è¾“å…¥å¸–å­ä»£å·ï¼Œè¾“å…¥å®Œå†æŠŠåˆšæ‰çš„ç©ºæ ¼ åˆ é™¤ï¼Œåªæœ‰è¿™æ ·æ‰ä¸ä¼šæŠ¥é”™ã€‚ Traceback (most recent call last):File â€œE:/python/code/PycharmProject/Python-Projects/baidutieba/BDTB3.pyâ€, line 149,in &lt; module &gt; bdtb.start()File â€œE:/python/code/PycharmProject/Python-Projects/baidutieba/BDTB3.pyâ€, line 123, in startpageNum = self.getPageNum(indexPage)File â€œE:/python/code/PycharmProject/Python-Projects/baidutieba/BDTB3.pyâ€, line 86, in getPageNumresult = re.search(pattern,page)File â€œC:\\Python27\\lib\\re.pyâ€, line 146, in searchreturn _compile(pattern, flags).search(string)TypeError: expected string or buffer","tags":[{"name":"Python","slug":"Python","permalink":"http://www.54tianzhisheng.cn/tags/Python/"},{"name":"çˆ¬è™«","slug":"çˆ¬è™«","permalink":"http://www.54tianzhisheng.cn/tags/çˆ¬è™«/"}]},{"title":"Pythonçˆ¬è™«å®æˆ˜ä¹‹çˆ¬å–ç³—äº‹ç™¾ç§‘æ®µå­","date":"2017-06-12T16:00:00.000Z","path":"2017/06/13/Pythonçˆ¬è™«å®æˆ˜ä¹‹çˆ¬å–ç³—äº‹ç™¾ç§‘æ®µå­/","text":"å®Œæ•´ä»£ç åœ°å€ï¼šPythonçˆ¬è™«å®æˆ˜ä¹‹çˆ¬å–ç³—äº‹ç™¾ç§‘æ®µå­ç¨‹åºä»£ç è¯¦è§£ï¼š Spider1-qiushibaike.pyï¼šçˆ¬å–ç³—äº‹ç™¾ç§‘çš„8å°æ—¶æœ€æ–°é¡µçš„æ®µå­ã€‚åŒ…å«çš„ä¿¡æ¯æœ‰ä½œè€…åç§°ï¼Œè§‰å¾—å¥½ç¬‘äººæ•°ï¼Œè¯„è®ºäººæ•°ï¼Œå‘å¸ƒçš„å†…å®¹ã€‚å¦‚æœå‘å¸ƒçš„å†…å®¹ä¸­å«æœ‰å›¾ç‰‡çš„è¯ï¼Œåˆ™è¿‡æ»¤å›¾ç‰‡ï¼Œå†…å®¹ä¾ç„¶æ˜¾ç¤ºå‡ºæ¥ã€‚ Spider2-qiushibaike.pyï¼šåœ¨Spider1-qiushibaike.pyåŸºç¡€ä¸Šï¼Œå¼•å…¥ç±»å’Œæ–¹æ³•ï¼Œè¿›è¡Œä¼˜åŒ–å’Œå°è£…ï¼Œçˆ¬å–ç³—äº‹ç™¾ç§‘çš„24å°æ—¶çƒ­é—¨é¡µçš„æ®µå­ã€‚è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œæ¯æŒ‰ä¸€æ¬¡å›è½¦æ›´æ–°ä¸€æ¡å†…å®¹ï¼Œå½“å‰é¡µçš„å†…å®¹æŠ“å–å®Œæ¯•åï¼Œè‡ªåŠ¨æŠ“å–ä¸‹ä¸€é¡µçš„å†…å®¹ï¼ŒæŒ‰â€˜qâ€™é€€å‡ºã€‚ Spider3-qiushibaike.pyï¼šåœ¨Spiders-qiushibaike.pyåŸºç¡€ä¸Šï¼Œçˆ¬å–äº†ç™¾ç§‘æ®µå­çš„è¯„è®ºã€‚æŒ‰CæŸ¥çœ‹å½“å‰è¿™ä¸ªç³—äº‹çš„è¯„è®ºï¼Œå½“åˆ‡æ¢åˆ°æŸ¥çœ‹è¯„è®ºæ—¶ï¼Œæ¢å›è½¦æ˜¾ç¤ºä¸‹ä¸€ä¸ªè¯„è®º,æŒ‰Qé€€å‡ºå›åˆ°æŸ¥çœ‹ç³—äº‹ã€‚ç³—äº‹æ®µå­é¡µæ•°æ˜¯ä¸€é¡µä¸€é¡µåŠ è½½çš„ï¼Œå¦‚æœä½ å·²ç»çœ‹å®Œæ‰€æœ‰çš„ç³—äº‹ï¼Œå°±ä¼šè‡ªåŠ¨é€€å‡ºï¼ æœ¬çˆ¬è™«ç›®æ ‡ï¼š æŠ“å–ç³—äº‹ç™¾ç§‘çƒ­é—¨æ®µå­ è¿‡æ»¤å¸¦æœ‰å›¾ç‰‡çš„æ®µå­ å®ç°æ¯æŒ‰ä¸€æ¬¡å›è½¦æ˜¾ç¤ºä¸€ä¸ªæ®µå­çš„å‘å¸ƒæ—¶é—´ï¼Œå‘å¸ƒäººï¼Œæ®µå­å†…å®¹ï¼Œç‚¹èµæ•°ï¼Œè¯„è®ºäººæ•°ã€‚ ç³—äº‹ç™¾ç§‘æ˜¯ä¸éœ€è¦ç™»å½•çš„ï¼Œæ‰€ä»¥ä¹Ÿæ²¡å¿…è¦ç”¨åˆ°Cookieï¼Œå¦å¤–ç³—äº‹ç™¾ç§‘æœ‰çš„æ®µå­æ˜¯é™„å›¾çš„ï¼Œæˆ‘ä»¬æŠŠå›¾æŠ“ä¸‹æ¥å›¾ç‰‡ä¸ä¾¿äºæ˜¾ç¤ºï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å°è¯•è¿‡æ»¤æ‰æœ‰å›¾çš„æ®µå­å§ã€‚ å¥½ï¼Œç°åœ¨æˆ‘ä»¬å°è¯•æŠ“å–ä¸€ä¸‹ç³—äº‹ç™¾ç§‘çš„çƒ­é—¨æ®µå­å§ï¼Œæ¯æŒ‰ä¸‹ä¸€æ¬¡å›è½¦æˆ‘ä»¬æ˜¾ç¤ºä¸€ä¸ªæ®µå­ã€‚ 1.ç¡®å®šURLå¹¶æŠ“å–é¡µé¢ä»£ç é¦–å…ˆæˆ‘ä»¬ç¡®å®šå¥½é¡µé¢çš„URLæ˜¯ http://www.qiushibaike.com/hot/page/1ï¼Œå…¶ä¸­æœ€åä¸€ä¸ªæ•°å­—1ä»£è¡¨é¡µæ•°ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ å…¥ä¸åŒçš„å€¼æ¥è·å¾—æŸä¸€é¡µçš„æ®µå­å†…å®¹ã€‚ 2.æå–æŸä¸€é¡µçš„æ‰€æœ‰æ®µå­å¥½ï¼Œè·å–äº†HTMLä»£ç ä¹‹åï¼Œæˆ‘ä»¬å¼€å§‹åˆ†ææ€æ ·è·å–æŸä¸€é¡µçš„æ‰€æœ‰æ®µå­ã€‚ é¦–å…ˆæˆ‘ä»¬å®¡æŸ¥å…ƒç´ çœ‹ä¸€ä¸‹ï¼ŒæŒ‰æµè§ˆå™¨çš„F12ï¼Œæˆªå›¾å¦‚ä¸‹: æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸€ä¸ªæ®µå­éƒ½æ˜¯ &lt;div class=â€article block untagged mb15â€³ id=â€â€¦â€&gt;â€¦&lt;/div&gt; åŒ…è£¹çš„å†…å®¹ã€‚ ç°åœ¨æˆ‘ä»¬æƒ³è·å–å‘å¸ƒäººï¼Œå‘å¸ƒæ—¥æœŸï¼Œæ®µå­å†…å®¹ï¼Œç‚¹èµäººæ•°å’Œè¯„è®ºäººæ•°ã€‚ä¸è¿‡å¦å¤–æ³¨æ„çš„æ˜¯ï¼Œæ®µå­æœ‰äº›æ˜¯å¸¦å›¾ç‰‡çš„ï¼Œå¦‚æœæˆ‘ä»¬æƒ³åœ¨æ§åˆ¶å°æ˜¾ç¤ºå›¾ç‰‡æ˜¯ä¸ç°å®çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥æŠŠå¸¦æœ‰å›¾ç‰‡çš„æ®µå­ç»™å®ƒå‰”é™¤æ‰ï¼Œåªä¿å­˜ä»…å«æ–‡æœ¬çš„æ®µå­ã€‚ æ‰€ä»¥æˆ‘ä»¬åŠ å…¥å¦‚ä¸‹æ­£åˆ™è¡¨è¾¾å¼æ¥åŒ¹é…ä¸€ä¸‹ï¼Œç”¨åˆ°çš„æ–¹æ³•æ˜¯ re.findall æ˜¯æ‰¾å¯»æ‰€æœ‰åŒ¹é…çš„å†…å®¹ã€‚æ–¹æ³•çš„ç”¨æ³•è¯¦æƒ…å¯ä»¥çœ‹å‰é¢è¯´çš„æ­£åˆ™è¡¨è¾¾å¼çš„ä»‹ç»ã€‚ å¥½ï¼Œæˆ‘ä»¬çš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…è¯­å¥ä¹¦å†™å¦‚ä¸‹ï¼Œåœ¨åŸæ¥çš„åŸºç¡€ä¸Šè¿½åŠ å¦‚ä¸‹ä»£ç ï¼š 123456789#æ­£åˆ™è¡¨è¾¾å¼åŒ¹é… pattern = re.compile(&apos;&lt;div.*?author.*?&gt;.*?&lt;img.*?&gt;.*?&lt;h2&gt;(.*?)&lt;/h2&gt;.*?&lt;div.*?&apos;+ &apos;content&quot;&gt;(.*?)&lt;/div&gt;(.*?)&lt;div.*?class=&quot;number&quot;&gt;(.*?)&lt;/i&gt;.*?class=&quot;number&quot;&gt;(.*?)&lt;/i&gt;&apos;,re.S) items = re.findall(pattern,content) for item in items: haveImg = re.search(&quot;img&quot;,item[2]) if not haveImg: print item[0],item[3],item[4],item[1] #item[0]æ˜¯ä½œè€…åç§° item[3]å¥½ç¬‘äººæ•° item[4]è¯„è®ºäººæ•° item[1]å†…å®¹ item[2]æ˜¯å†…å®¹åé¢çš„ä¸œè¥¿ï¼Œå¦‚æœå«æœ‰å›¾ç‰‡ï¼Œè¿‡æ»¤æ‰ ç°åœ¨æ­£åˆ™è¡¨è¾¾å¼åœ¨è¿™é‡Œç¨ä½œè¯´æ˜ 1ï¼‰ .*? æ˜¯ä¸€ä¸ªå›ºå®šçš„æ­é…ï¼Œ . å’Œ * ä»£è¡¨å¯ä»¥åŒ¹é…ä»»æ„æ— é™å¤šä¸ªå­—ç¬¦ï¼ŒåŠ ä¸Š ï¼Ÿ è¡¨ç¤ºä½¿ç”¨éè´ªå©ªæ¨¡å¼è¿›è¡ŒåŒ¹é…ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¼šå°½å¯èƒ½çŸ­åœ°åšåŒ¹é…ï¼Œä»¥åæˆ‘ä»¬è¿˜ä¼šå¤§é‡ç”¨åˆ° .*? çš„æ­é…ã€‚ 2ï¼‰(.*?) ä»£è¡¨ä¸€ä¸ªåˆ†ç»„ï¼Œåœ¨è¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼ä¸­æˆ‘ä»¬åŒ¹é…äº†äº”ä¸ªåˆ†ç»„ï¼Œåœ¨åé¢çš„éå† item ä¸­ï¼Œitem[0] å°±ä»£è¡¨ç¬¬ä¸€ä¸ª (.*?) æ‰€æŒ‡ä»£çš„å†…å®¹ï¼Œitem[1] å°±ä»£è¡¨ç¬¬äºŒä¸ª (.*?) æ‰€æŒ‡ä»£çš„å†…å®¹ï¼Œä»¥æ­¤ç±»æ¨ã€‚ 3ï¼‰re.S æ ‡å¿—ä»£è¡¨åœ¨åŒ¹é…æ—¶ä¸ºç‚¹ä»»æ„åŒ¹é…æ¨¡å¼ï¼Œç‚¹ . ä¹Ÿå¯ä»¥ä»£è¡¨æ¢è¡Œç¬¦ã€‚ è¿™æ ·æˆ‘ä»¬å°±è·å–äº†å‘å¸ƒäººï¼Œå‘å¸ƒæ—¶é—´ï¼Œå‘å¸ƒå†…å®¹ï¼Œé™„åŠ å›¾ç‰‡ä»¥åŠç‚¹èµæ•°ã€‚ åœ¨è¿™é‡Œæ³¨æ„ä¸€ä¸‹ï¼Œæˆ‘ä»¬è¦è·å–çš„å†…å®¹å¦‚æœæ˜¯å¸¦æœ‰å›¾ç‰‡ï¼Œç›´æ¥è¾“å‡ºå‡ºæ¥æ¯”è¾ƒç¹çï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬åªè·å–ä¸å¸¦å›¾ç‰‡çš„æ®µå­å°±å¥½äº†ã€‚ æ‰€ä»¥ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å°±éœ€è¦å¯¹å¸¦å›¾ç‰‡çš„æ®µå­è¿›è¡Œè¿‡æ»¤ã€‚ æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå¸¦æœ‰å›¾ç‰‡çš„æ®µå­ä¼šå¸¦æœ‰ç±»ä¼¼ä¸‹é¢çš„ä»£ç ï¼Œè€Œä¸å¸¦å›¾ç‰‡çš„åˆ™æ²¡æœ‰ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬çš„æ­£åˆ™è¡¨è¾¾å¼çš„ item[2] å°±æ˜¯è·å–äº†ä¸‹é¢çš„å†…å®¹ï¼Œå¦‚æœä¸å¸¦å›¾ç‰‡ï¼Œitem[2]è·å–çš„å†…å®¹ä¾¿æ˜¯ç©ºï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦åˆ¤æ–­ item[2]ä¸­æ˜¯å¦å«æœ‰ img æ ‡ç­¾å°±å¯ä»¥äº†ã€‚ æ•´ä½“ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334#-*-coding:utf8-*-#created by 10412 2016/8/23#çˆ¬å–ç³—äº‹ç™¾ç§‘çš„8å°æ—¶æœ€æ–°é¡µçš„æ®µå­ã€‚åŒ…å«çš„ä¿¡æ¯æœ‰ä½œè€…åç§°ï¼Œè§‰å¾—å¥½ç¬‘äººæ•°ï¼Œè¯„è®ºäººæ•°ï¼Œå‘å¸ƒçš„å†…å®¹ã€‚#å¦‚æœå‘å¸ƒçš„å†…å®¹ä¸­å«æœ‰å›¾ç‰‡çš„è¯ï¼Œåˆ™è¿‡æ»¤å›¾ç‰‡ï¼Œå†…å®¹ä¾ç„¶æ˜¾ç¤ºå‡ºæ¥ã€‚import urllibimport urllib2import re#è‡ªå®šä¹‰è¾“å…¥çˆ¬å–çš„é¡µæ•°page = raw_input(&quot;please enter the page number:&quot;)url = &apos;http://www.qiushibaike.com/8hr/page/&apos;+ page +&apos;/?s=4880477&apos;user_agent = &apos;Mozilla/4.0 (compatible; MSIE 5.5; Windows NT)&apos;headers = &#123; &apos;User-Agent&apos; : user_agent &#125;try: request = urllib2.Request(url,headers = headers) response = urllib2.urlopen(request) content = response.read().decode(&apos;utf-8&apos;) #æ­£åˆ™è¡¨è¾¾å¼åŒ¹é… pattern = re.compile(&apos;&lt;div.*?author.*?&gt;.*?&lt;img.*?&gt;.*?&lt;h2&gt;(.*?)&lt;/h2&gt;.*?&lt;div.*?&apos;+ &apos;content&quot;&gt;(.*?)&lt;/div&gt;(.*?)&lt;div.*?class=&quot;number&quot;&gt;(.*?)&lt;/i&gt;.*?class=&quot;number&quot;&gt;(.*?)&lt;/i&gt;&apos;,re.S) items = re.findall(pattern,content) for item in items: haveImg = re.search(&quot;img&quot;,item[2]) if not haveImg: print item[0],item[3],item[4],item[1] #item[0]æ˜¯ä½œè€…åç§° item[3]å¥½ç¬‘äººæ•° item[4]è¯„è®ºäººæ•° item[1]å†…å®¹ item[2]æ˜¯å†…å®¹åé¢çš„ä¸œè¥¿ï¼Œå¦‚æœå«æœ‰å›¾ç‰‡ï¼Œè¿‡æ»¤æ‰except urllib2.URLError, e: if hasattr(e,&quot;code&quot;): print e.code if hasattr(e,&quot;reason&quot;): print e.reason è¿è¡Œä¸€ä¸‹çœ‹ä¸‹æ•ˆæœ: æ©ï¼Œå¸¦æœ‰å›¾ç‰‡çš„æ®µå­å·²ç»è¢«å‰”é™¤å•¦ã€‚ 3.å®Œå–„äº¤äº’ï¼Œè®¾è®¡é¢å‘å¯¹è±¡æ¨¡å¼å¥½å•¦ï¼Œç°åœ¨æœ€æ ¸å¿ƒçš„éƒ¨åˆ†æˆ‘ä»¬å·²ç»å®Œæˆå•¦ï¼Œå‰©ä¸‹çš„å°±æ˜¯ä¿®ä¸€ä¸‹è¾¹è¾¹è§’è§’çš„ä¸œè¥¿ï¼Œæˆ‘ä»¬æƒ³è¾¾åˆ°çš„ç›®çš„æ˜¯ï¼š æŒ‰ä¸‹å›è½¦ï¼Œè¯»å–ä¸€ä¸ªæ®µå­ï¼Œæ˜¾ç¤ºå‡ºæ®µå­çš„å‘å¸ƒäººï¼Œå†…å®¹ï¼Œç‚¹èµä¸ªæ•°åŠè¯„è®ºæ•°é‡ã€‚ å¦å¤–æˆ‘ä»¬éœ€è¦è®¾è®¡é¢å‘å¯¹è±¡æ¨¡å¼ï¼Œå¼•å…¥ç±»å’Œæ–¹æ³•ï¼Œå°†ä»£ç åšä¸€ä¸‹ä¼˜åŒ–å’Œå°è£…ï¼Œæœ€åï¼Œæˆ‘ä»¬çš„ä»£ç å¦‚ä¸‹æ‰€ç¤º 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788#-*-coding:utf8-*-#created by 10412# åœ¨Spider1-qiushibaike.pyåŸºç¡€ä¸Šï¼Œå¼•å…¥ç±»å’Œæ–¹æ³•ï¼Œè¿›è¡Œä¼˜åŒ–å’Œå°è£…ï¼Œçˆ¬å–ç³—äº‹ç™¾ç§‘çš„24å°æ—¶çƒ­é—¨é¡µçš„æ®µå­ã€‚# è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œæ¯æŒ‰ä¸€æ¬¡å›è½¦æ›´æ–°ä¸€æ¡å†…å®¹ï¼Œå½“å‰é¡µçš„å†…å®¹æŠ“å–å®Œæ¯•åï¼Œè‡ªåŠ¨æŠ“å–ä¸‹ä¸€é¡µçš„å†…å®¹ï¼ŒæŒ‰â€˜qâ€™é€€å‡ºã€‚import urllib2import reclass QSBK: def __init__(self): self.pageIndex = 1 self.user_agent = &apos;Mozilla/4.0 (compatible; MSIE 5.5; Windows NT)&apos; self.headers = &#123;&apos;User-Agent&apos; : self.user_agent&#125; self.stories = [] # å­˜æ”¾ç¨‹åºæ˜¯å¦ç»§ç»­è¿è¡Œçš„å˜é‡ self.enable = False # ä¼ å…¥æŸä¸€é¡µçš„ç´¢å¼•è·å¾—é¡µé¢ä»£ç  def getPage(self, pageIndex): try: url = &apos;http://www.qiushibaike.com/hot/page/&apos; + str(pageIndex) request = urllib2.Request(url, headers=self.headers) response = urllib2.urlopen(request) pageCode = response.read().decode(&apos;utf-8&apos;) return pageCode except urllib2.URLError, e: if hasattr(e, &quot;reason&quot;): print u&quot;è¿æ¥ç³—äº‹ç™¾ç§‘å¤±è´¥,é”™è¯¯åŸå› &quot;, e.reason return None # ä¼ å…¥æŸä¸€é¡µä»£ç ï¼Œè¿”å›æœ¬é¡µä¸å¸¦å›¾ç‰‡çš„æ®µå­åˆ—è¡¨ def getPageItems(self, pageIndex): pageCode = self.getPage(pageIndex) if not pageCode: print u&quot;å‡ºé”™äº†&quot; return None pattern = re.compile(&apos;&lt;div class=&quot;author.*?href.*?&lt;img src.*?title=.*?&lt;h2&gt;(.*?)&lt;/h2&gt;.*?&lt;div class=&quot;content&quot;&gt;(.*?)&lt;/div&gt;.*?&lt;i class=&quot;number&quot;&gt;(.*?)&lt;/i&gt;.*?class=&quot;number&quot;&gt;(.*?)&lt;/i&gt;&apos;,re.S) items = re.findall(pattern, pageCode) pageStories = [] for item in items: replaceBR = re.compile(&apos;&lt;br/&gt;&apos;) text = re.sub(replaceBR, &quot;\\n&quot;, item [1] ) pageStories.append([item[0].strip(), text.strip(), item[2].strip(), item[3].strip()]) return pageStories # åŠ è½½å¹¶æå–é¡µé¢å†…å®¹ï¼ŒåŠ å…¥åˆ°åˆ—è¡¨ä¸­ def loadPage(self): if self.enable == True: if len(self.stories) &lt; 2: # è·å–æ–°ä¸€é¡µ pageStories = self.getPageItems(self.pageIndex) if pageStories: self.stories.append(pageStories) self.pageIndex += 1 # è°ƒç”¨è¯¥æ–¹æ³•ï¼Œå›è½¦æ‰“å°ä¸€ä¸ªæ®µå­ def getOneStory(self, pageStories, page): for story in pageStories: input = raw_input() self.loadPage() if input == &quot;Q&quot;: self.enable = False return print u&quot;ç¬¬%dé¡µ\\tå‘å¸ƒäºº:%s\\tèµ:%s\\tè¯„è®º:%s\\n%s&quot; %(page, story[0], story[2], story[2], story [1]) # å¼€å§‹æ–¹æ³• def start(self): print u&quot;æ­£åœ¨è¯»å–ç³—äº‹ç™¾ç§‘,æŒ‰å›è½¦æŸ¥çœ‹æ–°æ®µå­ï¼ŒQé€€å‡º&quot; # ä½¿å˜é‡ä¸ºTrueï¼Œç¨‹åºå¯ä»¥æ­£å¸¸è¿è¡Œ self.enable = True # å…ˆåŠ è½½ä¸€é¡µå†…å®¹ self.loadPage() # å±€éƒ¨å˜é‡ï¼Œæ§åˆ¶å½“å‰è¯»åˆ°äº†ç¬¬å‡ é¡µ nowPage = 0 while self.enable: if len(self.stories) &gt; 0: # ä»å…¨å±€listä¸­è·å–ä¸€é¡µçš„æ®µå­ pageStories = self.stories[0] # å½“å‰è¯»åˆ°çš„é¡µæ•°åŠ ä¸€ nowPage += 1 # å°†å…¨å±€listä¸­ç¬¬ä¸€ä¸ªå…ƒç´ åˆ é™¤ï¼Œå› ä¸ºå·²ç»å–å‡º del self.stories[0] # è¾“å‡ºè¯¥é¡µçš„æ®µå­ self.getOneStory(pageStories, nowPage)spider = QSBK()spider.start() å¥½å•¦ï¼Œå¤§å®¶æ¥æµ‹è¯•ä¸€ä¸‹å§ï¼Œç‚¹ä¸€ä¸‹å›è½¦ä¼šè¾“å‡ºä¸€ä¸ªæ®µå­ï¼ŒåŒ…æ‹¬ç¬¬å‡ é¡µï¼Œå‘å¸ƒäººï¼Œæ®µå­å†…å®¹ï¼Œç‚¹èµæ•°ä»¥åŠè¯„è®ºæ•°é‡ï¼Œæ˜¯ä¸æ˜¯æ„Ÿè§‰çˆ½çˆ†äº†ï¼ å®Œå–„æ›´æ–°ç‰ˆçˆ¬è™«ä»£ç åœ¨ä¸Šé¢çˆ¬è™«çš„åŸºç¡€ä¸Šï¼Œè¿˜å¢åŠ çˆ¬å–äº†ç™¾ç§‘æ®µå­çš„è¯„è®ºã€‚æŒ‰CæŸ¥çœ‹å½“å‰è¿™ä¸ªç³—äº‹çš„è¯„è®ºï¼Œå½“åˆ‡æ¢åˆ°æŸ¥çœ‹è¯„è®ºæ—¶ï¼Œæ¢å›è½¦æ˜¾ç¤ºä¸‹ä¸€ä¸ªè¯„è®º,æŒ‰Qé€€å‡ºå›åˆ°æŸ¥çœ‹ç³—äº‹ã€‚ç³—äº‹æ®µå­é¡µæ•°æ˜¯ä¸€é¡µä¸€é¡µåŠ è½½çš„ï¼Œå¦‚æœä½ å·²ç»çœ‹å®Œæ‰€æœ‰çš„ç³—äº‹ï¼Œå°±ä¼šè‡ªåŠ¨é€€å‡ºï¼ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198#-*-coding:utf8-*-#created by 10412#åœ¨Spiders-qiushibaike.pyåŸºç¡€ä¸Šï¼Œçˆ¬å–äº†ç™¾ç§‘æ®µå­çš„è¯„è®ºã€‚æŒ‰CæŸ¥çœ‹å½“å‰è¿™ä¸ªç³—äº‹çš„è¯„è®ºï¼Œå½“åˆ‡æ¢åˆ°æŸ¥çœ‹è¯„è®ºæ—¶ï¼Œ# æ¢å›è½¦æ˜¾ç¤ºä¸‹ä¸€ä¸ªè¯„è®º,æŒ‰Qé€€å‡ºå›åˆ°æŸ¥çœ‹ç³—äº‹ã€‚ç³—äº‹æ®µå­é¡µæ•°æ˜¯ä¸€é¡µä¸€é¡µåŠ è½½çš„ï¼Œå¦‚æœä½ å·²ç»çœ‹å®Œæ‰€æœ‰çš„ç³—äº‹ï¼Œå°±ä¼šè‡ªåŠ¨é€€å‡ºï¼import urllibimport urllib2import reimport os.pathhtmlCharacterMap = &#123; &apos;&lt;br/&gt;&apos; : &apos;\\n&apos;, &apos;&amp;quot;&apos; : &apos;&quot;&apos;, &apos;&amp;nbsp;&apos; : &apos; &apos;, &apos;&amp;gt;&apos; : &apos;&gt;&apos;, &apos;&amp;lt;&apos; : &apos;&lt;&apos;, &apos;&amp;amp;&apos;: &apos;&amp;&apos;, &apos;&amp;#39&apos;:&quot;&apos;&quot;,&#125;class QSBK(object): &quot;&quot;&quot;ç³—äº‹ç™¾ç§‘çš„çˆ¬è™«&quot;&quot;&quot; def __init__(self): self.pageIndex = 1 self.pagetotal = 9999 self.user_agent = &apos;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.103 Safari/537.36&apos; self.headers = &#123;&apos;User-Agent&apos; : self.user_agent&#125; self.stories = [] self.comments = [] self.currentStoryId = &apos;&apos; #æ˜¯å¦è¦é€€å‡ºäº† self.enable = False #è®°å½•å½“å‰æ˜¯å¦åœ¨æŸ¥çœ‹è¯„è®º self.viewComment = False def getPageContent(self, pageIndex): try: url = &apos;http://www.qiushibaike.com/8hr/page/%d/&apos; % pageIndex request = urllib2.Request(url, headers=self.headers) print u&apos;å¼€å§‹åŠ è½½%02dé¡µ&apos; % pageIndex response = urllib2.urlopen(request, timeout=5) print u&apos;æˆåŠŸåŠ è½½%02dé¡µ&apos; % pageIndex pageContent = response.read().decode(&apos;utf-8&apos;) return pageContent except urllib2.URLError, e: if hasattr(e, &apos;reason&apos;): print u&quot;è¿æ¥ç³—äº‹ç™¾ç§‘å¤±è´¥ï¼Œé”™è¯¯åŸå› ï¼š&quot;, e.reason return None def getCommentsContent(self, storyId): # å¾—åˆ°æ®µå­çš„è¯„è®º try: url = &apos;http://www.qiushibaike.com/article/%s&apos; % storyId request = urllib2.Request(url, headers=self.headers) response = urllib2.urlopen(request, timeout=5) pageContent = response.read().decode(&apos;utf-8&apos;) return pageContent except urllib2.URLError, e: if hasattr(e, &apos;reason&apos;): print u&quot;è¿æ¥ç³—äº‹ç™¾ç§‘å¤±è´¥ï¼Œé”™è¯¯åŸå› ï¼š&quot;, e.reason return None def getPageTotal(self, content): # å¾—åˆ°æ€»é¡µæ•° if self.pagetotal != 9999: # print u&apos;åŠ è½½ç¬¬%dé¡µ&apos; % self.pageIndex return pattrenStr = &apos;&lt;span class=&quot;page-numbers&quot;&gt;(?P&lt;pagetotal&gt;.*?)&lt;/span&gt;&apos; pattern = re.compile(pattrenStr, re.S) items = re.findall(pattern, content) if len(items)&gt;0: self.pagetotal = int(items[-1].strip()) print u&apos;æ€»å…±æœ‰%dé¡µ&apos; % self.pagetotal def getPageItems(self, pageIndex): pageContent = self.getPageContent(pageIndex) with open(&apos;temp%02d.html&apos; % pageIndex, &apos;w&apos;) as f: f.write(pageContent.encode(&apos;utf-8&apos;)) if not pageContent: print &quot;é¡µé¢åŠ è½½å¤±è´¥...&quot; return None self.getPageTotal(pageContent) pattrenStr = r&apos;&lt;h2&gt;(?P&lt;authorname&gt;.*?)&lt;/h2&gt;.*?&apos;\\ r&apos;&lt;div class=&quot;content&quot;&gt;(?P&lt;content&gt;.*?)&lt;/div&gt;&apos;\\ r&apos;(?P&lt;maybehaveimage&gt;.*?)&apos;\\ r&apos;&lt;i class=&quot;number&quot;&gt;(?P&lt;numbervote&gt;.*?)&lt;/i&gt;.*?&apos;\\ r&apos;&lt;span class=&quot;stats-comments&quot;&gt;(?P&lt;comments&gt;.*?)&lt;/div&gt;&apos; pattern = re.compile(pattrenStr, re.S) items = re.findall(pattern, pageContent) return items def getCurrentStoryComments(self, storyId): #åˆ‡æ¢åˆ°æŸ¥çœ‹è¯„è®ºæ¨¡å¼ self.viewComment = True content = self.getCommentsContent(storyId) if not content: print &quot;é¡µé¢åŠ è½½å¤±è´¥...&quot; return None reStr = r&apos;&lt;div id=&quot;comment-.*?&apos;\\ r&apos;&lt;a href=&quot;/users/.*?/&quot; class=&quot;userlogin&quot; target=&quot;_blank&quot; title=&quot;(?P&lt;username&gt;.*?)&quot;&gt;(?P=username)&lt;/a&gt;.*?&apos;\\ r&apos;&lt;span class=&quot;body&quot;&gt;(?P&lt;comment&gt;.*?)&lt;/span&gt;.*?&apos;\\ r&apos;&lt;div class=&quot;report&quot;&gt;(?P&lt;index&gt;.*?)&lt;/div&gt;&apos; pattern = re.compile(reStr, re.S) items = re.findall(pattern, content) del self.comments[:] for item in items: comentstr = item[0]+&apos;(&apos;+ item[2] + u&apos;æ¥¼)&apos; + &apos;\\n&apos; + item[1] + &apos;\\n&apos; for (k,v) in htmlCharacterMap.items(): re.sub(re.compile(k), v, comentstr) self.comments.append(comentstr) if len(self.comments)&gt;0: print &apos;å·²åˆ‡æ¢åˆ°æŸ¥çœ‹è¯„è®ºï¼Œæ¢å›è½¦æ˜¾ç¤ºä¸‹ä¸€ä¸ªè¯„è®º,æŒ‰Qé€€å‡ºå›åˆ°æŸ¥çœ‹ç³—äº‹&apos; else: print &apos;å½“å‰ç³—äº‹æ²¡æœ‰è¯„è®º&apos; self.viewComment = False def getNextPage(self): if self.pageIndex &gt; self.pagetotal: self.enable = False print &quot;ä½ å·²ç»çœ‹å®Œæ‰€æœ‰çš„ç³—äº‹ï¼Œç°åœ¨è‡ªåŠ¨é€€å‡ºï¼&quot; return items = self.getPageItems(self.pageIndex) self.pageIndex += 1 for item in items: #å¦‚æœæœ‰å›¾ç‰‡ç›´æ¥è·³è¿‡ï¼Œå› ä¸ºå›¾ç‰‡åœ¨ç»ˆç«¯æ˜¾ç¤ºä¸äº† if re.search(&apos;img&apos;, item[2]): continue content = item[1].strip() #è½¬æ¢htmlçš„ç‰¹æ®Šå­—ç¬¦ for (k,v) in htmlCharacterMap.items(): content = re.sub(re.compile(k), v, content) authorname = item[0].strip() for (k,v) in htmlCharacterMap.items(): authorname = re.sub(re.compile(k), v, authorname) #æ‰¾å‡ºè¯„è®ºä¸ªæ•°ï¼Œæ²¡æœ‰ä¸º0 pattern = re.compile(r&apos;.*?&lt;a href=&quot;/article/(?P&lt;id&gt;.*?)&quot;.*?&lt;i class=&quot;number&quot;&gt;(?P&lt;number&gt;.*?)&lt;/i&gt;.*?&apos;, re.S) result = re.match(pattern, item[4]) commentnumbers = 0 articleId = &apos;&apos; if result: commentnumbers = result.groupdict().get(&apos;number&apos;, &apos;0&apos;) articleId = result.groupdict().get(&apos;id&apos;, &apos;&apos;) self.stories.append(authorname + &apos;(&apos; + item[3].strip() + u&apos;å¥½ç¬‘Â·&apos; + str(commentnumbers) + u&apos;è¯„è®º)&apos; + &apos;\\n&apos; + content + &apos;\\n&apos;) self.stories.append(articleId) def getNextComment(self): print self.comments[0] self.comments.pop(0) if len(self.comments)==0: print &apos;ä½ å·²æŸ¥çœ‹å®Œè¿™ä¸ªç³—äº‹çš„æ‰€æœ‰è¯„è®º,ç°åœ¨è‡ªåŠ¨é€€å‡ºåˆ°æŸ¥çœ‹ç³—äº‹&apos; self.viewComment = False def getOneStory(self): #é˜²æ­¢æœ‰çš„é¡µé¢å…¨æ˜¯å¸¦å›¾ç‰‡çš„ while (len(self.stories)==0 and self.enable): self.getNextPage() story = self.stories[0] self.currentStoryId = self.stories[1] print story self.stories.pop(0) self.stories.pop(0) if len(self.stories)==0: self.getNextPage() def start(self): #å…ˆåˆ é™¤ä¸´æ—¶ä¿å­˜çš„ç½‘é¡µ tempfiles = [x for x in os.listdir(&apos;.&apos;) if os.path.isfile(x) and os.path.splitext(x)[1]==&apos;.html&apos; and x.startswith(&apos;temp&apos;)] for file in tempfiles: os.remove(file) print u&quot;æ­£åœ¨è¯»å–ç³—äº‹ç™¾ç§‘ï¼ŒæŒ‰å›è½¦æŸ¥çœ‹ä¸‹ä¸€ä¸ªç³—äº‹ï¼ŒæŒ‰CæŸ¥çœ‹å½“å‰è¿™ä¸ªç³—äº‹çš„è¯„è®ºï¼ŒæŒ‰Qé€€å‡ºæˆ–è¿”å›&quot; self.enable = True self.getNextPage() while self.enable: input = raw_input() if input.upper() == &quot;Q&quot;: if not self.viewComment: self.enable = False else: self.viewComment = False print &apos;ç°åœ¨é€€å‡ºåˆ°æŸ¥çœ‹ç³—äº‹äº†&apos; elif input.upper() == &quot;C&quot;: #æŸ¥çœ‹å½“å‰çœ‹åˆ°çš„ç³—äº‹çš„è¯„è®º if len(self.currentStoryId)&gt;0: self.getCurrentStoryComments(self.currentStoryId) else: print &apos;è¿™æ¡ç³—äº‹æ²¡æœ‰è¯„è®º&apos; else: if not self.viewComment: self.getOneStory() else: self.getNextComment()if __name__ == &apos;__main__&apos;: spider = QSBK() spider.start()","tags":[{"name":"Python","slug":"Python","permalink":"http://www.54tianzhisheng.cn/tags/Python/"},{"name":"çˆ¬è™«","slug":"çˆ¬è™«","permalink":"http://www.54tianzhisheng.cn/tags/çˆ¬è™«/"}]},{"title":"æ·±å…¥åˆ†æ Java Web ä¸­çš„ä¸­æ–‡ç¼–ç é—®é¢˜","date":"2017-06-12T16:00:00.000Z","path":"2017/06/13/æ·±å…¥åˆ†æ Java Web ä¸­çš„ä¸­æ–‡ç¼–ç é—®é¢˜/","text":"èƒŒæ™¯ï¼š ç¼–ç é—®é¢˜ä¸€ç›´å›°æ‰°ç€ç¨‹åºå¼€å‘äººå‘˜ï¼Œå°¤å…¶æ˜¯åœ¨ Java ä¸­æ›´åŠ æ˜æ˜¾ï¼Œå› ä¸º Java æ˜¯è·¨å¹³å°çš„è¯­è¨€ï¼Œåœ¨ä¸åŒå¹³å°çš„ç¼–ç ä¹‹é—´çš„åˆ‡æ¢è¾ƒå¤šã€‚æ¥ä¸‹æ¥å°†ä»‹ç» Java ç¼–ç é—®é¢˜å‡ºç°çš„æ ¹æœ¬åŸå› ï¼›åœ¨ Java ä¸­ç»å¸¸é‡åˆ°çš„å‡ ç§ç¼–ç æ ¼å¼çš„åŒºåˆ«ï¼›åœ¨ Java ä¸­ç»å¸¸éœ€è¦ç¼–ç çš„åœºæ™¯ï¼›å‡ºç°ä¸­æ–‡é—®é¢˜çš„åŸå› åˆ†æï¼›åœ¨å¼€å‘ Java Web ä¸­å¯èƒ½å­˜åœ¨ç¼–ç çš„å‡ ä¸ªåœ°æ–¹ï¼›ä¸€ä¸ª HTTP è¯·æ±‚æ€ä¹ˆæ§åˆ¶ç¼–ç æ ¼å¼ï¼›å¦‚ä½•é¿å…å‡ºç°ä¸­æ–‡ç¼–ç é—®é¢˜ç­‰ã€‚ 1ã€å‡ ç§å¸¸è§çš„ç¼–ç æ ¼å¼1.1 ä¸ºä»€ä¹ˆè¦ç¼–ç  åœ¨è®¡ç®—æœºä¸­å­˜å‚¨ä¿¡æ¯çš„æœ€å°å•å…ƒæ˜¯ 1 ä¸ªå­—èŠ‚ï¼Œå³ 8 ä¸ª bitï¼Œ æ‰€ä»¥èƒ½è¡¨ç¤ºçš„å­—ç¬¦èŒƒå›´æ˜¯ 0 ~ 255 ä¸ªã€‚ è¦è¡¨ç¤ºçš„ç¬¦å·å¤ªå¤šï¼Œæ— æ³•ç”¨ 1 ä¸ªå­—èŠ‚æ¥å®Œå…¨è¡¨ç¤ºã€‚ 1.2 å¦‚ä½•ç¿»è¯‘è®¡ç®—æœºä¸­æä¾›å¤šç§ç¿»è¯‘æ–¹å¼ï¼Œå¸¸è§çš„æœ‰ ASCIIã€ISO-8859-1ã€GB2312ã€GBKã€UTF-8ã€UTF-16ç­‰ã€‚è¿™äº›éƒ½è§„å®šäº†è½¬åŒ–çš„è§„åˆ™ï¼ŒæŒ‰ç…§è¿™ä¸ªè§„åˆ™å°±å¯ä»¥è®©è®¡ç®—æœºæ­£ç¡®çš„è¡¨ç¤ºæˆ‘ä»¬çš„å­—ç¬¦ã€‚ä¸‹é¢ä»‹ç»è¿™å‡ ç§ç¼–ç æ ¼å¼ï¼š ASCII ç  æ€»å…±æœ‰ 128 ä¸ªï¼Œç”¨ 1 ä¸ªå­—èŠ‚çš„ä½ 7 ä½è¡¨ç¤ºï¼Œ 0 ~ 31 æ˜¯æ§åˆ¶å­—ç¬¦å¦‚æ¢è¡Œã€å›è½¦ã€åˆ é™¤ç­‰ï¼Œ32 ~ 126 æ˜¯æ‰“å°å­—ç¬¦ï¼Œå¯ä»¥é€šè¿‡é”®ç›˜è¾“å…¥å¹¶ä¸”èƒ½å¤Ÿæ˜¾ç¤ºå‡ºæ¥ã€‚ ISO-8859-1 128 ä¸ªå­—ç¬¦æ˜¾ç„¶æ˜¯ä¸å¤Ÿç”¨çš„ï¼Œæ‰€ä»¥ ISO ç»„ç»‡åœ¨ ASCII çš„åŸºç¡€ä¸Šæ‰©å±•ï¼Œä»–ä»¬æ˜¯ ISO-8859-1 è‡³ ISO-8859-15ï¼Œå‰è€…æ¶µç›–å¤§å¤šæ•°å­—ç¬¦ï¼Œåº”ç”¨æœ€å¹¿ã€‚ISO-8859-1 ä»æ˜¯å•å­—èŠ‚ç¼–ç ï¼Œå®ƒæ€»å½’èƒ½è¡¨ç¤º 256 ä¸ªå­—ç¬¦ã€‚ GB2312 å®ƒæ˜¯åŒå­—èŠ‚ç¼–ç ï¼Œæ€»çš„ç¼–ç èŒƒå›´æ˜¯ A1 ~ F7ï¼Œå…¶ä¸­ A1 ~ A9 æ˜¯ç¬¦å·åŒºï¼Œæ€»å…±åŒ…å« 682 ä¸ªç¬¦å·ï¼›B0 ~ F7 æ˜¯æ±‰å­—åŒºï¼ŒåŒ…å« 6763 ä¸ªæ±‰å­—ã€‚ GBk GBK ä¸ºã€Šæ±‰å­—å†…ç æ‰©å±•è§„èŒƒã€‹ï¼Œä¸º GB2312 çš„æ‰©å±•ï¼Œå®ƒçš„ç¼–ç èŒƒå›´æ˜¯ 8140 ~ FEFEï¼ˆå»æ‰XX7Fï¼‰ï¼Œæ€»å…±æœ‰ 23940 ä¸ªç ä½ï¼Œèƒ½è¡¨ç¤º 21003 ä¸ªæ±‰å­—ï¼Œå’Œ GB2312çš„ç¼–ç å…¼å®¹ï¼Œä¸ä¼šæœ‰ä¹±ç ã€‚ UTF-16 å®ƒå…·ä½“å®šä¹‰äº† Unicode å­—ç¬¦åœ¨è®¡ç®—æœºä¸­çš„å­˜å–æ–¹æ³•ã€‚UTF-16 ç”¨ä¸¤ä¸ªå­—èŠ‚æ¥è¡¨ç¤º Unicode çš„è½¬åŒ–æ ¼å¼ï¼Œå®ƒé‡‡ç”¨å®šé•¿çš„è¡¨ç¤ºæ–¹æ³•ï¼Œå³ä¸è®ºä»€ä¹ˆå­—ç¬¦ç”¨ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºã€‚ä¸¤ä¸ªå­—èŠ‚æ˜¯ 16 ä¸ª bitï¼Œæ‰€ä»¥å« UTF-16ã€‚å®ƒè¡¨ç¤ºå­—ç¬¦éå¸¸æ–¹ä¾¿ï¼Œæ²¡ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œè¿™å°±å¤§å¤§ç®€åŒ–äº†å­—ç¬¦ä¸²æ“ä½œã€‚ UTF-8 è™½è¯´ UTF-16 ç»Ÿä¸€é‡‡ç”¨ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦å¾ˆç®€å•æ–¹ä¾¿ï¼Œä½†æ˜¯å¾ˆå¤§ä¸€éƒ¨åˆ†å­—ç¬¦ç”¨ä¸€ä¸ªå­—èŠ‚å°±å¯ä»¥è¡¨ç¤ºï¼Œå¦‚æœç”¨ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºï¼Œå­˜å‚¨ç©ºé—´æ”¾å¤§äº†ä¸€å€ï¼Œåœ¨ç½‘ç»œå¸¦å®½æœ‰é™çš„æƒ…å†µä¸‹ä¼šå¢åŠ ç½‘ç»œä¼ è¾“çš„æµé‡ã€‚UTF-8 é‡‡ç”¨äº†ä¸€ç§å˜é•¿æŠ€æœ¯ï¼Œæ¯ä¸ªç¼–ç åŒºåŸŸæœ‰ä¸åŒçš„å­—ç é•¿åº¦ä¸åŒç±»å‹çš„å­—ç¬¦å¯ä»¥ç”± 1 ~ 6 ä¸ªå­—èŠ‚ç»„æˆã€‚ UTF-8 æœ‰ä»¥ä¸‹ç¼–ç è§„åˆ™ï¼š å¦‚æœæ˜¯ 1 ä¸ªå­—èŠ‚ï¼Œæœ€é«˜ä½ï¼ˆç¬¬ 8 ä½ï¼‰ä¸º 0ï¼Œåˆ™è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ª ASCII å­—ç¬¦ï¼ˆ00 ~ 7Fï¼‰ å¦‚æœæ˜¯ 1 ä¸ªå­—èŠ‚ï¼Œä»¥ 11 å¼€å¤´ï¼Œåˆ™è¿ç»­çš„ 1 çš„ä¸ªæ•°æš—ç¤ºè¿™ä¸ªå­—ç¬¦çš„å­—èŠ‚æ•° å¦‚æœæ˜¯ 1 ä¸ªå­—èŠ‚ï¼Œä»¥ 10 å¼€å¤´ï¼Œè¡¨ç¤ºå®ƒä¸æ˜¯é¦–å­—èŠ‚ï¼Œåˆ™éœ€è¦å‘å‰æŸ¥æ‰¾æ‰èƒ½å¾—åˆ°å½“å‰å­—ç¬¦çš„é¦–å­—èŠ‚ â€‹ 2ã€åœ¨ Java ä¸­éœ€è¦ç¼–ç çš„åœºæ™¯2.1 åœ¨ I/O æ“ä½œä¸­å­˜åœ¨çš„ç¼–ç  å¦‚ä¸Šå›¾ï¼šReader ç±»æ˜¯åœ¨ Java çš„ I/O ä¸­è¯»å–ç¬¦çš„çˆ¶ç±»ï¼Œè€Œ InputStream ç±»æ˜¯è¯»å­—èŠ‚çš„çˆ¶ç±»ï¼Œ InputStreamReader ç±»å°±æ˜¯å…³è”å­—èŠ‚åˆ°å­—ç¬¦çš„æ¡¥æ¢ï¼Œå®ƒè´Ÿè´£åœ¨ I/O è¿‡ç¨‹ä¸­å¤„ç†è¯»å–å­—èŠ‚åˆ°å­—ç¬¦çš„è½¬æ¢ï¼Œè€Œå¯¹å…·ä½“å­—èŠ‚åˆ°å­—ç¬¦çš„è§£ç å®ç°ï¼Œå®ƒåˆå§”æ‰˜ StreamDecoder å»åšï¼Œåœ¨ StreamDecoder è§£ç è¿‡ç¨‹ä¸­å¿…é¡»ç”±ç”¨æˆ·æŒ‡å®š Charset ç¼–ç æ ¼å¼ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä½ æ²¡æœ‰æŒ‡å®š Charsetï¼Œåˆ™å°†ä½¿ç”¨æœ¬åœ°ç¯å¢ƒä¸­é»˜è®¤çš„å­—ç¬¦é›†ï¼Œå¦‚åœ¨ä¸­æ–‡ç¯å¢ƒä¸­å°†ä½¿ç”¨ GBK ç¼–ç ã€‚ å¦‚ä¸‹é¢ä¸€æ®µä»£ç ï¼Œå®ç°äº†æ–‡ä»¶çš„è¯»å†™åŠŸèƒ½ï¼š 12345678910111213141516171819202122232425String file = \"c:/stream.txt\";String charset = \"UTF-8\";// å†™å­—ç¬¦æ¢è½¬æˆå­—èŠ‚æµFileOutputStream outputStream = new FileOutputStream(file);OutputStreamWriter writer = new OutputStreamWriter(outputStream, charset);try &#123; writer.write(\"è¿™æ˜¯è¦ä¿å­˜çš„ä¸­æ–‡å­—ç¬¦\");&#125; finally &#123; writer.close();&#125;// è¯»å–å­—èŠ‚è½¬æ¢æˆå­—ç¬¦FileInputStream inputStream = new FileInputStream(file);InputStreamReader reader = new InputStreamReader(inputStream, charset);StringBuffer buffer = new StringBuffer();char[] buf = new char[64];int count = 0;try &#123; while ((count = reader.read(buf)) != -1) &#123; buffer.append(buffer, 0, count); &#125;&#125; finally &#123; reader.close();&#125; åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­æ¶‰åŠ I/O æ“ä½œæ—¶ï¼Œåªè¦æ³¨æ„æŒ‡å®šç»Ÿä¸€çš„ç¼–è§£ç  Charset å­—ç¬¦é›†ï¼Œä¸€èˆ¬ä¸ä¼šå‡ºç°ä¹±ç é—®é¢˜ã€‚ 2.2 åœ¨å†…å­˜æ“ä½œä¸­çš„ç¼–ç åœ¨å†…å­˜ä¸­è¿›è¡Œä»å­—ç¬¦åˆ°å­—èŠ‚çš„æ•°æ®ç±»å‹è½¬æ¢ã€‚ 1ã€String ç±»æä¾›å­—ç¬¦ä¸²è½¬æ¢åˆ°å­—èŠ‚çš„æ–¹æ³•ï¼Œä¹Ÿæ”¯æŒå°†å­—èŠ‚è½¬æ¢æˆå­—ç¬¦ä¸²çš„æ„é€ å‡½æ•°ã€‚ 123String s = \"å­—ç¬¦ä¸²\"ï¼›byte[] b = s.getBytes(\"UTF-8\");String n = new String(b, \"UTF-8\"); 2ã€Charset æä¾› encode ä¸ decodeï¼Œåˆ†åˆ«å¯¹åº” char[] åˆ° byte[] çš„ç¼–ç  å’Œ byte[] åˆ° char[] çš„è§£ç ã€‚ 123Charset charset = Charset.forName(\"UTF-8\");ByteBuffer byteBuffer = charset.encode(string);CharBuffer charBuffer = charset.decode(byteBuffer); â€¦ 3ã€åœ¨ Java ä¸­å¦‚ä½•ç¼–è§£ç Java ç¼–ç ç±»å›¾ é¦–å…ˆæ ¹æ®æŒ‡å®šçš„ charsetName é€šè¿‡ Charset.forName(charsetName) è®¾ç½® Charset ç±»ï¼Œç„¶åæ ¹æ® Charset åˆ›å»º CharsetEncoder å¯¹è±¡ï¼Œå†è°ƒç”¨ CharsetEncoder.encode å¯¹å­—ç¬¦ä¸²è¿›è¡Œç¼–ç ï¼Œä¸åŒçš„ç¼–ç ç±»å‹éƒ½ä¼šå¯¹åº”åˆ°ä¸€ä¸ªç±»ä¸­ï¼Œå®é™…çš„ç¼–ç è¿‡ç¨‹æ˜¯åœ¨è¿™äº›ç±»ä¸­å®Œæˆçš„ã€‚ä¸‹é¢æ˜¯ String. getBytes(charsetName) ç¼–ç è¿‡ç¨‹çš„æ—¶åºå›¾ Java ç¼–ç æ—¶åºå›¾ ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºæ ¹æ® charsetName æ‰¾åˆ° Charset ç±»ï¼Œç„¶åæ ¹æ®è¿™ä¸ªå­—ç¬¦é›†ç¼–ç ç”Ÿæˆ CharsetEncoderï¼Œè¿™ä¸ªç±»æ˜¯æ‰€æœ‰å­—ç¬¦ç¼–ç çš„çˆ¶ç±»ï¼Œé’ˆå¯¹ä¸åŒçš„å­—ç¬¦ç¼–ç é›†åœ¨å…¶å­ç±»ä¸­å®šä¹‰äº†å¦‚ä½•å®ç°ç¼–ç ï¼Œæœ‰äº† CharsetEncoder å¯¹è±¡åå°±å¯ä»¥è°ƒç”¨ encode æ–¹æ³•å»å®ç°ç¼–ç äº†ã€‚è¿™ä¸ªæ˜¯ String.getBytes ç¼–ç æ–¹æ³•ï¼Œå…¶å®ƒçš„å¦‚ StreamEncoder ä¸­ä¹Ÿæ˜¯ç±»ä¼¼çš„æ–¹å¼ã€‚ ç»å¸¸ä¼šå‡ºç°ä¸­æ–‡å˜æˆâ€œï¼Ÿâ€å¾ˆå¯èƒ½å°±æ˜¯é”™è¯¯çš„ä½¿ç”¨äº† ISO-8859-1 è¿™ä¸ªç¼–ç å¯¼è‡´çš„ã€‚ä¸­æ–‡å­—ç¬¦ç»è¿‡ ISO-8859-1 ç¼–ç ä¼šä¸¢å¤±ä¿¡æ¯ï¼Œé€šå¸¸æˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œé»‘æ´â€ï¼Œå®ƒä¼šæŠŠä¸è®¤è¯†çš„å­—ç¬¦å¸æ”¶æ‰ã€‚ç”±äºç°åœ¨å¤§éƒ¨åˆ†åŸºç¡€çš„ Java æ¡†æ¶æˆ–ç³»ç»Ÿé»˜è®¤çš„å­—ç¬¦é›†ç¼–ç éƒ½æ˜¯ ISO-8859-1ï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“å‡ºç°ä¹±ç é—®é¢˜ï¼Œåé¢å°†ä¼šåˆ†æä¸åŒçš„ä¹±ç å½¢å¼æ˜¯æ€ä¹ˆå‡ºç°çš„ã€‚ å‡ ç§ç¼–ç æ ¼å¼çš„æ¯”è¾ƒå¯¹ä¸­æ–‡å­—ç¬¦åé¢å››ç§ç¼–ç æ ¼å¼éƒ½èƒ½å¤„ç†ï¼ŒGB2312 ä¸ GBK ç¼–ç è§„åˆ™ç±»ä¼¼ï¼Œä½†æ˜¯ GBK èŒƒå›´æ›´å¤§ï¼Œå®ƒèƒ½å¤„ç†æ‰€æœ‰æ±‰å­—å­—ç¬¦ï¼Œæ‰€ä»¥ GB2312 ä¸ GBK æ¯”è¾ƒåº”è¯¥é€‰æ‹© GBKã€‚UTF-16 ä¸ UTF-8 éƒ½æ˜¯å¤„ç† Unicode ç¼–ç ï¼Œå®ƒä»¬çš„ç¼–ç è§„åˆ™ä¸å¤ªç›¸åŒï¼Œç›¸å¯¹æ¥è¯´ UTF-16 ç¼–ç æ•ˆç‡æœ€é«˜ï¼Œå­—ç¬¦åˆ°å­—èŠ‚ç›¸äº’è½¬æ¢æ›´ç®€å•ï¼Œè¿›è¡Œå­—ç¬¦ä¸²æ“ä½œä¹Ÿæ›´å¥½ã€‚å®ƒé€‚åˆåœ¨æœ¬åœ°ç£ç›˜å’Œå†…å­˜ä¹‹é—´ä½¿ç”¨ï¼Œå¯ä»¥è¿›è¡Œå­—ç¬¦å’Œå­—èŠ‚ä¹‹é—´å¿«é€Ÿåˆ‡æ¢ï¼Œå¦‚ Java çš„å†…å­˜ç¼–ç å°±æ˜¯é‡‡ç”¨ UTF-16 ç¼–ç ã€‚ä½†æ˜¯å®ƒä¸é€‚åˆåœ¨ç½‘ç»œä¹‹é—´ä¼ è¾“ï¼Œå› ä¸ºç½‘ç»œä¼ è¾“å®¹æ˜“æŸåå­—èŠ‚æµï¼Œä¸€æ—¦å­—èŠ‚æµæŸåå°†å¾ˆéš¾æ¢å¤ï¼Œæƒ³æ¯”è¾ƒè€Œè¨€ UTF-8 æ›´é€‚åˆç½‘ç»œä¼ è¾“ï¼Œå¯¹ ASCII å­—ç¬¦é‡‡ç”¨å•å­—èŠ‚å­˜å‚¨ï¼Œå¦å¤–å•ä¸ªå­—ç¬¦æŸåä¹Ÿä¸ä¼šå½±å“åé¢å…¶å®ƒå­—ç¬¦ï¼Œåœ¨ç¼–ç æ•ˆç‡ä¸Šä»‹äº GBK å’Œ UTF-16 ä¹‹é—´ï¼Œæ‰€ä»¥ UTF-8 åœ¨ç¼–ç æ•ˆç‡ä¸Šå’Œç¼–ç å®‰å…¨æ€§ä¸Šåšäº†å¹³è¡¡ï¼Œæ˜¯ç†æƒ³çš„ä¸­æ–‡ç¼–ç æ–¹å¼ã€‚ 4ã€åœ¨ Java Web ä¸­æ¶‰åŠçš„ç¼–è§£ç å¯¹äºä½¿ç”¨ä¸­æ–‡æ¥è¯´ï¼Œæœ‰ I/O çš„åœ°æ–¹å°±ä¼šæ¶‰åŠåˆ°ç¼–ç ï¼Œå‰é¢å·²ç»æåˆ°äº† I/O æ“ä½œä¼šå¼•èµ·ç¼–ç ï¼Œè€Œå¤§éƒ¨åˆ† I/O å¼•èµ·çš„ä¹±ç éƒ½æ˜¯ç½‘ç»œ I/Oï¼Œå› ä¸ºç°åœ¨å‡ ä¹æ‰€æœ‰çš„åº”ç”¨ç¨‹åºéƒ½æ¶‰åŠåˆ°ç½‘ç»œæ“ä½œï¼Œè€Œæ•°æ®ç»è¿‡ç½‘ç»œä¼ è¾“éƒ½æ˜¯ä»¥å­—èŠ‚ä¸ºå•ä½çš„ï¼Œæ‰€ä»¥æ‰€æœ‰çš„æ•°æ®éƒ½å¿…é¡»èƒ½å¤Ÿè¢«åºåˆ—åŒ–ä¸ºå­—èŠ‚ã€‚åœ¨ Java ä¸­æ•°æ®è¢«åºåˆ—åŒ–å¿…é¡»ç»§æ‰¿ Serializable æ¥å£ã€‚ ä¸€æ®µæ–‡æœ¬å®ƒçš„å®é™…å¤§å°åº”è¯¥æ€ä¹ˆè®¡ç®—ï¼Œæˆ‘æ›¾ç»ç¢°åˆ°è¿‡ä¸€ä¸ªé—®é¢˜ï¼šå°±æ˜¯è¦æƒ³åŠæ³•å‹ç¼© Cookie å¤§å°ï¼Œå‡å°‘ç½‘ç»œä¼ è¾“é‡ï¼Œå½“æ—¶æœ‰é€‰æ‹©ä¸åŒçš„å‹ç¼©ç®—æ³•ï¼Œå‘ç°å‹ç¼©åå­—ç¬¦æ•°æ˜¯å‡å°‘äº†ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å‡å°‘å­—èŠ‚æ•°ã€‚æ‰€è°“çš„å‹ç¼©åªæ˜¯å°†å¤šä¸ªå•å­—èŠ‚å­—ç¬¦é€šè¿‡ç¼–ç è½¬å˜æˆä¸€ä¸ªå¤šå­—èŠ‚å­—ç¬¦ã€‚å‡å°‘çš„æ˜¯ String.length()ï¼Œè€Œå¹¶æ²¡æœ‰å‡å°‘æœ€ç»ˆçš„å­—èŠ‚æ•°ã€‚ä¾‹å¦‚å°†â€œabâ€ä¸¤ä¸ªå­—ç¬¦é€šè¿‡æŸç§ç¼–ç è½¬å˜æˆä¸€ä¸ªå¥‡æ€ªçš„å­—ç¬¦ï¼Œè™½ç„¶å­—ç¬¦æ•°ä»ä¸¤ä¸ªå˜æˆä¸€ä¸ªï¼Œä½†æ˜¯å¦‚æœé‡‡ç”¨ UTF-8 ç¼–ç è¿™ä¸ªå¥‡æ€ªçš„å­—ç¬¦æœ€åç»è¿‡ç¼–ç å¯èƒ½åˆä¼šå˜æˆä¸‰ä¸ªæˆ–æ›´å¤šçš„å­—èŠ‚ã€‚åŒæ ·çš„é“ç†æ¯”å¦‚æ•´å‹æ•°å­— 1234567 å¦‚æœå½“æˆå­—ç¬¦æ¥å­˜å‚¨ï¼Œé‡‡ç”¨ UTF-8 æ¥ç¼–ç å ç”¨ 7 ä¸ª byteï¼Œé‡‡ç”¨ UTF-16 ç¼–ç å°†ä¼šå ç”¨ 14 ä¸ª byteï¼Œä½†æ˜¯æŠŠå®ƒå½“æˆ int å‹æ•°å­—æ¥å­˜å‚¨åªéœ€è¦ 4 ä¸ª byte æ¥å­˜å‚¨ã€‚æ‰€ä»¥çœ‹ä¸€æ®µæ–‡æœ¬çš„å¤§å°ï¼Œçœ‹å­—ç¬¦æœ¬èº«çš„é•¿åº¦æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œå³ä½¿æ˜¯ä¸€æ ·çš„å­—ç¬¦é‡‡ç”¨ä¸åŒçš„ç¼–ç æœ€ç»ˆå­˜å‚¨çš„å¤§å°ä¹Ÿä¼šä¸åŒï¼Œæ‰€ä»¥ä»å­—ç¬¦åˆ°å­—èŠ‚ä¸€å®šè¦çœ‹ç¼–ç ç±»å‹ã€‚ æˆ‘ä»¬èƒ½å¤Ÿçœ‹åˆ°çš„æ±‰å­—éƒ½æ˜¯ä»¥å­—ç¬¦å½¢å¼å‡ºç°çš„ï¼Œä¾‹å¦‚åœ¨ Java ä¸­â€œæ·˜å®â€ä¸¤ä¸ªå­—ç¬¦ï¼Œå®ƒåœ¨è®¡ç®—æœºä¸­çš„æ•°å€¼ 10 è¿›åˆ¶æ˜¯ 28120 å’Œ 23453ï¼Œ16 è¿›åˆ¶æ˜¯ 6bd8 å’Œ 5d9dï¼Œä¹Ÿå°±æ˜¯è¿™ä¸¤ä¸ªå­—ç¬¦æ˜¯ç”±è¿™ä¸¤ä¸ªæ•°å­—å”¯ä¸€è¡¨ç¤ºçš„ã€‚Java ä¸­ä¸€ä¸ª char æ˜¯ 16 ä¸ª bit ç›¸å½“äºä¸¤ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥ä¸¤ä¸ªæ±‰å­—ç”¨ char è¡¨ç¤ºåœ¨å†…å­˜ä¸­å ç”¨ç›¸å½“äºå››ä¸ªå­—èŠ‚çš„ç©ºé—´ã€‚ è¿™ä¸¤ä¸ªé—®é¢˜ææ¸…æ¥šåï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹ Java Web ä¸­é‚£äº›åœ°æ–¹å¯èƒ½ä¼šå­˜åœ¨ç¼–ç è½¬æ¢ï¼Ÿ ç”¨æˆ·ä»æµè§ˆå™¨ç«¯å‘èµ·ä¸€ä¸ª HTTP è¯·æ±‚ï¼Œéœ€è¦å­˜åœ¨ç¼–ç çš„åœ°æ–¹æ˜¯ URLã€Cookieã€Parameterã€‚æœåŠ¡å™¨ç«¯æ¥å—åˆ° HTTP è¯·æ±‚åè¦è§£æ HTTP åè®®ï¼Œå…¶ä¸­ URIã€Cookie å’Œ POST è¡¨å•å‚æ•°éœ€è¦è§£ç ï¼ŒæœåŠ¡å™¨ç«¯å¯èƒ½è¿˜éœ€è¦è¯»å–æ•°æ®åº“ä¸­çš„æ•°æ®ï¼Œæœ¬åœ°æˆ–ç½‘ç»œä¸­å…¶å®ƒåœ°æ–¹çš„æ–‡æœ¬æ–‡ä»¶ï¼Œè¿™äº›æ•°æ®éƒ½å¯èƒ½å­˜åœ¨ç¼–ç é—®é¢˜ï¼Œå½“ Servlet å¤„ç†å®Œæ‰€æœ‰è¯·æ±‚çš„æ•°æ®åï¼Œéœ€è¦å°†è¿™äº›æ•°æ®å†ç¼–ç é€šè¿‡ Socket å‘é€åˆ°ç”¨æˆ·è¯·æ±‚çš„æµè§ˆå™¨é‡Œï¼Œå†ç»è¿‡æµè§ˆå™¨è§£ç æˆä¸ºæ–‡æœ¬ã€‚è¿™äº›è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä¸€æ¬¡ HTTP è¯·æ±‚çš„ç¼–ç ç¤ºä¾‹ 4.1 URL çš„ç¼–è§£ç ç”¨æˆ·æäº¤ä¸€ä¸ª URLï¼Œè¿™ä¸ª URL ä¸­å¯èƒ½å­˜åœ¨ä¸­æ–‡ï¼Œå› æ­¤éœ€è¦ç¼–ç ï¼Œå¦‚ä½•å¯¹è¿™ä¸ª URL è¿›è¡Œç¼–ç ï¼Ÿæ ¹æ®ä»€ä¹ˆè§„åˆ™æ¥ç¼–ç ï¼Ÿæœ‰å¦‚ä½•æ¥è§£ç ï¼Ÿå¦‚ä¸‹å›¾ä¸€ä¸ª URLï¼š ä¸Šå›¾ä¸­ä»¥ Tomcat ä½œä¸º Servlet Engine ä¸ºä¾‹ï¼Œå®ƒä»¬åˆ†åˆ«å¯¹åº”åˆ°ä¸‹é¢è¿™äº›é…ç½®æ–‡ä»¶ä¸­ï¼šPort å¯¹åº”åœ¨ Tomcat çš„ ä¸­é…ç½®ï¼Œè€Œ Context Path åœ¨ ä¸­é…ç½®ï¼ŒServlet Path åœ¨ Web åº”ç”¨çš„ web.xml ä¸­çš„ 1234&lt;servlet-mapping&gt; &lt;servlet-name&gt;junshanExample&lt;/servlet-name&gt; &lt;url-pattern&gt;/servlets/servlet/*&lt;/url-pattern&gt; &lt;/servlet-mapping&gt; ä¸­é…ç½®ï¼ŒPathInfo æ˜¯æˆ‘ä»¬è¯·æ±‚çš„å…·ä½“çš„ Servletï¼ŒQueryString æ˜¯è¦ä¼ é€’çš„å‚æ•°ï¼Œæ³¨æ„è¿™é‡Œæ˜¯åœ¨æµè§ˆå™¨é‡Œç›´æ¥è¾“å…¥ URL æ‰€ä»¥æ˜¯é€šè¿‡ Get æ–¹æ³•è¯·æ±‚çš„ï¼Œå¦‚æœæ˜¯ POST æ–¹æ³•è¯·æ±‚çš„è¯ï¼ŒQueryString å°†é€šè¿‡è¡¨å•æ–¹å¼æäº¤åˆ°æœåŠ¡å™¨ç«¯ã€‚ ä¸Šå›¾ä¸­ PathInfo å’Œ QueryString å‡ºç°äº†ä¸­æ–‡ï¼Œå½“æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­ç›´æ¥è¾“å…¥è¿™ä¸ª URL æ—¶ï¼Œåœ¨æµè§ˆå™¨ç«¯å’ŒæœåŠ¡ç«¯ä¼šå¦‚ä½•ç¼–ç å’Œè§£æè¿™ä¸ª URL å‘¢ï¼Ÿä¸ºäº†éªŒè¯æµè§ˆå™¨æ˜¯æ€ä¹ˆç¼–ç  URL çš„æˆ‘é€‰æ‹©çš„æ˜¯360æé€Ÿæµè§ˆå™¨å¹¶é€šè¿‡ Postman æ’ä»¶è§‚å¯Ÿæˆ‘ä»¬è¯·æ±‚çš„ URL çš„å®é™…çš„å†…å®¹ï¼Œä»¥ä¸‹æ˜¯ URLï¼š HTTP://localhost:8080/examples/servlets/servlet/å›å±±?author=å›å±± å›å±±çš„ç¼–ç ç»“æœæ˜¯ï¼še5 90 9b e5 b1 b1ï¼Œå’Œã€Šæ·±å…¥åˆ†æ Java Web æŠ€æœ¯å†…å¹•ã€‹ä¸­çš„ç»“æœä¸ä¸€æ ·ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä½¿ç”¨çš„æµè§ˆå™¨å’Œæ’ä»¶å’ŒåŸä½œè€…æ˜¯æœ‰åŒºåˆ«çš„ï¼Œé‚£ä¹ˆè¿™äº›æµè§ˆå™¨ä¹‹é—´çš„é»˜è®¤ç¼–ç æ˜¯ä¸ä¸€æ ·çš„ï¼ŒåŸæ–‡ä¸­çš„ç»“æœæ˜¯ï¼š å›å±±çš„ç¼–ç ç»“æœåˆ†åˆ«æ˜¯ï¼še5 90 9b e5 b1 b1ï¼Œbe fd c9 bdï¼ŒæŸ¥é˜…ä¸Šä¸€å±Šçš„ç¼–ç å¯çŸ¥ï¼ŒPathInfo æ˜¯ UTF-8 ç¼–ç è€Œ QueryString æ˜¯ç»è¿‡ GBK ç¼–ç ï¼Œè‡³äºä¸ºä»€ä¹ˆä¼šæœ‰â€œ%â€ï¼ŸæŸ¥é˜… URL çš„ç¼–ç è§„èŒƒ RFC3986 å¯çŸ¥æµè§ˆå™¨ç¼–ç  URL æ˜¯å°†é ASCII å­—ç¬¦æŒ‰ç…§æŸç§ç¼–ç æ ¼å¼ç¼–ç æˆ 16 è¿›åˆ¶æ•°å­—ç„¶åå°†æ¯ä¸ª 16 è¿›åˆ¶è¡¨ç¤ºçš„å­—èŠ‚å‰åŠ ä¸Šâ€œ%â€ï¼Œæ‰€ä»¥æœ€ç»ˆçš„ URL å°±æˆäº†ä¸Šå›¾çš„æ ¼å¼äº†ã€‚ ä»ä¸Šé¢æµ‹è¯•ç»“æœå¯çŸ¥æµè§ˆå™¨å¯¹ PathInfo å’Œ QueryString çš„ç¼–ç æ˜¯ä¸ä¸€æ ·çš„ï¼Œä¸åŒæµè§ˆå™¨å¯¹ PathInfo ä¹Ÿå¯èƒ½ä¸ä¸€æ ·ï¼Œè¿™å°±å¯¹æœåŠ¡å™¨çš„è§£ç é€ æˆå¾ˆå¤§çš„å›°éš¾ï¼Œä¸‹é¢æˆ‘ä»¬ä»¥ Tomcat ä¸ºä¾‹çœ‹ä¸€ä¸‹ï¼ŒTomcat æ¥å—åˆ°è¿™ä¸ª URL æ˜¯å¦‚ä½•è§£ç çš„ã€‚ è§£æè¯·æ±‚çš„ URL æ˜¯åœ¨ org.apache.coyote.HTTP11.InternalInputBuffer çš„ parseRequestLine æ–¹æ³•ä¸­ï¼Œè¿™ä¸ªæ–¹æ³•æŠŠä¼ è¿‡æ¥çš„ URL çš„ byte[] è®¾ç½®åˆ° org.apache.coyote.Request çš„ç›¸åº”çš„å±æ€§ä¸­ã€‚è¿™é‡Œçš„ URL ä»ç„¶æ˜¯ byte æ ¼å¼ï¼Œè½¬æˆ char æ˜¯åœ¨ org.apache.catalina.connector.CoyoteAdapter çš„ convertURI æ–¹æ³•ä¸­å®Œæˆçš„ï¼š 12345678910111213141516171819202122232425262728293031323334protected void convertURI(MessageBytes uri, Request request) throws Exception &#123; ByteChunk bc = uri.getByteChunk(); int length = bc.getLength(); CharChunk cc = uri.getCharChunk(); cc.allocate(length, -1); String enc = connector.getURIEncoding(); if (enc != null) &#123; B2CConverter conv = request.getURIConverter(); try &#123; if (conv == null) &#123; conv = new B2CConverter(enc); request.setURIConverter(conv); &#125; &#125; catch (IOException e) &#123;...&#125; if (conv != null) &#123; try &#123; conv.convert(bc, cc, cc.getBuffer().length - cc.getEnd()); uri.setChars(cc.getBuffer(), cc.getStart(), cc.getLength()); return; &#125; catch (IOException e) &#123;...&#125; &#125; &#125; // Default encoding: fast conversion byte[] bbuf = bc.getBuffer(); char[] cbuf = cc.getBuffer(); int start = bc.getStart(); for (int i = 0; i &lt; length; i++) &#123; cbuf[i] = (char) (bbuf[i + start] &amp; 0xff); &#125; uri.setChars(cbuf, 0, length); &#125; ä»ä¸Šé¢çš„ä»£ç ä¸­å¯ä»¥çŸ¥é“å¯¹ URL çš„ URI éƒ¨åˆ†è¿›è¡Œè§£ç çš„å­—ç¬¦é›†æ˜¯åœ¨ connector çš„ ä¸­å®šä¹‰çš„ï¼Œå¦‚æœæ²¡æœ‰å®šä¹‰ï¼Œé‚£ä¹ˆå°†ä»¥é»˜è®¤ç¼–ç  ISO-8859-1 è§£æã€‚æ‰€ä»¥å¦‚æœæœ‰ä¸­æ–‡ URL æ—¶æœ€å¥½æŠŠ URIEncoding è®¾ç½®æˆ UTF-8 ç¼–ç ã€‚ QueryString åˆå¦‚ä½•è§£æï¼Ÿ GET æ–¹å¼ HTTP è¯·æ±‚çš„ QueryString ä¸ POST æ–¹å¼ HTTP è¯·æ±‚çš„è¡¨å•å‚æ•°éƒ½æ˜¯ä½œä¸º Parameters ä¿å­˜ï¼Œéƒ½æ˜¯é€šè¿‡ request.getParameter è·å–å‚æ•°å€¼ã€‚å¯¹å®ƒä»¬çš„è§£ç æ˜¯åœ¨ request.getParameter æ–¹æ³•ç¬¬ä¸€æ¬¡è¢«è°ƒç”¨æ—¶è¿›è¡Œçš„ã€‚request.getParameter æ–¹æ³•è¢«è°ƒç”¨æ—¶å°†ä¼šè°ƒç”¨ org.apache.catalina.connector.Request çš„ parseParameters æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•å°†ä¼šå¯¹ GET å’Œ POST æ–¹å¼ä¼ é€’çš„å‚æ•°è¿›è¡Œè§£ç ï¼Œä½†æ˜¯å®ƒä»¬çš„è§£ç å­—ç¬¦é›†æœ‰å¯èƒ½ä¸ä¸€æ ·ã€‚POST è¡¨å•çš„è§£ç å°†åœ¨åé¢ä»‹ç»ï¼ŒQueryString çš„è§£ç å­—ç¬¦é›†æ˜¯åœ¨å“ªå®šä¹‰çš„å‘¢ï¼Ÿå®ƒæœ¬èº«æ˜¯é€šè¿‡ HTTP çš„ Header ä¼ åˆ°æœåŠ¡ç«¯çš„ï¼Œå¹¶ä¸”ä¹Ÿåœ¨ URL ä¸­ï¼Œæ˜¯å¦å’Œ URI çš„è§£ç å­—ç¬¦é›†ä¸€æ ·å‘¢ï¼Ÿä»å‰é¢æµè§ˆå™¨å¯¹ PathInfo å’Œ QueryString çš„ç¼–ç é‡‡å–ä¸åŒçš„ç¼–ç æ ¼å¼ä¸åŒå¯ä»¥çŒœæµ‹åˆ°è§£ç å­—ç¬¦é›†è‚¯å®šä¹Ÿä¸ä¼šæ˜¯ä¸€è‡´çš„ã€‚çš„ç¡®æ˜¯è¿™æ · QueryString çš„è§£ç å­—ç¬¦é›†è¦ä¹ˆæ˜¯ Header ä¸­ ContentType ä¸­å®šä¹‰çš„ Charset è¦ä¹ˆå°±æ˜¯é»˜è®¤çš„ ISO-8859-1ï¼Œè¦ä½¿ç”¨ ContentType ä¸­å®šä¹‰çš„ç¼–ç å°±è¦è®¾ç½® connector çš„ ä¸­çš„ useBodyEncodingForURI è®¾ç½®ä¸º trueã€‚è¿™ä¸ªé…ç½®é¡¹çš„åå­—æœ‰ç‚¹è®©äººäº§ç”Ÿæ··æ·†ï¼Œå®ƒå¹¶ä¸æ˜¯å¯¹æ•´ä¸ª URI éƒ½é‡‡ç”¨ BodyEncoding è¿›è¡Œè§£ç è€Œä»…ä»…æ˜¯å¯¹ QueryString ä½¿ç”¨ BodyEncoding è§£ç ï¼Œè¿™ä¸€ç‚¹è¿˜è¦ç‰¹åˆ«æ³¨æ„ã€‚ ä»ä¸Šé¢çš„ URL ç¼–ç å’Œè§£ç è¿‡ç¨‹æ¥çœ‹ï¼Œæ¯”è¾ƒå¤æ‚ï¼Œè€Œä¸”ç¼–ç å’Œè§£ç å¹¶ä¸æ˜¯æˆ‘ä»¬åœ¨åº”ç”¨ç¨‹åºä¸­èƒ½å®Œå…¨æ§åˆ¶çš„ï¼Œæ‰€ä»¥åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­åº”è¯¥å°½é‡é¿å…åœ¨ URL ä¸­ä½¿ç”¨é ASCII å­—ç¬¦ï¼Œä¸ç„¶å¾ˆå¯èƒ½ä¼šç¢°åˆ°ä¹±ç é—®é¢˜ï¼Œå½“ç„¶åœ¨æˆ‘ä»¬çš„æœåŠ¡å™¨ç«¯æœ€å¥½è®¾ç½® ä¸­çš„ URIEncoding å’Œ useBodyEncodingForURI ä¸¤ä¸ªå‚æ•°ã€‚ 4.2 HTTP Header çš„ç¼–è§£ç å½“å®¢æˆ·ç«¯å‘èµ·ä¸€ä¸ª HTTP è¯·æ±‚é™¤äº†ä¸Šé¢çš„ URL å¤–è¿˜å¯èƒ½ä¼šåœ¨ Header ä¸­ä¼ é€’å…¶å®ƒå‚æ•°å¦‚ Cookieã€redirectPath ç­‰ï¼Œè¿™äº›ç”¨æˆ·è®¾ç½®çš„å€¼å¾ˆå¯èƒ½ä¹Ÿä¼šå­˜åœ¨ç¼–ç é—®é¢˜ï¼ŒTomcat å¯¹å®ƒä»¬åˆæ˜¯æ€ä¹ˆè§£ç çš„å‘¢ï¼Ÿ å¯¹ Header ä¸­çš„é¡¹è¿›è¡Œè§£ç ä¹Ÿæ˜¯åœ¨è°ƒç”¨ request.getHeader æ˜¯è¿›è¡Œçš„ï¼Œå¦‚æœè¯·æ±‚çš„ Header é¡¹æ²¡æœ‰è§£ç åˆ™è°ƒç”¨ MessageBytes çš„ toString æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å°†ä» byte åˆ° char çš„è½¬åŒ–ä½¿ç”¨çš„é»˜è®¤ç¼–ç ä¹Ÿæ˜¯ ISO-8859-1ï¼Œè€Œæˆ‘ä»¬ä¹Ÿä¸èƒ½è®¾ç½® Header çš„å…¶å®ƒè§£ç æ ¼å¼ï¼Œæ‰€ä»¥å¦‚æœä½ è®¾ç½® Header ä¸­æœ‰é ASCII å­—ç¬¦è§£ç è‚¯å®šä¼šæœ‰ä¹±ç ã€‚ æˆ‘ä»¬åœ¨æ·»åŠ  Header æ—¶ä¹Ÿæ˜¯åŒæ ·çš„é“ç†ï¼Œä¸è¦åœ¨ Header ä¸­ä¼ é€’é ASCII å­—ç¬¦ï¼Œå¦‚æœä¸€å®šè¦ä¼ é€’çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå°†è¿™äº›å­—ç¬¦ç”¨ org.apache.catalina.util.URLEncoder ç¼–ç ç„¶åå†æ·»åŠ åˆ° Header ä¸­ï¼Œè¿™æ ·åœ¨æµè§ˆå™¨åˆ°æœåŠ¡å™¨çš„ä¼ é€’è¿‡ç¨‹ä¸­å°±ä¸ä¼šä¸¢å¤±ä¿¡æ¯äº†ï¼Œå¦‚æœæˆ‘ä»¬è¦è®¿é—®è¿™äº›é¡¹æ—¶å†æŒ‰ç…§ç›¸åº”çš„å­—ç¬¦é›†è§£ç å°±å¥½äº†ã€‚ 4.3 POST è¡¨å•çš„ç¼–è§£ç åœ¨å‰é¢æåˆ°äº† POST è¡¨å•æäº¤çš„å‚æ•°çš„è§£ç æ˜¯åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨ request.getParameter å‘ç”Ÿçš„ï¼ŒPOST è¡¨å•å‚æ•°ä¼ é€’æ–¹å¼ä¸ QueryString ä¸åŒï¼Œå®ƒæ˜¯é€šè¿‡ HTTP çš„ BODY ä¼ é€’åˆ°æœåŠ¡ç«¯çš„ã€‚å½“æˆ‘ä»¬åœ¨é¡µé¢ä¸Šç‚¹å‡» submit æŒ‰é’®æ—¶æµè§ˆå™¨é¦–å…ˆå°†æ ¹æ® ContentType çš„ Charset ç¼–ç æ ¼å¼å¯¹è¡¨å•å¡«çš„å‚æ•°è¿›è¡Œç¼–ç ç„¶åæäº¤åˆ°æœåŠ¡å™¨ç«¯ï¼Œåœ¨æœåŠ¡å™¨ç«¯åŒæ ·ä¹Ÿæ˜¯ç”¨ ContentType ä¸­å­—ç¬¦é›†è¿›è¡Œè§£ç ã€‚æ‰€ä»¥é€šè¿‡ POST è¡¨å•æäº¤çš„å‚æ•°ä¸€èˆ¬ä¸ä¼šå‡ºç°é—®é¢˜ï¼Œè€Œä¸”è¿™ä¸ªå­—ç¬¦é›†ç¼–ç æ˜¯æˆ‘ä»¬è‡ªå·±è®¾ç½®çš„ï¼Œå¯ä»¥é€šè¿‡ request.setCharacterEncoding(charset) æ¥è®¾ç½®ã€‚ å¦å¤–é’ˆå¯¹ multipart/form-data ç±»å‹çš„å‚æ•°ï¼Œä¹Ÿå°±æ˜¯ä¸Šä¼ çš„æ–‡ä»¶ç¼–ç åŒæ ·ä¹Ÿæ˜¯ä½¿ç”¨ ContentType å®šä¹‰çš„å­—ç¬¦é›†ç¼–ç ï¼Œå€¼å¾—æ³¨æ„çš„åœ°æ–¹æ˜¯ä¸Šä¼ æ–‡ä»¶æ˜¯ç”¨å­—èŠ‚æµçš„æ–¹å¼ä¼ è¾“åˆ°æœåŠ¡å™¨çš„æœ¬åœ°ä¸´æ—¶ç›®å½•ï¼Œè¿™ä¸ªè¿‡ç¨‹å¹¶æ²¡æœ‰æ¶‰åŠåˆ°å­—ç¬¦ç¼–ç ï¼Œè€ŒçœŸæ­£ç¼–ç æ˜¯åœ¨å°†æ–‡ä»¶å†…å®¹æ·»åŠ åˆ° parameters ä¸­ï¼Œå¦‚æœç”¨è¿™ä¸ªç¼–ç ä¸èƒ½ç¼–ç æ—¶å°†ä¼šç”¨é»˜è®¤ç¼–ç  ISO-8859-1 æ¥ç¼–ç ã€‚ 4.4 HTTP BODY çš„ç¼–è§£ç å½“ç”¨æˆ·è¯·æ±‚çš„èµ„æºå·²ç»æˆåŠŸè·å–åï¼Œè¿™äº›å†…å®¹å°†é€šè¿‡ Response è¿”å›ç»™å®¢æˆ·ç«¯æµè§ˆå™¨ï¼Œè¿™ä¸ªè¿‡ç¨‹å…ˆè¦ç»è¿‡ç¼–ç å†åˆ°æµè§ˆå™¨è¿›è¡Œè§£ç ã€‚è¿™ä¸ªè¿‡ç¨‹çš„ç¼–è§£ç å­—ç¬¦é›†å¯ä»¥é€šè¿‡ response.setCharacterEncoding æ¥è®¾ç½®ï¼Œå®ƒå°†ä¼šè¦†ç›– request.getCharacterEncoding çš„å€¼ï¼Œå¹¶ä¸”é€šè¿‡ Header çš„ Content-Type è¿”å›å®¢æˆ·ç«¯ï¼Œæµè§ˆå™¨æ¥å—åˆ°è¿”å›çš„ socket æµæ—¶å°†é€šè¿‡ Content-Type çš„ charset æ¥è§£ç ï¼Œå¦‚æœè¿”å›çš„ HTTP Header ä¸­ Content-Type æ²¡æœ‰è®¾ç½® charsetï¼Œé‚£ä¹ˆæµè§ˆå™¨å°†æ ¹æ® Html çš„ ä¸­çš„ charset æ¥è§£ç ã€‚å¦‚æœä¹Ÿæ²¡æœ‰å®šä¹‰çš„è¯ï¼Œé‚£ä¹ˆæµè§ˆå™¨å°†ä½¿ç”¨é»˜è®¤çš„ç¼–ç æ¥è§£ç ã€‚ 4.5 å…¶å®ƒéœ€è¦ç¼–ç çš„åœ°æ–¹é™¤äº† URL å’Œå‚æ•°ç¼–ç é—®é¢˜å¤–ï¼Œåœ¨æœåŠ¡ç«¯è¿˜æœ‰å¾ˆå¤šåœ°æ–¹å¯èƒ½å­˜åœ¨ç¼–ç ï¼Œå¦‚å¯èƒ½éœ€è¦è¯»å– xmlã€velocity æ¨¡ç‰ˆå¼•æ“ã€JSP æˆ–è€…ä»æ•°æ®åº“è¯»å–æ•°æ®ç­‰ã€‚xml æ–‡ä»¶å¯ä»¥é€šè¿‡è®¾ç½®å¤´æ¥åˆ¶å®šç¼–ç æ ¼å¼ 1&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; Velocity æ¨¡ç‰ˆè®¾ç½®ç¼–ç æ ¼å¼ï¼š 1services.VelocityService.input.encoding=UTF-8 JSP è®¾ç½®ç¼–ç æ ¼å¼ï¼š 1&lt;%@page contentType=&quot;text/html; charset=UTF-8&quot;%&gt; è®¿é—®æ•°æ®åº“éƒ½æ˜¯é€šè¿‡å®¢æˆ·ç«¯ JDBC é©±åŠ¨æ¥å®Œæˆï¼Œç”¨ JDBC æ¥å­˜å–æ•°æ®è¦å’Œæ•°æ®çš„å†…ç½®ç¼–ç ä¿æŒä¸€è‡´ï¼Œå¯ä»¥é€šè¿‡è®¾ç½® JDBC URL æ¥åˆ¶å®šå¦‚ MySQLï¼šurl=â€jdbc:mysql://localhost:3306/DB?useUnicode=true&amp;characterEncoding=GBKâ€ã€‚ 5ã€å¸¸è§é—®é¢˜åˆ†æä¸‹é¢çœ‹ä¸€ä¸‹ï¼Œå½“æˆ‘ä»¬ç¢°åˆ°ä¸€äº›ä¹±ç æ—¶ï¼Œåº”è¯¥æ€ä¹ˆå¤„ç†è¿™äº›é—®é¢˜ï¼Ÿå‡ºç°ä¹±ç é—®é¢˜å”¯ä¸€çš„åŸå› éƒ½æ˜¯åœ¨ char åˆ° byte æˆ– byte åˆ° char è½¬æ¢ä¸­ç¼–ç å’Œè§£ç çš„å­—ç¬¦é›†ä¸ä¸€è‡´å¯¼è‡´çš„ï¼Œç”±äºå¾€å¾€ä¸€æ¬¡æ“ä½œæ¶‰åŠåˆ°å¤šæ¬¡ç¼–è§£ç ï¼Œæ‰€ä»¥å‡ºç°ä¹±ç æ—¶å¾ˆéš¾æŸ¥æ‰¾åˆ°åº•æ˜¯å“ªä¸ªç¯èŠ‚å‡ºç°äº†é—®é¢˜ï¼Œä¸‹é¢å°±å‡ ç§å¸¸è§çš„ç°è±¡è¿›è¡Œåˆ†æã€‚ 5.1 ä¸­æ–‡å˜æˆäº†çœ‹ä¸æ‡‚çš„å­—ç¬¦ä¾‹å¦‚ï¼Œå­—ç¬¦ä¸²â€œæ·˜ï¼æˆ‘å–œæ¬¢ï¼â€å˜æˆäº†â€œÃŒ Ã” Â£ Â¡Ã Ã’ ÃÂ²Â»Â¶ Â£ Â¡â€ç¼–ç è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å­—ç¬¦ä¸²åœ¨è§£ç æ—¶æ‰€ç”¨çš„å­—ç¬¦é›†ä¸ç¼–ç å­—ç¬¦é›†ä¸ä¸€è‡´å¯¼è‡´æ±‰å­—å˜æˆäº†çœ‹ä¸æ‡‚çš„ä¹±ç ï¼Œè€Œä¸”æ˜¯ä¸€ä¸ªæ±‰å­—å­—ç¬¦å˜æˆä¸¤ä¸ªä¹±ç å­—ç¬¦ã€‚ 5.2 ä¸€ä¸ªæ±‰å­—å˜æˆä¸€ä¸ªé—®å·ä¾‹å¦‚ï¼Œå­—ç¬¦ä¸²â€œæ·˜ï¼æˆ‘å–œæ¬¢ï¼â€å˜æˆäº†â€œï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿâ€ç¼–ç è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤º: å°†ä¸­æ–‡å’Œä¸­æ–‡ç¬¦å·ç»è¿‡ä¸æ”¯æŒä¸­æ–‡çš„ ISO-8859-1 ç¼–ç åï¼Œæ‰€æœ‰å­—ç¬¦å˜æˆäº†â€œï¼Ÿâ€ï¼Œè¿™æ˜¯å› ä¸ºç”¨ ISO-8859-1 è¿›è¡Œç¼–è§£ç æ—¶é‡åˆ°ä¸åœ¨ç å€¼èŒƒå›´å†…çš„å­—ç¬¦æ—¶ç»Ÿä¸€ç”¨ 3f è¡¨ç¤ºï¼Œè¿™ä¹Ÿå°±æ˜¯é€šå¸¸æ‰€è¯´çš„â€œé»‘æ´â€ï¼Œæ‰€æœ‰ ISO-8859-1 ä¸è®¤è¯†çš„å­—ç¬¦éƒ½å˜æˆäº†â€œï¼Ÿâ€ã€‚ 5.3 ä¸€ä¸ªæ±‰å­—å˜æˆä¸¤ä¸ªé—®å·ä¾‹å¦‚ï¼Œå­—ç¬¦ä¸²â€œæ·˜ï¼æˆ‘å–œæ¬¢ï¼â€å˜æˆäº†â€œï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿâ€ç¼–ç è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤º: è¿™ç§æƒ…å†µæ¯”è¾ƒå¤æ‚ï¼Œä¸­æ–‡ç»è¿‡å¤šæ¬¡ç¼–ç ï¼Œä½†æ˜¯å…¶ä¸­æœ‰ä¸€æ¬¡ç¼–ç æˆ–è€…è§£ç ä¸å¯¹ä»ç„¶ä¼šå‡ºç°ä¸­æ–‡å­—ç¬¦å˜æˆâ€œï¼Ÿâ€ç°è±¡ï¼Œå‡ºç°è¿™ç§æƒ…å†µè¦ä»”ç»†æŸ¥çœ‹ä¸­é—´çš„ç¼–ç ç¯èŠ‚ï¼Œæ‰¾å‡ºå‡ºç°ç¼–ç é”™è¯¯çš„åœ°æ–¹ã€‚ 5.4 ä¸€ç§ä¸æ­£å¸¸çš„æ­£ç¡®ç¼–ç è¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯åœ¨æˆ‘ä»¬é€šè¿‡ request.getParameter è·å–å‚æ•°å€¼æ—¶ï¼Œå½“æˆ‘ä»¬ç›´æ¥è°ƒç”¨ String value = request.getParameter(name); ä¼šå‡ºç°ä¹±ç ï¼Œä½†æ˜¯å¦‚æœç”¨ä¸‹é¢çš„æ–¹å¼ String value = String(request.getParameter(name).getBytes(&quot; ISO-8859-1&quot;), &quot;GBK&quot;); è§£ææ—¶å–å¾—çš„ value ä¼šæ˜¯æ­£ç¡®çš„æ±‰å­—å­—ç¬¦ï¼Œè¿™ç§æƒ…å†µæ˜¯æ€ä¹ˆé€ æˆçš„å‘¢ï¼Ÿ çœ‹ä¸‹å¦‚æ‰€ç¤ºï¼š è¿™ç§æƒ…å†µæ˜¯è¿™æ ·çš„ï¼ŒISO-8859-1 å­—ç¬¦é›†çš„ç¼–ç èŒƒå›´æ˜¯ 0000-00FFï¼Œæ­£å¥½å’Œä¸€ä¸ªå­—èŠ‚çš„ç¼–ç èŒƒå›´ç›¸å¯¹åº”ã€‚è¿™ç§ç‰¹æ€§ä¿è¯äº†ä½¿ç”¨ ISO-8859-1 è¿›è¡Œç¼–ç å’Œè§£ç å¯ä»¥ä¿æŒç¼–ç æ•°å€¼â€œä¸å˜â€ã€‚è™½ç„¶ä¸­æ–‡å­—ç¬¦åœ¨ç»è¿‡ç½‘ç»œä¼ è¾“æ—¶ï¼Œè¢«é”™è¯¯åœ°â€œæ‹†â€æˆäº†ä¸¤ä¸ªæ¬§æ´²å­—ç¬¦ï¼Œä½†ç”±äºè¾“å‡ºæ—¶ä¹Ÿæ˜¯ç”¨ ISO-8859-1ï¼Œç»“æœè¢«â€œæ‹†â€å¼€çš„ä¸­æ–‡å­—çš„ä¸¤åŠåˆè¢«åˆå¹¶åœ¨ä¸€èµ·ï¼Œä»è€Œåˆåˆšå¥½ç»„æˆäº†ä¸€ä¸ªæ­£ç¡®çš„æ±‰å­—ã€‚è™½ç„¶æœ€ç»ˆèƒ½å–å¾—æ­£ç¡®çš„æ±‰å­—ï¼Œä½†æ˜¯è¿˜æ˜¯ä¸å»ºè®®ç”¨è¿™ç§ä¸æ­£å¸¸çš„æ–¹å¼å–å¾—å‚æ•°å€¼ï¼Œå› ä¸ºè¿™ä¸­é—´å¢åŠ äº†ä¸€æ¬¡é¢å¤–çš„ç¼–ç ä¸è§£ç ï¼Œè¿™ç§æƒ…å†µå‡ºç°ä¹±ç æ—¶å› ä¸º Tomcat çš„é…ç½®æ–‡ä»¶ä¸­ useBodyEncodingForURI é…ç½®é¡¹æ²¡æœ‰è®¾ç½®ä¸ºâ€trueâ€ï¼Œä»è€Œé€ æˆç¬¬ä¸€æ¬¡è§£æå¼ç”¨ ISO-8859-1 æ¥è§£ææ‰é€ æˆä¹±ç çš„ã€‚ 6ã€æ€»ç»“æœ¬æ–‡é¦–å…ˆæ€»ç»“äº†å‡ ç§å¸¸è§ç¼–ç æ ¼å¼çš„åŒºåˆ«ï¼Œç„¶åä»‹ç»äº†æ”¯æŒä¸­æ–‡çš„å‡ ç§ç¼–ç æ ¼å¼ï¼Œå¹¶æ¯”è¾ƒäº†å®ƒä»¬çš„ä½¿ç”¨åœºæ™¯ã€‚æ¥ç€ä»‹ç»äº† Java é‚£äº›åœ°æ–¹ä¼šæ¶‰åŠåˆ°ç¼–ç é—®é¢˜ï¼Œå·²ç» Java ä¸­å¦‚ä½•å¯¹ç¼–ç çš„æ”¯æŒã€‚å¹¶ä»¥ç½‘ç»œ I/O ä¸ºä¾‹é‡ç‚¹ä»‹ç»äº† HTTP è¯·æ±‚ä¸­çš„å­˜åœ¨ç¼–ç çš„åœ°æ–¹ï¼Œä»¥åŠ Tomcat å¯¹ HTTP åè®®çš„è§£æï¼Œæœ€ååˆ†æäº†æˆ‘ä»¬å¹³å¸¸é‡åˆ°çš„ä¹±ç é—®é¢˜å‡ºç°çš„åŸå› ã€‚ ç»¼ä¸Šæ‰€è¿°ï¼Œè¦è§£å†³ä¸­æ–‡é—®é¢˜ï¼Œé¦–å…ˆè¦ææ¸…æ¥šå“ªäº›åœ°æ–¹ä¼šå¼•èµ·å­—ç¬¦åˆ°å­—èŠ‚çš„ç¼–ç ä»¥åŠå­—èŠ‚åˆ°å­—ç¬¦çš„è§£ç ï¼Œæœ€å¸¸è§çš„åœ°æ–¹å°±æ˜¯è¯»å–ä¼šå­˜å‚¨æ•°æ®åˆ°ç£ç›˜ï¼Œæˆ–è€…æ•°æ®è¦ç»è¿‡ç½‘ç»œä¼ è¾“ã€‚ç„¶åé’ˆå¯¹è¿™äº›åœ°æ–¹ææ¸…æ¥šæ“ä½œè¿™äº›æ•°æ®çš„æ¡†æ¶çš„æˆ–ç³»ç»Ÿæ˜¯å¦‚ä½•æ§åˆ¶ç¼–ç çš„ï¼Œæ­£ç¡®è®¾ç½®ç¼–ç æ ¼å¼ï¼Œé¿å…ä½¿ç”¨è½¯ä»¶é»˜è®¤çš„æˆ–è€…æ˜¯æ“ä½œç³»ç»Ÿå¹³å°é»˜è®¤çš„ç¼–ç æ ¼å¼ã€‚ æ³¨æ˜ï¼šæ–‡ç« å¤§éƒ¨åˆ†å‚è€ƒä¹¦ç±ã€Šæ·±å…¥ Java Web æŠ€æœ¯å†…å¹•ã€‹ç¬¬ä¸‰ç« ï¼Œè‡ªå·±æœ‰åˆ å‡ï¼ŒäºŒæ¬¡è½¬è½½è¯·ä¹ŸåŠ¡å¿…æ³¨æ˜æ­¤å‡ºå¤„ã€‚","tags":[{"name":"Java","slug":"Java","permalink":"http://www.54tianzhisheng.cn/tags/Java/"},{"name":"ç¼–ç ","slug":"ç¼–ç ","permalink":"http://www.54tianzhisheng.cn/tags/ç¼–ç /"}]},{"title":"æ·±åº¦æ¢ç©¶Java ä¸­ finally è¯­å¥å—","date":"2017-06-12T16:00:00.000Z","path":"2017/06/13/æ·±åº¦æ¢ç©¶Java ä¸­ finally è¯­å¥å—/","text":"ä¹çœ‹è¿™ä¸ªé¢˜ç›®ï¼Œæ˜¯ä¸æ˜¯æœ‰äººä¼šé—®ï¼Œè¿™ä¸ªè°ä¸çŸ¥é“å•Šï¼Œå¤§å‡¡ç†Ÿæ‚‰ Java ç¼–ç¨‹çš„äººéƒ½çŸ¥é“ finally è¯­å¥å—çš„ä½œç”¨å’Œç”¨æ³•ã€‚æœ‰ä»€ä¹ˆå¯æ·±åº¦è¾¨æçš„å‘¢ï¼Ÿäº‹å®å¹¶éå¦‚æ­¤ï¼Œæˆ‘å‘ç°å³ä½¿å†™äº†å¾ˆå¤šå¹´ Java ç¨‹åºçš„äººï¼Œä¹Ÿä¸ä¸€å®šèƒ½å¤Ÿé€å½»çš„ç†è§£ finally è¯­å¥å—ã€‚æœ¬ç¯‡å°†ä»¥ç”ŸåŠ¨å½¢è±¡çš„æ¡ˆä¾‹æ¥å¸¦æ‚¨ç”±æµ…å…¥æ·±çš„æ¥åˆ†æä¸€ä¸‹è¿™ä¸ªå°å°çš„ finallyï¼Œå¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¤Ÿè®©æ‚¨çœŸæ­£çš„ç†è§£ finally è¯­å¥å—çš„æœ¬è´¨ï¼Œè‡³å°‘é˜…è¯»å®Œæœ¬ç¯‡æ–‡ç« åï¼Œæ²¡æœ‰è§‰å¾—æµªè´¹äº†æ—¶é—´ã€‚ å¯ä¸èƒ½å°çœ‹è¿™ä¸ªç®€å•çš„ finallyï¼Œçœ‹ä¼¼ç®€å•çš„é—®é¢˜èƒŒåï¼Œå´éšè—äº†æ— æ•°çš„ç„æœºã€‚æ¥ä¸‹æ¥æˆ‘å°±å¸¦æ‚¨ä¸€æ­¥ä¸€æ­¥çš„æ­å¼€è¿™ä¸ª finally çš„ç¥ç§˜é¢çº±ã€‚ é—®é¢˜åˆ†æé¦–å…ˆæ¥é—®å¤§å®¶ä¸€ä¸ªé—®é¢˜ï¼šfinally è¯­å¥å—ä¸€å®šä¼šæ‰§è¡Œå—ï¼Ÿå¾ˆå¤šäººéƒ½è®¤ä¸º finally è¯­å¥å—æ˜¯è‚¯å®šè¦æ‰§è¡Œçš„ï¼Œå…¶ä¸­ä¹ŸåŒ…æ‹¬ä¸€äº›å¾ˆæœ‰ç»éªŒçš„ Java ç¨‹åºå‘˜ã€‚å¯æƒœå¹¶ä¸åƒå¤§å¤šäººæ‰€è®¤ä¸ºçš„é‚£æ ·ï¼Œå¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œç­”æ¡ˆå½“ç„¶æ˜¯å¦å®šçš„ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ã€‚ æ¸…å• 1.12345678910111213141516171819public class Test &#123;public static void main(String[] args) &#123;System.out.println(\"return value of test(): \" + test()); &#125;public static int test() &#123;int i = 1;// if(i == 1)// return 0;System.out.println(\"the previous statement of try block\");i = i / 0;try &#123; System.out.println(\"try block\"); return i; &#125;finally &#123; System.out.println(\"finally block\"); &#125; &#125;&#125; æ¸…å• 1 çš„æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š 1234the previous statement of try block Exception in thread &quot;main&quot; java.lang.ArithmeticException: / by zero at com.bj.charlie.Test.test(Test.java:15) at com.bj.charlie.Test.main(Test.java:6) å¦å¤–ï¼Œå¦‚æœå»æ‰ä¸Šä¾‹ä¸­è¢«æ³¨é‡Šçš„ä¸¤æ¡è¯­å¥å‰çš„æ³¨é‡Šç¬¦ï¼Œæ‰§è¡Œç»“æœåˆ™æ˜¯ï¼š 1return value of test(): 0 åœ¨ä»¥ä¸Šä¸¤ç§æƒ…å†µä¸‹ï¼Œfinally è¯­å¥å—éƒ½æ²¡æœ‰æ‰§è¡Œï¼Œè¯´æ˜ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿåªæœ‰ä¸ finally ç›¸å¯¹åº”çš„ try è¯­å¥å—å¾—åˆ°æ‰§è¡Œçš„æƒ…å†µä¸‹ï¼Œfinally è¯­å¥å—æ‰ä¼šæ‰§è¡Œã€‚ä»¥ä¸Šä¸¤ç§æƒ…å†µï¼Œéƒ½æ˜¯åœ¨ try è¯­å¥å—ä¹‹å‰è¿”å›ï¼ˆreturnï¼‰æˆ–è€…æŠ›å‡ºå¼‚å¸¸ï¼Œæ‰€ä»¥ try å¯¹åº”çš„ finally è¯­å¥å—æ²¡æœ‰æ‰§è¡Œã€‚ é‚£å¥½ï¼Œå³ä½¿ä¸ finally ç›¸å¯¹åº”çš„ try è¯­å¥å—å¾—åˆ°æ‰§è¡Œçš„æƒ…å†µä¸‹ï¼Œfinally è¯­å¥å—ä¸€å®šä¼šæ‰§è¡Œå—ï¼Ÿä¸å¥½æ„æ€ï¼Œè¿™æ¬¡å¯èƒ½åˆè®©å¤§å®¶å¤±æœ›äº†ï¼Œç­”æ¡ˆä»ç„¶æ˜¯å¦å®šçš„ã€‚è¯·çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼ˆæ¸…å• 2ï¼‰ã€‚ æ¸…å• 2.12345678910111213141516public class Test &#123;public static void main(String[] args) &#123;System.out.println(\"return value of test(): \" + test()); &#125;public static int test() &#123;int i = 1;try &#123;System.out.println(\"try block\");System.exit(0);return i;&#125;finally &#123;System.out.println(\"finally block\"); &#125; &#125;&#125; æ¸…å• 2 çš„æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š 1try block finally è¯­å¥å—è¿˜æ˜¯æ²¡æœ‰æ‰§è¡Œï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºæˆ‘ä»¬åœ¨ try è¯­å¥å—ä¸­æ‰§è¡Œäº† System.exit (0) è¯­å¥ï¼Œç»ˆæ­¢äº† Java è™šæ‹Ÿæœºçš„è¿è¡Œã€‚é‚£æœ‰äººè¯´äº†ï¼Œåœ¨ä¸€èˆ¬çš„ Java åº”ç”¨ä¸­åŸºæœ¬ä¸Šæ˜¯ä¸ä¼šè°ƒç”¨è¿™ä¸ª System.exit(0) æ–¹æ³•çš„ã€‚OK ï¼æ²¡æœ‰é—®é¢˜ï¼Œæˆ‘ä»¬ä¸è°ƒç”¨ System.exit(0) è¿™ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆ finally è¯­å¥å—å°±ä¸€å®šä¼šæ‰§è¡Œå—ï¼Ÿ å†ä¸€æ¬¡è®©å¤§å®¶å¤±æœ›äº†ï¼Œç­”æ¡ˆè¿˜æ˜¯å¦å®šçš„ã€‚å½“ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œ try è¯­å¥å—æˆ–è€… catch è¯­å¥å—æ—¶è¢«æ‰“æ–­ï¼ˆinterruptedï¼‰æˆ–è€…è¢«ç»ˆæ­¢ï¼ˆkilledï¼‰ï¼Œä¸å…¶ç›¸å¯¹åº”çš„ finally è¯­å¥å—å¯èƒ½ä¸ä¼šæ‰§è¡Œã€‚è¿˜æœ‰æ›´æç«¯çš„æƒ…å†µï¼Œå°±æ˜¯åœ¨çº¿ç¨‹è¿è¡Œ try è¯­å¥å—æˆ–è€… catch è¯­å¥å—æ—¶ï¼Œçªç„¶æ­»æœºæˆ–è€…æ–­ç”µï¼Œfinally è¯­å¥å—è‚¯å®šä¸ä¼šæ‰§è¡Œäº†ã€‚å¯èƒ½æœ‰äººè®¤ä¸ºæ­»æœºã€æ–­ç”µè¿™äº›ç†ç”±æœ‰äº›å¼ºè¯å¤ºç†ï¼Œæ²¡æœ‰å…³ç³»ï¼Œæˆ‘ä»¬åªæ˜¯ä¸ºäº†è¯´æ˜è¿™ä¸ªé—®é¢˜ã€‚ finally è¯­å¥å‰–æè¯´äº†è¿™ä¹ˆå¤šï¼Œè¿˜æ˜¯è®©æˆ‘ä»¬æ‹¿å‡ºäº›æœ‰è¯´æœåŠ›çš„è¯æ®å§ï¼è¿˜æœ‰ä»€ä¹ˆè¯æ®æ¯”å®˜æ–¹çš„æ–‡æ¡£æ›´å…·è¯´æœåŠ›å‘¢ï¼Ÿè®©æˆ‘ä»¬æ¥çœ‹çœ‹å®˜æ–¹ç½‘ç«™ä¸Šçš„ã€ŠThe Java Tutorialsã€‹ä¸­æ˜¯æ€æ ·æ¥æè¿° finally è¯­å¥å—çš„å§ï¼ä»¥ä¸‹å†…å®¹åŸå°ä¸åŠ¨çš„æ‘˜è‡ªäºã€Š The Java Tutorials ã€‹æ–‡æ¡£ã€‚ The finally BlockThe finally block always executes when the try block exits. This ensures that the finally block is executed even if an unexpected exception occurs. But finally is useful for more than just exception handling â€” it allows the programmer to avoid having cleanup code accidentally bypassed by a return,continue, or break. Putting cleanup code in a finally block is always a good practice, even when no exceptions are anticipated.Note: If the JVM exits while the try or catch code is being executed, then the finally block may not execute. Likewise, if the thread executing the try or catch code is interrupted or killed, the finally block may not execute even though the application as a whole continues. è¯·ä»”ç»†é˜…è¯»å¹¶è®¤çœŸä½“ä¼šä¸€ä¸‹ä»¥ä¸Šä¸¤æ®µè‹±æ–‡ï¼Œå½“ä½ çœŸæ­£çš„ç†è§£äº†è¿™ä¸¤æ®µè‹±æ–‡çš„ç¡®åˆ‡å«ä¹‰ï¼Œä½ å°±å¯ä»¥éå¸¸è‡ªä¿¡çš„æ¥å›ç­”â€œfinally è¯­å¥å—æ˜¯å¦ä¸€å®šä¼šæ‰§è¡Œï¼Ÿâ€è¿™æ ·çš„é—®é¢˜ã€‚çœ‹æ¥ï¼Œå¤§å¤šæ—¶å€™ï¼Œå¹¶ä¸æ˜¯ Java è¯­è¨€æœ¬èº«æœ‰å¤šä¹ˆé«˜æ·±ï¼Œè€Œæ˜¯æˆ‘ä»¬å¿½ç•¥äº†å¯¹åŸºç¡€çŸ¥è¯†çš„æ·±å…¥ç†è§£ã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹ finally è¯­å¥å—æ˜¯æ€æ ·æ‰§è¡Œçš„ã€‚åœ¨æ’é™¤äº†ä»¥ä¸Š finally è¯­å¥å—ä¸æ‰§è¡Œçš„æƒ…å†µåï¼Œfinally è¯­å¥å—å°±å¾—ä¿è¯è¦æ‰§è¡Œï¼Œæ—¢ç„¶ finally è¯­å¥å—ä¸€å®šè¦æ‰§è¡Œï¼Œé‚£ä¹ˆå®ƒå’Œ try è¯­å¥å—ä¸ catch è¯­å¥å—çš„æ‰§è¡Œé¡ºåºåˆæ˜¯æ€æ ·çš„å‘¢ï¼Ÿè¿˜æœ‰ï¼Œå¦‚æœ try è¯­å¥å—ä¸­æœ‰ return è¯­å¥ï¼Œé‚£ä¹ˆ finally è¯­å¥å—æ˜¯åœ¨ return ä¹‹å‰æ‰§è¡Œï¼Œè¿˜æ˜¯åœ¨ return ä¹‹åæ‰§è¡Œå‘¢ï¼Ÿå¸¦ç€è¿™æ ·ä¸€äº›é—®é¢˜ï¼Œæˆ‘ä»¬è¿˜æ˜¯ä»¥å…·ä½“çš„æ¡ˆä¾‹æ¥è®²è§£ã€‚ å…³äº tryã€catchã€finally çš„æ‰§è¡Œé¡ºåºé—®é¢˜ï¼Œæˆ‘ä»¬è¿˜æ˜¯æ¥çœ‹çœ‹æƒå¨çš„è®ºè¿°å§ï¼ä»¥ä¸‹å†…å®¹æ‘˜è‡ª Java è¯­è¨€è§„èŒƒç¬¬å››ç‰ˆï¼ˆã€ŠThe Javaâ„¢ Programming Language, Fourth Editionã€‹ï¼‰ä¸­å¯¹äº tryï¼Œcatchï¼Œå’Œ finally çš„æè¿°ã€‚ 12.4. Try, catch, and finallyYou catch exceptions by enclosing code in Try blocks. The basic syntax for a Try block is:try {statements} catch (exception_type1 identifier1) {statements} catch (exception_type2 identifier2) {statementsâ€¦} finally {statements} where either at least one catch clause, or the finally clause, must be present. The body of the try statement is executed until either an exception is thrown or the body finishes successfully. If an exception is thrown, each catch clause is examined in turn, from first to last, to see whether the type of the exception object is assignable to the type declared in the catch. When an assignable catch clause is found, its block is executed with its identifier set to reference the exception object. No other catch clause will be executed. Any number of catch clauses, including zero, can be associated with a particular TRy as long as each clause catches a different type of exception. If no appropriate catch is found, the exception percolates out of the try statement into any outer try that might have a catch clause to handle it. If a finally clause is present with a try, its code is executed after all other processing in the try is complete. This happens no matter how completion was achieved, whether normally, through an exception, or through a control flow statement such as return or break. ä¸Šé¢è¿™æ®µæ–‡å­—çš„å¤§ä½“æ„æ€æ˜¯è¯´ï¼Œä¸ç®¡ try è¯­å¥å—æ­£å¸¸ç»“æŸè¿˜æ˜¯å¼‚å¸¸ç»“æŸï¼Œfinally è¯­å¥å—æ˜¯ä¿è¯è¦æ‰§è¡Œçš„ã€‚å¦‚æœ try è¯­å¥å—æ­£å¸¸ç»“æŸï¼Œé‚£ä¹ˆåœ¨ try è¯­å¥å—ä¸­çš„è¯­å¥éƒ½æ‰§è¡Œå®Œä¹‹åï¼Œå†æ‰§è¡Œ finally è¯­å¥å—ã€‚å¦‚æœ try ä¸­æœ‰æ§åˆ¶è½¬ç§»è¯­å¥ï¼ˆreturnã€breakã€continueï¼‰å‘¢ï¼Ÿé‚£ finally è¯­å¥å—æ˜¯åœ¨æ§åˆ¶è½¬ç§»è¯­å¥ä¹‹å‰æ‰§è¡Œï¼Œè¿˜æ˜¯ä¹‹åæ‰§è¡Œå‘¢ï¼Ÿä¼¼ä¹ä»ä¸Šé¢çš„æè¿°ä¸­æˆ‘ä»¬è¿˜çœ‹ä¸å‡ºä»»ä½•ç«¯å€ªï¼Œä¸è¦ç€æ€¥ï¼Œåé¢çš„è®²è§£ä¸­æˆ‘ä»¬ä¼šåˆ†æè¿™ä¸ªé—®é¢˜ã€‚å¦‚æœ try è¯­å¥å—å¼‚å¸¸ç»“æŸï¼Œåº”è¯¥å…ˆå»ç›¸åº”çš„ catch å—åšå¼‚å¸¸å¤„ç†ï¼Œç„¶åæ‰§è¡Œ finally è¯­å¥å—ã€‚åŒæ ·çš„é—®é¢˜ï¼Œå¦‚æœ catch è¯­å¥å—ä¸­åŒ…å«æ§åˆ¶è½¬ç§»è¯­å¥å‘¢ï¼Ÿ finally è¯­å¥å—æ˜¯åœ¨è¿™äº›æ§åˆ¶è½¬ç§»è¯­å¥ä¹‹å‰ï¼Œè¿˜æ˜¯ä¹‹åæ‰§è¡Œå‘¢ï¼Ÿæˆ‘ä»¬ä¹Ÿä¼šåœ¨åç»­è®¨è®ºä¸­æåˆ°ã€‚ å…¶å®ï¼Œå…³äº tryï¼Œcatchï¼Œfinally çš„æ‰§è¡Œæµç¨‹è¿œéè¿™ä¹ˆç®€å•ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥å‚è€ƒ Java è¯­è¨€è§„èŒƒç¬¬ä¸‰ç‰ˆï¼ˆã€ŠThe Javaâ„¢ Language Specification, Third Editionã€‹ï¼‰ä¸­å¯¹äº Execution of try-catch-finally çš„æè¿°ï¼Œéå¸¸å¤æ‚çš„ä¸€ä¸ªæµç¨‹ã€‚é™äºç¯‡å¹…çš„åŸå› ï¼Œæœ¬æ–‡ä¸åšæ‘˜å½•ï¼Œè¯·æ„Ÿå…´è¶£çš„è¯»è€…è‡ªè¡Œé˜…è¯»ã€‚ finally è¯­å¥ç¤ºä¾‹è¯´æ˜ä¸‹é¢ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼ˆæ¸…å• 3ï¼‰ã€‚ æ¸…å• 3.12345678910public class Test &#123;public static void main(String[] args) &#123;try &#123;System.out.println(\"try block\");return ;&#125; finally &#123;System.out.println(\"finally block\"); &#125; &#125;&#125; æ¸…å• 3 çš„æ‰§è¡Œç»“æœä¸ºï¼š12try blockfinally block æ¸…å• 3 è¯´æ˜ finally è¯­å¥å—åœ¨ try è¯­å¥å—ä¸­çš„ return è¯­å¥ä¹‹å‰æ‰§è¡Œã€‚æˆ‘ä»¬å†æ¥çœ‹å¦ä¸€ä¸ªä¾‹å­ï¼ˆæ¸…å• 4ï¼‰ã€‚ æ¸…å• 4.123456789101112131415161718public class Test &#123;public static void main(String[] args) &#123;System.out.println(\"reture value of test() : \" + test()); &#125;public static int test()&#123;int i = 1;try &#123; System.out.println(\"try block\"); i = 1 / 0; return 1;&#125;catch (Exception e)&#123;System.out.println(\"exception block\");return 2;&#125;finally &#123;System.out.println(\"finally block\"); &#125; &#125;&#125; æ¸…å• 4 çš„æ‰§è¡Œç»“æœä¸ºï¼š1234try blockexception blockfinally blockreture value of test() : 2 æ¸…å• 4 è¯´æ˜äº† finally è¯­å¥å—åœ¨ catch è¯­å¥å—ä¸­çš„ return è¯­å¥ä¹‹å‰æ‰§è¡Œã€‚ ä»ä¸Šé¢çš„æ¸…å• 3 å’Œæ¸…å• 4ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œå…¶å® finally è¯­å¥å—æ˜¯åœ¨ try æˆ–è€… catch ä¸­çš„ return è¯­å¥ä¹‹å‰æ‰§è¡Œçš„ã€‚æ›´åŠ ä¸€èˆ¬çš„è¯´æ³•æ˜¯ï¼Œfinally è¯­å¥å—åº”è¯¥æ˜¯åœ¨æ§åˆ¶è½¬ç§»è¯­å¥ä¹‹å‰æ‰§è¡Œï¼Œæ§åˆ¶è½¬ç§»è¯­å¥é™¤äº† return å¤–ï¼Œè¿˜æœ‰ break å’Œ continueã€‚å¦å¤–ï¼Œthrow è¯­å¥ä¹Ÿå±äºæ§åˆ¶è½¬ç§»è¯­å¥ã€‚è™½ç„¶ returnã€throwã€break å’Œ continue éƒ½æ˜¯æ§åˆ¶è½¬ç§»è¯­å¥ï¼Œä½†æ˜¯å®ƒä»¬ä¹‹é—´æ˜¯æœ‰åŒºåˆ«çš„ã€‚å…¶ä¸­ return å’Œ throw æŠŠç¨‹åºæ§åˆ¶æƒè½¬äº¤ç»™å®ƒä»¬çš„è°ƒç”¨è€…ï¼ˆinvokerï¼‰ï¼Œè€Œ break å’Œ continue çš„æ§åˆ¶æƒæ˜¯åœ¨å½“å‰æ–¹æ³•å†…è½¬ç§»ã€‚è¯·å¤§å®¶å…ˆè®°ä½å®ƒä»¬çš„åŒºåˆ«ï¼Œåœ¨åç»­çš„åˆ†æä¸­æˆ‘ä»¬è¿˜ä¼šè°ˆåˆ°ã€‚ è¿˜æ˜¯å¾—æ¥ç‚¹æœ‰è¯´æœåŠ›çš„è¯æ®ï¼Œä¸‹é¢è¿™æ®µæ‘˜è‡ª Java è¯­è¨€è§„èŒƒç¬¬å››ç‰ˆï¼ˆã€ŠThe Javaâ„¢ Programming Language, Fourth Editionã€‹ï¼‰ï¼Œè¯·è¯»è€…è‡ªå·±ä½“ä¼šä¸€ä¸‹å…¶å«ä¹‰ã€‚ Afinallyclause can also be used to clean up forbreak,continue, andreturn, which is one reason you will sometimes see atryclause with nocatchclauses. When any control transfer statement is executed, all relevantfinallyclauses are executed. There is no way to leave atryblock without executing itsfinallyclause. å¥½äº†ï¼Œçœ‹åˆ°è¿™é‡Œï¼Œæ˜¯ä¸æ˜¯æœ‰äººè®¤ä¸ºè‡ªå·±å·²ç»æŒæ¡äº† finally çš„ç”¨æ³•äº†ï¼Ÿå…ˆåˆ«å¿™ç€ä¸‹ç»“è®ºï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸¤ä¸ªä¾‹å­ â€“ æ¸…å• 5 å’Œæ¸…å• 6ã€‚ æ¸…å• 5.123456789101112public class Test &#123; public static void main(String[] args) &#123; System.out.println(\"return value of getValue(): \" + getValue()); &#125; public static int getValue() &#123; try &#123; return 0; &#125; finally &#123; return 1; &#125; &#125; &#125; æ¸…å• 5 çš„æ‰§è¡Œç»“æœï¼š1return value of getValue(): 1 æ¸…å• 6.12345678910111213public class Test &#123;public static void main(String[] args) &#123; System.out.println(\"return value of getValue(): \" + getValue()); &#125;public static int getValue() &#123; int i = 1; try &#123; return i; &#125; finally &#123; i++; &#125; &#125;&#125; æ¸…å• 6 çš„æ‰§è¡Œç»“æœï¼š1return value of getValue(): 1 åˆ©ç”¨æˆ‘ä»¬ä¸Šé¢åˆ†æå¾—å‡ºçš„ç»“è®ºï¼šfinally è¯­å¥å—æ˜¯åœ¨ try æˆ–è€… catch ä¸­çš„ return è¯­å¥ä¹‹å‰æ‰§è¡Œçš„ã€‚ ç”±æ­¤ï¼Œå¯ä»¥è½»æ¾çš„ç†è§£æ¸…å• 5 çš„æ‰§è¡Œç»“æœæ˜¯ 1ã€‚å› ä¸º finally ä¸­çš„ return 1ï¼›è¯­å¥è¦åœ¨ try ä¸­çš„ return 0ï¼›è¯­å¥ä¹‹å‰æ‰§è¡Œï¼Œé‚£ä¹ˆ finally ä¸­çš„ return 1ï¼›è¯­å¥æ‰§è¡Œåï¼ŒæŠŠç¨‹åºçš„æ§åˆ¶æƒè½¬äº¤ç»™äº†å®ƒçš„è°ƒç”¨è€… mainï¼ˆï¼‰å‡½æ•°ï¼Œå¹¶ä¸”è¿”å›å€¼ä¸º 1ã€‚é‚£ä¸ºä»€ä¹ˆæ¸…å• 6 çš„è¿”å›å€¼ä¸æ˜¯ 2ï¼Œè€Œæ˜¯ 1 å‘¢ï¼ŸæŒ‰ç…§æ¸…å• 5 çš„åˆ†æé€»è¾‘ï¼Œfinally ä¸­çš„ i++ï¼›è¯­å¥åº”è¯¥åœ¨ try ä¸­çš„ return iï¼›ä¹‹å‰æ‰§è¡Œå•Šï¼Ÿ i çš„åˆå§‹å€¼ä¸º 1ï¼Œé‚£ä¹ˆæ‰§è¡Œ i++ï¼›ä¹‹åä¸º 2ï¼Œå†æ‰§è¡Œ return iï¼›é‚£ä¸å°±åº”è¯¥æ˜¯ 2 å—ï¼Ÿæ€ä¹ˆå˜æˆ 1 äº†å‘¢ï¼Ÿ å…³äº Java è™šæ‹Ÿæœºæ˜¯å¦‚ä½•ç¼–è¯‘ finally è¯­å¥å—çš„é—®é¢˜ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥å‚è€ƒã€Š The JavaTM Virtual Machine Specification, Second Edition ã€‹ä¸­ 7.13 èŠ‚ Compiling finallyã€‚é‚£é‡Œè¯¦ç»†ä»‹ç»äº† Java è™šæ‹Ÿæœºæ˜¯å¦‚ä½•ç¼–è¯‘ finally è¯­å¥å—ã€‚å®é™…ä¸Šï¼ŒJava è™šæ‹Ÿæœºä¼šæŠŠ finally è¯­å¥å—ä½œä¸º subroutineï¼ˆå¯¹äºè¿™ä¸ª subroutine ä¸çŸ¥è¯¥å¦‚ä½•ç¿»è¯‘ä¸ºå¥½ï¼Œå¹²è„†å°±ä¸ç¿»è¯‘äº†ï¼Œå…å¾—äº§ç”Ÿæ­§ä¹‰å’Œè¯¯è§£ã€‚ï¼‰ç›´æ¥æ’å…¥åˆ° try è¯­å¥å—æˆ–è€… catch è¯­å¥å—çš„æ§åˆ¶è½¬ç§»è¯­å¥ä¹‹å‰ã€‚ä½†æ˜¯ï¼Œè¿˜æœ‰å¦å¤–ä¸€ä¸ªä¸å¯å¿½è§†çš„å› ç´ ï¼Œé‚£å°±æ˜¯åœ¨æ‰§è¡Œ subroutineï¼ˆä¹Ÿå°±æ˜¯ finally è¯­å¥å—ï¼‰ä¹‹å‰ï¼Œtry æˆ–è€… catch è¯­å¥å—ä¼šä¿ç•™å…¶è¿”å›å€¼åˆ°æœ¬åœ°å˜é‡è¡¨ï¼ˆLocal Variable Tableï¼‰ä¸­ã€‚å¾… subroutine æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œå†æ¢å¤ä¿ç•™çš„è¿”å›å€¼åˆ°æ“ä½œæ•°æ ˆä¸­ï¼Œç„¶åé€šè¿‡ return æˆ–è€… throw è¯­å¥å°†å…¶è¿”å›ç»™è¯¥æ–¹æ³•çš„è°ƒç”¨è€…ï¼ˆinvokerï¼‰ã€‚è¯·æ³¨æ„ï¼Œå‰æ–‡ä¸­æˆ‘ä»¬æ›¾ç»æåˆ°è¿‡ returnã€throw å’Œ breakã€continue çš„åŒºåˆ«ï¼Œå¯¹äºè¿™æ¡è§„åˆ™ï¼ˆä¿ç•™è¿”å›å€¼ï¼‰ï¼Œåªé€‚ç”¨äº return å’Œ throw è¯­å¥ï¼Œä¸é€‚ç”¨äº break å’Œ continue è¯­å¥ï¼Œå› ä¸ºå®ƒä»¬æ ¹æœ¬å°±æ²¡æœ‰è¿”å›å€¼ã€‚ æ˜¯ä¸æ˜¯ä¸å¤ªå¥½ç†è§£ï¼Œé‚£æˆ‘ä»¬å°±ç”¨å…·ä½“çš„ä¾‹å­æ¥åšå½¢è±¡çš„è¯´æ˜å§ï¼ ä¸ºäº†èƒ½å¤Ÿè§£é‡Šæ¸…å• 6 çš„æ‰§è¡Œç»“æœï¼Œæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹æ¸…å• 6 çš„å­—èŠ‚ç ï¼ˆbyte-codeï¼‰ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647Compiled from &quot;Test.java&quot; public class Test extends java.lang.Object&#123; public Test(); Code: 0: aload_0 1:invokespecial#1; //Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V 4: return LineNumberTable: line 1: 0 public static void main(java.lang.String[]); Code: 0: getstatic #2; //Field java/lang/System.out:Ljava/io/PrintStream; 3: new #3; //class java/lang/StringBuilder 6: dup 7: invokespecial #4; //Method java/lang/StringBuilder.&quot;&lt;init&gt;&quot;:()V 10: ldc #5; //String return value of getValue(): 12: invokevirtual #6; //Method java/lang/StringBuilder.append:( Ljava/lang/String;)Ljava/lang/StringBuilder; 15: invokestatic #7; //Method getValue:()I 18: invokevirtual #8; //Method java/lang/StringBuilder.append:(I)Ljava/lang/StringBuilder; 21: invokevirtual #9; //Method java/lang/StringBuilder.toString:()Ljava/lang/String; 24: invokevirtual #10; //Method java/io/PrintStream.println:(Ljava/lang/String;)V 27: return public static int getValue(); Code: 0: iconst_1 1: istore_0 2: iload_0 3: istore_1 4: iinc 0, 1 7: iload_1 8: ireturn 9: astore_2 10: iinc 0, 1 13: aload_2 14: athrow Exception table: from to target type 2 4 9 any 9 10 9 any &#125; å¯¹äº Testï¼ˆï¼‰æ„é€ æ–¹æ³•ä¸ mainï¼ˆï¼‰æ–¹æ³•ï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¸åšè¿‡å¤šè§£é‡Šã€‚è®©æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ getValueï¼ˆï¼‰æ–¹æ³•çš„æ‰§è¡Œã€‚åœ¨è¿™ä¹‹å‰ï¼Œå…ˆè®©æˆ‘æŠŠ getValueï¼ˆï¼‰ä¸­ç”¨åˆ°çš„è™šæ‹ŸæœºæŒ‡ä»¤è§£é‡Šä¸€ä¸‹ï¼Œä»¥ä¾¿è¯»è€…èƒ½å¤Ÿæ­£ç¡®çš„ç†è§£è¯¥å‡½æ•°çš„æ‰§è¡Œã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445461. iconst_Description: Push the int constant (-1, 0, 1, 2, 3, 4 or 5) onto the operand stack.Forms: iconst_m1 = 2 (0x2) iconst_0 = 3 (0x3) iconst_1 = 4 (0x4)iconst_2 = 5 (0x5) iconst_3 = 6 (0x6) iconst_4 = 7 (0x7) iconst_5 = 8 (0x8)2. istore_Description: Store int into local variable. The must be an index into thelocal variable array of the current frame.Forms: istore_0 = 59 (0x3b) istore_1 = 60 (0x3c) istore_2 = 61 (0x3d)istore_3 = 62 (0x3e)3. iload_Description: Load int from local variable. The must be an index into thelocal variable array of the current frame.Forms: iload_0 = 26 (0x1a) iload_1 = 27 (0x1b) iload_2 = 28 (0x1c) iload_3 = 29 (0x1d)4. iinc index, constDescription: Increment local variable by constant. The index is an unsigned byte thatmust be an index into the local variable array of the current frame. The const is animmediate signed byte. The local variable at index must contain an int. The valueconst is first sign-extended to an int, and then the local variable at index isincremented by that amount.Forms: iinc = 132 (0x84)Format:iincindexconst5. ireturnDescription: Return int from method.Forms: ireturn = 172 (0xac)6. astore_Description: Store reference into local variable. The must be an index into thelocal variable array of the current frame.Forms: astore_0 = 75 (0x4b) astore_1 = 76 (0x4c) astore_2 =77 (0x4d) astore_3 =78 (0x4e)7. aload_Description: Load reference from local variable. The must be an index into thelocal variable array of the current frame.Forms: aload_0 = 42 (0x2a) aload_1 = 43 (0x2b) aload_2 = 44 (0x2c) aload_3 = 45 (0x2d)8. athrowDescription: Throw exception or error.Forms: athrow = 191 (0xbf) æœ‰äº†ä»¥ä¸Šçš„ Java è™šæ‹ŸæœºæŒ‡ä»¤ï¼Œæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹å…¶æ‰§è¡Œé¡ºåºï¼šåˆ†ä¸ºæ­£å¸¸æ‰§è¡Œï¼ˆæ²¡æœ‰ exceptionï¼‰å’Œå¼‚å¸¸æ‰§è¡Œï¼ˆæœ‰ exceptionï¼‰ä¸¤ç§æƒ…å†µã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹æ­£å¸¸æ‰§è¡Œçš„æƒ…å†µï¼Œå¦‚å›¾ 1 æ‰€ç¤ºï¼š ###å›¾ 1. getValueï¼ˆï¼‰å‡½æ•°æ­£å¸¸æ‰§è¡Œçš„æƒ…å†µ ç”±ä¸Šå›¾ï¼Œæˆ‘ä»¬å¯ä»¥æ¸…æ™°çš„çœ‹å‡ºï¼Œåœ¨ finally è¯­å¥å—ï¼ˆiinc 0, 1ï¼‰æ‰§è¡Œä¹‹å‰ï¼ŒgetValueï¼ˆï¼‰æ–¹æ³•ä¿å­˜äº†å…¶è¿”å›å€¼ï¼ˆ1ï¼‰åˆ°æœ¬åœ°è¡¨é‡è¡¨ä¸­ 1 çš„ä½ç½®ï¼Œå®Œæˆè¿™ä¸ªä»»åŠ¡çš„æŒ‡ä»¤æ˜¯ istore_1ï¼›ç„¶åæ‰§è¡Œ finally è¯­å¥å—ï¼ˆiinc 0, 1ï¼‰ï¼Œfinally è¯­å¥å—æŠŠä½äº 0 è¿™ä¸ªä½ç½®çš„æœ¬åœ°å˜é‡è¡¨ä¸­çš„å€¼åŠ  1ï¼Œå˜æˆ 2ï¼›å¾… finally è¯­å¥å—æ‰§è¡Œå®Œæ¯•ä¹‹åï¼ŒæŠŠæœ¬åœ°è¡¨é‡è¡¨ä¸­ 1 çš„ä½ç½®ä¸Šå€¼æ¢å¤åˆ°æ“ä½œæ•°æ ˆï¼ˆiload _1ï¼‰ï¼Œæœ€åæ‰§è¡Œ ireturn æŒ‡ä»¤æŠŠå½“å‰æ“ä½œæ•°æ ˆä¸­çš„å€¼ï¼ˆ1ï¼‰è¿”å›ç»™å…¶è°ƒç”¨è€…ï¼ˆmainï¼‰ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ¸…å• 6 çš„æ‰§è¡Œç»“æœæ˜¯ 1ï¼Œè€Œä¸æ˜¯ 2 çš„åŸå› ã€‚ å†è®©æˆ‘ä»¬æ¥çœ‹çœ‹å¼‚å¸¸æ‰§è¡Œçš„æƒ…å†µã€‚æ˜¯ä¸æ˜¯æœ‰äººä¼šé—®ï¼Œä½ çš„æ¸…å• 6 ä¸­éƒ½æ²¡æœ‰ catch è¯­å¥ï¼Œå“ªæ¥çš„å¼‚å¸¸å¤„ç†å‘¢ï¼Ÿæˆ‘è§‰å¾—è¿™æ˜¯ä¸€ä¸ªå¥½é—®é¢˜ï¼Œå…¶å®ï¼Œå³ä½¿æ²¡æœ‰ catch è¯­å¥ï¼ŒJava ç¼–è¯‘å™¨ç¼–è¯‘å‡ºçš„å­—èŠ‚ç ä¸­è¿˜æ˜¯æœ‰é»˜è®¤çš„å¼‚å¸¸å¤„ç†çš„ï¼Œåˆ«å¿˜äº†ï¼Œé™¤äº†éœ€è¦æ•è·çš„å¼‚å¸¸ï¼Œè¿˜å¯èƒ½æœ‰ä¸éœ€æ•è·çš„å¼‚å¸¸ï¼ˆå¦‚ï¼šRunTimeException å’Œ Errorï¼‰ã€‚ ä» getValueï¼ˆï¼‰æ–¹æ³•çš„å­—èŠ‚ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒçš„å¼‚å¸¸å¤„ç†è¡¨ï¼ˆexception tableï¼‰ï¼Œ å¦‚ä¸‹ï¼š123Exception table:from to target type2 4 9 any å®ƒçš„æ„æ€æ˜¯è¯´ï¼šå¦‚æœä» 2 åˆ° 4 è¿™æ®µæŒ‡ä»¤å‡ºç°å¼‚å¸¸ï¼Œåˆ™ç”±ä» 9 å¼€å§‹çš„æŒ‡ä»¤æ¥å¤„ç†ã€‚ å›¾ 2. getValueï¼ˆï¼‰å‡½æ•°å¼‚å¸¸æ‰§è¡Œçš„æƒ…å†µ å…ˆè¯´æ˜ä¸€ç‚¹ï¼Œä¸Šå›¾ä¸­çš„ exception å…¶å®åº”è¯¥æ˜¯ exception å¯¹è±¡çš„å¼•ç”¨ï¼Œä¸ºäº†æ–¹ä¾¿è¯´æ˜ï¼Œæˆ‘ç›´æ¥æŠŠå®ƒå†™æˆ exception äº†ã€‚ ç”±ä¸Šå›¾ï¼ˆå›¾ 2ï¼‰å¯çŸ¥ï¼Œå½“ä» 2 åˆ° 4 è¿™æ®µæŒ‡ä»¤å‡ºç°å¼‚å¸¸æ—¶ï¼Œå°†ä¼šäº§ç”Ÿä¸€ä¸ª exception å¯¹è±¡ï¼Œå¹¶ä¸”æŠŠå®ƒå‹å…¥å½“å‰æ“ä½œæ•°æ ˆçš„æ ˆé¡¶ã€‚æ¥ä¸‹æ¥æ˜¯ astore_2 è¿™æ¡æŒ‡ä»¤ï¼Œå®ƒè´Ÿè´£æŠŠ exception å¯¹è±¡ä¿å­˜åˆ°æœ¬åœ°å˜é‡è¡¨ä¸­ 2 çš„ä½ç½®ï¼Œç„¶åæ‰§è¡Œ finally è¯­å¥å—ï¼Œå¾… finally è¯­å¥å—æ‰§è¡Œå®Œæ¯•åï¼Œå†ç”± aload _2 è¿™æ¡æŒ‡ä»¤æŠŠé¢„å…ˆå­˜å‚¨çš„ exception å¯¹è±¡æ¢å¤åˆ°æ“ä½œæ•°æ ˆä¸­ï¼Œæœ€åç”± athrow æŒ‡ä»¤å°†å…¶è¿”å›ç»™è¯¥æ–¹æ³•çš„è°ƒç”¨è€…ï¼ˆmainï¼‰ã€‚ é€šè¿‡ä»¥ä¸Šçš„åˆ†æï¼Œå¤§å®¶åº”è¯¥å·²ç»æ¸…æ¥š try-catch-finally è¯­å¥å—çš„æ‰§è¡Œæµç¨‹äº†å§ï¼ä¸ºäº†æ›´å…·è¯´æœåŠ›ï¼Œæˆ‘ä»¬è¿˜æ˜¯æ¥å¼•ç»æ®å…¸å§ï¼ä¸‹é¢è¿™æ®µä»ç„¶æ‘˜è‡ª Java è¯­è¨€è§„èŒƒç¬¬å››ç‰ˆ ã€ŠThe Javaâ„¢ Programming Language, Fourth Editionã€‹ï¼Œè¯·è¯»è€…è‡ªå·±ä½“ä¼šå§ï¼ a finally clause is always entered with a reason. That reason may be that the try code finished normally, that it executed a control flow statement such as return, or that an exception was thrown in code executed in the Try block. The reason is remembered when the finally clause exits by falling out the bottom. However, if the finally block creates its own reason to leave by executing a control flow statement (such as break or return) or by throwing an exception, that reason supersedes the original one, and the original reason is forgotten. For example, consider the following code:try {// â€¦ do something â€¦return 1;} finally {return 2;}When the Try block executes its return, the finally block is entered with the â€œreasonâ€ of returning the value 1. However, inside the finally block the value 2 is returned, so the initial intention is forgotten. In fact, if any of the other code in the try block had thrown an exception, the result would still be to return 2. If the finally block did not return a value but simply fell out the bottom, the â€œreturn the value 1 â€³ reason would be remembered and carried out. å¥½äº†ï¼Œæœ‰äº†ä»¥ä¸Šçš„çŸ¥è¯†ï¼Œè®©æˆ‘ä»¬å†æ¥çœ‹ä»¥ä¸‹ 3 ä¸ªä¾‹å­ã€‚ æ¸…å• 7.123456789101112131415public class Test &#123; public static void main(String[] args) &#123; System.out.println(\"return value of getValue(): \" + getValue()); &#125; @SuppressWarnings(\"finally\") public static int getValue() &#123; int i = 1; try &#123; i = 4; &#125; finally &#123; i++; return i; &#125; &#125; &#125; æ¸…å• 7 çš„æ‰§è¡Œç»“æœï¼š1return value of getValue(): 5 æ¸…å• 8.1234567891011121314public class Test &#123;public static void main(String[] args) &#123; System.out.println(\"return value of getValue(): \" + getValue()); &#125;public static int getValue() &#123; int i = 1; try &#123; i = 4; &#125; finally &#123; i++; &#125; return i; &#125;&#125; æ¸…å• 8 çš„æ‰§è¡Œç»“æœï¼š1return value of getValue(): 5 æ¸…å• 7 å’Œæ¸…å• 8 åº”è¯¥è¿˜æ¯”è¾ƒç®€å•å§ï¼åˆ©ç”¨æˆ‘ä»¬ä¸Šé¢è®²è§£çš„çŸ¥è¯†ï¼Œå¾ˆå®¹æ˜“åˆ†æå‡ºå…¶ç»“æœã€‚è®©æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸ªç¨å¾®å¤æ‚ä¸€ç‚¹çš„ä¾‹å­ â€“ æ¸…å• 9ã€‚æˆ‘å»ºè®®å¤§å®¶æœ€å¥½å…ˆä¸è¦çœ‹æ‰§è¡Œç»“æœï¼Œè¿ç”¨å­¦è¿‡çš„çŸ¥è¯†æ¥åˆ†æä¸€ä¸‹ï¼Œçœ‹æ˜¯å¦èƒ½æ¨æ–­å‡ºæ­£ç¡®çš„ç»“æœã€‚ æ¸…å• 9.1234567891011121314151617public class Test &#123;public static void main(String[] args) &#123;System.out.println(test()); &#125;public static String test() &#123;try &#123;System.out.println(\"try block\");return test1();&#125; finally &#123;System.out.println(\"finally block\"); &#125; &#125;public static String test1() &#123;System.out.println(\"return statement\");return \"after return\"; &#125;&#125; æ¸…å• 9 çš„ç»“æœï¼š1234try blockreturn statementfinally blockafter return ä½ åˆ†æå¯¹äº†å—ï¼Ÿå…¶å®è¿™ä¸ªæ¡ˆä¾‹ä¹Ÿä¸ç®—å¾ˆéš¾ï¼Œreturn test1();è¿™æ¡è¯­å¥ç­‰åŒäº : 12String tmp = test1();return tmp; è¿™æ ·ï¼Œå°±åº”è¯¥æ¸…æ¥šä¸ºä»€ä¹ˆæ˜¯ä¸Šé¢æ‰€ç¤ºçš„æ‰§è¡Œç»“æœäº†å§ï¼ å¦‚æœè¿˜æ˜¯ä¸æ€ä¹ˆæ¸…æ¥šå¯ä»¥åœ¨ IDE ä¸‹è¯•ç”¨ä¸‹ Debugï¼Œç„¶åæŸ¥çœ‹å…·ä½“çš„è¿è¡Œæ­¥éª¤ã€‚ å¥½äº†ï¼Œå°±å†™åˆ°è¿™å§ï¼å¸Œæœ›å¤§å®¶çœ‹å®Œè¿™ç¯‡æ–‡ç« èƒ½å¤Ÿæœ‰æ‰€æ”¶è·ï¼ æ€»ç»“æ²¡æƒ³åˆ°å§ï¼ä¸€ä¸ªå°å°çš„ã€çœ‹ä¼¼ç®€å•çš„ finally è¯­å¥å—èƒŒåå±…ç„¶éšè—äº†è¿™ä¹ˆå¤šç„æœºã€‚çœ‹æ¥ï¼Œæˆ‘ä»¬å¹³æ—¶è¿˜æ˜¯åº”è¯¥è®¤çœŸçš„é˜…è¯» Java ç›¸å…³çš„åŸºç¡€æ–‡æ¡£ï¼Œæ¯”å¦‚ï¼šJava è¯­è¨€è§„èŒƒã€Java è™šæ‹Ÿæœºè§„èŒƒç­‰ï¼Œå¾ˆå¤šæ£˜æ‰‹çš„é—®é¢˜éƒ½å¯ä»¥ä»ä¸­å¾—åˆ°ç­”æ¡ˆã€‚åªæœ‰çœŸæ­£çš„åƒé€äº†åŸºç¡€çŸ¥è¯†ï¼Œæ‰èƒ½è¾¾åˆ°è¿ç”¨è‡ªå¦‚çš„å¢ƒç•Œï¼ å‚è€ƒèµ„æ–™å‚è€ƒ The Java Tutorialsï¼ŒæŸ¥çœ‹å¯¹ finally è¯­å¥å—çš„æè¿°ã€‚ å‚è€ƒ ã€ŠThe Java Programming Language, Fourth Editionã€‹ï¼ŒæŸ¥çœ‹ Java è¯­è¨€è§„èŒƒç¬¬å››ç‰ˆä¸­å¯¹ finally è¯­å¥å—çš„è§£é‡Šã€‚ å‚è€ƒ ã€ŠThe Java Language Specification, Third Editionã€‹ï¼ŒæŸ¥çœ‹ Java è¯­è¨€è§„èŒƒç¬¬ä¸‰ç‰ˆä¸­å¯¹ finally è¯­å¥å—æ‰§è¡Œæµç¨‹çš„å…·ä½“æè¿°ã€‚ å‚è€ƒ ã€ŠThe Java Virtual Machine Specification, Second Editionã€‹ï¼ŒæŸ¥çœ‹ Java è™šæ‹Ÿæœºæ˜¯å¦‚ä½•æ¥ç¼–è¯‘ finally è¯­å¥å—çš„çŸ¥è¯†ã€‚ æŸ¥çœ‹æ–‡ç«  ã€ŠJava çš„å¼‚å¸¸å¤„ç†æœºåˆ¶(try â€¦ catch â€¦ finally)ã€‹ï¼Œäº†è§£æ›´å¤šå…³äº Java ä¸­ finally è¯­å¥å—çš„åˆ†æã€‚ æŸ¥çœ‹æ–‡ç«  ã€ŠJava ä¸­ finally çš„è¾¨æã€‹ï¼Œäº†è§£æ›´å¤šå…³äº Java ä¸­ finally è¯­å¥å—çš„åˆ†æã€‚ æŸ¥çœ‹æ–‡ç« ã€Šå…³äº Java ä¸­ finally è¯­å¥å—çš„æ·±åº¦è¾¨æã€‹","tags":[{"name":"Java","slug":"Java","permalink":"http://www.54tianzhisheng.cn/tags/Java/"},{"name":"finally","slug":"finally","permalink":"http://www.54tianzhisheng.cn/tags/finally/"}]},{"title":"é€šè¿‡é¡¹ç›®é€æ­¥æ·±å…¥äº†è§£Mybatisï¼ˆäºŒï¼‰","date":"2017-06-12T16:00:00.000Z","path":"2017/06/13/é€šè¿‡é¡¹ç›®é€æ­¥æ·±å…¥äº†è§£Mybatis(äºŒ)/","text":"è½¬è½½è¯·åŠ¡å¿…æ³¨æ˜å‡ºå¤„ï¼ŒåŸåˆ›ä¸æ˜“ï¼ ç›¸å…³æ–‡ç« ï¼šé€šè¿‡é¡¹ç›®é€æ­¥æ·±å…¥äº†è§£Mybatis&lt;ä¸€&gt;æœ¬é¡¹ç›®å…¨éƒ¨ä»£ç åœ°å€ï¼šGithub-Mybatis Mybatis è§£å†³ jdbc ç¼–ç¨‹çš„é—®é¢˜1ã€ æ•°æ®åº“é“¾æ¥åˆ›å»ºã€é‡Šæ”¾é¢‘ç¹é€ æˆç³»ç»Ÿèµ„æºæµªè´¹ä»è€Œå½±å“ç³»ç»Ÿæ€§èƒ½ï¼Œå¦‚æœä½¿ç”¨æ•°æ®åº“é“¾æ¥æ± å¯è§£å†³æ­¤é—®é¢˜ã€‚ è§£å†³ï¼šåœ¨SqlMapConfig.xmlä¸­é…ç½®æ•°æ®é“¾æ¥æ± ï¼Œä½¿ç”¨è¿æ¥æ± ç®¡ç†æ•°æ®åº“é“¾æ¥ã€‚ 2ã€ Sqlè¯­å¥å†™åœ¨ä»£ç ä¸­é€ æˆä»£ç ä¸æ˜“ç»´æŠ¤ï¼Œå®é™…åº”ç”¨sqlå˜åŒ–çš„å¯èƒ½è¾ƒå¤§ï¼Œsqlå˜åŠ¨éœ€è¦æ”¹å˜javaä»£ç ã€‚ è§£å†³ï¼šå°†Sqlè¯­å¥é…ç½®åœ¨XXXXmapper.xmlæ–‡ä»¶ä¸­ä¸javaä»£ç åˆ†ç¦»ã€‚ 3ã€ å‘sqlè¯­å¥ä¼ å‚æ•°éº»çƒ¦ï¼Œå› ä¸ºsqlè¯­å¥çš„whereæ¡ä»¶ä¸ä¸€å®šï¼Œå¯èƒ½å¤šä¹Ÿå¯èƒ½å°‘ï¼Œå ä½ç¬¦éœ€è¦å’Œå‚æ•°ä¸€ä¸€å¯¹åº”ã€‚ è§£å†³ï¼šMybatisè‡ªåŠ¨å°†javaå¯¹è±¡æ˜ å°„è‡³sqlè¯­å¥ï¼Œé€šè¿‡statementä¸­çš„parameterTypeå®šä¹‰è¾“å…¥å‚æ•°çš„ç±»å‹ã€‚ 4ã€ å¯¹ç»“æœé›†è§£æéº»çƒ¦ï¼Œsqlå˜åŒ–å¯¼è‡´è§£æä»£ç å˜åŒ–ï¼Œä¸”è§£æå‰éœ€è¦éå†ï¼Œå¦‚æœèƒ½å°†æ•°æ®åº“è®°å½•å°è£…æˆpojoå¯¹è±¡è§£ææ¯”è¾ƒæ–¹ä¾¿ã€‚ è§£å†³ï¼šMybatisè‡ªåŠ¨å°†sqlæ‰§è¡Œç»“æœæ˜ å°„è‡³javaå¯¹è±¡ï¼Œé€šè¿‡statementä¸­çš„resultTypeå®šä¹‰è¾“å‡ºç»“æœçš„ç±»å‹ã€‚ Mybatis ä¸ Hibernate ä¸åŒMybatiså’Œhibernateä¸åŒï¼Œå®ƒä¸å®Œå…¨æ˜¯ä¸€ä¸ªORMæ¡†æ¶ï¼Œå› ä¸ºMyBatiséœ€è¦ç¨‹åºå‘˜è‡ªå·±ç¼–å†™Sqlè¯­å¥ï¼Œä¸è¿‡mybatiså¯ä»¥é€šè¿‡XMLæˆ–æ³¨è§£æ–¹å¼çµæ´»é…ç½®è¦è¿è¡Œçš„sqlè¯­å¥ï¼Œå¹¶å°†javaå¯¹è±¡å’Œsqlè¯­å¥æ˜ å°„ç”Ÿæˆæœ€ç»ˆæ‰§è¡Œçš„sqlï¼Œæœ€åå°†sqlæ‰§è¡Œçš„ç»“æœå†æ˜ å°„ç”Ÿæˆjavaå¯¹è±¡ã€‚ Mybatiså­¦ä¹ é—¨æ§›ä½ï¼Œç®€å•æ˜“å­¦ï¼Œç¨‹åºå‘˜ç›´æ¥ç¼–å†™åŸç”Ÿæ€sqlï¼Œå¯ä¸¥æ ¼æ§åˆ¶sqlæ‰§è¡Œæ€§èƒ½ï¼Œçµæ´»åº¦é«˜ï¼Œéå¸¸é€‚åˆå¯¹å…³ç³»æ•°æ®æ¨¡å‹è¦æ±‚ä¸é«˜çš„è½¯ä»¶å¼€å‘ï¼Œä¾‹å¦‚äº’è”ç½‘è½¯ä»¶ã€ä¼ä¸šè¿è¥ç±»è½¯ä»¶ç­‰ï¼Œå› ä¸ºè¿™ç±»è½¯ä»¶éœ€æ±‚å˜åŒ–é¢‘ç¹ï¼Œä¸€ä½†éœ€æ±‚å˜åŒ–è¦æ±‚æˆæœè¾“å‡ºè¿…é€Ÿã€‚ä½†æ˜¯çµæ´»çš„å‰ææ˜¯mybatisæ— æ³•åšåˆ°æ•°æ®åº“æ— å…³æ€§ï¼Œå¦‚æœéœ€è¦å®ç°æ”¯æŒå¤šç§æ•°æ®åº“çš„è½¯ä»¶åˆ™éœ€è¦è‡ªå®šä¹‰å¤šå¥—sqlæ˜ å°„æ–‡ä»¶ï¼Œå·¥ä½œé‡å¤§ã€‚ Hibernateå¯¹è±¡/å…³ç³»æ˜ å°„èƒ½åŠ›å¼ºï¼Œæ•°æ®åº“æ— å…³æ€§å¥½ï¼Œå¯¹äºå…³ç³»æ¨¡å‹è¦æ±‚é«˜çš„è½¯ä»¶ï¼ˆä¾‹å¦‚éœ€æ±‚å›ºå®šçš„å®šåˆ¶åŒ–è½¯ä»¶ï¼‰å¦‚æœç”¨hibernateå¼€å‘å¯ä»¥èŠ‚çœå¾ˆå¤šä»£ç ï¼Œæé«˜æ•ˆç‡ã€‚ä½†æ˜¯Hibernateçš„å­¦ä¹ é—¨æ§›é«˜ï¼Œè¦ç²¾é€šé—¨æ§›æ›´é«˜ï¼Œè€Œä¸”æ€ä¹ˆè®¾è®¡O/Ræ˜ å°„ï¼Œåœ¨æ€§èƒ½å’Œå¯¹è±¡æ¨¡å‹ä¹‹é—´å¦‚ä½•æƒè¡¡ï¼Œä»¥åŠæ€æ ·ç”¨å¥½Hibernateéœ€è¦å…·æœ‰å¾ˆå¼ºçš„ç»éªŒå’Œèƒ½åŠ›æ‰è¡Œã€‚ æ€»ä¹‹ï¼ŒæŒ‰ç…§ç”¨æˆ·çš„éœ€æ±‚åœ¨æœ‰é™çš„èµ„æºç¯å¢ƒä¸‹åªè¦èƒ½åšå‡ºç»´æŠ¤æ€§ã€æ‰©å±•æ€§è‰¯å¥½çš„è½¯ä»¶æ¶æ„éƒ½æ˜¯å¥½æ¶æ„ï¼Œæ‰€ä»¥æ¡†æ¶åªæœ‰é€‚åˆæ‰æ˜¯æœ€å¥½ã€‚ Mybatis å¼€å‘ daoä¸¤ç§æ–¹æ³• åŸå§‹ dao å¼€å‘æ–¹æ³•ï¼ˆç¨‹åºéœ€è¦ç¼–å†™ dao æ¥å£å’Œ dao å®ç°ç±»ï¼‰ï¼ˆæŒæ¡ï¼‰ Mybatis çš„ mapper æ¥å£ï¼ˆç›¸å½“äº dao æ¥å£ï¼‰ä»£ç†å¼€å‘æ–¹æ³•ï¼ˆæŒæ¡ï¼‰ éœ€æ±‚å°†ä¸‹è¾¹çš„åŠŸèƒ½å®ç°Daoï¼š æ ¹æ®ç”¨æˆ·idæŸ¥è¯¢ä¸€ä¸ªç”¨æˆ·ä¿¡æ¯ æ ¹æ®ç”¨æˆ·åç§°æ¨¡ç³ŠæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯åˆ—è¡¨ æ·»åŠ ç”¨æˆ·ä¿¡æ¯ Mybatis é…ç½®æ–‡ä»¶ SqlMapConfig.xml Sqlsession çš„ä½¿ç”¨èŒƒå›´SqlSession ä¸­å°è£…äº†å¯¹æ•°æ®åº“çš„æ“ä½œï¼Œå¦‚ï¼šæŸ¥è¯¢ã€æ’å…¥ã€æ›´æ–°ã€åˆ é™¤ç­‰ã€‚ é€šè¿‡ SqlSessionFactory åˆ›å»º SqlSessionï¼Œè€Œ SqlSessionFactory æ˜¯é€šè¿‡ SqlSessionFactoryBuilder è¿›è¡Œåˆ›å»ºã€‚ 1ã€SqlSessionFactoryBuilderSqlSessionFactoryBuilder ç”¨äºåˆ›å»º SqlSessionFacotyï¼ŒSqlSessionFacoty ä¸€æ—¦åˆ›å»ºå®Œæˆå°±ä¸éœ€è¦SqlSessionFactoryBuilder äº†ï¼Œå› ä¸º SqlSession æ˜¯é€šè¿‡ SqlSessionFactory ç”Ÿäº§ï¼Œæ‰€ä»¥å¯ä»¥å°†SqlSessionFactoryBuilder å½“æˆä¸€ä¸ªå·¥å…·ç±»ä½¿ç”¨ï¼Œæœ€ä½³ä½¿ç”¨èŒƒå›´æ˜¯æ–¹æ³•èŒƒå›´å³æ–¹æ³•ä½“å†…å±€éƒ¨å˜é‡ã€‚ 2ã€SqlSessionFactorySqlSessionFactory æ˜¯ä¸€ä¸ªæ¥å£ï¼Œæ¥å£ä¸­å®šä¹‰äº† openSession çš„ä¸åŒé‡è½½æ–¹æ³•ï¼ŒSqlSessionFactory çš„æœ€ä½³ä½¿ç”¨èŒƒå›´æ˜¯æ•´ä¸ªåº”ç”¨è¿è¡ŒæœŸé—´ï¼Œä¸€æ—¦åˆ›å»ºåå¯ä»¥é‡å¤ä½¿ç”¨ï¼Œé€šå¸¸ä»¥å•ä¾‹æ¨¡å¼ç®¡ç† SqlSessionFactoryã€‚ 3ã€SqlSessionSqlSession æ˜¯ä¸€ä¸ªé¢å‘ç”¨æˆ·çš„æ¥å£ï¼Œ sqlSession ä¸­å®šä¹‰äº†æ•°æ®åº“æ“ä½œï¼Œé»˜è®¤ä½¿ç”¨ DefaultSqlSession å®ç°ç±»ã€‚ æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š 1ï¼‰ã€ åŠ è½½æ•°æ®æºç­‰é…ç½®ä¿¡æ¯ Environment environment = configuration.getEnvironment(); 2ï¼‰ã€ åˆ›å»ºæ•°æ®åº“é“¾æ¥ 3ï¼‰ã€ åˆ›å»ºäº‹åŠ¡å¯¹è±¡ 4ï¼‰ã€ åˆ›å»ºExecutorï¼ŒSqlSession æ‰€æœ‰æ“ä½œéƒ½æ˜¯é€šè¿‡ Executor å®Œæˆï¼Œmybatis æºç å¦‚ä¸‹ï¼š 12345678910if (ExecutorType.BATCH == executorType) &#123; executor = newBatchExecutor(this, transaction); &#125; elseif (ExecutorType.REUSE == executorType) &#123; executor = new ReuseExecutor(this, transaction); &#125; else &#123; executor = new SimpleExecutor(this, transaction); &#125;if (cacheEnabled) &#123; executor = new CachingExecutor(executor, autoCommit); &#125; 5ï¼‰ã€ SqlSessionçš„å®ç°ç±»å³ DefaultSqlSessionï¼Œæ­¤å¯¹è±¡ä¸­å¯¹æ“ä½œæ•°æ®åº“å®è´¨ä¸Šç”¨çš„æ˜¯ Executor ç»“è®ºï¼šæ¯ä¸ªçº¿ç¨‹éƒ½åº”è¯¥æœ‰å®ƒè‡ªå·±çš„SqlSessionå®ä¾‹ã€‚SqlSessionçš„å®ä¾‹ä¸èƒ½å…±äº«ä½¿ç”¨ï¼Œå®ƒä¹Ÿæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚å› æ­¤æœ€ä½³çš„èŒƒå›´æ˜¯è¯·æ±‚æˆ–æ–¹æ³•èŒƒå›´(å®šä¹‰å±€éƒ¨å˜é‡ä½¿ç”¨)ã€‚ç»å¯¹ä¸èƒ½å°†SqlSessionå®ä¾‹çš„å¼•ç”¨æ”¾åœ¨ä¸€ä¸ªç±»çš„é™æ€å­—æ®µæˆ–å®ä¾‹å­—æ®µä¸­ã€‚ æ‰“å¼€ä¸€ä¸ªSqlSessionï¼›ä½¿ç”¨å®Œæ¯•å°±è¦å…³é—­å®ƒã€‚é€šå¸¸æŠŠè¿™ä¸ªå…³é—­æ“ä½œæ”¾åˆ° finally å—ä¸­ä»¥ç¡®ä¿æ¯æ¬¡éƒ½èƒ½æ‰§è¡Œå…³é—­ã€‚å¦‚ä¸‹ï¼š 123456SqlSession session = sqlSessionFactory.openSession(); try &#123; // do work &#125; finally &#123; session.close();&#125; åŸå§‹ Dao å¼€å‘æ–¹æ³•æ€è·¯ï¼šéœ€è¦ç¨‹åºå‘˜ç¼–å†™ Dao æ¥å£å’Œ Dao å®ç°ç±»ï¼› éœ€è¦åœ¨ Dao å®ç°ç±»ä¸­æ³¨å…¥ SqlsessionFactory ï¼Œåœ¨æ–¹æ³•ä½“å†…é€šè¿‡ SqlsessionFactory åˆ›å»º Sqlsessionã€‚ Daoæ¥å£1234567891011public interface UserDao //daoæ¥å£ï¼Œç”¨æˆ·ç®¡ç†&#123; //æ ¹æ®idæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ public User findUserById(int id) throws Exception; //æ·»åŠ ç”¨æˆ·ä¿¡æ¯ public void addUser(User user) throws Exception; //åˆ é™¤ç”¨æˆ·ä¿¡æ¯ public void deleteUser(int id) throws Exception;&#125; Dao å®ç°ç±»1234567891011121314151617181920212223242526272829303132333435363738394041public class UserDaoImpl implements UserDao //daoæ¥å£å®ç°ç±»&#123; //éœ€è¦åœ¨ Dao å®ç°ç±»ä¸­æ³¨å…¥ SqlsessionFactory //è¿™é‡Œé€šè¿‡æ„é€ æ–¹æ³•æ³¨å…¥ private SqlSessionFactory sqlSessionFactory; public UserDaoImpl(SqlSessionFactory sqlSessionFactory) &#123; this.sqlSessionFactory = sqlSessionFactory; &#125; @Override public User findUserById(int id) throws Exception &#123; //åœ¨æ–¹æ³•ä½“å†…é€šè¿‡ SqlsessionFactory åˆ›å»º Sqlsession SqlSession sqlSession = sqlSessionFactory.openSession(); User user = sqlSession.selectOne(\"test.findUserById\", id); sqlSession.close(); return user; &#125; @Override public void insertUser(User user) throws Exception &#123; //åœ¨æ–¹æ³•ä½“å†…é€šè¿‡ SqlsessionFactory åˆ›å»º Sqlsession SqlSession sqlSession = sqlSessionFactory.openSession(); //æ‰§è¡Œæ’å…¥çš„æ“ä½œ sqlSession.insert(\"test.insetrUser\", user); //æäº¤äº‹åŠ¡ sqlSession.commit(); //é‡Šæ”¾èµ„æº sqlSession.close(); &#125; @Override public void deleteUser(int id) throws Exception &#123; //åœ¨æ–¹æ³•ä½“å†…é€šè¿‡ SqlsessionFactory åˆ›å»º Sqlsession SqlSession sqlSession = sqlSessionFactory.openSession(); sqlSession.delete(\"test.deleteUserById\", id); //æäº¤äº‹åŠ¡ sqlSession.commit(); sqlSession.close(); &#125;&#125; æµ‹è¯•12345678910111213141516171819202122232425public class UserDaoImplTest&#123; private SqlSessionFactory sqlSessionFactory; //æ­¤æ–¹æ³•æ˜¯åœ¨ testFindUserById æ–¹æ³•ä¹‹å‰æ‰§è¡Œçš„ @Before public void setup() throws Exception &#123; //åˆ›å»ºsqlSessionFactory //Mybatis é…ç½®æ–‡ä»¶ String resource = \"SqlMapConfig.xml\"; //å¾—åˆ°é…ç½®æ–‡ä»¶æµ InputStream inputStream = Resources.getResourceAsStream(resource); //åˆ›å»ºä¼šè¯å·¥å‚,ä¼ å…¥Mybatisçš„é…ç½®æ–‡ä»¶ä¿¡æ¯ sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream); &#125; @Test public void testFindUserById() throws Exception &#123; //åˆ›å»ºUserDaoçš„å¯¹è±¡ UserDao userDao = new UserDaoImpl(sqlSessionFactory); //è°ƒç”¨UserDaoæ–¹æ³• User user = userDao.findUserById(1); System.out.println(user); &#125;&#125; é€šè¿‡idæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯æµ‹è¯•ç»“æœå¦‚ä¸‹ï¼šï¼ˆå…¶ä»–çš„å¯ä»¥è‡ªå·±åœ¨å†™æµ‹è¯•ä»£ç ï¼ŒåŸç†ç±»ä¼¼ï¼‰ é—®é¢˜åŸå§‹Daoå¼€å‘ä¸­å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š Daoæ–¹æ³•ä½“å­˜åœ¨é‡å¤ä»£ç ï¼šé€šè¿‡ SqlSessionFactory åˆ›å»º SqlSessionï¼Œè°ƒç”¨ SqlSession çš„æ•°æ®åº“æ“ä½œæ–¹æ³• è°ƒç”¨ sqlSession çš„æ•°æ®åº“æ“ä½œæ–¹æ³•éœ€è¦æŒ‡å®š statement çš„i dï¼Œè¿™é‡Œå­˜åœ¨ç¡¬ç¼–ç ï¼Œä¸å¾—äºå¼€å‘ç»´æŠ¤ã€‚ è°ƒç”¨ sqlSession çš„æ•°æ®åº“æ“ä½œæ–¹æ³•æ—¶ä¼ å…¥çš„å˜é‡ï¼Œç”±äº sqlsession æ–¹æ³•ä½¿ç”¨æ³›å‹ï¼Œå³ä½¿å˜é‡ç±»å‹ä¼ å…¥é”™è¯¯ï¼Œåœ¨ç¼–è¯‘é˜¶æ®µä¹Ÿä¸æŠ¥é”™ï¼Œä¸åˆ©äºç¨‹åºå‘˜å¼€å‘ã€‚ Mybatis çš„ mapper æ¥å£æ€è·¯ç¨‹åºå‘˜éœ€è¦ç¼–å†™ mapper.xml æ˜ å°„æ–‡ä»¶ åªéœ€è¦ç¨‹åºå‘˜ç¼–å†™Mapperæ¥å£ï¼ˆç›¸å½“äºDaoæ¥å£ï¼‰ï¼Œéœ€éµå¾ªä¸€äº›å¼€å‘è§„èŒƒï¼Œmybatis å¯ä»¥è‡ªåŠ¨ç”Ÿæˆ mapper æ¥å£ç±»ä»£ç†å¯¹è±¡ã€‚ å¼€å‘è§„èŒƒï¼š åœ¨ mapper.xml ä¸­ namespace ç­‰äº mapper æ¥å£åœ°å€ 1&lt;mapper namespace=\"cn.zhisheng.mybatis.mapper.UserMapper\"&gt;&lt;/mapper&gt; åœ¨ xxxmapper.java æ¥å£ä¸­çš„æ–¹æ³•åè¦ä¸ xxxMapper.xml ä¸­ statement çš„ id ä¸€è‡´ã€‚ åœ¨ xxxmapper.java æ¥å£ä¸­çš„è¾“å…¥å‚æ•°ç±»å‹è¦ä¸ xxxMapper.xml ä¸­ statement çš„ parameterType æŒ‡å®šçš„å‚æ•°ç±»å‹ä¸€è‡´ã€‚ åœ¨ xxxmapper.java æ¥å£ä¸­çš„è¿”å›å€¼ç±»å‹è¦ä¸ xxxMapper.xml ä¸­ statement çš„ resultType æŒ‡å®šçš„ç±»å‹ä¸€è‡´ã€‚ UserMapper.java 12//æ ¹æ®idæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ public User findUserById(int id) throws Exception; UserMapper.xml 123&lt;select id=\"findUserById\" parameterType=\"int\" resultType=\"cn.zhisheng.mybatis.po.User\"&gt; select * from user where id = #&#123;1&#125;&lt;/select&gt; æ€»ç»“ï¼šä»¥ä¸Šçš„å¼€å‘è§„èŒƒä¸»è¦æ˜¯å¯¹ä¸‹è¾¹çš„ä»£ç è¿›è¡Œç»Ÿä¸€çš„ç”Ÿæˆï¼š 1234User user = sqlSession.selectOne(\"test.findUserById\", id);sqlSession.insert(\"test.insetrUser\", user);sqlSession.delete(\"test.deleteUserById\", id);List&lt;User&gt; list = sqlSession.selectList(\"test.findUserByName\", username); æµ‹è¯•æµ‹è¯•ä¹‹å‰è®°å¾—åœ¨ SqlMapConfig.xml æ–‡ä»¶ä¸­æ·»åŠ åŠ è½½æ˜ å°„æ–‡ä»¶ UserMapper.xmlï¼š 1&lt;mapper resource=\"mapper/UserMapper.xml\"/&gt; æµ‹è¯•ä»£ç ï¼š 1234567891011121314151617181920212223242526public class UserMapperTest&#123; private SqlSessionFactory sqlSessionFactory; //æ­¤æ–¹æ³•æ˜¯åœ¨ testFindUserById æ–¹æ³•ä¹‹å‰æ‰§è¡Œçš„ @Before public void setup() throws Exception &#123; //åˆ›å»ºsqlSessionFactory //Mybatis é…ç½®æ–‡ä»¶ String resource = \"SqlMapConfig.xml\"; //å¾—åˆ°é…ç½®æ–‡ä»¶æµ InputStream inputStream = Resources.getResourceAsStream(resource); //åˆ›å»ºä¼šè¯å·¥å‚,ä¼ å…¥Mybatisçš„é…ç½®æ–‡ä»¶ä¿¡æ¯ sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream); &#125; @Test public void testFindUserById() throws Exception &#123; SqlSession sqlSession = sqlSessionFactory.openSession(); //åˆ›å»ºusermapperå¯¹è±¡,mybatisè‡ªåŠ¨ç”Ÿæˆä»£ç†å¯¹è±¡ UserMapper userMapper = sqlSession.getMapper(UserMapper.class); //è°ƒç”¨UserMapperçš„æ–¹æ³• User user = userMapper.findUserById(1); System.out.println(user); &#125;&#125; é€šè¿‡idæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯æµ‹è¯•ç»“æœå¦‚ä¸‹ï¼šï¼ˆå…¶ä»–çš„è¯·è‡ªå·±æ ¹æ®ä¸Šä¸‹æ–‡å†™æµ‹è¯•ä»£ç ï¼Œæˆ–è€…å»çœ‹æˆ‘ Github-Mybatiså­¦ä¹ ç¬”è®° ä¸Šçœ‹æˆ‘è¿™ä¸ªé¡¹ç›®çš„å…¨éƒ¨ä»£ç ï¼‰ é€šè¿‡å§“åæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼š ä»£ç†å¯¹è±¡å†…éƒ¨è°ƒç”¨ selectOne æˆ–è€… selectList å¦‚æœ mapper æ–¹æ³•è¿”å›å•ä¸ª pojo å¯¹è±¡ï¼ˆéé›†åˆå¯¹è±¡ï¼‰ï¼Œä»£ç†å¯¹è±¡å†…éƒ¨é€šè¿‡ selectOne æŸ¥è¯¢æ•°æ®åº“ å¦‚æœ mapper æ–¹æ³•è¿”å›é›†åˆå¯¹è±¡ï¼Œä»£ç†å¯¹è±¡å†…éƒ¨é€šè¿‡ selectList æŸ¥è¯¢æ•°æ®åº“ mapperæ¥å£æ–¹æ³•å‚æ•°åªèƒ½æœ‰ä¸€ä¸ªæ˜¯å¦å½±å“ç³»ç»Ÿå¼€å‘ mapper æ¥å£æ–¹æ³•å‚æ•°åªèƒ½æœ‰ä¸€ä¸ªï¼Œç³»ç»Ÿæ˜¯å¦ä¸åˆ©äºç»´æŠ¤ï¼Ÿ ç³»ç»Ÿæ¡†æ¶ä¸­ï¼Œdaoå±‚çš„ä»£ç æ˜¯è¢«ä¸šåŠ¡å±‚å…¬ç”¨çš„ã€‚ å³ä½¿ mapper æ¥å£åªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨åŒ…è£…ç±»å‹çš„ pojo æ»¡è¶³ä¸åŒçš„ä¸šåŠ¡æ–¹æ³•çš„éœ€æ±‚ã€‚ æ³¨æ„ï¼šæŒä¹…å±‚æ–¹æ³•çš„å‚æ•°å¯ä»¥åŒ…è£…ç±»å‹ã€mapâ€¦. ï¼Œserviceæ–¹æ³•ä¸­ä¸å»ºè®®ä½¿ç”¨åŒ…è£…ç±»å‹ã€‚ï¼ˆä¸åˆ©äºä¸šåŠ¡å±‚çš„å¯æ‰©å±•æ€§ï¼‰ SqlMapConfig.xml æ–‡ä»¶Mybatis çš„å…¨å±€é…ç½®å˜é‡ï¼Œé…ç½®å†…å®¹å’Œé¡ºåºå¦‚ä¸‹ï¼š propertiesï¼ˆå±æ€§ï¼‰ settingsï¼ˆå…¨å±€é…ç½®å‚æ•°ï¼‰ typeAliasesï¼ˆç±»å‹åˆ«åï¼‰ typeHandlersï¼ˆç±»å‹å¤„ç†å™¨ï¼‰ objectFactoryï¼ˆå¯¹è±¡å·¥å‚ï¼‰ pluginsï¼ˆæ’ä»¶ï¼‰ environmentsï¼ˆç¯å¢ƒé›†åˆå±æ€§å¯¹è±¡ï¼‰ â€‹ environmentï¼ˆç¯å¢ƒå­å±æ€§å¯¹è±¡ï¼‰ â€‹ transactionManagerï¼ˆäº‹åŠ¡ç®¡ç†ï¼‰ â€‹ dataSourceï¼ˆæ•°æ®æºï¼‰ mappersï¼ˆæ˜ å°„å™¨ï¼‰ properties å±æ€§éœ€æ±‚ï¼šå°†æ•°æ®åº“è¿æ¥å‚æ•°å•ç‹¬é…ç½®åœ¨ db.properties ä¸­ï¼Œåªéœ€è¦åœ¨ SqlMapConfig.xml ä¸­åŠ è½½è¯¥é…ç½®æ–‡ä»¶ db.properties çš„å±æ€§å€¼ã€‚åœ¨ SqlMapConfig.xml ä¸­å°±ä¸éœ€è¦ç›´æ¥å¯¹æ•°æ®åº“çš„è¿æ¥å‚æ•°è¿›è¡Œç¡¬ç¼–ç äº†ã€‚æ–¹ä¾¿ä»¥åå¯¹å‚æ•°è¿›è¡Œç»Ÿä¸€çš„ç®¡ç†ï¼Œå…¶ä»–çš„xmlæ–‡ä»¶å¯ä»¥å¼•ç”¨è¯¥ db.properties ã€‚ db.properties 1234jdbc.driver=com.mysql.jdbc.Driverjdbc.url=jdbc:mysql://localhost:3306/mybatis_test?characterEncoding=utf-8jdbc.username=rootjdbc.password=root é‚£ä¹ˆ SqlMapConfig.xml ä¸­çš„é…ç½®å˜æˆå¦‚ä¸‹ï¼š 12345678910111213141516&lt;!--åŠ è½½é…ç½®æ–‡ä»¶--&gt; &lt;properties resource=\"db.properties\"&gt;&lt;/properties&gt; &lt;!-- å’Œspringæ•´åˆå environmentsé…ç½®å°†åºŸé™¤--&gt; &lt;environments default=\"development\"&gt; &lt;environment id=\"development\"&gt; &lt;!-- ä½¿ç”¨jdbcäº‹åŠ¡ç®¡ç†,äº‹åŠ¡ç”± Mybatis æ§åˆ¶--&gt; &lt;transactionManager type=\"JDBC\" /&gt; &lt;!-- æ•°æ®åº“è¿æ¥æ± --&gt; &lt;dataSource type=\"POOLED\"&gt; &lt;property name=\"driver\" value=\"$&#123;jdbc.driver&#125;\" /&gt; &lt;property name=\"url\" value=\"$&#123;jdbc.url&#125;\" /&gt; &lt;property name=\"username\" value=\"$&#123;jdbc.username&#125;\" /&gt; &lt;property name=\"password\" value=\"$&#123;jdbc.password&#125;\" /&gt; &lt;/dataSource&gt; &lt;/environment&gt; &lt;/environments&gt; é…ç½®å®Œæˆåæˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹æ˜¯å¦èƒ½å¤Ÿå’Œåˆšæ‰ä¸€æ ·çš„èƒ½å¤ŸæˆåŠŸå‘¢ï¼Ÿé‚£ä¹ˆæˆ‘å°±å…ˆåœ¨db.propertiesä¸­æŠŠæ•°æ®åº“å¯†ç æ•…æ„æ”¹é”™ï¼Œçœ‹æ˜¯å¦æ˜¯æ­£ç¡®çš„ï¼Ÿä¸å‡ºæ„å¤–çš„è¯æ˜¯ä¼šæŠ¥é”™çš„ã€‚ æ³¨æ„ï¼š MyBatis å°†æŒ‰ç…§ä¸‹é¢çš„é¡ºåºæ¥åŠ è½½å±æ€§ï¼š åœ¨ properties å…ƒç´ ä½“å†…å®šä¹‰çš„å±æ€§é¦–å…ˆè¢«è¯»å–ã€‚ ç„¶åä¼šè¯»å– properties å…ƒç´ ä¸­ resource æˆ– url åŠ è½½çš„å±æ€§ï¼Œå®ƒä¼šè¦†ç›–å·²è¯»å–çš„åŒåå±æ€§ã€‚ æœ€åè¯»å– parameterType ä¼ é€’çš„å±æ€§ï¼Œå®ƒä¼šè¦†ç›–å·²è¯»å–çš„åŒåå±æ€§ã€‚ å› æ­¤ï¼Œé€šè¿‡parameterTypeä¼ é€’çš„å±æ€§å…·æœ‰æœ€é«˜ä¼˜å…ˆçº§ï¼Œresourceæˆ– url åŠ è½½çš„å±æ€§æ¬¡ä¹‹ï¼Œæœ€ä½ä¼˜å…ˆçº§çš„æ˜¯ properties å…ƒç´ ä½“å†…å®šä¹‰çš„å±æ€§ã€‚ å»ºè®®ï¼š ä¸è¦åœ¨ properties å…ƒç´ ä½“å†…æ·»åŠ ä»»ä½•å±æ€§å€¼ï¼Œåªå°†å±æ€§å€¼å®šä¹‰åœ¨ db.properties æ–‡ä»¶ä¹‹ä¸­ã€‚ åœ¨ db.properties æ–‡ä»¶ä¹‹ä¸­å®šä¹‰çš„å±æ€§åè¦æœ‰ä¸€å®šçš„ç‰¹æ®Šæ€§ã€‚å¦‚ xxx.xxx.xxx settingsï¼ˆå…¨å±€é…ç½®å‚æ•°ï¼‰Mybatis æ¡†æ¶åœ¨è¿è¡Œæ—¶å¯ä»¥è°ƒæ•´ä¸€äº›è¿è¡Œå‚æ•° æ¯”å¦‚ï¼šå¼€å¯äºŒçº§ç¼“å­˜ã€å¼€å¯å»¶è¿ŸåŠ è½½ã€‚ã€‚ã€‚ typeAliasesï¼ˆç±»å‹åˆ«åï¼‰éœ€æ±‚ï¼š åœ¨mapper.xmlä¸­ï¼Œå®šä¹‰å¾ˆå¤šçš„statementï¼Œstatementéœ€è¦parameterTypeæŒ‡å®šè¾“å…¥å‚æ•°çš„ç±»å‹ã€éœ€è¦resultTypeæŒ‡å®šè¾“å‡ºç»“æœçš„æ˜ å°„ç±»å‹ã€‚ å¦‚æœåœ¨æŒ‡å®šç±»å‹æ—¶è¾“å…¥ç±»å‹å…¨è·¯å¾„ï¼Œä¸æ–¹ä¾¿è¿›è¡Œå¼€å‘ï¼Œå¯ä»¥é’ˆå¯¹parameterTypeæˆ–resultTypeæŒ‡å®šçš„ç±»å‹å®šä¹‰ä¸€äº›åˆ«åï¼Œåœ¨mapper.xmlä¸­é€šè¿‡åˆ«åå®šä¹‰ï¼Œæ–¹ä¾¿å¼€å‘ã€‚ Mybatisæ”¯æŒçš„åˆ«åï¼š åˆ«å æ˜ å°„çš„ç±»å‹ _byte byte _long long _short short _int int _integer int _double double _float float _boolean boolean string String byte Byte long Long short Short int Integer integer Integer double Double float Float boolean Boolean date Date decimal BigDecimal bigdecimal BigDecimal è‡ªå®šä¹‰åˆ«åï¼š åœ¨ SqlMapConfig.xml ä¸­é…ç½®ï¼š(è®¾ç½®åˆ«å) 1234567&lt;typeAliases&gt; &lt;!-- å•ä¸ªåˆ«åå®šä¹‰ --&gt; &lt;typeAlias alias=\"user\" type=\"cn.zhisheng.mybatis.po.User\"/&gt; &lt;!-- æ‰¹é‡åˆ«åå®šä¹‰ï¼Œæ‰«ææ•´ä¸ªåŒ…ä¸‹çš„ç±»ï¼Œåˆ«åä¸ºç±»åï¼ˆé¦–å­—æ¯å¤§å†™æˆ–å°å†™éƒ½å¯ä»¥ï¼‰ --&gt; &lt;package name=\"cn.zhisheng.mybatis.po\"/&gt; &lt;package name=\"å…¶å®ƒåŒ…\"/&gt;&lt;/typeAliases&gt; åœ¨ UserMapper.xml ä¸­å¼•ç”¨åˆ«åï¼š( resultType ä¸º user ) 123&lt;select id=\"findUserById\" parameterType=\"int\" resultType=\"user\"&gt; select * from user where id = #&#123;id&#125;&lt;/select&gt; æµ‹è¯•ç»“æœï¼š typeHandlersï¼ˆç±»å‹å¤„ç†å™¨ï¼‰mybatisä¸­é€šè¿‡typeHandlerså®Œæˆjdbcç±»å‹å’Œjavaç±»å‹çš„è½¬æ¢ã€‚ é€šå¸¸æƒ…å†µä¸‹ï¼Œmybatisæä¾›çš„ç±»å‹å¤„ç†å™¨æ»¡è¶³æ—¥å¸¸éœ€è¦ï¼Œä¸éœ€è¦è‡ªå®šä¹‰. mybatisæ”¯æŒç±»å‹å¤„ç†å™¨ï¼š ç±»å‹å¤„ç†å™¨ Javaç±»å‹ JDBCç±»å‹ BooleanTypeHandler Booleanï¼Œboolean ä»»ä½•å…¼å®¹çš„å¸ƒå°”å€¼ ByteTypeHandler Byteï¼Œbyte ä»»ä½•å…¼å®¹çš„æ•°å­—æˆ–å­—èŠ‚ç±»å‹ ShortTypeHandler Shortï¼Œshort ä»»ä½•å…¼å®¹çš„æ•°å­—æˆ–çŸ­æ•´å‹ IntegerTypeHandler Integerï¼Œint ä»»ä½•å…¼å®¹çš„æ•°å­—å’Œæ•´å‹ LongTypeHandler Longï¼Œlong ä»»ä½•å…¼å®¹çš„æ•°å­—æˆ–é•¿æ•´å‹ FloatTypeHandler Floatï¼Œfloat ä»»ä½•å…¼å®¹çš„æ•°å­—æˆ–å•ç²¾åº¦æµ®ç‚¹å‹ DoubleTypeHandler Doubleï¼Œdouble ä»»ä½•å…¼å®¹çš„æ•°å­—æˆ–åŒç²¾åº¦æµ®ç‚¹å‹ BigDecimalTypeHandler BigDecimal ä»»ä½•å…¼å®¹çš„æ•°å­—æˆ–åè¿›åˆ¶å°æ•°ç±»å‹ StringTypeHandler String CHARå’ŒVARCHARç±»å‹ ClobTypeHandler String CLOBå’ŒLONGVARCHARç±»å‹ NStringTypeHandler String NVARCHARå’ŒNCHARç±»å‹ NClobTypeHandler String NCLOBç±»å‹ ByteArrayTypeHandler byte[] ä»»ä½•å…¼å®¹çš„å­—èŠ‚æµç±»å‹ BlobTypeHandler byte[] BLOBå’ŒLONGVARBINARYç±»å‹ DateTypeHandler Dateï¼ˆjava.utilï¼‰ TIMESTAMPç±»å‹ DateOnlyTypeHandler Dateï¼ˆjava.utilï¼‰ DATEç±»å‹ TimeOnlyTypeHandler Dateï¼ˆjava.utilï¼‰ TIMEç±»å‹ SqlTimestampTypeHandler Timestampï¼ˆjava.sqlï¼‰ TIMESTAMPç±»å‹ SqlDateTypeHandler Dateï¼ˆjava.sqlï¼‰ DATEç±»å‹ SqlTimeTypeHandler Timeï¼ˆjava.sqlï¼‰ TIMEç±»å‹ ObjectTypeHandler ä»»æ„ å…¶ä»–æˆ–æœªæŒ‡å®šç±»å‹ EnumTypeHandler Enumerationç±»å‹ VARCHAR-ä»»ä½•å…¼å®¹çš„å­—ç¬¦ä¸²ç±»å‹ï¼Œä½œä¸ºä»£ç å­˜å‚¨ï¼ˆè€Œä¸æ˜¯ç´¢å¼•ï¼‰ã€‚ mappersï¼ˆæ˜ å°„å™¨ï¼‰ ä½¿ç”¨ç›¸å¯¹äºç±»è·¯å¾„çš„èµ„æºï¼Œå¦‚ï¼š ä½¿ç”¨å®Œå…¨é™å®šè·¯å¾„å¦‚ï¼š ä½¿ç”¨ mapper æ¥å£ç±»è·¯å¾„ å¦‚ï¼š æ³¨æ„ï¼šæ­¤ç§æ–¹æ³•è¦æ±‚ mapper æ¥å£åç§°å’Œ mapper æ˜ å°„æ–‡ä»¶åç§°ç›¸åŒï¼Œä¸”æ”¾åœ¨åŒä¸€ä¸ªç›®å½•ä¸­ã€‚ æ³¨å†ŒæŒ‡å®šåŒ…ä¸‹çš„æ‰€æœ‰mapperæ¥å£å¦‚ï¼šæ³¨æ„ï¼šæ­¤ç§æ–¹æ³•è¦æ±‚ mapper æ¥å£åç§°å’Œ mapper æ˜ å°„æ–‡ä»¶åç§°ç›¸åŒï¼Œä¸”æ”¾åœ¨åŒä¸€ä¸ªç›®å½•ä¸­ã€‚ Mapper.xml æ˜ å°„æ–‡ä»¶Mapper.xmlæ˜ å°„æ–‡ä»¶ä¸­å®šä¹‰äº†æ“ä½œæ•°æ®åº“çš„sqlï¼Œæ¯ä¸ªsqlæ˜¯ä¸€ä¸ªstatementï¼Œæ˜ å°„æ–‡ä»¶æ˜¯mybatisçš„æ ¸å¿ƒã€‚ è¾“å…¥æ˜ å°„é€šè¿‡ parameterType æŒ‡å®šè¾“å…¥å‚æ•°çš„ç±»å‹ï¼Œç±»å‹å¯ä»¥æ˜¯ç®€å•ç±»å‹ã€hashmapã€pojoçš„åŒ…è£…ç±»å‹ã€‚ ä¼ é€’ pojo åŒ…è£…å¯¹è±¡ ï¼ˆé‡ç‚¹ï¼‰ å¼€å‘ä¸­é€šè¿‡pojoä¼ é€’æŸ¥è¯¢æ¡ä»¶ ï¼ŒæŸ¥è¯¢æ¡ä»¶æ˜¯ç»¼åˆçš„æŸ¥è¯¢æ¡ä»¶ï¼Œä¸ä»…åŒ…æ‹¬ç”¨æˆ·æŸ¥è¯¢æ¡ä»¶è¿˜åŒ…æ‹¬å…¶å®ƒçš„æŸ¥è¯¢æ¡ä»¶ï¼ˆæ¯”å¦‚å°†ç”¨æˆ·è´­ä¹°å•†å“ä¿¡æ¯ä¹Ÿä½œä¸ºæŸ¥è¯¢æ¡ä»¶ï¼‰ï¼Œè¿™æ—¶å¯ä»¥ä½¿ç”¨åŒ…è£…å¯¹è±¡ä¼ é€’è¾“å…¥å‚æ•°ã€‚ å®šä¹‰åŒ…è£…å¯¹è±¡ å®šä¹‰åŒ…è£…å¯¹è±¡å°†æŸ¥è¯¢æ¡ä»¶(pojo)ä»¥ç±»ç»„åˆçš„æ–¹å¼åŒ…è£…èµ·æ¥ã€‚ UserQueryVo.java 123456789101112131415public class UserQueryVo //ç”¨æˆ·åŒ…è£…ç±»å‹&#123; //åœ¨è¿™é‡ŒåŒ…è£…æ‰€éœ€è¦çš„æŸ¥è¯¢æ¡ä»¶ //ç”¨æˆ·æŸ¥è¯¢æ¡ä»¶ private UserCustom userCustom; public UserCustom getUserCustom() &#123; return userCustom; &#125; public void setUserCustom(UserCustom userCustom) &#123; this.userCustom = userCustom; &#125; //è¿˜å¯ä»¥åŒ…è£…å…¶ä»–çš„æŸ¥è¯¢æ¡ä»¶ï¼Œæ¯”å¦‚è®¢å•ã€å•†å“&#125; UserCustomer.java 1234public class UserCustom extends User //ç”¨æˆ·çš„æ‰©å±•ç±»&#123; //å¯ä»¥æ‰©å±•ç”¨æˆ·çš„ä¿¡æ¯&#125; UserMapper.xml æ–‡ä»¶ 1234567&lt;!--ç”¨æˆ·ä¿¡æ¯ç»¼åˆæŸ¥è¯¢ #&#123;userCustom.sex&#125; :å–å‡ºpojoåŒ…è£…å¯¹è±¡ä¸­çš„æ€§åˆ«å€¼ #&#123;userCustom.username&#125; :å–å‡ºpojoåŒ…è£…å¯¹è±¡ä¸­çš„ç”¨æˆ·åç§° --&gt; &lt;select id=\"findUserList\" parameterType=\"cn.zhisheng.mybatis.po.UserQueryVo\" resultType=\"cn.zhisheng.mybatis.po.UserCustom\"&gt; select * from user where user.sex = #&#123;userCustom.sex&#125; and user.username like '%$&#123;userCustom.username&#125;%' &lt;/select&gt; UserMapper.java 12//ç”¨æˆ·ä¿¡æ¯ç»¼åˆæŸ¥è¯¢public List&lt;UserCustom&gt; findUserList(UserQueryVo userQueryVo) throws Exception; æµ‹è¯•ä»£ç  1234567891011121314151617//æµ‹è¯•ç”¨æˆ·ä¿¡æ¯ç»¼åˆæŸ¥è¯¢ @Test public void testFindUserList() throws Exception &#123; SqlSession sqlSession = sqlSessionFactory.openSession(); //åˆ›å»ºusermapperå¯¹è±¡,mybatisè‡ªåŠ¨ç”Ÿæˆä»£ç†å¯¹è±¡ UserMapper userMapper = sqlSession.getMapper(UserMapper.class); //åˆ›å»ºåŒ…è£…å¯¹è±¡ï¼Œè®¾ç½®æŸ¥è¯¢æ¡ä»¶ UserQueryVo userQueryVo = new UserQueryVo(); UserCustom userCustom = new UserCustom(); userCustom.setSex(\"ç”·\"); userCustom.setUsername(\"å¼ å°æ˜\"); userQueryVo.setUserCustom(userCustom); //è°ƒç”¨UserMapperçš„æ–¹æ³• List&lt;UserCustom&gt; list = userMapper.findUserList(userQueryVo); System.out.println(list); &#125; æµ‹è¯•ç»“æœ è¾“å‡ºæ˜ å°„ resultType ä½¿ç”¨ resultType è¿›è¡Œè¾“å‡ºæ˜ å°„ï¼Œåªæœ‰æŸ¥è¯¢å‡ºæ¥çš„åˆ—åå’Œ pojo ä¸­çš„å±æ€§åä¸€è‡´ï¼Œè¯¥åˆ—æ‰å¯ä»¥æ˜ å°„æˆåŠŸã€‚ å¦‚æœæŸ¥è¯¢å‡ºæ¥çš„åˆ—åå’Œ pojo ä¸­çš„å±æ€§åå…¨éƒ¨ä¸ä¸€è‡´ï¼Œæ²¡æœ‰åˆ›å»º pojo å¯¹è±¡ã€‚ åªè¦æŸ¥è¯¢å‡ºæ¥çš„åˆ—åå’Œ pojo ä¸­çš„å±æ€§æœ‰ä¸€ä¸ªä¸€è‡´ï¼Œå°±ä¼šåˆ›å»º pojo å¯¹è±¡ã€‚ è¾“å‡ºç®€å•ç±»å‹éœ€æ±‚ï¼šç”¨æˆ·ä¿¡æ¯ç»¼åˆæŸ¥è¯¢åˆ—è¡¨æ€»æ•°ï¼Œé€šè¿‡æŸ¥è¯¢æ€»æ•°å’Œä¸Šè¾¹ç”¨æˆ·ç»¼åˆæŸ¥è¯¢åˆ—è¡¨æ‰å¯ä»¥å®ç°åˆ†é¡µ å®ç°ï¼š 1234567&lt;!--ç”¨æˆ·ä¿¡æ¯ç»¼åˆæŸ¥è¯¢æ€»æ•° parameterType:æŒ‡å®šè¾“å…¥çš„ç±»å‹å’ŒfindUserListä¸€æ · resultType:è¾“å‡ºç»“æœç±»å‹ä¸º int --&gt; &lt;select id=\"findUserCount\" parameterType=\"cn.zhisheng.mybatis.po.UserQueryVo\" resultType=\"int\"&gt; select count(*) from user where user.sex = #&#123;userCustom.sex&#125; and user.username like '%$&#123;userCustom.username&#125;%' &lt;/select&gt; 12//ç”¨æˆ·ä¿¡æ¯ç»¼åˆæŸ¥è¯¢æ€»æ•° public int findUserCount(UserQueryVo userQueryVo) throws Exception; 12345678910111213141516//æµ‹è¯•ç”¨æˆ·ä¿¡æ¯ç»¼åˆæŸ¥è¯¢æ€»æ•° @Test public void testFindUserCount() throws Exception &#123; SqlSession sqlSession = sqlSessionFactory.openSession(); //åˆ›å»ºusermapperå¯¹è±¡,mybatisè‡ªåŠ¨ç”Ÿæˆä»£ç†å¯¹è±¡ UserMapper userMapper = sqlSession.getMapper(UserMapper.class); //åˆ›å»ºåŒ…è£…å¯¹è±¡ï¼Œè®¾ç½®æŸ¥è¯¢æ¡ä»¶ UserQueryVo userQueryVo = new UserQueryVo(); UserCustom userCustom = new UserCustom(); userCustom.setSex(\"ç”·\"); userCustom.setUsername(\"å¼ å°æ˜\"); userQueryVo.setUserCustom(userCustom); //è°ƒç”¨UserMapperçš„æ–¹æ³• System.out.println(userMapper.findUserCount(userQueryVo)); &#125; æ³¨æ„ï¼šæŸ¥è¯¢å‡ºæ¥çš„ç»“æœé›†åªæœ‰ä¸€è¡Œä¸”ä¸€åˆ—ï¼Œå¯ä»¥ä½¿ç”¨ç®€å•ç±»å‹è¿›è¡Œè¾“å‡ºæ˜ å°„ã€‚ è¾“å‡ºpojoå¯¹è±¡å’Œpojoåˆ—è¡¨ ä¸ç®¡æ˜¯è¾“å‡ºçš„pojoå•ä¸ªå¯¹è±¡è¿˜æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼ˆlistä¸­åŒ…æ‹¬pojoï¼‰ï¼Œåœ¨mapper.xmlä¸­resultTypeæŒ‡å®šçš„ç±»å‹æ˜¯ä¸€æ ·çš„ã€‚ åœ¨mapper.javaæŒ‡å®šçš„æ–¹æ³•è¿”å›å€¼ç±»å‹ä¸ä¸€æ ·ï¼š 1ã€è¾“å‡ºå•ä¸ªpojoå¯¹è±¡ï¼Œæ–¹æ³•è¿”å›å€¼æ˜¯å•ä¸ªå¯¹è±¡ç±»å‹ 12//æ ¹æ®idæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ public User findUserById(int id) throws Exception; 2ã€è¾“å‡ºpojoå¯¹è±¡listï¼Œæ–¹æ³•è¿”å›å€¼æ˜¯List 12//æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ public List&lt;User&gt; findUserByUsername(String userName) throws Exception; resultTypeæ€»ç»“ï¼š è¾“å‡ºpojoå¯¹è±¡å’Œè¾“å‡ºpojoåˆ—è¡¨åœ¨sqlä¸­å®šä¹‰çš„resultTypeæ˜¯ä¸€æ ·çš„ã€‚ è¿”å›å•ä¸ªpojoå¯¹è±¡è¦ä¿è¯sqlæŸ¥è¯¢å‡ºæ¥çš„ç»“æœé›†ä¸ºå•æ¡ï¼Œå†…éƒ¨ä½¿ç”¨session.selectOneæ–¹æ³•è°ƒç”¨ï¼Œmapperæ¥å£ä½¿ç”¨pojoå¯¹è±¡ä½œä¸ºæ–¹æ³•è¿”å›å€¼ã€‚ è¿”å›pojoåˆ—è¡¨è¡¨ç¤ºæŸ¥è¯¢å‡ºæ¥çš„ç»“æœé›†å¯èƒ½ä¸ºå¤šæ¡ï¼Œå†…éƒ¨ä½¿ç”¨session.selectListæ–¹æ³•ï¼Œmapperæ¥å£ä½¿ç”¨Listå¯¹è±¡ä½œä¸ºæ–¹æ³•è¿”å›å€¼ã€‚ resultMap resultType å¯ä»¥æŒ‡å®š pojo å°†æŸ¥è¯¢ç»“æœæ˜ å°„ä¸º pojoï¼Œä½†éœ€è¦ pojo çš„å±æ€§åå’Œ sql æŸ¥è¯¢çš„åˆ—åä¸€è‡´æ–¹å¯æ˜ å°„æˆåŠŸã€‚ å¦‚æœsqlæŸ¥è¯¢å­—æ®µåå’Œpojoçš„å±æ€§åä¸ä¸€è‡´ï¼Œå¯ä»¥é€šè¿‡resultMapå°†å­—æ®µåå’Œå±æ€§åä½œä¸€ä¸ªå¯¹åº”å…³ç³» ï¼ŒresultMapå®è´¨ä¸Šè¿˜éœ€è¦å°†æŸ¥è¯¢ç»“æœæ˜ å°„åˆ°pojoå¯¹è±¡ä¸­ã€‚ resultMapå¯ä»¥å®ç°å°†æŸ¥è¯¢ç»“æœæ˜ å°„ä¸ºå¤æ‚ç±»å‹çš„pojoï¼Œæ¯”å¦‚åœ¨æŸ¥è¯¢ç»“æœæ˜ å°„å¯¹è±¡ä¸­åŒ…æ‹¬pojoå’Œlistå®ç°ä¸€å¯¹ä¸€æŸ¥è¯¢å’Œä¸€å¯¹å¤šæŸ¥è¯¢ã€‚ ä½¿ç”¨æ–¹æ³•ï¼š 1ã€å®šä¹‰ resultMap 2ã€ä½¿ç”¨ resultMap ä½œä¸º statement çš„è¾“å‡ºæ˜ å°„ç±»å‹ å°†ä¸‹é¢çš„ sql ä½¿ç”¨ User å®Œæˆæ˜ å°„ 1select id id_, username username_ from user where id = #&#123;value&#125; User ç±»ä¸­å±æ€§åå’Œä¸Šè¾¹æŸ¥è¯¢çš„åˆ—åä¸ä¸€è‡´ã€‚ æ‰€ä»¥éœ€è¦ï¼š 1ã€å®šä¹‰ resultMap 1234567891011121314151617181920&lt;!--å®šä¹‰ resultMap å°†select id id_, username username_ from user where id = #&#123;value&#125; å’ŒUserç±»ä¸­çš„å±æ€§åšä¸€ä¸ªæ˜ å°„å…³ç³» type: resultMapæœ€ç»ˆæ˜ å°„çš„javaå¯¹è±¡ç±»å‹ id:å¯¹resultMapçš„å”¯ä¸€æ ‡è¯† --&gt; &lt;resultMap id=\"userResultMap\" type=\"user\"&gt; &lt;!--idè¡¨ç¤ºæŸ¥è¯¢ç»“æœä¸­çš„å”¯ä¸€æ ‡è¯† columnï¼šæŸ¥è¯¢å‡ºæ¥çš„åˆ—å propertyï¼štypeæŒ‡å®špojoçš„å±æ€§å æœ€ç»ˆresultMapå¯¹columnå’Œpropertyåšä¸€ä¸ªæ˜ å°„å…³ç³»ï¼ˆå¯¹åº”å…³ç³»ï¼‰ --&gt; &lt;id column=\"id_\" property=\"id\"/&gt; &lt;!--result: å¯¹æ™®é€šç»“æœæ˜ å°„å®šä¹‰ columnï¼šæŸ¥è¯¢å‡ºæ¥çš„åˆ—å propertyï¼štypeæŒ‡å®špojoçš„å±æ€§å æœ€ç»ˆresultMapå¯¹columnå’Œpropertyåšä¸€ä¸ªæ˜ å°„å…³ç³»ï¼ˆå¯¹åº”å…³ç³»ï¼‰ --&gt; &lt;result column=\"username_\" property=\"username\"/&gt; &lt;/resultMap&gt; 2ã€ä½¿ç”¨ resultMap ä½œä¸º statement çš„è¾“å‡ºæ˜ å°„ç±»å‹ 12345&lt;!--ä½¿ç”¨ resultMap ä½œä¸ºè¾“å‡ºæ˜ å°„ç±»å‹ resultMap=\"userResultMap\":å…¶ä¸­çš„userResultMapå°±æ˜¯æˆ‘ä»¬åˆšæ‰å®šä¹‰çš„ resultMap çš„idå€¼,å¦‚æœè¿™ä¸ªresultMapåœ¨å…¶ä»–çš„mapperæ–‡ä»¶ä¸­ï¼Œå‰è¾¹é¡»åŠ ä¸Šnamespace --&gt; &lt;select id=\"findUserByIdResultMap\" parameterType=\"int\" resultMap=\"userResultMap\"&gt; select id id_, username username_ from user where id = #&#123;value&#125; &lt;/select&gt; 3ã€UserMapper.java 12//æ ¹æ®idæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼Œä½¿ç”¨ resultMap è¾“å‡ºpublic User findUserByIdResultMap(int id) throws Exception; 4ã€æµ‹è¯• 1234567891011//æµ‹è¯•æ ¹æ®idæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼Œä½¿ç”¨ resultMap è¾“å‡º @Test public void testFindUserByIdResultMap() throws Exception &#123; SqlSession sqlSession = sqlSessionFactory.openSession(); //åˆ›å»ºusermapperå¯¹è±¡,mybatisè‡ªåŠ¨ç”Ÿæˆä»£ç†å¯¹è±¡ UserMapper userMapper = sqlSession.getMapper(UserMapper.class); //è°ƒç”¨UserMapperçš„æ–¹æ³• User user = userMapper.findUserByIdResultMap(1); System.out.println(user); &#125; 5ã€æµ‹è¯•ç»“æœ åŠ¨æ€ SQLé€šè¿‡mybatisæä¾›çš„å„ç§æ ‡ç­¾æ–¹æ³•å®ç°åŠ¨æ€æ‹¼æ¥sqlã€‚ éœ€æ±‚ï¼š ç”¨æˆ·ä¿¡æ¯ç»¼åˆæŸ¥è¯¢åˆ—è¡¨å’Œç”¨æˆ·ä¿¡æ¯æŸ¥è¯¢åˆ—è¡¨æ€»æ•°è¿™ä¸¤ä¸ª statementçš„å®šä¹‰ä½¿ç”¨åŠ¨æ€sqlã€‚ å¯¹æŸ¥è¯¢æ¡ä»¶è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœè¾“å…¥çš„å‚æ•°ä¸ä¸ºç©ºæ‰è¿›è¡ŒæŸ¥è¯¢æ¡ä»¶æ‹¼æ¥ã€‚ UserMapper.xml (findUserListçš„é…ç½®å¦‚ä¸‹ï¼Œé‚£ä¹ˆfindUserCountçš„ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œè¿™é‡Œå°±ä¸å…¨éƒ¨å†™å‡ºæ¥äº†) 1234567891011121314&lt;select id=\"findUserList\" parameterType=\"cn.zhisheng.mybatis.po.UserQueryVo\" resultType=\"cn.zhisheng.mybatis.po.UserCustom\"&gt; select * from user &lt;!--whereå¯ä»¥è‡ªåŠ¨çš„å»æ‰æ¡ä»¶ä¸­çš„ç¬¬ä¸€ä¸ªand--&gt; &lt;where&gt; &lt;if test=\"userCustom != null\"&gt; &lt;if test=\"userCustom.sex != null and userCustom.sex != ''\"&gt; and user.sex = #&#123;userCustom.sex&#125; &lt;/if&gt; &lt;if test=\"userCustom.username != null\"&gt; and user.username like '%$&#123;userCustom.username&#125;%' &lt;/if&gt; &lt;/if&gt; &lt;/where&gt; &lt;/select&gt; æµ‹è¯•ä»£ç ï¼šå› ä¸ºè®¾ç½®äº†åŠ¨æ€çš„sqlï¼Œå¦‚æœä¸è®¾ç½®æŸä¸ªå€¼ï¼Œé‚£ä¹ˆæ¡ä»¶å°±ä¸ä¼šæ‹¼æ¥åœ¨sqlä¸Š æ‰€ä»¥æˆ‘ä»¬å°±æ³¨é‡Šæ‰è®¾ç½®usernameçš„è¯­å¥ 1//userCustom.setUsername(\"å¼ å°æ˜\"); æµ‹è¯•ç»“æœï¼š Sql ç‰‡æ®µé€šè¿‡ä¸Šé¢çš„å…¶å®çœ‹åˆ°åœ¨ where sqlè¯­å¥ä¸­æœ‰å¾ˆå¤šé‡å¤ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶æŠ½å–å‡ºæ¥ï¼Œç»„æˆä¸€ä¸ªsqlç‰‡æ®µï¼Œå…¶ä»–çš„statementå°±å¯ä»¥å¼•ç”¨è¿™ä¸ªsqlç‰‡æ®µï¼Œåˆ©äºç³»ç»Ÿçš„å¼€å‘ã€‚ è¿™é‡Œæˆ‘ä»¬å°±æ‹¿ä¸Šè¾¹sql ä¸­çš„whereå®šä¹‰ä¸€ä¸ªsqç‰‡æ®µå¦‚ä¸‹ï¼š 123456789101112131415&lt;!--sqlç‰‡æ®µ id:å”¯ä¸€æ ‡è¯† ç»éªŒï¼šæ˜¯åŸºäºå•è¡¨æ¥å®šä¹‰sqlç‰‡æ®µï¼Œè¿™æ ·çš„è¯sqlç‰‡æ®µçš„å¯é‡ç”¨æ€§æ‰é«˜ ä¸€èˆ¬ä¸åŒ…å«where --&gt; &lt;sql id=\"query_user_where\"&gt; &lt;if test=\"userCustom != null\"&gt; &lt;if test=\"userCustom.sex != null and userCustom.sex != ''\"&gt; and user.sex = #&#123;userCustom.sex&#125; &lt;/if&gt; &lt;if test=\"userCustom.username != null\"&gt; and user.username like '%$&#123;userCustom.username&#125;%' &lt;/if&gt; &lt;/if&gt; &lt;/sql&gt; é‚£ä¹ˆæˆ‘ä»¬è¯¥æ€æ ·å¼•ç”¨è¿™ä¸ªsqlç‰‡æ®µå‘¢ï¼Ÿå¦‚ä¸‹ï¼š 12345select * from user &lt;where&gt; &lt;!--refid: æŒ‡å®šsqlç‰‡æ®µçš„idï¼Œå¦‚æœæ˜¯å†™åœ¨å…¶ä»–çš„mapperæ–‡ä»¶ä¸­ï¼Œåˆ™éœ€è¦åœ¨å‰é¢åŠ ä¸Šnamespace--&gt; &lt;include refid=\"query_user_where\"/&gt; &lt;/where&gt; æµ‹è¯•çš„è¯è¿˜æ˜¯é‚£æ ·äº†ï¼Œå°±ä¸ç»§ç»­è¯´äº†ï¼Œå‰é¢å·²ç»è¯´äº†å¾ˆå¤šäº†ã€‚ foreachå‘sqlä¼ é€’æ•°ç»„æˆ–Listï¼Œmybatisä½¿ç”¨foreachè§£æ éœ€æ±‚ï¼š åœ¨ç”¨æˆ·æŸ¥è¯¢åˆ—è¡¨å’ŒæŸ¥è¯¢æ€»æ•°çš„statementä¸­å¢åŠ å¤šä¸ªidè¾“å…¥æŸ¥è¯¢ã€‚ sqlè¯­å¥å¦‚ä¸‹ï¼š 123SELECT * FROM USER WHERE id=1 OR id=10 ORid=16æˆ–è€…SELECT * FROM USER WHERE id IN(1,10,16) åœ¨è¾“å…¥å‚æ•°ç±»å‹ä¸­æ·»åŠ  List ids ä¼ å…¥å¤šä¸ª id 12345public class UserQueryVo //ç”¨æˆ·åŒ…è£…ç±»å‹&#123; //ä¼ å…¥å¤šä¸ªid private List&lt;Integer&gt; ids;&#125; ä¿®æ”¹ UserMapper.xmlæ–‡ä»¶ WHERE id=1 OR id=10 OR id=16 åœ¨æŸ¥è¯¢æ¡ä»¶ä¸­ï¼ŒæŸ¥è¯¢æ¡ä»¶å®šä¹‰æˆä¸€ä¸ªsqlç‰‡æ®µï¼Œéœ€è¦ä¿®æ”¹sqlç‰‡æ®µã€‚ 12345678910111213141516171819202122&lt;if test=\"ids!=null\"&gt; &lt;!-- ä½¿ç”¨ foreachéå†ä¼ å…¥ids collectionï¼šæŒ‡å®šè¾“å…¥ å¯¹è±¡ä¸­é›†åˆå±æ€§ itemï¼šæ¯ä¸ªéå†ç”Ÿæˆå¯¹è±¡ä¸­ openï¼šå¼€å§‹éå†æ—¶æ‹¼æ¥çš„ä¸² closeï¼šç»“æŸéå†æ—¶æ‹¼æ¥çš„ä¸² separatorï¼šéå†çš„ä¸¤ä¸ªå¯¹è±¡ä¸­éœ€è¦æ‹¼æ¥çš„ä¸² --&gt; &lt;!-- ä½¿ç”¨å®ç°ä¸‹è¾¹çš„sqlæ‹¼æ¥ï¼š AND (id=1 OR id=10 OR id=16) --&gt; &lt;foreach collection=\"ids\" item=\"user_id\" open=\"AND (\" close=\")\" separator=\"or\"&gt; &lt;!-- æ¯ä¸ªéå†éœ€è¦æ‹¼æ¥çš„ä¸² --&gt; id=#&#123;user_id&#125; &lt;/foreach&gt; &lt;!-- å®ç° â€œ and id IN(1,10,16)â€æ‹¼æ¥ --&gt; &lt;!-- &lt;foreach collection=\"ids\" item=\"user_id\" open=\"and id IN(\" close=\")\" separator=\",\"&gt; æ¯ä¸ªéå†éœ€è¦æ‹¼æ¥çš„ä¸² #&#123;user_id&#125; &lt;/foreach&gt; --&gt; &lt;/if&gt; æµ‹è¯•ä»£ç ï¼š 1234567 //ä¼ å…¥å¤šä¸ªidList&lt;Integer&gt; ids = new ArrayList&lt;&gt;();ids.add(1);ids.add(10);ids.add(16);//å°†idsä¼ å…¥statementä¸­userQueryVo.setIds(ids); æœŸå¾…åç»­çš„æ–‡ç« å§ï¼","tags":[{"name":"Mybatis","slug":"Mybatis","permalink":"http://www.54tianzhisheng.cn/tags/Mybatis/"},{"name":"SpringMVC","slug":"SpringMVC","permalink":"http://www.54tianzhisheng.cn/tags/SpringMVC/"}]},{"title":"ã€ŠJava å¤šçº¿ç¨‹ç¼–ç¨‹æ ¸å¿ƒæŠ€æœ¯ã€‹å­¦ä¹ ç¬”è®°åŠæ€»ç»“","date":"2017-06-12T16:00:00.000Z","path":"2017/06/13/Java-Thread/","text":"ç¬¬ä¸€ç«  â€”â€” Java å¤šçº¿ç¨‹æŠ€èƒ½çº¿ç¨‹æŠ€æœ¯ç‚¹ï¼š çº¿ç¨‹çš„å¯åŠ¨ å¦‚ä½•ä½¿çº¿ç¨‹æš‚åœ å¦‚ä½•ä½¿çº¿ç¨‹åœæ­¢ çº¿ç¨‹çš„ä¼˜å…ˆçº§ çº¿ç¨‹å®‰å…¨ç›¸å…³é—®é¢˜ è¿›ç¨‹å’Œçº¿ç¨‹çš„æ¦‚å¿µåŠå¤šçº¿ç¨‹çš„ä¼˜ç‚¹è¿›ç¨‹ï¼šæ¯”å¦‚æˆ‘ä»¬ç”µè„‘è¿è¡Œçš„ QQ.exe ç¨‹åºï¼Œæ˜¯æ“ä½œç³»ç»Ÿç®¡ç†çš„åŸºæœ¬è¿è¡Œå•å…ƒ çº¿ç¨‹ï¼šåœ¨è¿›ç¨‹ä¸­ç‹¬ç«‹è¿è¡Œçš„å­ä»»åŠ¡ï¼Œæ¯”å¦‚ QQ.exe è¿›ç¨‹ä¸­å°±æœ‰å¾ˆå¤šçº¿ç¨‹åœ¨è¿è¡Œï¼Œä¸‹è½½æ–‡ä»¶çº¿ç¨‹ã€å‘é€æ¶ˆæ¯çº¿ç¨‹ã€è¯­éŸ³çº¿ç¨‹ã€è§†é¢‘çº¿ç¨‹ç­‰ã€‚ å¤šçº¿ç¨‹ä¼˜ç‚¹ï¼šæˆ‘ä»¬ç”µè„‘å¯ä»¥åŒæ—¶æ“ä½œä¸åŒçš„è½¯ä»¶ï¼Œè¾¹å¬ç€æ­Œï¼Œæ•²ç€ä»£ç ï¼ŒæŸ¥çœ‹ pdf æ–‡æ¡£ï¼Œæµè§ˆç½‘é¡µç­‰ï¼ŒCPU åœ¨è¿™äº›ä»»åŠ¡ä¹‹é—´ä¸åœçš„åˆ‡æ¢ï¼Œåˆ‡æ¢éå¸¸å¿«ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±è§‰å¾—ä»–ä»¬æ˜¯åœ¨åŒæ—¶è¿è¡Œçš„ã€‚ ä½¿ç”¨å¤šçº¿ç¨‹ç»§æ‰¿ Thread ç±»JDK æºç æ³¨é‡Šï¼ˆThread.javaï¼‰å¦‚ä¸‹ï¼š 12345678910111213141516171819One is to declare a class to be a subclass(å­ç±») of &lt;code&gt;Thread&lt;/code&gt;. This subclass should override the &lt;code&gt;run&lt;/code&gt; method of class &lt;code&gt;Thread&lt;/code&gt;. An instance of the subclass can then be allocated and started. For example, a thread that computes primeslarger than a stated value could be written as follows://ç»§æ‰¿ Thread ç±»class PrimeThread extends Thread &#123; long minPrime; PrimeThread(long minPrime) &#123; this.minPrime = minPrime; &#125; public void run() &#123; // compute primes larger than minPrime é‡å†™ Thread ç±»çš„ run æ–¹æ³• &#125; &#125;The following code would then create a thread and start it running://å¼€å¯çº¿ç¨‹ PrimeThread p = new PrimeThread(143); p.start(); å®ç° Runnable æ¥å£JDK æºç æ³¨é‡Šï¼ˆThread.javaï¼‰å¦‚ä¸‹ï¼š 12345678910111213141516171819The other way to create a thread is to declare a class that implements the &lt;code&gt;Runnable&lt;/code&gt; interface. That class then implements the &lt;code&gt;run&lt;/code&gt; method. An instance of the class can then be allocated, passed as an argument when creating&lt;code&gt;Thread&lt;/code&gt;, and started. The same example in this other style looks like the following://å®ç° Runnable æ¥å£ class PrimeRun implements Runnable &#123; long minPrime; PrimeRun(long minPrime) &#123; this.minPrime = minPrime; &#125; public void run() &#123; // compute primes larger than minPrime //é‡å†™ run æ–¹æ³• &#125; &#125;The following code would then create a thread and start it running://å¼€å¯çº¿ç¨‹ PrimeRun p = new PrimeRun(143); new Thread(p).start(); currentThread() æ–¹æ³•è¯¥æ–¹æ³•è¿”å›ä»£ç æ®µæ­£åœ¨è¢«å“ªä¸ªçº¿ç¨‹è°ƒç”¨çš„ä¿¡æ¯ã€‚ isAlive() æ–¹æ³•åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦å¤„äºæ´»åŠ¨çŠ¶æ€ï¼ˆå·²ç»å¯åŠ¨ä½†æœªç»ˆæ­¢ï¼‰ sleep() æ–¹æ³•åœ¨æŒ‡å®šçš„æ¯«ç§’æ•°å†…è®©å½“å‰â€œæ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ï¼ˆthis.currentThread() è¿”å›çš„çº¿ç¨‹ï¼‰â€ä¼‘çœ ï¼ˆæš‚åœæ‰§è¡Œï¼‰ã€‚ getId() æ–¹æ³•è·å–çº¿ç¨‹çš„å”¯ä¸€æ ‡è¯† åœæ­¢çº¿ç¨‹å¯ä»¥ä½¿ç”¨ Thread.stop() æ–¹æ³•ï¼Œä½†æœ€å¥½ä¸è¦ç”¨ï¼Œå› ä¸ºè¿™ä¸ªæ–¹æ³•æ˜¯ä¸å®‰å…¨çš„ï¼Œå·²ç»å¼ƒç”¨ä½œåºŸäº†ã€‚ å¤§å¤šæ•°åœæ­¢ä¸€ä¸ªçº¿ç¨‹æ˜¯ä½¿ç”¨ Thread.interrupt() æ–¹æ³• åˆ¤æ–­çº¿ç¨‹æ˜¯å¦æ˜¯åœæ­¢çŠ¶æ€ interrupted() 12345//æµ‹è¯•å½“å‰çº¿ç¨‹æ˜¯å¦å·²ç»ä¸­æ–­äº†ï¼Œè¿™ä¸ªçº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ä¼šè¢«è¿™ä¸ªæ–¹æ³•æ¸…é™¤ã€‚//æ¢å¥è¯è¯´ï¼Œå¦‚æœè¿ç»­ä¸¤æ¬¡è°ƒç”¨äº†è¿™ä¸ªæ–¹æ³•ï¼Œç¬¬äºŒæ¬¡è°ƒç”¨çš„æ—¶å€™å°†ä¼šè¿”å› false ï¼Œpublic static boolean interrupted() &#123; return currentThread().isInterrupted(true);&#125; isInterrupted() 1234567891011 //æµ‹è¯•çº¿ç¨‹æ˜¯å¦å·²ç»ä¸­æ–­äº†ï¼Œçº¿ç¨‹çš„çŠ¶æ€ä¸ä¼šå—è¿™ä¸ªæ–¹æ³•çš„å½±å“ //çº¿ç¨‹ä¸­æ–­è¢«å¿½ç•¥ï¼Œå› ä¸ºçº¿ç¨‹å¤„äºä¸­æ–­ä¸‹ä¸å¤„äºæ´»åŠ¨çŠ¶æ€çš„çº¿ç¨‹ç”±æ­¤è¿”å›falseçš„æ–¹æ³•åæ˜ å‡ºæ¥ public boolean isInterrupted() &#123; return isInterrupted(false); &#125; /*** Tests if some Thread has been interrupted. The interrupted state* is reset or not based on the value of ClearInterrupted that is* passed.*/private native boolean isInterrupted(boolean ClearInterrupted); åœ¨æ²‰ç¡ä¸­åœæ­¢1234567891011121314151617181920212223242526public class MyThread2 extends Thread&#123; @Override public void run() &#123; try &#123; System.out.println(\"run start\"); Thread.sleep(20000); System.out.println(\"run end\"); &#125; catch (InterruptedException e) &#123; System.out.println(\"run catch \"+this.isInterrupted()); e.printStackTrace(); &#125; &#125; public static void main(String[] args) &#123; try &#123; MyThread2 t2 = new MyThread2(); t2.start(); Thread.sleep(200); t2.interrupt(); &#125; catch (InterruptedException e) &#123; System.out.println(\"main catch\"); e.printStackTrace(); &#125; System.out.println(\"main end\"); &#125;&#125; è¿è¡Œç»“æœï¼š 123456run startmain endrun catch falsejava.lang.InterruptedException: sleep interrupted at java.lang.Thread.sleep(Native Method) at com.zhisheng.thread.thread1.MyThread2.run(MyThread2.java:12) ä»è¿è¡Œç»“æœæ¥çœ‹ï¼Œå¦‚æœåœ¨ sleep çŠ¶æ€ä¸‹åœæ­¢æŸä¸€çº¿ç¨‹ï¼Œä¼šè¿›å…¥ catch è¯­å¥ï¼Œå¹¶æ¸…é™¤åœæ­¢çŠ¶æ€å€¼ï¼Œä½¿ä¹‹å˜æˆ falseã€‚ åœ¨åœæ­¢ä¸­æ²‰ç¡12345678910111213141516171819public class MyThread3 extends Thread&#123; @Override public void run() &#123; try &#123; System.out.println(\"run start\"); Thread.sleep(20000); System.out.println(\"run end\"); &#125; catch (InterruptedException e) &#123; System.out.println(\"run catch \"+this.isInterrupted()); e.printStackTrace(); &#125; &#125; public static void main(String[] args) &#123; MyThread3 t3 = new MyThread3(); t3.start(); t3.interrupt(); &#125;&#125; è¿è¡Œç»“æœï¼š 12345run startrun catch falsejava.lang.InterruptedException: sleep interrupted at java.lang.Thread.sleep(Native Method) at com.zhisheng.thread.thread1.MyThread3.run(MyThread3.java:12) èƒ½åœæ­¢çš„çº¿ç¨‹ â€”â€” æš´åŠ›åœæ­¢ä½¿ç”¨ stop() æ–¹æ³•åœæ­¢çº¿ç¨‹ æš‚åœçº¿ç¨‹å¯ä½¿ç”¨ suspend æ–¹æ³•æš‚åœçº¿ç¨‹ï¼Œä½¿ç”¨ resume() æ–¹æ³•æ¢å¤çº¿ç¨‹çš„æ‰§è¡Œã€‚ suspend å’Œ resume æ–¹æ³•çš„ä½¿ç”¨1234567891011121314151617181920212223242526272829public class MyThread4 extends Thread&#123; private int i; public int getI() &#123; return i; &#125; public void setI(int i) &#123; this.i = i; &#125; @Override public void run() &#123; while (true) &#123; i++; &#125; &#125; public static void main(String[] args) throws InterruptedException &#123; MyThread4 t4 = new MyThread4(); t4.start(); System.out.println(\"A----- \" + System.currentTimeMillis() + \" ---- \" + t4.getI()); Thread.sleep(2000); System.out.println(\"A----- \" + System.currentTimeMillis() + \" ---- \" + t4.getI()); t4.suspend(); Thread.sleep(2000); t4.resume(); System.out.println(\"B----- \" + System.currentTimeMillis() + \" ---- \" + t4.getI()); Thread.sleep(2000); System.out.println(\"B----- \" + System.currentTimeMillis() + \" ---- \" + t4.getI()); &#125;&#125; ä»è¿è¡Œç»“æœæ¥çœ‹ï¼Œçº¿ç¨‹çš„ç¡®èƒ½å¤Ÿæš‚åœå’Œæ¢å¤ã€‚ ä½†æ˜¯ suspend å’Œ resume æ–¹æ³•çš„ç¼ºç‚¹å°±æ˜¯ï¼šä¸åŒæ­¥ï¼Œå› ä¸ºçº¿ç¨‹çš„æš‚åœå¯¼è‡´æ•°æ®çš„ä¸åŒæ­¥ã€‚ yield æ–¹æ³•123456789101112131415161718/** * A hint to the scheduler that the current thread is willing to yield * its current use of a processor. The scheduler is free to ignore this * hint. * * &lt;p&gt; Yield is a heuristic attempt to improve relative progression * between threads that would otherwise over-utilise a CPU. Its use * should be combined with detailed profiling and benchmarking to * ensure that it actually has the desired effect. * * &lt;p&gt; It is rarely appropriate to use this method. It may be useful * for debugging or testing purposes, where it may help to reproduce * bugs due to race conditions. It may also be useful when designing * concurrency control constructs such as the ones in the * &#123;@link java.util.concurrent.locks&#125; package. */ //æš‚åœå½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹å¯¹è±¡ï¼Œå¹¶æ‰§è¡Œå…¶ä»–çº¿ç¨‹ã€‚æš‚åœçš„æ—¶é—´ä¸ç¡®å®šã€‚ public static native void yield(); 1234567891011121314151617public class MyThread5 extends Thread&#123; @Override public void run() &#123; double start = System.currentTimeMillis(); for (int i = 0; i &lt; 200000; i++) &#123; //yield();//æš‚åœçš„æ—¶é—´ä¸ç¡®å®š i++; &#125; double end = System.currentTimeMillis(); System.out.println(\"time is \"+(end - start)); &#125; public static void main(String[] args) &#123; MyThread5 t5 = new MyThread5(); t5.start(); &#125;&#125; çº¿ç¨‹çš„ä¼˜å…ˆçº§è®¾ç½®ä¼˜å…ˆçº§çš„æ–¹æ³•ï¼šsetPriority() æ–¹æ³• 12345678910111213public final void setPriority(int newPriority) &#123; ThreadGroup g; checkAccess(); if (newPriority &gt; MAX_PRIORITY || newPriority &lt; MIN_PRIORITY) &#123; throw new IllegalArgumentException(); &#125; if((g = getThreadGroup()) != null) &#123; if (newPriority &gt; g.getMaxPriority()) &#123; newPriority = g.getMaxPriority(); &#125; setPriority0(priority = newPriority); &#125; &#125; ä¸ä¸€å®šä¼˜å…ˆçº§é«˜çš„çº¿ç¨‹å°±å…ˆæ‰§è¡Œã€‚ å®ˆæŠ¤çº¿ç¨‹å½“è¿›ç¨‹ä¸­ä¸å­˜åœ¨éå®ˆæŠ¤çº¿ç¨‹äº†ï¼Œåˆ™å®ˆæŠ¤çº¿ç¨‹è‡ªåŠ¨é”€æ¯ã€‚åƒåœ¾å›æ”¶çº¿ç¨‹å°±æ˜¯å…¸å‹çš„å®ˆæŠ¤çº¿ç¨‹ï¼Œå½“è¿›ç¨‹ä¸­æ²¡æœ‰éå®ˆæŠ¤çº¿ç¨‹äº†ï¼Œåˆ™åƒåœ¾å›æ”¶çº¿ç¨‹ä¹Ÿå°±æ²¡æœ‰å­˜åœ¨çš„å¿…è¦äº†ï¼Œè‡ªåŠ¨é”€æ¯ã€‚ 12345678910111213141516171819202122/** * Marks this thread as either a &#123;@linkplain #isDaemon daemon&#125; thread * or a user thread. The Java Virtual Machine exits when the only * threads running are all daemon threads. * * &lt;p&gt; This method must be invoked before the thread is started. * * @param on * if &#123;@code true&#125;, marks this thread as a daemon thread * @throws IllegalThreadStateException * if this thread is &#123;@linkplain #isAlive alive&#125; * @throws SecurityException * if &#123;@link #checkAccess&#125; determines that the current * thread cannot modify this thread */ public final void setDaemon(boolean on) &#123; checkAccess(); if (isAlive()) &#123; throw new IllegalThreadStateException(); &#125; daemon = on; &#125; ç¬¬äºŒç«  â€”â€” å¯¹è±¡åŠå˜é‡çš„å¹¶å‘è®¿é—®æŠ€æœ¯ç‚¹ï¼š synchronized å¯¹è±¡ç›‘è§†å™¨ä¸º Object æ—¶çš„ä½¿ç”¨ synchronized å¯¹è±¡ç›‘è§†å™¨ä¸º Class æ—¶çš„ä½¿ç”¨ éçº¿ç¨‹å®‰å…¨æ˜¯å¦‚ä½•å‡ºç°çš„ å…³é”®å­— volatile çš„ä¸»è¦ä½œç”¨ å…³é”®å­— volatile ä¸ synchronized çš„åŒºåˆ«åŠä½¿ç”¨æƒ…å†µ synchronized åŒæ­¥æ–¹æ³•æ–¹æ³•å†…çš„å˜é‡ä¸ºçº¿ç¨‹å®‰å…¨â€œéçº¿ç¨‹å®‰å…¨â€é—®é¢˜å­˜åœ¨äºâ€œå®ä¾‹å˜é‡â€ä¸­ï¼Œå¦‚æœæ˜¯æ–¹æ³•å†…éƒ¨çš„ç§æœ‰å˜é‡ï¼Œåˆ™ä¸å­˜åœ¨â€œéçº¿ç¨‹å®‰å…¨â€é—®é¢˜ï¼Œæ‰€å¾—ç»“æœä¹Ÿå°±æ˜¯â€œçº¿ç¨‹å®‰å…¨â€äº†ã€‚ å®ä¾‹å˜é‡éçº¿ç¨‹å®‰å…¨å¦‚æœå¤šçº¿ç¨‹å…±åŒè®¿é—®ä¸€ä¸ªå¯¹è±¡ä¸­çš„å®ä¾‹å˜é‡ï¼Œåˆ™æœ‰å¯èƒ½å‡ºç°â€œéçº¿ç¨‹å®‰å…¨â€é—®é¢˜ã€‚ åœ¨ä¸¤ä¸ªçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªå¯¹è±¡ä¸­çš„åŒæ­¥æ–¹æ³•æ—¶ä¸€å®šæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ è„è¯»å‘ç”Ÿè„è¯»çš„æƒ…å†µæ˜¯åœ¨è¯»å–å®ä¾‹å˜é‡æ—¶ï¼Œæ­¤å€¼å·²ç»è¢«å…¶ä»–çº¿ç¨‹æ›´æ”¹è¿‡äº†ã€‚ å¦‚ä¸‹ä¾‹å­å°±å¯ä»¥è¯´æ˜ï¼Œå¦‚æœä¸åŠ  synchronized å…³é”®å­—åœ¨ setValue å’Œ getValue æ–¹æ³•ä¸Šï¼Œå°±ä¼šå‡ºç°æ•°æ®è„è¯»ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142class VarName&#123; private String userName = \"A\"; private String password = \"AA\"; synchronized public void setValue(String userName, String password) &#123; try &#123; this.userName = userName; Thread.sleep(500); this.password = password; System.out.println(\"setValue method Thread name is : \" + Thread.currentThread().getName() + \" userName = \" + userName + \" password = \" + password); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; //synchronized public void getValue() &#123; System.out.println(\"getValue method Thread name is : \" + Thread.currentThread().getName() + \" userName = \" + userName + \" password = \" + password); &#125;&#125;class Thread1 extends Thread&#123; private VarName varName; public Thread1(VarName varName) &#123; this.varName = varName; &#125; @Override public void run() &#123; varName.setValue(\"B\", \"BB\"); &#125;&#125;public class Test&#123; public static void main(String[] args) throws InterruptedException &#123; VarName v = new VarName(); Thread1 thread1 = new Thread1(v); thread1.start(); Thread.sleep(200);//æ‰“å°ç»“æœå—ç¡çœ æ—¶é—´çš„å½±å“ v.getValue(); &#125;&#125; synchronized é”é‡å…¥å…³é”®å­— synchronized æ‹¥æœ‰é”é‡å…¥çš„åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯åœ¨ä½¿ç”¨ synchronized æ—¶ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹å¾—åˆ°ä¸€ä¸ªå¯¹è±¡é”åï¼Œå†æ¬¡è¯·æ±‚æ­¤å¯¹è±¡é”æ˜¯å¯ä»¥å†æ¬¡å¾—åˆ°è¯¥å¯¹è±¡çš„é”çš„ã€‚è¿™ä¹Ÿè¯æ˜äº†åœ¨ä¸€ä¸ª synchronized æ–¹æ³•/å—çš„å†…éƒ¨è°ƒç”¨æœ¬ç±»çš„å…¶ä»– synchronized æ–¹æ³•/å—æ—¶ï¼Œæ˜¯æ°¸è¿œå¯ä»¥å¾—åˆ°é”çš„ã€‚ 12345678910111213141516171819202122232425262728293031class Service&#123; synchronized public void service1() &#123; System.out.println(\"service 1\"); service2(); &#125; synchronized public void service2() &#123; System.out.println(\"service 2\"); service3(); &#125; synchronized public void service3() &#123; System.out.println(\"service 3\"); &#125;&#125;class Thread2 extends Thread&#123; @Override public void run() &#123; Service s = new Service(); s.service1(); &#125;&#125;public class Test2&#123; public static void main(String[] args) &#123; Thread2 t2 = new Thread2(); t2.start(); &#125;&#125; è¿è¡Œç»“æœï¼š 123service 1service 2service 3 åŒæ­¥ä¸å…·æœ‰ç»§æ‰¿æ€§åŒæ­¥ä¸å¯ä»¥ç»§æ‰¿ã€‚ synchronized åŒæ­¥è¯­å¥å—synchronized ä»£ç å—é—´çš„åŒæ­¥æ€§å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—® object çš„ä¸€ä¸ª synchronized(this) åŒæ­¥ä»£ç å—æ—¶ï¼Œå…¶ä»–çº¿ç¨‹å¯¹åŒä¸€ä¸ª object ä¸­æ‰€æœ‰å…¶ä»– synchronized(this) åŒæ­¥ä»£ç å—çš„è®¿é—®å°†è¢«é˜»å¡ï¼Œè¿™è¯´æ˜ synchronized ä½¿ç”¨çš„ â€œå¯¹è±¡ç›‘è§†å™¨â€ æ˜¯ä¸€ä¸ªã€‚ å°†ä»»æ„å¯¹è±¡ä½œä¸ºå¯¹è±¡ç›‘è§†å™¨å¤šä¸ªçº¿ç¨‹è°ƒç”¨åŒä¸€ä¸ªå¯¹è±¡ä¸­çš„ä¸åŒåç§°çš„ synchronized åŒæ­¥æ–¹æ³•æˆ–è€… synchronized(this) åŒæ­¥ä»£ç å—æ—¶ï¼Œè°ƒç”¨çš„æ•ˆæœå°±æ˜¯æŒ‰é¡ºåºæ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯åŒæ­¥çš„ï¼Œé˜»å¡çš„ã€‚ é™æ€åŒæ­¥ synchronized æ–¹æ³•ä¸ synchronized(class) ä»£ç å—å…³é”®å­— synchronized è¿˜å¯ä»¥åº”ç”¨åœ¨ static é™æ€æ–¹æ³•ä¸Šï¼Œå¦‚æœè¿™æ ·å†™å°±æ˜¯å¯¹å½“å‰çš„ *.java æ–‡ä»¶å¯¹åº”çš„ Class ç±»è¿›è¡ŒåŠ é”ã€‚è€Œ synchronized å…³é”®å­—åŠ åˆ°é static é™æ€æ–¹æ³•ä¸Šå°±æ˜¯ç»™å¯¹è±¡åŠ é”ã€‚ å¤šçº¿ç¨‹çš„æ­»é”volatile å…³é”®å­—ä½œç”¨ï¼šä½¿å˜é‡åœ¨å¤šä¸ªçº¿ç¨‹é—´å¯è§ã€‚ é€šè¿‡ä½¿ç”¨ volatile å…³é”®å­—ï¼Œå¼ºåˆ¶çš„ä»å…¬å…±å†…å­˜ä¸­è¯»å–å˜é‡çš„å€¼ã€‚ä½¿ç”¨ volatile å…³é”®å­—å¢åŠ äº†å®ä¾‹å˜é‡åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´çš„å¯è§æ€§ï¼Œä½† volatile å…³é”®å­—æœ€è‡´å‘½çš„ç¼ºç‚¹å°±æ˜¯ä¸æ”¯æŒåŸå­æ€§ã€‚ å…³é”®å­— synchronized å’Œ volatile æ¯”è¾ƒï¼š å…³é”®å­— volatile æ˜¯çº¿ç¨‹åŒæ­¥çš„è½»é‡å®ç°ï¼Œæ‰€ä»¥ volatile æ€§èƒ½è‚¯å®šè¦æ¯” synchronized è¦å¥½ï¼Œå¹¶ä¸” volatile åªèƒ½ä¿®é¥°äºå˜é‡ï¼Œè€Œ synchronized å¯ä»¥ä¿®é¥°æ–¹æ³•ï¼Œä»¥åŠä»£ç å—ã€‚ å¤šçº¿ç¨‹è®¿é—® volatile ä¸ä¼šå‘ç”Ÿé˜»å¡ï¼Œè€Œ synchronized ä¼šå‡ºç°é˜»å¡ã€‚ volatile èƒ½ä¿è¯æ•°æ®çš„å¯è§æ€§ï¼Œä½†ä¸èƒ½ä¿è¯åŸå­æ€§ï¼›è€Œ synchronized å¯ä»¥ä¿è¯åŸå­æ€§ï¼Œä¹Ÿå¯ä»¥é—´æ¥ä¿è¯å¯è§æ€§ï¼Œå› ä¸ºå®ƒä¼šå°†ç§æœ‰å†…å­˜å’Œå…¬æœ‰å†…å­˜ä¸­çš„æ•°æ®åšåŒæ­¥ã€‚ å…³é”®å­— volatile è§£å†³çš„æ˜¯å˜é‡åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´çš„å¯è§æ€§ï¼›è€Œ synchronized å…³é”®å­—è§£å†³çš„æ˜¯å¤šä¸ªçº¿ç¨‹ä¹‹é—´è®¿é—®èµ„æºçš„åŒæ­¥æ€§ã€‚ â€‹ ç¬¬ä¸‰ç«  â€”â€” çº¿ç¨‹é—´é€šä¿¡æŠ€æœ¯ç‚¹ï¼š ä½¿ç”¨ wait/notify å®ç°çº¿ç¨‹é—´çš„é€šä¿¡ ç”Ÿäº§è€…/æ¶ˆè´¹è€…æ¨¡å¼çš„å®ç° æ–¹æ³• join çš„ä½¿ç”¨ ThreadLocal ç±»çš„ä½¿ç”¨ ç­‰å¾…/é€šçŸ¥æœºåˆ¶wait ä½¿çº¿ç¨‹åœæ­¢è¿è¡Œï¼Œnotify ä½¿åœæ­¢çš„çº¿ç¨‹ç»§ç»­è¿è¡Œã€‚ å…³é”®å­— synchronized å¯ä»¥å°†ä»»ä½•ä¸€ä¸ª Object å¯¹è±¡ä½œä¸ºåŒæ­¥å¯¹è±¡çœ‹å¾…ï¼Œè€Œ Java ä¸ºæ¯ä¸ª Object éƒ½å®ç°äº† wait() å’Œ notify() æ–¹æ³•ï¼Œä»–ä»¬å¿…é¡»ç”¨åœ¨è¢« synchronized åŒæ­¥çš„ Object çš„ä¸´ç•ŒåŒºå†…ã€‚é€šè¿‡è°ƒç”¨ wait æ–¹æ³•å¯ä»¥ä½¿å¤„äºä¸´ç•ŒåŒºå†…çš„çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼ŒåŒæ—¶é‡Šæ”¾è¢«åŒæ­¥å¯¹è±¡çš„é”ã€‚è€Œ notify æ“ä½œå¯ä»¥å”¤é†’ä¸€ä¸ªå› è°ƒç”¨äº† wait æ–¹æ³•è€Œå¤„äºé˜»å¡çŠ¶æ€çš„çº¿ç¨‹ï¼Œä½¿å…¶è¿›å…¥å°±ç»ªçŠ¶æ€ã€‚è¢«é‡æ–°å”¤é†’çš„çº¿ç¨‹ä¼šè¯•å›¾é‡æ–°è·å¾—ä¸´ç•ŒåŒºçš„æ§åˆ¶æƒï¼Œç»§ç»­æ‰§è¡Œä¸´ç•ŒåŒºå†… wait ä¹‹åçš„ä»£ç ã€‚ wait æ–¹æ³•å¯ä»¥ä½¿è°ƒç”¨è¯¥æ–¹æ³•çš„çº¿ç¨‹é‡Šæ”¾å…±äº«èµ„æºçš„é”ï¼Œä»è¿è¡ŒçŠ¶æ€é€€å‡ºï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°å†æ¬¡è¢«å”¤é†’ã€‚ notify() æ–¹æ³•å¯ä»¥éšæœºå”¤é†’ç­‰å¾…å¯¹åˆ—ä¸­ç­‰å¾…åŒä¸€å…±äº«èµ„æºçš„ä¸€ä¸ªçº¿ç¨‹ï¼Œå¹¶ä½¿è¯¥çº¿ç¨‹é€€å‡ºç­‰å¾…çŠ¶æ€ï¼Œè¿›å…¥å¯è¿è¡ŒçŠ¶æ€ã€‚ notifyAll() æ–¹æ³•å¯ä»¥éšæœºå”¤é†’ç­‰å¾…å¯¹åˆ—ä¸­ç­‰å¾…åŒä¸€å…±äº«èµ„æºçš„æ‰€æœ‰çº¿ç¨‹ï¼Œå¹¶ä½¿è¿™äº›çº¿ç¨‹é€€å‡ºç­‰å¾…çŠ¶æ€ï¼Œè¿›å…¥å¯è¿è¡ŒçŠ¶æ€ã€‚ çº¿ç¨‹çŠ¶æ€ç¤ºæ„å›¾ï¼š æ–°åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å¯¹è±¡åï¼Œåœ¨è°ƒç”¨å®ƒçš„ start() æ–¹æ³•ï¼Œç³»ç»Ÿä¼šä¸ºæ­¤çº¿ç¨‹åˆ†é… CPU èµ„æºï¼Œä½¿å…¶å¤„äº Runnableï¼ˆå¯è¿è¡Œï¼‰çŠ¶æ€ï¼Œå¦‚æœçº¿ç¨‹æŠ¢å åˆ° CPU èµ„æºï¼Œæ­¤çº¿ç¨‹å°±ä¼šå¤„äº Running ï¼ˆè¿è¡Œï¼‰çŠ¶æ€ Runnable å’Œ Running çŠ¶æ€ä¹‹é—´å¯ä»¥ç›¸äº’åˆ‡æ¢ï¼Œå› ä¸ºçº¿ç¨‹æœ‰å¯èƒ½è¿è¡Œä¸€æ®µæ—¶é—´åï¼Œæœ‰å…¶ä»–ä¼˜å…ˆçº§é«˜çš„çº¿ç¨‹æŠ¢å äº† CPU èµ„æºï¼Œæ­¤æ—¶çº¿ç¨‹å°±ä» Running çŠ¶æ€å˜æˆäº† Runnable çŠ¶æ€ã€‚ çº¿ç¨‹è¿›å…¥ Runnable çŠ¶æ€æœ‰å¦‚ä¸‹å‡ ç§æƒ…å†µï¼š è°ƒç”¨ sleep() æ–¹æ³•åç»è¿‡çš„æ—¶é—´è¶…è¿‡äº†æŒ‡å®šçš„ä¼‘çœ æ—¶é—´ çº¿ç¨‹è°ƒç”¨çš„é˜»å¡ IO å·²ç»è¿”å›ï¼Œé˜»å¡æ–¹æ³•æ‰§è¡Œå®Œæ¯• çº¿ç¨‹æˆåŠŸçš„è·å¾—äº†è¯•å›¾åŒæ­¥çš„ç›‘è§†å™¨ çº¿ç¨‹æ­£åœ¨ç­‰å¾…æŸä¸ªé€šçŸ¥ï¼Œå…¶ä»–çº¿ç¨‹å‘å‡ºäº†é€šçŸ¥ å¤„äºæŒ‚çŠ¶æ€çš„çº¿ç¨‹è°ƒç”¨äº† resume æ¢å¤æ–¹æ³• Blocked æ˜¯é˜»å¡çš„æ„æ€ï¼Œä¾‹å¦‚çº¿ç¨‹é‡åˆ°ä¸€ä¸ª IO æ“ä½œï¼Œæ­¤æ—¶ CPU å¤„äºç©ºé—²çŠ¶æ€ï¼Œå¯èƒ½ä¼šè½¬è€ŒæŠŠ CPU æ—¶é—´ç‰‡åˆ†é…ç»™å…¶ä»–çº¿ç¨‹ï¼Œè¿™æ—¶ä¹Ÿå¯ä»¥ç§°ä¸º â€œæš‚åœâ€çŠ¶æ€ã€‚Blocked çŠ¶æ€ç»“æŸä¹‹åï¼Œè¿›å…¥ Runnable çŠ¶æ€ï¼Œç­‰å¾…ç³»ç»Ÿé‡æ–°åˆ†é…èµ„æºã€‚ å‡ºç°é˜»å¡çŠ¶æ€çš„æœ‰å¦‚ä¸‹å‡ ç§æƒ…å†µï¼š çº¿ç¨‹è°ƒç”¨ sleep æ–¹æ³•ï¼Œä¸»åŠ¨æ”¾å¼ƒå ç”¨çš„å¤„ç†å™¨èµ„æº çº¿ç¨‹è°ƒç”¨äº†é˜»å¡å¼ IO æ–¹æ³•ï¼Œåœ¨è¯¥æ–¹æ³•è¿”å›ä¹‹å‰ï¼Œè¯¥çº¿ç¨‹è¢«é˜»å¡ çº¿ç¨‹è¯•å›¾è·å¾—ä¸€ä¸ªåŒæ­¥ç›‘è§†å™¨ï¼Œä½†è¯¥åŒæ­¥ç›‘è§†å™¨æ­£åœ¨è¢«å…¶ä»–çº¿ç¨‹æ‰€æŒæœ‰ çº¿ç¨‹ç­‰å¾…æŸä¸ªé€šçŸ¥ ç¨‹åºè°ƒç”¨äº† suspend æ–¹æ³•å°†è¯¥çº¿ç¨‹æŒ‚èµ· run æ–¹æ³•è¿è¡Œç»“æŸåè¿›å…¥é”€æ¯é˜¶æ®µï¼Œæ•´ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæ¯•ã€‚ ç”Ÿäº§è€…/æ¶ˆè´¹è€…æ¨¡å¼å®ç°ä¸€ä¸ªç”Ÿäº§è€…ï¼Œä¸€ä¸ªæ¶ˆè´¹è€… å­˜å‚¨å€¼å¯¹è±¡ï¼š 12345678910package com.zhisheng.thread.thread5;/** * Created by 10412 on 2017/6/3. * å­˜å‚¨å€¼å¯¹è±¡ */public class ValueObject&#123; public static String value = \"\";&#125; ç”Ÿäº§è€…ï¼š 123456789101112131415161718192021222324252627282930package com.zhisheng.thread.thread5;/** * Created by 10412 on 2017/6/3. * ç”Ÿäº§è€… */public class Product&#123; private String lock; public Product(String lock) &#123; this.lock = lock; &#125; public void setValue() &#123; synchronized (lock) &#123; if (!ValueObject.value.equals(\"\")) &#123; try &#123; lock.wait(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; String value = System.currentTimeMillis() + \"_\" + System.nanoTime(); System.out.println(\"ç”Ÿäº§è€… set çš„å€¼æ˜¯ï¼š\" + value); ValueObject.value = value; lock.notify(); &#125; &#125;&#125; æ¶ˆè´¹è€…ï¼š 1234567891011121314151617181920212223242526272829package com.zhisheng.thread.thread5;/** * Created by 10412 on 2017/6/3. * æ¶ˆè´¹è€… */public class Resume&#123; private String lock; public Resume(String lock) &#123; this.lock = lock; &#125; public void getValue() &#123; synchronized (lock) &#123; if (ValueObject.value.equals(\"\")) &#123; try &#123; lock.wait(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; System.out.println(\"æ¶ˆè´¹è€… get çš„å€¼ï¼š\" + ValueObject.value); ValueObject.value = \"\"; lock.notify(); &#125; &#125;&#125; ç”Ÿäº§è€…çº¿ç¨‹ï¼š 123456789101112131415161718192021package com.zhisheng.thread.thread5;/** * Created by 10412 on 2017/6/3. * ç”Ÿäº§è€…çº¿ç¨‹ */public class ProductThread extends Thread&#123; private Product p; public ProductThread(Product p) &#123; this.p = p; &#125; @Override public void run() &#123; while (true) &#123; p.setValue(); &#125; &#125;&#125; æ¶ˆè´¹è€…çº¿ç¨‹ï¼š 123456789101112131415161718192021package com.zhisheng.thread.thread5;/** * Created by 10412 on 2017/6/3. * æ¶ˆè´¹è€…çº¿ç¨‹ */public class ResumeThread extends Thread&#123; private Resume r; public ResumeThread(Resume r) &#123; this.r = r; &#125; @Override public void run() &#123; while (true) &#123; r.getValue(); &#125; &#125;&#125; ä¸»å‡½æ•°ï¼š 123456789101112131415161718package com.zhisheng.thread.thread5;/** * Created by 10412 on 2017/6/3. * ä¸€ä¸ªç”Ÿäº§è€…ä¸€ä¸ªæ¶ˆè´¹è€…æµ‹è¯• */public class Test&#123; public static void main(String[] args) &#123; String str = new String(\"\"); Product p = new Product(str); Resume r = new Resume(str);; ProductThread pt = new ProductThread(p); ResumeThread rt = new ResumeThread(r); pt.start(); rt.start(); &#125;&#125; é¢˜ç›®ï¼šåˆ›å»º20ä¸ªçº¿ç¨‹ï¼Œå…¶ä¸­10ä¸ªçº¿ç¨‹æ˜¯å°†æ•°æ®å¤‡ä»½åˆ°æ•°æ®åº“Aï¼Œå¦å¤–10ä¸ªçº¿ç¨‹å°†æ•°æ®å¤‡ä»½åˆ°æ•°æ®åº“Bä¸­å»ï¼Œå¹¶ä¸”å¤‡ä»½æ•°æ®åº“Aå’Œå¤‡ä»½æ•°æ®åº“Bæ˜¯äº¤å‰è¿›è¡Œçš„ã€‚ å·¥å…·ç±»ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142package com.zhisheng.thread.thread6;/** * Created by 10412 on 2017/6/3. * åˆ›å»º20ä¸ªçº¿ç¨‹ï¼Œå…¶ä¸­10ä¸ªçº¿ç¨‹æ˜¯å°†æ•°æ®å¤‡ä»½åˆ°æ•°æ®åº“Aï¼Œå¦å¤–10ä¸ªçº¿ç¨‹å°†æ•°æ®å¤‡ä»½åˆ°æ•°æ®åº“Bä¸­å»ï¼Œå¹¶ä¸” * å¤‡ä»½æ•°æ®åº“Aå’Œå¤‡ä»½æ•°æ®åº“Bæ˜¯äº¤å‰è¿›è¡Œçš„ */public class DBTools&#123; volatile private boolean prevIsA = false; //ç¡®ä¿Aå¤‡ä»½å…ˆè¿›è¡Œ synchronized public void backA() &#123; while (prevIsA == true) &#123; try &#123; wait(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; for (int i = 0; i &lt; 5; i++) &#123; System.out.println(\"AAAAA\"); &#125; prevIsA = true; notifyAll(); &#125; synchronized public void backB() &#123; while (prevIsA == false) &#123; try &#123; wait(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; for (int i = 0; i &lt; 5; i++) &#123; System.out.println(\"BBBBB\"); &#125; prevIsA = false; notifyAll(); &#125;&#125; å¤‡ä»½Aå…ˆçº¿ç¨‹ï¼š 123456789101112131415161718package com.zhisheng.thread.thread6;/** * Created by 10412 on 2017/6/3. */public class ThreadA extends Thread&#123; private DBTools dbTools; public ThreadA(DBTools dbTools) &#123; this.dbTools = dbTools; &#125; @Override public void run() &#123; dbTools.backA(); &#125;&#125; å¤‡ä»½Bçº¿ç¨‹ï¼š 123456789101112131415161718package com.zhisheng.thread.thread6;/** * Created by 10412 on 2017/6/3. */public class ThreadB extends Thread&#123; private DBTools dbTools; public ThreadB(DBTools dbTools) &#123; this.dbTools = dbTools; &#125; @Override public void run() &#123; dbTools.backB(); &#125;&#125; æµ‹è¯•ï¼š 1234567891011121314151617package com.zhisheng.thread.thread6;/** * Created by 10412 on 2017/6/3. */public class Test&#123; public static void main(String[] args) &#123; DBTools dbTools = new DBTools(); for (int i = 0; i &lt; 20; i++) &#123; ThreadB tb = new ThreadB(dbTools); tb.start(); ThreadA ta = new ThreadA(dbTools); ta.start(); &#125; &#125;&#125; Join æ–¹æ³•çš„ä½¿ç”¨ä½œç”¨ï¼šç­‰å¾…çº¿ç¨‹å¯¹è±¡é”€æ¯ join æ–¹æ³•å…·æœ‰ä½¿çº¿ç¨‹æ’é˜Ÿè¿è¡Œçš„ä½œç”¨ï¼Œæœ‰äº›ç±»ä¼¼åŒæ­¥çš„è¿è¡Œæ•ˆæœã€‚join ä¸ synchronized çš„åŒºåˆ«æ˜¯ï¼šjoin åœ¨å†…éƒ¨ä½¿ç”¨ wait() æ–¹æ³•è¿›è¡Œç­‰å¾…ï¼Œè€Œ synchronized å…³é”®å­—ä½¿ç”¨çš„æ˜¯ â€œå¯¹è±¡ç›‘è§†å™¨â€ åŸç†åšä¸ºåŒæ­¥ã€‚ åœ¨ join è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå½“å‰çº¿ç¨‹å¯¹è±¡è¢«ä¸­æ–­ï¼Œåˆ™å½“å‰çº¿ç¨‹å‡ºç°å¼‚å¸¸ã€‚ æ–¹æ³• join(long) ä¸­çš„å‚æ•°æ˜¯è®¾å®šç­‰å¾…çš„æ—¶é—´ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243/** * ç­‰å¾…è¯¥çº¿ç¨‹ç»ˆæ­¢çš„æ—¶é—´æœ€é•¿ä¸º millis æ¯«ç§’ã€‚è¶…æ—¶ä¸º 0 æ„å‘³ç€è¦ä¸€ç›´ç­‰ä¸‹å»ã€‚ * Waits at most &#123;@code millis&#125; milliseconds for this thread to * die. A timeout of &#123;@code 0&#125; means to wait forever. * * &lt;p&gt; This implementation uses a loop of &#123;@code this.wait&#125; calls * conditioned on &#123;@code this.isAlive&#125;. As a thread terminates the * &#123;@code this.notifyAll&#125; method is invoked. It is recommended that * applications not use &#123;@code wait&#125;, &#123;@code notify&#125;, or * &#123;@code notifyAll&#125; on &#123;@code Thread&#125; instances. * * @param millis * the time to wait in milliseconds * * @throws IllegalArgumentException * if the value of &#123;@code millis&#125; is negative * * @throws InterruptedException * if any thread has interrupted the current thread. The * &lt;i&gt;interrupted status&lt;/i&gt; of the current thread is * cleared when this exception is thrown. */ public final synchronized void join(long millis) throws InterruptedException &#123; long base = System.currentTimeMillis(); long now = 0; if (millis &lt; 0) &#123; throw new IllegalArgumentException(\"timeout value is negative\"); if (millis == 0) &#123; while (isAlive()) &#123; wait(0); &#125; &#125; else &#123; while (isAlive()) &#123; long delay = millis - now; if (delay &lt;= 0) &#123; break; &#125; wait(delay); now = System.currentTimeMillis() - base; &#125; &#125; &#125; ç±» ThreadLocal çš„ä½¿ç”¨è¯¥ç±»æä¾›äº†çº¿ç¨‹å±€éƒ¨ (thread-local) å˜é‡ã€‚è¿™äº›å˜é‡ä¸åŒäºå®ƒä»¬çš„æ™®é€šå¯¹åº”ç‰©ï¼Œå› ä¸ºè®¿é—®æŸä¸ªå˜é‡ï¼ˆé€šè¿‡å…¶ get æˆ–set æ–¹æ³•ï¼‰çš„æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å±€éƒ¨å˜é‡ï¼Œå®ƒç‹¬ç«‹äºå˜é‡çš„åˆå§‹åŒ–å‰¯æœ¬ã€‚ThreadLocal å®ä¾‹é€šå¸¸æ˜¯ç±»ä¸­çš„private static å­—æ®µï¼Œå®ƒä»¬å¸Œæœ›å°†çŠ¶æ€ä¸æŸä¸€ä¸ªçº¿ç¨‹ï¼ˆä¾‹å¦‚ï¼Œç”¨æˆ· ID æˆ–äº‹åŠ¡ IDï¼‰ç›¸å…³è”ã€‚ get() æ–¹æ³•12345678910111213public T get() &#123; Thread t = Thread.currentThread(); ThreadLocalMap map = getMap(t); if (map != null) &#123; ThreadLocalMap.Entry e = map.getEntry(this); if (e != null) &#123; @SuppressWarnings(\"unchecked\") T result = (T)e.value; return result; &#125; &#125; return setInitialValue(); &#125; è¿”å›æ­¤çº¿ç¨‹å±€éƒ¨å˜é‡çš„å½“å‰çº¿ç¨‹å‰¯æœ¬ä¸­çš„å€¼ã€‚å¦‚æœå˜é‡æ²¡æœ‰ç”¨äºå½“å‰çº¿ç¨‹çš„å€¼ï¼Œåˆ™å…ˆå°†å…¶åˆå§‹åŒ–ä¸ºè°ƒç”¨ initialValue() æ–¹æ³•è¿”å›çš„å€¼ã€‚ InheritableThreadLocal ç±»çš„ä½¿ç”¨è¯¥ç±»æ‰©å±•äº† ThreadLocalï¼Œä¸ºå­çº¿ç¨‹æä¾›ä»çˆ¶çº¿ç¨‹é‚£é‡Œç»§æ‰¿çš„å€¼ï¼šåœ¨åˆ›å»ºå­çº¿ç¨‹æ—¶ï¼Œå­çº¿ç¨‹ä¼šæ¥æ”¶æ‰€æœ‰å¯ç»§æ‰¿çš„çº¿ç¨‹å±€éƒ¨å˜é‡çš„åˆå§‹å€¼ï¼Œä»¥è·å¾—çˆ¶çº¿ç¨‹æ‰€å…·æœ‰çš„å€¼ã€‚é€šå¸¸ï¼Œå­çº¿ç¨‹çš„å€¼ä¸çˆ¶çº¿ç¨‹çš„å€¼æ˜¯ä¸€è‡´çš„ï¼›ä½†æ˜¯ï¼Œé€šè¿‡é‡å†™è¿™ä¸ªç±»ä¸­çš„ childValue æ–¹æ³•ï¼Œå­çº¿ç¨‹çš„å€¼å¯ä»¥ä½œä¸ºçˆ¶çº¿ç¨‹å€¼çš„ä¸€ä¸ªä»»æ„å‡½æ•°ã€‚ å½“å¿…é¡»å°†å˜é‡ï¼ˆå¦‚ç”¨æˆ· ID å’Œ äº‹åŠ¡ IDï¼‰ä¸­ç»´æŠ¤çš„æ¯çº¿ç¨‹å±æ€§ï¼ˆper-thread-attributeï¼‰è‡ªåŠ¨ä¼ é€ç»™åˆ›å»ºçš„æ‰€æœ‰å­çº¿ç¨‹æ—¶ï¼Œåº”å°½å¯èƒ½åœ°é‡‡ç”¨å¯ç»§æ‰¿çš„çº¿ç¨‹å±€éƒ¨å˜é‡ï¼Œè€Œä¸æ˜¯é‡‡ç”¨æ™®é€šçš„çº¿ç¨‹å±€éƒ¨å˜é‡ã€‚ ç¬¬å››ç«  â€”â€” Lock çš„ä½¿ç”¨ä½¿ç”¨ ReentrantLock ç±»ä¸€ä¸ªå¯é‡å…¥çš„äº’æ–¥é” Lockï¼Œå®ƒå…·æœ‰ä¸ä½¿ç”¨ synchronized æ–¹æ³•å’Œè¯­å¥æ‰€è®¿é—®çš„éšå¼ç›‘è§†å™¨é”ç›¸åŒçš„ä¸€äº›åŸºæœ¬è¡Œä¸ºå’Œè¯­ä¹‰ï¼Œä½†åŠŸèƒ½æ›´å¼ºå¤§ã€‚ ReentrantLock å°†ç”±æœ€è¿‘æˆåŠŸè·å¾—é”ï¼Œå¹¶ä¸”è¿˜æ²¡æœ‰é‡Šæ”¾è¯¥é”çš„çº¿ç¨‹æ‰€æ‹¥æœ‰ã€‚å½“é”æ²¡æœ‰è¢«å¦ä¸€ä¸ªçº¿ç¨‹æ‰€æ‹¥æœ‰æ—¶ï¼Œè°ƒç”¨ lock çš„çº¿ç¨‹å°†æˆåŠŸè·å–è¯¥é”å¹¶è¿”å›ã€‚å¦‚æœå½“å‰çº¿ç¨‹å·²ç»æ‹¥æœ‰è¯¥é”ï¼Œæ­¤æ–¹æ³•å°†ç«‹å³è¿”å›ã€‚å¯ä»¥ä½¿ç”¨ isHeldByCurrentThread()å’Œ getHoldCount()æ–¹æ³•æ¥æ£€æŸ¥æ­¤æƒ…å†µæ˜¯å¦å‘ç”Ÿã€‚ æ­¤ç±»çš„æ„é€ æ–¹æ³•æ¥å—ä¸€ä¸ªå¯é€‰çš„å…¬å¹³ å‚æ•°ã€‚å½“è®¾ç½®ä¸º true æ—¶ï¼Œåœ¨å¤šä¸ªçº¿ç¨‹çš„äº‰ç”¨ä¸‹ï¼Œè¿™äº›é”å€¾å‘äºå°†è®¿é—®æƒæˆäºˆç­‰å¾…æ—¶é—´æœ€é•¿çš„çº¿ç¨‹ã€‚å¦åˆ™æ­¤é”å°†æ— æ³•ä¿è¯ä»»ä½•ç‰¹å®šè®¿é—®é¡ºåºã€‚ä¸é‡‡ç”¨é»˜è®¤è®¾ç½®ï¼ˆä½¿ç”¨ä¸å…¬å¹³é”ï¼‰ç›¸æ¯”ï¼Œä½¿ç”¨å…¬å¹³é”çš„ç¨‹åºåœ¨è®¸å¤šçº¿ç¨‹è®¿é—®æ—¶è¡¨ç°ä¸ºå¾ˆä½çš„æ€»ä½“ååé‡ï¼ˆå³é€Ÿåº¦å¾ˆæ…¢ï¼Œå¸¸å¸¸æå…¶æ…¢ï¼‰ï¼Œä½†æ˜¯åœ¨è·å¾—é”å’Œä¿è¯é”åˆ†é…çš„å‡è¡¡æ€§æ—¶å·®å¼‚è¾ƒå°ã€‚ä¸è¿‡è¦æ³¨æ„çš„æ˜¯ï¼Œå…¬å¹³é”ä¸èƒ½ä¿è¯çº¿ç¨‹è°ƒåº¦çš„å…¬å¹³æ€§ã€‚å› æ­¤ï¼Œä½¿ç”¨å…¬å¹³é”çš„ä¼—å¤šçº¿ç¨‹ä¸­çš„ä¸€å‘˜å¯èƒ½è·å¾—å¤šå€çš„æˆåŠŸæœºä¼šï¼Œè¿™ç§æƒ…å†µå‘ç”Ÿåœ¨å…¶ä»–æ´»åŠ¨çº¿ç¨‹æ²¡æœ‰è¢«å¤„ç†å¹¶ä¸”ç›®å‰å¹¶æœªæŒæœ‰é”æ—¶ã€‚è¿˜è¦æ³¨æ„çš„æ˜¯ï¼Œæœªå®šæ—¶çš„ tryLockæ–¹æ³•å¹¶æ²¡æœ‰ä½¿ç”¨å…¬å¹³è®¾ç½®ã€‚å› ä¸ºå³ä½¿å…¶ä»–çº¿ç¨‹æ­£åœ¨ç­‰å¾…ï¼Œåªè¦è¯¥é”æ˜¯å¯ç”¨çš„ï¼Œæ­¤æ–¹æ³•å°±å¯ä»¥è·å¾—æˆåŠŸã€‚ å»ºè®®æ€»æ˜¯ ç«‹å³å®è·µï¼Œä½¿ç”¨ lock å—æ¥è°ƒç”¨ tryï¼Œåœ¨ä¹‹å‰/ä¹‹åçš„æ„é€ ä¸­ï¼Œæœ€å…¸å‹çš„ä»£ç å¦‚ä¸‹ï¼š 12345678910111213class X &#123; private final ReentrantLock lock = new ReentrantLock(); // ... public void m() &#123; lock.lock(); // block until condition holds try &#123; // ... method body &#125; finally &#123; lock.unlock() &#125; &#125; &#125; ConditionCondition å°† Object ç›‘è§†å™¨æ–¹æ³•ï¼ˆwaitã€notify å’Œ notifyAllï¼‰åˆ†è§£æˆæˆªç„¶ä¸åŒçš„å¯¹è±¡ï¼Œä»¥ä¾¿é€šè¿‡å°†è¿™äº›å¯¹è±¡ä¸ä»»æ„ Lock å®ç°ç»„åˆä½¿ç”¨ï¼Œä¸ºæ¯ä¸ªå¯¹è±¡æä¾›å¤šä¸ªç­‰å¾… setï¼ˆwait-setï¼‰ã€‚å…¶ä¸­ï¼ŒLock æ›¿ä»£äº† synchronized æ–¹æ³•å’Œè¯­å¥çš„ä½¿ç”¨ï¼ŒCondition æ›¿ä»£äº† Object ç›‘è§†å™¨æ–¹æ³•çš„ä½¿ç”¨ã€‚ å‡å®šæœ‰ä¸€ä¸ªç»‘å®šçš„ç¼“å†²åŒºï¼Œå®ƒæ”¯æŒ put å’Œ take æ–¹æ³•ã€‚å¦‚æœè¯•å›¾åœ¨ç©ºçš„ç¼“å†²åŒºä¸Šæ‰§è¡Œ take æ“ä½œï¼Œåˆ™åœ¨æŸä¸€ä¸ªé¡¹å˜å¾—å¯ç”¨ä¹‹å‰ï¼Œçº¿ç¨‹å°†ä¸€ç›´é˜»å¡ï¼›å¦‚æœè¯•å›¾åœ¨æ»¡çš„ç¼“å†²åŒºä¸Šæ‰§è¡Œ put æ“ä½œï¼Œåˆ™åœ¨æœ‰ç©ºé—´å˜å¾—å¯ç”¨ä¹‹å‰ï¼Œçº¿ç¨‹å°†ä¸€ç›´é˜»å¡ã€‚æˆ‘ä»¬å–œæ¬¢åœ¨å•ç‹¬çš„ç­‰å¾… set ä¸­ä¿å­˜ put çº¿ç¨‹å’Œ take çº¿ç¨‹ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ç¼“å†²åŒºä¸­çš„é¡¹æˆ–ç©ºé—´å˜å¾—å¯ç”¨æ—¶åˆ©ç”¨æœ€ä½³è§„åˆ’ï¼Œä¸€æ¬¡åªé€šçŸ¥ä¸€ä¸ªçº¿ç¨‹ã€‚å¯ä»¥ä½¿ç”¨ä¸¤ä¸ª Condition å®ä¾‹æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚ 12345678910111213141516171819202122232425262728293031323334353637class BoundedBuffer &#123; final Lock lock = new ReentrantLock(); final Condition notFull = lock.newCondition(); final Condition notEmpty = lock.newCondition(); final Object[] items = new Object[100]; int putptr, takeptr, count; public void put(Object x) throws InterruptedException &#123; lock.lock(); try &#123; while (count == items.length) notFull.await(); items[putptr] = x; if (++putptr == items.length) putptr = 0; ++count; notEmpty.signal(); &#125; finally &#123; lock.unlock(); &#125; &#125; public Object take() throws InterruptedException &#123; lock.lock(); try &#123; while (count == 0) notEmpty.await(); Object x = items[takeptr]; if (++takeptr == items.length) takeptr = 0; --count; notFull.signal(); return x; &#125; finally &#123; lock.unlock(); &#125; &#125; &#125; æ­£ç¡®ä½¿ç”¨ Condition å®ç°ç­‰å¾…/é€šçŸ¥MyService.java 123456789101112131415161718192021222324252627282930313233343536package com.zhisheng.thread.Thread9;import java.util.concurrent.locks.Condition;import java.util.concurrent.locks.Lock;import java.util.concurrent.locks.ReentrantLock;/** * Created by 10412 on 2017/6/4. */public class MyService&#123; private Lock lock = new ReentrantLock(); private Condition condition = lock.newCondition(); public void await() &#123; lock.lock(); try &#123; System.out.println(\"await A\"); condition.await();//ä½¿å½“å‰æ‰§è¡Œçš„çº¿ç¨‹å¤„äºç­‰å¾…çŠ¶æ€ waiting System.out.println(\"await B\"); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125;finally &#123; lock.unlock(); System.out.println(\"é‡Šæ”¾é”\"); &#125; &#125; public void signal() &#123; lock.lock(); System.out.println(\"signal A\"); condition.signal(); System.out.println(\"signal B\"); lock.unlock(); &#125;&#125; ThreadA.java 123456789101112131415161718package com.zhisheng.thread.Thread9;/** * Created by 10412 on 2017/6/4. */public class ThreadA extends Thread&#123; private MyService service; public ThreadA(MyService service) &#123; this.service = service; &#125; @Override public void run() &#123; service.await(); &#125;&#125; Test.java 123456789101112131415package com.zhisheng.thread.Thread9;/** * Created by 10412 on 2017/6/4. */public class Test&#123; public static void main(String[] args) throws InterruptedException &#123; MyService service = new MyService(); ThreadA ta = new ThreadA(service); ta.start(); Thread.sleep(5000); service.signal(); &#125;&#125; è¿è¡Œç»“æœï¼š 12345await Asignal Asignal Bawait Bé‡Šæ”¾é” Object ç±»ä¸­çš„ wait() æ–¹æ³•ç›¸å½“äº Condition ç±»ä¸­ await() æ–¹æ³• Object ç±»ä¸­çš„ wait(long time) æ–¹æ³•ç›¸å½“äº Condition ç±»ä¸­ await(long time, TimeUnit unit) æ–¹æ³• Object ç±»ä¸­çš„ notify() æ–¹æ³•ç›¸å½“äº Condition ç±»ä¸­ signal() æ–¹æ³• Object ç±»ä¸­çš„ notifyAll() æ–¹æ³•ç›¸å½“äº Condition ç±»ä¸­ signalAll() æ–¹æ³• é¢˜ç›®ï¼šå®ç°ç”Ÿäº§è€…ä¸æ¶ˆè´¹è€… ä¸€å¯¹ä¸€äº¤æ›¿æ‰“å° MyService.java 12345678910111213141516171819202122232425262728293031323334353637383940414243444546package com.zhisheng.thread.thread10;import java.util.concurrent.locks.Condition;import java.util.concurrent.locks.Lock;import java.util.concurrent.locks.ReentrantLock;/** * Created by 10412 on 2017/6/4. * å®ç°ç”Ÿäº§è€…ä¸æ¶ˆè´¹è€… ä¸€å¯¹ä¸€Â·äº¤æ›¿æ‰“å° */public class MyService&#123; private Lock lock = new ReentrantLock(); private Condition condition = lock.newCondition(); private boolean flag = false; public void setValue() &#123; lock.lock(); while (flag == true) &#123; try &#123; condition.await(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; System.out.println(\"SetValue AAAAAA\"); flag = true; condition.signal(); lock.unlock(); &#125; public void getValue() &#123; lock.lock(); while (flag == false) &#123; try &#123; condition.await(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; System.out.println(\"GetValue BBBB\"); flag = false; condition.signal(); lock.unlock(); &#125;&#125; ThreadA.java 1234567891011121314151617181920package com.zhisheng.thread.thread10;/** * Created by 10412 on 2017/6/4. */public class ThreadA extends Thread&#123; private MyService service; public ThreadA(MyService service) &#123; this.service = service; &#125; @Override public void run() &#123; for (int i = 0; i &lt; Integer.MAX_VALUE; i++) &#123; service.setValue(); &#125; &#125;&#125; ThreadB.java 1234567891011121314151617181920package com.zhisheng.thread.thread10;/** * Created by 10412 on 2017/6/4. */public class ThreadB extends Thread&#123; private MyService service; public ThreadB(MyService service) &#123; this.service = service; &#125; @Override public void run() &#123; for (int i = 0; i &lt; Integer.MAX_VALUE; i++) &#123; service.getValue(); &#125; &#125;&#125; Test.java 123456789101112131415package com.zhisheng.thread.thread10;/** * Created by 10412 on 2017/6/4. */public class Test&#123; public static void main(String[] args) &#123; MyService service = new MyService(); ThreadA ta = new ThreadA(service); ThreadB tb = new ThreadB(service); ta.start(); tb.start(); &#125;&#125; getHoldCount() æŸ¥è¯¢å½“å‰çº¿ç¨‹ä¿æŒæ­¤é”å®šçš„ä¸ªæ•°ï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨ lock() çš„æ–¹æ³• getQueueLength() è¿”å›æ­£ç­‰å¾…è·å–æ­¤é”å®šçš„çº¿ç¨‹ä¼°è®¡æ•° getWaitQueueLength() è¿”å›ç­‰å¾…ä¸æ­¤é”å®šç›¸å…³çš„ç»™å®šæ¡ä»¶ Condition çš„çº¿ç¨‹ä¼°è®¡æ•° hasQueuedThread() æŸ¥è¯¢æŒ‡å®šçš„çº¿ç¨‹æ˜¯å¦æ­£åœ¨ç­‰å¾…è·å–æ­¤é”å®š hasQueuedThreads() æŸ¥è¯¢æ˜¯å¦æœ‰çº¿ç¨‹æ­£åœ¨ç­‰å¾…è·å–æ­¤é”å®š hasWaiters() æŸ¥è¯¢æ˜¯å¦æœ‰çº¿ç¨‹æ­£åœ¨ç­‰å¾…ä¸æ­¤é”å®šæœ‰å…³çš„ condition æ¡ä»¶ isFair() åˆ¤æ–­æ˜¯å¦æ˜¯å…¬å¹³é”ï¼ˆé»˜è®¤ä¸‹ ReentrantLockç±»ä½¿ç”¨çš„æ˜¯éå…¬å¹³é”ï¼‰ isHeldByCurrentThread() æŸ¥è¯¢å½“å‰çº¿ç¨‹æ˜¯å¦ä¿æŒæ­¤é”å®š isLocked() æŸ¥è¯¢æ­¤é”å®šæ˜¯å¦ç”±ä»»æ„çº¿ç¨‹ä¿æŒ lockInterruptibly() å¦‚æœå½“å‰çº¿ç¨‹æœªè¢«ä¸­æ–­ï¼Œåˆ™è·å–é”å®šï¼Œå¦‚æœå·²ç»è¢«ä¸­æ–­åˆ™å‡ºç°å¼‚å¸¸ tryLock() ä»…åœ¨è°ƒç”¨æ—¶é”å®šæœªè¢«å¦ä¸€ä¸ªçº¿ç¨‹ä¿æŒçš„æƒ…å†µä¸‹ï¼Œæ‰è·å–è¯¥é”å®š tryLock(long time, TimeUtil util) å¦‚æœé”å®šåœ¨ç»™å®šçš„ç­‰å¾…æ—¶é—´å†…æ²¡æœ‰è¢«å¦ä¸€ä¸ªçº¿ç¨‹ä¿æŒï¼Œä¸”å½“å‰çº¿ç¨‹æœªè¢«ä¸­æ–­ï¼Œåˆ™è·å–è¯¥é”å®šã€‚ ä½¿ç”¨ ReentrantReadWriteLock ç±»è¯»å†™äº’æ–¥ï¼š MyService.java 123456789101112131415161718192021222324252627282930313233package com.zhisheng.thread.Thread11;import java.util.concurrent.locks.ReentrantReadWriteLock;/** * Created by 10412 on 2017/6/4. */public class MyService&#123; private ReentrantReadWriteLock lock = new ReentrantReadWriteLock(); public void read() &#123; lock.readLock().lock(); System.out.println(Thread.currentThread().getName() + \" Read AAA \" + System.currentTimeMillis()); try &#123; Thread.sleep(10000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; lock.readLock().unlock(); &#125; public void write() &#123; lock.writeLock().lock(); System.out.println(Thread.currentThread().getName() + \" write BBB \" + System.currentTimeMillis()); try &#123; Thread.sleep(10000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; lock.writeLock().unlock(); &#125;&#125; ThreadA.java 123456789101112131415161718package com.zhisheng.thread.Thread11;/** * Created by 10412 on 2017/6/4. */public class ThreadA extends Thread&#123; private MyService service; public ThreadA(MyService service) &#123; this.service = service; &#125; @Override public void run() &#123; service.read(); &#125;&#125; ThreadB.java 123456789101112131415161718package com.zhisheng.thread.Thread11;/** * Created by 10412 on 2017/6/4. */public class ThreadB extends Thread&#123; private MyService service; public ThreadB(MyService service) &#123; this.service = service; &#125; @Override public void run() &#123; service.write(); &#125;&#125; Test.java 123456789101112131415161718package com.zhisheng.thread.Thread11;/** * Created by 10412 on 2017/6/4. */public class Test&#123; public static void main(String[] args) throws InterruptedException &#123; MyService service = new MyService(); ThreadA ta = new ThreadA(service); ta.setName(\"A\"); ta.start(); Thread.sleep(1000); ThreadB tb = new ThreadB(service); tb.setName(\"B\"); tb.start(); &#125;&#125; è¿è¡Œç»“æœï¼š 12A Read AAA 1496556770402B write BBB 1496556780402 ç¬¬å…­ç«  â€”â€” å•ä¾‹æ¨¡å¼ä¸å¤šçº¿ç¨‹æ¨èæ–‡ç«  ã€Šæ·±å…¥æµ…å‡ºå•å®ä¾‹Singletonè®¾è®¡æ¨¡å¼ã€‹ ç«‹å³åŠ è½½æ¨¡å¼ / â€œé¥¿æ±‰æ¨¡å¼â€ç«‹å³åŠ è½½ï¼šä½¿ç”¨ç±»çš„æ—¶å€™å·²ç»å°†å¯¹è±¡åˆ›å»ºå®Œæ¯•ï¼Œnew å®ä¾‹åŒ– 123456789public class MyObject&#123; private static MyObject object = new MyObject(); private MyObject() &#123; &#125; public static MyObject getInstance() &#123; return object; &#125;&#125; å»¶è¿ŸåŠ è½½ / â€œ æ‡’æ±‰æ¨¡å¼ â€å°±æ˜¯åœ¨è°ƒç”¨ get çš„æ—¶å€™å®ä¾‹æ‰è¢«åˆ›å»ºã€‚åœ¨ get() æ–¹æ³•ä¸­è¿›è¡Œ new å®ä¾‹åŒ–ã€‚ 12345678910111213public class MyObject&#123; private static MyObject object; private MyObject() &#123; &#125; public static MyObject getInstance() &#123; if (object != null) &#123; &#125; else &#123; object = new MyObject(); &#125; return object; &#125;&#125; ä½¿ç”¨ DCL åŒé‡æ£€æŸ¥é”ï¼Œè§£å†³â€œæ‡’æ±‰æ¨¡å¼â€é‡åˆ°çš„å¤šçº¿ç¨‹é—®é¢˜ 123456789101112131415161718public class MyObject&#123; private volatile static MyObject object; private MyObject() &#123; &#125; //synchronized public static MyObject getInstance() &#123; if (object != null) &#123; &#125; else &#123; synchronized (MyObject.class) &#123; if (object == null) &#123; object = new MyObject(); &#125; &#125; &#125; return object; &#125;&#125; ä½¿ç”¨é™æ€å†…éƒ¨ç±»å®ç°å•ä¾‹æ¨¡å¼123456789101112public class MyObject&#123; private static class MyObjectHandler &#123; private static MyObject object = new MyObject(); &#125; private MyObject() &#123; &#125; public static MyObject getInstance() &#123; return MyObjectHandler.object; &#125;&#125; åºåˆ—åŒ–ä¸ååºåˆ—åŒ–çš„å•ä¾‹æ¨¡å¼å®ç°MyObject.java 12345678910111213141516171819202122232425package com.zhisheng.thread.thread15;import java.io.ObjectStreamException;import java.io.Serializable;/** * Created by 10412 on 2017/6/4. */public class MyObject implements Serializable&#123; private static final long serialVersionUID = 888L; private static class MyObjectHandler &#123; private static final MyObject object = new MyObject(); &#125; private MyObject() &#123; &#125; public static MyObject getInstance() &#123; return MyObjectHandler.object; &#125; protected Object readResolve() throws ObjectStreamException &#123; System.out.println(\"è°ƒç”¨äº†readResolveæ–¹æ³•ï¼\"); return MyObjectHandler.object; &#125;&#125; SaveAndRead.java 12345678910111213141516171819202122232425262728293031323334353637383940package com.zhisheng.thread.thread15;import java.io.*;/** * Created by 10412 on 2017/6/4. */public class SaveAndRead&#123; public static void main(String[] args) &#123; try &#123; MyObject object = MyObject.getInstance(); FileOutputStream fos = new FileOutputStream(new File(\"fos.txt\")); ObjectOutputStream oos = new ObjectOutputStream(fos); oos.writeObject(object); oos.close(); fos.close(); System.out.println(object.hashCode()); &#125; catch (FileNotFoundException e) &#123; e.printStackTrace(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; try &#123; FileInputStream fis = new FileInputStream(new File(\"fos.txt\")); ObjectInputStream ois = new ObjectInputStream(fis); MyObject o = (MyObject) ois.readObject(); ois.close(); fis.close(); System.out.println(o.hashCode()); &#125; catch (FileNotFoundException e) &#123; e.printStackTrace(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; catch (ClassNotFoundException e) &#123; e.printStackTrace(); &#125; &#125;&#125; è¿™é‡Œä¸»è¦è¦æŒ‡å‡º MyObject.java ä¸­ readResolve æ–¹æ³• 1234protected Object readResolve() throws ObjectStreamException &#123; System.out.println(\"è°ƒç”¨äº†readResolveæ–¹æ³•ï¼\"); return MyObjectHandler.object; &#125; æ–¹æ³• readResolve å…è®¸ class åœ¨ååºåˆ—åŒ–è¿”å›å¯¹è±¡å‰æ›¿æ¢ã€è§£æåœ¨æµä¸­è¯»å‡ºæ¥çš„å¯¹è±¡ã€‚å®ç° readResolve æ–¹æ³•ï¼Œä¸€ä¸ª class å¯ä»¥ç›´æ¥æ§åˆ¶ååºåŒ–è¿”å›çš„ç±»å‹å’Œå¯¹è±¡å¼•ç”¨ã€‚ æ–¹æ³• readResolve ä¼šåœ¨ ObjectInputStream å·²ç»è¯»å–ä¸€ä¸ªå¯¹è±¡å¹¶åœ¨å‡†å¤‡è¿”å›å‰è°ƒç”¨ã€‚ObjectInputStream ä¼šæ£€æŸ¥å¯¹è±¡çš„ class æ˜¯å¦å®šä¹‰äº† readResolve æ–¹æ³•ã€‚å¦‚æœå®šä¹‰äº†ï¼Œå°†ç”± readResolve æ–¹æ³•æŒ‡å®šè¿”å›çš„å¯¹è±¡ã€‚è¿”å›å¯¹è±¡çš„ç±»å‹ä¸€å®šè¦æ˜¯å…¼å®¹çš„ï¼Œå¦åˆ™ä¼šæŠ›å‡º ClassCastException ã€‚ ä½¿ç”¨ static ä»£ç å—å®ç°å•ä¾‹æ¨¡å¼1234567891011121314151617package com.zhisheng.thread.thread16;/** * Created by 10412 on 2017/6/4. */public class MyObject&#123; private static MyObject instance = null; private MyObject() &#123; &#125; static &#123; instance = new MyObject(); &#125; public static MyObject getInstance() &#123; return instance; &#125;&#125; ThreadA.java 1234567891011121314package com.zhisheng.thread.thread16;/** * Created by 10412 on 2017/6/4. */public class ThreadA extends Thread&#123; @Override public void run() &#123; for (int i = 0; i &lt; 5; i++) &#123; System.out.println(MyObject.getInstance().hashCode()); &#125; &#125;&#125; Test.java 12345678910111213141516package com.zhisheng.thread.thread16;/** * Created by 10412 on 2017/6/4. */public class Test&#123; public static void main(String[] args) &#123; ThreadA ta1 = new ThreadA(); ThreadA ta2 = new ThreadA(); ThreadA ta3 = new ThreadA(); ta1.start(); ta2.start(); ta3.start(); &#125;&#125; ä½¿ç”¨æšä¸¾æ•°æ®ç±»å‹å®ç°å•ä¾‹æ¨¡å¼åœ¨ä½¿ç”¨æšä¸¾ç±»æ—¶ï¼Œæ„é€ æ–¹æ³•ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥åº”ç”¨è¿™ä¸ªç‰¹æ€§å®ç°å•ä¾‹æ¨¡å¼ã€‚ 123456789101112131415public class MyObject &#123; private enum MyEnumSingleton&#123; INSTANCE; private Resource resource; private MyEnumSingleton()&#123; resource = new Resource(); &#125; public Resource getResource()&#123; return resource; &#125; &#125; public static Resource getResource()&#123; return MyEnumSingleton.INSTANCE.getResource(); &#125;&#125; æµ‹è¯•ï¼š 123456789101112131415161718192021import test.MyObject;public class Run &#123; class MyThread extends Thread &#123; @Override public void run() &#123; for (int i = 0; i &lt; 5; i++) &#123; System.out.println(MyObject.getResource().hashCode()); &#125; &#125; &#125; public static void main(String[] args) &#123; Run.MyThread t1 = new Run().new MyThread(); Run.MyThread t2 = new Run().new MyThread(); Run.MyThread t3 = new Run().new MyThread(); t1.start(); t2.start(); t3.start(); &#125;&#125; è¿™é‡Œå†æ¨èä¸€ç¯‡ stackoverflow ä¸Šçš„ä¸€ä¸ªé—®é¢˜å›ç­”ï¼š What is an efficient way to implement a singleton pattern in Java? æ€»ç»“æœ¬ç¯‡æ–‡ç« æ˜¯æˆ‘è¯» ã€ŠJavaå¤šçº¿ç¨‹ç¼–ç¨‹æ ¸å¿ƒæŠ€æœ¯ã€‹ çš„ç¬”è®°åŠè‡ªå·±çš„ä¸€äº›æ€»ç»“ï¼Œè§‰å¾—ä¸é”™ï¼Œæ¬¢è¿ç‚¹èµå’Œè½¬å‘ã€‚","tags":[{"name":"Java","slug":"Java","permalink":"http://www.54tianzhisheng.cn/tags/Java/"},{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"http://www.54tianzhisheng.cn/tags/å¤šçº¿ç¨‹/"}]},{"title":"Java NIO ç³»åˆ—æ•™ç¨‹","date":"2017-06-12T16:00:00.000Z","path":"2017/06/13/Java NIO ç³»åˆ—æ•™ç¨‹/","text":"Java NIOï¼ˆNew IOï¼‰æ˜¯ä»Java 1.4ç‰ˆæœ¬å¼€å§‹å¼•å…¥çš„ä¸€ä¸ªæ–°çš„IO APIï¼Œå¯ä»¥æ›¿ä»£æ ‡å‡†çš„Java IO APIã€‚ Java NIOæä¾›äº†ä¸æ ‡å‡†IOä¸åŒçš„IOå·¥ä½œæ–¹å¼ï¼š Channels and Buffersï¼ˆé€šé“å’Œç¼“å†²åŒºï¼‰ï¼šæ ‡å‡†çš„IOåŸºäºå­—èŠ‚æµå’Œå­—ç¬¦æµè¿›è¡Œæ“ä½œçš„ï¼Œè€ŒNIOæ˜¯åŸºäºé€šé“ï¼ˆChannelï¼‰å’Œç¼“å†²åŒºï¼ˆBufferï¼‰è¿›è¡Œæ“ä½œï¼Œæ•°æ®æ€»æ˜¯ä»é€šé“è¯»å–åˆ°ç¼“å†²åŒºä¸­ï¼Œæˆ–è€…ä»ç¼“å†²åŒºå†™å…¥åˆ°é€šé“ä¸­ã€‚ Asynchronous IOï¼ˆå¼‚æ­¥IOï¼‰ï¼šJava NIOå¯ä»¥è®©ä½ å¼‚æ­¥çš„ä½¿ç”¨IOï¼Œä¾‹å¦‚ï¼šå½“çº¿ç¨‹ä»é€šé“è¯»å–æ•°æ®åˆ°ç¼“å†²åŒºæ—¶ï¼Œçº¿ç¨‹è¿˜æ˜¯å¯ä»¥è¿›è¡Œå…¶ä»–äº‹æƒ…ã€‚å½“æ•°æ®è¢«å†™å…¥åˆ°ç¼“å†²åŒºæ—¶ï¼Œçº¿ç¨‹å¯ä»¥ç»§ç»­å¤„ç†å®ƒã€‚ä»ç¼“å†²åŒºå†™å…¥é€šé“ä¹Ÿç±»ä¼¼ã€‚ Selectorsï¼ˆé€‰æ‹©å™¨ï¼‰ï¼šJava NIOå¼•å…¥äº†é€‰æ‹©å™¨çš„æ¦‚å¿µï¼Œé€‰æ‹©å™¨ç”¨äºç›‘å¬å¤šä¸ªé€šé“çš„äº‹ä»¶ï¼ˆæ¯”å¦‚ï¼šè¿æ¥æ‰“å¼€ï¼Œæ•°æ®åˆ°è¾¾ï¼‰ã€‚å› æ­¤ï¼Œå•ä¸ªçš„çº¿ç¨‹å¯ä»¥ç›‘å¬å¤šä¸ªæ•°æ®é€šé“ã€‚ ä¸‹é¢å°±æ¥è¯¦ç»†ä»‹ç»Java NIOçš„ç›¸å…³çŸ¥è¯†ã€‚ 1ã€Java NIO æ¦‚è¿°Java NIO ç”±ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒéƒ¨åˆ†ç»„æˆï¼š Channels Buffers Selectors è™½ç„¶ Java NIO ä¸­é™¤æ­¤ä¹‹å¤–è¿˜æœ‰å¾ˆå¤šç±»å’Œç»„ä»¶ï¼Œä½†åœ¨æˆ‘çœ‹æ¥ï¼ŒChannelï¼ŒBuffer å’Œ Selector æ„æˆäº†æ ¸å¿ƒçš„ APIã€‚å…¶å®ƒç»„ä»¶ï¼Œå¦‚ Pipe å’Œ FileLockï¼Œåªä¸è¿‡æ˜¯ä¸ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶å…±åŒä½¿ç”¨çš„å·¥å…·ç±»ã€‚å› æ­¤ï¼Œåœ¨æ¦‚è¿°ä¸­æˆ‘å°†é›†ä¸­åœ¨è¿™ä¸‰ä¸ªç»„ä»¶ä¸Šã€‚å…¶å®ƒç»„ä»¶ä¼šåœ¨å•ç‹¬çš„ç« èŠ‚ä¸­è®²åˆ°ã€‚ Channel å’Œ BufferåŸºæœ¬ä¸Šï¼Œæ‰€æœ‰çš„ IO åœ¨NIO ä¸­éƒ½ä»ä¸€ä¸ª Channel å¼€å§‹ã€‚Channel æœ‰ç‚¹è±¡æµã€‚ æ•°æ®å¯ä»¥ä» Channel è¯»åˆ° Buffer ä¸­ï¼Œä¹Ÿå¯ä»¥ä» Buffer å†™åˆ° Channel ä¸­ã€‚è¿™é‡Œæœ‰ä¸ªå›¾ç¤ºï¼š Channel å’Œ Buffer æœ‰å¥½å‡ ç§ç±»å‹ã€‚ä¸‹é¢æ˜¯ JAVA NIO ä¸­çš„ä¸€äº›ä¸»è¦ Channel çš„å®ç°ï¼š FileChannel DatagramChannel SocketChannel ServerSocketChannel æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œè¿™äº›é€šé“æ¶µç›–äº† UDP å’Œ TCP ç½‘ç»œ IOï¼Œä»¥åŠæ–‡ä»¶ IOã€‚ ä¸è¿™äº›ç±»ä¸€èµ·çš„æœ‰ä¸€äº›æœ‰è¶£çš„æ¥å£ï¼Œä½†ä¸ºç®€å•èµ·è§ï¼Œæˆ‘å°½é‡åœ¨æ¦‚è¿°ä¸­ä¸æåˆ°å®ƒä»¬ã€‚æœ¬æ•™ç¨‹å…¶å®ƒç« èŠ‚ä¸å®ƒä»¬ç›¸å…³çš„åœ°æ–¹æˆ‘ä¼šè¿›è¡Œè§£é‡Šã€‚ ä»¥ä¸‹æ˜¯ Java NIO é‡Œå…³é”®çš„ Buffer å®ç°ï¼š ByteBuffer CharBuffer DoubleBuffer FloatBuffer IntBuffer LongBuffer ShortBuffer è¿™äº› Buffer è¦†ç›–äº†ä½ èƒ½é€šè¿‡ IO å‘é€çš„åŸºæœ¬æ•°æ®ç±»å‹ï¼šbyte, short, int, long, float, double å’Œ charã€‚ Java NIO è¿˜æœ‰ä¸ª MappedByteBufferï¼Œç”¨äºè¡¨ç¤ºå†…å­˜æ˜ å°„æ–‡ä»¶ï¼Œ æˆ‘ä¹Ÿä¸æ‰“ç®—åœ¨æ¦‚è¿°ä¸­è¯´æ˜ã€‚ SelectorSelector å…è®¸å•çº¿ç¨‹å¤„ç†å¤šä¸ª Channelã€‚å¦‚æœä½ çš„åº”ç”¨æ‰“å¼€äº†å¤šä¸ªè¿æ¥ï¼ˆé€šé“ï¼‰ï¼Œä½†æ¯ä¸ªè¿æ¥çš„æµé‡éƒ½å¾ˆä½ï¼Œä½¿ç”¨ Selector å°±ä¼šå¾ˆæ–¹ä¾¿ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªèŠå¤©æœåŠ¡å™¨ä¸­ã€‚ è¿™æ˜¯åœ¨ä¸€ä¸ªå•çº¿ç¨‹ä¸­ä½¿ç”¨ä¸€ä¸ª Selector å¤„ç†3ä¸ª Channel çš„å›¾ç¤ºï¼š è¦ä½¿ç”¨ Selectorï¼Œå¾—å‘ Selector æ³¨å†Œ Channelï¼Œç„¶åè°ƒç”¨å®ƒçš„ select() æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•ä¼šä¸€ç›´é˜»å¡åˆ°æŸä¸ªæ³¨å†Œçš„é€šé“æœ‰äº‹ä»¶å°±ç»ªã€‚ä¸€æ—¦è¿™ä¸ªæ–¹æ³•è¿”å›ï¼Œçº¿ç¨‹å°±å¯ä»¥å¤„ç†è¿™äº›äº‹ä»¶ï¼Œäº‹ä»¶çš„ä¾‹å­æœ‰å¦‚æ–°è¿æ¥è¿›æ¥ï¼Œæ•°æ®æ¥æ”¶ç­‰ã€‚ 2ã€ChannelJava NIO çš„é€šé“ç±»ä¼¼æµï¼Œä½†åˆæœ‰äº›ä¸åŒï¼š æ—¢å¯ä»¥ä»é€šé“ä¸­è¯»å–æ•°æ®ï¼Œåˆå¯ä»¥å†™æ•°æ®åˆ°é€šé“ã€‚ä½†æµçš„è¯»å†™é€šå¸¸æ˜¯å•å‘çš„ã€‚ é€šé“å¯ä»¥å¼‚æ­¥åœ°è¯»å†™ã€‚ é€šé“ä¸­çš„æ•°æ®æ€»æ˜¯è¦å…ˆè¯»åˆ°ä¸€ä¸ª Bufferï¼Œæˆ–è€…æ€»æ˜¯è¦ä»ä¸€ä¸ª Buffer ä¸­å†™å…¥ã€‚ æ­£å¦‚ä¸Šé¢æ‰€è¯´ï¼Œä»é€šé“è¯»å–æ•°æ®åˆ°ç¼“å†²åŒºï¼Œä»ç¼“å†²åŒºå†™å…¥æ•°æ®åˆ°é€šé“ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š Channel çš„å®ç°è¿™äº›æ˜¯ Java NIO ä¸­æœ€é‡è¦çš„é€šé“çš„å®ç°ï¼š FileChannel DatagramChannel SocketChannel ServerSocketChannel FileChannel ä»æ–‡ä»¶ä¸­è¯»å†™æ•°æ®ã€‚ DatagramChannel èƒ½é€šè¿‡ UDP è¯»å†™ç½‘ç»œä¸­çš„æ•°æ®ã€‚ SocketChannel èƒ½é€šè¿‡ TCP è¯»å†™ç½‘ç»œä¸­çš„æ•°æ®ã€‚ ServerSocketChannel å¯ä»¥ç›‘å¬æ–°è¿›æ¥çš„ TCP è¿æ¥ï¼Œåƒ Web æœåŠ¡å™¨é‚£æ ·ã€‚å¯¹æ¯ä¸€ä¸ªæ–°è¿›æ¥çš„è¿æ¥éƒ½ä¼šåˆ›å»ºä¸€ä¸ª SocketChannelã€‚ åŸºæœ¬çš„ Channel ç¤ºä¾‹ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ FileChannel è¯»å–æ•°æ®åˆ° Buffer ä¸­çš„ç¤ºä¾‹ï¼š 12345678910111213141516171819RandomAccessFile aFile = new RandomAccessFile(&quot;data/nio-data.txt&quot;, &quot;rw&quot;);FileChannel inChannel = aFile.getChannel();ByteBuffer buf = ByteBuffer.allocate(48);int bytesRead = inChannel.read(buf);while (bytesRead != -1) &#123;System.out.println(&quot;Read &quot; + bytesRead);buf.flip();while(buf.hasRemaining())&#123;System.out.print((char) buf.get());&#125;buf.clear();bytesRead = inChannel.read(buf);&#125;aFile.close(); æ³¨æ„ buf.flip() çš„è°ƒç”¨ï¼Œé¦–å…ˆè¯»å–æ•°æ®åˆ°Bufferï¼Œç„¶ååè½¬Buffer,æ¥ç€å†ä»Bufferä¸­è¯»å–æ•°æ®ã€‚ä¸‹ä¸€èŠ‚ä¼šæ·±å…¥è®²è§£Bufferçš„æ›´å¤šç»†èŠ‚ã€‚ 3ã€BufferJava NIO ä¸­çš„ Buffer ç”¨äºå’Œ NIO é€šé“è¿›è¡Œäº¤äº’ã€‚å¦‚ä½ æ‰€çŸ¥ï¼Œæ•°æ®æ˜¯ä»é€šé“è¯»å…¥ç¼“å†²åŒºï¼Œä»ç¼“å†²åŒºå†™å…¥åˆ°é€šé“ä¸­çš„ã€‚ ç¼“å†²åŒºæœ¬è´¨ä¸Šæ˜¯ä¸€å—å¯ä»¥å†™å…¥æ•°æ®ï¼Œç„¶åå¯ä»¥ä»ä¸­è¯»å–æ•°æ®çš„å†…å­˜ã€‚è¿™å—å†…å­˜è¢«åŒ…è£…æˆ NIO Buffer å¯¹è±¡ï¼Œå¹¶æä¾›äº†ä¸€ç»„æ–¹æ³•ï¼Œç”¨æ¥æ–¹ä¾¿çš„è®¿é—®è¯¥å—å†…å­˜ã€‚ Buffer çš„åŸºæœ¬ç”¨æ³•ä½¿ç”¨ Buffer è¯»å†™æ•°æ®ä¸€èˆ¬éµå¾ªä»¥ä¸‹å››ä¸ªæ­¥éª¤ï¼š å†™å…¥æ•°æ®åˆ° Buffer è°ƒç”¨ flip() æ–¹æ³• ä» Buffer ä¸­è¯»å–æ•°æ® è°ƒç”¨ clear() æ–¹æ³•æˆ–è€… compact() æ–¹æ³• å½“å‘ buffer å†™å…¥æ•°æ®æ—¶ï¼Œbuffer ä¼šè®°å½•ä¸‹å†™äº†å¤šå°‘æ•°æ®ã€‚ä¸€æ—¦è¦è¯»å–æ•°æ®ï¼Œéœ€è¦å…ˆé€šè¿‡ flip() æ–¹æ³•å°† Buffer ä»å†™æ¨¡å¼åˆ‡æ¢åˆ°è¯»æ¨¡å¼ã€‚åœ¨è¯»æ¨¡å¼ä¸‹ï¼Œå¯ä»¥è¯»å–ä¹‹å‰å†™å…¥åˆ° buffer çš„æ‰€æœ‰æ•°æ®ã€‚ ä¸€æ—¦è¯»å®Œäº†æ‰€æœ‰çš„æ•°æ®ï¼Œå°±éœ€è¦æ¸…ç©ºç¼“å†²åŒºï¼Œè®©å®ƒå¯ä»¥å†æ¬¡è¢«å†™å…¥ã€‚æœ‰ä¸¤ç§æ–¹å¼èƒ½æ¸…ç©ºç¼“å†²åŒºï¼šè°ƒç”¨ clear() æˆ– compact() æ–¹æ³•ã€‚clear() æ–¹æ³•ä¼šæ¸…ç©ºæ•´ä¸ªç¼“å†²åŒºã€‚compact() æ–¹æ³•åªä¼šæ¸…é™¤å·²ç»è¯»è¿‡çš„æ•°æ®ï¼Œä»»ä½•æœªè¯»çš„æ•°æ®éƒ½è¢«ç§»åˆ°ç¼“å†²åŒºçš„èµ·å§‹å¤„ï¼Œæ–°å†™å…¥çš„æ•°æ®å°†æ”¾åˆ°ç¼“å†²åŒºæœªè¯»æ•°æ®çš„åé¢ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨Bufferçš„ä¾‹å­ï¼š 12345678910111213141516171819RandomAccessFile aFile = new RandomAccessFile(&quot;data/nio-data.txt&quot;, &quot;rw&quot;);FileChannel inChannel = aFile.getChannel();//create buffer with capacity of 48 bytesByteBuffer buf = ByteBuffer.allocate(48);int bytesRead = inChannel.read(buf); //read into buffer.while (bytesRead != -1) &#123; buf.flip(); //make buffer ready for read while(buf.hasRemaining())&#123; System.out.print((char) buf.get()); // read 1 byte at a time &#125; buf.clear(); //make buffer ready for writing bytesRead = inChannel.read(buf);&#125;aFile.close(); Buffer çš„ capacityã€ position å’Œ limitç¼“å†²åŒºæœ¬è´¨ä¸Šæ˜¯ä¸€å—å¯ä»¥å†™å…¥æ•°æ®ï¼Œç„¶åå¯ä»¥ä»ä¸­è¯»å–æ•°æ®çš„å†…å­˜ã€‚è¿™å—å†…å­˜è¢«åŒ…è£…æˆ NIO Buffer å¯¹è±¡ï¼Œå¹¶æä¾›äº†ä¸€ç»„æ–¹æ³•ï¼Œç”¨æ¥æ–¹ä¾¿çš„è®¿é—®è¯¥å—å†…å­˜ã€‚ ä¸ºäº†ç†è§£ Buffer çš„å·¥ä½œåŸç†ï¼Œéœ€è¦ç†Ÿæ‚‰å®ƒçš„ä¸‰ä¸ªå±æ€§ï¼š capacity position limit position å’Œ limit çš„å«ä¹‰å–å†³äº Buffer å¤„åœ¨è¯»æ¨¡å¼è¿˜æ˜¯å†™æ¨¡å¼ã€‚ä¸ç®¡ Buffer å¤„åœ¨ä»€ä¹ˆæ¨¡å¼ï¼Œcapacity çš„å«ä¹‰æ€»æ˜¯ä¸€æ ·çš„ã€‚ è¿™é‡Œæœ‰ä¸€ä¸ªå…³äº capacityï¼Œposition å’Œ limit åœ¨è¯»å†™æ¨¡å¼ä¸­çš„è¯´æ˜ï¼Œè¯¦ç»†çš„è§£é‡Šåœ¨æ’å›¾åé¢ã€‚ capacity ä½œä¸ºä¸€ä¸ªå†…å­˜å—ï¼ŒBuffer æœ‰ä¸€ä¸ªå›ºå®šçš„å¤§å°å€¼ï¼Œä¹Ÿå«â€œcapacityâ€.ä½ åªèƒ½å¾€é‡Œå†™ capacity ä¸ªbyteã€longï¼Œchar ç­‰ç±»å‹ã€‚ä¸€æ—¦ Buffer æ»¡äº†ï¼Œéœ€è¦å°†å…¶æ¸…ç©ºï¼ˆé€šè¿‡è¯»æ•°æ®æˆ–è€…æ¸…é™¤æ•°æ®ï¼‰æ‰èƒ½ç»§ç»­å†™æ•°æ®å¾€é‡Œå†™æ•°æ®ã€‚ position å½“ä½ å†™æ•°æ®åˆ° Buffer ä¸­æ—¶ï¼Œposition è¡¨ç¤ºå½“å‰çš„ä½ç½®ã€‚åˆå§‹çš„ position å€¼ä¸º 0ã€‚å½“ä¸€ä¸ª byteã€long ç­‰æ•°æ®å†™åˆ° Buffer åï¼Œ position ä¼šå‘å‰ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå¯æ’å…¥æ•°æ®çš„ Buffer å•å…ƒã€‚position æœ€å¤§å¯ä¸º capacity â€“ 1. å½“è¯»å–æ•°æ®æ—¶ï¼Œä¹Ÿæ˜¯ä»æŸä¸ªç‰¹å®šä½ç½®è¯»ã€‚å½“å°† Buffer ä»å†™æ¨¡å¼åˆ‡æ¢åˆ°è¯»æ¨¡å¼ï¼Œposition ä¼šè¢«é‡ç½®ä¸º 0. å½“ä» Buffer çš„ position å¤„è¯»å–æ•°æ®æ—¶ï¼Œposition å‘å‰ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå¯è¯»çš„ä½ç½®ã€‚ limit åœ¨å†™æ¨¡å¼ä¸‹ï¼ŒBuffer çš„ limit è¡¨ç¤ºä½ æœ€å¤šèƒ½å¾€ Buffer é‡Œå†™å¤šå°‘æ•°æ®ã€‚ å†™æ¨¡å¼ä¸‹ï¼Œlimit ç­‰äºBuffer çš„ capacityã€‚ å½“åˆ‡æ¢ Buffer åˆ°è¯»æ¨¡å¼æ—¶ï¼Œ limit è¡¨ç¤ºä½ æœ€å¤šèƒ½è¯»åˆ°å¤šå°‘æ•°æ®ã€‚å› æ­¤ï¼Œå½“åˆ‡æ¢ Buffer åˆ°è¯»æ¨¡å¼æ—¶ï¼Œlimit ä¼šè¢«è®¾ç½®æˆå†™æ¨¡å¼ä¸‹çš„ position å€¼ã€‚æ¢å¥è¯è¯´ï¼Œä½ èƒ½è¯»åˆ°ä¹‹å‰å†™å…¥çš„æ‰€æœ‰æ•°æ®ï¼ˆlimitè¢«è®¾ç½®æˆå·²å†™æ•°æ®çš„æ•°é‡ï¼Œè¿™ä¸ªå€¼åœ¨å†™æ¨¡å¼ä¸‹å°±æ˜¯ positionï¼‰ Bufferçš„ç±»å‹Java NIO æœ‰ä»¥ä¸‹Bufferç±»å‹ ByteBuffer MappedByteBuffer CharBuffer DoubleBuffer FloatBuffer IntBuffer LongBuffer ShortBuffer å¦‚ä½ æ‰€è§ï¼Œè¿™äº›Bufferç±»å‹ä»£è¡¨äº†ä¸åŒçš„æ•°æ®ç±»å‹ã€‚æ¢å¥è¯è¯´ï¼Œå°±æ˜¯å¯ä»¥é€šè¿‡charï¼Œshortï¼Œintï¼Œlongï¼Œfloat æˆ– doubleç±»å‹æ¥æ“ä½œç¼“å†²åŒºä¸­çš„å­—èŠ‚ã€‚ MappedByteBuffer æœ‰äº›ç‰¹åˆ«ï¼Œåœ¨æ¶‰åŠå®ƒçš„ä¸“é—¨ç« èŠ‚ä¸­å†è®²ã€‚ Buffer çš„åˆ†é…è¦æƒ³è·å¾—ä¸€ä¸ª Buffer å¯¹è±¡é¦–å…ˆè¦è¿›è¡Œåˆ†é…ã€‚ æ¯ä¸€ä¸ª Buffer ç±»éƒ½æœ‰ä¸€ä¸ª allocate æ–¹æ³•ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªåˆ†é…48å­—èŠ‚ capacity çš„ ByteBuffer çš„ä¾‹å­ã€‚ 1ByteBuffer buf = ByteBuffer.allocate(48); è¿™æ˜¯åˆ†é…ä¸€ä¸ªå¯å­˜å‚¨1024ä¸ªå­—ç¬¦çš„ CharBufferï¼š 1CharBuffer buf = CharBuffer.allocate(1024); å‘ Buffer ä¸­å†™æ•°æ®å†™æ•°æ®åˆ° Buffer æœ‰ä¸¤ç§æ–¹å¼ï¼š ä» Channel å†™åˆ° Bufferã€‚ é€šè¿‡ Buffer çš„ put() æ–¹æ³•å†™åˆ° Buffer é‡Œã€‚ ä» Channel å†™åˆ° Buffer çš„ä¾‹å­ï¼š 1int bytesRead = inChannel.read(buf); //read into buffer. é€šè¿‡putæ–¹æ³•å†™Bufferçš„ä¾‹å­ï¼š 1buf.put(127); put æ–¹æ³•æœ‰å¾ˆå¤šç‰ˆæœ¬ï¼Œå…è®¸ä½ ä»¥ä¸åŒçš„æ–¹å¼æŠŠæ•°æ®å†™å…¥åˆ° Buffer ä¸­ã€‚ä¾‹å¦‚ï¼Œ å†™åˆ°ä¸€ä¸ªæŒ‡å®šçš„ä½ç½®ï¼Œæˆ–è€…æŠŠä¸€ä¸ªå­—èŠ‚æ•°ç»„å†™å…¥åˆ° Bufferã€‚ æ›´å¤šBufferå®ç°çš„ç»†èŠ‚å‚è€ƒJavaDocã€‚ flip() æ–¹æ³• flip() æ–¹æ³•å°† Buffer ä»å†™æ¨¡å¼åˆ‡æ¢åˆ°è¯»æ¨¡å¼ã€‚è°ƒç”¨ flip() æ–¹æ³•ä¼šå°† position è®¾å› 0ï¼Œå¹¶å°† limit è®¾ç½®æˆä¹‹å‰ position çš„å€¼ã€‚ æ¢å¥è¯è¯´ï¼Œposition ç°åœ¨ç”¨äºæ ‡è®°è¯»çš„ä½ç½®ï¼Œlimit è¡¨ç¤ºä¹‹å‰å†™è¿›äº†å¤šå°‘ä¸ª byteã€charç­‰ â€”â€” ç°åœ¨èƒ½è¯»å–å¤šå°‘ä¸ªbyteã€charç­‰ã€‚ ä»Bufferä¸­è¯»å–æ•°æ®ä»Bufferä¸­è¯»å–æ•°æ®æœ‰ä¸¤ç§æ–¹å¼ï¼š ä»Bufferè¯»å–æ•°æ®åˆ°Channelã€‚ ä½¿ç”¨get()æ–¹æ³•ä»Bufferä¸­è¯»å–æ•°æ®ã€‚ ä»Bufferè¯»å–æ•°æ®åˆ°Channelçš„ä¾‹å­ï¼š 12//read from buffer into channel.int bytesWritten = inChannel.write(buf); ä½¿ç”¨get()æ–¹æ³•ä»Bufferä¸­è¯»å–æ•°æ®çš„ä¾‹å­ 1byte aByte = buf.get(); getæ–¹æ³•æœ‰å¾ˆå¤šç‰ˆæœ¬ï¼Œå…è®¸ä½ ä»¥ä¸åŒçš„æ–¹å¼ä»Bufferä¸­è¯»å–æ•°æ®ã€‚ä¾‹å¦‚ï¼Œä»æŒ‡å®špositionè¯»å–ï¼Œæˆ–è€…ä»Bufferä¸­è¯»å–æ•°æ®åˆ°å­—èŠ‚æ•°ç»„ã€‚æ›´å¤šBufferå®ç°çš„ç»†èŠ‚å‚è€ƒJavaDocã€‚ rewind()æ–¹æ³•Buffer.rewind()å°†positionè®¾å›0ï¼Œæ‰€ä»¥ä½ å¯ä»¥é‡è¯»Bufferä¸­çš„æ‰€æœ‰æ•°æ®ã€‚limitä¿æŒä¸å˜ï¼Œä»ç„¶è¡¨ç¤ºèƒ½ä»Bufferä¸­è¯»å–å¤šå°‘ä¸ªå…ƒç´ ï¼ˆbyteã€charç­‰ï¼‰ã€‚ clear()ä¸compact()æ–¹æ³•ä¸€æ—¦è¯»å®ŒBufferä¸­çš„æ•°æ®ï¼Œéœ€è¦è®©Bufferå‡†å¤‡å¥½å†æ¬¡è¢«å†™å…¥ã€‚å¯ä»¥é€šè¿‡clear()æˆ–compact()æ–¹æ³•æ¥å®Œæˆã€‚ å¦‚æœè°ƒç”¨çš„æ˜¯clear()æ–¹æ³•ï¼Œpositionå°†è¢«è®¾å›0ï¼Œlimitè¢«è®¾ç½®æˆ capacityçš„å€¼ã€‚æ¢å¥è¯è¯´ï¼ŒBuffer è¢«æ¸…ç©ºäº†ã€‚Bufferä¸­çš„æ•°æ®å¹¶æœªæ¸…é™¤ï¼Œåªæ˜¯è¿™äº›æ ‡è®°å‘Šè¯‰æˆ‘ä»¬å¯ä»¥ä»å“ªé‡Œå¼€å§‹å¾€Bufferé‡Œå†™æ•°æ®ã€‚ å¦‚æœBufferä¸­æœ‰ä¸€äº›æœªè¯»çš„æ•°æ®ï¼Œè°ƒç”¨clear()æ–¹æ³•ï¼Œæ•°æ®å°†â€œè¢«é—å¿˜â€ï¼Œæ„å‘³ç€ä¸å†æœ‰ä»»ä½•æ ‡è®°ä¼šå‘Šè¯‰ä½ å“ªäº›æ•°æ®è¢«è¯»è¿‡ï¼Œå“ªäº›è¿˜æ²¡æœ‰ã€‚ å¦‚æœBufferä¸­ä»æœ‰æœªè¯»çš„æ•°æ®ï¼Œä¸”åç»­è¿˜éœ€è¦è¿™äº›æ•°æ®ï¼Œä½†æ˜¯æ­¤æ—¶æƒ³è¦å…ˆå…ˆå†™äº›æ•°æ®ï¼Œé‚£ä¹ˆä½¿ç”¨compact()æ–¹æ³•ã€‚ compact()æ–¹æ³•å°†æ‰€æœ‰æœªè¯»çš„æ•°æ®æ‹·è´åˆ°Bufferèµ·å§‹å¤„ã€‚ç„¶åå°†positionè®¾åˆ°æœ€åä¸€ä¸ªæœªè¯»å…ƒç´ æ­£åé¢ã€‚limitå±æ€§ä¾ç„¶åƒclear()æ–¹æ³•ä¸€æ ·ï¼Œè®¾ç½®æˆcapacityã€‚ç°åœ¨Bufferå‡†å¤‡å¥½å†™æ•°æ®äº†ï¼Œä½†æ˜¯ä¸ä¼šè¦†ç›–æœªè¯»çš„æ•°æ®ã€‚ mark()ä¸reset()æ–¹æ³•é€šè¿‡è°ƒç”¨Buffer.mark()æ–¹æ³•ï¼Œå¯ä»¥æ ‡è®°Bufferä¸­çš„ä¸€ä¸ªç‰¹å®špositionã€‚ä¹‹åå¯ä»¥é€šè¿‡è°ƒç”¨Buffer.reset()æ–¹æ³•æ¢å¤åˆ°è¿™ä¸ªpositionã€‚ä¾‹å¦‚ï¼š 123buffer.mark();//call buffer.get() a couple of times, e.g. during parsing.buffer.reset(); //set position back to mark. equals()ä¸compareTo()æ–¹æ³•å¯ä»¥ä½¿ç”¨equals()å’ŒcompareTo()æ–¹æ³•ä¸¤ä¸ªBufferã€‚ equals() å½“æ»¡è¶³ä¸‹åˆ—æ¡ä»¶æ—¶ï¼Œè¡¨ç¤ºä¸¤ä¸ªBufferç›¸ç­‰ï¼š æœ‰ç›¸åŒçš„ç±»å‹ï¼ˆbyteã€charã€intç­‰ï¼‰ã€‚ Bufferä¸­å‰©ä½™çš„byteã€charç­‰çš„ä¸ªæ•°ç›¸ç­‰ã€‚ Bufferä¸­æ‰€æœ‰å‰©ä½™çš„byteã€charç­‰éƒ½ç›¸åŒã€‚ å¦‚ä½ æ‰€è§ï¼Œequalsåªæ˜¯æ¯”è¾ƒBufferçš„ä¸€éƒ¨åˆ†ï¼Œä¸æ˜¯æ¯ä¸€ä¸ªåœ¨å®ƒé‡Œé¢çš„å…ƒç´ éƒ½æ¯”è¾ƒã€‚å®é™…ä¸Šï¼Œå®ƒåªæ¯”è¾ƒBufferä¸­çš„å‰©ä½™å…ƒç´ ã€‚ compareTo()æ–¹æ³• compareTo()æ–¹æ³•æ¯”è¾ƒä¸¤ä¸ªBufferçš„å‰©ä½™å…ƒç´ (byteã€charç­‰)ï¼Œ å¦‚æœæ»¡è¶³ä¸‹åˆ—æ¡ä»¶ï¼Œåˆ™è®¤ä¸ºä¸€ä¸ªBufferâ€œå°äºâ€å¦ä¸€ä¸ªBufferï¼š ç¬¬ä¸€ä¸ªä¸ç›¸ç­‰çš„å…ƒç´ å°äºå¦ä¸€ä¸ªBufferä¸­å¯¹åº”çš„å…ƒç´  ã€‚ æ‰€æœ‰å…ƒç´ éƒ½ç›¸ç­‰ï¼Œä½†ç¬¬ä¸€ä¸ªBufferæ¯”å¦ä¸€ä¸ªå…ˆè€—å°½(ç¬¬ä¸€ä¸ªBufferçš„å…ƒç´ ä¸ªæ•°æ¯”å¦ä¸€ä¸ªå°‘)ã€‚ ï¼ˆè¯‘æ³¨ï¼šå‰©ä½™å…ƒç´ æ˜¯ä» positionåˆ°limitä¹‹é—´çš„å…ƒç´ ï¼‰ 4ã€Scatter/GatherJava NIO å¼€å§‹æ”¯æŒ scatter/gatherï¼Œscatter/gather ç”¨äºæè¿°ä» Channelï¼ˆè¯‘è€…æ³¨ï¼šChannel åœ¨ä¸­æ–‡ç»å¸¸ç¿»è¯‘ä¸ºé€šé“ï¼‰ä¸­è¯»å–æˆ–è€…å†™å…¥åˆ° Channel çš„æ“ä½œã€‚ åˆ†æ•£ï¼ˆscatterï¼‰ä» Channel ä¸­è¯»å–æ˜¯æŒ‡åœ¨è¯»æ“ä½œæ—¶å°†è¯»å–çš„æ•°æ®å†™å…¥å¤šä¸ª buffer ä¸­ã€‚å› æ­¤ï¼ŒChannel å°†ä» Channel ä¸­è¯»å–çš„æ•°æ®â€œåˆ†æ•£ï¼ˆscatterï¼‰â€åˆ°å¤šä¸ªBufferä¸­ã€‚ èšé›†ï¼ˆgatherï¼‰å†™å…¥Channelæ˜¯æŒ‡åœ¨å†™æ“ä½œæ—¶å°†å¤šä¸ªbufferçš„æ•°æ®å†™å…¥åŒä¸€ä¸ªChannelï¼Œå› æ­¤ï¼ŒChannel å°†å¤šä¸ªBufferä¸­çš„æ•°æ®â€œèšé›†ï¼ˆgatherï¼‰â€åå‘é€åˆ°Channelã€‚ scatter / gatherç»å¸¸ç”¨äºéœ€è¦å°†ä¼ è¾“çš„æ•°æ®åˆ†å¼€å¤„ç†çš„åœºåˆï¼Œä¾‹å¦‚ä¼ è¾“ä¸€ä¸ªç”±æ¶ˆæ¯å¤´å’Œæ¶ˆæ¯ä½“ç»„æˆçš„æ¶ˆæ¯ï¼Œä½ å¯èƒ½ä¼šå°†æ¶ˆæ¯ä½“å’Œæ¶ˆæ¯å¤´åˆ†æ•£åˆ°ä¸åŒçš„bufferä¸­ï¼Œè¿™æ ·ä½ å¯ä»¥æ–¹ä¾¿çš„å¤„ç†æ¶ˆæ¯å¤´å’Œæ¶ˆæ¯ä½“ã€‚ Scattering ReadsScattering Readsæ˜¯æŒ‡æ•°æ®ä»ä¸€ä¸ªchannelè¯»å–åˆ°å¤šä¸ªbufferä¸­ã€‚å¦‚ä¸‹å›¾æè¿°ï¼š ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š 123456ByteBuffer header = ByteBuffer.allocate(128);ByteBuffer body = ByteBuffer.allocate(1024);ByteBuffer[] bufferArray = &#123; header, body &#125;;channel.read(bufferArray); æ³¨æ„bufferé¦–å…ˆè¢«æ’å…¥åˆ°æ•°ç»„ï¼Œç„¶åå†å°†æ•°ç»„ä½œä¸ºchannel.read() çš„è¾“å…¥å‚æ•°ã€‚read()æ–¹æ³•æŒ‰ç…§bufferåœ¨æ•°ç»„ä¸­çš„é¡ºåºå°†ä»channelä¸­è¯»å–çš„æ•°æ®å†™å…¥åˆ°bufferï¼Œå½“ä¸€ä¸ªbufferè¢«å†™æ»¡åï¼Œchannelç´§æ¥ç€å‘å¦ä¸€ä¸ªbufferä¸­å†™ã€‚ Scattering Readsåœ¨ç§»åŠ¨ä¸‹ä¸€ä¸ªbufferå‰ï¼Œå¿…é¡»å¡«æ»¡å½“å‰çš„bufferï¼Œè¿™ä¹Ÿæ„å‘³ç€å®ƒä¸é€‚ç”¨äºåŠ¨æ€æ¶ˆæ¯(è¯‘è€…æ³¨ï¼šæ¶ˆæ¯å¤§å°ä¸å›ºå®š)ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœå­˜åœ¨æ¶ˆæ¯å¤´å’Œæ¶ˆæ¯ä½“ï¼Œæ¶ˆæ¯å¤´å¿…é¡»å®Œæˆå¡«å……ï¼ˆä¾‹å¦‚ 128byteï¼‰ï¼ŒScattering Readsæ‰èƒ½æ­£å¸¸å·¥ä½œã€‚ Gathering WritesGathering Writesæ˜¯æŒ‡æ•°æ®ä»å¤šä¸ªbufferå†™å…¥åˆ°åŒä¸€ä¸ªchannelã€‚å¦‚ä¸‹å›¾æè¿°ï¼š ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š 12345678ByteBuffer header = ByteBuffer.allocate(128);ByteBuffer body = ByteBuffer.allocate(1024);//write data into buffersByteBuffer[] bufferArray = &#123; header, body &#125;;channel.write(bufferArray); buffersæ•°ç»„æ˜¯write()æ–¹æ³•çš„å…¥å‚ï¼Œwrite()æ–¹æ³•ä¼šæŒ‰ç…§bufferåœ¨æ•°ç»„ä¸­çš„é¡ºåºï¼Œå°†æ•°æ®å†™å…¥åˆ°channelï¼Œæ³¨æ„åªæœ‰positionå’Œlimitä¹‹é—´çš„æ•°æ®æ‰ä¼šè¢«å†™å…¥ã€‚å› æ­¤ï¼Œå¦‚æœä¸€ä¸ªbufferçš„å®¹é‡ä¸º128byteï¼Œä½†æ˜¯ä»…ä»…åŒ…å«58byteçš„æ•°æ®ï¼Œé‚£ä¹ˆè¿™58byteçš„æ•°æ®å°†è¢«å†™å…¥åˆ°channelä¸­ã€‚å› æ­¤ä¸Scattering Readsç›¸åï¼ŒGathering Writesèƒ½è¾ƒå¥½çš„å¤„ç†åŠ¨æ€æ¶ˆæ¯ã€‚ 5ã€é€šé“ä¹‹é—´çš„æ•°æ®ä¼ è¾“åœ¨Java NIOä¸­ï¼Œå¦‚æœä¸¤ä¸ªé€šé“ä¸­æœ‰ä¸€ä¸ªæ˜¯FileChannelï¼Œé‚£ä½ å¯ä»¥ç›´æ¥å°†æ•°æ®ä»ä¸€ä¸ªchannelï¼ˆè¯‘è€…æ³¨ï¼šchannelä¸­æ–‡å¸¸è¯‘ä½œé€šé“ï¼‰ä¼ è¾“åˆ°å¦å¤–ä¸€ä¸ªchannelã€‚ transferFrom()FileChannelçš„transferFrom()æ–¹æ³•å¯ä»¥å°†æ•°æ®ä»æºé€šé“ä¼ è¾“åˆ°FileChannelä¸­ï¼ˆè¯‘è€…æ³¨ï¼šè¿™ä¸ªæ–¹æ³•åœ¨JDKæ–‡æ¡£ä¸­çš„è§£é‡Šä¸ºå°†å­—èŠ‚ä»ç»™å®šçš„å¯è¯»å–å­—èŠ‚é€šé“ä¼ è¾“åˆ°æ­¤é€šé“çš„æ–‡ä»¶ä¸­ï¼‰ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š 12345678910RandomAccessFile fromFile = new RandomAccessFile(&quot;fromFile.txt&quot;, &quot;rw&quot;);FileChannel fromChannel = fromFile.getChannel();RandomAccessFile toFile = new RandomAccessFile(&quot;toFile.txt&quot;, &quot;rw&quot;);FileChannel toChannel = toFile.getChannel();long position = 0;long count = fromChannel.size();toChannel.transferFrom(position, count, fromChannel); æ–¹æ³•çš„è¾“å…¥å‚æ•°positionè¡¨ç¤ºä»positionå¤„å¼€å§‹å‘ç›®æ ‡æ–‡ä»¶å†™å…¥æ•°æ®ï¼Œcountè¡¨ç¤ºæœ€å¤šä¼ è¾“çš„å­—èŠ‚æ•°ã€‚å¦‚æœæºé€šé“çš„å‰©ä½™ç©ºé—´å°äº count ä¸ªå­—èŠ‚ï¼Œåˆ™æ‰€ä¼ è¾“çš„å­—èŠ‚æ•°è¦å°äºè¯·æ±‚çš„å­—èŠ‚æ•°ã€‚ æ­¤å¤–è¦æ³¨æ„ï¼Œåœ¨SoketChannelçš„å®ç°ä¸­ï¼ŒSocketChannelåªä¼šä¼ è¾“æ­¤åˆ»å‡†å¤‡å¥½çš„æ•°æ®ï¼ˆå¯èƒ½ä¸è¶³countå­—èŠ‚ï¼‰ã€‚å› æ­¤ï¼ŒSocketChannelå¯èƒ½ä¸ä¼šå°†è¯·æ±‚çš„æ‰€æœ‰æ•°æ®(countä¸ªå­—èŠ‚)å…¨éƒ¨ä¼ è¾“åˆ°FileChannelä¸­ã€‚ transferTo()transferTo()æ–¹æ³•å°†æ•°æ®ä»FileChannelä¼ è¾“åˆ°å…¶ä»–çš„channelä¸­ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š 12345678910RandomAccessFile fromFile = new RandomAccessFile(&quot;fromFile.txt&quot;, &quot;rw&quot;);FileChannel fromChannel = fromFile.getChannel();RandomAccessFile toFile = new RandomAccessFile(&quot;toFile.txt&quot;, &quot;rw&quot;);FileChannel toChannel = toFile.getChannel();long position = 0;long count = fromChannel.size();fromChannel.transferTo(position, count, toChannel); æ˜¯ä¸æ˜¯å‘ç°è¿™ä¸ªä¾‹å­å’Œå‰é¢é‚£ä¸ªä¾‹å­ç‰¹åˆ«ç›¸ä¼¼ï¼Ÿé™¤äº†è°ƒç”¨æ–¹æ³•çš„FileChannelå¯¹è±¡ä¸ä¸€æ ·å¤–ï¼Œå…¶ä»–çš„éƒ½ä¸€æ ·ã€‚ ä¸Šé¢æ‰€è¯´çš„å…³äºSocketChannelçš„é—®é¢˜åœ¨transferTo()æ–¹æ³•ä¸­åŒæ ·å­˜åœ¨ã€‚SocketChannelä¼šä¸€ç›´ä¼ è¾“æ•°æ®ç›´åˆ°ç›®æ ‡bufferè¢«å¡«æ»¡ã€‚ 6ã€SelectorSelectorï¼ˆé€‰æ‹©å™¨ï¼‰æ˜¯Java NIOä¸­èƒ½å¤Ÿæ£€æµ‹ä¸€åˆ°å¤šä¸ªNIOé€šé“ï¼Œå¹¶èƒ½å¤ŸçŸ¥æ™“é€šé“æ˜¯å¦ä¸ºè¯¸å¦‚è¯»å†™äº‹ä»¶åšå¥½å‡†å¤‡çš„ç»„ä»¶ã€‚è¿™æ ·ï¼Œä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹å¯ä»¥ç®¡ç†å¤šä¸ªchannelï¼Œä»è€Œç®¡ç†å¤šä¸ªç½‘ç»œè¿æ¥ã€‚ ä¸ºä»€ä¹ˆä½¿ç”¨Selector?ä»…ç”¨å•ä¸ªçº¿ç¨‹æ¥å¤„ç†å¤šä¸ªChannelsçš„å¥½å¤„æ˜¯ï¼Œåªéœ€è¦æ›´å°‘çš„çº¿ç¨‹æ¥å¤„ç†é€šé“ã€‚äº‹å®ä¸Šï¼Œå¯ä»¥åªç”¨ä¸€ä¸ªçº¿ç¨‹å¤„ç†æ‰€æœ‰çš„é€šé“ã€‚å¯¹äºæ“ä½œç³»ç»Ÿæ¥è¯´ï¼Œçº¿ç¨‹ä¹‹é—´ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€å¾ˆå¤§ï¼Œè€Œä¸”æ¯ä¸ªçº¿ç¨‹éƒ½è¦å ç”¨ç³»ç»Ÿçš„ä¸€äº›èµ„æºï¼ˆå¦‚å†…å­˜ï¼‰ã€‚å› æ­¤ï¼Œä½¿ç”¨çš„çº¿ç¨‹è¶Šå°‘è¶Šå¥½ã€‚ ä½†æ˜¯ï¼Œéœ€è¦è®°ä½ï¼Œç°ä»£çš„æ“ä½œç³»ç»Ÿå’ŒCPUåœ¨å¤šä»»åŠ¡æ–¹é¢è¡¨ç°çš„è¶Šæ¥è¶Šå¥½ï¼Œæ‰€ä»¥å¤šçº¿ç¨‹çš„å¼€é”€éšç€æ—¶é—´çš„æ¨ç§»ï¼Œå˜å¾—è¶Šæ¥è¶Šå°äº†ã€‚å®é™…ä¸Šï¼Œå¦‚æœä¸€ä¸ªCPUæœ‰å¤šä¸ªå†…æ ¸ï¼Œä¸ä½¿ç”¨å¤šä»»åŠ¡å¯èƒ½æ˜¯åœ¨æµªè´¹CPUèƒ½åŠ›ã€‚ä¸ç®¡æ€ä¹ˆè¯´ï¼Œå…³äºé‚£ç§è®¾è®¡çš„è®¨è®ºåº”è¯¥æ”¾åœ¨å¦ä¸€ç¯‡ä¸åŒçš„æ–‡ç« ä¸­ã€‚åœ¨è¿™é‡Œï¼Œåªè¦çŸ¥é“ä½¿ç”¨Selectorèƒ½å¤Ÿå¤„ç†å¤šä¸ªé€šé“å°±è¶³å¤Ÿäº†ã€‚ ä¸‹é¢æ˜¯å•çº¿ç¨‹ä½¿ç”¨ä¸€ä¸ªSelectorå¤„ç†3ä¸ªchannelçš„ç¤ºä¾‹å›¾ï¼š Selectorçš„åˆ›å»ºé€šè¿‡è°ƒç”¨Selector.open()æ–¹æ³•åˆ›å»ºä¸€ä¸ªSelectorï¼Œå¦‚ä¸‹ï¼š 1Selector selector = Selector.open(); å‘Selectoræ³¨å†Œé€šé“ä¸ºäº†å°†Channelå’ŒSelectoré…åˆä½¿ç”¨ï¼Œå¿…é¡»å°†channelæ³¨å†Œåˆ°selectorä¸Šã€‚é€šè¿‡SelectableChannel.register()æ–¹æ³•æ¥å®ç°ï¼Œå¦‚ä¸‹ï¼š 123channel.configureBlocking(false);SelectionKey key = channel.register(selector, Selectionkey.OP_READ); ä¸Selectorä¸€èµ·ä½¿ç”¨æ—¶ï¼ŒChannelå¿…é¡»å¤„äºéé˜»å¡æ¨¡å¼ä¸‹ã€‚è¿™æ„å‘³ç€ä¸èƒ½å°†FileChannelä¸Selectorä¸€èµ·ä½¿ç”¨ï¼Œå› ä¸ºFileChannelä¸èƒ½åˆ‡æ¢åˆ°éé˜»å¡æ¨¡å¼ã€‚è€Œå¥—æ¥å­—é€šé“éƒ½å¯ä»¥ã€‚ æ³¨æ„register()æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°ã€‚è¿™æ˜¯ä¸€ä¸ªâ€œinteresté›†åˆâ€ï¼Œæ„æ€æ˜¯åœ¨é€šè¿‡Selectorç›‘å¬Channelæ—¶å¯¹ä»€ä¹ˆäº‹ä»¶æ„Ÿå…´è¶£ã€‚å¯ä»¥ç›‘å¬å››ç§ä¸åŒç±»å‹çš„äº‹ä»¶ï¼š Connect Accept Read Write é€šé“è§¦å‘äº†ä¸€ä¸ªäº‹ä»¶æ„æ€æ˜¯è¯¥äº‹ä»¶å·²ç»å°±ç»ªã€‚æ‰€ä»¥ï¼ŒæŸä¸ªchannelæˆåŠŸè¿æ¥åˆ°å¦ä¸€ä¸ªæœåŠ¡å™¨ç§°ä¸ºâ€œè¿æ¥å°±ç»ªâ€ã€‚ä¸€ä¸ªserver socket channelå‡†å¤‡å¥½æ¥æ”¶æ–°è¿›å…¥çš„è¿æ¥ç§°ä¸ºâ€œæ¥æ”¶å°±ç»ªâ€ã€‚ä¸€ä¸ªæœ‰æ•°æ®å¯è¯»çš„é€šé“å¯ä»¥è¯´æ˜¯â€œè¯»å°±ç»ªâ€ã€‚ç­‰å¾…å†™æ•°æ®çš„é€šé“å¯ä»¥è¯´æ˜¯â€œå†™å°±ç»ªâ€ã€‚ è¿™å››ç§äº‹ä»¶ç”¨SelectionKeyçš„å››ä¸ªå¸¸é‡æ¥è¡¨ç¤ºï¼š SelectionKey.OP_CONNECT SelectionKey.OP_ACCEPT SelectionKey.OP_READ SelectionKey.OP_WRITE å¦‚æœä½ å¯¹ä¸æ­¢ä¸€ç§äº‹ä»¶æ„Ÿå…´è¶£ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨â€œä½æˆ–â€æ“ä½œç¬¦å°†å¸¸é‡è¿æ¥èµ·æ¥ï¼Œå¦‚ä¸‹ï¼š 1int interestSet = SelectionKey.OP_READ | SelectionKey.OP_WRITE; åœ¨ä¸‹é¢è¿˜ä¼šç»§ç»­æåˆ°interesté›†åˆã€‚ SelectionKeyåœ¨ä¸Šä¸€å°èŠ‚ä¸­ï¼Œå½“å‘Selectoræ³¨å†ŒChannelæ—¶ï¼Œregister()æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªSelectionKeyå¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡åŒ…å«äº†ä¸€äº›ä½ æ„Ÿå…´è¶£çš„å±æ€§ï¼š interesté›†åˆ readyé›†åˆ Channel Selector é™„åŠ çš„å¯¹è±¡ï¼ˆå¯é€‰ï¼‰ä¸‹é¢æˆ‘ä¼šæè¿°è¿™äº›å±æ€§ã€‚ interesté›†åˆå°±åƒå‘Selectoræ³¨å†Œé€šé“ä¸€èŠ‚ä¸­æ‰€æè¿°çš„ï¼Œinteresté›†åˆæ˜¯ä½ æ‰€é€‰æ‹©çš„æ„Ÿå…´è¶£çš„äº‹ä»¶é›†åˆã€‚å¯ä»¥é€šè¿‡SelectionKeyè¯»å†™interesté›†åˆï¼Œåƒè¿™æ ·ï¼š 123456int interestSet = selectionKey.interestOps();boolean isInterestedInAccept = (interestSet &amp; SelectionKey.OP_ACCEPT) == SelectionKey.OP_ACCEPTï¼›boolean isInterestedInConnect = interestSet &amp; SelectionKey.OP_CONNECT;boolean isInterestedInRead = interestSet &amp; SelectionKey.OP_READ;boolean isInterestedInWrite = interestSet &amp; SelectionKey.OP_WRITE; å¯ä»¥çœ‹åˆ°ï¼Œç”¨â€œä½ä¸â€æ“ä½œinterest é›†åˆå’Œç»™å®šçš„SelectionKeyå¸¸é‡ï¼Œå¯ä»¥ç¡®å®šæŸä¸ªç¡®å®šçš„äº‹ä»¶æ˜¯å¦åœ¨interest é›†åˆä¸­ã€‚ readyé›†åˆready é›†åˆæ˜¯é€šé“å·²ç»å‡†å¤‡å°±ç»ªçš„æ“ä½œçš„é›†åˆã€‚åœ¨ä¸€æ¬¡é€‰æ‹©(Selection)ä¹‹åï¼Œä½ ä¼šé¦–å…ˆè®¿é—®è¿™ä¸ªready setã€‚Selectionå°†åœ¨ä¸‹ä¸€å°èŠ‚è¿›è¡Œè§£é‡Šã€‚å¯ä»¥è¿™æ ·è®¿é—®readyé›†åˆï¼š 1int readySet = selectionKey.readyOps(); å¯ä»¥ç”¨åƒæ£€æµ‹interesté›†åˆé‚£æ ·çš„æ–¹æ³•ï¼Œæ¥æ£€æµ‹channelä¸­ä»€ä¹ˆäº‹ä»¶æˆ–æ“ä½œå·²ç»å°±ç»ªã€‚ä½†æ˜¯ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å››ä¸ªæ–¹æ³•ï¼Œå®ƒä»¬éƒ½ä¼šè¿”å›ä¸€ä¸ªå¸ƒå°”ç±»å‹ï¼š 1234selectionKey.isAcceptable();selectionKey.isConnectable();selectionKey.isReadable();selectionKey.isWritable(); Channel + Selectorä»SelectionKeyè®¿é—®Channelå’ŒSelectorå¾ˆç®€å•ã€‚å¦‚ä¸‹ï¼š 12Channel channel = selectionKey.channel();Selector selector = selectionKey.selector(); é™„åŠ çš„å¯¹è±¡å¯ä»¥å°†ä¸€ä¸ªå¯¹è±¡æˆ–è€…æ›´å¤šä¿¡æ¯é™„ç€åˆ°SelectionKeyä¸Šï¼Œè¿™æ ·å°±èƒ½æ–¹ä¾¿çš„è¯†åˆ«æŸä¸ªç»™å®šçš„é€šé“ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥é™„åŠ  ä¸é€šé“ä¸€èµ·ä½¿ç”¨çš„Bufferï¼Œæˆ–æ˜¯åŒ…å«èšé›†æ•°æ®çš„æŸä¸ªå¯¹è±¡ã€‚ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š 12selectionKey.attach(theObject);Object attachedObj = selectionKey.attachment(); è¿˜å¯ä»¥åœ¨ç”¨register()æ–¹æ³•å‘Selectoræ³¨å†ŒChannelçš„æ—¶å€™é™„åŠ å¯¹è±¡ã€‚å¦‚ï¼š 1SelectionKey key = channel.register(selector, SelectionKey.OP_READ, theObject); é€šè¿‡Selectoré€‰æ‹©é€šé“ä¸€æ—¦å‘Selectoræ³¨å†Œäº†ä¸€æˆ–å¤šä¸ªé€šé“ï¼Œå°±å¯ä»¥è°ƒç”¨å‡ ä¸ªé‡è½½çš„select()æ–¹æ³•ã€‚è¿™äº›æ–¹æ³•è¿”å›ä½ æ‰€æ„Ÿå…´è¶£çš„äº‹ä»¶ï¼ˆå¦‚è¿æ¥ã€æ¥å—ã€è¯»æˆ–å†™ï¼‰å·²ç»å‡†å¤‡å°±ç»ªçš„é‚£äº›é€šé“ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœä½ å¯¹â€œè¯»å°±ç»ªâ€çš„é€šé“æ„Ÿå…´è¶£ï¼Œselect()æ–¹æ³•ä¼šè¿”å›è¯»äº‹ä»¶å·²ç»å°±ç»ªçš„é‚£äº›é€šé“ã€‚ ä¸‹é¢æ˜¯select()æ–¹æ³•ï¼š int select() int select(long timeout) int selectNow() select()é˜»å¡åˆ°è‡³å°‘æœ‰ä¸€ä¸ªé€šé“åœ¨ä½ æ³¨å†Œçš„äº‹ä»¶ä¸Šå°±ç»ªäº†ã€‚ select(long timeout)å’Œselect()ä¸€æ ·ï¼Œé™¤äº†æœ€é•¿ä¼šé˜»å¡timeoutæ¯«ç§’(å‚æ•°)ã€‚ selectNow()ä¸ä¼šé˜»å¡ï¼Œä¸ç®¡ä»€ä¹ˆé€šé“å°±ç»ªéƒ½ç«‹åˆ»è¿”å›ï¼ˆè¯‘è€…æ³¨ï¼šæ­¤æ–¹æ³•æ‰§è¡Œéé˜»å¡çš„é€‰æ‹©æ“ä½œã€‚å¦‚æœè‡ªä»å‰ä¸€æ¬¡é€‰æ‹©æ“ä½œåï¼Œæ²¡æœ‰é€šé“å˜æˆå¯é€‰æ‹©çš„ï¼Œåˆ™æ­¤æ–¹æ³•ç›´æ¥è¿”å›é›¶ã€‚ï¼‰ã€‚ select()æ–¹æ³•è¿”å›çš„intå€¼è¡¨ç¤ºæœ‰å¤šå°‘é€šé“å·²ç»å°±ç»ªã€‚äº¦å³ï¼Œè‡ªä¸Šæ¬¡è°ƒç”¨select()æ–¹æ³•åæœ‰å¤šå°‘é€šé“å˜æˆå°±ç»ªçŠ¶æ€ã€‚å¦‚æœè°ƒç”¨select()æ–¹æ³•ï¼Œå› ä¸ºæœ‰ä¸€ä¸ªé€šé“å˜æˆå°±ç»ªçŠ¶æ€ï¼Œè¿”å›äº†1ï¼Œè‹¥å†æ¬¡è°ƒç”¨select()æ–¹æ³•ï¼Œå¦‚æœå¦ä¸€ä¸ªé€šé“å°±ç»ªäº†ï¼Œå®ƒä¼šå†æ¬¡è¿”å›1ã€‚å¦‚æœå¯¹ç¬¬ä¸€ä¸ªå°±ç»ªçš„channelæ²¡æœ‰åšä»»ä½•æ“ä½œï¼Œç°åœ¨å°±æœ‰ä¸¤ä¸ªå°±ç»ªçš„é€šé“ï¼Œä½†åœ¨æ¯æ¬¡select()æ–¹æ³•è°ƒç”¨ä¹‹é—´ï¼Œåªæœ‰ä¸€ä¸ªé€šé“å°±ç»ªäº†ã€‚ selectedKeys()ä¸€æ—¦è°ƒç”¨äº†select()æ–¹æ³•ï¼Œå¹¶ä¸”è¿”å›å€¼è¡¨æ˜æœ‰ä¸€ä¸ªæˆ–æ›´å¤šä¸ªé€šé“å°±ç»ªäº†ï¼Œç„¶åå¯ä»¥é€šè¿‡è°ƒç”¨selectorçš„selectedKeys()æ–¹æ³•ï¼Œè®¿é—®â€œå·²é€‰æ‹©é”®é›†ï¼ˆselected key setï¼‰â€ä¸­çš„å°±ç»ªé€šé“ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š å½“åƒSelectoræ³¨å†ŒChannelæ—¶ï¼ŒChannel.register()æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªSelectionKey å¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡ä»£è¡¨äº†æ³¨å†Œåˆ°è¯¥Selectorçš„é€šé“ã€‚å¯ä»¥é€šè¿‡SelectionKeyçš„selectedKeySet()æ–¹æ³•è®¿é—®è¿™äº›å¯¹è±¡ã€‚ å¯ä»¥éå†è¿™ä¸ªå·²é€‰æ‹©çš„é”®é›†åˆæ¥è®¿é—®å°±ç»ªçš„é€šé“ã€‚å¦‚ä¸‹ï¼š 123456789101112131415Set selectedKeys = selector.selectedKeys();Iterator keyIterator = selectedKeys.iterator();while(keyIterator.hasNext()) &#123; SelectionKey key = keyIterator.next(); if(key.isAcceptable()) &#123; // a connection was accepted by a ServerSocketChannel. &#125; else if (key.isConnectable()) &#123; // a connection was established with a remote server. &#125; else if (key.isReadable()) &#123; // a channel is ready for reading &#125; else if (key.isWritable()) &#123; // a channel is ready for writing &#125; keyIterator.remove();&#125; è¿™ä¸ªå¾ªç¯éå†å·²é€‰æ‹©é”®é›†ä¸­çš„æ¯ä¸ªé”®ï¼Œå¹¶æ£€æµ‹å„ä¸ªé”®æ‰€å¯¹åº”çš„é€šé“çš„å°±ç»ªäº‹ä»¶ã€‚ æ³¨æ„æ¯æ¬¡è¿­ä»£æœ«å°¾çš„keyIterator.remove()è°ƒç”¨ã€‚Selectorä¸ä¼šè‡ªå·±ä»å·²é€‰æ‹©é”®é›†ä¸­ç§»é™¤SelectionKeyå®ä¾‹ã€‚å¿…é¡»åœ¨å¤„ç†å®Œé€šé“æ—¶è‡ªå·±ç§»é™¤ã€‚ä¸‹æ¬¡è¯¥é€šé“å˜æˆå°±ç»ªæ—¶ï¼ŒSelectorä¼šå†æ¬¡å°†å…¶æ”¾å…¥å·²é€‰æ‹©é”®é›†ä¸­ã€‚ SelectionKey.channel()æ–¹æ³•è¿”å›çš„é€šé“éœ€è¦è½¬å‹æˆä½ è¦å¤„ç†çš„ç±»å‹ï¼Œå¦‚ServerSocketChannelæˆ–SocketChannelç­‰ã€‚ wakeUp()æŸä¸ªçº¿ç¨‹è°ƒç”¨select()æ–¹æ³•åé˜»å¡äº†ï¼Œå³ä½¿æ²¡æœ‰é€šé“å·²ç»å°±ç»ªï¼Œä¹Ÿæœ‰åŠæ³•è®©å…¶ä»select()æ–¹æ³•è¿”å›ã€‚åªè¦è®©å…¶å®ƒçº¿ç¨‹åœ¨ç¬¬ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨select()æ–¹æ³•çš„é‚£ä¸ªå¯¹è±¡ä¸Šè°ƒç”¨Selector.wakeup()æ–¹æ³•å³å¯ã€‚é˜»å¡åœ¨select()æ–¹æ³•ä¸Šçš„çº¿ç¨‹ä¼šç«‹é©¬è¿”å›ã€‚ å¦‚æœæœ‰å…¶å®ƒçº¿ç¨‹è°ƒç”¨äº†wakeup()æ–¹æ³•ï¼Œä½†å½“å‰æ²¡æœ‰çº¿ç¨‹é˜»å¡åœ¨select()æ–¹æ³•ä¸Šï¼Œä¸‹ä¸ªè°ƒç”¨select()æ–¹æ³•çš„çº¿ç¨‹ä¼šç«‹å³â€œé†’æ¥ï¼ˆwake upï¼‰â€ã€‚ close()ç”¨å®ŒSelectoråè°ƒç”¨å…¶close()æ–¹æ³•ä¼šå…³é—­è¯¥Selectorï¼Œä¸”ä½¿æ³¨å†Œåˆ°è¯¥Selectorä¸Šçš„æ‰€æœ‰SelectionKeyå®ä¾‹æ— æ•ˆã€‚é€šé“æœ¬èº«å¹¶ä¸ä¼šå…³é—­ã€‚ å®Œæ•´çš„ç¤ºä¾‹è¿™é‡Œæœ‰ä¸€ä¸ªå®Œæ•´çš„ç¤ºä¾‹ï¼Œæ‰“å¼€ä¸€ä¸ªSelectorï¼Œæ³¨å†Œä¸€ä¸ªé€šé“æ³¨å†Œåˆ°è¿™ä¸ªSelectorä¸Š(é€šé“çš„åˆå§‹åŒ–è¿‡ç¨‹ç•¥å»),ç„¶åæŒç»­ç›‘æ§è¿™ä¸ªSelectorçš„å››ç§äº‹ä»¶ï¼ˆæ¥å—ï¼Œè¿æ¥ï¼Œè¯»ï¼Œå†™ï¼‰æ˜¯å¦å°±ç»ªã€‚ 12345678910111213141516171819202122Selector selector = Selector.open();channel.configureBlocking(false);SelectionKey key = channel.register(selector, SelectionKey.OP_READ);while(true) &#123; int readyChannels = selector.select(); if(readyChannels == 0) continue; Set selectedKeys = selector.selectedKeys(); Iterator keyIterator = selectedKeys.iterator(); while(keyIterator.hasNext()) &#123; SelectionKey key = keyIterator.next(); if(key.isAcceptable()) &#123; // a connection was accepted by a ServerSocketChannel. &#125; else if (key.isConnectable()) &#123; // a connection was established with a remote server. &#125; else if (key.isReadable()) &#123; // a channel is ready for reading &#125; else if (key.isWritable()) &#123; // a channel is ready for writing &#125; keyIterator.remove(); &#125;&#125; 7ã€FileChannelJava NIOä¸­çš„FileChannelæ˜¯ä¸€ä¸ªè¿æ¥åˆ°æ–‡ä»¶çš„é€šé“ã€‚å¯ä»¥é€šè¿‡æ–‡ä»¶é€šé“è¯»å†™æ–‡ä»¶ã€‚ FileChannelæ— æ³•è®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼ï¼Œå®ƒæ€»æ˜¯è¿è¡Œåœ¨é˜»å¡æ¨¡å¼ä¸‹ã€‚ æ‰“å¼€FileChannelåœ¨ä½¿ç”¨FileChannelä¹‹å‰ï¼Œå¿…é¡»å…ˆæ‰“å¼€å®ƒã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬æ— æ³•ç›´æ¥æ‰“å¼€ä¸€ä¸ªFileChannelï¼Œéœ€è¦é€šè¿‡ä½¿ç”¨ä¸€ä¸ªInputStreamã€OutputStreamæˆ–RandomAccessFileæ¥è·å–ä¸€ä¸ªFileChannelå®ä¾‹ã€‚ä¸‹é¢æ˜¯é€šè¿‡RandomAccessFileæ‰“å¼€FileChannelçš„ç¤ºä¾‹ï¼š 12RandomAccessFile aFile = new RandomAccessFile(&quot;data/nio-data.txt&quot;, &quot;rw&quot;);FileChannel inChannel = aFile.getChannel(); ä»FileChannelè¯»å–æ•°æ®è°ƒç”¨å¤šä¸ªread()æ–¹æ³•ä¹‹ä¸€ä»FileChannelä¸­è¯»å–æ•°æ®ã€‚å¦‚ï¼š 12ByteBuffer buf = ByteBuffer.allocate(48);int bytesRead = inChannel.read(buf); é¦–å…ˆï¼Œåˆ†é…ä¸€ä¸ªBufferã€‚ä»FileChannelä¸­è¯»å–çš„æ•°æ®å°†è¢«è¯»åˆ°Bufferä¸­ã€‚ ç„¶åï¼Œè°ƒç”¨FileChannel.read()æ–¹æ³•ã€‚è¯¥æ–¹æ³•å°†æ•°æ®ä»FileChannelè¯»å–åˆ°Bufferä¸­ã€‚read()æ–¹æ³•è¿”å›çš„intå€¼è¡¨ç¤ºäº†æœ‰å¤šå°‘å­—èŠ‚è¢«è¯»åˆ°äº†Bufferä¸­ã€‚å¦‚æœè¿”å›-1ï¼Œè¡¨ç¤ºåˆ°äº†æ–‡ä»¶æœ«å°¾ã€‚ å‘FileChannelå†™æ•°æ®ä½¿ç”¨FileChannel.write()æ–¹æ³•å‘FileChannelå†™æ•°æ®ï¼Œè¯¥æ–¹æ³•çš„å‚æ•°æ˜¯ä¸€ä¸ªBufferã€‚å¦‚ï¼š 1234567891011String newData = &quot;New String to write to file...&quot; + System.currentTimeMillis();ByteBuffer buf = ByteBuffer.allocate(48);buf.clear();buf.put(newData.getBytes());buf.flip();while(buf.hasRemaining()) &#123; channel.write(buf);&#125; æ³¨æ„FileChannel.write()æ˜¯åœ¨whileå¾ªç¯ä¸­è°ƒç”¨çš„ã€‚å› ä¸ºæ— æ³•ä¿è¯write()æ–¹æ³•ä¸€æ¬¡èƒ½å‘FileChannelå†™å…¥å¤šå°‘å­—èŠ‚ï¼Œå› æ­¤éœ€è¦é‡å¤è°ƒç”¨write()æ–¹æ³•ï¼Œç›´åˆ°Bufferä¸­å·²ç»æ²¡æœ‰å°šæœªå†™å…¥é€šé“çš„å­—èŠ‚ã€‚ å…³é—­FileChannelç”¨å®ŒFileChannelåå¿…é¡»å°†å…¶å…³é—­ã€‚å¦‚ï¼š1channel.close(); FileChannelçš„positionæ–¹æ³•æœ‰æ—¶å¯èƒ½éœ€è¦åœ¨FileChannelçš„æŸä¸ªç‰¹å®šä½ç½®è¿›è¡Œæ•°æ®çš„è¯»/å†™æ“ä½œã€‚å¯ä»¥é€šè¿‡è°ƒç”¨position()æ–¹æ³•è·å–FileChannelçš„å½“å‰ä½ç½®ã€‚ ä¹Ÿå¯ä»¥é€šè¿‡è°ƒç”¨position(long pos)æ–¹æ³•è®¾ç½®FileChannelçš„å½“å‰ä½ç½®ã€‚ è¿™é‡Œæœ‰ä¸¤ä¸ªä¾‹å­:12long pos = channel.position();channel.position(pos +123); å¦‚æœå°†ä½ç½®è®¾ç½®åœ¨æ–‡ä»¶ç»“æŸç¬¦ä¹‹åï¼Œç„¶åè¯•å›¾ä»æ–‡ä»¶é€šé“ä¸­è¯»å–æ•°æ®ï¼Œè¯»æ–¹æ³•å°†è¿”å›-1 â€”â€” æ–‡ä»¶ç»“æŸæ ‡å¿—ã€‚ å¦‚æœå°†ä½ç½®è®¾ç½®åœ¨æ–‡ä»¶ç»“æŸç¬¦ä¹‹åï¼Œç„¶åå‘é€šé“ä¸­å†™æ•°æ®ï¼Œæ–‡ä»¶å°†æ’‘å¤§åˆ°å½“å‰ä½ç½®å¹¶å†™å…¥æ•°æ®ã€‚è¿™å¯èƒ½å¯¼è‡´â€œæ–‡ä»¶ç©ºæ´â€ï¼Œç£ç›˜ä¸Šç‰©ç†æ–‡ä»¶ä¸­å†™å…¥çš„æ•°æ®é—´æœ‰ç©ºéš™ã€‚ FileChannelçš„sizeæ–¹æ³•FileChannelå®ä¾‹çš„size()æ–¹æ³•å°†è¿”å›è¯¥å®ä¾‹æ‰€å…³è”æ–‡ä»¶çš„å¤§å°ã€‚å¦‚:1long fileSize = channel.size(); FileChannelçš„truncateæ–¹æ³•å¯ä»¥ä½¿ç”¨FileChannel.truncate()æ–¹æ³•æˆªå–ä¸€ä¸ªæ–‡ä»¶ã€‚æˆªå–æ–‡ä»¶æ—¶ï¼Œæ–‡ä»¶å°†ä¸­æŒ‡å®šé•¿åº¦åé¢çš„éƒ¨åˆ†å°†è¢«åˆ é™¤ã€‚å¦‚ï¼š1channel.truncate(1024); è¿™ä¸ªä¾‹å­æˆªå–æ–‡ä»¶çš„å‰1024ä¸ªå­—èŠ‚ã€‚ FileChannelçš„forceæ–¹æ³•FileChannel.force()æ–¹æ³•å°†é€šé“é‡Œå°šæœªå†™å…¥ç£ç›˜çš„æ•°æ®å¼ºåˆ¶å†™åˆ°ç£ç›˜ä¸Šã€‚å‡ºäºæ€§èƒ½æ–¹é¢çš„è€ƒè™‘ï¼Œæ“ä½œç³»ç»Ÿä¼šå°†æ•°æ®ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œæ‰€ä»¥æ— æ³•ä¿è¯å†™å…¥åˆ°FileChannelé‡Œçš„æ•°æ®ä¸€å®šä¼šå³æ—¶å†™åˆ°ç£ç›˜ä¸Šã€‚è¦ä¿è¯è¿™ä¸€ç‚¹ï¼Œéœ€è¦è°ƒç”¨force()æ–¹æ³•ã€‚ force()æ–¹æ³•æœ‰ä¸€ä¸ªbooleanç±»å‹çš„å‚æ•°ï¼ŒæŒ‡æ˜æ˜¯å¦åŒæ—¶å°†æ–‡ä»¶å…ƒæ•°æ®ï¼ˆæƒé™ä¿¡æ¯ç­‰ï¼‰å†™åˆ°ç£ç›˜ä¸Šã€‚ ä¸‹é¢çš„ä¾‹å­åŒæ—¶å°†æ–‡ä»¶æ•°æ®å’Œå…ƒæ•°æ®å¼ºåˆ¶å†™åˆ°ç£ç›˜ä¸Šï¼š æŸ¥çœ‹æºä»£ç æ‰“å°å¸®åŠ©1channel.force(true); 8ã€SocketChannelJava NIOä¸­çš„SocketChannelæ˜¯ä¸€ä¸ªè¿æ¥åˆ°TCPç½‘ç»œå¥—æ¥å­—çš„é€šé“ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹2ç§æ–¹å¼åˆ›å»ºSocketChannelï¼š æ‰“å¼€ä¸€ä¸ªSocketChannelå¹¶è¿æ¥åˆ°äº’è”ç½‘ä¸Šçš„æŸå°æœåŠ¡å™¨ã€‚ä¸€ä¸ªæ–°è¿æ¥åˆ°è¾¾ServerSocketChannelæ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªSocketChannelã€‚ æ‰“å¼€ SocketChannelä¸‹é¢æ˜¯SocketChannelçš„æ‰“å¼€æ–¹å¼ï¼š 12SocketChannel socketChannel = SocketChannel.open();socketChannel.connect(new InetSocketAddress(&quot;http://jenkov.com&quot;, 80)); å…³é—­ SocketChannel å½“ç”¨å®ŒSocketChannelä¹‹åè°ƒç”¨SocketChannel.close()å…³é—­SocketChannelï¼š 1socketChannel.close(); ä» SocketChannel è¯»å–æ•°æ®è¦ä»SocketChannelä¸­è¯»å–æ•°æ®ï¼Œè°ƒç”¨ä¸€ä¸ªread()çš„æ–¹æ³•ä¹‹ä¸€ã€‚ä»¥ä¸‹æ˜¯ä¾‹å­ï¼š 12ByteBuffer buf = ByteBuffer.allocate(48);int bytesRead = socketChannel.read(buf); é¦–å…ˆï¼Œåˆ†é…ä¸€ä¸ªBufferã€‚ä»SocketChannelè¯»å–åˆ°çš„æ•°æ®å°†ä¼šæ”¾åˆ°è¿™ä¸ªBufferä¸­ã€‚ ç„¶åï¼Œè°ƒç”¨SocketChannel.read()ã€‚è¯¥æ–¹æ³•å°†æ•°æ®ä»SocketChannel è¯»åˆ°Bufferä¸­ã€‚read()æ–¹æ³•è¿”å›çš„intå€¼è¡¨ç¤ºè¯»äº†å¤šå°‘å­—èŠ‚è¿›Bufferé‡Œã€‚å¦‚æœè¿”å›çš„æ˜¯-1ï¼Œè¡¨ç¤ºå·²ç»è¯»åˆ°äº†æµçš„æœ«å°¾ï¼ˆè¿æ¥å…³é—­äº†ï¼‰ã€‚ å†™å…¥ SocketChannelå†™æ•°æ®åˆ°SocketChannelç”¨çš„æ˜¯SocketChannel.write()æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä»¥ä¸€ä¸ªBufferä½œä¸ºå‚æ•°ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š 1234567891011String newData = &quot;New String to write to file...&quot; + System.currentTimeMillis();ByteBuffer buf = ByteBuffer.allocate(48);buf.clear();buf.put(newData.getBytes());buf.flip();while(buf.hasRemaining()) &#123; channel.write(buf);&#125; æ³¨æ„SocketChannel.write()æ–¹æ³•çš„è°ƒç”¨æ˜¯åœ¨ä¸€ä¸ªwhileå¾ªç¯ä¸­çš„ã€‚Write()æ–¹æ³•æ— æ³•ä¿è¯èƒ½å†™å¤šå°‘å­—èŠ‚åˆ°SocketChannelã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬é‡å¤è°ƒç”¨write()ç›´åˆ°Bufferæ²¡æœ‰è¦å†™çš„å­—èŠ‚ä¸ºæ­¢ã€‚ éé˜»å¡æ¨¡å¼å¯ä»¥è®¾ç½® SocketChannel ä¸ºéé˜»å¡æ¨¡å¼ï¼ˆnon-blocking modeï¼‰.è®¾ç½®ä¹‹åï¼Œå°±å¯ä»¥åœ¨å¼‚æ­¥æ¨¡å¼ä¸‹è°ƒç”¨connect(), read() å’Œwrite()äº†ã€‚ connect()å¦‚æœSocketChannelåœ¨éé˜»å¡æ¨¡å¼ä¸‹ï¼Œæ­¤æ—¶è°ƒç”¨connect()ï¼Œè¯¥æ–¹æ³•å¯èƒ½åœ¨è¿æ¥å»ºç«‹ä¹‹å‰å°±è¿”å›äº†ã€‚ä¸ºäº†ç¡®å®šè¿æ¥æ˜¯å¦å»ºç«‹ï¼Œå¯ä»¥è°ƒç”¨finishConnect()çš„æ–¹æ³•ã€‚åƒè¿™æ ·ï¼š 123456socketChannel.configureBlocking(false);socketChannel.connect(new InetSocketAddress(&quot;http://jenkov.com&quot;, 80));while(! socketChannel.finishConnect() )&#123; //wait, or do something else...&#125; write()éé˜»å¡æ¨¡å¼ä¸‹ï¼Œwrite()æ–¹æ³•åœ¨å°šæœªå†™å‡ºä»»ä½•å†…å®¹æ—¶å¯èƒ½å°±è¿”å›äº†ã€‚æ‰€ä»¥éœ€è¦åœ¨å¾ªç¯ä¸­è°ƒç”¨write()ã€‚å‰é¢å·²ç»æœ‰ä¾‹å­äº†ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚ read()éé˜»å¡æ¨¡å¼ä¸‹,read()æ–¹æ³•åœ¨å°šæœªè¯»å–åˆ°ä»»ä½•æ•°æ®æ—¶å¯èƒ½å°±è¿”å›äº†ã€‚æ‰€ä»¥éœ€è¦å…³æ³¨å®ƒçš„intè¿”å›å€¼ï¼Œå®ƒä¼šå‘Šè¯‰ä½ è¯»å–äº†å¤šå°‘å­—èŠ‚ã€‚ éé˜»å¡æ¨¡å¼ä¸é€‰æ‹©å™¨éé˜»å¡æ¨¡å¼ä¸é€‰æ‹©å™¨æ­é…ä¼šå·¥ä½œçš„æ›´å¥½ï¼Œé€šè¿‡å°†ä¸€æˆ–å¤šä¸ªSocketChannelæ³¨å†Œåˆ°Selectorï¼Œå¯ä»¥è¯¢é—®é€‰æ‹©å™¨å“ªä¸ªé€šé“å·²ç»å‡†å¤‡å¥½äº†è¯»å–ï¼Œå†™å…¥ç­‰ã€‚Selectorä¸SocketChannelçš„æ­é…ä½¿ç”¨ä¼šåœ¨åé¢è¯¦è®²ã€‚ 9ã€ServerSocketChannelJava NIOä¸­çš„ ServerSocketChannel æ˜¯ä¸€ä¸ªå¯ä»¥ç›‘å¬æ–°è¿›æ¥çš„TCPè¿æ¥çš„é€šé“, å°±åƒæ ‡å‡†IOä¸­çš„ServerSocketä¸€æ ·ã€‚ServerSocketChannelç±»åœ¨ java.nio.channelsåŒ…ä¸­ã€‚ è¿™é‡Œæœ‰ä¸ªä¾‹å­ï¼š 12345678910ServerSocketChannel serverSocketChannel = ServerSocketChannel.open();serverSocketChannel.socket().bind(new InetSocketAddress(9999));while(true)&#123; SocketChannel socketChannel = serverSocketChannel.accept(); //do something with socketChannel...&#125; æ‰“å¼€ ServerSocketChannelé€šè¿‡è°ƒç”¨ ServerSocketChannel.open() æ–¹æ³•æ¥æ‰“å¼€ServerSocketChannel.å¦‚ï¼š 1ServerSocketChannel serverSocketChannel = ServerSocketChannel.open(); å…³é—­ ServerSocketChannelé€šè¿‡è°ƒç”¨ServerSocketChannel.close() æ–¹æ³•æ¥å…³é—­ServerSocketChannel. å¦‚ï¼š 1serverSocketChannel.close(); ç›‘å¬æ–°è¿›æ¥çš„è¿æ¥é€šè¿‡ ServerSocketChannel.accept() æ–¹æ³•ç›‘å¬æ–°è¿›æ¥çš„è¿æ¥ã€‚å½“ accept()æ–¹æ³•è¿”å›çš„æ—¶å€™,å®ƒè¿”å›ä¸€ä¸ªåŒ…å«æ–°è¿›æ¥çš„è¿æ¥çš„ SocketChannelã€‚å› æ­¤, accept()æ–¹æ³•ä¼šä¸€ç›´é˜»å¡åˆ°æœ‰æ–°è¿æ¥åˆ°è¾¾ã€‚ é€šå¸¸ä¸ä¼šä»…ä»…åªç›‘å¬ä¸€ä¸ªè¿æ¥,åœ¨whileå¾ªç¯ä¸­è°ƒç”¨ accept()æ–¹æ³•. å¦‚ä¸‹é¢çš„ä¾‹å­ï¼š 123456while(true)&#123; SocketChannel socketChannel = serverSocketChannel.accept(); //do something with socketChannel...&#125; å½“ç„¶,ä¹Ÿå¯ä»¥åœ¨whileå¾ªç¯ä¸­ä½¿ç”¨é™¤äº†trueä»¥å¤–çš„å…¶å®ƒé€€å‡ºå‡†åˆ™ã€‚ éé˜»å¡æ¨¡å¼ServerSocketChannelå¯ä»¥è®¾ç½®æˆéé˜»å¡æ¨¡å¼ã€‚åœ¨éé˜»å¡æ¨¡å¼ä¸‹ï¼Œaccept() æ–¹æ³•ä¼šç«‹åˆ»è¿”å›ï¼Œå¦‚æœè¿˜æ²¡æœ‰æ–°è¿›æ¥çš„è¿æ¥,è¿”å›çš„å°†æ˜¯nullã€‚ å› æ­¤ï¼Œéœ€è¦æ£€æŸ¥è¿”å›çš„SocketChannelæ˜¯å¦æ˜¯null.å¦‚ï¼š 12345678910111213ServerSocketChannel serverSocketChannel = ServerSocketChannel.open();serverSocketChannel.socket().bind(new InetSocketAddress(9999));serverSocketChannel.configureBlocking(false);while(true)&#123; SocketChannel socketChannel = serverSocketChannel.accept(); if(socketChannel != null)&#123; //do something with socketChannel... &#125;&#125; 10ã€Java NIO DatagramChannelJava NIOä¸­çš„DatagramChannelæ˜¯ä¸€ä¸ªèƒ½æ”¶å‘UDPåŒ…çš„é€šé“ã€‚å› ä¸ºUDPæ˜¯æ— è¿æ¥çš„ç½‘ç»œåè®®ï¼Œæ‰€ä»¥ä¸èƒ½åƒå…¶å®ƒé€šé“é‚£æ ·è¯»å–å’Œå†™å…¥ã€‚å®ƒå‘é€å’Œæ¥æ”¶çš„æ˜¯æ•°æ®åŒ…ã€‚ æ‰“å¼€ DatagramChannelä¸‹é¢æ˜¯ DatagramChannel çš„æ‰“å¼€æ–¹å¼ï¼š 12DatagramChannel channel = DatagramChannel.open();channel.socket().bind(new InetSocketAddress(9999)); è¿™ä¸ªä¾‹å­æ‰“å¼€çš„ DatagramChannelå¯ä»¥åœ¨UDPç«¯å£9999ä¸Šæ¥æ”¶æ•°æ®åŒ…ã€‚ æ¥æ”¶æ•°æ®é€šè¿‡receive()æ–¹æ³•ä»DatagramChannelæ¥æ”¶æ•°æ®ï¼Œå¦‚ï¼š 123ByteBuffer buf = ByteBuffer.allocate(48);buf.clear();channel.receive(buf); receive()æ–¹æ³•ä¼šå°†æ¥æ”¶åˆ°çš„æ•°æ®åŒ…å†…å®¹å¤åˆ¶åˆ°æŒ‡å®šçš„Buffer. å¦‚æœBufferå®¹ä¸ä¸‹æ”¶åˆ°çš„æ•°æ®ï¼Œå¤šå‡ºçš„æ•°æ®å°†è¢«ä¸¢å¼ƒã€‚ å‘é€æ•°æ®é€šè¿‡send()æ–¹æ³•ä»DatagramChannelå‘é€æ•°æ®ï¼Œå¦‚: 12345678String newData = &quot;New String to write to file...&quot; + System.currentTimeMillis();ByteBuffer buf = ByteBuffer.allocate(48);buf.clear();buf.put(newData.getBytes());buf.flip();int bytesSent = channel.send(buf, new InetSocketAddress(&quot;jenkov.com&quot;, 80)); è¿™ä¸ªä¾‹å­å‘é€ä¸€ä¸²å­—ç¬¦åˆ°â€jenkov.comâ€æœåŠ¡å™¨çš„UDPç«¯å£80ã€‚ å› ä¸ºæœåŠ¡ç«¯å¹¶æ²¡æœ‰ç›‘æ§è¿™ä¸ªç«¯å£ï¼Œæ‰€ä»¥ä»€ä¹ˆä¹Ÿä¸ä¼šå‘ç”Ÿã€‚ä¹Ÿä¸ä¼šé€šçŸ¥ä½ å‘å‡ºçš„æ•°æ®åŒ…æ˜¯å¦å·²æ”¶åˆ°ï¼Œå› ä¸ºUDPåœ¨æ•°æ®ä¼ é€æ–¹é¢æ²¡æœ‰ä»»ä½•ä¿è¯ã€‚ è¿æ¥åˆ°ç‰¹å®šçš„åœ°å€å¯ä»¥å°†DatagramChannelâ€œè¿æ¥â€åˆ°ç½‘ç»œä¸­çš„ç‰¹å®šåœ°å€çš„ã€‚ç”±äºUDPæ˜¯æ— è¿æ¥çš„ï¼Œè¿æ¥åˆ°ç‰¹å®šåœ°å€å¹¶ä¸ä¼šåƒTCPé€šé“é‚£æ ·åˆ›å»ºä¸€ä¸ªçœŸæ­£çš„è¿æ¥ã€‚è€Œæ˜¯é”ä½DatagramChannel ï¼Œè®©å…¶åªèƒ½ä»ç‰¹å®šåœ°å€æ”¶å‘æ•°æ®ã€‚ è¿™é‡Œæœ‰ä¸ªä¾‹å­: 1channel.connect(new InetSocketAddress(&quot;jenkov.com&quot;, 80)); å½“è¿æ¥åï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨read()å’Œwrite()æ–¹æ³•ï¼Œå°±åƒåœ¨ç”¨ä¼ ç»Ÿçš„é€šé“ä¸€æ ·ã€‚åªæ˜¯åœ¨æ•°æ®ä¼ é€æ–¹é¢æ²¡æœ‰ä»»ä½•ä¿è¯ã€‚è¿™é‡Œæœ‰å‡ ä¸ªä¾‹å­ï¼š 12int bytesRead = channel.read(buf);int bytesWritten = channel.write(but); 11ã€PipeJava NIO ç®¡é“æ˜¯2ä¸ªçº¿ç¨‹ä¹‹é—´çš„å•å‘æ•°æ®è¿æ¥ã€‚Pipeæœ‰ä¸€ä¸ªsourceé€šé“å’Œä¸€ä¸ªsinké€šé“ã€‚æ•°æ®ä¼šè¢«å†™åˆ°sinké€šé“ï¼Œä»sourceé€šé“è¯»å–ã€‚ è¿™é‡Œæ˜¯PipeåŸç†çš„å›¾ç¤ºï¼š åˆ›å»ºç®¡é“é€šè¿‡Pipe.open()æ–¹æ³•æ‰“å¼€ç®¡é“ã€‚ä¾‹å¦‚ï¼š 1Pipe pipe = Pipe.open(); å‘ç®¡é“å†™æ•°æ®è¦å‘ç®¡é“å†™æ•°æ®ï¼Œéœ€è¦è®¿é—®sinké€šé“ã€‚åƒè¿™æ ·ï¼š 1Pipe.SinkChannel sinkChannel = pipe.sink(); é€šè¿‡è°ƒç”¨SinkChannelçš„write()æ–¹æ³•ï¼Œå°†æ•°æ®å†™å…¥SinkChannel,åƒè¿™æ ·ï¼š 12345678910String newData = &quot;New String to write to file...&quot; + System.currentTimeMillis();ByteBuffer buf = ByteBuffer.allocate(48);buf.clear();buf.put(newData.getBytes());buf.flip();while(buf.hasRemaining()) &#123; sinkChannel.write(buf);&#125; ä»ç®¡é“è¯»å–æ•°æ®ä»è¯»å–ç®¡é“çš„æ•°æ®ï¼Œéœ€è¦è®¿é—®sourceé€šé“ï¼Œåƒè¿™æ ·ï¼š 1Pipe.SourceChannel sourceChannel = pipe.source(); è°ƒç”¨sourceé€šé“çš„read()æ–¹æ³•æ¥è¯»å–æ•°æ®ï¼Œåƒè¿™æ ·ï¼š 123ByteBuffer buf = ByteBuffer.allocate(48);int bytesRead = sourceChannel.read(buf); read()æ–¹æ³•è¿”å›çš„intå€¼ä¼šå‘Šè¯‰æˆ‘ä»¬å¤šå°‘å­—èŠ‚è¢«è¯»è¿›äº†ç¼“å†²åŒºã€‚ 12ã€Java NIOä¸IOçš„å¯¹æ¯”å½“å­¦ä¹ äº†Java NIOå’ŒIOçš„APIåï¼Œä¸€ä¸ªé—®é¢˜é©¬ä¸Šæ¶Œå…¥è„‘æµ·ï¼š æˆ‘åº”è¯¥ä½•æ—¶ä½¿ç”¨IOï¼Œä½•æ—¶ä½¿ç”¨NIOå‘¢ï¼Ÿåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä¼šå°½é‡æ¸…æ™°åœ°è§£æJava NIOå’ŒIOçš„å·®å¼‚ã€å®ƒä»¬çš„ä½¿ç”¨åœºæ™¯ï¼Œä»¥åŠå®ƒä»¬å¦‚ä½•å½±å“æ‚¨çš„ä»£ç è®¾è®¡ã€‚ Java NIOå’ŒIOçš„ä¸»è¦åŒºåˆ«ä¸‹è¡¨æ€»ç»“äº†Java NIOå’ŒIOä¹‹é—´çš„ä¸»è¦å·®åˆ«ï¼Œæˆ‘ä¼šæ›´è¯¦ç»†åœ°æè¿°è¡¨ä¸­æ¯éƒ¨åˆ†çš„å·®å¼‚ã€‚ IO NIO Stream oriented Buffer oriented Blocking IO Non blocking IO æ—  Selectors é¢å‘æµä¸é¢å‘ç¼“å†²Java NIOå’ŒIOä¹‹é—´ç¬¬ä¸€ä¸ªæœ€å¤§çš„åŒºåˆ«æ˜¯ï¼ŒIOæ˜¯é¢å‘æµçš„ï¼ŒNIOæ˜¯é¢å‘ç¼“å†²åŒºçš„ã€‚ Java IOé¢å‘æµæ„å‘³ç€æ¯æ¬¡ä»æµä¸­è¯»ä¸€ä¸ªæˆ–å¤šä¸ªå­—èŠ‚ï¼Œç›´è‡³è¯»å–æ‰€æœ‰å­—èŠ‚ï¼Œå®ƒä»¬æ²¡æœ‰è¢«ç¼“å­˜åœ¨ä»»ä½•åœ°æ–¹ã€‚æ­¤å¤–ï¼Œå®ƒä¸èƒ½å‰åç§»åŠ¨æµä¸­çš„æ•°æ®ã€‚å¦‚æœéœ€è¦å‰åç§»åŠ¨ä»æµä¸­è¯»å–çš„æ•°æ®ï¼Œéœ€è¦å…ˆå°†å®ƒç¼“å­˜åˆ°ä¸€ä¸ªç¼“å†²åŒºã€‚ Java NIOçš„ç¼“å†²å¯¼å‘æ–¹æ³•ç•¥æœ‰ä¸åŒã€‚æ•°æ®è¯»å–åˆ°ä¸€ä¸ªå®ƒç¨åå¤„ç†çš„ç¼“å†²åŒºï¼Œéœ€è¦æ—¶å¯åœ¨ç¼“å†²åŒºä¸­å‰åç§»åŠ¨ã€‚è¿™å°±å¢åŠ äº†å¤„ç†è¿‡ç¨‹ä¸­çš„çµæ´»æ€§ã€‚ä½†æ˜¯ï¼Œè¿˜éœ€è¦æ£€æŸ¥æ˜¯å¦è¯¥ç¼“å†²åŒºä¸­åŒ…å«æ‰€æœ‰æ‚¨éœ€è¦å¤„ç†çš„æ•°æ®ã€‚è€Œä¸”ï¼Œéœ€ç¡®ä¿å½“æ›´å¤šçš„æ•°æ®è¯»å…¥ç¼“å†²åŒºæ—¶ï¼Œä¸è¦è¦†ç›–ç¼“å†²åŒºé‡Œå°šæœªå¤„ç†çš„æ•°æ®ã€‚ é˜»å¡ä¸éé˜»å¡IOJava IOçš„å„ç§æµæ˜¯é˜»å¡çš„ã€‚è¿™æ„å‘³ç€ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨read() æˆ– write()æ—¶ï¼Œè¯¥çº¿ç¨‹è¢«é˜»å¡ï¼Œç›´åˆ°æœ‰ä¸€äº›æ•°æ®è¢«è¯»å–ï¼Œæˆ–æ•°æ®å®Œå…¨å†™å…¥ã€‚è¯¥çº¿ç¨‹åœ¨æ­¤æœŸé—´ä¸èƒ½å†å¹²ä»»ä½•äº‹æƒ…äº†ã€‚ Java NIOçš„éé˜»å¡æ¨¡å¼ï¼Œä½¿ä¸€ä¸ªçº¿ç¨‹ä»æŸé€šé“å‘é€è¯·æ±‚è¯»å–æ•°æ®ï¼Œä½†æ˜¯å®ƒä»…èƒ½å¾—åˆ°ç›®å‰å¯ç”¨çš„æ•°æ®ï¼Œå¦‚æœç›®å‰æ²¡æœ‰æ•°æ®å¯ç”¨æ—¶ï¼Œå°±ä»€ä¹ˆéƒ½ä¸ä¼šè·å–ã€‚è€Œä¸æ˜¯ä¿æŒçº¿ç¨‹é˜»å¡ï¼Œæ‰€ä»¥ç›´è‡³æ•°æ®å˜çš„å¯ä»¥è¯»å–ä¹‹å‰ï¼Œè¯¥çº¿ç¨‹å¯ä»¥ç»§ç»­åšå…¶ä»–çš„äº‹æƒ…ã€‚ éé˜»å¡å†™ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ä¸€ä¸ªçº¿ç¨‹è¯·æ±‚å†™å…¥ä¸€äº›æ•°æ®åˆ°æŸé€šé“ï¼Œä½†ä¸éœ€è¦ç­‰å¾…å®ƒå®Œå…¨å†™å…¥ï¼Œè¿™ä¸ªçº¿ç¨‹åŒæ—¶å¯ä»¥å»åšåˆ«çš„äº‹æƒ…ã€‚ çº¿ç¨‹é€šå¸¸å°†éé˜»å¡IOçš„ç©ºé—²æ—¶é—´ç”¨äºåœ¨å…¶å®ƒé€šé“ä¸Šæ‰§è¡ŒIOæ“ä½œï¼Œæ‰€ä»¥ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹ç°åœ¨å¯ä»¥ç®¡ç†å¤šä¸ªè¾“å…¥å’Œè¾“å‡ºé€šé“ï¼ˆchannelï¼‰ã€‚ é€‰æ‹©å™¨ï¼ˆSelectorsï¼‰Java NIOçš„é€‰æ‹©å™¨å…è®¸ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹æ¥ç›‘è§†å¤šä¸ªè¾“å…¥é€šé“ï¼Œä½ å¯ä»¥æ³¨å†Œå¤šä¸ªé€šé“ä½¿ç”¨ä¸€ä¸ªé€‰æ‹©å™¨ï¼Œç„¶åä½¿ç”¨ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹æ¥â€œé€‰æ‹©â€é€šé“ï¼šè¿™äº›é€šé“é‡Œå·²ç»æœ‰å¯ä»¥å¤„ç†çš„è¾“å…¥ï¼Œæˆ–è€…é€‰æ‹©å·²å‡†å¤‡å†™å…¥çš„é€šé“ã€‚è¿™ç§é€‰æ‹©æœºåˆ¶ï¼Œä½¿å¾—ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹å¾ˆå®¹æ˜“æ¥ç®¡ç†å¤šä¸ªé€šé“ã€‚ NIOå’ŒIOå¦‚ä½•å½±å“åº”ç”¨ç¨‹åºçš„è®¾è®¡æ— è®ºæ‚¨é€‰æ‹©IOæˆ–NIOå·¥å…·ç®±ï¼Œå¯èƒ½ä¼šå½±å“æ‚¨åº”ç”¨ç¨‹åºè®¾è®¡çš„ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š å¯¹NIOæˆ–IOç±»çš„APIè°ƒç”¨ã€‚ æ•°æ®å¤„ç†ã€‚ ç”¨æ¥å¤„ç†æ•°æ®çš„çº¿ç¨‹æ•°ã€‚ APIè°ƒç”¨å½“ç„¶ï¼Œä½¿ç”¨NIOçš„APIè°ƒç”¨æ—¶çœ‹èµ·æ¥ä¸ä½¿ç”¨IOæ—¶æœ‰æ‰€ä¸åŒï¼Œä½†è¿™å¹¶ä¸æ„å¤–ï¼Œå› ä¸ºå¹¶ä¸æ˜¯ä»…ä»ä¸€ä¸ªInputStreamé€å­—èŠ‚è¯»å–ï¼Œè€Œæ˜¯æ•°æ®å¿…é¡»å…ˆè¯»å…¥ç¼“å†²åŒºå†å¤„ç†ã€‚ æ•°æ®å¤„ç†ä½¿ç”¨çº¯ç²¹çš„NIOè®¾è®¡ç›¸è¾ƒIOè®¾è®¡ï¼Œæ•°æ®å¤„ç†ä¹Ÿå—åˆ°å½±å“ã€‚ åœ¨IOè®¾è®¡ä¸­ï¼Œæˆ‘ä»¬ä»InputStreamæˆ– Readeré€å­—èŠ‚è¯»å–æ•°æ®ã€‚å‡è®¾ä½ æ­£åœ¨å¤„ç†ä¸€åŸºäºè¡Œçš„æ–‡æœ¬æ•°æ®æµï¼Œä¾‹å¦‚ï¼š 1234Name: AnnaAge: 25Email: anna@mailserver.comPhone: 1234567890 è¯¥æ–‡æœ¬è¡Œçš„æµå¯ä»¥è¿™æ ·å¤„ç†ï¼š 1234567InputStream input = â€¦ ; // get the InputStream from the client socketBufferedReader reader = new BufferedReader(new InputStreamReader(input));String nameLine = reader.readLine();String ageLine = reader.readLine();String emailLine = reader.readLine();String phoneLine = reader.readLine(); è¯·æ³¨æ„å¤„ç†çŠ¶æ€ç”±ç¨‹åºæ‰§è¡Œå¤šä¹…å†³å®šã€‚æ¢å¥è¯è¯´ï¼Œä¸€æ—¦reader.readLine()æ–¹æ³•è¿”å›ï¼Œä½ å°±çŸ¥é“è‚¯å®šæ–‡æœ¬è¡Œå°±å·²è¯»å®Œï¼Œ readline()é˜»å¡ç›´åˆ°æ•´è¡Œè¯»å®Œï¼Œè¿™å°±æ˜¯åŸå› ã€‚ä½ ä¹ŸçŸ¥é“æ­¤è¡ŒåŒ…å«åç§°ï¼›åŒæ ·ï¼Œç¬¬äºŒä¸ªreadline()è°ƒç”¨è¿”å›çš„æ—¶å€™ï¼Œä½ çŸ¥é“è¿™è¡ŒåŒ…å«å¹´é¾„ç­‰ã€‚ æ­£å¦‚ä½ å¯ä»¥çœ‹åˆ°ï¼Œè¯¥å¤„ç†ç¨‹åºä»…åœ¨æœ‰æ–°æ•°æ®è¯»å…¥æ—¶è¿è¡Œï¼Œå¹¶çŸ¥é“æ¯æ­¥çš„æ•°æ®æ˜¯ä»€ä¹ˆã€‚ä¸€æ—¦æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹å·²å¤„ç†è¿‡è¯»å…¥çš„æŸäº›æ•°æ®ï¼Œè¯¥çº¿ç¨‹ä¸ä¼šå†å›é€€æ•°æ®ï¼ˆå¤§å¤šå¦‚æ­¤ï¼‰ã€‚ä¸‹å›¾ä¹Ÿè¯´æ˜äº†è¿™æ¡åŸåˆ™ï¼š ä¸Šå›¾ï¼šä»ä¸€ä¸ªé˜»å¡çš„æµä¸­è¯»æ•°æ® è€Œä¸€ä¸ªNIOçš„å®ç°ä¼šæœ‰æ‰€ä¸åŒï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š 123ByteBuffer buffer = ByteBuffer.allocate(48);int bytesRead = inChannel.read(buffer); æ³¨æ„ç¬¬äºŒè¡Œï¼Œä»é€šé“è¯»å–å­—èŠ‚åˆ°ByteBufferã€‚å½“è¿™ä¸ªæ–¹æ³•è°ƒç”¨è¿”å›æ—¶ï¼Œä½ ä¸çŸ¥é“ä½ æ‰€éœ€çš„æ‰€æœ‰æ•°æ®æ˜¯å¦åœ¨ç¼“å†²åŒºå†…ã€‚ä½ æ‰€çŸ¥é“çš„æ˜¯ï¼Œè¯¥ç¼“å†²åŒºåŒ…å«ä¸€äº›å­—èŠ‚ï¼Œè¿™ä½¿å¾—å¤„ç†æœ‰ç‚¹å›°éš¾ã€‚å‡è®¾ç¬¬ä¸€æ¬¡ read(buffer)è°ƒç”¨åï¼Œè¯»å…¥ç¼“å†²åŒºçš„æ•°æ®åªæœ‰åŠè¡Œï¼Œä¾‹å¦‚ï¼Œâ€œName:Anâ€ï¼Œä½ èƒ½å¤„ç†æ•°æ®å—ï¼Ÿæ˜¾ç„¶ä¸èƒ½ï¼Œéœ€è¦ç­‰å¾…ï¼Œç›´åˆ°æ•´è¡Œæ•°æ®è¯»å…¥ç¼“å­˜ï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œå¯¹æ•°æ®çš„ä»»ä½•å¤„ç†æ¯«æ— æ„ä¹‰ã€‚ æ‰€ä»¥ï¼Œä½ æ€ä¹ˆçŸ¥é“æ˜¯å¦è¯¥ç¼“å†²åŒºåŒ…å«è¶³å¤Ÿçš„æ•°æ®å¯ä»¥å¤„ç†å‘¢ï¼Ÿå¥½äº†ï¼Œä½ ä¸çŸ¥é“ã€‚å‘ç°çš„æ–¹æ³•åªèƒ½æŸ¥çœ‹ç¼“å†²åŒºä¸­çš„æ•°æ®ã€‚å…¶ç»“æœæ˜¯ï¼Œåœ¨ä½ çŸ¥é“æ‰€æœ‰æ•°æ®éƒ½åœ¨ç¼“å†²åŒºé‡Œä¹‹å‰ï¼Œä½ å¿…é¡»æ£€æŸ¥å‡ æ¬¡ç¼“å†²åŒºçš„æ•°æ®ã€‚è¿™ä¸ä»…æ•ˆç‡ä½ä¸‹ï¼Œè€Œä¸”å¯ä»¥ä½¿ç¨‹åºè®¾è®¡æ–¹æ¡ˆæ‚ä¹±ä¸å ªã€‚ä¾‹å¦‚ï¼š 12345ByteBuffer buffer = ByteBuffer.allocate(48);int bytesRead = inChannel.read(buffer);while(! bufferFull(bytesRead) ) &#123;bytesRead = inChannel.read(buffer);&#125; bufferFull()æ–¹æ³•å¿…é¡»è·Ÿè¸ªæœ‰å¤šå°‘æ•°æ®è¯»å…¥ç¼“å†²åŒºï¼Œå¹¶è¿”å›çœŸæˆ–å‡ï¼Œè¿™å–å†³äºç¼“å†²åŒºæ˜¯å¦å·²æ»¡ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœç¼“å†²åŒºå‡†å¤‡å¥½è¢«å¤„ç†ï¼Œé‚£ä¹ˆè¡¨ç¤ºç¼“å†²åŒºæ»¡äº†ã€‚ bufferFull()æ–¹æ³•æ‰«æç¼“å†²åŒºï¼Œä½†å¿…é¡»ä¿æŒåœ¨bufferFullï¼ˆï¼‰æ–¹æ³•è¢«è°ƒç”¨ä¹‹å‰çŠ¶æ€ç›¸åŒã€‚å¦‚æœæ²¡æœ‰ï¼Œä¸‹ä¸€ä¸ªè¯»å…¥ç¼“å†²åŒºçš„æ•°æ®å¯èƒ½æ— æ³•è¯»åˆ°æ­£ç¡®çš„ä½ç½®ã€‚è¿™æ˜¯ä¸å¯èƒ½çš„ï¼Œä½†å´æ˜¯éœ€è¦æ³¨æ„çš„åˆä¸€é—®é¢˜ã€‚ å¦‚æœç¼“å†²åŒºå·²æ»¡ï¼Œå®ƒå¯ä»¥è¢«å¤„ç†ã€‚å¦‚æœå®ƒä¸æ»¡ï¼Œå¹¶ä¸”åœ¨ä½ çš„å®é™…æ¡ˆä¾‹ä¸­æœ‰æ„ä¹‰ï¼Œä½ æˆ–è®¸èƒ½å¤„ç†å…¶ä¸­çš„éƒ¨åˆ†æ•°æ®ã€‚ä½†æ˜¯è®¸å¤šæƒ…å†µä¸‹å¹¶éå¦‚æ­¤ã€‚ä¸‹å›¾å±•ç¤ºäº†â€œç¼“å†²åŒºæ•°æ®å¾ªç¯å°±ç»ªâ€ï¼š ä¸Šå›¾ï¼šä»ä¸€ä¸ªé€šé“é‡Œè¯»æ•°æ®ï¼Œç›´åˆ°æ‰€æœ‰çš„æ•°æ®éƒ½è¯»åˆ°ç¼“å†²åŒºé‡Œ æ€»ç»“NIOå¯è®©æ‚¨åªä½¿ç”¨ä¸€ä¸ªï¼ˆæˆ–å‡ ä¸ªï¼‰å•çº¿ç¨‹ç®¡ç†å¤šä¸ªé€šé“ï¼ˆç½‘ç»œè¿æ¥æˆ–æ–‡ä»¶ï¼‰ï¼Œä½†ä»˜å‡ºçš„ä»£ä»·æ˜¯è§£ææ•°æ®å¯èƒ½ä¼šæ¯”ä»ä¸€ä¸ªé˜»å¡æµä¸­è¯»å–æ•°æ®æ›´å¤æ‚ã€‚ å¦‚æœéœ€è¦ç®¡ç†åŒæ—¶æ‰“å¼€çš„æˆåƒä¸Šä¸‡ä¸ªè¿æ¥ï¼Œè¿™äº›è¿æ¥æ¯æ¬¡åªæ˜¯å‘é€å°‘é‡çš„æ•°æ®ï¼Œä¾‹å¦‚èŠå¤©æœåŠ¡å™¨ï¼Œå®ç°NIOçš„æœåŠ¡å™¨å¯èƒ½æ˜¯ä¸€ä¸ªä¼˜åŠ¿ã€‚åŒæ ·ï¼Œå¦‚æœä½ éœ€è¦ç»´æŒè®¸å¤šæ‰“å¼€çš„è¿æ¥åˆ°å…¶ä»–è®¡ç®—æœºä¸Šï¼Œå¦‚P2Pç½‘ç»œä¸­ï¼Œä½¿ç”¨ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹æ¥ç®¡ç†ä½ æ‰€æœ‰å‡ºç«™è¿æ¥ï¼Œå¯èƒ½æ˜¯ä¸€ä¸ªä¼˜åŠ¿ã€‚ä¸€ä¸ªçº¿ç¨‹å¤šä¸ªè¿æ¥çš„è®¾è®¡æ–¹æ¡ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä¸Šå›¾ï¼šå•çº¿ç¨‹ç®¡ç†å¤šä¸ªè¿æ¥ å¦‚æœä½ æœ‰å°‘é‡çš„è¿æ¥ä½¿ç”¨éå¸¸é«˜çš„å¸¦å®½ï¼Œä¸€æ¬¡å‘é€å¤§é‡çš„æ•°æ®ï¼Œä¹Ÿè®¸å…¸å‹çš„IOæœåŠ¡å™¨å®ç°å¯èƒ½éå¸¸å¥‘åˆã€‚ä¸‹å›¾è¯´æ˜äº†ä¸€ä¸ªå…¸å‹çš„IOæœåŠ¡å™¨è®¾è®¡ï¼š ä¸Šå›¾ï¼šä¸€ä¸ªå…¸å‹çš„IOæœåŠ¡å™¨è®¾è®¡ï¼šä¸€ä¸ªè¿æ¥é€šè¿‡ä¸€ä¸ªçº¿ç¨‹å¤„ç† æ³¨æ˜ï¼šæ–‡ç« è½¬è½½è‡ª NIO|å¹¶å‘ç¼–ç¨‹ç½‘ï¼ŒäºŒæ¬¡è½¬è½½è¯·åŠ¡å¿…æ³¨æ˜åŸå‡ºå¤„ï¼","tags":[{"name":"Java","slug":"Java","permalink":"http://www.54tianzhisheng.cn/tags/Java/"},{"name":"NIO","slug":"NIO","permalink":"http://www.54tianzhisheng.cn/tags/NIO/"}]},{"title":"ã€Šç–¯ç‹‚ Java çªç ´ç¨‹åºå‘˜åŸºæœ¬åŠŸçš„ 16 è¯¾ã€‹è¯»ä¹¦ç¬”è®°","date":"2017-06-12T16:00:00.000Z","path":"2017/06/13/Java-16-lession/","text":"ç¬¬ 1 è¯¾ â€”â€” æ•°ç»„ä¸å†…å­˜æ§åˆ¶æ•°ç»„åˆå§‹åŒ–æ•°ç»„åˆå§‹åŒ–ä¹‹åï¼Œè¯¥æ•°ç»„çš„é•¿åº¦æ˜¯ä¸å¯å˜çš„ï¼ˆå¯é€šè¿‡æ•°ç»„çš„ length å±æ€§è®¿é—®æ•°ç»„çš„é•¿åº¦ï¼‰ã€‚Java ä¸­çš„æ•°ç»„å¿…é¡»ç»è¿‡åˆå§‹åŒ–ï¼ˆä¸ºæ•°ç»„å¯¹è±¡çš„å…ƒç´ åˆ†é…å†…å­˜ç©ºé—´ï¼Œå¹¶ä¸ºæ¯ä¸ªæ•°ç»„å…ƒç´ æŒ‡å®šåˆå§‹å€¼ï¼‰æ‰å¯ä½¿ç”¨ã€‚ æ•°ç»„åˆå§‹åŒ–çš„å½¢å¼ï¼š é™æ€åˆå§‹åŒ–ï¼šåˆå§‹åŒ–æ—¶ç”±ç¨‹åºå‘˜æ˜¾ç¤ºçš„æŒ‡å®šæ¯ä¸ªæ•°ç»„çš„åˆå§‹å€¼ï¼Œç³»ç»Ÿå†³å®šæ•°ç»„é•¿åº¦ã€‚ åŠ¨æ€åˆå§‹åŒ–ï¼šåˆå§‹åŒ–æ—¶ç¨‹åºå‘˜åªæŒ‡å®šæ•°ç»„çš„é•¿åº¦ï¼Œç³»ç»Ÿä¸ºæ•°ç»„å…ƒç´ åˆ†é…åˆå§‹å€¼ã€‚ ä½¿ç”¨æ•°ç»„æ•°ç»„å…ƒç´ å°±æ˜¯å˜é‡ï¼šä¾‹å¦‚ int[] æ•°ç»„å…ƒç´ ç›¸å½“äº int ç±»å‹çš„å˜é‡ å½“é€šè¿‡ç´¢å¼•æ¥ä½¿ç”¨æ•°ç»„å…ƒç´ æ—¶ï¼ˆè®¿é—®æ•°ç»„å…ƒç´ çš„å€¼ã€ä¸ºæ•°ç»„å…ƒç´ èµ‹å€¼ï¼‰ï¼Œå°†è¯¥æ•°ç»„å…ƒç´ å½“æˆæ™®é€šå˜é‡ä½¿ç”¨å³å¯ã€‚ ç¬¬ 2 è¯¾ â€”â€” å¯¹è±¡ä¸å†…å­˜çš„æ§åˆ¶Java å†…å­˜ç®¡ç†åˆ†ä¸ºï¼šå†…å­˜åˆ†é…å’Œå†…å­˜å›æ”¶ã€‚ å†…å­˜åˆ†é…ï¼šåˆ›å»º Java å¯¹è±¡æ—¶ JVM ä¸ºè¯¥å¯¹è±¡åœ¨å †å†…å­˜ä¸­æ‰€åˆ†é…çš„å†…å­˜ç©ºé—´ã€‚ å†…å­˜å›æ”¶ï¼šå½“ Java å¯¹è±¡å¤±å»å¼•ç”¨ï¼Œå˜æˆåƒåœ¾ï¼ŒJVM çš„åƒåœ¾å›æ”¶æœºåˆ¶è‡ªåŠ¨æ¸…ç†è¯¥å¯¹è±¡ï¼Œå¹¶å›æ”¶å†…å­˜ å®ä¾‹å˜é‡ å’Œ ç±»å˜é‡å±€éƒ¨å˜é‡ç‰¹ç‚¹ï¼šä½œç”¨æ—¶é—´çŸ­ï¼Œå­˜å‚¨åœ¨æ–¹æ³•çš„æ ˆå†…å­˜ä¸­ ç§ç±»ï¼š å½¢å‚ï¼šæ–¹æ³•ç­¾åä¸­å®šä¹‰çš„å±€éƒ¨å˜é‡ï¼Œç”±æ–¹æ³•è°ƒç”¨è€…è´Ÿè´£ä¸ºå…¶èµ‹å€¼ï¼Œéšæ–¹æ³•ç»“æŸè€Œæ¶ˆäº¡ æ–¹æ³•å†…çš„å±€éƒ¨å˜é‡ï¼šæ–¹æ³•å†…å®šä¹‰çš„å±€éƒ¨å˜é‡ï¼Œå¿…é¡»åœ¨æ–¹æ³•å†…å¯¹å…¶è¿›è¡Œæ˜¾ç¤ºåˆå§‹åŒ–ï¼Œä»åˆå§‹åŒ–åå¼€å§‹ç”Ÿæ•ˆï¼Œéšæ–¹æ³•ç»“æŸè€Œæ¶ˆäº¡ ä»£ç å—å†…çš„å±€éƒ¨å˜é‡ï¼šåœ¨ä»£ç å—ä¸­å®šä¹‰çš„å±€éƒ¨å˜é‡ï¼Œå¿…é¡»åœ¨ä»£ç å—ä¸­è¿›è¡Œæ˜¾ç¤ºåˆå§‹åŒ–ï¼Œä»åˆå§‹åŒ–åå¼€å§‹ç”Ÿæ•ˆï¼Œéšä»£ç å—ç»“æŸè€Œæ¶ˆäº¡ æˆå‘˜å˜é‡ç±»ä½“å†…å®šä¹‰çš„å˜é‡ï¼Œå¦‚æœè¯¥æˆå‘˜å˜é‡æ²¡æœ‰ä½¿ç”¨ static ä¿®é¥°ï¼Œé‚£è¯¥æˆå‘˜å˜é‡åˆè¢«ç§°ä¸ºéé™æ€å˜é‡æˆ–å®ä¾‹å˜é‡ï¼Œå¦‚æœä½¿ç”¨ static ä¿®é¥°ï¼Œåˆ™è¯¥æˆå‘˜å˜é‡åˆå¯è¢«ç§°ä¸ºé™æ€å˜é‡æˆ–ç±»å˜é‡ã€‚ å®ä¾‹å˜é‡å’Œç±»å˜é‡çš„å±æ€§ä½¿ç”¨ static ä¿®é¥°çš„æˆå‘˜å˜é‡æ˜¯ç±»å˜é‡ï¼Œå±äºè¯¥ç±»æœ¬èº«ï¼Œæ²¡æœ‰ä½¿ç”¨ static ä¿®é¥°çš„æˆå‘˜å˜é‡æ˜¯å®ä¾‹å˜é‡ï¼Œå±äºè¯¥ç±»çš„å®ä¾‹ï¼Œåœ¨åŒä¸€ä¸ªç±»ä¸­ï¼Œæ¯ä¸€ä¸ªç±»åªå¯¹åº”ä¸€ä¸ª Class å¯¹è±¡ï¼Œä½†æ¯ä¸ªç±»å¯ä»¥åˆ›å»ºå¤šä¸ªå¯¹è±¡ã€‚ ç”±äºåŒä¸€ä¸ª JVM å†…çš„æ¯ä¸ªç±»åªå¯¹åº”ä¸€ä¸ª CLass å¯¹è±¡ï¼Œå› æ­¤åŒä¸€ä¸ª JVM å†…çš„ä¸€ä¸ªç±»çš„ç±»å˜é‡åªéœ€è¦ä¸€å—å†…å­˜ç©ºé—´ï¼›ä½†å¯¹äºå®ä¾‹å˜é‡è€Œè¨€ï¼Œè¯¥ç±»æ¯åˆ›å»ºä¸€æ¬¡å®ä¾‹ï¼Œå°±éœ€è¦ä¸ºè¯¥å®ä¾‹å˜é‡åˆ†é…ä¸€å—å†…å­˜ç©ºé—´ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç¨‹åºä¸­åˆ›å»ºäº†å‡ ä¸ªå®ä¾‹ï¼Œå®ä¾‹å˜é‡å°±éœ€è¦å‡ å—å†…å­˜ç©ºé—´ã€‚ è¿™é‡Œæˆ‘æƒ³åˆ°ä¸€é“é¢è¯•é¢˜ç›®ï¼š 123456789101112public class A&#123; &#123; System.out.println(\"æˆ‘æ˜¯ä»£ç å—\"); &#125; static&#123; System.out.println(\"æˆ‘æ˜¯é™æ€ä»£ç å—\"); &#125; public static void main(String[] args) &#123; A a = new A(); A a1 = new A(); &#125;&#125; ç»“æœï¼š 123æˆ‘æ˜¯é™æ€ä»£ç å—æˆ‘æ˜¯ä»£ç å—æˆ‘æ˜¯ä»£ç å— é™æ€ä»£ç å—åªæ‰§è¡Œä¸€æ¬¡ï¼Œè€Œä»£ç å—æ¯åˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼Œå°±ä¼šæ‰“å°ä¸€æ¬¡ã€‚ å®ä¾‹å˜é‡çš„åˆå§‹åŒ–æ—¶æœºç¨‹åºå¯åœ¨3ä¸ªåœ°æ–¹å¯¹å®ä¾‹å˜é‡æ‰§è¡Œåˆå§‹åŒ–ï¼š å®šä¹‰å®ä¾‹å˜é‡æ—¶æŒ‡å®šåˆå§‹å€¼ éé™æ€åˆå§‹åŒ–å—ä¸­å¯¹å®ä¾‹å˜é‡æŒ‡å®šåˆå§‹å€¼ æ„é€ å™¨ä¸­å¯¹å®ä¾‹å˜é‡æŒ‡å®šåˆå§‹å€¼ ä¸Šé¢ç¬¬ä¸€ç§å’Œç¬¬äºŒç§æ–¹å¼æ¯”ç¬¬ä¸‰ç§æ–¹å¼æ›´æ—©æ‰§è¡Œï¼Œä½†ç¬¬ä¸€ã€äºŒç§æ–¹å¼çš„æ‰§è¡Œé¡ºåºä¸ä»–ä»¬åœ¨æºç¨‹åºä¸­çš„æ’åˆ—é¡ºåºç›¸åŒã€‚ åŒæ ·åœ¨ä¸Šé¢é‚£ä¸ªä»£ç ä¸ŠåŠ ä¸Šä¸€ä¸ªå˜é‡ weight çš„æˆå‘˜å˜é‡ï¼Œæˆ‘ä»¬æ¥éªŒè¯ä¸‹ä¸Šé¢çš„åˆå§‹åŒ–é¡ºåºï¼š 1ã€å®šä¹‰å®ä¾‹å˜é‡æŒ‡å®šåˆå§‹å€¼ åœ¨ éé™æ€åˆå§‹åŒ–å—å¯¹å®ä¾‹å˜é‡æŒ‡å®šåˆå§‹å€¼ ä¹‹å: 123456789101112131415public class A&#123; &#123; weight = 2.1; System.out.println(\"æˆ‘æ˜¯ä»£ç å—\"); &#125; double weight = 2.0; static&#123; System.out.println(\"æˆ‘æ˜¯é™æ€ä»£ç å—\"); &#125; public static void main(String[] args) &#123; A a = new A(); A a1 = new A(); System.out.println(a.weight); &#125;&#125; ç»“æœæ˜¯ï¼š 1234æˆ‘æ˜¯é™æ€ä»£ç å—æˆ‘æ˜¯ä»£ç å—æˆ‘æ˜¯ä»£ç å—2.0 2ã€å®šä¹‰å®ä¾‹å˜é‡æŒ‡å®šåˆå§‹å€¼ åœ¨ éé™æ€åˆå§‹åŒ–å—å¯¹å®ä¾‹å˜é‡æŒ‡å®šåˆå§‹å€¼ ä¹‹å‰: 123456789101112131415public class A&#123; double weight = 2.0; &#123; weight = 2.1; System.out.println(\"æˆ‘æ˜¯ä»£ç å—\"); &#125; static&#123; System.out.println(\"æˆ‘æ˜¯é™æ€ä»£ç å—\"); &#125; public static void main(String[] args) &#123; A a = new A(); A a1 = new A(); System.out.println(a.weight); &#125;&#125; ç»“æœä¸ºï¼š 1234æˆ‘æ˜¯é™æ€ä»£ç å—æˆ‘æ˜¯ä»£ç å—æˆ‘æ˜¯ä»£ç å—2.1 å¤§å®¶æœ‰æ²¡æœ‰è§‰å¾—å¾ˆå¥‡æ€ªï¼Ÿ æˆ‘æ¥å¥½å¥½è¯´æ¸…æ¥šä¸‹ï¼š å®šä¹‰å®ä¾‹å˜é‡æ—¶æŒ‡å®šçš„åˆå§‹å€¼ã€åˆå§‹ä»£ç å—ä¸­ä¸ºå®ä¾‹å˜é‡æŒ‡å®šåˆå§‹å€¼çš„è¯­å¥çš„åœ°ä½æ˜¯å¹³ç­‰çš„ï¼Œå½“ç»è¿‡ç¼–è¯‘å™¨å¤„ç†åï¼Œä»–ä»¬éƒ½å°†ä¼šè¢«æå–åˆ°æ„é€ å™¨ä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™æ¡è¯­å¥ double weight = 2.0; å®é™…ä¸Šä¼šè¢«åˆ†æˆå¦‚ä¸‹ 2 æ¬¡æ‰§è¡Œï¼š double weight; : åˆ›å»º Java å¯¹è±¡æ—¶ç³»ç»Ÿæ ¹æ®è¯¥è¯­å¥ä¸ºè¯¥å¯¹è±¡åˆ†é…å†…å­˜ã€‚ weight = 2.1; : è¿™æ¡è¯­å¥å°†ä¼šè¢«æå–åˆ° Java ç±»çš„æ„é€ å™¨ä¸­æ‰§è¡Œã€‚ åªè¯´åŸç†ï¼Œå¤§å®¶è‚¯å®šä¸æ€ä¹ˆä¿¡ï¼Œé‚£ä¹ˆè¿˜æœ‰æ‹¿å‡ºæºç æ¥ï¼Œè¿™æ ·æ‰æœ‰ä¿¡æœèƒ½åŠ›çš„å—ï¼Ÿæ˜¯ä¸ï¼Ÿ è¿™é‡Œæˆ‘ç›´æ¥ä½¿ç”¨è½¯ä»¶å°†ä»£ç çš„å­—èŠ‚ç æ–‡ä»¶åç¼–è¯‘è¿‡æ¥ï¼Œçœ‹çœ‹é‡Œé¢æ˜¯æ€æ ·çš„ç»„æˆï¼Ÿ ç¬¬ä¸€ä¸ªä»£ç çš„åç¼–è¯‘æºç å¦‚ä¸‹ï¼š 1234567891011121314151617181920public class A&#123; double weight; public A() &#123; this.weight = 2.1D; System.out.println(\"æˆ‘æ˜¯ä»£ç å—\"); this.weight = 2.0D; &#125; static &#123; System.out.println(\"æˆ‘æ˜¯é™æ€ä»£ç å—\"); &#125; public static void main(String[] args) &#123; A a = new A(); A a1 = new A(); System.out.println(a.weight); &#125;&#125; ç¬¬äºŒä¸ªä»£ç åç¼–è¯‘æºç å¦‚ä¸‹ï¼š 1234567891011121314151617181920public class A&#123; double weight; public A() &#123; this.weight = 2.0D; this.weight = 2.1D; System.out.println(\"æˆ‘æ˜¯ä»£ç å—\"); &#125; static &#123; System.out.println(\"æˆ‘æ˜¯é™æ€ä»£ç å—\"); &#125; public static void main(String[] args) &#123; A a = new A(); A a1 = new A(); System.out.println(a.weight); &#125;&#125; è¿™ä¸‹å­æ»¡æ„äº†å§ï¼ é€šè¿‡åç¼–è¯‘çš„æºç å¯ä»¥çœ‹åˆ°è¯¥ç±»å®šä¹‰çš„ weight å®ä¾‹å˜é‡æ—¶ä¸å†æœ‰åˆå§‹å€¼ï¼Œä¸º weight æŒ‡å®šåˆå§‹å€¼çš„ä»£ç ä¹Ÿè¢«æåˆ°äº†æ„é€ å™¨ä¸­å»äº†ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿå¯ä»¥å‘ç°ä¹‹å‰è§„åˆ™ä¹Ÿæ˜¯æ»¡è¶³çš„ã€‚ ä»–ä»¬çš„èµ‹å€¼è¯­å¥éƒ½è¢«åˆå¹¶åˆ°æ„é€ å™¨ä¸­ï¼Œåœ¨åˆå¹¶è¿‡ç¨‹ä¸­ï¼Œå®šä¹‰çš„å˜é‡è¯­å¥è½¬æ¢å¾—åˆ°çš„èµ‹å€¼è¯­å¥ï¼Œåˆå§‹ä»£ç å—ä¸­çš„è¯­å¥éƒ½è½¬æ¢å¾—åˆ°çš„èµ‹å€¼è¯­å¥ï¼Œæ€»æ˜¯ä½äºæ„é€ å™¨çš„æ‰€æœ‰è¯­å¥ä¹‹å‰ï¼Œåˆå¹¶åï¼Œä¸¤ç§èµ‹å€¼è¯­å¥çš„é¡ºåºä¹Ÿä¿æŒäº†å®ƒä»¬åœ¨ Java æºä»£ç ä¸­çš„é¡ºåºã€‚ å¤§è‡´è¿‡ç¨‹åº”è¯¥äº†è§£äº†å§ï¼Ÿå¦‚æœè¿˜ä¸æ€ä¹ˆæ¸…æ¥šçš„ï¼Œå»ºè®®è¿˜æ˜¯è‡ªå·±å°†æ€ä¸ªè¿‡ç¨‹åœ¨è‡ªå·±çš„ç”µè„‘ä¸Šæ“ä½œä¸€éï¼Œæ¯•ç«Ÿå…‰çœ‹ä¸ç»ƒå‡æŠŠå¼ã€‚ ç±»å˜é‡çš„åˆå§‹åŒ–æ—¶æœºJVM å¯¹æ¯ä¸€ä¸ª Java ç±»åªåˆå§‹åŒ–ä¸€æ¬¡ï¼Œå› æ­¤ Java ç¨‹åºæ¯è¿è¡Œä¸€æ¬¡ï¼Œç³»ç»Ÿåªä¸ºç±»å˜é‡åˆ†é…ä¸€æ¬¡å†…å­˜ç©ºé—´ï¼Œæ‰§è¡Œä¸€æ¬¡åˆå§‹åŒ–ã€‚ç¨‹åºå¯åœ¨ä¸¤ä¸ªåœ°æ–¹å¯¹ç±»å˜é‡æ‰§è¡Œåˆå§‹åŒ–ï¼š å®šä¹‰ç±»å˜é‡æ—¶æŒ‡å®šåˆå§‹å€¼ é™æ€åˆå§‹åŒ–ä»£ç å—ä¸­å¯¹ç±»å˜é‡æŒ‡å®šåˆå§‹å€¼ è¿™ä¸¤ç§æ–¹å¼çš„æ‰§è¡Œé¡ºåºä¸å®ƒä»¬åœ¨æºä»£ç ä¸­çš„æ’åˆ—é¡ºåºç›¸åŒã€‚ è¿˜æ˜¯ç”¨ä¸Šé¢é‚£ä¸ªç¤ºä¾‹ï¼Œæˆ‘ä»¬åœ¨å…¶åŸºç¡€ä¸ŠåŠ ä¸ªè¢« static ä¿®é¥°çš„å˜é‡ heightï¼š 1ã€å®šä¹‰ç±»å˜é‡æ—¶æŒ‡å®šåˆå§‹å€¼ åœ¨ é™æ€åˆå§‹åŒ–ä»£ç å—ä¸­å¯¹ç±»å˜é‡æŒ‡å®šåˆå§‹å€¼ ä¹‹åï¼š 123456789101112131415161718public class A&#123; double weight = 2.0; &#123; weight = 2.1; System.out.println(\"æˆ‘æ˜¯ä»£ç å—\"); &#125; static&#123; height = 10.1; System.out.println(\"æˆ‘æ˜¯é™æ€ä»£ç å—\"); &#125; static double height = 10.0; public static void main(String[] args) &#123; A a = new A(); A a1 = new A(); System.out.println(a.weight); System.out.println(height); &#125;&#125; è¿è¡Œç»“æœï¼š 12345æˆ‘æ˜¯é™æ€ä»£ç å—æˆ‘æ˜¯ä»£ç å—æˆ‘æ˜¯ä»£ç å—2.110.0 2ã€å®šä¹‰ç±»å˜é‡æ—¶æŒ‡å®šåˆå§‹å€¼ åœ¨ é™æ€åˆå§‹åŒ–ä»£ç å—ä¸­å¯¹ç±»å˜é‡æŒ‡å®šåˆå§‹å€¼ ä¹‹å‰ï¼š 123456789101112131415161718public class A&#123; static double height = 10.0; double weight = 2.0; &#123; weight = 2.1; System.out.println(\"æˆ‘æ˜¯ä»£ç å—\"); &#125; static&#123; height = 10.1; System.out.println(\"æˆ‘æ˜¯é™æ€ä»£ç å—\"); &#125; public static void main(String[] args) &#123; A a = new A(); A a1 = new A(); System.out.println(a.weight); System.out.println(height); &#125;&#125; è¿è¡Œç»“æœï¼š 12345æˆ‘æ˜¯é™æ€ä»£ç å—æˆ‘æ˜¯ä»£ç å—æˆ‘æ˜¯ä»£ç å—2.110.1 å…¶è¿è¡Œç»“æœæ­£å¦‚æˆ‘ä»¬é¢„æ–™ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯çœ‹çœ‹åç¼–è¯‘åçš„ä»£ç å§ï¼ ç¬¬ä¸€ç§æƒ…å†µä¸‹åç¼–è¯‘çš„ä»£ç ï¼š 1234567891011121314151617181920212223public class A&#123; double weight; public A() &#123; this.weight = 2.0D; this.weight = 2.1D; System.out.println(\"æˆ‘æ˜¯ä»£ç å—\"); &#125; static &#123; System.out.println(\"æˆ‘æ˜¯é™æ€ä»£ç å—\"); &#125; static double height = 10.0D; public static void main(String[] args) &#123; A a = new A(); A a1 = new A(); System.out.println(a.weight); System.out.println(height); &#125;&#125; ç¬¬äºŒç§æƒ…å†µä¸‹åç¼–è¯‘çš„ä»£ç ï¼š 123456789101112131415161718192021222324public class A&#123; static double height = 10.0D; double weight; public A() &#123; this.weight = 2.0D; this.weight = 2.1D; System.out.println(\"æˆ‘æ˜¯ä»£ç å—\"); &#125; static &#123; height = 10.1D; System.out.println(\"æˆ‘æ˜¯é™æ€ä»£ç å—\"); &#125; public static void main(String[] args) &#123; A a = new A(); A a1 = new A(); System.out.println(a.weight); System.out.println(height); &#125;&#125; é€šè¿‡åç¼–è¯‘æºç ï¼Œå¯ä»¥çœ‹åˆ°ç¬¬ä¸€ç§æƒ…å†µä¸‹(å®šä¹‰ç±»å˜é‡æ—¶æŒ‡å®šåˆå§‹å€¼ åœ¨ é™æ€åˆå§‹åŒ–ä»£ç å—ä¸­å¯¹ç±»å˜é‡æŒ‡å®šåˆå§‹å€¼ ä¹‹å): æˆ‘ä»¬åœ¨ é™æ€åˆå§‹åŒ–ä»£ç å—ä¸­å¯¹ç±»å˜é‡æŒ‡å®šåˆå§‹å€¼ å·²ç»ä¸å­˜åœ¨äº†ï¼Œåªæœ‰ä¸€ä¸ªç±»å˜é‡æŒ‡å®šçš„åˆå§‹å€¼ static double height = 10.0D; , è€Œåœ¨ç¬¬äºŒç§æƒ…å†µä¸‹ï¼ˆå®šä¹‰ç±»å˜é‡æ—¶æŒ‡å®šåˆå§‹å€¼ åœ¨ é™æ€åˆå§‹åŒ–ä»£ç å—ä¸­å¯¹ç±»å˜é‡æŒ‡å®šåˆå§‹å€¼ ä¹‹å‰ï¼‰å’Œä¹‹å‰çš„æºä»£ç é¡ºåºæ˜¯ä¸€æ ·çš„ï¼Œæ²¡å•¥åŒºåˆ«ã€‚ ä¸Šé¢çš„ä»£ç ä¸­å……åˆ†çš„å±•ç¤ºäº†ç±»å˜é‡çš„ä¸¤ç§åˆå§‹åŒ–æ–¹å¼ ï¼šæ¯æ¬¡è¿è¡Œè¯¥ç¨‹åºæ—¶ï¼Œç³»ç»Ÿä¼šä¸º A ç±»æ‰§è¡Œåˆå§‹åŒ–ï¼Œå…ˆä¸ºæ‰€æœ‰ç±»å˜é‡åˆ†é…å†…å­˜ç©ºé—´ï¼Œå†æŒ‰ç…§æºä»£ç ä¸­çš„æ’åˆ—é¡ºåºæ‰§è¡Œé™æ€åˆå§‹ä»£ç å—ä¸­æ‰€æŒ‡å®šçš„åˆå§‹å€¼å’Œå®šä¹‰ç±»å˜é‡æ—¶æ‰€æŒ‡å®šçš„åˆå§‹å€¼ã€‚ çˆ¶ç±»æ„é€ å™¨å½“åˆ›å»ºä»»ä½• Java å¯¹è±¡æ—¶ï¼Œç¨‹åºæ€»ä¼šå…ˆä¾æ¬¡è°ƒç”¨æ¯ä¸ªçˆ¶ç±»éé™æ€åˆå§‹åŒ–ä»£ç å—ã€çˆ¶ç±»æ„é€ å™¨ï¼ˆæ€»æ˜¯ä» Object å¼€å§‹ï¼‰æ‰§è¡Œåˆå§‹åŒ–ï¼Œæœ€åæ‰è°ƒç”¨æœ¬ç±»çš„éé™æ€åˆå§‹åŒ–ä»£ç å—ã€æ„é€ å™¨æ‰§è¡Œåˆå§‹åŒ–ã€‚ éšå¼è°ƒç”¨å’Œæ˜¾ç¤ºè°ƒç”¨å½“è°ƒç”¨æŸä¸ªç±»çš„æ„é€ å™¨æ¥åˆ›å»º Java å¯¹è±¡æ—¶ï¼Œç³»ç»Ÿæ€»ä¼šå…ˆè°ƒç”¨çˆ¶ç±»çš„éé™æ€åˆå§‹åŒ–ä»£ç å—è¿›è¡Œåˆå§‹åŒ–ã€‚è¿™ä¸ªè°ƒç”¨æ˜¯éšå¼æ‰§è¡Œçš„ï¼Œè€Œä¸”çˆ¶ç±»çš„é™æ€åˆå§‹åŒ–ä»£ç å—æ€»æ˜¯ä¼šè¢«æ‰§è¡Œã€‚æ¥ç€ä¼šè°ƒç”¨çˆ¶ç±»çš„ä¸€ä¸ªæˆ–å¤šä¸ªæ„é€ å™¨æ‰§è¡Œåˆå§‹åŒ–ï¼Œè¿™ä¸ªè°ƒç”¨æ—¢å¯ä»¥æ˜¯é€šè¿‡ super è¿›è¡Œæ˜¾ç¤ºè°ƒç”¨ï¼Œä¹Ÿå¯ä»¥æ˜¯éšå¼è°ƒç”¨ã€‚ å½“æ‰€æœ‰çˆ¶ç±»çš„éé™æ€åˆå§‹ä»£ç å—ã€æ„é€ å™¨ä¾æ¬¡è°ƒç”¨å®Œæˆåï¼Œç³»ç»Ÿè°ƒç”¨æœ¬ç±»çš„éé™æ€ä»£ç å—ã€æ„é€ å™¨æ‰§è¡Œåˆå§‹åŒ–ï¼Œæœ€åè¿”å›æœ¬ç±»çš„å®ä¾‹ã€‚è‡³äºè°ƒç”¨çˆ¶ç±»çš„å“ªä¸ªæ„é€ å™¨æ‰§è¡Œåˆå§‹åŒ–ï¼Œåˆ†ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š å­ç±»æ„é€ å™¨æ‰§è¡Œä½“çš„ç¬¬ä¸€è¡Œä»£ç ä½¿ç”¨ super æ˜¾å¼è°ƒç”¨çˆ¶ç±»æ„é€ å™¨ï¼Œç³»ç»Ÿå°†æ ¹æ® super è°ƒç”¨é‡Œä¼ å…¥çš„å®å‚åˆ—è¡¨æ¥ç¡®å®šè°ƒç”¨çˆ¶ç±»çš„å“ªä¸ªæ„é€ å™¨ï¼› å­ç±»æ„é€ å™¨æ‰§è¡Œä½“çš„ç¬¬ä¸€è¡Œä»£ç ä½¿ç”¨ this æ˜¾å¼è°ƒç”¨æœ¬ç±»ä¸­çš„é‡è½½æ„é€ å™¨ï¼Œç³»ç»Ÿå°†æ ¹æ® this è°ƒç”¨é‡Œä¼ å…¥çš„å®å‚åˆ—è¡¨æ¥ç¡®å®šå¥”é›·çš„å¦ä¸€ä¸ªæ„é€ å™¨ï¼ˆæ‰§è¡Œæœ¬ç±»ä¸­å¦ä¸€ä¸ªæ„é€ å™¨æ—¶å³è¿›å…¥ç¬¬ä¸€ç§æƒ…å†µï¼‰ï¼› å­ç±»æ„é€ å™¨ä¸­æ—¢æ²¡æœ‰ super è°ƒç”¨ï¼Œä¹Ÿæ²¡æœ‰ this è°ƒç”¨ï¼Œç³»ç»Ÿå°†ä¼šåœ¨æ‰§è¡Œå­ç±»æ„é€ å™¨ä¹‹å‰ï¼Œéšå¼è°ƒç”¨çˆ¶ç±»æ— å‚æ„é€ å™¨ã€‚ æ³¨ï¼šsuper å’Œ this å¿…é¡»åœ¨æ„é€ å™¨çš„ç¬¬ä¸€è¡Œï¼Œä¸”ä¸èƒ½åŒæ—¶å­˜åœ¨ã€‚ æ¨èä¸€ç¯‡åšå®¢ï¼šJavaåˆå§‹åŒ–é¡ºåº æ–‡ç« ä»æ— ç»§æ‰¿å’Œç»§æ‰¿ä¸¤ç§æƒ…å†µä¸‹åˆ†æäº† Java åˆå§‹åŒ–çš„é¡ºåºã€‚ Javaåˆå§‹åŒ–é¡ºåºå¦‚å›¾ï¼š è®¿é—®å­ç±»å¯¹è±¡çš„å®ä¾‹å˜é‡è°ƒç”¨è¢«å­ç±»é‡å†™çš„æ–¹æ³•çˆ¶å­å®ä¾‹çš„å†…å­˜æ§åˆ¶ç»§æ‰¿æˆå‘˜å˜é‡å’Œç»§æ‰¿æ–¹æ³•çš„åŒºåˆ«æ–¹æ³•çš„è¡Œä¸ºæ€»æ˜¯è¡¨ç°å‡ºå®ƒä»¬å®é™…ç±»å‹çš„è¡Œä¸ºï¼›å®ä¾‹å˜é‡çš„å€¼æ€»æ˜¯è¡¨ç°å‡ºå£°æ˜è¿™äº›å˜é‡æ‰€ç”¨ç±»å‹çš„è¡Œä¸ºã€‚ å†…å­˜ä¸­çš„å­ç±»å®ä¾‹çˆ¶ã€å­ç±»çš„ç±»å˜é‡final ä¿®é¥°ç¬¦final å¯ä»¥ä¿®é¥°å˜é‡ã€æ–¹æ³•ã€ç±»ã€‚ ä¿®é¥°å˜é‡ï¼Œå˜é‡è¢«èµ‹åˆå§‹å€¼ä¹‹åï¼Œä¸èƒ½å¤Ÿå¯¹ä»–åœ¨è¿›è¡Œä¿®æ”¹ ä¿®é¥°æ–¹æ³•ï¼Œä¸èƒ½å¤Ÿè¢«é‡å†™ ä¿®é¥°ç±»ï¼Œä¸èƒ½å¤Ÿè¢«ç»§æ‰¿ final ä¿®é¥°çš„å®ä¾‹å˜é‡åªèƒ½åœ¨å¦‚ä¸‹ä½ç½®æŒ‡å®šåˆå§‹å€¼ï¼š å®šä¹‰ final å®ä¾‹å˜é‡æ—¶æŒ‡å®šåˆå§‹å€¼ åœ¨éé™æ€ä»£ç å—ä¸­ä¸º final å®ä¾‹å˜é‡æŒ‡å®šåˆå§‹å€¼ åœ¨æ„é€ å™¨ä¸­ä¸º final å®ä¾‹å˜é‡æŒ‡å®šåˆå§‹å€¼ final ä¿®é¥°çš„ç±»å˜é‡åªèƒ½åœ¨å¦‚ä¸‹ä½ç½®æŒ‡å®šåˆå§‹å€¼ï¼š å®šä¹‰ final ç±»å˜é‡æ—¶æŒ‡å®šåˆå§‹å€¼ åœ¨é™æ€ä»£ç å—ä¸­ä¸º final ç±»å˜é‡æŒ‡å®šåˆå§‹å€¼ ç¬¬ 3 è¯¾ â€”â€” å¸¸è§ Java é›†åˆçš„å®ç°ç»†èŠ‚Java é›†åˆæ¡†æ¶ç±»å›¾ï¼š Set å’Œ MapSet ä»£è¡¨ä¸€ç§é›†åˆå…ƒç´ æ— åºã€é›†åˆå…ƒç´ ä¸å¯é‡å¤çš„é›†åˆï¼ŒMap åˆ™ä»£è¡¨ä¸€ç§ç”±å¤šä¸ª key-value å¯¹ç»„åˆçš„é›†åˆï¼ŒMap é›†åˆç±»ä¼¼äºä¼ ç»Ÿçš„å…³è”æ•°ç»„ã€‚ Set å’Œ Map çš„å…³ç³»1ã€Map é›†åˆä¸­çš„ key ä¸èƒ½é‡å¤ä¸”æ²¡æœ‰é¡ºåºã€‚å°†è¿™äº› key ç»„åˆèµ·æ¥å°±æ˜¯ä¸€ä¸ª Set é›†åˆã€‚æ‰€ä»¥æœ‰ä¸€ä¸ª Set&lt;k&gt; keySet() æ–¹æ³•æ¥è¿”å›æ‰€æœ‰ key ç»„æˆçš„ Set é›†åˆã€‚ 2ã€Set ä¹Ÿå¯ä»¥è½¬æ¢æˆ Mapã€‚ï¼ˆåœ¨ Set ä¸­å°† æ¯ä¸€å¯¹ key å’Œ value å­˜æ”¾åœ¨ä¸€èµ·ï¼‰ HashMap å’Œ HashSetHashSetï¼šç³»ç»Ÿé‡‡ç”¨ Hash ç®—æ³•å†³å®šé›†åˆå…ƒç´ çš„å­˜å‚¨ä½ç½®ã€‚ï¼ˆåŸºäº HashMap å®ç°çš„ï¼‰ HashMapï¼šç³»ç»Ÿå°† value å½“æˆ key çš„é™„å±ï¼Œç³»ç»Ÿæ ¹æ® Hash ç®—æ³•å†³å®š key çš„å­˜å‚¨ä½ç½®ã€‚ HashSet çš„ç»å¤§éƒ¨åˆ†æ–¹æ³•éƒ½æ˜¯é€šè¿‡è°ƒç”¨ HashMap çš„æ–¹æ³•å®ç°çš„ï¼Œå› æ­¤ HashSet å’Œ HashMap ä¸¤ä¸ªé›†åˆåœ¨å®ç°æœ¬è´¨ä¸Šæ˜¯ç›¸åŒçš„ã€‚ TreeMap å’Œ TreeSetTreeSet åº•å±‚ä½¿ç”¨ TreeMap æ¥åŒ…å« Set é›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚ TreeMap é‡‡ç”¨çš„æ˜¯ä¸€ç§â€œçº¢é»‘æ ‘â€çš„æ’åºäºŒå‰æ ‘æ¥ä¿å­˜ Map ä¸­æ¯ä¸ª Entry â€”â€” æ¯ä¸ª Entry éƒ½è¢«å½“æˆ â€œçº¢é»‘æ ‘â€ çš„ä¸€ä¸ªèŠ‚ç‚¹å¯¹å¾…ã€‚ Map å’Œ ListMap çš„ values() æ–¹æ³•ä¸ç®¡æ˜¯ HashMap è¿˜æ˜¯ TreeMap ï¼Œå®ƒä»¬çš„ values() æ–¹æ³•éƒ½å¯ä»¥è¿”å›å…¶æ‰€æœ‰ value ç»„æˆçš„ Collection é›†åˆï¼Œå…¶å®æ˜¯ä¸€ä¸ªä¸å­˜å‚¨å…ƒç´ çš„ Collection é›†åˆï¼Œå½“ç¨‹åºéå† Collection é›†åˆæ—¶ï¼Œå®é™…ä¸Šå°±æ˜¯éå† Map å¯¹è±¡çš„ valueã€‚ HashMap å’Œ TreeMap çš„ values() æ–¹æ³•å¹¶æœªæŠŠ Map ä¸­çš„ values é‡æ–°ç»„åˆæˆä¸€ä¸ªåŒ…å«å…ƒç´ çš„é›†åˆå¯¹è±¡ï¼Œè¿™æ ·å°±å¯ä»¥é™ä½ç³»ç»Ÿå†…å­˜å¼€é”€ã€‚ Map å’Œ List çš„å…³ç³»åº•å±‚å®ç°å¾ˆç›¸ä¼¼ï¼›ç”¨æ³•ä¸Šå¾ˆç›¸ä¼¼ã€‚ Map æ¥å£æä¾› get(K key) æ–¹æ³•å…è®¸ Map å¯¹è±¡æ ¹æ® key æ¥å–å¾— valueï¼› List æ¥å£æä¾›äº† get(int index) æ–¹æ³•å…è®¸ List å¯¹è±¡æ ¹æ®å…ƒç´ ç´¢å¼•æ¥å–å¾— valueï¼› ArrayList å’Œ LinkedListList é›†åˆçš„å®ç°ç±»ï¼Œä¸»è¦æœ‰ ArrayList ã€Vector å’Œ LinkedListã€‚ ArrayList æ˜¯ä¸€ä¸ªå¯æ”¹å˜å¤§å°çš„æ•°ç»„.å½“æ›´å¤šçš„å…ƒç´ åŠ å…¥åˆ° ArrayList ä¸­æ—¶, å…¶å¤§å°å°†ä¼šåŠ¨æ€åœ°å¢é•¿. å†…éƒ¨çš„å…ƒç´ å¯ä»¥ç›´æ¥é€šè¿‡ get ä¸ set æ–¹æ³•è¿›è¡Œè®¿é—®, å› ä¸º ArrayList æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªæ•°ç»„. LinkedList æ˜¯ä¸€ä¸ªåŒé“¾è¡¨, åœ¨æ·»åŠ å’Œåˆ é™¤å…ƒç´ æ—¶å…·æœ‰æ¯” ArrayList æ›´å¥½çš„æ€§èƒ½. ä½†åœ¨ get ä¸ set æ–¹é¢å¼±äºArrayList. å½“ç„¶, è¿™äº›å¯¹æ¯”éƒ½æ˜¯æŒ‡æ•°æ®é‡å¾ˆå¤§æˆ–è€…æ“ä½œå¾ˆé¢‘ç¹çš„æƒ…å†µä¸‹çš„å¯¹æ¯”, å¦‚æœæ•°æ®å’Œè¿ç®—é‡å¾ˆå°,é‚£ä¹ˆå¯¹æ¯”å°†å¤±å»æ„ä¹‰. Vector å’Œ ArrayList ç±»ä¼¼, ä½†å±äºå¼ºåŒæ­¥ç±»ã€‚å¦‚æœä½ çš„ç¨‹åºæœ¬èº«æ˜¯çº¿ç¨‹å®‰å…¨çš„(thread-safe,æ²¡æœ‰åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´å…±äº«åŒä¸€ä¸ªé›†åˆ/å¯¹è±¡),é‚£ä¹ˆä½¿ç”¨ ArrayList æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚ Vector å’Œ ArrayList åœ¨æ›´å¤šå…ƒç´ æ·»åŠ è¿›æ¥æ—¶ä¼šè¯·æ±‚æ›´å¤§çš„ç©ºé—´ã€‚Vector æ¯æ¬¡è¯·æ±‚å…¶å¤§å°çš„åŒå€ç©ºé—´ï¼Œè€Œ ArrayListæ¯æ¬¡å¯¹ size å¢é•¿ 50%. è€Œ LinkedList è¿˜å®ç°äº† Queue æ¥å£, è¯¥æ¥å£æ¯” List æä¾›äº†æ›´å¤šçš„æ–¹æ³•,åŒ…æ‹¬ offer(), peek(), poll()ç­‰. æ³¨æ„: é»˜è®¤æƒ…å†µä¸‹ ArrayList çš„åˆå§‹å®¹é‡éå¸¸å°, æ‰€ä»¥å¦‚æœå¯ä»¥é¢„ä¼°æ•°æ®é‡çš„è¯, åˆ†é…ä¸€ä¸ªè¾ƒå¤§çš„åˆå§‹å€¼å±äºæœ€ä½³å®è·µ, è¿™æ ·å¯ä»¥å‡å°‘è°ƒæ•´å¤§å°çš„å¼€é”€ã€‚ ArrayListä¸LinkedListæ€§èƒ½å¯¹æ¯” æ—¶é—´å¤æ‚åº¦å¯¹æ¯”å¦‚ä¸‹: LinkedList æ›´é€‚ç”¨äº: æ²¡æœ‰å¤§è§„æ¨¡çš„éšæœºè¯»å– å¤§é‡çš„å¢åŠ /åˆ é™¤æ“ä½œ Iterator è¿­ä»£å™¨æ˜¯ä¸€ä¸ªè¿­ä»£å™¨æ¥å£ï¼Œä¸“é—¨ç”¨äºè¿­ä»£å„ç§ Collection é›†åˆï¼ŒåŒ…æ‹¬ Set é›†åˆå’Œ List é›†åˆã€‚ ç¬¬ 4 è¯¾ â€”â€” Java çš„å†…å­˜å›æ”¶Java å¼•ç”¨çš„ç§ç±»å¯¹è±¡åœ¨å†…å­˜ä¸­çš„çŠ¶æ€JVM åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œæ˜¯å¦å›æ”¶ä¸€ä¸ªå¯¹è±¡çš„æ ‡å‡†åœ¨äºï¼šæ˜¯å¦è¿˜æœ‰å¼•ç”¨å˜é‡å¼•ç”¨è¯¥å¯¹è±¡ï¼Ÿåªè¦æœ‰å¼•ç”¨å˜é‡å¼•ç”¨è¯¥å¯¹è±¡ï¼Œåƒåœ¾å›æ”¶æœºåˆ¶å°±ä¸ä¼šå›æ”¶å®ƒã€‚ Java è¯­è¨€å¯¹å¯¹è±¡çš„å¼•ç”¨æœ‰ï¼š å¼ºå¼•ç”¨ è½¯å¼•ç”¨ å¼±å¼•ç”¨ è™šå¼•ç”¨ å¼ºå¼•ç”¨ç¨‹åºåˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶æŠŠè¿™ä¸ªå¯¹è±¡èµ‹ç»™ä¸€ä¸ªå¼•ç”¨å˜é‡ï¼Œè¿™ä¸ªå¼•ç”¨å˜é‡å°±æ˜¯å¼ºå¼•ç”¨ã€‚å½“ä¸€ä¸ªå¯¹è±¡è¢«ä¸€ä¸ªæˆ–è€…ä¸€ä¸ªä»¥ä¸Šçš„å¼ºå¼•ç”¨å˜é‡æ‰€å¼•ç”¨æ—¶ï¼Œå®ƒå¤„äºå¯è¾¾çŠ¶æ€ï¼Œå®ƒæ˜¯ä¸ä¼šè¢«ç³»ç»Ÿçš„åƒåœ¾å›æ”¶æœºåˆ¶å›æ”¶ã€‚ è½¯å¼•ç”¨è½¯å¼•ç”¨éœ€è¦é€šè¿‡ SoftReference ç±»æ¥å®ç°ï¼Œå½“ä¸€ä¸ªå¯¹è±¡åªå…·æœ‰è½¯å¼•ç”¨æ—¶ï¼Œå®ƒæœ‰å¯èƒ½ä¼šè¢«åƒåœ¾å›æ”¶æœºåˆ¶å›æ”¶ã€‚å¯¹äºåªæœ‰è½¯å¼•ç”¨çš„å¯¹è±¡è€Œè¨€ï¼Œå½“ç³»ç»Ÿå†…å­˜ç©ºé—´è¶³å¤Ÿæ—¶ï¼Œå®ƒä¸ä¼šè¢«ç³»ç»Ÿå›æ”¶ï¼Œç¨‹åºä¹Ÿå¯ä½¿ç”¨è¯¥å¯¹è±¡ï¼›å½“ç³»ç»Ÿå†…å­˜ç©ºé—´ä¸è¶³æ—¶ï¼Œç³»ç»Ÿå°†ä¼šå›æ”¶å®ƒã€‚ å¼±å¼•ç”¨å¼±å¼•ç”¨å’Œè½¯å¼•ç”¨æœ‰ç‚¹ç›¸ä¼¼ï¼ŒåŒºåˆ«åœ¨äºå¼±å¼•ç”¨æ‰€å¼•ç”¨å¯¹è±¡çš„ç”Ÿå­˜æœŸæ›´çŸ­ã€‚ è™šå¼•ç”¨è™šå¼•ç”¨ä¸»è¦ç”¨äºè·Ÿè¸ªå¯¹è±¡è¢«åƒåœ¾å›æ”¶çš„çŠ¶æ€ï¼Œè™šå¼•ç”¨ä¸èƒ½å•ç‹¬ä½¿ç”¨ï¼Œè™šå¼•ç”¨å¿…é¡»å’Œå¼•ç”¨é˜Ÿåˆ—è”åˆä½¿ç”¨ã€‚ Java çš„å†…å­˜æ³„æ¼ArrayList.java ä¸­çš„ remove æ–¹æ³• 1234567891011public E remove(int index) &#123; rangeCheck(index); modCount++; E oldValue = elementData(index); int numMoved = size - index - 1; if (numMoved &gt; 0) System.arraycopy(elementData, index+1, elementData, index, numMoved); elementData[--size] = null; // clear to let GC do its work return oldValue; &#125; å…¶ä¸­ elementData[--size] = null; // clear to let GC do its work è¯­å¥æ˜¯æ¸…é™¤æ•°ç»„å…ƒç´ çš„å¼•ç”¨ï¼Œé¿å…å†…å­˜çš„æ³„æ¼ï¼Œå¦‚æœæ²¡æœ‰è¿™å¥çš„è¯ï¼Œé‚£ä¹ˆå°±æ˜¯åªæœ‰ä¸¤ä¸ªä½œç”¨ï¼š ä¿®é¥° Stack çš„å±æ€§ï¼Œä¹Ÿå°±æ˜¯å°†å€¼å‡ 1ï¼› è¿”å›ç´¢å¼•ä¸º size -1 çš„å€¼ã€‚ åƒåœ¾å›æ”¶æœºåˆ¶ è·Ÿè¸ªå¹¶ç›‘æ§æ¯ä¸ª Java å¯¹è±¡ï¼Œå½“æŸä¸ªå¯¹è±¡å¤„äºä¸å¯è¾¾çŠ¶æ€æ—¶ï¼Œå›æ”¶è¯¥å¯¹è±¡æ‰€å ç”¨çš„å†…å­˜ã€‚ æ¸…ç†å†…å­˜åˆ†é…ï¼Œå›æ”¶è¿‡ç¨‹ä¸­äº§ç”Ÿçš„å†…å­˜ç¢ç‰‡ã€‚ åƒåœ¾å›æ”¶çš„åŸºæœ¬ç®—æ³•å¯¹äºä¸€ä¸ªåƒåœ¾å›æ”¶å™¨çš„è®¾è®¡ç®—æ³•æ¥è¯´ï¼Œå¤§æ¦‚æœ‰å¦‚ä¸‹å‡ ä¸ªè®¾è®¡ï¼š ä¸²è¡Œå›æ”¶ å’Œ å¹¶è¡Œå›æ”¶ ä¸²è¡Œå›æ”¶ï¼šä¸ç®¡ç³»ç»Ÿæœ‰å¤šå°‘ä¸ª CPUï¼Œå§‹ç»ˆä½¿ç”¨ä¸€ä¸ª CPU æ¥æ‰§è¡Œåƒåœ¾å›æ”¶æ“ä½œ å¹¶è¡Œå›æ”¶ï¼šæŠŠæ•´ä¸ªå›æ”¶å·¥ä½œæ‹†åˆ†æˆå¤šéƒ¨åˆ†ï¼Œæ¯ä¸ªéƒ¨åˆ†ç”±ä¸€ä¸ª CPU è´Ÿè´£ï¼Œä»è€Œè®©å¤šä¸ª CPU å¹¶è¡Œå›æ”¶ å¹¶å‘æ‰§è¡Œ å’Œ åº”ç”¨ç¨‹åºåœæ­¢ å‹ç¼© å’Œ ä¸å‹ç¼© å’Œ å¤åˆ¶ å¤åˆ¶ï¼šå°†å †å†…åˆ†æˆä¸¤ä¸ªç›¸åŒçš„ç©ºé—´ï¼Œä»æ ¹å¼€å§‹è®¿é—®æ¯ä¸€ä¸ªå…³è”çš„å¯è¾¾å¯¹è±¡ï¼Œå°†ç©ºé—´Açš„å¯è¾¾å¯¹è±¡å…¨éƒ¨å¤åˆ¶åˆ°ç©ºé—´Bï¼Œç„¶åä¸€æ¬¡æ€§å›æ”¶æ•´ä¸ªç©ºé—´Aã€‚ æ ‡è®°æ¸…é™¤ï¼šä¹Ÿå°±æ˜¯ ä¸å‹ç¼© çš„å›æ”¶æ–¹å¼ã€‚åƒåœ¾å›æ”¶å™¨å…ˆä»æ ¹å¼€å§‹è®¿é—®æ‰€æœ‰å¯è¾¾å¯¹è±¡ï¼Œå°†å®ƒä»¬æ ‡è®°ä¸ºå¯è¾¾çŠ¶æ€ï¼Œç„¶åå†éå†ä¸€æ¬¡æ•´ä¸ªå†…å­˜åŒºåŸŸï¼ŒæŠŠæ‰€æœ‰æ²¡æœ‰æ ‡è®°ä¸ºå¯è¾¾çš„å¯¹è±¡è¿›è¡Œå›æ”¶å¤„ç†ã€‚ æ ‡è®°å‹ç¼©ï¼šè¿™æ˜¯å‹ç¼©æ–¹å¼ï¼Œè¿™ç§æ–¹å¼å……åˆ†åˆ©ç”¨ä¸Šè¿°ä¸¤ç§ç®—æ³•çš„ä¼˜ç‚¹ï¼Œåƒåœ¾å›æ”¶å™¨å…ˆä»æ ¹å¼€å§‹è®¿é—®æ‰€æœ‰å¯è¾¾å¯¹è±¡ï¼Œå°†ä»–ä»¬æ ‡è®°ä¸ºå¯è¾¾çŠ¶æ€ï¼Œæ¥ä¸‹æ¥åƒåœ¾å›æ”¶å™¨ä¼šå°†è¿™äº›æ´»åŠ¨å¯¹è±¡æ¬è¿åœ¨ä¸€èµ·ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åšå†…å­˜å‹ç¼©ï¼Œç„¶ååƒåœ¾å›æ”¶æœºåˆ¶å†æ¬¡å›æ”¶é‚£äº›ä¸å¯è¾¾å¯¹è±¡æ‰€å ç”¨çš„å†…å­˜ç©ºé—´ï¼Œè¿™æ ·å°±é¿å…äº†å›æ”¶äº§ç”Ÿçš„å†…å­˜ç¢ç‰‡ã€‚ å †å†…å­˜çš„åˆ†ä»£å›æ”¶1ã€Young ä»£ 2ã€Old ä»£ 3ã€Permanent ä»£ å†…å­˜ç®¡ç†å°æŠ€å·§ å°½é‡ä½¿ç”¨ç›´æ¥é‡ ä½¿ç”¨ StringBuilder å’Œ StringBuffer è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥ å°½æ—©é‡Šæ”¾æ— ç”¨å¯¹è±¡çš„å¼•ç”¨ å°½é‡å°‘ç”¨é™æ€å˜é‡ é¿å…åœ¨ç»å¸¸è°ƒç”¨çš„æ–¹æ³•ã€å¾ªç¯ä¸­åˆ›å»º Java å¯¹è±¡ ç¼“å­˜ç»å¸¸ä½¿ç”¨çš„å¯¹è±¡ å°½é‡ä¸è¦ä½¿ç”¨ finalize æ–¹æ³• è€ƒè™‘ä½¿ç”¨ SoftReference ç¬¬ 5 è¯¾ â€”â€” è¡¨è¾¾å¼ä¸­çš„é™·é˜±å…³äºå­—ç¬¦ä¸²çš„é™·é˜±JVM å¯¹å­—ç¬¦ä¸²çš„å¤„ç†String java = new String(&quot;Java&quot;) è¿™å¥åˆ›å»ºäº†ä¸¤ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼Œä¸€ä¸ªæ˜¯ â€œJavaâ€ è¿™ä¸ªç›´æ¥é‡å¯¹åº”çš„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯ new String() æ„é€ å™¨è¿”å›çš„å­—ç¬¦ä¸²å¯¹è±¡ã€‚ Java ç¨‹åºä¸­åˆ›å»ºå¯¹è±¡çš„æ–¹æ³•ï¼š é€šè¿‡ new è°ƒç”¨æ„é€ å™¨åˆ›å»º Java å¯¹è±¡ é€šè¿‡ Class å¯¹è±¡çš„ newInstance() æ–¹æ³•è°ƒç”¨æ„é€ å™¨åˆ›å»º Java å¯¹è±¡ é€šè¿‡ Java çš„ååºåˆ—åŒ–æœºåˆ¶ä» IO æµä¸­æ¢å¤ Java å¯¹è±¡ é€šè¿‡ Java å¯¹è±¡æä¾›çš„ clone() æ–¹æ³•å¤åˆ¶ä¸€ä¸ªæ–°çš„ Java å¯¹è±¡ å¯¹äºå­—ç¬¦ä¸²ä»¥åŠ Byteã€Shortã€Intã€Longã€Characterã€Floatã€Double å’Œ Boolean è¿™äº›åŸºæœ¬ç±»å‹çš„åŒ…è£…ç±» ç›´æ¥é‡çš„æ–¹å¼æ¥åˆ›å»º Java å¯¹è±¡ Integer in = 5ï¼› é€šè¿‡ç®€å•çš„ç®—æ³•è¡¨è¾¾å¼ï¼Œè¿æ¥è¿ç®—æ¥åˆ›å»º Java å¯¹è±¡ String str = â€œaâ€ + â€œbâ€; ï¼ˆå¦‚æœè¿™ä¸ªå­—ç¬¦ä¸²è¡¨è¾¾å¼çš„å€¼åœ¨ç¼–è¯‘æ—¶ç¡®å®šä¸‹æ¥ï¼Œé‚£ä¹ˆ JVM ä¼šåœ¨ç¼–è¯‘æ—¶è®¡ç®—è¯¥å­—ç¬¦ä¸²å˜é‡çš„å€¼ï¼Œå¹¶è®©å®ƒæŒ‡å‘å­—ç¬¦ä¸²æ± ä¸­å¯¹åº”çš„å­—ç¬¦ä¸²ã€‚å¦‚æœè¿™äº›ç®—æ³•è¡¨è¾¾å¼éƒ½æ˜¯å­—ç¬¦ä¸²ç›´æ¥é‡ã€æ•´æ•°ç›´æ¥é‡ï¼Œæ²¡æœ‰å˜é‡å’Œæ–¹æ³•å‚ä¸ï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨ç¼–è¯‘æœŸå°±å¯ä»¥ç¡®å®šå­—ç¬¦ä¸²çš„å€¼ï¼›å¦‚æœä½¿ç”¨äº†å˜é‡ã€è°ƒç”¨äº†æ–¹æ³•ï¼Œé‚£ä¹ˆåªæœ‰ç­‰åˆ°è¿è¡Œæ—¶æ‰èƒ½ç¡®å®šå­—ç¬¦ä¸²è¡¨è¾¾å¼çš„å€¼ï¼›å¦‚æœå­—ç¬¦ä¸²è¿æ¥è¿ç®—æ‰€æœ‰çš„å˜é‡éƒ½å¯æ‰§è¡Œ â€œå®æ›¿æ¢â€ï¼ˆä½¿ç”¨ final ä¿®é¥°çš„å˜é‡ï¼‰ï¼Œé‚£åœ¨ç¼–è¯‘æ—¶æœŸä¹Ÿèƒ½ç¡®å®šå­—ç¬¦ä¸²è¿æ¥è¡¨è¾¾å¼çš„å€¼ï¼‰ å¯¹äº Java ç¨‹åºçš„å­—ç¬¦ç›´æ¥é‡ï¼ŒJVM ä¼šä½¿ç”¨ä¸€ä¸ªå­—ç¬¦ä¸²æ± æ¥ä¿æŠ¤å®ƒä»¬ï¼›å½“ç¬¬ä¸€æ¬¡ä½¿ç”¨æŸä¸ªå­—ç¬¦ä¸²ç›´æ¥é‡æ—¶ï¼ŒJVM ä¼šå°†å®ƒæ”¾å…¥å­—ç¬¦ä¸²æ± è¿›è¡Œç¼“å­˜ã€‚åœ¨ä¸€èˆ¬çš„æƒ…å†µä¸‹ï¼Œå­—ç¬¦ä¸²æ± ä¸­çš„å­—ç¬¦ä¸²å¯¹è±¡ä¸ä¼šè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ï¼Œå½“ç¨‹åºå†æ¬¡éœ€è¦ä½¿ç”¨è¯¥å­—ç¬¦ä¸²æ—¶ï¼Œæ— éœ€é‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯ç›´æ¥è®©å¼•ç”¨å˜é‡æŒ‡å‘å­—ç¬¦ä¸²æ± ä¸­å·²æœ‰çš„å­—ç¬¦ä¸²ã€‚ ä¸å¯å˜çš„å­—ç¬¦ä¸²String ç±»æ˜¯ä¸€ä¸ªä¸å¯å˜ç±»ï¼Œå½“ä¸€ä¸ª String å¯¹è±¡åˆ›å»ºå®Œæˆåï¼Œè¯¥ String ç±»é‡ŒåŒ…å«çš„å­—ç¬¦åºåˆ—å°±è¢«å›ºå®šä¸‹æ¥ï¼Œä»¥åæ°¸è¿œä¸èƒ½ä¿®æ”¹ã€‚ å¦‚æœç¨‹åºéœ€è¦ä¸€ä¸ªå­—ç¬¦åºåˆ—ä¼šå‘ç”Ÿæ”¹å˜çš„å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆå»ºè®®ä½¿ç”¨ StringBuilder ï¼ˆæ•ˆç‡æ¯” StringBuffer é«˜ï¼‰ å­—ç¬¦ä¸²æ¯”è¾ƒå¦‚æœè¦æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ç›¸åŒï¼Œç”¨ == è¿›è¡Œåˆ¤æ–­å°±è¡Œï¼Œä½†å¦‚æœè¦åˆ¤æ–­ä¸¤ä¸ªå­—ç¬¦ä¸²æ‰€åŒ…å«çš„å­—ç¬¦åºåˆ—æ˜¯å¦ç›¸åŒï¼Œåˆ™åº”è¯¥ç”¨ String é‡å†™è¿‡çš„ equals() æ–¹æ³•è¿›è¡Œæ¯”è¾ƒã€‚ 123456789101112131415161718192021222324252627public boolean equals(Object anObject) &#123; //å¦‚æœä¸¤ä¸ªå­—ç¬¦ä¸²ç›¸åŒ if (this == anObject) &#123; return true; &#125; //å¦‚æœanObjectæ˜¯Stringç±»å‹ if (anObject instanceof String) &#123; String anotherString = (String)anObject; //nä»£è¡¨å­—ç¬¦ä¸²çš„é•¿åº¦ int n = value.length; //å¦‚æœä¸¤ä¸ªå­—ç¬¦ä¸²é•¿åº¦ç›¸ç­‰ if (n == anotherString.value.length) &#123; //è·å–å½“å‰å­—ç¬¦ä¸²ã€anotherStringåº•å±‚å°è£…çš„å­—ç¬¦æ•°ç»„ char v1[] = value; char v2[] = anotherString.value; int i = 0; //é€ä¸€æ¯”è¾ƒv1 å’Œ v2æ•°ç»„ä¸­çš„æ¯ä¸ªå­—ç¬¦ while (n-- != 0) &#123; if (v1[i] != v2[i]) return false; i++; &#125; return true; &#125; &#125; return false; &#125; è¿˜å¯ä»¥ä½¿ç”¨ String æä¾›çš„ compareTo() æ–¹æ³•è¿”å›ä¸¤ä¸ªå­—ç¬¦ä¸²çš„å¤§å° 123456789101112131415161718public int compareTo(String anotherString) &#123; int len1 = value.length; int len2 = anotherString.value.length; int lim = Math.min(len1, len2); char v1[] = value; char v2[] = anotherString.value; int k = 0; while (k &lt; lim) &#123; char c1 = v1[k]; char c2 = v2[k]; if (c1 != c2) &#123; return c1 - c2; &#125; k++; &#125; return len1 - len2; &#125; è¡¨è¾¾å¼ç±»å‹çš„é™·é˜±è¡¨è¾¾å¼ç±»å‹çš„è‡ªåŠ¨æå‡ æ‰€æœ‰ byteã€shortã€charç±»å‹å°†è¢«æå‡åˆ° int ç±»å‹å‚ä¸è¿ç®— æ•´ä¸ªç®—æœ¯è¡¨è¾¾å¼çš„æ•°æ®ç±»å‹è‡ªåŠ¨æå‡åˆ°ä¸è¡¨è¾¾å¼ä¸­æœ€é«˜ç­‰çº§æ“ä½œæ•°åŒæ ·çš„ç±»å‹ï¼Œæ“ä½œæ•°çš„ç­‰çº§æ’åˆ—å¦‚ä¸‹ï¼šchar -&gt; int -&gt; long -&gt;float -&gt; double byte -&gt; short -&gt; int -&gt; long -&gt;float -&gt; double å¤åˆèµ‹å€¼è¿ç®—ç¬¦çš„é™·é˜±Java è¯­è¨€å…è®¸æ‰€æœ‰çš„åŒç›®è¿ç®—ç¬¦å’Œ = ä¸€èµ·ç»“åˆç»„æˆå¤åˆèµ‹å€¼è¿ç®—ç¬¦ï¼Œå¦‚ +=ã€-=ã€*=ã€/=ã€%= ã€&amp;= ç­‰ï¼Œå¤åˆèµ‹å€¼è¿ç®—ç¬¦åŒ…å«äº†ä¸€ä¸ªéšå¼çš„ç±»å‹è½¬æ¢ã€‚ 123//ä¸‹é¢è¿™ä¸¤æ¡è¯­å¥ä¸ç­‰ä»·a = a + 5; //a += 5; //å®é™…ä¸Šç­‰ä»·äº a = (açš„ç±»å‹) (a + 5); å¤åˆèµ‹å€¼è¿ç®—ç¬¦ä¼šè‡ªåŠ¨çš„å°†å®ƒè®¡ç®—çš„ç»“æœå€¼å¼ºåˆ¶è½¬æ¢ä¸ºå…¶å·¦ä¾§å˜é‡çš„ç±»å‹ã€‚ è¾“å…¥æ³•å¯¼è‡´çš„é™·é˜±æ³¨é‡Šçš„å­—ç¬¦å¿…é¡»åˆæ³•è½¬ä¹‰å­—ç¬¦çš„é™·é˜± æ…ç”¨å­—ç¬¦çš„ Unicode è½¬ä¹‰å½¢å¼ ä¸­æ­¢è¡Œæ³¨é‡Šçš„è½¬ä¹‰å­—ç¬¦ æ³›å‹å¯èƒ½å¼•èµ·çš„é”™è¯¯åŸå§‹ç±»å‹å˜é‡çš„èµ‹å€¼ å½“ç¨‹åºæŠŠä¸€ä¸ªåŸå§‹ç±»å‹çš„å˜é‡èµ‹ç»™ä¸€ä¸ªå¸¦æœ‰æ³›å‹ä¿¡æ¯çš„å˜é‡æ—¶ï¼Œæ€»æ˜¯å¯ä»¥é€šè¿‡ç¼–è¯‘ï¼ˆåªæ˜¯ä¼šæç¤ºè­¦å‘Šä¿¡æ¯ï¼‰ å½“ç¨‹åºè¯•å›¾è®¿é—®å¸¦æ³›å‹å£°æ˜çš„é›†åˆçš„é›†åˆå…ƒç´ æ—¶ï¼Œç¼–è¯‘å™¨æ€»æ˜¯æŠŠé›†åˆå…ƒç´ å½“æˆæ³›å‹ç±»å‹å¤„ç†ï¼ˆå®ƒå¹¶ä¸å…³å¿ƒé›†åˆé‡Œé›†åˆå…ƒç´ çš„å®é™…ç±»å‹ï¼‰ å½“ç¨‹åºè¯•å›¾è®¿é—®å¸¦æ³›å‹å£°æ˜çš„é›†åˆçš„é›†åˆå…ƒç´ æ—¶ï¼ŒJVMä¼šéå†æ¯ä¸ªé›†åˆå…ƒç´ è‡ªåŠ¨æ‰§è¡Œå¼ºåˆ¶è½¬å‹ï¼Œå¦‚æœé›†åˆå…ƒç´ çš„å®é™…ç±»å‹ä¸é›†åˆæ‰€å¸¦çš„æ³›å‹ä¿¡æ¯ä¸åŒ¹é…ï¼Œè¿è¡Œæ—¶å°†å¼•å‘ ClassCastException åŸå§‹ç±»å‹å¸¦æ¥çš„æ“¦é™¤å½“æŠŠä¸€ä¸ªå…·æœ‰æ³›å‹ä¿¡æ¯çš„å¯¹è±¡èµ‹ç»™å¦ä¸€ä¸ªæ²¡æœ‰æ³›å‹ä¿¡æ¯çš„å˜é‡æ—¶ï¼Œæ‰€æœ‰åœ¨å°–æ‹¬å·ä¹‹é—´çš„ç±»å‹ä¿¡æ¯éƒ½ä¼šä¸¢å¼ƒã€‚ åˆ›å»ºæ³›å‹æ•°ç»„çš„é™·é˜±Java ä¸­ä¸å…è®¸åˆ›å»ºæ³›å‹æ•°ç»„ æ­£åˆ™è¡¨è¾¾å¼çš„é™·é˜±æœ‰äº›ç¬¦å·æœ¬èº«å°±æ˜¯æ­£åˆ™è¡¨è¾¾å¼ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ç¬¦å·åšè½¬ä¹‰è¿ç®—ã€‚ å¤šçº¿ç¨‹çš„é™·é˜±ä¸è¦è°ƒç”¨ run æ–¹æ³•å¼€å¯çº¿ç¨‹æ˜¯ç”¨ start() æ–¹æ³•ï¼Œè€Œä¸æ˜¯ run() æ–¹æ³•ã€‚ é™æ€çš„åŒæ­¥æ–¹æ³•å¯¹äºåŒæ­¥ä»£ç å—è€Œè¨€ï¼Œç¨‹åºå¿…é¡»æ˜¾å¼ä¸ºå®ƒæŒ‡å®šåŒæ­¥ç›‘è§†å™¨ï¼›å¯¹äºåŒæ­¥éé™æ€æ–¹æ³•è€Œè¨€ï¼Œè¯¥æ–¹æ³•çš„åŒæ­¥ç›‘è§†å™¨æ˜¯ this â€”â€” å³è°ƒç”¨è¯¥æ–¹æ³•çš„ Java å¯¹è±¡ï¼›å¯¹äºé™æ€çš„åŒæ­¥æ–¹æ³•è€Œè¨€ï¼Œè¯¥æ–¹æ³•çš„åŒæ­¥ç›‘è§†å™¨ä¸æ˜¯ thisï¼Œè€Œæ˜¯è¯¥ç±»æœ¬èº«ã€‚ ç¬¬ 6 è¯¾ â€”â€” æµç¨‹æ§åˆ¶çš„é™·é˜±switch è¯­å¥é™·é˜±break è¯­å¥ä¸è¦å¿˜è®°å†™ switch çš„è¡¨è¾¾å¼ç±»å‹ï¼š byte short int char enum String ï¼ˆJdk 1.7 ä»¥åæœ‰ Stringï¼‰ æ ‡ç­¾å¼•èµ·çš„é™·é˜±Java ä¸­çš„æ ‡ç­¾é€šå¸¸æ˜¯å’Œå¾ªç¯ä¸­çš„ break å’Œ continue ç»“åˆä½¿ç”¨ï¼Œè®© break ç›´æ¥ç»ˆæ­¢æ ‡ç­¾æ‰€æ ‡è¯†çš„å¾ªç¯ï¼Œè®© continue è¯­å¥å¿½ç•¥æ ‡ç­¾æ‰€æ ‡è¯†çš„å¾ªç¯çš„å‰©ä¸‹è¯­å¥ã€‚ ã€‚ã€‚ ç¬¬ 7 è¯¾ â€”â€” é¢å‘å¯¹è±¡çš„é™·é˜±instanceof è¿ç®—ç¬¦çš„é™·é˜±instanceof å®ƒç”¨äºåˆ¤æ–­å‰é¢çš„å¯¹è±¡æ˜¯å¦æ˜¯åé¢çš„ç±»æˆ–å…¶å­ç±»ã€å®ç°ç±»çš„å®ä¾‹ã€‚å¦‚æœæ˜¯è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚ instanceof è¿ç®—ç¬¦å‰é¢æ“ä½œæ•°çš„ç¼–è¯‘æ—¶ç±»å‹å¿…é¡»æ˜¯ï¼š è¦ä¹ˆä¸åé¢çš„ç±»ç›¸åŒ è¦ä¹ˆæ˜¯åé¢ç±»çš„çˆ¶ç±» è¦ä¹ˆæ˜¯åé¢ç±»å‹çš„å­ç±» æ„é€ å™¨é™·é˜±æ„é€ å™¨æ˜¯ Java ä¸­æ¯ä¸ªç±»éƒ½ä¼šæä¾›çš„ä¸€ä¸ªâ€œç‰¹æ®Šæ–¹æ³•â€ã€‚æ„é€ å™¨è´Ÿè´£å¯¹ Java å¯¹è±¡æ‰§è¡Œåˆå§‹åŒ–æ“ä½œï¼Œä¸ç®¡æ˜¯å®šä¹‰å®ä¾‹å˜é‡æ—¶æŒ‡å®šçš„åˆå§‹å€¼ï¼Œè¿˜æ˜¯åœ¨éé™æ€åˆå§‹åŒ–ä»£ç å—ä¸­æ‰€åšçš„æ“ä½œï¼Œå®é™…ä¸Šéƒ½ä¼šè¢«æå–åˆ°æ„é€ å™¨ä¸­æ‰§è¡Œã€‚ æ„é€ å™¨ä¸èƒ½å£°æ˜è¿”å›å€¼ç±»å‹ï¼Œä¹Ÿä¸èƒ½ä½¿ç”¨voidå£°æ˜æ„é€ å™¨æ²¡æœ‰è¿”å›å€¼ã€‚ æ„é€ å™¨åˆ›å»ºå¯¹è±¡å—æ„é€ å™¨å¹¶ä¸ä¼šåˆ›å»º Java å¯¹è±¡ï¼Œæ„é€ å™¨åªæ˜¯è´Ÿè´£æ‰§è¡Œåˆå§‹åŒ–ï¼Œåœ¨æ„é€ å™¨æ‰§è¡Œä¹‹å‰ï¼ŒJava å¯¹è±¡æ‰€éœ€è¦çš„å†…å­˜ç©ºé—´ï¼Œæ˜¯ç”± new å…³é”®å­—ç”³è¯·å‡ºæ¥çš„ã€‚ç»å¤§éƒ¨åˆ†æ—¶å€™ï¼Œç¨‹åºä½¿ç”¨ new å…³é”®å­—ä¸ºä¸€ä¸ª Java å¯¹è±¡ç”³è¯·ç©ºé—´ä¹‹åï¼Œéƒ½éœ€è¦ä½¿ç”¨æ„é€ å™¨ä¸ºè¿™ä¸ªå¯¹è±¡æ‰§è¡Œåˆå§‹åŒ–ï¼Œä½†åœ¨æŸäº›æ—¶å€™ï¼Œç¨‹åºåˆ›å»º Java å¯¹è±¡æ— éœ€è°ƒç”¨æ„é€ å™¨ï¼Œå¦‚ä¸‹ï¼š ä½¿ç”¨ååºåˆ—åŒ–çš„æ–¹å¼æ¢å¤ Java å¯¹è±¡ ä½¿ç”¨ clone æ–¹æ³•å¤åˆ¶ Java å¯¹è±¡ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778package com.zhisheng.test;import java.io.*;/** * Created by 10412 on 2017/5/31. */class Wolf implements Serializable&#123; private String name; public Wolf(String name) &#123; System.out.println(\"è°ƒç”¨äº†æœ‰å‚æ„é€ æ–¹æ³•\"); this.name = name; &#125; @Override public boolean equals(Object o) &#123; if (this == o) return true; if (o == null || getClass() != o.getClass()) return false; Wolf wolf = (Wolf) o; return name != null ? name.equals(wolf.name) : wolf.name == null; &#125; @Override public int hashCode() &#123; return name != null ? name.hashCode() : 0; &#125;&#125;public class SerializableTest&#123; public static void main(String[] args) &#123; Wolf w = new Wolf(\"ç°å¤ªç‹¼\"); System.out.println(\"å¯¹è±¡åˆ›å»ºå®Œæˆ\"); Wolf w2 = null; ObjectInputStream ois = null; ObjectOutputStream oos = null; try &#123; //åˆ›å»ºè¾“å‡ºå¯¹è±¡æµ oos = new ObjectOutputStream(new FileOutputStream(\"a.bin\")); //åˆ›å»ºè¾“å…¥å¯¹è±¡æµ ois = new ObjectInputStream(new FileInputStream(\"a.bin\")); //åºåˆ—è¾“å‡ºjava å¯¹è±¡ oos.writeObject(w); oos.flush(); //ååºåˆ—åŒ–æ¢å¤javaå¯¹è±¡ w2 = (Wolf) ois.readObject(); System.out.println(w); System.out.println(w2); //ä¸¤ä¸ªå¯¹è±¡çš„å®ä¾‹å˜é‡å€¼å®Œå…¨ç›¸ç­‰ï¼Œè¾“å‡ºtrue System.out.println(w.equals(w2)); //ä¸¤ä¸ªå¯¹è±¡ä¸åŒï¼Œè¾“å‡ºfalse System.out.println(w == w2); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; catch (ClassNotFoundException e) &#123; e.printStackTrace(); &#125;finally &#123; if (ois!=null) try &#123; ois.close(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; if (oos!=null) try &#123; oos.close(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; &#125;&#125; ç¨‹åºè¿è¡Œç»“æœï¼š 123456è°ƒç”¨äº†æœ‰å‚æ„é€ æ–¹æ³•å¯¹è±¡åˆ›å»ºå®Œæˆcom.zhisheng.test.Wolf@1b15382com.zhisheng.test.Wolf@1b15382truefalse æ­£å¦‚ç»“æœæ‰€ç¤ºï¼šåˆ›å»º Wolf å¯¹è±¡æ—¶ï¼Œç¨‹åºè°ƒç”¨äº†ç›¸åº”çš„æ„é€ å™¨æ¥å¯¹è¯¥å¯¹è±¡æ‰§è¡Œåˆå§‹åŒ–ï¼›å½“ç¨‹åºé€šè¿‡ååºåˆ—åŒ–æœºåˆ¶æ¢å¤ Java å¯¹è±¡æ—¶ï¼Œç³»ç»Ÿæ— éœ€åœ¨è°ƒç”¨æ„é€ å™¨æ¥è¿›è¡Œåˆå§‹åŒ–ã€‚é€šè¿‡ååºåˆ—åŒ–æ¢å¤å‡ºæ¥çš„ Wolf å¯¹è±¡å’ŒåŸæ¥çš„ Wolf å¯¹è±¡å…·æœ‰å®Œå…¨ç›¸åŒçš„å®ä¾‹å˜é‡å€¼ï¼Œä½†ç³»ç»Ÿä¼šäº§ç”Ÿä¸¤ä¸ªå¯¹è±¡ã€‚ æ— é™é€’å½’æ„é€ å™¨12345678910111213public class ConstrutionTest&#123; ConstrutionTest ct; &#123; ct = new ConstrutionTest(); &#125; public ConstrutionTest() &#123; System.out.println(\"æ— å‚æ„é€ å™¨\"); &#125; public static void main(String[] args) &#123; ConstrutionTest ct = new ConstrutionTest(); &#125;&#125; è¿è¡Œç»“æœæŠ›å‡ºå¼‚å¸¸ java.lang.StackOverflowError å› ä¸ºä¸ç®¡å®šä¹‰å®ä¾‹å˜é‡æ—¶æŒ‡å®šçš„åˆå§‹å€¼ï¼Œè¿˜æ˜¯åœ¨éé™æ€åˆå§‹åŒ–ä»£ç å—ä¸­æ‰§è¡Œçš„åˆå§‹åŒ–æ“ä½œï¼Œæœ€ç»ˆéƒ½å°†æå–åˆ°æ„é€ å™¨ä¸­æ‰§è¡Œï¼Œå› ä¸ºä»£ç ä¸­é€’å½’è°ƒç”¨äº†ç±»çš„æ„é€ å™¨ï¼Œæœ€ç»ˆå¯¼è‡´å‡ºç° java.lang.StackOverflowError å¼‚å¸¸ã€‚ åˆ°åº•è°ƒç”¨å“ªä¸ªé‡è½½æ–¹æ³•1ã€ç¬¬ä¸€é˜¶æ®µ JVM å°†ä¼šé€‰å–æ‰€æœ‰å¯è·å¾—å¹¶åŒ¹é…è°ƒç”¨çš„æ–¹æ³•æˆ–è€…æ„é€ å™¨ 2ã€ç¬¬äºŒä¸ªé˜¶æ®µå†³å®šåˆ°åº•è¦è°ƒç”¨å“ªä¸ªæ–¹æ³•ï¼Œæ­¤æ—¶ JVM ä¼šåœ¨ç¬¬ä¸€é˜¶æ®µæ‰€é€‰å–çš„æ–¹æ³•æˆ–è€…æ„é€ å™¨ä¸­å†æ¬¡é€‰å–æœ€ç²¾ç¡®åŒ¹é…çš„é‚£ä¸€ä¸ªã€‚ 1234567891011121314151617public class OverrideTest&#123; public void info(Object obj, int a) &#123; System.out.println(\"obj å‚æ•°\" + obj); System.out.println(\"æ•´å‹å‚æ•° \" + a); &#125; public void info(Object[] obj, double a) &#123; System.out.println(\"obj å‚æ•°\" + obj); System.out.println(\"æ•´å‹å‚æ•° \" + a); &#125; public static void main(String[] args) &#123; OverrideTest o = new OverrideTest(); o.info(null, 5); &#125;&#125; æŠ¥é”™å¦‚ä¸‹ï¼š 12Error:(20, 10) java: å¯¹infoçš„å¼•ç”¨ä¸æ˜ç¡® com.zhisheng.test.OverrideTest ä¸­çš„æ–¹æ³• info(java.lang.Object,int) å’Œ com.zhisheng.test.OverrideTest ä¸­çš„æ–¹æ³• info(java.lang.Object[],double) éƒ½åŒ¹é… åœ¨è¿™ç§å¤æ‚çš„æ¡ä»¶ä¸‹ï¼ŒJVM æ— æ³•åˆ¤æ–­å“ªä¸ªæ–¹æ³•æ›´åŒ¹é…å®é™…è°ƒç”¨ï¼Œå°†ä¼šå¯¼è‡´ç¨‹åºç¼–è¯‘é”™è¯¯ã€‚ æ–¹æ³•é‡å†™çš„é™·é˜±æ— æ³•é‡å†™çˆ¶ç±» private æ–¹æ³•ã€‚å¦‚æœå­ç±»æœ‰ä¸€ä¸ªä¸çˆ¶ç±» private æ–¹æ³•å…·æœ‰ç›¸åŒæ–¹æ³•åã€ç›¸åŒå½¢å‚åˆ—è¡¨ã€ç›¸åŒè¿”å›å€¼ç±»å‹çš„æ–¹æ³•ï¼Œä¾ç„¶ä¸æ˜¯é‡å†™ï¼Œåªæ˜¯å­ç±»å®šä¹‰äº†ä¸€ä¸ªä¸çˆ¶ç±»ç›¸åŒçš„æ–¹æ³•ã€‚ static å…³é”®å­—static å¯ä»¥ä¿®é¥°ç±»ä¸­å®šä¹‰çš„æˆå‘˜ï¼šfieldã€æ–¹æ³•ã€å†…éƒ¨ç±»ã€åˆå§‹åŒ–ä»£ç å—ã€å†…éƒ¨æšä¸¾ç±» é™æ€æ–¹æ³•å±äºç±»è¢« static ä¿®é¥°çš„æˆå‘˜ï¼ˆfieldã€æ–¹æ³•ã€å†…éƒ¨ç±»ã€åˆå§‹åŒ–å—ã€å†…éƒ¨æšä¸¾ç±»ï¼‰å±äºç±»æœ¬èº«ï¼Œè€Œä¸æ˜¯å•ä¸ªçš„ Java å¯¹è±¡ã€‚é™æ€æ–¹æ³•ä¹Ÿæ˜¯å±äºç±»ã€‚ ç¬¬ 8 è¯¾ â€”â€” å¼‚å¸¸æ•æ‰çš„é™·é˜±æ­£ç¡®å…³é—­èµ„æºçš„æ–¹å¼ ä½¿ç”¨ finally å—æ¥ä¿è¯å›æ”¶ï¼Œä¿è¯å…³é—­æ“ä½œæ€»æ˜¯ä¼šè¢«æ‰§è¡Œ å…³é—­æ¯ä¸ªèµ„æºä¹‹å‰é¦–å…ˆä¿è¯å¼•ç”¨è¯¥èµ„æºçš„å¼•ç”¨å˜é‡ä¸ä¸º null ä¸ºæ¯ä¸ªç‰©ç†èµ„æºå•ç‹¬ä½¿ç”¨ try .. catch å—å…³é—­èµ„æºï¼Œä¿è¯å…³é—­èµ„æºæ—¶å¼•å‘çš„å¼‚å¸¸ä¸ä¼šå½±å“å…¶ä»–èµ„æºçš„å…³é—­ã€‚ finally å—é™·é˜±finally æ‰§è¡Œé¡ºåºï¼Œçœ‹æˆ‘ä»¥å‰å†™çš„ä¸€ç¯‡æ–‡ç« ã€Šæ·±åº¦æ¢ç©¶Java ä¸­ finally è¯­å¥å—ã€‹ã€‚ catch å—ç”¨æ³•åœ¨ try å—åä½¿ç”¨ catch å—æ¥æ•è·å¤šä¸ªå¼‚å¸¸æ—¶ï¼Œç¨‹åºåº”è¯¥å°å¿ƒå¤šä¸ª catch å—ä¹‹é—´çš„é¡ºåºï¼šæ•è·çˆ¶ç±»å¼‚å¸¸çš„ catch å—éƒ½åº”è¯¥æ’åœ¨æ•è·å­ç±»å¼‚å¸¸çš„ catch å—ä¹‹åï¼ˆå…ˆå¤„ç†å°å¼‚å¸¸ï¼Œå†å¤„ç†å¤§å¼‚å¸¸ï¼‰ï¼Œå¦åˆ™å‡ºç°ç¼–è¯‘é”™è¯¯ã€‚ ç»§æ‰¿å¾—åˆ°çš„å¼‚å¸¸å­ç±»é‡å†™çˆ¶ç±»æ–¹æ³•æ—¶ï¼Œä¸èƒ½å£°æ˜æŠ›å‡ºæ¯”çˆ¶ç±»æ–¹æ³•ç±»å‹æ›´å¤šã€èŒƒå›´æ›´å¤§çš„å¼‚å¸¸ã€‚ äºŒå‰æ ‘æ€§è´¨ï¼š äºŒå‰æ ‘ç¬¬ i å±‚ä¸Šçš„èŠ‚ç‚¹æ•°ç›®è‡³å¤šä¸º 2 ^(i - 1) (i &gt;= 1) æ·±åº¦ä¸º k çš„äºŒå‰æ ‘è‡³å¤šæœ‰ 2 ^ k - 1 ä¸ªèŠ‚ç‚¹ åœ¨ä»»ä½•ä¸€é¢—äºŒå‰æ ‘ä¸­ï¼Œå¦‚æœå…¶å¶å­ç»“ç‚¹çš„æ•°é‡ä¸º n0ï¼Œåº¦ä¸º 2 çš„å­èŠ‚ç‚¹æ•°é‡ä¸º n2ï¼Œåˆ™ n0 = n2 + 1 å…·æœ‰ n ä¸ªèŠ‚ç‚¹çš„å®Œå…¨äºŒå‰æ ‘çš„æ·±åº¦ä¸º log n + 1 (log çš„åº•ä¸º 2) å¯¹äºä¸€æ£µæœ‰ n ä¸ªèŠ‚ç‚¹çš„å®Œå…¨äºŒå‰æ ‘çš„èŠ‚ç‚¹æŒ‰å±‚è‡ªå·¦å‘å³ç¼–å·ï¼Œåˆ™å¯¹ä»»ä¸€ç¼–å·ä¸º i çš„èŠ‚ç‚¹æœ‰å¦‚ä¸‹æ€§è´¨ï¼š å½“ i == 1 æ—¶ï¼ŒèŠ‚ç‚¹ i æ˜¯äºŒå‰æ ‘çš„æ ¹ï¼›è‹¥ i &gt; 1 æ—¶ï¼Œåˆ™èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹æ˜¯ i/2 å½“ 2i &lt;= nï¼Œåˆ™èŠ‚ç‚¹ i æœ‰å·¦å­©å­ï¼Œå·¦å­©å­çš„ç¼–å·æ˜¯ 2iï¼Œå¦åˆ™ï¼ŒèŠ‚ç‚¹æ— å·¦å­©å­ï¼Œå¹¶ä¸”æ˜¯å¶å­ç»“ç‚¹ è‹¥ 2i + 1 &lt;= n ï¼Œåˆ™èŠ‚ç‚¹ i æœ‰å³å­©å­ï¼Œå³å­©å­çš„ç¼–å·æ˜¯ 2i + 1ï¼›å¦åˆ™ï¼ŒèŠ‚ç‚¹æ— å³å­©å­ã€‚ å¯¹äºä¸€é¢— n ä¸ªèŠ‚ç‚¹çš„å®Œå…¨äºŒå‰æ ‘çš„èŠ‚ç‚¹æŒ‰å±‚è‡ªå·¦å‘å³ç¼–å·ï¼Œ1 ~ n/2 èŒƒå›´çš„èŠ‚ç‚¹éƒ½æ˜¯æœ‰å­©å­èŠ‚ç‚¹çš„éå¶å­ç»“ç‚¹ï¼Œå…¶ä½™çš„èŠ‚ç‚¹å…¨éƒ¨éƒ½æ˜¯å¶å­ç»“ç‚¹ã€‚ç¼–å·ä¸º n/2 çš„èŠ‚ç‚¹æœ‰å¯èƒ½åªæœ‰å·¦èŠ‚ç‚¹ï¼Œä¹Ÿå¯èƒ½æ—¢æœ‰å·¦èŠ‚ç‚¹ï¼Œåˆæœ‰å³èŠ‚ç‚¹ã€‚ é€‰æ‹©æ’åºç›´æ¥é€‰æ‹©æ’åºéœ€è¦ç»è¿‡ n - 1 è¶Ÿæ¯”è¾ƒ ç¬¬ä¸€è¶Ÿæ¯”è¾ƒï¼šç¨‹åºå°†è®°å½•å®šä½åœ¨ç¬¬ä¸€ä¸ªæ•°æ®ä¸Šï¼Œæ‹¿ç¬¬ä¸€ä¸ªæ•°æ®ä¾æ¬¡å’Œå®ƒåé¢çš„æ¯ä¸ªæ•°æ®è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç¬¬ä¸€ä¸ªæ•°æ®å¤§äºåé¢æŸä¸ªæ•°æ®ï¼Œäº¤æ¢å®ƒä»¬ã€‚ã€‚ä¾æ­¤ç±»æ¨ï¼Œç»è¿‡ç¬¬ä¸€è¶Ÿæ¯”è¾ƒï¼Œè¿™ç»„æ•°æ®ä¸­æœ€å°çš„æ•°æ®è¢«é€‰å‡ºæ¥ï¼Œå®ƒè¢«æ’åœ¨ç¬¬ä¸€ä½ã€‚ ç¬¬äºŒè¶Ÿæ¯”è¾ƒï¼šç¨‹åºå°†è®°å½•å®šä½åœ¨ç¬¬äºŒä¸ªæ•°æ®ä¸Šï¼Œæ‹¿ç¬¬äºŒä¸ªæ•°æ®ä¾æ¬¡å’Œå®ƒåé¢æ¯ä¸ªæ•°æ®è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç¬¬äºŒä¸ªæ•°æ®å¤§äºåé¢æŸä¸ªæ•°æ®ï¼Œäº¤æ¢å®ƒä»¬ã€‚ã€‚ä¾æ¬¡ç±»æ¨ï¼Œç»è¿‡ç¬¬äºŒè¶Ÿæ¯”è¾ƒï¼Œè¿™ç»„æ•°æ®ä¸­ç¬¬äºŒå°çš„æ•°æ®è¢«é€‰å‡ºï¼Œå®ƒæ’åœ¨ç¬¬äºŒä½ ã€‚ã€‚ æŒ‰æ­¤è§„åˆ™ä¸€å…±è¿›è¡Œ n-1 è¶Ÿæ¯”è¾ƒï¼Œè¿™ç»„æ•°æ®ä¸­ç¬¬ n - 1å°ï¼ˆç¬¬äºŒå¤§ï¼‰çš„æ•°æ®è¢«é€‰å‡ºï¼Œè¢«æ’åœ¨ç¬¬ n -1 ä½ï¼ˆå€’æ•°ç¬¬ä¸€ä½ï¼‰ï¼›å‰©ä¸‹çš„å°±æ˜¯æœ€å¤§çš„æ•°æ®ï¼Œå®ƒæ’åœ¨æœ€åã€‚ ç›´æ¥é€‰æ‹©æ’åºçš„ä¼˜ç‚¹å°±æ˜¯ç®—æ³•ç®€å•ï¼Œå®¹æ˜“å®ç°ï¼Œç¼ºç‚¹å°±æ˜¯æ¯è¶Ÿåªèƒ½ç¡®å®šä¸€ä¸ªå…ƒç´ ï¼Œnä¸ªæ•°ç»„éœ€è¦è¿›è¡Œ n-1 è¶Ÿæ¯”è¾ƒã€‚ å †æ’åº å»ºå † æ‹¿å †çš„æ ¹èŠ‚ç‚¹å’Œæœ€åä¸€ä¸ªèŠ‚ç‚¹äº¤æ¢ äº¤æ¢æ’åºå†’æ³¡æ’åºç¬¬ä¸€è¶Ÿï¼šä¾æ¬¡æ¯”è¾ƒ0å’Œ1ï¼Œ1å’Œ2ï¼Œ2å’Œ3 â€¦ n-2 å’Œ n - 1 ç´¢å¼•çš„å…ƒç´ ï¼Œå¦‚æœå‘ç°ç¬¬ä¸€ä¸ªæ•°æ®å¤§äºåä¸€ä¸ªæ•°æ®ï¼Œäº¤æ¢å®ƒä»¬ï¼Œç»è¿‡ç¬¬ä¸€è¶Ÿï¼Œæœ€å¤§çš„å…ƒç´ æ’åˆ°äº†æœ€åã€‚ ç¬¬äºŒè¶Ÿï¼šä¾æ¬¡æ¯”è¾ƒ0å’Œ1ï¼Œ1å’Œ2ï¼Œ2å’Œ3 â€¦ n-3 å’Œ n - 2 ç´¢å¼•çš„å…ƒç´ ï¼Œå¦‚æœå‘ç°ç¬¬ä¸€ä¸ªæ•°æ®å¤§äºåä¸€ä¸ªæ•°æ®ï¼Œäº¤æ¢å®ƒä»¬ï¼Œç»è¿‡ç¬¬äºŒè¶Ÿï¼Œç¬¬äºŒå¤§çš„å…ƒç´ æ’åˆ°äº†å€’æ•°ç¬¬äºŒä½ ã€‚ã€‚ ç¬¬ n -1 è¶Ÿï¼šä¾æ¬¡æ¯”è¾ƒ0å’Œ1å…ƒç´ ï¼Œå¦‚æœå‘ç°ç¬¬ä¸€ä¸ªæ•°æ®å¤§äºåä¸€ä¸ªæ•°æ®ï¼Œäº¤æ¢å®ƒä»¬ï¼Œç»è¿‡ç¬¬ n - 1 è¶Ÿï¼Œç¬¬äºŒå°çš„å…ƒç´ æ’åˆ°äº†ç¬¬äºŒä½ã€‚ å¿«é€Ÿæ’åºä»å¾…æ’çš„æ•°æ®åºåˆ—ä¸­ä»»å–ä¸€ä¸ªæ•°æ®ä½œä¸ºåˆ†ç•Œå€¼ï¼Œæ‰€æœ‰æ¯”å®ƒå°çš„æ•°æ®å…ƒç´ ä¸€å¾‹æ”¾åœ¨å·¦è¾¹ï¼Œæ‰€æœ‰æ¯”ä»–å¤§çš„å…ƒç´ ä¸€å¾‹æ”¾åœ¨å³è¾¹ï¼Œè¿™æ ·ä¸€è¶Ÿä¸‹æ¥ï¼Œè¯¥åºåˆ—å°±åˆ†æˆäº†ä¸¤ä¸ªå­åºåˆ—ï¼Œæ¥ä¸‹æ¥å¯¹ä¸¤ä¸ªå­åºåˆ—è¿›è¡Œé€’å½’ï¼Œç›´åˆ°æ¯ä¸ªå­åºåˆ—åªå‰©ä¸€ä¸ªï¼Œæ’åºå®Œæˆã€‚ æ’å…¥æ’åºç›´æ¥æ’å…¥æ’åºä¾æ¬¡å°†å¾…æ’åºçš„æ•°æ®å…ƒç´ æŒ‰å…¶å…³é”®å­—å€¼çš„å¤§å°æ’å…¥å‰é¢çš„æœ‰åºåºåˆ—ã€‚ æŠ˜åŠæ’å…¥æ’åºå½“ç¬¬ i - 1 è¶Ÿéœ€è¦å°†ç¬¬ i ä¸ªå…ƒç´ æ’å…¥å‰é¢çš„ 0 ~ i -1 ä¸ªå…ƒç´ åºåˆ—ä¸­æ—¶ï¼š è®¡ç®— 0 ~ i - 1 ç´¢å¼•çš„ä¸­é—´ç‚¹ï¼Œä¹Ÿå°±æ˜¯ç”¨ i ç´¢å¼•å¤„çš„å…ƒç´ å’Œ ï¼ˆ0 + i - 1ï¼‰/2 ç´¢å¼•å¤„çš„å…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœ i ç´¢å¼•å¤„çš„å…ƒç´ å¤§ï¼Œå°±ç›´æ¥åœ¨ ï¼ˆï¼ˆ0 + i - 1ï¼‰/2 ï¼‰ ~ ï¼ˆi - 1ï¼‰ååŠä¸ªèŒƒå›´å†…è¿›è¡Œæœç´¢ï¼Œåä¹‹åœ¨å‰åŠä¸ªèŒƒå›´æœç´¢ã€‚ é‡å¤ä¸Šé¢æ­¥éª¤ ç¡®å®šç¬¬ i ä¸ªå…ƒç´ çš„æ’å…¥ä½ç½®ï¼Œå°±å°†è¯¥ä½ç½®çš„åé¢æ‰€æœ‰å…ƒç´ æ•´ä½“åç§»ä¸€ä½ï¼Œç„¶åå°†ç¬¬ i ä¸ªå…ƒç´ æ”¾å…¥è¯¥ä½ç½®ã€‚","tags":[{"name":"Java","slug":"Java","permalink":"http://www.54tianzhisheng.cn/tags/Java/"}]},{"title":"é€šè¿‡é¡¹ç›®é€æ­¥æ·±å…¥äº†è§£Mybatisï¼ˆä¸€ï¼‰","date":"2017-06-11T16:00:00.000Z","path":"2017/06/12/é€šè¿‡é¡¹ç›®é€æ­¥æ·±å…¥äº†è§£Mybatis(ä¸€)/","text":"Mybatis å’Œ SpringMVC é€šè¿‡è®¢å•å•†å“æ¡ˆä¾‹é©±åŠ¨ å®˜æ–¹ä¸­æ–‡åœ°å€ï¼šhttp://www.mybatis.org/mybatis-3/zh/ å®˜æ–¹æ‰˜ç®¡åœ°å€ï¼šhttps://github.com/mybatis/mybatis-3 æœ¬é¡¹ç›®å…¨éƒ¨ä»£ç åœ°å€ï¼šhttps://github.com/zhisheng17/mybatis å¦‚æœè§‰å¾—ä¸é”™çš„è¯ï¼Œæ¬¢è¿ç»™ä¸ª star ï¼Œ å¦‚æœä½ æƒ³å®Œå–„è¿™ä¸ªé¡¹ç›®çš„è¯ï¼Œä½ ä¹Ÿå¯ä»¥ fork åä¿®æ”¹ç„¶åæ¨é€ç»™æˆ‘ã€‚ åŸºç¡€çŸ¥è¯†ï¼šå¯¹åŸç”Ÿæ€ jdbc ç¨‹åºï¼ˆå•ç‹¬ä½¿ç”¨ jdbc å¼€å‘ï¼‰é—®é¢˜æ€»ç»“1ã€ç¯å¢ƒâ€‹ java ç¯å¢ƒ ï¼šjdk1.8.0_77 â€‹ å¼€å‘å·¥å…· ï¼š IDEA 2016.1 â€‹ æ•°æ®åº“ ï¼š MySQL 5.7 2ã€åˆ›å»ºæ•°æ®åº“â€‹ mybatis_test.sql â€‹ Tables ï¼šitemsã€orderdetailã€ordersã€user 3ã€JDBC ç¨‹åºâ€‹ ä½¿ç”¨ JDBC æŸ¥è¯¢ MySQL æ•°æ®åº“ä¸­ç”¨æˆ·è¡¨çš„è®°å½• â€‹ ä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980package cn.zhisheng.mybatis.jdbc;/** * Created by 10412 on 2016/11/27. */import java.sql.*;/** *é€šè¿‡å•ç‹¬çš„jdbcç¨‹åºæ¥æ€»ç»“é—®é¢˜ */public class JdbcTest&#123; public static void main(String[] args) &#123; //æ•°æ®åº“è¿æ¥ Connection connection = null; //é¢„ç¼–è¯‘çš„Statementï¼Œä½¿ç”¨é¢„ç¼–è¯‘çš„Statementå¯ä»¥æé«˜æ•°æ®åº“æ€§èƒ½ PreparedStatement preparedStatement = null; //ç»“æœé›† ResultSet resultSet = null; try &#123; //åŠ è½½æ•°æ®åº“é©±åŠ¨ Class.forName(\"com.mysql.jdbc.Driver\"); //é€šè¿‡é©±åŠ¨ç®¡ç†ç±»è·å–æ•°æ®åº“é“¾æ¥ connection = DriverManager.getConnection(\"jdbc:mysql://localhost:3306/mybatis_test?characterEncoding=utf-8\", \"root\", \"root\"); //å®šä¹‰sqlè¯­å¥ ?è¡¨ç¤ºå ä½ç¬¦ï¼ˆåœ¨è¿™é‡Œè¡¨ç¤ºusernameï¼‰ String sql = \"select * from user where username = ?\"; //è·å–é¢„å¤„ç†statement preparedStatement = connection.prepareStatement(sql); //è®¾ç½®å‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºsqlè¯­å¥ä¸­å‚æ•°çš„åºå·ï¼ˆä»1å¼€å§‹ï¼‰ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºè®¾ç½®çš„å‚æ•°å€¼ preparedStatement.setString(1, \"ç‹äº”\"); //å‘æ•°æ®åº“å‘å‡ºsqlæ‰§è¡ŒæŸ¥è¯¢ï¼ŒæŸ¥è¯¢å‡ºç»“æœé›† resultSet = preparedStatement.executeQuery(); //éå†æŸ¥è¯¢ç»“æœé›† while(resultSet.next()) &#123; System.out.println(resultSet.getString(\"id\")+\" \"+resultSet.getString(\"username\")); &#125; &#125; catch (Exception e) &#123; e.printStackTrace(); &#125;finally&#123; //é‡Šæ”¾èµ„æº if(resultSet!=null) &#123; try &#123; resultSet.close(); &#125; catch (SQLException e) &#123; // TODO Auto-generated catch block e.printStackTrace(); &#125; &#125; if(preparedStatement!=null) &#123; try &#123; preparedStatement.close(); &#125; catch (SQLException e) &#123; // TODO Auto-generated catch block e.printStackTrace(); &#125; &#125; if(connection!=null) &#123; try &#123; connection.close(); &#125; catch (SQLException e) &#123; // TODO Auto-generated catch block e.printStackTrace(); &#125; &#125; &#125; &#125;&#125; 4ã€é—®é¢˜æ€»ç»“ æ•°æ®åº“è¿æ¥ï¼Œä½¿ç”¨æ—¶å°±åˆ›å»ºï¼Œä¸ä½¿ç”¨ç«‹å³é‡Šæ”¾ï¼Œå¯¹æ•°æ®åº“é¢‘ç¹è¿æ¥å¼€å¯å’Œå…³é—­ï¼Œé€ æˆæ•°æ®åº“èµ„æºçš„æµªè´¹ï¼Œå½±å“æ•°æ®åº“æ€§èƒ½ã€‚ è§£å†³æ–¹æ³•ï¼šä½¿ç”¨æ•°æ®åº“è¿æ¥æ± ç®¡ç†æ•°æ®åº“è¿æ¥ã€‚ å°† sql è¯­å¥ç¡¬ç¼–ç åˆ° java ä»£ç ä¸­ï¼Œå¦‚æœ sql è¯­å¥éœ€è¦ä¿®æ”¹ï¼Œé‚£ä¹ˆå°±éœ€è¦é‡æ–°ç¼–è¯‘ java ä»£ç ï¼Œä¸åˆ©äºç³»ç»Ÿçš„ç»´æŠ¤ã€‚ è®¾æƒ³ï¼šå°† sql è¯­å¥é…ç½®åœ¨ xml é…ç½®æ–‡ä»¶ä¸­ï¼Œå³ä½¿ sql è¯­å¥å‘ç”Ÿå˜åŒ–ï¼Œä¹Ÿä¸éœ€è¦é‡æ–°ç¼–è¯‘ java ä»£ç ã€‚ å‘ preparedStatement ä¸­è®¾ç½®å‚æ•°ï¼Œå¯¹å ä½ç¬¦å·ä½ç½®å’Œè®¾ç½®å‚æ•°å€¼ï¼Œç¡¬ç¼–ç åœ¨ java ä»£ç ä¸­ï¼ŒåŒæ ·ä¹Ÿä¸åˆ©äºç³»ç»Ÿçš„ç»´æŠ¤ã€‚ è®¾æƒ³ï¼šå°† sql è¯­å¥ã€å ä½ç¬¦ã€å‚æ•°å€¼é…ç½®åœ¨ xml é…ç½®æ–‡ä»¶ä¸­ã€‚ ä» resultSet ä¸­éå†ç»“æœé›†æ•°æ®æ—¶ï¼Œå­˜åœ¨ç¡¬ç¼–ç ï¼Œå°†è·å–è¡¨çš„å­—æ®µè¿›è¡Œç¡¬ç¼–ç ï¼Œä¸åˆ©äºç³»ç»Ÿç»´æŠ¤ã€‚ è®¾æƒ³ï¼šå°†æŸ¥è¯¢çš„ç»“æœé›†è‡ªåŠ¨æ˜ å°„æˆ java å¯¹è±¡ã€‚ Mybatisæ¡†æ¶åŸç†ï¼ˆæŒæ¡ï¼‰1ã€Mybatis æ˜¯ä»€ä¹ˆï¼Ÿâ€‹ Mybatis æ˜¯ä¸€ä¸ªæŒä¹…å±‚çš„æ¶æ„ï¼Œæ˜¯ appach ä¸‹çš„é¡¶çº§é¡¹ç›®ã€‚ â€‹ Mybatis åŸå…ˆæ˜¯æ‰˜ç®¡åœ¨ googlecode ä¸‹ï¼Œå†åæ¥æ˜¯æ‰˜ç®¡åœ¨ Github ä¸Šã€‚ â€‹ Mybatis è®©ç¨‹åºå‘˜å°†ä¸»è¦çš„ç²¾åŠ›æ”¾åœ¨ sql ä¸Šï¼Œé€šè¿‡ Mybatis æä¾›çš„æ˜ å°„æ–¹å¼ï¼Œè‡ªç”±çµæ´»ç”Ÿæˆï¼ˆåŠè‡ªåŠ¨ï¼Œå¤§éƒ¨åˆ†éœ€è¦ç¨‹åºå‘˜ç¼–å†™ sql ï¼‰æ»¡è¶³éœ€è¦ sql è¯­å¥ã€‚ â€‹ Mybatis å¯ä»¥å°†å‘ preparedStatement ä¸­çš„è¾“å…¥å‚æ•°è‡ªåŠ¨è¿›è¡Œè¾“å…¥æ˜ å°„ï¼Œå°†æŸ¥è¯¢ç»“æœé›†çµæ´»çš„æ˜ å°„æˆ java å¯¹è±¡ã€‚ï¼ˆè¾“å‡ºæ˜ å°„ï¼‰ 2ã€Mybatis æ¡†æ¶ æ³¨è§£ï¼š SqlMapConfig.xml ï¼ˆMybatisçš„å…¨å±€é…ç½®æ–‡ä»¶ï¼Œåç§°ä¸å®šï¼‰é…ç½®äº†æ•°æ®æºã€äº‹åŠ¡ç­‰ Mybatis è¿è¡Œç¯å¢ƒ Mapper.xml æ˜ å°„æ–‡ä»¶ï¼ˆé…ç½® sql è¯­å¥ï¼‰ SqlSessionFactory ï¼ˆä¼šè¯å·¥å‚ï¼‰æ ¹æ®é…ç½®æ–‡ä»¶é…ç½®å·¥å‚ã€åˆ›å»º SqlSession SqlSession ï¼ˆä¼šè¯ï¼‰é¢å‘ç”¨æˆ·çš„æ¥å£ã€æ“ä½œæ•°æ®åº“ï¼ˆå‘å‡º sql å¢åˆ æ”¹æŸ¥ï¼‰ Executor ï¼ˆæ‰§è¡Œå™¨ï¼‰æ˜¯ä¸€ä¸ªæ¥å£ï¼ˆåŸºæœ¬æ‰§è¡Œå™¨ã€ç¼“å­˜æ‰§è¡Œå™¨ï¼‰ã€SqlSession å†…éƒ¨é€šè¿‡æ‰§è¡Œå™¨æ“ä½œæ•°æ®åº“ Mapped Statement ï¼ˆåº•å±‚å°è£…å¯¹è±¡ï¼‰å¯¹æ“ä½œæ•°æ®åº“å­˜å‚¨å°è£…ï¼ŒåŒ…æ‹¬ sql è¯­å¥ã€è¾“å…¥å‚æ•°ã€è¾“å‡ºç»“æœç±»å‹ â€‹ Mybatiså…¥é—¨ç¨‹åº1ã€éœ€æ±‚å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š æ ¹æ®ç”¨æˆ·idæŸ¥è¯¢ä¸€ä¸ªç”¨æˆ·ä¿¡æ¯ æ ¹æ®ç”¨æˆ·åç§°æ¨¡ç³ŠæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯åˆ—è¡¨ æ·»åŠ ç”¨æˆ· æ›´æ–°ç”¨æˆ· åˆ é™¤ç”¨æˆ· 2ã€ç¯å¢ƒjava ç¯å¢ƒ ï¼šjdk1.8.0_77 å¼€å‘å·¥å…· ï¼š IDEA 2016.1 æ•°æ®åº“ ï¼š MySQL 5.7 Mybatis è¿è¡Œç¯å¢ƒï¼ˆ jar åŒ…ï¼‰ MySQL é©±åŠ¨åŒ… å…¶ä»–ä¾èµ–åŒ… 3ã€ log4j.propertiesåœ¨classpathä¸‹åˆ›å»ºlog4j.propertieså¦‚ä¸‹ï¼š 1234567# Global logging configuration#åœ¨å¼€å‘ç¯å¢ƒæ—¥å¿—çº§åˆ«è¦è®¾ç½®ä¸ºDEBUGã€ç”Ÿäº§ç¯å¢ƒè¦è®¾ç½®ä¸ºINFOæˆ–è€…ERRORlog4j.rootLogger=DEBUG, stdout# Console output...log4j.appender.stdout=org.apache.log4j.ConsoleAppenderlog4j.appender.stdout.layout=org.apache.log4j.PatternLayoutlog4j.appender.stdout.layout.ConversionPattern=%5p [%t] - %m%n Mybatisé»˜è®¤ä½¿ç”¨log4jä½œä¸ºè¾“å‡ºæ—¥å¿—ä¿¡æ¯ã€‚ 4ã€å·¥ç¨‹ç»“æ„ 5ã€SqlMapConfig.xmlé…ç½® Mybatis çš„è¿è¡Œç¯å¢ƒã€æ•°æ®æºã€äº‹åŠ¡ç­‰ 1234567891011121314151617181920&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;&lt;!DOCTYPE configuration PUBLIC \"-//mybatis.org//DTD Config 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-config.dtd\"&gt;&lt;configuration&gt; &lt;!-- å’Œspringæ•´åˆå environmentsé…ç½®å°†åºŸé™¤--&gt; &lt;environments default=\"development\"&gt; &lt;environment id=\"development\"&gt; &lt;!-- ä½¿ç”¨jdbcäº‹åŠ¡ç®¡ç†,äº‹åŠ¡ç”± Mybatis æ§åˆ¶--&gt; &lt;transactionManager type=\"JDBC\" /&gt; &lt;!-- æ•°æ®åº“è¿æ¥æ± ,ç”±Mybatisç®¡ç†ï¼Œæ•°æ®åº“åæ˜¯mybatis_testï¼ŒMysqlç”¨æˆ·årootï¼Œå¯†ç root --&gt; &lt;dataSource type=\"POOLED\"&gt; &lt;property name=\"driver\" value=\"com.mysql.jdbc.Driver\" /&gt; &lt;property name=\"url\" value=\"jdbc:mysql://localhost:3306/mybatis_test?characterEncoding=utf-8\" /&gt; &lt;property name=\"username\" value=\"root\" /&gt; &lt;property name=\"password\" value=\"root\" /&gt; &lt;/dataSource&gt; &lt;/environment&gt; &lt;/environments&gt;&lt;/configuration&gt; 6ã€åˆ›å»º po ç±»Po ç±»ä½œä¸º mybatis è¿›è¡Œ sql æ˜ å°„ä½¿ç”¨ï¼Œpo ç±»é€šå¸¸ä¸æ•°æ®åº“è¡¨å¯¹åº”ï¼ŒUser.java å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657package cn.zhisheng.mybatis.po;import java.util.Date;/** * Created by 10412 on 2016/11/28. */public class User&#123; private int id; private String username; // ç”¨æˆ·å§“å private String sex; // æ€§åˆ« private Date birthday; // ç”Ÿæ—¥ private String address; // åœ°å€ //getter and setter public int getId() &#123; return id; &#125; public void setId(int id) &#123; this.id = id; &#125; public String getUsername() &#123; return username; &#125; public void setUsername(String username) &#123; this.username = username; &#125; public Date getBirthday() &#123; return birthday; &#125; public void setBirthday(Date birthday) &#123; this.birthday = birthday; &#125; public String getSex() &#123; return sex; &#125; public void setSex(String sex) &#123; this.sex = sex; &#125; public String getAddress() &#123; return address; &#125; public void setAddress(String address) &#123; this.address = address; &#125;&#125; 7ã€æ ¹æ®ç”¨æˆ· idï¼ˆä¸»é”®ï¼‰æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ æ˜ å°„æ–‡ä»¶ User.xmlï¼ˆåŸåœ¨ Ibatis ä¸­å‘½åï¼‰åœ¨ Mybatis ä¸­å‘½åè§„åˆ™ä¸º xxxmapper.xml åœ¨æ˜ å°„æ–‡ä»¶ä¸­é…ç½® sql è¯­å¥ User.xml 123456&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;&lt;!DOCTYPE mapperPUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\"\"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"&gt;&lt;mapper namespace=\"test\"&gt;&lt;/mapper&gt; namespace ï¼šå‘½åç©ºé—´ï¼Œå¯¹ sql è¿›è¡Œåˆ†ç±»åŒ–ç®¡ç†ï¼Œç”¨äºéš”ç¦» sql è¯­å¥ï¼Œåé¢ä¼šè®²å¦ä¸€å±‚éå¸¸é‡è¦çš„ä½œç”¨ã€‚ â€‹ åœ¨ User.xml ä¸­åŠ å…¥ 123456789101112&lt;!--é€šè¿‡selectæ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢ id:æ ‡è¯†æ˜ å°„æ–‡ä»¶ä¸­çš„sql å°†sqlè¯­å¥å°è£…åˆ°mappedStatementå¯¹è±¡ä¸­ï¼Œæ‰€ä»¥idç§°ä¸ºStatementçš„id #&#123;&#125;ï¼šè¡¨ç¤ºå ä½ç¬¦ #&#123;id&#125;ï¼šå…¶ä¸­çš„idè¡¨ç¤ºæ¥æ”¶è¾“å…¥çš„å‚æ•°ï¼Œå‚æ•°åç§°å°±æ˜¯idï¼Œå¦‚æœè¾“å…¥å‚æ•°æ˜¯ç®€å•ç±»å‹ï¼Œé‚£ä¹ˆ#&#123;&#125;ä¸­çš„å‚æ•°åå¯ä»¥ä»»æ„ï¼Œå¯ä»¥æ˜¯valueæˆ–è€…å…¶ä»–åç§° parameterTypeï¼šè¡¨ç¤ºæŒ‡å®šè¾“å…¥å‚æ•°çš„ç±»å‹ resultTypeï¼šè¡¨ç¤ºæŒ‡å®šsqlè¾“å‡ºç»“æœçš„æ‰€æ˜ å°„çš„javaå¯¹è±¡ç±»å‹ --&gt;&lt;!-- æ ¹æ®idè·å–ç”¨æˆ·ä¿¡æ¯ --&gt; &lt;select id=\"findUserById\" parameterType=\"int\" resultType=\"cn.zhisheng.mybatis.po.User\"&gt; select * from user where id = #&#123;id&#125; &lt;/select&gt; User.xml æ˜ å°„æ–‡ä»¶å·²ç»å®Œå…¨å†™å¥½äº†ï¼Œé‚£æ¥ä¸‹æ¥å°±éœ€è¦åœ¨ SqlMapConfig.xmlä¸­åŠ è½½æ˜ å°„æ–‡ä»¶ User.xml 1234&lt;!--åŠ è½½æ˜ å°„æ–‡ä»¶--&gt; &lt;mappers&gt; &lt;mapper resource=\"sqlmap/User.xml\"/&gt; &lt;/mappers&gt; â€‹ ç¼–å†™ç¨‹åº `MybatisFirst.java` â€‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445package cn.zhisheng.mybatis.first;import cn.zhisheng.mybatis.po.User;import org.apache.ibatis.io.Resources;import org.apache.ibatis.session.SqlSession;import org.apache.ibatis.session.SqlSessionFactory;import org.apache.ibatis.session.SqlSessionFactoryBuilder;import org.junit.Test;import java.io.IOException;import java.io.InputStream; /*** Created by 10412 on 2016/11/28.*/public class MybatisFirst&#123; //æ ¹æ®idæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼Œå¾—åˆ°ç”¨æˆ·çš„ä¸€æ¡è®°å½• @Test public void findUserByIdTest() throws IOException &#123; //Mybatis é…ç½®æ–‡ä»¶ String resource = \"SqlMapConfig.xml\"; //å¾—åˆ°é…ç½®æ–‡ä»¶æµ InputStream inputStream = Resources.getResourceAsStream(resource); //åˆ›å»ºä¼šè¯å·¥å‚,ä¼ å…¥Mybatisçš„é…ç½®æ–‡ä»¶ä¿¡æ¯ SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream); //é€šè¿‡å·¥å‚å¾—åˆ°SqlSession SqlSession sqlSession = sqlSessionFactory.openSession(); //é€šè¿‡SqlSessionæ“ä½œæ•°æ®åº“ //ç¬¬ä¸€ä¸ªå‚æ•°ï¼šæ˜ å°„æ–‡ä»¶ä¸­Statementçš„idï¼Œç­‰äº = namespace + \".\" + Statementçš„id //ç¬¬äºŒä¸ªå‚æ•°ï¼šæŒ‡å®šå’Œæ˜ å°„æ–‡ä»¶ä¸­æ‰€åŒ¹é…çš„parameterTypeç±»å‹çš„å‚æ•° //sqlSession.selectOne ç»“æœä¸æ˜ å°„æ–‡ä»¶ä¸­æ‰€åŒ¹é…çš„resultTypeç±»å‹çš„å¯¹è±¡ User user = sqlSession.selectOne(\"test.findUserById\", 1); System.out.println(user); //é‡Šæ”¾èµ„æº sqlSession.close(); &#125;&#125; ç„¶åè¿è¡Œä¸€ä¸‹è¿™ä¸ªæµ‹è¯•ï¼Œå‘ç°ç»“æœå¦‚ä¸‹å°±ä»£è¡¨å¯ä»¥äº†ï¼š 8ã€æ ¹æ®ç”¨æˆ·åç§°æ¨¡ç³ŠæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯åˆ—è¡¨ æ˜ å°„æ–‡ä»¶ ä¾æ—§ä½¿ç”¨ User.xml æ–‡ä»¶ï¼Œåªä¸è¿‡è¦åœ¨åŸæ¥çš„æ–‡ä»¶ä¸­åŠ å…¥ 123456789&lt;!-- è‡ªå®šä¹‰æ¡ä»¶æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨ resultTypeï¼šæŒ‡å®šå°±æ˜¯å•æ¡è®°å½•æ‰€æ˜ å°„çš„javaå¯¹è±¡ç±»å‹ $&#123;&#125;:è¡¨ç¤ºæ‹¼æ¥sqlä¸²ï¼Œå°†æ¥æ”¶åˆ°çš„å‚æ•°å†…å®¹ä¸åŠ ä¿®é¥°çš„æ‹¼æ¥åœ¨sqlä¸­ ä½¿ç”¨$&#123;&#125;æ‹¼æ¥sqlï¼Œä¼šå¼•èµ·sqlæ³¨å…¥ $&#123;value&#125;ï¼šæ¥æ”¶è¾“å…¥å‚æ•°çš„å†…å®¹ï¼Œå¦‚æœä¼ å…¥ç±»å‹æ˜¯ç®€å•ç±»å‹ï¼Œ$&#123;&#125;ä¸­åªèƒ½å¤Ÿä½¿ç”¨value--&gt; &lt;select id=\"findUserByUsername\" parameterType=\"java.lang.String\" resultType=\"cn.zhisheng.mybatis.po.User\"&gt; select * from user where username like '%$&#123;value&#125;%' &lt;/select&gt; ç¼–å†™ç¨‹åº ä¾æ—§ç›´æ¥åœ¨åˆšæ‰é‚£ä¸ª MybatisFirst.java ä¸­åŠ å…¥æµ‹è¯•ä»£ç ï¼š 12345678910111213141516171819202122232425262728//æ ¹æ®ç”¨æˆ·åç§°æ¨¡ç³ŠæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯åˆ—è¡¨ @Test public void findUserByUsernameTest() throws IOException &#123; //Mybatis é…ç½®æ–‡ä»¶ String resource = \"SqlMapConfig.xml\"; //å¾—åˆ°é…ç½®æ–‡ä»¶æµ InputStream inputStream = Resources.getResourceAsStream(resource); //åˆ›å»ºä¼šè¯å·¥å‚,ä¼ å…¥Mybatisçš„é…ç½®æ–‡ä»¶ä¿¡æ¯ SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream); //é€šè¿‡å·¥å‚å¾—åˆ°SqlSession SqlSession sqlSession = sqlSessionFactory.openSession(); //é€šè¿‡SqlSessionæ“ä½œæ•°æ®åº“ //ç¬¬ä¸€ä¸ªå‚æ•°ï¼šæ˜ å°„æ–‡ä»¶ä¸­Statementçš„idï¼Œç­‰äº = namespace + \".\" + Statementçš„id //ç¬¬äºŒä¸ªå‚æ•°ï¼šæŒ‡å®šå’Œæ˜ å°„æ–‡ä»¶ä¸­æ‰€åŒ¹é…çš„parameterTypeç±»å‹çš„å‚æ•° //selectList æŸ¥è¯¢ç»“æœå¯èƒ½å¤šæ¡ //listä¸­çš„userå’Œæ˜ å°„æ–‡ä»¶ä¸­resultTypeæ‰€æŒ‡å®šçš„ç±»å‹ä¸€è‡´ List&lt;User&gt; list = sqlSession.selectList(\"test.findUserByUsername\", \"å°æ˜\"); System.out.println(list); //é‡Šæ”¾èµ„æº sqlSession.close(); &#125; åŒæ ·æµ‹è¯•ä¸€ä¸‹findUserByUsernameTest ï¼Œå¦‚æœè¿è¡Œç»“æœå¦‚ä¸‹å°±ä»£è¡¨æ²¡é—®é¢˜ï¼š æç¤ºï¼šé€šè¿‡è¿™ä¸ªä»£ç å¯ä»¥å‘ç°ï¼Œå…¶ä¸­æœ‰ä¸€éƒ¨åˆ†ä»£ç æ˜¯å†—ä½™çš„ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶å°è£…æˆä¸€ä¸ªå‡½æ•°ã€‚ 1234567public void createSqlSessionFactory() throws IOException &#123; // é…ç½®æ–‡ä»¶ String resource = \"SqlMapConfig.xml\"; InputStream inputStream = Resources.getResourceAsStream(resource); // ä½¿ç”¨SqlSessionFactoryBuilderä»xmlé…ç½®æ–‡ä»¶ä¸­åˆ›å»ºSqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream); &#125; æ³¨æ„ï¼š1ã€#{ } å’Œ ${ } çš„åŒºåˆ« #{ }è¡¨ç¤ºä¸€ä¸ªå ä½ç¬¦å·ï¼Œé€šè¿‡#{ }å¯ä»¥å®ç° preparedStatement å‘å ä½ç¬¦ä¸­è®¾ç½®å€¼ï¼Œè‡ªåŠ¨è¿›è¡Œjava ç±»å‹å’Œ jdbc ç±»å‹è½¬æ¢ï¼Œ#{ } å¯ä»¥æœ‰æ•ˆé˜²æ­¢sqlæ³¨å…¥ã€‚#{ } å¯ä»¥æ¥æ”¶ç®€å•ç±»å‹å€¼æˆ– pojo å±æ€§å€¼ï¼ˆé€šè¿‡ OGNL è¯»å–å¯¹è±¡ä¸­çš„å€¼ï¼Œå±æ€§.å±æ€§.å±æ€§..æ–¹å¼è·å–å¯¹è±¡å±æ€§å€¼ï¼‰ã€‚ å¦‚æœ parameterType ä¼ è¾“å•ä¸ªç®€å•ç±»å‹å€¼ï¼Œ#{ }æ‹¬å·ä¸­å¯ä»¥æ˜¯ value æˆ–å…¶å®ƒåç§°ã€‚ ${ } è¡¨ç¤ºæ‹¼æ¥ sql ä¸²ï¼Œé€šè¿‡${ }å¯ä»¥å°† parameterType ä¼ å…¥çš„å†…å®¹æ‹¼æ¥åœ¨ sql ä¸­ä¸”ä¸è¿›è¡Œ jdbc ç±»å‹è½¬æ¢ï¼Œ ${ }å¯ä»¥æ¥æ”¶ç®€å•ç±»å‹å€¼æˆ– pojo å±æ€§å€¼ï¼ˆï¼ˆé€šè¿‡ OGNL è¯»å–å¯¹è±¡ä¸­çš„å€¼ï¼Œå±æ€§.å±æ€§.å±æ€§..æ–¹å¼è·å–å¯¹è±¡å±æ€§å€¼ï¼‰ï¼‰ï¼Œå¦‚æœ parameterType ä¼ è¾“å•ä¸ªç®€å•ç±»å‹å€¼ï¼Œ${}æ‹¬å·ä¸­åªèƒ½æ˜¯ valueã€‚ 2ã€parameterType å’Œ resultType åŒºåˆ« parameterTypeï¼šæŒ‡å®šè¾“å…¥å‚æ•°ç±»å‹ï¼Œmybatis é€šè¿‡ ognl ä»è¾“å…¥å¯¹è±¡ä¸­è·å–å‚æ•°å€¼æ‹¼æ¥åœ¨ sql ä¸­ã€‚ resultTypeï¼šæŒ‡å®šè¾“å‡ºç»“æœç±»å‹ï¼Œmybatis å°† sql æŸ¥è¯¢ç»“æœçš„ä¸€è¡Œè®°å½•æ•°æ®æ˜ å°„ä¸º resultType æŒ‡å®šç±»å‹çš„å¯¹è±¡ã€‚ 3ã€selectOne å’Œ selectList åŒºåˆ« selectOne æŸ¥è¯¢ä¸€æ¡è®°å½•æ¥è¿›è¡Œæ˜ å°„ï¼Œå¦‚æœä½¿ç”¨selectOneæŸ¥è¯¢å¤šæ¡è®°å½•åˆ™æŠ›å‡ºå¼‚å¸¸ï¼š org.apache.ibatis.exceptions.TooManyResultsException: Expected one result (or null) to bereturned by selectOne(), but found: 3 at selectList å¯ä»¥æŸ¥è¯¢ä¸€æ¡æˆ–å¤šæ¡è®°å½•æ¥è¿›è¡Œæ˜ å°„ã€‚ 9ã€æ·»åŠ ç”¨æˆ· æ˜ å°„æ–‡ä»¶ åœ¨ User.xml ä¸­åŠ å…¥ï¼š 12345678&lt;!-- æ·»åŠ ç”¨æˆ· --&gt; &lt;insert id=\"insetrUser\" parameterType=\"cn.zhisheng.mybatis.po.User\" &gt; &lt;selectKey keyProperty=\"id\" order=\"AFTER\" resultType=\"java.lang.Integer\"&gt; select LAST_INSERT_ID() &lt;/selectKey&gt; insert into user(username, birthday, sex, address) values(#&#123;username&#125;, #&#123;birthday&#125;, #&#123;sex&#125;, #&#123;address&#125;) &lt;/insert&gt; æ³¨æ„: selectKeyå°†ä¸»é”®è¿”å›ï¼Œéœ€è¦å†è¿”å› æ·»åŠ selectKeyå®ç°å°†ä¸»é”®è¿”å› keyProperty:è¿”å›çš„ä¸»é”®å­˜å‚¨åœ¨pojoä¸­çš„å“ªä¸ªå±æ€§ orderï¼šselectKeyçš„æ‰§è¡Œé¡ºåºï¼Œæ˜¯ç›¸å¯¹ä¸insertè¯­å¥æ¥è¯´ï¼Œç”±äºmysqlçš„è‡ªå¢åŸç†æ‰§è¡Œå®Œinsertè¯­å¥ä¹‹åæ‰å°†ä¸»é”®ç”Ÿæˆï¼Œæ‰€ä»¥è¿™é‡ŒselectKeyçš„æ‰§è¡Œé¡ºåºä¸ºafter resultType:è¿”å›çš„ä¸»é”®æ˜¯ä»€ä¹ˆç±»å‹ LAST_INSERT_ID():æ˜¯mysqlçš„å‡½æ•°ï¼Œè¿”å›auto_incrementè‡ªå¢åˆ—æ–°è®°å½•idå€¼ã€‚ ç„¶ååœ¨ MybatisFirst.java ä¸­å†™ä¸€ä¸ªæµ‹è¯•å‡½æ•°ï¼Œä»£ç å¦‚ä¸‹ 123456789101112131415161718192021@Test public void insetrUser() throws IOException, ParseException &#123; //Mybatis é…ç½®æ–‡ä»¶ String resource = \"SqlMapConfig.xml\"; //å¾—åˆ°é…ç½®æ–‡ä»¶æµ InputStream inputStream = Resources.getResourceAsStream(resource); //åˆ›å»ºä¼šè¯å·¥å‚,ä¼ å…¥Mybatisçš„é…ç½®æ–‡ä»¶ä¿¡æ¯ SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream); //é€šè¿‡å·¥å‚å¾—åˆ°SqlSession SqlSession sqlSession = sqlSessionFactory.openSession(); User user = new User(); SimpleDateFormat sdf = new SimpleDateFormat (\"yyyy-MM-dd\"); user.setUsername(\"ç”°å¿—å£°\"); user.setSex(\"ç”·\"); user.setBirthday(sdf.parse(\"2016-11-29\")); user.setAddress(\"æ±Ÿè¥¿å—æ˜Œ\"); sqlSession.insert(\"test.insetrUser\", user); sqlSession.commit(); //é‡Šæ”¾èµ„æº sqlSession.close(); &#125; ç„¶å run ä¸€ä¸‹ï¼Œå¦‚æœå‡ºç°çš„ç»“æœå¦‚ä¸‹ï¼Œé‚£ä¹ˆå°±æ˜¯æˆåŠŸäº†ã€‚ åŒæ—¶æ•°æ®åº“ä¹Ÿèƒ½æŸ¥è¯¢åˆ°åˆšæ’å…¥çš„ç”¨æˆ·ä¿¡æ¯ï¼š 10ã€è‡ªå¢ä¸»é”®è¿”å› ä¸ éè‡ªå¢ä¸»é”®è¿”å› MySQL è‡ªå¢ä¸»é”®ï¼šæ‰§è¡Œ insert æäº¤ä¹‹å‰è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªè‡ªå¢ä¸»é”®ï¼Œé€šè¿‡ MySQL å‡½æ•°è·å–åˆ°åˆšæ’å…¥è®°å½•çš„è‡ªå¢ä¸»é”®ï¼š LAST_INSERT_ID() ï¼Œæ˜¯åœ¨ insert å‡½æ•°ä¹‹åè°ƒç”¨ã€‚ éè‡ªå¢ä¸»é”®è¿”å›ï¼šä½¿ç”¨ MySQL çš„ uuid() å‡½æ•°ç”Ÿæˆä¸»é”®ï¼Œéœ€è¦ä¿®æ”¹è¡¨ä¸­ id å­—æ®µç±»å‹ä¸º String ï¼Œé•¿åº¦è®¾ç½®ä¸º 35 ä½ï¼Œæ‰§è¡Œæ€è·¯ï¼šå…ˆé€šè¿‡ uuid() æŸ¥è¯¢åˆ°ä¸»é”®ï¼Œå°†ä¸»é”®è¾“å…¥åˆ° sql è¯­å¥ä¸­ï¼›æ‰§è¡Œ uuid() è¯­å¥é¡ºåºç›¸å¯¹äº insert è¯­å¥ä¹‹å‰æ‰§è¡Œã€‚ åˆšæ‰é‚£ä¸ªæ’å…¥ç”¨æˆ·çš„åœ°æ–¹ï¼Œå…¶å®ä¹Ÿå¯ä»¥é€šè¿‡ uuid() æ¥ç”Ÿæˆä¸»é”®ï¼Œå¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦åœ¨ User.xml ä¸­åŠ å…¥å¦‚ä¸‹ä»£ç ï¼š 123456789&lt;!--ä½¿ç”¨ MySQL çš„ uuid()ç”Ÿæˆä¸»é”® æ‰§è¡Œè¿‡ç¨‹ï¼š é¦–å…ˆé€šè¿‡uuid()å¾—åˆ°ä¸»é”®ï¼Œå°†ä¸»é”®è®¾ç½®åˆ°userå¯¹è±¡çš„idå±æ€§ä¸­ å…¶æ¬¡æ‰§è¡Œinsertæ—¶ï¼Œä»userå¯¹è±¡ä¸­å–å‡ºidå±æ€§å€¼ --&gt;&lt;selectKey keyProperty=\"id\" order=\"BEFORE\" resultType=\"java.lang.String\"&gt; select uuid()&lt;/selectKey&gt;insert into user(id, username, birthday, sex, address) values(#&#123;id&#125;, #&#123;username&#125;, #&#123;birthday&#125;, #&#123;sex&#125;, #&#123;address&#125;) Oracle ä½¿ç”¨åºåˆ—ç”Ÿæˆä¸»é”® é¦–å…ˆè‡ªå®šä¹‰ä¸€ä¸ªåºåˆ—ä¸”ç”¨äºç”Ÿæˆä¸»é”®ï¼ŒselectKeyä½¿ç”¨å¦‚ä¸‹ï¼š 12345678&lt;insert id=\"insertUser\" parameterType=\"cn.itcast.mybatis.po.User\"&gt; &lt;selectKey resultType=\"java.lang.Integer\" order=\"BEFORE\" keyProperty=\"id\"&gt; SELECT è‡ªå®šä¹‰åºåˆ—.NEXTVAL FROM DUAL &lt;/selectKey&gt;insert into user(id,username,birthday,sex,address) values(#&#123;id&#125;,#&#123;username&#125;,#&#123;birthday&#125;,#&#123;sex&#125;,#&#123;address&#125;)&lt;/insert&gt; â€‹ 11ã€åˆ é™¤ç”¨æˆ·å‰é¢è¯´äº†è¿™ä¹ˆå¤šäº†ï¼Œè¿™é‡Œå°±ç®€å•æ¥è¯´æ˜ä¸‹ï¼š åœ¨ User.xml æ–‡ä»¶ä¸­åŠ å…¥å¦‚ä¸‹ä»£ç ï¼š 1234&lt;!--åˆ é™¤ç”¨æˆ·--&gt; &lt;delete id=\"deleteUserById\" parameterType=\"int\"&gt; delete from user where user.id = #&#123;id&#125; &lt;/delete&gt; åœ¨ MybatisFirst.java æ–‡ä»¶ä¸­åŠ å…¥å¦‚ä¸‹ä»£ç ï¼š 1234567891011121314151617181920212223242526272829//åˆ é™¤ç”¨æˆ· @Test public void deleteUserByIdTest() throws IOException &#123; //Mybatis é…ç½®æ–‡ä»¶ String resource = \"SqlMapConfig.xml\"; //å¾—åˆ°é…ç½®æ–‡ä»¶æµ InputStream inputStream = Resources.getResourceAsStream(resource); //åˆ›å»ºä¼šè¯å·¥å‚,ä¼ å…¥Mybatisçš„é…ç½®æ–‡ä»¶ä¿¡æ¯ SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream); //é€šè¿‡å·¥å‚å¾—åˆ°SqlSession SqlSession sqlSession = sqlSessionFactory.openSession(); //é€šè¿‡SqlSessionæ“ä½œæ•°æ®åº“ //ç¬¬ä¸€ä¸ªå‚æ•°ï¼šæ˜ å°„æ–‡ä»¶ä¸­Statementçš„idï¼Œç­‰äº = namespace + \".\" + Statementçš„id //ç¬¬äºŒä¸ªå‚æ•°ï¼šæŒ‡å®šå’Œæ˜ å°„æ–‡ä»¶ä¸­æ‰€åŒ¹é…çš„parameterTypeç±»å‹çš„å‚æ•° sqlSession.delete(\"test.deleteUserById\", 26); //æäº¤äº‹åŠ¡ sqlSession.commit(); //é‡Šæ”¾èµ„æº sqlSession.close(); &#125; æµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š ä¹‹å‰çš„æ•°æ®åº“ user è¡¨æŸ¥è¯¢ç»“æœï¼š æ‰§è¡Œå®Œæµ‹è¯•ä»£ç åï¼Œç»“æœå¦‚ä¸‹ï¼š 12ã€æ›´æ–°ç”¨æˆ·ä¿¡æ¯åœ¨ User.xml ä¸­åŠ å…¥å¦‚ä¸‹ä»£ç ï¼š 123456789&lt;!--æ ¹æ®idæ›´æ–°ç”¨æˆ· éœ€è¦è¾“å…¥ç”¨æˆ·çš„id ä¼ å…¥ç”¨æˆ·è¦æ›´æ–°çš„ä¿¡æ¯ parameterTypeæŒ‡å®šuserå¯¹è±¡ï¼ŒåŒ…æ‹¬idå’Œæ›´æ–°ä¿¡æ¯ï¼Œidå¿…é¡»å­˜åœ¨ #&#123;id&#125;ï¼šä»è¾“å…¥å¯¹è±¡ä¸­è·å–idå±æ€§å€¼--&gt;&lt;update id=\"updateUserById\" parameterType=\"cn.zhisheng.mybatis.po.User\"&gt; update user set username = #&#123;username&#125;, birthday = #&#123;birthday&#125;, sex = #&#123;sex&#125;, address = #&#123;address&#125; where user.id = #&#123;id&#125; &lt;/update&gt; ç„¶ååœ¨ MybatisFirst.java ä¸­åŠ å…¥ 12345678910111213141516171819202122232425262728293031323334353637//æ ¹æ®idæ›´æ–°ç”¨æˆ·ä¿¡æ¯ @Test public void updateUserByIdTest() throws IOException, ParseException &#123; //Mybatis é…ç½®æ–‡ä»¶ String resource = \"SqlMapConfig.xml\"; //å¾—åˆ°é…ç½®æ–‡ä»¶æµ InputStream inputStream = Resources.getResourceAsStream(resource); //åˆ›å»ºä¼šè¯å·¥å‚,ä¼ å…¥Mybatisçš„é…ç½®æ–‡ä»¶ä¿¡æ¯ SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream); //é€šè¿‡å·¥å‚å¾—åˆ°SqlSession SqlSession sqlSession = sqlSessionFactory.openSession(); //ä¸ºäº†è®¾ç½®ç”Ÿæ—¥çš„æ—¥æœŸè¾“å…¥ SimpleDateFormat sdf = new SimpleDateFormat (\"yyyy-MM-dd\"); User user = new User(); //æ ¹æ®idæ›´æ–°ç”¨æˆ·ä¿¡æ¯ user.setId(24); user.setUsername(\"å¼ å››é£\"); user.setBirthday(sdf.parse(\"2015-01-12\")); user.setSex(\"å¥³\"); user.setAddress(\"ä¸Šæµ·é»„åŸ”\"); //é€šè¿‡SqlSessionæ“ä½œæ•°æ®åº“ //ç¬¬ä¸€ä¸ªå‚æ•°ï¼šæ˜ å°„æ–‡ä»¶ä¸­Statementçš„idï¼Œç­‰äº = namespace + \".\" + Statementçš„id //ç¬¬äºŒä¸ªå‚æ•°ï¼šæŒ‡å®šå’Œæ˜ å°„æ–‡ä»¶ä¸­æ‰€åŒ¹é…çš„parameterTypeç±»å‹çš„å‚æ•° sqlSession.update(\"test.updateUserById\", user); //æäº¤äº‹åŠ¡ sqlSession.commit(); //é‡Šæ”¾èµ„æº sqlSession.close(); &#125; æµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š æŸ¥çœ‹æ•°æ®åº“ï¼Œid ä¸º 24 çš„ç”¨æˆ·ä¿¡æ¯æ˜¯å¦æ›´æ–°äº†ï¼š å•Šï¼Œæ˜¯ä¸æ˜¯å¾ˆçˆ½ï¼Œæ‰€æœ‰çš„éœ€æ±‚éƒ½å®Œæˆäº†ã€‚ æ²¡é”™ï¼Œè¿™åªæ˜¯ Mybatis çš„ä¸€ä¸ªç®€å•çš„å…¥é—¨ç¨‹åºï¼Œç®€å•çš„å®ç°äº†å¯¹æ•°æ®åº“çš„å¢åˆ æ”¹æŸ¥åŠŸèƒ½ï¼Œé€šè¿‡è¿™ä¸ªæˆ‘ä»¬å¤§æ¦‚å¯ä»¥äº†è§£è¿™ä¸ªç¼–ç¨‹æ–¹å¼äº†ã€‚ æœŸå¾…æ¥ä¸‹æ¥çš„ Mybatisé«˜çº§çŸ¥è¯†æ–‡ç« å§ï¼ æ›´å¤šæ–‡ç« è¯·è§ å¾®ä¿¡å…¬ä¼—å·ï¼šçŒ¿blog","tags":[{"name":"Mybatis","slug":"Mybatis","permalink":"http://www.54tianzhisheng.cn/tags/Mybatis/"},{"name":"SpringMVC","slug":"SpringMVC","permalink":"http://www.54tianzhisheng.cn/tags/SpringMVC/"}]},{"title":"Â å…­æœˆ â€”â€” æ„¿ä½ åšæœ€ç¾å¥½çš„è‡ªå·±ï¼","date":"2017-06-01T16:00:00.000Z","path":"2017/06/02/poetry2/","text":"ç¾å¦™çš„å…­æœˆå·²ç»åˆ°æ¥ï¼Œé€ä½ å…«å°ä¿¡ï¼Œæ„¿æ—¶å…‰è½»ç¼“ï¼Œæ„¿å¾®é£æ­£å¥½ï¼Œæ„¿ä½ åšæœ€ç¾å¥½çš„è‡ªå·±ã€‚ ç¬¬ä¸€å° â€”â€” å…³äºå‹åŠ› é¸¡è›‹ï¼Œä»å¤–æ‰“ç ´æ˜¯é£Ÿç‰©ï¼Œä»å†…æ‰“ç ´æ˜¯ç”Ÿå‘½ã€‚äººç”Ÿäº¦æ˜¯ï¼Œä»å¤–æ‰“ç ´æ˜¯å‹åŠ›ï¼Œä»å†…æ‰“ç ´æ˜¯æˆé•¿ã€‚å¦‚æœä½ ç­‰å¾…åˆ«äººæ‰“ç ´ä½ ï¼Œé‚£ä¹ˆä½ æ³¨å®šæˆä¸ºåˆ«äººçš„é£Ÿç‰©ï¼›å¦‚æœèƒ½è®©è‡ªå·±ä»å†…æ‰“ç ´ï¼Œé‚£ä¹ˆä½ ä¼šå‘ç°è‡ªå·±çš„æˆé•¿ç›¸å½“äºä¸€ç§é‡ç”Ÿã€‚ ç¬¬äºŒå° â€”â€” å…³äºè¯»ä¹¦ è¯»ä¹¦æ˜¯ä¸€ç§å……å®äººç”Ÿçš„è‰ºæœ¯ï¼Œæ²¡æœ‰ä¹¦çš„äººç”Ÿå°±åƒç©ºå¿ƒçš„ç«¹å­ä¸€æ ·ï¼Œç©ºæ´æ— ç‰©ã€‚çŠ¹å¤ªäººè®©å­©å­ä»¬äº²å»æ¶‚æœ‰èœ‚èœœçš„ä¹¦æœ¬ï¼Œæ˜¯ä¸ºäº†è®©ä»–ä»¬è®°ä½ï¼šä¹¦æœ¬æ˜¯ç”œçš„ï¼Œè¦è®©ç”œèœœå……æ»¡äººç”Ÿå°±è¦è¯»ä¹¦ã€‚è¯»ä¹¦æ˜¯ä¸€æœ¬äººç”Ÿæœ€éš¾å¾—çš„å­˜æŠ˜ï¼Œä¸€ç‚¹ä¸€æ»´åœ°ç§¯ç´¯ï¼Œæœ€åä½ ä¼šå‘ç°ï¼šè‡ªå·±æ˜¯ä¸–ç•Œä¸Šæœ€å¯Œæœ‰çš„äººã€‚ç¬¬ä¸‰å° â€”â€” å…³äºäººé™…å…³ç³» ä½ å¯ä»¥è¦æ±‚è‡ªå·±å®ˆä¿¡ï¼Œä½†ä¸èƒ½è¦æ±‚åˆ«äººå®ˆä¿¡ï¼›ä½ å¯ä»¥è¦æ±‚è‡ªå·±å¯¹äººå¥½ï¼Œä½†ä¸èƒ½æœŸå¾…åˆ«äººå¯¹ä½ å¥½ã€‚ä½ æ€æ ·å¯¹äººï¼Œå¹¶ä¸ä»£è¡¨äººå®¶å°±ä¼šæ€ä¹ˆå¯¹ä½ ã€‚å¦‚æœçœ‹ä¸é€è¿™ä¸€ç‚¹ï¼Œä½ åªä¼šå¾’æ·»ä¸å¿…è¦çš„çƒ¦æ¼ã€‚ ç¬¬å››å° â€”â€” å…³äºå­¤ç‹¬ æ¯ä¸ªäººéƒ½è¦ç»å†ä¸€æ®µå­¤ç‹¬çš„æ—¥å­ï¼Œæ¯æ®µè·¯éƒ½æœ‰ä¸€æ®µç‹¬å­¤çš„æ—¶å…‰ã€‚çˆ¶æ¯ä¸å¯èƒ½ä¸€ç›´å¸®ç€ä½ ï¼Œæœ‹å‹ä¹Ÿä¸å¯èƒ½ä¸€ç›´å›´ç€ä½ è½¬ã€‚å­¤ç‹¬ä¸æ˜¯å­¤åƒ»ï¼Œæ›´ä¸æ˜¯å¯‚å¯ã€‚ç»å†è¿‡å­¤ç‹¬çš„äººï¼Œå†…å¿ƒæ›´åšå¼ºï¼Œä¸ç®¡å¤„äºä»€ä¹ˆæ ·çš„ç¯å¢ƒéƒ½èƒ½è®©è‡ªå·±å®‰é™ï¼Œæ›´å¥½åœ°è°ƒæ•´çŠ¶æ€ï¼Œé¢å¯¹ç¯å¢ƒã€‚ ç¬¬äº”å° â€”â€” å…³äºä¿®å…» çœ‹åˆ«äººä¸é¡ºçœ¼ï¼Œæ˜¯è‡ªå·±ä¿®å…»ä¸å¤Ÿã€‚äººæ„¤æ€’çš„é‚£ä¸€ç¬é—´ï¼Œæ™ºå•†æ˜¯é›¶ï¼Œè¿‡ä¸€åˆ†é’Ÿåæ¢å¤æ­£å¸¸ã€‚äººçš„ä¼˜é›…å…³é”®åœ¨äºæ§åˆ¶è‡ªå·±çš„æƒ°ç»ªï¼Œç”¨å˜´ä¼¤å®³äººï¼Œæ˜¯æœ€æ„šè ¢çš„ä¸€ç§è¡Œä¸ºã€‚ ç¬¬å…­å° â€”â€” å…³äºç°å® ç°å®æœ‰å¤ªå¤šçš„ä¸å¦‚æ„ï¼Œå°±ç®—ç”Ÿæ´»ç»™ä½ çš„æ˜¯åƒåœ¾ï¼Œä½ åŒæ ·èƒ½æŠŠåƒåœ¾è¸©åœ¨è„šåº•ä¸‹ç™»ä¸Šä¸–ç•Œä¹‹å·…ã€‚ä½ è¦æŠŠè‡ªå·±é€¼å‡ºæœ€å¤§çš„æ½œèƒ½ï¼Œæ²¡æœ‰äººä¼šä¸ºä½ çš„æœªæ¥ä¹°å•ï¼Œä½ è¦ä¹ˆåŠªåŠ›å‘ä¸Šçˆ¬ï¼Œè¦ä¹ˆçƒ‚åœ¨ç¤¾ä¼šæœ€åº•å±‚çš„æ³¥é‡Œï¼Œè¿™å°±æ˜¯ç”Ÿæ´»ã€‚ ç¬¬ä¸ƒå° â€”â€” å…³äºè‡ªå·± ä¸€ä¸ªäººç»è¿‡ä¸åŒç¨‹åº¦çš„é›ç‚¼ï¼Œå°±è·å¾—ä¸åŒç¨‹åº¦çš„ä¿®å…»ã€‚å¥½æ¯”é¦™æ–™ï¼Œæ£å¾—æ„ˆç¢ï¼Œç£¨å¾—æ„ˆç»†ï¼Œé¦™å¾—æ„ˆæµ“çƒˆã€‚æˆ‘ä»¬æ›¾å¦‚æ­¤æ¸´æœ›å‘½è¿çš„æ³¢æ¾œï¼Œåˆ°æœ€åæ‰å‘ç°ï¼šäººç”Ÿæœ€æ›¼å¦™çš„é£æ™¯ï¼Œç«Ÿæ˜¯å†…å¿ƒçš„æ·¡å®šä¸ä»å®¹ã€‚æˆ‘ä»¬æ›¾å¦‚æ­¤æœŸç›¼å¤–ç•Œçš„è®¤å¯ï¼Œåˆ°æœ€åæ‰çŸ¥é“ï¼šä¸–ç•Œæ˜¯è‡ªå·±çš„ï¼Œä¸ä»–äººæ¯«æ— å…³ç³»ã€‚ ç¬¬å…«å° â€”â€” å…³äºå¹¸ç¦ å¸¸æœ‰äººè¯´ï¼Œæˆ‘ç°åœ¨ä¸å¹¸ç¦ï¼Œç­‰æˆ‘ç»“äº†å©šæˆ–ä¹°äº†æˆ¿â€¦â€¦å°±å¹¸ç¦äº†ã€‚äº‹å®æ˜¯ï¼Œå¹¸ç¦çš„äººåœ¨å“ªå„¿éƒ½å¹¸ç¦ï¼Œä¸å¹¸ç¦çš„äººåœ¨å“ªå„¿éƒ½ä¸å¹¸ç¦ã€‚æ‰€ä»¥è¦å…ˆåŸ¹å…»è‡ªå·±çš„å¹¸ç¦åŠ›ï¼Œä¸è®ºå‘ç”Ÿä»€ä¹ˆï¼Œåˆ«äººéƒ½åŠ¨ä¸äº†ä½ çš„è‡ªåœ¨å¼€å¿ƒã€‚è¿™æ‰æ˜¯çœŸæ­£å¼ºå¤§çš„æ°”åœºå’Œè‡ªä¿¡ã€‚ å¹¸ç¦çš„äººç”Ÿï¼Œéœ€è¦ä¸‰ç§å§¿æ€ï¼šå¯¹è¿‡å»ï¼Œè¦æ·¡ï¼›å¯¹ç°åœ¨ï¼Œè¦æƒœï¼›å¯¹æœªæ¥ï¼Œè¦ä¿¡ã€‚æ„¿ä½ æ‹¥æœ‰å¹¸ç¦çš„èƒ½åŠ›ï¼Œåšæœ€ç¾å¥½çš„è‡ªå·±ã€‚","tags":[{"name":"éšç¬”","slug":"éšç¬”","permalink":"http://www.54tianzhisheng.cn/tags/éšç¬”/"}]},{"title":"æœ€è¿‘å¾ˆç«çš„é¸¡æ±¤ï¼Œåˆ†äº«ç»™å¤§å®¶","date":"2017-05-11T16:00:00.000Z","path":"2017/05/12/poetry/","text":"&lt;æœ€è¿‘å¾ˆç«çš„ä¸€é¦–å°è¯—ï¼Œåˆ†äº«ç»™å¤§å®¶&gt; çº½çº¦æ—¶é—´æ¯”åŠ å·æ—¶é—´æ—©ä¸‰ä¸ªå°æ—¶ï¼Œ New York is 3 hours ahead of California, ä½†åŠ å·æ—¶é—´å¹¶æ²¡æœ‰å˜æ…¢ã€‚ but it does not make California slow. æœ‰äºº22å²å°±æ¯•ä¸šäº†ï¼Œ Someone graduated at the age of 22, ä½†ç­‰äº†äº”å¹´æ‰æ‰¾åˆ°å¥½çš„å·¥ä½œï¼ but waited 5 years before securing a good job! æœ‰äºº25å²å°±å½“ä¸ŠCEOï¼Œ Someone became a CEO at 25, å´åœ¨50å²å»ä¸–ã€‚ and died at 50. ä¹Ÿæœ‰äººè¿Ÿåˆ°50å²æ‰å½“ä¸ŠCEOï¼Œ While another became a CEO at 50, ç„¶åæ´»åˆ°90å²ã€‚ and lived to 90 years. æœ‰äººä¾ç„¶å•èº«ï¼Œ Someone is still single, åŒæ—¶ä¹Ÿæœ‰äººå·²å©šã€‚ while someone else got married. å¥¥å·´é©¬55å²å°±é€€ä¼‘ï¼Œ Obama retires at 55, å·æ™®70å²æ‰å¼€å§‹å½“æ€»ç»Ÿã€‚ but Trump starts at 70. ä¸–ä¸Šæ¯ä¸ªäººæœ¬æ¥å°±æœ‰è‡ªå·±çš„å‘å±•æ—¶åŒºã€‚ Absolutely everyone in this world works based on their Time Zone. èº«è¾¹æœ‰äº›äººçœ‹ä¼¼èµ°åœ¨ä½ å‰é¢ï¼Œ People around you might seem to go ahead of you, ä¹Ÿæœ‰äººçœ‹ä¼¼èµ°åœ¨ä½ åé¢ã€‚ some might seem to be behind you. ä½†å…¶å®æ¯ä¸ªäººåœ¨è‡ªå·±çš„æ—¶åŒºæœ‰è‡ªå·±çš„æ­¥ç¨‹ã€‚ But everyone is running their own RACE, in their own TIME. ä¸ç”¨å«‰å¦’æˆ–å˜²ç¬‘ä»–ä»¬ã€‚ Donâ€™t envy them or mock them. ä»–ä»¬éƒ½åœ¨è‡ªå·±çš„æ—¶åŒºé‡Œï¼Œä½ ä¹Ÿæ˜¯ï¼ They are in their TIME ZONE, and you are in yours! ç”Ÿå‘½å°±æ˜¯ç­‰å¾…æ­£ç¡®çš„è¡ŒåŠ¨æ—¶æœºã€‚ Life is about waiting for the right moment to act. æ‰€ä»¥ï¼Œæ”¾è½»æ¾ã€‚ So, RELAX. ä½ æ²¡æœ‰è½åã€‚ Youâ€™re not LATE. ä½ æ²¡æœ‰é¢†å…ˆã€‚ Youâ€™re not EARLY. åœ¨å‘½è¿ä¸ºä½ å®‰æ’çš„å±äºè‡ªå·±çš„æ—¶åŒºé‡Œï¼Œä¸€åˆ‡éƒ½å‡†æ—¶ã€‚ You are very much ON TIME, and in your TIME ZONE Destiny set up for you.","tags":[{"name":"éšç¬”","slug":"éšç¬”","permalink":"http://www.54tianzhisheng.cn/tags/éšç¬”/"}]},{"title":"Github pages + Hexo åšå®¢ yilia ä¸»é¢˜ä½¿ç”¨ç•…è¨€è¯„è®ºç³»ç»Ÿ","date":"2017-04-12T16:00:00.000Z","path":"2017/04/13/Hexo-yilia-changyan/","text":"å‰è¨€Hexoçš„Yiliaä¸»é¢˜ç”±äºåŸæ¥ä½¿ç”¨çš„æ˜¯å¤šè¯´çš„ç•™è¨€æ¿ï¼Œè¿‘æœŸå¤šè¯´å…¬å‘Šè¦åœæ­¢æä¾›æœåŠ¡äº†ï¼Œæ‰€ä»¥æˆ‘å°±æŠŠå¤šè¯´æ¢æˆæœç‹çš„ç•…è¨€äº†ï¼Œä¸‹é¢å†™ä¸€ä¸ªç®€å•çš„å°æ•™ç¨‹ã€‚ æ³¨å†Œç•…è¨€è¿›å…¥ç•…è¨€å®˜ç½‘ , ç‚¹å‡»å³ä¸Šè§’ â€œå…è´¹æ³¨å†Œâ€ï¼Œå¹¶å¡«å†™æ³¨å†Œä¿¡æ¯ã€‚ï¼ˆæ³¨æ„åŸŸåéœ€è¦å¤‡æ¡ˆä¿¡æ¯ï¼‰ ç™»å½•å¹¶è¿›å…¥ç•…è¨€åå°æ³¨å†Œå®Œåï¼Œç™»å½•è¿›å…¥ç•…è¨€å®˜ç½‘ï¼Œè·å–ä½ çš„ç•…è¨€ app id å’Œ app keyã€‚ ä½¿ç”¨ç•…è¨€ç³»ç»Ÿä¸‹é¢è¯´ä¸‹ä¿®æ”¹è¯„è®ºä¸ºç•…è¨€çš„æ–¹æ³•ï¼Œå…¶å®æ–¹æ³•å’Œå¤šè¯´æ˜¯å·®ä¸å¤šçš„ã€‚ 1ã€ä¿®æ”¹ themes\\yilia\\layout\\_partial\\article.ejs æ¨¡æ¿ï¼ŒæŠŠå¦‚ä¸‹ä»£ç  1234567&lt;% if (!index &amp;&amp; post.comments &amp;&amp; config.disqus_shortname)&#123; %&gt; &lt;section id=\"comments\"&gt; &lt;div id=\"disqus_thread\"&gt; è¿™é‡Œè¿˜æœ‰å¾ˆå¤šä»£ç  &lt;/div&gt; &lt;/section&gt; &lt;% &#125; %&gt; ä¿®æ”¹ä¸ºï¼š 1234567891011121314151617181920 &lt;% if (!index &amp;&amp; post.comments)&#123; %&gt; &lt;section id=&quot;comments&quot;&gt;&lt;!--é«˜é€Ÿç‰ˆï¼ŒåŠ è½½é€Ÿåº¦å¿«ï¼Œä½¿ç”¨å‰éœ€æµ‹è¯•é¡µé¢çš„å…¼å®¹æ€§--&gt;&lt;div id=&quot;SOHUCS&quot; sid=&quot;&lt;%= page.title %&gt;&quot;&gt;&lt;/div&gt;&lt;script&gt; (function()&#123; var appid = &apos;ä½ çš„APP ID&apos;, conf = &apos;ä½ çš„APP KEY&apos;; var doc = document, s = doc.createElement(&apos;script&apos;), h = doc.getElementsByTagName(&apos;head&apos;)[0] || doc.head || doc.documentElement; s.type = &apos;text/javascript&apos;; s.charset = &apos;utf-8&apos;; s.src = &apos;http://assets.changyan.sohu.com/upload/changyan.js?conf=&apos;+ conf +&apos;&amp;appid=&apos; + appid; h.insertBefore(s,h.firstChild); window.SCS_NO_IFRAME = true; &#125;)()&lt;/script&gt; &lt;/section&gt; &lt;% &#125; %&gt; ä¸Šé¢çš„APP IDå’ŒAPP KEYæ˜¯åœ¨ç•…è¨€è®¾ç½®ä¸­å¾—åˆ°ã€‚ è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ç‚¹çš„æ˜¯ï¼šsid=&quot;&lt;%= page.title %&gt;&quot;&gt; è¿™æ ·çš„è¯ç•…è¨€å°±å¯ä»¥ç›´æ¥æ ¹æ®å¯¹åº”çš„æ–‡ç« æ¥è¯†åˆ«ï¼Œä½¿å¾—æ–‡ç« æœ‰å¯¹åº”çš„è¯„è®ºï¼Œä¸ä¼šéƒ½ä¹±åœ¨ä¸€èµ·ã€‚ 2ã€åœ¨æ¯ç¯‡æ–‡ç« å¼€å¤´çš„ front-matter ä¸­æ·»åŠ ä¸€å¥comments: trueï¼Œç„¶åå›åˆ°åšå®¢æ ¹ç›®å½•æ‰§è¡Œå‘½ä»¤ hexo d -g ï¼Œé‡æ–°ç”Ÿæˆåšå®¢å¹¶éƒ¨ç½²åšå®¢ï¼Œç„¶ååˆ·æ–°ï¼Œä»»é€‰ä¸€ç¯‡æ–‡ç« è¿›å…¥ä¸‹æ‹‰ï¼Œä¼šå‘ç°è¯„è®ºåŠŸèƒ½å¯ä»¥ä½¿ç”¨äº†ã€‚ ä¿®æ”¹ BUGä½†æ˜¯ï¼Œè¿™æ˜¯ä½ ä¼šå‘ç°ä¸€ä¸ª Bugï¼Œè¡¨æƒ…æŒ‰é’®ç‚¹å‡»ä¸äº†ï¼ŒåŸå› æ˜¯è¢«å·¦ä¾§çš„ div å±‚è¦†ç›–äº†ï¼Œå›åˆ°æˆ‘ä»¬åˆšæ‰æ”¹è¿‡çš„ä»£ç ï¼Œæ‰¾åˆ° &lt;div id=&quot;SOHUCS&quot; å¼€å¤´çš„ä¸€ä¸²ä»£ç ã€‚å¹¶åšå¦‚ä¸‹æ›´æ”¹ 1&lt;div id=\"SOHUCS\" sid=\"&lt;%=title %&gt;\" style=\"padding: 0px 30px 0px 46px;\"&gt;&lt;/div&gt; åŠ ä¸Šä¸Šé¢è¿™ä¸€æ®µæ ·å¼ä»£ç ï¼Œå³å¯ä¿®å¤ã€‚ å‚è€ƒæ–‡ç« ï¼š 1ã€Hexoåšå®¢yiliaä¸»é¢˜æ›´æ¢ç•…è¨€è¯„è®ºç³»ç»Ÿ 2ã€åœ¨Hexoä¸­ä½¿ç”¨ç•…è¨€è¯„è®ºç³»ç»Ÿ æ–°å¢ç”±äºé—®é¢˜å¤ªå¤šäº†ï¼Œæ‰€ä»¥æ–°å†™äº†ç¯‡æ–‡ç« ï¼šGithub page + Hexo + yilia æ­å»ºåšå®¢å¯èƒ½ä¼šé‡åˆ°çš„æ‰€æœ‰ç–‘é—®","tags":[{"name":"hexo","slug":"hexo","permalink":"http://www.54tianzhisheng.cn/tags/hexo/"},{"name":"yilia","slug":"yilia","permalink":"http://www.54tianzhisheng.cn/tags/yilia/"}]}]